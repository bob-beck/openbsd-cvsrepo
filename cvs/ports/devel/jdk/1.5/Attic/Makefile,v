head	1.70;
access;
symbols
	OPENBSD_5_0:1.67.0.2
	OPENBSD_5_0_BASE:1.67
	OPENBSD_4_9:1.66.0.2
	OPENBSD_4_9_BASE:1.66
	OPENBSD_4_8:1.60.0.2
	OPENBSD_4_8_BASE:1.60
	OPENBSD_4_7:1.59.0.2
	OPENBSD_4_7_BASE:1.59
	OPENBSD_4_6:1.58.0.2
	OPENBSD_4_6_BASE:1.58
	OPENBSD_4_5:1.55.0.2
	OPENBSD_4_5_BASE:1.55
	OPENBSD_4_4:1.52.0.2
	OPENBSD_4_4_BASE:1.52
	OPENBSD_4_3:1.49.0.2
	OPENBSD_4_3_BASE:1.49
	OPENBSD_4_2:1.42.0.2
	OPENBSD_4_2_BASE:1.42
	OPENBSD_4_1:1.34.0.2
	OPENBSD_4_1_BASE:1.34
	OPENBSD_4_0:1.23.0.2
	OPENBSD_4_0_BASE:1.23
	OPENBSD_3_9:1.13.0.2
	OPENBSD_3_9_BASE:1.13
	OPENBSD_3_8:1.4.0.2
	OPENBSD_3_8_BASE:1.4
	kurt_20050525:1.1.1.1
	kurt:1.1.1;
locks; strict;
comment	@# @;


1.70
date	2011.10.07.13.54.31;	author kurt;	state dead;
branches;
next	1.69;

1.69
date	2011.10.02.13.31.03;	author ajacoutot;	state Exp;
branches;
next	1.68;

1.68
date	2011.09.16.09.24.51;	author espie;	state Exp;
branches;
next	1.67;

1.67
date	2011.04.10.18.01.13;	author jasper;	state Exp;
branches;
next	1.66;

1.66
date	2011.02.05.23.11.17;	author ian;	state Exp;
branches;
next	1.65;

1.65
date	2010.11.27.11.54.53;	author espie;	state Exp;
branches;
next	1.64;

1.64
date	2010.11.26.07.19.00;	author espie;	state Exp;
branches;
next	1.63;

1.63
date	2010.11.15.19.45.59;	author espie;	state Exp;
branches;
next	1.62;

1.62
date	2010.10.24.21.10.57;	author ajacoutot;	state Exp;
branches;
next	1.61;

1.61
date	2010.10.18.17.47.53;	author espie;	state Exp;
branches;
next	1.60;

1.60
date	2010.04.24.20.18.39;	author naddy;	state Exp;
branches;
next	1.59;

1.59
date	2009.08.10.06.31.07;	author kili;	state Exp;
branches;
next	1.58;

1.58
date	2009.05.15.17.47.29;	author kurt;	state Exp;
branches;
next	1.57;

1.57
date	2009.03.25.22.11.16;	author kurt;	state Exp;
branches;
next	1.56;

1.56
date	2009.03.15.09.25.04;	author espie;	state Exp;
branches;
next	1.55;

1.55
date	2009.03.01.20.43.09;	author naddy;	state Exp;
branches;
next	1.54;

1.54
date	2008.12.21.03.59.44;	author kurt;	state Exp;
branches;
next	1.53;

1.53
date	2008.10.22.16.02.24;	author kurt;	state Exp;
branches;
next	1.52;

1.52
date	2008.06.30.20.16.37;	author naddy;	state Exp;
branches;
next	1.51;

1.51
date	2008.06.28.12.34.57;	author kurt;	state Exp;
branches;
next	1.50;

1.50
date	2008.03.17.03.21.25;	author kurt;	state Exp;
branches;
next	1.49;

1.49
date	2008.02.15.15.14.37;	author kurt;	state Exp;
branches;
next	1.48;

1.48
date	2008.01.18.15.52.55;	author kurt;	state Exp;
branches;
next	1.47;

1.47
date	2007.11.30.14.57.23;	author kurt;	state Exp;
branches;
next	1.46;

1.46
date	2007.11.09.15.27.55;	author kurt;	state Exp;
branches;
next	1.45;

1.45
date	2007.11.07.17.04.36;	author kurt;	state Exp;
branches;
next	1.44;

1.44
date	2007.10.25.20.51.41;	author kurt;	state Exp;
branches;
next	1.43;

1.43
date	2007.09.16.02.52.59;	author merdely;	state Exp;
branches;
next	1.42;

1.42
date	2007.07.27.19.29.51;	author kurt;	state Exp;
branches;
next	1.41;

1.41
date	2007.07.06.01.35.57;	author kurt;	state Exp;
branches;
next	1.40;

1.40
date	2007.07.01.20.34.02;	author kurt;	state Exp;
branches;
next	1.39;

1.39
date	2007.06.28.03.20.20;	author ian;	state Exp;
branches;
next	1.38;

1.38
date	2007.06.27.21.51.09;	author kurt;	state Exp;
branches;
next	1.37;

1.37
date	2007.05.01.02.05.46;	author kurt;	state Exp;
branches;
next	1.36;

1.36
date	2007.04.13.00.29.48;	author kurt;	state Exp;
branches;
next	1.35;

1.35
date	2007.04.08.12.43.06;	author kurt;	state Exp;
branches;
next	1.34;

1.34
date	2007.02.04.15.57.06;	author kurt;	state Exp;
branches;
next	1.33;

1.33
date	2007.02.01.21.00.52;	author kurt;	state Exp;
branches;
next	1.32;

1.32
date	2007.01.24.21.05.10;	author kurt;	state Exp;
branches;
next	1.31;

1.31
date	2007.01.23.14.14.37;	author kurt;	state Exp;
branches;
next	1.30;

1.30
date	2006.12.14.09.07.56;	author steven;	state Exp;
branches;
next	1.29;

1.29
date	2006.11.24.21.30.13;	author steven;	state Exp;
branches;
next	1.28;

1.28
date	2006.11.22.19.42.54;	author kurt;	state Exp;
branches;
next	1.27;

1.27
date	2006.11.17.20.19.33;	author kurt;	state Exp;
branches;
next	1.26;

1.26
date	2006.11.11.21.04.27;	author steven;	state Exp;
branches;
next	1.25;

1.25
date	2006.10.03.13.36.28;	author kurt;	state Exp;
branches;
next	1.24;

1.24
date	2006.09.26.17.48.19;	author kurt;	state Exp;
branches;
next	1.23;

1.23
date	2006.07.28.13.18.45;	author kurt;	state Exp;
branches
	1.23.2.1;
next	1.22;

1.22
date	2006.07.10.13.17.39;	author kurt;	state Exp;
branches;
next	1.21;

1.21
date	2006.07.01.09.06.00;	author steven;	state Exp;
branches;
next	1.20;

1.20
date	2006.06.20.02.02.48;	author kurt;	state Exp;
branches;
next	1.19;

1.19
date	2006.06.06.03.02.42;	author kurt;	state Exp;
branches;
next	1.18;

1.18
date	2006.05.26.17.32.21;	author steven;	state Exp;
branches;
next	1.17;

1.17
date	2006.05.15.18.11.22;	author ian;	state Exp;
branches;
next	1.16;

1.16
date	2006.04.28.22.57.11;	author ian;	state Exp;
branches;
next	1.15;

1.15
date	2006.04.28.20.56.15;	author kurt;	state Exp;
branches;
next	1.14;

1.14
date	2006.04.11.00.45.41;	author kurt;	state Exp;
branches;
next	1.13;

1.13
date	2006.02.22.22.52.44;	author kurt;	state Exp;
branches
	1.13.2.1;
next	1.12;

1.12
date	2006.02.16.05.46.21;	author david;	state Exp;
branches;
next	1.11;

1.11
date	2006.01.22.22.46.30;	author kurt;	state Exp;
branches;
next	1.10;

1.10
date	2006.01.02.03.48.40;	author kurt;	state Exp;
branches;
next	1.9;

1.9
date	2005.11.30.02.21.32;	author kurt;	state Exp;
branches;
next	1.8;

1.8
date	2005.11.23.19.39.13;	author kurt;	state Exp;
branches;
next	1.7;

1.7
date	2005.11.22.14.48.07;	author kurt;	state Exp;
branches;
next	1.6;

1.6
date	2005.11.22.14.43.05;	author kurt;	state Exp;
branches;
next	1.5;

1.5
date	2005.09.16.09.51.27;	author espie;	state Exp;
branches;
next	1.4;

1.4
date	2005.08.09.04.38.01;	author kurt;	state Exp;
branches;
next	1.3;

1.3
date	2005.06.03.20.36.07;	author kurt;	state Exp;
branches;
next	1.2;

1.2
date	2005.05.27.09.34.01;	author espie;	state Exp;
branches;
next	1.1;

1.1
date	2005.05.25.17.27.53;	author kurt;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2005.05.25.17.27.53;	author kurt;	state Exp;
branches;
next	;

1.13.2.1
date	2007.01.31.14.52.31;	author kurt;	state Exp;
branches;
next	1.13.2.2;

1.13.2.2
date	2007.02.01.21.06.01;	author kurt;	state Exp;
branches;
next	;

1.23.2.1
date	2006.11.04.09.23.01;	author sturm;	state Exp;
branches;
next	1.23.2.2;

1.23.2.2
date	2007.02.12.22.21.50;	author sturm;	state Exp;
branches;
next	;


desc
@@


1.70
log
@- remove devel/jdk/1.5 and lang/kaffe
- adjust java.port.mk for their removal
- bump affected packages
okay jasper@@
@
text
@# $OpenBSD: Makefile,v 1.69 2011/10/02 13:31:03 ajacoutot Exp $

SHARED_ONLY=		Yes
ONLY_FOR_ARCHS= 	amd64 i386

COMMENT-main=		Java2(TM) Standard Edition Dev Kit v${V}
COMMENT-jre=		Java2(TM) Standard Edition Runtime Environment v${V}
V=			1.5.0.16
PKGNAME=		jdk-${V}
PKGNAME-main=		jdk-${V}
REVISION-main =		7
PKGNAME-jre=		jre-${V}
REVISION-jre =		7

CATEGORIES=		devel devel/jdk java

MULTI_PACKAGES= 	-main -jre

HOMEPAGE=		https://tiger.dev.java.net/

MAINTAINER=		Kurt Miller <kurt@@openbsd.org>

JRLSRC=			jdk-1_5_0_16-fcs-src-b02-jrl-28_may_2008.jar
JRLBIN=			jdk-1_5_0_16-fcs-bin-b02-jrl-28_may_2008.jar
PATCHSET=		bsd-jdk15-patches-9.tar.bz2

DISTFILES=		${JRLSRC} \
			${JRLBIN} \
			${PATCHSET}

MASTER_SITES=		http://www.java.net/download/tiger/tiger_u16/

# Java Research License
# http://www.java.net/jrl.csp
PERMIT_PACKAGE_CDROM=	JRL
PERMIT_PACKAGE_FTP=	JRL
PERMIT_DISTFILES_CDROM= JRL
PERMIT_DISTFILES_FTP=	JRL

NO_REGRESS=		Yes

VMEM_WARNING=		Yes
BUILD_DEPENDS=		archivers/gtar \
			archivers/zip \
			archivers/unzip \
			archivers/bzip2
USE_GROFF =		Yes
MODULES=		converters/libiconv
WANTLIB=		X11 Xext Xi Xt Xtst c m ossaudio pthread \
			pthread-stubs xcb stdc++ z Xm
LIB_DEPENDS+=		x11/openmotif
WANTLIB-main=		${WANTLIB} Xmu

USE_GMAKE=		Yes

TAR=			${LOCALBASE}/bin/gtar

MAKE_ENV=		ALT_MOTIF_DIR="${LOCALBASE}" \
			LOCALDIR="${LOCALBASE}" \
			X11DIR="${X11BASE}" \
			SKIP_COMPARE_IMAGES="YES" \
			DONT_BUILD_DOCS="YES" \
			DONT_BUILD_INSTALL="YES" \
			LANG="C" \
			CC="${CC}" \
			CXX="${CXX}" \
			DEFAULT_LD_LIBRARY_PATH="/usr/lib:${X11BASE}/lib:${LOCALBASE}/lib" \
			USER="${USER}" \
			HOTSPOT_BUILD_JOBS=${HOTSPOT_BUILD_JOBS} \
			MOTIFLIB='-L${LOCALBASE}/lib -lXm'

# Error message for distfile.
FETCH_MANUALLY=		"You must manually fetch the distribution files, place"
FETCH_MANUALLY+=	"them in ${FULLDISTDIR} and then run make again."
FETCH_MANUALLY+=	"Get the 'Update 16 Source under the JRL license' file:"
FETCH_MANUALLY+=	"    ${JRLSRC} and"
FETCH_MANUALLY+=	"    the 'Source Binaries needed for Source Build' file:"
FETCH_MANUALLY+=	"    ${JRLBIN}"
FETCH_MANUALLY+=	"from http://download.java.net/tiger/tiger_u16/"
FETCH_MANUALLY+=	"Get the BSD patchset file:"
FETCH_MANUALLY+=	"   ${PATCHSET}"
FETCH_MANUALLY+=	"from http://www.eyesbeyond.com/freebsddom/java/jdk15.html"

FLAVORS=		no_web with_ipv6
PSEUDO_FLAVORS=		native_bootstrap
FLAVOR?=

.if !${FLAVOR:L:Mwith_ipv6}
MAKE_ENV+=		DONT_ENABLE_IPV6="YES"
.endif

# handle jar files in post-extract
EXTRACT_CASES+=		*.jar) true ;;

.if ${FLAVOR:L:Mnative_bootstrap}
INSTALLED!= (pkg_info -e "jdk->=1.5.0,<1.6" -q && echo yes) || echo no
.if ${INSTALLED:L} != "yes"
ERRORS += "Fatal: This flavor requires an installed 1.5 jdk package"
.endif
BUILD_DEPENDS+=		jdk->=1.5.0,<1.6:devel/jdk/1.5
MAKE_ENV+=		ALT_BOOTDIR="${LOCALBASE}/${JDKHOME}"
.else
DISTFILES+=		jdk-1_5_0_16-solaris-i586.tar.Z \
			xalan-j_2_7_0-bin.tar.gz
FETCH_MANUALLY+=	"Get 'JDK 5.0 Update 16' for 'Solaris x86 packages' file:"
FETCH_MANUALLY+=	"    jdk-1_5_0_16-solaris-i586.tar.Z"
FETCH_MANUALLY+=	"from http://java.sun.com/javase/downloads/index_jdk5.jsp or"
FETCH_MANUALLY+=	"http://java.sun.com/products/archive/j2se/5.0_16/index.html"
FETCH_MANUALLY+=	"Get the Apache Xalan Java file:"
FETCH_MANUALLY+=	"    xalan-j_2_7_0-bin.tar.gz"
FETCH_MANUALLY+=	"from http://archive.apache.org/dist/xml/xalan-j/"
BUILD_DEPENDS+=		lang/kaffe>=1.1.7p1 \
			lang/jikes
ALT_BOOTDIR2=		${LOCALBASE}/kaffe
MAKE_ENV+=		ALT_BOOTDIR=${WRKDIST} \
			ALT_BOOTDIR2=${LOCALBASE}/kaffe \
			ALT_BOOTSTRAP=yes \
			ABS_OUTPUTDIR=${OUTPUTDIR}
RT_JAR=			SUNWj5rt/reloc/jdk/instances/jdk1.5.0/jre/lib/rt.jar
TOOLS_JAR=		SUNWj5dev/reloc/jdk/instances/jdk1.5.0/lib/tools.jar
EXTRACT_CASES+=		*.Z) \
			tar xzf ${FULLDISTDIR}/$$archive ${RT_JAR} ${TOOLS_JAR} ;;
.endif

.if !${FLAVOR:L:Mno_web}
BUILD_DEPENDS+=		devel/nspr
.else
MESSAGE=		${PKGDIR}/MESSAGE-no_web
MAKE_ENV+=		DONT_BUILD_DEPLOY="YES"
.endif

JDKHOME=		jdk-1.5.0
JREHOME=		jre-1.5.0

SUBST_VARS=		JDKHOME JREHOME

.if ${MACHINE_ARCH} == "i386"
PKG_ARGS+=              -Dclient_vm=1
.else
PKG_ARGS+=              -Dclient_vm=0
.endif

# Deal with Sun's internal build structure
WRKDIST=		${WRKDIR}
WRKSRC=         	${WRKDIR}/control/make
OUTPUTDIR=		${WRKDIR}/control/build/bsd-${MACHINE_ARCH:S/i386/i586/}
JDKIMAGEDIR=		${OUTPUTDIR}/j2sdk-image
JDKIMAGEDIR_G=		${OUTPUTDIR}/j2sdk-debug-image
JREIMAGEDIR=		${OUTPUTDIR}/j2re-image

.include <bsd.own.mk>

ACCEPT_JRL_LICENSE ?= No

.if ${ACCEPT_JRL_LICENSE:L} != "yes"
BROKEN += \n
BROKEN += You must read and accept Sun's JRL license located\n
BROKEN += at ${FILESDIR}/JavaResearchLicense.txt\n
BROKEN += To indicate your acceptance of the JRL add ACCEPT_JRL_LICENSE=Yes\n
BROKEN += to /etc/mk.conf and restart the build
.endif

post-extract:
	@@rm -rf ${WRKDIR}/tmp
	@@mkdir ${WRKDIR}/tmp && \
		${CC} ${CFLAGS} -o ${WRKDIR}/tmp/x_x2zip ${FILESDIR}/x_x2zip.c
.for jar in ${JRLSRC} ${JRLBIN}
	@@cd ${WRKDIR}/tmp && \
		unzip -qo ${FULLDISTDIR}/${jar} X_X && \
		./x_x2zip "YES I ACCEPT THE CLICK THROUGH LICENSE.  " X_X && \
		cd ${WRKDIR} && \
		unzip -q ${WRKDIR}/tmp/X_X.zip -x */lib*.so
.endfor
	@@rm -rf ${WRKDIR}/tmp
.if !${FLAVOR:L:Mnative_bootstrap}
	@@mkdir -p ${OUTPUTDIR}/classes
	@@cd ${OUTPUTDIR}/classes && \
		unzip -q ${WRKDIR}/${RT_JAR} -x META-INF* && \
		unzip -qn ${WRKDIR}/${TOOLS_JAR} -x META-INF*
	@@rm -rf ${WRKDIR}/SUNWj5*
.endif

pre-patch:
	@@cp -f ${FILESDIR}/cacerts ${WRKDIR}/j2se/src/share/lib/security
	@@cd ${WRKDIR} &&  \
		${PATCH} -p0 -z .orig.bsd --quiet < ${WRKDIR}/jdk15.patches

.if !${FLAVOR:L:Mnative_bootstrap}
post-patch:
	@@cd ${WRKDIR}/bin && \
		${CHMOD} +x bootscript
.for prog in java javac javah jar
	@@cd ${WRKDIR}/bin && \
		ln -s bootscript ${prog}
.endfor
.endif

post-build:
	@@rm -rf ${JDKIMAGEDIR}/man/ja \
		${JDKIMAGEDIR}/man/ja_JP.eucJP \
		${JREIMAGEDIR}/man/ja \
		${JREIMAGEDIR}/man/ja_JP.eucJP

do-install:
	${INSTALL_DATA_DIR} ${PREFIX}/${JDKHOME}
	cd ${JDKIMAGEDIR} && tar -cf - * | tar -C ${PREFIX}/${JDKHOME} -xf - 
	cd ${JDKIMAGEDIR_G} && tar -cf - * | tar -C ${PREFIX}/${JDKHOME} -xf - 
	${INSTALL_DATA_DIR} ${PREFIX}/${JREHOME}
	cd ${JREIMAGEDIR} && tar -cf - * | tar -C ${PREFIX}/${JREHOME} -xf -
	cd ${WRKDIR} && \
		${INSTALL_DATA} JavaResearchLicense.txt ${PREFIX}/${JDKHOME}/LICENSE && \
		${INSTALL_DATA} JavaResearchLicense.txt ${PREFIX}/${JDKHOME}/jre/LICENSE && \
		${INSTALL_DATA} JavaResearchLicense.txt ${PREFIX}/${JREHOME}/LICENSE

.include <bsd.port.mk>
@


1.69
log
@Fix path to the shared Mozilla plugins directory.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.68 2011/09/16 09:24:51 espie Exp $
@


1.68
log
@normalize pkgpath
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.67 2011/04/10 18:01:13 jasper Exp $
d11 1
a11 1
REVISION-main =		6
d13 1
a13 1
REVISION-jre =		6
@


1.67
log
@adjust after recent lesstif removal

ok aja@@ sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.66 2011/02/05 23:11:17 ian Exp $
d11 1
a11 1
REVISION-main =		5
d13 1
a13 1
REVISION-jre =		5
@


1.66
log
@Security Fix for DoS caused by very small subnormal double, found by Konstantin Preisser
at http://www.exploringbinary.com/java-hangs-when-converting-2-2250738585072012e-308/.
Fix from https://bugs.openjdk.java.net/show_bug.cgi?id=100119.
Ok kurt@@ (maintainer), ok & comments sthen@@, ok naddy@@, aja@@.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.64 2010/11/26 07:19:00 espie Exp $
d11 1
a11 1
REVISION-main =		4
d13 1
a13 1
REVISION-jre =		4
a46 1
USE_MOTIF=		openmotif
d50 2
a51 2
			pthread-stubs xcb stdc++ z

d69 2
a70 1
			HOTSPOT_BUILD_JOBS=${HOTSPOT_BUILD_JOBS}
@


1.65
log
@minor bumps after pkg_create fix: generate catN entry when needed.
@
text
@d11 1
a11 1
REVISION-main =		3
d13 1
a13 1
REVISION-jre =		3
@


1.64
log
@newer depends with >=
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.63 2010/11/15 19:45:59 espie Exp $
d11 1
a11 1
REVISION-main =		2
d13 1
a13 1
REVISION-jre =		2
@


1.63
log
@move depends to new style
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.62 2010/10/24 21:10:57 ajacoutot Exp $
d112 1
a112 1
BUILD_DEPENDS+=		kaffe->=1.1.7p1:lang/kaffe \
@


1.62
log
@Remove USE_X11.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.61 2010/10/18 17:47:53 espie Exp $
d10 4
a13 2
PKGNAME-main=		jdk-${V}p2
PKGNAME-jre=		jre-${V}p2
d43 4
a46 4
BUILD_DEPENDS=		::archivers/gtar \
			::archivers/zip \
			::archivers/unzip \
			::archivers/bzip2
d48 1
a48 1
USE_GROFF =	Yes
d100 1
a100 1
BUILD_DEPENDS+=		:jdk->=1.5.0,<1.6:devel/jdk/1.5
d112 2
a113 2
BUILD_DEPENDS+=		:kaffe->=1.1.7p1:lang/kaffe \
			::lang/jikes
d126 1
a126 1
BUILD_DEPENDS+=		::devel/nspr
@


1.61
log
@USE_GROFF=Yes
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.60 2010/04/24 20:18:39 naddy Exp $
a52 1
USE_X11=		Yes
@


1.60
log
@fix build and WANTLIB after libXp removal
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.59 2009/08/10 06:31:07 kili Exp $
d46 1
@


1.59
log
@WANTLIB changes after xcb addition and bump.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.58 2009/05/15 17:47:29 kurt Exp $
d10 2
a11 2
PKGNAME-main=		jdk-${V}p1
PKGNAME-jre=		jre-${V}p1
d47 1
a47 1
WANTLIB=		X11 Xext Xi Xp Xt Xtst c m ossaudio pthread \
@


1.58
log
@- prevent users from using native_bootstrap when the required package is
not pre-installed
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.57 2009/03/25 22:11:16 kurt Exp $
d10 2
a11 2
PKGNAME-main=		jdk-${V}p0
PKGNAME-jre=		jre-${V}p0
d47 2
a48 1
WANTLIB=		X11 Xext Xi Xp Xt Xtst c m ossaudio pthread stdc++ z
@


1.57
log
@- update to patchset 9 1.5.0 u16
- remove patches included in patchset 9
- fix native_bootstrap BUILD_DEPENDS
- chase plist changes
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.56 2009/03/15 09:25:04 espie Exp $
d10 2
a11 2
PKGNAME-main=		jdk-${V}
PKGNAME-jre=		jre-${V}
d93 4
@


1.56
log
@more depends fixes
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.55 2009/03/01 20:43:09 naddy Exp $
d8 1
a8 1
V=			1.5.0.14
d10 2
a11 2
PKGNAME-main=		jdk-${V}p3
PKGNAME-jre=		jre-${V}p3
d21 3
a23 3
JRLSRC=			jdk-1_5_0_14-fcs-src-b03-jrl-05_oct_2007.jar
JRLBIN=			jdk-1_5_0_14-fcs-bin-b03-jrl-05_oct_2007.jar
PATCHSET=		bsd-jdk15-patches-8.tar.bz2
d29 1
a29 1
MASTER_SITES=		http://www.java.net/download/tiger/tiger_u14/
d57 2
d72 1
a72 1
FETCH_MANUALLY+=	"Get the 'Update 14 Source under the JRL license' file:"
d76 1
a76 1
FETCH_MANUALLY+=	"from http://download.java.net/tiger/tiger_u14/"
d93 1
a93 1
BUILD_DEPENDS+=		:jdk-1.5*:devel/jdk/1.5
d96 1
a96 1
DISTFILES+=		jdk-1_5_0_14-solaris-i586.tar.Z \
d98 2
a99 2
FETCH_MANUALLY+=	"Get 'JDK 5.0 Update 14' for 'Solaris x86 packages' file:"
FETCH_MANUALLY+=	"    jdk-1_5_0_14-solaris-i586.tar.Z"
d101 1
a101 1
FETCH_MANUALLY+=	"http://java.sun.com/products/archive/j2se/5.0_14/index.html"
@


1.55
log
@Java bug fix; from kurt@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.54 2008/12/21 03:59:44 kurt Exp $
d13 1
a13 1
CATEGORIES=		devel/jdk java
@


1.54
log
@Parellel make doesn't work for the jdk builds so instead of passing
MAKE_JOBS on allow users to set HOTSPOT_BUILD_JOBS via env.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.53 2008/10/22 16:02:24 kurt Exp $
d10 2
a11 2
PKGNAME-main=		jdk-${V}p2
PKGNAME-jre=		jre-${V}p2
@


1.53
log
@Limit the jdk's view of physical memory to rlimit_cur instead of
rlimit_max. This makes the jdk behave better on amd64.

okay naddy@@ ian@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.52 2008/06/30 20:16:37 naddy Exp $
d65 1
a65 1
			HOTSPOT_BUILD_JOBS=${MAKE_JOBS}
@


1.52
log
@spawn only ${MAKE_JOBS} build jobs in parallel; ok kurt@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.51 2008/06/28 12:34:57 kurt Exp $
d10 2
a11 2
PKGNAME-main=		jdk-${V}p1
PKGNAME-jre=		jre-${V}p1
@


1.51
log
@- remove work-arounds for missing getpwuid_r now that we have it
- regen pkg files with @@bin markers
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.50 2008/03/17 03:21:25 kurt Exp $
d65 1
a65 1
			HOTSPOT_BUILD_JOBS=`sysctl -n hw.ncpu`
@


1.50
log
@- use HW_{USER|PHYS}MEM64. okay naddy@@
- on amd64 only do implicit null optimizations on offsets landing in the
first page of memory.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.49 2008/02/15 15:14:37 kurt Exp $
d10 2
a11 2
PKGNAME-main=		jdk-${V}p0
PKGNAME-jre=		jre-${V}p0
@


1.49
log
@- update to BSD patchset 8 based off Sun's JRL licensed Update 14 source:
  http://java.sun.com/j2se/1.5.0/ReleaseNotes.html#150_14
- NOTE: patchset 8 includes amd64 plugin support now.
- adjust pkg/MESSAGE-* files for change in plugin support and add missing
  JRL licensing blurb for the jre package.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.48 2008/01/18 15:52:55 kurt Exp $
d10 2
a11 2
PKGNAME-main=		jdk-${V}
PKGNAME-jre=		jre-${V}
@


1.48
log
@- don't install libnative_chmod.so. it is an unused linux shared lib
- install JRL LICENSE in second location in JDK
okay ajacoutot@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.47 2007/11/30 14:57:23 kurt Exp $
d8 1
a8 1
V=			1.5.0.13
d10 2
a11 2
PKGNAME-main=		jdk-${V}p0
PKGNAME-jre=		jre-${V}p0
d21 3
a23 3
JRLSRC=			jdk-1_5_0_13-fcs-src-b05-jrl-25_sep_2007.jar
JRLBIN=			jdk-1_5_0_13-fcs-bin-b05-jrl-25_sep_2007.jar
PATCHSET=		bsd-jdk15-patches-7.tar.bz2
d29 1
a29 1
MASTER_SITES=		http://www.java.net/download/tiger/tiger_u13/
d70 1
a70 1
FETCH_MANUALLY+=	"Get the 'Update 13 Source under the JRL license' file:"
d74 1
a74 1
FETCH_MANUALLY+=	"from http://download.java.net/tiger/tiger_u13/"
d94 1
a94 1
DISTFILES+=		jdk-1_5_0_13-solaris-i586.tar.Z \
d96 2
a97 2
FETCH_MANUALLY+=	"Get 'JDK 5.0 Update 13' for 'Solaris x86 packages' file:"
FETCH_MANUALLY+=	"    jdk-1_5_0_13-solaris-i586.tar.Z"
d99 1
a99 1
FETCH_MANUALLY+=	"http://java.sun.com/products/archive/j2se/5.0_13/index.html"
a117 3
. if ${MACHINE_ARCH} == "amd64"
MESSAGE=		${PKGDIR}/MESSAGE-amd64
. endif
a118 1
#no plugin - no messages
@


1.47
log
@update fetch manually url xalan. reported by James Hartley
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.46 2007/11/09 15:27:55 kurt Exp $
d10 2
a11 2
PKGNAME-main=		jdk-${V}
PKGNAME-jre=		jre-${V}
d207 1
@


1.46
log
@s/ERRORS/BROKEN/ to fix mirror-maker per espie@@ and nikolay@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.45 2007/11/07 17:04:36 kurt Exp $
d102 1
a102 1
FETCH_MANUALLY+=	"from http://www.apache.org/dist/xml/xalan-j/"
@


1.45
log
@Remove interactive license verification since it causes issues due to
lack of stdin availability when built indirectly as a depend of another
port. Instead of interactive license verification solely use the
ACCEPT_JRL_LICENSE var. If it's not correctly set error out and let the
user know what to do. Cluestick and okay espie@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.44 2007/10/25 20:51:41 kurt Exp $
d151 5
a155 4
ERRORS += "Fatal: you must read and accept Sun's JRL license located"
ERRORS += "at ${FILESDIR}/JavaResearchLicense.txt"
ERRORS += "To indicate your acceptance of the JRL add ACCEPT_JRL_LICENSE=Yes"
ERRORS += "to /etc/mk.conf and restart the build."
@


1.44
log
@- update to BSD patchset 7 based off Sun's JRL licensed Update 13 source:
http://java.sun.com/j2se/1.5.0/ReleaseNotes.html#150_13
- Do a better job respecting Sun's JRL license by using interactive
  license verification, installing the correct license and include a
  license blurb in the pkg MESSAGEs. (Interactive license verification
  script from FreeBSD/Greg Lewis)
- fix a packing problem with the no_web FLAVOR.

NOTE: This port is now IS_INTERACTIVE=Yes. After agreeing to the JRL
license, users can put ACCEPT_JRL_LICENSE=Yes into /etc/mk.conf to
automatically accept the license and make the port IS_INTERACTIVE=No.
Bulk builders will need to do this so things like OpenOffice get built.
okay naddy@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.43 2007/09/16 02:52:59 merdely Exp $
d151 4
a154 4
IS_INTERACTIVE=	Yes
pre-extract:
	@@${SH} ${FILESDIR}/license.sh
	@@echo continuing...
@


1.43
log
@Remove quotes surrounding COMMENT*/PERMIT_*/BROKEN
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.42 2007/07/27 19:29:51 kurt Exp $
d8 1
a8 1
V=			1.5.0.12
d21 3
a23 3
JRLSRC=			jdk-1_5_0_12-fcs-src-b04-jrl-02_may_2007.jar
JRLBIN=			jdk-1_5_0_12-fcs-bin-b04-jrl-02_may_2007.jar
PATCHSET=		bsd-jdk15-patches-6.tar.bz2
d29 1
a29 1
MASTER_SITES=		http://www.java.net/download/tiger/tiger_u12/
d70 1
a70 1
FETCH_MANUALLY+=	"Get the 'Update 12 Source under the JRL license' file:"
d74 1
a74 1
FETCH_MANUALLY+=	"from http://download.java.net/tiger/tiger_u12/"
d94 1
a94 1
DISTFILES+=		jdk-1_5_0_12-solaris-i586.tar.Z \
d96 2
a97 2
FETCH_MANUALLY+=	"Get 'JDK 5.0 Update 12' for 'Solaris x86 packages' file:"
FETCH_MANUALLY+=	"    jdk-1_5_0_12-solaris-i586.tar.Z"
d99 1
a99 1
FETCH_MANUALLY+=	"http://java.sun.com/products/archive/j2se/5.0_12/index.html"
d123 1
a123 1
MESSAGE=		/dev/null
d146 11
d158 1
a179 1
		${CHMOD} -R u+w * && \
d204 3
@


1.42
log
@- upgrade to Update 12 srcs which fixes the following bugs:
http://java.sun.com/j2se/1.5.0/ReleaseNotes.html#150_12
- remove patches I committed into patchset 6
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.41 2007/07/06 01:35:57 kurt Exp $
d6 2
a7 2
COMMENT-main=		"Java2(TM) Standard Edition Dev Kit v${V}"
COMMENT-jre=		"Java2(TM) Standard Edition Runtime Environment v${V}"
d33 4
a36 4
PERMIT_PACKAGE_CDROM=	"JRL"
PERMIT_PACKAGE_FTP=	"JRL"
PERMIT_DISTFILES_CDROM= "JRL"
PERMIT_DISTFILES_FTP=	"JRL"
@


1.41
log
@- don't link jvmti demo native libs with $ORIGIN in RPATH since ld.so
does not support it yet.
- fix writes to HOME complaints
- clean up post-build target
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.40 2007/07/01 20:34:02 kurt Exp $
d8 1
a8 1
V=			1.5.0.11
d10 2
a11 2
PKGNAME-main=		jdk-${V}p1
PKGNAME-jre=		jre-${V}p1
d21 3
a23 3
JRLSRC=			jdk-1_5_0_11-fcs-src-b03-jrl-15_dec_2006.jar
JRLBIN=			jdk-1_5_0_11-fcs-bin-b03-jrl-15_dec_2006.jar
PATCHSET=		bsd-jdk15-patches-5.tar.bz2
d29 1
a29 1
MASTER_SITES=		http://www.java.net/download/tiger/tiger_u11/
d70 1
a70 1
FETCH_MANUALLY+=	"Get the 'Update 11 Source under the JRL license' file:"
d74 1
a74 1
FETCH_MANUALLY+=	"from http://download.java.net/tiger/tiger_u11/"
d94 1
a94 1
DISTFILES+=		jdk-1_5_0_11-solaris-i586.tar.Z \
d96 4
a99 3
FETCH_MANUALLY+=	"Get 'JDK 5.0 Update 11' for 'Solaris x86 packages' file:"
FETCH_MANUALLY+=	"    jdk-1_5_0_11-solaris-i586.tar.Z"
FETCH_MANUALLY+=	"from http://java.sun.com/products/archive/j2se/5.0_11/index.html"
@


1.40
log
@- actually enable version scripts on libjvm which fixes a symbol conflict
with recent xulrunner which is used by eclipse's internal swt-browser.
(patch missed in last update)
- adjust url to update 11 download which has been move to the archive.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.39 2007/06/28 03:20:20 ian Exp $
d10 2
a11 2
PKGNAME-main=		jdk-${V}p0
PKGNAME-jre=		jre-${V}p0
d181 1
a181 3
	@@rm -rf ${JDKIMAGEDIR}/demo/jfc/SwingSet2/resources \
		${JDKIMAGEDIR}/demo/plugin/jfc/SwingSet2/resources \
		${JDKIMAGEDIR}/man/ja \
@


1.39
log
@Better url in FETCH_MANUALLY, ok kurt@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.38 2007/06/27 21:51:09 kurt Exp $
d10 2
a11 2
PKGNAME-main=		jdk-${V}
PKGNAME-jre=		jre-${V}
d98 1
a98 1
FETCH_MANUALLY+=	"from http://java.sun.com/javase/downloads/index_jdk5.jsp"
@


1.38
log
@- update port to be based of Sun's 1.5.0 Update 11 src which includes many
bug fixes since the initial release of the 1.5 jdk. I'm sure some of the
fixes are security related but I wasn't able to find a concise list. All
the bugs fixes listed here from update 11 and lower should be fixed by
this update: http://java.sun.com/j2se/1.5.0/ReleaseNotes.html#150_11
- NOTE: License change: used to be SCSL, now is JRL (Java Research
License). Still no packages with this license but at least we get the bug
fixes and security fixes now: https://tiger.dev.java.net/
- enable version scripts on libjvm which fixes a symbol conflict with
recent xulrunner which is used by eclipse's internal swt-browser.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.37 2007/05/01 02:05:46 kurt Exp $
d74 1
a74 1
FETCH_MANUALLY+=	"from http://download.java.net/tiger/"
@


1.37
log
@fix bug in the filtering of corrupt environment vars
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.36 2007/04/13 00:29:48 kurt Exp $
d8 1
a8 2
V=			1.5.0
DISTNAME=		jdk-1_5_0
d10 2
a11 2
PKGNAME-main=		jdk-${V}p31
PKGNAME-jre=		jre-${V}p31
d17 1
a17 2
# wwws is not a typo in the following:
HOMEPAGE=		http://wwws.sun.com/software/communitysource/j2se/java2/
d21 16
a36 10
DISTFILES=		${DISTNAME}-src-scsl.zip \
			${DISTNAME}-bin-scsl.zip \
			bsd-jdk15-patches-4.tar.bz2

# Sun Community Source License
# http://www.sun.com/software/communitysource/j2se/java2/license.html
PERMIT_PACKAGE_CDROM=	"SCSL"
PERMIT_PACKAGE_FTP=	"SCSL"
PERMIT_DISTFILES_CDROM= "SCSL"
PERMIT_DISTFILES_FTP=	"SCSL"
d38 1
a38 2
# TCK (Technology Compatibility Kit) covered by yet another license...
NO_REGRESS=		yes
d41 4
a44 3
BUILD_DEPENDS=		:gtar-*:archivers/gtar \
			:zip-*:archivers/zip
RUN_DEPENDS=		:zip-*:archivers/zip
d64 1
d70 5
a74 4
FETCH_MANUALLY+=	"Get the SCSL source \& binary files:"
FETCH_MANUALLY+=	"    ${DISTNAME}-src-scsl.zip"
FETCH_MANUALLY+=	"    ${DISTNAME}-bin-scsl.zip"
FETCH_MANUALLY+=	"from http://wwws.sun.com/software/communitysource/j2se/java2/download.html"
d76 1
a76 1
FETCH_MANUALLY+=	"    bsd-jdk15-patches-4.tar.bz2"
d87 3
d94 1
a94 1
DISTFILES+=		jdk-1_5_0-solaris-i586.tar.Z \
d96 3
a98 3
FETCH_MANUALLY+=	"Get the solaris x86 jdk file:"
FETCH_MANUALLY+=	"    jdk-1_5_0-solaris-i586.tar.Z"
FETCH_MANUALLY+=	"from http://java.sun.com/products/archive/j2se/5.0/index.html"
d126 2
a127 2
JDKHOME=		jdk-${V}
JREHOME=		jre-${V}
d145 11
a156 1
post-extract:
d159 2
a160 3
		${LOCALBASE}/kaffe/bin/jar xf ${WRKDIR}/${RT_JAR} && \
		${LOCALBASE}/kaffe/bin/jar xf ${WRKDIR}/${TOOLS_JAR} && \
		rm -rf META-INF
@


1.36
log
@- work-around libpthread limitations in javaForkAndExec() by adjusting the
  child process to not set file descriptors back to blocking when closing
  them. This fixes the netbeans build failure since a libpthread fix is not
  evident.
- update the North America time zone file to account for the tz changes
  (from ian@@)
- use X11BASE
- SHARED_ONLY=Yes
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.35 2007/04/08 12:43:06 kurt Exp $
d11 2
a12 2
PKGNAME-main=		jdk-${V}p30
PKGNAME-jre=		jre-${V}p30
@


1.35
log
@- fix the build for good on systems with >= 4G memory by limiting
the jdk's view of physical memory to datasize rlimit max
- remove and adjust old memory adjustments for OpenBSD
- shrink overhead on amd64 making more memory available for use
ok wilfried@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.34 2007/02/04 15:57:06 kurt Exp $
d3 1
d11 2
a12 2
PKGNAME-main=		jdk-${V}p29
PKGNAME-jre=		jre-${V}p29
d59 1
a59 1
			DEFAULT_LD_LIBRARY_PATH="/usr/lib:/usr/X11R6/lib:${LOCALBASE}/lib" \
@


1.34
log
@install javaws man page for amd64 too. fixes a packaging problem on amd64
found by wilfried@@. okay wilfried@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.33 2007/02/01 21:00:52 kurt Exp $
d9 3
a11 3
PKGNAME=		jdk-${V}p28
PKGNAME-main=		jdk-${V}p28
PKGNAME-jre=		jre-${V}p28
@


1.33
log
@- fix mistake that broke OOo build. the jdk needs to search ${PREFIX}/lib
by default.
- regen plist and move javaws man page to no-no_web PFRAG files where it
belongs.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.32 2007/01/24 21:05:10 kurt Exp $
d9 3
a11 3
PKGNAME=		jdk-${V}p27
PKGNAME-main=		jdk-${V}p27
PKGNAME-jre=		jre-${V}p27
@


1.32
log
@distfile rerolled with milestone bumped.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.31 2007/01/23 14:14:37 kurt Exp $
d9 3
a11 3
PKGNAME=		jdk-${V}p26
PKGNAME-main=		jdk-${V}p26
PKGNAME-jre=		jre-${V}p26
@


1.31
log
@Update to patchset 4 which includes a security fix for CVE-2007-0243

Buffer overflow allows applets to gain privileges via a GIF image with a
block with a 0 width field, which triggers memory corruption and possible
execution of arbitrary code.

Also included in patchset 4 are corrections for building the jdk on amd64
systems with 4G+ memory and the inclusion of the mozilla headers needed to
build the plugin without an external dependency on the old mozilla suite.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.30 2006/12/14 09:07:56 steven Exp $
d9 3
a11 3
PKGNAME=		jdk-${V}p25
PKGNAME-main=		jdk-${V}p25
PKGNAME-jre=		jre-${V}p25
@


1.30
log
@use BASE_PKGPATH instead of homegrown variable, no bumps needed
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.29 2006/11/24 21:30:13 steven Exp $
d9 3
a11 2
PKGNAME-main=		jdk-${V}p24
PKGNAME-jre=		jre-${V}p24
d24 1
a24 1
			bsd-jdk15-patches-3.tar.bz2
d69 1
a69 1
FETCH_MANUALLY+=	"    bsd-jdk15-patches-3.tar.bz2"
d106 1
a106 1
BUILD_DEPENDS+=		:mozilla-devel-*:www/mozilla,-devel
@


1.29
log
@take flavors into account in @@pkgpath

ok espie@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.28 2006/11/22 19:42:54 kurt Exp $
d118 1
a118 3
MAINPATH=		devel/jdk/1.5${FLAVOR_EXT:S/-/,/g}

SUBST_VARS=		JDKHOME JREHOME MAINPATH
@


1.28
log
@new MULTI_PACKAGES
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.27 2006/11/17 20:19:33 kurt Exp $
d9 2
a10 2
PKGNAME-main=		jdk-${V}p23
PKGNAME-jre=		jre-${V}p23
d118 3
a120 1
SUBST_VARS=		JDKHOME JREHOME
@


1.27
log
@- attempt to fully send/receive packets in socketTransport.c by handling
EINTR and continue to send/receive the rest of the packet. corrects:
"ERROR: transport error 202: recv error: Interrupted system call
["transport.c",L41]" seen while debugging large projects in eclipse.
from niklas@@
- Prevent problems opening RandomAccessFile with "rws" as the mode by
defining O_SYNC and O_DSYNC if they aren't defined.  In particular we
were previously defining O_SYNC bogusly to the same value as O_EXCL.
from FreeBSD
- close two more pthread_addr leaks
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.26 2006/11/11 21:04:27 steven Exp $
d5 1
a5 1
COMMENT=		"Java2(TM) Standard Edition Dev Kit v${V}"
d9 2
a10 2
PKGNAME=		jdk-${V}p22
PKGNAME-jre=		jre-${V}p22
d14 1
a14 2
MULTI_PACKAGES= 	-jre
SUBPACKAGE?=
d43 1
a43 3
.if defined(PACKAGING) && empty(SUBPACKAGE)
WANTLIB+=		Xmu
.endif
@


1.26
log
@USE_X11
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.25 2006/10/03 13:36:28 kurt Exp $
d9 2
a10 2
PKGNAME=		jdk-${V}p21
PKGNAME-jre=		jre-${V}p21
@


1.25
log
@- remove disabling J malloc option now that pthreads stacks are mmap'ed
this is no longer a concern upon forking.
- use closefrom(2) after forking instead of less efficient heursitics
approach.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.24 2006/09/26 17:48:19 kurt Exp $
d48 1
@


1.24
log
@- Fix jdk build when timezone is GMT+0. Reported by Schöberle Dániel
<Schoeberle.Daniel at aamtech.hu>
- Fix short Thread.sleep() issue. Reported by Mr David SH Rosenthal
<dshr at stanford.edu>
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.23 2006/07/28 13:18:45 kurt Exp $
d9 2
a10 2
PKGNAME=		jdk-${V}p20
PKGNAME-jre=		jre-${V}p20
@


1.23
log
@Prevent the jvm from crashing when it encounters a font with an
illegal glyph name (like in x11/freefonts). Problem reported by Jan Zach.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.22 2006/07/10 13:17:39 kurt Exp $
d9 2
a10 2
PKGNAME=		jdk-${V}p19
PKGNAME-jre=		jre-${V}p19
@


1.23.2.1
log
@MFC:
- Fix jdk build when timezone is GMT+0. Reported by Schvberle Daniel
<Schoeberle.Daniel at aamtech.hu>
- Fix short Thread.sleep() issue. Reported by Mr David SH Rosenthal
<dshr at stanford.edu>
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.23 2006/07/28 13:18:45 kurt Exp $
d9 2
a10 2
PKGNAME=		jdk-${V}p20
PKGNAME-jre=		jre-${V}p20
@


1.23.2.2
log
@MFC:
Update to patchset 4 which includes a security fix for CVE-2007-0243

Buffer overflow allows applets to gain privileges via a GIF image with a
block with a 0 width field, which triggers memory corruption and possible
execution of arbitrary code.

Also included in patchset 4 are corrections for building the jdk on amd64
systems with 4G+ memory and the inclusion of the mozilla headers needed to
build the plugin without an external dependency on the old mozilla suite.

ok kurt
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.23.2.1 2006/11/04 09:23:01 sturm Exp $
d9 2
a10 2
PKGNAME=		jdk-${V}p26
PKGNAME-jre=		jre-${V}p26
d24 1
a24 1
			bsd-jdk15-patches-4.tar.bz2
d70 1
a70 1
FETCH_MANUALLY+=	"    bsd-jdk15-patches-4.tar.bz2"
d107 1
a107 1
BUILD_DEPENDS+=		::devel/nspr
@


1.22
log
@- speed up builds on mp systems by using parallel compiles (one per cpu)
- increase default thread stack size on amd64
- filter out corrupt env vars with no name
- Properly deal with error cases in transferTo0(). Corrects non-blocking
IO case.
All but first one from FreeBSD
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.21 2006/07/01 09:06:00 steven Exp $
d9 2
a10 2
PKGNAME=		jdk-${V}p18
PKGNAME-jre=		jre-${V}p18
@


1.21
log
@add client vm files in jre package. this unbreaks the browser plugin.

ok kurt@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.20 2006/06/20 02:02:48 kurt Exp $
d9 2
a10 2
PKGNAME=		jdk-${V}p17
PKGNAME-jre=		jre-${V}p17
d59 2
a60 1
			DEFAULT_LD_LIBRARY_PATH="/usr/lib:/usr/X11R6/lib:${LOCALBASE}/lib"
@


1.20
log
@- use /dev/srandom in NativePRNG replacing /dev/random.
/dev/random use noticed by Sigfred Håversen.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.19 2006/06/06 03:02:42 kurt Exp $
d9 2
a10 2
PKGNAME=		jdk-${V}p16
PKGNAME-jre=		jre-${V}p16
@


1.19
log
@- fix reoccurance of KOI8_U charset NPE's for ALT_BOOTSTRAP (default).
since KOI8_U doesn't come with the Solaris class files, make sure it is
built in the recompile stage. Reported by Matt Jibson.
- add a useable cacerts file and use that instead of current empty one.
charset portions tested by and okay ian@@.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.18 2006/05/26 17:32:21 steven Exp $
d9 2
a10 2
PKGNAME=		jdk-${V}p15
PKGNAME-jre=		jre-${V}p15
@


1.18
log
@add a missing man page, update-plist, bump PKGNAME.  okay kurt@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.17 2006/05/15 18:11:22 ian Exp $
d9 2
a10 2
PKGNAME=		jdk-${V}p14
PKGNAME-jre=		jre-${V}p14
d146 1
@


1.17
log
@Enable JDK/JRE build on amd64. Switch to bootstrapping using Kaffe + Solaris JDK binary,
obviating need to build with JDK Linux compat (which was i386 only anyway).
Add native_bootstrap pseudo-flavor so you can build with a native Sun JDK if you
have one (tested by building this way using JDK built with default Kaffe-based build).
Work by kurt@@, tested by him on i386 and me on amd64. OK kurt@@.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.16 2006/04/28 22:57:11 ian Exp $
d9 2
a10 2
PKGNAME=		jdk-${V}p13
PKGNAME-jre=		jre-${V}p13
@


1.16
log
@fix typo; 'ok kurt@@; no pkg bump needed'
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.15 2006/04/28 20:56:15 kurt Exp $
d3 1
a3 1
ONLY_FOR_ARCHS= 	i386
d9 2
a10 2
PKGNAME=		jdk-${V}p11
PKGNAME-jre=		jre-${V}p11
d73 1
a73 1
PSEUDO_FLAVORS=		native_bootstrap alt_bootstrap
d83 1
a83 1
.elif ${FLAVOR:L:Malt_bootstrap}
d92 1
a92 1
BUILD_DEPENDS+=		:kaffe->=1.1.7p0:lang/kaffe \
d97 2
a98 1
			ALT_BOOTSTRAP=yes
a102 3
.else
BUILD_DEPENDS+=		:jdk-1.4*:devel/jdk/1.4
MAKE_ENV+=		ALT_BOOTDIR="${LOCALBASE}/jdk-1.4.2/"
d107 3
d112 1
a112 1
MESSAGE=                /dev/null
d121 6
d130 1
a130 1
OUTPUTDIR=		${WRKDIR}/control/build/bsd-i586
d135 1
a135 1
.if ${FLAVOR:L:Malt_bootstrap}
d150 1
a150 1
.if ${FLAVOR:L:Malt_bootstrap}
@


1.15
log
@- add a new pseudo flavor called alt_bootstrap which uses kaffe, Xalan and
solaris class files to bootstrap the jdk build. this avoids the need for
devel/jdk/1.4 to bootstrap and will provide a way to bootstrap the jdk on
amd64 and sparc64 when kaffe runs there.
- fix a keyboard entry problem when numlock is on
- fixup socket option code similar to FreeBSD & NetBSD
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.14 2006/04/11 00:45:41 kurt Exp $
d92 1
a92 1
BUILD_DEPENDS+=		:kaffe->=1.1.7p0*:lang/kaffe \
@


1.14
log
@Update to patchset 3. Patchset 3 includes several bug fixes that improve
compatiabily and stability which came from work sponsored by the FreeBSD
Foundation.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.13 2006/02/22 22:52:44 kurt Exp $
d9 2
a10 2
PKGNAME=		jdk-${V}p10
PKGNAME-jre=		jre-${V}p10
d73 1
a73 1
PSEUDO_FLAVORS=		native_bootstrap
d83 19
d128 10
d142 10
@


1.13
log
@stablity fix for os_sleep. patchset 2 introduced a buggy version of
os_sleep based on nanosleep(). revert to patchset 1 version based on
poll(). fixes issues with large sleep values. okay pvalchev@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.12 2006/02/16 05:46:21 david Exp $
d9 2
a10 2
PKGNAME=		jdk-${V}p9
PKGNAME-jre=		jre-${V}p9
d24 1
a24 1
			bsd-jdk15-patches-2.tar.bz2
d42 1
a42 1
WANTLIB=		X11 Xext Xi Xp Xt Xtst c m ossaudio pthread stdc++
d69 1
a69 1
FETCH_MANUALLY+=	"    bsd-jdk15-patches-2.tar.bz2"
@


1.13.2.1
log
@Update to patchset 4 which includes a security fix for CVE-2007-0243

Buffer overflow allows applets to gain privileges via a GIF image with a
block with a 0 width field, which triggers memory corruption and possible
execution of arbitrary code.

Also included in patchset 4 are corrections for building the jdk on amd64
systems with 4G+ memory and the inclusion of the mozilla headers needed to
build the plugin without an external dependency on the old mozilla suite.

okay nikolay@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.13 2006/02/22 22:52:44 kurt Exp $
d9 2
a10 2
PKGNAME=		jdk-${V}p25
PKGNAME-jre=		jre-${V}p25
d24 1
a24 1
			bsd-jdk15-patches-4.tar.bz2
d69 1
a69 1
FETCH_MANUALLY+=	"    bsd-jdk15-patches-4.tar.bz2"
d89 1
a89 1
BUILD_DEPENDS+=		::devel/nspr
@


1.13.2.2
log
@fix two mistakes with last update:
- the jdk needs to search for shared libs in ${PREFIX}/lib too
- WANTLIB += z

okay sturm@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.13.2.1 2007/01/31 14:52:31 kurt Exp $
d9 2
a10 2
PKGNAME=		jdk-${V}p26
PKGNAME-jre=		jre-${V}p26
d42 1
a42 1
WANTLIB=		X11 Xext Xi Xp Xt Xtst c m ossaudio pthread stdc++ z
@


1.12
log
@typo in DESCR; bump PKGNAME; ok kurt@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.11 2006/01/22 22:46:30 kurt Exp $
d9 2
a10 2
PKGNAME=		jdk-${V}p8
PKGNAME-jre=		jre-${V}p8
@


1.11
log
@- fix a series of datatype assumptions in i486/hotspot (intptr_t != int
  on OpenBSD)
- fix implicit declaration's by adding headers or prototypes as needed.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.10 2006/01/02 03:48:40 kurt Exp $
d9 2
a10 2
PKGNAME=		jdk-${V}p7
PKGNAME-jre=		jre-${V}p7
@


1.10
log
@Disable Junk malloc option for java. java mprotects portions of the thread
stack. When forking, the child process deallocates the threads stacks it
inheritated from the parent. The junk malloc option then attempts to write
to the deallocated memory and segfaults because its not all writable. The
child proc stays in a SIGSEGV loop when this happens.  okay ian@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.9 2005/11/30 02:21:32 kurt Exp $
d9 2
a10 2
PKGNAME=		jdk-${V}p6
PKGNAME-jre=		jre-${V}p6
@


1.9
log
@- fix build for systems with > 2G physical memory (signed int value was
assigned to uint64).
- set some fall-back max-memory values to reasonable values for OpenBSD.
Problem reported and update tested by Douglas Santos.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.8 2005/11/23 19:39:13 kurt Exp $
d9 2
a10 2
PKGNAME=		jdk-${V}p5
PKGNAME-jre=		jre-${V}p5
@


1.8
log
@- add plugin and javaws support. disable with no_web flavor.
Demos all work but deadlocking the vm under load has been
noted. Both MToolkit and XToolkit work ok so far.
- fix segfault with MToolkit where processTree was called
with to==NULL.
- fix NPE in plugin paintGrayBox where g==null
- fix javaws startup (from FreeBSD)
- forgot to mention in last commit: Forte Peformance Tools
collector is no longer disabled.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.7 2005/11/22 14:48:07 kurt Exp $
d9 2
a10 2
PKGNAME=		jdk-${V}p4
PKGNAME-jre=		jre-${V}p4
@


1.7
log
@forgot to bump pkgname in last commit
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.6 2005/11/22 14:43:05 kurt Exp $
d9 2
a10 2
PKGNAME=		jdk-${V}p3
PKGNAME-jre=		jre-${V}p3
a54 1
			DONT_BUILD_DEPLOY="YES" \
d72 1
a72 1
FLAVORS=		with_ipv6
d88 8
d116 1
@


1.6
log
@- update to patchset 2. mostly removing patches now included in patchset.
- link awt_robot with -pthread
- disable a runtime Motif version check that incorrectly thought we were
using Motif 1.2 based on Xm major version. problem reported by Laurence
Tratt
- plugin and webstart comming later
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.5 2005/09/16 09:51:27 espie Exp $
d9 2
a10 2
PKGNAME=		jdk-${V}p2
PKGNAME-jre=		jre-${V}p2
@


1.5
log
@Fix a buglet in bsd.port.mk where the PSEUDO_FLAVORS get encoded into
the FULLPKGPATH, thus providing changes to packing-lists which shouldn't
happen, and making update more difficult.

Accordingly, bump all pkgnames with PSEUDO_FLAVORS, and provide an
update @@pkgpath for the bug for most of them (left out the ones with 3
or 4 pseudo flavors for space constraints...)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.4 2005/08/09 04:38:01 kurt Exp $
d24 1
a24 1
			bsd-jdk15-patches-1.tar.bz2
d70 1
a70 1
FETCH_MANUALLY+=	"    bsd-jdk15-patches-1.tar.bz2"
@


1.4
log
@Add PREFIX/lib to the default java.library.path. Noticed, testing and
okay by ian@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.3 2005/06/03 20:36:07 kurt Exp $
d9 2
a10 2
PKGNAME=		jdk-${V}p1
PKGNAME-jre=		jre-${V}p1
@


1.3
log
@- Ensure that when files are extracted that their fully resolved path lies
  in or below the current working directory.  Fixes a security problem with
  jar. From FreeBSD.
- Fix timezone issues. Allow /etc/localtime to be a symlink and fix the case
  where /etc/localtime points to a tz that the jdk doesn't know about.
- timezone is a function on BSD, not a variable, so move the timezone
  == 0 check to the non-BSD section. from millert@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.2 2005/05/27 09:34:01 espie Exp $
d9 2
a10 2
PKGNAME=		jdk-${V}p0
PKGNAME-jre=		jre-${V}p0
@


1.2
log
@tsk, tsk, distibution
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.1.1.1 2005/05/25 17:27:53 kurt Exp $
d9 2
a10 2
PKGNAME=		jdk-${V}
PKGNAME-jre=		jre-${V}
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
# $OpenBSD$
d63 1
a63 1
FETCH_MANUALLY=		"You must manually fetch the distibution files, place"
@


1.1.1.1
log
@initial import of 1.5
@
text
@@
