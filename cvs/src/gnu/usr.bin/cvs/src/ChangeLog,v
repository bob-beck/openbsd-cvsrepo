head	1.1;
branch	1.1.1;
access;
symbols
	OPENBSD_6_1_BASE:1.1.1.18
	OPENBSD_6_0:1.1.1.18.0.62
	OPENBSD_6_0_BASE:1.1.1.18
	OPENBSD_5_9:1.1.1.18.0.58
	OPENBSD_5_9_BASE:1.1.1.18
	OPENBSD_5_8:1.1.1.18.0.60
	OPENBSD_5_8_BASE:1.1.1.18
	OPENBSD_5_7:1.1.1.18.0.52
	OPENBSD_5_7_BASE:1.1.1.18
	OPENBSD_5_6:1.1.1.18.0.56
	OPENBSD_5_6_BASE:1.1.1.18
	OPENBSD_5_5:1.1.1.18.0.54
	OPENBSD_5_5_BASE:1.1.1.18
	OPENBSD_5_4:1.1.1.18.0.50
	OPENBSD_5_4_BASE:1.1.1.18
	OPENBSD_5_3:1.1.1.18.0.48
	OPENBSD_5_3_BASE:1.1.1.18
	OPENBSD_5_2:1.1.1.18.0.46
	OPENBSD_5_2_BASE:1.1.1.18
	OPENBSD_5_1_BASE:1.1.1.18
	OPENBSD_5_1:1.1.1.18.0.44
	OPENBSD_5_0:1.1.1.18.0.42
	OPENBSD_5_0_BASE:1.1.1.18
	OPENBSD_4_9:1.1.1.18.0.40
	OPENBSD_4_9_BASE:1.1.1.18
	OPENBSD_4_8:1.1.1.18.0.38
	OPENBSD_4_8_BASE:1.1.1.18
	OPENBSD_4_7:1.1.1.18.0.34
	OPENBSD_4_7_BASE:1.1.1.18
	OPENBSD_4_6:1.1.1.18.0.36
	OPENBSD_4_6_BASE:1.1.1.18
	OPENBSD_4_5:1.1.1.18.0.32
	OPENBSD_4_5_BASE:1.1.1.18
	OPENBSD_4_4:1.1.1.18.0.30
	OPENBSD_4_4_BASE:1.1.1.18
	OPENBSD_4_3:1.1.1.18.0.28
	OPENBSD_4_3_BASE:1.1.1.18
	OPENBSD_4_2:1.1.1.18.0.26
	OPENBSD_4_2_BASE:1.1.1.18
	OPENBSD_4_1:1.1.1.18.0.24
	OPENBSD_4_1_BASE:1.1.1.18
	OPENBSD_4_0:1.1.1.18.0.22
	OPENBSD_4_0_BASE:1.1.1.18
	OPENBSD_3_9:1.1.1.18.0.20
	OPENBSD_3_9_BASE:1.1.1.18
	OPENBSD_3_8:1.1.1.18.0.18
	OPENBSD_3_8_BASE:1.1.1.18
	OPENBSD_3_7:1.1.1.18.0.16
	OPENBSD_3_7_BASE:1.1.1.18
	OPENBSD_3_6:1.1.1.18.0.14
	OPENBSD_3_6_BASE:1.1.1.18
	OPENBSD_3_5:1.1.1.18.0.12
	OPENBSD_3_5_BASE:1.1.1.18
	OPENBSD_3_4:1.1.1.18.0.10
	OPENBSD_3_4_BASE:1.1.1.18
	OPENBSD_3_3:1.1.1.18.0.8
	OPENBSD_3_3_BASE:1.1.1.18
	OPENBSD_3_2:1.1.1.18.0.6
	OPENBSD_3_2_BASE:1.1.1.18
	OPENBSD_3_1:1.1.1.18.0.4
	OPENBSD_3_1_BASE:1.1.1.18
	OPENBSD_3_0:1.1.1.18.0.2
	OPENBSD_3_0_BASE:1.1.1.18
	cvs-1-11-1p1:1.1.1.18
	OPENBSD_2_9:1.1.1.17.0.2
	OPENBSD_2_9_BASE:1.1.1.17
	cvs-1-11:1.1.1.17
	OPENBSD_2_8:1.1.1.16.0.6
	OPENBSD_2_8_BASE:1.1.1.16
	OPENBSD_2_7:1.1.1.16.0.4
	OPENBSD_2_7_BASE:1.1.1.16
	OPENBSD_2_6:1.1.1.16.0.2
	OPENBSD_2_6_BASE:1.1.1.16
	cvs-1-10-7:1.1.1.16
	OPENBSD_2_5:1.1.1.15.0.2
	OPENBSD_2_5_BASE:1.1.1.15
	cvs-1-10-5:1.1.1.15
	OPENBSD_2_4:1.1.1.14.0.2
	OPENBSD_2_4_BASE:1.1.1.14
	cvs-1-10:1.1.1.14
	cvs-1-9-28:1.1.1.13
	OPENBSD_2_3:1.1.1.12.0.2
	OPENBSD_2_3_BASE:1.1.1.12
	cvs-1-9-26:1.1.1.12
	cvs-1-9-24:1.1.1.11
	OPENBSD_2_2:1.1.1.10.0.2
	OPENBSD_2_2_BASE:1.1.1.10
	cvs-1-9-10:1.1.1.10
	OPENBSD_2_1:1.1.1.9.0.2
	OPENBSD_2_1_BASE:1.1.1.9
	cvs-1-9-8:1.1.1.9
	cvs-1-9-6:1.1.1.8
	cvs-1-9-4:1.1.1.7
	cvs-1-9-2:1.1.1.6
	cvs-1-9:1.1.1.5
	OPENBSD_2_0:1.1.1.4.0.2
	OPENBSD_2_0_BASE:1.1.1.4
	cvs-1-8-1:1.1.1.4
	cvs-1-8:1.1.1.4
	cvs-1-7-2:1.1.1.3
	cvs-1-7-1:1.1.1.2
	cvs-1-6:1.1.1.1
	cyclic:1.1.1;
locks; strict;
comment	@# @;


1.1
date	95.12.19.09.21.30;	author deraadt;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	95.12.19.09.21.30;	author deraadt;	state Exp;
branches;
next	1.1.1.2;

1.1.1.2
date	96.01.30.00.17.42;	author tholo;	state Exp;
branches;
next	1.1.1.3;

1.1.1.3
date	96.04.27.19.41.22;	author tholo;	state Exp;
branches;
next	1.1.1.4;

1.1.1.4
date	96.05.06.22.18.55;	author tholo;	state Exp;
branches;
next	1.1.1.5;

1.1.1.5
date	96.10.18.03.35.08;	author tholo;	state Exp;
branches;
next	1.1.1.6;

1.1.1.6
date	97.02.21.06.37.01;	author tholo;	state Exp;
branches;
next	1.1.1.7;

1.1.1.7
date	97.03.18.01.55.41;	author tholo;	state Exp;
branches;
next	1.1.1.8;

1.1.1.8
date	97.03.29.04.37.54;	author tholo;	state Exp;
branches;
next	1.1.1.9;

1.1.1.9
date	97.04.21.04.26.26;	author tholo;	state Exp;
branches;
next	1.1.1.10;

1.1.1.10
date	97.06.28.03.28.23;	author tholo;	state Exp;
branches;
next	1.1.1.11;

1.1.1.11
date	98.02.22.08.20.44;	author tholo;	state Exp;
branches;
next	1.1.1.12;

1.1.1.12
date	98.03.12.06.58.00;	author tholo;	state Exp;
branches;
next	1.1.1.13;

1.1.1.13
date	98.07.13.03.53.11;	author tholo;	state Exp;
branches;
next	1.1.1.14;

1.1.1.14
date	98.08.22.20.52.17;	author tholo;	state Exp;
branches;
next	1.1.1.15;

1.1.1.15
date	99.02.28.21.32.03;	author tholo;	state Exp;
branches;
next	1.1.1.16;

1.1.1.16
date	99.09.10.05.06.14;	author tholo;	state Exp;
branches;
next	1.1.1.17;

1.1.1.17
date	2001.02.10.18.57.32;	author tholo;	state Exp;
branches;
next	1.1.1.18;

1.1.1.18
date	2001.09.28.22.45.36;	author tholo;	state Exp;
branches;
next	;


desc
@@


1.1
log
@Initial revision
@
text
@Tue Oct  3 09:26:00 1995  Karl Fogel  <kfogel@@totoro.cyclic.com>

        * version.c: upped to 1.6.

Mon Oct  2 18:10:35 1995  Larry Jones  <larry.jones@@sdrc.com>

	* server.c: if HAVE_SYS_BSDTYPES_H, include <sys/bsdtypes.h>.

Mon Oct  2 10:34:53 1995  Karl Fogel  <kfogel@@totoro.cyclic.com>

        * version.c: Upped version to 1.5.95.

Mon Oct  2 15:16:47 1995  Norbert Kiesel  <nk@@col.sw-ley.de>

	* tag.c, rtag.c: pass "mov" instead of "add" if tag will be moved
	(i.e. invoked with -F)

Sun Oct  1 18:36:34 1995  Karl Fogel  <kfogel@@totoro.cyclic.com>

        * version.c: upped to 1.5.94.

        * server.c: reverted earlier ISC change (of Sep. 28).

        * version.c: upped to 1.5.93, for Peter Wemm's new SVR4 patch.

Sun Oct  1 14:51:59 1995  Harlan Stenn  <Harlan.Stenn@@pfcs.com>

        * main.c: don't #include <pwd.h>; cvs.h does that already.

Fri Sep 29 15:21:35 1995  Karl Fogel  <kfogel@@floss.cyclic.com>

        * version.c: upped to 1.5.91 for another pre-1.6 release.

Fri Sep 29 14:41:14 1995  <bmeier@@rzu.unizh.ch>

        * root.c: start rcsid[] with "CVSid".

Fri Sep 29 13:22:44 1995  Jim Blandy  <jimb@@totoro.cyclic.com>

	* diff.c (diff): Doc fix.

Fri Sep 29 14:32:36 1995  Norbert Kiesel <nk@@col.sw-ley.de>
        
        * repos.c (Short_Repository): chop superfluous "/".
        
        * tag.c (pretag_proc): correct user-visible string.
        
        * rtag.c (pretag_proc): correct user-visible string.

Fri Sep 29 13:45:36 1995  Karl Fogel  <kfogel@@floss.cyclic.com>

        * cvs.h (USE): if __GNUC__ != 2, expand to a dummy var instead of
        nothing.

Thu Sep 28 13:37:05 1995  Larry Jones <larry.jones@@sdrc.com>
        
        * server.c: ifdef ISC, include <sys/bsdtypes.h>.
        
Fri Sep 29 07:54:22 1995  Mike Sutton  <mws115@@llcoolj.dayton.saic.com>

	* filesubr.c (last_component): Don't use ANSI style declaration.

Wed Sep 27 15:24:00 1995  Del  <del@@matra.com.au>

	* tag.c, rtag.c:  Pass a few extra options to the script
	named in taginfo (del/add, and revision number).

	* tag.c:  Support a -r option (at long last).  Also needs
	a -f option to tag the head if there is no matching -r tag.

Tue Sep 26 11:41:08 1995  Karl Fogel  <kfogel@@totoro.cyclic.com>

        * version.c: Upped version to 1.5.89 for test release preceding
        1.6.

Wed Sep 20 15:32:49 1995  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* ignore.c (ign_add_file): Check for errors from fopen and fclose.

Tue Sep 19 18:02:16 1995  Jim Blandy  <jimb@@totoro.cyclic.com>

	* Makefile.in (DISTFILES): Remove sanity.el from this list; the
	file has been deleted.

Thu Sep 14 14:17:52 1995  Peter Wemm  <peter@@haywire.dialix.com>

	* import.c: Recover from being unable to open the user file.

	* update.c (join_file): Print a message in the case where the file
	was added.

	* mkmodules.c: Deal with .db as well as .pag/.dir (for use with
	BSD 4.4 and real dbm support).

Mon Sep 11 15:44:13 1995  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* release.c (release): Revise comment regarding why and how we
	skip argv[0].

Mon Sep 11 10:03:59 1995  Karl Fogel  <kfogel@@floss.cyclic.com>

        * release.c (release): use return value of pclose to determine
        success of update.

Mon Sep 11 09:56:33 1995  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* release.c (release_delete): Fix comment.

Sun Sep 10 18:48:35 1995  Karl Fogel  <kfogel@@floss.cyclic.com>

        * release.c (release): made work with client/server.
        Don't ask if <arg> is mentioned in `modules'.

Fri Sep  8 13:25:55 1995  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* sanity.sh: When committing a removal, send stdout to LOGFILE;
	this is no longer a silent operation.

	* sanity.sh: Remove OUTPUT variable; it is unused.

	* client.c: Add comment regarding deleting temp file.
	* main.c: Add comment regarding getopt REQUIRE_ORDER.

Thu Sep  7 20:24:46 1995  Karl Fogel  <kfogel@@floss.cyclic.com>

        * main.c (main): use getopt_long(), accept "--help" and
        "--version".
        Don't assume EOF is -1.

Thu Sep 7  19:18:00 1995  Jim Blandy  <jimb@@cyclic.com>

	* cvs.h (unlink_file_dir): Add prototype for this.

Thu Sep  7 14:38:06 1995  Karl Fogel  <kfogel@@floss.cyclic.com>

        * ALL FILES: add semicolon, as indicated below.
        
        * cvs.h (USE): don't provide semicolon in the expansion of the USE
        macro; we'd rather the callers provided it themselves because that
        way etags doesn't get fooled.

Mon Sep  4 23:30:41 1995  Magnus Hyllander  <mhy@@os.se>

	* checkout.c: cvs export now takes -k option and does not default
	to -kv.
	* checkout.c, cvs.h, modules.c: Modules file now takes -e option
	for cvs export.

Mon Sep  4 23:30:41 1995  Kirby Koster  <koster@@sctc.com>

	* commit.c: When committing a removal, print a message saying what
	we are doing.

Wed Aug  2 10:06:51 1995  Vince DeMarco  <vdemarco@@bou.shl.com>

	* server.c: fix compiler warnings (on NeXT) (declare functions as
	static inline instead of just static) functions: get_buffer_date,
	buf_append_char, and buf_append_data

Mon Sep  4 22:31:28 1995  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* client.c (update_entries), import.c (expand_at_signs): Check for
	errors from fread and putc.

Fri Sep  1 00:03:17 1995  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* sanity.sh: Fix TODO item pathname.

	* sanity.el: Removed.  It was out of date, didn't do much, and I
	doubt anyone was using it.

	* no_diff.c (No_Difference): Don't change the modes of the files.

Thu Aug 31 13:14:34 1995  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* version.c: Change version to 1.5.1.

	* client.c (start_rsh_server): Don't pass -d to "cvs server"
	invocation via rsh (restore change which was lost when NT stuff
	was merged in).
	* sanity.sh: Add TODO item suggesting test for bug which this fixes.

Wed Aug 30 12:36:37 1995  Jim Blandy  <jimb@@totoro.cyclic.com>

	* sanity.sh (basic1): Make sure first-dir is deleted before
	running this set of tests.

        * subr.c: Extract file twiddling functions to a different file,
	because we want to use different versions of many of these
	routines under Windows NT.
	(copy_file, isdir, islink, isfile, isreadable, iswritable,
	open_file, make_directory, make_directories, xchmod,
	rename_file, link_file, unlink_file, xcmp, tmpnam,
	unlink_file_dir, deep_remove_dir): Moved to...
	* filesubr.c: ...this file, which is new.
	* Makefile.in (SOURCES): Mention filesubr.c.
	(COMMON_OBJECTS): Mention filesubr.o.

	* subr.c: Extract process execution guts to a different file,
	because we want to replace these routines entirely under
	Windows NT.
	(VA_START, va_alist, va_dcl): Move this stuff...
	(run_add_arg, run_init_prog): and these declarations...
	(run_prog, run_argv, run_argc, run_argc_allocated): and these
	variables...
	(run_setup, run_arg, run_args, run_add_arg, run_init_prog,
	run_exec, run_print, Popen): and these functions...
	* run.c: To this file, which is new.
	* Makefile.in (SOURCES): Mention run.c.
	(COMMON_OBJECTS): Mention run.o.

	* status.c (status): Call ign_setup, if client_active.  Otherwise,
	we don't end up ignoring CVS directories and such.

	* server.c (mkdir_p, dirswitch): Use CVS_MKDIR instead of mkdir.

	* repos.c (Name_Repository): Use the isabsolute function instead of
	checking the first character of the path.
	* root.c (Name_Root): Same.

	* release.c (release): Use fncmp instead of strcmp to compare
	filenames.

	* rcs.c (RCS_parse, RCS_parsercsfile) [LINES_CRLF_TERMINATED]:
	Abort, because we have strong reason to believe this code is
	wrong.

	* patch.c (patch): Register signal handlers iff the signal name is
	#defined.

	* no_diff.c (No_Difference): Don't try to include server_active in
	trace message unless SERVER_SUPPORT is #defined.

	* modules.c (do_module): Use CVS_MKDIR instead of mkdir.

	* mkmodules.c (main): Call last_component instead of writing it out.

	* main.c (main): Call last_component instead of writing it out.
	Break up the long copyright string into several strings; Microsoft
	Visual C++ can't handle a line that long.  Feh.
	Use fncmp instead of strcmp to compare filenames.
	Register signal handlers iff the signal name is #defined.

	* lock.c (readers_exist): Don't check return value of closedir.
	Most of the rest of the code doesn't, and some systems don't
	provide a return value anyway.
	(set_lock): Use CVS_MKDIR instead of mkdir.

	* import.c (import): Use the isabsolute function instead of
	checking the first character of the path.
	Try to delete the temporary file again after we close it, so it'll
	get deleted on systems that don't let you delete files that are
	open.
	(add_rev): Instead of making a hard link to the working file and
	checking in the revision with ci -r, use ci -u and restore the
	permission bits.
	(comtable): Include lines from SYSTEM_COMMENT_TABLE, if it is
	#defined.
	(add_rcs_file) [LINES_CRLF_TERMINATED]: Abort, because we have
	strong reason to believe this code is wrong.
	(import_descend_dir): Use CVS_MKDIR instead of mkdir.

	* history.c (read_hrecs): Open the file with OPEN_BINARY.

	* find_names.c (add_entries_proc, fsortcmp): Add prototypes.
	* entries.c (write_ent_proc): Add prototype.
	* hash.c (walklist): Add prototype for PROC argument.
	(sortlist): Add prototype for COMP argument.
	(printnode): Add a prototype, and make it static.

	* cvs.h (wrap_add_file, wrap_add): Add extern decls for these;
	they're used in import.c and update.c.
	* wrapper.c (wrap_add_file, wrap_add): Remove them from here.

	* cvs.h (RUN_NORMAL, RUN_COMBINED, RUN_REALLY, RUN_STDOUT_APPEND,
	RUN_STDERR_APPEND, RUN_SIGNIGNORE, RUN_TTY, run_arg, run_print,
	run_setup, run_args, run_exec, Popen, piped_child, close_on_exec,
	filter_stream_through_program, waitpid): Move all these
	declarations and definitions to the same section.

	* cvs.h (error_set_cleanup): Fix prototype.

	* cvs.h (isabsolute, last_component): New extern decls.

	* cvs.h (link_file): Function is deleted; remove extern decl.

	* cvs.h (DEATH_STATE, DEATH_SUPPORT): Move #definitions of these
	above the point where we #include rcs.h, since rcs.h tests them
	(or DEATH_SUPPORT, at least).

	* cvs.h (DEVNULL): #define this iff it isn't already #defined.
	config.h may want to override it.

	* cvs.h (SERVER_SUPPORT, CLIENT_SUPPORT): Don't #define these
	here; let config.h do that.  On some systems, we don't have any
	server support.

	* cvs.h: Don't #include <io.h> or <direct.h>; we take care of
	those in lib/system.h.

	* commit.c (commit): Open logfile with the OPEN_BINARY flag.
	(precommit_proc): Use the isabsolute function, instead of
	comparing the first character with /.
	(remove_file, checkaddfile): Use CVS_MKDIR instead of mkdir.

        * client.c (send_repository): Use larger line buffers.

        * client.c [LINES_CRLF_TERMINATED] (update_entries): If we've just
	received a gzipped file, copy it over, converting LF to CRLF,
	instead of just renaming it into place.
	[LINES_CRLF_TERMINATED] (send_modified): Convert file to LF format
	before sending with gzip.
	(send_modified): Don't be disturbed if we get fewer than
	sb.st_size characters when we read.  The read function may be
	collapsing CRLF to LF for us.

	* client.c: Add forward declarations for all the cvs command
	functions we call.

	* client.c: Add forward static declarations for all the
	handle_mumble functions.

	On some systems, RSH converts LF to CRLF; this screws us up.
	* client.c (rsh_pid): Declare this iff RSH_NOT_TRANSPARENT is not
	#defined.
	(get_responses_and_close): Use SHUTDOWN_SERVER if it is #defined.
	Only wait for rsh process to exit if RSH_NOT_TRANSPARENT is not
	#defined.
	(start_rsh_server): Declare and define only if
	RSH_NOT_TRANSPARENT is not #defined.  Use piped_child, instead of
	writing all that out.
	(start_server): Only try to call start_rsh_server if
	RSH_NOT_TRANSPARENT is not #defined.  Use START_SERVER if it is
	#defined.  Convert file descriptors to stdio file pointers using
	the FOPEN_BINARY_WRITE and FOPEN_BINARY_READ strings.

	* client.h (rsh_pid): Don't declare this; it's never used elsewhere.
	(supported_request): Add external declaration for this;
	it's used in checkout.c.

	Move process-running functions to run.c; we need to totally
	replace these on other systems, like Windows NT.
	* client.c (close_on_exec, filter_stream_through_program): Moved
	to run.c.
	* run.c (close_on_exec, filter_stream_through_program): Here they
	are.

	* add.c (add_directory): Use CVS_MKDIR instead of straight mkdir.
	* checkout.c (checkout, build_dirs_and_chdir): Same.
	(checkout_proc): Use fncmp instead of strcmp.
	* client.c (call_in_directory): Use CVS_MKDIR instead of straight
	mkdir.

	* client.c (handle_checksum): Cast return value of strtol.

Wed Aug 30 10:35:46 1995  Stefan Monnier <stefan.monnier@@epfl.ch>

        * main.c (main): Allow -d to override CVSROOT_ENV.

Thu Aug 24 18:57:49 1995  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* cvs.h, rcscmds.c (RCS_unlock, RCS_deltag, RCS_lock): Add extra
	parameter for whether to direct stderr to DEVNULL.
	* checkin.c, tag.c, rtag.c, import.c, commit.c: Pass extra
	argument.  1 if stderr had been directed to DEVNULL before
	rcscmds.c was in use, 0 if it was RUN_TTY.

	* cvs.h: Add comment regarding attic.

Tue Aug 22 10:09:29 1995  Alexander Dupuy  <dupuy@@smarts.com>

	* rcs.c (whitespace): Cast to unsigned char in case char is signed
	and value is negative.

Tue Aug 22 10:09:29 1995  Kirby Koster  <koster@@sctc.com>
			  and Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* update.c (join_file): If vers->vn_user is NULL, just return.

Tue Aug 22 10:09:29 1995  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* server.c, client.c: Add comments about modes and umasks.

Mon Aug 21 12:54:14 1995  Rick Sladkey  <jrs@@world.std.com>

	* update.c (update_filesdone_proc): If pipeout, don't try to
	create CVS/Root.

Mon Aug 21 12:54:14 1995  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* client.c (start_rsh_server): Don't pass -d to "cvs server"
	invocation via rsh.

	* server.c (serve_root): Report errors via pending_error_text.
	(serve_valid_requests): Check for pending errors.

Sun Aug 20 00:59:46 1995  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* options.h.in: Document usage of DIFF in update.c
	* update.c: Use DIFF -c, not DIFF -u.  The small improvement in
	diff size is not worth the hassle in terms of everyone having to
	make sure that DIFF is GNU diff (IMHO).

Sat Aug 19 22:05:46 1995  Jim Blandy  <jimb@@totoro.cyclic.com>

	* recurse.c (start_recursion): Doc fix.

	* server.c (do_cvs_command): Clear error_use_protocol in the
	child.
	(server): Set error_use_protocol.

Sun Aug 13 15:33:37 1995  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* server.c (do_cvs_command): Don't select on exceptions.

Fri Aug  4 00:13:47 1995  Jim Meyering  (meyering@@comco.com)

	* Makefile.in (LDFLAGS): Set to @@LDFLAGS@@.
	(options.h): Depend on ../config.status and options.h.in.
	Add rule to build it from dependents.

	* add.c: Include save-cwd.h.
	(add_directory): Use save_cwd and restore_cwd instead of
	explicit getwd then chdir.
	* import.c (import_descend_dir): Likewise.
	* modules.c (do_module): Likewise.

	* recurse.c (save_cwd, restore_cwd, free_cwd): Remove functions.
	New versions have been broken out into save-cwd.c.
	(do_dir_proc): Adapt to handle status code returned by new versions
	of save_cwd and restore_cwd -- and one fewer argument to restore_cwd.
	(unroll_files_proc): Likewise.

	* wrapper.c (wrap_name_has): Add default: abort () to switch
	statement to avoid warning from gcc -Wall.
	(wrap_matching_entry): Remove dcl of unused TEMP.
	(wrap_tocvs_process_file): Remove dcl of unused ERR.
	(wrap_fromcvs_process_file): Likewise.

	* cvs.h: Remove prototype for error.  Instead, include error.h.
	Also, remove trailing white space.

Thu Aug  3 10:12:20 1995  Jim Meyering  (meyering@@comco.com)

	* import.c (import_descend_dir): Don't print probably-bogus CWD
	in error messages saying `cannot get working directory'.

Sun Jul 30 20:52:04 1995  James Kingdon  <kingdon@@harvey.cyclic.com>

	* parseinfo.c (Parse_Info): Revise comments and indentation.

Sun Jul 30 15:30:16 1995  Vince DeMarco  <vdemarco@@bou.shl.com>

        * history.c: put ifdef SERVER_SUPPORT around tracing code incase
        the client/server code is not compiled into the program.

Sat Jul 29 16:59:49 1995  James Kingdon  <kingdon@@harvey.cyclic.com>

	* subr.c (deep_remove_dir): Use struct dirent, not struct direct.

Sat Jul 29 18:32:06 1995  Vince DeMarco  <vdemarco@@bou.shl.com>

	* add.c: Check wrap_name_has.

	* diff.c, checkin.c, import.c: have code call unlink_file_dir in
	the appropriate places instead of just calling unlink_file.

        * checkin.c: Remove one unlink call.

	* import.c (comtable): Add .m .psw .pswm.

	* import.c (add_rcs_file): Remove tocvsPath before returning.

	* subr.c (unlink_file_dir):  Add new function. unlinks the file if
	it is a file. or will do a recursive delete if the path is
	actually a directory.
	(deep_remove_dir): New function, helps unlink_file_dir.

	* mkmodules.c:  Added CVSROOTADM_WRAPPER (cvswrappers file) to the
	checkout file list.

Fri Jul 28 16:27:56 1995  James Kingdon  <kingdon@@harvey.cyclic.com>

	* checkout.c (safe_location): Use PATH_MAX not MAXPATHLEN.

Fri Jul 28 19:37:03 1995  Paul Eggert  <eggert@@twinsun.com>

	* log.c (cvslog, log_fileproc): Pass all options (except -l)
	to rlog as-is, so that users can put spaces in options,
	can specify multiple -d options, etc.
	(ac, av): New variables.
	(log_option_with_arg, options): Remove.

	(log_fileproc): Don't prepend `/' to file name if update_dir is empty.

Tue Jul 25 00:52:26 1995  James Kingdon  <kingdon@@harvey.cyclic.com>

	* checkout.c (safe_location): Don't use PROTO in function definition.

Mon Jul 24 18:32:06 1995  Vince DeMarco  <vdemarco@@bou.shl.com>

	* checkout.c (safe_location):  fix a compiler warning. (Declare
	safe_location). Changed code in safe_location to call getwd
	instead of getcwd. getwd is declared in the ../lib directory and
	used exclusively thoughout the code. (this helps portability on
	non POSIX systems).

	* wrapper.c: updated Andrew Athan's email address.

	* main.c:  fix an ifdef so the code will compile. syntax error in
	the ifdef for CVS_NOADMIN.

Mon Jul 24 13:25:00 1995  Del <del@@babel.dialix.oz.au>

	* checkout.c:  New procedure safe_location.
	Ensures that you don't check out into the repository
	itself.

	* tag.c, rtag.c, cvs.h, mkmodules.c:  Added a "taginfo" file in
	CVSROOT to perform pre-tag checks.

	* main.c, options.h.in:  Added a compile time option to
	disable the admin command.

Fri Jul 21 17:07:42 1995  James Kingdon  <kingdon@@harvey.cyclic.com>

	* update.c, status.c, patch.c, checkout.c, import.c, release.c,
	rtag.c, tag.c: Now -q and -Q options just print an error message
	telling you to use global -q and -Q options.  The non-global
	options were a mess because some commands accepted them and some
	did not, and they were redundant with -q and -Q global options.

	* rcs.c, cvs.h, commit.c, log.c, find_names.c: Remove CVS.dea
	stuff.  It is slower than the alternatives and I don't think
	anyone ever actually used it.

Fri Jul 21 10:35:10 1995  Vince DeMarco <vdemarco@@bou.shl.com>

	* Makefile.in (SOURCES, OBJECTS): Add wrapper.c, wrapper.o.
	* add.c, admin.c, checkout.c, commit.c, diff.c, import.c, log.c,
	remove.c, status.c: Call wrap_setup at start of commands.
	* add.c (add): Check for wrapper, as well as directory, in repository.
	* checkin.c: Add tocvsPath variable and associated handling.
	* cvs.h: Add wrapper declarations.
	* diff.c: Add tocvsPath variable and associated handling.
	* import.c: Add -W option, CVSDOTWRAPPER handling.
	(import_descend): check wrap_name_has.
	(update_rcs_file, add_rev, add_rcs_file): add tocvsPath
	variable and associated handling.
	* no_diff.c: Add tocvsPath variable and associated handling.
	* recurse.c (start_recursion): Check wrap_name_has.
	* update.c: Copy, don't merge, copy-by-merge files.  Attempt to
	use -j on a copy-by-merge file generates a warning and no further
	action.
	* update.c: Add CVSDOTWRAPPER handling.
	* wrapper.c: Added.

Fri Jul 21 00:20:52 1995  James Kingdon  <kingdon@@harvey.cyclic.com>

	* client.c: Revert David Lamkin patch, except for the bits about
	removing temp_filename and the .rej file.
	* sanity.sh (errmsg1): Test for the underlying bug which Lamkin
	kludged around.
	* client.c (call_in_directory): Set short_pathname to include the
	filename, not just the directory.  Improve comments regarding what
	is passed to FUNC.

Thu Jul 20 17:51:54 1995  David Lamkin  <drl@@net-tel.co.uk>

	* client.c (short_pathname): Fixes the fetching of the whole file
	after a patch to bring it up to date has failed:
	   - failed_patches[] now holds short path to file that failed
	   - patch temp files are unlinked where the patch is done

Thu Jul 20 12:37:10 1995  James Kingdon  <kingdon@@harvey.cyclic.com>

	* cvs.h: Declare error_set_cleanup
	* main.c: Call it.
	(error_cleanup): New function.

Thu Jul 20 12:17:16 1995  Mark H. Wilkinson  <mhw@@minster.york.ac.uk>

	* add.c, admin.c, checkin.c, checkout.c, classify.c, client.c,
	client.h, commit.c, create_adm.c, cvs.h, diff.c, entries.c,
	history.c, import.c, log.c, main.c, modules.c, no_diff.c, patch.c,
	release.c, remove.c, repos.c, rtag.c, server.c, server.h,
	status.c, subr.c, tag.c, update.c, vers_ts.c, version.c: Put
	client code inside #ifdef CLIENT_SUPPORT, server code inside
	#ifdef SERVER_SUPPORT.  When reporting version, report whether
	client and/or server are compiled in.

Wed Jul 19 18:00:00 1995  Jim Blandy <jimb@@cyclic.com>

	* subr.c (copy_file): Declare local var n to be an int,
	not a size_t.  size_t is unsigned, and the return values
	of read and write are definitely not unsigned.

	* cvs.h [HAVE_IO_H]: #include <io.h>.
	[HAVE_DIRECT_H]: #include <direct.h>.

Fri Jul 14 22:28:46 1995  Jim Blandy  <jimb@@totoro.cyclic.com>

	* server.c (dirswitch, serve_static_directory, serve_sticky,
	serve_lost, server_write_entries, serve_checkin_prog,
	serve_update_prog): Include more information in error messages.
	(Thanks, DJM.)

	* cvsbug.sh: Use /usr/sbin/sendmail, unless it doesn't
	exist, in which case use /usr/lib/sendmail.  (Thanks, DJM.)

	* server.c (server, server_cleanup): Use "/tmp" instead of
	"/usr/tmp" when the TMPDIR environment variable isn't set.  This
	is what the rest of the code uses.

Thu Jul 13 11:03:17 1995  Jim Meyering  (meyering@@comco.com)

	* recurse.c (free_cwd): New function.
	(save_cwd, restore_cwd): Use it instead of simply freeing any
	string.  The function also closes any open file descriptor.

	* import.c (comtable): Now static.
	(comtable): Put braces around each element of initializer.

	* cvs.h: Add prototype for xgetwd.
	* recurse.c (save_cwd, restore_cwd): New functions to encapsulate
	run-time solution to secure-SunOS vs. fchown problem.
	(do_dir_proc, unroll_files_proc): Use new functions instead of
	open-coded fchdir/chdir calls with cpp directives.

        * sanity.sh: Change out of TESTDIR before removing it.
	Some versions of rm fail when asked to delete the current directory.

Wed Jul 12 22:35:04 1995  Jim Meyering  (meyering@@comco.com)

	* client.c (get_short_pathname): Add const qualifier to parameter dcl.
	(copy_a_file): Remove set-but-not-used variable, LEN.
	(handle_clear_static_directory): Likewise: SHORT_PATHNAME.
	(set_sticky): Likewise: LEN.
	(handle_set_sticky): Likewise: SHORT_PATHNAME.
	(handle_clear_sticky): Likewise: SHORT_PATHNAME.
	(start_rsh_server): Convert perl-style `cond || stmt' to more
	conventional C-style `if (cond) stmt.'  Sheesh.
	Remove dcl of unused file-static, SEND_CONTENTS.

	* history.c: Remove dcls of set-but-not-used file-statics,
	HISTSIZE, HISTDATA.
	(read_hrecs): Don't set them.

	* import.c (add_rev): Remove dcl of set-but-not-used local, RETCODE.

	* repos.c (Name_Repository): Remove dcl of set-but-not-used local,
	HAS_CVSADM.

	* cvsrc.c (read_cvsrc): Parenthesize assignment used as truth value.

Tue Jul 11 16:49:41 1995  J.T. Conklin  <jtc@@rtl.cygnus.com>

	* hash.h (struct entnode, Entnode): moved from here...
	* cvs.h: to here.

Wed Jul 12 19:45:24 1995  Dominik Westner (dominik@@gowest.ppp.informatik.uni-muenchen.de)

        * client.c (server_user): new var.
        (parse_cvsroot): set above if repo is "user@@host:/dir".
        (start_rsh_server): if server_user set, then use it.

Wed Jul 12 10:53:36 1995  Karl Fogel  <kfogel@@floss.cyclic.com>

        * sanity.sh: remove the TESTDIR after done.

        * cvsbug.sh (GNATS_ADDR): now bug-cvs@@prep.ai.mit.edu again.

Tue Jul 11 15:53:08 1995  Greg A. Woods  <woods@@most.weird.com>

        * options.h.in: depend on configure for grep and diff, now that
        changes to configure.in are applied.

Tue Jul 11 14:32:14 1995 Michael Shields  <shields@@tembel.org>

	* Makefile.in (LDFLAGS): Pick up from configure.

Tue Jul 11 14:20:00 1995  Loren James Rittle  <rittle@@supra.comm.mot.com>

	* import.c (add_rev), commit.c (remove_file, ci_new_rev),
	checkin.c (Checkin), subr.c (make_message_rcslegal), cvs.h:
	Always perform sanity check and fix-up on messages to be passed
 	directly to RCS via the '-m' switch.  RCS 5.7 requires that a
 	non-total-whitespace, non-null message be provided or it will
 	abort with an error.  CVS is not setup to handle any returned
 	error from 'ci' gracefully and, thus, the repository entered a
 	trashed state.

	* sanity.sh: Add regression tests for new code and interactions
	with RCS 5.7.

Sun Jul  9 19:03:00 1995  Greg A. Woods  <woods@@most.weird.com>

	* .cvsignore: added new backup file

	* options.h.in: our new configure.in finds the right diff and
        grep paths now....

	* subr.c: quote the string in run_print() for visibility
	- indent a comment
	- Jun Hamano's xchmod() patch to prevent writable files
	(from previous local changes)

	* logmsg.c: fix a NULL pointer de-reference
	- clean up some string handling code...
	(from previous local changes)

	* parseinfo.c: add hack to expand $CVSROOT in an *info file.
	- document "ALL" and "DEFAULT" in opening comment for Parse_Info()
	- fix the code to match the comments w.r.t. callbacks for "ALL"
	- add a line of trace output...
	(from previous local changes)

	* mkmodules.c: add support for comments in CVSROOT/checkoutlist
	- add CVSroot used by something other .o, ala main.c
	(from previous local changes)

	* main.c, cvs.h: add support for $VISUAL as log msg editor
	(from previous local changes)

	* status.c: add support for -q and -Q (from previous local changes)


Sun Jul  9 18:44:32 1995  Karl Fogel  <kfogel@@floss.cyclic.com>

        * log.c: trivial change to test ChangeLog stuff.

Sat Jul  8 20:33:57 1995  Paul Eggert  <eggert@@twinsun.com>

	* history.c: (history_write): Don't assume that fopen(..., "a")
	lets one interleave writes to the history file from different processes
	without interlocking.  Use open's O_APPEND option instead.
	Throw in an lseek to lessen the race bugs on non-Posix hosts.
	* cvs.h, subr.c (Fopen): Remove.

	* log.c (log_fileproc): Pass working file name to rlog, so that
	the name is reported correctly.

Fri Jul  7 18:29:37 1995  Michael Hohmuth  <hohmuth@@inf.tu-dresden.de>

	* client.c, client.h (client_import_setup): New function.
	(client_import_done, client_process_import_file): Add comments
	regarding now-redundant code.
	* import.c (import): Call client_import_setup.

Tue Jul  4 09:21:26 1995  Bernd Leibing  <bernd.leibing@@rz.uni-ulm.de>

	* rcs.c (RCS_parsercsfile_i): Rename error to l_error; SunOS4 /bin/cc
	doesn't like a label and function with the same name.

Sun Jul  2 12:51:33 1995  Fred Appelman <Fred.Appelman@@cv.ruu.nl>

	* logmsg.c: Rename strlist to str_list to avoid conflict with
	Unixware 2.01.

Thu Jun 29 17:37:22 1995  Paul Eggert  <eggert@@twinsun.com>

	* rcs.c (RCS_check_kflag): Allow RCS 5.7's new -kb option.

Wed Jun 28 09:53:14 1995  James Kingdon  <kingdon@@harvey.cyclic.com>

	* Makefile.in (HEADERS): Remove options.h.in.
	(DISTFILES): Add options.h.in.
	Depend on options.h in addition to HEADERS.

Tue Jun 27 22:37:28 1995  Vince Demarco  <vdemarco@@bou.shl.com>

	* subr.c: Don't try to do fancy waitstatus stuff for NeXT,
	lib/wait.h is sufficient.

Mon Jun 26 15:17:45 1995  James Kingdon  <kingdon@@harvey.cyclic.com>

	* Makefile.in (DISTFILES): Remove RCS-patches and convert.sh.

Fri Jun 23 13:38:28 1995  J.T. Conklin  (jtc@@rtl.cygnus.com)

	* server.c (dirswitch, serve_co): Use CVSADM macro instead of
        literal "CVS".

Fri Jun 23 00:00:51 1995  James Kingdon  <kingdon@@harvey.cyclic.com>

	* README-rm-add: Do not talk about patching RCS, that only
	confuses people.
	* RCS-patches, convert.sh: Removed (likewise).

Thu Jun 22 10:41:41 1995  James Kingdon  <kingdon@@harvey.cyclic.com>

	* subr.c: Change -1 to (size_t)-1 when comparing against a size_t.

Wed Jun 21 16:51:54 1995  nk@@ipgate.col.sw-ley.de (Norbert Kiesel)

	* create_adm.c, entries.c, modules.c: Avoid coredumps if
	timestamps, tags, etc., are NULL.

Tue Jun 20 15:52:53 1995  Jim Meyering  (meyering@@comco.com)

	* checkout.c (checkout): Remove dcl of unused variable.
	* client.c (call_in_directory, handle_clear_static_directory,
	handle_set_sticky, handle_clear_sticky, send_a_repository,
	send_modified, send_dirent_proc): Remove dcls of unused variables.
	* server.c (receive_file, serve_modified, server_cleanup):
	Remove dcls of unused variables.
	* subr.c (copy_file): Remove dcl of unused variable.
	* vers_ts.c (time_stamp_server): Remove dcl of unused variable.

Mon Jun 19 13:49:35 1995  Jim Blandy  <jimb@@totoro.cyclic.com>

	* sanity.sh: Fix commencement message --- the test suite says
	"Ok." when it's done.

Fri Jun 16 11:23:44 1995  Jim Meyering  (meyering@@comco.com)

	* entries.c (fgetentent): Parenthesize assignment in if-conditional.

Thu Jun 15 17:33:28 1995  J.T. Conklin  <jtc@@rtl.cygnus.com>

	* server.c (get_buffer_data, buf_append_char, buf_append_data):
	  Don't conditionalize use of "inline".  Autoconf takes care of
	  defining it away on systems that don't grok it.

Thu Jun 15 13:43:38 1995  Jim Kingdon  (kingdon@@cyclic.com)

	* options.h.in (DIFF): Default to "diff" not "diff -a" since diff
	might not support the -a option.

Wed Jun 14 11:29:42 1995  J.T. Conklin  <jtc@@rtl.cygnus.com>

	* import.c (import_descend): Initialize dirlist to NULL.

	* subr.c (copy_file): Fix infinite loop.

	* server.c (serve_directory): fix a memory leak.

	* checkout.c, commit.c, diff.c, history.c, import.c, log.c,
	  patch.c, release.c, remove.c, rtag.c, status.c, tag.c, update.c:
	  Use send_arg() to send command line arguments to server.

	* commit.c (fsortcmp), find_names (fsortcmp), hash.c (hashp,
	  findnode), hash.h (findnode), rcs.c (RCS_addnode,
	  RCS_check_kflag, RCS_check_tag, RCS_isdead, RCS_parse,
	  RCS_parsercsfile_i), rcs.h (RCS_addnode, RCS_check_kflag,
	  RCS_check_tag, RCS_parse): Added const qualifiers as
	  appropriate.
	* rcs.h (RCS_isdead): Added prototype.

	* hash.h (walklist, sortlist): correct function prototypes.

	* ignore.c (ign_setup): don't bother checking to see if file
	  exists before calling ign_add_file.

Fri Jun  9 11:24:06 1995  J.T. Conklin  <jtc@@rtl.cygnus.com>

	* all source files (rcsid): Added const qualifer.
	* ignore.c (ign_default): Added const qualifier.
	* subr.c (numdots): Added const qualifier to function argument.
	* cvs.h (numdots): Added const qualifier to prototype argument.

	* client.c (change_mode): Tied consecutive if statements testing
	  the same variable together with else if.

	* import.c (import_descend): Build list of subdirectories when
	  reading directory, and then process the subdirectories in that
	  list.  This change avoids I/O overhead of rereading directory
	  and reloading ignore list (.cvsignore) for each subdirectory.

Thu Jun  8 11:54:24 1995  J.T. Conklin  <jtc@@rtl.cygnus.com>

	* import.c (import_descend): Use 4.4BSD d_type field if it is
	  present.

	* lock.c (set_lockers_name): Use %lu in format and cast st_uid
	  field to unsigned long.

	* import.c (import): Use RCS_check_kflag() to check -k options.
	  (keyword_usage, str2expmode, strn2expmode, expand_names):
	  Removed.
	* rcs.c (RCS_check_kflag): Added keyword_usage array from import.c
	  for more descriptive error messages.

	* subr.c (run_setup, run_args): Changed variable argument
	  processing to work on machines that use <varargs.h>.

	* subr.c (copy_file, xcmp): Changed to read the file(s) by blocks
	  rather than by reading the whole file into a huge buffer.  The
	  claim that this was reasonable because source files tend to be
	  small does not hold up in real world situations.   CVS is used
	  to manage non-source files, and mallocs of 400K+ buffers (x2
	  for xcmp) can easily fail due to lack of available memory or
	  even memory pool fragmentation.
	  (block_read): New function, taken from GNU cmp and slightly
	  modified.

	* subr.c (xcmp): Added const qualifier to function arguments.
	* cvs.h (xcmp): Added const qualifer to prototype arguments.

Wed Jun  7 11:28:31 1995  J.T. Conklin  <jtc@@rtl.cygnus.com>

	* cvs.h (Popen): Added prototype.
	  (Fopen, open_file, isreadable, iswritable, isdir, isfile,
	  islink, make_directory, make_directories, rename_file,
	  link_file, unlink_file, copy_file): Added const qualifer to
	  prototype arguments.
	* subr.c (Fopen, Popen, open_file, isreadable, iswritable, isdir,
	  isfile, islink, make_directory, make_directories, rename_file,
	  link_file, unlink_file, copy_file): Added const qualifier to
	  function arguments.

	* logmsg.c (logfile_write), recurse.c (do_recursion, addfile):
	  Don't cast void functions to a void expression.  There is at
	  least one compiler (MPW) that balks at this.

	* rcs.c (keysize, valsize): Change type to size_t.

	* add.c (add_directory): Don't cast umask() argument to int.

	* import.c (add_rcs_file): Changed type of mode to mode_t.

	* rcscmds.c (RCS_merge): New function.
	* cvs.h (RCS_merge): Declare.
	* update.c (merge_file, join_file): Call RCS_merge instead of
	  invoking rcsmerge directly.

	* cvs.h: Include <stdlib.h> if HAVE_STDC_HEADERS, otherwise
	  declared getenv().
	* cvsrc.c, ignore.c, main.c: Removed getenv() declaration.

	* client.c (mode_to_string): Changed to take mode_t instead of
	  struct statb argument.  Simplified implementation, no longer
	  overallocates storage for returned mode string.
	* client.h (mode_to_string): Updated declaration.
	* server.c (server_updated): Updated for new calling conventions,
	  pass st_mode instead of pointer to struct statb.

	* cvs.h (CONST): Removed definition, use of const qualifier is
	  determined by autoconf.
	* history.c, modules.c, parseinfo.c: Use const instead of CONST.

	* add.c, admin.c, checkout.c, commit.c, diff.c, import.c, log.c,
	  main.c, mkmodules.c, patch.c, recurse.c, remove.c, rtag.c,
	  server.c, status.c, subr.c, tag.c, update.c: Changed function
	  arguments "char *argv[]" to "char **argv" to silence lint
	  warnings about performing arithmetic on arrays.

Tue Jun  6 18:57:21 1995  Jim Blandy  <jimb@@totoro.cyclic.com>

	* version.c: Fix up version string, to say that this is Cyclic
        CVS.

Tue Jun  6 15:26:16 1995  J.T. Conklin  <jtc@@rtl.cygnus.com>

	* subr.c (run_setup, run_args, run_add_arg, xstrdup): Add const
	  qualifier to format argument.
	* cvs.h (run_setup, run_args, xstrdup): Likewise.

	* Makefile.in (SOURCES): Added rcscmds.c.
	  (OBJECTS): Added rcscmds.o.

	* rcscmds.c: New file, with new functions RCS_settag, RCS_deltag,
	  RCS_setbranch, RCS_lock, RCS_unlock.
	* checkin.c, commit.c, import.c, rtag.c, tag.c: Call above
	  functions instead of exec'ing rcs commands.
	* cvs.h: Declare new functions.

Mon May 29 21:40:54 1995  J.T. Conklin  (jtc@@rtl.cygnus.com)

	* recurse.c (start_recursion, do_recursion): Set entries to NULL
	  after calling Entries_Close().

Sat May 27 08:08:18 1995  Jim Meyering  (meyering@@comco.com)

	* Makefile.in (check): Export RCSBIN only if there exists an
	`rcs' executable in ../../rcs/src.  Before, tests would fail when
	the directory existed but contained no executables.
	(distclean): Remove options.h, now that it's generated.
	(Makefile): Regenerate only *this* file when Makefile.in is
	out of date.  Depend on ../config.status.

Fri May 26 14:34:28 1995  J.T. Conklin  <jtc@@rtl.cygnus.com>

	* entries.c (Entries_Open): Added missing fclose().
	  (Entries_Close): Don't write Entries unless Entries.Log exists.

	* entries.c (Entries_Open): Renamed from ParseEntries; changed to
	  process Entries Log files left over from previous crashes or
	  aborted runs.
	  (Entries_Close): New function, write out Entries file if
	  neccessary and erase Log file.
	  (Register): Append changed records to Log file instead of
	  re-writing file.
	  (fgetentent): New function, parse one Entry record from a file.
	  (AddEntryNode): It's no longer an error for two records with the
	  same name to be added to the list.  New records replace older
	  ones.
	* cvs.h (Entries_Open, Entries_Close): Add prototypes.
	  (CVSADM_ENTLOG): New constant, name of Entries Log file.
	* add.c, checkout.c, client.c, find_names.c, recurse.c: Use
	  Entries_Open()/Entries_Close() instead of ParseEntries()/dellist().

	* add.c, admin.c, checkout.c, client.c, commit.c, diff.c,
	  history.c, import.c, log.c, patch.c, release.c, remove.c,
	  rtag.c, server.c, status.c, tag.c, update.c: Changed
	  conditionals so that return value of *printf is tested less than
	  0 instead of equal to EOF.

Thu May 25 08:30:12 1995  Jim Kingdon  (kingdon@@lioth.cygnus.com)

	* subr.c (xmalloc): Never try to malloc zero bytes; if the user
	asks for zero bytes, malloc one instead.

Wed May 24 12:44:25 1995  Ken Raeburn  <raeburn@@cujo.cygnus.com>

	* subr.c (xmalloc): Don't complain about NULL if zero bytes were
	requested.

Tue May 16 21:49:05 1995  Jim Blandy  <jimb@@totoro.bio.indiana.edu>

	* subr.c (xmalloc): Never try to malloc zero bytes; if the user
	asks for zero bytes, malloc one instead.

Mon May 15 14:35:11 1995  J.T. Conklin  <jtc@@rtl.cygnus.com>

	* lock.c (L_LOCK_OWNED): Removed.

	* add.c, checkout.c, client.c, create_adm.c, cvs.h, entries.c,
	  find_names.c modules.c, recurse.c, release.c, repos.c, update.c:
	  removed CVS 1.2 compatibility/upgrade code.

Mon May  8 11:25:07 1995  J.T. Conklin  <jtc@@rtl.cygnus.com>

	* lock.c (write_lock): Missed one instance where rmdir(tmp) should
	  have been changed to clear_lock().

Wed May  3 11:08:32 1995  J.T. Conklin  <jtc@@rtl.cygnus.com>

	* create_adm.c, entries.c, import.c, root.c: Changed conditionals
	  so that return value of *printf is tested less than 0 instead of
	  equal to EOF --- That's all Standard C requires.

Wed May  3 18:03:37 1995  Samuel Tardieu  <tardieu@@emma.enst.fr>

	* rcs.h: removed #ifdef CVS_PRIVATE and #endif because cvs didn't
	  compile anymore.

Mon May  1 13:58:53 1995  J.T. Conklin  <jtc@@rtl.cygnus.com>

	* rcs.c, rcs.h: Implemented lazy parsing of rcs files.
	  RCS_parsercsfile_i modified to read only the first two records
	  of rcs files, a new function RCS_reparsercsfile is called only
	  when additional information (tags, revision numbers, dates,
	  etc.) is required.

Mon May  1 12:20:02 1995  Jim Kingdon  (kingdon@@lioth.cygnus.com)

	* Makefile.in (INCLUDES): Include -I. for options.h.

Fri Apr 28 16:16:33 1995  Jim Blandy  <jimb@@totoro.bio.indiana.edu>

	* Makefile.in (SOURCES, HEADERS, DISTFILES): Updated.
	(dist-dir): Renamed from dist; changed to work with DISTDIR
	variable passed from parent.

	We don't want to include a file the user has to edit in the
	distribution.
	* options.h: No longer distributed.
	* options.h.in: Distribute this instead.
	* ../INSTALL, ../README: Installation instructions updated.

	* client.c (start_rsh_server): Send the remote command to rsh as a
	single string.

Fri Apr 28 00:29:49 1995  Noel Cragg  <noel@@vo.com>

	* commit.c: Added initializer for FORCE_CI

        * sanity.sh: Fix tests added 25 Apr -- they were expecting the
        server to make noise, but the CVS_SERVER variable had been
        accidentally set with the `-Q' flag.  Ran all tests -- both
        locally and remotely -- to verify that the change didn't break
        anything.

Thu Apr 27 12:41:52 1995  Jim Kingdon  (kingdon@@lioth.cygnus.com)

	* Makefile.in: Revise comment regarding check vs. remotecheck.

Thu Apr 27 12:52:28 1995  Bryan O'Sullivan <bos@@cyclic.com>

	* client.c (start_rsh_server): If the CVS_RSH environment variable
	is set, use its contents as the name of the program to invoke
	instead of `rsh'.

Thu Apr 27 12:18:38 1995  Noel Cragg  <noel@@vo.com>

	* checkout.c (checkout): To fix new bug created by Apr 23 change,
        re-enabled "expand-module" functionality, because it has the side
        effect of setting the checkin/update programs for a directory.  To
        solve the local/remote checkout problem that prompted this change
        in the first place, I performed the next change.
	* server.c (expand_proc): Now returns expansions for aliases only.

Wed Apr 26 12:07:42 1995  J.T. Conklin  <jtc@@rtl.cygnus.com>

	* rcs.c (getrcskey): Rewritten to process runs of whitespace chars
	  and rcs @@ strings instead of using state variables "white" and
	  "funky".

Fri Apr  7 15:49:25 1995  J.T. Conklin  <jtc@@rtl.cygnus.com>

	* lock.c (unlock): Only call stat if we need to.

Wed Apr 26 10:48:44 1995  Jim Kingdon  (kingdon@@lioth.cygnus.com)

	* server.c (new_entries_line): Don't prototype.

Tue Apr 25 22:19:16 1995  Jim Blandy  <jimb@@totoro.bio.indiana.edu>

	* sanity.sh: Add new tests to catch bugs in Apr 23 change.

Tue Apr 25 17:10:55 1995  Roland McGrath  <roland@@baalperazim.frob.com>

	* create_adm.c (Create_Admin): Use getwd instead of getcwd.

Sun Apr 23 20:58:32 1995  Noel Cragg  <noel@@vo.com>

       	* checkout.c (checkout): Disabled "expand-module" functionality on
        remote checkout, since it makes modules behave like aliases (see
        longer note there).  This change necessitated the change below.
        Also merged the like parts of a conditional.

	* client.c (call_in_directory): Changed the algorithm that created
        nested and directories and the "CVS" administration directories
        therein.  The algoithm wrongly assumed that the name of the
        directory that that was to be created and the repository name were
        the same, which breaks modules.

	* create_adm.c (Create_Admin), module.c (do_module), server.c
        (server_register), subr.c, entries.c: Added fprintfs for trace-mode
	debugging.

	* client.c (client_send_expansions): Argument to function didn't
        have a type -- added one.

	* server.c (new_entries_line): Arguments to this function are
        never used -- reoved them and fixed callers.

Sat Apr 22 11:17:20 1995  Jim Kingdon  (kingdon@@lioth.cygnus.com)

	* rcs.c (RCS_parse): If we can't open the file, give an error
	message (except for ENOENT in case callers rely on that).

Wed Apr 19 08:52:37 1995  Jim Kingdon  (kingdon@@lioth.cygnus.com)

	* client.c (send_repository): Check for CVSADM_ENTSTAT in `dir', not
	in `.'.

	* sanity.sh: Add TODO list.  Revise some comments.  Add tests of
	one working directory adding a file and other updating it.

Sat Apr  8 14:52:55 1995  Jim Blandy  <jimb@@totoro.bio.indiana.edu>

	* Makefile.in (CFLAGS): Let configure set the default for CFLAGS.
	Under GCC, we want -g -O.

Fri Apr  7 15:49:25 1995  J.T. Conklin  <jtc@@rtl.cygnus.com>

	* root.c (Name_Root): merge identical adjacent conditionals.

	* create_admin.c (Create_Admin): Rearranged check for CVSADM and
	  OCVSADM directories so that CVSADM pathname is only built once.

	* update.c (update_dirleave_proc): Removed code to remove CVS
	  administration directory if command_name == "export" and to
	  create CVS/Root file if it is not present.  Identical code
	  in update_filesdone_proc() will perform these same actions.
	  Also removed code that read and verfied CVS/Root.  This is
	  expensive, and if it is necessary should happen in the
	  general recursion processor rather than in the update
	  callbacks.

	* lock.c (masterlock): New variable, pathname of master lockdir.
	  (set_lock): removed lockdir argument, now constructs it itself
	  and stores it in masterlock.
	  (clear_lock): new function, removes master lockdir.
	  (Reader_Lock, write_lock): call clear_lock instead of removing
	  master lockdir.
	  (Reader_Lock, write_lock): #ifdef'd out CVSTFL code.

	* main.c (main): register Lock_Cleanup signal handler.
	* lock.c (Reader_Lock, write_lock): no longer register
	  Lock_Cleanup.

	* main.c (main): initialize new array hostname.
	* lock.c (Reader_Lock, write_lock): Use global hostname array.
	* logmsg.c (logfile_write): Likewise.

	* recurse.c (do_dir_proc, unroll_files_proc): Use open()/fchdir()
	  instead of getwd()/chdir() on systems that support the fchdir()
	  system call.

Fri Apr  7 06:57:20 1995  Jim Kingdon  (kingdon@@lioth.cygnus.com)

	* server.c: Include the word "server" in error message for memory
	exhausted, so the user knows which machine ran out of memory.

	* sanity.sh: For remote, set CVS_SERVER to test the right server,
	rather than a random one from the PATH.

	* commit.c [DEATH_STATE]: Pass -f to `ci'.

Thu Apr  6 13:05:15 1995  Jim Blandy  <jimb@@totoro.bio.indiana.edu>

	* commit.c (checkaddfile): If we didn't manage to fopen the file,
	don't try to fclose it.

	* client.c (handle_m, handle_e): Use fwrite, rather than a loop of
	putc's.  Sometimes these streams are unbuffered.

Tue Apr  4 11:33:56 1995  Jim Blandy  <jimb@@totoro.bio.indiana.edu>

	* (DISTFILES): Include cvsbug.sh, ChangeLog, NOTES, RCS-patches,
	README-rm-add, ChangeLog.fsf, sanity.sh, sanity.el, and
	.cvsignore.

Mon Mar 27 08:58:42 1995  Jim Kingdon  (kingdon@@lioth.cygnus.com)

	* rcs.c (RCS_parsercsfile_i): Accept `dead' state regardless of
	DEATH_STATE define.  Revise comments regarding DEATH_STATE versus
	CVSDEA versus the scheme which uses a patched RCS.
	* README-rm-add, RCS-patches: Explain what versions of CVS need
	RCS patches.

Sat Mar 25 18:51:39 1995  Roland McGrath  <roland@@churchy.gnu.ai.mit.edu>

	* server.c (server_cleanup): Only do the abysmal kludge of waiting
 	for command and draining the pipe #ifdef sun.  The code makes
 	assumptions not valid on all systems, and is only there to
 	workaround a SunOS bug.

Wed Mar 22 21:55:56 1995  Jim Kingdon  (kingdon@@lioth.cygnus.com)

	* server.c (mkdir_p): Call stat only if we get the EACCES.  Faster
	and more elegant.

Tue Jan 31 20:59:19 1995  Ken Raeburn  <raeburn@@cujo.cygnus.com>

	* server.c: Try to avoid starting the "rm -rf" at cleanup time
	until after subprocesses have finished.
	(command_fds_to_drain, max_command_fd): New variables.
	(do_cvs_command): Set them.
	(command_pid_is_dead): New variable.
	(wait_sig): New function.
	(server_cleanup): If command_pid is nonzero, wait for it to die,
	draining output from it in the meantime.  If nonzero SIG was
	passed, send a signal to the subprocess, to encourage it to die
	soon.

	* main.c (usage): Argument is now `const char *const *'.
	* cvs.h (usage): Changed prototype.
	(USE): Make new variable `const'.
	* add.c (add_usage), admin.c (admin_usage), checkout.c
	(checkout_usage, export_usage, checkout), commit.c (commit_usage),
	diff.c (diff_usage), history.c (history_usg), import.c
	(import_usage, keyword_usage), log.c (log_usage), main.c (usg),
	patch.c (patch_usage), release.c (release_usage), remove.c
	(remove_usage), rtag.c (rtag_usage), server.c (server), status.c
	(status_usage), tag.c (tag_usage), update.c (update_usage): Usage
	messages are now const arrays of pointers to const char.

	* import.c (comtable): Now const.
	* main.c (rcsid): Now static.
	(cmd): Now const.
	(main): Local variable CM now points to const.
	* server.c (outbuf_memory_error): Local var MSG now const.

	* client.c (client_commit_usage): Deleted.

Sat Dec 31 15:51:55 1994  Jim Kingdon  (kingdon@@lioth.cygnus.com)

	* logmsg.c (do_editor): Allocate enough space for trailing '\0'.

Fri Mar  3 11:59:49 1995  Jim Blandy  <jimb@@totoro.bio.indiana.edu>

	* cvsbug.sh: Call it "Cyclic CVS" now, not "Remote CVS".  Call it
	version C1.4A, not 1.4A2-remote.  Send bugs to cyclic-cvs, not
	remote-cvs.

	* classify.c (Classify_File): Put check for dead file inside
	"#ifdef DEATH_SUPPORT".

Thu Feb 23 23:03:43 1995  Jim Blandy  <jimb@@totoro.bio.indiana.edu>

	* update.c (join_file): Don't pass the -E option to rcsmerge here,
	either (see Jan 22 change).

Mon Feb 13 13:28:46 1995  Jim Blandy  <jimb@@totoro.bio.indiana.edu>

	* cvsbug.sh: Send bug reports to remote-cvs@@cyclic.com, rather
	than to the ordinary CVS bug address.  This does mean we'll have
	to wade through GNATS-style bug reports, sigh.

Wed Feb  8 06:42:27 1995  Roland McGrath  <roland@@churchy.gnu.ai.mit.edu>

	* server.c: Don't include <sys/stat.h>; system.h already does, and
 	4.3BSD can't take it twice.

	* subr.c [! HAVE_VPRINTF] (run_setup, run_args): Don't use va_dcl
 	in declaration.  Declare the a1..a8 args which are used in the
 	sprintf call.
	* cvs.h [! HAVE_VPRINTF] (run_setup, run_args): Don't prototype
 	args, to avoid conflicting with the function definitions
 	themselves.

Tue Feb  7 20:10:00 1995  Jim Blandy  <jimb@@totoro.bio.indiana.edu>

	* client.c (update_entries): Pass the patch subprocess the switch
	"-b ~", not "-b~"; the latter form seems not to work with patch
	version 2.0 and earlier --- it takes the next argv element as the
	backup suffix, and thus doesn't notice that the patch file's name
	has been specified, thus doesn't find the patch, thus...  *aargh*

Fri Feb  3 20:28:21 1995  Jim Blandy  <jimb@@totoro.bio.indiana.edu>

	* log.c (log_option_with_arg): New function.
	(cvslog): Use it and send_arg to handle the rlog options that take
	arguments.  The code used to use send_option_string for
	everything, which assumes that "-d1995/01/02" is equivalent to
	"-d -1 -9 -9 -5 ...".

Tue Jan 31 15:02:01 1995  Jim Blandy  <jimb@@floss.life.uiuc.edu>

	* server.c: #include <sys/stat.h> for the new stat call in mkdir_p.
	(mkdir_p): Don't try to create the intermediate directory if it
	exists already.  Some systems return EEXIST, but others return
	EACCES, which we can't otherwise distinguish from a real access
	problem.

Sun Jan 22 15:25:45 1995  Jim Blandy  <jimb@@totoro.bio.indiana.edu>

	* update.c (merge_file): My rcsmerge doesn't accept a -E option,
	and it doesn't look too important, so don't pass it.

Fri Jan 20 14:24:58 1995  Ian Lance Taylor  <ian@@sanguine.cygnus.com>

	* client.c (do_deferred_progs): Don't try to chdir to toplevel_wd
	if it has not been set.
	(process_prune_candidates): Likewise.

Mon Nov 28 09:59:14 1994  Jim Kingdon  (kingdon@@lioth.cygnus.com)

	* client.c (client_commit): Move guts of function from here...
	* commit.c (commit): ...to here.

Mon Nov 28 15:14:36 1994  Ken Raeburn  <raeburn@@cujo.cygnus.com>

	* server.c (buf_input_data, buf_send_output): Start cpp directives
	in column 1, otherwise Sun 4 pcc complains.

Mon Nov 28 09:59:14 1994  Jim Kingdon  (kingdon@@lioth.cygnus.com)

	* client.c (add_prune_candidate): Don't try to prune ".".

Tue Nov 22 05:27:10 1994  Jim Kingdon  (kingdon@@lioth.cygnus.com)

	* server.c, client.c: More formatting cleanups.

	* client.h, client.c: New variable client_prune_dirs.
	* update.c (update), checkout.c (checkout): Set it.
	* client.c (add_prune_candidate, process_prune_candidates): New
	functions.
	(send_repository, call_in_directory, get_responses_and_close):
	Call them.

Wed Nov 23 01:17:32 1994  Ian Lance Taylor  (ian@@tweedledumb.cygnus.com)

	* server.c (do_cvs_command): Don't select on STDOUT_FILENO unless
	we have something to write.

Tue Nov 22 05:27:10 1994  Jim Kingdon  (kingdon@@lioth.cygnus.com)

	* remove.c (remove_fileproc): Only call server_checked_in if we
	actually are changing the entries file.

	* server.c (server_write_entries): New function.
	(dirswitch, do_cvs_command): Call it.
	(serve_entry, serve_updated): Just update in-memory data
	structures, don't mess with CVS/Entries file.

Mon Nov 21 10:15:11 1994  Jim Kingdon  (kingdon@@lioth.cygnus.com)

	* server.c (server_checked_in): Set scratched_file to NULL after
	using it.

	* checkin.c (Checkin): If the file was changed by the checkin,
	call server_updated not server_checked_in.

Sun Nov 20 08:01:51 1994  Jim Kingdon  (kingdon@@lioth.cygnus.com)

	* client.c (send_repository): Move check for update_dir NULL to
	before where we check last_update_dir.  Check for "" here too.

	* client.c (send_repository): Use new argument dir.

	* client.c: Pass new argument dir to send_repository and
	send_a_repository.

	* server.c, server.h (server_prog): New function.
	* modules.c (do_modules): Call it if server_expanding.
	* client.c: Support Set-checkin-prog and Set-update-prog responses.
	* server.c, client.c: Add Checkin-prog and Update-prog requests.

Fri Nov 18 14:04:38 1994  Jim Kingdon  (kingdon@@lioth.cygnus.com)

	* client.c (get_short_pathname, is_cvsroot_level,
	call_in_directory): Base whether this is new-style or
	old-style based on whether we actually used the Directory request,
	not based on whether the pathname is absolute.  Rename
	directory_supported to use_directory.
	* server.c: Rename use_relative_pathnames to use_dir_and_repos.
	* client.c (send_a_repository): If update_dir is absolute, don't
	use it to try to reconstruct how far we have recursed.

	* server.c, server.h, client.c, client.h, vers_ts.c, update.h:
	More cosmetic changes (identation, PARAMS vs. PROTO, eliminate
	alloca, etc.) to remote CVS to make it more like the rest of CVS.

	* server.c: Make server_temp_dir just the dir name, not the name
	with "%s" at the end.
	* server.c, client.c: Add "Max-dotdot" request, and use it to make
	extra directories in server_temp_dir if needed.

Thu Nov 17 09:03:28 1994  Jim Kingdon  <kingdon@@cygnus.com>

	* client.c: Fix two cases where NULL was used and 0 was meant.

Mon Nov 14 08:48:41 1994  Jim Kingdon  (kingdon@@lioth.cygnus.com)

	* server.c (serve_unchanged): Set noexec to 0 when calling Register.

	* update.c (merge_file): Don't call xcmp if noexec.

Fri Nov 11 13:58:22 1994  Jim Kingdon  (kingdon@@lioth.cygnus.com)

	* client.c (call_in_directory): Deal with it if reposdirname is
	not a subdirectory of toplevel_repos.

Mon Nov  7 09:12:01 1994  Jim Kingdon  (kingdon@@lioth.cygnus.com)

	* patch.c: If file is removed and we don't have a tag or date,
	just print "current release".

	* classify.c (Classify_File): Treat dead files appropriately.

Fri Nov  4 07:33:03 1994  Jim Kingdon  (kingdon@@lioth.cygnus.com)

	* main.c (main) [SERVER_SUPPORT]: Move call to getwd past where we
	know whether we are the server or not.  Set CurDir to "<remote>"
	if we are the server.

	* client.c: Remove #if 0'd function option_with_arg.
	Remove #if 0'd code pertaining to the old way of logging the
	session.

	* client.c (start_rsh_server): Don't invoke the server with the
	-d option.
	* server.c (serve_root): Test root for validity, just like main.c
	does for non-remote CVS.
	* main.c (main): If `cvs server' happens with a colon in the
	CVSroot, just handle it normally; don't make it an error.

Wed Nov  2 11:09:38 1994  Jim Kingdon  (kingdon@@lioth.cygnus.com)

	* client.c (send_dirent_proc): If dir does not exist, just return
	R_SKIP_ALL.

	* server.c, client.c: Add Directory request and support for
	local relative pathnames (along with the repository absolute
	pathnames).
	* update.c, add.c, checkout.c, checkin.c, cvs.h, create_adm.c,
	commit.c, modules.c, server.c, server.h, remove.c, client.h:
	Pass update_dir to server_* functions.  Include update_dir in
	more error messages.

Fri Oct 28 08:54:00 1994  Jim Kingdon  (kingdon@@lioth.cygnus.com)

	* client.c: Reformat to bring closer to cvs standards for brace
	position, comment formatting, etc.

	* sanity.sh: Remove wrong "last mod" line.  Convert more tests to
	put PASS or FAIL in log file.  Change it so arguments to the
	script specify which tests to run.

	* client.c, client.h, server.c, checkout.c: Expand modules in
	separate step from the checkout itself.

Sat Oct 22 20:33:35 1994  Ken Raeburn  (raeburn@@kr-pc.cygnus.com)

	* update.c (join_file): When checking for null return from
	RCS_getversion, still do return even if quiet flag is set.

Thu Oct 13 07:36:11 1994  Jim Kingdon  (kingdon@@lioth.cygnus.com)

	* client.c (send_files): Call send_repository even if
	toplevel_repos was NULL.

	* server.c (server_updated): If joining, don't remove file.

	* update.c (join_file): If server and file is unmodified, check it
	out before joining.  After joining, call server_updated.  New
	argument repository.

	* server.c, server.h (server_copy_file): New function.
	* update.c (update_file_proc, join_file): Call it.
	* client.c (copy_file, handle_copy_file): New functions.
	* client.c (responses): Add "Copy-file".

	* client.c, client.h: Make toplevel_wd, failed_patches and
	failed_patches_count extern.
	* client.c (client_update): Move guts of function from here...
	* update.c (update): ...to here.

	* client.c, checkout.c: Likewise for checkout.

	* client.c (is_cvsroot_level): New function.
	(handle_set_sticky, handle_clear_sticky,
	handle_clear_static_directory): Call it, instead of checking
	short_pathname for a slash.

	* client.c, client.h (client_process_import_file,
	client_import_done): New functions.
	* import.c (import, import_descend): Use them.
	* import.c (import_descend): If server, don't mention ignored CVS
	directories.
	* import.c (import_descend_dir): If client, don't print warm
	fuzzies, or make directories in repository.  If server, print warm
	fuzzies to stdout not stderr.
	* client.c (send_modified): New function, broken out from
	send_fileproc.
	(send_fileproc): Call it.

	* client.c (handle_clear_sticky, handle_set_sticky,
	handle_clear_static_directory, handle_set_static_directory): If
	command is export, just return.
	(call_in_directory, update_entries): If command is export, don't
	create CVS directories, CVS/Entries files, etc.
	* update.c (update_filesdone_proc): Don't remove CVS directories if
	client_active.

	* client.c (send_a_repository): Instead of insisting that
	repository end with update_dir, just strip as many pathname
	components from the end as there are in update_dir.

	* Makefile.in (remotecheck): New target, pass -r to sanity.sh.
	* sanity.sh: Accept -r argument which means to test remote cvs.

	* tag.c (tag), rtag.c (rtag), patch.c (patch), import.c (import),
	admin.c (admin), release.c (release): If client_active, connect to
	the server and send the right requests.
	* main.c (cmds): Add these commands.
	(main): Remove code which would strip hostname off cvsroot and try
	the command locally.  There are no longer any commands which are
	not supported.
	* client.c, client.h (client_rdiff, client_tag, client_rtag,
	client_import, client_admin, client_export, client_history,
	client_release): New functions.
	* server.c (serve_rdiff, serve_tag, serve_rtag, serve_import,
	serve_admin, serve_export, serve_history, serve_release): New
	functions.
	(requests): List them.
	* server.c: Declare cvs commands (add, admin, etc.).
	* cvs.h, server.h: Don't declare any of them here.
	* main.c: Restore declarations of cvs commands which were
	previously removed.

	* cvs.h: New define DEATH_STATE, commented out for now.
	* rcs.c (RCS_parsercsfile_i), commit.c (remove_file, checkaddfile)
	[DEATH_STATE]: Use RCS state to record a dead file.

Mon Oct  3 09:44:54 1994  Jim Kingdon  (kingdon@@lioth.cygnus.com)

	* status.c (status_fileproc): Now that ts_rcs is just one time,
	don't try to print the second time from it.  (Same as raeburn 20
	Aug change, it accidentally got lost in 1.4 Alpha-1 merge).

	* cvs.h (CVSDEA): Added (but commented out for now).
	* rcs.c (RCS_parsercsfile_i) [CVSDEA]: Also look in CVSDEA to see if
	something is dead.
	* commit.c (ci_new_rev, mark_file) [CVSDEA]: New functions.
	(remove_file, checkaddfile) [CVSDEA]: Use them instead of ci -K.
	* find_names.c (find_dirs) [CVSDEA]: Don't match CVSDEA directories.
	* update.c (checkout_file): Check RCS_isdead rather than relying
	on co to not create the file.

	* sanity.sh: Direct output to logfile, not /dev/null.

	* subr.c (run_exec): Print error message if we are unable to exec.

	* commit.c (remove_file): Call Scratch_Entry when removing tag
	from file.  The DEATH_SUPPORT ifdef was erroneous.

Sun Oct  2 20:33:27 1994  Jim Kingdon  (kingdon@@lioth.cygnus.com)

	* commit.c (checkaddfile): Instead of calling isdir before
	attempting to create the directory, just ignore EEXIST errors from
	mkdir.  (This removes some DEATH_SUPPORT ifdefs which actually had
	nothing to do with death support).

Thu Sep 29 09:23:57 1994  Jim Kingdon  (kingdon@@lioth.cygnus.com)

	* diff.c (diff): Search attic too if we have a second tag/date.
	(diff_fileproc): If we have a second tag/date, don't do all the
	checking regarding the user file.

Mon Sep 26 12:02:15 1994  Jim Kingdon  (kingdon@@lioth.cygnus.com)

	* checkin.c (Checkin): Check for error from unlink_file.

Mon Sep 26 08:51:10 1994  Anthony J. Lill  (ajlill@@ajlc.waterloo.on.ca)

	* rcs.c (getrcskey): Allocate space for terminating '\0' if
	necessary.

Sat Sep 24 09:07:37 1994  Jim Kingdon  (kingdon@@lioth.cygnus.com)

	* commit.c (commit_fileproc): Set got_message = 1 when calling
	do_editor (accidentally omitted from last change).

Fri Sep 23 11:59:25 1994  Jim Kingdon  (kingdon@@lioth.cygnus.com)

	Revert buggy parts of Rich's change of 1 Nov 1993 (keeping the
	dynamic buffer allocation, which was the point of that change).
	* logmsg.c (do_editor): Reinstate message arg, but make it char
	**messagep instead of char *message.  Change occurances of message
	to *messagep.  Char return type from char * back to void.
	* cvs.h: Change do_editor declaration.
	* commit.c: Reinstate got_message variable
	(commit_filesdoneproc, commit_fileproc, commit_direntproc): Use it.
	* import.c (import), commit.c (commit_fileproc,
	commit_direntproc): Pass &message to do_editor; don't expect it to
	return a value.
	* client.c (client_commit): Likewise.
	* import.c (import): Deal with it if message is NULL.

Wed Sep 21 09:43:25 1994  Jim Kingdon  (kingdon@@lioth.cygnus.com)

	* server.c (server_updated): If the file doesn't exist, skip it.

	* diff.c, client.h, client.c: Rename diff_client_senddate to
	client_senddate and move from diff.c to client.c.
	* client.c (client_update, client_checkout): Use it.

Sat Sep 17 08:36:58 1994  Jim Kingdon  (kingdon@@lioth.cygnus.com)

	* checkout.c (checkout_proc): Don't pass NULL to Register for
	version.  (should fix "cvs co -r <nonexistent-tag> <file>"
	coredump on Solaris).

Fri Sep 16 08:38:02 1994  Jim Kingdon  (kingdon@@lioth.cygnus.com)

	* diff.c (diff_fileproc): Set top_rev from vn_user, not vn_rcs.
	Rename it to user_file_rev because it need not be the head of any
	branch.
	(diff_file_nodiff): After checking user_file_rev, if we have both
	use_rev1 and use_rev2, compare them instead of going on to code
	which assumes use_rev2 == NULL.

Thu Sep 15 08:20:23 1994  Jim Kingdon  (kingdon@@lioth.cygnus.com)

	* status.c (status): Return a value in client_active case.

Thu Sep 15 15:02:12 1994  Ian Lance Taylor  (ian@@sanguine.cygnus.com)

	* server.c (serve_modified): Create the file even if the size is
	zero.

Thu Sep 15 08:20:23 1994  Jim Kingdon  (kingdon@@lioth.cygnus.com)

	* lock.c (readers_exist): Clear errno each time around the loop,
	not just the first time.

	* client.c (start_server): Don't send Global_option -q twice.

	* no_diff.c (No_Difference): Check for error from unlink.

	* no_diff.c, cvs.h (No_Difference): New args repository,
	update_dir.  Call server_update_entries if needed.  Use update_dir
	in error message.
	* classify.c (Classify_File): Pass new args to No_Difference.

	* server.c (server_update_entries, server_checked_in,
	server_updated): Don't do anything if noexec.

	* client.c (send_fileproc): Rather than guessing how big the gzip
	output may be, just realloc the buffer as needed.

Tue Sep 13 13:22:03 1994  Jim Kingdon  (kingdon@@lioth.cygnus.com)

	* lock.c: Check for errors from unlink, readdir, and closedir.

	* classify.c (Classify_File): Pass repository and update_dir to
	sticky_ck.
	(sticky_ck): New args repository and update_dir.
	* server.c, server.h (server_update_entries): New function.
	* classify.c (sticky_ck): Call it.
	* client.c: New response "New-entry".
	* client.c (send_fileproc): Send tag/date from vers->entdata, not
	from vers itself.

Mon Sep 12 07:07:05 1994  Jim Kingdon  (kingdon@@lioth.cygnus.com)

	* server.c: Clean up formatting ("=  (errno)" -> "= errno").

	* cvs.h: Declare strerror.

	* client.c: Add code to deal with Set-sticky and Clear-sticky
	responses, and Sticky request.
	* server.c: Add code to deal with Sticky request.
	* server.c, server.h (server_set_sticky): New function.
	* create_adm.c (Create_Admin), update.c (update, update_dirent_proc),
	commit.c (commit_dirleaveproc): Call it.
	* client.c, client.h (send_files): Add parameter aflag.
	* add.c (add), diff.c (diff), log.c (cvslog), remove.c (cvsremove),
	status.c (status),
	client.c (client_commit, client_update, client_checkout): Pass it.
	* client.c (client_update): Add -A flag.

Fri Sep  9 07:05:35 1994  Jim Kingdon  (kingdon@@lioth.cygnus.com)

	* entries.c (WriteTag): Check for error from unlink_file.

	* server.c (server_updated): Initialize size to 0.  Previously if
	the file was zero length, the variable size got used without being
	set.

Thu Sep  8 14:23:05 1994  Jim Kingdon  (kingdon@@lioth.cygnus.com)

	* server.c (serve_repository): Check for error from fopen on
	CVSADM_ENT.

	* update.c (update, update_dirent_proc): Check for errors when
	removing Entries.Static.

	* client.c: Add code to deal with Set-static-directory and
	Clear-static-directory responses, and Static-directory request.
	* server.c, server.h (server_clear_entstat, server_set_entstat):
	New functions.
	* update.c, checkout.c, modules.c: Call them.
	* server.c: Add code to deal with Static-directory request.

	* server.c, client.c: Use strchr and strrchr instead of index and
	rindex.

	* server.c (serve_unchanged, serve_lost): Change comments which
	referred to changing timestamp; we don't always change the
	timestamp in those cases anymore.

Wed Sep  7 10:58:12 1994  J.T. Conklin  (jtc@@rtl.cygnus.com)

	* cvsrc.c (read_cvsrc): Don't call getenv() three times when one
	  time will do.

	* subr.c (xmalloc, xrealloc): Change type of bytes argument from
	  int to size_t and remove the test that checks if it is less than
	  zero.
	* cvs.h (xmalloc, xrealloc): Update prototype.

Thu Sep  1 12:22:20 1994  Jim Kingdon  (kingdon@@cygnus.com)

	* update.c (merge_file, join_file): Pass -E to rcsmerge.
	(merge_file): If rcsmerge doesn't change the file, say so.

	* recurse.c, cvs.h (start_recursion): New argument wd_is_repos.
	* recurse.c (start_recursion): Use it instead of checking whether
	command_name is rtag to find out if we are cd'd to the repository.
	* client.c, update.c, commit.c, status.c, diff.c, log.c, admin.c,
	remove.c, tag.c: Pass 0 for wd_is_repos.
	* rtag.c, patch.c: Pass 1 for wd_is_repos.

	* classify.c, cvs.h (Classify_File): New argument pipeout.
	* classify.c (Classify_File): If pipeout, don't complain if the
	file is already there.
	* update.c, commit.c, status.c: Change callers.

	* mkmodules.c (main): Don't print "reminders" if commitinfo,
	loginfo, rcsinfo, or editinfo files are missing.

Mon Aug 22 23:22:59 1994  Ken Raeburn  (raeburn@@kr-pc.cygnus.com)

	* server.c (strerror): Static definition replaced by extern
	declaration.

Sun Aug 21 07:16:27 1994  Ken Raeburn  (raeburn@@kr-pc.cygnus.com)

	* client.c (update_entries): Run "patch" with input from
	/dev/null, so if it's the wrong version, it fails quickly rather
	than waiting for EOF from terminal before failing.

Sat Aug 20 04:16:33 1994  Ken Raeburn  (raeburn@@cujo.cygnus.com)

	* server.c (serve_unchanged): Instead of creating a file with a
	zero timestamp, rewrite the entries file to have "=" in the
	timestamp field.
	* vers_ts.c (mark_lost, mark_unchanged): New macros.
	(time_stamp_server): Use them, for clarity.  Interpret "="
	timestamp as an unchanged file.  A zero-timestamp file should
	never be encountered now in use_unchanged mode.

	* client.c (start_server): If CVS_CLIENT_PORT indicates a
	non-positive port number, skip straight to rsh connection.

	* status.c (status_fileproc): Fix ts_rcs reference when printing
	version info, to correspond to new Entries file format.  Don't
	print it at all if server_active, because it won't have any useful
	data.

Thu Aug 18 14:38:21 1994  Ken Raeburn  (raeburn@@cujo.cygnus.com)

	* cvs.h (status): Declare.
	* client.c (client_status): New function.

	* client.h (client_status): Declare.
	* main.c (cmds): Include it.
	* server.c (serve_status): New function.
	(requests): Add it.
	* status.c (status): Do the remote thing if client_active.

	* client.c (supported_request): New function.
	(start_server): Use it.

	* server.c (receive_partial_file): New function, broken out from
	serve_modified.  Operate with fixed-size local buffer, instead of
	growing stack frame by entire file size.
	(receive_file): New function, broken out from serve_modified.
	(serve_modified): Call it.
	(server): Print out name of unrecognized request.

	More generic stream-filtering support:
	* client.c (close_on_exec, filter_stream_through_program): New
	functions.
	(server_fd): New variable.
	(get_responses_and_close): Direct non-rsh connection is now
	indicated by server_fd being non-negative.  File descriptors for
	to_server and from_server may now be different in case "tee"
	filtering is being done.  Wait for rsh_pid specifically.
	(start_server): Use filter_stream_through_program for "tee"
	filter, and enable it for direct Kerberos-authenticated
	connections.  Use dup to create new file descriptors for server
	connection if logging is enabled.
	(start_rsh_server): Disable code that deals with logging.

	Per-file compression support:
	* cvs.h (gzip_level): Declare.
	* main.c (usg): Describe new -z argument.
	(main): Recognize it and set gzip_level.
	* client.c (filter_through_gzip, filter_through_gunzip): New
	functions to handle compression.
	(update_entries): If size starts with "z", uncompress
	(start_server): If gzip_level is non-zero and server supports it,
	issue gzip-file-contents request.
	(send_fileproc): Optionally compress file contents.  Use a
	slightly larger buffer, anticipating the worst case.
	* server.c (gzip_level): Define here.
	(receive_file): Uncompress file contents if needed.
	(serve_modified): Recognize "z" in file size and pass receive_file
	appropriate flag.
	(buf_read_file_to_eof, buf_chain_length): New functions.
	(server_updated): Call them when sending a compressed file.
	(serve_gzip_contents): New function; set gzip_level.
	(requests): Added gzip-file-contents request.

Wed Aug 17 09:37:44 1994  J.T. Conklin  (jtc@@cygnus.com)

	* find_names.c (find_dirs): Use 4.4BSD filesystem feature (it
	  contains the file type in the dirent structure) to avoid
	  stat'ing each file.

	* commit.c (remove_file,checkaddfile): Change type of umask
	  variables from int to mode_t.
	* subr.c (): Likewise.

Tue Aug 16 19:56:34 1994  Mark Eichin  (eichin@@cygnus.com)

	* diff.c (diff_fileproc): Don't use diff_rev* because they're
	invariant across calls -- add new variable top_rev.
	(diff_file_nodiff): After checking possible use_rev* values, if
	top_rev is set drop it in as well (if we don't already have two
	versions) and then clear it for next time around.

Wed Aug 10 20:50:47 1994  Mark Eichin  (eichin@@cygnus.com)

	* diff.c (diff_fileproc): if ts_user and ts_rcs match, then the
	file is at the top of the tree -- so we might not even have a
	copy. Put the revision into diff_rev1 or diff_rev2.

Wed Aug 10 14:55:38 1994  Ken Raeburn  (raeburn@@cujo.cygnus.com)

	* server.c (do_cvs_command): Use waitpid.

	* subr.c (run_exec): Always use waitpid.

	* Makefile.in (CC, LIBS): Define here, in case "make" is run in
	this directory instead of top level.

Wed Aug 10 13:57:06 1994  Mark Eichin  (eichin@@cygnus.com)

	* client.c (krb_get_err_text): use HAVE_KRB_GET_ERR_TEXT to
	determine if we need to use the array or the function.
	* main.c: ditto.

Tue Aug  9 16:43:30 1994  Ken Raeburn  (raeburn@@cujo.cygnus.com)

	* entries.c (ParseEntries): If timestamp is in old format, rebuild
	it in the new format.  Fudge an unmatchable entry that won't
	trigger this code next time around, if the file is modified.

	* vers_ts.c (time_stamp): Only put st_mtime field into timestamp,
	and use GMT time for it.  With st_ctime or in local time, copying
	trees between machines in different time zones makes all the files
	look modified.
	(time_stamp_server): Likewise.

Tue Aug  9 19:40:51 1994  Mark Eichin  (eichin@@cygnus.com)

	* main.c (main): use krb_get_err_text function instead of
	krb_err_txt array.

Thu Aug  4 15:37:50 1994  Ian Lance Taylor  (ian@@sanguine.cygnus.com)

	* main.c (main): When invoked as kserver, set LOGNAME and USER
	environment variables to the remote user name.

Thu Aug  4 07:44:37 1994  Mark Eichin  (eichin@@cygnus.com)

	* client.c: (handle_valid_requests): if we get an option that has
	rq_enableme set, then send that option. If it is UseUnchanged, set
	use_unchanged so that the rest of the client knows about
	it. (Could become a more general method for dealing with protocol
	upgrades.)
	(send_fileproc): if use_unchanged didn't get set, send an
	old-style "Lost" request, otherwise send an "Unchanged" request.
	* server.c (serve_unchanged): new function, same as serve_lost,
	but used in the opposite case.
	(requests): add new UseUnchanged and Unchanged requests, and make
	"Lost" optional (there isn't a good way to interlock these.)
	* server.h (request.status): rq_enableme, new value for detecting
	compatibility changes.
	* vers_ts.c (time_stamp_server): swap meaning of zero timestamp if
	use_unchanged is set.

Tue Jul 26 10:19:30 1994  Jim Kingdon  (kingdon@@lioth.cygnus.com)

	* sanity.sh: Separate CVSROOT_FILENAME, which must be the filename
	of the root, from CVSROOT, which can include a hostname for
	testing remote CVS.  (but the tests aren't yet prepared to deal
	with the bugs in remote CVS).

	* import.c (update_rcs_file): Change temporary file name in TMPDIR
	from FILE_HOLDER to cvs-imp<process-id>.

	* sanity.sh: Add ">/dev/null" and "2>/dev/null" many places to
	suppress spurious output.  Comment out tests which don't work (cvs
	add on top-level directory, cvs diff when non-committed adds or
	removes have been made, cvs release, test 53 (already commented as
	broken), retagging without deleting old tag, test 63).  Now 'make
	check' runs without any failures.

Fri Jul 15 12:58:29 1994  Ian Lance Taylor  (ian@@sanguine.cygnus.com)

	* Makefile.in (install): Do not depend upon installdirs.

Thu Jul 14 15:49:42 1994  Ian Lance Taylor  (ian@@sanguine.cygnus.com)

	* client.c, server.c: Don't try to handle alloca here; it's
	handled by cvs.h.

Tue Jul 12 13:32:40 1994  Ian Lance Taylor  (ian@@sanguine.cygnus.com)

	* client.c (update_entries): Reset stored_checksum_valid if we
	quit early because of a patch failure.

Fri Jul  8 11:13:05 1994  Ian Lance Taylor  (ian@@sanguine.cygnus.com)

	* client.c (responses): Mark "Remove-entry" as optional.

Thu Jul  7 14:07:58 1994  Ian Lance Taylor  (ian@@sanguine.cygnus.com)

	* server.c (server_updated): Add new checksum argument.  If it is
	not NULL, and the client supports the "Checksum" response, send
	it.
	* server.h (server_updated): Update prototype.
	* update.c: Include md5.h.
	(update_file_proc): Pass new arguments to patch_file and
	server_updated.
	(patch_file): Add new checksum argument.  Set it to the MD5
	checksum of the version of the file being checked out.
	(merge_file): Pass new argument to server_updated.
	* client.c: Include md5.h.
	(stored_checksum_valid, stored_checksum): New static variables.
	(handle_checksum): New static function.
	(update_entries): If a checksum was received, check it against the
	MD5 checksum of the final file.
	(responses): Add "Checksum".
	(start_server): Clear stored_checksum_valid.
	* commit.c (commit_fileproc): Pass new argument to server_updated.

	* client.h (struct response): Move definition in from client.c,
	add status field.
	(responses): Declare.
	* client.c (struct response): Remove definition; moved to
	client.h.
	(responses): Make non-static.  Initialize status field.
	* server.c (serve_valid_responses): Check and record valid
	responses, just as in handle_valid_requests in client.c.

	* diff.c (diff_client_senddate): New function.
	(diff): Use it to send -D arguments to server.

Wed Jul  6 12:52:37 1994  J.T. Conklin  (jtc@@phishhead.cygnus.com)

	* rcs.c (RCS_parsercsfile_i): New function, parse RCS file
	referenced by file ptr argument.
	(RCS_parsercsfile): Open file and pass its file ptr to above function.
	(RCS_parse): Likewise.

Wed Jul  6 01:25:38 1994  Ian Lance Taylor  (ian@@tweedledumb.cygnus.com)

	* client.c (update_entries): Print message indicating that an
	unpatchable file will be refetched.
	(client_update): Print message when refetching unpatchable files.

Fri Jul  1 07:16:29 1994  Jim Kingdon  (kingdon@@lioth.cygnus.com)

	* client.c (send_dirent_proc): Don't call send_a_repository if
	repository is "".

Fri Jul  1 13:58:11 1994  Ian Lance Taylor  (ian@@sanguine.cygnus.com)

	* client.c (last_dirname, last_repos): Move out of function.
	(failed_patches, failed_patches_count): New static variables.
	(update_entries): If patch program fails, save short_pathname in
	failed_patches array, only exit program if retcode is -1, and
	return out of the function rather than update the Entries line.
	(start_server): Clear toplevel_repos, last_dirname, last_repos.
	(client_update): If failed_patches is not NULL after doing first
	update, do another update, but remove all the failed files first.

Thu Jun 30 09:08:57 1994  Jim Kingdon  (kingdon@@lioth.cygnus.com)

	* server.c (requests): Add request "Global_option".
	(serve_global_option): New function, to handle it.
	* client.c (start_server): Deal with global options.  Check for
	errors from fprintf.

	* client.c (send_fileproc): Split out code which sends repository
	into new function send_a_repository.  Also, deal with update_dir
	being ".".
	(send_dirent_proc): Call send_a_repository.
	* add.c (add): If client_active, do special processing for
	directories.
	(add_directory): If server_active, don't try to create CVSADM
	directory.

Thu Jun 30 11:58:52 1994  Ian Lance Taylor  (ian@@sanguine.cygnus.com)

	* client.c (update_entries): If patch succeeds, remove the backup
	file.
	* server.c (server_updated): Add new argument file_info.  If it is
	not NULL, use it rather than sb to get the file mode.
	* server.h (server_updated): Update prototype for new argument.
	* update.c (update_file_proc): Pass new arguments to patch_file
	and server_updated.
	(patch_file): Add new argument file_info.  Don't use -p to check
	out new version, check it out into file and rename that to file2.
	If result is not readable, assume file is dead and set docheckout.
	Call xchmod on file2.  Close the patch file after checking for a
	binary diff.  Set file_info to the results of stat on file2.
	(merge_file): Pass new argument to server_updated.
	* commit.c (commit_fileproc): Pass new argument to server_updated.

Wed Jun 29 13:00:41 1994  Ian Lance Taylor  (ian@@sanguine.cygnus.com)

	* client.c (krb_realmofhost): Declare, since it's not the current
	<krb.h>.
	(start_server): Save the name returned by gethostbyname.  Call
	krb_realmofhost to get the realm.  Pass the resulting realm to
	krb_sendauth.  Pass the saved real name to krb_sendauth, rather
	than server_host.

	* update.c (update_file_proc): Pass &docheckout to patch_file.  If
	it is set to 1, fall through to T_CHECKOUT case.
	(patch_file): Add docheckout argument.  Set it to 1 if we can't
	make a patch.  Check out the files and run diff rather than
	rcsdiff.  If either file does not end in a newline, we can't make
	a patch.  If the patch starts with the string "Binary", assume
	one or the other is a binary file, and that we can't make a patch.

Tue Jun 28 11:57:29 1994  Ian Lance Taylor  (ian@@sanguine.cygnus.com)

	* client.c (update_entries): If the patch file is empty, don't run
	patch program; avoids error message.

	* classify.c (Classify_File): Return T_CHECKOUT, not T_PATCH, if
	the file is in the Attic.

	* cvs.h (enum classify_type): Add T_PATCH.
	* config.h (PATCH_PROGRAM): Define.
	* classify.c (Classify_File): If user file exists and is not
	modified, and using the same -k options, return T_PATCH instead of
	T_CHECKOUT.
	* update.c (patches): New static variable.
	(update): Add u to gnu_getopt argument.  Handle it.
	(update_file_proc): Handle T_PATCH.
	(patch_file): New static function.
	* server.h (enum server_updated_arg4): Add SERVER_PATCHED.
	* server.c (server_updated): Handle SERVER_PATCHED by sending
	"Patched" command.
	(serve_ignore): New static function.
	(requests): Add "update-patches".
	(client_update): If the server supports "update-patches", send -u.
	* client.c (struct update_entries_data): Change contents field
	from int to an unnamed enum.
	(update_entries): Correponding change.  If contents is
	UPDATE_ENTRIES_PATCH, pass the input to the patch program.
	(handle_checked_in): Initialize contents to enum value, not int.
	(handle_updated, handle_merged): Likewise.
	(handle_patched): New static function.
	(responses): Add "Patched".
	* commit.c (check_fileproc): Handle T_PATCH.
	* status.c (status_fileproc): Likewise.

	* client.c (start_server): If CVS_CLIENT_PORT is set in the
	environment, connect to that port, rather than looking up "cvs" in
	/etc/services.  For debugging.

Tue Jun 21 12:48:16 1994  Ken Raeburn  (raeburn@@cujo.cygnus.com)

	* update.c (joining): Return result of comparing pointer with
	NULL, not result of casting (truncating, on Alpha) pointer to int.

	* main.c (main) [HAVE_KERBEROS]: Impose a umask if starting as
	Kerberos server, so temp directories won't be world-writeable.

	* update.c (update_filesdone_proc) [CVSADM_ROOT]: If environment
	variable CVS_IGNORE_REMOTE_ROOT is set and repository is remote,
	don't create CVS/Root file.
	* main.c (main): If env var CVS_IGNORE_REMOTE_ROOT is set, don't
	check CVS/Root.

Fri Jun 10 18:48:32 1994  Mark Eichin  (eichin@@cygnus.com)

	* server.c (O_NDELAY): use POSIX O_NONBLOCK by default, unless it
	isn't available (in which case substitute O_NDELAY.)

Thu Jun  9 19:17:44 1994  Mark Eichin  (eichin@@cygnus.com)

	* server.c (server_cleanup): chdir out of server_temp_dir before
	deleting it (so that it works on non-BSD systems.) Code for choice
	of directory cloned from server().

Fri May 27 18:16:01 1994  Ian Lance Taylor  (ian@@tweedledumb.cygnus.com)

	* client.c (update_entries): Add return type of void.
	(get_responses_and_close): If using Kerberos and from_server and
	to_server are using the same file descriptor, use shutdown, not
	fclose.  Close from_server.
	(start_server): New function; most of old version renamed to
	start_rsh_server.
	(start_rsh_server): Mostly renamed from old start_server.
	(send_fileproc): Use %lu and cast sb.st_size in fprintf call.
	(send_files): Remove unused variables repos and i.
	(option_no_arg): Comment out; unused.
	* main.c (main): Initialize cvs_update_env to 0.  If command is
	"kserver", authenticate and change command to "server".  If
	command is "server", don't call Name_Root, don't check access to
	history file, and don't assume that CVSroot is not NULL.
	* server.c (my_memmove): Removed.
	(strerror): Change check from STRERROR_MISSING to HAVE_STRERROR.
	(serve_root): Likewise for putenv.
	(serve_modified): Initialize buf to NULL.
	(struct output_buffer, buf_try_send): Remove old buffering code.
	(struct buffer, struct buffer_data, BUFFER_DATA_SIZE,
	allocate_buffer_datas, get_buffer_data, buf_empty_p,
	buf_append_char, buf_append_data, buf_read_file, buf_input_data,
	buf_copy_lines): New buffering code.
	(buf_output, buf_output0, buf_send_output, set_nonblock,
	set_block, buf_send_counted, buf_copy_counted): Rewrite for new
	buffering code.
	(protocol, protocol_memory_error, outbuf_memory_error,
	do_cvs_command, server_updated): Rewrite for new buffering code.
	(input_memory_error): New function.
	(server): Put Rcsbin at start of PATH in environment.
	* Makefile.in: Add @@includeopt@@ to DEFS.

Fri May 20 08:13:10 1994  Jim Kingdon  (kingdon@@lioth.cygnus.com)

	* cvs.h, classify.c (Classify_File): New argument update_dir.
	Include it in user messages.
	* commit.c (check_fileproc), status.c (status_fileproc), update.c
	(update_file_proc): Pass update_dir to Classify_File.
	* commit.c (check_fileproc), update.c (checkout_file):
	Include update_dir in user messages.
	* commit.c (check_fileproc) update.c (update_file_proc): Re-word
	"unknown status" message.

	* server.c (server_checked_in): Deal with the case where
	scratched_file is set rather than entries_line.

	* entries.c (Register): Write file even if server_active.
	* add.c (add): Add comment about how we depend on above behavior.

Tue May 17 08:16:42 1994  Jim Kingdon  (kingdon@@lioth.cygnus.com)

	* mkmodules.c: Add dummy server_active and server_cleanup, to go
	with the dummy Lock_Cleanup already there.

	* server.c (server_cleanup): No longer static.

Sat May  7 10:17:17 1994  Jim Kingdon  (kingdon@@lioth.cygnus.com)

	Deal with add and remove:
	* commit.c (checkaddfile): If CVSEXT_OPT or CVSEXT_LOG file does
	not exist, just	silently keep going.
	(remove_file): If server_active, remove file before creating
	temporary file with that name.
	* server.c (serve_remove, serve_add): New functions.
	(requests): Add them.
	* server.c (server_register): If options is NULL, it means there
	are no options.
	* server.c, server.h (server_scratch_entry_only): New function.
	New variable kill_scratched_file.
	(server_scratch, server_updated): Deal with kill_scratched_file.
	* commit.c (commit_fileproc): If server_active, call
	server_scratch_entry_only and server_updated.
	* add.c (add): Add client_active code.
	(add): If server_active, call server_checked_in for each file added.
	* remove.c (remove): Add client_active code.
	(remove_fileproc): If server_active, call server_checked_in.
	* main.c (cmds), client.c, client.h: New functions client_add and
	client_remove.
	* Move declarations of add, cvsremove, diff, and cvslog from
	main.c to cvs.h.
	* client.c (call_in_directory): Update comment regarding Root and
	Repository files.
	(send_fileproc): Only send Entries line if Version_TS really finds
	an entry.  If it doesn't find one, send Modified.
	(update_entries): If version is empty or starts with 0 or -,
	create a dummy timestamp.

Thu May  5 19:02:51 1994  Per Bothner  (bothner@@kalessin.cygnus.com)

	* recurse/c (start_recursion):  If we're doing rtag, and thus
	have cd'd to the reporsitory, add ,v to a file name before stat'ing.

Wed Apr 20 15:01:45 1994  Ian Lance Taylor  (ian@@tweedledumb.cygnus.com)

	* client.c (client_commit): Call ign_setup.
	(client_update, client_checkout): Likewise.
	* diff.c (diff): If client, call ign_setup.
	* log.c (cvslog): Likewise.
	* update.h (ignlist): Change definition to declaration to avoid
	depending upon common semantics (not required by ANSI C, and not
	the default on Irix 5).
	* update.c (ignlist): Define.

Tue Apr 19 00:02:54 1994  John Gilmore  (gnu@@cygnus.com)

	Add support for remote `cvs log'; clean up `cvs diff' a bit.

	* client.c (send_arg):  Make external.
	(send_option_string): New function.
	(client_diff_usage):  Remove, unused.
	(client_diff):  Just call diff, not do_diff.
	(client_log):  Add.
	* client.h (client_log, send_arg, send_option_string):  Declare.
	* cvs.h (cvslog):  Declare.
	* diff.c (do_diff):  Fold back into diff(), distinguish by checking
	client_active.
	(diff):  Remove `-*' arg parsing crud; use send_option_string.
	* log.c (cvslog):  If a client, start the server, pass options
	and files, and handle server responses.
	* main.c (cmds):  Add client_log.
	(main):  Remove obnoxious message every time CVS/Root is used.
	Now CVS will be quiet about it -- unless there is a conflict
	between $CVSROOT or -d value versus CVS/Root.
	* server.c (serve_log):  Add.
	(requests):  Add "log".

Mon Apr 18 22:07:53 1994  John Gilmore  (gnu@@cygnus.com)

	Add support for remote `cvs diff'.

	* diff.c (diff):  Break guts out into new fn do_diff.
	Add code to handle starting server, writing args,
	sending files, and retrieving responses.
	(includes): Use PARAMS for static function declarations.
	* client.c (to_server, from_server, rsh_pid,
	get_responses_and_close, start_server, send_files,
	option_with_arg):  Make external.
	(send_file_names):  New function.
	(client_diff):  New function.
	* client.h (client_diff, to_server, from_server,
	rsh_pid, option_with_arg, get_responses_and_close, start_server,
	send_file_names, send_files):  Declare.
	* cvs.h (diff):  Declare.
	* main.c (cmds):  Add client_diff to command table.
	* server.c (serve_diff):  New function.
	(requests):  Add serve_diff.
	(server):  Bug fix: avoid free()ing incremented cmd pointer.
	* update.h (update_filesdone_proc):  Declare with PARAMS.

Sat Apr 16 04:20:09 1994  John Gilmore  (gnu@@cygnus.com)

	* root.c (Name_root):  Fix tyop (CVSroot when root meant).

Sat Apr 16 03:49:36 1994  John Gilmore  (gnu@@cygnus.com)

	Clean up remote `cvs update' to properly handle ignored
	files (and files that CVS can't identify), and to create
	CVS/Root entries on the client side, not the server side.

	* client.c (send_fileproc):  Handle the ignore list.
	(send_dirent_proc):  New function for handling ignores.
	(send_files):  Use update_filesdone_proc and send_dirent_proc
	while recursing through the local filesystem.
	* update.h:  New file.
	* update.c:  Move a few things into update.h so that client.c
	can use them.

Fri Mar 11 13:13:20 1994  Ian Lance Taylor  (ian@@tweedledumb.cygnus.com)

	* server.c: If O_NDELAY is not defined, but O_NONBLOCK is, define
	O_NDELAY to O_NONBLOCK.

Wed Mar  9 21:08:30 1994  Jim Kingdon  (kingdon@@lioth.cygnus.com)

	Fix some spurious remote CVS errors caused by the CVS/Root patches:
	* update.c (update_filesdone_proc): If server_active, don't try to
	create CVS/Root.
	* root.c (Name_Root): Make error messages which happen if root is
	not an absolute pathname or if it doesn't exist a bit clearer.
	Skip them if root contains a colon.

Mon Nov  1 15:54:51 1993  K. Richard Pixley  (rich@@sendai.cygnus.com)

	* client.c (client_commit): dynamically allocate message.

Tue Jun  1 17:03:05 1993  david d `zoo' zuhn  (zoo at cirdan.cygnus.com)

	* server.h: remove alloca cruft

	* server.c: replace with better alloca cruft

Mon May 24 11:25:11 1993  Jim Kingdon  (kingdon@@lioth.cygnus.com)

	* entries.c (Scratch_Entry):  Update our local Entries file even if
	server_active.

	* server.c (server_scratch, server_register): If both Register
	and Scratch_Entry happen, use whichever one happened later.
	If neither happen, silently continue.

	* client.c (client_checkout): Initialize tag and date (eichin and
	I independently discovered this bug at the same time).

Wed May 19 10:11:51 1993  Mark Eichin (eichin@@cygnus.com)

	* client.c (update_entries): handle short reads over the net
	(SVR4 fread is known to be broken, specifically for short
	reads off of streams.)

Tue May 18 15:53:44 1993  Jim Kingdon  (kingdon@@lioth.cygnus.com)

	* server.c (do_cvs_command): Fix fencepost error in setting
	num_to_check.

	* server.c (do_cvs_command): If terminated with a core dump, print
	message and set dont_delete_temp.
	(server_cleanup): If dont_delete_temp, don't delete it.

	* client.c (get_server_responses): Don't change cmd since we
	are going to "free (cmd)".

	* server.c: Rename memmove to my_memmove pending a real fix.

	* server.c (do_cvs_command): Set num_to_check to largest descriptor
	we try to use, rather than using (non-portable) getdtablesize.

Wed May 12 15:31:40 1993  Jim Kingdon  (kingdon@@lioth.cygnus.com)

	Add CVS client feature:
	* client.{c,h}: New files.
	* cvs.h: Include client.h.
	* main.c: If CVSROOT has a colon, use client commands instead.
	* vers_ts.c (Version_TS): If repository arg is NULL, don't worry
	about the repository.
	* logmsg.c (do_editor): If repository or changes is NULL, just don't
	use those features.
	* create_adm.c (Create_Admin), callers:  Move the test for whether
	the repository exists from here to callers.
	* repos.c (Name_Repository): Don't test whether the repository exists
	if client_active set (might be better to move test to callers).

	Add CVS server feature:
	* server.{c,h}: New files.
	* cvs.h: Include server.h.
	* checkin.c (Checkin): Call server_checked_in.
	* update.c (update_file_proc, merge_files): Call server_updated.
	* entries.c (Register): Call server_register.
	(Scratch_Entry): Call server_scratch.
	* main.c: Add server to cmds.
	* vers_ts.c (Version_TS): If server_active, call new function
	time_stamp_server to set ts_user.

@


1.1.1.1
log
@raw import of cvs-1.6
@
text
@@


1.1.1.2
log
@Upgrade to 1.7.1 snapshot
@
text
@a0 1607
Sun Jan 28 09:45:53 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* edit.c, edit.h (mark_up_to_date): New function, to remove file
	in CVS/Base.
	* client.c (update_entries): Call it if file is up to date.
	* checkin.c (Checkin): Call it in non-server (local) case.
	* sanity.sh: New test 182.5, tests for above-fixed bug.

Sun Jan 28 01:07:22 1996  Jim Kingdon  (kingdon@@beezley)

	* client.c (change_mode): Separate out CHMOD_BROKEN code to parse
	mode_string, rather than going through a mode_t.  Cleaner than
	the previous CHMOD_BROKEN code (which also had a typo of && not &).

Sat Jan 27 23:29:46 1996  Jim Kingdon  (kingdon@@beezley)

	* edit.c (edit_fileproc): Check for EACCESS as well as EEXIST.

Sat Jan 27 16:26:30 1996  Karl Fogel  (kfogel@@floss.cyclic.com)

        * client.c (notified_a_file): use rename_file() instead of
        rename() (but temporarily set `noexec' to 0 so it runs
        unconditionally).
        (change_mode): deal with CHMOD_BROKEN.        

Fri Jan 26 00:14:00 1996  Karl Fogel  <kfogel@@floss.red-bean.com>

        * server.c: renamed `dirname' to `dir_name', to avoid conflicts
        with system headers.

        * client.c: renamed `dirname' and `last_dirname' to `dir_name' and
        last_dir_name' (see above).  Not strictly necessary, but
        consistency is nice -- as long as you do it all the time.

Thu Jan 25 00:41:59 1996  Karl Fogel  <kfogel@@floss.red-bean.com>

        * options.h.in (AUTH_SERVER_SUPPORT, AUTH_CLIENT_SUPPORT): change
        comment now that no longer under construction.

Wed Jan 24 15:25:22 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* Version 1.7.1.

	* Version 1.7.

Sat Jan 20 00:05:08 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* Version 1.6.87.

Mon Jan 15 18:14:55 1996  Gary Oberbrunner  <garyo@@avs.com>
			  and Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* tag.c (val_direntproc):  New function to ignore
	  nonexistent dirs when recursing to check tag validity.
	  (tag_check_valid): Pass it to start_recursion.
	* sanity.sh (death): New tests 65a0-65a6 cause test 74 to test for
	above-fixed bug.

Mon Jan 15 12:55:37 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* main.c: Revert change to run getopt_long twice.  This can go in
	after 1.7.

Mon Jan 15 13:03:28 1996  Norbert Kiesel  <nk@@col.sw-ley.de>

	* filesubr.c (deep_remove_dir): added test of EEXIST for nonempty
	  directory (Posix states that both ENOTEMPTY (BSD) and EEXIST
	  (SYSV) are valid)

	* main.c (main): run getopt_long twice to allow command-line
	  suppression of reading the cvsrc file

Fri Jan 12 10:02:43 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* Version 1.6.86.

Thu Jan 11 23:28:05 1996  J.T. Conklin  <jtc@@rtl.cygnus.com>
			  and Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* fileattr.h (fileattr_startdir): Add comment about REPOS == NULL.
	* fileattr.c (fileattr_read, fileattr_write): Assert that
	fileattr_stored_repos != NULL.
	(fileattr_free): If fileattr_stored_repos is NULL, don't free it.

Thu Jan 11 18:03:21 1996  Karl Fogel  <kfogel@@floss.red-bean.com>

        * scramble.c (descramble): deal with DIAGNOSTIC better.

Thu Jan 11 12:04:42 1996  Norbert Kiesel  <nk@@col.sw-ley.de>

	* main.c: remove CVS_NOADMIN.

	* options.h.in: remove CVS_NOADMIN

Thu Jan 11 10:28:44 1996  Karl Fogel  <kfogel@@floss.red-bean.com>

        * scramble.c (descramble): make sure the string returned is safe
        to free().

Wed Jan 10 01:11:23 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* server.c (serve_notify): Cast return value from malloc.

	* edit.c (notify_do): Use struct assignment, not struct
	initialization (which SunOS4 /bin/cc doesn't have).

Tue Jan  9 09:41:29 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* Version 1.6.85.

	We use version numbers instead of patchlevels.  But there was some
	confusing patchlevel stuff lying around.  Nuke it:
	* Makefile.in (HEADERS): Remove patchlevel.h
	* patchlevel.h: Removed.
	* main.c: Don't include patchlevel.h.
	(main): Don't print patch level.

	* server.c (check_repository_password): Check for errors from
	system calls; reindent function.

Tue Jan  9 23:15:30 1996  Karl Fogel  <kfogel@@floss.red-bean.com>

        * expand_path.c: fix comments (explain expand_path()'s behavior
        correctly).

Tue Jan  9 09:41:29 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* edit.c (notify_proc): After copying in string following %s,
	don't clobber it.  Instead set up q to end of string.

	* watch.c (watch_modify_watchers), edit.c (editor_set): Fix sense
	of test in trying to decide whether attributes are changed.

	* cvs.h (CVSROOTADM_USERS): New macro.
	* edit.c (notify_do): Look up notifyee in CVSROOTADM_USERS if it
	exists.

Tue Jan  9 21:39:45 1996  Karl Fogel  <kfogel@@floss.red-bean.com>

        * expand_path.c: don't redundantly #include things that cvs.h
        already #includes (i.e., stdio.h, ctype.h, string[s].h).

Tue Jan  9 09:41:29 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* ignore.c (ign_default): Add *.obj.

	* server.c: Put /* */ around #endif comment.

Mon Jan  8 20:37:17 1996  Karl Fogel  <kfogel@@floss.red-bean.com>

        * client.c (connect_to_pserver): check return value of recv().

Mon Jan  8 11:37:57 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* client.c (connect_to_pserver): Check for error from connect;
	reindent function.

	* sanity.sh (4.75): Use dotest, so we get a PASS if test passes.

	* sanity.sh (dotest): New argument OUTPUT2.
	(188a): Use it instead of \|.

	* sanity.sh (import): Avoid using string $ followed by Id followed
	by $ in sanity.sh source, in case sanity.sh itself is under CVS.
	I hate keyword expansion.

	* sanity.sh: If expr cannot handle multiline expressions, fail and
	tell the user to get one which can.

	* release.c (release_delete): Remove unused variable retcode.

Fri Jan  5 13:30:00 1996  Jim Kingdon   <kingdon@@peary.cyclic.com>

	* release.c (release_delete): Call unlink_file_dir rather 
	than "rm -rf".

Thu Jan  4 09:58:30 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* commit.c (find_fileproc): Print "nothing known about foo" and
	return 1 if the file doesn't exist and isn't in CVS/Entries.
	(commit): If the recursion over find_fileproc returns an error,
	print "correct above errors first!" just like local CVS.
	* sanity.sh (basica): Test for above-fixed bug.

	* release.c (release): If we are the client, only unedit if the
	server supports it.

	* sanity.sh: Remove STARTANCHOR stuff; expr patterns are
	automatically anchored to the start.  ENDANCHOR remains.

	* commit.c (commit): Don't start the server until we have
	determined that there is something to commit.

Thu Jan  4 09:48:33 1996  Ben Laurie  <ben@@gonzo.ben.algroup.co.uk>
			  and Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* client.c (start_server): dup the file descriptor before
	fdopening it.

Wed Jan  3 18:25:25 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* sanity.sh: Remove tests 5, 5.5, and 5.75.  All that stuff is
	tested elsewhere.

	* ignore.c (ign_default): Change CVS* to CVS CVS.adm.  CVS* is too
	broad, especially in a case-insensitive filesystem.

	* Makefile.in (cvsbug): version.c is in srcdir.

Wed Jan  3 17:30:45 1996  Phi-Long Tran  <ptran@@autodesk.com>

	* modules.c (do_module): Honor error_use_protocol in printing trace.
	* server.c (server_register): Move check for options NULL to above
	printing of the trace.

Wed Jan  3 01:19:53 1996  Mark Immel <immel@@centerline.com>
			  and Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* update.c (checkout_file): Do not resurrect file on join if it
	doesn't contain the revisions we are joining.  Probably not a
	perfect test, but should be an improvement.
	* sanity.sh (death): New death-file4-* tests, for bug fixed above.

Wed Jan  3 01:19:53 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* add.c, admin.c, checkout.c, client.c, commit.c, diff.c, edit.c,
	history.c, import.c, log.c, patch.c, release.c, remove.c, rtag.c,
	status.c, tag.c, update.c, watch.c: In calling send_to_server,
	pass \012 not \n.  On the Mac \n is CR, not LF, and we want to
	send LF.  I didn't try to deal with whether files in CVSADM should
	contain CR or LF--in fact there is some code in client.c which
	reads \n from CVSADM files and passes it to send_to_server; it
	needs to be cleaned up one way or the other.

	* entries.c (Entries_Open): Don't try to close fpin twice.

	* client.c (update_entries): Fix typo ("strlen (filename + 10)"
	-> "strlen (filename) + 10").

	* commit.c (checkaddfile): Remove arbitrary limit.

Tue Jan  2 11:25:22 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* commit.c (commit): Only pass files which were modified, added,
	or removed to send_file_names.  This has as a side effect a
	semantic change--the up-to-date check is now skipped for other
	files--but probably a good one, or at least not a bad one.
	* sanity.sh (basica): New test; tests for bug fixed above.
	* sanity.sh (187a3): Adjust for new 'cvs commit' output.  Set up
	DOTSTAR to match arbitrary text (another GNU expr bug/misfeature,
	sigh).

	* sanity.sh: Test that the commit in test 43 actually worked.
	Merge tests basic2 and basic3 and make them independent of basic1.
	(pass,fail): Don't insert spurious space.
	(45.5): Fix typo in directory name.

Tue Jan  2 13:00:00 1996  Jim Kingdon  <kingdon@@peary.cyclic.com>

	Visual C++ lint:
	* myndbm.c: Prototype write_item.

Tue Jan  2 11:25:22 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	gcc -Wall lint:
	* client.c (client_expand_modules): Pass error message not "" to error.
	* client.c (supported_request), server.c (supported_response):
	Return a value (gcc -Wall can't know that error doesn't return).
	* commit.c (copy_ulist): Return a value.
	* history.c (fill_hrec): Don't make assumptions about whether
	time_t is "int" or "long" or what.
	* cvs.h: Declare link_file.
	* server.c: Include fileattr.h.
	* server.c (server_notify): Remove unused variable val.
	* tag.c (val_fileproc): Remove unused variable foundtag.

Mon Jan  1 09:49:16 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* Version 1.6.5.

	* Version 1.6.4.

	* filesubr.c (link_file): Add comment about link vs. copy semantics.

	* cvs.h (struct vers_ts): Fix comments.
	* commit.c (commit): Before we ask for a log message, figure out
	what is modified and what is not and pass the information to
	do_editor.
	(copy_ulist,find_fileproc): New helper functions for above code.

	* client.c (read_line): When writing to from_server_logfile, write
	the \n too.

	* client.c (send_files): No longer call send_file_names.
	* client.h: Update comment.
	* add.c, admin.c, commit.c, diff.c, edit.c, log.c, remove.c,
	status.c, tag.c, update.c, watch.c: Call send_file_names before
	send_files.
	* client.c: New variables module_argc, module_argv.
	(client_expand_modules): Set them, to arguments.
	(client_send_expansions): Use them instead of modules_vector to
	send arguments.
	* sanity.sh (modules): Add test of modules -d flag.

Sun Dec 31 17:33:47 1995  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* import.c (add_rev): Revert portion of 31 Aug 95 change which
	passes -u to ci instead of using a hard link.
	* sanity.sh (import): Add test for above-fixed bug.

Sun Dec 31 16:40:41 1995  Peter Chubb  <peterc@@bookworm.sw.oz.au>
			  and Jim Kingdon  <kingdon@@cyclic.com>

	* admin.c (admin_fileproc): Call freevers_ts before returning.

Mon Dec 25 12:20:06 1995  Peter Wemm  <peter@@haywire.DIALix.COM>

	* logmsg.c (rcsinfo_proc): initialise line and
	line_chars_allocated so they dont cause malloc problems within
	getline().  This was causing rcsinfo templates to not work.

Sun Dec 24 01:38:36 1995  Karl Fogel  <kfogel@@floss.cyclic.com>

        * server.c (authenticate_connection): clarify protocol.

        * login.c (login): deprolixify the password prompt.

Sat Dec 23 10:46:41 1995  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* myndbm.h, myndbm.c (dbm_store): New function.
	* myndbm.h (DBM): Add modified and filename fields.
	* myndbm.c (dbm_open, dbm_close): Manipulate new fields.  dbm_open
	no longer fails if the file doesn't exist and O_CREAT is set.
	* cvs.h (CVSROOTADM_VALTAGS): Added.
	* tag.c, cvs.h (tag_check_valid): New function.
	* update.c (update), checkout.c (checkout_proc), commit.c (commit),
	diff.c (diff), patch.c (patch_proc), rtag.c (rtag_proc), tag.c (tag):
	Call it.
	* sanity.sh: Test for rejection of invalid tagname.

Fri Dec 22 18:21:39 1995  Karl Fogel  <kfogel@@csxt.cs.oberlin.edu>

        * client.c (start_server): don't use kerberos if authenticating
        server was specified.

Fri Dec 22 16:35:57 1995  Karl Fogel  <kfogel@@csxt.cs.oberlin.edu>

        * login.c (login): deal with new scramble methods.
        (get_cvs_password): same.

        * server.c (check_repository_password): remove arbitrary limit on
        line length.
        (authenticate_connection): use a separate variable for the
        descrambled password, now that we no longer scramble in place.
        Set `error_use_protocol' to 1 and just use error() where used to
        do its job inline.

        * cvs.h (scramble, descramble): adjust prototype.

        * scramble.c (scramble, descramble): return char *.

Fri Dec 22 13:00:00 1995  Jim Kingdon  <kingdon@@peary.cyclic.com>

	* release.c (release): If SERVER_SUPPORT is not defined, still
	set up arg_start_idx.

	* release.c (release): When calling unedit, set argv[1] to
	NULL (since argc is only 1).

	* edit.c: Pass dosrcs 0 to all calls to start_recursion.
	None of the fileprocs were using it, so it just slowed things
	down and caused potentially harmful checks for rcs files.

	* edit.c (send_notifications): In client case, do not readlock.

Thu Dec 21 16:00:00 1995  Jim Kingdon  <kingdon@@peary.cyclic.com>

	Clean up Visual C++ lint:
	* client.c (read_line): Change input_index and result_size to size_t.
	(update_entries): Remove unused variables buf2, size_left, size_read.
	(handle_mode): Prototype.
	* client.c, client.h (send_to_server, read_from_server): Change
	len to size_t.
	* client.c (send_to_server): Change wrtn to size_t.
	(read_from_server): Change red to size_t.
	* client.c, myndbm.c, edit.c, fileattr.c: Include getline.h.
	* checkin.c, commit.c, update.c: Include fileattr.h.
	* commit.c, update.c: Include edit.h.
	* edit.c (onoff_filesdoneproc): Prototype.
	(ncheck_fileproc,edit_fileproc): Change "return" to "return 0".
	(notify_do): Cast a signed value to unsigned before comparing
	with unsigned value.

Thu Dec 21 15:24:37 1995  Karl Fogel  <kfogel@@occs.cs.oberlin.edu>

        * client.c: don't include socket headers twice just because
        both HAVE_KERBEROS and AUTH_CLIENT_SUPPORT are set.
        (start_kerberos_server): if fail to connect to kerberos, print out
        a more specific error message, mainly so pcl-cvs can know what
        happened and not panic.
        (start_server): don't assume sprintf() returns len
        written (only some systems provide this); instead, have
        send_to_server() calculate the length itself.
        (send_modified): same.
        (send_fileproc): same.
        (send_file_names): same.

Wed Dec 20 14:00:28 1995  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* update.c (ignore_files): Move from here...
	* ignore.c (ignore_files): ...to here.  No longer static.  Take
	new argument PROC.
	* cvs.h (ignore_files): Declare.
	* client.c (send_filesdoneproc): Split off from
	update_filesdone_proc.  Pass new function send_ignproc to
	ignore_files (to ask server about ignored file before printing
	"?").
	* server.c: Rename outbuf from but_to_net and take it from
	do_cvs_command to a global.  Move initialization accordingly.
	(serve_questionable): New function.
	(requests): Add it.
	* update.c (update_filesdone_proc): Remove client stuff.  Pass new
	function update_ignproc to ignore_files.
	* cvs.h (joining, do_update): Move declarations from here...
	* update.h: ...to here.
	* cvs.h: Include update.h.
	* update.c, client.c: Don't include update.h
	* ignore.c, cvs.h: New variable ign_inhibit_server, set on -I !.
	* import.c (import): Pass -I ! to server if specified.
	(import_descend): If server, ignore CVS directories even if -I !.
	* update.c (update), import.c (import): Only call ign_setup before
	argument processing; don't call it again afterwards in client case.
	* sanity.sh (ignore): Test above-fixed bugs and other ignore behaviors.
	(dotest): New function.
	Move modules checkin from modules test to start, so that other
	tests can use mkmodules without a warning message.

Wed Dec 20 13:06:17 1995  Karl Fogel  <kfogel@@floss.cyclic.com>

        * client.c (send_to_server): don't check string's length twice.

Wed Dec 20 02:05:19 1995  Karl Fogel  <kfogel@@floss.cyclic.com>

        * login.c (login): took out debugging printf's.
        (login): Removed unused variable `p'.

Wed Dec 20 00:27:36 1995  Karl Fogel  <kfogel@@floss.cyclic.com>

        * login.c (login): prefix scrambled password with 'A', so we know
        which version of scrambling was used.  This may be useful in the
        future.
        (get_cvs_password): skip past the leading 'A'.
        Scramble $CVS_PASSWORD before returning it.

        * scramble.c: made this work.

Tue Dec 19 17:45:11 1995  Karl Fogel  <kfogel@@floss.cyclic.com>

        * login.c (cvs_password): new static var, init to NULL.
        (login): scramble() the password before using it.
        Verify the password with the server.
        Check CVSroot more carefully to insure that it is
        "fully-qualified".
        (get_cvs_password): if cvs_password is not NULL, just return it.
        Never prompt -- just tell user why failed, then exit.
        Try CVS_PASSWORD environment variable first.
        (construct_cvspass_filename): try CVS_PASSFILE environment
        variable first.

        * client.h (connect_to_pserver): update prototype.

        * client.c (cvsroot_parsed): new static var.
        (parse_cvsroot): set `cvsroot_parsed' to 1 when done.
        (connect_to_pserver): return int.
        Take `verify_only' arg.  If it is non-zero, perform password
        verification with the server and then shut down the connection and
        return.
        Call parse_cvsroot() before doing anything.
        
        * server.c (authenticate_connection): deal with verification
        requests as well as authorization requests.
        descramble() the password before hashing it.

        * cvs.h: prototype scramble() and descramble().

        * Makefile.in: build scramble.o.

        * scramble.c: new file, provides trivial encoding but NOT real
        encryption.

Mon Dec 18 20:57:58 1995  Karl Fogel  <kfogel@@floss.cyclic.com>

        * login.c (login): don't insert extra newlines.  They were
        harmless, but confusing.

Mon Dec 18 15:32:32 1995  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* hash.c, hash.h (findnode_fn): New function.
	* hash.c (hashp): Tweak hash function so that findnode_fn works.
	* update.c (ignore_files): Call findnode_fn, not findnode.

Mon Dec 18 09:34:56 1995  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* myndbm.c: Remove arbitrary limit.

	* client.c: Fix comment--Windows 95 requires NO_SOCKET_TO_FD, not
	Windows NT.

Mon Dec 18 01:06:20 1995  Karl Fogel  <kfogel@@floss.cyclic.com>

        * client.c (server_sock): replaces `server_socket'.
        (start_kerberos_server): added FIXME comment about how
        NO_SOCKET_TO_FD is not dealt with in the kerberos case.
        (connect_to_pserver): deal with NO_SOCKET_TO_FD case.
        (read_line): deal with NO_SOCKET_TO_FD case.
        (read_from_server): deal with NO_SOCKET_TO_FD case.
        (send_to_server): deal with NO_SOCKET_TO_FD case.
        (get_responses_and_close): deal with NO_SOCKET_TO_FD case.

        * client.c (send_to_server): error check logging.
        (start_server): error check opening of logfiles.
        (read_from_server): error check logging.
        (read_line): use fwrite() to log, & error_check it.
        Don't log if using socket style, because read_from_server()
        already logged for us.
        
Mon Dec 18 00:52:26 1995  Karl Fogel  <kfogel@@floss.cyclic.com>

        * client.c (use_socket_style): new static var, init to 0.
        (server_socket): new static var.
        (connect_to_pserver): don't deal with logging here.
        Caller changed.
        (start_kerberos_server): don't deal with logging here either.
        Caller changed.

Mon Dec 18 00:40:46 1995  Karl Fogel  <kfogel@@floss.cyclic.com>

        * client.c (send_modified): don't error-check `to_server';
        send_to_server() does that now.

Mon Dec 18 00:19:16 1995  Karl Fogel  <kfogel@@floss.cyclic.com>

        * login.c (get_cvs_password): Init `linebuf' to NULL.
        free() `linebuf' and reset it for each new line.
        (login): same as above.

        * client.c: Removed all the varargs prototyping gunk.
        (to_server, from_server): make these static.
        (from_server_logfile, to_server_logfile): new vars.
        (start_server): init above two new vars to NULL.
        (send_to_server): return void.
        Correct bug in which amount to be written would be too high if the
        loop ever ran more than once.
        Log to `to_server_logfile' if it's non-NULL.
        (read_from_server): new func, does raw reading from server.
        Logs to `from_server_logfile' if it's non-NULL.
        (update_entries): just use read_from_server() instead of looping
        to fread() directly from `from_server'.
        (read_line): Log to `from_server_logfile' if it's non-NULL.

        * client.h: send_to_server() returns void now.
        (read_from_server): prototype.

Sun Dec 17 19:38:03 1995  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* checkout.c (checkout_proc), client.c, lock.c (readers_exist),
	login.c, modules.c (cat_module, do_module): Remove arbitrary limits.

	* client.c (send_to_server): Fix typo (NULL -> '\0').
	(get_responses_and_close): Set server_started to 0 instead of
	setting to_server and from_server to NULL.
	* client.c: Make to_server and from_server static.

Sun Dec 17 17:59:04 1995  Karl Fogel  <kfogel@@floss.cyclic.com>

        * client.h (to_server, from_server): don't declare these anymore.
        They are now entirely private to client.c (and in fact will go
        away soon there too).
        
Sun Dec 17 15:40:58 1995  Karl Fogel  <kfogel@@floss.cyclic.com>

        * client.h: update prototype of send_to_server().

        * client.c, watch.c, update.c, tag.c, status.c, rtag.c, remove.c,
        release.c, patch.c, log.c, import.c, history.c, edit.c, diff.c,
        commit.c, client.c, checkout.c, admin.c, add.c:
        Convert all send_to_server() calls that used formatting to send
        pre-formatted strings instead.  And don't error check
        send_to_server(), because it does its own error checking now.
        
        * client.c (send_to_server): don't use vasprintf(), just fwrite a
        certain number of bytes to the server.  And do error checking
        here, so our callers don't have to.
        (send_arg): use send_to_server() instead of putc()'ing
        directly to `to_server'.
        
Sun Dec 17 14:37:52 1995  Karl Fogel  <kfogel@@floss.cyclic.com>

        * options.h.in (AUTH_CLIENT_SUPPORT, AUTH_SERVER_SUPPORT):
        Define to 1 but leave commented out, instead of #undef'ing them.
        This treats them like everything else in this file.

        * client.c: define server_started, init to 0.
        (start_server): set server_started to 1.

        * client.h: declare `server_started', extern.
        AUTH_CLIENT_SUPPORT moved here from cvs.h.
        
        * cvs.h: moved AUTH_CLIENT_SUPPORT stuff to client.h.

        * edit.c (notify_check): use new var server_started.

Sun Dec 17 00:44:17 1995  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* client.c (get_responses_and_close): Really stop ignoring ECHILD
	errors.  The Nov 30 1995 change claimed to do this, but the code
	was not actually changed.

	* update.c (ignore_files): Revert H.J. Lu change; it was wrong for
	directories and sometimes looked at sb.st_mode when it wasn't set.
	* import.c (import_descend): Revert H.J. Lu change; it was wrong
	for directories and the extra lstat call was an unnecessary
	performance hit.
	* sanity.sh (import): Add test for the second of these two bugs.

Sat Dec 16 17:26:08 1995  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* client.c (send_to_server): Remove arbitrary limit.  Also remove
	!HAVE_VPRINTF code; all relevant systems have vprintf these days.

Sat Dec 16 21:35:31 1995  Karl Fogel  <kfogel@@floss.cyclic.com>

        * checkout.c (checkout): use send_to_server() now.

Sat Dec 16 21:18:16 1995  H.J. Lu (hjl@@gnu.ai.mit.edu)
                          (applied by kfogel@@cyclic.com)
        
	* import.c (import_descend): We ignore an entry if it is
		1. not a file, nor a link, nor a directory, or
		2. a file and on the ignore list.

	* update.c (ignore_files): We ignore any thing which is
		1. not a file, or
		2. it is a file on the ignore list.

Sat Dec 16 00:14:19 1995  Karl Fogel  <kfogel@@floss.cyclic.com>

        * client.c (send_to_server): corrected comment.

        * client.h: prototype new func send_to_server().

        * add.c, admin.c, client.c, commit.c, diff.c, edit.c, history.c,
        import.c, log.c, patch.c, release.c, remove.c, rtag.c, status.c,
        tag.c, update.c, watch.c: 
        Use send_to_server() instead of writing directly to to_server.

        * client.c: conditionally include the right stuff for variable arg
        lists.
        (send_to_server): new func.
        
Fri Dec 15 23:10:22 1995  Karl Fogel  <kfogel@@floss.cyclic.com>

        * error.c: expanded comments.

        * client.c (connect_to_pserver): verbosify errors.
        (connect_to_pserver): use send() and recv(), not write() and
        read().  Sockets are not file descriptors on all systems.

Fri Dec 15 22:36:05 1995  Karl Fogel  <kfogel@@floss.cyclic.com>

        * client.c (connect_to_pserver): oops, removed old debugging
        printf.

Fri Dec 15 18:21:16 1995  Karl Fogel  (kfogel@@floss.cyclic.com)

        * client.c (auth_server_port_number): don't call htons();
        init_sockaddr() does that for us.
        (init_sockaddr): zero the sockadder_in struct before doing
        anything with it.  IBM TCP/IP docs recommend this, and it can't
        hurt.

Fri Dec 15 15:21:53 1995  Karl Fogel  <kfogel@@floss.cyclic.com>

        * client.c (connect_to_pserver): new var `port_number', initialize
        with new func auth_server_port_number() and pass to
        init_sockaddr().
        (auth_server_port_number): new func.  Right now it just returns
        `htons (CVS_AUTH_PORT)'.  We'll probably add the ability to
        specify the port at run time soon, anyway, so having this function
        will make that easier.

Wed Dec  6 18:08:40 1995  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* cvs.h: Add CVSREP.
	* find_names.c (find_dirs): Skip CVSREP too.
	* fileattr.h, fileattr.c: New files, to manipulate file attributes.
	* hash.c (nodetypestring), hash.h (enum ntype): Add FILEATTR.
	* hash.c, hash.h (list_isempty): New function.
	* recurse.c (do_recursion): Call fileattr_startdir before
	processing files in a directory and fileattr_write and
	fileattr_free (after files, before recursing).
	* watch.c, watch.h: New files, to handle notification features.
	* edit.c, edit.h: New file, to handle new read-only checkout features.
	* client.c, server.c: Add "Mode" request, to change the mode of a file
	when it is checked in.
	* main.c (cmds): Add "watch", "edit", "unedit", "watchers", "editors".
	* main.c: Split command help from usg into new variable cmd_usage,
	which.
	(main): Add --help-commands option to print out cmd_usage.
	* cvs.h: Declare watch, edit, unedit, watchers, editors.
	* client.c, client.h: Add client_watch, client_edit, client_unedit,
	client_watchers, client_editors.
	* client.c, server.c: Add notification stuff.
	* update.c (checkout_file, patch_file), checkin.c (Checkin): Check
	_watched attribute when deciding read-only or read-write.
	* commit.c (checkaddfile): Call fileattr_newfile to set attributes
	on newly created files.
	* release.c (release): 
	* cvs.h: Add CVSADM_NOTIFY and CVSADM_NOTIFYBAK.
	* recurse.c (do_recursion): Call notify_check.
	* commit.c (commit_fileproc): Call notify_do after committing file.
	* client.c (get_responses_and_close): Set to_server and from_server
	to NULL so that it is possible to tell whether we are speaking to
	the server.
	* cvs.h: Add CVSROOTADM_NOTIFY.
	* mkmodules.c (main): Add CVSROOTADM_NOTIFY to filelist.
	* Makefile.in (SOURCES,OBJECTS,HEADERS): Add new files mentioned above.
	* lock.c, cvs.h (lock_tree_for_write, lock_tree_cleanup): New
	functions, taken from old commit.c writelock code.  As part of
	this, fsortcmp and lock_filesdoneproc go from commit.c to lock.c.
	So does locklist but it gets renamed to lock_tree_list.
	* commit.c: Use lock_tree_*.

Fri Dec 15 10:37:00 1995  J.T. Conklin  <jtc@@slave.cygnus.com>

	* tag.c (tag_usage): Added -r and -D flags to usage string.
	(tag): Detect when user specifies both -r and -D arguments.
	Pass -r and -D arguments to server.
	
Thu Dec 14 11:56:13 1995  Karl Fogel  <kfogel@@floss.cyclic.com>

        * client.c (start_rsh_server): use RSH_NEEDS_BINARY_FLAG to
        conditionalize "-b" option to "rsh".

        * run.c (filter_stream_through_program): document return value and
        error behavior.

        * client.c (filter_through_gunzip): pass the supposedly
        superfluous "-d" option to gunzip, to avoid stimulating what seems
        to be an argument-passing bug in spawn() under OS/2 with IBM
        C/C++.  Yucko.

Wed Dec 13 20:08:37 1995  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* options.h.in (RCSBIN_DFLT): Recommend specifying -b in
	inetd.conf for pserver.  That is a pretty good solution.

Wed Dec 13 18:29:59 1995  Preston L. Bannister <pbannister@@ca.mdis.com>
                          and Karl Fogel       <kfogel@@floss.cyclic.com>

        * client.c (send_modified): make sure that vers and vers->options
        are non-NULL before strcmp()'ing them with "-kb".
        Initialize `bin' near where it is used, not at beginning of
        function.
        (update_entries): make sure `options' is non-NULL before
        strcmp()'ing with "-kb".
        Initialize `bin' near where it is used, not at beginning of
        function.

Tue Dec 12 18:56:38 1995  Karl Fogel  <kfogel@@totoro.cyclic.com>

        * options.h.in (RCSBIN_DFLT): document the probable need for this
        to be set in the authenticating server.

Tue Dec 12 11:56:43 1995  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* server.c (expand_proc): If mfile is non-NULL, return it too as
	part of the expansion.
	* sanity.sh (modules): Add tests for above-fixed bug.

Mon Dec 11 21:39:07 1995  Karl Fogel  <kfogel@@floss.cyclic.com>

        * dog.c (flea_bath): Take `suds' arg.
        All collars changed.

Mon Dec 11 15:58:47 1995  Karl Fogel  <kfogel@@floss.cyclic.com>

        * login.c (login): if client password file doesn't exist, create
        it, duh.

        * main.c (main): die if CVSroot has access-method but no
        username.

        * root.c: added some comments.

        * main.c: removed all code pertaining to the "-a" option.  We
        specify access-method in CVSroot now.

        * client.c (parse_cvsroot): new var, `access_method'.  If CVSroot
        is prepended with an access method (i.e.,
        ":pserver:user@@host:/path"), then handle it.

        * login.c (login): use || when checking if CVSroot is "fully
        qualified".
        Prepend ":pserver:" before writing to ~/.cvspass.
        (get_cvs_password): Take no parameters; we'll just use CVSroot to
        get the password.

Mon Dec 11 12:43:35 1995  adamg  <adamg@@microsoft.com>

	* error.c, client.c, remove.c, main.c: Add explicit casts for some
 	function pointers to remove warnings under MS VC.
	* main.c (main): remove use of NEED_CALL_SOCKINIT in favor of the
	more generic INITIALIZE_SOCKET_SUBSYSTEM.  Note that the code assumes
	that if INITIALIZE_SOCKET_SUBSYSTEM() returns, socket subsystem
	initialization has been successful.

Sat Dec  9 22:01:41 1995  Dan O'Connor  <doconnor@@tii.com>

        * commit.c (check_fileproc): pass RUN_REALLY flag to run_exec,
        because it's okay to examine the file with noexec set.

Sat Dec  9 20:28:01 1995  Karl Fogel  <kfogel@@floss.cyclic.com>

        * client.c (update_entries): new var, `bin, init to 0.
        Use it in determining whether to convert the file.
        (send_modified): same as above.

Fri Dec  8 17:47:39 1995  Karl Fogel  <kfogel@@floss.cyclic.com>

        * server.c (downcase_string): removed.
        (check_repository_password): don't deal with case-insensitivity
        anymore.

        * options.h.in (CVS_PASSWORDS_CASE_SENSITIVE): deleted this.  No
        need for it anymore.

Thu Dec  7 21:08:39 1995  Karl Fogel  <kfogel@@floss.cyclic.com>

        * server.c (check_repository_password): when checking for false
        prefix-matches, look for ':', not '@@'.  Duh.

Thu Dec  7 18:44:51 1995  Karl Fogel  <kfogel@@floss.cyclic.com>

        * options.h.in (CVS_PASSWORDS_CASE_SENSITIVE): replaces
        CVS_PASSWORDS_CASE_INSENSITIVE; passwords are now insensitive by
        default.  Expanded explanatory comment.

        * login.c (get_cvs_password): Use memset(), not bzero().  I
        botched this change earlier.

        * server.c (check_repository_password): no need to check
        xmalloc()'s return value.
        (check_repository_password): check for false prefix-matches (for
        example, username is "theo" and linebuf contains user
        "theocracy").

Thu Dec  7 14:49:16 1995  Jim Meyering  (meyering@@comco.com)

	* filesubr.c (isaccessible): Rename from isaccessable.
	Update callers.
	* cvs.h: Update prototype.
	* main.c (main): Update callers.
	* server.c (main): Update callers.

Thu Dec  7 12:50:20 1995  Adam Glass <glass@@NetBSD.ORG>

        * cvs.h: "isaccessible" is the correct spelling.
        Also add "const" to second arg to make prototype match
        declaration.

Thu Dec  7 11:06:51 1995  Karl Fogel  <kfogel@@floss.cyclic.com>

        * client.c, login.c: memset() instead of bzero().

Thu Dec  7 00:08:53 1995  Karl Fogel  <kfogel@@floss.cyclic.com>

        * server.c (authenticate_connection): document server's side of
        the Authentication Protocol too.

        * client.c (connect_to_pserver): when printing out "unrecognized
        response", also print out the offending response.

        * server.c (check_password): take `repository' arg too now.
        Call check_repository_password() before checking /etc/passwd.
        (check_repository_password): new func.

        * options.h.in (CVS_PASSWORDS_CASE_INSENSITIVE): new define, unset
        by default.

Wed Dec  6 18:51:16 1995  Karl Fogel  <kfogel@@floss.cyclic.com>

        * server.c (check_password): If user has a null password, then
        return 1 if arg is also null.
        Reverse sense of return value.  Caller changed.

Wed Dec  6 14:42:57 1995  Karl Fogel  <kfogel@@floss.cyclic.com>

        * server.c (check_password): new func.
        (authenticate_connection): call above new func.

        * login.c (login): use construct_cvspass_filename().
        If CVSroot is not "fully-qualified", then insist the user qualify
        it before going on.
        (get_cvs_password): fleshed out.  Now reads from ~/.cvspass, or
        prompts if no appropriate password found.
        (construct_cvspass_filename): new func.

        * server.c (authenticate_connection): send ACK or NACK to client.

        * client.c (connect_to_pserver): check for ACK vs NACK response
        from server after sending authorization request.

        * login.c (get_cvs_password): new func.

        * client.c (connect_to_pserver): use new func get_cvs_password().
        Prototype it at top of file.  Hmmm.

Wed Dec  6 13:29:22 1995  Karl Fogel  <kfogel@@floss.cyclic.com>

        * server.c: same as below (AUTH_SERVER_SUPPORT).

        * main.c: same as below (AUTH_SERVER_SUPPORT where appropriate).

        * login.c: same same as below.

        * cvs.h: same as below.

        * client.c: use AUTH_CLIENT_SUPPORT, not CVS_LOGIN.

        * options.h.in (AUTH_CLIENT_SUPPORT, AUTH_SERVER_SUPPORT): these
        replace CVS_LOGIN.

Wed Dec  6 00:04:58 1995  Karl Fogel  <kfogel@@floss.cyclic.com>

        * server.c (authenticate_connection): expanded comment.

Tue Dec  5 23:37:39 1995  Karl Fogel  <kfogel@@floss.cyclic.com>

        * client.c (connect_to_pserver): read password from prompt for
        now.

        * server.c (authenticate_connection): if the password passes
        muster, then don't abort.

Tue Dec  5 22:46:37 1995  Karl Fogel  <kfogel@@floss.cyclic.com>

        * subr.c (strip_trailing_newlines): new func.

        * client.c (connect_to_pserver): took out print statements.

        * server.c (authenticate_connection): removed print statments.
        Use new func strip_trailing_newlines() to purify `repository',
        `username', and `password'.
        Run a primitive password check, just for testing.

        * client.c (connect_to_pserver): use CVS_AUTH_PORT.
        Take tofdp, fromfdp, and log args.  Caller changed.
        (get_responses_and_close): either kerberos and CVS_LOGIN might
        have one fd for both directions, so adjust #ifdef accordingly.

        * cvs.h (CVS_AUTH_PORT): new define, default to 2401.
        Prototype strip_trailing_newlines().

Tue Dec  5 16:53:35 1995  Karl Fogel  <kfogel@@floss.cyclic.com>

        * server.c (authenticate_connection): new func.

        * client.c (init_sockaddr): func moved here from login.c.
        (connect_to_pserver): same as above.  Take no args, now.
        Include <sys/socket.h>, <netinet/in.h>, <netdb.h>, if CVS_LOGIN.

        * cvs.h: Declare use_authenticating_server, as extern int.
        Declare connect_to_pserver().

        * main.c (main): call authenticate_connection().  Removed testing
        code.
        Add 'a' to the short-option string in the getopt() call.

        * login.c (connect_to_pserver): moved to client.c.

Tue Dec  5 16:01:42 1995  Peter Chubb <peterc@@bookworm.sw.oz.au>
                          (patch applied by Karl Fogel <kfogel@@cyclic.com>)

        * update.c (join_file): if vers->vn_user is "0", file has been
        removed on the current branch, so print an error and return.

Mon Dec  4 14:27:42 1995  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* Version 1.6.3.

Mon Dec  4 16:28:25 1995  Norbert Kiesel  <nk@@col.sw-ley.de>

	* release.c (release): add return (0) as last line

	* cvs.h: declare program_path

	* main.c define program_path
	  (main): set program_path

	* release.c (release): use program_path for update_cmd

Mon Dec  4 11:22:42 1995  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* Version 1.6.2.

Sun Dec  3 20:02:29 1995  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* rcs.h (struct rcsnode), rcs.c (freercsnode): Add expand field.
	* rcs.h (RCSEXPAND): New #define.
	* rcs.c (RCS_reparsercsfile): Record keyword expansion in expand
	field of struct rcsnode.
	* update.c (checkout_file): Set keyword expansion in Entries file
	from rcs file if there is nowhere else to set it from.
	* client.c (send_modified, update_entries) [LINES_CRLF_TERMINATED]:
	If -kb is in effect, don't convert.

	* update.c (update_file_proc), commit.c (check_fileproc),
	rcscmds.c (RCS_merge): Direct stdout to DEVNULL rather than
	passing -s option to grep.  This avoids trouble with respect to
	finding a grep which support -s and whether we should use the (GNU
	grep) -q option if it exists.
	* options.h.in: Change "@@ggrep_path@@" to "grep".

Fri Dec  1 11:53:19 1995  Norbert Kiesel  <nk@@col.sw-ley.de>

	* rcs.c (RCS_gettag): new parameter return_both force return both
	  tags: the symbolic and the numeric one.
	  (RCS_getversion): new parameter return_both is forwarded to
	  RCS_gettag.

	* rtag.c, tag.c, commit.c, patch.c, update.c: pass 0 as additional
	  last parameter to RCS_getversion and RCS_gettag

	* rcs.h (RCS_gettag): new parameter return_both.
	  (RCS_getversion): new parameter return_both.

	* cvs.h (struct vers_ts): add vn_tag slot for symbolic tag name

	* vers_ts.c (Version_TS): call RCS_getversion with 1 for
	  return_both and split output into vn_rcs and vn_tag
	  (freevers_ts): free vn_tag

	* update.c (checkout_file): use vn_tag instead of vn_rcs when
	  calling 'rcs co' to allow rcs expansion of :$Name :

Thu Nov 30 20:44:30 1995  Karl Fogel  <kfogel@@floss.cyclic.com>

        * client.c (get_responses_and_close): undo previous change
        regarding waitpid().  The problem has been solved by modifying
        os2/waitpid.c instead of its callers.

Thu Nov 30 16:37:10 1995  Karl Fogel  <kfogel@@floss.cyclic.com>

        * client.c: All these changes are for OS/2, which will no longer have
        a separate client.c:
        (start_kerberos_server): new func, contains code that
        used to be in start_server().
        (start_server): moved kerberos code to above function, reorganized
        the rest.  Added authentication clause.
        (call_in_directory): test errno against EACCESS, if EACCESS is
        defined (this is for OS/2's oddball mkdir).
        (change_mode): don't set execute permission on anything if
        EXECUTE_PERMISSION_LOSES is defined.
        (get_responses_and_close): if START_RSH_WITH_POPEN_RW, then use
        pclose() instead of fclose().
        If waitpid errors with ECHILD, don't die.  This is okay.
        (start_rsh_server): alternate definition if
        START_RSH_WITH_POPEN_RW.

        * main.c: [all these changes conditional on CVS_LOGIN: ]
        Don't prototype connect_to_pserver, don't enter it in cmds[]
        (actually, it was never in there, I don't know why my previous
        change said it was).
        (use_authenticating_server): new global var.
        (main): if "-a", then set above new var to TRUE.
        (usg): document "-a" option.

Wed Nov 29 12:55:10 1995  Karl Fogel  <kfogel@@floss.cyclic.com>

        * main.c: Prototype connect_to_pserver(), and enter it in cmds[].
        (main): test some extremely primitive authentication.

        * login.c: Include <sys/socket.h>
        (connect_to_pserver): new func.
        (init_sockaddr): new func.

Mon Nov 20 14:07:41 1995  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* Makefile.in (TAGFILES): Separate out from DISTFILES, for C code.
	(TAGS,tags): Use TAGFILES not DISTFILES.

Sun Nov 19 11:22:43 1995  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* recurse.c (do_recursion): Don't call server_pause_check if there
	are writelocks around.  Revise comment to reflect fact we are no
	longer relying on a writelock'd operations being "unable" to
	generate enough data to pause.

Sun Nov 19 10:04:50 1995  Peter Wemm  <peter@@haywire.DIALix.COM>

	* server.c, server.h, options.h.in: Implement hooks for doing
	simple flow control on the server to prevent VM exhaustion on a
	slow network with a fast server.
	* recurse.c: Call the flow control check at a convenient location
	while no locks are active.  This is a convenience tradeoff against
	accurate flow control - if you have a large directory it will all
	be queued up, bypassing the flow control check until the next
	directory is processed.

Sat Nov 18 16:22:06 1995  Karl Fogel  <kfogel@@floss.cyclic.com>

        * client.c, update.c, vers_ts.c, server.c, rcs.c, lock.c,
        ignore.c, entries.c, diff.c, commit.c, checkin.c:
        Use new macro `existence_error', instead of comparing errno to
        ENOENT directly.

Fri Nov 17 14:56:12 1995  Karl Fogel  <kfogel@@floss.cyclic.com>

        * client.c (start_server): removed alternate version of this func,
        since os2/client.c will now be used under OS/2.

Thu Nov 16 22:57:12 1995  Karl Fogel  <kfogel@@floss.cyclic.com>

        * client.c (start_server): ifdef HAVE_POPEN_RW, use a different
        version of start_server().  This is maybe not the cleanest cut to
        make, but it's better than mucking around with yet more #ifdefs in
        the middle of the old start_server() function.  Once things are
        up, I may reposition this code.

Wed Nov 15 15:33:37 1995  Karl Fogel  <kfogel@@floss.cyclic.com>

        * main.c (main): ifdef NEED_CALL_SOCKINIT, then call SockInit().
        Only OS/2 needs this initialization.

Tue Nov 14 18:54:01 1995  Greg A. Woods  <woods@@most.weird.com>

	* patch.c:
	- fix orientation of test for result of getline() call
	- use fputs() not printf() when just copying file out

	* cvsbug.sh:
	- add space after #!
	- new rcs id
	- allow version to be edited by Makefile.

	* Makefile.in:
	- make Makefile a dependent of all (this might not be perfect, but
	it at least gives you a chance to catch up on the second
	go-around).
	- filter cvsbug.sh in a manner similar to cvsinit.sh to get the
	version number set from version.c

Tue Nov 14 13:28:17 1995  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* sanity.sh: Call old log file check.plog, not check.olog.

	* sanity.sh: Convert remaining tests from old-style ('***' on fail
	and nothing on pass), to new-style (FAIL on fail and PASS on pass).

	* sanity.sh: Fix ability to run only some of the tests (always run
	tests 1-4.75 to set up repository, document better how it works).

	* sanity.sh: Change "completed successfully" to "completed" in
	message--many tests, but not all, exit if they fail.

Tue Nov 14 15:10:00 1995  Greg A. Woods  <woods@@most.weird.com>

	* sanity.sh: test 63 doesn't work and probably can't

Tue Nov 14 12:22:00 1995  Greg A. Woods  <woods@@most.weird.com>

	* sanity.sh: many minor tweaks:
	- make the optional arguments almost work
	- use a function 'directory_cmp' instead of 'diff -r'
	- fix up a few more tests that weren't working....

Mon Nov 13 07:33:55 1995  Karl Fogel  <kfogel@@floss.cyclic.com>

        * cvs.h: ifdef USE_OWN_POPEN, #include "popen.h".  Only OS/2 has
        its own popen()/pclose() right now.

Mon Nov 13 04:06:10 1995  Karl Fogel  <kfogel@@floss.cyclic.com>

        * cvs.h: conform to 80 column standard (yes, I'm a pedant).

Sat Nov 11 13:45:13 1995  Karl Fogel  <kfogel@@floss.cyclic.com>

        * client.c (process_prune_candidates): use unlink_file_dir() to
        remove the directory, instead of invoking "rm" via run_exec().

Fri Nov 10 14:38:56 1995  Karl Fogel  <kfogel@@floss.cyclic.com>

        * main.c (main): removed "#define KF_GETOPT_LONG 1", since that
        change is no longer in testing.

Thu Nov  9 20:32:12 1995  Karl Fogel  <kfogel@@floss.cyclic.com>

        * release.c (release): Use Popen(), not popen().

Wed Nov  8 10:20:20 1995  Jim Meyering  (meyering@@comco.com)

	* entries.c (ParseTag): Remove dcl of unused local.

	* patch.c: Include getline.h.

Wed Nov  8 11:57:31 1995  Norbert Kiesel  <nk@@col.sw-ley.de>

	* options.h.in: add configuration option STEXID_SUPPORT (default
	  is off i.e. old semantics)

	* filesubr.c (isaccessable): new function.  Checks access-rights
	for files like access(), but is getxid-safe.  Falls back to
	access() if SETXID_SUPPORT is not enabled.
	(isfile): replace stat() by isaccessable(file, F_OK)
	(isreadable): replace access() by isaccessable()
	(iswritable): ditto
	(make_directory): rename local variable buf to sb

	* cvs.h: add prototype for new function isaccessable.

	* server.c (serve_root): replace access() by isaccessable()

	* cvsrc.c (read_cvsrc): replace access() by isreadable()

	* main.c (main): replace access() by isaccessable()

Wed Nov  8 10:22:41 1995  Greg A. Woods  <woods@@most.weird.com>

	* entries.c (fgetentent): change definition to static to match the
	declaration at the top of the file

Tue Nov  7 16:59:25 1995  J.T. Conklin  <jtc@@lestat.cygnus.com>

	* rcs.c (RCS_getbranch, RCS_getdate, RCS_getrevtime, RCS_gettag,
 	RCS_getversion, RCS_head): Use assert() instead of attempting to
	"do the right thing" with a bogus RCSNode argument.

Mon Nov  6 14:24:34 1995  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* vers_ts.c: Remove ctime define.  It is just asking for trouble.

Mon Nov  6 11:58:26 1995  Karl Fogel  <kfogel@@floss.cyclic.com>

        * vers_ts.c: ifdef ctime, undef it before redefining it.  It is a
        macro on some systems.

        * lock.c: don't prototype ctime() here.  (See note below about
        fgetentent() in entries.c.)

Sun Nov  5 16:06:01 1995  Karl Fogel  <kfogel@@floss.cyclic.com>

        * entries.c (fgetentent): don't prototype ctime here; we include
        cvs.h, which includes system.h, which includes <time.h>
        unconditionally (either as <time.h> or <sys/time.h>).  Anyway, IBM
        C/C++ chokes on mid-function, or even mid-file, prototypes.  Sigh.

Thu Nov  2 21:51:04 1995  Dan Wilder  <dan@@gasboy.com>

	* rtag.c (rtag): Fix typo ("-T" -> "-F").

Tue Oct 31 19:09:11 1995  Dan Wilder <dan@@gasboy.com>

        * diff.c (diff_dirproc): just return R_SKIP_ALL if dir not exist.
        (diff_file_nodiff): don't complain if file doesn't exist, just
        ignore.

Tue Oct 31 09:25:10 1995  Norbert Kiesel  <nk@@col.sw-ley.de>

	* sanity.sh: Use absolute pathname for mkmodules.

Sat Oct 28 01:01:41 1995  Jim Meyering  (meyering@@comco.com)

	* entries.c (ParseTag): Use getline instead of fgets.

Fri Oct 27 13:44:20 1995  Karl Fogel  <kfogel@@floss.cyclic.com>

        * cvs.h: do nothing about alloca ifdef ALLOCA_IN_STDLIB.  I am
        rather suspicious of this solution, and will not be surprised to
        find out that there's a Right Way to handle this situation ("this
        situation" being that OS/2 simply declares alloca in <stdlib.h>).
        Suggestions are welcome; see src/cvs.h and lib/system.h to see why
        I was getting a conflict in the first place.

Wed Oct 25 16:03:20 1995  J.T. Conklin  <jtc@@slave.cygnus.com>

	* cvs.h (struct entnode): Add user field.
	* entries.c (fputentent): New function, write entries line.
	(write_ent_proc): Call fputentent to write entries line.
	(Entnode_Create): New function, construct new Entnode.
	(Entnode_Destroy): New function, destruct old Entnode.
	(AddEntryNode): Changed to take an Entnode argument instead of
	separate user, version, timestamp, etc. arguments.
	(fgetentent): Changed to return Entnode.
	(struct entent, free_entent): Removed.

Wed Oct 25 12:44:32 1995  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* admin.c (admin): Don't rely on ANSI C string concatenation;
	SunOS 4.1.3 /bin/cc doesn't support it.

Tue Oct 24 22:34:22 1995  Anthony J. Lill  <ajlill@@ajlc.waterloo.on.ca>

	* import.c (expand_at_signs): Check errno as well as return value
	from putc.  Some systems bogusly return EOF when successfully
	writing 0xff.

Tue Oct 24 14:32:45 1995  Norbert Kiesel  <nk@@col.sw-ley.de>

	* admin.c (admin): use getcaller() instead of getpwuid

	* subr.c (getcaller): prefer getlogin() to $USER and $LOGNAME
	  (especially useful for NT where getuid always returns 0)

Tue Oct 24 06:22:08 1995  Jim Meyering  (meyering@@comco.com)

	* cvsrc.c (read_cvsrc): Use getline instead of fgets.
	* patch.c (patch_fileproc): Use getline instead of fgets.

	* entries.c (fgetentent): Use getline instead of fgets.
	Use xmalloc to allocate space for each returned entry.
	Since LINE is no longer static, save it in struct entent.
	(struct entent): New member, line.
	(free_entent): New function.
	(Entries_Open): Call it after each call to fgetentent.

Tue Oct 24 11:13:15 1995  Norbert Kiesel  <nk@@col.sw-ley.de>

	* cvs.h: Declare valloc again, but this time with the right
	  signature (also changed in libs/valloc.c)

Mon Oct 23 12:17:03 1995  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* logmsg.c (do_editor): Check for errors from stdio calls.

Mon Oct 23 12:37:06 1995  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* cvs.h: Don't declare valloc.  Some systems (e.g. linux) declare
	it in stdlib.h in a conflicting way.

Mon Oct 23 08:41:25 1995  Jim Meyering  (meyering@@comco.com)

	* commit.c (commit_filesdoneproc): Use getline instead of fgets.

	* logmsg.c (do_editor): Use getline instead of fgets.
	(rcsinfo_proc): Likewise.

	* logmsg.c (do_editor): Lose if fclose of temp file output
	stream fails.

Mon Oct 23 11:59:41 1995  Norbert Kiesel  <nk@@col.sw-ley.de>

	* cvs.h: add valloc declaration

	* server.h: add server_cleanup prototype

	* server.c: remove server_cleanup prototype

	* mkmodules.c (server_cleanup): fix parameter type

	* server.c: encapsulate wait_sig in #ifdef sun (it's only used in
	  code which is also encapsulated in #ifdef sun)

	* rcscmds.c (RCS_deltag, RCS_lock): add definition of noerr
	  parameter

	* error.c: include cvs.h instead of config.h, add USE(rcsid)

	* error.c (error): fix parameter type

	* update.c (join_file): encapsulate recent changes from garyo
	  within #ifdef SERVER_SUPPORT

Sun Oct 22 13:47:53 1995  J.T. Conklin  <jtc@@slave.cygnus.com>

	* client.c (update_entries): Fix memory leak; free mode_string and
	file_timestamp.
	(send_fileproc): Fix memory leak; call freevers_ts before exiting.

	* module.c (do_module): Partially fix memory leak; added
	variable so that the address of memory allocated by line2argv
	is retained, but comment out the call to free_names.  Freeing
 	the vector at that point loses because some of the elements
	may be used later in the function.
	(cat_module): fix memory leak.

	* recurse.c (start_recursion): Fix memory leak; free return
	value of Name_Repository after it has been used.

Sat Oct 21 23:24:26 1995  Jim Meyering  (meyering@@comco.com)

	* client.c (send_modified) [LINES_CRLF_TERMINATED]: Comment text
	after #endif.

Fri Oct 20 14:41:49 1995  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* sanity.sh: Add test 87a, to test for bug fixed by garyo in
	change below.

Fri Oct 20 10:59:58 1995  Gary Oberbrunner  <garyo@@darkstar.avs.com>

	* update.c (join_file): send file back to client even if no
	conflicts were detected, by calling Register().

Fri Oct 20 10:46:45 1995  Norbert Kiesel  <nk@@col.sw-ley.de>

	* lock.c: Add prototype for Check_Owner

Thu Oct 19 16:38:14 1995  Jim Meyering  (meyering@@comco.com)

	* lock.c (Check_Owner): Declare function `static int'.

Thu Oct 19 14:58:40 1995  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* expand_path.c (expand_variable): Fix typo ('*'->'(').

Thu Oct 19 14:58:40 1995  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* commit.c (commit_filesdoneproc): Check for errors from fopen,
	fgets, and fclose.

	* rcscmds.c (RCS_merge): Remove comment about rcsmerge -E.
	Hacking CVS was never a very good solution; the situation is fixed
	in RCS 5.7, and is documented in ../INSTALL.

Thu Oct 19 15:06:15 1995  Jim Meyering  (meyering@@comco.com)

	* filesubr.c (xchmod): Parenthesize arithmetic in operand of |
	to placate gcc -Wall.

	* expand_path.c (expand_path): Parenthesize assignments used as
	truth values to placate gcc -Wall.

	* commit.c (checkaddfile): Remove dcls of unused variables.
	* lock.c (unlock): Remove dcl of unused variable.

Thu Oct 19 14:58:40 1995  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* root.c (Create_Root): If noexec, don't create CVS/Root.

Wed Oct 18 11:19:40 1995  J.T. Conklin  <jtc@@slave.cygnus.com>

	* lock.c (unlock): Change order of comparison so that Check_Owner
	is called only if other conditions are true.  This performance
	enhancement was broken when the AFS support was added.

Wed Oct 18 12:51:33 1995  Karl Fogel  <kfogel@@floss.cyclic.com>

        * main.c (main): check if argv[0] is "pserver" with else-if, not
        if, since we've already asked if it's "kserver".

Tue Oct 17 18:09:23 1995  Warren Jones <wjones@@tc.fluke.com>
			  and Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* sanity.sh: Deal with supplying a relative cvs filename, or
	with a cvs filename which doesn't have basename "cvs".

Mon Oct 16 15:58:31 1995  Vince Demarco <vdemarco@@bou.shl.com>

	* parseinfo.c (Parse_Info): if the Keyword isn't ALL the current
	version doesn't use the expanded variable, It should.

Mon Oct 16 15:58:31 1995  Gary Oberbrunner <garyo@@avs.com>
			  and Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* server.c (server_register): Don't pass NULL to printf if tag,
	date, or conflict is NULL.

Thu Oct 12 12:13:42 1995  Karl Fogel  <kfogel@@floss.cyclic.com>

        * main.c (main): begin to handle "pserver"; support not complete
        yet, however.

Thu Oct 12 02:52:13 1995  Roland McGrath  <roland@@churchy.gnu.ai.mit.edu>

	* expand_path.c: Don't #include <pwd.h>, since cvs.h already does,
	and not all systems' <pwd.h>s are protected from multiple inclusion.
	* login.c: Likewise.

Wed Oct 11 15:23:24 1995  Karl Fogel  <kfogel@@floss.cyclic.com>

        * login.c (login): handle everything correctly now.

Wed Oct 11 12:02:48 1995  Norbert Kiesel  <nk@@col.sw-ley.de>

	* rcs.c (RCS_gettag): support RCS keyword Name

Tue Oct 10 19:11:16 1995  Karl Fogel  <kfogel@@floss.cyclic.com>

        * options.h.in (CVS_LOGIN): discuss, but leave commented out.
        The "cvs login" command is still under construction; however, the
        repository was changing so fast that instead of creating a branch
        and dealing with the attendant hair, I'm just developing on the
        trunk, making sure that everything is surrounded by "#ifdef
        CVS_LOGIN ... #endif" so I don't get in anyone's way.

        * login.c: include cvs.h before checking CVS_LOGIN, so it has a
        chance to get defined before we ask if it's defined.
        (login): oops, use semi not comma in `for' loop init.

        * Makefile.in (SOURCES, OBJECTS): include login.c, login.o.

        * main.c: added protoype for login().
        Added "login" entry to cmds[].
        (usg): added line about "login".

        * login.c: new file.

Tue Oct 10 18:33:47 1995  Karl Fogel  <kfogel@@totoro.cyclic.com>

        * Makefile.in (COMMON_OBJECTS): added error.o.
        (OBJECTS): took error.o out; it's in COMMON_OBJECTS now.

Tue Oct 10 12:02:37 1995  Thorsten Lockert  <tholo@@sigmasoft.com>

	* cvsbug.sh: Cater to lame versions of sh (4.4BSD ash) by using
	${foo-bar} instead of `if....`.

Tue Oct 10 12:02:37 1995  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* remove.c (remove_fileproc): If noexec, don't remove file.  Check
	for error when removing file.

Sun Oct  8 12:32:15 1995  Peter Wemm  <peter@@haywire.DIALix.COM>

	* run.c: detect/use POSIX/BSD style reliable signals for critical
	section masking etc.  Helps prevent stray locks on interruption.

Sat Oct  7 23:26:54 1995  Norbert Kiesel  <nk@@col.sw-ley.de>

	* admin.c (admin): If group CVS_ADMIN_GROUP exists, allow only
	users in that group to use "cvs admin".
	* options.h.in: Default CVS_ADMIN_GROUP to "cvsadmin".

Sat Oct  7 23:05:24 1995  Norbert Kiesel  <nk@@col.sw-ley.de>

	* add.c, checkout.c, commit.c, cvs.h, filesubr.c, import.c,
	lock.c, main.c, modules.c, options.h.in: New variable cvsumask
	which is used to set mode of files in repository (regardless of
	umask in effect when cvs is run).

Sat Oct  7 22:40:17 1995  Stephen Bailey  <sjbailey@@sand.npl.washington.edu>

	* lock.c: Include AFSCVS ifdefs to deal with AFS's lack of
	correspondance between userid's from stat and from geteuid.

Sat Oct  7 22:28:49 1995  Scott Carson  <sdc@@TracerTech.COM>

	* add.c (add): Pass -ko, not -k -ko, to set keyword expansion options.

	* admin.c (admin): Don't skip first argument when sending to server.

Fri Oct  6 21:45:03 1995  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* version.c: Version 1.6.1.

Fri Oct  6 21:31:28 1995  Jeff Johnson  <jbj@@brewster.jbj.org>

	* cvs.h, admin.c, client.c, commit.c, log.c, modules.c,
	parseinfo.c, patch.c, recurse.c, rtag.c, status.c, tag.c:
	Prototype when dealing in pointers to functions.

Fri Oct  6 21:07:22 1995  Mark H. Wilkinson  <mhw@@minster.york.ac.uk>

	* cvsrc.c (read_cvsrc): fix look up of command names in cvsrc file
	to use full name from command table rather than possible nickname
	in argv. Fixes errors with things like `cvs di' when cvsrc has
	`diff -u5' in it.

Thu Aug  3 01:03:52 1995  Vince DeMarco  <vdemarco@@bou.shl.com>

	* parseinfo.c (Parse_Info): Add code to call expand_path function
	instead of using built in code.

	* wrapper.c (wrap_add): Add code to call expand_path function to
	expand all built in variables.

	* expand_path.c (New file): expand things that look like
	environmental variables (only expand local CVS environmental
	variables) and user names like ~/.
	* cvs.h: Declare expand_path.

	* Makefile.in (SOURCES, OBJECTS): Added expand_path.c,
	expand_path.o.

Fri Oct  6 14:03:09 1995  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* ignore.c (ign_setup): Don't try to look for a file in CVSroot if
	client.  (The recent tightening of the error checking detects this).

	* commit.c (checkaddfile): Don't try to pass options if it is "".

Thu Oct  5 18:04:46 1995  Karl Fogel  <kfogel@@totoro.cyclic.com>

        * sanity.sh: unset CVSREAD, since it causes the script to bomb.

Thu Oct  5 18:29:17 1995  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* remove.c, add.c, commit.c, cvs.h: Remove CVSEXT_OPT stuff; it
	has been broken for ages and the options are already stored in the
	Entries file.

Thu Oct  5 18:20:13 1995  Norbert Kiesel  <nk@@col.sw-ley.de>

	* commit.c (checkaddfile): New argument options; pass it to RCS.
	(commit_fileproc): Pass it.

d43 1
a43 1

d45 1
a45 1

d47 1
a47 1

d56 1
a56 1

d58 1
a58 1

d137 1
a137 1

@


1.1.1.3
log
@Latest public release from Cyclic; fixes numerous memory leaks and have
some performance improvements
@
text
@a0 508
Mon Feb 26 16:07:56 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* Version 1.7.2.

Mon Feb 26 1996  Jim Kingdon  <kingdon@@cyclic.com>

	* recurse.c (start_recursion): Use last_component rather than
	checking for '/' directly.
	(do_dir_proc): Likewise.

	Visual C++ lint:
	* client.c (send_to_server): Change wrtn to size_t.
	(connect_to_pserver): Put tofd and fromfd declarations inside
	#ifndef NO_SOCKET_TO_FD.
	* scramble.c (shifts): Change from array of char to array of
	unsigned char.

Mon Feb 26 13:31:25 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* server.c (check_repository_password): Remove unused variables
	linelen, ch.

	* client.c (send_file_names): Translate ISDIRSEP characters to '/'.

Sat Feb 24 21:25:46 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* checkout.c (safe_location): Re-indent one line.

Sat Feb 24 10:50:42 1996  Karl Fogel  <kfogel@@floss.red-bean.com>

        * checkout.c (safe_location): put assignment to hardpath[x] in an
        `else'-clause, so we don't do it when x == -1.

Sat Feb 24 01:40:28 1996  Marcus Daniels  <marcus@@sayre.sysc.pdx.edu>
                          via Karl Fogel  <kfogel@@floss.red-bean.com>
 
 	* server.c (check_repository_password): Return by reference an
  	  optional username, the `host_user', from the passwd file.  The
  	  host_user will be the user-id under which the cvs repository is
  	  run.
 	  (check_repository_password): Use `read_line' instead of fgets to
  	  allow for passwords larger than 32 characters, as well as the
  	  optional host user argument.
 	  (check_password): Modify to use host_user.
 	  (authenticate_connection): Modify to use host_user.

Sat Feb 24 01:05:21 1996  Karl Fogel  <kfogel@@floss.red-bean.com>

        * scramble.c (descramble): just shift descrambled string to get
        rid of tag char, instead of allocating a whole new copy.
        (scramble): cast return value of xmalloc to avoid unsightly
        compiler warnings.

        * options.h.in (RCSBIN_DFLT): don't refer to AUTH_SERVER_SUPPORT
        in comment anymore, now that it's not defined in this file.

Fri Feb 23 1996  Jim Kingdon  <kingdon@@cyclic.com>

	* client.c: Ifdef HAVE_WINSOCK_H, include winsock.h
	instead of sys/socket.h and friends.
	* login.c: Don't include sys/socket.h and friends.
	* login.c (login): Only fclose fp in the case where it was
	successfully fopen'd.
	* login.c: Declare getpass.
	* filesubr.c, cvs.h (get_homedir): New function.
	* cvsrc.c, expand_path.c, history.c, login.c: Call it instead
	of getenv ("HOME").

Fri Feb 23 09:23:20 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* client.c (connect_to_pserver): Remove unused variable host.
	* login.c: Include getline.h.
	(login): Remove unused variables i and username.
	(get_cvs_password): Move free of linebuf to where it actually will
	be called.  Add a "return NULL" at the end of the function to shut
	up gcc -Wall.

	* options.h.in: Remove AUTH_SERVER_SUPPORT.
	* client.h (authenticate_connection): Declare.
	* scramble.c (scramble): Cast char to unsigned char before using
	it to look up in table (char might be signed).
	* server.c [AUTH_SERVER_SUPPORT]: Include grp.h
	(authenticate_connection): Remove unused variables len and
	server_user.

	* sanity.sh (basica): Add comments regarding creating a top-level
	directory.
	(basic1): Don't try to remove first-dir and
	${CVSROOT_DIRNAME}/first-dir at start of test; tests are now
	responsible for cleaning up at the end.
	(PLUS,DOTSTAR,ENDANCHOR): Add comments regarding fixed GNU expr.

Thu Feb 22 22:34:11 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* cvs.h: Remove alloca cruft.

Wed Feb 21 07:30:16 1996  J.T. Conklin  <jtc@@rtl.cygnus.com>

	* modules.c (do_module): call free_cwd before exiting.

	* recurse.c: Removed entries global variable.
	(do_recursion): Declare entries.  Moved call to Entries_Close so
 	entries list is closed on all code paths.
	(start_recursion): Removed call to Entries_Close, entries list has
 	been moved to do_recursion only.

Tue Feb 20 22:10:05 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* update.c (update_dirent_proc): If dir lacks a CVS subdirectory,
	don't recurse into it.
	* sanity.sh (conflicts): Test for above-fixed bug.

	* update.c (merge_file): Use write_letter not printf.

Tue Feb 20 12:34:07 EST 1996: Gary Oberbrunner <garyo@@avs.com>
			      and Jim Kingdon <kingdon@@cyclic.com>

	* history.c (history_write): Change username to char * and call
	getcaller() to set it.  Setting username accidentally got deleted
	8 Feb 96.
	* sanity.sh: Revise test 64 to test for above-fixed bug.
	* sanity.sh (PLUS): New variable, work around yet another GNU expr
	bug.

Tue Feb 20 14:07:50 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* sanity.sh: Merge test rtags into test basic2.  They never were
	capable of running separately of each other.

	* sanity.sh (deep): New test, to test ability to operate in deeply
	nested directories (more quickly than basic2 test did).
	(basic2,rtags): Remove directories dir3 and dir4.  Remove file8,
	file10, file12, file9, file11, file13, file15, file16, file17.
	These additional files slowed down the tests considerably without
	significantly increasing coverage.

	* sanity.sh (PROG): New variable.  Use it instead of "cvs"
	to match the name cvs prints out for itself.

Mon Feb 19 09:00:29 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	This fixes a bug whereby old default attributes would get
	clobbered instead of added to on "cvs watch add".
	* hash.c (findnode): Don't check for key == NULL; let the
	assertion in hashp take care of it.
	* fileattr.h, fileattr.c (fileattr_get): If filename is NULL,
	return default attributes.

	* client.c (send_repository): Fix indentation.

Mon Feb 19 01:10:01 1996  Karl Fogel  <kfogel@@floss.red-bean.com>

        * login.c (login): print out full repos so user knows which server
        she's logging into.

        * client.c (send_repository): die if `repos' is NULL.  This is a
        lame solution; see comments in code.

Thu Feb 15 15:04:01 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* error.c (error): Free entire and mess when done with them.

	* sanity.sh (info): Correct syntax of .cvsrc file.

	* cvs.h, expand_path.c, edit.c, parseinfo.c, wrapper.c:
	expand_path now takes arguments containing file and line for error
	message, and it prints the error message itself.
	* sanity.sh (info-6a): Test printing of error message.

	* expand_path.c (expand_variable): Add USER internal variable.
	* sanity.sh (info): Test USER and CVSROOT internal variables too.

Wed Feb 14 19:11:08 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* main.c (usg): Add -s option.

Tue Feb 13 20:26:06 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	gcc -Wall lint:
	* mkmodules.c (mkmodules_usage): Remove declaration of
	non-existent function.
	* cvs.h (mkmodules): Declare.

Mon Feb 12 12:20:04 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* mkmodules.c: Rename main to mkmodules and remove various pieces
	of scaffolding which it used to emulate non-existent parts of CVS.
	Change calling convention to just take a char * not argc,argv.
	Save and restore working directory.
	* commit.c (commit_filesdoneproc): Call it if checking files into
	CVSROOT.
	* Makefile.in (SOURCES): Add mkmodules.c.
	(OBJECTS): Add mkmodules.o.
	(MSOURCES,MOBJECTS): Removed.
	(COMMON_OBJECTS): Removed; move former contents into OBJECTS.
	Update other rules accordingly.
	* sanity.sh: Adjust to reflect nonexistence of mkmodules.

	These changes introduce functions cvs_output and cvs_outerr;
	eventually all server output will go through them rather than
	stdio directly.
	* server.c (saved_output, saved_outerr): New variables.
	(do_cvs_command): Initialize them.
	(buf_output): Don't require that buf->output be set; saved_* use
	this to shove some data in a buffer which buf_copy_lines will
	later want to get data from.
	* server.c, cvs.h (cvs_output, cvs_outerr): New functions.
	* mkmodules.c (cvs_outerr): New function, so error() works.
	* error.c: Reindent.  Don't declare program_name and command_name;
	cvs.h declares them.
	(error): Use vasprintf and cvs_outerr (or fputs in the
	error_use_protocol case) rather than stdio directly.
	* import.c (import_descend_dir): Remove kludge which had prevented
	messages from error() from being out of order with respect to
	messages from printf; cvs_output and cvs_outerr are a cleaner
	solution to the problem.
	(add_log, import): Use cvs_output not printf.
	* update.c (write_letter): Use cvs_output not printf.
	(checkout_file): Use write_letter not printf.
	* sanity.sh: Use dotest for test 56 (test that output is actually
	correct).  In theory should test that the import.c bug is fixed,
	but I was unable to reproduce the bug (it is timing dependent).

Mon Feb 12 16:07:45 1996  Norbert Kiesel  <nk@@col.sw-ley.de>

	* commit.c: define last_register_time
	(commit): make sure cvs doesn't exit in the same second it wrote
	the last timestamp
	(commit_fileproc): set last_register_time
	(finaladd): set last_register_time

	* run.c, cvs.h: Changed more Popen() to run_popen()

Mon Feb 12 03:06:50 1996  Benjamin J. Lee  <benjamin@@cyclic.com>

	* release.c, rtag.c, tag.c: changed 'delete' to 'delete_flag'
	to avoid symbol collision with DEC C RTL function delete()

Mon Feb 12 03:01:48 1996  Benjamin J. Lee  <benjamin@@cyclic.com>

	* mkmodules.c: changed 'void Lock_Cleanup()' to 'void static
	Lock_Cleanup() to avoid conflict with more substantial
	Lock_Cleanup() in lock.c

Mon Feb 12 02:50:19 1996  Benjamin J. Lee  <benjamin@@cyclic.com>

	* edit.c, logmsg.c, release.c, run.c: Changed Popen() to
	run_popen().  VMS' linker is not case sensitive and considered
	popen() and Popen() to be identical symbols.

Sun Feb 11 10:51:14 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* main.c (main) [!CLIENT_SUPPORT]: Silently ignore gzip level
	rather than printing usage message.

	* cvs.h, expand_path.c (variable_list): New variable.
	(variable_set): New function.
	* hash.h (enum ntype), hash.c (nodetypestring): Add VARIABLE.
	* expand_path.c (expand_path, expand_variable): Reindent.
	(expand_variable): Use user variables not environment variables
	for ${=VAR} syntax.  The environment variables didn't work
	client/server.
	* main.c (main): Process new -s global option.
	* client.c (send_variable_proc): New function.
	(start_server): Call it, to send user variables.
	* server.c (serve_set): New function.
	(requests): Add Set request.
	* sanity.sh: Revise info test to use user variables rather than
	environment variables.

Sat Feb 10 16:55:37 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	By itself this is only a small cleanup, but in the long run it
	will be way cool (for reference, it takes CVS's text segment from
	290816 bytes to 294912, which I expect will be made up by future
	changes which this enables):
	* cvs.h (struct file_info): Added.
	(FILEPROC): Replace 5 args with single struct file_info *.
	* recurse.c (do_file_proc): Adjust args to fileproc; passed in
	instead of from globals.
	(do_recursion): Call do_file_proc accordingly.  Remove srcfiles
	global variable.
	* update.c (update_fileproc): Renamed from update_file_proc.
	* admin.c, client.c, commit.c, diff.c, edit.c, log.c, patch.c,
	remove.c, rtag.c, status.c, tag.c, update.c, watch.c: Update
	fileprocs to new calling convention.

Fri Feb  9 15:30:32 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* expand_path.c (expand_variable): Accept a variable name starting
	with '=' as a way to specify an environment variable.
	* sanity.sh (info): New tests, for above behavior.

	* Makefile.in (clean): Also remove check.log check.plog.

	* import.c (comtable): Remove SYSTEM_COMMENT_TABLE; the table
	should *not* depend on what kind of machine the server happens to
	be.  Add "mak", "rc", "dlg", "frm", and "bas" types which were
	formerly included via SYSTEM_COMMENT_TABLE.

	* cvs.h, rcs.h, add.c, checkin.c, classify.c, commit.c, diff.c,
	import.c, patch.c, rcs.c, update.c, vers_ts.c: Remove
	DEATH_SUPPORT ifdefs.  They were introduced to facilitate merging
	between Cygnus and Berliner variants of CVS, not because it was
	intended to subset CVS this way.  And they clutter up the code
	quite a bit.
	* cvs.h, create_adm.c, main.c, update.c: Likewise, remove
	CVSADM_ROOT ifdefs (it is still a #define, of course).  I believe
	they had a more-or-less similar motivation.

	* sanity.sh: Move setting of HOME from ignore test to the start of
	the tests so it applies to all tests.
	(CVS): Remove -f; the above change takes care of it.

	* rcs.h (RCS_MERGE): Removed; unused.

	* commit.c (checkaddfile): Fix memory leak.

	* admin.c, commit.c, diff.c, log.c, mkmodules.c: Pass -x,v/ to RCS
	commands.

	* rcscmds.c, cvs.h (RCS_checkin): New function.
	* checkin.c, commit.c, import.c: Call it, rather than run_*.
	* cvs.h, commit.c: Remove DEATH_STATE define; the behavior
	which used to be the default (DEATH_STATE) is now the only one.
	Failing to define DEATH_STATE has been commented as obsolete at
	least since CVS 1.5.  We still can read repositories created with
	such a CVS, however.
	* rcs.h, rcs.c: Adjust comments regarding DEATH_STATE.
	* subr.c (make_message_rcslegal): Add comment, describing
	allocation of returned value.

Fri Feb  9 09:53:44 MET 1996  Norbert Kiesel  <nk@@col.sw-ley.de>

	* sanity.sh: use "${testcvs}" instead of "cvs" in devcom tests

	* hash.c: fix "dereferencing a NULL pointer" bug triggered with
	  "cvs watch add"
	(findnode): return NULL if key == NULL
	(hashp): assert (key != NULL)
	
Fri Feb  9 00:46:47 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* rcs.c (RCS_reparsercsfile): Remove unused variable date.

	* myndbm.c (mydbm_load_file): Fix typo ('015' -> '\015').

Thu Feb  8 13:00:00 1996  Jim Kingdon  <kingdon@@peary.cyclic.com>

	* rcs.c (RCS_parse, RCS_parsercsfile, RCS_reparsercsfile),
	fileattr.c (fileattr_read), myndbm.c (myndbm_open):
	Use FOPEN_BINARY_READ.
	* fileattr.c (fileattr_write), myndbm.c (myndbm_close):
	Use FOPEN_BINARY_WRITE.
	* history.c (history_write, read_hrecs): Specify OPEN_BINARY.
	* rcs.c: Remove calls to abort.
	* myndbm.c (myndbm_load_file): Ignore CRs from ends of lines
	if present.
	* myndbm.c, fileattr.c: While I am at it, change \n to \012
	a few places where LF is intended.
	* history.c (history_write): Use getenv ("HOME"), not getpwnam,
	to find home directory.  If it isn't set, just keep going; don't
	print a message.
	* rcscmds.c, cvs.h (RCS_checkout): New function.
	* update.c, checkin.c, commit.c, diff.c, import.c, no_diff.c, 
	patch.c: Call it instead of run_*.
	* patch.c (patch_fileproc): Clean up inconsistent handling of
	noexec flag.
	* rcscmds.c (RCS_*): Pass -x,v/ to RCS commands; elsewhere in
	CVS it is assumed that ,v is a suffix.

Fri Feb  2 14:07:32 1996  J.T. Conklin  <jtc@@rtl.cygnus.com>

	* rcs.h (struct rcsnode): Remove dates field (list of rcsversnodes
 	indexed by date).  CVS maintained this list for each RCS file even
	though it was never used.  This resulted in higher then necessary 
	memory requirements (and run time too).  Even if revision info was
	needed, CVS' List data structure is inappropriate because can't
	handle duplicate keys.  The above was discovered by tracking down
	a memory leak.
	* rcs.c (RCS_reparsercsfile): Don't build dates list.
	(freercsnode): Don't delete dates list.
	(rcsvers_delproc): Free date field.
	(null_delproc): Removed.
	
Thu Feb  1 12:28:33 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* remove.c (cvsremove): Don't tell user the name of the program
	which they use to remove files; we don't have any way of knowing
	that, and besides which they might use a GUI or emacs 'dired' anyway.
	* update.c (update_filesdone_proc, update_dirleave_proc): Call
	unlink_file_dir instead of rm -rf.
	* options.h.in: Remove RM; no longer used.

	* sanity.sh: New tests devcom-a* test "cvs watch add",
	"cvs watch remove", and "cvs watchers".

	* sanity.sh: New test 171a0 tests for watch.c bug just fixed by kfogel.

	* Most .c files: Remove rcsids.
	* cvs.h: Remove USE macro.

Thu Feb  1 13:07:15 1996  J.T. Conklin  <jtc@@rtl.cygnus.com>

	* tag.c, rtag.c: Update various comments to reflect function name
 	changes.

Thu Feb  1 14:14:31 1996  Karl Fogel  <kfogel@@floss.red-bean.com>

        * recurse.c (do_recursion): comment #endif.

        * edit.c (notify_check): surround with #ifdef CLIENT_SUPPORT; else
        CVS won't compile if CLIENT_SUPPORT is undefined.
        
        * edit.h (notify_check): surround declaration with #ifdef
        CLIENT_SUPPORT.

        * watch.c (watch): if argc <= 1, then just give usage (previously
        was "argc == -1").

Thu Feb  1 12:28:33 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* README-rm-add: Remove information which is now in cvs.texinfo.

	* sanity.sh: Remove basic0 tests.  Move a few to new tests
	basica-1a* (but there is no need to test that *every* command
	gracefully does nothing on an empty directory; exhaustive testing
	is impractical and the generic recursion processor handles this
	anyway).

	* sanity.sh: New tests 69a* test use of update -p to restore old
	version of dead file.

Wed Jan 31 18:32:34 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* ChangeLog-9395: Remove duplicate entries from 1996 which
	accidentally got into this file.

	* client.c (read_line, read_from_server): Change "premature end of
	file from server" message to "end of file from server (consult
	above messages if any)" because 99% of the time it means rsh has
	printed an error message and exited.

Wed Jan 31 15:09:51 1996  J.T. Conklin  <jtc@@rtl.cygnus.com>

	* edit.c (ncheck_fileproc): Fix memory leak; free line before
	returning.

Tue Jan 30 18:06:12 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* recurse.c (do_recursion): Add comment about the fact that we
	don't have locks in place at certain points.

Tue Jan 30 09:43:34 1996  Vince Demarco  <vdemarco@@bou.shl.com>

	* edit.c (notify_proc): have notify_proc call expand_path with
	the name of the filter program. The user may have used a
	cvs environmental variable. (Popen will expand it, but it may not
	use the correct value)

Tue Jan 30 09:43:34 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* ChangeLog: take the pre-1996 changes and put them in a new file
	ChangeLog-9395.
	* ChangeLog-9194: Renamed from ChangeLog.fsf.
	* ChangeLog-9194, ChangeLog-9395, ChangeLog: Add additional text
	explaining the difference between all these logs and pointing to
	older logs.
	* Makefile.in (DISTFILES): Add ChangeLog-9194 and ChangeLog-9395;
	remove ChangeLog.fsf.

	* modules.c (do_module): Don't fall through from 'l' to 'o' case
	of option processing switch statement.

Tue Jan 30 06:50:19 1996  J.T. Conklin  <jtc@@rtl.cygnus.com>

	* client.c (send_repository): Fix memory leak; free adm_name
 	before returning.
	* diff.c (diff_file_nodiff): Fix memory leak; free xvers before
 	returning.
	* rtag.c (rtag_fileproc): Fix memory leak; if branch_mode is set,
 	free rev before returning.
	* status.c (status_fileproc, tag_list_proc): Fix memory leak; free
 	return value of RCS_whatbranch.
	* tag.c (tag_fileproc): Fix memory leak; free vers before
 	returning.
	(val_fileproc): Fix memory leak; free return value of RCS_gettag.
	* watch.c (watch_modify_watchers): Fix memory leak; free mynewattr
	before returning.

Tue Jan 30 09:43:34 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* lock.c (readers_exist): If stat gave an error, print an error
	message saying it was from stat, rather than from "reading
	directory".  Skip the message completely if it was an
	existence_error.

	* sanity.sh (branches): New tests (branches off of branches, etc.).

Tue Jan 30 11:55:34 MET 1996  Norbert Kiesel  <nk@@col.sw-ley.de>

	* main.c (main): Add change to run getopt_long twice again.

Mon Jan 29 15:59:31 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	gcc -Wall lint:
	* client.c: Include edit.h

d305 3718
a4022 2

For older changes see ChangeLog-9395.
@


1.1.1.4
log
@New CVS release from Cyclic Software
@
text
@a0 557
Sun May  5 21:39:02 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* vers_ts.c (Version_TS): If sdtp is NULL, go ahead and check
	RCS_getexpand for options.  Fixes binaries and non-unix clients.
	* sanity.sh: Fix binfiles-5.5 to test for the correct behavior
	rather than the buggy behavior which existed when the binfiles-5.5
	test was written.
	(binfiles-14c,binfiles-14f): Likewise.

Sun May  5 17:38:21 1996  Benjamin J. Lee  <benjamin@@cyclic.com>

        Integrated changes submitted by Ian Taylor <ian@@cygnus.com>

        * update.c (update_dirent_proc): cvs co -p doesn't print
        anything when run from an empty directory.

        * import.c (import_descend_dir): Check for a file in the
        repository which will be checked out to the same name as the
        directory.

Thu May  2 13:34:37 1996  Benjamin J. Lee  <benjamin@@cyclic.com>

	* Version 1.7.88

Thu May  2 01:40:55 1996  Benjamin J. Lee  <benjamin@@cyclic.com>

	* server.c (HAVE_INITGROUPS): Use initgroups() only if
        located by configure, in the event a system has crypt(), but
	no initgroups()

Wed May  1 18:05:02 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* sanity.sh (basica): When testing rejection of reserved tag name,
	use BASE instead of RESERVED.

Wed May  1 15:15:11 1996  Tom Jarmolowski  <tjj@@booklink.com>

	* rcs.c (linevector_delete): Only copy up to vec->nlines - nlines,
	not to vec->nlines.

Wed May  1 15:43:21 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* rcscmds.c (RCS_settag): Instead of reserving all tag names
	containing only uppercase letters, reserve only BASE and HEAD.
	* sanity.sh (mflag): Revert 26 Mar change; use all-uppercase tag
	name again.

Wed May  1 15:15:11 1996  Tom Jarmolowski  <tjj@@booklink.com>

	* rcs.c (linevector_add): Move increment of i out of larger
	statement, to avoid assumptions about evaluation order.

Tue Apr 30 15:46:03 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* Version 1.7.87.

	* server.c (check_password): Don't use ANSI string concatenation.
	Reindent function.

Wed Apr 24 17:27:53 1996  Norbert Kiesel  <nk@@col.sw-ley.de>

	* vers_ts.c (Version_TS): xmalloc enough space (1 more
	  byte). Thanks to purify!

Fri Apr 19 11:22:35 1996  Benjamin J. Lee  <benjamin@@cyclic.com>

        * Version 1.7.86

Thu Apr 18 1996  Jim Kingdon  <kingdon@@cyclic.com>

	* client.c (try_read_from_server): Compare return value from fwrite
	with a size_t not an int (Visual C++ lint).

Wed Apr 17 11:56:32 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* client.c (try_read_from_server): New function.
	(read_from_server): Use it.
	(read_counted_file): New function.
	* client.c, server.c: Add Template response.
	* cvs.h (CVSADM_TEMPLATE): Added.
	* logmsg.c (do_editor): If repository is NULL, use CVSADM_TEMPLATE
	file in place of rcsinfo.
	* server.c, server.h (server_template): New function.
	* create_adm.c (Create_Admin): Call it.

Tue Apr 16 13:56:06 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* repos.c (Name_Repository): Fix comments.
	* create_adm.c (Create_Admin): Fix indentation.

Wed Apr 10 16:46:54 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* options.h.in: Include relevant information here rather than
	citing (former) FAQ.

	* ChangeLog-9395: Fix typo in introductory paragraph.

Wed Apr 10 14:55:10 1996  code by Mike Spengler  mks@@msc.edu
	comments by Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* filesubr.c (unlink_file_dir,deep_remove_dir): Don't call unlink
	on something which might be a directory; check using isdir instead.

Wed Apr 10 14:55:10 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* checkout.c (build_dirs_and_chdir): Pass path, not cp, to
	Create_Admin.  The former is the correct update dir.
	* sanity.sh (modules): New tests modules-155* test, for above fix.

Mon Apr  8 13:53:27 1996  Samuel Tardieu  <sam@@inf.enst.fr>

	* rcs.c (annotate_fileproc): If the file is not under CVS control,
	return instead of dumping a core. Don't bug on files with an empty
	first revision.

Fri Mar 29 16:08:28 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* rcs.c (annotate_fileproc): If last line of add-chunk is not
	newline terminated, end the loop when we find that out.

Fri Mar 29 16:59:34 1996  Norbert Kiesel  <nk@@col.sw-ley.de>

	* rcs.c (annotate_fileproc): allow last line of add-chunk not to
	  be newline terminated

Thu Mar 28 10:56:36 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	Add more diff tests:
	* sanity.sh (basic2): Use dotest for test 61.
	(basica): Add test basica-6.2.
	(branches): Add tests branches-14.4 and branches-14.5.
	(basic1): Remove tests 19, 20, 25, and 26.  The only thing this
	might miss out on is diff's interaction with added and removed
	files, but those tests didn't test that very well anyway.

	* rcs.c (RCS_getrevtime): Add comment regarding years after 1999.

	* rcs.c: Add "cvs annotate" command and related code.
	(getrcskey): Move special handling of RCSDESC from here to
	callers.  Handle those keys (desc, log, text) which do not
	end in a semicolon.
	* rcs.h (RCSVers): Add author field.
	* rcs.c (RCS_reparsercsfile): Set it.
	* cvs.h (annotate), main.c (cmd_usage, cmds), client.h client.c
	(client_annotate), server.c (serve_annotate, requests): Usual
	machinery to add a new command.
	* sanity.sh (basica): Test cvs annotate.

	* sanity.sh (branches): More tests, of things like adding files on
	the trunk after a branch has been made.

Tue Mar 26 09:48:49 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* expand_path.c: Don't declare free and xmalloc; cvs.h already
	takes care of that.

	* sanity.sh (mflag): Don't use tag name reserved to CVS.

	NT local changes plus miscellaneous things noticed in the process:
	* import.c (add_rcs_file): Use binary mode to write RCS file.  Use
	\012 where linefeed is intended.  Copy data a small block at a
	time, until we hit EOF, rather than trying to read the whole file
	into memory at once.
	* client.c (send_modified): Add comments regarding st_size.
	* commit.c (commit): Add comments regarding binary mode and read().
	* logmsg.c (do_editor): Add comments regarding st_size.
	* server.c (server_updated): Use binary mode to read file we are
	sending.

	* rcscmds.c (RCS_settag): Complain if user tries to add a tag name
	reserved to CVS.
	* sanity.sh (basica): Test for this behavior.

	* sanity.sh (binfiles): New tests test ability to change keyword
	expansion.

Mon Mar 25 1996  Jim Kingdon  <kingdon@@cyclic.com>

	* cvs.h, filesubr.c (expand_wild): New function.
	* recurse.c (start_recursion): Call expand_wild at beginning and
	free its results at the end.
	* cvs.h, subr.c (xrealloc): Make argument and return value void *.
	* client.h, client.c (send_file_names): Add flags argument.   If
	SEND_EXPAND_WILD flag is passed, call expand_wild at beginning and
	free its results at the end.
	* admin.c, add.c, log.c, tag.c, status.c, edit.c, watch.c,
	update.c, commit.c, remove.c, client.c, diff.c: Update callers.

Fri Mar 22 10:09:55 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* error.c (error, fperror): Exit with status EXIT_FAILURE rather
	than STATUS.  We had been neglecting to check for 256, and the
	value of providing a count of errors is probably minimal anyway.
	* add.c, modules.c, mkmodules.c, tag.c, server.c, main.c,
	import.c, client.c, scramble.c, recurse.c: Exit with status
	EXIT_FAILURE rather than 1.  On VMS, 1 is success, not failure.
	* main.c (main): Return EXIT_FAILURE or 0.  The value of providing
	a count of errors is minimal.

	* client.c (init_sockaddr): Exit with status 1 rather than
	EXIT_FAILURE.  The latter apparently doesn't exist on SunOS4.
	Reindent function.

Mon Mar 18 14:28:00 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* cvs.h, ignore.c: New variable ign_case.
	* ignore.c (ign_name): If it is set, match in a case-insensitive
	fashion.
	* server.c (serve_case): New function.
	(requests): Add Case request.
	* client.c (start_server): If FILENAMES_CASE_INSENSITIVE is
	defined, send Case request.

Sat Mar 16 08:20:01 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	For reference, this change takes cvs's text segment from 315392
	bytes to 311296 bytes (one 4096 byte page).
	* cvs.h (struct file_info): Add fullname field.
	* recurse.c (do_file_proc): Set it.
	* commit.c (find_fileproc), client.c (send_fileproc), commit.c
	(check_fileproc), diff.c (diff_fileproc), edit.c
	(unedit_fileproc), patch.c (patch_fileproc), remove.c
	(remove_fileproc), rtag.c (rtag_fileproc), tag.c (tag_fileproc),
	update.c (update_fileproc), watch.c (watchers_fileproc): Use it
	instead of computing it each time.
	* diff.c (diff_fileproc), remove.c (remove_fileproc): Use fullname
	where we had been (bogusly) omitting the directory from user
	messages.
	* edit.c (unedit_fileproc, edit_fileproc): If we cannot close
	CVSADM_NOTIFY, mention CVSADM_NOTIFY rather than finfo->file in
	error message.
	* rtag.c (rtag_fileproc), tag.c (tag_fileproc): Reindent.

Fri Mar 15 15:12:11 1996  Norbert Kiesel  <nk@@col.sw-ley.de>

	* server.h: fix prototype of server_pause_check (was
	  server_check_pause)

Thu Mar 14 1996  Jim Kingdon  <kingdon@@cyclic.com>

	* vers_ts.c (Version_TS), entries.c (Scratch_Entry, AddEntryNode):
	Change findnode to findnode_fn.

	* main.c: Depending on HAVE_WINSOCK_H, include winsock.h or
	declare gethostname.
	* cvs.h: Don't declare it here.

Thu Mar 14 07:06:59 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* commit.c (find_fileproc): If vn_user is NULL and ts_user is not,
	print an error rather than silently succeeding.
	* sanity.sh (basica-notadded): New test, for above fix.
	(dotest_internal): New function.
	(dotest,dotest_fail): Call it instead of duplicating code between
	these two functions.

	* sanity.sh: Skip tests binfiles-9 through binfiles-13 for remote.

	* options.h.in: Adjust comment to reflect kfogel change.

Thu Mar 14 01:38:30 1996  Karl Fogel  <kfogel@@floss.red-bean.com>

        * options.h.in (AUTH_CLIENT_SUPPORT): turn on by default.

Wed Mar 13 09:25:56 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* vers_ts.c (Version_TS): Don't try to override options from rcs
	file if there isn't an rcs file (e.g. called from send_fileproc).
	This fixes a bug detected by test 59 in "make remotecheck".

	* rcs.c (RCS_reparsercsfile, RCS_getexpand): Assert that argument
	is not NULL.

	Fix a gcc -Wall warning:
	* rcs.c, rcs.h (RCS_getexpand): New function.
	* vers_ts.c (Version_TS): Call it.
	* rcs.c (RCS_reparsercsfile): Make static.

	Add a "cvs init" command.  This is needed because cvsinit.sh
	invoked mkmodules which doesn't exist any more.
	* mkmodules.c: Break filelist out of mkmodules function, rename
	struct _checkout_file to struct admin_file (for namespace
	correctness), and add contents field.
	(init,mkdir_if_needed): New functions.
	* cvs.h (init): Declare.
	* main.c (cmds): Add init.
	(main): If command is init, don't require cvsroot to exist.
	* client.c, client.h (client_init, send_init_command): New functions.
	* client.c (start_server): Don't send Root request if command is init.
	* server.c (serve_init): New function.
	(requests): Add "init".

Wed Mar 13 09:51:03 MET 1996  Norbert Kiesel  <nk@@col.sw-ley.de>

	* vers_ts.c (Version_TS): set options to default option if the
	  file if no -k option but -A was given.  This avoids the (wrong)
	  update message for binary files which are up-to-date when
	  running 'cvs -A'.

	* update.c (checkout_file): remove test of -k option stored in the
	  file itself because it was moved to vers_ts.c

	* sanity.sh: added tests for the above fix.

Tue Mar 12 13:47:09 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* hash.c (findnode): Adjust comment regarding errors.

	* hash.c (findnode, findnode_fn): Assert that key != NULL.  This
	way the check still happens even if the function is later
	rewritten to not start out by calling hashp.

Mon Mar 11 10:21:05 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* sanity.sh: If expr accepts multi-line patterns but is too
	liberal in matching them, print a warning but keep going.

	* sanity.sh: Add QUESTION variable, analogous to PLUS.  Use it
	instead of \? to match a question mark.

	* cvs.h (CVSMODULE_OPTS, CVSMODULE_SPEC): Move from here...
	* modules.c: ...to here.  They are only used here and the code to
	handle the syntax of modules files should not be scattered all over.
	* modules.c (CVSMODULE_OPTS): Add "+" as first character.
	* sanity.sh (modules): New tests 148a0 and 148a1 test for
	above-fixed bug.

Mon Mar 11 13:11:04 1996  Samuel Tardieu  <sam@@inf.enst.fr>

	* modules.c (cat_module): set optind to 0 to force getopt() to
	reinitialize its internal nextchar

Mon Mar 11 00:09:14 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* hash.c (findnode, findnode_fn): Revert changes of 7-8 Mar 1996.
	The correct style is to assert() that key != NULL (see HACKING),
	which is already done in the hashp function.
	* fileattr.c (fileattr_delproc): Likewise, assert() that
	node->data != NULL rather than trying to deal with it being NULL.

Fri Mar  8 01:31:04 1996  Greg A. Woods  <woods@@most.weird.com>

	* hash.c (findnode_fn): one more place to avoid calling hashp()
	with a NULL key

Thu Mar  7 17:30:01 1996  Greg A. Woods  <woods@@most.weird.com>

	* hash.c (findnode): also return NULL if key is not set
	[[ reported by Chris_Eich@@optilink.optilink.dsccc.com, and
	supposedly in a PR that should be marked "fixed"..... ]]

	* fileattr.c (fileattr_set): set node->data to NULL after freeing
	it to prevent subsequent accesses
	(fileattr_delproc): don't free node->data if it's NULL, and set it
	to NULL after freeing
	[[ reported by Chris_Eich@@optilink.optilink.dsccc.com, and
	supposedly in a PR that should be marked "fixed"..... ]]

Fri Mar  1 14:56:08 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* sanity.sh (basica): New test basica-4a tests for bug fixed by
	sam@@inf.enst.fr on 1 Mar 96.

Fri Mar  1 18:10:49 1996  Samuel Tardieu  <sam@@inf.enst.fr>

	* tag.c (check_fileproc): Check for file existence before trying
	to tag it.

Fri Mar  1 07:51:29 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* client.c (update_entries): If command is export, set options to
	NULL.

Thu Feb 29 16:54:14 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* lock.c (write_lock, Reader_Lock): Remove
	BOGUS_UNLESS_PROVEN_OTHERWISE code.  It was pretty bogus, and has
	been ifdeffed out for a long time.
	* cvs.h (CVSTFL): Removed; no longer used.

	* cvsrc.c, cvs.h (read_cvsrc): Pass in command name rather than
	using global variable command_name.
	* main.c (command_name): Initialize to "", not "cvs" so that error
	messages don't say "cvs cvs".  Update calls to read_cvsrc to pass
	in command_name or "cvs" as appropriate.
	* sanity.sh (basica): New test basica-9 tests for above-fixed bug.

	* lock.c: Rename unlock to lock_simple_remove to avoid conflict
	with builtin function on QNX.

Thu Feb 29 17:02:22 1996  Samuel Tardieu  <sam@@inf.enst.fr>

	* fileattr.c (fileattr_get): Removed NULL pointer dereference
	which occurred in the absence of default attribute.

Thu Feb 29 07:36:57 1996  J.T. Conklin  <jtc@@rtl.cygnus.com>

	* rcs.c (RCS_isbranch, RCS_whatbranch): Remove no longer used file
 	argument, swap order of remaining two arguments to be like other
	RCS_* functions.
	(RCS_nodeisbranch): swap order of arguments to be like other RCS_*
	functions.
	* rcs.h (RCS_isbranch, RCS_whatbranch, RCS_nodeisbranch): Update
	prototypes for above changes.
	* commit.c, rtag.c, status.c, tag.c: Update for above calling
 	convention changes.

Thu Feb 29 08:39:03 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* client.c (start_server): Revert changes which claimed to fall
	back to a different way of connecting.  Add comments explaining
	why.  (I don't think the changes did what they claimed, anyway).
	Use indentation rather than comments to line up #if, #else, and
	#endif.

	* patch.c (patch, patch_fileproc): Revert change to add optional
	arguments to -c and -u.  Optional arguments are evil and in
	violation of the POSIX argument syntax guidelines.  The correct
	way to do this is -C and -U.  Also change DIFF back to "diff" in
	output (see comments).

	gcc -Wall lint:
	* client.c (copy_a_file): Declare p inside the #ifdef in which is
	it used.
	* commit.c (remove_file): Remove unused variable p.
	* commit.c (checkaddfile): Remove unused variables p.
	* rcs.c (RCS_isbranch): Remove unused variable p.
	* rcs.c: Remove unused declarations and definitions of
	parse_rcs_proc, rcsnode_delproc, rcslist, and repository.
	* rtag.c (rtag_fileproc): Remove unused variable p.
	* patch.c (patch_fileproc): Remove unused variable p.
	* tag.c (val_fileproc): Remove unused variable node.
	* client.c, import.c, lock.c, server.c: Cast pid_t to long before
	passing it to %ld.

	* cvs.h: Don't prototype gethostname; merely declare it (on linux,
	second argument is size_t not int).

Thu Feb 29 10:29:25 MET 1996  Norbert Kiesel (nk)  <nk@@col.sw-ley.de>

	* sanity.sh: added "cat > /dev/null" to loginfo entry to avoid the
	  SIGPIPE signal

Thu Feb 29 10:28:25 MET 1996  Norbert Kiesel (nk)  <nk@@col.sw-ley.de>

	* patch.c: added new variable diff_opt
	(patch): allow optional parameter to -c and -u option, send it to
	server
	(patch_fileproc): cleaned up the code which prints the current
	filename.  For "-s" option, print the pathname relative to CVSROOT
	instead of just the filename.

	* filesubr.c (xchmod): added cast to shut up gcc

	* cvs.h: added prototype for gethostname

Thu Feb 29 10:27:25 MET 1996  Norbert Kiesel (nk)  <nk@@col.sw-ley.de>

	* lock.c (write_lock), (Reader_Lock), import.c (update_rcs_file),
	  client.c (update_entries), (send_modified), server.c (server),
	  (receive_file), (server_updated): use %ld for printing pid_t
	  variables

Thu Feb 29 02:22:12 1996  Benjamin J. Lee  <benjamin@@cyclic.com>

	* run.c (run_exec): Added VMS return status support.

Thu Feb 29 01:07:43 1996  Benjamin J. Lee  <benjamin@@cyclic.com>

	* client.c (send_to_server): wrtn wasn't being declared under
	VMS for some reason.

Wed Feb 28 23:27:04 1996  Benjamin J. Lee  <benjamin@@cyclic.com>

	* client.c: Changed #ifdef VMS && NO_SOCKET_TO_FD to
	#if defined(VMS) && defined(NO_SOCKET_TO_FD)

Wed Feb 28 22:28:43 1996  Benjamin J. Lee  <benjamin@@cyclic.com>

	* build_src.com: Added DCL command procedure to build
	and link CVS client for VMS.

Wed Feb 28 22:07:20 1996  Benjamin J. Lee  <benjamin@@cyclic.com>

	* client.c: VMS CVS client specific changes.

	Added USE_DIRECT_TCP to allow CVS_PORT to be used to specify
	a TCP connection port (no Kerberos).  Changed
	start_kerberos_server() to start_tcp_server().

	In copy_a_file(): transform a backup file to have a
        VMS-friendly name. 

	Added HAVE_CONFIG_H to include "config.h".  

	start_server() will starts the first successful of any
	mutually exclusive methods of starting the CVS server
	which might be enabled.

	Initialized use_socket_style and server_sock for VMS in
	start_server().

Wed Feb 28 21:49:48 1996  Benjamin J. Lee  <benjamin@@cyclic.com>

	* find_names.c, recurse.c, cvs.h: Changed Find_Dirs() to
	Find_Directories().
	* cvs.h: Added VMS filenames enabled through USE_VMS_FILENAMES
	VMS POSIX will require to use the regular CVS filenames
	while VMS is #define'd.

Wed Feb 28 21:26:22 1996  Benjamin J. Lee  <benjamin@@cyclic.com>

	* ignore.c: Added the patterns *.olb *.exe _$* *$ to default
	ignore list for VMS.

Wed Feb 28 13:32:28 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* logmsg.c (do_editor): Fix indentation.

Wed Feb 28 12:56:49 1996  Benjamin J. Lee  <benjamin@@cyclic.com>

	* logmsg.c (do_editor): If no editor is defined, exit and print
	a message.

Wed Feb 28 10:40:25 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* vers_ts.c (time_stamp, time_stamp_server): Reindent and revise
	comments.

Tue Feb 27 23:57:55 1996  Benjamin J. Lee  <benjamin@@cyclic.com>

	* vers_ts.c: gmtime() returns NULL on some systems (VMS)
	revert to local time via ctime() if GMT is not avaiable.

Tue Feb 27 13:07:45 1996  J.T. Conklin  <jtc@@rtl.cygnus.com>

	The changes listed below cause cvs to parse each rcs file (and
 	free the associated rcsnode after the file has been processed)
 	sequentially.  cvs used to parse all files in a directory, an
	approach that does not scale to huge repositories with lots 
	of revisions/branches/tags/etc.  
	
	* cvs.h (struct file_info): Removed srcfiles field.  Added rcs
 	(node) field.
	* recurse.c (do_recursion): Removed code that pre-parsed all
 	rcs files in the directory.
	(do_file_proc): Parse current rcs file.
	* rcs.c (RCS_parsefiles, parse_rcs_proc, RCS_addnode): Removed.
	(RCS_isbranch, RCS_whatbranch): Changed srcfiles argument to
	rcs (node).
	* rcs.h (RCS_parsefiles, RCS_addnode): Removed prototypes.
	(RCS_isbranch, RCS_whatbranch): Updated prototypes.
	* add.c, admin.c, checkin.c, checkout.c, classify.c, client.c, 
	commit.c, diff.c, history.c, import.c, log.c, patch.c, remove.c, 
	rtag.c, status.c, tag.c, update.c, vers_ts: Updated for above
	calling convention / data structure changes.

a1 2

	* Version 1.7.3.
@


1.1.1.5
log
@New release from Cyclic Software
@
text
@a0 2214
Fri Oct  4 15:11:46 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* server.c (server_cleanup): Temporarily clear noexec when calling
	unlink_file_dir.  This is so we clean up the temp directory even
	when the -n global option is specified.

Wed Oct  2 10:47:33 1996  Norbert Kiesel  <nk@@col.sw-ley.de>

	* client.c (send_repository): initialize some variables before
 	first usage

Tue Oct  1 13:01:24 1996  Jim Blandy  <jimb@@floss.cyclic.com>

	Revert some of Greg's changes; they're welcome later, but we're
	trying to keep CVS stable for pre-release testing at the moment. 
	* checkin.c, commit.c, cvs.h, diff.c, import.c, main.c, no_diff.c,
	options.h.in, patch.c, rcs.c, rcs.h, rcscmds.c, sanity.sh, update.c:
	Revert changes of Sep 29 and 30.

Tue Oct  1 13:17:31 1996  Ian Lance Taylor  <ian@@cygnus.com>

	Make sure the server temporary directory is removed even if
	Max-dotdot is used.
	* server.c (orig_server_temp_dir): New static variable.
	(serve_max_dotdot): Don't free server_temp_dir if it is the same
	as orig_server_temp_dir.
	(do_cvs_command): Use orig_server_temp_dir in error message.
	(server_cleanup): Remove orig_server_temp_dir.
	(server): Set orig_server_temp_dir.  Remove incorrect indentation
	of error message.

	* import.c (update_rcs_file): Restore new argument to
	RCS_checkout, removed in last patch.

Tue Oct  1 00:32:55 1996  Jim Blandy  <jimb@@floss.cyclic.com>

	* import.c: Revert Greg Woods' changes of Sep 30.  We may want
	them later, but not before 1.9.

Mon Sep 30 23:31:01 1996  Jim Blandy  <jimb@@floss.cyclic.com>

	* log.c (log_fileproc): Now that we might actually find a "desc"
 	node in rcsfile->other, thanks to Ian's change below, we had
 	better deal correctly if we find a null pointer in it.

Mon Sep 30 13:55:03 1996  Greg A. Woods  <woods@@most.weird.com>

	* main.c (main): don't set need_to_create_root for "cvs init"
	either, just in case it's run from within a valid working
	directory.

	* sanity.sh (testcvs): oops, forgot to comment out test version I
 	was using...

	* diff.c (diff_fileproc): use Diffbin instead of DIFF (3).
	* patch.c (patch_fileproc): use Diffbin instead of DIFF.
	* commit.c (check_fileproc): use Grepbin instead of GREP.
	* rcscmds.c (RCS_merge): use Grepbin instead of GREP.
	* update.c (patch_file): use Diffbin instead of DIFF.
	(update_fileproc): use Grepbin instead of GREP.
	* cvs.h (Diffbin): new declaration.
	(Grepbin): new declaration.
	(DIFFBIN_ENV): new manifest to name DIFFBIN environ var.
	(GREPBIN_ENV): new manifest to name GREPBIN environ var.
	* option.h.in (DIFFBIN_DFLT): renamed from DIFF.
	(GREPBIN_DFLT): renamed from GREP.
	* main.c (main): new variables diffbin_update_env and
	grepbin_update_inv, ala rcsbin_update_env.
	(main): new options -D diffbin and -g grepbin
	(usg): describe new options -D diffbin and -g grepbin.
	(Diffbin): new global variable for DIFF path.
	(Grepfbin): new global variable for GREP path.

	* options.h.in (RCSBIN_DFLT): mention this needs to be set if
	your PATH isn't set properly by rshd.

	* sanity.sh (rdiff): re-do Jim's change, but with the original
	keywords I had intended (should be a bit more like real life), and
	Jim's better RCS date and user matching form.
	[I guess that's what I get for checking things in at 3am! ;-)]

Mon Sep 30 17:00:20 1996  Ian Lance Taylor  <ian@@cygnus.com>

	* rcs.c (RCS_reparsercsfile): Store desc field value in main RCS
	node data, not in version specific data.
	* sanity.sh: Enable log2 test (for local CVS only).

Mon Sep 30 13:01:45 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* sanity.sh (log2): New test, tests cvs add -m.  Not yet enabled
	in "tests" because CVS currently flunks this test.

	* sanity.sh (rdiff, basic2): Allow "cvs server" as well as "cvs
	checkout" and friends in messages.  In testing output of cvs
	status, don't require a tab which isn't there for remote.  Skip
	test rdiff-9 for remote.  In test basic2-64, add missing slash in
	the pattern which gets used for remote.

	* sanity.sh (rdiff): Fix strings we were matching against which
	got keyword-expanded in checking in sanity.sh.

Mon Sep 30 03:21:37 1996  Greg A. Woods  <woods@@most.weird.com>

	* sanity.sh: change all regexpr literal '.' to '\.'
 	(basic2): why are tests 34 & 42 commented out (because
	of 'diff -u'?)?
	add tests 56[abc], 57a, and 58a to test import to the main
	branch (i.e. branch '1').
	(rdiff): new test section for rdiff -K, etc.
	(dotest): remove dotest.ex? before running a new test.
	(dotest_fail): remove dotest.ex? before running a new test.
	(dotest_internal): write expected output to dotest.exp, or if $4
	also used, to dotest.ex1 and dotest.ex2.
	(patch): renamed this test to 'serverpatch'.
	(dotest_lit): rename dotest.res to dotest.exp ala dotest().
	remove dotest.ex? before running a new test.
	(DOTSTAR): mention the bug exists up to 1.12
	(ENDANCHOR): mention the bug exists up to 1.12
	(dotest_all_in_one): new function for debugging.
	(dotest_line_by_line): new function for debugging.
	(dotest_internal_debug): new function for debugging.
	(dotest_internal): stop emulating the ancient tests and don't spew
	the dotest.tmp contents onto $LOGFILE -- it's just too much
	meaningless noise.  Only do this if the test fails.  Many tests
	don't use dotest() yet, so this isn't quite so helpful as it might
	otherwise be.
	(TODO): mention CVS/* files, especially CVS/Root.
	
	* main.c (main): add a commented out piece of code to suggest that
	there should be a function lookup_command_attribute() that could
	tell us various things about internal commands, such as whether
	they use CVS/Root, or if they're repository-only, or if they need
	a working directory, etc....
	(main): don't set need_to_create_root if command doesn't use a
	local working directory.

	* patch.c (patch): CLIENT_SUPPORT: send '-f' if NOT force_tag_match

	* error.c (fperror): protect declaration for un-defined __STDC__

	* import.c (import): permit imports to a branch with zero dots,
	i.e. the trunk.
	(update_rcs_file): don't detect conflicts if importing to the
	trunk.
	(import): add hint that we should allow a module name, instead of
	just a pathname relative to $CVSROOT.
	(add_rcs_file): if importing to trunk, do it with ci(1).

	* import.c: XXX the following are all #if 0'ed out until a full
	implementation can be designed....
	(cbranch): new variable to support conflict detection on another
	branch set by -c.
	(import): truncate -b and -c optarg if to fit in static storage.
	(import_usage): describe -c

	* rcscmds.c (RCS_checkout): add new argument 'rcsver'.  If rcsver
	is set, turn on 'keywords' to force call to RCS_exec_checkout.
	* rcs.c (RCS_exec_checkout): add new argument 'rcsver'.  Pass
	'rcsver' to "co" with run_arg().
	* cvs.h: (RCS_checkout): add new argument 'rcsver' to prototype.
	(RCS_exec_checkout): add new argument 'rcsver' to prototype.
	* commit.c (remove_file): supply new argument to RCS_checkout.
	* checkin.c (Checkin): supply new argument to RCS_checkout.
	* diff.c (diff_fileproc): supply new argument to RCS_checkout.
	(diff_file_nodiff): supply new argument to RCS_checkout.
	* no_diff.c (No_Difference): supply new argument to RCS_checkout.
	* update.c (checkout_file): supply new argument to RCS_checkout.
	(patch_file): supply new argument to RCS_checkout.
	(join_file): supply new argument to RCS_checkout.

	* patch.c: (o_options): new variable for -K
	(rcsver): new variable for -V.
	(patch): add -K flag which sets o_options, change -V to set
	rcsver, send o_options and rcsver if in client mode.
	(patch_fileproc): use RCS_checkout instead of RCS_fast_checkout in
	order to ensure $Name is expanded, use o_options if set, or
	options if set, or by default "-ko" when getting "old" file.

Sun Sep 29 16:43:28 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* rcscmds.c: Replace comment at top of file concerning RCS library
	with a reworded version based on discussion between me, Ian, Paul
	Eggert, and JimB.

Sun Sep 29 13:09:45 1996  Noel Cragg  <noel@@kiva.rain.org>

	* main.c (main): don't create/update CVS/Root when doing the "cvs
 	login" command.  Consider: if the user executes "cvs login" with
 	the working directory inside an already checked out module, we'd
 	incorrectly change the CVS/Root file to reflect the CVSROOT of the
 	"cvs login" command.

	* login.c (login): if we're re-logging into a server for which a
 	.cvspass entry already exists, copy the temporary file to its home
 	location rather than renaming.  Renaming doesn't work between
 	filesystems.  After copying, unlink the temporary file.

Fri Sep 27 05:24:56 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* diff.c: Add comment about --brief option.

	* README-rm-add: Removed; the information which was here is now in
	cvs.texinfo.
	* Makefile.in (DISTFILES): Remove README-rm-add.

Wed Sep 25 10:00:00 1996  Larry Jones  <larry.jones@@sdrc.com>

	* Makefile.in (cvsbug): Add dependency on version.c.

Wed Sep 25 09:01:48 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* filesubr.c (get_homedir), update.c (update): Reindent.

Wed Sep 25 04:44:54 1996  Jim Blandy  <jimb@@totoro.cyclic.com>

	* version.c (version_string): Bump to 1.8.86.

Wed Sep 25 05:17:50 1996  Jim Blandy  <jimb@@floss.cyclic.com>

	* update.c (update): Don't neglect to pass the -kmumble options
	to the server.
	* sanity.sh (binfiles-sticky): New tests for above.

	* cvsrc.c (read_cvsrc): Deal correctly with lines that specify a
	command, but no options; don't corrupt argv.

	* sanity.sh: When testing rsh, use the program specified by
 	the CVS_RSH environment variable, if it's set.  Move test to top
	of file, so it runs before all other tests (it's really a
	meta-test).

	* filesubr.c (get_homedir): Use getpwuid to find the home
	directory, if the HOME environment variable isn't set.
	* ignore.c (ign_add_file): Call get_homedir to find the user's
	home directory; this is more portable than calling getpwuid.

Tue Sep 24 09:08:17 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* log.c (log_tree): When walking through branches, follow the
	->prev field rather than following ->next which insures that the
	loop only executes once and we only see the last branch.
	* sanity.sh (multibranch): Test "cvs log" too; tests for above fix.

Mon Sep 23 09:55:22 1996  Norbert Kiesel  <nk@@col.sw-ley.de>

	* options.h.in: Fixed some typos in the comments and reindented
 	them.

Sat Sep 21 02:33:26 1996  Jim Blandy  <jimb@@totoro.cyclic.com>

	* sanity.sh: If we're testing remote CVS, make sure rsh itself is
	working before running any tests.  It's confusing when basica-1
	fails just because you don't have the local host in your .rhosts
	file.

	* version.c (version_string): Bump to 1.8.85.

Thu Sep 19 09:15:41 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* options.h.in: Define SERVER_FLOWCONTROL, SERVER_HI_WATER,
	SERVER_LO_WATER.  Several large sites (FreeBSD, Cygnus) have been
	pounding on this code without problems, and it doesn't seem to
	have any significant downsides.

Tue Sep 17 01:13:41 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* status.c (status_fileproc): Instead of a default case, set sstat
	before the switch.  This way gcc -Wall can detect a missed case.
	Add explicit T_TITLE case.

Tue Sep 17 00:09:44 1996  Assar Westerlund  <assar@@pdc.kth.se>

	* login.c (login): Print usage if argc < 0.

Tue Sep 17 00:09:44 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* lock.c: In comment, mention one more function of readlocks
	(fileattr not updated atomically).  Note similarity between
	solutions #2 and #5.

	* checkout.c (safe_location): Do not reject a location merely
	because it textually starts with hardpath; insist that it be
	hardpath or a subdirectory thereof.

Mon Sep 16 11:46:36 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* server.c (server_cleanup): Add comment about ignoring errors
	from unlink_file_dir.

Mon Sep 16 10:31:48 1996  Norbert Kiesel  <nk@@col.sw-ley.de>

	* main.c: Add support for -T <tmpdir> command line option.  This
 	is needed for servers started via inetd.
	(usg): Added line for -T.  Improved -z documentation.
	(main): Read default for tmpdir from the environment. Test for 'T'
	in getopt loop.  Use '/tmp' as ultimative fallback.  Update
	environment if possible.

	* cvs.h (TMPDIR_ENV): Added for -T <tmpdir> command line option.

	* options.h.in: Add TMPDIR_DFLT

	* import.c (update_rcs_file): Use global variable Tmpdir instead
 	of reading the environment.

	* server.c (server_cleanup): Use global variable Tmpdir instead of
 	reading the environment.  Also, replace system("rm -rf") with
 	unlink_file_dir.
	(server): Use global variable Tmpdir instead of reading the
 	environment.

Thu Sep 12 1996  Jim Kingdon  <kingdon@@cyclic.com>

	* main.c (main): If ARGV0_NOT_PROGRAM_NAME, then just set
	program_name to "cvs" rather than argv[0].

Thu Sep 12 12:06:56 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* client.c (update_entries): If we can't write the file, don't
	make it a fatal error.

Wed Sep 11 12:46:23 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* client.c (start_server): Move START_SERVER_RETURNS_SOCKET code
	so that it is only run for server_method.  It is wrong for
	pserver_method (in which connect_to_pserver sets server_sock).

	* login.c (construct_cvspass_filename): If NO_SLASH_AFTER_HOME,
	don't put a '/' between $HOME and .cvspass.  Reindent function.
	* build_src.com: Add zlib.c, login.c, and scramble.c.

	* rcs.c (RCS_deltas): When looking for our branch in ->branches,
	check the branch number.
	* sanity.sh (multibranch): New tests test for above fix.

	* commit.c (precommit_list_proc): Fix typo in last change
	(->status to ->type).

Tue Sep 10 23:05:41 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* Makefile.in (DISTFILES): Add build_src.com.
	* build_src.com: Add buffer.c, buffer.obj, and zlib.olb.

Tue Sep 10 20:35:23 1996  Juergen Renz  <renz@@conware.de>
			  and Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* commit.c (precommit_list_proc): Update to reflect Jul 22 change
	in which p->data was changed from a Ctype to a struct
	logfile_info *.  This means that commitinfo scripts again get
	passed the file	list like they should.

Tue Sep 10 20:35:23 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* client.c (auth_server_port_number): Change name of service from
	"cvs" to "cvspserver".  The latter is what the manual has always
	recommended, and it is also officially registered with IANA.

Tue Sep 10 11:12:42 1996  Mark A. Solinski <markso@@mcs.com>
			  and Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* client.c (socket_buffer_output): Change ifdef VMS to ifdef
	SEND_NEVER_PARTIAL. 
	(start_server): Change ifdef VMS to ifdef START_SERVER_RETURNS_SOCKET.

Tue Sep 10 17:15:21 1996  Jim Blandy  <jimb@@totoro.cyclic.com>

	* client.c (auth_server_port_number): Look up "cvs" in the
 	services database, and use the value it returns; fall back to
	CVS_AUTH_PORT if no entry is present.
	(connect_to_pserver): Use the correct port number in any error
	messages.

Tue Sep 10 11:12:42 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* sanity.sh (newb): New test newb-123j0 tests for another "cvs
	status" case.

Sun Sep  8 15:20:37 1996  Ian Lance Taylor  <ian@@cygnus.com>

	* rcs.c (RCS_checkout): Clarify handling of options parameter.

	* rcs.c (RCS_checkout): Free buffer allocated by RCS_deltas.

Sat Sep  7 21:28:27 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* main.c (struct cmd): Add comment concerning recognizing unique
	abbreviations.

Fri Sep  6 22:31:52 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* rcs.c (RCS_checkout): Fix indentation.

Fri Sep  6 11:48:08 1996  Ian Lance Taylor  <ian@@cygnus.com>

	* rcs.c (RCS_checkout): Replace tag parameter with rev and nametag
	parameters.  Change all callers.
	* rcs.h (RCS_checkout): Update declaration.

	* rcs.c (RCS_getversion): Replace return_both parameter with
	simple_tag.  Change all callers.
	(RCS_gettag): Likewise.
	* rcs.h (RCS_getversion, RCS_gettag): Update declarations.
	* vers_ts.c (Version_TS): Simplify vn_tag initialization using new
	simple_tag rather than old return_both.
	* cvs.h (struct vers_ts): Clarify vn_tag comment a bit.

	* main.c (usg): Only mention -x if ENCRYPTION is defined.
	(main): Mention ENCRYPTION define in comment for -x.
	* client.h (krb_encrypt_buffer_initialize): Only declare if
	ENCRYPTION is defined.
	* client.c (start_server): Only encrypt if ENCRYPTION is defined.
	* server.c (serve_kerberos_encrypt): Only define if ENCRYPTION is
	defined.
	(requests): Only include Kerberos-encrypt is ENCRYPTION is
	defined.
	(krb_encrypt_*): Only define if ENCRYPTION is defined.

Thu Sep  5 17:32:39 1996  Ian Lance Taylor  <ian@@cygnus.com>

	* sanity.sh: When testing remote, use :ext: instead of :server: to
 	match change made earlier today.

Thu Sep  5 13:57:47 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* client.c (start_tcp_server): Don't allow :kserver: to mean
	"direct tcp" (root.c already takes care of this, but I want to
	make it clear what is intended, and not intended, here).
	(start_server): Handle ext_method (external rsh program) and
	server_method (internal rsh client) separately.
	* client.c: Take rsh_pid and start_rsh_server out of
	RSH_NOT_TRANSPARENT ifdefs.  It is useful for things like SSH on NT.
	* cvs.h (CVSmethod), root.c (method_names): Add ext_method.
	* root.c (parse_cvsroot): Recognize "ext" access method.
	If access method is not specified and CVSROOT contains a colon,
	use either ext_method or server_method depending on
	RSH_NOT_TRANSPARENT.

Thu Sep  5 00:09:49 1996  Ian Lance Taylor  <ian@@cygnus.com>

	* rcs.c (RCS_checkout): Remove flags parameter, which was not
	serving any useful purpose.  Change all callers.
	* rcscmds.c (RCS_exec_checkout): Likewise.

	* rcscmds.c (RCS_exec_checkout): Rename from RCS_checkout.  Change
	all callers.
	* rcs.c (RCS_checkout): Rename from RCS_fast_checkout.  Change all
	callers.

Wed Sep  4 14:42:28 1996  Ian Lance Taylor  <ian@@cygnus.com>

	* rcs.c (RCS_fast_checkout): If tracing, output a message.  If
	noexec, and workfile is not NULL, just return immediately.  Assert
	that sout is RUN_TTY or workfile is NULL, rather than using it as
	a conditional.  Replace found variable with two variables--gothead
	and keywords--reflecting what it actually means.

	* rcs.c (RCS_fast_checkout): Don't handle the case of workfile set
	to "".
	* rcscmds.c (RCS_checkout): Likewise.
	* checkin.c (Checkin): Pass explicit file name, not "", to
	RCS_fast_checkout.
	* update.c (join_file): Likewise.
	* commit.c (remove_file): Pass explicit file name to
	RCS_fast_checkout and RCS_checkin.

	* rcs.c (RCS_reparsercsfile): Always continue after seeing
	RCSSYMBOLS, even if the value is NULL.  Clear the NODELTA flag
	after setting delta_pos.
	(free_rcsnode_contents): New static function.
	(freercsnode): Call free_rcsnode_contents.
	(RCS_fast_checkout): If NODELTA is set, reparse the RCS file.
	(RCS_settag): New function.  Change all callers to old function.
	(RCS_deltag, RCS_setbranch): Likewise.
	(RCS_lock, RCS_unlock): Likewise.
	(RCS_deltas): If NODELTA is set, reparse the RCS file.
	* rcs.h (NODELTA): Define.
	(RCS_settag, RCS_deltag, RCS_setbranch): Declare.
	(RCS_lock, RCS_unlock): Declare.
	* rcscmds.c (RCS_exec_settag): Rename from RCS_settag.  Don't
	check tag against BASE or HEAD (now done in new RCS_settag).
	(RCS_exec_deltag): Rename from RCS_deltag.
	(RCS_exec_setbranch): Rename from RCS_setbranch.
	(RCS_exec_lock): Rename from RCS_lock.
	(RCS_exec_unlock): Rename from RCS_unlock.
	* cvs.h: Update declarations of renamed functions.
	* checkin.c (Checkin): Remove rcscopy variable (no longer needed
	because of change in RCS_unlock call).
	* commit.c: Include <assert.h>.
	(remove_file): Update RCSNode path if the file is renamed.
	(unblockrcs): Change rcs parameter to RCSNode.  Change all
	callers.
	(fixbranch): Likewise.
	(lock_RCS): Likewise.  Don't call RCS_parsercsfile.
	(checkaddfile): Update RCSNode path if the file is renamed.  After
	creating a new file, call RCS_parse.  When stubbing a branch, use
	the passed in RCSNode if there is one, rather than calling
	RCS_Parse.  Don't call RCS_Parse again after calling RCS_settag.
	Free head and magicrev even if RCS_settag fails.
	* import.c (add_rev): Change rcs parameter to RCSNode.  Change all
	callers.
	(add_tag): Likewise.

	* rcs.c (RCS_fast_checkout): Amend last patch: if workfile is
	NULL, but sout is not NULL, use sout in error message.

Wed Sep  4 13:35:09 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* version.c: Increment version number to 1.8.8.

	* Version 1.8.7.

Wed Sep  4 1996  Jim Kingdon  <kingdon@@cyclic.com>

	* client.c (send_file_names): Look for the name to send in
	Entries even if the file doesn't exist; we should send the
	name as it appears in Entries in the "rm foo; cvs update FOO"
	case.

Tue Sep  3 20:50:11 1996  William A. Hoffman  <hoffman@@albirio.crd.ge.com>

	* rcs.c (RCS_fast_checkout): If workfile is NULL, don't try to
	include it in error message.

Mon Aug 26 12:27:38 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* mkmodules.c (mkdir_if_needed): Move from here ...
	* filesubr.c, cvs.h (mkdir_if_needed): ... to here.  Have it
	return a value saying whether the directory was created.
	* client.c (call_in_directory), edit.c (edit_fileproc): Call it.

Fri Aug 23 19:19:44 1996  Ian Lance Taylor  <ian@@cygnus.com>

	* checkin.c (Checkin): Copy rcs parameter in case it is freed when
	finfo->rcs is freed.

Fri Aug 23 14:55:41 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* remove.c (remove_fileproc): Revert change of 23 Aug to print
	getwd and finfo->file in message.  The latter is redundant with
	fullname and the former is redundant with fullname and the working
	directory when CVS was invoked.  The implementation was also
	lacking as the getwd call could overflow the buffer.

Fri Aug 23 18:40:35 1996  Norbert Kiesel  <nk@@col.sw-ley.de>

	* remove.c (cvsremove): fix remove -f for client/server

Fri Aug 23 11:28:27 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* wrapper.c, cvs.h: Remove conflictHook field of WrapperEntry,
	WRAP_CONFLICT in WrapMergeHas, and 'c' option in wrap_add; they
	are never used.

Fri Aug 23 11:41:46 1996  Norbert Kiesel  <nk@@col.sw-ley.de>

	* server.c (switch_to_user): use #ifdef SETXID_SUPPORT instead of
 	#if SETXID_SUPPORT

Thu Aug 22 14:18:43 1996  Ian Lance Taylor  <ian@@cygnus.com>

	* checkin.c (Checkin): Remove local variable xfinfo.  Reparse the
	RCS file after the checkin.  Call RCS_fast_checkout rather than
	RCS_checkout.

	* cvs.h (RCS_FLAGS_LOCK): Don't define.
	(RCS_FLAGS_*): Adjust values to fill in hole left by removal of
	RCS_FLAGS_LOCK.
	* rcs.c (RCS_fast_checkout): Don't check for RCS_FLAGS_LOCK.
	* rcscmds.c (RCS_checkout): Likewise.
	* commit.c (commit_fileproc): Remove rcs local variable.  If
	status is T_MODIFIED, require that finfo->rcs be set, call
	Lock_RCS directly, and don't call locate_rcs.  If adding to a tag,
	require that finfo->rcs be set, and don't call locate_rcs.
	(remove_file): Remove rcs local variable.  Require that finfo->rcs
	be set.  Don't call locate_rcs.  Don't pass RCS_FLAGS_LOCK to
	RCS_checkout; use RCS_lock instead.  Call RCS_fast_checkout rather
	than RCS_checkout.
	(unlockrcs): Use a single rcs parameter rather than two parameters
	for file and repository.  Change all callers.  Don't call
	locate_rcs.
	(fixbranch): Likewise.
	(lockrcsfile): Remove; no more callers.

Tue Aug 20 10:13:59 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* buffer.c, rcs.c: Don't use inline.  It wasn't being used in a
	loop or any such place where it would matter for performance, and
	it was a (minor) portability hassle.

	* server.c (server): Change "Dummy argument 0" to "cvs server" and
	add comment explaining why.

	* rcs.c (linevector_add): Add comment regarding changing \n to \0.

Tue Aug 20 09:19:19 1996  Norbert Kiesel  <nk@@col.sw-ley.de>

	* checkout.c (checkout_proc): Call RCS_parse to get the default
 	options from the RCS file.

	* sanity.sh (binfiles): Add tests 5.5b0 and 5.5b1 for the above fix

Mon Aug 19 18:13:32 1996  Ian Lance Taylor  <ian@@cygnus.com>

	* rcs.c (linevector_init): Make inline.  Set lines_alloced to 0,
	not 10.  Set vector to NULL.
	(linevector_add): Remove assertion that lines_alloced is greater
	than zero.  Initialize lines_alloced if necessary.
	(linevector_copy): Initialize lines_alloced if necessary.
	(linevector_free): Only free vector if it is not NULL.
	(RCS_deltas): Always call linevector_init and linevector_free on
	curlines, headlines, and trunklines.
 	(RCS_fast_checkout): Remove #if 0 around code that calls
	RCS_deltas.

Fri Aug 16 17:52:54 1996  Ian Lance Taylor  <ian@@cygnus.com>

	* rcs.c (linevector_add): Handle zero length correctly.
	(RCS_deltas): In RCS_FETCH case, the data is in headlines, not
	curlines.
	(RCS_fast_checkout): Update comment about RCS_deltas: the
	testsuite now passes.

	* rcs.c (RCS_fully_parse): Use the length of the value, rather
	than assuming that there are no embedded zero bytes.
	(struct line): Add len field.
	(linevector_add): Add len parameter.  Change all callers.  Use
	len, rather than assuming that there are no embedded zero bytes.
	Set the len field in new lines.
	(RCS_deltas): Use the length of the value, rather than assuming
	that there are no embedded zero bytes.  Use the line length when
	outputting it and when copying it.
	(RCS_fast_checkout): Update comment about RCS_deltas to remove
	note about supporting zero bytes correctly.

Thu Aug 15 23:38:48 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* commit.c, import.c: Revise comments regarding the fact that we
	call start_server before do_editor.

Thu Aug 15 11:30:55 1996  Ian Lance Taylor  <ian@@cygnus.com>

	* server.c: Include <sys/socket.h> if AUTH_SERVER_SUPPORT.
	(pserver_authenticate_connection): Set SO_KEEPALIVE on
	STDIN_FILENO.
	(kserver_authenticate_connection): Likewise.

Thu Aug 15 10:26:41 1996  Norbert Kiesel  <nk@@col.sw-ley.de>

	* server.c (switch_to_user): Fix previous patch to compile it for
 	both HAVE_KERBEROS and AUTH_SERVER_SUPPORT

Wed Aug 14 14:02:00 1996  Norbert Kiesel  <nk@@col.sw-ley.de>

	* server.c (check_password): if available use getspnam instead of
 	getpwnam when reading system passwords.  This allows cvs pserver
 	to run on systems with shadow passwords.
	(switch_to_user): new static function.  Contains the extracted
 	common tail of kserver_authenticate_connection and
 	pserver_authenticate_connection.  If compiled with SETXID_SUPPORT,
 	honor the setgid bit if it is set.
	(check_repository_password): turn into a static function
	(check_password): ditto
	(pserver_authenticate_connection): little code cleanup

Wed Aug 14 01:07:10 1996  Greg A. Woods  <woods@@most.weird.com>

	* history.c (history): apply fix posted by Steven Meyer
	<steve@@blacksmith.com> to info-cvs to correct handling of '-D'
	argument.  Message-Id: <9608122335.AA01385@@nijel.blacksmith.com>

Tue Aug 13 13:42:36 1996  Ian Lance Taylor  <ian@@cygnus.com>

	* log.c (cvslog): Remove comment about calling rlog.
	* rcs.c (translate_symtag): Correct typo in comment (l ist ->
	list).
	* server.c (server_write_entries): Add omitted word (lists) in
	comment.

Tue Aug 13 14:01:49 1996  Norbert Kiesel  <nk@@col.sw-ley.de>

	* wrapper.c (wrap_rcsoption): fix memory access error

	* rcs.c (RCS_fast_checkout): fix memory access error (triggered
	by an empty option string)

Mon Aug 12 17:45:15 1996  Jim Kingdon  (unknown@@beezley)

	* buffer.c, zlib.c: If EIO is not defined, try to define it.

Mon Aug 12 10:33:27 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* import.c (comtable): Add comment concerning applicability with
	RCS 5.7.

	* server.c (server): If TMPDIR is not an absolute pathname, give
	an error.

Mon Aug 12 10:34:43 1996  Norbert Kiesel  <nk@@col.sw-ley.de>

	* main.c: add synonym "ann" for "annotate" again

Sun Aug 11 17:54:11 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* rcs.h (RCS_RLOG): Removed; no longer used.

Fri Aug  9 20:16:20 1996  Ian Lance Taylor  <ian@@cygnus.com>

	* server.c (dirswitch): Open the Entries file with mode "a" rather
 	than "w+".
	(server_write_entries): Open the Entries file with mode "a" rather
	than "w".
	* sanity.sh (modules): Add topfiles module and 155cN tests for
	above patch.

Fri Aug  9 12:11:25 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* main.c (cmd): Add comment regarding synonyms.

Thu Aug  8 14:40:10 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* main.c: Remove synonyms for "cvs annotate".  Synonyms create
	user confusion.

Thu Aug  8 10:24:04 1996  Norbert Kiesel  <nk@@col.sw-ley.de>

	* main.c: Revert (undocumented) change to rename the cvs history
	alias "his" to "hist"

Wed Aug  7 18:26:25 1996  Ian Lance Taylor  <ian@@cygnus.com>

	* server.c (cvs_output): Change str parameter to const char *.
	Correct loop to print from p, not str.
	(cvs_outerr): Likewise.
	* cvs.h (cvs_output, cvs_outerr): Update declarations.

	* server.c (receive_partial_file): Read and discard remaining file
	data on a write error.
	(serve_modified): Discard data while size > 0, not >=.

Wed Aug  7 15:11:40 1996  Norbert Kiesel  <nk@@col.sw-ley.de>

	* main.c (cmds): Add some aliases for "annotate".
	(usg): Improve usage message text
	(cmd_synonyms): New function to print the command synonym list
	(main): Add new option --help-synonyms

Wed Aug  7 00:07:31 1996  Ian Lance Taylor  <ian@@cygnus.com>

	Keep track of subdirectories in the Entries file.
	* cvs.h (enum ent_type): Define.
	(struct entnode): Add type field.
	(struct stickydirtag): Add subdirs field.
	(Subdirs_Known, Subdir_Register, Subdir_Deregister): Declare.
	(ignore_files): Update declaration for new parameter.
	(FILESDONEPROC): Add entries parameter.
	(DIRENTPROC, DIRLEAVEPROC): Likewise.
	* entries.c (Entnode_Create): Add type parameter.  Change all
	callers.
	(write_ent_proc): If closure is not NULL, treat it as a pointer to
	an int, and set it to 1 if a node is seen which is not ENT_FILE.
	(write_entries): If subdirectory information is known, but no
	subdirectories were written, write an unadorned D to the file.
	(Scratch_Entry): Write an R command to Entries.Log.  Don't rewrite
	the Entries file.
	(Register): Set entfilename.  Write an A command rather than an
	unadorned entries line.
	(fgetentent): Add cmd and sawdir parameters.  Change all callers.
	If CMD is not NULL, expect and return a single character command.
	Handle an initial D by setting the type to ENT_SUBDIR.
	(fputentent): Output an initial D for an ENT_SUBDIR entry.
	(Entries_Open): Handle removal commands in Entries.Log.  Record
	whether subdirectory information is known in the list private
	data.
	(Subdirs_Known): New function.
	(subdir_record): New static function.
	(Subdir_Register, Subdir_Deregister): New functions.
	* find_names.c (add_entries_proc): Skip entries that are not
	ENT_FILE.
	(add_subdir_proc): New static function.
	(register_subdir_proc): New static function.
	(Find_Directories): If the Entries file has subdirectory
	information, get the directories out of it.  Otherwise, call
	find_dirs, and add the information to the Entries file.
	* recurse.c (struct frame_and_entries): Define.
	(do_recursion): Don't call Entries_Close until after processing
	dirlist.  Pass entries to filesdoneproc.  Pass a frame_and_entries
	structure to do_dir_proc via walklist.
	(do_dir_proc): Expect a frame_and_entries structure in closure,
	not a recursion_frame.  Pass entries to direntproc and
	dirleaveproc.
	* ignore.c (ignore_files): Add entries parameter.  Change all
	callers.  If we have subdirectory information, check for
	directories in entries.
	* add.c (add): If client_active, call Subdir_Register on each new
	directory.
	(add_directory): Add entries parameter.  Change caller.  Call
	Subdir_Register.
	* checkout.c (build_dirs_and_chdir): Call Subdir_Register.
	* client.c (call_in_directory): Call Subdir_Register for newly
	created directories.  Call Subdirs_Known or Find_Directories after
	calling Entries_Open.
	(process_prune_candidates): Call Subdir_Deregister.
	* commit.c (findmaxrev): Skip entries that are not ENT_FILE.
	* server.c (dirswitch): Call Subdir_Register.
	* update.c (update_dirent_proc): Call Subdir_Register.
	(update_dirleave_proc): Call Subdir_Deregister.
	* Several files: Change direntproc, dirleaveproc, and
	filesdoneproc routines to expect an entries argument.

	* rcs.c (translate_symtag): New static function.
	(RCS_gettag): Use translate_symtag rather than RCS_symbols.
	(RCS_nodeisbranch, RCS_whatbranch): Likewise.

Tue Aug  6 15:36:09 1996  Ian Lance Taylor  <ian@@cygnus.com>

	Finish the conversion of cvs log so that it never invokes rlog.
	* log.c (struct log_data): Remove dorlog field.  Add nameonly,
	header, long_header, statelist, and authorlist fields.
	(log_usage): Remove rlog-options.  Add -R, -h, -t, -b, -s, -w.
	(cvslog): Don't clear opterr.  Handle -h, -R, -s, -t, -w.  If an
	unrecognized option is seen, call usage.
	(log_parse_list): New static function.
	(log_fileproc): Remove code that called rlog.  Check nameonly,
	header, and long_header fields in log_data.
	(log_version_requested): Check statelist and authorlist.

	* log.c (struct datelist): Define.
	(struct log_data): Add datelist and singledatelist fields.
	(log_usage): Add -d.
	(cvslog): Handle -d.
	(log_parse_date): New static function.
	(log_fileproc): Do special single date handling.
	(log_version_requested): Check datelist and singledatelist.
	(log_fix_singledate): New static function.

Mon Aug  5 23:48:16 1996  Ian Lance Taylor  <ian@@cygnus.com>

	* log.c (struct option_revlist): Define.
	(struct revlist): Define.
	(struct log_data): Add default_branch and revlist fields.
	(struct log_data_and_rcs): Define.
	(log_usage): Add -N and -r.
	(cvslog): Handle -N and -r.
	(log_parse_revlist): New static function.
	(log_fileproc): Call log_expand_revlist and log_free_revlist.
	Pass log_data_and_rcs structure to log_count_print via walklist.
	(log_expand_revlist, log_free_revlist): New static functions.
	(log_version_requested): New static function.
	(log_count_print): New static function.
	(log_tree): Add log_data and revlist parameter.  Change all
	callers.
	(log_abranch): Likewise.
	(log_version): Likewise.  Call log_version_requested.
	(version_compare): New static function.
	* sanity.sh (log): New tests for -r, -b, and -N options to log.

Sun Aug  4 11:19:30 1996  Ian Lance Taylor  <ian@@cygnus.com>

	Handle simple cases of cvs log without invoking rlog.
	* log.c (struct log_data): Define.
	(cvslog): Use getopt to parse options.  Set up a log_data
	structure, and pass it to start_recursion.
	(log_fileproc): Get arguments form callerdat rather than static
	variables.  In simple cases, print the log information directly,
	rather than invoking rlog.
	(log_symbol, log_count, log_tree): New static functions.
	(log_abranch, log_version, log_branch): New static functions.
	* rcs.h (struct rcsnode): Add other field.
	(struct rcsversnode): Add other field.
	(RCS_fully_parse): Declare.
	* rcs.c (getrcsrev): Move declaration to start of file.
 	(RCS_reparsercsfile): Add all parameter.  Change all callers.
	(RCS_fully_parse): New function.
	(freercsnode): Free other list.
	(rcsvers_delproc): Free other list.
	* hash.h (enum ntype): Add RCSFIELD.
	* hash.c (nodetypestring): Handle RCSFIELD.

Sat Aug  3 19:39:54 1996  Ian Lance Taylor  <ian@@cygnus.com>

	* log.c (cvslog): Correct position of CLIENT_SUPPORT #endif.

Thu Jul 25 12:06:45 1996  Ian Lance Taylor  <ian@@cygnus.com>

	* update.c (join_file): If merging a branch, and the branch
	revision does not exist, just return without doing anything.
	* sanity.sh (join): Add cases file7 and file8 to test above
	patch.

	* server.c (cvsencrypt): Rename from encrypt, to avoid conflict
	with NetBSD unistd.h.  Rename all uses.

	* server.c (krb_encrypt_buffer_output): Fix typo in comment (reply
	-> replay).

Thu Jul 25 10:37:32 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* server.c (krb_encrypt_buffer_output): Fix typo in comment
	(krb_recv_auth -> krb_recvauth).

Wed Jul 24 09:28:33 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* lock.c (set_lock): Adjust comment regarding why we call stat.

Wed Jul 24 15:06:08 1996  Ian Lance Taylor  <ian@@cygnus.com>

	Add encryption support over a Kerberos connection.
	* main.c (usg): Mention -x if CLIENT_SUPPORT.
	(main): Handle -x.
	* client.h (encrypt): Declare.
	(krb_encrypt_buffer_initialize): Declare.
	* client.c (kblock, sched): New static variables if
	HAVE_KERBEROS.
	(start_tcp_server): Remove sched local variable.  Copy
	cred.session into kblock.
	(start_server): Turn on encryption if requested.
	* server.c (kblock, sched): New static variables if
	HAVE_KERBEROS.
	(serve_kerberos_encrypt): New static function.
	(requests): Add "Kerberos-encrypt" if HAVE_KERBEROS.
	(kserver_authenticate_connection): Remove sched local variable.
	Copy auth.session into kblock.
	(encrypt): New global variable.
	(struct krb_encrypt_buffer): Define.
	(krb_encrypt_buffer_initialize): New function.
	(krb_encrypt_buffer_input): New static function.
	(krb_encrypt_buffer_output): New static function.
	(krb_encrypt_buffer_flush): New static function.
	(krb_encrypt_buffer_block): New static function.
	(krb_encrypt_buffer_shutdown): New static function.

Wed Jul 24 09:28:33 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* recurse.c (do_recursion): Add comment about calling
	Name_Repository in !(which & W_LOCAL) case.

	* expand_path.c (expand_variable): Fix typo (varaible -> variable).

Tue Jul 23 15:05:01 1996  Ian Lance Taylor  <ian@@cygnus.com>

	* update.c (update_fileproc): In T_REMOVE_ENTRY case, only call
	server_scratch_entry_only if ts_user is NULL.
	* sanity.sh (death2): Add death2-20 test for above patch.

	* diff.c (diff_fileproc): If a file is not in the working
	directory, check that the tag is present before warning that no
	comparison is possible.
	* sanity.sh (death2): Add death2-diff-9 and death2-diff-10 tests
	for above patch.

Tue Jul 23 12:05:42 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* tag.c (tag_check_valid): Fix indentation.

	* client.c (handle_e): Flush stdout before writing to stderr.
	(handle_m): Flush stderr before writing to stdout.

Fri Jul 19 16:02:11 1996  Mike Ladwig  <mike@@twinpeaks.prc.com>

	* client.c: Added NO_CLIENT_GZIP_PROCESS to deal with the MacOS
	client where Gzip-stream is supported, but "gzip-file-contents" is
	not.

Fri Jul 19 16:02:11 1996  Mike Ladwig  <mike@@twinpeaks.prc.com>

	* repos.c: Fixed recent patch which added plain fopen rather than
	CVS_FOPEN

Mon Jul 22 22:25:53 1996  Ian Lance Taylor  <ian@@cygnus.com>

	* logmsg.c (tag): New static variable.
	(setup_tmpfile): Don't print the prefix before calling fmt_proc.
	Free tag if it is set.
	(find_type): Get type from logfile_info struct.
	(fmt_proc): Likewise.  Print tag information.  Handle all prefix
	printing.
	(revision): Remove static variable.
	(Update_Logfile): Remove xrevision parameter.  Change all
	callers.
	(title_proc): Get type from logfile_info struct.
	(logfile_write): Remove revision parameter.  Change all callers.
	* cvs.h (struct logfile_info): Define.
	(Update_Logfile): Update prototype.
	* commit.c (find_fileproc): Set logfile_info information.
	(check_fileproc): Likewise.
	(commit_filesdoneproc): Don't call ParseTag.
	(update_delproc): Free logfile_info information.
	* add.c (add_directory): Set logfile_info information.
	* import.c (import): Likewise.

	* tag.c (tag_check_valid): The special BASE and HEAD tags are
	always valid.
	* sanity.sh (basica): Add basica-6.3 test for above patch.

Mon Jul 22 14:41:20 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* update.c (merge_file): Pass 0 not NULL to checkout_file (20 Jul
	96 change changed other calls to checkout_file but missed this one).

Sat Jul 20 00:21:54 1996  Ian Lance Taylor  <ian@@cygnus.com>

	* update.c (join_file): Check whether the target of the merge is
	the same as the working file revision before checking whether the
	file was added during the merge.

	* update.c (scratch_file): Remove existing parameters, and add a
	single parameter of type struct file_info.  Change all callers.
	Warn if unlink_file fails.
	(checkout_file): Remove resurrecting_out parameter.  Add adding
	parameter.  Change all callers.  Remove joining code.
	(join_file): Remove resurrecting parameter.  Rewrite to handle
	joining dead or added revisions.
	* classify.c (Classify_File): If there is no user file, and the
	RCS file is dead, return T_UPTODATE rather than T_CHECKOUT.
	* checkout.c (checkout_proc): Set W_ATTIC if there is a join tag.
	* sanity.sh (join): New set of tests for above patches.
	(death): Adjust tests 86, 89, 89a, 92.1c, 95 for above patches.
	(import): Adjust test 113 for above patches.

Thu Jul 18 19:24:08 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* lock.c: Add comment explaining what locks are for.  Also discuss
	various changes to locking which get proposed from time to time.

	* sanity.sh (death2): Change a number of test names from death-*
	to death2-*.

	* wrapper.c (wrap_setup): Don't look in repository if client_active.
	* wrapper.c, cvs.h (wrap_send): New function.
	* update.c (update), import.c (import): Call it.
	* sanity.sh (binwrap): Do binwrap tests for remote as well as
	local; tests for above fixes.

	* wrapper.c: Add a few FIXME comments.

Thu Jul 18 18:43:50 1996  Ian Lance Taylor  <ian@@cygnus.com>

	* sanity.sh (patch): Fix names of a couple of tests to say patch
	rather than death2.

Thu Jul 18 16:19:21 1996  Bill Bumgarner <bbum@@friday.com>
			  and Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* add.c (add), import.c (add_rcs_file): Check for options from
	wrappers and use them if specified.
	* cvs.h (WrapMergeHas): Add WRAP_RCSOPTION.
	* wrapper.c (WrapperEntry): Add rcsOption field.
	(wrap_add): Allow a single character argument to an option.
	(wrap_add): Handle -k option.
	(wrap_add_entry): Handle rcsOption field.
	(wrap_name_has): Handle WRAP_RCSOPTION.
	* wrapper.c, cvs.h (wrap_rcsoption): New function.
	* add.c, import.c, wrapper.c: Minor beautification (mostly
	removing trailing spaces).
	* sanity.sh (binwrap): New tests test for this feature.

Wed Jul 17 10:14:20 1996  Ian Lance Taylor  <ian@@cygnus.com>

	* checkout.c (checkout): Remove extraneous else accidentally
	inserted in last checkin.

Tue Jul 16 11:37:41 1996  Ian Lance Taylor  <ian@@cygnus.com>

	* sanity.sh (import): Use quoting to avoid expansion of RCS ID
	strings.

	* sanity.sh (import): Use dotest to examine the output of test
 	113, and the actual contents of the file in test 116.

	* update.c (join_file): Always skip rcsmerge if the two revisions
 	are the same (the old code always did the rcsmerge when two -j
	options were specified).

	* checkout.c (history_name): New static variable.
	(checkout): Permit both tag and date to be specified.  Set
	history_name.
	(checkout_proc): Use history_name when calling history_write.
	* rcs.c (RCS_getversion): If both tag and date are set, use
	RCS_whatbranch to get the branch revision number of a symbolic
	tag.
	(RCS_getdatebranch): If the branch revision itself is early
	enough, then use it if the first branch is not early enough.  Add
	comment for invalid RCS file.  Don't bother to check for NULL
	before calling xstrdup, since xstrdup checks anyhow.

	* client.h (file_gzip_level): Declare.
	* client.c (file_gzip_level): Define.
	(start_server): Don't set gzip_level to zero after sending
	Gzip-stream command.  Set file_gzip_level after sending
	gzip-file-contents command.
	(send_modified): Use file_gzip_level rather than gzip_level.
	* server.c (server_updated): Likewise.
	(serve_gzip_contents): Likewise.

	* sanity.sh (patch): New tests.  Test remote CVS handling of
	unpatchable files.

	* sanity.sh (death2): Accept a '.' in the temporary file name
	printed by diff.

	* rcscmds.c (RCS_checkin): Remove noerr parameter.  Change all
	callers.
	* cvs.h (RCS_checkin): Update declaration.
	* commit.c (remove_file): Pass RCS_FLAGS_QUIET to RCS_checkin.

	* history.c (history): Cast sizeof to int to use correct type in
	error printf string.
	(report_hrecs): Cast strlen result to int to use correct type in
	printf string.

	* server.c (cvs_flusherr): Correct typo in comment.

	* rcs.c (getrcskey): Hoist three constant strcmp calls out of the
	value reading loop.

	* fileattr.c (fileattr_get): Change parameter types from char * to
 	const char *.
	(fileattr_get0, fileattr_modify, fileattr_set): Likewise.
	(fileattr_newfile): Likewise.
	* fileattr.h (fileattr_get): Update declaration.
	(fileattr_get0, fileattr_modify, fileattr_set): Likewise.
	(fileattr_newfile): Likewise.

Thu May 16 11:12:18 1996  Mark P. Immel <immel@@radix.net>
			  and Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* client.h, client.c, checkout.c (client_send_expansions):
	Pass an additional parameter indicating where the checkout is
	to occur, to avoid passing the wrong information to send_files().
	* sanity.sh (basicb): New test basicb-cod-1 tests for above fix.

Mon Jul 15 18:26:56 1996  Ian Lance Taylor  <ian@@cygnus.com>

	* recurse.c (do_recursion): Require a repository before calling
	Find_Names.
	* repos.c (Name_Repository): Remove sanity checks which spend time
	examining the filesystem.

Mon Jul 15 1996  Jim Kingdon  <kingdon@@cyclic.com>

	* client.c (send_file_names): Send file names as they appear
	in CVS/Entries, rather than as specified (in cases where they
	might differ in case).
	(send_fileproc): Use file name from CVS/Entries (vers->entdata->user)
	rather than file name as specified (finfo->file) when available.

Sun Jul 14 15:39:44 1996  Mark Eichin  <eichin@@cygnus.com>
			  and Ian Lance Taylor  <ian@@cygnus.com>

	Improve diff -N handling of nonexistent tags and removed files.
	* diff.c (enum diff_file): New definition for whole file, moving
	unnamed enum out of diff_fileproc, renaming DIFF_NEITHER to
	DIFF_DIFFERENT, and adding DIFF_SAME.
	(diff): Look through the repository even if only one revision is
	given.
	(diff_fileproc): Change empty_file to be enum diff_file.  If there
	is no user revision, but there is a repository file, treat it as a
	removed file.  Pass empty_file to diff_file_nodiff, and set it
	from the return value.
	(diff_file_nodiff): Change return type to enum diff_file.  Replace
	just_set_rev parameter with enum diff_file empty_file parameter.
	Change handling of a missing tag to return an enum diff_file value
	if empty_files is set, rather than reporting an error.  Free tmp
	if xcmp returns 0.
	* sanity.sh (death2): Add tests for above patches.

Sat Jul 13 19:11:32 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* rcs.c (annotate): In sending options to server, reverse sense of
	test so that we send -f iff -f was specified, rather than iff -f was
	not specified.

Fri Jul 12 20:23:54 1996  Greg A. Woods  <woods@@most.weird.com>

	* zlib.c (compress_buffer_input): add a couple of casts for
	uses of z_stream's next_in and next_out

Fri Jul 12 18:55:26 1996  Ian Lance Taylor  <ian@@cygnus.com>

	* zlib.c: New file.
	* client.c (log_buffer_block): Call set_block and set_nonblock,
	rather than lb->buf->block.
	(log_buffer_shutdown): New static function.
	(get_responses_and_close): Call buf_shutdown on to_server and
	from_server.
	(start_server): If "Gzip-stream" is supported, use it rather than
	"gzip-file-contents".
	* server.c (print_error): Call buf_flush rather than
	buf_send_output.
	(print_pending_error, serve_valid_responses): Likewise.
	(serve_expand_modules, serve_valid_requests): Likewise.
	(do_cvs_command): Call buf_flush rather than buf_send_output
	before the fork, and in the parent after the child has completed.
	In the child, set buf_to_net and buf_from_net to NULL.
	(serve_gzip_stream): New static function.
	(requests): Add "Gzip-stream".
	(server_cleanup): Don't do anything with buf_to_net if it is
	NULL.  Call buf_flush rather than buf_send_output.  Call
	buf_shutdown on buf_to_net and buf_from_net.  Call error for an
	malloc failure rather than buf_output to buf_to_net.
	* buffer.h (struct buffer): Add shutdown field.
	(buf_initialize): Update declaration for new shutdown parameter.
	(compress_buffer_initialize): Declare.
	(buf_shutdown): Declare.
	* buffer.c (buf_initialize): Add shutdown parameter.  Change all
	callers.
	(buf_shutdown): New function.
	* Makefile.in (SOURCES): Add zlib.c
	(OBJECTS): Add zlib.o.
	($(PROGS)): Depend upon ../zlib/libz.a.
	(cvs): Link against ../zlib/libz.a.
	(zlib.o): New target.

Fri Jul 12 1996  Jim Kingdon  <kingdon@@cyclic.com>

	* client.c (log_buffer_input, log_buffer_output): Use size_t
	to avoid Visual C++ signed/unsigned warnings.

Thu Jul 11 22:01:37 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* client.c (handle_f): Reindent.

	* client.c (mode_to_string, handle_m, handle_e,
	auth_server_port_number, get_responses_and_close), server.c
	(pserver_authenticate_connection, serve_modified,
	serve_enable_unchanged, wait_sig, server_cleanup): Reindent.
	* server.c: Remove #if 0'd block of code above
	check_repository_password; it was yanked out of some unknown
	context and didn't seem to be very useful.

Thu Jul 11 20:10:21 1996  Ian Lance Taylor  <ian@@cygnus.com>

	* server.c (do_cvs_command): Pass new special parameter to
	buf_copy_counted.  If it gets set to -1, send an 'F' response if
	the client supports it, and call cvs_flusherr.
	(cvs_flusherr): New function.
	* cvs.h (cvs_flusherr): Declare.
	* client.c (handle_f): New static function.
	(responses): Add "F".
	* buffer.c (buf_send_special_count): New function.
	(buf_copy_counted): Add special parameter.  Handle negative counts
	specially.
	* buffer.h (buf_send_sepcial_count): Declare.
	(buf_copy_counted): Update declaration.
	* lock.c (lock_wait, lock_obtained): Call cvs_flusherr.

	Change the client to use the buffer data structure.
	* client.c: Include "buffer.h".
	(to_server): Change to be struct buffer *.
	(to_server_fp): New static variable.
	(from_server): Change to be struct buffer *.
	(from_server_fp): New static variable.
	(from_server_logfile, to_server_logfile): Remove.
	(buf_memory_error): New static function.
	(struct log_buffer): Define.
	(log_buffer_initialize, log_buffer_input): New static functions.
	(log_buffer_output, log_buffer_flush): New static functions.
	(log_buffer_block): New static function.
	(struct socket_buffer): Define if NO_SOCKET_TO_FD.
	(socket_buffer_initialize): New static function if
	NO_SOCKET_TO_FD.
	(socket_buffer_input, socket_buffer_output): Likewise.
	(socket_buffer_flush): Likewise.
	(read_line): Rewrite to use buf_read_line.  Remove eof_ok
	parameter (it was always passed as 0); change all callers.
	(send_to_server): Rewrite to use buf_output.
	(try_read_from_server): Rewrite to use buf_read_data.
	(get_responses_and_close): Use from_server_fp and to_server_fp for
	the streams.  Check buf_empty_p when checking for dying gasps.
	(start_server): Don't set from_server_logfile and
	to_server_logfile; instead, call log_buffer_initialize.  If
	NO_SOCKET_TO_FD and use_socket_style, call
	socket_buffer_initialize; otherwise, call
	stdio_buffer_initialize.
	* buffer.c: Compile if CLIENT_SUPPORT is defined.
	(buf_flush): Fix comment to describe return value.
	(buf_read_line): Add lenp parameter.  Change all callers.  Look
	for a line terminated by \012 rather than \n.
	* buffer.h: Compile if CLIENT_SUPPORT is defined.
	(buf_read_line): Update declaration.

	* server.c (server): Initialize buf_to_net, buf_from_net,
	saved_output, and saved_outerr before setting error_use_protocol.
	(pserver_authenticate_connection): Don't set error_use_protocol.
	Errors before the authentication is complete aren't handled
	cleanly anyhow.  Change error call after authentication to use
	printf.

Thu Jul 11 1996  Jim Kingdon  <kingdon@@cyclic.com>

	* client.c (start_server): Open logfiles in binary, not text, mode.

Wed Jul 10 19:24:22 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* server.c (print_pending_error, print_error): Remove comments
	about deadlocks; they don't apply here.  Add comments saying
	that these functions must only be called when it is OK to
	send output (which is why the deadlock concern doesn't apply).  The
	comments remain for server_cleanup and serve_valid_responses,
	where they are an example of the "print a message and exit"
	behavior which is noted in cvsclient.texi and which also exists
	places like kserver_authenticate_connection.

Wed Jul 10 18:24:46 1996  Ian Lance Taylor  <ian@@cygnus.com>

	* server.c (print_error): Add comment warning about potential
	deadlock.
	(print_pending_error, serve_valid_responses): Likewise.
	(server_cleanup): Likewise.
	(serve_directory): Don't call buf_send_output.
	(serve_modified, serve_notify, server, cvs_outerr): Likewise.
	(serve_expand_modules): Call buf_send_output.
	(serve_valid_requests): Likewise.

Wed Jul 10 15:51:29 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* main.c (main): Print a warning for rlog command.

Wed Jul 10 15:00:55 1996  Ian Lance Taylor  <ian@@cygnus.com>

	Abstract the buffer data structure away from the underlying
	communication medium.
	* buffer.h (struct buffer): Remove fd and output fields.  Add
	input, output, flush, block, and closure fields.
	(buf_initialize, buf_nonio_initialize): Declare.
	(stdio_buffer_initialize, buf_flush): Declare.
	(buf_read_line, buf_read_data): Declare.
	* buffer.c: Include <assert.h>.  Don't include <fcntl.h>.
	(O_NONBLOCK, blocking_error): Don't define.
	(buf_initialize, buf_nonio_initialize): New functions.
	(buf_send_output): Use output function, rather than write.
	(buf_flush): New function.
	(set_nonblock, set_block): Use block function, rather than calling
	fcntl.
	(buf_send_counted): Don't check output.
	(buf_input_data): Call input function, rather than read.
	(buf_read_line, buf_read_data): New functions.
	(buf_copy_lines, buf_copy_counted): Don't check output.
	(stdio_buffer_initialize): New function.
	(stdio_buffer_input, stdio_buffer_output): New static functions.
	(stdio_bufer_flush): New static function.
	* server.c: Include "getline.h".
	(buf_to_net): Change to be a pointer.  Change all uses.
	(protocol, saved_output, saved_outerr): Likewise.
	(buf_from_net): New static variable.
	(no_mem_error, NO_MEM_ERROR, read_line): Remove.
	(struct fd_buffer): Define.
	(fd_buffer_initialize, fd_buffer_input): New static functions.
	(fd_buffer_output, fd_buffer_flush): New static functions.
	(fd_buffer_block): New static function.
	(serve_directory): Call buf_read_line rather than read_line.
	(serve_notify, server): Likewise.
	(receive_partial_file): Call buf_read_data rather than fread.
	(serve_modified): Call buf_read_line rather than read_line.  Call
	buf_read_data rather than fread.
	(do_cvs_command): Initialize buffers with fd_buffer_initialize.
	Change stdoutbuf, stderrbuf, and protocol_inbuf to be pointers.
	(server): Initialize buffers using fd_buffer_initialize,
	stdio_buffer_initialize, and buf_nonio_initialize.
	(check_repository_password): Call getline rather than read_line.

Wed Jul 10 15:51:29 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* commit.c (find_fileproc): Add comments describing a few cases
	that we aren't handling.

Tue Jul  9 04:33:03 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* rcs.c (RCS_deltas): New function, created from guts of old
	annotate_fileproc.
	(annotate_fileproc): Call RCS_deltas.
	(RCS_fast_checkout): Call it (commented out for now; see comment
	for reasons).

	* cvs.h, recurse.c (start_recursion): Add callerdat argument.
	* cvs.h: Add callerdat argument to recursion processor callbacks.
	* recurse.c: add it to struct recursion_frame and pass it to all
	the callbacks.
	* admin.c, client.c, commit.c, diff.c, edit.c, lock.c, log.c,
	patch.c, rcs.c, remove.c, rtag.c, status.c, tag.c, update.c,
	watch.c: Update all the functions used as callbacks.  Update calls
	to start_recursion.
	* commit.c (find_filesdoneproc, find_fileproc, find_dirent_proc,
	commit), tag.c (val_fileproc, tag_check_valid): Use callerdat
	instead of a static variable.

	* recurse.c (do_recursion): Make static and move declaration to here...
	* cvs.h: ...from here.
	* recurse.c (do_recursion): Replace plethora of arguments with
	single struct recursion_frame *.  Change callers.
	* recurse.c: New structure frame_and_file.  Use it and existing
	struct recursion_frame structures to pass info to do_file_proc and
	do_dir_proc.  Remove globals fileproc, filesdoneproc, direntproc,
	dirleaveproc, which, flags, aflag, readlock, and dosrcs.

Tue Jul  9 11:13:29 1996  Ian Lance Taylor  <ian@@cygnus.com>

	* modules.c (do_module): Call cvs_outerr rather than fprintf.

Mon Jul 8 1996  Jim Kingdon  <kingdon@@cyclic.com>

	* rcs.c (RCS_fast_checkout): If -kb is not in use, open the
	working file in text, not binary, mode.

Sun Jul  7 10:36:16 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* rcscmds.c (RCS_settag): Add comment regarding moving check for
	reserved tag names to RCS_check_tag.

	* rcscmds.c: Add comment regarding librarifying RCS and related
	issues.  This is a lightly edited version of a message I sent to
	the CVS developers and didn't get flamed for, so it would appear
	to be relatively uncontroversial.

	* rcs.c (annotate): Remove comment suggesting -r option and
	related functionality; it is done.

Fri Jul  5 17:19:57 1996  Ian Lance Taylor  <ian@@cygnus.com>

	* client.c (last_entries): Make file static, rather than function
	static within call_in_directory.
	(get_responses_and_close): If last_entries is not NULL, pass it to
	Entries_Close.

	* server.c (server_pause_check): Check for errors when reading
	from flowcontrol_pipe.

	* client.c (call_in_directory): If dir_name is ".", call
	Create_Admin if there is no CVS directory.
	(send_dirent_proc): If there is no CVS subdirectory, pretend that
	the directory does not exist (i.e., don't try to send any files in
	the directory).
	* server.c (dirswitch): If dir is "." in the top level repository,
	add "/." after the Repository entry.
	* sanity.sh (modules): Add test 155b for above patches.

Thu Jul  4 15:57:34 1996  Ian Lance Taylor  <ian@@cygnus.com>

	* server.c (buf_to_net): Move definition near top of file.
	(read_line): Call buf_send_output rather than fflush.
	(print_error): Output information to buf_to_net buffer rather than
	stdout.
	(print_pending_error, serve_valid_responses): Likewise.
	(server_notify, do_cvs_command, server_co): Likewise.
	(expand_proc, serve_expand_modules, server_prog): Likewise.
	(serve_valid_requests, server_cleanup, server): Likewise.
	(server_notify): Don't call fflush on stdout.
	(do_cvs_command): Flush saved_output and saved_outerr to
	buf_to_net before fork.  Flush buf_to_net before fork.  In child,
	just initialize memory_error field of saved_output and
	saved_outerr.
	(server_cleanup): Flush buf_to_net.
	(server): Initialize saved_output and saved_outerr.
	(cvs_output): Add support for error_use_protocol case.
	(cvs_outerr): Likewise.
	* error.c (error): In HAVE_VPRINTF case, just call cvs_outerr.

	* buffer.c: New file; buffer support functions taken from
	server.c.
	* buffer.h: New file; declarations for buffer.c.
	* server.c: Move buffer support functions into buffer.c and
	buffer.h.  Include "buffer.h".
	* Makefile.in (SOURCES): Add buffer.c.
	(OBJECTS): Add buffer.o.
	(HEADERS): Add buffer.h.

Thu Jul  4 00:12:45 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* version.c: Increment version number to 1.8.6.

Wed Jul  3 22:31:16 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* version.c: Version 1.8.5.

Wed Jul  3 21:51:23 1996  Ian Lance Taylor  <ian@@cygnus.com>

	* server.c (blocking_error): Define macro.
	(buf_send_output, buf_input_data): Use blocking_error rather than
	#ifdef EWOULDBLOCK.

Tue Jul  2 20:38:41 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* add.c (add): Change message which said "version 1.2 of foo.c
	will be resurrected"; the message was confusing because it made
	people think that the old contents of the file would come back
	instead of the contents in the working directory.

Mon Jul  1 01:38:57 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* find_names.c (find_dirs): Add comment explaining why we bother
	with the entries stuff.

Sat Jun 29 20:23:50 1996  Ian Lance Taylor  <ian@@cygnus.com>

	* find_names.c (Find_Directories): Add entries parameter, and pass
	it to find_dirs.
	(find_dirs): Add entries parameter, and skip all files it names.
	* cvs.h (Find_Directories): Update declaration.
	* recurse.c (start_recursion): Pass NULL to Find_Directories.
	(do_recursion): Pass entries to Find_Directories.

	* client.c (send_modified): Add trace output.

	* diff.c (diff_fileproc): Always call diff_file_nodiff.  Handle
	dead versions correctly.  Handle diffs between a specified
	revision to a dead file correctly.
	(diff_file_nodiff): Add just_set_rev parameter.  Change caller.
	* patch.c (patch_fileproc): Check for dead versions.
	* sanity.sh (death2): Add tests for above patches.

Fri Jun 28 20:30:48 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	For reference, this takes CVS's text segment from 271136 bytes to
	270352 bytes, a saving of 784.  Not as good as I had hoped (oh well,
	the source *seems* simpler at least).
	* checkin.c (Checkin), commit.c (finaladd, remove_file), update.c
	(join_file, checkout_file, patch_file), no_diff.c
	(No_Differences), server.c (server_updated), classify.c
	(Classify_File), vers_ts.c (Version_TS), diff.c (diff_file_nodiff):
	Use a single struct file_info * argument instead of a bunch of
	separate arguments for each of its fields.  Remove local fullname
	emulations.  Use fullname in error messages where file had
	erroneously been used.
	* cvs.h: Update declarations of above functions and move them to
	after the struct file_info declaration.
	* server.h: Update declarations.
	* add.c, admin.c, checkin.c, checkout.c, classify.c, client.c,
	commit.c, diff.c, history.c, import.c, update.c, status.c,
	remove.c, rtag.c, tag.c: Change callers.

	* diff.c (diff): Remove -q and -Q command options.  This somehow
	slipped through the cracks of the general removal of -q and -Q
	command options on Jul 21 1995.  Note that there is no need to
	accept and ignore these options in server mode, like there is for
	some of the commands, because the client has never sent -q and -Q
	command options for "cvs diff".

Fri Jun 28 16:50:18 1996  Ian Lance Taylor  <ian@@cygnus.com>

	* add.c (add): Pass force_tag_match as 1 when calling Version_TS.
	* sanity.sh (death2): Add test for above patch.  Also add
	commented out test for adding a file on a nonbranch tag, which CVS
	currently, mistakenly, permits.

Thu Jun 27 23:20:49 1996  Ian Lance Taylor  <ian@@cygnus.com>
			  and Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* diff.c (longopts): New static array.
	(diff): Handle long options and new short options in diff 2.7.
	Fix arbitrary limit associated with the tmp variable.
	* client.c (send_option_string): Parse options as space separated,
	rather than requiring all options to be single characters.
	* diff.c, options.h.in: Remove CVS_DIFFDATE; the need for it is gone
	now that we have --ifdef (the new behavior is the behavior which
	was the default, which is that -D specifies a date).

Wed Jun 26 22:36:29 1996  Ian Lance Taylor  <ian@@cygnus.com>

	* commit.c (check_fileproc): If there is a tag, permit adding a
 	file even if the RCS file already exists.
	(checkaddfile): If there is a tag, use the file in the regular
 	repository, rather than the Attic, if it exists.
	* sanity.sh (death2): New set of tests for above patch.

Tue Jun 25 23:34:13 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* update.c (checkout_file): Add comments about two cases which
	seem fishy.

	* sanity.sh (basic2, death): Add comments encouraging people to
	stop making these sections bigger and more complex.  I'm not (yet
	at least) trying to figure out the ideal size for a section (my
	current best estimate is 10-20 tests), but surely these
	two sections are pushing the limit, whatever it is.

Tue Jun 25 19:52:02 1996  Ian Lance Taylor  <ian@@cygnus.com>

	* update.c (checkout_file): Rewrite handling of dead files when
	joining.  Avoid space leaks.  Avoid unnecessary file
	resurrections.
	(join_file): Add checks to skip merging a dead revision onto a
	dead revision, and to skip merging a common ancestor onto a dead
	revision.  Move check for non-existent working file after new
	checks.
	* sanity.sh (death): Use dotest for tests 86 and 95, and add test
	death-file2-1, to test above changes.

Mon Jun 24 11:27:37 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* update.c (merge_file): Replace file, repository, entries, and
	update_dir arguments with finfo argument.  Use fullname field
	instead of locally emulating it.
	(update_fileproc): Update caller.
	(merge_file): If -kb is in effect, call it a conflict, leave
	the two versions in the file and the backup file, and tell the
	user to deal with it.  The previous behavior was that the merge
	would fail and then there was no way to do a checkin even once you
	resolved the conflict (short of kludges like moving the file
	aside, updating, and then moving it back).
	* sanity.sh (binfiles): New tests binfiles-con* test for above
	behavior.  Adjust remaining tests to reflect changes in revision
	numbers.

Mon Jun 17 15:11:09 1996  Ian Lance Taylor  <ian@@cygnus.com>

	* sanity.sh (import): Remove sleep.  Requiring it was a bug, and
	it is fixed in the current sources.

Mon Jun 17 1996  Ian Lance Taylor  <ian@@cygnus.com>
		 and Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* sanity.sh (TMPPWD): Set to real name of /tmp directory.
	(basic2-64, conflicts-126.5): Use ${TMPPWD}.

Mon Jun 17 1996  Ian Lance Taylor  <ian@@cygnus.com>

	* rcscmds.c (RCS_checkout): Remove noerr parameter.  Change all
	callers.
	* rcs.c (RCS_fast_checkout): Likewise.

Mon Jun 17 1996  Ian Lance Taylor  <ian@@cygnus.com>

	Cleaner implementation of tag locking code added Jun 13 1996:
	* cvs.h (tag_lockdir, tag_unlockdir): Declare.
	* rtag.c (locked_dir, locked_list): Remove.
	(rtag_fileproc): Don't lock here; just call tag_lockdir.
	(rtag_filesdoneproc): Don't unlock here; just call tag_unlockdir.
	* tag.c (locked_dir, locked_list): Move farther down in file.
	(tag_fileproc): Don't lock here; just call tag_lockdir.
	(tag_filesdoneproc): Don't unlock here; just call tag_unlockdir.
	(tag_lockdir, tag_unlockdir): New functions.

Wed Jun 15 07:52:22 1996  Mike Ladwig  <mike@@twinpeaks.prc.com>

	* client.c (send_modified, update_entries): Fixed bug which didn't
	handle binary file transfers in BROKEN_READWRITE_CONVERSION.

Thu Jun 13 1996  Ian Lance Taylor  <ian@@cygnus.com>
		 and Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* update.c (checkout_file): Call server_scratch_entry_only when a
	non-pertinent file is found that does not exist.
	* sanity.sh (newb): Add test case for above patch.

Thu Jun 13 1996  Ian Lance Taylor  <ian@@cygnus.com>

	* update.c (update_fileproc): Call server_scratch_entry_only when
	handling T_REMOVE_ENTRY on the server.
	* sanity.sh (conflicts2): Remove special case for remote server
	bug fixed by above patch.

Thu Jun 13 21:16:26 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* sanity.sh (basica-9): Update to reflect change to "sufficient
	access" message.

Thu Jun 13 20:13:55 1996  Ian Lance Taylor  <ian@@cygnus.com>
			  and Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* recurse.c, cvs.h (start_recursion): Remove wd_is_repos argument;
	add comment about meaning of which argument.  Use !(which &
	W_LOCAL) instead of wd_is_repos.
	* admin.c, client.c, commit.c, diff.c, edit.c, lock.c, log.c,
	patch.c, rcs.c, remove.c, rtag.c, status.c, tag.c, update.c,
	watch.c: Change callers.  This is a semantic change in only two
	cases: (1) tag_check_valid, where repository was not "", and (2)
	the pipeout case in checkout_proc.  In both of those cases the
	previous setting of wd_is_repos did not reflect whether we
	actually were cd'd into the repository.
	* recurse.c (start_recursion): Only check for the CVS subdirectory
	if which & W_LOCAL.
	* sanity.sh (devcom): Add test case fixed by above patch.

Thu Jun 13 1996  Ian Lance Taylor  <ian@@cygnus.com>

	* ignore.c (ignore_files): Skip based on the file name before
	calling lstat.

	* client.c (last_register_time): New static variable.
	(update_entries): Set last_register_time when calling Register.
	(get_responses_and_close): If the current time is the same as
	last_register_time, sleep for a section to avoid timestamp races.

Thu Jun 13 17:24:38 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* client.c (supported_request): Reindent.

Thu Jun 13 1996  Mark H. Wilkinson  <mhw@@minster.york.ac.uk>

	* options.h.in, mkmodules.c: Corrections to allow compilation of
	non-client-server version.

Thu Jun 13 1996  Ian Lance Taylor  <ian@@cygnus.com>

	* tag.c (tag_check_valid_join): New function.
	* cvs.h (tag_check_valid_join): Declare.
	* checkout.c (join_tags_validated): New static variable.
	(checkout_proc): Check validity of join tags.
	* update.c (update): Likewise.

	* tag.c (tag_check_valid): Correct sizeof CVSROOTADM_HISTORY to
	use CVSROOTADM_VALTAGS.

	* lock.c (Writer_Lock): If we called lock_wait to wait for a lock,
	then call lock_obtained when we get it.
	(set_lock): Likewise.
	(lock_obtained): New static function.

Thu Jun 13 13:55:38 1996  Ian Lance Taylor  <ian@@cygnus.com>
			  and Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* main.c (main): If we can't read cvs root, don't say "you don't
	have sufficient access"; just print the message from errno.  It
	might be "No such file or directory" or something else for which
	"you don't have sufficient access" doesn't make any sense.

Thu Jun 13 1996  Ian Lance Taylor  <ian@@cygnus.com>

	* commit.c (remove_file): Pass noerr as 0 to RCS_checkout.

Thu Jun 13 12:55:56 1996  Ian Lance Taylor  <ian@@cygnus.com>

	* patch.c: Initialize rev1_validated and rev2_validated to 0, not 1.

Thu Jun 13 12:55:56 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* rtag.c (locked_dir): Revise comments regarding locking; the rtag
	and tag situations are different (changing from readlocking one
	directory at a time to writelocking one directory at a time does
	not do everything we might want, but it does fix simultaneous tags
	and it doesn't make anything worse).

Thu Jun 13 1996  Ian Lance Taylor  <ian@@cygnus.com>

	Prevent simultaneous tag operations from interfering with each
	other.
	* rtag.c (rtag_proc): Pass rtag_filesdoneproc to start_recursion,
	and pass readlock as 0.
	(locked_dir, locked_list): New static variables.
	(rtag_fileproc): Write lock the repository if it is not already
	locked.
	(rtag_filesdoneproc): New static function to unlock the
	repository.
	* tag.c (tag): Pass tag_filesdoneproc to start_recursion, and pass
	readlock as 0.
	(locked_dir, locked_list): New static variables.
	(tag_fileproc): Write lock the repository if it is not already
	locked.
	(tag_filesdoneproc): New static function.

Thu Jun 13 11:42:25 1996  Mike Sutton <mws115@@llcoolj.dayton.saic.com>

	* sanity.sh: Allow digits in usernames.

Wed Jun 12 16:23:03 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* client.c (send_modified, update_entries): Reindent and add
	comments to BROKEN_READWRITE_CONVERSION code.

Wed Jun 12 16:23:03 1996  Mike Ladwig  <mike@@twinpeaks.prc.com>

	* client.c (send_modified, update_entries): Add
	BROKEN_READWRITE_CONVERSION code.

Mon Jun 10 20:03:16 1996  J.T. Conklin  <jtc@@cygnus.com>

	* rcs.c (RCS_gettag): No longer set p to NULL if rcs is also NULL.
  	rcs will never be null, thanks to the assertion at top of function.

Mon Jun 10 16:28:14 1996  Ian Lance Taylor  <ian@@cygnus.com>
			  and Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* main.c (main): Ignore CVS/Root file when doing an import.

Fri Jun  7 18:20:01 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* status.c (status_fileproc, tag_list_proc): Use cvs_output rather
	than writing to stdout directly.

Wed Jun  5 13:54:57 1996  Ian Lance Taylor  <ian@@cygnus.com>

	* rcs.c (force_tag_match, tag, date): New static variables.
	(annotate_fileproc): Redo the loop to look for the version
	specified by tag/date/force_tag_match, and handle branches
	correctly.
	(annotate_usage): Mention -f, -r, and -D.
	(annotate): Handle -f, -r, and -D.

Tue Jun  4 13:38:17 1996  Ian Lance Taylor  <ian@@cygnus.com>

	* rcs.c (annotate_fileproc): Skip unrelated branch deltas.

Fri Jun  7 13:04:01 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* main.c (main): Change INITIALIZE_SOCKET_SUBSYSTEM to
	SYSTEM_INITIALIZE and pass it pointers to argc and argv.  Rename
	CLEANUP_SOCKET_SUBSYSTEM to SYSTEM_CLEANUP.

Wed Jun 05 10:07:29 1996  Mike Ladwig  <mike@@twinpeaks.prc.com>

	* import.c (add_rcs_file): make buf char[] not unsigned char[]

Wed Jun 05 10:07:29 1996  Mike Ladwig  <mike@@twinpeaks.prc.com>
			  and Jim Kingdon  <kingdon@@cyclic.com>

	* main.c (main): Add CLEANUP_SOCKET_SUBSYSTEM hook at end.  Revise
	comments regarding INITIALIZE_SOCKET_SUBSYSTEM.

Wed Jun 05 10:07:29 1996  Mike Ladwig  <mike@@twinpeaks.prc.com>
			  and Jim Kingdon  <kingdon@@cyclic.com>

	* main.c (main): Don't mess with signals if DONT_USE_SIGNALS is
	defined.

Thu Jun  6 15:32:41 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* modules.c (cat_module): Always format for 80 columns rather than
	trying to determine how wide the screen is.  The code we had for
	the latter didn't cover all cases, was a portability headache, and
	didn't work client/server.

Wed Jun 05 10:07:29 1996  Mike Ladwig  <mike@@twinpeaks.prc.com>

	* error.c: Don't declare strerror if it is #defined.

Wed Jun 05 10:07:29 1996  Mike Ladwig  <mike@@twinpeaks.prc.com>
			  and Jim Kingdon  <kingdon@@cyclic.com>

	* cvs.h: If ENUMS_CAN_BE_TROUBLE, typedef Dtype to int not an enum.

Wed Jun 05 10:07:29 1996  Mike Ladwig  <mike@@twinpeaks.prc.com>
			  and Jim Kingdon  <kingdon@@cyclic.com>

	* update.c (update):  If DONT_USE_PATCH, don't request patches.
	Also call supported_request rather than reimplementing it.

Wed Jun 05 10:07:29 1996  Mike Ladwig  <mike@@twinpeaks.prc.com>

	* client.c (read_line): Changed an occurence of '\n' to '\012'.

Wed Jun  5 17:18:46 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* add.c (add_directory): Don't create the directory if noexec.
	* sanity.sh (basica): New tests basica-1a10, basica-1a11 test for
	above fix.
	* sanity.sh (basicb): New tests basicb-2a10, basicb-2a11,
	basicb-3a1 test for analogous situation with files rather than
	directories.

Tue Jun  4 13:38:17 1996  Ian Lance Taylor  <ian@@cygnus.com>

	* sanity.sh: When doing a remote check, use :server: in CVSROOT.

Wed Jun  5 13:32:40 1996  Larry Jones  <larry.jones@@sdrc.com>
			  and Jim Kingdon  <kingdon@@cyclic.com>

	* ignore.c: Set ign_hold to -1 when not holding instead of 0 so 
	that holding an empty list works correctly.
	* sanity.sh (ignore): New tests 190 & 191 for above fix.

Wed Jun 5 1996  Jim Kingdon  <kingdon@@cyclic.com>

	Visual C++ lint:
	* client.c (update_entries): Copy the size to an unsigned variable
	before comparing it with unsigned variables.
	(handle_created, handle_update_existing): Prototype.

Tue Jun  4 10:02:44 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* client.c (responses): Add Created and Update-existing responses.
	* server.c (server_updated): If they are supported, use them
	instead of Updated.
	* client.c (struct update_entries_data): Add existp field.
	(handle_checked_in, handle_updated, handle_new_entry,
	handle_merged, handle_patched): Set it.
	(handle_update_existing, handle_created): New functions,
	for new responses.
	(update_entries): Based on existp, check for
	existence/nonexistence of file.
	(try_read_from_server): Expand comment.
	* server.c, server.h (server_updated): New argument vers.
	* checkin.c (Checkin), commit.c (commit_fileproc), update.c
	(update_fileproc, merge_file, join_file): Pass it.
	* cvs.h: Move include of server.h after Vers_TS declaration.
	* sanity.sh (conflicts2): New tests conflicts2-142d* test for
	above fix.

	* sanity.sh (ignore): Fix typo in comment.

	* tag.c (tag_check_valid): Add comment clarifying when val-tags
	entries are created.

Mon Jun  3 07:26:35 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* version.c: Increment version number to 1.8.4.

Mon Jun  3 02:20:30 1996  Noel Cragg  <noel@@gargle.rain.org>

	* version.c: version 1.8.3.

Thu May 30 10:07:24 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* main.c (cmds): Fix typo ("bdif" -> "dif") which was accidentally
	introduced 24 May 96.

	* main.c (main_cleanup): Add comment stating default case will
	never be reached.

Wed May 29 21:43:43 1996  noel  <noel@@BOAT_ANCHOR>

	* main.c (main_cleanup): check to see if SIGHUP, SIGINT, SIGQUIT,
 	SIGPIPE, and SIGTERM are defined before using them.  Also add a
 	default case to print out those errors numerically which are not
 	found.

Wed May 29 18:43:45 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* expand_path.c (expand_path): Document LINE == 0 and allocation
	of return value.
	* modules.c (do_module): Pass 0, not -1, to indicate line number
	not known.  Free value returned from expand_path.  Deal with NULL
	return from expand_path.

Wed May 29 15:56:47 1996  Greg A. Woods  <woods@@most.weird.com>

	* modules.c (do_module): call expand_path() on the program name
	specfied by one of '-o', '-t', or '-e' in the modules file before
	passing it to run_setup().  This makes it possible to use $CVSROOT
	(or indeed ~user or any other user-specified variable) to specify
	pathnames for programs not installed in the normal execution path.

Sun May 26 21:57:09 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* client.c (start_server): Don't include %s in error message;
	there is no argument to go with it.  Do include "internal error"
	in error message since that might not be clear to the user otherwise.

Sun May 26 11:58:13 1996  Greg A. Woods  <woods@@most.weird.com>

	* root.c (set_local_cvsroot): enforce a wee bit of portability
	(parse_cvsroot): same....
	(DEBUG main): same, plus style guidelines
	(DEBUG error): deleted -- not necessary here (use fprintf instead)

	* mkmodules.c (modules_contents): updated notes about what must be
	done if you change any of the options for a module.
	(loginfo_contents): fixed grammar, re-pargraphed, and added 'echo
	%s;' to the example.
	(editinfo_contents): minor grammar fix.

Sun May 26 17:51:18 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* vers_ts.c (Version_TS): Remove case where we get options from
	sdtp->options.  Whatever case that was intended to handle is
	probably lost in the mists of time, but sdtp->options isn't set
	anywhere, and I think that has been true for a long time.
	* cvs.h (struct stickydirtag): remove options field.
	* entries.c (freesdt): Don't free ->options.
	* sanity.sh (binfiles): New tests binfiles-13a* test for above fix.

	* tag.c (check_fileproc): Use fullname not file in error message.
	Say "locally modified" not "up-to-date"; the file need not match
	the head revision it only need match some revision.

Sun May 26 16:57:02 1996  Norbert Kiesel  <nk@@col.sw-ley.de>

	* tag.c: added support for new option -c to make sure all tagged
	  files are up-to-date
	  (tag): check for option and set check_uptodate
	  (check_fileproc): check status of file if check_uptodate is set

Sat May 25 15:22:26 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* main.c (main): Revert change to look for a -H command option;
	command option parsing should be up to each subcommand and the -H
	global option works fine.

Mon May 23 1996  Ian Lance Taylor  <ian@@cygnus.com>

	* client.c (process_prune_candidates): Set prune_candidates to
	NULL at the end of the function.

Mon May 23 1996  Ian Lance Taylor  <ian@@cygnus.com>

	* checkout.c (checkout): In code to handle multiple arguments,
	pass preload_update_dir, not where, to Create_Admin.
	(checkout_proc): Pass preload_update_dir, not where, to
	Create_Admin.

Thu May 23 19:14:35 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* server.c (server_set_sticky): Assert that update_dir != NULL.
	* sanity.sh (basicb): New test; tests for Ian's fix to checkout.c
	above.

Thu May 23 1996  Ian Lance Taylor  <ian@@cygnus.com>

	* patch.c (patch_fileproc): Don't ignore a file just because it is
	in the Attic directory.

Thu May 23 10:40:24 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* sanity.sh (death): New tests death-{72a,76a0,76a1} test for bug
	fixed by Ian's patch_fileproc change above.

	* sanity.sh (death): Remove "temporary hack" in test 89.

	* rcs.c (RCS_fast_checkout): If error closing file, and workfile
	is NULL, use sout in error message instead of workfile.

Thu May 23 1996  Ian Lance Taylor  <ian@@cygnus.com>

	* rcs.c (RCS_fast_checkout): Do a fast checkout in the case where
	workfile is NULL and sout is a file name.

Wed May 22 19:06:23 1996  Mark Immel  <immel@@centerline.com>

	* update.c (checkout_file): New arg resurrecting_out, to provide
	resurrecting flag to caller.
	(join_file): New arg resurrecting.  Register with "0" if we are
	the server and are resurrecting.
	(update_fileproc): Pass the flag from checkout_file to join_file.

Wed May 22 19:06:23 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* sanity.sh (death): Test for above fix, in test 89 and new test 89a.

Tue May 21 09:49:04 1996  Greg A. Woods  <woods@@most.weird.com>

	* update.c (update_usage): oops -- fix my spelling typo.

Mon May 20 10:53:14 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* commit.c (find_fileproc): Call freevers_ts.

	* commit.c (find_*): Keep an ignlist, like update.c and client.c do.
	* commit.c (commit): Process the files from the ignlists, once we
	are connected to the server.
	* sanity.sh (ignore): New tests 189e and 189f test for new
	commit.c behavior (and client.c behavior, which is unchanged).
	* sanity.sh (conflicts): Remove dir1 and sdir in parts of the test
	where we aren't prepared for "? dir1" and similar output.

Mon May 20 13:23:36 1996  Greg A. Woods  <woods@@most.weird.com>

	* main.c (cmd_usage): minor corrections to descriptions of status,
	rtag, tag, and rdiff.  Sort alphabetically by command name.

Mon May 20 10:36:07 1996  Ian Lance Taylor  <ian@@cygnus.com>

	* client.c (call_in_directory): Move the call to Entries_Close
	before the call to chdir, since Entries_Close examines files in
	the current directory.

Fri May 17 12:13:09 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* client.c (start_tcp_server, start_server, start_rsh_server,
	read_line, filter_through_gzip, filter_through_gunzip,
	call_in_directory): Reindent as needed.

	* main.c (main): Add missing #endif.  Use indentation to indicate
	nesting.

Thu May 16 17:15:01 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* main.c (cmd_usage): Add "init" command.

Thu May 16 16:45:51 1996  Noel Cragg  <noel@@gargle.rain.org>

	* client.c (start_tcp_server): Error message modified to tell the
 	user to use ":server:" instead of setting CVS_CLIENT_PORT to a
 	negative number.

	* main.c (main): Add #ifdefs for turning off buffering of
 	stdio/stderr, so we don't get it by default.

Thu May 16 01:29:47 1996  noel  <noel@@BOAT_ANCHOR>

	* commit.c (commit_filesdoneproc): Print the repository and root
 	directories as part of the error message.

	* main.c (main): Don't buffer stdout or stderr.  It's inefficient,
 	but it then produces the right output for sanity.sh.

Thu May 16 09:44:47 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* fileattr.c (fileattr_set): In the case where we are about to
	call delproc, don't free ->data; delproc does that.
	* sanity.sh (devcom): New tests devcom-b* test for this fix.

	* sanity.sh (conflicts): Remove redundant clean up from previous
	tests at the beginning of the test.  Use dotest a few more places.
	(conflicts2): New test, tests for Ian's fix to Classify_File.

	* client.c (remove_entry_and_file): Add comment about
	existence_error's.

Sat May 16 1996  Ian Lance Taylor  <ian@@cygnus.com>

	* update.c (update_dirleave_proc): Don't try to chdir .. and check
	for an empty directory if there is a slash in the directory name.

Thu May 16 09:02:59 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* sanity.sh (deep): New tests deep-4a* test for Ian's fix to
	update_dirleave_proc.

Sat May 16 1996  Ian Lance Taylor  <ian@@cygnus.com>

	* main.c (main_cleanup): Report signal name before dying.

Wed May 15 23:47:59 1996  Noel Cragg  <noel@@gargle.rain.org>

	* main.c (usg): revert usage strings for `-H' flag change.

Sat May 15 1996  Ian Lance Taylor  <ian@@cygnus.com>

	* server.c (serve_static_directory): Return immediately if there
	is a pending error.
	(serve_sticky): Likewise.
	(serve_modified): Read the file data even if there is a pending
	error.

Wed May 15 14:26:32 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* main.c (main): If -d and CVS/Root both specified, after writing
	the value from -d into CVS/Root, use the value from -d, not the
	old value from CVS/Root.  Don't write CVS/Root with value from -d
	until we have verified that it works.
	* sanity.sh: Reenable test basica-9 and adjust for new behavior.

Tue May 14 1996  Jim Kingdon  <kingdon@@cyclic.com>

	* logmsg.c (do_editor): If user aborts the commit, still remove the
	temporary file.

Tue May 14 11:45:41 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* filesubr.c, cvs.h (cvs_temp_name): New function.  Move L_tmpnam
	define from cvs.h to filesubr.c.
	* client.c, diff.c, import.c, login.c, logmsg.c, no_diff.c,
	patch.c, wrapper.c: Call cvs_temp_name not tmpnam.
	* login.c (login): Reindent function.

Tue May 14 10:56:56 1996  Ian Lance Taylor  <ian@@cygnus.com>

	* rcs.c (RCS_fast_checkout): If workfile is NULL, don't call chmod.

Mon May 13 10:52:10 1996  Greg A. Woods  <woods@@most.weird.com>

	* checkout.c (export_usage): note which options cause a sticky
	version to be set, and which option avoids this.
	* update.c (update_usage): likewise

Sat May 11 18:57:07 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* sanity.sh: Comment out test basica-9 until I get around to
	actually fixing it (the -d vs. CVS/Root change broke it).

Fri May 10 09:39:49 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* main.c (main): -d now overrides CVS/Root.

Thu May  9 19:45:24 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* main.c: Remove comment listing commands at beginning.  It was
	out of date and redundant with the help.

Thu May  9 09:33:55 1996  Greg A. Woods  <woods@@most.weird.com>

	* main.c: add 'init' to opening comment listing commands

	* mkmodules.c (init): fix to recognize argc==-1 as hint to call
	usage() [should make "cvs init -H" work as expected]

Wed May  8 15:02:49 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* sanity.sh: Set EXPR in the case that the expr in the path is the
	one that we want.

Wed May  8 14:06:24 1996  Greg A. Woods  <woods@@most.weird.com>

	* sanity.sh (test): - convert all '[' to test ala GCD

Wed May  8 13:46:56 1996  Greg A. Woods  <woods@@most.weird.com>

	* sanity.sh (expr): - make a valiant attempt to find GNU expr
	- Patch from Larry Jones:
	sanity test deep-4 failed with "expr: arg list too long"
	sanity test 56 failed because the stderr and stdout output was not
	interleaved as expected.
	sanity test modules-155a4 failed with "ls: illegal option -- 1"

	* main.c (main): - Patch from Larry Jones for SysV setvbuf

Tue May  7 16:41:16 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* version.c: Increment version number to 1.8.2 to work around fact
	that CVS 1.8 (confusingly) calls itself 1.8.1 not 1.8.

Tue May  7 10:44:20 MET DST 1996  Norbert Kiesel  <nk@@col.sw-ley.de>

	* rcs.c (rcsvers_delproc): fix memory leak by freeing author
	  field.

Mon May  6 10:40:05 1996  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* sanity.sh (conflicts): New test conflicts-126.5 tests for bug
	which Ian fixed May 5 in update.c

Mon May  6 06:00:10 1996  Benjamin J. Lee  <benjamin@@cyclic.com>

        * Version 1.8.1

a20 25
Sat May  4 12:33:02 1996  Ian Lance Taylor  <ian@@cygnus.com>

	Extract the head revision directly from the RCS file when
	possible, rather than execing co.
	* rcs.c (RCS_reparsercsfile): Set delta_pos field.
	(getrcskey): Add lenp parameter.  Change all callers.
	(RCS_fast_checkout): New function.
	(annotate_fileproc): If PARTIAL is not set, just fseek to
	delta_pos.
	* rcs.h (struct rcsnode): Add delta_pos field.
	(RCS_fast_checkout): Declare.
	* diff.c (diff_file_nodiff): Call RCS_fast_checkout rather than
	RCS_checkout.
	* import.c (update_rcs_file): Likewise.
	* no_diff.c (No_Difference): Likewise.
	* patch.c (patch_fileproc): Likewise.
	* update.c (checkout_file): Likewise.
	(patch_file): Likewise.
	(join_file): Likewise.

Sat May  4 12:33:02 1996  Ian Lance Taylor  <ian@@cygnus.com>

	* classify.c (Classify_File): Don't report a conflict for a
	pending remove if somebody else has already removed the file.

a30 12
Wed May 01 21:08:21 1996  noel  <noel@@BOAT_ANCHOR>

	* client.c (filter_through_gunzip): use "gzip -d" instead of
 	"gunzip," since there's no good reason (on NT at least) to have an
 	extra copy of gzip.exe copied to gunzip.exe (Arrrrgh!  No symbolic
 	links!).

	* mkmodules.c (init): check to see that we have the correct number
 	of arguments or print out the usage message (used to be argc > 1,
 	should be argc != 1, because help forces argc == -1 as a special
 	case).

a59 92
Mon Apr 29 10:48:38 1996  Noel Cragg  <noel@@gargle>

	* root.c (parse_cvsroot): removed "rsh" as an alias to "server" in
 	the method section.

	* main.c (main): new variable help so we can support the `cvs -H
 	cmd' convention.  Reverts change of 26 Apr 96 which removed this
 	feature.

Sun Apr 28 14:57:38 1996  Noel Cragg  <noel@@gargle>

        * main.c (main): update error message if parse_cvsroot fails.
	* server.c (serve_root): same.
	(serve_init): same.
	
	* client.c (start_tcp_server): get rid of the "fall through"
 	stuff, now that we have access methods.
	(start_server): switch off the access method to choose routine
 	that starts the server.
	(start_tcp_server): tofd wasn't getting set to -1 early enough,
 	because a call to error for bind or gethostbyname might fail and
 	the subsequent error check to see if the connection had been made
 	would fail.

	* root.c: new variable method_names for error reporting purposes.

Sun Apr 28 17:22:15 1996  Noel Cragg  <noel@@occs.cs.oberlin.edu>

	* server.c: moved kerberos #includes from main.c for the
        kserver_authenticate_connection routine.

Fri Apr 26 07:59:44 1996  Noel Cragg  <noel@@gargle>

	* server.c (serve_init): use the new return value from
 	parse_cvsroot.
	(serve_root): same.
	* main.c (main): same.

	* root.c (parse_cvsroot): fix indentation, add a return value
 	which tells whether the command succeeded or failed.

	* main.c (main): move the setting of the UMASK environment
 	variable inside the stuff that gets done if the user is NOT asking
 	for help, so we don't signal any errors prematurely (don't want to
 	give an error because we can't parse an environment variable
 	correctly if the user asks for help).  Similar mods for the code
 	that tries to get the working directory.

	Also make CVSADM_Root a local variable instead of a global, since
 	its scope is only about 20 lines here!

	* server.c (kserver_authenticate_connection): moved code from
 	main.c to clean up MAIN.  Makes sense, since we already have a
 	pserver_authenticate_connection.
	(pserver_authenticate_connection): rename from
 	authenticate_connection.

	* main.c (main): reorganized the routine to eliminate variables
 	help, help_commands, and version_flag.  Now the routine is much
 	clearer, since we don't have to be checking to see if these
 	variables are set.  One behavior that was a bug/feature which is
 	now gone is an invocation like "cvs -H rtag" -- previously this
 	would give usage for rtag, but now gives usage for cvs itself.
  	The first behavior didn't make sense, especially since we say in
 	the docs that command-line flags are position-specific.  *Reverted
 	Above*

Thu Apr 25 20:05:10 1996  Noel Cragg  <noel@@gargle>

        * main.c (main): make sure we have a valid command name before we
 	do anything else (moved the thing that looks for a command in CMDS
 	to right after the GETOPT loop).  Added `kserver' and `pserver' to
 	the table so they will be recognized; set their functions to
 	SERVER so that help will be given when asked for.
	
	* expand_path.c (expand_variable): return CVSroot_original rather
 	than CVSroot_directory.

	* main.c (main): save CVSroot in the env rather than
 	CVSroot_original, since we might not have called PARSE_CVSROOT
 	(this can happen if we use the -H option to a command).

	* root.c (parse_cvsroot): the parsing method was bogus for
 	guessing when we had hostnames vs. directories specified.  Any
 	ambiguity should be removed by having the user specify the access
 	method.  If the access method isn't specified, choose
 	server_method if the string contains a colon or local_method
 	otherwise.

	* Changed CVSroot_remote back to client_active since the code
 	reads better.
	
a63 95

Mon Apr 22 00:38:08 1996  Noel Cragg  <noel@@gargle>

	* create_adm.c (Create_Admin): pass CVSroot_original instead of
 	CVSroot_directory (oops!).
	* update.c (update_filesdone_proc): same.

	* server.c (serve_root): modify to use parse_cvsroot rather than
 	goofing around with other variables.  Will need to fix
 	parse_cvsroot to have a return value so we can return an error and
 	quit gracefully if in server mode.
	(serve_init): same.

	* main.c: modify command table to remove client_* routines, since
 	they no longer exist.
	(main): don't try to switch off non-existent field in command
 	table! ;-)

        * client.h (client_*): removed prototypes for now non-existent
 	functions.

	* client.c: remove proto for get_cvs_password, since it is now in
 	cvs.h.  Modify routines to use new globals that describe CVSROOT
 	rather than client_active, server_host, server_user, and
 	server_cvsroot.
	(parse_cvsroot): removed function, since a more generic version
 	now lives in root.c.
	(connect_to_pserver): remove call to parse_cvsroot, since main.c
 	has already done it for us.
	(client_*): removed all of these routines, since they only call
 	parse_cvsroot and then their respective operation functions.
  	Since main.c has already called parse_cvsroot, we shouldn't bother
 	with the extra function call, since client-server diffs are
 	already handled in the core routines themselves.

	* main.c: remove CVSroot as a global variable.  Remove
 	use_authenticating_server variable since we have a new
 	`CVSroot_method' variable instead.
	(main): add `CVSroot' as a local variable.  Call parse_cvsroot
 	after we're sure we have the right setting for `CVSroot.'

	* login.c (login): update to use new global variables.  Instead of
 	old behavior which let the user type in user@@host when prompted,
 	it makes them do it in CVSROOT proper.  The routine still lets the
 	user type the password, however.
	(get_cvs_password): make sure that CVSROOT is fully qualified
 	before trying to find the entry in the .cvspass file.
	* cvs.h: add prototype for get_cvs_password.

	* add.c: use new globals that describe CVSROOT.
	* admin.c: same.
	* checkout.c: same.
	* commit.c: same.
	* create_adm.c: same.
	* diff.c: same.
	* edit.c: same.
	* expand_path.c: same.
	* history.c: same.
	* ignore.c: same.
	* import.c: same.
	* log.c: same.
	* mkmodules.c: same.
	* modules.c: same.
	* parseinfo.c: same.
	* patch.c: same.
	* rcs.c: same.
	* recurse.c: same.
	* release.c: same.
	* remove.c: same.
	* repos.c: same.
	* rtag.c: same.
	* status.c: same.
	* tag.c: same.
	* update.c: same.
	* watch.c: same.
	* wrapper.c: same.
	
	* root.c (Name_Root): remove error message that reports missing
 	CVSROOT, since new code in main.c will catch it and also print out
 	an error.
	(parse_cvsroot): new function -- takes a CVSROOT string and breaks
 	it up into its component parts -- method, hostname, username, and
 	repository directory.  Sets new global variables that describe the
 	repository location more precisely: CVSroot_original,
 	CVSroot_remote, CVSroot_method, CVSroot_username,
 	CVSroot_hostname, CVSroot_directory for use by all other
 	functions.  Checks for obvious errors in format of string.
	(main): a short routine to test parse_cvsroot from the command
 	line.
	* cvs.h: add prototype for parse_cvsroot and extern definitions
 	for new globals.

	* cvs.h: removed CVSroot variable, since we don't want other
 	routines using the raw CVSROOT (also helped to find all of the
 	refs to the variable!).
@


1.1.1.6
log
@New release from Cyclic Software
@
text
@d1 1
a1 1
Thu Jan 16 00:06:00 1997  Jim Kingdon  <kingdon@@harvey.cyclic.com>
d3 3806
a3808 1
	* version.c: Version 1.9.2.
d3810 2
a3811 180
Wed Jan 15 09:14:38 1997  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* client.c (call_in_directory): Take code that creates CVSADM at
	top level, move it before the CVS_CHDIR (dir_name) call, and do it
	regardless of whether dir_name is ".".  Pass "." not dir_name to
	Create_Admin (when the code was written they were always the
	same).  Don't add reposdirname to the repository we pass to
	Create_Admin (when the code was written, I think reposdirname
	probably would always be ".").  Don't create CVSADM if
	reposdirname_absolute.
	* sanity.sh (basicb): Enable tests basicb-1a and basicb-9a for
	remote; tests for above fix.
	(basic1): Do entire test within a "1" directory to deal with
	creation of CVS directories at top level.  Support --keep.
	(conflicts): In test conflicts-136, only update first-dir.
	(basica): Uncomment the part that tests "cvs co -l .".  That tests
	the existing functionality which I might have (but hopefully did not)
	perturbed with the call_in_directory changes.

Mon Jan 13 11:04:32 1997  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* server.c (check_command_legal_p): Do not call error (1, ...)
 	here; that will always cause a protocol violation by shutting down
	the connection prematurely.  Remove croak_on_illegal arg.
	(do_cvs_command): Move call to check_command_legal_p until after
	the call to print_pending_error.  Print the error message ourself.

	* mkmodules.c (filelist): Add readers and writers.  Add comment
	about why passwd is not included.  Add comment about meaning of
	NULL contents field.

Fri Jan 10 13:23:09 1997  Norbert Kiesel  <nk@@col.sw-ley.de>

	* release.c (release): Initialize delete_flag before reading it
	(found by running purify)

	* logmsg.c (do_verify): Fix reading unallocated memory (found by
 	running purify)

Thu Jan  9 16:32:47 1997  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* checkout.c (build_dirs_and_chdir): Partially revert 3 Jan
	change--move call to Subdir_Register back above the CVS_CHDIR call
	(we need to register in the old, not the new, directory).  Instead
	of calling CVS_MKDIR and ignoring errors, call mkdir_if_needed;
	this is an effort to catch errors there rather than catching them
	in the CVS_CHDIR.  This makes test 27-add-add in sanity.sh work
	again.

	* find_names.c (Find_Directories): Remove code inside
	#ifdef ATTIC_DIR_SUPPORT and replace it with a comment explaining
	why we don't look in the attic.  ATTIC_DIR_SUPPORT was never defined.

	* find_names.c (find_dirs): Add comment about tmp being unset.

	* commit.c (checkaddfile): Report errors with errno and specific
	error messages.

	* rcs.c, commit.c, create_adm.c, entries.c, find_names.c,
	ignore.c, history.c: Nuke PATH_MAX arbitrary limits.

Wed Jan  8 23:07:41 1997  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* add.c (add): Reindent a portion which needed it.

1997-01-08  Jim Kingdon

	* client.c (send_file_names): When looking name up in Entries,
	call Entries_Open and Entries_Close.  This has two effects:
	(1) we look at Entries.Log, and (2) we don't skip 'D' entries,
	both of which are needed to make us get the right (command
	line) name for a directory we are adding.

Wed Jan  8 14:50:47 1997  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* Makefile.in, cvs.h, hash.h, myndbm.h, rcs.h: Remove CVSid; we
	decided to get rid of these some time ago.

Tue Jan  7 12:56:10 1997  Karl Fogel  <kfogel@@ynu38.ynu.edu.cn>

        * root.c (check_root_consistent): new func, compares below new
        global var with CVSroot_directory, assuming both set.
        (set_local_cvsroot): use above new func for security check.
        (parse_cvsroot): same.
        But do all of above only #ifdef AUTH_SERVER_SUPPORT.

        * server.c: (Pserver_Repos): new global var, init to NULL.
        (pserver_authenticate_connection): set above new global.
        (check_repository_password): be a good scout and use
        CVSROOTADM and CVSROOTADM_PASSWD, now that they are the standard.
        Make sure all of above is in #ifdef AUTH_SERVER_SUPPORT.
        (check_command_legal_p): wrap most of body in #ifdef
        AUTH_SERVER_SUPPORT.
        Everywhere: wrap all references to CVS_Username in #ifdef
        AUTH_SERVER_SUPPORT.

        * cvs.h (Pserver_Repos): new var, used in consistency [security]
        check.  Defined only #ifdef AUTH_SERVER_SUPPORT.
        (CVSROOTADM_PASSWD): new #define, trying to get with the program.

Fri Jan  3 18:10:39 1997  Ian Lance Taylor  <ian@@cygnus.com>

	* checkout.c (build_dirs_and_chdir): Move call to Subdir_Register
	until after we know that the directory exists.

Thu Jan  2 13:30:56 1997  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* Makefile.in, cvsbug.sh, edit.c, edit.h, error.c, error.h,
	fileattr.c, fileattr.h, filesubr.c, run.c, update.h, watch.c,
	watch.h: Remove "675" paragraph; see ../ChangeLog for rationale.

Thu Jan  2 12:27:46 1997  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* sanity.sh (info): New test info-cleanup-verifymsg gets rid of
	verifymsg when we are done with it.

	* sanity.sh (basicb): Skip tests basicb-1a and basicb-9a for remote.
	* sanity.sh (modules-155a4): It is OK if a CVS directory exists.
	* sanity.sh (ignore): Do everything inside a "1" directory.  The
	change to create CVS directories at top-level causes messages such as
	"? home" otherwise.  In test 191, specify -I CVS so that new CVS
	directory is ignored.
	* sanity.sh (crerepos): Manually remove CVS directory which had not
	existed before.

Thu Jan  2 09:06:20 1997  Karl Fogel  <kfogel@@ynu38.ynu.edu.cn>

        * server.c: Changes for pserver read-only repository access:
        (check_command_legal_p): new func.  Right now, just checks if
        repository modification is permitted, and that only if pserver is
        active.
        (do_cvs_command): take new parameter `cmd_name', a string.  All
        callers changed.  Pass it on to new func check_command_legal_p()
        before executing the command.
        (CVS_Username): new global, init to NULL.  Used by
        check_command_legal_p(), set in check_password().
        (check_password): set above new global CVS_Username; reorganized a
        bit to facilitate this.
        (check_repository_password): give *host_user_ptr permanent
        storage iff success.

        * main.c: Changes for pserver read-only repository access:
        (lookup_command_attribute): new func.
        (main): use new func lookup_command_attribute() to establish if
        CVS_CMD_IGNORE_ADMROOT and CVS_CMD_USES_WORK_DIR.

        * cvs.h: Changes for pserver read-only repository access:
        (CVSROOTADM_READERS, CVSROOTADM_WRITERS): new #defines.
        Prototype lookup_command_attribute().
        (CVS_CMD_IGNORE_ADMROOT, CVS_CMD_USES_WORK_DIR,
        CVS_CMD_MODIFIES_REPOSITORY): new #defines for
        lookup_command_attribute() and its callers.

Wed Jan  1 19:50:38 1997  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* options.h.in: Reword comment for TMPDIR_DFLT to make it clear
	that this isn't specific to the pserver server.

	* modules.c (do_module): Give an error message if one tries to
	specify -a together with another option.
	* sanity.sh (modules2): New tests modules2-a* test for above fix.

	* sanity.sh (devcom): Add tests devcom-a-nonexist and
	devcom-t-nonexist for "cvs watchers" on nonexistent argument.

1997-01-01  Fred Fish  <fnf@@ninemoons.com>

	* run.c (piped_child, filter_stream_through_program): Actually
	install these HAVE_VFORK patches that got missed.
	(There was a log entry for these changes for 29 Nov 1996 but it
	seems I accidentally forgot to actually check them in -kingdon).

Wed Jan  1 18:32:44 1997  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* Makefile.in: Add ChangeLog-96.
	* ChangeLog-96: New file, contains former contents of ChangeLog.
	* ChangeLog: Now just contains 1997 changes.


For older changes see ChangeLog-96.
@


1.1.1.7
log
@New release from Cyclic Software
@
text
@a0 441
Sun Mar 16 10:18:28 1997  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* version.c: Version 1.9.4.

	* rcscmds.c (RCS_checkin): Preserve the mode of the rcsfile.
	RCS_CI usually, but not always, does this for us.
	* commit.c (fix_rcs_modes): Replace algorithm with a more
	CVSUMASK-friendly one.
	* sanity.sh (modes): Update tests modes-5, modes-7, modes-10, and
	modes-15 so they test that CVSUMASK is honored.

Sun Mar 16 10:18:28 1997  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* sanity.sh (modes): New tests modes-7a and modes-7b test behavior
	if one manually changes the modes in the repository.

	* server.c (server): Revise code which checks for errors creating
	temporary directory.  This won't solve the intermittent
	  can't create temporary directory
	  Unknown error -1
	but it will mean (a) the right message based on errno gets
	printed, instead of "unknown error -1", and (b) the message says
	that it happened in chmod instead of mkdir_p.

Sat Mar 15 16:47:12 1997  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* sanity.sh (modes): New tests.  Note that (for now) these are
	just testing how CVS already behaves; I want to record that before
	I move on to changing CVS's behavior with modes of RCS files.

13 Mar 1997  Jim Kingdon

	* subr.c (line2argv): Change argv_allocated from size_t to int.

Wed Mar 12 22:16:44 1997  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* add.c (add_directory): If repository has an extraneous "."
	directory at the end, strip it off.  This fixes a bug which was
	introduced when strip_path was nuked (this fix is much more
	limited in scope than strip_path was; I _think_ that is a good
	thing).
	(add): Likewise, for client.
	(combine_dir): New function, helps with above.
	* sanity.sh (modules3): Reenable tests for this behavior.
	(basica-0b, basicb-0e): Adjust test to reflect "foo/bar" instead
	of "foo/./bar" in message.  As with the rest of this, I believe
	this is just restoring the behavior prior to the strip_path nuking
	(I tried it with CVS 1.9).

Sun Mar  9 10:06:29 1997  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* root.c (parse_cvsroot), server.c (serve_root, serve_init):
	If CVSroot_directory is not an absolute pathname, give a fatal error.
	* sanity.sh (crerepos): New tests crerepos-6* test for above fixes.

Sat Mar  8 22:06:17 1997  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	This cleans up the last known code which can overflow its buffers
	(except the Mac client).  I've skimmed through much of CVS looking
	for other such places; but I didn't read everything.  If I missed
	any please report it to bug-cvs.
	* logmsg.c (logfile_write, title_proc): Realloc str_list as
	needed; don't assume MAXLISTLEN is enough.
	* cvs.h (MAXLISTLEN, MAXFILEPERDIR): Removed; no longer used.
	* add.c, myndbm.c, parseinfo.c, update.c: Nuke MAXLINELEN limit.
	* parseinfo.c, update.c, mkmodules.c: Check for errors reading file.
	* cvs.h (MAXLINELEN): Removed; no longer used.
	* logmsg (MAXHOSTNAMELEN): Removed; not used.
	* main.c (cmd_synonyms): Allocate based on fullname, nick1, and
	nick2, just in case someone makes those big enough so that 100
	bytes is not enough.
	(Make_Date): Use MAXDATELEN rather than our own fixed size.
	* mkmodules.c (mkmodules): Nuke arbitrary limit on line length.
	* rcs.c (ALLOCINCR): Remove; not used.
	(RCS_check_kflag): Add comment concerning karg size.
	* run.c: Allocate run_prog to the needed size, rather than
	allocating a fixed size buffer.

Fri Mar  7 22:39:08 1997  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* logmsg.c (logfile_write): Allocate prog to needed length rather
	than assuming MAXPROGLEN is enough.
	* cvs.h (MAXPROGLEN): Removed; no longer used.
	* subr.c (MIN_INCR): Update comment to reflect MAXPROGLEN's demise.

	* subr.c (free_names): Fix comment: this function is not used to
	free memory allocated by Find_Names (at least it hasn't for a long
	time).
	* subr.c, cvs.h (line2argv): Change calling convention so that we
	allocate argv array rather than the caller.  The previous one had
	no way of checking whether we overflowed the passed-in buffer.
	* subr.c (free_names): Free the argv array too.
	* modules.c (do_module, cat_module): Update callers.

Thu Mar  6 12:44:42 1997  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* import.c: Allocate vhead and vbranch dynamically; removes
	arbitrary limit.
	* history.c: Likewise (since_rev, since_tag, backto, rec_types).
	* ignore.c: Likewise (line).  Also check for errors from getline
	and add 'copyright' notice to top of file.
	* wrapper.c (wrap_add_file): Likewise (line).  Also check for
	errors from various calls and add 'copyright' notice to top of file.

Tue Mar  4 17:39:15 1997  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* client.c (update_entries): Add comment about "move away <file>"
	message.

Mon Mar  3 21:51:40 1997  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* sanity.sh (basicb): Clean up topfile,v at end of test.  Fixes
	failure in modules-155b.

Sun Mar  2 18:11:09 1997  Dan Wilder  <dan@@gasboy.com>
			  and Jim Kingdon

	* admin.c (admin): Arrange to perform recursion if "cvs admin"
	is passed only options.

Sun Mar  2 18:11:09 1997  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* sanity.sh (basicb): New tests basicb-0* test for files at top
	level.

	* error.c (error): Add newline to "out of memory" message.  I think
	that its omission probably could cause the message to be lost in
	the bowels of server.c and never passed to the user.

	* client.c (start_rsh_server): Add comment about "remsh" vs. "rsh".

	* cvs.h: Move copyright notice to top of file.

Sun Mar  2 13:44:36 1997  Ian Lance Taylor  <ian@@cygnus.com>

	* sanity.sh: Use -n when testing whether rsh works.

	* server.c (serve_root): Free path.

Sun Mar  2 13:12:46 1997  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	The following are things that I noticed in the process of trying
	to track down:
	  can't create temporary directory
	  Unknown error -1
	  FAIL: test 28
	from nightly testing.  I'm not sure that either item explains that
	message however.
	* server.c (server): Allocate pending_error_text;
	print_pending_error will try to free it so
	  pending_error_text = "foo"
	won't work.
	(mkdir_p): Don't assume that isdir will leave errno unmolested.

Thu Feb 27 15:29:58 1997  Ian Lance Taylor  <ian@@cygnus.com>

	* remove.c (cvsremove): When forcing removal in client mode, use
	start_recursion rather than calling CVS_UNLINK on each argument.
	(remove_force_fileproc): New static function.
	* sanity.sh (deep): Add tests deep-rm7 through deep-rm10 for above
	patch.

	* sanity.sh (death): Enable death-76a0 and death-76a1 tests for
	remote, since they now work.

Wed Feb 26 16:13:26 1997  Ian Lance Taylor  <ian@@cygnus.com>

	* client.c (add_prune_candidate): Skip adding this directory if
	it is the same as the first directory already on the list.

Mon Feb 24 21:36:43 1997  Noel Cragg  <noel@@gargle.rain.org>

	* main.c (lookup_command_attribute): Add the "init" command to the
 	list of commands that don't use the current working directory.

Sun Feb 23 09:54:49 1997  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* sanity.sh (devcom3): Clean up at end of test.

	* sanity.sh (basicb): Add commented out test basicb-8a0, for
	whether CVS can print an error on bad numeric revision to diff.
	Commented out until we get around to fixing CVS.
	* diff.c (diff_file_nodiff): Add comment about this case.

	* fileattr.c (fileattr_read): If a filename is duplicated,
	continue to ignore subsequent lines but free the node so that we
	don't leak memory.
	* sanity.sh (devcom3): New tests devcom3-8 and devcom3-9 test for
	behavior on duplicated filenames.

	* fileattr.h: Add comment about unrecognized ENT-TYPE and order of
	lines in fileattr file.
	* fileattr.c (struct unrecog, unrecog_head): New variables, to
	record unrecognized lines.
	(fileattr_startdir): Assert that unrecog_head == NULL.
	(fileattr_read): Record unrecognized lines in unrecog_head linked
	list rather than ignoring them.
	(fileattr_write): Also write out unrecognized lines, if any.
	* sanity.sh (devcom3): New tests, test for above fix.

	* fileattr.h (fileattr_modify): Fix example in comment.

Sat Feb 22 08:30:27 1997  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* sanity.sh: Add variable username.
	(basica rdiff multibranch log log2): Use it instead of our own
	(inconsistent) ways of matching an author name.

	* filesubr.c, root.c, rtag.c, server.c, subr.c, update.c,
	wrapper.c: Nuke PATH_MAX.
	* cvs.h, wrapper.c (wrap_fromcvs_process_file): Now returns void
	(return value had been unused).
	* cvs.h: Adjust comment to reflect the fact that PATH_MAX is
	gone, at least from src/*.c (except safe_location, as noted).

22 Feb 1997  patch by Tom Hageman  <tom@@basil.icce.rug.nl> (4 Jun 1996)
	updated and commented by Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* update.c (checkout_file): Call unlink_file_dir on backup, not
	unlink_file.

Fri Feb 21 16:40:03 1997  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* Makefile.in (DISTFILES): Remove NOTES.

	* NOTES: Removed.  bcopy->memcpy is done.  "static buffers" I
	assume refers to what is covered by reentrancy text in HACKING.
 	Obstack idea moved to comment in hash.c (at nodecache).  Checking
	system calls for error returns largely done, and isn't a very
	helpful suggestion unless you know where the bogus calls are
	anyway.  Sizing limits--we're in the progress of removing them
	(assuming it meant things like PATH_MAX and earlier, already
	nuked, limits).  Removed various items about changes which were
	done a long time ago (I realize that the ChangeLog's probably
	aren't reliable that far back, but I'm not convinced anyone cares
	anymore).  CONFIRM_DIRECTORY_ADDS: I assume this is a
	reference to the #if 0'd code in add_directory which asks for
	confirmation--a better way of making it harder to accidentally add
	directories would be to have to add and commit directories like
	for files.  I don't know what FORCE_MESSAGE_ON_ADD meant.

	* rcs.c (RCS_getrevtime): Fix documentation (in particular, the
	size of the array that DATE must point to, but many other things
	too).
	* patch.c, recurse.c, release.c, remove.c, repos.c: Nuke PATH_MAX.
	(patch_fileproc): Use MAXDATELEN not hardcoded 50.

Sun Feb 16 12:00:44 1997  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* client.c (client_process_import_file): New variable fullname;
	pass it to send_modified.  This finishes the job of untangling the
	old short_pathname variable into update_dir vs. fullname.

	* client.c (client_process_import_file): Nuke first_time.  If
	toplevel_repos were ever NULL here, the code would dump core in
	strncmp a few lines down.  And client_import_setup ensures
	toplevel_repos is not NULL.

Sun Feb 16 08:16:48 1997  Ian Lance Taylor  <ian@@cygnus.com>

	* client.c (client_process_import_file): Rename short_pathname to
	update_dir (to reflect its function) and make sure that it doesn't
	point to uninitialized memory if repository and toplevel_repos
	contain the same string.

Sun Feb 16 08:16:48 1997  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* client.c (start_rsh_server): Nuke comment about weirdnesses with
	pre-1.5 versions of CVS and .bashrc/.cshrc.  The remote protocol
	is interoperable only back to 1.5, and people who need to know are
	unlikely to see this comment anyway.

Sun Dec 15 13:12:30 1996  Michael Douglass <mikedoug@@texas.net>
			  and Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* main.c (cmds): Added an entry for new logout command.
	(cmd_usage): Added an entry for new logout command.
	(lookup_command_attribute): Added 'logout' to list of commands
	that set need_to_crate_root to 1.
	* login.c, cvs.h (logout): New command for removing entries from
	the .cvspass file.
	(logout_usage): Usage information on the logout command.

Wed Feb 12 11:19:42 1997  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* client.c (struct send_data): Fix indentation.

Wed Feb 12 08:48:04 1997  Greg A. Woods  <woods@@most.weird.com>

	* mkmodules.c (loginfo_contents): add missing comma in
	initializer statement (caused syntax error on SunOS-4).

Tue Feb 11 21:14:28 1997  Ian Lance Taylor  <ian@@cygnus.com>

	* commit.c (find_fileproc): If force_ci is set, set the status to
	T_MODIFIED even if the file hasn't changed.
	(commit): Pass force_ci to send_files as new force argument.
	* client.c (struct send_data): Define.
	(send_fileproc): The callerdat parameter now points to a send_data
	struct.  If force is set, always call send_modified.
	(send_dirent_proc): The callerdat parameter now points to a
	send_data struct.
	(send_files): Add force parameter. Change all callers.  Set up a
	send_data struct and pass it to start_recursion as callerdat.
	* client.h (send_files): Update declaration.
	* sanity.sh (basica): Add a simple test for the above patch.

Sun Feb  9 12:58:59 1997  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* tag.c (cvstag), rtag.c (rtag): Pass -f to server if specified in
	the client.  I haven't tried to come up with a test case because
	the fix seems obvious.

	* import.c (add_rcs_file): Change size of altdate1 and altdate2 to
	MAXDATELEN.
	* cvs.h (MAXDATELEN): Fix comments; describe what this is for.

	* diff.c (diff_usage): Document --ifdef and try to briefly say
	what "rcsdiff-options" means.

	* update.c (update): If update had a nonzero status and we haven't
	yet tried to fetch unpatchable files, go ahead and try it again.
	The previous behavior was to quit, which meant that updates would
	keep failing until you hacked around the problem.  Patch and bug
	report by Ian; comment, ChangeLog entry, and willingness to take
	the flak if checking it is premature by Jim.

	* server.c (alloc_pending): New function.
	* server.c: Call it.  Fixes places where we had neglected to
	check for NULL return from malloc.

	* sanity.sh (binwrap): Add test binwrap-0, tests for import.c fix
	below.

Sun, 9 Feb 1997 (submitted 19 Jul 1996)  John Polstra  <jdp@@polstra.com>

	* import.c (import): Give error if the same tag is specified more
	than once.  The previous behavior was to write an RCS file which
	had the same tag listed twice, once pointing to each revision,
	which is not legal.

Sun Feb  9 12:37:09 1997  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* checkin.c (Checkin): Use cvs_output to print message (should
	make out of order bugs no worse, as it merely substitues a
	protocol_pipe vs. stderr_pipe race instead of a stdout_pipe
	vs. stderr_pipe race).  Add comment about stdout vs. stderr.

Fri Feb  7 08:29:52 1997  Josef Nelissen  <josef.nelissen@@munich.ixos.de>

	* server.c (check_command_legal_p): Don't use ANSI-style definition.

Thu Feb  6 10:55:37 1997  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* patch.c (patch): Give a fatal error for -V option (see comment
	for rationale).

	* diff.c (diff): Also send "options" to server.  Pretty much the
	patch submitted independently by josef.nelissen@@munich.ixos.de and
	Ronald Khoo <ronald@@demon.net>.

Wed Feb  5 18:57:14 1997  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* modules.c (do_module): Fix typo in 30 Jan 97 PATH_MAX nuking
	(free -> free_cwd).  Testsuite test 151 gets credit for catching
	this one.

Mon Feb  3 16:14:54 1997  Ian Lance Taylor  <ian@@cygnus.com>

	* main.c (lookup_command_attribute): Don't use an ANSI prototype
	when defining the function.

Fri Jan 31 12:49:02 1997  Ian Lance Taylor <ian@@cygnus.com>

	* modules.c (do_module): Actually goto found if is_found is set
	(fixes thinko in PATH_MAX nuking of 30 Jan 97).

Fri Jan 31 12:49:02 1997  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* sanity.sh: Add modules3 and big to list of tests to run
	by default; they were omitted by accident.

Thu Jan 30 11:46:33 1997  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* logmsg.c, main.c, mkmodules.c, modules.c, parseinfo.c, patch.c:
	Nuke more PATH_MAX.

	* server.c (server_updated): After we send Created or
	Update-existing for a file, mark it as unchanged, in case we
	process it again.
	* sanity.sh (modules3): New tests, test for above fix.

	* logmsg.c (do_verify): Error return from fopen is NULL, not -1.
	Pass errno to error().

	* login.c [_CRAY]: Don't declare getpass.

Mon Jan 27 17:25:27 1997  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* import.c (process_import_file): Fix freeing of rcs (Don't free
	it before we are done using it, and don't free it twice).

	* modules.c (cat_module): Allocate line right before we use
	it.  The previous code was wrong because the length of the
	s_h->rest changes between the time we allocate line and the time we
	sprintf s_h->rest into it.

Sun Jan 26 21:58:16 1997  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* expand_path.c (expand_path): Revise to call expand_string as
	needed.  Nuke PATH_MAX.
	* find_names.c (find_dirs): Likewise.
	* import.c, lock.c: Nuke more PATH_MAX.

	* server.c (mkdir_p): Set retval to 0 at start of function.
	Previously it had been uninitialized for some cases.  Thanks are
	due to nightly testing for catching this one.

Sat Jan 25 21:34:19 1997  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* subr.c, cvs.h (expand_string): New function.
	* rcs.c (getrcskey, getrcsrev): Call it.  This greatly reduces the
	number of calls to realloc if there is a very large file in the
	RCS file.  Credit goes to Mike Heath <mike@@pswtech.com> for
	pointing out the problem and the basic solution (MIN_INCR,
	MAX_INCR); I adapted it into the separate function expand_string.
	* sanity.sh (big): New test helps insure this hasn't broken
	anything obvious.

Wed Jan 22 10:06:13 1997  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* status.c (status_fileproc): Change message which is printed for
	T_MODIFIED and ts_conflict set, so that it doesn't say "unresolved
	confict".  This message occurs whether the conflict is resolved or
	not.
	* sanity.sh (conflicts): Add tests conflicts-status-* to test
	output of "cvs status" in the context of conflicts.  Tests for
	above fix.

	* rtag.c (rtag): Send -n if run_module_prog is NOT true.

a1 2

	* version.c: Change version number to 1.9.3.
@


1.1.1.8
log
@Latest release from Cyclic Software
@
text
@a0 45
Tue Mar 25 13:26:52 1997  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* version.c: Version 1.9.6.

Mon Mar 24 13:02:04 1997  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* entries.c (ParseTag): Add comment about unrecognized characters
	in CVS/Tag file.

	* classify.c (Classify_File): Add comment about how specifying a
	tag (bogusly?) suppresses certain messages.

Fri Mar 21 13:37:46 1997  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* rcs.h (struct rcsnode): Add comment about case of PATH.
	* rcs.c (RCS_parse): If ign_case, then try opening the file with
	fopen_case.
	* ignore.c (ign_case): Adjust comment.
	* cvs.h, filesubr.c (cvs_casecmp, fopen_case): New functions.

20 Mar 1997  Jim Kingdon

	* client.c (send_repository): When sending Directory request,
	send any ISDIRSEP character as '/'.  Fixes
	"cvs log foo\bar\baz.c" on NT & friends.

	* client.c (send_file_names): Don't try to read Entries file if
	CVSADM directory does not exist.  Fixes fairly serious regression
	(warning on all fresh checkouts) introduced by 1997-01-08 change.

Tue Mar 18 13:03:33 1997  Jim Meyering  <meyering@@totoro.cyclic.com>

	* sanity.sh (RCSINIT): Define to be empty and export, to hide any
	existing value that might cause spurious failures.

	* Makefile.in: (install): Depend on installdirs.
	Remove `CYGNUS LOCAL' comment saying not to.

Tue Mar 18 09:36:26 1997  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* recurse.c (struct recursion_frame): Reindent.
	(do_dir_proc): Print message if we try to recurse into a CVSADM
	directory.
	* sanity.sh (basicb): New test basicb-4a tests for above fix.

a1 10

	* sanity.sh (death2): Replace regexp matching temporary file name
	with new variable ${tempname}.  For most of the tests this is a
	cosmetic change, but death2-diff-6 had been missing _ which caused
	it to fail on Solaris (at least sometimes).

	* sanity.sh (modes): Don't use export -n; it doesn't seem
	to be sufficiently portable.

	* version.c: Change version number to 1.9.5.
@


1.1.1.9
log
@Latest release from Cyclic Software
@
text
@a0 248
Fri Apr 18 11:24:26 1997  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* version.c: Version 1.9.8.

	* commit.c (struct find_data): Add field force.
	(find_fileproc, commit): Use it instead of force_ci to decide
	whether to send files to server.
	(commit): Set it if either -f or -r is specified.
	* sanity.sh (basica): Add tests basica-8a0, basica-8a1, and
	basica-8a2; tests for above fix.

Wed Apr 16 11:50:59 1997  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* zlib.c: Remove paragraph with Free Software Foundation address.
	See 2 Jan 1997 entry in ../ChangeLog for rationale.

Tue Apr 15 00:36:23 1997  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* update.c (patch_file_write): Always assign to final_nl, so that
	it ends up reflecting whether the data from the last call had a
	newline, not whether the data from any of the calls ended in a
	newline.  Doesn't matter with the current RCS_checkout
	implementation, but it will if RCS_checkout is changed to pass
	less than the entire file.

	* rcs.c (RCS_cmp_file): Change NULL to RUN_TTY in passing sout to
	RCS_checkout, for clarity.

	* import.c (update_rcs_file): Remove unused variable ierrno.

	* add.c, checkout.c, commit.c, diff.c, edit.c, import.c,
	history.c, log.c, main.c, patch.c, release.c, remove.c, rtag.c,
	status.c, tag.c, update.c, watch.c: Pass "+" to all calls to
	getopt.  This ensures that we maintain existing behavior even with
	glibc2.

	* filesubr.c (fopen_case): Don't set *PATHP if we return an
	error.  Since the 9 Apr 1997 change, the behavior has been to
	sometimes set it and sometimes not.
	* rcs.c (RCS_parse): Adjust callers to not free it.  Without this
	change, they could call free() on an uninitialized variable.

	* checkout.c (checkout): Add comment about export -k.

	* root.c (check_root_consistent): Add comment about wording of
	message.

Mon Apr 14 11:51:49 1997  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* client.c (call_in_directory): If rdirp reaches the end of
	reposdirname, then just set it to NULL.  If server does not create
	directories one at a time, give a warning.
	* sanity.sh (modules3): Enable tests modules3-8 through
	modules3-11 for remote; tests for above fix.

	* client.c (call_in_directory): Don't set short_pathname to
	pathname for a while; just use pathname itself (cleans up a relic
	of the old "Repository" (not "Directory") code).  Add comment
	explaining short_pathname.

Sun Apr 13 18:07:50 1997  Ian Lance Taylor  <ian@@cygnus.com>

	* rcs.c (RCS_checkout): Add pfn and callerdat parameters.  Change
	all callers.  Move setting of expand after retrieval of file
	data.
	(struct cmp_file_data): Define.
	(RCS_cmp_file): New function.
	(cmp_file_buffer): New static function.
	* rcs.h (RCSCHECKOUTPROC): Define type.
	(RCS_checkout): Update declaration.
	(RCS_cmp_file): Define.
	* diff.c (diff_file_nodiff): Call RCS_cmp_file rather than
	RCS_checkout and xcmp.
	* import.c (update_rcs_file): Likewise.
	* no_diff.c (No_Difference): Likewise.
	* update.c (struct patch_file_data): Define.
	(patch_file): Just return if noexec, or if binary file.  Pass
	patch_file_write to RCS_checkout.  Don't check for newlines or
	compute checksums here.  Stat RCS file to set modes.
	(patch_file_write): New static function.

	* update.c (patch_file): Checkout directly to file2, rather than
	to finfo->file followed by rename.  Remove check for whether
	result of checkout is readable; that was for an old, obsolete,
	form of death support.

Sun Apr 13 13:16:40 1997  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* checkout.c (build_one_dir): New function.
	(struct dir_to_build): New structure.
	(build_dirs_and_chir): Rewritten to accept a linked list of struct
	dir_to_build rather than the silly string processing we had been
	doing before.
	(checkout_proc): Rewrite code that calls build_dirs_and_chdir
	accordingly.
	* sanity.sh: Enable tests modules3-10 and modules3-11 for local CVS;
	tests for above fix.

	* rcs.h (RCS_CO): Removed; no longer used.

Sun Apr 13 00:04:34 1997  Ian Lance Taylor  <ian@@cygnus.com>

	Expand RCS keywords internally; never call co:
	* rcs.h (struct rcsversnode): Add state field.
	* rcs.c (kflags): Move out of RCS_check_kflag, and make file
	static.
	(enum kflag): Define.
	(RCS_reparsercsfile): Always save lock information.  Save state in
	new state field, rather than other field.
	(struct rcs_keyword): Define.
	(keywords): New static variable.
	(enum keyword): Define.
	(printable_date, escape_keyword_value): New static functions.
	(expand_keywords): New static function.
	(RCS_checkout): Call expand_keywords.  Don't call
	RCS_exec_checkout.
	(RCS_deltas): Add log and loglen parameters.  Change all callers.
	* log.c (log_version_requested): Use new state field.
	(log_version): Likewise.
	* cvs.h (RCS_exec_checkout): Don't declare.
	* rcscmds.c (RCS_exec_checkout): Remove.

Sat Apr 12 17:32:59 1997  Ian Lance Taylor  <ian@@cygnus.com>

	* sanity.sh (modules3): Remove second-dir at end of tests.
	(sticky): Correct removal of directories at end of tests.

	* sanity.sh (keyword): New tests for RCS keyword expansion.

Sat Apr 12 16:47:13 1997  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* sanity.sh (basicb): New tests basicb-1b, basicb-1c, basicb-9b,
	basic-9c test current build_dirs_and_chdir behavior.

Fri Apr 11 23:54:56 1997  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* sanity.sh (modules3): New tests modules3-7* test for ability to
	supply a path in -d in modules.  Similar to modules3-8 through
	modules3-11 except because the nesting is different, these ones
	work.

Thu Apr 10 00:14:47 1997  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* sanity.sh (modules3): New tests modules3-12 through modules3-15
	test use of a module name which contains a slash.

	* sanity.sh (basicb): New tests basicb-14 to basicb-20 test use of
	co -d with two or more arguments.

	* rcscmds.c: Refer to doc/RCSFILES in comment.

Wed Apr  9 09:49:17 1997  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* sanity.sh (basicb): New tests basicb-11 through basicb-13 test
	ability to specify several directory levels in co -d (commented
	out).

	* filesubr.c (fopen_case): If CVS_OPENDIR gives an
	existence_error, return it to the caller instead of giving a fatal
	error.

	* client.c (update_entries): Fix typo in call to error (1 -> errno).

Tue Apr  8 23:02:22 1997  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* error.h, error.c: Test for #ifdef __STDC__, not #if __STDC__.
	This is consistent with other parts of CVS; it means that the
	declaration for fperror will match the definition even if __STDC__
	is defined to 0 as the SunPro 4.0 compiler does.  Reported by
	Richard Smith <rjsmith@@cisco.com>.

2 Apr 1997  Jim Kingdon

	* entries.c (ParseTag): Add "break;" after "default:" to avoid
	error from Visual C++.

Wed Apr  2 12:06:44 1997  Vince Del Vecchio  <vdelvecc@@spd.analog.com>
			  and Jim Kingdon

	* client.c: In reporting errors from socket calls, use
 	SOCK_STRERROR and SOCK_ERRNO since strerror(errno) doesn't work
 	for Win32.

Tue Apr  8 10:45:32 1997  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* sanity.sh (modules3): Add tests modules3-8 to modules3-11, to
	test for ability to supply a path to -d in modules.  Mostly
	commented out as CVS is buggy in this area.

Mon Apr  7 12:41:44 1997  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* add.c (add): Add comment about SEND_NO_CONTENTS.

Sun Apr  6 21:46:32 1997  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* update.c (update): Add comment about noexec and SEND_NO_CONTENTS.

Sun Apr  6 17:34:08 1997  Robert Bihlmeyer  <robbe@@orcus.priv.at>

	* Pass +f not f to getopt_long to prevent options from being
	permuted with glibc 2.0.1.

Sun Mar 30 00:07:05 1997  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* cvs.h (struct vers_ts): Adjust comment regarding ts_user.
	* server.c (serve_is_modified): New function.  Set entries to show
	that the file is modified but we don't know the contents.
	* server.c (requests): Add "Is-modified" request.
	* vers_ts.c (time_stamp_server): If the timestamp in entdata is
	"M" or "D", just copy that over into ts_user.
	* vers_ts.c (Version_TS): If timestamp is "D", use the entries
	line for the sole purpose of passing it to time_stamp_server.
	* no_diff.c (No_Difference): If ts_user is "M", conclude the files
	are different.
	* client.h, client.c (send_files): Replace arguments build_dirs
	and force with argument flags.  Add flag SEND_NO_CONTENTS and add
	to struct send_data.
	(send_fileproc): If no_contents, then send Is-modified instead of
	Modified.
	* add.c, admin.c, client.c, commit.c, diff.c, edit.c, log.c,
	rcs.c, remove.c, status.c, tag.c, update.c, watch.c: Change all
	send_files callers.

Fri Mar 28 22:32:25 1997  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* server.c (requests): Change "Repository" to rq_optional.  I'm
	not sure whether I overlooked this when I removed support for
	Repository, or whether I was thinking that servers would need to
	support it anyway, for CVS 1.5 to 1.9 clients, but making it
	optional doesn't prevent the server from supporting it and it
	seems silly for the client to complain about absence of a request
	that it never will use.

Fri Mar 28 10:06:59 1997  Steven Miller  <Miller@@wingra.com>

	* entries.c (Subdirs_Known): Don't create Entries.Log if noexec.

Thu Mar 27 18:14:12 1997  Ian Lance Taylor  <ian@@cygnus.com>

	* sanity.sh (death2): Remove commented out test death2-21.  It
	would now pass, but it duplicates the new test sticky-11.

Thu Mar 27 10:21:19 1997  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* sanity.sh (dotest_internal): Write test output to logfile even
	if test succeeds.  This was the behavior prior to 30 Sep 1996.
	See the comment for rationale.

a1 23

	* cvs.h, entries.c (WriteTag): Add arguments nonbranch,
	update_dir, and repository.  Move the server_set_sticky call from
	callers to here.
	* cvs.h, create_adm.c (Create_Admin): New argument nonbranch.
	* cvs.h, entries.c (ParseTag): Add argument nonbranchp.
	* cvs.h (struct stickydirtag): Add field nonbranch.
	* entries.c (Entries_Open): Set it.
	* cvs.h (Vers_TS): Add field nonbranch.
	* vers_ts.c (Version_TS): Copy it from struct stickydirtag.
	* server.c, server.h (server_set_sticky): Add argument nonbranch.
	* add.c, client.c, checkout.c, modules.c, update.c, create_adm.c,
	commit.c: Update callers.
	* add.c (add): If nonbranch, don't add the file on that "branch".
	* commit.c (write_dirnonbranch): New variable.
	(commit_fileproc, commit): Set it.
	(commit_dirleaveproc): Pass it to WriteTag.
	* update.c (rewrite_tag, nonbranch): New variables.
	(update, update_dirent_proc, update_fileproc): Set them.
	(update_filesdoneproc): If rewrite_tag, call WriteTag.
	* sanity.sh (sticky): New tests, test for above fix.

	* version.c: Change version number to 1.9.7.
@


1.1.1.10
log
@Latest version from Cyclic Software
@
text
@a0 421
Tue Jun 17 22:48:00 1997  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* main.c (main): Add --allow-root=ROOT argument; call
	root_allow_add for each time it is specified.  Call
	root_allow_free before exiting.
	* root.c, cvs.h (root_allow_add, root_allow_free, root_allow_ok):
	New function.
	* server.c (pserver_authenticate_connection): If root_allow_ok
	doesn't like the CVSROOT directory, don't allow access.

Tue Jun 17 14:30:14 1997  Jim Kingdon  (unknown@@beezley)

	* client.c: Add "copyright" notice.  If NO_EXT_METHOD, omit
	start_rsh_method.
	* client.c (update_entries): Cast argument to MD5Update from
	char * to unsigned char *.

Mon Jun 16 16:46:28 1997  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* run.c (piped_child, filter_stream_through_program):
	If USE_SETMODE_BINARY, then put the pipes into binary mode.
	* find_names.c, ignore.c, lock.c, wrapper.c: Change fnmatch to
	CVS_FNMATCH.
	* client.c (start_server): If NO_EXT_METHOD, then give a fatal
	error on any use of :ext:.

Sun Jun 15 22:30:27 1997  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* sanity.sh (toplevel): Match U CVSROOT/* lines with DOTSTAR in
	test toplevel-9.

Thu Jun 12 10:27:51 1997  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* sanity.sh (toplevel): Remove Emptydir before starting.

	* sanity.sh: Change "rm -rf" to "rm -r" when deleting working
	directories (except a few watches cases).  Helps detect cases
	where the testsuite has cd'd to somewhere other than where we
	think it has.
	(basic2): Remove "rm -r first-dir" between tests 49 and 50.  The
	directory was already deleted in test 45.5.
	(rcs): Add "cd .." at end of tests.
	(stamps): No longer cd to TESTDIR; shouldn't be necessary with
	fix to "rcs" test.

Wed Jun 11 22:28:38 1997  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* sanity.sh (basicb): Also remove CVSROOT/Emptydir at end of
	test.  Otherwise it affects the toplevel-9 test for remote.

Tue Jun 10 14:03:32 1997  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* sanity.sh (toplevel): Change "update" and "checkout" to "[a-z]*"
	as these read "server" instead for "make remotecheck".  Change
	expect strings for toplevel-9 to accept the behavior of remote CVS
	(see comments for more discussion).

	* sanity.sh: New tests stamps-9 through stamps-11 test timestamp
	behavior on cvs update.

Mon Jun  9 22:42:50 1997  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* sanity.sh: Remove "#! /bin/zsh" line at end.  I assume it was
	added accidentally.

Tue Jun 10 03:08:46 1997  Norbert Kiesel  <nk@@psycho.de>

	* sanity.sh: new tests "toplevel" for the new toplevel CVS
	directory creation (including one test which shows an error in
	this area).

Sun Jun  8 20:52:00 1997  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* rcs.c (getrcsrev): Before printing error, check whether it was
	feof or ferror.

	* rcs.h, import.c (add_rcs_file): No longer static.  New arguments
	add_vbranch, add_vhead, and add_logfp replace access to static
	variables vbranch, vhead, and logfp.
	* mkmodules.c: Call it instead of RCS_CI.
	* import.c (process_import_file): Adjust call to add_rcs_file.

Tue Jun  3 10:18:33 1997  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* sanity.sh (basicb): Match "." with "\." not ".".

Tue Jun  3 13:02:37 1997  Norbert Kiesel  <nk@@cosa.de>

	* checkout.c (checkout): Removed restriction of not sending -k in
 	remote export (I think this was introduced while the -k handling
 	was still broken in remote mode).  Give better error texts
 	regarding -c and -s options.  Use error() instead of usage() for
 	reporting errors in all places.  Reindented some lines.  Free
 	xmalloc'd space of options.

Thu May 29 16:32:47 1997  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* rcscmds.c (RCS_checkin), mkmodules.c (init): Pass -w option to
	"ci", specifying getcaller ().
	* server.h, server.c (CVS_Username): Now extern.
	* subr.c (getcaller): Return CVS_Username if it is set.

Wed May 28 22:31:38 1997  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* update.c (update_fileproc): If wrap_merge_is_copy and we would
	like to do a merge, give a fatal error.  See comment for why.
	* sanity.sh (mwrap): New tests, tests for above fix.

Tue May 27 21:59:32 1997  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* sanity.sh (stamps): cd to ${TESTDIR} before starting.

Mon May 26 15:31:30 1997  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* client.c (handle_mod_time): New function.
	(responses): Add "Mod-time".
	(stored_modtime_valid, stored_modtime): New variables.
	(update_entries): If it is set, change the file's modtime.
	* server.c, server.h (server_modtime): New function.
	* vers_ts.c (Version_TS): Call it.
	* patch.c (patch_fileproc): Add comment about why we don't.
	* sanity.sh (stamps): Added, tests for above fix.

Fri May 16 13:14:30 1997  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* subr.c (free_names): Update documentation to reflect fact that
	free_names is now called to free vectors allocated by expand_wild
	as well	as by line2argv.

	* main.c (main): Use "xstrdup (foo)" not "xstrdup(foo)" as
	specified in HACKING.

Fri May 16 15:10:37 1997  Norbert Kiesel  <nk@@cosa.de>

	* modules.c (do_module): initialize optind to 0.  use local copies
 	of optarg's (because they might me freed within free_names).

Thu May 15 11:50:15 1997  Norbert Kiesel  <nk@@cosa.de>

	* main.c (main): initialize optind to 0.  use local copies of
	optarg's (because they might me freed within read_cvsrc).

	* cvsrc.c (read_cvsrc): free old argv after constructing a new
	one.  This fixes a memory leak.

	* recurse.c (start_recursion): use free_names() instead of
	reimplementing it

	* rcs.c (RCS_deltas): free branchversion (memory leak).

	* parseinfo.c (Parse_Info): free some vars (3 memory leaks).

	* logmsg.c (logfile_write): free str_list_format (memory leak).

	* watch.c (watch_addremove), (watchers), update.c (update), tag.c
 	(cvstag), status.c (status), rtag.c (rtag), remove.c (cvsremove),
 	release.c (release), patch.c (patch), log.c (cvslog), import.c
 	(import), history.c (history), edit.c (watch_onoff), (edit),
 	(unedit), (editors), diff.c (diff), commit.c (commit), checkout.c
 	(checkout), add.c (add): initialize optind to 0

	* diff.c (diff_fileproc): cosmetic change (whitespace added).

	* checkout.c (checkout): move local variable definition into the
	block where the variable is used.

	* client.c (update_entries): initialize some local variables to shut up
	gcc -O -Wall.

	* buffer.c (buf_read_line): initialize a local variable to shut up
	gcc -O -Wall.
		   

Wed May 14 16:29:50 1997  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* admin.c (admin): When sending options to server, don't try to
	send av[ac].  It may contain one of the names that we'll send in
	send_file_names (which caused tests like keyword-6 to work,
	sort of accidentally), or it may contain NULL (which would tend to
	cause a coredump).
	* sanity.sh (basicb): New test basicb-21 tests for above fix.

Mon May 12 16:22:00 1997  Larry Jones  <larry.jones@@sdrc.com>

	* add.c (add): Free message and repository in client code.
	* checkout.c (checkout): Don't free repository unless allocated.
	* client.c (start_rsh_server): Free command.

Sun May 11 11:43:54 1997  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* client.c: Remove all references to USE_DIRECT_TCP; see
	../ChangeLog for rationale.

Fri May  9 22:19:36 1997  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* main.c (main): Add comment explaining why we call exit.  Pass 0
	not EXIT_SUCCESS, because lib/system.h has portability cruft for
	EXIT_FAILURE but not EXIT_SUCCESS.

Fri May  9 17:25:00 1997  Larry Jones  <larry.jones@@sdrc.com>

	Fix miscellaneous memory allocation problems:
	* add.c (add): Free repository.
	* client.c (notified_a_file): Free getline buffer.
	* edit.c (notify_check): Free getline buffer.
	* hash.c (dellist): Free header node when not caching.
	* login.c (login): Don't continually free & allocate getline
	buffer, use xstrdup instead of xmalloc/strcpy, free getline
	buffer before returning.
	* main.c (main): Call exit instead of returning so tools like
	Purify won't consider permanently allocated memory as leaks.
	* mkmodules.c (mkmodules): Free getline buffer.
	* modules.c (cat_module): Call close_module.
	* rcs.c (rcsvers_delproc): Free state.
	* recurse.c (start_recursion): Free files_by_dir.
	(unroll_files_proc): NULL out p->data after using it to set
	filelist to avoid multiple frees.
	* server.c (check_command_legal_p): Don't continually free &
	allocate getline buffer, free getline buffer before returning.
	(check_repository_password): Ditto, use xstrdup instead of
	xmalloc/strcpy.
	* wrapper.c (wrap_add_file): Free getline buffer.

Thu May  8 14:21:00 1997  Larry Jones  <larry.jones@@sdrc.com>
	and Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* checkout.c (checkout_proc): Free finfo.rcs (memory leak).

8 May 1997  Larry Jones  <larry.jones@@sdrc.com>
	and Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* hash.c: Add #ifdef's to disable caching.  This makes it easier
	to track down memory allocation problems.

Thu May  8 11:40:39 1997  Larry Jones  <larry.jones@@sdrc.com>

	* sanity.sh: In setting "tests" use a number of statements rather
	than one very long line.

Thu May  8 11:40:39 1997  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* cvsbug.sh: Remove $Id; we decided to get rid of these some time
	ago.

Thu May  8 11:34:02 1997  Larry Jones  <larry.jones@@sdrc.com>

	* cvsbug.sh: Put separate statements on separate lines, so it
	works if awk is AT&T nawk.

Tue May  6 16:56:00 1997  Larry Jones  <larry.jones@@sdrc.com>
	and Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* cvsrc.c (read_cvsrc): Fix various memory allocation problems:
	rearrange code to avoid leaks, use xrealloc instead of xmalloc/
	copy/free, make sure there's room for the remaining args before
	appending them.

Tue May  6 14:20:00 1997  Larry Jones  <larry.jones@@sdrc.com>

	* edit.c (watch_onoff, edit, unedit, editors): Add -R like
	other things with -l.
	* watch.c (watch_addremove, watchers): Ditto.

Mon May  5 18:10:37 1997  larry.jones@@sdrc.com
	and Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* sanity.sh: Change all /tmp/cvs-sanity to TESTDIR.  If TESTDIR
	environment variable is set, use it instead of /tmp/cvs-sanity.
	* sanity.sh: Make TMPPWD the pwd equivalent of TESTDIR, not of /tmp.

4 May 1997  Larry jones  <larry.jones@@sdrc.com>
	    and Jim Kingdon

	* checkout.c, diff.c, patch.c, rcs.c: Update usage messages.
	* rcs.c (annotate): Add -R like other things with -l.

Sat May  3 14:57:40 1997  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* sanity.sh (basic1): Rewrite test (use dotest, unroll the loops
	which IMHO makes the test a zillion times more understandable, and
	only do the variant which tests for 4 files at a time--we test one
	file at a time lots of places).

2 May 1997  Ziv Gigus <ziv@@rest.home.net>
	    and Jim Kingdon

	* client.c, client.h (client_process_import_file): New argument
	all_files_binary means treat all files as binary.
	* import.c (import_descend): Pass it if -kb is specified.
	* client.c (client_process_import_file): In the
	non-all_files_binary case, call wrap_rcsoption to determine
	whether the file is binary.

Thu May  1 13:44:51 1997  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* sanity.sh (binfiles2): New tests, for update -j and binary files.

Wed Apr 30 11:18:36 1997  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* recurse.c (start_recursion): Also free reposfile.
	Don't look in repository if client_active (latter bug reported by Paul
	Sanders <p.sanders@@dial.pipex.com>).

Mon Apr 28 22:36:39 1997  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* diff.c (diff_file_nodiff): Remove SERVER_SUPPORT ifdefs.  They
	were not based on server_active, which doesn't really make any
	sense (it meant that compiling --disable-server could affect the
	behavior of the non-client/server CVS).  This affected the output
	in tests death2-diff-11 and death2-diff-12 in the testsuite.
	* sanity.sh (newb-123j0): Also accept "Needs Checkout", for a
	--disable-server CVS.

	* main.c (cmd_usage): Change "run diffs" to "show differences";
	the former is jargon.
	* edit.c (edit_usage): Fix typo ("." -> ",").
	* edit.c (editors_usage), watch.c (watchers_usage): Mention -l.
	* checkout.c (export_usage): Say what -P does.
	* history.c (history_usg): Add comment about message wording.

Mon Apr 28 14:47:45 1997  Norbert Kiesel  <nk@@cosa.de>

	* checkin.c (Checkin): use filename without path when calling
 	wrapper (bug found by Michal Schmitz <ms@@cosa.de>).

Fri Apr 25 13:28:55 1997  Ian Lance Taylor  <ian@@cygnus.com>

	* client.c (update_entries): In UPDATE_ENTRIES_RCS_DIFF case,
	write to a temporary file and then rename it.

Thu Apr 24 11:35:40 1997  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* subr.c, cvs.h (pathname_levels): New function, from a piece of
	send_file_names.
	* client.c (send_file_names): Call pathname_levels in place of the
	code which was moved there.
	* server.c, server.h (server_pathname_check): New function.
	* recurse.c (start_recursion): Call it.
	* sanity.sh (modules3): New test modules3-11b tests for above fix.

	* filesubr.c: Do not define L_tmpnam.  It is in ANSI and SunOS4,
	so I don't think there will be a problem with it being missing.
	Defining it too small can cause memory corruption.
	(cvs_temp_name): Do not use L_tmpnam in the mktemp code; this
	could cause a buffer overflow if the -T global option was in use.

Thu Apr 24 13:21:15 1997  Norbert Kiesel  <nk@@cosa.de>

	* filesubr.c (cvs_temp_name): Use tempnam if available, else
 	mktemp, else tmpnam. See the comment for rationale.

	* sanity.sh: use "tar cf - ." instead of "tar cf - *" for
 	directory copies.

Wed Apr 23 23:41:47 1997  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* server.c (serve_update_prog): If in readonly mode, give an error.

Wed Apr 23 19:07:41 1997  Norbert Kiesel  <nk@@cosa.de>

	* subr.c (line2argv): Allocate at least 4 slots for argv.

	* checkout.c (checkout_proc): Add a comment which says why the
 	above change was necessary to avoid writing to unallocated memory.

Wed Apr 23 11:20:40 1997  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* entries.c (ParseTag): Always set *NONBRANCHP.

21 Apr 1997  Jim Kingdon

	* client.c (update_entries), rcs.c (expand_keywords): Rewrite
	test to avoid signed/unsigned warning.

Mon Apr 21 09:02:22 1997  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* update.c (patch_file): Add comment about whether auto-detecting
	features of the DIFF program is a good idea.

Mon Apr 21 00:03:34 1997  Ian Lance Taylor  <ian@@cygnus.com>

	Don't require the patch program:
	* client.c (struct update_entries_data): Add
	UPDATE_ENTRIES_RCS_DIFF to contents enum.
	(update_entries): Handle UPDATE_ENTRIES_RCS_DIFF.
	(handle_rcs_diff): New static function.
	(responses): Add "Rcs-diff".
	* server.c (server_updated): Handle SERVER_RCS_DIFF.
	(server_use_rcs_diff): New function.
	* server.h (enum server_updated_arg4): Add SERVER_RCS_DIFF.
	(server_use_rcs_diff): Declare.
	* update.c (rcs_diff_patches): New static variable.
	(update): Set rcs_diff_patches.
	(update_fileproc): If rcs_diff_patches, pass SERVER_RCS_DIFF
	rather than SERVER_PATCHED to server_updated.
	(patch_file): Correct initial comment to say diff rather than
	rcsdiff.  If rcs_diff_options, pass -n to diff rather than -c.
	* rcs.c (rcs_change_text): New function.
	* rcs.h (rcs_change_text): Declare.

Mon Apr 21 00:08:59 1997  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* diff.c (diff_fileproc): Add comment concerning updating the
	client timestamp.

Sun Apr 20 23:20:37 1997  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* commit.c (commit): Add comment regarding SEND_FORCE rationale.

Sat Apr 19 17:10:36 1997  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* server.c (dirswitch): If directory ends in '/', complain.

Fri Apr 18 18:09:57 1997  Ian Lance Taylor  <ian@@cygnus.com>

	* rcs.c (apply_rcs_changes): New static function, broken out of
	RCS_deltas.
	(RCS_deltas): Call it.
	(linevector_add): Change return type to int.  Return an indication
	of an error for an invalid add, rather than calling error.

a1 2

	* version.c: Change version number to 1.9.9.
@


1.1.1.11
log
@Latest version from Cyclic
@
text
@d1 1
a1 1
Thu Jan 29 00:01:05 1998  Jim Kingdon  <kingdon@@harvey.cyclic.com>
d3 7
a9 1
	* Version 1.9.24.
d11 899
a909 36
	* sanity.sh (multibranch2): File file2 and tests multibranch2-13
	through multibranch2-15 test a slightly different case than the
	rest of multibranch2.

	* mkmodules.c (cvswrappers_contents): Rewrite.  The text didn't
	describe -k and had various other problems.

28 Jan 1998  Karl Fogel and Jim Kingdon

	New feature to let server tell client about wrappers.
	* client.h (struct response): Add comment about args being
	'\0' terminated when passed to handle_* functions.
	* client.c (start_server): send "wrapper-sendme-rcsOptions" to
	server iff supported.
	(responses): new response "Wrapper-rcsOption"; allows the server
	to send certain lines from its cvswrappers file.
	(handle_wrapper_rcs_option): new func, handles "Wrapper-rcsOption"
	response from server.
	* server.c (serve_wrapper_sendme_rcs_options): new func, sends
	server side CVSROOT/cvswrappers rcs option lines to client.
	(requests): new request "wrapper-sendme-rcsOptions"; if received,
	we know we can send "Wrapper-rcsOption..." to the client.
	* wrapper.c (wrap_unparse_rcs_options): new func; repeated calls
	step down the wrapper list returning rcs option entries, but
	repackaged as cvswrappers lines.
	(wrap_setup): new guard variable `wrap_setup_already_done'; if
	this function has run already, just return having done nothing.
	Add comment concerning environment variable.
	* cvs.h: declare wrap_unparse_rcs_options().

Tue Jan 27 18:27:19 1998  Ian Lance Taylor  <ian@@cygnus.com>

	* rtag.c (rtag_dirproc): Call ignore_directory, and skip the
	directory if it returns true.
	* sanity.sh (modules4): New set of tests to test some aspects of
	excluding directories in the modules file, including the above
d912 216
a1127 1
Thu Jan 22 10:05:55 1998  Jim Kingdon  <kingdon@@harvey.cyclic.com>
d1129 2
a1130 3
	* server.c (serve_kopt): Check for length of arg.  Based on
	inspection of the code, plugs a buffer overrun security hole which
	was introduced Monday.
d1132 1
a1132 3
	* server.c (serve_is_modified): Don't call xmalloc; we aren't
	allowed to call error() here.  Remove duplicate (and potentially
	confusing) variable 'p'.
d1134 2
a1135 4
	* log.c (log_fileproc): Look for first character of version
	'0' AND second character '\0', rather than OR.  I didn't try to
	come up with a test case but this looks like a simple thinko
	(albeit one which would show up in obscure cases if at all).
d1137 4
a1140 1
Tue Jan 20 19:37:53 1998  Jim Kingdon  <kingdon@@harvey.cyclic.com>
d1142 2
a1143 4
	* client.c (send_dirent_proc): Don't send nonexistent directories
	unless noexec.
	* sanity.sh (modules2): New tests modules2-13 through modules2-18
	test for this fix.
d1145 1
a1145 1
Mon Jan 19 11:17:51 1998  Jim Kingdon  <kingdon@@harvey.cyclic.com>
d1147 1
a1147 14
	* server.c (serve_kopt): New function.
	(requests): Add "Kopt" request.
	(kopt): New variable.
	(serve_is_modified): Write kopts from there into entries.
	(serve_modified): Call serve_is_modified so we do the same.
	Declare serve_modified and serve_is_modified.
	* vers_ts.c (Version_TS): Set ->options even for a dummy ("D"
	timestamp) entry.
	* import.c (process_import_file): Check for -k options.
	* client.c (client_process_import_file): Send Kopt request.
	(send_fileproc): Likewise, for "cvs add".
	* sanity.sh: Enable test binwrap3-sub2-add1 for remote.
	Add -I .cvswrappers to binwrap3-2a; adjust binwrap3-2d
	accordingly.  Tests for this fix.
d1149 2
a1150 1
Mon Jan 19 08:48:59 1998  Larry Jones  <larry.jones@@sdrc.com>
d1152 4
a1155 1
	* sanity.sh (errmsg1): Append test 168 output to log file.
d1157 1
a1157 1
Sat Jan 17 08:01:51 1998  Jim Kingdon  <kingdon@@harvey.cyclic.com>
d1159 4
a1162 2
	* sanity.sh (ann-10, ann-11): Don't make assumptions about the
	number of characters in the username.
d1164 3
a1166 1
Fri Jan 16 15:34:02 1998  Larry Jones  <larry.jones@@sdrc.com>
d1168 1
a1168 1
	* diff.c (diff_fileproc): Free label1 and label2 when finished.
d1170 8
a1177 2
	* edit.c (editor_set): Don't free edlist until after we're
	done using it.
d1179 1
a1179 1
	* rcscmds.c (RCS_merge): Free xrev1 and xrev2 when finished.
d1181 7
a1187 3
	* subr.c (make_message_rcslegal): Don't access uninitialized or
	unallocated memory; only strip trailing blank lines.
	* sanity.sh (log-3): Enhance to test this fix.
d1189 1
a1189 1
Fri Jan 16 12:41:03 1998  Jim Kingdon  <kingdon@@harvey.cyclic.com>
d1191 1
a1191 1
	* sanity.sh: Add keywordlog to list of tests run by default.
d1193 1
a1193 6
	* rcs.c (RCS_deltas): Don't call cvs_output if length is zero;
	passing zero length to cvs_output does not mean output zero
	bytes.  The 27 Dec 1997 change to no longer '\0'-terminate the
	->text field turned this from a time bomb to a user-visible bug.
	* sanity.sh (ann): New tests, test for this fix and other annotate
	behaviors.
d1195 1
a1195 1
Thu Jan 15 23:52:00 1998  Jim Kingdon  <kingdon@@harvey.cyclic.com>
d1197 1
a1197 3
	* root.c (root_allow_ok): If inetd.conf didn't specify an
	--allow-root options at all, we know we are in trouble.  Give a
	specific error message.
d1199 16
a1214 1
Thu Jan 15 21:24:59 1998  Ian Lance Taylor  <ian@@cygnus.com>
d1216 1
a1216 5
	* sanity.sh (dotest_sort): New variant of dotest which sorts the
	output, for use when the output depends upon details of the file
	system, typically when doing an import.
	(rdiff): Use dotest_sort for rdiff-1.
	(ignore): Use dotest_sort for 188a, 188b, 189d, 190, and 191.
d1218 5
a1222 2
	* sanity.sh: (TESTSHELL): New variable.
	(editor, info, reserved): Use TESTSHELL in temporary script.
d1224 3
a1226 3
	* sanity.sh (ignore): Do all tests in subdirectory, to avoid
	conflict between cvsroot and CVSROOT on Windows.
	(binwrap3, mwrap, info, config): Likewise.
d1228 1
a1228 2
	* sanity.sh (binfiles2): Correct test name binfile2-7-brmod to
	binfiles2-7-brmod.
d1230 2
a1231 3
	* release.c (release_delete): If __CYGWIN32__ is defined, don't
 	worry about mismatched inodes.  This is a hack, but then I think
 	the test is rather peculiar anyhow.
d1233 2
a1234 1
Thu Jan 15 16:07:36 1998  Larry Jones  <larry.jones@@sdrc.com>
d1236 1
a1236 1
	* sanity.sh (reserved-9): Use ${PROG} instead of "cvs".
d1238 7
a1244 1
Wed Jan 14 15:43:13 1998  Jim Kingdon  <kingdon@@harvey.cyclic.com>
d1246 3
a1248 2
	* Split ChangeLog into ChangeLog-97 and ChangeLog.
	* Makefile.in (DISTFILES): Add ChangeLog-97.
d1250 1
a1250 1
13 Jan 1998  Jim Kingdon
d1252 2
a1253 1
	* client.c: Declare handle_mt.
d1255 2
a1256 1
Tue Jan 13 22:21:30 1998  Jim Kingdon  <kingdon@@harvey.cyclic.com>
d1258 1
a1258 2
	* sanity.sh: Add comment about how pwd and /bin/pwd often differ
	in behavior (but are not guaranteed to).
d1260 1
a1260 1
Tue Jan 13 13:49:53 1998  Ian Lance Taylor  <ian@@cygnus.com>
d1262 1
a1262 1
	* sanity.sh: When setting TMPPWD use just pwd, not /bin/pwd.
d1264 5
a1268 5
	* update.c (checkout_file): Don't pass set_time as true to
	Version_TS if the file is dead.
	* sanity.sh (modules): Add tests modules-155c6 through
 	modules-155c8 to test for above patch (without the above patch,
 	modules-155c8 will fail when remote).
d1270 1
a1270 1
Tue Jan 13 10:37:02 1998  Larry Jones  <larry.jones@@sdrc.com>
d1272 2
a1273 2
	* client.c (send_modified): Change bufsize and newsize from int
	to size_t to avoid type clashes in call to read_and_gzip.
d1275 1
a1275 1
Tue Jan 13 10:33:02 1998  Larry Jones  <larry.jones@@sdrc.com>
d1277 5
a1281 1
	* zlib.c (read_and_gzip): Set finish to 0; it was uninitialized.
d1283 9
a1291 1
Tue Jan 13 10:26:43 1998  Larry Jones  <larry.jones@@sdrc.com>
d1293 3
a1295 1
	* add.c, rcs.c: Plug memory leaks.
d1297 1
a1297 1
Mon Jan 12 10:45:27 1998  Larry Jones  <larry.jones@@sdrc.com>
d1299 2
a1300 4
	* server.c (mkdir_p): Don't try to create nameless directories
	(i.e., given "/foo//bar", don't try to create "/foo/",
	just "/foo" and "/foo//bar") since it isn't necessary and
	it fails on some systems in unexpected ways.
d1302 1
a1302 1
1998-01-11  enami tsugutomo  <enami@@but-b.or.jp>
d1304 3
a1306 1
	* rcs.c (linevector_copy): Delete lines before overwriting them.
d1308 1
a1308 1
Sat Jan 10 11:05:40 1998  Jim Kingdon  <kingdon@@harvey.cyclic.com>
d1310 2
a1311 8
	* cvsrc.c, entries.c, login.c, logmsg.c, myndbm.c, patch.c,
	release.c, server.c: Check for errors from getline, CVS_FOPEN,
	fprintf, CVS_UNLINK and fclose.  Note that the new errors are
	nonfatal.  This is because of conservatism more than because
	it is always the best thing.
	* login.c (get_cvs_password): Close the file when done with it.
	* client.c (notified_a_file): If -1 return from getline, check
	feof rather than assuming errno is set.
d1313 8
a1320 1
Fri Jan  9 14:38:54 1998  Jim Kingdon  <kingdon@@harvey.cyclic.com>
d1322 1
a1322 4
	* server.c (expand_proc): Also output server_dir in
	"Module-expansion", not just in output_dir ("Created", &c).
	* sanity.sh (modules2): New tests modules2-9 through modules2-12
	test for this.
d1324 13
a1336 1
Thu Jan  8 12:56:55 1998  Yasutoshi Hiroe  <hiroe@@rgk.ricoh.co.jp>
d1338 4
a1341 2
	* import.c (import): Don't strcat on uninitialized memory.  Fixes
	possible SIGSEGV with zero-length message.
d1343 6
a1348 1
Tue Jan  6 22:56:29 1998  Jim Kingdon  <kingdon@@harvey.cyclic.com>
d1350 1
a1350 2
	* sanity.sh (crerepos): Fix mistaken variable name which caused us
	not to clean up at the end of the test.
d1352 2
a1353 1
Mon Dec 22 01:40:57 1997  Jim Kingdon  <kingdon@@harvey.cyclic.com>
d1355 3
a1357 3
	* add.c (add): Also look for .cvswrappers files.
	* sanity.sh (binwrap3): New tests binwrap3-2*, binwrap3-sub2-add*
	test for this.
d1359 2
a1360 1
Tue Jan  6 11:50:38 1998  Jim Kingdon  <kingdon@@harvey.cyclic.com>
d1362 1
a1362 2
	* sanity.sh (crerepos): New tests crerepos-8 through crerepos-18
	test behaviors when mixing repositories.
d1364 4
a1367 1
Sun Jan  4 17:40:22 1998  Jim Kingdon  <kingdon@@harvey.cyclic.com>
d1369 1
a1369 1
	* version.c: Change version number to 1.9.23.
d1371 3
a1373 1
	* Version 1.9.22.
d1376 1
a1376 1
For older changes see ChangeLog-97.
@


1.1.1.12
log
@Latest version from Cyclic
@
text
@a0 483
1998-03-04  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* entries.c, cvs.h (Entries_Open): New argument update_dir; use it
	in error message.
	* add.c, checkout.c, client.c, find_names.c, import.c, recurse.c,
	update.c: Pass it (as NULL except in call_in_directory).
	* entries.c (Subdirs_Known): Just return if there is no CVSADM
	directory (as in subdir_record).
	* sanity.sh (conflicts3): New tests conflicts3-20a and
	conflicts3-23 test for these fixes.

	* commit.c (commit): Only set up hardlist if preserve_perms.

	* commit.c, import.c, no_diff.c, parseinfo.c, rcs.c, rcscmds.c,
	update.c: Omit the preserve_perms code if
	PRESERVE_PERMISSIONS_SUPPORT is not defined.  Much of that code
	won't even compile on non-unix systems.

	* hardlink.c, hardlink.h: Use the 'standard' copyright (as found
	in server.c).
	* commit.c, rcs.c: Minor whitespace changes to Tim's submission.
	* commit.c (check_fileproc), update.c (get_linkinfo_proc): Remove
	unused variable delta.
	* hardlink.c (set_hardlink_field_proc), update.c
	(get_linkinfo_proc): Return a value rather than falling off the
	end of the function.

1998-03-02  Tim Pierce  <twp@@skepsis.com>

	* update.c (special_file_mismatch): Compare the hard links of the
	two revisions.

	* rcs.c (RCS_checkout): 

	* hardlink.c, hardlink.h: New files.
	(hardlink_info): New struct.
	(hardlist, working_dir): New variables.
	(list_files_proc, cache_hardlinks_proc, set_hardlink_field_proc,
	lookup_file_by_inode, update_hardlink_info, list_files_linked_to):
	New functions.

	* Makefile.in (SOURCES): Add hardlink.c.
	(OBJECTS): Add hardlink.o.
	(HEADERS): Add hardlink.h.
	* commit.c: Include hardlink.h.
	(commit): Save the working directory before recursing.  Walk the
	hardlink list, calling set_hardlink_field_proc on each node.
	(check_fileproc): Add each file's link information to hardlist.
	* rcs.c: Include hardlink.h.
	(RCS_checkin): Save list of hardlinks in delta node.
	(RCS_checkout): Look up the file's `hardlinks' delta field, and
	see if any of the files linked to it have been checked out
	already.  Link to one of those files if so.
	* update.c: Include hardlink.h.
	(get_linkinfo_proc): New function.
	(do_update): Extra recursion to collect hardlink info.
	(special_file_mismatch): Reparse the RCS file if necessary.

	fsortcmp is now used by several files, so let's make it extern.
	* hash.c, hash.h (fsortcmp): New function.
	* find_names.c (fsortcmp): Removed.
	* lock.c (fsortcmp): Removed.

1998-03-03  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* sanity.sh (conflicts3): New tests conflicts3-14a,
	conflicts3-14b, and conflicts3-21, conflicts3-22 test that we can
	skip over a working directory with a CVSADM directory missing.

1998-02-26  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* sanity.sh (conflicts3): Tests conflicts3-16 and conflicts3-20
	test that we include update_dir in messages.  Rename test
	conflicts3-14 to fix typo.

Sun Feb 22 23:14:25 1998  Steve Cameron  <steve.cameron@@compaq.com>
	and Ian Lance Taylor  <ian@@cygnus.com>

	* update.c (tag_update_dir): New static variable.
	(update_dirent_proc): If no tag or date were specified when
	creating a subdirectory, use the tag and/or date of the parent
	directory.
	(update_dirleave_proc): If we set the tag and/or date in
	update_dirent_proc, reset them when we leave the directory.
	* sanity.sh (branches2): New set of tests for above patch, and
	related behaviour.

Sun Feb 22 13:31:51 1998  Ian Lance Taylor  <ian@@cygnus.com>

	* commit.c (lock_RCS): Don't call RCS_rewrite.

	* update.c (patch_file): If the revision is dead, let
	checkout_file handle it.
	* sanity.sh (death2): Add test for above patch: add
	death2-10a, death2-10b, death2-13a, and adjust
	death2-{2,4,5,11,14,diff-11,diff-12,19}.

	* cvs.h (RCS_FLAGS_KEEPFILE): Define.
	* rcs.c (RCS_checkin): If RCS_FLAGS_KEEPFILE is set in the flags
	parameter, don't unlink the working file.
	* checkin.c (Checkin): Don't copy the file.  Instead pass
 	RCS_FLAGS_KEEPFILE to RCS_checkin, and only check the file out
	again if it has changed.

1998-02-21  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* rcs.c (rcs_internal_unlockfile, RCS_rewrite): Don't assume errno
	means anything just because ferror is set.

Sat Feb 21 20:02:24 1998  Ian Lance Taylor  <ian@@cygnus.com>

	* Makefile.in (clean): Change "/bin/rm" to "rm".

	* buffer.c (buf_append_buffer): Correct typo in comment.
	* rcs.c (RCS_putadmin): Likewise.

Fri Feb 20 17:53:06 1998  Ian Lance Taylor  <ian@@cygnus.com>

	* rcs.c (rcs_internal_unlockfile): Pass errno when calling error
 	because ferror is true.

1998-02-20  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* sanity.sh (abspath): Don't assume that we can't write to /; this
	is the kind of thing that is sure to break sooner or later
	(especially on Windows).

	* sanity.sh: Add summary of which modules tests are which (at
	"modules").  Move cvsadm, abspath, and toplevel next to modules.
	Add comments to clarify the structure (such as it is).

Fri Feb 20 12:47:14 1998  Larry Jones  <larry.jones@@sdrc.com>

	* admin.c (admin_fileproc): Better fix for -b.

	* rcs.c (RCS_whatbranch): Back out previous change.
	(RCS_getversion): Ditto.
	(RCS_setbranch): Treat an empty revision string like a null pointer.

1998-02-18  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* rcs.c (RCS_whatbranch): Fix indentation.

	* patch.c (patch_fileproc): Check for errors from fclose; check
	for errors from fopen properly.

Wed Feb 18 16:03:37 1998  Larry Jones  <larry.jones@@sdrc.com>

	* admin.c (admin_fileproc): Convert -b argument from symbolic name
	to revision number before storing in the RCS file.
	* rcs.c (RCS_whatbranch): Allow numeric as well as symbolic revision.
	(RCS_getversion): Take advantage of above.
	* sanity.sh (admin): Add/revise/renumber admin-10c, admin-11a,
	admin-12, and admin-12a to check above.

	* commmit.c (lock_RCS): Minor clean-up.

	* sanity.sh (abspath-6a): Don't depend on the sepcific contents of
	CVSROOT, it depends on which other tests have been run.

Wed Feb 18 01:56:04 1998  Ian Lance Taylor  <ian@@cygnus.com>

	* rcs.c (putsymbol_proc): Use putc and fputs rather than fprintf.
	(RCS_putadmin): Don't call RCS_symbols if the symbols have not yet
	been converted to a list.

	* rcs.c (rcsbuf_cache, rcsbuf_cache_open, rcsbuf_cache_close): New
	static functions to avoid closing and reopening the RCS file.
	(cached_rcs, cached_rcsbuf): New static variables.
 	(RCS_parse): Call rcsbuf_cache_close.  Don't call fclose.
	(RCS_parsercsfile): Likewise.
	(RCS_parsercsfile_i): Call rcsbuf_cache rather than
	rcsbuf_close.  Call fclose on error.  Remove comment about
	inefficiency of opening file twice.
	(RCS_reparsercsfile): Call rcsbuf_cache_open rather than fopen and
	rcsbuf_open.  Call rcsbuf_cache rather than rcsbuf_close and
	fclose.
	(RCS_fully_parse, RCS_checkout, RCS_deltas): Likewise.
	(RCS_rewrite): Likewise.
	(RCS_checkin): Call rcsbuf_cache_close.

	* rcs.c (RCS_copydeltas): Fix code which checks for an extra
	newline in buffered data.

	* rcs.c (rcsbuf_getkey): Save an indirection by using start rather
	than *valp when trimming trailing whitespace from value.

	* rcs.c (rcsbuf_get_buffered): New static function.
	(RCS_copydeltas): After we have done all the required special
 	actions, and inserted any new revision, just copy the file bytes
 	directly, rather than interpreting all the data.
	(count_delta_actions): New static function.
	* sanity.sh (rcs): Add rcs-6a and rcs-6b to commit a new branch
	revision, to force CVS to interpret all the data, rather than just
	copying it.  Adjust rcs-5 to add a branch tag.  Adjust rcs-8a and
	rcs-14 for the changes created by rcs-6b.

Tue Feb 17 18:34:01 1998  Ian Lance Taylor  <ian@@cygnus.com>

	* sanity.sh (cvsadm, diffmerge2): Remove directories at the end of
	the test.

	* import.c (expand_at_signs): Rewrite to use memchr and fwrite
	rather than putc.

	Rewrite RCS file reading routines for speed:
	* rcs.c (struct rcsbuffer): Define.
	(rcsbuf_open, rcsbuf_close, rcsbuf_getkey, rcsbuf_getrevnum,
	rcsbuf_fill, rcsbuf_valcopy, rcsbuf_valpolish,
	rcsbuf_valpolish_internal, rcsbuf_ftell): New static functions.
	(getrcskey, getrcsrev, getrevnum): Remove.
	(many functions): Change to use new rcsbuf functions instead of
	old getrcskey/getrcsrev/getrevnum functions.
	(RCS_reparsercsfile): Add rcsbufp parameter.  Change all callers.
	(RCS_deltas): Add rcsbuf parameter.  Change all callers.
	(getdelta): Change fp parameter to rcsbuf parameter.  Change all
	callers.
	(RCS_getdeltatext): Add rcsbuf parameter.  Change all callers.
	(RCS_copydeltas): Add rcsbufin parameter.  Change all callers.
	* rcs.h (RCS_reparsercsfile): Update declaration.
	* admin.c (admin_fileproc): Update calls to RCS_reparsercsfile for
	new parameters.

1998-02-17  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* sanity.sh (toplevel): Also clean up second-dir (not a new
	bug, but triggered by running tests as "toplevel abspath").

	* create_adm.c (Create_Admin): Just print update_dir to tell the
	user where we are; not the whole xgetwd.  Cleaner than
	Noel's change (which also had problems in errno handling).
	* sanity.sh (toplevel-12): Update accordingly.

Tue Feb 17 02:32:21 1998  Noel Cragg  <noel@@swish.red-bean.com>

	[These mods make "checkout" work with "-d /absolute/pathname"
	once again.]
	
	* checkout.c (checkout_proc): the -d flag on the command line
 	should override the -d flag in the modules file if the latter is
 	an absolute path.  The loop that assembles the list of directories
 	to build has been reorganized slightly to prepare for rewriting
 	with last_component rather than assuming '/' as a path separator.
  	Also added to that loop was some code to handle absolute
 	pathnames.
	(build_dirs_and_chdir): add a new argument that tells this routine
 	whether or not to check before it creates and populates
 	directories or not.

	* filesubr.c (last_component): return the top-level directory when
 	asked about the top-level directory.

	* sanity.sh (toplevel-12): change test to reflect the new style of
 	this error message.

	* create_adm.c (Create_Admin): include the directory in the error
 	message.
	
1998-02-16  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* diff.c (diff_fileproc), import.c (import, add_rcs_file), rcs.c
	(RCS_cmp_file): Don't ignore errors from CVS_UNLINK and fclose.

	* patch.c (patch_fileproc): Check for errors from fclose; if we
	get -1 from getline check for end of file vs. error.

	* rcs.c (RCS_checkout): Comment return value (0/1, not -1).
	* commit.c, diff.c, mkmodules.c, patch.c, rcs.c, update.c: Update
	to match this convention.  Don't suppress errors based on
	quiet or really_quiet variables.

	Fix a longstanding bug which also makes stamps-8kw in make
	remotecheck work again (it stopped working with Ian's 8 Feb 98
	checkin):
	* client.c, client.h (change_mode): If new argument respect_umask
	is set, then honor the umask.
	* client.c, server.c: Update callers.

	Cleanups to Tim's checkin:
	* rcs.c (RCS_checkout): Use existence_error not ENOENT.
	* commit.c (checkaddfile): Remove comment about whether we want to
	check for errors from fclose; there is no reason not to.
	* rcs.c (RCS_checkout), update.c (special_file_mismatch): sscanf
	on %ld requires an unsigned long, not a dev_t.
	* update.c (special_file_mismatch): Remove unused variable
	check_devnums.
	* mkmodules.c (config_contents): Between two settings, use a blank
	line not a "#" line.

1998-02-15  Tim Pierce  <twp@@skepsis.com>

	[This is the code as submitted.  I'll be checking in my cleanups
	shortly.  This work sponsored by Abbott Labs.  -kingdon]

	Support for device special files, symbolic links, user and group
	ownerships, and file permissions.
	
	* parseinfo.c: (parse_config): Handle new config variable
	`PreservePermissions'.
	* mkmodules.c (config_contents): Add new PreservePermissions var.

	* rcs.c, rcs.h (preserve_perms): New variable.
	(RCS_checkout, RCS_checkin): Support for newphrases `owner',
	`group', `permissions', `special', `symlink'.
	(RCS_checkout): If `workfile' and `sout' are symlinks, remove them
	before attempting to open them for writing.
	* import.c (add_rcs_file): Support for newphrases.  Do not attempt
	to read data from special files or symlinks.  Error message
	`cannot fstat' is now `cannot lstat'.

	New metrics for deciding when two files are different:

	* update.c, cvs.h (special_file_mismatch): New function.
	(merge_file, join_file): Call it.
	* no_diff.c (No_Difference): Call it.

	* filesubr.c (xcmp): Consider files to be different if they are of
	different types; if they are symlinks which link to different
	pathnames; or if they are devices with different device numbers.
	Error message is now `cannot lstat'.
	* rcs.c (RCS_cmp_file): Use `xcmp' to compare files, simplifying
	the special handling for nonregular files.

	* rcscmds.c (diff_exec, diff_execv): If asked to obtain diffs for
	special files, report no differences.

	Miscellaneous changes to make special file support possible:

	* commit.c (fix_rcs_modes): Don't attempt to `fix' permissions on
	a symlink.

	* import.c (add_rcs_file): Don't try to close fpuser if it was
	never opened (e.g. when operating on a symlink).

	* filesubr.c, cvs.h (isdevice, xreadlink): New functions.
	* filesubr.c (copy_file): Handle special files and symlinks.
	(xchmod): Do nothing if `preserve_perms' is set.

	* commit.c (checkaddfile): Replace `copy_file (DEVNULL, ...)' with
	fopen/fclose calls.  Copy_file no longer attempts to read data
	from device files.

	* filesubr.c (islink): Use CVS_LSTAT, not lstat.
	* vers_ts.c (time_stamp, time_stamp_server): Use CVS_LSTAT, not stat,
	to get symlinks right.
	* subr.c (get_file): Same.  Don't attempt to read from special
	files or symlinks.

	* classify.c (Classify_File): Doc fix.

Fri Feb 13 17:07:32 1998  Eric Mumpower  <nocturne@@cygnus.com>
	and Ian Lance Taylor  <ian@@cygnus.com>

	Fix some file system ordering problems found on Irix 6.4:
	* sanity.sh (basic2): Use dotest_sort for test 56.
	(importb): Use dotest_sort for tests importb-1 and importb-2.
	(head): Use dotest_sort for test head-1.

Thu Feb 12 15:15:33 1998  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* import.c (add_rcs_file): If add_logfp is NULL, don't call fperror.

11 Feb 1998  Andy Piper

	* server.c (cvs_output_binary): Use OPEN_BINARY not _O_BINARY.

Mon Feb  9 18:34:39 1998  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	Tweaks to Ian's checkin:
	* update.c (merge_file): Remove comment about sending file to
	client before the message.  It doesn't apply to this code any more
	(it does apply to checkout_file, but I'm not sure it is important
	to have such a comment anyway).
	* buffer.c (buf_default_memory_error, buf_length): Reindent.
	* server.h: Declare struct buffer before use.

Mon Feb  9 21:05:28 1998  Ian Lance Taylor  <ian@@cygnus.com>

	* rcs.c (RCS_fully_parse): Call getrevnum rather than getrcsrev.
	Don't bother with ungetc.

	* rcs.c (getrcsrev): Rewrite to simply call getrevnum.

Sun Feb  8 15:49:39 1998  Ian Lance Taylor  <ian@@cygnus.com>

	Don't have the server check out a revision into a file and then
	immediately read the file; just read into a buffer instead.
	* update.c: Include buffer.h.
	(update_fileproc): Let checkout_file call server_updated.
	(checkout_file): Add merging and update_server parameters.  Change
	all callers.  If server_active, don't mess with backup files.  If
	server_active, copy the revision into a buffer rather than a file
	when possible.  If update_server, call server_updated.  Fix
	handling of error status.
	(checkout_to_buffer): New static function used by checkout_file.
	(merge_file): Let checkout_file call server_updated.
	(join_file): Likewise.
	* server.c (server_updated): Change file_info parameter to mode
	parameter.  Add filebuf parameter.  Change all callers.  If
	filebuf is not NULL, don't read the file.
	* server.h (server_updated): Update declaration.
	* buffer.c (buf_free): New function.
	(buf_append_buffer): New function.
	(buf_length): New function.
	* buffer.h (buf_free, buf_append_buffer, buf_length): Declare.

	* buffer.c: (buf_initialize): If the memory parameter is NULL, use
	buf_default_memory_error.
	(buf_default_memory_error): New static function.
	* buffer.h (BUFMEMERRPROC): Define typedef.
	* client.c (buf_memory_error): Remove.
	(start_server): Pass NULL rather than buf_memory_error as buffer
	memory error function.

Sat Feb  7 16:27:30 1998  Ian Lance Taylor  <ian@@cygnus.com>

	* rcs.c (RCS_parsercsfile_i): Read the expand keyword from the RCS
	file.  We do this because Version_TS calls RCS_getexpand in many
	common cases, and we don't want to reopen the file just for that.
	(RCS_reparsercsfile): Skip the expand keyword.
	(RCS_getexpand): Don't call RCS_reparsercsfile.

	* rcs.c (STREQ): New macro.  In all string equality tests in the
	file, replace strcmp with STREQ.

Fri Feb  6 16:14:49 1998  Ian Lance Taylor  <ian@@cygnus.com>

	* update.c (checkout_file): If we've already removed the backup
	file once, don't try to remove it again.

	* filesubr.c (unlink_file_dir): Call stat rather than isdir, and
	don't call unlink if the file does not exist.

	* myndbm.c (mydbm_load_file): Rename line_len to line_size.  Call
	getstr rather than getline, to avoid any confusion between \n and
	\012.  Use the line length returned by getstr rather than calling
	strlen.  Remove local variable len.

Fri Feb  6 13:23:46 1998  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* rcs.c (RCS_parsercsfile_i): Don't suppress errors on
	really_quiet.
	(RCS_parsercsfile_i, RCS_reparsercsfile, RCS_fully_parse,
	RCS_deltas, getdelta, getrcskey, RCS_getdeltatext):
	Check for errors.  Include errno in error messages.  Include
	filename in error messages.  Pass new argument to getrcskey.
	(getrcskey): New argument NAME, so we can report errors ourself.

Fri Feb  6 12:10:18 1998  Ian Lance Taylor  <ian@@cygnus.com>

	* rcs.c (RCS_reparsercsfile): Don't use ftell/fseek; just keep
	track of whether we've already read a key/value pair.  Use sizeof
	rather than strlen for a constant string.  Pass the current key
	and value to getdelta, and get them back as well.
	(getdelta): Add keyp and valp parameters.  Don't use ftell/fseek;
	just return the key/value pair to the caller.  Don't allocate
	vnode before we know we need it.  Check one getrcskey return
	value.  Use sizeof rather than strlen for a constant string.

	* rcs.c (getrcskey): Correct comment describing return value.

Thu Feb  5 22:51:13 1998  Ian Lance Taylor  <ian@@cygnus.com>

	* subr.c (getcaller): Cache the result, so that we don't keep
	searching the password file.

Wed Feb  4 23:31:08 1998  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* rcs.c (max_rev): Don't prototype.  Interesting that noone
	complained about this until now.

4 Feb 1998  Jim Kingdon

	* rcs.c (RCS_checkin): When adding a new file, read it
	with "rb" if binary.

Fri Jan 30 11:32:41 1998  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* sanity.sh: Also test "first-dir" as the regexp in loginfo in
	addition to ALL.

	* main.c (main): Update year in copyright notice to 1998.

a1 2

	* version.c: Change version number to 1.9.25.
@


1.1.1.13
log
@Latest version from Cyclic
@
text
@a0 346
1998-05-23  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* Version 1.9.28.

1998-05-22  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* rcs.c (RCS_cmp_file): Check for errors from CVS_FOPEN.  This
	restores the CVS 1.9 behavior (fatal error if we can't open the
	file), and corrects an apparent oversight in Ian's 13 Apr 1997
	change.
	* sanity.sh (modes2): New test, tests for this.

1998-05-22  Ian Lance Taylor  <ian@@cygnus.com>

        * server.c (server_updated): Correct test for whether to unlink
        the file.

1998-05-20  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* wrapper.c (wrap_add): Disable -t/-f wrappers at least until the
	serious bug can be fixed.

1998-05-15  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* checkout.c (checkout): Call server_pathname_check on the
	argument to "cvs co -d".
	* server.c (server_pathname_check): Add comment about how we could
	be handling absolute pathnames.
	* sanity.sh (abspath): Rewrite the tests which run "cvs co -d /foo"
	for remote, to reflect this.

	* sanity.sh (abspath): Also do the "cannot rename" work-around for
	abspath-7d.

1998-05-13  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* commit.c (commit_filesdoneproc): Free admin_dir when done with it.

1998-05-13  Jim Meyering  <meyering@@ascend.com>

	* sanity.sh (editor): Change bogus sed command, `s/^/x&/g', to `s/^/x/'.
	The former exercised a bug in GNU sed-3.01-beta3.
	(emptydir-8): Add `Rebuilding administrative file database' message,
	since now it does that.
	* commit.c (commit_filesdoneproc): Pass only the admin directory
	pathname to mkmodules.
	Remove #if 0, now that it's fixed.

	* status.c (cvsstatus): Rename from `status' to avoid shadowing
	lots of locals and parameters by the same name.
	* server.c (serve_status): Update caller.
	* main.c (cmds[]): Update table entry.
	* cvs.h: Update prototype.

	* commit.c (commit_filesdoneproc): Remove trailing blanks.
	(commit) [CLIENT_SUPPORT]: Remove unnecessary (and local-shadowing)
	declaration of `err'.
	Rename global `tag' to `saved_tag' to avoid overshadowing `tag'
	parameters of three functions.
	Rename global `message' to `saved_message' to avoid overshadowing
	`message' parameter of a function.
	Rename global `ulist' to `saved_ulist' and move dcl up with others.

1998-05-12  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* commit.c (commit_filesdoneproc): #if 0 the new code until it can
	be fixed.

	* commit.c (commit_filesdoneproc): Add comment explaining last
	change.

1998-05-12  Jim Meyering  <meyering@@ascend.com>

	* commit.c (commit_filesdoneproc): Call mkmodules not just when
	committing a file directly under CVSROOT, but also when committing
	files in subdirectories of CVSROOT.

1998-05-08  Jim Meyering  <meyering@@ascend.com>

	* filesubr.c (xreadlink):  NUL-terminate the symbolic link name.
	Use a much smaller initial buffer length.
	Test errno only if readlink fails.
	Use xstrdup then free the original link name so we don't waste space.

1998-05-02  Jim Meyering  <meyering@@ascend.com>

	* rcs.c (rcsbuf_getword): Fix off-by-one error that would result in
	an abort (the first one in rcsbuf_getkey) when operating on on some
	,v files with over 8192 bytes of tag and branch info.

1998-05-04  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* sanity.sh (ann): New tests ann-12 and ann-13 test for specifying
	a numeric branch.

1998-05-02  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* rcs.c: Add comments about getting rid of rcsbuf_getid,
	rcsbuf_getword, and rcsbuf_getstring.

	* sanity.sh (abspath): Revise the workarounds to deal with exit
	status.

1998-04-30  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* sanity.sh (abspath): Work around the "cannot rename" bug.

1998-04-27  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* classify.c (Classify_File): Add comments about checking whether
	command name is "update".

1998-04-22  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* version.c: Change version number to 1.9.27.1.

	* Version 1.9.27.

1998-04-20  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	(This diff was run by devel-cvs and everyone seemed to like it).
	* diff.c (diff_file_nodiff): Make HEAD mean the head of the branch
	which contains the sticky tag, not the sticky tag itself.
	* rcs.c, rcs.h (RCS_branch_head): New function.
	* sanity.sh (head): Update for this changed behavior.

1998-04-19  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* sanity.sh: Move emptydir tests from basicb to new test emptydir.
	This is because we now need a module definition to create Emptydir;
	"co -d" doesn't cut it anymore.

1998-04-17  Petri Virkkula

	* server.c (mkdir_p): Ignore EROFS error (like for EACCES).

1998-04-16  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* checkout.c (checkout_proc): Don't create directories above the
	last one specified in "co -d".
	(build_dirs_and_chdir): Revert Noel's change of 17 Feb 1998.
	(struct dir_to_build): New field just_chdir.
	(build_dirs_and_chdir): Test it.
	* sanity.sh (abspath): New tests abspath-7* test for a bug which
	we fix, in which CVS would create bogus "D/////" entries in
	CVS/Entries.
	(abspath): Revise abspath-3* tests to test for the fact that we no
	longer create directories above the last one specified in "co -d".
	I checked that CVS 1.9 gives an error on this, so changing this
	behavior back should be OK.
	(cvsadm-2d3): Likewise (also checked CVS 1.9 for this case).
	(cvsadm-2d3d): Likewise (also checked CVS 1.9 for this case).
	(cvsadm-2d{4,5,6,7,8}, cvsadm-N2d{3,4,5,6,7,8}): Adjust for new
	behavior (same case as cvsadm-2d3).
	(cvsadm-2d{4,5,6,7,8}d, cvsadm-N2d{3,4,5,6,7,8}d): Remove test
	(same case as cvsadm-2d3d).
	(cvsadm): For remote, skip most these tests.
	(abspath): When cleaning up, delete mod1 and mod2 rather than mod1
	twice (longstanding bug, apparently only becomes visible if you
	run the tests in a certain order).

1998-04-14  Wilfredo Sanchez  <wsanchez@@apple.com>

	* rcs.c: variable "lockfile" was being referenced after being
	free'd.  Bad.  Moved the free() call down.

1998-04-12  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* sanity.sh (rcs): Add test for annotate and the year 2000.

	* server.c (do_cvs_command): If there are partial lines left when
	the child process is done, send them along.
	* sanity.sh (rcs, rcs2): Enable all tests for remote; tests for
	this fix.

1998-04-11  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* client.c (client_senddate): Pass SDATEFORM not DATEFORM to
	sscanf.  This fixes a Y2K bug.

	* history.c (history, select_hrec): Change since_date from time_t
	to RCS format.  Use the usual machinery (in particular, Make_Date
	and client_senddate) so that it will work on VMS too.
	* main.c, cvs.h (date_from_time_t): New function.
	* sanity.sh (history): New test, to test that this didn't break
	anything (also tests client_senddate fix).

1998-04-11  Norbert Kiesel  <nk@@iname.com>

	* server.c (cvs_output_binary): Shut up "gcc -Wall" by removing
	unnecessary else if test.
	* server.c (check_password): Fix uninitialized memory read if
 	shadow passwords are used.  Also added some comments.
	* rcs.c (RCS_checkout): Make sure to call chown with -1 for uid or
	gid if they should not be changed

1998-04-10  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* sanity.sh (rcs2): New test, tests for various Y2K cases.
	* rcs.c (getdelta): Value for "state" keyword is optional (bug
	discovered incidentally in writing rcs2 test).

1998-04-09  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* filesubr.c, cvs.h (link_file): Remove; no longer used.

1998-04-08  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* recurse.c (do_dir_proc): Restore update_dir rather than a
	computation which appears to, but does not necessarily, restore it
	(reported by various people; this fix is from Greg Hudson).
	* sanity.sh (importc): New test, tests for this fix.

1998-03-27  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* rcs.c (RCS_lock): If the revision is already locked, give an
	error rather than dumping core.
	* sanity.sh (reserved): New test reserved-13c tests for this.

1998-03-25  Loren J. Rittle

	* import.c (add_rev): Rewrite to use RCS_FLAGS_KEEPFILE option
	of RCS_checkin() to avoid damage to imported files instead of
	externally undoing damage after the fact.  The side effect is
	that callers of add_rev() may now incrementally walk the
	entries of the current directory without seeing gratuitous
	changes to the directory structure (under at least one file
	system under at least one OS).

1998-03-18  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* error.c (error): Save and restore errno.  Should fix test case
	conflicts3-23 on SCO 5.0.2.  Reported by Steve Cameron.

	* sanity.sh (admin): Rename admin-26-o* to admin-26-*; the "o"
	stands for "cvs admin -o".  Add comment about length of tests.
	Use ${PLUS}.

1998-03-05  Dan Wilder <dan@@gasboy.com>

 	* Fix problem with cvs admin in which -ntag:branch
 	option associated tag with the branch's head revision.
 	Should have used branch number.  Entailed in this fix,
 	the following.

 	* Add new functions "RCS_exist_rev", "RCS_exist_tag",
 	"RCS_tag2rev", and "RCS_valid_rev" to rcs.c.  RCS_tag2rev
 	is similar to RCS_gettag, but does less interpretation.

 	* Plug a small memory leak.

 	* Add tests admin-26 through admin-29 to sanity.sh,
 	to test "cvs admin -n".

1998-03-17  Samuel Tardieu  <sam@@inf.enst.fr>

	* server.c (server_register): protect dereferencing timestamp in
	the trace message when it is null, to avoid a segmentation fault.

1998-03-16  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* options.h.in (MY_NDBM): Rewrite the comment explaining this
	option.  It was not clear to everyone who "my" referred to, for
	example.

	* hardlink.c (list_linked_files_on_disk): Remove unused variables
	err and p.
	(list_linked_files_on_disk): Add comment about memory allocation
	of return value.
	* rcs.c (rcsbuf_getword): Shut up gcc -Wall with a "return 0".
	(RCS_checkin): Remove unused variable fullpath.
	* sanity.sh (hardlinks): Remove comment about spurious warnings;
	the warnings are gone.

1998-03-12  Tim Pierce  <twp@@skepsis.com>

	New functions for parsing and writing hardlink fields.
	* rcs.c [PRESERVE_PERMISSIONS_SUPPORT] (puthardlink_proc): New
	function.
	(putdelta) [PRESERVE_PERMISSIONS_SUPPORT]: Use it.
	(rcsbuf_getid, rcsbuf_getstring, rcsbuf_getword): New functions.
	(getdelta): Call them, storing `hardlinks' field in vnode->hardlinks.
	(RCS_reparsercsfile): When setting rdata->desc, xstrdup value
	rather than rcsbuf_valcopying it (due to changes in how getdelta
	handles keys and values in newphrases).

	* sanity.sh (hardlinks): Use uglier filenames.  Checking out
	hardlinked files no longer produces the same spurious diagnostics,
	so fix that test.
	(hardlinks-2.3): Renamed from hardlinks-2.2 (duplicate test name).

	New infrastructure for managing hardlink lists internally...
	* hardlink.c, hardlink.h (list_linked_files_on_disk,
	compare_linkage_lists, find_checkedout_proc): New functions.
	* rcs.h (struct rcsversnode) [PRESERVE_PERMISSIONS_SUPPORT]: New
	member `hardlinks'.
	* update.c (special_file_mismatch): Get hardlinks from
	vp->hardlinks instead of from vp->other_delta.
	* rcs.c (free_rcsvers_contents): Comment about freeing hardlinks
	member.
	(RCS_checkout) [PRESERVE_PERMISSIONS_SUPPORT]: Get hardlinks from
	vers->hardlinks list instead of vers->other_delta.

	... and removed obsolete code from earlier revs.
	* hardlink.c, hardlink.h (list_files_linked_to,
	cache_hardlinks_proc, list_files_proc, set_hardlink_field_proc):
	Removed.
	* hardlink.h: Removed `links' member from hardlink_info struct.
	* commit.c (commit): Remove the call to cache_hardlinks_proc.
	(check_fileproc) [PRESERVE_PERMISSIONS_SUPPORT]: Removed reference
	to hlinfo->links.
	* hardlink.c (update_hardlink_info): Same.
	* update.c (get_linkinfo_proc): Same.

	* rcs.c (RCS_checkout) [PRESERVE_PERMISSIONS_SUPPORT]: Use
	vp->hardlinks and find_checkedout_proc to find recently-updated
	files that may be hardlinked.
	* update.c (special_file_mismatch): Use List * structures and
	compare_linkage_lists for rev1_hardlinks and rev2_hardlinks.

1998-03-16  Larry Jones  <larry.jones@@sdrc.com>

	* server.c (check_password): If shadow passwords are supported but no
	entry is found in the shadow file, check the regular password file.

1998-03-07  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* sanity.sh: Rename permissions test to perms since that is what
	each of its individual tests are named.
	* sanity.sh (perms symlinks hardlinks): Change CVSROOT to
	CVSROOT_DIRNAME where appropriate.
	(perms symlinks hardlinks): Disable/adjust the meat of the tests for
	remote.
	(symlinks): Link to ${TESTDIR}/fumble rather than
	/fumble/mumble/grumble.  We shouldn't be making assumptions about
	what might exist in random directories outside ${TESTDIR}.
	* hardlink.c (cache_hardlinks_proc): Add comment about trimming
	whitespace.

1998-03-07  Tim Pierce  <twp@@skepsis.com>

	* rcs.c (RCS_checkout): Negation bug when checking out symlinks:
	existence_error should be !existence_error.
	* sanity.sh (permissions symlinks hardlinks): New tests, for
	PreservePermissions.

a2 4
	* version.c: Change version number to 1.9.26.1.

	* Version 1.9.26.

d33 1
a33 1
	* rcs.c (RCS_checkout):
d238 1
a238 1

d258 1
a258 1

d297 1
a297 1

@


1.1.1.14
log
@Latest version from Cyclic
@
text
@a0 345
Thu Aug 13 11:15:24 1998  Noel Cragg  <noel@@swish.red-bean.com>

	* version.c: Change version number to 1.10 and name to `Halibut'.

	* sanity.sh (rcslib): new tests to check behavior of symlinks in
 	the repository.

Wed Aug 12 15:39:38 1998  Noel Cragg  <noel@@swish.red-bean.com>

	* main.c (lookup_command_attribute): the `annotate' command
 	shouldn't require access to the repository.  Add comment about
 	commands that do not use the working directory.

Mon Aug 10 10:26:38 1998  Noel Cragg  <noel@@swish.red-bean.com>

	* version.c: Change version number to 1.9.30.

Thu Aug  6 17:44:50 1998  Noel Cragg  <noel@@swish.red-bean.com>

	* server.c (serve_rdiff): change the name of the command (for
 	error reporting, etc.) from "patch" to "rdiff."
	(serve_remove): rename from "cvsremove" to "remove."

	* main.c (lookup_command_attribute): the `rdiff' command shouldn't
 	require write access to the repository.

1998-08-06  David Masterson of kla-tencor.com
	and Jim Kingdon

	* commit.c (commit_filesdoneproc): Don't call strlen ("CVSROOT")
	from within the assert statement.  Apparently HP's cc compiler on
	HPUX 10.20 has trouble with that.

1998-08-06  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* rcs.c (RCS_checkin): When adding branch, if there is a lock on
	the branchpoint owned by someone else, leave it alone.  This
	restores CVS 1.9 (RCS 5.7) behavior, fixing a core dump.
	* sanity.sh (reserved): New tests reserved-16 through reserved-19
	test for this fix.

1998-08-05  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* sanity.sh (unedit-without-baserev): Use ${QUESTION} not "?".
	This makes it work with GNU expr 1.12 as well as 1.16.

Sun Aug  2 20:27:44 1998  Noel Cragg  <noel@@swish.red-bean.com>

	* mkmodules.c: add comment about TopLevelAdmin for the initial
 	contents of CVSROOT/config.

1998-07-29  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* rcs.c (RCS_checkin): Only try to call xreadlink if HAVE_READLINK
	is defined.

Tue Jul 28 19:33:08 1998  Noel Cragg  <noel@@swish.red-bean.com>

	* version.c: Change version number to 1.9.29.

	* rcs.c (RCS_checkin): add code to follow symbolic links in the
 	repository.

Sun Jul 26 05:14:41 1998  Noel Cragg  <noel@@swish.red-bean.com>

	* This set of changes reverts the code to pre-1.9.2 behavior and
 	does not create CVS directories at top-level (except for the
 	obvious "cvs co .").  Added a new configuration option to switch
 	between 1.9 and 1.9.2 behavior.
	
	* recurse.c (do_argument_proc): new function.
	(start_recursion): in the case that we've done a command from
 	top-level but have no CVS directory there, the behavior should be
 	the same as "cvs <cmd> dir1 dir2 dir3...".  Make sure that the
 	appropriate "Argument" commands are sent to the server by calling
 	walklist with do_argument_proc.
 
	* client.c (call_in_directory): only create the top-level CVS
 	directory when we're checking out "." explicitly.  The server will
 	force creation of this directory in all other cases.

	* checkout.c (checkout_proc): only generate the top-level
 	directory when the TopLevelAdmin=yes.  Also send a message to the
 	client to do the same.

	* parseinfo.c (parse_config): handle TopLevelAdmin option.  Set
 	top_level_admin.

	* main.c: add new variable top_level_admin.
	* cvs.h: add extern definition for above.

	* sanity.sh: since we're reverting to pre 1.9.2 behavior for
 	top-level CVS directories, I needed to make changes to a bunch of
 	tests that made assumptions about said directories.
	(preamble): make sure to add read and execute access to everything
 	in TMPDIR before removing, since some tests make things read-only.
	(basicb-1a, basicb-1b, basicb-9a, basicb-9b): use dotest_fail
 	because these tests check for the non-existant top-level CVS
 	directory.
	(basicc-3, emptydir-6, emptydir-7, crerepos-6): use "rm -rf" so it
 	won't complain when trying to remove the non-existant top-level
 	CVS directory.
	(106.5): remove imported-f2-orig.tmp.
	(modules2-10, emptydir-4, abspath-1ba, abspath-1bb): cd into the
 	directory where files exist before using the "add" command so cvs
 	can find CVSROOT in CVS/Root.
	(cvsadm-2): look at a different CVS/Repository file, since the
 	top-level one doesn't exist.
	(taginfo-3): create the directory in the repository directly
 	rather than relying on the fact that the top-level CVS directory
 	was created in a previous test.
	(serverpatch-6): update first-dir explicity, rather than relying
 	on the non-existant top-level CVS/Entries file.
	(crerepos-18): look at CVS/Repository in a subdirectory rather
 	than in the non-existant top-level CVS directory.
	(toplevel): add code to set TopLevelAdmin=yes.
	(toplevel2): new tests -- same as toplevel, but TopLevelAdmin=no.

1998-07-21  Jim Meyering  <meyering@@ascend.com>

	* rcs.c (RCS_checkout): Hoist frees of rev and value.
	Warn and return 1 in several cases rather than exiting via
	`error (1, ...'.  The latter could abort a multi-file commit
	in mid-stream, leaving stale locks in the repository.

1998-07-16  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* build_src.com (rcscmds.c): Also look for include files in
	[-.diff], just like Ian's 1998-06-18 change to Makefile.in

1998-07-14  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* tag.c (pretag_proc), rtag.c (pretag_proc): Don't pass RUN_REALLY
	to run_exec.  This means that taginfo does not get executed if the
	global -n option is specified.  Which makes it like loginfo, -i,
	-e, -o, -t, -u in modules, editinfo, and verifymsg and unlike
	commitinfo.  The old behavior was pretty bad in the sense that it
	doesn't provide any way to log only the tags which actually
	happen.
	* sanity.sh (taginfo): New tests taginfo-11 to taginfo-13, for this.

1998-07-12  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* sanity.sh (ann-id): Write the test so that it tests for the
	current (buggy) behavior.

	* sanity.sh (taginfo): Also clean up cvsroot/first-dir.

1998-07-12  Jim Meyering  <meyering@@ascend.com>

	* sanity.sh (ann-id): New (currently failing) test for bug in how
	rcs keywords are expanded in the output of `cvs annotate'.

1998-07-12  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* sanity.sh (taginfo): Write the TESTDIR into the script rather
	than having the script look at the environment.  This means that
	it will work if TESTDIR is set by sanity.sh as well as if
	sanity.sh finds TESTDIR in the environment.

1998-07-11  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* tag.c (check_fileproc): Calculate the revision to be tagged the
	same way that tag_fileproc does.
	* sanity.sh (taginfo): New tests, test for this (before this fix,
	brtag had said 1.1 not 1.1.2.1).

1998-07-10  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* sanity.sh (unedit-without-baserev): Also clean up "2" directory.

1998-07-08  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* edit.c (unedit_fileproc): If the Baserev file is missing, don't
	get the working file from CVS/Base.  The previous code could get
	you version 1.1 of the working file and put 1.2 in CVS/Entries.
	* sanity.sh (unedit-without-baserev): New tests test for this.

1998-07-02  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* sanity.sh (unedit-without-baserev): Move the test itself to be
	in the same order as in the "tests" variable.

1998-07-02  Ian Lance Taylor  <ian@@cygnus.com>

	* rcscmds.c: Don't include <stdarg.h> or <vasprintf.h>.  Don't
	declare vasprintf.
	(call_diff_printf_output): Remove.
	(call_diff_stdout_callbacks): Don't initialize printf_output
	field--it has been removed from the interface.
	(call_diff_file_callbacks): Likewise.

1998-07-01  Jim Meyering  <meyering@@ascend.com>

	* edit.c (unedit_fileproc): Handle the case in which base_get
	returns a NULL baserev.  That happens when a file being `unedit'ed
	exists in the CVS/Base directory, but isn't listed in the CVS/Baserev
	file.  The one case I've seen had no Baserev file at all.  The symptom
	(if you're lucky) is a segmentation fault upon unedit.  If you use
	SunOS4.1.4 for which printf prints NULL pointers as `(null)', your
	unedit command will complete normally, but it will have corrupted
	your CVS/Entries file and a subsequent update may result in an
	assertion failure, a core dump, and a stale lock in the repository.
	* sanity.sh (unedit-without-baserev): New test for this.

1998-07-01  Andy Mortimer of aeat.co.uk
	and Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* server.c (server_updated): Use a prototype if we are using them
	for declarations.

1998-06-29  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* sanity.sh (commit-readonly): Protect keyword against expansion
	in sanity.sh itself.  Keep the keyword in the file which we check
	in (or else this fails to test for the RCS_checkout change).

1998-06-27  Jim Meyering  <meyering@@ascend.com>

	* rcs.c (RCS_checkout): If opening the local workfile fails due to
	lack of write access, try to chmod the file and retry the open.
	Before, a commit could fail part way through merely because the
	open to rewrite with newly expanded rcs keywords would fail.  It's
	easy to make this happen if you use `cvs -r' or CVSREAD and you
	apply a patch to one of your read-only source files -- patch
	preserves the read-only setting for the file and your next commit
	will fail after committing that file, but before rewriting
	(checking out) your working copy.
	* sanity.sh (commit-readonly): New test for this.

1998-06-25  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* update.c (patch_file): Update comments regarding context diffs
	to reflect diff library.

1998-06-23  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* sanity.sh (modules4): Add tests for reversing the order of the
	"!first-dir/sdir" and "first-dir".

1998-06-23  Jim Kingdon  <kingdon@@harvey.cyclic.com>
	and Dave Wolfe@@Motorola.

	* sanity.sh (modes2): Touch the file before chmod'ing it.

1998-06-21  Ian Lance Taylor  <ian@@cygnus.com>

	* update.c (merge_files): Revert changes of 1998-06-19.  Instead,
	register a merged file with a dummy time stamp.  Only set
	last_register_time if we need to.
	(join_file): Likewise.  Always register a merged file, not just
	when the merge fails.

1998-06-21  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* call_diff_write_output, call_diff_printf_output,
	call_diff_flush_output, call_diff_write_stdout, call_diff_error,
	call_diff_stdout_callbacks, call_diff_file_callbacks): Re-indent.

1998-06-19  Ian Lance Taylor  <ian@@cygnus.com>

	* update.c (merge_file): Make sure the time stamp of the file is
	different from the time stamp we register in the Entries file.
	(join_file): Likewise.

1998-06-18  Ian Lance Taylor  <ian@@cygnus.com>

	* rcscmds.c: Include <stdio.h>.  Include either <stdarg.h> or
	<varargs.h>.  Declare vasprintf.
	(call_diff_write_output): New static function.
	(call_diff_printf_output): New static function.
	(call_diff_flush_output): New static function.
	(call_diff_write_stdout): New static function.
	(call_diff_error): New static function.
	(call_diff_stdout_callbacks): New static variable.
	(call_diff_file_callbacks): New static variable.
	(call_diff): Don't sleep.  Use a callback structure when calling
	the diff library.
	(call_diff3): Likewise.

	* rcscmds.c: Include diffrun.h.
	(call_diff, call_diff3): Pass NULL callback parameter.
	(diff_run, diff3_run): Don't declare.
	* Makefile.in (rcscmds.o): New target, to use -I for diff
	directory.
	(zlib.o): Depend upon zlib.h.

1998-06-09  Mike Sutton@@SAIC

	Make it compile with Sun's bundled K&R C compiler:
	* rcs.c (count_delta_actions): Change to static to match
	declaration.
	* client.c (handle_wrapper_rcs_option): Rename error label to
	handle_error to avoid clash with function name.

1998-06-09  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* rcs.c (RCS_delete_revs): If we are trying to delete all
	revisions, give an error rather than assertion failed.
	* sanity.sh (basicb): New tests basicb-o* test for this.

1998-06-04  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* add.c (add): Only send "Directory" requests if we need to.

1998-06-02  Assar Westerlund  <assar@@sics.se>

	* client.c: Check for HAVE_GSS_C_NT_HOSTBASED_SERVICE rather than
	assuming that GSS_C_NT_HOSTBASED_SERVICE is a macro.
	* server.c: Likewise.

1998-06-02  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* fileattr.c (fileattr_read): Check for NULL return from strchr.
	* sanity.sh (devcom3): New test devcom3-10 checks for this.

1998-06-01  Assar Westerlund  <assar@@sics.se>
	and Ian Lance Taylor  <ian@@cygnus.com>

	* client.c: If HAVE_GSSAPI_H, include <gssapi.h>.  Only include
	<gssapi/gssapi.h> if HAVE_GSSAPI_GSSAPI_H.  Only include
	<gssapi/gssapi_generic.h> if HAVE_GSSAPI_GSSAPI_GENERIC_H.
	(GSS_C_NT_HOSTBASED_SERVICE): Define if not defined.
	(connect_to_gserver): Use GSS_C_NT_HOSTBASED_SERVICE instead of
	gss_nt_service_name.
	* server.c: Same header file changes.
	(GSS_C_NT_HOSTBASED_SERVICE): Define if not defined.
	(gserver_authenticate_connection): Use GSS_C_NT_HOSTBASED_SERVICE
	instead of gss_nt_service_name.

1998-06-01  Jim Meyering  <meyering@@ascend.com>

	* sanity.sh (tag8k): Add a test for the 1998-05-02 rcs.c bug fix.

1998-05-26  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* rcs.c (annotate): Call tag_check_valid like the other functions
	which have a -r option.
	* sanity.sh (ann): New test ann-14 tests for this.

1998-05-24  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* sanity.sh (importc): New tests importc-5 through importc-8 test
	for a (fairly obscure) regression from CVS 1.9.

a1 9

	* sanity.sh (modules2): Add comment listing cvs release tests.
	(info): New test info-cleanup-0 tests "cvs -n release".

	* rcs.c (rcsbuf_getid): Remove semicolon at end of #undef.  I'm
	kind of surprised that compilers accepted this at all, but
	removing it squelches a warning for some compilers.

	* version.c: Change version number to 1.9.28.1.
@


1.1.1.15
log
@Latest version from Cyclic
@
text
@a0 1065
1999-02-18  Jim Kingdon  <http://www.cyclic.com>

	* sanity.sh (files): New test, for a relatively obscure spurious
	"Up-to-date check failed" in client/server.

	* main.c (lookup_command_attribute): Don't check for "history"
	twice.

1999-02-17  Jim Kingdon  <http://www.cyclic.com>
	    and Hallvard B Furuseth

	* root.c (parse_cvsroot): Rearrange ifdefs to squelch possible
	warnings about statement not reached.

1999-02-16  Jim Kingdon  <http://www.cyclic.com>

	* recurse.c (start_recursion): If we are skipping the current
	directory (due to it being from the wrong repository), also adjust
	the arguments we send to the server accordingly (like we already
	do for the case in which there is no CVS directory).
	* sanity.sh (multiroot4): New test, for this.  All these tests had
	passed locally, but remote multiroot4-12 tests for this fix.
	(multiroot): Adjust multiroot-diff-1, multiroot-update-2,
	multiroot-tag-1, multiroot-status-1, multiroot-update-3, and
	multiroot-log-1 to reflect the cosmetic change this produces (one
	less "Diffing ." message).
	(multiroot2): multiroot2-8 likewise.

1999-02-10  Jim Kingdon  <http://www.cyclic.com>

	* tag.c (cvstag): Don't pass SEND_NO_CONTENTS if -c specified.
	* sanity.sh (tagc): New test, for various tag -c behaviors.
	Test tagc-6 tests for this fix.

1999-02-09  Jim Kingdon  <http://www.cyclic.com>

	* error.c (error): Rewrite to no longer use vasprintf (see
	../lib/ChangeLog for rationale).  Note the slight change in
	interface - callers which want %8.8s or similar formats need to
	call sprintf.
	* lock.c (lock_wait, lock_obtained): Use sprintf.

1999-02-08  Jim Kingdon  <http://www.cyclic.com>

	* rcs.c (RCS_delete_revs): Pass -a to diff_exec.
	* sanity.sh (binfiles3): New tests binfiles3-9 through
	binfiles3-13 test for this fix.
	* sanity.sh (binfiles): New tests binfiles-o4 and binfiles-o5
	(which don't test this bug, just on general principles).

1999-02-04  Jim Kingdon  <http://www.cyclic.com>

	* lock.c (lock_name): Permissions of directories in LockDir
	shouldn't depend on the umask.
	* sanity.sh (lockfiles): Set umask and CVSUMASK, to test for this.

1999-02-01  Jim Kingdon  <http://www.cyclic.com>

	* sanity.sh (keywordlog): New tests keywordlog-22 and
	keywordlog-23 test keyword expansion and $Log.  Adjust other tests
	so that revisions differ more from each other, so this is a
	better test.

1999-01-29  Jim Kingdon  <http://www.cyclic.com>

	* commit.c (checkaddfile): If options is "", treat it the same as
	NULL.  Centralize this check, and the one for it starting with
	"-k", at the start of the function.

	* rcs.c, rcs.h (RCS_setexpand): New function.
	* admin.c (admin_fileproc): Access keyword expansion field via
	RCS_getexpand and RCS_setexpand, rather than directly.
	* commit.c (checkaddfile): When resurrecting, set the keyword
	expansion mode.
	* sanity.sh (binfiles3): Adjust tests binfiles3-7 and binfiles3-8
	for the new behavior.

1999-01-27  Jim Kingdon  <http://www.cyclic.com>

	* sanity.sh (multiroot3): Add new variant of multiroot3-10 test
	for RELATIVE_REPOS.  Move multiroot3-11 test out of the
	conditionals; it works the same for remote or local,
	RELATIVE_REPOS or no.

	* options.h.in: Make RELATIVE_REPOS the default, as has been
	announced as a future direction since 1997-10-11.
	* sanity.sh (multiroot): Tweak multiroot-update-1a and
	multiroot-update-1b tests to work with either RELATIVE_REPOS or
	non-RELATIVE_REPOS.

	* sanity.sh (client-9): Don't assume the time zone.

1999-01-26  Jim Kingdon  <http://www.cyclic.com>

	Fix one facet of the "cvs add -kb" re-adding problem (the other
	known facet is tested for by binfiles3-8).
	* add.c (add): When re-adding a file, set the keyword expansion
	as we normally would.
	* sanity.sh (binfiles3): New test binfiles3-6a tests for this.

1999-01-22  Jim Kingdon  <http://www.cyclic.com>

	* sanity.sh (rmadd2): New tests, for undoing a commit.

1999-01-21  Eric Mumpower  <nocturne@@cygnus.com>

	* sanity.sh (reposmv): Actually modify CVSROOT in current
	environment when calling functions, rather than trying to achieve
	the same effect with "CVSROOT=foo functionname". (Many common
	bourne shells, including those in SunOS and Solaris 2.4-2.7,
	do not properly handle "ENVVAR=foo command" when "command" is
	a user-defined shell function rather than an actual executable.)

1999-01-15  Jim Kingdon  <http://www.cyclic.com>

	* sanity.sh (rcs3): Redirect awk's stdin to /dev/null like all the
	other awk invocations.  GNU awk seems not to read stdin in this
	case, but that behavior is hard to reconcile with the Single Unix
	Spec and some awks don't do it.

	* sanity.sh (binfiles, binfiles2, binfiles3, server): Use the same
	tr trick as in rcs3.  People don't seem to have been complaining,
	and this should fix server-4 for HPUX.

1999-01-14  Jim Kingdon  <http://www.cyclic.com>

	* client.c (recv_line): If the line we are reading contains a
	character which would sign-extend to EOF, don't treat it as end of
	file.  recv() doesn't report end of file this way and this might
	fix bugs with 0xff characters.

1999-01-14  Larry Jones  <larry.jones@@sdrc.com>

	* client.c (recv_line): Handle EOF from server.

	* sanity.sh (importc-8, importc-9): Accept anything in the seconds
	fields of the timestamps since touch doesn't set it reliably.
	(This isn't great, but it's better than nothing.)

1999-01-14  Jim Kingdon  <http://www.cyclic.com>

	* run.c (run_exec): Adjust comment about vfork; this isn't the place
	to get into a treatise about fork performance vs. vfork
	performance but it isn't quite as simple as whether one has
	copy-on-write.

1999-01-13  Larry Jones  <larry.jones@@sdrc.com>

	* sanity.sh (dotest_fail): Handle spurrious output from assert better.

	* sanity.sh (rcs3-4, rcs3-5a): Handle even more variants of the
	assertion failure message.

1999-01-12  Larry Jones  <larry.jones@@sdrc.com>

	* sanity.sh (mtfr-3): ls behavior varies wildly on nonexistant files,
        just use echo instead.

1999-01-11  Jim Meyering  <meyering@@ascend.com>

	* sanity.sh (mkmodules-temp-file-removal): New test, for this.
	* mkmodules.c (mkmodules): Remove each `CVSROOT/.#[0-9]*' temporary
	file that's used to check out files listed in CVSROOT/checkoutlist.
	Remove extra semicolon at end of line.

1999-01-11  Larry Jones  <larry.jones@@sdrc.com>

	* sanity.sh (rcs3-5a): Allow for multiple lines of output before the
	assertion failure message.

	* sanity.sh (lockfiles-6, client-8): Work around bug in HP-UX chmod
	(doesn't allow anything to follow omitted permissions).

1999-01-09  Jim Kingdon  <http://www.cyclic.com>

	* client.c (set_sticky): Nonfatal error if we can't write it.
	* sanity.sh (dirs2-8 through dirs2-14): New tests, for this.

	* sanity.sh (rcs3): Write NUL character with tr not awk, in
	accordance with Single Unix Specification.  Hopefully will fix
	rcs3-7 for HPUX.  Will not work on SunOS4, but then again neither
	did the old syntax.

1999-01-05  Jim Kingdon  <http://www.cyclic.com>

	* client.c, update.c: Rename MD5* functions to cvs_MD5* per
	corresponding change to ../lib/md5.h.

1999-01-03  Jim Kingdon  <http://www.cyclic.com>

	* sanity.sh (client): Give file1 a predictable mode so that the
	output in client-9 will not depend on the umask of the user
	running the tests.

1998-12-29  Jim Kingdon  <http://www.cyclic.com>

	* client.c (client_senddate): Use date_to_internet rather than
	using our own "5/26/1997 13:01:40 GMT" date format.
	* main.c (date_to_internet): Check for errors from sscanf.  Always
	send a four digit year.  Send hours, minutes, and seconds as two
	digits per RFC822.
	* sanity.sh (client): New tests client-8 and client-9 test for this.

	* sanity.sh (rcs2): New tests rcs2-6 through rcs2-8 test for fix
	to lib/getdate.y (before the fix, "100 months" or "8 years" would
	tend to mean the year 1969, thus the tests would give "cvs update:
	file1 is no longer in the repository").

1998-12-28  Larry Jones  <larry.jones@@sdrc.com>

	* entries.c (Register): Return if unable to open log file to avoid
	referencing the invalid file pointer.
	* sanity.sh (dirs2-7): With above change, no longer fails.
	* sanity.sh (rcs3-5a): Another assertion failure message.
	* sanity.sh (pserver-4, pserver-5): Some 4.4BSD derived systems spit
	out bogus error messages when initgroups is called as non-root.

1998-12-23  Larry Jones  <larry.jones@@sdrc.com>

	* sanity.sh (rcs3, dotest_fail): The assertion failure message varies
	wildly between different systems and the resulting abort call can
	even result in spurrious output.  Fix the regexp to accept nearly
	anything containing some kind of assertion failure and ensure that
	any spurrious output ends up in the output file instead of on the
	terminal.

1998-12-23  Jim Kingdon  <http://www.cyclic.com>

	* admin.c, checkout.c, commit.c, cvsrc.c, expand_path.c,
	history.c, ignore.c, import.c, log.c, mkmodules.c, modules.c,
	myndbm.c, parseinfo.c, rcs.c, remove.c, rtag.c, status.c, subr.c,
	tag.c, wrapper.c: Cast all char's to unsigned char before passing
	them to ctype.h functions (isalpha, isgraph, isalnum, isspace,
	isdigit, isprint, isupper).  Whether using ctype.h is the right
	thing at all is unclear to me (having the server depend on locale
	seems wrong, as we don't necessarily have any good way to set the
	right locale, if there even is such a concept as 'right' locale in
	this context), but as long as we use ctype.h we might as use it
	according to the standards (this affects systems where plain char
	is signed but users supply characters with the 8th bit set).
	Thanks to Paul Eggert for suggesting this.

1998-12-22  Jim Kingdon  <http://www.cyclic.com>

	* sanity.sh (rcs3): Oops, the earlier fix for srcdir only fixed
	the non-remote case, not the remote case.  Fix the other occurrence.

1998-12-22  Jim Kingdon

	* sanity.sh (rcs3): The assertion failure message varies slightly
	depending on whether CVS was built with srcdir != ".".  Fix regexp.

1998-12-21  Jim Kingdon

	* rcs.c (RCS_getdate): Reindent Jim Meyering's change; remove
	unused variable x_vers.

	* rcs.c: When printing an unexpected character we found in the RCS
	file, print it in hex rather than as a character (see comment for
	rationale).
	* sanity.sh (rcs3): Adjust rcs3-2 and rcs3-7 tests accordingly.

	* sanity.sh (rcs3): New test, for some error handling cases
	involving parsing RCS files.

1998-12-16  Jim Meyering  <meyering@@ascend.com>

	* rcs.c (RCS_getdate): Handle the case in which a file is first
	imported after its initial version has been created.
	* sanity.sh (import-after-initial): New test for that.

1998-12-17  Jim Kingdon

	* server.c (serve_root): Pserver_Repos only exists if
	AUTH_SERVER_SUPPORT is defined.

1998-12-12  Jim Kingdon, and Derek R. Price of Stortek.

	* sanity.sh (multiroot): Change + to ${PLUS}.

1998-12-12  Jim Kingdon, and Gary Young of Motorola

	* sanity.sh (admin): In tests admin-13, admin-25, and admin-29,
	allow 4 digit year in addition to 2 digit year.

1998-12-12  Jim Kingdon

	* sanity.sh (log): New tests log-14a and log-14b test for -rHEAD
	and for HEAD as (nonexistent) file name.

1998-12-02  Jim Kingdon

	* version.c: Squish version number to 1.10.4.1.

	* version.c: Version 1.10.4.

1998-11-24  Jim Kingdon

	* recurse.c (do_file_proc): Check for errors from RCS_parse.
	* sanity.sh (rcslib-symlink-7 through rcslib-symlink-10): New
	tests, test for this.

	* sanity.sh (reposmv-2): Adjust for 22-Nov change to Find_Names.

	* entries.c (Register): If we can't write Entries.Log, make it a
	nonfatal error.
	* sanity.sh (dirs2): Test for this fix.

	* sanity.sh (dirs2): Clean up working directory at end of test.

1998-11-23  Jim Kingdon

	* sanity.sh (dirs2): New test, for some more cases involving
	deleting directories and such.

	* sanity.sh (dirs): Update for yesterday's change in Find_Names
	error handling.  The error in dirs-4 is fairly different now; in
	dirs-3 and dirs-3a it is the obvious change.

1998-11-22  Jim Kingdon

	* sanity.sh (release): Move the commments listing "cvs release"
	tests from modules2-6 to here.
	* release.c (release): Update comment to reflect "? foo" case.

	* find_names.c (Find_Names): If we can't read the repository, make
	it a nonfatal error.  Tell the caller whether this happened.
	(find_rcs): Add comment regarding this behavior.
	* recurse.c (do_recursion): If Find_Names gives an error, skip
	the directory and print a message saying so.
	* sanity.sh (modes3): New test, for this.

1998-11-18  Jim Kingdon

	* rtag.c (rtag_usage), tag.c (tag_usage): Use "-r rev"
	consistently.

	* sanity.sh (conflicts3): Tests conflicts3-24 through
	conflicts3-28 test for another case similar to conflicts3-22.

1998-11-14  Jim Kingdon

	* sanity.sh (diff): New test, for now just tests for the "I know
	nothing" message.

	* sanity.sh (conflicts2-142b7 through conflicts2-142b11): New
	tests; resurrecting doesn't work from one level up.

	* sanity.sh (mwrap-7): Remote prints the messages in a different
	order.

1998-11-13  Jim Kingdon

	* tag.c (check_fileproc): Log tag deletions.
	* rtag.c (check_fileproc): Likewise.
	* sanity.sh (taginfo-14 through taginfo-18): New tests, for
	these behaviors.

1998-11-12  Jim Kingdon

	* sanity.sh (mwrap-7): Update for the noexec fix.

	* server.c (server_copy_file): Add comment about noexec.

	* update.c (checkout_file): Handle noexec case involving revbuf
	and modes.
	(update_fileproc): In case T_NEEDS_MERGE, let merge_file take care
	of noexec, so it can tell the user if there would be conflicts.
	(merge_file): Print "conflicts found in FILE" message
	regardless of noexec.  Add comment about checking for whether the
	file already contained the changes, and noexec.
	* sanity.sh (conflicts-192a): New test, for this.

1998-10-20  Jim Kingdon

	Use the gzip library on the server.  Probably doesn't speed things
	up as currently implemented, but does avoid hassles in terms of
	finding an external gzip program.
	* zlib.c, server.h (gunzip_and_write, read_and_gzip): Now returns
	whether a fatal error occurred, rather than expecting error (1,
	...) to work.
	* client.c (update_entries, send_modified): Change callers.
	* server.c (receive_file): Rewrite gzip code to use
	gunzip_and_write rather than filter_through_gunzip.
	(server_updated): Likewise, use read_and_gzip rather than
	filter_through_gzip.
	* client.c, client.h (filter_through_gzip, filter_through_gunzip),
	run.c, cvs.h (filter_stream_through_program): Removed; no longer used.
	* sanity.sh (server): New tests server-4 and server-5 test
	this feature (note that CVS 1.10 also passes these tests; the
	behavior is supposed to be unchanged).

1998-10-19  Jim Kingdon

	* sanity.sh (multiroot3): New test, tests for a few more
	multiroot cases.

	* lock.c (lock_name): Set the permissions on each directory we
	create to that of the parent directory.
	* sanity.sh (lockfiles): New chmod and tests lockfiles-7a and
	lockfiles-7b test for this.  Adjust lockfiles-5 for new text of
	error message.

1998-10-15  Jim Kingdon

	* server.c (requests): Set RQ_ROOTLESS for "Set".
	* sanity.sh (info): Also clean up $HOME/.cvsrc.
	(server): Test that we can send Set before Root (had been tested
	by crerepos-6b, but only if you ran the info test first).  Tests
	for this fix.

1998-10-14  Jim Kingdon

	* subr.c (expand_string): Tweak the algorithm so that the size
	that it allocates is generally a power of two.

1998-10-14  Eivind Eklund and Jim Kingdon

	* commit.c (commit): For the client, don't worry about whether we
	are root.

1998-10-13  Jim Kingdon

	* server.h (struct request): Change status field to flags and add
	RQ_ROOTLESS.
	* client.c (handle_valid_requests, supported_request): Change
	status to flags.
	* server.c (requests): Change status to flags.  Add RQ_ROOTLESS.
	* server.c (server): If not RQ_ROOTLESS, and we haven't gotten a
	Root request, give an error.

1998-10-12  Jim Kingdon

	* version.c: Slide version number to 1.10.3.1.

	* Version 1.10.3.

	* sanity.sh (modules2-17): Update for 9 Oct 1998 change to
	update_dirent_proc.

1998-10-11  Jim Kingdon

	* commit.c (checkaddfile, commit_fileproc): A numeric value for
	'tag' does not mean that we are adding on a branch.
	* sanity.sh (keywordlog): Adjust this test, to test for this
	(replaces comment saying we should be doing it).
	(rmadd): Likewise.

	* sanity.sh (rmadd): New test, tests for various existing
	behaviors with "cvs ci -r".

1998-10-09  Jim Kingdon

	* update.c (update_dirent_proc): For local CVS, if the directory
	does not exist in the working directory nor in the repository,
	just skip it.
	* sanity.sh (dirs): New tests dirs-3a, dirs-7 and dirs-8 test for
	this and related behaviors.  Note that the new behavior was also
	the previous behavior for remote; we are only changing it for local.

	* wrapper.c, cvsrc.c, ignore.c: Add comments about ignoring .cvsrc
	and friends if we can't find a home directory.
	* expand_path.c (expand_path): If we can't find the home
	directory, give an error rather than a coredump (or worse).
	* login.c (construct_cvspass_filename): Don't use errno in error
	message; get_homedir doesn't set it.  Add comment about this
	message.

1998-10-07  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* diff.c (diff): Set variables to NULL at the start, and free
	memory at the end.
	* sanity.sh (multiroot2): Add tests for this (before the fix,
	multiroot2-12 would abort with "no more than two revisions/dates
	can be specified").

1998-10-06  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* Makefile.in (installcheck check): Remove references to RCSBIN;
	they don't do anything now that RCSBIN is ignored.

	* client.c: Clean up horrible confusion about whether stored_mode
	or stored_mode_valid (or nothing :-)) indicates whether
	stored_mode is allocated.  Should fix crashes (for example, on NT
	when the server has renamed multiple files from uppercase to
	lowercase).

	* sanity.sh (dirs): New tests, tests for some cases involving
	admins who do surgery on the repository.

1998-10-03  Johannes Stezenbach <johannes.stezenbach@@propack-data.de>

	* vers_ts.c (Version_TS): If UTIME_EXPECTS_WRITABLE, if
	necessary change the file to be writable temporarily to set its
	modification time.

1998-10-03  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* client.c (handle_error): Add comment about indicating which
	errors are from the server.

1998-10-01  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* sanity.sh (devcom-180): Allow one digit day.

1998-09-30  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* main.c (main): Don't call Name_Root if -d specified.
	* recurse.c (do_recursion, do_dir_proc): Don't check CVS/Root
	if -d was specified.
	* import.c (import): Indentation fix.
	* sanity.sh (multiroot): Update for this change.
	(reposmv): New test, tests for this.

1998-09-28  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* sanity.sh (multiroot2): New test, tests some nested directory
	cases.

1998-09-25  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* sanity.sh (multiroot): Change a few comments which said modules
	when they meant directories.

1998-09-25  Jim Meyering  <meyering@@ascend.com>

	* sanity.sh (devcom-180): Add 0-9 to the range of characters allowed
	in hostname regexp.

1998-09-25  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* sanity.sh (log2): New test log2-7a tests for one error handling
	case.  Add a comment about another.

1998-09-24  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* sanity.sh: Change crerepos test back to :ext: (for several
	reasons; see comments).

1998-09-24  Noel Cragg  <noel@@swish.red-bean.com>

	* sanity.sh (rcslib-symlink-5, rcslib-symlink-6): new tests to
	check the operation of "tag" when there are symlinks in the
	repository.

	* rcs.c (RCS_checkin): remove old code that resolved the symlink
	and call resolve_symlink instead.
	(RCS_rewrite): call resolve_symlink before doing anything else to
	make sure we're operating on the file and not the symlink.

	* subr.c (resolve_symlink): new routine -- resolves a symbolic
	link chain to its destination.
	* cvs.h: add prototype.

	* sanity.sh (basica-6.2, basica-6.3): changed match expressions to
	reflect new diff output.

	* rcs.c (make_file_label): generate labels for files that include
	the pathname so that output from "cvs diff" is useable by patch.
	Looks like I came up with the mods as Andy Piper
	<andyp@@parallax.co.uk>; his patch was on the Cyclic unofficial
	patches page.

	* sanity.sh: change remote access method from ext to fork.  This
	results in a significant speed improvement when running the
	testsuite.  The ext method on my machine (i586 120MHz Linux 2.0.35
	with TCP wrappers installed) runs in 450% of the time of the local
	method while the fork method runs in only 150% of the time of the
	local method!  Yow!  Am I SWAPPING yet?!
	(crerepos-6a, crerepos-6b): change to reflect different error
	messages for fork method.
	(modes-15): same.

	* client.c (connect_to_forked_server): new routine.
	(start_server): call the above when method is fork_method.

	* root.c: add a new method named "fork".  This method uses the
	remote protocol, but does so by forking a "cvs server" process
	directly rather than doing "rsh host cvs server" (for example).
	This new method has few advantages for day-to-day use, but has
	three important benefits for debugging:

	  1) Most secure installations these days don't allow rsh access.
	  With this new method, we can still test the remote protocol on
	  these machines because we don't need to be able to make a local
	  TCP connection.

	  2) Even if installations allow rsh access, they almost always
	  have TCP wrappers to check permissions by IP/hostname.  This
	  causes a short delay for every connection.  For invocations from
	  the command line, this doesn't matter much, but it adds up to a
	  significant amount of time when running the testsuite.

	  3) On machines that can't (or do not usually) provide rshd
	  access (I'm thinking of WNT/W95 in particular), we can now run
	  tests of the remote protocol using this method.  Indeed, we can
	  run remote protocol tests on any machine that has an
	  implementation of piped_child().

	(parse_cvsroot): handle new method.
	(error_exit, xstrdup, isabsolute): new stub functions to use when
	compiling root.c with the DEBUG option.
	(main): fix a few typos.
	* cvs.h (CVSmethod): add fork_method.

	* server.c (create_adm_p): use Emptydir as the placeholder
	directory instead of "." to avoid problems with "cvs update -d" et
	al.

1998-09-22  Noel Cragg  <noel@@swish.red-bean.com>

	* sanity.sh (devcom-180): fixed typo in regexp.

	* main.c (main): remove need_to_create_root and related code
	(including CVS_IGNORE_REMOTE_ROOT environment variable).  The
	current implementation (just removed) of rewriting the contents of
	the CVS/Root file isn't desirable for a number of reasons:

	  1) Only the top-level CVS/Root directory is updated.  If we're
	  really interested in pointing our WD at another CVSROOT, we
	  should have a separate command.

	  2) With the new multiroot mods, we don't ever want to rewrite
	  CVS/Root files in the way the removed code did.  Consider:

	    cvs -d repository1 co a
	    cd a
	    cvs -d repository2 co b
            cvs -d repository2 update b

	  The update command would rewrite the contents of a/CVS/Root to
	  the incorrect value.  Bad.  We then wouldn't be talking to the
	  correct repository for files in a.

	  3) The removed code seems to be a quick hack to support working
	  directories checked out from multiple repositories.  With the
	  CVS_IGNORE_REMOTE_ROOT variable set, one could perform commands
	  as in example 2, above, without worring about updating CVS/Root
	  files.  While in pre-1.10.1 recursive commands wouldn't handle
	  that working directory hierarchy, one could use commands like
	  "cvs foo -l" instead.  While not great, this allows you (with a
	  lot of manual interaction) to have a multiroot WD.  Since we now
	  have multiroot mods checked in, we don't need this code.

	(lookup_command_attribute): while we don't need the
	CVS_CMD_USES_WORK_DIR flag anymore (since it only was supporting
	the need_to_create_root code), I'm leaving it in.  It may come in
	handy at some later date.

1998-09-18  Jim Kingdon  <kingdon@@pennington.cyclic.com>

	* version.c: Advance version number to 1.10.2.1.

	* Version 1.10.2.

1998-09-13  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* client.c: Refuse to Copy-file to another directory
	* sanity.sh (client): New test, tests for this.

	* edit.c (editors_fileproc), watch.c (watchers_fileproc): Use
	cvs_output rather than writing to stdout.
	* sanity.sh (devcom): Use dotest for tests 178, 180, and 183
	(tests that we preserve existing behavior on "cvs editors").

	* commit.c (check_fileproc): Don't allow commits in Emptydir.
	* sanity.sh (emptydir-8): Test for this change in behavior.

	* sanity.sh: Add some compatibility tests to TODO comments at end.

1998-09-10  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* wrapper.c (wrap_add): Remove obsolete comment about -m.

	* server.c (server_updated): Check for error from CVS_UNLINK.

1998-09-09  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* server.c (serve_root): Allocate with malloc, not xmalloc.

	* root.c (set_local_cvsroot): Move memory allocation from here...
	* server.c (serve_root): ...to here.  Fixes error handling.

	* root.c (parse_cvsroot): Don't call check_root_consistent;
	parse_cvsroot is only used for local and client.
	* root.c (set_local_cvsroot): Move check_root_consistent
	functionality from here...
	* server.c (serve_root): ...to here.  Fixes error handling.  Also
	made the error more explicit, while I am at it.
	* server.c (Pserver_Repos): Now static.
	* cvs.h: Don't declare it.
	* root.c (check_root_consistent): Removed; no longer needed.
	* sanity.sh (pserver): New test, tests for this behavior and some
	other basic pserver stuff.

	* update.c (merge_file): Use cvs_output for "already contains the
	differences" message.  Found this one when I actually observed the
	out-of-order bug in Real Life(TM).

1998-09-09  Jim Kingdon

	* find_names.c (find_dirs): Make sure to zero errno before
	going around the loop again.
	* find_names.c (find_rcs): Make sure to set save_errno.
	(thanks to Alexandre Parenteau for reporting both problems).

1998-09-09  Jim Kingdon  <kingdon@@harvey.cyclic.com> and Michael Pakovic

	* edit.c (notify_do): Only free line if it is not NULL.

1998-09-07  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* cvs.h: dirs_sent_to_server should not be inside
	AUTH_SERVER_SUPPORT (reported by both Richard Levitte and Murray
	Bishop, thanks).

	* lock.c, cvs.h: New variable lock_dir.
	* parseinfo.c (parse_config): New option LockDir.
	* lock.c (lock_name): New function, abstracts out lock file naming
	and also supports LockDir.
	* lock.c (lock_simple_remove, Reader_Lock, write_lock, set_lock):
	Call it (6 places, to create/remove read/write/master locks).
	(Lock_Cleanup): Refuse to reenter this function.
	* sanity.sh (lockfiles): New test, tests for this feature.

1998-09-03  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* sanity.sh (multiroot): Expect ${TESTDIR} in output instead of
	assuming it is /tmp/cvs-sanity (thanks to Mark D. Baushke of Cisco).
	Clean up working directory when done (fixes apparent thinko).

	* server.c (create_adm_p): Fix one "return" which didn't return a
	value.
	(dirswitch): Check for errors from create_adm_p.

	* sanity.sh: Set LC_ALL rather than just LC_COLLATE.

Wed Sep  2 02:30:22 1998  Jim Kingdon  <kingdon@@pennington.cyclic.com>

	* version.c: Bump version number to 1.10.1.1.

	* Version 1.10.1.

1998-09-01  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	Administrative note regarding Noel's changes to allow one to
	switch from one CVS root to another in a single command: The
	ChangeLog entries for the changes which Noel just checked in
	appear for 1998-09-01, 1998-08-28, 1998-08-25, 1998-08-19, and
	1998-08-18, rather than being all together.

	* main.c (set_root_directory): Fix whitespace.
	(main): Nuke new -m option and just have that message controlled
	by -t.
	* server.c (server): Revert the CVS_SERVER_SLEEP code back the way
	it was in CVS 1.10.  Attaching to the parent process is relatively
	boring (you can just run "cvs server" under a debugger instead),
	but connecting to the child process is what the old code was for.
	* recurse.c, server.c: Remove DEBUG_NJC code.

1998-09-01  Noel Cragg  <noel@@swish.red-bean.com>

	* server.c (do_cvs_command): add another environment variable,
	CVS_SERVER_SLEEP2, after forking to pause the program so one can
	attach a debugger.

	* sanity.sh (crerepos): clean up crerepos-18 now that multiroot
	works in this case.
	(multiroot): finalize tests for local vs. remote operation.

	* recurse.c (start_recursion): near the beginning, save the list
	of directories to spoof as command-line arguments, if necessary.
	Use that list near the end and call send_file_names to send those
	arguments to the server.
	(do_argument_proc): removed, since we call send_file_names now.

	* main.c (main): re-initialize dirs_sent_to_server on each pass
	through the loop for each CVSROOT.

	* cvs.h: add proto for global variable which keeps track of which
	directories have been sent to the server when in client mode.

	* client.c (is_arg_a_parent_or_listed_dir): new function.
	(arg_should_not_be_sent_to_server): new function.  Tries to decide
	whether the given argument should be sent to the server, based on
	the current CVSROOT and the list of directories sent to the
	server.
	(send_repository): add the directory name to the list of
	directories sent to the server.
	(send_file_names): call arg_should_not_be_sent_to_server.

	* add.c (add): switch the order of send_files and send_file_names
	to make multiple repository support possible.  send_files needs to
	create a list of directories being requested so that
	send_file_names can decide which command-line arguments to send to
	the server for the given current CVSROOT.
	* admin.c (admin): same.
	* commit.c (commit): same.
	* diff.c (diff): same.
	* edit.c (editors): same.
	* log.c (cvslog): same.
	* rcs.c (annotate): same.
	* remove.c (cvsremove): same.
	* status.c (cvsstatus): same.
	* tag.c (cvstag): same.
	* update.c (update): same.
	* watch.c (watch_addremove): same.
	(watchers): same.

1998-08-31  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* sanity.sh: Remove "debug" function; it was apparently checked
	in accidentally by Norbert Kiesel's change.

1998-08-31  Norbert Kiesel  <nk@@iname.com>

	* release.c (release): modify last patch to release so that
	save_cwd is called only once and restore_cwd is always called when
	neccessary.  Also fixed a tiny memory leak.

	* sanity.sh (release): added some more tests for "cvs release"
	including a test with two dirs and a "no" for the first one (which
	fails without the above patch).

1998-08-28  Noel Cragg  <noel@@swish.red-bean.com>

	* sanity.sh (crerepos-18): add new comment and change test
	slightly to support multiroot.
	(multiroot): add more tests.

	* server.c (create_adm_p): new function.
	(dirswitch): call create_adm_p.  Modify the code to always write a
	new CVSADM_REP file, since create_adm_p might have put a
	placeholder there and our value is guaranteed to be correct.
	(server): move the CVS_SERVER_SLEEP check here so we can debug
	things at an earlier stage.

	* recurse.c (start_recursion): add large comment about the ideal
	solution to the "Argument xxx" problem.

	* main.c (main): move position of debugging comment for -m flag.

	* diff.c (diff): clear a static variable.

	* client.c (send_file_names): check to see if we should send this
	argument to the server based on the contents of the appropriate
	CVSADM directory.  This avoids "nothing known about foo" messages
	and problems with duplicate modules names in multiple
	repositories.
	(send_a_repository): change method of calculating toplevel_repos
	to support multiple CVSROOTs.
	(start_server): clear some static variables.

1998-08-28  Jim Meyering  <meyering@@ascend.com>

	* sanity.sh (basicc-8, basicc-11): Use `.*' instead of explicit
	`Operation not permitted'.  Solaris2.5.1 gets a different error:
	`Invalid argument'.

1998-08-26  Eric M. Hopper

	* sanity.sh: Set LC_COLLATE to "C".

1998-08-25  Noel Cragg  <noel@@swish.red-bean.com>

	* sanity.sh (multiroot): new set of tests to check the behavior of
	multiroot.

	* diff.c (diff): set options value to NULL after freeing to reset
	the state for the next time around.

1998-08-25  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	Fix problems with trying to rename an open file:
	* rcs.c, rcs.h (RCS_setattic): New function.
	* commit.c (remove_file, checkaddfile): Call it.

1998-08-24  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* release.c (release): Use save_cwd and restore_cwd to get back to
	where we started, rather than hoping that CVS_CHDIR ("..") will do
	something useful.  This removes the need for most of
	release_delete, so remove that function and inline what is left.
	* sanity.sh (basicc): Adjust tests for this fix, also some tests
	with multiple arguments to "cvs release" (in the non-"-d"-case, it
	would seem like the old code would CVS_CHDIR into directories and not
	CVS_CHDIR back, but I'm not going to investigate this and it
	should be a moot point with this fix.).

	* sanity.sh (basicc): Add tests for a serious bug in "cvs release
	-d .".

	More error handling fixes:
	* ignore.c (ignore_files): Check for errors from opendir and
	readdir.
	* find_names.c (Find_Names): Check for errors from find_rcs.
	(find_rcs, find_dirs): Comment error handling better; also return
	an error if we got one from readdir.
	* filesubr.c (deep_remove_dir): Also check for errors from readdir.
	* import.c (import_descend): Print message on error from opendir
	or readdir.
	* commit.c (remove_file): Check for errors from CVS_MKDIR and
	CVS_RENAME.
	(remove_file): No need to remove the file in the temporary
	directory; server.c now informs time_stamp_server of what is going
	on via CVS/Entries rather than a file with a kludged up timestamp.
	* client.c, entries.c, login.c, logmsg.c, mkmodules.c, patch.c,
	remove.c, update.c: Check for errors from unlink_file.
	* mkmodules.c (write_dbmfile, rename_dbfile, rename_rcsfile):
	Check for errors from fclose, CVS_RENAME, and CVS_STAT.
	* mkmodules.c (checkout_file): Clarify error handling convention.
	* mkmodules.c (mkmodules): Call checkout_file accordingly.
	* entries.c (Entries_Open): Check for errors from fclose.

1998-08-21  Ian Lance Taylor  <ian@@cygnus.com>

	* import.c (import): Output suggested merge command using
	cvs_output_tagged rather than just cvs_output.  Don't put
	CVSroot_cmdline in the log file.
	* client.c (importmergecmd): New static struct.
	(handle_mt): Handle +importmergecmd tag.
	* sanity.sh (import): Use an explicit -d in importb-2, to test
	whether it is reported in the suggested merge command.

1998-08-20  Ian Lance Taylor  <ian@@cygnus.com>

	* sanity.sh (import): Rewrite tests to use dotest.

1998-08-20  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* sanity.sh: Add comments about binary files and cvs import.

1998-08-19  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* sanity.sh (importc): Use ${username} in one place where I had
	missed it.

	Make import -d work client/server:
	* client.c, client.h (client_process_import_file): Take new
	argument, for whether -d is specified, and send Checkin-time
	request if it is set.
	* import.c (import_descend): Pass it.
	* main.c, cvs.h (date_to_internet): New function.
	* server.c (server_modtime): Call date_to_internet.
	* server.c (serve_checkin_time): New function.
	(requests): Add "Checkin-time" request.
	(serve_modified): If it was sent, set the timestamp in the
	temporary directory.
	* import.c (import): If the client sends a -d option, complain.
	(import): For the server, always use the timestamps from the temp
	directory.
	(import): Don't send a -d option to the server.
	* sanity.sh (importc): Add tests for import -d.

Wed Aug 19 15:19:13 1998  Larry Jones  <larry.jones@@sdrc.com>

	* sanity.sh (unedit-without-baserev-5): use ${DOTSTAR} instead
	of .* since we expect to match multiple lines.

1998-08-19  Ian Lance Taylor  <ian@@cygnus.com>

	* cvs.h (CVSroot_cmdline): Declare.
	* root.c (CVSroot_cmdline): Define.
	* main.c (main): Set CVSroot_cmdline if the -d option is used.
	* import.c (import): If CVSroot_cmdline is not NULL, then mention
	an explicit -d option in the suggested merge command line.

Wed Aug 19 00:28:50 1998  Noel Cragg  <noel@@swish.red-bean.com>

	* recurse.c (do_dir_proc): don't muck with CVS/Root directories
 	when running in server mode.
	(do_recursion): same.

	* main.c (main): add the command-line option `m' to help debug the
 	multiroot environment; it prints out the value of CVSROOT for each
 	iteration through the main loop.  Also, changed the main loop so
 	that it gets executed only once when running in server mode (the
 	server will only deal with a single CVSROOT).

	* recurse.c (do_recursion): change default for
 	PROCESS_THIS_DIRECTORY to true; we should always process a
 	directory's contents unless there's an existing CVS/Root file with
 	a different root than the current root to tell us otherwise.
	(do_dir_proc): same.

Tue Aug 18 14:30:59 1998  Noel Cragg  <noel@@swish.red-bean.com>

	* recurse.c (do_recursion): check the current value of CVS/Root
 	and add it to our list of CVSROOTs if it doesn't exist.  Decide
 	whether or not to process files in this directory based based on
 	the value of CURRENT_ROOT.
	(do_dir_proc): same.

	* main.c: add two new globals -- root_directories and current_root
 	-- which keep track of the values of CVSROOT we've seen and which
 	value of CVSROOT we're currently processing.
	(main): put the main loop for stepping through cvsroot values
 	here, since we might need to send command-specific arguments for
 	every unique non-local cvsroot.  Moved blocks of code around so
 	that one-time initializations happen first (outside the loop) and
 	the other stuff happens inside the loop.
	(set_root_directory): helper function.

	* cvs.h: add prototypes for root_directories and current_root, two
 	new globals for keeping track of multiple CVSROOT information.

1998-08-18  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* sanity.sh: Don't assume that the shell leaves $^ unexpanded in
	an unquoted here-document (suggested by Bart Schaefer to help when
	zsh is the shell).

1998-08-17  Ian Lance Taylor  <ian@@cygnus.com>

	* commit.c (checkaddfile): Don't call fix_rcs_modes.
	(fix_rcs_modes): Remove.

1998-08-16  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* create_adm.c (Create_Admin): Don't condition traces on
	SERVER_SUPPORT; SERVER_SUPPORT shouldn't do (much of) anything
	independent of server_active.

	* sanity.sh (binfiles3): New test, for yet another binary file
	bug (sigh).  Thanks to Jason Aten for reporting this one.

1998-08-15  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* rcscmds.c (call_diff_write_output): Update to reflect new
	calling convention for the write_output callback.

1998-08-15  Jim Meyering  <meyering@@ascend.com>

	* update.c (merge_file): Warn about failed unlink when not due
	to ENOENT.

	* server.h (CLIENT_SERVER_STR): New macro
	* create_adm.c (Create_Admin): Use it.
	* entries.c (Scratch_Entry, Register): Use it.
	* filesubr.c (copy_file, xchmod, rename_file, unlink_file): Use it.
	* history.c (history_write): Use it.
	* modules.c (do_module): Use it.
	* no_diff.c (No_Difference): Use it.
	* run.c (run_popen): Use it.
	* server.c (server_register): Use it.

1998-08-14  Jim Meyering  <meyering@@ascend.com>

	* hardlink.c (lookup_file_by_inode): Use existence_error rather than
	comparing errno to ENOENT directly.

	* client.c (copy_a_file): Unlink destination before doing copy.
	* sanity.sh (join-readonly-conflict): New test for this -- it would
	fail only in client/server mode.

	* sanity.sh (rcsmerge-symlink-4): Don't use `test -L', it's not
	portable.  Instead, match against the output of `ls -l'.
	(dotest tag8k-16): Simplify tag-construction code and at the same
	time, avoid using expr's `length' and `substr' operators.  Not
	all versions of expr support those.

1998-08-14  Jim Kingdon  <kingdon@@harvey.cyclic.com>

	* version.c: Bump version number to 1.10.0.1.

d70 1
a70 1

d77 1
a77 1

@


1.1.1.16
log
@Latest version from Cyclic
@
text
@a0 449
1999-07-28  Eric Sink   <eric@@sourcegear.com>

	* sanity.sh: before running basicc-11, we need to see if
	the cwd has been deleted (by basicc-8).  If so, we
	recreate it to allow basicc-11 to proceed.  This may be
	something that only happens under the Linux 2.2 kernel.

1999-07-18  Karl Fogel  <kfogel@@floss.red-bean.com>

	* edit.c (notify_do): chop newline, if any, from the value
	obtained from CVSROOT/users.  Otherwise it just gets passed along
	in the argument to the notification program (usually mail), which
	will misinterpret it as signifying the end of the command.

1999-07-19  Larry Jones  <larry.jones@@sdrc.com>

	* rcs.c (RCS_delete_revs): In the WIN32 kludge, be sure that the result
	of RCS_getexpand is not NULL before trying to use what it points to.
	(Patch submitted by Timothy L. Taylor <ttaylor@@mitre.org>.)

1999-07-16  Tom Tromey  <tromey@@cygnus.com>

	* admin.c (admin): Allow `-k' options to be used unrestricted.

1999-06-23  Jim Kingdon  <http://www.cyclic.com>

	* sanity.sh (symlinks2): New test, for symlinks in working
	directory without PreservePermissions.  This test (modulo a few
	details not relevant to testing whether we are following symlinks)
	worked remote as of now, or either remote or local for CVS 1.9.
	* subr.c (get_file): Revert 1998-02-15 change to special-case
	symlinks.  This makes the above test work local too.
	* rcs.c (RCS_checkin): Move the logic to handle special-case
	symlinks (and other files other than regular files) here, and make
	it only happen if PreservePermissions is on.

1999-06-18  Larry Jones  <larry.jones@@sdrc.com>

	* sanity.sh (devcom3-9a): Be less specific about the expected
	error message (BSD/OS 4.0 has a bug that can cause exec* to fail
	with EACCES instead of ENOENT).

1999-06-08  Larry Jones  <larry.jones@@sdrc.com>

	* sanity.sh (diff-4, dirs2-10, tagf-13, importc-7, conflicts2-142b8):
	Use ${PROG} instead of "cvs".

1999-06-05  Jim Kingdon  <http://www.cyclic.com>

	* recurse.c (do_recursion, do_dir_proc): Make the SERVER_ACTIVE
	#ifdef be only around the check for server_active.  Modulo a few
	cosmetic tweaks, same as a patch submitted by Johannes Stezenbach
	of propack-data.de.

1999-06-01  Jim Kingdon  <http://www.cyclic.com>

	* sanity.sh: Add comment about rcs2-7 failures on certain days.

	Make "cvs status -v" on a removed file work:
	* status.c (cvsstatus): Reindent the client code.
	(status_fileproc): Don't need a CVS/Entries listing to show the
	tags.
	* sanity.sh (rmadd2): New test rmadd2-16 tests the existing
	behavior with "cvs log"; new test rmadd2-17 tests the new behavior
	with "cvs status".

	* sanity.sh (basicc): To match no output in dotest, put the empty
	regexp first.  Remove tests which check that first-dir exists,
	since that isn't true in the case where the OS let us delete it.
	(dotest_internal): Fix so that things work with two regexps, with
	an empty one first.

1999-05-28  Larry Jones  <larry.jones@@sdrc.com>

	* sanity.sh (server-4): Replace bogus directory with real one since
	the server now checks it.

1999-05-27  Jim Kingdon  <http://www.cyclic.com>

	* sanity.sh (spacefiles): Clean up -c, top, and -b at end.
	(spacefiles, files): Fix bad references to CVSROOT_DIRNAME.

	Fix two problems pointed out by Olaf Kirch of swb.de/caldera.de:
	* server.c (outside_root): New function, contains expanded version
	of code from serve_directory.
	(serve_directory): Call outside_root.
	(outside_dir): New function
	(serve_modified, serve_is_modified, serve_notify,
	serve_questionable, serve_unchanged): Call outside_dir.
	* sanity.sh (server2): New tests, for these fixes.

1999-05-26  Jim Kingdon  <http://www.cyclic.com>

	* cvs.h, subr.c (xmalloc): Return void* not char*, like xrealloc
	has done for some time.
	* modules.c (do_module): If we find the module as a directory/file
	(rather than in the modules file), skip a bunch of processing
	which was unnecessary and also broken in most of the cases
	now tested for by the spacefiles sanity.sh test.
	* sanity.sh (spacefiles): New test, for specifying filenames
	(containing spaces, or starting with '-', or starting with '/') to
	"cvs co".

1999-05-25  Jim Kingdon  <http://www.cyclic.com>

	* client.c (update_entries): Make the old DONT_USE_PATCH code the
	only code.  This means that if people are still on CVS 1.9
	servers, then CVS will fall back to transferring entire files.
	This is better than looking for an external "patch" program which
	causes no end of troubles (especially on Windows, but someone just
	posted to info-cvs about a problem with the Solaris patch).  (This
	change was run by devel-cvs and feedback was positive).

	* subr.c (xmalloc, xrealloc): The new error.c does not support
	%lu; use sprintf instead.

1999-05-25 Derek Price
	<http://www-personal.engin.umich.edu/~oberon/resume.html>

	* sanity.sh (server): Escaped a few more newlines in
	another awk script.  Solaris awk still don't like 'em.

1999-05-25 Derek Price
	<http://www-personal.engin.umich.edu/~oberon/resume.html>
	and Jim Kingdon

	* log.c: Remove comment which said "you can delete [this line]"
	and which stuck around for over 3 years.
	* sanity.sh (errmsg2 & tagdate): Added tests to prove the
	current functionality with respect to combining -r and -D.

1999-05-20  Larry Jones  <larry.jones@@sdrc.com>

	* server.c (pserver_authenticate_connection): Previous changes
	broke verify_and_exit (reported by Robert Fitzsimons, thanks).
	* sanity.sh (pserver): New tests pserver-7 and pserver-8 for this.

1999-05-18 Derek Price
	<http://www-personal.engin.umich.edu/~oberon/resume.html>

	* sanity.sh (keyword2): Escaped a newline in an awk script.
	Apparently Solaris awk don't like 'em.

1999-05-18  Jim Kingdon  <http://www.cyclic.com>

	* sanity.sh (basicc): Allow the behavior whereby unlink(".")
	succeeds.  Reported by Jeremy Buhler and Pavel Roskin.

1999-05-17  Steve Cameron of Compaq

	* sanity.sh: Modified to no longer use "test -e" for existence
	test as it has turned out to be not portable enough.  Instead use
	"test -f", "test -d", etc.
	[SCO Unixware 7 apparently doesn't always support it -kingdon]

1999-05-17  Jim Kingdon  <http://www.cyclic.com>

	* version.c: Push version number to 1.10.6.1.

	* version.c: Version 1.10.6.

1999-05-16  Jim Kingdon  <http://www.cyclic.com>

	* update.c (patch_file): When we are passing vn_rcs to
	RCS_checkout, pass vn_tag as well.
	* sanity.sh (keyword): In test keyword-22, test for the fixed
	behavior rather than the buggy behavior.  Adjust keyword-23.  Add
	test keyword-24, to see whether keyword-23 really worked.

1999-05-12  Larry Jones  <larry.jones@@sdrc.com>

	* sanity.sh (pserver-4, pserver-5): Bogus error messages from
	non-root initgroups on some 4.4BSD derived systems now show up
	in different places in the output.

1999-05-12  Jim Kingdon  <http://www.cyclic.com>

	* import.c (import): Don't allow the user to supply a repository
	directory which takes us out of the cvsroot.
	* sanity.sh (importc): New tests importc-10 to importc-12, for this.

1999-05-11  Larry Jones  <larry.jones@@sdrc.com>

	* server.c (serve_notify): Allocate enough memory to hold the
	"misformed Notify request" message in pending_error_text.

1999-05-11  Jim Kingdon  <http://www.cyclic.com>

	* server.c (switch_to_user): Ignore EPERM from initgroups.  Fixes
	pserver-4 in testsuite.
	(pserver_authenticate_connection): Only print "I LOVE YOU" after
	switch_to_user has come back successfully.

	* server.c (pserver_authenticate_connection): Call error_exit
	rather than reinventing the wheel ourselves.
	(switch_to_user): Check for errors from setuid, setgid, and
	initgroups.  Fix the #ifdef's (the previous code would skip the
	setuid call if SETXID_SUPPORT).

1999-05-10  Jim Kingdon  <http://www.cyclic.com>

	* server.c (serve_notify), edit.c (notify_do): Check for
	and reject characters which will get confused with delimiters.
	* sanity.sh (server): New tests server-7 through server-15 test
	for this and for other notify behaviors.

	* rcs.c (RCS_tag2rev): Also look for a physical branch with
	RCS_getversion.
	* sanity.sh (tagf): Adjust tagf-12 and following tests to test for
	the fixed behavior rather than the broken behavior.

1999-05-07  Jim Kingdon  <http://www.cyclic.com>

	* server.c (server_notify): Also set last_node to NULL.
	* sanity.sh (server): New tests server-6 and server-7, for this.

1999-05-05  Jim Kingdon  <http://www.cyclic.com>

	* rcs.c (rcs_internal_lockfile): Remove unused variable lockfile.

	* add.c (add): Look for directories with the same name in a
	different case where appropriate (analogous to fopen_case).
	In client code, add comment about how this doesn't do quite
	everything.

1999-05-03  Jim Meyering  <meyering@@ascend.com>

	Remove rcs-style ,file, lock files upon signal.
	* rcs.c (rcs_lockfile): New file-scoped global.
	(rcs_cleanup): New function (similar to patch_cleanup).
	(rcs_internal_lockfile): Register rcs_cleanup the first time this
	function is called.  Rename uses of local `lockfile' to refer to new
	global, `rcs_lockfile'.  Don't free the lock file name string, now
	that it's global.
	(rcs_internal_unlockfile): Rename `lockfile', as above, and carefully
	free and NULL-out the global, rcs_lockfile.

1999-04-30  Jim Kingdon  <http://www.cyclic.com>

	* rcs.c (annotate_fileproc): Don't cast NULL in passing it to
	RCS_deltas.  Because there is a prototype in scope the cast is
	unnecessary (per HACKING's ANSI C or SunOS4 rule), and in fact it
	was causing failures on UNICOS because it cast to size_t instead
	of size_t*.  (Thanks to Dean Kopesky for reporting this).

1999-04-29  Jim Kingdon  <http://www.cyclic.com>

	* sanity.sh: If invoked without any arguments, print a usage
	message (thanks to Pavel Roskin for a report/patch).

	* run.c (piped_child): Make the error messages more verbose.
	(close_on_exec): Reindent.
	* sanity.sh (devcom3): Several errors are possible in devcom3-9a.
	Adjust for change to piped_child error message.

1999-04-28  Jim Kingdon  <http://www.cyclic.com>

	* sanity.sh (devcom3): Add some tests of the CVS/Notify file and
	disconnected "cvs edit".

	* main.c (opt_usage): Remove -b.

1999-04-20 Derek Price
	<http://www-personal.engin.umich.edu/~oberon/resume.html>

	* rcs.c (RCS_delete_revs):  RCS_delete_revs uses an
	RCS_checkout call to get a new copy of a revision to be
	used internally after old revisions were deleted and it was
	performing keyword substitutions.  This munged all the
	the revisions of the file on the branch containing the
	deleted revisions and its sub-branches, as the original they
	were being patched from was incorrect.  Corrected this by
	passing in "-ko" as an option to RCS_checkout.
	* sanity.sh (keywordlog):  modified this test to verify the
	correct behavior of 'cvs admin -o'.
	[Fixed use of \$ in keywordlog test; added code in RCS_delete_revs
	to abort on binary file on Windows -kingdon]

1999-04-21  Derek Price
	<http://www-personal.engin.umich.edu/~oberon/resume.html>
	and Jim Kingdon

	* tag.c (tag_check_valid): A bug was causing CVS to spin
	indefinately when -j:<date> was specified.  CVS now returns
	an error.
	* sanity.sh: Added a test (tagdate-12) to test this.

1999-04-19  Jim Kingdon  <http://www.cyclic.com>

	* sanity.sh (backuprecover): Clean up the repository at the end.

1999-04-18  Derek Price
	<http://www-personal.engin.umich.edu/~oberon/resume.html>

	* sanity.sh added a test (backuprecover) to test cvs behavior
	with a repository that is out of date relative to the
	developer's workspaces.
	[Fix --keep code; move test to "Repository Storage" section since
	it doesn't really exercise the diff/diff3 library. -kingdon]

1999-04-13  Derek Price
	<http://www-personal.engin.umich.edu/~oberon/resume.html>

	* sanity.sh (diff):  Tests to verify correct operation of
	the --ifdef parameter to cvs diff.
	[indentation fixed -kingdon].

1999-04-13  Derek Price
	<http://www-personal.engin.umich.edu/~oberon/resume.html>
	for Noah Friedman  <friedman@@splode.com>

        * diff.c (diff): Put "--ifdef=" in opts string, not "-D"; the
        latter is confused by pserver for a date spec.

1999-04-14  Jim Kingdon  <http://www.cyclic.com>

	* fileattr.h: Adjust comments to reflect the official version of
	the fileattr format now being in cvs.texinfo.

1999-04-05  Jim Kingdon

	* sanity.sh (watch5): Remove nonstandard --keep code.  Don't pass
	-f to rm when cleaning up (that tends to mask bugs).  Add watch5
	to list of tests at start.  Add comment explaining why we consider
	the behavior we test for the right one.  Rename a few tests which
	had been erroneously named watch6* instead of watch5*.
	* client.c (update_entries): Add comment with brief discussion of
	whether there is a better way.

1999-04-05  Derek Price
	<http://www-personal.engin.umich.edu/~oberon/resume.html>

	* client.c (update_entries):  Only call mark_up_to_date
	(which deletes the CVS/Base/<filename> file for watched
	and edited files) on commit.
	* sanity.sh:  Make sure the CVS/Base/<filename> file for
	a watched and edited file is not removed on a status or
	update of a touched/unmodfied file.

1999-03-30  Larry Jones  <larry.jones@@sdrc.com>

	* client.c (get_responses_and_close), commit.c (commit),
	update.c (do_update): If the sleep(1) call returns prematurely
	(due to the way wakeup is scheduled or receiving a signal), do
	it again.

1999-03-26  Jim Kingdon  <http://www.cyclic.com>

	* server.c (server): Add comment about Gzip-stream vs. RQ_ROOTLESS.

	* sanity.sh (modules3-11b): Adjust exact text of error message to
	reflect 1999-03-24 change to dirswitch.

1999-03-25  Jim Kingdon  <http://www.cyclic.com>

	* admin.c (admin): Make argument to -e optional, to match the
	documentation.
	* sanity.sh (admin-19a-2): Test for this.

	* server.c (serve_root): Update comment about checking for missing
	Root request.

1999-03-24  Jim Kingdon  <http://www.cyclic.com>

	* server.c (dirswitch): Also check dir here, similar to
	what server_pathname_check does for other cases.
	* sanity.sh (files): Adjust files-14 to test for this.

1999-03-24  Derek Price
	<http://www-personal.engin.umich.edu/~oberon/resume.html>
	and Jim Kingdon

	* sanity.sh: added a test (files-13) to test .. indirection
	in a path and another (files-14) to make sure we still fail
	out when the '..' indirection takes us into the $CVSROOT
	directory or beyond.

1999-03-24  Larry Jones  <larry.jones@@sdrc.com>

	* rcs.c: Change enum constants ADD and DELETE to something less
	likely to run into conflicts.

1999-03-21  Jim Kingdon  <http://www.cyclic.com>

	* sanity.sh (tagf): New test, tests for moving a branch tag to a
	non-branch tag and trying to recover.

1999-03-12  Jim Kingdon  <http://www.cyclic.com>

	* sanity.sh (branches): Tweak test branches-5 to test the case in
	which one modifies a file and then branches it.

1999-03-09  John Bley of duke.edu

	* mkmodules.c (filelist): Missed a NULL in this struct (should
	have 3 members, only had 2).

1999-03-07  Jim Kingdon  <http://www.cyclic.com>

	* sanity.sh (Index): Rename new test from rm_CVS/Root to rmroot
	(we don't have a formal rule about funky punctuation in test names
	but both underscore and a slash is too funky for me :-)).
	Reindent a few tests which were off.

	* root.c: Remove the sentence which had the improper English;
	there isn't really a need for that sentence and it isn't
	particularly accurate any more.

1999-02-27  Derek Price
	<http://www-personal.engin.umich.edu/~oberon/resume.html>

	* sanity.sh:  Added rm_CVS/Root test to test that CVS uses
	$CVSROOT rather than dumping core when running remotely and
	the admin file CVS/Root is deleted from the workspace.

	Also, altered a few 'cvs commit' 's in regular expressions to
	fit the .${PROG} commit. portability syntax.

	* recurse.c:  Stopped CVS from dumping core in the case tested
	above.

	* root.c:  Fixed somebody's improper english.

1999-02-25  Larry Jones  <larry.jones@@sdrc.com>

	* sanity.sh (keyword2-12): Use ${QUESTION} instead of ? in the
	expected result.

1999-02-24  Jim Kingdon  <http://www.cyclic.com>

	* sanity.sh (keyword2): Restore the original \\\$ instead of $.
	The latter ends up working due to various kludgy semantics in the
	shell and regular expressions, but the former is cleaner.

	* sanity.sh (keyword2): Protect keywords against accidental
	expansion in sanity.sh itself (most occurrences had this, but not
	all).

1999-02-23  Derek Price  <http://www.cyclic.com>
	and Jim Kingdon.

	* sanity.sh (keyword2): New test, tests for merging with -kk.

1999-02-22  Jim Kingdon  <http://www.cyclic.com>

	* version.c: Ease version number to 1.10.5.1.

	* version.c: Version 1.10.5.

@


1.1.1.17
log
@Latest from Cyclic Software
@
text
@a0 1101
2000-09-19  Larry Jones  <larry.jones@@sdrc.com> 

	* version.c: Version 1.11.

2000-09-07  Larry Jones  <larry.jones@@sdrc.com>

	* Makefile.in: Use @@bindir@@, @@libdir@@, @@infodir@@, and @@mandir@@
	from autoconf.

2000-08-23  Larry Jones  <larry.jones@@sdrc.com>

	* mkmodules.c (init): Create an empty val-tags file if it doesn't
	already exist to avoid problems with users not having sufficient
	permissions to create it later.

2000-09-06  Jim Kingdon  <jkingdon@@dhcp-net200-89.su.valinux.com>

	* main.c (lookup_command_attribute): Add "release" to commands
	which can be done by a read-only user.

2000-08-23  Larry Jones  <larry.jones@@sdrc.com>

	* repos.c (Name_Repository): Use pathname_levels to detect attempts
	to get above the repository instead of checking for leading ..
	which isn't reliable.
	* sanity.sh (multiroot3-12 to multiroot3-15): New tests for above.

2000-08-21  Larry Jones  <larry.jones@@sdrc.com>

	* rcs.c (expand_keywords): Handle the unusual case of log == NULL.
	(Reported by Craig Metz <cmetz@@inner.net>.)

2000-08-01  Larry Jones  <larry.jones@@sdrc.com>

	* subr.c (pathname_levels): Fix bug that miscounts adjacent
	slashes.
	(Patch submitted by Tanaka Akira <akr@@m17n.org>.)

	* loginc.c (login): If available, use getpassphrase instead of
	getpass to support long passwords on Solaris.

2000-07-28  Larry Jones  <larry.jones@@sdrc.com>

	* server.c (server_noop): Avoid do_cvs_command() overhead.
	(requests): Make noop RQ_ROOTLESS.

2000-07-27  Noel Cragg  <noel@@red-bean.com>

	* root.c (parse_cvsroot): change fork method to behave like other
	remote methods -- let the server check that the repository
	directory is an absolute pathname.

2000-07-27  Larry Jones  <larry.jones@@sdrc.com>

	* lock.c (set_lock): Include actual lock directory in error message.
	* sanity.sh (multiroot3-10): Change to match.

	* sanity.sh (client-3): Allow for a potential "broken pipe".

2000-07-26  Larry Jones  <larry.jones@@sdrc.com>

	* commit.c (commit_filesdoneproc): Flush stdout before running script.
	* modules.c (do_module): Ditto.
	* update.c (update_dirleave_proc): Ditto.
	* server.c (do_cvs_command): Give input from the protocol pipe
	precedence over input from stdout/stderr.  There's no particularly
	good justification for this other than helping to avoid out-of-order
	messages in sanity.sh.

	* admin.c (admin_usage): Add the supported options.

	* sanity.sh (info): Try to avoid out-of-order messages.

	* sanity.sh (info): Fix problems when running twice in a row.

2000-07-17  Larry Jones  <larry.jones@@sdrc.com>

	* sanity.sh (modules5-7, cvsadm-1e, emptydir-2): Allow for a nil
	commit (can happen if the test is run twice in a row).

2000-07-19  Pavel Roskin  <proski@@gnu.org>
	and Larry Jones  <larry.jones@@sdrc.com>

	* mkmodules.c (config_contents): Add a commented out example for
	LockDir. Don't suggest PreservePermissions unless it's enabled.

2000-07-17  Larry Jones  <larry.jones@@sdrc.com>

	* login.c (get_cvs_password): Handle malformed ~/.cvspass more
	gracefully.

2000-07-12  Larry Jones  <larry.jones@@sdrc.com>

	* sanity.sh (modules5): New tests for module programs.

2000-07-11  Larry Jones  <larry.jones@@sdrc.com>

	* filesubr.c (copy_file, xcmp): Handle systems (like Plan 9) that
	don't support mknod() and/or st_rdev.
	* import.c (add_rcs_file): Ditto.
	* rcs.c (RCS_checkout, RCS_checkin): Ditto.
	* update.c (special_file_mismatch): Ditto.

2000-07-10  Larry Jones  <larry.jones@@sdrc.com>

	* zlib.c (gunzip_and_write): Fix type clashes.

	* main.c (main): Remove unused variables.

2000-07-10  Jim Meyering  <meyering@@lucent.com>

	When a command like `cvs update -kk -jT1 -jT2' creates a new file
	(because it had the T2 tag, but not T1), the subsequent commit of
	that just-added file would effectively set the admin `-kk' option
	for that file in the repository.

	* update.c (join_file): Rename global-shadowing local `options'
	to `t_options'.
	Set file-scoped global `options' to NULL just before
	check-out.
	* sanity.sh (join-admin): New test for this.

2000-07-08  Larry Jones  <larry.jones@@sdrc.com>

	* version.c, cvs.h (version): New function.
	* main.c (cmds[]): Add version command to invoke it.
	(main): Also use it in -v.
	* server.c (serve_version): New function.
	(requests[]): Add version command to invoke it.

2000-07-06  Karl Fogel  <kfogel@@red-bean.com>

	* sanity.sh (pserver-14): remove this test for portability
	reasons (it was only recently added for the 2000-07-04 change).

2000-07-06  Larry Jones  <larry.jones@@sdrc.com>

	sanity.sh (modules-148): Don't test for specific revisions.

	* main.c (main): Catch SIGABRT to try to clean up after assertion
	failures.  Don't bother SIG_register'ing Lock_Cleanup because
	main_cleanup calls it indirectly anyway.
	* patch.c (patch): Catch SIGABRT.
	* rcs.c (rcs_internal_lockfile): Ditto.
	* server.c (server): Ditto.

	* fileattr.c (fileattr_write): Don't delete the unrecog_head list
	when writing...
	(fileattr_free): Delete it when freeing!

2000-07-05  Larry Jones  <larry.jones@@sdrc.com>

	* admin.c (admin): Handle -t in client so reading from files works
	correctly in client/server mode.
	* sanity.sh (log2): Update to match.

2000-07-04  Karl Fogel  <kfogel@@red-bean.com>

	* server.c (pserver_authenticate_connection): use new
	getline_safe() during authentication phase, to avoid a
	denial-of-service attack in which client sends arbitrary
	amounts of data with no newlines.
	(Reported by <jpmg@@eng.cam.ac.uk>.)

	* sanity.sh: new test pserver-14 for above.

	* myndbm.c: #include getline.h.
	(mydbm_load_file): pass new GETLINE_NO_LIMIT flag to getstr().

2000-07-03  Larry Jones  <larry.jones@@sdrc.com>

	* sanity.sh (modules): Rewrite using dotest.  Add "modules-"
	prefix to test names.

2000-06-28  Larry Jones  <larry.jones@@sdrc.com>

	* error.c (error_exit): Call rcs_cleanup () to release any rcs locks.
	* rcs.c, rcs.h (rcs_cleanup): Make public, close file before trying
	to remove (some systems won't remove open files).
	(RCS_putdtree): Don't worry about cleaning up before call error
	since it now does it for us.
	(rcs_internal_lockfile, rcs_internal_unlockfile): Keep track of
	lock file fd for rcs_cleanup ().

	* client.c (handle_set_checkin_prog, handle_set_update_prog):
	Just ignore the request when exporting.

2000-06-27  Larry Jones  <larry.jones@@sdrc.com>

	* create_adm.c, cvs.h (Create_Admin): Add dotemplate argument.
	Change all callers.
	* checkout.c (checkout_proc): Don't create CVS/Template if
	exporting.

2000-06-26  Pavel Roskin <proski@@gnu.org>
	and Larry Jones  <larry.jones@@sdrc.com>

	* server.c (switch_to_user): Only set CVS_Username if
	AUTH_SERVER_SUPPORT is defined.

2000-06-23  Larry Jones  <larry.jones@@sdrc.com>

	* client.c (send_dirent_proc): Don't allocate ignlist if you're
	going to skip the directory (plugs memory leak).
	(send_dirleave_proc): New function.
	(send_files): Use it (plugs memory leak).
	* root.c (root_allow_free): Plug memory leaks.
	* server.c (serve_directory, serve_notify, check_password,
	pserver_authenticate_connection): Ditto.
	* update.c (update): Ditto.

	This completes the memory leak shoot-out -- the Purify'ed version
	of CVS now runs the entire test suite, both local and remote (except
	for remote crerepos, which causes Purify to choke) with *no* memory
	leaks.

	* server.c (pserver_authenticate_connection): Don't free null pointer.

2000-06-21  Larry Jones  <larry.jones@@sdrc.com>

	* client.c (update_entries, get_responses_and_close): Plug memory leaks.
	* commit.c (find_fileproc, commit): Ditto.
	* import.c (import): Ditto.
	* log.c (cvslog): Ditto.
	* recurse.c (start_recursion): Ditto.
	* remove.c (cvsremove): Ditto.
	* server.c (fd_buffer_initialize, server_notify, do_cvs_command): Ditto.
	(fd_buffer_shutdown): New function.

2000-06-20  Larry Jones  <larry.jones@@sdrc.com>

	* root.c (parse_cvsroot): Put the terminating NUL byte into the
	string *before* copying it, not after. :-(

2000-06-19  Larry Jones  <larry.jones@@sdrc.com>

	* main.c (main): Plug memory leaks.
	* root.c (parse_cvsroot, set_local_cvsroot): Ditto.
	* server.c (serve_root): Ditto.

2000-06-16  Larry Jones  <larry.jones@@sdrc.com>

	* fileattr.c (fileattr_read): Plug memory leak.
	* rcs.c (RCS_whatbranch): Ditto.
	* update.c (update_dirleave_proc): Ditto.

	* ignore.c (ign_dir_add): Duplicate string so caller can free.

	* modules.c (do_module): Don't write into dbm's memory!

2000-06-15  Larry Jones  <larry.jones@@sdrc.com>

	* checkout.c (checkout_proc): Fix non-ANSI code in call to
	findslash(), minor cleanups.

2000-06-14  Larry Jones  <larry.jones@@sdrc.com>

	* tag.c (val_direntproc): Return R_PROCESS instead of 0.

	* client.c (update_entries): Fix type clash calling gunzip_and_write().
	* server.c (receive_file): Fix type clash calling gunzip_and_write().
	(server_updated): Fix type clash calling buf_output().
	* error.c (error): Make buf char instead of unsigned char to avoid
	type clashes.

	* modules.c (do_module): Change callback_proc to pass argc by
	value instead of by reference: callback procs shouldn't be
	messing with the callers argc/argv, it makes correct memory
	management impossible.  Plug memory leaks.
	* cvs.h: Change to match.
	* checkout.c (checkout_proc): Ditto; use a local argv array instead
	of messing with caller's.
	* modules.c (callback_proc): Ditto.
	* patch.c (patch_proc): Ditto; use a local argv array instead
	of messing with caller's.
	* rtag.c (rtag_proc): Ditto; use a local argv array instead
	of messing with caller's.
	* server.c (expand_proc): Ditto.
	* subr.c (line2argv): Change initial argv_allocated back to 1.

	* checkout.c (findslash): Fix non-ANSI code.

	* sanity.sh (modes3): Fix test names.

2000-06-13  Larry Jones  <larry.jones@@sdrc.com>

	* add.c (add): Plug memory leaks.
	* admin.c (admin_fileproc): Ditto.
	* checkout.c (build_dirs_and_chdir): Ditto.
	* edit.c (editors_fileproc): Ditto.
	* log.c (cvslog, log_parse_revlist, log_parse_date): Ditto.
	* rcs.c (RCS_addaccess): Ditto.
	* tag.c (check_fileproc): Ditto.
	* vers_ts.c (Version_TS): Ditto.
	* watch.c (watchers_fileproc): Ditto.

2000-06-12  Larry Jones  <larry.jones@@sdrc.com>

	* rcs.c (rcsbuf_valword): Set rcsbuf->vlen to keep rcsbuf_valcopy()
	from allocating more memory than needed for @@ strings.  Don't declare
	unless PRESERVE_PERMISSIONS_SUPPORT (since not defined).

	* rcs.c (RCS_abandon): New function to abandon changes.
	* rcs.h: Declare it.
	* admin.c (admin_fileproc): Use it instead of RCS_reparsercsfile.

	* commit.c (commit_fileproc): Fix memory leaks.
	* patch.c (patch_fileproc): Ditto.
	* rcs.c (RCS_nodeisbranch, RCS_copydeltas): Ditto.
	* tag.c (tag_fileproc): Ditto.
	* update.c (update): Ditto.

2000-06-09  Larry Jones  <larry.jones@@sdrc.com>

	* rcs.c (RCS_reparsercsfile, RCS_fully_parse, getdelta,
	RCS_getdeltatext): Handle newphrases with composite values.
	(rcsbuf_getkey): Don't remove @@s in composite values -- it makes
	it impossible to parse the value!  Set special flag to indicate
	a composite value.
	(rcsbuf_valcopy, rcsbuf_valpolish_internal): Handle composite values.
	(putrcsfield): Write composite values.
	(RCS_checkin): Set node types in other_delta list.
	* hash.h: Add RCSCMPFLD.
	* hash.c (nodetypestring): Ditto.

	* rcs.c (getdelta): Never allocate space for value, just return
	pointer into rcsbuf (fixes memory leaks).  Use rcsbuf_getkey to
	read a key and value and then parse the value if needed rather
	than trying to read it in bits and pieces with rcsbuf_getid,
	rcsbuf_getstring, and rcsbuf_getword.
	(RCS_reparsercsfile): Change callers to compensate.
	(rcsbuf_valcmp, rcsbuf_valword): New functions.
	(rcsbuf_getid, rcsbuf_getstring, rcsbuf_getword): Deleted.
	* sanity.sh (rcs3-1): Now get slightly different error message.

2000-06-08  Larry Jones  <larry.jones@@sdrc.com>

	* main.c (usg): Update CVS home page URL.

	* main.c (main): Provide an actual error message for an unknown
	command in addition to the usage message.

2000-06-07  Larry Jones  <larry.jones@@sdrc.com>

	* server.c (serve_root, dirswitch, serve_repository,
	serve_static_directory, serve_sticky, receive_partial_file,
	receive_file, serve_modified, server_write_entries, serve_notify,
	serve_checkin_prog, serve_update_prog, server): Don't set
	pending_error before calling alloc_pending, it makes it fail;
	use alloc_pending instead of malloc when reasonable; be sure to
	save errno before calling functions that might change it.
	(Patch submitted by Dietmar Petras <dietmar.petras@@elsa.de>.)

2000-06-03  Larry Jones  <larry.jones@@sdrc.com>

	* commit.c (checkaddfile): Plug memory leak.
	* rcs.c (RCS_checkin): Plug memory leaks.
	* server.c (do_cvs_command): Plug file descriptor leaks.
	* tag.c (check_fileproc): Plug memory leak.

2000-05-26  Larry Jones  <larry.jones@@sdrc.com>

	* recurse.c (unroll_files_proc): Plug memory leak.

	* recurse.c (addfile): Fix nonportable pointer cast.

	* rcs.c (rcsbuf_getstring, rcsbuf_getword, getdelta): Plug memory
	leaks.

2000-05-25  Larry Jones  <larry.jones@@sdrc.com>

	* checkout.c (checkout, build_one_dir, checkout_proc): Move m_type
	to file scope and use it instead of continually doing strcmp on
	command_name.
	(build_one_dir, checkout_proc): Don't allow export if CVSADM
	directory already exists.

2000-05-23  Larry Jones  <larry.jones@@sdrc.com>

	* rcs.c (RCS_checkin, RCS_cmp_file): Plug memory leaks.  (Patch
	submitted by Chris G. Demetriou <cgd@@sibyte.com>.)

2000-05-20  Ian Lance Taylor  <ian@@zembu.com>

	* client.c (connect_to_gserver): Handle server error messages
	reasonably.

2000-05-19  Larry Jones  <larry.jones@@sdrc.com>

	* server.c (requests): Make Global_option RQ_ROOTLESS so it can be
	used with init.

2000-05-18  Larry Jones  <larry.jones@@sdrc.com>

	* client.c (start_server): Don't do encryption, authentication,
	compression, or case insensitivity when doing init because init
	is ROOTLESS and they're not.

	* client.c (connect_to_pserver): Include repository and username in
	authorization failed message -- if a directory tree crosses multiple
	repositories, it can be quite difficult for the user to figure out
	which one is the problem.

2000-05-17  Larry Jones  <larry.jones@@sdrc.com>

	* main.c (main): Use full set of options when looking for -f to
	avoid misparsing options that take values (previously, -sVAR=foo
	was incorrectly parsed as though it were -s -V -A -R -= -f -o -o
	because it didn't know that -s takes a value).
	* sanity.sh (info-6b): New test for above.

	* sanity.sh (conflicts-status): Fix tests so they work remotely, too.

2000-05-17  Jim Meyering  <meyering@@lucent.com>

	* sanity.sh (TESTDIR): Fix braino in last change:
	cd to /tmp before invoking pwd.

	* sanity.sh: Set TESTDIR so that `make check' passes even when /tmp
	is a symlink.
	(join-36): Use $TESTDIR rather than hard-coding `/tmp/cvs-sanity'.
	(conflicts-132): Remove unnecessary `rm aa'.

2000-05-16  Jim Kingdon  <kingdon@@redhat.com>

	* cvs.h, checkout.c (safe_location): Make extern.
	* import.c (import): Call it rather than reimplementing
	(incompletely) the same check.

2000-05-16  Larry Jones  <larry.jones@@sdrc.com>

	* rcs.h, subr.c (file_has_markers): Check for any of the three
	conflict marker lines, not just one.
	* sanity.sh (conflicts-status): New tests for above.
	* sanity.sh: Revise to avoid tripping the above check when merging
	changes into sanity.sh itself.

2000-05-15  Larry Jones  <larry.jones@@sdrc.com>

	* update.c (join_file): When registering the result of the merge,
	make sure that the version number is valid (vers->vn_rcs may be
	null if the file doesn't exist on the branch yet).  (Patch submitted
	by Robert de Vries <rhdv@@rhdv.cistron.nl>.)
	* update.c (join_file): Correct diagnostics (previous change was not
	correct -- the file *does* exist in the specified revision, it just
	doesn't exist in the sandbox).
	* sanity.sh (import-113, join): New tests and changes for above.

2000-05-04  Larry Jones  <larry.jones@@sdrc.com>

	* sanity.sh: Look for a useful id program.  Since we're getting
	the real username for some tests anyway, use it for all the
	tests instead of a generic regular expression that may or may
	not match the actual username.

2000-05-04  Larry Jones  <larry.jones@@sdrc.com>

	* server.c: More error messages.

2000-05-02  Donald Sharp <sharpd@@cisco.com>
	and Larry Jones  <larry.jones@@sdrc.com>

	* history.c (report_hrecs): Added code to print out year instead of
	just month/day.
	* sanity.sh (basic2-64, history): Update to match.

2000-04-19  Larry Jones  <larry.jones@@sdrc.com>

	* server.c (dirswitch): Set pending_error_text in addition to
	pending_error to aid in problem determination.

2000-03-23  Larry Jones  <larry.jones@@sdrc.com>

	* mkmodules.c (mkmodules): Return without doing anything if noexec
	is set to avoid trashing existing files.

2000-03-23  Larry Jones  <larry.jones@@sdrc.com>

	* main.c: Alphabetize cmds[] and cmd_usage[] and add server
	commands to cmd_usage[].

2000-03-21  Larry Jones  <larry.jones@@sdrc.com>

	* sanity.sh (client-1): May get "Broken pipe" message from the
	"server" in addition to the expected output.

2000-03-17  Larry Jones  <larry.jones@@sdrc.com>

	* server.c (switch_to_user): Set CVS_Username if it hasn't already
	been set elsewhere.  (Patch submitted by Gordon Matzigkeit
	<gord@@fig.org>).

2000-03-13  Larry Jones  <larry.jones@@sdrc.com>

	* parseinfo.c: Add extern to logHistory declaration.  (Reported by
	<John.Tytgat@@aaug.net>.)
	(parse_config): Reformat logHistory code.

2000-03-10  Larry Jones  <larry.jones@@sdrc.com>

	* add.c (add): Don't try to set cvsroot_len until after checking
	for help only -- CVSroot_directory isn't set in that case.

2000-03-03  Larry Jones  <larry.jones@@sdrc.com>

	* mkmodules.c (init): Use mkdir_if_needed to create CVSROOT/Emptydir
	so we don't fail if run multiple times.  (Reported by KOIE Hidetaka
	<hide@@koie.org>.)
	* sanity.sh (1a): New test for above.

2000-03-02  Larry Jones  <larry.jones@@sdrc.com>

	* main.c: Use identical #if's in the command table and the code
	for pserver and kserver to prevent "peculiar" configurations from
	having really perverse behavior because the command table entries
	are present but the related code isn't.

2000-03-01  Larry Jones  <larry.jones@@sdrc.com>

	* import.c (import): Don't allow importing the repository.
	* sanity.sh (errmsg2-20, errmsg2-21): New tests for above.

2000-03-01  Larry Jones  <larry.jones@@sdrc.com>

	* main.c (main): Update year in copyright message.

2000-03-01  Larry Jones  <larry.jones@@sdrc.com>

	* logmsg.c (do_editor): Correct previous change.

2000-02-29  Larry Jones  <larry.jones@@sdrc.com>

	* logmsg.c (do_editor): When reading temp file, check that message
	buffer is large enough to hold the next line and expand if needed.

2000-02-28  Larry Jones  <larry.jones@@sdrc.com>

	* commit.c (commit): Use get_file() to read log file correctly
	and in text mode rather than binary mode.

	* subr.c (get_file): Ignore bufsize if buf is NULL.  Include
	terminating NUL byte when estimating required buffer size.

2000-02-28  Larry Jones  <larry.jones@@sdrc.com>

	* sanity.sh (find_tool): New function to replace duplicated code.

2000-02-25  Larry Jones  <larry.jones@@sdrc.com>

	* import.c (add_rcs_file): Don't abort just because lstat fails.

2000-02-16  Jim Meyering  <meyering@@lucent.com>

	Avoid race condition whereby a catchable signal could
	end up corrupting the repository.
	* commit.c (checkaddfile): Put a critical section around the code
	that handles the first commit on the trunk of a file that's already
	been committed on a branch.
	* cvs.h (Sig_inCrSect): Declare new function.

2000-02-21  Karl Fogel  <kfogel@@red-bean.com>

	* main.c (main): still check for repository, but not history file
	(correction to 2000-02-18 change -- that's what I get for
	believing the comment rather than the code).

2000-02-21  K.J. Paradise <kj@@sourcegear.com>

	* history.c mkmodules.c parseinfo.c: control which actions
	get logged to the cvs history file via CVSROOT/config file
	and LogHistory keyword. (John P Cavanaugh <cavanaug@@sr.hp.com>)

2000-02-18  Karl Fogel  <kfogel@@red-bean.com>

	* history.c (history_write): don't die if history file not
	writable, just warn (unless `really_quiet') and skip out.

	* main.c (main): don't bother checking if history file is
	writable.

	* server.c (serve_root): same.

2000-02-17  Larry Jones  <larry.jones@@sdrc.com>

	* sanity.sh (perms symlinks symlinks2 hardlinks): Don't run by
	default since PreservePermissions code is now disabled.

2000-02-17  Larry Jones  <larry.jones@@sdrc.com>

	* sanity.sh (import-113): Revise to match Jim Meyering's fix.

2000-02-16  Larry Jones  <larry.jones@@sdrc.com>

	* add.c (add): Don't allow adding files or directories to Emptydir.
	(Patch submitted by Chris Cameron <chris.cameron@@ot.co.nz>.)
	* sanity.sh (emptydir): Revise (emptydir-7 and emptydir-8) for this.

2000-02-16  Jim Meyering  <meyering@@lucent.com>

	* update.c (join_file): Correct typo in diagnostic:
	change `file %s is present...' to `file %s is not present...'.

2000-02-10  Larry Jones  <larry.jones@@sdrc.com>

	* parseinfo.c (Parse_Info): Treat matching lines with bad expansions
	as errors rather than just ignoring.

2000-02-10  Larry Jones  <larry.jones@@sdrc.com>

	* edit.c (edit): Check for invalid characters in hostname and CurDir.
	(Reported by "Andrew S. Townley" <atownley@@informix.com>.)
	* sanity.sh (devcom2): New tests for above.

2000-02-10  Larry Jones  <larry.jones@@sdrc.com>

	* cvs.h: Always #include "server.h" to prevent compile errors when
	neither CLIENT_SUPPORT nor SERVER_SUPPORT is defined.
	(Reported by "Crow, Ian" <ian.crow@@linklaters.com>.)
	* log.c (send_one, send_arg_list): Only define when CLIENT_SUPPORT
	is defined to prevent link errors.

	* server.c (server): Always create a new temporary directory, don't
	try to reuse an existing one since we might not have correct
	permissions.  Also, include directory name in error messages.

2000-01-29  Jim Kingdon  <http://developer.redhat.com/>

	* ignore.c (ignore_files): Correctly set errno to 0 when we go
	back to the top of the loop.  Fixes spurious errors like "cvs
	update: error reading current directory: No such file or
	directory".

2000-01-26  Larry Jones  <larry.jones@@sdrc.com>

	* run.c (run_exec): Conditionalize K.J.'s change so that it only
	applies when SETXID_SUPPORT is defined since some platforms don't
	have setegid().

2000-01-26  Larry Jones  <larry.jones@@sdrc.com>

	* sanity.sh: Make TESTDIR earlier then use it to check for versions
	of expr that don't work right with long expressions.

	* sanity.sh (dotest_line_by_line): Have wc read from stdin so it
	doesn't output the file name and confuse expr.  Make the output a
	bit less verbose and easier to read.

2000-01-24  K.J. Paradise <kj@@sourcegear.com>

	* run.c :> prevents a user from creating a privileged shell from the
	text editor when the SETXID_SUPPORT option is selected.  This came from
	Bob Colle <bcolle@@ilx.com>, and is his completely.

2000-01-22  Jim Kingdon  <http://developer.redhat.com/>

	* sanity.sh (emptydir): Add a case in which one might hope for a
	non-Emptydir result, but which result?

2000-01-18  Larry Jones  <larry.jones@@sdrc.com>

	* main.c (main): Allow -z0 to disable gzip compression.

2000-01-17  Larry Jones  <larry.jones@@sdrc.com> for
	K.J. Paradise (kj@@sourcegear.com)

	* version.c: Push version number to 1.10.8.1.

	* version.c: Version 1.10.8.

2000-01-17  Larry Jones  <larry.jones@@sdrc.com>

	* mkmodules.c (init): Create CVSROOT/Emptydir to avoid problems
	with users not having sufficient permissions to create it later.

2000-01-04  Larry Jones  <larry.jones@@sdrc.com>

	* client.c (get_responses_and_close): Simplify time-stamp race
	avoidance code.
	* commit.c (commit): Ditto.
	* update.c (do_update): Ditto.
	(Prompted by patch submitted by Pavel Roskin
	<pavel_roskin@@geocities.com>.)

	* hardlink.c: sizeof (char) is 1, by definition.
	* logmsg.c: Ditto.
	* rcs.c: Ditto.

2000-01-03  Karl Fogel  <kfogel@@red-bean.com>

	* filesubr.c, subr.c (backup_file): moved this function from
	filesubr.c to subr.c, at JimK's suggestion.

2000-01-03  Jim Kingdon  <http://developer.redhat.com/>

	* sanity.sh (clean): Test the contents of the .#cleanme.txt.1.1
	file, not just its existence.

2000-01-03  Karl Fogel  <kfogel@@red-bean.com>

	* cvs.h, filesubr.c (backup_file): use `const' for suffix too;
	correct suffix length calculation and appending behavior; discard
	unnecessary `void' cast.  Thanks to Jim Meyering for noticing.

2000-01-03  Larry Jones <larry.jones@@sdrc.com>

	* sanity.sh (clean): Fix up expected output.

2000-01-02  John P Cavanaugh <cavanaug@@sr.hp.com>
        and Karl Fogel <kfogel@@red-bean.com>

	New -C option to update: overwrites local changes with clean
	copies from the repository.  (This is an unreversion of the
	1999-12-10 change, further modified to work remotely.)

	* client.h (BACKUP_MODIFIED_FILES): new #define.

	* client.c (struct send_data): new element `backup_modified'.
	(send_files): set above element if BACKUP_MODIFIED_FILES flag is
	present.

	* filesubr.c (backup_file): new function.

	* cvs.h: prototype for new function `backup_file'.

	* update.c (toss_local_changes): new file-scoped global.
	(update): set toss_local_changes if -C flag seen.  If
	client_active, send "-C" to server, and set SEND_NO_CONTENTS and
	BACKUP_MODIFIED_FILES flags before calling send_files().

	(update_fileproc): if file is modified and toss_local_changes is
	set, then back the file up and then check out a fresh copy from
	the repository.  Also, fixed indentation and formatting for a
	particularly bad stretch of code near (but unrelated to) these
	changes.

	* sanity.sh: new test `clean', for update -C option.

1999-12-29  Jim Kingdon  <http://developer.redhat.com/>

	* history.c (read_hrecs): st_blksize is unsigned long, not int.
	This isn't just cosmetic - getting it wrong will cause coredumps
	and such on 64 bit machines.

	* import.c (import_descend), ignore.c (ignore_files): Placate gcc
	-Wall by parenthesizing foo || (bar && baz).

1999-12-24  Larry Jones <larry.jones@@sdrc.com>

	* release.c (release): Use fputs to echo lines from update instead
	of printf to avoid problems with lines containing "%".  (Reported
	by Jean-Luc Simard <Jean-Luc.Simard@@matrox.com>.)

	* history.c (read_hrecs): Allocate a single 2-block buffer instead
	of allocating and freeing a buffer for each block.
	(fill_hrec): Remove redundant code.
	(select_hrec): Plug memory leak.

1999-12-22  Larry Jones <larry.jones@@sdrc.com>

	* history.c (history): For "modified" or "checkout", sort on
	file if user specified -l, even if user also specified a date-
	oriented flag.
	* sanity.sh (history): Update to match; add new tests.

1999-12-15  Pavel Roskin <pavel_roskin@@geocities.com>
	and Larry Jones <larry.jones@@sdrc.com>

	* lock.c (lock_name): fixed assertion failure for the
	top-level CVS directory when LockDir is used
	* sanity.sh (lockfiles-9): new test for this case

1999-12-11  Karl Fogel  <kfogel@@red-bean.com>

	* Revert previous change -- it doesn't work remotely yet.

1999-12-10  John P Cavanaugh <cavanaug@@sr.hp.com>
        and Karl Fogel <kfogel@@red-bean.com>

	* update.c: new -C option to update, overwrites local changes with
	clean copies from the repository.
	Also, fixed indentation and formatting for a particularly bad
	stretch of code near these changes in update_fileproc().

	* sanity.sh: test new update -C option.

1999-12-10  Larry Jones <larry.jones@@sdrc.com>

	* commit.c (remove_file): Call history_write with update_dir NULL
	like Checkin() does for add and modify.
	* sanity.sh (basic2-64): Update to match, add "R" records to expected
	remote output.

1999-12-09  K.J. Paradise (kj@@sourcegear.com)

	* history.c, commit.c, sanity.sh: found (I think) final
	cause of seg fault in history command.  Also, added the "R"
	history functionality.  Fixed basic2-64 so it looks correct for
	the change.

1999-11-30  K.J. Paradise (kj@@sourcegear.com)

	* history.c: fixed seg fault caused by 11-03 changes.
	off by one in block memory allocations.

1999-11-29  Karl Fogel  <kfogel@@red-bean.com>

	* login.c (logout): free `tmp_name' when done.
	Correct a comment.

1999-11-29  Larry Jones <larry.jones@@sdrc.com>

	* cvs.h, error.c, import.c: Rename fperror to avoid name clash
	on LynxOS.  (Reported by Markus Braun <MarkusBraun@@gmx.de>.)

1999-11-23  Larry Jones <larry.jones@@sdrc.com>

	* checkout.c (checkout_proc): Split declaration and initialization
	of rp to placate neurotic compilers that gripe about jumping past
	an initialization, even when the variable is not subsequently used.

1999-11-19  Larry Jones <larry.jones@@sdrc.com>

	* server.c (switch_to_user): Correct setgid error messages.

1999-11-19  Karl Fogel  <kfogel@@red-bean.com>

	* edit.c (unedit_usage, unedit): new struct, use it.  Now "cvs
	unedit" prints an accurate usage message (formerly it printed the
	message for "cvs edit", even though the two commands do not have
	identical usages).

1999-11-19  Larry Jones <larry.jones@@sdrc.com>

	* history.c: Move -e documentation from Flags to Reports.
	(history): Add -e to list of report types in error message.

	* history.c (history): Process file arguments before client/server
	processing so they get sent to the server.
	* sanity.sh (history): New tests for above.  (Also remove comments
	about variable spacing -- history output is in variable-width
	columns with exactly one space between.)

1999-11-19  Larry Jones <larry.jones@@sdrc.com>

	* sanity.sh: Reestablish check for running as root (using ``id -u''
	instead of ``whoami'').

	* sanity.sh(dotest, dotest_lit, dotest_fail, dotest_status,
	dotest_sort): Eval the command so quoting and pipes work right.
	(spacefiles, dirs, rcslib, modules, unedit-without-baserev,
	ignore, rcs, rcs2, history, tagdate, pserver, server, server2)
	Simplify various tests based on above.

1999-11-19  Karl Fogel  <kfogel@@red-bean.com>

	* mkmodules.c (init): make history file world-writeable after
	creating it, since it needs to be writeable for virtually any
	CVS operation.

1999-11-10  Jim Kingdon  <http://developer.redhat.com/>

	* admin.c: Revert change to add -H command option.  The help
	invocation is "cvs -H admin" not "cvs admin -H" (see cvs.texinfo,
	basicb-21 in sanity.sh; fix to cvs.1)

1999-11-08  Jim Kingdon  <http://developer.redhat.com/>

	* log.c (cvslog): If client_active, send options to the server
	based on our parsed options rather than trying to send the exact
	strings specified (using canonical forms, like RFC822/1123
	dates, in the protocol is just cleaner).
	(send_one, send_arg_list): New functions, helpers for above.
	* sanity.sh (logopt-6a): New test, for this fix.

1999-11-09  K.J. Paradise <kj@@sourcegear.com>

	* admin.c: made the -H option do what it is documented to
	do.  a

1999-11-08  Tom Tromey  <tromey@@cygnus.com>

	* client.c (connect_to_gserver): Print more error text if gssapi
	initialization fails.  From Assar Westerlund <assar@@sics.se>.

1999-11-06  Larry Jones <larry.jones@@sdrc.com>

	*sanity.sh(rcs3-5): Remote output can be out-of-order, so need a
	more general pattern to match the assertion failure.

1999-11-05  K.J. Paradise (kj@@sourcegear.com)

	* history.c: Added a trap to verify that if a
	read(file, buffer,blocksize) returns less than blocksize,
	that we really are at the end of the file.  I can't easily
	come up with a test case where this code gets touched, so
	it may cause problems.  All sanity tests still pass though.

1999-11-05  Jim Kingdon  <http://developer.redhat.com/>

	* sanity.sh (logopt): New test, for Larry's fix.
	* sanity.sh (log-18a, rcs-15 to rcs-19): New tests, to test -d
	and -r more thoroughly.

1999-11-05  Larry Jones <larry.jones@@sdrc.com>

	* log.c (cvslog): Fix -s and -d with spaces on client side.
	(log_usage): Revert Karl's change once again.
	sanity.sh(rcs3-5): No longer get different results from local
	and client/server.

1999-11-04  Karl Fogel  <kfogel@@red-bean.com>

	* log.c (log_usage): Revert Jim Kingdon's reversion of my change
	of 1999-11-03.  Allowing a space between option and argument
	results in lossage; here is a reproduction recipe: run this from
	the top of a remote copy of the cvs source tree

	   cvs log -d '>1999-03-01' > log-out.with-space

	and then run this (note there's no space after -d now):

	   cvs log -d'>1999-03-01' > log-out.no-space

	The resulting files differ; furthermore, a glance at the output of
	cvs shows that the first command failed to recurse into
	subdirectories.  Until this misbehavior can be fixed in the source
	code, the documentation should reflect the true state of affairs:
	if one simply omits the space, everything works fine.

1999-11-04  Jim Kingdon  <http://developer.redhat.com/>

	* log.c (log_usage): Revert Karl's change regarding -d and
	-s.  A space is allowed (see sanity.sh for example).

1999-11-03  K.J. Paradise (kj@@sourcegear.com>

	* history.c: cleaned up my prior change a bit, per Larry Jones'
	comments, and John O'Conner's additional comments about bits of
	non MS-Visual C++ compliancy of my code.

1999-11-04  Larry Jones <larry.jones@@sdrc.com>

	* sanity.sh: Check that tr that correctly handles NULs; if not, try
	to find a version that does; if none can be found, warn user.
	Also fix warnings for defective expr.

1999-11-04  Karl Fogel  <kfogel@@red-bean.com>

	Changes for empty/random passwords in anon pserver access:

	* server.c (check_repository_password): if password empty, grant
	access no matter what password is received; this is so anon CVS no
	longer requires a password but remains backwards-compatible with
	all those clients out there.

	* client.c (connect_to_pserver): proceed with login even if
	password not found in .cvspass file -- just use empty string as
	password.  And if such a login fails, print a descriptive error.

	* login.c (get_cvs_password): don't complain if file or password
	not found.  That condition is no longer a showstopper, now that
	empty passwords are permissible.
	Cleaned up conditional chaining a bit, too.

	* sanity.sh (pserver-9, pserver-10, pserver-11, pserver-12,
	pserver-13): new tests, about empty-password pserver access.

1999-11-03  K.J. Paradise (kj@@sourcegear.com>

	* history.c:  modify parsing routines to parse the history
	file a block at a time, rather than all at once.  This allows
	people with large history files and small amount of memory
	to still get some functionality out of the history file.

1999-11-03  Karl Fogel  <kfogel@@red-bean.com>

	* log.c (log_usage): correct usage message for -d and -s options.
	Because the space between the option letter and its argument has
	been eliminated, I capitalized the argument portion to distinguish
	it from the option letter.  This makes it slightly inconsistent
	with other such usage summaries, but at least it is now both
	correct and readable.

1999-10-22  Larry Jones  <larry.jones@@sdrc.com>

	* sanity.sh (dotest_sort): Old versions of tr don't understand \t
	so use a literal tab instead.

1999-10-21  Larry Jones  <larry.jones@@sdrc.com>

	* sanity.sh (dotest_sort): Convert any tabs in the output into spaces
	before sorting to avoid POSIX.2 sort weirdness.
	(import-106, importb-2): Change expected output per above.

1999-10-18  K.J. Paradise <kj@@sourcegear.com>

	Bug: users 'stan' and 'cartman' both have full read/write access
	to the cvs repository.  'cartman' does a 'cvs admin -l foo.c'.
	'stan' then does a 'cvs admin -u foo.c'.  The lock wouldn't be
	removed, and no warning/error would be given.  This is now fixed.
	* rcs.c:(c.6157) remove caller/user check on the multiple lock
        detection routines.  Sanity.sh runs with no errors after this fix.

1999-10-14  Larry Jones  <larry.jones@@sdrc.com>

	Make "cvs admin -e" (with no list of users) work:
	* admin.c (admin): Remove error message.
	(admin_fileproc): If no args for -e, call RCS_delaccess with NULL user.
	* rcs.c (RCS_delaccess): Interpret NULL user as request to delete
	entire access list.
	* sanity.sh (admin-19a-*): Test.

1999-09-29  Larry Jones  <larry.jones@@sdrc.com>

	* entries.c (Subdirs_Known): Use entfilename when opening CVSADM_ENTLOG
	like everywhere else.  Although this isn't strictly necessary (since
	we immediately close it again), it keeps the code consistent and fixes
	a bug where an open error reported the wrong file name.

1999-09-16  Larry Jones  <larry.jones@@sdrc.com>

	* log.c (log_parse_revlist): Handle peculiar revision specs like
	"-r.", "-r:", and "-r," correctly.  (Thanks to Pavel Roskin
	<pavel_roskin@@geocities.com> for submitting a patch, this fix is
	somewhat different.)
	* sanity.sh (log): New tests for above.

1999-09-15  Larry Jones  <larry.jones@@sdrc.com>

	* sanity.sh (basica-8b1): New test to check fix for bad diff options
	causing cvs to crash.

1999-09-02  Larry Jones  <larry.jones@@sdrc.com>

	* modules.c (do_module): Handle case where module definition has
	options and special options but no directory; fix potential problems
	running off beginning of string while stripping trailing blanks.
	* sanity.sh (modules2): New tests for above.

1999-08-26  Larry Jones  <larry.jones@@sdrc.com>

	* lock.c (lock_name): Remove side-effects from assert() expression
	since they won't occur if NDEBUG is defined (not that that's a good
	thing to do).  (Reported by KOIE Hidetaka <hide@@koie.org>.)

1999-08-25  Larry Jones  <larry.jones@@sdrc.com>

	* sanity.sh: Use "${AWK}" instead of "awk" to make it easier for
	people to use nawk/gawk/etc.; use an explicit "-print" with find
	since some older version don't assume it; rename tests to avoid
	duplicate importc-8.  (Changes along these lines suggested by
	Chris Cameron <chris.cameron@@ot.co.nz>.)

1999-08-24  Larry Jones  <larry.jones@@sdrc.com>

	* commit.c (check_fileproc): Don't crash when a file has no
	repository, just treat it as unknown.  (Reported by Stefaan
	Diericx <stefaan.diericx@@argenta.be>.)
	* sanity.sh (errmsg2): New tests, for this fix.

1999-08-18  Larry Jones  <larry.jones@@sdrc.com>

	* update.c (special_file_mismatch): Initialize *_hardlinks to
	avoid trying to free garbage later on.  (Reported by Jan
	Scheffczyk <herta@@Xterminator.StudFB.UniBw-Muenchen.de>.)

1999-08-17  Larry Jones  <larry.jones@@sdrc.com>

	* sanity.sh (basicc-11): Older versions of sh don't understand
	``if ! test...''.  (Patch submitted by David J N Begley
	<david@@avarice.nepean.uws.edu.au>.)

1999-08-17  Larry Jones  <larry.jones@@sdrc.com>

	* client.c, hardlink.c, hash.c, hash.h, main.c, recurse.c: Change
	enum constant UNKNOWN to avoid conflicts on HPUX 11.0.  (Reported
	by Laurent Duperval <laurent.duperval@@cgi.ca>.)

1999-08-16  Larry Jones  <larry.jones@@sdrc.com>

	client.c: Eliminate redundant #if.  (Patch submitted by Assar
	Westerlund <assar@@sics.se>.)

1999-07-30  Larry Jones  <larry.jones@@sdrc.com>

	* rcs.c (RCS_checkin): Terminate cleanly if RCS_addbranch fails
	rather than blithely continuing on and crashing.
	* sanity.sh (basica): New tests, for this fix.

1999-07-29  Larry Jones  <larry.jones@@sdrc.com>

	* import.c (add_rcs_file): change "cannot lstat" message to include
	userfile (the actual file causing the problem) instead of user
	(which may or may not be the same).

1999-07-29  Eric Sink   <eric@@sourcegear.com>

	* version.c: Push version number to 1.10.7.1.

	* version.c: Version 1.10.7.

@


1.1.1.18
log
@Latest from Cyclic Software
@
text
@d1 1
a1 1076
2001-04-27  Larry Jones  <larry.jones@@sdrc.com>

	* main.c (lookup_command_attribute): Lookup specified command, not
	whatever's in the global command_name.

2001-04-25  Derek Price  <dprice@@collab.net>

	* Makefile.in: Regenerated using AM 1.4e as of today at 18:10 -0400.
	* version.c: Regenerated.

2001-04-22  Larry Jones  <larry.jones@@sdrc.com>

	* tag.c (tag_check_valid): Make an unwritable val-tags file a
	warning instead of a fatal error.

2001-04-20  Larry Jones  <larry.jones@@sdrc.com>

	* annotate.c (annotate_usage): -r and -D are not mutually exclusive.
	* main.c (cmd_usage): Add missing version subcommand.
	* update.c (update_usage): Add missing -C option.

	* sanity.sh (death2): New tests for previous change.

	* classify.c (Classify_File): Treat a dead revision like the RCS
	file doesn't exist.
	* sanity.sh: Update to match.

2001-04-16  Larry Jones  <larry.jones@@sdrc.com>

	* checkout.c, update.c: Fix usage messages: -r and -D are not
	mutually exclusive.
	(Suggested by David L. Martin <dlmart2@@home.com>.)

	* logmsg.c (do_editor): Don't add a blank line to the message.
	* sanity.sh (editor-log-file*): Update to match.

	* checkout.c, update.c: Note in usage message that -k is sticky.

	* server.c: (server_cleanup, wait_sig): Remove ancient SunOS kludge.
	(Suggested by Rob Saccoccio <robs@@chelsea.net>.)

2001-04-04  Larry Jones  <larry.jones@@sdrc.com>

	* sanity.sh (dotest, dotest_lit, dotest_fail, dotest_status,
	dotest_sort): Don't count on $? being set in then or else clauses.

	* ignore.c (ignore_files): Collect unignored files into a list and
	sort it before calling PROC to avoid order dependencies.  Rewrite
	the while loop to allow normal continues instead of goto.

2001-04-04  Derek Price  <dprice@@collab.net>

	* sanity.sh (ignore-on-branch-3): Fix in the remote case.

2001-04-03  Larry Jones  <larry.jones@@sdrc.com>

	* update.c (update_fileproc): Remove unused variable (resurrecting).

2001-04-03  Derek Price  <dprice@@collab.net>
	    Larry Jones  <larry.jones@@sdrc.com>
	    reported by Jakob Bhm  <JB@@Danware.dk>

	* update.c (update_fileproc): Don't store a file with T_UNKNOWN status
	in ignlist if present in the sandbox.
	* sanity.sh (ignore-on-branch): New test.
	(ignore): Tidy this test.

2001-04-02  Derek Price  <dprice@@collab.net>

	* sanity.sh: Make sure the test for `id' fails when a nonstandard `id'
	is used and the user is root.  Fix some quoting in error messages.
	(fork): Take `cvs' out of the PATH.
	(TODO): Add note about the test suite not working with user names over
	eight characters in length.

2001-04-02  Derek Price  <dprice@@collab.net>

	* sanity.sh (fork): New test for CVS_SERVER default.
	(TODO): Note about eventually removing most of the references to
	CVS_SERVER.

2001-04-02  Larry Jones  <larry.jones@@sdrc.com>

	* client.c (connect_to_forked_server): Use program_path as the default
	server instead of "cvs".

2001-04-02  Derek Price  <dprice@@collab.net>

	* sanity.sh: Use less obfuscated English in my comment about sanity
	checking sanity.sh.

2001-04-02  Derek Price  <dprice@@collab.net>

	* sanity.sh (rm-update-message): Create a test directory again but
	change back to the correct directory upon completion this time.

2001-04-02  Derek Price  <dprice@@collab.net>

	* sanity.sh: Change last two '[.*]'s to 'test's for
	consistency and remove...
	(TODO): the note from the TODO list.

2001-04-02  Derek Price  <dprice@@collab.net>

	* sanity.sh: Add test for PWD before successful exit.

2001-03-30  Larry Jones  <larry.jones@@sdrc.com>

	* sanity.sh (rm-update-message): Remove duplicate code.

2001-03-30  Derek Price  <dprice@@collab.net>

	* sanity.sh (rm-update-message): New test for local/client-server
	warning message discrepency.

2001-03-30  Larry Jones  <larry.jones@@sdrc.com>

	* annotate.c: Move annotate() here from rcs.c, support rannotate.
	* Makefile.am, Makefile.in: Add annotate.c.
	* main.c (cmds[], cmd_usage[]): Add rannotate.
	* rcs.c: Move declarations of rcs_delta_op and RCS_deltas to...
	* rcs.h:    ... here.
	* server.c (serve_rannotate): New.
	(requests[]): Add rannotate.
	* sanity.sh (ann): New tests for rannotate.

	* log.c (rlog_proc): Remove dead code.

2001-03-30  Derek Price  <dprice@@collab.net>

	* sanity.sh (join-readonly-conflict): Run more of this through dotest.

2001-03-30  Larry Jones  <larry.jones@@sdrc.com>

	* log.c (log_fileproc): Don't output working file for rlog.
	* sanity.sh (log): New tests for rlog.

	* cvs.h (mtype): Add MISC type.
	* log.c (cvslog): Support rlog as well as log.
	(rlog_proc): New.
	* main.c (cmds[], cmd_usage[]): Add rlog.
	(main): Remove old rlog warning message.
	* server.c (serve_rlog): New.
	(requests[]): Add rlog.

2001-03-29  Derek Price  <dprice@@collab.net>

	* sanity.sh: cd to $TESTDIR once after it is normalized.  Make TODO
	on history and symlinks more specific.  Tested properly this time.

2001-03-29  Larry Jones  <larry.jones@@sdrc.com>

	* main.c (cmds[], lookup_command_attribute, main): Include the
	command attributes in the global command table instead of inferring
	them from the command names.  Change the sense of the
	CVS_CMD_IGNORE_ADMROOT attribute to match its name.

2001-03-29  Derek Price  <dprice@@collab.net>

	* sanity.sh (*, basic2-64): Remove references to TMPPWD.  Fix FIXME
	at end of script now that $TESTDIR can't be relative.

2001-03-29  Derek Price  <dprice@@collab.net>

	* sanity.sh: Normalize TESTDIR even when the user set it.

2001-03-29  Larry Jones  <larry.jones@@sdrc.com>

	* client.c (connect_to_pserver, start_tcp_server): Add IP address
	to connect failed message.
	(connect_to_forked_server, connect_to_pserver, start_tcp_server): Add
	trace messages ala start_rsh_server.
	(start_rsh_server): Include entire command in trace message for
	START_RSH_WITH_POPEN_RW like ! START_RSH_WITH_POPEN_RW does.

2001-03-29  Derek Price  <dprice@@collab.net>

	* sanity.sh: Global search & replace ${TESTDIR}/cvsroot with
	${CVSROOT_DIRNAME} for consistency.

2001-03-29  Derek Price  <dprice@@collab.net>

	* sanity.sh (conflicts-12[68].5): Remove sanity hack which has allowed
	for a CVS bug since May 96/97.  Not sure when the bug went bye-bye, but
	the tests broke when $TESTDIR != $TMPPWD.

2001-03-26  Larry Jones  <larry.jones@@sdrc.com>

	* classify.c (Classify_File): Don't report a conflict for a removed
	file when piping.  Also simplify the code structure.
	(Reported by Milos Kleint <milos.kleint@@netbeans.com>.)
	* sanity.sh (rmadd2-14[abc]): New tests for above.

2001-03-24  Noel Cragg  <noel@@shave.cnet.com>

	* diff.c: mods to allow `-T' and `-y' options to be passed through
	to the diff library.  This wasn't allowed earlier because of a
	similarly named options that got passed through to the old rcs
	programs.  We've long since stopped sending `-T' to any rcs
	utility and have never used `-y'.  Any users of moldly CVS
	versions which used to support `-T' have (hopefully) upgraded to
	one where that option isn't supported.  It seems reasonable to
	enable them again and pass them through.  (sanity.sh still works
	anyways...)
	(longopts): add short option equivalents for --initial-tab and
	--side-by-side.
	(diff): add new short options to getopt string and switch
	statement.

2001-03-22  Larry Jones  <larry.jones@@sdrc.com>

	* sanity.sh: Add check for ${DOTSTAR} with large matches.

2001-03-23  Derek Price  <dprice@@collab.net>

	* sanity.sh: Do the same as below for $keep.

2001-03-23  Derek Price  <dprice@@collab.net>

	* sanity.sh: Replace 'remote=(yes|no)' with 'remote=(:|false)' since
	often 'false' and more often ':' are shell builtins.  This makes the
	succinct, 'if $remote; then' faster than 'if test $remote = yes; then'.
	Alter tests in the rest of the script to match the new usage.  Added
	a suffix of 'r' to remote test names when it was appropriate and I
	remembered.  Some reformatting.

2001-03-22  Larry Jones  <larry.jones@@sdrc.com>

	* sanity.sh (diffmerge1_yours, diffmerge1_mine): Check for exact
	output instead of using wildcards to avoid buffer overflows in some
	versions of expr.

2001-03-21  Derek Price  <dprice@@collab.net>

	* sanity.sh: cd to '/tmp' again rather than $HOME since HOME was set to
	a value inside ${TESTDIR} by the script.

2001-03-20  Derek Price  <dprice@@collab.net>

	* sanity.sh (diffmerge1): Minor formatting and syntax changes.

	    for Jacob Burckhardt  <bjacob@@ca.metsci.com>

	* sanity.sh (diffmerge1): More merging behavior tests.  Specifically,
	test some cases which broke before in Karl Tomlinson's diff fix was
	checked in today.

2001-03-20  Derek Price  <dprice@@collab.net>

	* sanity.sh: Don't use unescaped parens in sh outside of quotes.

2001-03-20  Derek Price  <dprice@@collab.net>

	* sanity.sh: Don't remove ${TESTDIR} when -k (keep) set.

2001-03-20  Derek Price  <dprice@@collab.net>

	* sanity.sh: Change usage to match the new getopts format and comment.

2001-03-16  Derek Price  <dprice@@collab.net>

	* sanity.sh (modules2-nestedrename): New test.  Verifies behavior of
	renames nested under an ampersand module.
	(modules2-ampertag): New test.  Verifies an error condition which
	prevents some ampersand modules from being checked out when a tag
	is specified.

2001-03-16  Derek Price  <dprice@@collab.net>

	* sanity.sh (modules2): Additional test for ampersand module behavior
	with '-d'.

	    for Greg Klanderman  <greg@@itasoftware.com>

	* checkout.c (build_one_dir): Fix typo where clauses of two
	conditionals were reversed in call to Create_Admin.  This caused
	the CVS/Tag file to be removed in cases where it should have been
	set, and vice-versa.  It only surfaced in rare cases as this code
	is only invoked when using the -d option to build the path to
	check out in.  Further, the bug would only matter when checking
	out a module containing ampersand modules within it, via
	client/server CVS.

2001-03-16  Derek Price  <dprice@@collab.net>

	* sanity.sh (admin-28-5): Confirm that a missing tag during an
	'admin -n' operation is not a fatal error.

2001-03-16  Derek Price  <dprice@@collab.net>

	* admin.c (admin_data): Remove 'quiet' member.
	(admin_fileproc): Use global 'really_quiet' rather than
	admin_data->quiet.

2001-03-16  Derek Price  <dprice@@collab.net>

	* sanity.sh (admin): Replace hardcoded testdir path with the variable.

2001-03-15  Derek Price  <derek.price@@openavenue.com>

	* sanity.sh (basica, binfiles, head, admin): Adjust for new messages.
	* admin.c (admin_fileproc): Only print messages when not in
	really_quiet mode.

	    for Stephen Rasku  <stephen@@tgivan.com>

	* rcs.c (RCS_tag2rev): Make a missing tag a survivable error.

2001-03-15  Larry Jones  <larry.jones@@sdrc.com>

	* subr.c (sleep_past): Fix various bugs that would result in a
	negative sleep time if it weren't unsigned; since it is, it would
	result in a very large sleep time.  Ensure that us is always less
	than 1000000.  Don't try to sleep for more 1 sec with usleep.
	Cast NULL select arguments to correct type just in case.

2001-03-14  Derek Price  <derek.price@@openavenue.com>

	* subr.c (sleep_past): New function.
	* client.c (get_responses_and_close): Use new function.
	* commit.c (commit): Ditto.
	* update.c (do_update): Ditto.
	* cvs.h: Prototype new function.

	* stamp-h2.in: Regenerated.

2001-03-14  Derek Price  <derek.price@@openavenue.com>

	* Makefile.in: Regenerated.
	* stamp-h2.in: Ditto.

2001-03-14  Larry Jones  <larry.jones@@sdrc.com>

	* commit.c (check_fileproc): Allow adding on the trunk when there's
	an existing non-Attic RCS file as long as the head revision is dead.
	This can happen due to an aborted resurrection.
	(commit_fileproc): When resurrecting, consider the dead revision
	along with the other files' revisions.
	(findmaxrev): Avoid unnecessary work.
	(checkaddfile): Only warn if file isn't in Attic as expected.
	(Reported by Ross Burton <r.burton@@180sw.com>.)
	* sanity.sh (basica-r*): New tests for above.
	(basica-o4): Update to match.

2001-03-09  Larry Jones  <larry.jones@@sdrc.com>

	* edit.c (edit_fileproc, unedit_fileproc): Some implementations of
	asctime/ctime apparently use a leading zero on the date instead
	of the space required by the C Standard.  Correct for this so that
	shared working directories work without hassle.
	(Reported by David L. Martin <dlmart2@@home.com>.)
	* entries.c (fgetentent): Ditto.
	* vers_ts.c (time_stamp_server, time_stamp) Ditto.

2001-03-07  Larry Jones  <larry.jones@@sdrc.com>

	* sanity.sh (basica, binfiles2, head, admin): Update to match
	change to admin.c.

2001-03-06  Larry Jones  <larry.jones@@sdrc.com>

	* client.c (recv_bytes): Handle EOF as in recv_line().
	(Reported by Pavel Roskin <proski@@gnu.org>.)

	* admin.c (admin_fileproc): Change final error message to clarify
	that CVS refused to modify the RCS file rather than being unable to.

2001-02-28  Jim Meyering  <meyering@@lucent.com>

	* commit.c (commit_usage): Use `-F logfile' (rather than -F file') in
	the description of that option, to be consistent with the `-F logfile'
	in the Usage: line.  Use spaces instead of TAB characters, and realign.

2001-03-02  Derek Price  <derek.price@@openavenue.com>

	* sanity.sh (crerepos): Make failed ${CVS_RSH-rsh} attempt print the
	name of the command it actually used rather than 'rsh'.

2001-02-27  Derek Price  <derek.price@@openavenue.com>

	* sanity.sh (modules2-ampermod-*): Added these tests to make sure the
	top level directory is created in an ampermodule when '-n' is passed to
	checkout.

	original bug report from
	    Wolfgang Haefelinger <Wolfgang.Haefelinger@@Dresdner-Bank.com>

2001-02-27  Derek Price  <derek.price@@openavenue.com>

	* sanity.sh (version-[12]): replace ' (client/server)' with .* in these
	two tests so that 'make check' works with whatever client/server
	options the executable was compiled with.

2001-02-23  Derek Price  <derek.price@@openavenue.com>

	* main.c (main): Only check a cvsroot_t's isremote member when client
	support is enabled.
	* server.c: Include GSSAPI headers with client support as well as
	server support.

2001-02-21  Larry Jones  <larry.jones@@sdrc.com>

	* modules.c, cvs.h (do_module): Add build_dirs argument and use it
	instead of run_module_prog.  Change all callers.
	* tag.c (cvstag): For rtag, don't build directories.
	* sanity.sh (modules3): Update to match.

2001-02-20  Derek Price  <derek.price@@openavenue.com>

	* client.c: Use xgssapi.h.
	* server.c: Ditto.

2001-02-15  Derek Price  <derek.price@@openavenue.com>

	* Makefile.am (cvs_SOURCES): Correct error from yesterday.
	* Makefile.in: Regenerated.

2001-02-14  Derek Price  <derek.price@@openavenue.com>

	* server.c: Include xselect.h.
	* update.c (do_update): Use best available sleep function.

2001-02-14  Derek Price  <derek.price@@openavenue.com>

	* Makefile.am (cvs_SOURCES): Alphabetize and split to one/line.
	(cvs_LDADD): Alphabetize and split to one/line.
	* Makefile.in: Regenerated.

2001-02-14  Larry Jones  <larry.jones@@sdrc.com>

	* build_src.com: Remove references to rtag.c & rtag.obj.

2001-02-13  Derek Price  <derek.price@@openavenue.com>

	* main.c (date_to_tm): New function to convert an RCS date string to a
	struct tm.
	(tm_to_internet): New function to convert a struct tm to a date string
	as specified by RFC822 and amended by RFC 1123.
	(date_to_internet): Use the above two functions and a struct tm
	intermediary for conversion.
	* patch.c (patch_fileproc): Answer somebody's comment and use the new
	diff_exec API.
	* rcs.c (RCS_checkin): Use new diff_exec API.
	(RCS_delete_revs): Use new diff_exec API.
	(make_file_label): If the file name is DEVNULL, date it the Epoch for
	compatibility with the POSIX.2 spec and Larry Wall's patch
	implementation.
	* rcscmds.c (diff_exec): Accept new label arguments.
	* sanity.sh (death2): Update some diff tests to accept the new format.
	* update.c (patch_file): Use new diff_exec API.
	* diff.c (diff_fileproc): Create header labels appropriate for
	compatibility with the Larry Wall version of patch.
	(diff): Rename calls to strcat_and_allocate.
	(strcat_and_allocate): Rename and move...
	* subr.c (xrealloc_and_strcat): here.
	* cvs.h: Update prototypes to match.

2001-02-13  Derek Price  <derek.price@@openavenue.com>

	* Makefile.am (cvs_SOURCES): Remove rtag.c.

2001-02-07  Larry Jones  <larry.jones@@sdrc.com>

	* sanity.sh (directory_cmp): Return status rather than setting ISDIFF.
	(basic2): Rewrite using dotest.

2001-02-06  Larry Jones  <larry.jones@@sdrc.com>

	* tag.c, rtag.c: Merge with tag.c being the surviving file.
	* Makefile.in: Update to match.
	* main.c (cmds): rtag() => cvstag().
	* server.c (serve_rtag): Ditto, and set command name.

2001-02-06  Derek Price  <derek.price@@openavenue.com>
	    Rex Jolliff  <Rex_Jolliff@@notes.ymp.gov>
	    Shawn Smith  <Shawn_Smith@@notes.ymp.gov>

	* add.c: Replace opendir, closedir, & readdir calls with CVS_OPENDIR,
	CVS_CLOSEDIR, & CVS_READDIR in support of changes to handle VMS DEC C
	5.7 {open,read,close}dir problems.  Check today's entry in the vms
	subdir for more.
	* filesubr.c: ditto
	* find_names.c: ditto
	* ignore.c: ditto
	* import.c: ditto
	* lock.c: ditto
	* update.c: ditto

2001-02-02  Larry Jones  <larry.jones@@sdrc.com>

	* error.h: Changed include guard macro from _error_h_ to ERROR_H;
	names beginning with underscore are reserved.
	* login.c (password_entry_parseline, password_entry_operation,
	password_entry_operation_e, password_entry_operation_t): Removed
	leading underscore(s).
	(password_entry_parseline): Corrected error messages.
	(password_entry_operation): Fixed uninitialized variable (password).
	(login): Removed unused variable (found_password).

	* rtag.c (rtag_proc): Call lock_tree_for_write() before calling
	start_recursion.  This fixes a serious problem where do_recursion
	was reading and caching RCS files without any locks in place and
	that information was subsequently being used to rewrite the file
	causing any intermediate changes to be lost.
	(rtag_filesdoneproc): Defunct.
	(Reported by Karl Tomlinson <k.tomlinson@@auckland.ac.nz>.)
	* tag.c (cvstag, tag_filesdoneproc): Ditto.
	* lock.c (lock_tree_for_write): Add which argument, change all
	callers to pass W_LOCAL.
	* rcs.h: Ditto.

2001-01-29  Derek Price  <derek.price@@openavenue.com>

	* client.c (get_cvs_port_number): change the prototype to accept a
	const cvsroot_t * as input and add a FIXME comment
	* cvs.h: new prototypes for get_cvs_port_number & normalize_cvsroot
	* login.c (_password_entry_operation): consolidate all the ~/.cvspass
	access into a single new function which reads ~/.cvspass in a backwards
	compatible manner
	(logout): use the new _password_entry_operation function
	(login): ditto
	(get_cvs_password): ditto
	* root.c (normalize_cvsroot): move knowledge of default port & username
	values inside

2001-01-29  Larry Jones  <larry.jones@@sdrc.com>

	* subr.c (shell_escape): New function.
	* cvs.h: Declare it.
	* logmsg.c (logfile_write): Use it to avoid problems with filenames
	containing "'".
	(Reported by Gerhard Ahuis <gerhard@@ats.xs4all.nl>.)

	* server.c (outbuf_memory_error, pserver_authenticate_connection,
	kserver_authenticate_connection): If available, use syslog() to
	record some errors.

2001-01-25  Larry Jones  <larry.jones@@sdrc.com>

	* server.c (do_cvs_command): If there's a partial output line left
	over and the client doesn't support MT, go ahead and send it in an
	M response instead of just dropping it.
	(Reported by Milos Kleint <Milos.Kleint@@netbeans.com>.)

	* update.c (update_fileproc): Handle toss_local_changes in the
	T_NEEDS_MERGE case.
	(Inspired by Noel L Yap <yap_noel@@jpmorgan.com>.)
	* sanity.sh (clean): New tests for above.

2001-01-23  Derek Price  <derek.price@@openavenue.com>

	* run.c (run_exec): flush, if used, stderr and stdout before exit
	* server.c (cvs_flusherr): flush stderr & send a stderr flush command
	on the protocol pipe
	(cvs_flushout): like above, for stdout
	(do_cvs_command): handle flushes properly
	* sanity.sh (reserved): make the commitinfo script echo errors to
	stderr rather than stdin

2001-01-18  Larry Jones  <larry.jones@@sdrc.com>

	* log.c (option_revlist, revlist, log_usage, cvslog,
	log_parse_revlist, log_expand_revlist, log_version_requested): Add
	support for :: for exclusive ranges.
	* admin.c (admin_usage): Reorder -o to be parallel to log -r.
	* sanity.sh (log): New tests for above.

2001-01-18  Derek Price  <derek.price@@openavenue.com>

	* main.c: Add '2001' to the range of copyright years listed by the
	--version option
	* version.c.in (version): check current_parsed_root before its isremote
	member to avoid a core dump
	* sanity.sh (version): add a test for the version command

	* version.c: regenerated

2001-01-12  Larry Jones  <larry.jones@@sdrc.com>

	* rcs.c, rcs.h (RCS_lock, RCS_unlock): Use RCS_gettag to find the
	correct revision so that symbolic tags work correctly.  (This
	requires removing the "const" from the rev parameter since it's
	passed to RCS_gettag which might modify it.)
	(Reported by irina sturm <irina.sturm@@st.com>.)

2001-01-11  Larry Jones  <larry.jones@@sdrc.com>

	* run.c (close_on_exec): Remove check for FD_CLOEXEC.  As far as I
	can see, it's *never* been defined, which defeats the whole point.
	If F_SETFD is defined, it's probably safe to use it.

	* server.c (do_cvs_command): Call close_on_exec on the protocol and
	flow control pipes in the child process so they don't get inherited
	by any subsidiary processes.
	(Reported by Tristan Gingold <tgi@@netgem.com>.)

	* cvs.h (free_cvsroot_t): Spell correctly (was free_CVSroot_t).

2001-01-10  Derek Price  <derek.price@@openavenue.com>
	    Rex Jolliff  <Rex_Jolliff@@notes.ymp.gov>

	* build_src.com: VMS changes
	* filesubr.c: replace calls to unlink() with CVS_UNLINK() for VMS
	* rcs.c: ditto

2001-01-10  Derek Price  <derek.price@@openavenue.com>

	* main.c (current_root): explicitly list this as a static global

2001-01-10  Derek Price  <derek.price@@openavenue.com>

	* cvs.h (get_cvs_port_number): change name & prototype from
	get_port_number
	* client.c (get_cvs_port_number): new function which returns a port
	number based on a cvsroot_t rather than requiring all possible sources
	passed in
	(connect_to_pserver): use new get_cvs_port_number function
	(connect_to_server): ditto
	* login.c (get_password): use new get_cvs_port_number function
	(login): ditto
	(logout): ditto

2001-01-10  Derek Price  <derek.price@@openavenue.com>

	* Makefile.am ($(srcdir)/version.c): specify $(srcdir) for all subparts
	of the build since some systems don't allow mv's across partitions
	* Makefile.in: regenerated

2001-01-10  Derek Price  <derek.price@@openavenue.com>

	* Makefile.am (version.c): specify $(srcdir) explicitly in target rule
	so version.c gets built properly for all makes.
	(version.o): specify $(srcdir)/version.c explicitly so dependency is
	found and built properly
	* Makefile.in: regenerated

2001-01-09  Derek Price  <derek.price@@openavenue.com>

	* version.c: updated timestamp

2001-01-09  Larry Jones  <larry.jones@@sdrc.com>

	* server.c (server): Change to server_temp_dir immediately after
	creating it so that any stray files that happen to be created go
	there instead of in the server's initial directory, wherever that
	may be.
	* sanity.sh (modules5-15): Update to match.

	* version.c.in: Update to match Derek's change to version.c.

2001-01-09  Derek Price  <derek.price@@openavenue.com>

	* cvs.h: Remove the various CVSroot_* bits and replace them with a
	single structure of type cvsroot_t (current_parsed_root)

	* root.c (parse_cvsroot): return pointer to a new cvsroot_t rather than
	altering global variables
	(local_cvsroot): return a pointer to a new cvsroot_t rather than
	setting globals.  changed the name of this function from
	set_local_cvsroot to better explain new functionality
	(new_cvsroot_t): new initializer function
	(free_cvsroot_t): new function
	(others): use current_parsed_root rather than the old CVSroot_* globals

	* add.c: use current_parsed_root rather than the old CVSroot_* globals
	* admin.c: ditto
	* checkout.c: ditto
	* client.c: ditto
	* commit.c: ditto
	* create_adm.c: ditto
	* diff.c: ditto
	* edit.c: ditto
	* expand_path.c: ditto
	* find_names.c: ditto
	* history.c: ditto
	* ignore.c: ditto
	* import.c: ditto
	* lock.c: ditto
	* log.c: ditto
	* login.c: ditto
	* logmsg.c: ditto
	* main.c: ditto
	* mkmodules.c: ditto
	* modules.c: ditto
	* parseinfo.c: ditto
	* patch.c: ditto
	* rcs.c: ditto
	* recurse.c: ditto
	* release.c: ditto
	* remove.c: ditto
	* repos.c: ditto
	* rtag.c: ditto
	* server.c: ditto
	* status.c: ditto
	* tag.c: ditto
	* update.c: ditto
	* version.c: ditto
	* watch.c: ditto
	* wrapper.c: ditto

2001-01-05  Derek Price  <derek.price@@openavenue.com>

	* cvs.h (enum CVSmethod): add null_method
	* root.c (method_names): correlate null_method & "undefined"
	(parse_cvsroot): make two error cases non fatal
	* sanity.sh (crerepos-6b): account for new error message, re above

2001-01-05  Derek Price  <derek.price@@openavenue.com>

	* src/Makefile.am (cvsbug, cvsbug_EXTRA_DIST, EXTRA_DIST): move cvsbug
	target to configure.in - see ../ChangeLog for more
	* src/cvsbug.in: Rename from cvsbug.sh
	* src/cvsbug.sh: Rename to cvsbug.in

2001-01-04  Larry Jones  <larry.jones@@sdrc.com>

	* Makefile.am (cvsbug): Explicitly list input file ($< is only
	valid in inference rules).
	* Makefile.in: Ditto.

2001-01-04  Derek Price  <derek.price@@openavenue.com>

	* sanity.sh: use getopts rather than getopt for portability reasons

2001-01-03  Derek Price  <derek.price@@openavenue.com>

	* Makefile.am (remotecheck): depend on 'all'
	* Makefile.in: regenerated

2000-12-29  Derek Price  <derek.price@@openavenue.com>

	* sanity.sh: remove explicit "$@@" from last checkin and move the 'do'
	to the line following the 'for'.  Apparently this is more portable.

2000-12-29  Derek Price  <derek.price@@openavenue.com>

	* sanity.sh: make "$@@" explicit in 'for' statement since Solaris 5.6's
	implementation of Bourne shell doesn't seem to implement this default
	behavior.

2000-12-27  Derek Price  <derek.price@@openavenue.com>

	* sanity.sh: add a -f option for continuing from a particular test
	and shorten --keep to -k so we can use the getopt function.

2000-12-27  Derek Price  <derek.price@@openavenue.com>

	* Makefile.am (remotecheck): Make remotecheck dependant on all
	* Makefile.in: regenerated

2000-12-26  Derek Price  <derek.price@@openavenue.com>

	* Makefile.in: update timestamp
	* stamp-h2.in: ditto
	* version.c: ditto

2000-12-26  Derek Price  <derek.price@@openavenue.com>

	* Makefile.am: new target for version.c
	(EXTRA_DIST): add version.c.in & version.c so builds work when
	configure doesn't
	* Makefile.in: Regenerated
	* stamp-h2.in: update timestamp
	* version.c: ditto

2000-12-26  Derek Price  <derek.price@@openavenue.com>

	* Makefile.am (INCLUDES): add zlib
	* Makefile.in: Regenerated

2000-12-22  Derek Price  <derek.price@@openavenue.com>

	* Makefile.am (DISTCLEANFILES): added a few files
	(INCLUDES): commented
        * Makefile.in: Regenerated

2000-12-21  Derek Price  <derek.price@@openavenue.com>

	* .cvsignore: Added .deps directory and a new stamp file
	* Makefile.am: New file needed by Automake
	* Makefile.in: Regenerated
	* stamp-h2.in: New stamp file created by Automake
	* version.c.in: use configure to generate version.c

2000-12-16  Derek Price  <derek.price@@openavenue.com>

	* server.c (server_update): Keep the vers structure up to date after
	sending a Remove or Remove-entry command to the client
	* update.c (update): remove call to server_updated() after
	scratch_file()
	(scratch_file): in server mode, call server_updated(), otherwise keep
	the vers structure up to date
	(join_file): add a trace, save the revision to Register() on a remove
	before calling server_scratch & server_updated
	* sanity.sh (join): Add test for a remove/add caused by an update
	to a new branch and a join in the same step.

2000-12-15  Larry Jones  <larry.jones@@sdrc.com>

	* error.c (error): Add %ld and %lu.

	* history.c: Change hrec.idx from int to long, reformat NEXT_BAR
	for readability, add hrec_idx.
	(fill_hrec): Change initialization to be portable and always set
	idx so it can be used as a line number in error messages; improve
	parsing and error checking.
	(read_hrecs): Initialize hrec_idx, handle embedded NULs, warn about
	no newline at end of file.
	(select_hrec): Add basic validity checking.

2000-12-07  Larry Jones  <larry.jones@@sdrc.com>

	* history.c (history): Allow multiple -m options as documented.

2000-11-29  Derek Price  <derek.price@@openavenue.com>

	* root.c (parse_cvsroot): back out yesterday's redundant changes
	* main.c (main): fix CVSROOT trace message to look like other trace
	messages
	* sanity.sh (multiroot2-9): expect new trace message

2000-11-28  Derek Price  <derek.price@@openavenue.com>

	* root.c (parse_cvsroot): add trace on this function
	* client.c (get_port_number): make trace print look like others

2000-11-16  Derek Price  <derek.price@@openavenue.com>

	* filesubr.c (cvs_temp_file): back out the previous change in the
	interests of portability, add an assertion, and fix the header comment

2000-11-16  Derek Price  <derek.price@@openavenue.com>

	* filesubr.c (cvs_temp_file): refine the exit behavior to notice if
	the out param was passed in NULL and, if so, avoid setting it and delete
	the temp file for later

2000-11-16  Derek Price  <derek.price@@openavenue.com>

	* filesubr.c (cvs_temp_file): fixed a garble or two, added some
	additional error checking, and added a comment

2000-11-15  Derek Price  <derek.price@@openavenue.com>

	* filesubr.c (cvs_temp_file): added cvs_temp_file
	function to use mkstemp rather than one of the other temp file
	generators as gcc keeps complaining I should.
	(cvs_temp_name): altered this function to simply wrap cvs_temp_file
	and deprecated it
	* cvs.h: added prototype for cvs_temp_file
	* commit.c (commit): use the new function instead of the old and plug
	an old (though related) memory leak.
	* import.c (import): use the new function
	* login.c (login): Ditto
	* logmsg.c (do_editor, do_verify): Ditto
	* patch.c (patch_fileproc): Ditto

2000-11-14  Larry Jones  <larry.jones@@sdrc.com>

	* update.c, update.h (do_update): Add xdotemplate parameter.
	Change all callers.
	(update_dirent_proc): Use dotemplate for Create_Admin, not 1.
	* checkout.c (checkout_proc): Don't create CVS/Template if
	exporting.
	(Reported by Andrey Podkolzin <mdh@@zenon.net>.)

2000-11-08  Larry Jones  <larry.jones@@sdrc.com>

	* admin.c (admin): Use getgroups() to check for membership in
	CVS_ADMIN_GROUP if it exists.  In any event, check the user's
	primary group in addition to any additional groups.
	(Reported by Thomas Okken <TOkken@@refco.com>.)

2000-11-06  Jim Meyering  <meyering@@lucent.com>

	Compile with gcc's -Wformat and fix the exposed problems.
	* root.c (parse_cvsroot) [! HAVE_KERBEROS]: Provide an argument
	for the %s error format spec.
	[! HAVE_GSSAPI]: Likewise.
	(normalize_cvsroot): Put comment delimiters around token after `#endif'.

2000-11-03  Larry Jones  <larry.jones@@sdrc.com>

	* sanity.sh: Some versions of sed require a space between -e and
	the value.

2000-10-27  Larry Jones  <larry.jones@@sdrc.com>

	* checkout.c (checkout): Don't check for a safe location if just
	cat'ing the module database.
	(Reported by Ilya Martynov <m_ilya@@agava.com>.)
	Have -s set cat as well as status; it simplifies the code.

2000-10-26  Larry Jones  <larry.jones@@sdrc.com>

	* sanity.sh (join-admin-2): Check output from all commands instead
	of (mostly) discarding.  (Some of the tests used to produce stray
	output in remote mode.)

	* sanity.sh (dotest_line_by_line): Handle empty lines in pattern
	(expr doesn't distingish between successfully matching nothing
	and failing to match anything).

	* sanity.sh (dotest_internal): Rearrange and use elif to simplify.

2000-10-24  Jim Meyering  <meyering@@lucent.com>

	Fix a bug, introduced with my fix of 2000-07-10, whereby -kk would
	sometimes be ignored for some of the files involved in an update.

	* update.c (join_file): Restore the original value of `options'
	right after calling checkout_file.
	* sanity.sh (join-admin-2): New test for this.

2000-10-23  Derek Price  <derek.price@@openavenue.com>
            James Youngman  <jay@@gnu.org>

	* sanity.sh: it's /gnu/bin, not /gun/bin.  Thanks go to James Youngman
	<jay@@gnu.org> for the bug report and patch.

2000-10-20  Jim Kingdon  <http://sourceforge.net/users/kingdon/>

	* server.c (switch_to_user): Set CVS_USER.  Patch from Sudish
	Joseph and popularized by dozens (e.g. mozilla.org, also others).

2000-10-20  Derek Price  <derek.price@@openavenue.com>
            KOIE Hidetaka  <hide@@koie.org>

	* root.c (normalize_cvsroot): plug a memory leak.  Thanks to
	KOIE Hidetaka <hide@@koie.org>

2000-10-18  Derek Price  <derek.price@@openavenue.com>

	* client.c (connect_to_pserver): added a close brace the lack of which
	was preventing compilation when gssapi was enabled.  Removed a
	redundant check for HAVE_KERBEROS.

2000-10-18  Derek Price  <derek.price@@openavenue.com>

	* root.c (normalize_cvsroot): removed references to free_port_s and the
	now useless call to free now that port_s is on the stack.  Thanks to
	Jon Miner.

2000-10-18  Derek Price  <derek.price@@openavenue.com>

	* root.c (normalize_cvsroot): remove calls to snprintf for
	compatibility with M$ Windoze.

2000-10-18  Derek Price  <derek.price@@openavenue.com>

	* sanity.sh (crerepos-6a, crerepos-6a-r): fix a "?" in a regex & pipe
	the output of a test to /dev/null since we don't know what error
	messages specific rsh implementations will output.

2000-10-17  Derek Price  <derek.price@@openavenue.com>

	* cvs.h: added CVSroot_password variable. Provided prototypes for
	get_port_number & normalize_cvsroot.
	* client.c (get_port_number): Fixed an ANSI prototype I had included
	for get_port_number.
	* login.c (login, logout): Removed two checks for a non-null
	CVSroot_username since parse_cvsroot now supplies a default in pserver
	mode. allow for a password in CVSROOT
	(get_cvs_passsword): return CVSroot_password if it was supplied
	in the CVSROOT.
	* root.c (parse_cvsroot): Changed CVSROOT spec from
	:method:user@@host/port:/cvsroot to
	:method:[[user][:password]@@]host[:[port]]/cvsroot
	Removed the xstrdup function since we'd rather have the error checking
	from the version in subr.c anyhow.  Moved some error messages which
	looked like they would print the wrong error message after a failed
	connect_to_gserver call.
	(normalize_cvsroot): return a normalized CVSROOT for use in the
	.cvspass file.
	* sanity.sh (crerepos-6): fix a test which was expecting an old error
	message.

	* client.c (connect_to_pserver): Moved some error messages which looked like they
	would print the wrong error message after a failed connect_to_gserver
	call.

	* login.c (login): Paranoiacly zero a password in memory.

2000-10-12  Derek Price  <derek.price@@openavenue.com>

	* client.c (auth_server_port_number -> get_port_number, start_pserver,
	start_tcp_server): use a port specified in CVSROOT instead of the
	default port.  Failing that, use the CVS_CLIENT_PORT environment
	variable.
	* cvs.h: Added global CVSroot_port & renamed auth_server_port_number.
	* root.c (parse_cvsroot): Parse the new CVSROOT format properly.
	Incidentally reformated some error messages for uniformity and
	readability.
	* sanity.sh (crerepos): fix two tests which were now expecting the
	wrong error message.

2000-10-11  Larry Jones  <larry.jones@@sdrc.com>

	* server.c (pserver_authenticate_connection): Fix stupid mistake
	in previous change.

2000-10-11  Derek Price  <derek.price@@openavenue.com>

	* main.c (main): Dispose old CVSroot when parsing a '-d' option if
	free_CVSroot is set.
	* root.c (parse_cvsroot): remove references to 'cvsroot_parsed', a
	static boolean I expect hasn't been used since CVS learned to handle
	multiple CVSROOTs.

2000-10-10  Larry Jones  <larry.jones@@sdrc.com>

	* server.c (print_error): Make up a message if strerror fails.

	* server.c (pserver_authenticate_connection): Give a real error
	message for an invalid repository.

2000-10-06  Derek Price  <derek.price@@openavenue.com>

	* add.c (add): Made quiet mode affect some warning messages as seemed
	appropriate.  Specifically, some of the messages which a user might
	want to ignore so they don't have to be quite so specific on the
	command line: files added twice, files already in the repository and
	check out properly (i.e. but picked up by 'cvs add *'), & files which
	are readded in place of a dead revision or onto a branch.  '-q' will
	not change the non-zero exit code for the cases where at least one
	passed in file name was already in the Entries file.  There seems to
	be a precedent in remove.c.
	* remove.c (cvsremove): switched the "use cvs ci to make these changes
	permanent message" to only print w/o '-Q' to match the new behavior of
	add.  This seems appropriate as '-Q' is defined to restrict messages
	to critical errors.
	* sanity.sh (adderrmsg): Added some tests for the above behavior.

2000-10-05  Larry Jones  <larry.jones@@sdrc.com>

	* client.c (call_in_directory): Create CVSADM directory if it doesn't
	exist in the directory.  This makes client/server work more like
	standalone when checking out into an existing (non-CVS) directory.
	* sanity.sh (dirs2, conflicts3, toplevel): Update to match.

2000-10-03  Larry Jones  <larry.jones@@sdrc.com>

	* filesubr.c (get_homedir): Ignore $HOME when running in server mode.

2000-10-02  Larry Jones  <larry.jones@@sdrc.com>

	* cvs.h: Define (and use) T_PATCH as a valid file classification
	even when SERVER_SUPPORT isn't defined -- it simplifies the code.
	* classify.c (Classify_File): Ditto.
	* commit.c (check_fileproc): Ditto.
	* status.c (status_fileproc): Ditto.
	* update.c (update_fileproc): Ditto.
	* tag.c (check_fileproc): Accept T_PATCH in addition to T_CHECKOUT.
	* sanity.sh (tagc-10): Update to match.

2000-09-29  Larry Jones  <larry.jones@@sdrc.com>

	* client.c (get_responses_and_close): Reset server_fd to -1 after
	shutting down.
	(Reported by Joerg Thoennes <Joerg.Thoennes@@data-sciences.de>.)

2000-09-27  Larry Jones  <larry.jones@@sdrc.com>

	* commit.c (commit): Don't sleep before returning in server mode,
	just let the client do it.
	* update.c (do_update): Ditto.

	* sanity.sh (find_tool): Correct method of checking for GNU tools.

	* checkout.c (checkout_proc): Match up user directories with
	repository directories instead of using Emptydir.
	* sanity.sh (cvsadm, emptydir): Update to match.

2000-09-19  Larry Jones  <larry.jones@@sdrc.com>

	* version.c: Push version number to 1.11.0.1.
@


