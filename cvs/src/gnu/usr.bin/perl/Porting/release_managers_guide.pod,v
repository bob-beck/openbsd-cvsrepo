head	1.3;
access;
symbols
	OPENBSD_6_0:1.2.0.4
	OPENBSD_6_0_BASE:1.2
	OPENBSD_5_9:1.1.1.6.0.2
	OPENBSD_5_9_BASE:1.1.1.6
	OPENBSD_5_8:1.1.1.6.0.4
	OPENBSD_5_8_BASE:1.1.1.6
	PERL_5_20_2:1.1.1.6
	OPENBSD_5_7:1.1.1.5.0.2
	OPENBSD_5_7_BASE:1.1.1.5
	PERL_5_20_1:1.1.1.5
	OPENBSD_5_6:1.1.1.4.0.4
	OPENBSD_5_6_BASE:1.1.1.4
	PERL_5_18_2:1.1.1.4
	PERL:1.1.1
	OPENBSD_5_5:1.1.1.3.0.6
	OPENBSD_5_5_BASE:1.1.1.3
	OPENBSD_5_4:1.1.1.3.0.2
	OPENBSD_5_4_BASE:1.1.1.3
	PERL_5_16_3:1.1.1.3
	OPENBSD_5_3:1.1.1.2.0.10
	OPENBSD_5_3_BASE:1.1.1.2
	OPENBSD_5_2:1.1.1.2.0.8
	OPENBSD_5_2_BASE:1.1.1.2
	OPENBSD_5_1_BASE:1.1.1.2
	OPENBSD_5_1:1.1.1.2.0.6
	OPENBSD_5_0:1.1.1.2.0.4
	OPENBSD_5_0_BASE:1.1.1.2
	OPENBSD_4_9:1.1.1.2.0.2
	OPENBSD_4_9_BASE:1.1.1.2
	PERL_5_12_2:1.1.1.2
	OPENBSD_4_8:1.1.1.1.0.4
	OPENBSD_4_8_BASE:1.1.1.1
	OPENBSD_4_7:1.1.1.1.0.2
	OPENBSD_4_7_BASE:1.1.1.1
	PERL_5_10_1:1.1.1.1
	CPAN:1.1.1;
locks; strict;
comment	@# @;
expand	@o@;


1.3
date	2017.02.05.00.31.54;	author afresh1;	state Exp;
branches;
next	1.2;
commitid	cxJ08BvJA9Pt2PTM;

1.2
date	2016.07.03.01.07.56;	author afresh1;	state Exp;
branches;
next	1.1;
commitid	GzHqjSTnBjdF7Wcw;

1.1
date	2009.10.12.18.10.45;	author millert;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2009.10.12.18.10.45;	author millert;	state Exp;
branches;
next	1.1.1.2;

1.1.1.2
date	2010.09.24.14.49.21;	author millert;	state Exp;
branches;
next	1.1.1.3;

1.1.1.3
date	2013.03.25.20.09.31;	author sthen;	state Exp;
branches;
next	1.1.1.4;

1.1.1.4
date	2014.03.24.14.59.09;	author afresh1;	state Exp;
branches;
next	1.1.1.5;

1.1.1.5
date	2014.11.17.20.53.16;	author afresh1;	state Exp;
branches;
next	1.1.1.6;
commitid	B31cAbBIXiCqnL97;

1.1.1.6
date	2015.04.25.19.10.46;	author afresh1;	state Exp;
branches;
next	;
commitid	Wpcs5S8qILgEZC7F;


desc
@@


1.3
log
@Fix merge issues, remove excess files - match perl-5.24.1 dist
@
text
@=encoding utf8

=head1 NAME

release_managers_guide - Releasing a new version of perl 5.x

Note that things change at each release, so there may be new things not
covered here, or tools may need updating.

=head1 MAKING A CHECKLIST

If you are preparing to do a release, you can run the
F<Porting/make-rmg-checklist> script to generate a new version of this
document that starts with a checklist for your release.

This script is run as:

    perl Porting/make-rmg-checklist \
        --type [BLEAD-POINT or MAINT or ...] > /tmp/rmg.pod

You can also pass the C<--html> flag to generate an HTML document instead of
POD.

    perl Porting/make-rmg-checklist --html \
        --type [BLEAD-POINT or MAINT or ...] > /tmp/rmg.html

=head1 SYNOPSIS

This document describes the series of tasks required - some automatic, some
manual - to produce a perl release of some description, be that a release
candidate, or final, numbered release of maint or blead.

The release process has traditionally been executed by the current
pumpking. Blead releases from 5.11.0 forward are made each month on the
20th by a non-pumpking release engineer.  The release engineer roster
and schedule can be found in Porting/release_schedule.pod.

This document both helps as a check-list for the release engineer
and is a base for ideas on how the various tasks could be automated
or distributed.

The checklist of a typical release cycle is as follows:

    (5.10.1 is released, and post-release actions have been done)

    ...time passes...

    a few weeks before the release, a number of steps are performed,
	including bumping the version to 5.10.2

    ...a few weeks pass...

    perl-5.10.2-RC1 is released

    perl-5.10.2 is released

    post-release actions are performed, including creating new
	perldelta.pod

    ... the cycle continues ...

=head1 DETAILS

Some of the tasks described below apply to all four types of
release of Perl. (blead, RC, final release of maint, final
release of blead). Some of these tasks apply only to a subset
of these release types.  If a step does not apply to a given
type of release, you will see a notation to that effect at
the beginning of the step.

=head2 Release types

=over 4

=item Release Candidate (RC)

A release candidate is an attempt to produce a tarball that is a close as
possible to the final release. Indeed, unless critical faults are found
during the RC testing, the final release will be identical to the RC
barring a few minor fixups (updating the release date in F<perlhist.pod>,
removing the RC status from F<patchlevel.h>, etc). If faults are found,
then the fixes should be put into a new release candidate, never directly
into a final release.


=item Stable/Maint release (MAINT).

A release with an even version number, and subversion number > 0, such as
5.14.1 or 5.14.2.

At this point you should have a working release candidate with few or no
changes since.

It's essentially the same procedure as for making a release candidate, but
with a whole bunch of extra post-release steps.

Note that for a maint release there are two versions of this guide to
consider: the one in the maint branch, and the one in blead. Which one to
use is a fine judgement. The blead one will be most up-to-date, while
it might describe some steps or new tools that aren't applicable to older
maint branches. It is probably best to review both versions of this
document, but to most closely follow the steps in the maint version.

=item A blead point release (BLEAD-POINT)

A release with an odd version number, such as 5.15.0 or 5.15.1.

This isn't for production, so it has less stability requirements than for
other release types, and isn't preceded by RC releases. Other than that,
it is similar to a MAINT release.

=item Blead final release (BLEAD-FINAL)

A release with an even version number, and subversion number == 0, such as
5.14.0. That is to say, it's the big new release once per year.

It's essentially the same procedure as for making a release candidate, but
with a whole bunch of extra post-release steps, even more than for MAINT.

=back

=for checklist begin

=head2 Prerequisites

Before you can make an official release of perl, there are a few
hoops you need to jump through:

=head3 PAUSE account with pumpkin status

Make sure you have a PAUSE account suitable for uploading a perl release.
If you don't have a PAUSE account, then request one:

    https://pause.perl.org/pause/query?ACTION=request_id

Check that your account is allowed to upload perl distros: go to
L<https://pause.perl.org/pause/authenquery?ACTION=who_pumpkin> and check that
your PAUSE ID is listed there.  If not, ask Andreas KE<0xf6>nig to add your ID
to the list of people allowed to upload something called perl.  You can find
Andreas' email address at:

    https://pause.perl.org/pause/query?ACTION=pause_04imprint

=head3 rt.perl.org update access

Make sure you have permission to close tickets on L<http://rt.perl.org/>
so you can respond to bug report as necessary during your stint.  If you
don't, make an account (if you don't have one) and contact the pumpking
with your username to get ticket-closing permission.

=head3 git checkout and commit bit

You will need a working C<git> installation, checkout of the perl
git repository and perl commit bit.  For information about working
with perl and git, see F<pod/perlgit.pod>.

If you are not yet a perl committer, you won't be able to make a
release.  Have a chat with whichever evil perl porter tried to talk
you into the idea in the first place to figure out the best way to
resolve the issue.

=head3 web-based file share

You will need to be able to share tarballs with #p5p members for
pre-release testing, and you may wish to upload to PAUSE via URL.
Make sure you have a way of sharing files, such as a web server or
file-sharing service.

Porters have access to the "dromedary" server (users.perl5.git.perl.org),
which has a F<public_html> directory to share files with.
(L<http://users.perl5.git.perl.org/~username/perl-5.xx.y.tar.gz>)

If you use Dropbox, you can append "raw=1" as a parameter to their usual
sharing link to allow direct download (albeit with redirects).

=head3 git clone of https://github.com/perlorg/perlweb

For updating the L<http://dev.perl.org> web pages, either a Github account or
sweet-talking somebody with a Github account into obedience is needed. This
is only needed on the day of the release or shortly afterwards.

=head3 Quotation for release announcement epigraph

You will need a quotation to use as an epigraph to your release announcement.

=head3 Install the previous version of perl

During the testing phase of the release you have created, you will be
asked to compare the installed files with a previous install. Save yourself
some time on release day, and have a (clean) install of the previous
version ready.

=head2 Building a release - advance actions

The work of building a release candidate for an even numbered release
(BLEAD-FINAL) of perl generally starts several weeks before the first
release candidate.  Some of the following steps should be done regularly,
but all I<must> be done in the run up to a release.

=head3 dual-life CPAN module synchronisation

To see which core distro versions differ from the current CPAN versions:

    $ ./perl -Ilib Porting/core-cpan-diff -x -a

However, this only checks whether the version recorded in
F<Porting/Maintainers.pl> differs from the latest on CPAN.  It doesn't tell you
if the code itself has diverged from CPAN.

You can also run an actual diff of the contents of the modules, comparing core
to CPAN, to ensure that there were no erroneous/extraneous changes that need to
be dealt with. You do this by not passing the C<-x> option:

    $ ./perl -Ilib Porting/core-cpan-diff -a -o /tmp/corediffs

Passing C<-u cpan> will probably be helpful, since it limits the search to
distributions with 'cpan' upstream source.  (It's OK for blead upstream to
differ from CPAN because those dual-life releases usually come I<after> perl
is released.)

See also the C<-d> and C<-v> options for more detail (and the C<-u> option as
mentioned above).  You'll probably want to use the C<-c cachedir> option to
avoid repeated CPAN downloads and may want to use C<-m file:///mirror/path> if
you made a local CPAN mirror. Note that a minicpan mirror won't actually work,
but can provide a good first pass to quickly get a list of modules which
definitely haven't changed, to avoid having to download absolutely everything.

For a BLEAD-POINT or BLEAD-FINAL release with 'cpan' upstream, if a CPAN
release appears to be ahead of blead, then consider updating it (or asking the
relevant porter to do so). (However, if this is a BLEAD-FINAL release or one of
the last BLEAD-POINT releases before it and hence blead is in some kind of
"code freeze" state (e.g. the sequence might be "contentious changes freeze",
then "user-visible changes freeze" and finally "full code freeze") then any
CPAN module updates must be subject to the same restrictions, so it may not be
possible to update all modules until after the BLEAD-FINAL release.) If blead
contains edits to a 'cpan' upstream module, this is naughty but sometimes
unavoidable to keep blead tests passing. Make sure the affected file has a
CUSTOMIZED entry in F<Porting/Maintainers.pl>.

If you are making a MAINT release, run C<core-cpan-diff> on both blead and
maint, then diff the two outputs. Compare this with what you expect, and if
necessary, fix things up. For example, you might think that both blead
and maint are synchronised with a particular CPAN module, but one might
have some extra changes.

=head3 How to sync a CPAN module with a cpanE<sol> distro

=over 4

=item *

Fetch the most recent version from CPAN.

=item *

Unpack the retrieved tarball. Rename the old directory; rename the new
directory to the original name.

=item *

Restore any F<.gitignore> file. This can be done by issuing
C<git checkout .gitignore> in the F<cpan/Distro> directory.

=item *

Remove files we do not need. That is, remove any files that match the
entries in C<@@IGNORABLE> in F<Porting/Maintainers.pl>, and anything that
matches the C<EXCLUDED> section of the distro's entry in the C<%Modules>
hash.

=item *

Restore any files mentioned in the C<CUSTOMIZED> section, using
C<git checkout>. Make any new customizations if necessary. Also,
restore any files that are mentioned in C<@@IGNORE>, but were checked
into the repository anyway.

=item *

For any new files in the distro, determine whether they are needed.
If not, delete them, and list them in either C<EXCLUDED> or C<@@IGNORABLE>.
Otherwise, add them to C<MANIFEST>, and run C<git add> to add the files
to the repository.

=item *

For any files that are gone, remove them from C<MANIFEST>, and use
C<git rm> to tell git the files will be gone.

=item *

If the C<MANIFEST> file was changed in any of the previous steps, run
C<perl Porting/manisort --output MANIFEST.sort; mv MANIFEST.sort MANIFEST>.

=item *

For any files that have an execute bit set, either remove the execute
bit, or edit F<Porting/exec-bit.txt>

=item *

Run C<make> (or C<nmake> on Windows), see if C<perl> compiles.

=item *

Run the tests for the package.

=item *

Run the tests in F<t/porting> (C<make test_porting>).

=item *

Update the C<DISTRIBUTION> entry in F<Porting/Maintainers.pl>.

=item *

Run a full configure/build/test cycle.

=item *

If everything is ok, commit the changes.

=back

For entries with a non-simple C<FILES> section, or with a C<MAP>, you
may have to take more steps than listed above.

F<Porting/sync-with-cpan> is a script that automates most of the steps
above; but see the comments at the beginning of the file.  In particular,
it has not yet been exercised on Windows, but will certainly require a set
of Unix tools such as Cygwin, and steps that run C<make> will need to run
C<nmake> instead.

=head3 dual-life CPAN module stability

Ensure dual-life CPAN modules are stable, which comes down to:

   for each module that fails its regression tests on $current
       did it fail identically on $previous?
       if yes, "SEP" (Somebody Else's Problem)
       else work out why it failed (a bisect is useful for this)

   attempt to group failure causes

   for each failure cause
       is that a regression?
       if yes, figure out how to fix it
           (more code? revert the code that broke it)
       else
           (presumably) it's relying on something un-or-under-documented
           should the existing behaviour stay?
               yes - goto "regression"
               no - note it in perldelta as a significant bugfix
               (also, try to inform the module's author)

=head3 monitor smoke tests for failures

Similarly, monitor the smoking of core tests, and try to fix.  See
L<http://smoke.procura.nl/index.html>, L<http://perl5.test-smoke.org/>
and L<http://perl.develop-help.com> for a summary. See also
L<http://www.nntp.perl.org/group/perl.daily-build.reports/> which has
the raw reports.

Similarly, monitor the smoking of perl for compiler warnings, and try to
fix.

=for checklist skip BLEAD-POINT

=head3 monitor CPAN testers for failures

For any release except a BLEAD-POINT: Examine the relevant analysis report(s)
at http://analysis.cpantesters.org/beforemaintrelease to see how the impending
release is performing compared to previous releases with regard to building
and testing CPAN modules.

That page accepts a query parameter, C<pair> that takes a pair of
colon-delimited versions to use for comparison.  For example:

http://analysis.cpantesters.org/beforemaintrelease?pair=5.20.2:5.22.0%20RC1

=head3 update perldelta

Get perldelta in a mostly finished state.

Read  F<Porting/how_to_write_a_perldelta.pod>, and try to make sure that
every section it lists is, if necessary, populated and complete. Copy
edit the whole document.

You won't be able to automatically fill in the "Updated Modules" section until
after Module::CoreList is updated (as described below in
L<"update Module::CoreList">).

=head3 Bump the version number

Do not do this yet for a BLEAD-POINT release! You will do this at the end of
the release process.

Increase the version number (e.g. from 5.12.0 to 5.12.1).

For a release candidate for a stable perl, this should happen a week or two
before the first release candidate to allow sufficient time for testing and
smoking with the target version built into the perl executable. For
subsequent release candidates and the final release, it is not necessary to
bump the version further.

There is a tool to semi-automate this process:

    $ ./perl -Ilib Porting/bump-perl-version -i 5.10.0 5.10.1

Remember that this tool is largely just grepping for '5.10.0' or whatever,
so it will generate false positives. Be careful not change text like
"this was fixed in 5.10.0"!

Use git status and git diff to select changes you want to keep.

Be particularly careful with F<INSTALL>, which contains a mixture of
C<5.10.0>-type strings, some of which need bumping on every release, and
some of which need to be left unchanged.
See below in L<"update INSTALL"> for more details.

For the first RC release leading up to a BLEAD-FINAL release, update the
description of which releases are now "officially" supported in
F<pod/perlpolicy.pod>.

When doing a BLEAD-POINT or BLEAD-FINAL release, also make sure the
C<PERL_API_*> constants in F<patchlevel.h> are in sync with the version
you're releasing, unless you're absolutely sure the release you're about to
make is 100% binary compatible to an earlier release. When releasing a MAINT
perl version, the C<PERL_API_*> constants C<MUST NOT> be changed as we aim
to guarantee binary compatibility in maint branches.

After editing, regenerate uconfig.h (this must be run on a system with a
/bin/sh available):

 $ perl regen/uconfig_h.pl

This might not cause any new changes.

You may also need to regen opcodes:

 $ ./perl -Ilib regen/opcode.pl

Test your changes:

 $ git clean -xdf   # careful if you don't have local files to keep!
 $ ./Configure -des -Dusedevel
 $ make
 $ make test

Do note that at this stage, porting tests will fail. They will continue
to fail until you've updated Module::CoreList, as described below.

Commit your changes:

 $ git status
 $ git diff
 B<review the delta carefully>

 $ git commit -a -m 'Bump the perl version in various places for 5.x.y'

At this point you may want to compare the commit with a previous bump to
see if they look similar.  See commit f7cf42bb69 for an example of a
previous version bump.

When the version number is bumped, you should also update Module::CoreList
(as described below in L<"update Module::CoreList">) to reflect the new
version number.

=head3 update INSTALL

Review and update INSTALL to account for the change in version number.
The lines in F<INSTALL> about "is not binary compatible with" may require a
correct choice of earlier version to declare incompatibility with. These are
in the "Changes and Incompatibilities" and "Coexistence with earlier versions
of perl 5" sections.

Be particularly careful with the section "Upgrading from 5.X.Y or earlier".
The "X.Y" needs to be changed to the most recent version that we are
I<not> binary compatible with.

For MAINT and BLEAD-FINAL releases, this needs to refer to the last
release in the previous development cycle (so for example, for a 5.14.x
release, this would be 5.13.11).

For BLEAD-POINT releases, it needs to refer to the previous BLEAD-POINT
release (so for 5.15.3 this would be 5.15.2).  If the last release manager
followed instructions, this should have already been done after the last
blead release, so you may find nothing to do here.

=head3 Check copyright years

Check that the copyright years are up to date by running:

    $ ./perl t/porting/copyright.t --now

Remedy any test failures by editing README or perl.c accordingly (search for
the "Copyright"). If updating perl.c, check if the file's own copyright date in
the C comment at the top needs updating, as well as the one printed by C<-v>.

=head3 Check more build configurations

Try running the full test suite against multiple Perl configurations. Here are
some sets of Configure flags you can try:

=over 4

=item *

C<-Duseshrplib -Dusesitecustomize>

=item *

C<-Duserelocatableinc>

=item *

C<-Dusethreads>

=back

If you have multiple compilers on your machine, you might also consider
compiling with C<-Dcc=$other_compiler>.

=head3 update perlport

L<perlport> has a section currently named I<Supported Platforms> that
indicates which platforms are known to build in the current release.
If necessary update the list and the indicated version number.

=head3 check a readonly build

Even before other prep work, follow the steps in  L<build the tarball> and test
it locally.  Because a perl source tarballs sets many files read-only, it could
test differently than tests run from the repository.  After you're sure
permissions aren't a problem, delete the generated directory and tarballs.

=head2 Building a release - on the day

This section describes the actions required to make a release
that are performed near to, or on the actual release day.

=head3 re-check earlier actions

Review all the actions in the previous section,
L<"Building a release - advance actions"> to ensure they are all done and
up-to-date.

=head3 create a release branch

For BLEAD-POINT releases, making a release from a release branch avoids the
need to freeze blead during the release. This is less important for
BLEAD-FINAL, MAINT, and RC releases, since blead will already be frozen in
those cases. Create the branch by running

    git checkout -b release-5.xx.yy

=head3 build a clean perl

Make sure you have a gitwise-clean perl directory (no modified files,
unpushed commits etc):

    $ git status
    $ git clean -dxf

then configure and build perl so that you have a Makefile and porting tools:

    $ ./Configure -Dusedevel -des && make

=head3 Check module versions

For each Perl release since the previous release of the current branch, check
for modules that have identical version numbers but different contents by
running:

    $ ./perl -Ilib Porting/cmpVERSION.pl --tag=v5.X.YY

(This is done automatically by F<t/porting/cmp_version.t> for the previous
release of the current branch, but not for any releases from other branches.)

Any modules that fail will need a version bump, plus a nudge to the upstream
maintainer for 'cpan' upstream modules.

=head3 update Module::CoreList

=head4 Bump Module::CoreList* $VERSIONs

If necessary, bump C<$Module::CoreList::VERSION> (there's no need to do this
for every RC; in RC1, bump the version to a new clean number that will
appear in the final release, and leave as-is for the later RCs and final).
It may also happen that C<Module::CoreList> has been modified in blead, and
hence has a new version number already.  (But make sure it is not the same
number as a CPAN release.)

C<$Module::CoreList::TieHashDelta::VERSION> and
C<$Module::CoreList::Utils::VERSION> should always be equal to
C<$Module::CoreList::VERSION>. If necessary, bump those two versions to match
before proceeding.

The files to modify are: F<dist/Module-CoreList/lib/Module/CoreList.pm>,
F<dist/Module-CoreList/lib/Module/CoreList/Utils.pm> and
F<dist/Module-CoreList/lib/Module/CoreList/TieHashDelta.pm>.

=head4 Update C<Module::CoreList> with module version data for the new release.

Note that if this is a MAINT release, you should run the following actions
from the maint branch, but commit the C<CoreList.pm> changes in
I<blead> and subsequently cherry-pick any releases since the last
maint release and then your recent commit.  XXX need a better example

[ Note that the procedure for handling Module::CoreList in maint branches
is a bit complex, and the RMG currently don't describe a full and
workable approach. The main issue is keeping Module::CoreList
and its version number synchronised across all maint branches, blead and
CPAN, while having to bump its version number for every RC release.
See this brief p5p thread:

    Message-ID: <20130311174402.GZ2294@@iabyn.com>

If you can devise a workable system, feel free to try it out, and to
update the RMG accordingly!

DAPM May 2013 ]

F<corelist.pl> uses ftp.funet.fi to verify information about dual-lived
modules on CPAN. It can use a full, local CPAN mirror and/or fall back
on HTTP::Tiny to fetch package metadata remotely.

(If you'd prefer to have a full CPAN mirror, see
http://www.cpan.org/misc/cpan-faq.html#How_mirror_CPAN)

Then change to your perl checkout, and if necessary,

    $ make

Then, If you have a local CPAN mirror, run:

    $ ./perl -Ilib Porting/corelist.pl ~/my-cpan-mirror

Otherwise, run:

    $ ./perl -Ilib Porting/corelist.pl cpan

This will chug for a while, possibly reporting various warnings about
badly-indexed CPAN modules unrelated to the modules actually in core.
Assuming all goes well, it will update
F<dist/Module-CoreList/lib/Module/CoreList.pm> and possibly
F<dist/Module-CoreList/lib/Module/CoreList/Utils.pm>.

Check those files over carefully:

    $ git diff dist/Module-CoreList/lib/Module/CoreList.pm
    $ git diff dist/Module-CoreList/lib/Module/CoreList/Utils.pm

=head4 Bump version in Module::CoreList F<Changes>

Also edit Module::CoreList's new version number in its F<Changes> file.
This file is F<dist/Module-CoreList/Changes>.

=head4 Add Module::CoreList version bump to perldelta

Add a perldelta entry for the new Module::CoreList version. You only
need to do this if you want to add notes about the changes included
with this version of Module::CoreList. Otherwise, its version bump
will be automatically filled in below in L<finalize perldelta>.

=for checklist skip RC

=head4 Update C<%Module::CoreList::released>

For any release except an RC: Update this version's entry in the C<%released>
hash with today's date.

=head4 Commit Module::CoreList changes

Finally, commit the new version of Module::CoreList:
(unless this is for MAINT; in which case commit it to blead first, then
cherry-pick it back).

    $ git commit -m 'Update Module::CoreList for 5.x.y' \
        dist/Module-CoreList/Changes \
        dist/Module-CoreList/lib/Module/CoreList.pm \
        dist/Module-CoreList/lib/Module/CoreList/Utils.pm

=head4 Rebuild and test

Build and test to get the changes into the currently built lib directory and to
ensure all tests are passing.

=head3 finalize perldelta

Finalize the perldelta.  In particular, fill in the Acknowledgements
section, which can be generated with something like:

    $ perl Porting/acknowledgements.pl v5.15.0..HEAD

Fill in the "New/Updated Modules" sections now that Module::CoreList is
updated:

    $ ./perl -Ilib Porting/corelist-perldelta.pl \
        --mode=update pod/perldelta.pod

For a MAINT release use something like this instead:

    $ ./perl -Ilib Porting/corelist-perldelta.pl 5.020001 5.020002 \
        --mode=update pod/perldelta.pod

Ideally, also fill in a summary of the major changes to each module for which
an entry has been added by F<corelist-perldelta.pl>.

Re-read the perldelta to try to find any embarrassing typos and thinkos;
remove any C<TODO> or C<XXX> flags; update the "Known Problems" section
with any serious issues for which fixes are not going to happen now; and
run through pod and spell checkers, e.g.

    $ podchecker -warnings -warnings pod/perldelta.pod
    $ spell pod/perldelta.pod

Also, you may want to generate and view an HTML version of it to check
formatting, e.g.

    $ ./perl -Ilib ext/Pod-Html/bin/pod2html pod/perldelta.pod > \
        /tmp/perldelta.html

Another good HTML preview option is http://search.cpan.org/pod2html

If you make changes, be sure to commit them.

=for checklist skip BLEAD-POINT MAINT RC

=head3 remove stale perldeltas

For the first RC release that is ONLY for a BLEAD-FINAL, the perldeltas
from the BLEAD-POINT releases since the previous BLEAD-FINAL should have
now been consolidated into the current perldelta, and hence are now just
useless clutter.  They can be removed using:

    $ git rm <file1> <file2> ...

For example, for RC0 of 5.16.0:

    $ cd pod
    $ git rm perldelta515*.pod

=for checklist skip BLEAD-FINAL BLEAD-POINT

=head3 add recent perldeltas

For the first RC for a MAINT release, copy in any recent perldeltas from
blead that have been added since the last release on this branch. This
should include any recent maint releases on branches older than your one,
but not newer. For example if you're producing a 5.14.x release, copy any
perldeltas from recent 5.10.x, 5.12.x etc maint releases, but not from
5.16.x or higher. Remember to

    $ git add <file1> <file2> ...

=head3 update and commit perldelta files

If you have added or removed any perldelta files via the previous two
steps, then edit F<pod/perl.pod> to add/remove them from its table of
contents, then run F<Porting/pod_rules.pl> to propagate your changes there
into all the other files that mention them (including F<MANIFEST>). You'll
need to C<git add> the files that it changes.

Then build a clean perl and do a full test

    $ git status
    $ git clean -dxf
    $ ./Configure -Dusedevel -des
    $ make
    $ make test

Once all tests pass, commit your changes.

=head3 build a clean perl

If you skipped the previous step (adding/removing perldeltas),
again, make sure you have a gitwise-clean perl directory (no modified files,
unpushed commits etc):

    $ git status
    $ git clean -dxf

then configure and build perl so that you have a Makefile and porting tools:

    $ ./Configure -Dusedevel -des && make

=for checklist skip BLEAD-FINAL BLEAD-POINT

=head3 synchronise from blead's perlhist.pod

For the first RC for a MAINT release, copy in the latest
F<pod/perlhist.pod> from blead; this will include details of newer
releases in all branches. In theory, blead's version should be a strict
superset of the one in this branch, but it's probably safest to diff them
first to ensure that there's nothing in this branch that was forgotten
from blead:

    $ diff pod/perlhist.pod ..../blead/pod/perlhist.pod
    $ cp  ..../blead/pod/perlhist.pod pod/
    $ git commit -m 'sync perlhist from blead' pod/perlhist.pod

=head3 update perlhist.pod

Add an entry to F<pod/perlhist.pod> with the release date, e.g.:

    David    5.10.1       2009-Aug-06

List yourself in the left-hand column, and if this is the first release
that you've ever done, make sure that your name is listed in the section
entitled C<THE KEEPERS OF THE PUMPKIN>.

I<If you're making a BLEAD-FINAL release>, also update the "SELECTED
RELEASE SIZES" section with the output of
F<Porting/perlhist_calculate.pl>.

Be sure to commit your changes:

    $ git commit -m 'add new release to perlhist' pod/perlhist.pod

=for checklist skip BLEAD-POINT

=head3 update patchlevel.h

I<You MUST SKIP this step for a BLEAD-POINT release>

Update F<patchlevel.h> to add a C<-RC1>-or-whatever string; or, if this is
a final release, remove it. For example:

     static const char * const local_patches[] = {
             NULL
    +        ,"RC1"
     #ifdef PERL_GIT_UNCOMMITTED_CHANGES
             ,"uncommitted-changes"
     #endif

Be sure to commit your change:

    $ git commit -m 'bump version to RCnnn' patchlevel.h

=head3 run makemeta to update META files

    $ ./perl -Ilib Porting/makemeta

Be sure to commit any changes (if applicable):

    $ git status   # any changes?
    $ git commit -m 'Update META files' META.*

=head3 build, test and check a fresh perl

Build perl, then make sure it passes its own test suite, and installs:

    $ git clean -xdf
    $ ./Configure -des -Dprefix=/tmp/perl-5.x.y-pretest

    # or if it's an odd-numbered version:
    $ ./Configure -des -Dusedevel -Dprefix=/tmp/perl-5.x.y-pretest

    $ make test install

Check that the output of C</tmp/perl-5.x.y-pretest/bin/perl -v> and
C</tmp/perl-5.x.y-pretest/bin/perl -V> are as expected,
especially as regards version numbers, patch and/or RC levels, and @@INC
paths. Note that as they have been built from a git working
directory, they will still identify themselves using git tags and
commits. (Note that for an odd-numbered version, perl will install
itself as C<perl5.x.y>). C<perl -v> will identify itself as:

 This is perl 5, version X, subversion Y (v5.X.Y (v5.X.Z-NNN-gdeadbeef))

where 5.X.Z is the latest tag, NNN the number of commits since this tag,
and C<< deadbeef >> commit of that tag.

Then delete the temporary installation.

=head3 create the release tag

Create the tag identifying this release (e.g.):

    $ git tag v5.11.0 -m "First release of the v5.11 series!"

It is B<VERY> important that from this point forward, you not push
your git changes to the Perl master repository.  If anything goes
wrong before you publish your newly-created tag, you can delete
and recreate it.  Once you push your tag, we're stuck with it
and you'll need to use a new version number for your release.

=head3 build the tarball

Before you run the following, you might want to install 7-Zip (the
C<p7zip-full> package under Debian or the C<p7zip> port on MacPorts) or
the AdvanceCOMP suite (e.g. the C<advancecomp> package under Debian,
or the C<advancecomp> port on macports - 7-Zip on Windows is the
same code as AdvanceCOMP, so Windows users get the smallest files
first time). These compress about 5% smaller than gzip and bzip2.
Over the lifetime of your distribution this will save a lot of
people a small amount of download time and disk space, which adds
up.

In order to produce the C<xz> tarball, XZ Utils are required. The C<xz>
utility is included with most modern UNIX-type operating systems and
is available for Cygwin. A Windows port is available from
L<http://tukaani.org/xz/>.

B<IMPORTANT>: if you are on OS X, you must export C<COPYFILE_DISABLE=1>
to prevent OS X resource files from being included in your tarball. After
creating the tarball following the instructions below, inspect it to ensure
you don't have files like F<._foobar>.

Create a tarball. Use the C<-s> option to specify a suitable suffix for
the tarball and directory name:

 $ cd root/of/perl/tree
 $ make distclean       # make sure distclean works
 $ git clean -xdf       # make sure perl and git agree on files
                        # git clean should not output anything!
 $ git status           # and there's nothing lying around

 $ perl Porting/makerel -bx -s RC1            # for a release candidate
 $ perl Porting/makerel -bx                   # for the release itself

This creates the  directory F<../perl-x.y.z-RC1> or similar, copies all
the MANIFEST files into it, sets the correct permissions on them, then
tars it up as F<../perl-x.y.z-RC1.tar.gz>. With C<-b>, it also creates a
C<tar.bz2> file. The C<-x> also produces a C<tar.xz> file.

If you're getting your tarball suffixed with -uncommitted and you're sure
your changes were all committed, you can override the suffix with:

    $ perl Porting/makerel -b -s ''

XXX if we go for extra tags and branches stuff, then add the extra details
here

Finally, clean up the temporary directory, e.g.

    $ rm -rf ../perl-x.y.z-RC1

=head3 test the tarball

Once you have a tarball it's time to test the tarball (not the repository).

=head4 Copy the tarball to a web server

Copy the tarballs (.gz and possibly .bz2 and .xz) to a web server somewhere you
have access to.

=head4 Download the tarball to another machine and unpack it

Download the tarball to some other machine. For a release candidate,
you really want to test your tarball on two or more different platforms
and architectures.

=head4 Ask #p5p to test the tarball on different platforms

Once you've verified the tarball can be downloaded and unpacked,
ask the #p5p IRC channel on irc.perl.org for volunteers to test the
tarballs on whatever platforms they can.

If you're not confident in the tarball, you can defer this step until after
your own tarball testing, below.

=head4 Check that F<Configure> works

Check that basic configuration and tests work on each test machine:

    $ ./Configure -des && make all test

    # Or for a development release:
    $ ./Configure -Dusedevel -des && make all test

=head4 Run the test harness and install

Check that the test harness and install work on each test machine:

 $ make distclean
 $ ./Configure -des -Dprefix=/install/path && make all test_harness install
 $ cd /install/path

=head4 Check C<perl -v> and C<perl -V>

Check that the output of C<perl -v> and C<perl -V> are as expected,
especially as regards version numbers, patch and/or RC levels, and @@INC
paths.

Note that the results may be different without a F<.git/> directory,
which is why you should test from the tarball.

=head4 Run the Installation Verification Procedure utility

    $ ./perl utils/perlivp
    ...
    All tests successful.
    $

=head4 Compare the installed paths to the last release

Compare the pathnames of all installed files with those of the previous
release (i.e. against the last installed tarball on this branch which you
have previously verified using this same procedure). In particular, look
for files in the wrong place, or files no longer included which should be.
For example, suppose the about-to-be-released version is 5.10.1 and the
previous is 5.10.0:

    cd installdir-5.10.0/
    find . -type f | perl -pe's/5\.10\.0/5.10.1/g' | sort > /tmp/f1
    cd installdir-5.10.1/
    find . -type f | sort > /tmp/f2
    diff -u /tmp/f[12]

=head4 Bootstrap the CPAN client

Bootstrap the CPAN client on the clean install:

    $ bin/cpan

    # Or, perhaps:
    $ bin/cpan5.xx.x

=head4 Install the Inline module with CPAN and test it

Try installing a popular CPAN module that's reasonably complex and that
has dependencies; for example:

    CPAN> install Inline::C
    CPAN> quit

Check that your perl can run this:

    $ bin/perl -lwe "use Inline C => q[int f() { return 42;}]; print f"
    42
    $

=head4 Make sure that perlbug works

Test L<perlbug> with the following:

    $ bin/perlbug
    ...
    Subject: test bug report
    Local perl administrator [yourself]:
    Editor [vi]:
    Module:
    Category [core]:
    Severity [low]:
    (edit report)
    Action (Send/Display/Edit/Subject/Save to File): f
    Name of file to save message in [perlbug.rep]:
    Action (Send/Display/Edit/Subject/Save to File): q

and carefully examine the output (in F<perlbug.rep]>), especially
the "Locally applied patches" section. If everything appears okay, then
delete the file, and try it again, this time actually submitting the bug
report. Check that it shows up, then remember to close it!

=for checklist skip BLEAD-POINT

=head3 monitor smokes

XXX This is probably irrelevant if working on a release branch, though
MAINT or RC might want to push a smoke branch and wait.

Wait for the smoke tests to catch up with the commit which this release is
based on (or at least the last commit of any consequence).

Then check that the smoke tests pass (particularly on Win32). If not, go
back and fix things.

Note that for I<BLEAD-POINT> releases this may not be practical. It takes a
long time for the smokers to catch up, especially the Win32
smokers. This is why we have a RC cycle for I<MAINT> and I<BLEAD-FINAL>
releases, but for I<BLEAD-POINT> releases sometimes the best you can do is
to plead with people on IRC to test stuff on their platforms, fire away,
and then hope for the best.

=head3 upload to PAUSE

Once smoking is okay, upload it to PAUSE. This is the point of no return.
If anything goes wrong after this point, you will need to re-prepare
a new release with a new minor version or RC number.

    https://pause.perl.org/

(Login, then select 'Upload a file to CPAN')

If your workstation is not connected to a high-bandwidth,
high-reliability connection to the Internet, you should probably use the
"GET URL" feature (rather than "HTTP UPLOAD") to have PAUSE retrieve the
new release from wherever you put it for testers to find it.  This will
eliminate anxious gnashing of teeth while you wait to see if your
15 megabyte HTTP upload successfully completes across your slow, twitchy
cable modem.

You can make use of your home directory on dromedary for
this purpose: F<http://users.perl5.git.perl.org/~USERNAME> maps to
F</home/USERNAME/public_html>, where F<USERNAME> is your login account
on dromedary.

I<Remember>: if your upload is partially successful, you
may need to contact a PAUSE administrator or even bump the version of perl.

Upload the .gz, .xz, and .bz2 versions of the tarball.

Do not proceed any further until you are sure that your tarballs are on CPAN.
Check your authors directory www.cpan.org (the globally balanced "fast"
mirror) to confirm that your uploads have been successful.

=for checklist skip RC BLEAD-POINT

=head3 wait for indexing

I<You MUST SKIP this step for RC and BLEAD-POINT>

Wait until you receive notification emails from the PAUSE indexer
confirming that your uploads have been received.  IMPORTANT -- you will
probably get an email that indexing has failed, due to module permissions.
This is considered normal.

=for checklist skip BLEAD-POINT

=head3 disarm patchlevel.h

I<You MUST SKIP this step for BLEAD-POINT release>

Disarm the F<patchlevel.h> change; for example,

     static const char * const local_patches[] = {
             NULL
    -        ,"RC1"
     #ifdef PERL_GIT_UNCOMMITTED_CHANGES
             ,"uncommitted-changes"
     #endif

Be sure to commit your change:

    $ git commit -m 'disarm RCnnn bump' patchlevel.h

=head3 announce to p5p

Mail p5p to announce your new release, with a quote you prepared earlier.

Use the template at Porting/release_announcement_template.txt

Send a carbon copy to C<noc@@metacpan.org>

=head3 merge release branch back to blead

Merge the (local) release branch back into master now, and delete it.

    git checkout blead
    git pull
    git merge release-5.xx.yy
    git push
    git branch -d release-5.xx.yy

Note: The merge will create a merge commit if other changes have been pushed
to blead while you've been working on your release branch. Do NOT rebase your
branch to avoid the merge commit (as you might normally do when merging a
small branch into blead) since doing so will invalidate the tag that you
created earlier.

=head3 publish the release tag

Now that you've shipped the new perl release to PAUSE and pushed your changes
to the Perl master repository, it's time to publish the tag you created
earlier too (e.g.):

    $ git push origin tag v5.11.0

=head3 update epigraphs.pod

Add your quote to F<Porting/epigraphs.pod> and commit it.
You can include the customary link to the release announcement even before your
message reaches the web-visible archives by looking for the X-List-Archive
header in your message after receiving it back via perl5-porters.

=head3 blog about your epigraph

If you have a blog, please consider writing an entry in your blog explaining
why you chose that particular quote for your epigraph.

=for checklist skip RC

=head3 Release schedule

I<You MUST SKIP this step for RC>

Tick the entry for your release in F<Porting/release_schedule.pod>.

=for checklist skip RC

=head3 Module::CoreList nagging

I<You MUST SKIP this step for RC>

Remind the current maintainer of C<Module::CoreList> to push a new release
to CPAN.

=for checklist skip RC

=head3 new perldelta

I<You MUST SKIP this step for RC>

Create a new perldelta.

=over 4

=item *

Confirm that you have a clean checkout with no local changes.

=item *

Run F<Porting/new-perldelta.pl>

=item *

Run the C<git add> commands it outputs to add new and modified files.

=item *

Verify that the build still works, by running C<./Configure> and
C<make test_porting>. (On Win32 use the appropriate make utility).

=item *

If F<t/porting/podcheck.t> spots errors in the new F<pod/perldelta.pod>,
run C<./perl -MTestInit t/porting/podcheck.t | less> for more detail.
Skip to the end of its test output to see the options it offers you.

=item *

When C<make test_porting> passes, commit the new perldelta.

=back

At this point you may want to compare the commit with a previous bump to
see if they look similar.  See commit ba03bc34a4 for an example of a
previous version bump.

=for checklist skip MAINT RC

=head3 bump version

I<You MUST SKIP this step for RC and MAINT>

If this was a BLEAD-FINAL release (i.e. the first release of a new maint
series, 5.x.0 where x is even), then bump the version in the blead branch
in git, e.g. 5.12.0 to 5.13.0.

First, add a new feature bundle to F<regen/feature.pl>, initially by just
copying the exiting entry, and bump the file's $VERSION (after the __END__
marker); e.g.

	 "5.14" => [qw(switch say state unicode_strings)],
    +    "5.15" => [qw(switch say state unicode_strings)],

Run F<regen/feature.pl> to propagate the changes to F<lib/feature.pm>.

Then follow the section L<"Bump the version number"> to bump the version
in the remaining files and test and commit.

If this was a BLEAD-POINT release, then just follow the section
L<"Bump the version number">.

After bumping the version, follow the section L<"update INSTALL"> to
ensure all version number references are correct.

(Note: The version is NOT bumped immediately after a MAINT release in order
to avoid confusion and wasted time arising from bug reports relating to
"intermediate versions" such as 5.20.1-and-a-bit: If the report is caused
by a bug that gets fixed in 5.20.2 and this intermediate version already
calls itself 5.20.2 then much time can be wasted in figuring out why there
is a failure from something that "should have been fixed". If the bump is
late then there is a much smaller window of time for such confusing bug
reports to arise. (The opposite problem -- trying to figure out why there
*is* a bug in something calling itself 5.20.1 when in fact the bug was
introduced later -- shouldn't arise for MAINT releases since they should,
in theory, only contain bug fixes but never regressions.))

=head3 clean build and test

Run a clean build and test to make sure nothing obvious is broken.

In particular, F<Porting/perldelta_template.pod> is intentionally exempted
from podchecker tests, to avoid false positives about placeholder text.
However, once it's copied to F<pod/perldelta.pod> the contents can now
cause test failures. Problems should be resolved by doing one of the
following:

=over

=item 1

Replace placeholder text with correct text.

=item 2

If the problem is from a broken placeholder link, you can add it to the
array C<@@perldelta_ignore_links> in F<t/porting/podcheck.t>.  Lines
containing such links should be marked with C<XXX> so that they get
cleaned up before the next release.

=item 3

Following the instructions output by F<t/porting/podcheck.t> on how to
update its exceptions database.

=back

=head3 push commits

Finally, push any commits done above.

    $ git push origin ....

=for checklist skip BLEAD-POINT MAINT RC

=head3 create maint branch

I<You MUST SKIP this step for RC, BLEAD-POINT, MAINT>

If this was a BLEAD-FINAL release (i.e. the first release of a new maint
series, 5.x.0 where x is even), then create a new maint branch based on
the commit tagged as the current release.

Assuming you're using git 1.7.x or newer:

    $ git checkout -b maint-5.12 v5.12.0
    $ git push origin -u maint-5.12


=for checklist skip BLEAD-POINT MAINT RC

=head3 make the maint branch available in the APC

Clone the new branch into /srv/gitcommon/branches on camel so the APC will
receive its changes.

    $ git clone --branch maint-5.14 /gitroot/perl.git \
    ?  /srv/gitcommon/branches/perl-5.14.x
    $ chmod -R g=u /srv/gitcommon/branches/perl-5.14.x

And nag the sysadmins to make this directory available via rsync.

XXX Who are the sysadmins?  Contact info?

=for checklist skip BLEAD-POINT RC

=head3 copy perldelta.pod to blead

I<You MUST SKIP this step for RC, BLEAD-POINT>

Copy the perldelta.pod for this release into blead; for example:

 $ cd ..../blead
 $ cp -i ../5.10.x/pod/perldelta.pod pod/perl5101delta.pod  #for example
 $ git add pod/perl5101delta.pod

Don't forget to set the NAME correctly in the new file (e.g. perl5101delta
rather than perldelta).

Edit F<pod/perl.pod> to add an entry for the file, e.g.:

    perl5101delta		Perl changes in version 5.10.1

Then rebuild various files:

    $ perl Porting/pod_rules.pl

Finally, commit and push:

    $ git commit -a -m 'add perlXXXdelta'
    $ git push origin ....

=for checklist skip BLEAD-POINT

=head3 copy perlhist.pod entries to blead

Make sure any recent F<pod/perlhist.pod> entries are copied to
F<perlhist.pod> on blead.  e.g.

    5.8.9         2008-Dec-14

=head3 Relax!

I<You MUST RETIRE to your preferred PUB, CAFE or SEASIDE VILLA for some
much-needed rest and relaxation>.

Thanks for releasing perl!

=head2 Building a release - the day after

=for checklist skip BLEAD-FINAL, MAINT, RC

=head3 update Module::CoreList

I<After a BLEAD-POINT release only>

After Module::CoreList has shipped to CPAN by the maintainer, update
Module::CoreList in the source so that it reflects the new blead
version number:

=over 4

=item *

Update F<Porting/Maintainers.pl> to list the new DISTRIBUTION on CPAN,
which should be identical to what is currently in blead.

=item *

Bump the $VERSION in F<dist/Module-CoreList/lib/Module/CoreList.pm>,
F<dist/Module-CoreList/lib/Module/CoreList/TieHashDelta.pm> and
F<dist/Module-CoreList/lib/Module/CoreList/Utils.pm>.

=item *

If you have a local CPAN mirror, run:

    $ ./perl -Ilib Porting/corelist.pl ~/my-cpan-mirror

Otherwise, run:

    $ ./perl -Ilib Porting/corelist.pl cpan

This will update F<dist/Module-CoreList/lib/Module/CoreList.pm> and
F<dist/Module-CoreList/lib/Module/CoreList/Utils.pm> as it did before,
but this time adding new sections for the next BLEAD-POINT release.

=item *

Add the new $Module::CoreList::VERSION to
F<dist/Module-CoreList/Changes>.

=item *

Update F<pod/perldelta.pod> to mention the upgrade to Module::CoreList.

=item *

Remake perl to get your changed .pm files propagated into F<lib/> and
then run at least the F<dist/Module-CoreList/t/*.t> tests and the
test_porting makefile target to check that they're ok.

=item *

Run

 $ ./perl -Ilib -MModule::CoreList \
    -le 'print Module::CoreList->find_version($]) ? "ok" : "not ok"'

and check that it outputs "ok" to prove that Module::CoreList now knows
about blead's current version.

=item *

Commit and push your changes.

=back

=head3 check tarball availability

Check various website entries to make sure the that tarball has appeared
and is properly indexed:

=over 4

=item *

Check your author directory under L<http://www.cpan.org/authors/id/>
to ensure that the tarballs are available on the website.

=item *

Check F</src> on CPAN (on a fast mirror) to ensure that links to
the new tarballs have appeared: There should be links in F</src/5.0>
(which is accumulating all new versions), and (for BLEAD-FINAL and
MAINT only) an appropriate mention in F</src/README.html> (which describes
the latest versions in each stable branch, with links).

The F</src/5.0> links should appear automatically, some hours after upload.
If they don't, or the F</src> description is inadequate,
ask Ask <ask@@perl.org>.

=item *

Check L<http://www.cpan.org/src/> to ensure that the F</src> updates
have been correctly mirrored to the website.
If they haven't, ask Ask <ask@@perl.org>.

=item *

Check L<http://search.cpan.org> to see if it has indexed the distribution.
It should be visible at a URL like C<http://search.cpan.org/dist/perl-5.10.1/>.

=back

=for checklist skip RC

=head3 update dev.perl.org

I<You MUST SKIP this step for a RC release>

In your C<perlweb> repository, link to the new release.  For a new
latest-maint release, edit F<docs/shared/tpl/stats.html>.  Otherwise,
edit F<docs/dev/perl5/index.html>.

Then make a pull request to Leo Lapworth.  If this fails for some reason
and you cannot cajole anybody else into submitting that change, you can
mail Leo as last resort.

This repository can be found on L<github|https://github.com/perlorg/perlweb>.

=head3 update release manager's guide

Go over your notes from the release (you did take some, right?) and update
F<Porting/release_managers_guide.pod> with any fixes or information that
will make life easier for the next release manager.

=for checklist end

=head1 SOURCE

Based on
http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2009-05/msg00608.html,
plus a whole bunch of other sources, including private correspondence.

=cut

@


1.2
log
@Update to perl 5.20.3

OK bluhm@@
@
text
@a143 6
=head3 search.cpan.org pumpkin status

Make sure that search.cpan.org knows that you're allowed to upload
perl distros. Contact Graham Barr to make sure that you're on the right
list.

d162 14
d186 7
d246 1
a246 1
=head3 How to sync a CPAN module with a cpan/ distro
d267 1
a267 1
entries in C<@@IGNORABLE> in F<Porting/Maintainer.pl>, and anything that
d281 1
a281 1
If not, delete them, and list them in either C<EXCLUDED> or C<@@INGORE>.
d310 1
a310 1
Run the tests in F<t/porting>.
d360 2
a361 2
L<http://doc.procura.nl/smoke/index.html> and L<http://perl5.test-smoke.org/>
for a summary. See also
d377 5
d436 1
a436 1
    $ perl regen/uconfig_h.pl
d440 3
a442 3
You may have to add stub entries in C<%Module::CoreList::version>,
C<%Module::CoreList::deprecated> and C<%Module::CoreList::Utils::delta>.
If so, you must up their version numbers as well.
d446 7
a452 4
    $ git clean -xdf   # careful if you don't have local files to keep!
    $ ./Configure -des -Dusedevel
    $ make
    $ make test
d456 3
a458 3
    $ git status
    $ git diff
    B<review the delta carefully>
d460 1
a460 1
    $ git commit -a -m 'Bump the perl version in various places for 5.x.y'
d487 3
a489 1
release (so for 5.15.3 this would be 5.15.2).
d658 1
d871 1
a871 1
    This is perl 5, version X, subversion Y (v5.X.Y (v5.X.Z-NNN-gdeadbeef))
d902 10
d915 5
a919 5
    $ cd root/of/perl/tree
    $ make distclean       # make sure distclean works
    $ git clean -xdf       # make sure perl and git agree on files
                           # git clean should not output anything!
    $ git status           # and there's nothing lying around
d921 2
a922 2
    $ perl Porting/makerel -b -s RC1            # for a release candidate
    $ perl Porting/makerel -b                   # for the release itself
d927 1
a927 1
C<tar.bz2> file.
d947 1
a947 1
Copy the tarballs (.gz and possibly .bz2) to a web server somewhere you
d950 1
a950 1
=head4 Download the tarball to another machine
d954 10
a963 2
and architectures. The #p5p IRC channel on irc.perl.org is a good place
to find willing victims.
d978 3
a980 3
    $ make distclean
    $ ./Configure -des -Dprefix=/install/path && make all test_harness install
    $ cd /install/path
d1094 3
a1096 1
cable modem.  You can make use of your home directory on dromedary for
d1099 3
a1101 1
on dromedary.  I<Remember>: if your upload is partially successful, you
d1104 1
a1104 1
Upload both the .gz and .bz2 versions of the tarball.
d1359 3
a1361 3
    $ cd ..../blead
    $ cp -i ../5.10.x/pod/perldelta.pod pod/perl5101delta.pod  # for example
    $ git add pod/perl5101delta.pod
a1387 12
=head3 bump RT version number

Log into http://rt.perl.org/ and check whether the new version is in the RT
fields C<Perl Version> and C<Fixed In>. The easiest way to determine this is to
open up any ticket for modification and check the drop downs next to the
C<Perl Version> and C<Fixed In> labels.

Here, try this link: L<https://rt.perl.org/Ticket/Modify.html?id=10000>

If the new version is not listed there, send an email to C<perlbug-admin at
perl.org> requesting this.

d1453 2
a1454 2
    $ ./perl -Ilib -MModule::CoreList \
        -le 'print Module::CoreList->find_version($]) ? "ok" : "not ok"'
d1479 2
a1480 2
Check C</src> on CPAN (on a fast mirror) to ensure that links to
the new tarballs have appeared: There should be links in C</src/5.0>
d1482 1
a1482 1
MAINT only) an appropriate mention in C</src/README.html> (which describes
d1485 2
a1486 2
The C</src/5.0> links should appear automatically, some hours after upload.
If they don't, or the C</src> description is inadequate,
d1491 1
a1491 1
Check L<http://www.cpan.org/src/> to ensure that the C</src> updates
@


1.1
log
@Initial revision
@
text
@d1 2
d7 19
a25 4
As of August 2009, this file is mostly complete, although it is missing
some detail on doing a major release (e.g. 5.10.0 -> 5.12.0). Note that
things change at each release, so there may be new things not covered
here, or tools may need updating.
d30 2
a31 2
manual - to produce a perl release of some description, be that a snaphot,
release candidate, or final, numbered release of maint or blead.
d34 3
a36 1
pumpking.
d38 2
a39 2
This document both helps as a check-list for the release engineer 
and is a base for ideas on how the various tasks could be automated 
d42 1
a42 1
The outline of a typical release cycle is as follows:
a47 5
    an occasional snapshot is released, that still identifies itself as
	5.10.1

    ...time passes...

d51 1
a51 1
    ...a few weeks passes...
d58 1
a58 1
	perl5103delta.pod
d64 2
a65 2
Some of the tasks described below apply to all four types of 
release of Perl. (snapshot, RC, final release of maint, final 
d67 1
a67 1
of these release types.  If a step does not apply to a given 
a74 7
=item Snapshot

A snapshot is intended to encourage in-depth testing from time-to-time,
for example after a key point in the stabilisation of a branch. It
requires fewer steps than a full release, and the version number of perl in
the tarball will usually be the same as that of the previous release.

d85 5
a89 1
=item Stable/Maint release
d97 19
a115 1
=item Blead release
d118 1
a118 1
with a whole bunch of extra post-release steps.
d122 2
d129 1
a129 5
=over 4

=item PAUSE account

I<SKIP this step for SNAPSHOT>
d136 5
a140 5
Check that your account is allowed to upload perl distros: goto
https://pause.perl.org/, login, then select 'upload file to CPAN'; there
should be a "For pumpkings only: Send a CC" tickbox.  If not, ask Andreas
Knig to add your ID to the list of people allowed to upload something
called perl.  You can find Andreas' email address at:
d144 1
a144 1
=item CPAN mirror
d146 3
a148 3
Some release engineering steps require a full mirror of the CPAN.
Work to fall back to using a remote mirror via HTTP is incomplete
but ongoing. (No, a minicpan mirror is not sufficient)
d150 8
a157 1
=item git checkout and commit bit
d161 1
a161 1
with perl and git, see F<pod/perlrepository.pod>.
d168 16
d185 1
a185 1
=item Quotation for release announcement epigraph
d187 1
a187 1
I<SKIP this step for SNAPSHOT and RC>
d189 1
a189 3
For a numbered blead or maint release of perl, you will need a quotation 
to use as an epigraph to your release announcement.  (There's no harm
in having one for a snapshot, but it's not required).
d191 7
d199 1
a199 1
=back
d201 23
d225 5
a229 1
=head2 Building a release - advance actions
d231 1
a231 4
The work of building a release candidate for a numbered release of
perl generally starts several weeks before the first release candidate.
Some of the following steps should be done regularly, but all I<must> be
done in the run up to a release.
d237 3
a239 1
I<You MAY SKIP this step for SNAPSHOT>
d241 9
a249 2
Ensure that dual-life CPAN modules are synchronised with CPAN.  Basically,
run the following:
d251 11
a261 1
    $ ./perl -Ilib Porting/core-cpan-diff -a -o /tmp/corediffs
d263 1
a263 4
to see any inconsistencies between the core and CPAN versions of distros,
then fix the core, or cajole CPAN authors as appropriate. See also the
C<-d> and C<-v> options for more detail.  You'll probably want to use the
C<-c cachedir> option to avoid repeated CPAN downloads.
d265 4
a268 1
To see which core distro versions differ from the current CPAN versions:
d270 1
a270 1
    $ ./perl -Ilib Porting/core-cpan-diff -x -a
d272 2
a273 5
If you are making a maint release, run C<core-cpan-diff> on both blead and
maint, then diff the two outputs. Compare this with what you expect, and if
necessary, fix things up. For example, you might think that both blead
and maint are synchronised with a particular CPAN module, but one might
have some extra changes. 
d277 2
a278 1
I<You MAY SKIP this step for SNAPSHOT>
d280 1
a280 1
Ensure dual-life CPAN modules are stable, which comes down to:
d282 2
a283 4
    for each module that fails its regression tests on $current
        did it fail identically on $previous?
        if yes, "SEP" (Somebody Else's Problem)
        else work out why it failed (a bisect is useful for this)
d285 1
a285 1
    attempt to group failure causes
d287 1
a287 10
    for each failure cause
        is that a regression?
        if yes, figure out how to fix it
            (more code? revert the code that broke it)
        else
            (presumably) it's relying on something un-or-under-documented
            should the existing behaviour stay?
                yes - goto "regression"
                no - note it in perldelta as a significant bugfix
                (also, try to inform the module's author)
d291 3
a293 1
I<You MAY SKIP this step for SNAPSHOT>
d295 1
a295 1
Similarly, monitor the smoking of core tests, and try to fix.
d299 3
a301 1
I<You MAY SKIP this step for SNAPSHOT>
d303 1
a303 2
Similarly, monitor the smoking of perl for compiler warnings, and try to
fix.
d307 6
a312 1
I<You MAY SKIP this step for SNAPSHOT>
d314 5
a318 3
Run F<Porting/cmpVERSION.pl> to compare the current source tree with the
previous version to check for for modules that have identical version
numbers but different contents, e.g.:
d320 1
a320 2
     $ cd ~/some-perl-root
     $ ./perl -Ilib Porting/cmpVERSION.pl -xd ~/my_perl-tarballs/perl-5.10.0 .
d322 27
a348 4
then bump the version numbers of any non-dual-life modules that have
changed since the previous release, but which still have the old version
number. If there is more than one maintenance branch (e.g. 5.8.x, 5.10.x),
then compare against both.
d350 2
a351 3
Note that some of the files listed may be generated (e.g. copied from ext/
to lib/, or a script like lib/lib_pm.PL is run to produce lib/lib.pm);
make sure you edit the correct file!
d353 1
a353 1
Once all version numbers have been bumped, re-run the checks.
d355 1
a355 2
Then run again without the -x option, to check that dual-life modules are
also sensible.
d357 4
a360 1
=item *
d362 1
a362 1
I<You MAY SKIP this step for SNAPSHOT>
d366 1
a366 1
Peruse  F<Porting/how_to_write_a_perldelta.pod>, and try to make sure that
d370 3
a372 9
=item *

I<You MUST SKIP this step for SNAPSHOT>

A week or two before the first release candidate, bump the perl version
number (e.g. from 5.10.0 to 5.10.1), to allow sufficient time for testing
and smoking with the target version built into the perl executable. For
subsequent release candidates and the final release, it it not necessary
to bump the version further.
d374 1
a374 5
There is a tool to semi-automate this process. It works in two stages.
First, it generates a list of suggested changes, which you review and
edit; then you feed this list back and it applies the edits. So, first
scan the source directory looking for likely candidates. The command line
arguments are the old and new version numbers, and -s means scan:
d376 2
a377 1
    $ Porting/bump-perl-version -s 5.10.0 5.10.1 > /tmp/scan
d379 1
a379 1
This produces a file containing a list of suggested edits, e.g.:
d381 5
a385 1
    NetWare/Makefile
d387 1
a387 2
       89: -MODULE_DESC     = "Perl 5.10.0 for NetWare"
	   +MODULE_DESC     = "Perl 5.10.1 for NetWare"
d389 1
a389 6
i.e. in the file F<NetWare/Makefile>, line 89 would be changed as shown.
Review the file carefully, and delete any -/+ line pairs that you don't
want changing. You can also edit just the C<+> line to change the
suggested replacement text. Remember that this tool is largely just
grepping for '5.10.0' or whatever, so it will generate false positives. Be
careful not change text like "this was fixed in 5.10.0"! Then run:
d391 3
a393 1
    $ Porting/bump-perl-version -u < /tmp/scan
d395 1
a395 1
which will update all the files shown; then commit the changes.
d399 2
a400 3
some of which need to be left unchanged. Also note that this tool
currently only detects a single substitution per line: so in particular,
this line in README.vms needs special handling:
d402 3
a404 1
    rename perl-5^.10^.1.dir perl-5_10_1.dir
d406 6
d413 2
a414 1
=item *
d416 1
a416 1
I<You MUST SKIP this step for SNAPSHOT>
d418 1
a418 2
Review and update INSTALL to account for the change in version number;
in particular, the "Coexistence with earlier versions of perl 5" section.
d420 3
a422 1
=item *
d424 1
a424 1
I<You MUST SKIP this step for SNAPSHOT>
d426 4
a429 3
Update the F<Changes> file to contain the git log command which would show
all the changes in this release. You will need assume the existence of a
not-yet created tag for the forthcoming release; e.g.
d431 1
a431 1
    git log ... perl-5.10.0..perl5.12.0
d433 5
a437 5
Due to warts in the perforce-to-git migration, some branches require extra
exclusions to avoid other branches being pulled in. Make sure you have the
correct incantation: replace the not-yet-created tag with C<HEAD> and see
if C<git log> produces roughly the right number of commits across roughly the
right time period (you may find C<git log --pretty=oneline | wc> useful).
d439 3
a441 1
=item *
d443 3
a445 2
Check some more build configurations. The check that setuid builds and
installs is for < 5.11.0 only.
d447 1
a447 4
    $ sh Configure -Dprefix=/tmp/perl-5.x.y  -Uinstallusrbinperl \
        -Duseshrplib -Dd_dosuid
    $ make
    $ LD_LIBRARY_PATH=`pwd` make test     # or similar for useshrplib
d449 5
a453 4
    $ make suidperl
    $ su -c 'make install'
    $ ls -l .../bin/sperl
    -rws--x--x 1 root root 69974 2009-08-22 21:55 .../bin/sperl
d455 3
a457 1
(Then delete the installation directory.)
d459 3
a461 1
XXX think of other configurations that need testing.
d463 2
a464 1
=item *
d466 1
a466 1
I<You MAY SKIP this step for SNAPSHOT>
d468 1
a468 3
Update F<AUTHORS>, using the C<Porting/checkAUTHORS.pl> script, and if
necessary, update the script to include new alias mappings for porters
already in F<AUTHORS>
d470 1
a470 1
	$ git log | perl Porting/checkAUTHORS.pl --acknowledged AUTHORS -
d472 3
a474 1
=back
d476 1
a476 1
=head2 Building a release - on the day
d478 2
a479 2
This section describes the actions required to make a release (or snapshot
etc) that are performed on the actual day.
d485 5
a489 3
Review all the items in the previous section,
L<"Building a release - advance actions"> to ensure they are all done and
up-to-date.
d493 8
a500 1
I<You MAY SKIP this step for SNAPSHOT>
d502 3
a504 4
Re-read the perldelta to try to find any embarrassing typos and thinkos;
remove any C<TODO> or C<XXX> flags; update the "Known Problems" section
with any serious issues for which fixes are not going to happen now; and
run through pod and spell checkers, e.g.
d506 1
a506 2
    $ podchecker -warnings -warnings pod/perl5101delta.pod
    $ spell pod/perl5101delta.pod
d508 4
a511 2
Also, you may want to generate and view an HTML version of it to check
formatting, e.g.
d513 1
a513 1
    $ perl pod/pod2html pod/perl5101delta.pod > /tmp/perl5101delta.html
d515 2
a516 1
=item *
d518 1
a518 2
Make sure you have a gitwise-clean perl directory (no modified files,
unpushed commits etc):
d520 3
a522 1
    $ git status
d524 1
a524 1
=item *
d526 4
a529 2
If not already built, Configure and build perl so that you have a Makefile
and porting tools:
d531 1
a531 1
    $ ./Configure -Dusedevel -des && make
d533 1
a533 1
=item *
d535 2
a536 2
Check that files managed by F<regen.pl> and friends are up to date. From
within your working directory:
d539 3
a541 3
    $ make regen
    $ make regen_perly
    $ git status
d543 1
a543 2
If any of the files managed by F<regen.pl> have changed, then you should
re-make perl to check that it's okay, then commit the updated versions:
d545 1
a545 1
    $ git commit -a -m 'make regn; make regn_perly'
d547 3
a549 1
=item *
d551 1
a551 1
Rebuild META.yml:
d553 2
a554 3
    $ rm META.yml
    $ make META.yml
    $ git diff
d556 2
a557 3
XXX it would be nice to make Porting/makemeta use regen_lib.pl
to get the same 'update the file if its changed' functionality
we get with 'make regen' etc.
d559 1
a559 1
Commit META.yml if it has changed:
d561 1
a561 1
    $ git commit -m 'Update META.yml' META.yml
d563 29
a591 1
=item *
d593 1
a593 1
I<You MUST SKIP this step for SNAPSHOT>
d595 2
a596 1
Update C<Module::Corelist> with module version data for the new release.
d598 1
a598 3
Note that if this is a maint release, you should run the following actions
from the maint directory, but commit the C<Corelist.pm> changes in
I<blead> and subsequently cherry-pick it.
d601 2
a602 2
modules on CPAN. It can use a full, local CPAN mirror or fall back
to C<wget> or C<curl> to fetch only package metadata remotely.
d604 1
a604 1
(If you'd prefer to have a full CPAN mirror, see 
d609 1
a609 9
    $ make perl

If this not the first update for this version, first edit
F<lib/Module/CoreList.pm>to delete the existing entries for this version
from the C<%released> and C<%version> hashes: they will have a key like
C<5.010001> for 5.10.1.

XXX the edit-in-place functionality of Porting/corelist.pl should
be fixed to handle this automatically.
d620 4
a623 2
badly-indexed CPABN modules unreltaed to the modules actually in core.
Assuming all goes well, it will update F<lib/Module/CoreList.pm>.
d625 1
a625 1
Check that file over carefully:
d627 2
a628 1
    $ git diff lib/Module/CoreList.pm
d630 1
a630 3
If necessary, bump C<$VERSION> (there's no need to do this for
every RC; in RC1, bump the version to a new clean number that will
appear in the final release, and leave as-is for the later RCs and final).
d632 1
a632 2
Edit the version number in the new C<< 'Module::CoreList' => 'X.YZ' >>
entry, as that is likely to reflect the previous version number.
d634 1
a634 1
In addition, if this is a final release (rather than a release candidate):
d636 4
a639 1
=over 4 
d641 1
a641 1
=item *
d643 1
a643 1
Update this version's entry in the C<%released> hash with today's date.
d645 2
a646 1
=item *
d648 1
a648 3
Make sure that the script has correctly updated the C<CAVEATS> section

=back
d651 1
a651 1
(unless this is for maint; in which case commit it blead first, then
d654 27
a680 1
    $ git commit -m 'Update Module::CoreList for 5.x.y' lib/Module/CoreList.pm
d682 69
a750 1
=item *
d752 3
a754 1
Check that the manifest is sorted and correct:
a755 3
    $ make manisort
    $ make distclean
    $ perl Porting/manicheck
d757 3
d761 1
a761 1
Commit MANIFEST if it has changed:
d763 1
a763 1
    $ git commit -m 'Update MANIFEST' MANIFEST
d765 14
a778 1
=item *
d780 1
a780 1
I<You MUST SKIP this step for SNAPSHOT>
d782 1
a782 1
Add an entry to F<pod/perlhist.pod> with the current date, e.g.:
d784 3
a786 1
    David    5.10.1-RC1    2009-Aug-06
d788 3
a790 4
Make sure that the correct pumpking is listed in the left-hand column, and
if this is the first release under the stewardship of a new pumpking, make
sure that his or her name is listed in the section entitled
C<THE KEEPERS OF THE PUMPKIN>.
d796 3
a798 1
=item *
d800 1
a800 1
I<You MUST SKIP this step for SNAPSHOT>
d808 3
a810 1
             PERL_GIT_UNPUSHED_COMMITS /* do not remove this line */
d816 10
a825 1
=item *
a836 2
=item *

d840 1
a840 1
paths. Note that as they have been been built from a git working
d842 2
a843 3
commits.

Then delete the temporary installation.
d845 1
a845 1
=item *
d847 2
a848 2
If this is maint release, make sure F<Porting/mergelog> is saved and
committed.
d850 1
a850 1
=item *
d852 1
a852 1
Push all your recent commits:
d854 1
a854 1
    $ git push origin ....
d856 1
d858 17
a874 1
=item *
d880 4
a883 2
    $ make distclean
    $ git clean -xdf		#  make sure perl and git agree on files
a884 1
    $ perl Porting/makerel -b -s `git describe` # for a snapshot
d886 1
a886 1
    $ perl Porting/makerel -b                   # for a final release
d889 8
a896 3
the MANIFEST files into it, sets the correct permissions on them,
adds DOS line endings to some, then tars it up as
F<../perl-x.y.z-RC1.tar.gz>. With C<-b>, it also creates a C<tar.bz2> file.
d901 3
a903 1
=item *
d905 1
a905 1
Clean up the temporary directory, e.g.
d907 1
a907 1
    $ rm -rf ../perl-x.y.z-RC1
d909 1
a909 1
=item *
d914 1
a914 1
=item *
d916 1
a916 1
Download the tarball to some other machine. For a release candidate, 
d921 1
a921 1
=item *
d927 4
a930 1
=item *
d938 1
a938 1
=item *
d942 1
a942 1
paths. 
d947 1
a947 3
=item *

Run the Installation Verification Procedure utility:
d949 1
a949 1
    $ bin/perlivp
d954 1
a954 1
=item *
d969 1
a969 1
=item *
d973 4
a976 1
    $ ./bin/perl -MCPAN -e'shell' 
d978 1
a978 1
=item *
d983 1
a983 1
    CPAN> install Inline
d988 1
a988 1
    $ ./bin/perl -lwe 'use Inline C => "int f() { return 42;} "; print f'
d992 1
a992 3
=item *

Bootstrap the CPANPLUS client on the clean install:
d994 1
a994 16
    $ ./bin/cpanp

=item *

Install an XS module, for example:

    CPAN Terminal> i DBI
    CPAN Terminal> quit
    $ bin/perl -MDBI -e 1


=item *

I<You MAY SKIP this step for SNAPSHOT>

Check that the C<perlbug> utility works. Try the following:
d999 5
a1003 5
    Local perl administrator [yourself]: 
    Editor [vi]: 
    Module: 
    Category [core]: 
    Severity [low]: 
d1006 1
a1006 1
    Name of file to save message in [perlbug.rep]: 
d1011 2
a1012 2
try it again, this time actually submitting the bug report. Check that it
shows up, then remember to close it!
d1014 3
a1016 1
=item *
d1018 2
a1019 1
I<You MAY SKIP this step for SNAPSHOT>
d1027 6
d1034 1
a1034 3
=item *

I<You MUST SKIP this step for SNAPSHOT>
d1044 12
d1058 7
a1064 1
=item *
d1066 1
a1066 1
I<You MUST SKIP this step for SNAPSHOT>
d1068 4
a1071 4
Create a tag for the exact git revision you built the release from.
C<commit> below is the commit corresponding to the tarball. It can be
omitted if there have been no further commits since the tarball was
created.
d1073 1
a1073 2
    $ git tag perl-5.10.1-RC1 -m'Release Candidate 1 of Perl 5.10.1' <commit>
    $ git push origin tag perl-5.10.1-RC1
d1075 1
a1075 1
=item *
d1077 1
a1077 1
I<You MUST SKIP this step for SNAPSHOT>
d1084 3
a1086 1
             PERL_GIT_UNPUSHED_COMMITS /* do not remove this line */
a1090 1
    $ git push origin ....
d1092 70
d1165 1
a1165 1
Mail p5p to announce your new release, with a quote you prepared earlier.
d1169 1
a1169 1
I<You MAY SKIP this step for SNAPSHOT>
d1171 3
a1173 3
Wait 24 hours or so, then post the announcement to use.perl.org.
(if you don't have access rights to post news, ask someone like Rafael to
do it for you.)
d1177 4
a1180 1
I<You MUST SKIP this step for SNAPSHOT>
d1182 3
a1184 1
Ask Jarkko to add the tarball to http://www.cpan.org/src/
d1188 21
a1208 1
I<You MUST SKIP this step for SNAPSHOT, RC, BLEAD>
d1210 2
a1211 3
Ask Jarkko to update the descriptions of which tarballs are current in
http://www.cpan.org/src/README.html, and Rafael to update
http://dev.perl.org/perl5/
d1213 138
a1350 1
=item *
d1352 1
a1352 1
I<You MUST SKIP this step for SNAPSHOT, RC>
d1354 2
a1355 3
Create a new empty perlNNNdelta.pod file for the current release + 1;
see F<Porting/how_to_write_a_perldelta.pod>.
[ XXX Perhaps we should have an empty template file we can copy in. ]
d1357 1
a1357 2
In addition, edit F<pod.lst>, adding the new entry as 'D', and unmark previous
entry as 'D',
d1359 1
a1359 1
Change perlNNNdelta references to the new version in these files
d1361 1
a1361 5
    INSTALL
    win32/Makefile.mk
    win32/Makefile
    Makefile.SH
    README
d1363 1
a1363 2
Also, edit the previous delta file to change the C<NAME> from C<perldelta>
to C<perlNNNdelta>.
d1365 1
a1365 2
These two lists of files probably aren't exhaustive; do a recursive grep
on the previous filename to look for suitable candidates.
d1367 5
a1371 1
(see 16410843ea for an example).
d1375 2
a1376 1
Run C<perl pod/buildtoc --build-all> to update the following files:
d1378 1
a1378 4
    MANIFEST
    pod/perl.pod
    win32/pod.mak
    vms/descrip_mms.template
d1380 3
a1382 3
If you modified perldelta.pod, (F<vms/descrip_mms.template> will
needs a manual edit to bump the C<perldelta.pod> entry - it would
be good for someone to figure out the fix.)
d1386 3
a1388 1
I<You MUST SKIP this step for SNAPSHOT, RC, BLEAD>
d1390 7
a1396 2
If this was a maint release, then edit F<Porting/mergelog> to change
all the C<d> (deferred) flags to C<.> (needs review).
d1400 2
a1401 1
I<You MUST SKIP this step for SNAPSHOT, RC, BLEAD>
d1403 1
a1403 3
If this was a major release (5.x.0), then create a new maint branch 
based on the commit tagged as the current release and bump the version 
in the blead branch in git, e.g. 5.12.0 to 5.13.0.
d1405 3
a1407 2
[ XXX probably lots more stuff to do, including perldelta,
C<lib/feature.pm> ]
d1409 3
a1411 1
XXX need a git recipe
d1415 1
a1415 1
I<You MUST SKIP this step for SNAPSHOT, RC, BLEAD>
d1417 2
a1418 2
Copy the perlNNNdelta.pod for this release into the other branches, and
remember to update these files on those branches too:
d1420 2
a1421 5
    MANIFEST
    pod.lst
    pod/perl.pod
    vms/descrip_mms.template
    win32/pod.mak
d1423 7
a1429 1
(see fc5be80860 for an example).
d1431 2
a1432 1
=item *
d1434 1
a1434 1
I<You MUST SKIP this step for SNAPSHOT>
d1436 1
a1436 3
Make sure any recent F<pod/perlhist.pod> entries are copied to
F<perlhist.pod> on other branches; typically the RC* and final entries,
e.g.
d1438 2
a1439 3
          5.8.9-RC1     2008-Nov-10
          5.8.9-RC2     2008-Dec-06
          5.8.9         2008-Dec-14
d1443 5
a1447 1
I<You MUST SKIP this step for SNAPSHOT, RC>
d1449 3
a1451 2
Remind the current maintainer of C<Module::CoreList> to push a new release
to CPAN.
d1455 3
a1457 2
I<You MUST RETIRE to your preferred PUB, CAFE or SEASIDE VILLA for some much-needed
rest and relaxation>. 
d1459 4
a1462 1
Thanks for releasing perl!
d1465 24
@


1.1.1.1
log
@import perl 5.10.1
@
text
@@


1.1.1.2
log
@Perl 5.12.2 from CPAN
@
text
@d17 1
a17 3
pumpking. Blead releases from 5.11.0 forward are made each month on the
20th by a non-pumpking release engineer.  The release engineer roster
and schedule can be found in Porting/release_schedule.pod.
d110 1
a110 1
L<https://pause.perl.org/>, login, then select 'upload file to CPAN'; there
a116 6
=item search.cpan.org

Make sure that search.cpan.org knows that you're allowed to upload
perl distros. Contact Graham Barr to make sure that you're on the right
list.

a241 2
     $ ./perl -Ilib Porting/cmpVERSION.pl -d ~/my_perl-tarballs/perl-5.10.0 .

d248 1
a248 1
Read  F<Porting/how_to_write_a_perldelta.pod>, and try to make sure that
d286 1
a286 1
which will update all the files shown.
a295 11
Commit your changes:

    $ git st
	$ git diff
	  B<review the delta carefully>

    $ git commit -a -m 'Bump the perl version in various places for 5.x.y'

When the version number is bumped, you should also update Module::CoreList (as
described below in L<"Building a release - on the day">) to reflect the new
version number.
d312 1
a312 1
    git log ... perl-5.10.0..perl-5.12.0
d347 1
a347 1
    $ git log --pretty=fuller | perl Porting/checkAUTHORS.pl --acknowledged AUTHORS -
d408 1
a408 1
    $ git commit -a -m 'make regen; make regen_perly'
d438 1
a438 3
to C<wget> or C<curl> to fetch only package metadata remotely. (If you're
on Win32, then installing Cygwin is one way to have commands like C<wget>
and C<curl> available.)
d447 4
a450 5
If this not the first update for this version (e.g. if it was updated
when the version number was originally bumped), first edit
F<dist/Module-CoreList/lib/Module/CoreList.pm> to delete the existing
entries for this version from the C<%released> and C<%version> hashes:
they will have a key like C<5.010001> for 5.10.1.
d464 2
a465 3
badly-indexed CPAN modules unrelated to the modules actually in core.
Assuming all goes well, it will update
F<dist/Module-CoreList/lib/Module/CoreList.pm>.
d469 1
a469 1
    $ git diff dist/Module-CoreList/lib/Module/CoreList.pm
a477 3
Also edit Module::CoreList's new version number in its F<Changes> file and
in its F<META.yml> file.

d496 1
a496 1
    $ git commit -m 'Update Module::CoreList for 5.x.y' dist/Module-CoreList/lib/Module/CoreList.pm
a503 1
    $ git clean -xdf # This shouldn't be necessary if distclean is correct
a506 2
	XXX manifest _sorting_ is now checked with make test_porting

a580 17
I<You MUST SKIP this step for SNAPSHOT>

Tag the release (e.g.):

    $ git tag v5.11.0 -m'First release of the v5.11 series!'

(Adjust the syntax appropriately if you're working on Win32, i.e. use
C<-m "..."> rather than C<-m'...'>.)

It is VERY important that from this point forward, you not push
your git changes to the Perl master repository.  If anything goes
wrong before you publish your newly-created tag, you can delete
and recreate it.  Once you push your tag, we're stuck with it
and you'll need to use a new version number for your release.

=item *

d586 1
a586 2
    $ git clean -xdf		# make sure perl and git agree on files
    $ git status		# and there's nothing lying around
a596 1

d669 1
a669 5
    $ bin/perl -MCPAN -e'shell' 

(Use C<... -e "shell"> instead on Win32. You probably also need a set of
Unix command-line tools available for CPAN to function correctly without
Perl alternatives like LWP installed. Cygwin is an obvious choice.)
d681 1
a681 1
    $ bin/perl -lwe 'use Inline C => "int f() { return 42;} "; print f'
a684 2
(Use C<... -lwe "use ..."> instead on Win32.)

d689 1
a689 5
    $ bin/cpanp

(Again, on Win32 you'll need something like Cygwin installed, but make sure
that you don't end up with its various F<bin/cpan*> programs being found on
the PATH before those of the Perl that you're trying to test.)
d698 1
a698 1
    $
d702 1
a702 3
I<If you're building a SNAPSHOT, you should STOP HERE>

=item *
d721 2
a722 2
delete the file, and try it again, this time actually submitting the bug
report. Check that it shows up, then remember to close it!
d726 2
d737 2
a746 12
If your workstation is not connected to a high-bandwidth,
high-reliability connection to the Internet, you should probably use the
"GET URL" feature (rather than "HTTP UPLOAD") to have PAUSE retrieve the
new release from wherever you put it for testers to find it.  This will
eliminate anxious gnashing of teeth while you wait to see if your
15 megabyte HTTP upload successfully completes across your slow, twitchy
cable modem.  You can make use of your home directory on dromedary for
this purpose: F<http://users.perl5.git.perl.org/~USERNAME> maps to
F</home/USERNAME/public_html>, where F<USERNAME> is your login account
on dromedary.  I<Remember>: if your upload is partially successful, you
may need to contact a PAUSE administrator or even bump the version of perl.

d749 1
a749 4
Wait until you receive notification emails from the PAUSE indexer
confirming that your uploads have been successfully indexed.  Do not
proceed any further until you are sure that the indexing of your uploads
has been successful.
d751 1
a751 1
=item *
d753 4
a756 2
Now that you've shipped the new perl release to PAUSE, it's
time to publish the tag you created earlier to the public git repo (e.g.):
d758 2
a759 1
    $ git push origin tag v5.11.0
d763 2
d784 2
d792 3
a794 3
Check http://www.cpan.org/src/ to see if the new tarballs have appeared.
They should appear automatically, but if they don't then ask Jarkko to look
into it, since his scripts must have broken.
d798 1
a798 1
I<You MUST SKIP this step for RC, BLEAD>
d806 1
a806 6
I<You MUST SKIP this step for RC>

Remind the current maintainer of C<Module::CoreList> to push a new release
to CPAN.

=item *
d808 1
a808 5
I<You MUST SKIP this step for RC>

Bump the perlXYZdelta version number.

First, create a new empty perlNNNdelta.pod file for the current release + 1;
d810 1
d812 2
a813 2
You should be able to do this by just copying in a skeleton template and
then doing a quick fix up of the version numbers, e.g.
d815 1
a815 10
    $ cp -i Porting/perldelta_template.pod pod/perl5102delta.pod
    $ (edit it)
    $ git add pod/perl5102delta.pod

Edit F<pod.lst>: add the new entry, flagged as 'D', and unflag the previous
entry from being 'D'; for example:

    -D perl5101delta                Perl changes in version 5.10.1
    +D perl5102delta                Perl changes in version 5.10.2
    +  perl5101delta                Perl changes in version 5.10.1
d817 3
a819 4
Run C<perl pod/buildtoc --build-all> to update the F<perldelta> version in
the following files:

    MANIFEST
a820 17
    pod.lst
    pod/perl.pod
    vms/descrip_mms.template
    win32/Makefile
    win32/makefile.mk
    win32/pod.mak

Then manually edit (F<vms/descrip_mms.template> to bump the version
in the following entry:

    [.pod]perldelta.pod : [.pod]perl5101delta.pod

XXX this previous step needs to fixed to automate it in pod/buildtoc.

Manually update references to the perlNNNdelta version in these files:

    INSTALL
d823 1
a823 1
Edit the previous delta file to change the C<NAME> from C<perldelta>
d827 1
a827 2
on the previous filename to look for suitable candidates that may have
been missed.
d829 1
a829 1
Finally, commit:
d831 1
a831 1
    $ git commit -a -m 'create perlXXXdelta'
d833 10
a842 3
At this point you may want  to compare the commit with a previous bump to
see if they look similar. See commit ca8de22071 for an example of a
previous version bump.
d846 1
a846 1
I<You MUST SKIP this step for RC, BLEAD>
d853 1
a853 1
I<You MUST SKIP this step for RC, BLEAD>
d855 3
a857 4
If this was the first release of a new maint series, (5.x.0 where x is
even), then create a new maint branch based on the commit tagged as
the current release and bump the version in the blead branch in git,
e.g. 5.12.0 to 5.13.0.
d862 1
a862 4
Assuming you're using git 1.7.x or newer:

    $ git checkout -b maint-5.12
    $ git push origin -u maint-5.12
d866 1
a866 1
I<You MUST SKIP this step for RC, BLEAD>
d868 2
a869 2
Copy the perlNNNdelta.pod for this release into the other branches; for
example:
d871 5
a875 2
    $ cp -i ../5.10.x/pod/perl5101delta.pod pod/    # for example
    $ git add pod/perl5101delta.pod
d877 1
a877 1
Edit F<pod.lst> to add an entry for the file, e.g.:
d879 1
a879 1
    perl5101delta		Perl changes in version 5.10.1
d881 1
a881 9
Then rebuild various files:

    $ perl pod/buildtoc --build-all

Finally, commit:

    $ git commit -a -m 'add perlXXXdelta'

=item *
d893 9
a901 2
I<You MUST RETIRE to your preferred PUB, CAFE or SEASIDE VILLA for some
much-needed rest and relaxation>.
@


1.1.1.3
log
@import perl 5.16.3 from CPAN - worked on by Andrew Fresh and myself
@
text
@a0 2
=encoding utf8

d5 4
a8 19
Note that things change at each release, so there may be new things not
covered here, or tools may need updating.

=head1 MAKING A CHECKLIST

If you are preparing to do a release, you can run the
F<Porting/make-rmg-checklist> script to generate a new version of this
document that starts with a checklist for your release.

This script is run as:

  perl Porting/make-rmg-checklist \
      --type [BLEAD-POINT or MAINT or ...] > /tmp/rmg.pod

You can also pass the C<--html> flag to generate an HTML document instead of
POD.

  perl Porting/make-rmg-checklist --html \
      --type [BLEAD-POINT or MAINT or ...] > /tmp/rmg.html
d13 2
a14 2
manual - to produce a perl release of some description, be that a release
candidate, or final, numbered release of maint or blead.
d25 1
a25 1
The checklist of a typical release cycle is as follows:
d31 5
d46 1
a46 1
	perldelta.pod
a49 1

d52 2
a53 2
Some of the tasks described below apply to all four types of
release of Perl. (blead, RC, final release of maint, final
a58 1

d63 7
d80 1
a80 5

=item Stable/Maint release (MAINT).

A release with an even version number, and subversion number > 0, such as
5.14.1 or 5.14.2.
d88 1
a88 12
=item A blead point release (BLEAD-POINT)

A release with an odd version number, such as 5.15.0 or 5.15.1.

This isn't for production, so it has less stability requirements than for
other release types, and isn't preceded by RC releases. Other than that,
it is similar to a MAINT release.

=item Blead final release (BLEAD-FINAL)

A release with an even version number, and subversion number == 0, such as
5.14.0. That is to say, it's the big new release once per year.
d91 1
a91 1
with a whole bunch of extra post-release steps, even more than for MAINT.
a94 2
=for checklist begin

d100 5
a104 1
=head3 PAUSE account with pumpkin status
d111 5
a115 5
Check that your account is allowed to upload perl distros: go to
L<https://pause.perl.org/pause/authenquery?ACTION=who_pumpkin> and check that
your PAUSE ID is listed there.  If not, ask Andreas KE<0xf6>nig to add your ID
to the list of people allowed to upload something called perl.  You can find
Andreas' email address at:
d119 1
a119 1
=head3 search.cpan.org pumpkin status
d125 1
a125 1
=head3 rt.perl.org update access
d127 3
a129 4
Make sure you have permission to close tickets on L<http://rt.perl.org/>
so you can respond to bug report as necessary during your stint.  If you
don't, make an account (if you don't have one) and contact the pumpking
with your username to get ticket-closing permission.
d131 1
a131 1
=head3 git checkout and commit bit
d135 1
a135 1
with perl and git, see F<pod/perlgit.pod>.
a141 1
=head3 git clone of https://github.com/perlorg/perlweb
d143 3
a145 3
For updating the L<http://dev.perl.org> web pages, either a Github account or
sweet-talking somebody with a Github account into obedience is needed. This
is only needed on the day of the release or shortly afterwards.
d147 3
a149 1
=for checklist skip RC
a150 1
=head3 Quotation for release announcement epigraph
d152 1
a152 1
I<SKIP this step for RC>
a153 2
For all except an RC release of perl, you will need a quotation
to use as an epigraph to your release announcement.
d157 8
a164 4
The work of building a release candidate for an even numbered release
(BLEAD-FINAL) of perl generally starts several weeks before the first
release candidate.  Some of the following steps should be done regularly,
but all I<must> be done in the run up to a release.
d166 1
a166 1
=head3 dual-life CPAN module synchronisation
d176 1
a176 2
C<-c cachedir> option to avoid repeated CPAN downloads and may want to
use C<-m file:///mirror/path> if you made a local CPAN mirror.
d182 1
a182 1
If you are making a MAINT release, run C<core-cpan-diff> on both blead and
a187 74
=head3 How to sync a CPAN module with a cpan/ distro

=over 4

=item *

Fetch the most recent version from CPAN.

=item *

Unpack the retrieved tarball. Rename the old directory; rename the new
directory to the original name.

=item *

Restore any F<.gitignore> file. This can be done by issueing 
C<git checkout .gitignore> in the F<cpan/Distro> directory.

=item *

Remove files we do not need. That is, remove any files that match the
entries in C<@@IGNORE> in F<Porting/Maintainer.pl>, and anything that 
matches the C<EXCLUDED> section of the distro's entry in the C<%Modules>
hash.

=item *

Restore any files mentioned in the C<CUSTOMIZED> section, using
C<git checkout>. Make any new customizations if necessary. Also,
restore any files that are mentioned in C<@@IGNORE>, but were checked
in in the repository anyway.

=item *

For any new files in the distro, determine whether they are needed.
If not, delete them, and list them in either C<EXCLUDED> or C<@@INGORE>.
Otherwise, add them to C<MANIFEST>, and run C<git add> to add the files
to the repository.

=item *

For any files that are gone, remove them from C<MANIFEST>, and use
C<git rm> to tell git the files will be gone.

=item *

If the C<MANIFEST> file was changed in any of the previous steps, run
C<perl Porting/manisort --output MANIFEST.sort; mv MANIFEST.sort MANIFEST>.

=item *

For any files that have an execute bit set, either remove the execute
bit, or edit F<Porting/exec-bit.txt>

=item *

Run C<make>, see if C<perl> compiles.

=item *

Run the tests for the package.

=item *

Run the tests in F<t/porting>.

=item *

Update the C<DISTRIBUTION> entry in F<Porting/Maintainers.pl>.

=item *

Run a full configure/build/test cycle.

d190 1
a190 12
If everything is ok, commit the changes.

=back

For entries with a non-simple C<FILES> section, or with a C<MAP>, you
may have to take more steps than listed above.

F<Porting/sync-with-cpan> is a script that automates most of the steps
above; but see the comments at the beginning of the file.


=head3 dual-life CPAN module stability
d212 1
d214 1
a214 1
=head3 monitor smoke tests for failures
d216 5
a220 4
Similarly, monitor the smoking of core tests, and try to fix.  See
L<http://doc.procura.nl/smoke/index.html> for a summary. See also
L<http://www.nntp.perl.org/group/perl.daily-build.reports/> which has
the raw reports.
d225 21
d247 8
a254 1
=head3 update perldelta
d262 1
d264 1
a264 1
=head3 Bump the version number
d266 5
a270 1
Increase the version number (e.g. from 5.12.0 to 5.12.1).
d272 5
a276 6
For a BLEAD-POINT release, this can happen on the day of the release.  For a
release candidate for a stable perl, this should happen a week or two
before the first release candidate to allow sufficient time for testing and
smoking with the target version built into the perl executable. For
subsequent release candidates and the final release, it it not necessary to
bump the version further.
d278 1
a278 1
There is a tool to semi-automate this process:
d280 1
a280 1
     $ ./perl -Ilib Porting/bump-perl-version -i 5.10.0 5.10.1
d282 1
a282 3
Remember that this tool is largely just grepping for '5.10.0' or whatever,
so it will generate false positives. Be careful not change text like
"this was fixed in 5.10.0"!
d284 13
a296 1
Use git status and git diff to select changes you want to keep.
d300 3
a302 16
some of which need to be left unchanged.
The line in F<INSTALL> about "is binary incompatible with" requires a
correct choice of earlier version to declare incompatibility with.

When doing a BLEAD-POINT or BLEAD-FINAL release, also make sure the
C<PERL_API_*> constants in F<patchlevel.h> are in sync with the version
you're releasing, unless you're
absolutely sure the release you're about to make is 100% binary compatible
to an earlier release. When releasing a MAINT perl version, the C<PERL_API_*>
constants C<MUST NOT> be changed as we aim to guarantee binary compatibility
in maint branches.

After editing, regenerate uconfig.h (this must be run on a system with a
/bin/sh available):

    $ perl regen/uconfig_h.pl
d304 1
a304 6
Test your changes:

    $ git clean -xdf   # careful if you don't have local files to keep!
    $ ./Configure -des -Dusedevel
    $ make
    $ make test
d308 3
a310 3
    $ git status
    $ git diff
    B<review the delta carefully>
d314 2
a315 6
At this point you may want to compare the commit with a previous bump to
see if they look similar.  See commit 8891dd8d for an example of a
previous version bump.

When the version number is bumped, you should also update Module::CoreList
(as described below in L<"update Module::CoreList">) to reflect the new
d318 1
d320 1
a320 1
=head3 update INSTALL
d325 3
a327 3
Be particularly careful with the section "Upgrading from 5.X.Y or earlier".
The "X.Y" needs to be changed to the most recent version that we are
I<not> binary compatible with.
d329 3
a331 3
For MAINT and BLEAD-FINAL releases, this needs to refer to the last
release in the previous development cycle (so for example, for a 5.14.x
release, this would be 5.13.11).
d333 1
a333 2
For BLEAD-POINT releases, it needs to refer to the previous BLEAD-POINT
release (so for 5.15.3 this would be 5.15.2).
d335 5
a339 1
=head3 Check more build configurations
d341 4
a344 1
Check some more build configurations.
d347 1
a347 1
        -Duseshrplib -Dusesitecustomize
d349 8
a356 1
    $ make test
d360 1
d362 1
a362 1
=head3 update perlport
d364 3
a366 3
L<perlport> has a section currently named I<Supported Platforms> that
indicates which platforms are known to build in the current release.
If necessary update the list and the indicated version number.
d368 1
d370 1
d374 2
a375 2
This section describes the actions required to make a release
that are performed on the actual day.
d377 1
d379 1
a379 1
=head3 re-check earlier actions
d381 1
a381 1
Review all the actions in the previous section,
d385 1
d387 1
a387 12
=head3 bump version number

For a BLEAD-POINT release, if you did not bump the perl version number as
part of I<advance actions>, do that now.


=head3 finalize perldelta

Finalize the perldelta.  In particular, fill in the Acknowledgements
section, which can be generated with something like:

  $ perl Porting/acknowledgements.pl v5.15.0..HEAD
d394 2
a395 2
    $ podchecker -warnings -warnings pod/perldelta.pod
    $ spell pod/perldelta.pod
d400 1
a400 1
    $ ./perl -Ilib ext/Pod-Html/bin/pod2html pod/perldelta.pod > /tmp/perldelta.html
d402 1
a402 1
Another good HTML preview option is http://search.cpan.org/pod2html
d404 2
a405 1
If you make changes, be sure to commit them.
d407 1
a407 1
=for checklist skip BLEAD-POINT MAINT RC
d409 1
a409 1
=head3 remove stale perldeltas
d411 2
a412 4
For the first RC release that is ONLY for a BLEAD-FINAL, the perldeltas
from the BLEAD-POINT releases since the previous BLEAD_FINAL should have
now been consolidated into the current perldelta, and hence are now just
useless clutter.  They can be removed using:
d414 1
a414 1
    $ git rm <file1> <file2> ...
d416 1
a416 1
For example, for RC0 of 5.16.0:
d418 2
a419 2
    $ cd pod
    $ git rm perldelta515*.pod
d421 4
a424 4
All mention to them should also be removed.  Edit F<pod/perl.pod> to remove
them from its table of contents, then run F<Porting/pod_rules.pl> to
propagate your changes there into all the other files that mention them
(including F<MANIFEST>). You'll need to C<git add> the files that it changes.
d426 2
a427 1
Then build a clean perl and do a full test
d429 3
a431 5
    $ git status
    $ git clean -dxf
    $ ./Configure -Dusedevel -des
    $ make
    $ make test
d433 1
a433 1
Once all tests pass, commit your changes.
d435 3
a437 1
=head3 build a clean perl
d439 3
a441 3
If you skipped the previous step (removing the stale perldeltas)
make sure you have a gitwise-clean perl directory (no modified files,
unpushed commits etc):
d443 1
a443 2
    $ git status
    $ git clean -dxf
d445 1
a445 1
then configure and build perl so that you have a Makefile and porting tools:
d447 1
a447 1
    $ ./Configure -Dusedevel -des && make
d449 1
a449 1
=head3 update Module::CoreList
d451 1
a451 1
Update C<Module::CoreList> with module version data for the new release.
d453 3
a455 4
Note that if this is a MAINT release, you should run the following actions
from the maint branch, but commit the C<CoreList.pm> changes in
I<blead> and subsequently cherry-pick any releases since the last
maint release and then your recent commit.  XXX need a better example
d468 1
a468 1
    $ make
d470 1
a470 1
If this is not the first update for this version (e.g. if it was updated
d496 1
a496 3
=head4 Bump C<$Module::CoreList::VERSION>

If necessary, bump C<$Module::CoreList::VERSION> (there's no need to do this for
a498 3
It may also happen that C<Module::CoreList> has been modified in blead, and
hence has a new version number already.  (But make sure it is not the same
number as a CPAN release.)
d503 2
a504 12
=head4 Bump version in Module::CoreList F<Changes>

Also edit Module::CoreList's new version number in its F<Changes>
file.

=head4 Add Module::CoreList version bump to perldelta

Add a perldelta entry for the new Module::CoreList version.

=for checklist skip RC

=head4 Update C<%Module::CoreList::released> and C<CAVEATS>
a516 2
(Note, the C<CAVEATS> section is in
F<dist/Module-CoreList/lib/Module/CoreList.pod>)
a519 2
=head4 Commit Module::CoreList changes

d521 1
a521 1
(unless this is for MAINT; in which case commit it to blead first, then
d524 5
a528 1
    $ git commit -m 'Update Module::CoreList for 5.x.y' dist/Module-CoreList/lib/Module/CoreList.pm dist/Module-CoreList/lib/Module/CoreList.pod
d530 7
a536 1
=for checklist skip RC
d538 1
a538 1
=head3 update perlhist.pod
d540 3
a542 1
I<You MUST SKIP this step for a RC release>
d544 1
a544 1
Add an entry to F<pod/perlhist.pod> with the release date, e.g.:
d546 3
a548 1
    David    5.10.1       2009-Aug-06
d559 1
a559 3
=for checklist skip BLEAD-POINT

=head3 update patchlevel.h
d561 1
a561 1
I<You MUST SKIP this step for a BLEAD-POINT release>
d575 1
a575 2

=head3 build, test and check a fresh perl
d587 2
d594 1
a594 2
commits. (Note that for an odd-numbered version, perl will install
itself as C<perl5.x.y>). C<perl -v> will identify itself as:
d596 1
a596 1
 This is perl 5, version X, subversion Y (v5.X.Y (v5.X.Z-NNN-deadbeef))
d598 1
a598 2
where 5.X.Z is the latest tag, Z the number of commits since this tag,
and C<< deadbeef >> commit of that tag.
d600 2
a601 1
Then delete the temporary installation.
d603 1
a603 2

=head3 push the work so far
d610 3
a612 1
=head3 tag the release
d616 1
a616 1
    $ git tag v5.11.0 -m "First release of the v5.11 series!"
d618 4
a621 1
It is B<VERY> important that from this point forward, you not push
d627 1
a627 12

=head3 build the tarball

Before you run the following, you might want to install 7-Zip (the
C<p7zip-full> package under Debian or the C<p7zip> port on MacPorts) or
the AdvanceCOMP suite (e.g. the C<advancecomp> package under Debian,
or the C<advancecomp> port on macports - 7-Zip on Windows is the
same code as AdvanceCOMP, so Windows users get the smallest files
first time). These compress about 5% smaller than gzip and bzip2.
Over the lifetime of your distribution this will save a lot of
people a small amount of download time and disk space, which adds
up.
d637 1
a645 4
If you're getting your tarball suffixed with -uncommitted and you're sure
your changes were all committed, you can override the suffix with:

    $ perl Porting/makerel -b -s ''
d650 3
a652 1
Finally, clean up the temporary directory, e.g.
d656 1
a656 6

=head3 test the tarball

Once you have a tarball it's time to test the tarball (not the repository).

=head4 Copy the tarball to a web server
d661 1
a661 1
=head4 Download the tarball to another machine
d668 1
a668 1
=head4 Check that F<Configure> works
d674 1
a674 1
=head4 Run the test harness and install
d682 1
a682 1
=head4 Check C<perl -v> and C<perl -V>
d691 1
a691 1
=head4 Run the Installation Verification Procedure utility
d693 3
a695 1
    $ ./perl utils/perlivp
d700 1
a700 1
=head4 Compare the installed paths to the last release
d715 1
a715 1
=head4 Test the CPAN client
d719 1
a719 1
    $ bin/perl -MCPAN -e "shell"
d721 2
a722 2
If you're running this on Win32 you probably also need a set of Unix
command-line tools available for CPAN to function correctly without
d725 1
a725 1
=head4 Install the Inline module and test it
d735 1
a735 1
    $ bin/perl -lwe "use Inline C => q[int f() { return 42;}]; print f"
d739 3
a741 1
=head4 Bootstrap the CPANPLUS client
d751 3
a753 1
=head4 Install the DBI module with CPANPLUS
d760 5
a764 1
=head4 Make sure that perlbug works
d766 1
a766 1
Test L<perlbug> with the following:
d786 1
a786 3
=for checklist skip BLEAD-POINT

=head3 monitor smokes
a793 6
Note that for I<BLEAD-POINT> releases this may not be practical. It takes a
long time for the smokers to catch up, especially the Win32
smokers. This is why we have a RC cycle for I<MAINT> and I<BLEAD-FINAL>
releases, but for I<BLEAD-POINT> releases sometimes the best you can do is
to plead with people on IRC to test stuff on their platforms, fire away,
and then hope for the best.
d795 1
a795 2

=head3 upload to PAUSE
a818 11
Do not proceed any further until you are sure that your tarballs are on
CPAN.  Check your authors directory on one of the "fast" CPAN mirrors
(e.g., cpan.hexten.net
or cpan.cpantesters.org) to confirm that your uploads have been successful.

=for checklist skip RC

=head3 wait for indexing

I<You MUST SKIP this step for RC>

d820 3
a822 3
confirming that your uploads have been received.  IMPORTANT -- you will
probably get an email that indexing has failed, due to module permissions.
This is considered normal.
d824 1
a824 2

=head3 publish tag
d831 1
a831 5
=for checklist skip BLEAD-POINT

=head3 disarm patchlevel.h

I<You MUST SKIP this step for BLEAD-POINT release>
d846 1
a846 2

=head3 announce to p5p
d850 1
a850 15
Use the template at Porting/release_announcement_template.txt

=head3 update epigraphs.pod

Add your quote to F<Porting/epigraphs.pod> and commit it.
Your release announcement will probably not have reached the web-visible
archives yet, so you won't be able to include the customary link to the
release announcement yet.

=head3 blog about your epigraph

If you have a blog, please consider writing an entry in your blog explaining
why you chose that particular quote for your epigraph.

=for checklist skip RC
d852 3
a854 16
=head3 Module::CoreList nagging

I<You MUST SKIP this step for RC>

Remind the current maintainer of C<Module::CoreList> to push a new release
to CPAN.

=for checklist skip RC

=head3 new perldelta

I<You MUST SKIP this step for RC>

Create a new perldelta.

=over 4
d858 3
a860 1
Confirm that you have a clean checkout with no local changes.
d864 1
a864 1
Run F<Porting/new-perldelta.pl>
d866 3
a868 3
=item *

Run the C<git add> commands it outputs to add new and modified files.
d872 1
a872 3
Verify that the build still works, by running C<./Configure> and
C<make test_porting>. (On Win32, run C<nmake> and
C<nmake test TEST_FILES="porting\*.t ..\lib\diagnostics.t">.)
d874 2
a875 5
=item *

If F<t/porting/podcheck.t> spots errors in the new F<pod/perldelta.pod>,
run C<./perl -MTestInit t/porting/podcheck.t | less> for more detail.
Skip to the end of its test output to see the options it offers you.
d879 1
a879 1
When C<make test_porting> passes, commit the new perldelta.
d881 1
a881 1
=back
d883 2
a884 3
At this point you may want to compare the commit with a previous bump to
see if they look similar.  See commit e3c71926d3 for an example of a
previous version bump.
d886 2
a887 1
=for checklist skip BLEAD-POINT MAINT RC
d889 3
a891 1
=head3 bump version
d893 2
a894 1
I<You MUST SKIP this step for RC, BLEAD-POINT, MAINT>
d896 3
a898 3
If this was a BLEAD-FINAL release (i.e. the first release of a new maint
series, 5.x.0 where x is even), then bump the version in the blead branch
in git, e.g. 5.12.0 to 5.13.0.
d900 2
a901 3
First, add a new feature bundle to F<regen/feature.pl>, initially by just
copying the exiting entry, and bump the file's $VERSION (after the __END__
marker); e.g.
d903 8
a910 2
	 "5.14" => [qw(switch say state unicode_strings)],
    +    "5.15" => [qw(switch say state unicode_strings)],
d912 2
a913 1
Run F<regen/feature.pl> to propagate the changes to F<lib/feature.pm>.
d915 1
a915 2
Then follow the section L<"Bump the version number"> to bump the version
in the remaining files and test and commit.
d917 1
d919 1
a919 1
=head3 clean build and test
d921 2
a922 1
Run a clean build and test to make sure nothing obvious is broken.
d924 2
a925 5
In particular, F<Porting/perldelta_template.pod> is intentionally exempted
from podchecker tests, to avoid false positives about placeholder text.
However, once it's copied to F<pod/perldelta.pod> the contents can now
cause test failures. Problems should resolved by doing one of the
following:
d927 3
a929 1
=over
d931 1
a931 1
=item 1
d933 1
a933 1
Replace placeholder text with correct text.
d935 3
a937 1
=item 2
d939 1
a939 4
If the problem is from a broken placeholder link, you can add it to the
array C<@@perldelta_ignore_links> in F<t/porting/podcheck.t>.  Lines
containing such links should be marked with C<XXX> so that they get
cleaned up before the next release.
d941 1
a941 1
=item 3
d943 2
a944 2
Following the instructions output by F<t/porting/podcheck.t> on how to
update its exceptions database.
d946 1
a946 3
=back

=head3 push commits
d948 1
a948 1
Finally, push any commits done above.
d950 4
a953 5
    $ git push origin ....

=for checklist skip BLEAD-POINT MAINT RC

=head3 create maint branch
d955 2
a956 5
I<You MUST SKIP this step for RC, BLEAD-POINT, MAINT>

If this was a BLEAD-FINAL release (i.e. the first release of a new maint
series, 5.x.0 where x is even), then create a new maint branch based on
the commit tagged as the current release.
d960 1
a960 1
    $ git checkout -b maint-5.12 v5.12.0
d963 1
d965 1
a965 12
=for checklist skip BLEAD-POINT MAINT RC

=head3 make the maint branch available in the APC

Clone the new branch into /srv/gitcommon/branches on camel so the APC will
receive its changes.

    $ git clone --branch maint-5.14 /gitroot/perl.git \
    ?  /srv/gitcommon/branches/perl-5.14.x
    $ chmod -R g=u /srv/gitcommon/branches/perl-5.14.x

And nag the sysadmins to make this directory available via rsync.
d967 1
a967 7
=for checklist skip BLEAD-POINT RC

=head3 copy perldelta.pod to other branches

I<You MUST SKIP this step for RC, BLEAD-POINT>

Copy the perldelta.pod for this release into the other branches; for
d970 1
a970 1
    $ cp -i ../5.10.x/pod/perldelta.pod pod/perl5101delta.pod    # for example
d973 1
a973 1
Edit F<pod/perl.pod> to add an entry for the file, e.g.:
d985 1
a985 2

=head3 update perlhist.pod in other branches
d988 1
a988 1
F<perlhist.pod> on other branches
d991 2
d995 1
a995 12

=head3 bump RT version number

Log into http://rt.perl.org/ and check whether the new version is in the RT
fields C<Perl Version> and C<Fixed In>. The easiest way to determine this is
to go to L<https://rt.perl.org/rt3/Search/Build.html> and click on the drop
downs next to the C<Perl Version> and C<Fixed In> labels.

If the new version is not listed there, send an email to C<perlbug-admin at
perl.org> requesting this.

=head3 Relax!
a1001 43

=head2 Building a release - the day after

=head3 link announcement in epigraphs.pod

Add, to your quote to F<Porting/epigraphs.pod>, a link to the release
announcement in the web-visible mailing list archive.  Commit it.

=head3 check tarball availability

Check various website entries to make sure the that tarball has appeared
and is properly indexed:

=over 4

=item *

Check your author directory under L<http://www.cpan.org/authors/id/>
to ensure that the tarballs are available on the website.

=item *

Check C</src> on CPAN (on a fast mirror) to ensure that links to
the new tarballs have appeared.  There should be links in C</src/5.0>
(which is accumulating all new versions), links in C</src> (which shows
only the latest version on each branch), and an appropriate mention in
C</src/README.html> (which describes the latest versions).

These links should appear automatically, some hours after upload.
If they don't, or the C<README.html> description is inadequate,
ask Ask <ask@@perl.org>.

=item *

Check L<http://www.cpan.org/src/> to ensure that the C</src> updates
have been correctly mirrored to the website.
If they haven't, ask Ask <ask@@perl.org>.

=item *

Check L<http://search.cpan.org> to see if it has indexed the distribution.
It should be visible at a URL like C<http://search.cpan.org/dist/perl-5.10.1/>.

a1002 15

=for checklist skip RC

=head3 update dev.perl.org

I<You MUST SKIP this step for a RC release>

In the C<perlorg> repository, edit F<docs/dev/perl5/index.html>
to link to this new release. Then make a pull request to Leo Lapworth.
If this fails for some reason and you cannot cajole anybody else into
submitting that change, you can mail Leo as last resort.

This repository can be found on L<github|https://github.com/perlorg/perlweb>.

=for checklist end
@


1.1.1.4
log
@Import perl-5.18.2

OK espie@@ sthen@@ deraadt@@
@
text
@d38 2
a39 2
This document both helps as a check-list for the release engineer
and is a base for ideas on how the various tasks could be automated
d68 1
a68 1
of these release types.  If a step does not apply to a given
a98 7
Note that for a maint release there are two versions of this guide to
consider: the one in the maint branch, and the one in blead. Which one to
use is a fine judgement. The blead one will be most up-to-date, while
it might describe some steps or new tools that aren't applicable to older
maint branches. It is probably best to review both versions of this
document, but to most closely follow the steps in the maint version.

d187 2
a188 1
To see which core distro versions differ from the current CPAN versions:
d190 1
a190 1
    $ ./perl -Ilib Porting/core-cpan-diff -x -a
d192 5
a196 7
Passing C<-u cpan> (and maybe C<-u undef>) will probably be helpful, since
those are the only types of distributions that you can actually affect as a
perl release manager (as opposed to a CPAN module maintainer).

You can also run an actual diff of the contents of the modules, comparing core
to CPAN, to ensure that there were no erroneous/extraneous changes that need to
be dealt with. You do this by not passing the C<-x> option:
d198 1
a198 1
    $ ./perl -Ilib Porting/core-cpan-diff -a -o /tmp/corediffs
d200 1
a200 7
then fix the core, or cajole CPAN authors as appropriate. See also the C<-d>
and C<-v> options for more detail (and the C<-u> option as mentioned above).
You'll probably want to use the C<-c cachedir> option to avoid repeated CPAN
downloads and may want to use C<-m file:///mirror/path> if you made a local
CPAN mirror. Note that a minicpan mirror won't actually work, but can provide a
good first pass to quickly get a list of modules which definitely haven't
changed, to avoid having to download absolutely everything.
d206 1
a206 1
have some extra changes.
d223 1
a223 1
Restore any F<.gitignore> file. This can be done by issuing
d229 1
a229 1
entries in C<@@IGNORE> in F<Porting/Maintainer.pl>, and anything that
d264 1
a264 1
Run C<make> (or C<nmake> on Windows), see if C<perl> compiles.
d292 1
a292 4
above; but see the comments at the beginning of the file.  In particular,
it has not yet been exercised on Windows, but will certainly require a set
of Unix tools such as Cygwin, and steps that run C<make> will need to run
C<nmake> instead.
d321 1
a321 2
L<http://doc.procura.nl/smoke/index.html> and L<http://perl5.test-smoke.org/>
for a summary. See also
a339 3
Do not do this yet for a BLEAD-POINT release! You will do this at the end of
the release process.

d342 2
a343 1
For a release candidate for a stable perl, this should happen a week or two
a377 2
This might not cause any new changes.

d394 1
a394 1
see if they look similar.  See commit 0e79a3d1bc for an example of a
d420 1
a420 2
Try running the full test suite against multiple Perl configurations. Here are
some sets of Configure flags you can try:
d422 4
a425 5
=over 4

=item *

C<-Duseshrplib -Dusesitecustomize>
d427 1
a427 1
=item *
a428 10
C<-Duserelocatableinc>

=item *

C<-Dusethreads>

=back

If you have multiple compilers on your machine, you might also consider
compiling with C<-Dcc=$other_compiler>.
d441 1
a441 1
that are performed near to, or on the actual release day.
d451 1
a451 6
=head3 create a release branch

For BLEAD-POINT releases, making a release from a release branch avoids the
need to freeze blead during the release. This is less important for
BLEAD-FINAL, MAINT, and RC releases, since blead will already be frozen in
those cases. Create the branch by running
d453 2
a454 1
  git checkout -b release-5.xx.yy
d497 4
a500 20
=for checklist skip BLEAD BLEAD-POINT

=head3 add recent perldeltas

For the first RC for a MAINT release, copy in any recent perldeltas from
blead that have been added since the last release on this branch. This
should include any recent maint releases on branches older than your one,
but not newer. For example if you're producing a 5.14.x release, copy any
perldeltas from recent 5.10.x, 5.12.x etc maint releases, but not from
5.16.x or higher. Remember to

    $ git add <file1> <file2> ...

=head3 update and commit perldelta files

If you have added or removed any perldelta files via the previous two
steps, then edit F<pod/perl.pod> to add/remove them from its table of
contents, then run F<Porting/pod_rules.pl> to propagate your changes there
into all the other files that mention them (including F<MANIFEST>). You'll
need to C<git add> the files that it changes.
d514 1
a514 1
If you skipped the previous step (adding/removing perldeltas)
a533 15
[ Note that the procedure for handling Module::CoreList in maint branches
is a bit complex, and the RMG currently don't describe a full and
workable approach. The main issue is keeping Module::CoreList
and its version number synchronised across all maint branches, blead and
CPAN, while having to bump its version number for every RC release.
See this brief p5p thread:

    Message-ID: <20130311174402.GZ2294@@iabyn.com>

If you can devise a workable system, feel free to try it out, and to
update the RMG accordingly!

DAPM May 2013 ]


d535 4
a538 2
modules on CPAN. It can use a full, local CPAN mirror and/or fall back
on HTTP::Tiny to fetch package metadata remotely.
d540 1
a540 1
(If you'd prefer to have a full CPAN mirror, see
a584 10
=head4 Bump C<$Module::CoreList::TieHashDelta::VERSION>

C<$Module::CoreList::TieHashDelta::VERSION> should always be equal to
C<$Module::CoreList::VERSION>. Make sure the two versions match before
proceeding.

Edit the version number in the new
C<< 'Module::CoreList::TieHashDelta' => 'X.YZ' >> entry, as that is likely to
reflect the previous version number.

d600 1
a600 1
=over 4
a621 15
=for checklist skip BLEAD BLEAD-POINT

=head3 synchronise from blead's perlhist.pod

For the first RC for a MAINT release, copy in the latest
F<pod/perlhist.pod> from blead; this will include details of newer
releases in all branches. In theory, blead's version should be a strict
superset of the one in this branch, but it's probably safest to diff them
first to ensure that there's nothing in this branch that was forgotten
from blead:

    $ diff pod/perlhist.pod ..../blead/pod/perlhist.pod
    $ cp  ..../blead/pod/perlhist.pod pod/
    $ git commit -m 'sync perlhist from blead' pod/perlhist.pod

a636 4
I<If you're making a BLEAD-FINAL release>, also update the "SELECTED
RELEASE SIZES" section with the output of
F<Porting/perlhist_calculate.pl>.

a658 8
=head3 run makemeta to update META files

    $ ./perl -Ilib Porting/makemeta

Be sure to commit any changes (if applicable):

    $ git status   # any changes?
    $ git commit -m 'Update META files' META.*
d680 1
a680 1
 This is perl 5, version X, subversion Y (v5.X.Y (v5.X.Z-NNN-gdeadbeef))
d682 1
a682 1
where 5.X.Z is the latest tag, NNN the number of commits since this tag,
d692 2
a693 1
    $ git push origin release-5.xx.yy
d760 1
a760 1
Download the tarball to some other machine. For a release candidate,
d783 1
a783 1
paths.
d810 1
a810 1
=head4 Bootstrap the CPAN client
d814 1
a814 1
    $ bin/cpan
d816 5
a820 1
=head4 Install the Inline module with CPAN and test it
d840 4
d858 5
a862 5
    Local perl administrator [yourself]:
    Editor [vi]:
    Module:
    Category [core]:
    Severity [low]:
d865 1
a865 1
    Name of file to save message in [perlbug.rep]:
a964 14
Send a carbon copy to C<noc@@metacpan.org>

=head3 merge release branch back to blead

If you made a release branch for this release, merge it back into master now,
and delete it.

  git checkout blead
  git pull
  git merge release-5.xx.yy
  git push
  git push origin :release-5.xx.yy
  git branch -d release-5.xx.yy

d1011 2
a1012 1
C<make test_porting>. (On Win32 use the appropriate make utility).
d1027 1
a1027 1
see if they look similar.  See commit 4eabcf701b for an example of a
d1030 1
a1030 1
=for checklist skip MAINT RC
d1034 1
a1034 1
I<You MUST SKIP this step for RC and MAINT>
a1051 3
If this was a BLEAD-POINT release, then just follow the section
L<"Bump the version number">.

d1120 1
a1120 1
=head3 copy perldelta.pod to blead
d1124 2
a1125 1
Copy the perldelta.pod for this release into blead; for example:
a1126 1
    $ cd ..../blead
d1136 1
a1136 1
    $ perl Porting/pod_rules.pl
d1143 1
a1143 1
=head3 copy perlhist.pod entries to blead
d1146 2
a1147 1
F<perlhist.pod> on blead.  e.g.
d1193 3
a1195 2
(which is accumulating all new versions), and an appropriate mention in
C</src> (which describes the latest versions in each branch, with links).
d1198 1
a1198 1
If they don't, or the C</src> description is inadequate,
d1220 4
a1223 7
In your C<perlweb> repository, link to the new release.  For a new
latest-maint release, edit F<docs/shared/tpl/stats.html>.  Otherwise,
edit F<docs/dev/perl5/index.html>.

Then make a pull request to Leo Lapworth.  If this fails for some reason
and you cannot cajole anybody else into submitting that change, you can
mail Leo as last resort.
@


1.1.1.5
log
@Import perl-5.20.1
@
text
@d62 1
d72 1
d198 3
a200 3
However, this only checks whether the version recorded in
F<Porting/Maintainers.pl> differs from the latest on CPAN.  It doesn't tell you
if the code itself has diverged from CPAN.
d208 7
a214 23
Passing C<-u cpan> will probably be helpful, since it limits the search to
distributions with 'cpan' upstream source.  (It's OK for blead upstream to
differ from CPAN because those dual-life releases usually come I<after> perl
is released.)

See also the C<-d> and C<-v> options for more detail (and the C<-u> option as
mentioned above).  You'll probably want to use the C<-c cachedir> option to
avoid repeated CPAN downloads and may want to use C<-m file:///mirror/path> if
you made a local CPAN mirror. Note that a minicpan mirror won't actually work,
but can provide a good first pass to quickly get a list of modules which
definitely haven't changed, to avoid having to download absolutely everything.

For a BLEAD-POINT or BLEAD-FINAL release with 'cpan' upstream, if a CPAN
release appears to be ahead of blead, then consider updating it (or asking the
relevant porter to do so). (However, if this is a BLEAD-FINAL release or one of
the last BLEAD-POINT releases before it and hence blead is in some kind of
"code freeze" state (e.g. the sequence might be "contentious changes freeze",
then "user-visible changes freeze" and finally "full code freeze") then any
CPAN module updates must be subject to the same restrictions, so it may not be
possible to update all modules until after the BLEAD-FINAL release.) If blead
contains edits to a 'cpan' upstream module, this is naughty but sometimes
unavoidable to keep blead tests passing. Make sure the affected file has a
CUSTOMIZED entry in F<Porting/Maintainers.pl>.
d243 1
a243 1
entries in C<@@IGNORABLE> in F<Porting/Maintainer.pl>, and anything that
d252 1
a252 1
into the repository anyway.
d311 1
d316 18
a333 17
 for each module that fails its regression tests on $current
     did it fail identically on $previous?
     if yes, "SEP" (Somebody Else's Problem)
     else work out why it failed (a bisect is useful for this)

 attempt to group failure causes

 for each failure cause
     is that a regression?
     if yes, figure out how to fix it
         (more code? revert the code that broke it)
     else
         (presumably) it's relying on something un-or-under-documented
         should the existing behaviour stay?
             yes - goto "regression"
             no - note it in perldelta as a significant bugfix
             (also, try to inform the module's author)
d346 1
a354 3
You won't be able to automatically fill in the "Updated Modules" section until
after Module::CoreList is updated (as described below in
L<"update Module::CoreList">).
d366 1
a366 1
subsequent release candidates and the final release, it is not necessary to
d387 5
a391 4
you're releasing, unless you're absolutely sure the release you're about to
make is 100% binary compatible to an earlier release. When releasing a MAINT
perl version, the C<PERL_API_*> constants C<MUST NOT> be changed as we aim
to guarantee binary compatibility in maint branches.
d396 1
a396 1
 $ perl regen/uconfig_h.pl
d402 4
a405 4
 $ git clean -xdf   # careful if you don't have local files to keep!
 $ ./Configure -des -Dusedevel
 $ make
 $ make test
d409 3
a411 3
 $ git status
 $ git diff
 B<review the delta carefully>
d413 1
a413 1
 $ git commit -a -m 'Bump the perl version in various places for 5.x.y'
d416 1
a416 1
see if they look similar.  See commit f7cf42bb69 for an example of a
d423 1
a439 10
=head3 Check copyright years

Check that the copyright years are up to date by running:

 $ ./perl t/porting/copyright.t --now

Remedy any test failures by editing README or perl.c accordingly (search for
the "Copyright"). If updating perl.c, check if the file's own copyright date in
the C comment at the top needs updating, as well as the one printed by C<-v>.

a469 1
=head3 check a readonly build
a470 4
Even before other prep work, follow the steps in  L<build the tarball> and test
it locally.  Because a perl source tarballs sets many files read-only, it could
test differently than tests run from the repository.  After you're sure
permissions aren't a problem, delete the generated directory and tarballs.
d477 1
d484 1
d494 72
d568 2
a569 1
Make sure you have a gitwise-clean perl directory (no modified files,
d581 1
a581 15
=head4 Bump Module::CoreList* $VERSIONs

If necessary, bump C<$Module::CoreList::VERSION> (there's no need to do this for
every RC; in RC1, bump the version to a new clean number that will
appear in the final release, and leave as-is for the later RCs and final).
It may also happen that C<Module::CoreList> has been modified in blead, and
hence has a new version number already.  (But make sure it is not the same
number as a CPAN release.)

C<$Module::CoreList::TieHashDelta::VERSION> and
C<$Module::CoreList::Utils::VERSION> should always be equal to
C<$Module::CoreList::VERSION>. If necessary, bump those two versions to match
before proceeding.

=head4 Update C<Module::CoreList> with module version data for the new release.
d602 1
d614 9
d634 1
a634 3
F<dist/Module-CoreList/lib/Module/CoreList.pm> and possibly
F<dist/Module-CoreList/lib/Module/CoreList.pod> and/or
F<dist/Module-CoreList/lib/Module/CoreList/Utils.pm>.
d636 1
a636 1
Check those files over carefully:
d639 22
a660 2
    $ git diff dist/Module-CoreList/lib/Module/CoreList.pod
    $ git diff dist/Module-CoreList/lib/Module/CoreList/Utils.pm
d664 2
a665 1
Also edit Module::CoreList's new version number in its F<Changes> file.
d697 1
a697 93
    $ git commit -m 'Update Module::CoreList for 5.x.y' dist/Module-CoreList/Changes dist/Module-CoreList/lib/Module/CoreList.pm dist/Module-CoreList/lib/Module/CoreList.pod dist/Module-CoreList/lib/Module/CoreList/Utils.pm

=head4 Rebuild and test

Build and test to get the changes into the currently built lib directory and to ensure
all tests are passing.

=head3 finalize perldelta

Finalize the perldelta.  In particular, fill in the Acknowledgements
section, which can be generated with something like:

  $ perl Porting/acknowledgements.pl v5.15.0..HEAD

Fill in the "New/Updated Modules" sections now that Module::CoreList is updated:

  $ ./perl -Ilib Porting/corelist-perldelta.pl --mode=update pod/perldelta.pod

Ideally, also fill in a summary of the major changes to each module for which
an entry has been added by F<corelist-perldelta.pl>.

Re-read the perldelta to try to find any embarrassing typos and thinkos;
remove any C<TODO> or C<XXX> flags; update the "Known Problems" section
with any serious issues for which fixes are not going to happen now; and
run through pod and spell checkers, e.g.

    $ podchecker -warnings -warnings pod/perldelta.pod
    $ spell pod/perldelta.pod

Also, you may want to generate and view an HTML version of it to check
formatting, e.g.

    $ ./perl -Ilib ext/Pod-Html/bin/pod2html pod/perldelta.pod > /tmp/perldelta.html

Another good HTML preview option is http://search.cpan.org/pod2html

If you make changes, be sure to commit them.

=for checklist skip BLEAD-POINT MAINT RC

=head3 remove stale perldeltas

For the first RC release that is ONLY for a BLEAD-FINAL, the perldeltas
from the BLEAD-POINT releases since the previous BLEAD-FINAL should have
now been consolidated into the current perldelta, and hence are now just
useless clutter.  They can be removed using:

    $ git rm <file1> <file2> ...

For example, for RC0 of 5.16.0:

    $ cd pod
    $ git rm perldelta515*.pod

=for checklist skip BLEAD-FINAL BLEAD-POINT

=head3 add recent perldeltas

For the first RC for a MAINT release, copy in any recent perldeltas from
blead that have been added since the last release on this branch. This
should include any recent maint releases on branches older than your one,
but not newer. For example if you're producing a 5.14.x release, copy any
perldeltas from recent 5.10.x, 5.12.x etc maint releases, but not from
5.16.x or higher. Remember to

    $ git add <file1> <file2> ...

=head3 update and commit perldelta files

If you have added or removed any perldelta files via the previous two
steps, then edit F<pod/perl.pod> to add/remove them from its table of
contents, then run F<Porting/pod_rules.pl> to propagate your changes there
into all the other files that mention them (including F<MANIFEST>). You'll
need to C<git add> the files that it changes.

Then build a clean perl and do a full test

    $ git status
    $ git clean -dxf
    $ ./Configure -Dusedevel -des
    $ make
    $ make test

Once all tests pass, commit your changes.

=head3 build a clean perl

If you skipped the previous step (adding/removing perldeltas),
again, make sure you have a gitwise-clean perl directory (no modified files,
unpushed commits etc):

    $ git status
    $ git clean -dxf
d699 1
a699 5
then configure and build perl so that you have a Makefile and porting tools:

    $ ./Configure -Dusedevel -des && make

=for checklist skip BLEAD-FINAL BLEAD-POINT
d779 1
a779 1
paths. Note that as they have been built from a git working
a790 1
=head3 create the release tag
d792 9
a800 1
Create the tag identifying this release (e.g.):
d810 1
d826 4
a829 4
 $ cd root/of/perl/tree
 $ make distclean
 $ git clean -xdf       # make sure perl and git agree on files
 $ git status           # and there's nothing lying around
d831 2
a832 2
 $ perl Porting/makerel -b -s RC1            # for a release candidate
 $ perl Porting/makerel -b                   # for a final release
d835 3
a837 3
the MANIFEST files into it, sets the correct permissions on them, then
tars it up as F<../perl-x.y.z-RC1.tar.gz>. With C<-b>, it also creates a
C<tar.bz2> file.
d851 1
d933 13
a971 3
XXX This is probably irrelevant if working on a release branch, though
MAINT or RC might want to push a smoke branch and wait.

d985 1
d1010 4
a1013 3
Do not proceed any further until you are sure that your tarballs are on CPAN.
Check your authors directory www.cpan.org (the globally balanced "fast"
mirror) to confirm that your uploads have been successful.
d1015 1
a1015 1
=for checklist skip RC BLEAD-POINT
d1019 1
a1019 1
I<You MUST SKIP this step for RC and BLEAD-POINT>
d1026 8
d1050 3
d1064 2
a1065 1
Merge the (local) release branch back into master now, and delete it.
d1071 1
a1073 14
Note: The merge will create a merge commit if other changes have been pushed
to blead while you've been working on your release branch. Do NOT rebase your
branch to avoid the merge commit (as you might normally do when merging a
small branch into blead) since doing so will invalidate the tag that you
created earlier.

=head3 publish the release tag

Now that you've shipped the new perl release to PAUSE and pushed your changes
to the Perl master repository, it's time to publish the tag you created
earlier too (e.g.):

    $ git push origin tag v5.11.0

d1077 3
a1079 3
You can include the customary link to the release announcement even before your
message reaches the web-visible archives by looking for the X-List-Archive
header in your message after receiving it back via perl5-porters.
d1135 1
a1135 1
see if they look similar.  See commit ba03bc34a4 for an example of a
a1162 2
After bumping the version, follow the section L<"update INSTALL"> to
ensure all version number references are correct.
a1228 2
XXX Who are the sysadmins?  Contact info?

d1237 3
a1239 6
 $ cd ..../blead
 $ cp -i ../5.10.x/pod/perldelta.pod pod/perl5101delta.pod  # for example
 $ git add pod/perl5101delta.pod

Don't forget to set the NAME correctly in the new file (e.g. perl5101delta
rather than perldelta).
d1249 1
a1249 1
Finally, commit and push:
a1251 1
    $ git push origin ....
a1252 1
=for checklist skip BLEAD-POINT
d1261 1
d1265 3
a1267 5
fields C<Perl Version> and C<Fixed In>. The easiest way to determine this is to
open up any ticket for modification and check the drop downs next to the
C<Perl Version> and C<Fixed In> labels.

Here, try this link: L<https://rt.perl.org/Ticket/Modify.html?id=10000>
d1279 1
a1286 68
=for checklist skip BLEAD-FINAL, MAINT, RC

=head3 update Module::CoreList

I<After a BLEAD-POINT release only>

After Module::CoreList has shipped to CPAN by the maintainer, update
Module::CoreList in the source so that it reflects the new blead
version number:

=over 4

=item *

Update F<Porting/Maintainers.pl> to list the new DISTRIBUTION on CPAN,
which should be identical to what is currently in blead.

=item *

Bump the $VERSION in F<dist/Module-CoreList/lib/Module/CoreList.pm>,
F<dist/Module-CoreList/lib/Module/CoreList/TieHashDelta.pm> and
F<dist/Module-CoreList/lib/Module/CoreList/Utils.pm>.

=item *

If you have a local CPAN mirror, run:

    $ ./perl -Ilib Porting/corelist.pl ~/my-cpan-mirror

Otherwise, run:

    $ ./perl -Ilib Porting/corelist.pl cpan

This will update F<dist/Module-CoreList/lib/Module/CoreList.pm>,
F<dist/Module-CoreList/lib/Module/CoreList.pod> and
F<dist/Module-CoreList/lib/Module/CoreList/Utils.pm> as it did before,
but this time adding new sections for the next BLEAD-POINT release.

=item *

Add the new $Module::CoreList::VERSION to
F<dist/Module-CoreList/Changes>.

=item *

Update F<pod/perldelta.pod> to mention the upgrade to Module::CoreList.

=item *

Remake perl to get your changed .pm files propagated into F<lib/> and
then run at least the F<dist/Module-CoreList/t/*.t> tests and the
test_porting makefile target to check that they're ok.

=item *

Run

    $ ./perl -Ilib -MModule::CoreList -le 'print Module::CoreList->find_version($]) ? "ok" : "not ok"'

and check that it outputs "ok" to prove that Module::CoreList now knows
about blead's current version.

=item *

Commit and push your changes.

=back

d1302 3
a1304 4
the new tarballs have appeared: There should be links in C</src/5.0>
(which is accumulating all new versions), and (for BLEAD-FINAL and
MAINT only) an appropriate mention in C</src/README.html> (which describes
the latest versions in each stable branch, with links).
d1306 1
a1306 1
The C</src/5.0> links should appear automatically, some hours after upload.
a1337 6

=head3 update release manager's guide

Go over your notes from the release (you did take some, right?) and update
F<Porting/release_managers_guide.pod> with any fixes or information that
will make life easier for the next release manager.
@


1.1.1.6
log
@Import perl-5.20.2
@
text
@d18 2
a19 2
    perl Porting/make-rmg-checklist \
        --type [BLEAD-POINT or MAINT or ...] > /tmp/rmg.pod
d24 2
a25 2
    perl Porting/make-rmg-checklist --html \
        --type [BLEAD-POINT or MAINT or ...] > /tmp/rmg.html
d51 1
a51 1
    ...a few weeks pass...
d174 2
d178 4
a181 1
You will need a quotation to use as an epigraph to your release announcement.
d329 17
a345 17
   for each module that fails its regression tests on $current
       did it fail identically on $previous?
       if yes, "SEP" (Somebody Else's Problem)
       else work out why it failed (a bisect is useful for this)

   attempt to group failure causes

   for each failure cause
       is that a regression?
       if yes, figure out how to fix it
           (more code? revert the code that broke it)
       else
           (presumably) it's relying on something un-or-under-documented
           should the existing behaviour stay?
               yes - goto "regression"
               no - note it in perldelta as a significant bugfix
               (also, try to inform the module's author)
d385 1
a385 1
    $ ./perl -Ilib Porting/bump-perl-version -i 5.10.0 5.10.1
d396 2
a397 5
See below in L<"update INSTALL"> for more details.

For the first RC release leading up to a BLEAD-FINAL release, update the
description of which releases are now "officially" supported in
F<pod/perlpolicy.pod>.
d409 1
a409 1
    $ perl regen/uconfig_h.pl
a412 4
You may have to add stub entries in C<%Module::CoreList::version>,
C<%Module::CoreList::deprecated> and C<%Module::CoreList::Utils::delta>.
If so, you must up their version numbers as well.

d415 4
a418 4
    $ git clean -xdf   # careful if you don't have local files to keep!
    $ ./Configure -des -Dusedevel
    $ make
    $ make test
d422 3
a424 3
    $ git status
    $ git diff
    B<review the delta carefully>
d426 1
a426 1
    $ git commit -a -m 'Bump the perl version in various places for 5.x.y'
d438 2
a439 5
Review and update INSTALL to account for the change in version number.
The lines in F<INSTALL> about "is not binary compatible with" may require a
correct choice of earlier version to declare incompatibility with. These are
in the "Changes and Incompatibilities" and "Coexistence with earlier versions
of perl 5" sections.
d456 1
a456 1
    $ ./perl t/porting/copyright.t --now
d517 1
a517 1
    git checkout -b release-5.xx.yy
a530 14
=head3 Check module versions

For each Perl release since the previous release of the current branch, check
for modules that have identical version numbers but different contents by
running:

    $ ./perl Porting/cmpVERSION.pl --tag=v5.X.YY

(This is done automatically by F<t/porting/cmp_version.t> for the previous
release of the current branch, but not for any releases from other branches.)

Any modules that fail will need a version bump, plus a nudge to the upstream
maintainer for 'cpan' upstream modules.

d535 2
a536 2
If necessary, bump C<$Module::CoreList::VERSION> (there's no need to do this
for every RC; in RC1, bump the version to a new clean number that will
a546 4
The files to modify are: F<dist/Module-CoreList/lib/Module/CoreList.pm>,
F<dist/Module-CoreList/lib/Module/CoreList/Utils.pm> and
F<dist/Module-CoreList/lib/Module/CoreList/TieHashDelta.pm>.

d591 1
d597 1
d610 9
a618 1
=head4 Update C<%Module::CoreList::released>
d620 7
a626 2
For any release except an RC: Update this version's entry in the C<%released>
hash with today's date.
d634 1
a634 4
    $ git commit -m 'Update Module::CoreList for 5.x.y' \
        dist/Module-CoreList/Changes \
        dist/Module-CoreList/lib/Module/CoreList.pm \
        dist/Module-CoreList/lib/Module/CoreList/Utils.pm
d638 2
a639 2
Build and test to get the changes into the currently built lib directory and to
ensure all tests are passing.
d646 1
a646 4
    $ perl Porting/acknowledgements.pl v5.15.0..HEAD

Fill in the "New/Updated Modules" sections now that Module::CoreList is
updated:
d648 1
a648 2
    $ ./perl -Ilib Porting/corelist-perldelta.pl \
        --mode=update pod/perldelta.pod
d650 1
a650 4
For a MAINT release use something like this instead:

    $ ./perl -Ilib Porting/corelist-perldelta.pl 5.020001 5.020002 \
        --mode=update pod/perldelta.pod
d666 1
a666 2
    $ ./perl -Ilib ext/Pod-Html/bin/pod2html pod/perldelta.pod > \
        /tmp/perldelta.html
d747 2
d751 2
d757 4
a760 3
List yourself in the left-hand column, and if this is the first release
that you've ever done, make sure that your name is listed in the section
entitled C<THE KEEPERS OF THE PUMPKIN>.
d782 1
a782 3
     #ifdef PERL_GIT_UNCOMMITTED_CHANGES
             ,"uncommitted-changes"
     #endif
d817 1
a817 1
    This is perl 5, version X, subversion Y (v5.X.Y (v5.X.Z-NNN-gdeadbeef))
d851 4
a854 5
    $ cd root/of/perl/tree
    $ make distclean       # make sure distclean works
    $ git clean -xdf       # make sure perl and git agree on files
                           # git clean should not output anything!
    $ git status           # and there's nothing lying around
d856 2
a857 2
    $ perl Porting/makerel -b -s RC1            # for a release candidate
    $ perl Porting/makerel -b                   # for a final release
a897 3
    # Or for a development release:
    $ ./Configure -Dusedevel -des && make all test

a942 3
    # Or, perhaps:
    $ bin/cpan5.xx.x

d948 1
a948 1
    CPAN> install Inline::C
d1049 1
a1049 3
     #ifdef PERL_GIT_UNCOMMITTED_CHANGES
             ,"uncommitted-changes"
     #endif
d1067 5
a1071 5
    git checkout blead
    git pull
    git merge release-5.xx.yy
    git push
    git branch -d release-5.xx.yy
a1100 8
=head3 Release schedule

I<You MUST SKIP this step for RC>

Tick the entry for your release in F<Porting/release_schedule.pod>.

=for checklist skip RC

a1178 12
(Note: The version is NOT bumped immediately after a MAINT release in order
to avoid confusion and wasted time arising from bug reports relating to
"intermediate versions" such as 5.20.1-and-a-bit: If the report is caused
by a bug that gets fixed in 5.20.2 and this intermediate version already
calls itself 5.20.2 then much time can be wasted in figuring out why there
is a failure from something that "should have been fixed". If the bump is
late then there is a much smaller window of time for such confusing bug
reports to arise. (The opposite problem -- trying to figure out why there
*is* a bug in something calling itself 5.20.1 when in fact the bug was
introduced later -- shouldn't arise for MAINT releases since they should,
in theory, only contain bug fixes but never regressions.))

d1186 1
a1186 1
cause test failures. Problems should be resolved by doing one of the
d1254 3
a1256 3
    $ cd ..../blead
    $ cp -i ../5.10.x/pod/perldelta.pod pod/perl5101delta.pod  # for example
    $ git add pod/perl5101delta.pod
d1281 1
a1281 1
    5.8.9         2008-Dec-14
d1304 5
d1342 2
a1343 1
This will update F<dist/Module-CoreList/lib/Module/CoreList.pm> and
d1366 1
a1366 2
    $ ./perl -Ilib -MModule::CoreList \
        -le 'print Module::CoreList->find_version($]) ? "ok" : "not ok"'
@


