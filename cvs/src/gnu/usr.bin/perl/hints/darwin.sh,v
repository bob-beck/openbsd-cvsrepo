head	1.3;
access;
symbols
	OPENBSD_6_2:1.3.0.6
	OPENBSD_6_2_BASE:1.3
	PERL_5_24_2:1.1.1.12
	OPENBSD_6_1:1.3.0.4
	OPENBSD_6_1_BASE:1.3
	OPENBSD_6_0:1.2.0.4
	OPENBSD_6_0_BASE:1.2
	OPENBSD_5_9:1.1.1.11.0.2
	OPENBSD_5_9_BASE:1.1.1.11
	OPENBSD_5_8:1.1.1.11.0.4
	OPENBSD_5_8_BASE:1.1.1.11
	PERL_5_20_2:1.1.1.11
	OPENBSD_5_7:1.1.1.10.0.2
	OPENBSD_5_7_BASE:1.1.1.10
	PERL_5_20_1:1.1.1.10
	OPENBSD_5_6:1.1.1.9.0.8
	OPENBSD_5_6_BASE:1.1.1.9
	PERL_5_18_2:1.1.1.9
	PERL:1.1.1
	OPENBSD_5_5:1.1.1.9.0.6
	OPENBSD_5_5_BASE:1.1.1.9
	OPENBSD_5_4:1.1.1.9.0.2
	OPENBSD_5_4_BASE:1.1.1.9
	PERL_5_16_3:1.1.1.9
	OPENBSD_5_3:1.1.1.8.0.14
	OPENBSD_5_3_BASE:1.1.1.8
	OPENBSD_5_2:1.1.1.8.0.12
	OPENBSD_5_2_BASE:1.1.1.8
	OPENBSD_5_1_BASE:1.1.1.8
	OPENBSD_5_1:1.1.1.8.0.10
	OPENBSD_5_0:1.1.1.8.0.8
	OPENBSD_5_0_BASE:1.1.1.8
	OPENBSD_4_9:1.1.1.8.0.6
	OPENBSD_4_9_BASE:1.1.1.8
	PERL_5_12_2:1.1.1.8
	OPENBSD_4_8:1.1.1.8.0.4
	OPENBSD_4_8_BASE:1.1.1.8
	OPENBSD_4_7:1.1.1.8.0.2
	OPENBSD_4_7_BASE:1.1.1.8
	PERL_5_10_1:1.1.1.8
	OPENBSD_4_6:1.1.1.7.0.6
	OPENBSD_4_6_BASE:1.1.1.7
	OPENBSD_4_5:1.1.1.7.0.2
	OPENBSD_4_5_BASE:1.1.1.7
	PERL_5_10_0:1.1.1.7
	OPENBSD_4_4:1.1.1.6.0.10
	OPENBSD_4_4_BASE:1.1.1.6
	OPENBSD_4_3:1.1.1.6.0.8
	OPENBSD_4_3_BASE:1.1.1.6
	OPENBSD_4_2:1.1.1.6.0.6
	OPENBSD_4_2_BASE:1.1.1.6
	OPENBSD_4_1:1.1.1.6.0.4
	OPENBSD_4_1_BASE:1.1.1.6
	OPENBSD_4_0:1.1.1.6.0.2
	OPENBSD_4_0_BASE:1.1.1.6
	PERL_5_8_8:1.1.1.6
	OPENBSD_3_9:1.1.1.5.0.8
	OPENBSD_3_9_BASE:1.1.1.5
	OPENBSD_3_8:1.1.1.5.0.6
	OPENBSD_3_8_BASE:1.1.1.5
	OPENBSD_3_7:1.1.1.5.0.4
	OPENBSD_3_7_BASE:1.1.1.5
	PERL_5_8_6:1.1.1.5
	OPENBSD_3_6:1.1.1.5.0.2
	OPENBSD_3_6_BASE:1.1.1.5
	PERL_5_8_5:1.1.1.5
	PERL_5_8_3:1.1.1.4
	OPENBSD_3_5:1.1.1.4.0.2
	OPENBSD_3_5_BASE:1.1.1.4
	PERL_5_8_2:1.1.1.4
	OPENBSD_3_4:1.1.1.3.0.4
	OPENBSD_3_4_BASE:1.1.1.3
	OPENBSD_3_3:1.1.1.3.0.2
	OPENBSD_3_3_BASE:1.1.1.3
	PERL_5_8_0:1.1.1.3
	OPENBSD_3_2:1.1.1.2.0.6
	OPENBSD_3_2_BASE:1.1.1.2
	OPENBSD_3_1:1.1.1.2.0.4
	OPENBSD_3_1_BASE:1.1.1.2
	OPENBSD_3_0:1.1.1.2.0.2
	OPENBSD_3_0_BASE:1.1.1.2
	PERL_5_6_1:1.1.1.2
	OPENBSD_2_9:1.1.1.1.0.6
	OPENBSD_2_9_BASE:1.1.1.1
	OPENBSD_2_8:1.1.1.1.0.4
	OPENBSD_2_8_BASE:1.1.1.1
	OPENBSD_2_7:1.1.1.1.0.2
	OPENBSD_2_7_BASE:1.1.1.1
	PERL_5_6_0:1.1.1.1
	CPAN:1.1.1;
locks; strict;
comment	@# @;
expand	@o@;


1.3
date	2017.02.05.00.32.14;	author afresh1;	state Exp;
branches;
next	1.2;
commitid	cxJ08BvJA9Pt2PTM;

1.2
date	2016.07.03.01.08.01;	author afresh1;	state Exp;
branches;
next	1.1;
commitid	GzHqjSTnBjdF7Wcw;

1.1
date	2000.04.06.16.09.27;	author millert;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2000.04.06.16.09.27;	author millert;	state Exp;
branches;
next	1.1.1.2;

1.1.1.2
date	2001.05.24.18.23.08;	author millert;	state Exp;
branches;
next	1.1.1.3;

1.1.1.3
date	2002.10.27.22.14.56;	author millert;	state Exp;
branches;
next	1.1.1.4;

1.1.1.4
date	2003.12.03.02.43.56;	author millert;	state Exp;
branches;
next	1.1.1.5;

1.1.1.5
date	2004.08.09.17.47.56;	author millert;	state Exp;
branches;
next	1.1.1.6;

1.1.1.6
date	2006.03.28.18.48.28;	author millert;	state Exp;
branches;
next	1.1.1.7;

1.1.1.7
date	2008.09.29.17.18.27;	author millert;	state Exp;
branches;
next	1.1.1.8;

1.1.1.8
date	2009.10.12.18.10.46;	author millert;	state Exp;
branches;
next	1.1.1.9;

1.1.1.9
date	2013.03.25.20.08.47;	author sthen;	state Exp;
branches;
next	1.1.1.10;

1.1.1.10
date	2014.11.17.20.53.07;	author afresh1;	state Exp;
branches;
next	1.1.1.11;
commitid	B31cAbBIXiCqnL97;

1.1.1.11
date	2015.04.25.19.10.37;	author afresh1;	state Exp;
branches;
next	1.1.1.12;
commitid	Wpcs5S8qILgEZC7F;

1.1.1.12
date	2017.08.14.13.46.13;	author afresh1;	state Exp;
branches;
next	;
commitid	fAzrs78vdW2Yfc6A;


desc
@@


1.3
log
@Fix merge issues, remove excess files - match perl-5.24.1 dist
@
text
@##
# Darwin (Mac OS) hints
# Wilfredo Sanchez <wsanchez@@wsanchez.net>
##

##
# Paths
##

# Configure hasn't figured out the version number yet.  Bummer.
perl_revision=`awk '/define[ 	]+PERL_REVISION/ {print $3}' $src/patchlevel.h`
perl_version=`awk '/define[ 	]+PERL_VERSION/ {print $3}' $src/patchlevel.h`
perl_subversion=`awk '/define[ 	]+PERL_SUBVERSION/ {print $3}' $src/patchlevel.h`
version="${perl_revision}.${perl_version}.${perl_subversion}"

# Pretend that Darwin doesn't know about those system calls in Tiger
# (10.4/darwin 8) and earlier [perl #24122]
case "$osvers" in
[1-8].*)
    d_setregid='undef'
    d_setreuid='undef'
    d_setrgid='undef'
    d_setruid='undef'
    ;;
esac

# finite() deprecated in 10.9, use isfinite() instead.
case "$osvers" in
[1-8].*) ;;
*) d_finite='undef' ;;
esac

# This was previously used in all but causes three cases
# (no -Ddprefix=, -Dprefix=/usr, -Dprefix=/some/thing/else)
# but that caused too much grief.
# vendorlib="/System/Library/Perl/${version}"; # Apple-supplied modules

# BSD paths
case "$prefix" in
'')	# Default install; use non-system directories
	prefix='/usr/local';
	siteprefix='/usr/local';
	;;
'/usr')	# We are building/replacing the built-in perl
	prefix='/';
	installprefix='/';
	bin='/usr/bin';
	siteprefix='/usr/local';
	# We don't want /usr/bin/HEAD issues.
	sitebin='/usr/local/bin';
	sitescript='/usr/local/bin';
	installusrbinperl='define'; # You knew what you were doing.
	privlib="/System/Library/Perl/${version}";
	sitelib="/Library/Perl/${version}";
	vendorprefix='/';
	usevendorprefix='define';
	vendorbin='/usr/bin';
	vendorscript='/usr/bin';
	vendorlib="/Network/Library/Perl/${version}";
	# 4BSD uses ${prefix}/share/man, not ${prefix}/man.
	man1dir='/usr/share/man/man1';
	man3dir='/usr/share/man/man3';
	# But users' installs shouldn't touch the system man pages.
	# Transient obsoleted style.
	siteman1='/usr/local/share/man/man1';
	siteman3='/usr/local/share/man/man3';
	# New style.
	siteman1dir='/usr/local/share/man/man1';
	siteman3dir='/usr/local/share/man/man3';
	;;
  *)	# Anything else; use non-system directories, use Configure defaults
	;;
esac

##
# Tool chain settings
##

# Since we can build fat, the archname doesn't need the processor type
archname='darwin';

# nm isn't known to work after Snow Leopard and XCode 4; testing with OS X 10.5
# and Xcode 3 shows a working nm, but pretending it doesn't work produces no
# problems.
usenm='false';

case "$optimize" in
'')
#    Optimizing for size also mean less resident memory usage on the part
# of Perl.  Apple asserts that this is a more important optimization than
# saving on CPU cycles.  Given that memory speed has not increased at
# pace with CPU speed over time (on any platform), this is probably a
# reasonable assertion.
if [ -z "${optimize}" ]; then
  case "`${cc:-gcc} -v 2>&1`" in
    *"gcc version 3."*) optimize='-Os' ;;
    *) optimize='-O3' ;;
  esac
else
  optimize='-O3'
fi
;;
esac

# -fno-common because common symbols are not allowed in MH_DYLIB
# -DPERL_DARWIN: apparently the __APPLE__ is not sanctioned by Apple
# as the way to differentiate Mac OS X.  (The official line is that
# *no* cpp symbol does differentiate Mac OS X.)
ccflags="${ccflags} -fno-common -DPERL_DARWIN"

# At least on Darwin 1.3.x:
#
# # define INT32_MIN -2147483648
# int main () {
#  double a = INT32_MIN;
#  printf ("INT32_MIN=%g\n", a);
#  return 0;
# }
# will output:
# INT32_MIN=2.14748e+09
# Note that the INT32_MIN has become positive.
# INT32_MIN is set in /usr/include/stdint.h by:
# #define INT32_MIN        -2147483648
# which seems to break the gcc.  Defining INT32_MIN as (-2147483647-1)
# seems to work.  INT64_MIN seems to be similarly broken.
# -- Nicholas Clark, Ken Williams, and Edward Moy
#
# This seems to have been fixed since at least Mac OS X 10.1.3,
# stdint.h defining INT32_MIN as (-INT32_MAX-1)
# -- Edward Moy
#
if test -f /usr/include/stdint.h; then
  case "$(grep '^#define INT32_MIN' /usr/include/stdint.h)" in
  *-2147483648) ccflags="${ccflags} -DINT32_MIN_BROKEN -DINT64_MIN_BROKEN" ;;
  esac
fi

# Avoid Apple's cpp precompiler, better for extensions
if [ "X`echo | ${cc} -no-cpp-precomp -E - 2>&1 >/dev/null`" = "X" ]; then
    cppflags="${cppflags} -no-cpp-precomp"

    # This is necessary because perl's build system doesn't
    # apply cppflags to cc compile lines as it should.
    ccflags="${ccflags} ${cppflags}"
fi

# Known optimizer problems.
case "`cc -v 2>&1`" in
  *"3.1 20020105"*) toke_cflags='optimize=""' ;;
esac

# Shared library extension is .dylib.
# Bundle extension is .bundle.
so='dylib';
dlext='bundle';
usedl='define';

# 10.4 can use dlopen.
# 10.4 broke poll().
case "$osvers" in
[1-7].*)
    dlsrc='dl_dyld.xs';
    ;;
*)
    dlsrc='dl_dlopen.xs';
    d_poll='undef';
    i_poll='undef';
    ;;
esac

case "$ccdlflags" in		# If passed in from command line, presume user knows best
'')
   cccdlflags=' '; # space, not empty, because otherwise we get -fpic
;;
esac

# Allow the user to override ld, but modify it as necessary below
case "$ld" in
    '') case "$cc" in
        # If the cc is explicitly something else than cc (or empty),
        # set the ld to be that explicitly something else.  Conversely,
        # if the cc is 'cc' (or empty), set the ld to be 'cc'.
        cc|'') ld='cc';;
        *) ld="$cc" ;;
        esac
        ;;
esac

# From http://ftp.netbsd.org/pub/pkgsrc/current/pkgsrc/mk/platform/Darwin.mk
# and https://trac.macports.org/wiki/XcodeVersionInfo
# and https://trac.macports.org/wiki/UsingTheRightCompiler
#
# OS, Kernel, Xcode Version
# Note that Xcode gets updates on older systems sometimes.
# pkgsrc generally expects that the most up-to-date xcode available for
# an OS version is installed
#
# Note that Apple hijacks the clang preprocessor symbols __clang_major__
# and __clang_minor__ so they cannot be used (easily) to detect the
# actual clang release.  For example:
#
# "Yosemite 10.10.x 14.x.y 6.3 (clang 3.6 as 6.1/602.0.49)"
#
# means that the Xcode 6.3 provided the clang 6.3 but called it 6.1
# (__clang_major__, __clang_minor__) and in addition the preprocessor
# symbol __apple_build_version__ was 6020049.
#
# Codename        OS      Kernel  Xcode
#
# Cheetah         10.0.x  1.3.1
# Puma            10.1    1.4.1
#                 10.1.x  5.x.y
# Jaguar          10.2.x  6.x.y
# Panther         10.3.x  7.x.y
# Tiger           10.4.x  8.x.y   2.0   (gcc4 4.0.0)
#                                 2.2   (gcc4 4.0.1)
#                                 2.2.1 (gcc 3.3)
#                                 2.5 ?
# Leopard         10.5.x  9.x.y   3.0   (gcc 4.0.1 default)
#                                 3.1   (gcc 4.2.1)
# Snow Leopard    10.6.x  10.x.y  3.2   (llvm gcc 4.2, clang 2.3 as 1.0)
#                                 3.2.1 (clang 1.0.1 as 1.0.1/24)
#                                 3.2.2 (clang 1.0.2 as 1.0.2/32)
#                                 3.2.3 (clang 1.5 as 1.5/60)
#                                 4.0.1 (clang 2.9 as 2.0/138)
# Lion            10.7.x  11.x.y  4.1   (llvm gcc 4.2.1, clang 3.0 as 2.1/163.7.1)
#                                 4.2   (clang 3.0 as 3.0/211.10.1)
#                                 4.3.3 (clang 3.1 as 3.1/318.0.61)
#                                 4.4   (clang 3.1 as 4.0/421.0.57)
# Mountain Lion   10.8.x  12.x.y  4.5   (clang 3.1 as 4.1/421.11.65, real gcc removed, there is gcc but it's really clang)
#                                 4.6   (clang 3.2 as 4.2/425.0.24)
#                                 5.0   (clang 3.3 as 5.0/500.2.75)
#                                 5.1   (clang 3.4 as 5.1/503.0.38)
#                                 5.1.1 (clang 3.4 as 5.1/503.0.40)
# Mavericks       10.9.x  13.x.y  6.0.1 (clang 3.5 as 6.0/600.0.51)
#                                 6.1   (clang 3.5 as 6.0/600.0.54)
#                                 6.1.1 (clang 3.5 as 6.0/600.0.56)
#                                 6.2   (clang 3.5 as 6.0/600.0.57)
# Yosemite        10.10.x 14.x.y  6.3   (clang 3.6 as 6.1/602.0.49)
#                                 6.3.1 (clang 3.6 as 6.1/602.0.49)
#                                 6.3.2 (clang 3.6 as 6.1/602.0.53)
# El Capitan      10.11.x 15.x.y  7.0   (clang 3.7 as 7.0/700.0.72)
#                                 7.1   (clang 3.7 as 7.0/700.1.76)
#                                 7.2   (clang 3.7 as 7.0.2/700.1.81)
#                                 7.2.1 (clang 3.7 as 7.0.2/700.1.81)
#                                 7.3   (clang 3.7 as 7.3.0/703.0.29)
#

# Processors Supported
#
# PowerPC (PPC):       10.0.x - 10.5.8 (final 10.5.x)
# PowerPC via Rosetta: 10.4.4 - 10.6.8 (final 10.6.x)
# IA-32:               10.4.4 - 10.6.8 (though still supported on x86-64)
# x86-64:              10.4.7 - current

# MACOSX_DEPLOYMENT_TARGET selects the minimum OS level we want to support
#
# It is needed for OS releases before 10.6.
#
# https://developer.apple.com/library/mac/documentation/DeveloperTools/Conceptual/cross_development/Configuring/configuring.html
#
# If it is set, we also propagate its value to ccflags and ldflags
# using the -mmacosx-version-min flag.  If it is not set, we use
# the OS X release as the min value for the flag.

# Adds "-mmacosx-version-min=$2" to "$1" unless it already is there.
add_macosx_version_min () {
  local v
  eval "v=\$$1"
  case " $v " in
  *"-mmacosx-version-min"*)
     echo "NOT adding -mmacosx-version-min=$2 to $1 ($v)" >&4
     ;;
  *) echo "Adding -mmacosx-version-min=$2 to $1" >&4
     eval "$1='$v -mmacosx-version-min=$2'"
     ;;
  esac
}

# Perl bundles do not expect two-level namespace, added in Darwin 1.4.
# But starting from perl 5.8.1/Darwin 7 the default is the two-level.
case "$osvers" in  # Note: osvers is the kernel version, not the 10.x
1.[0-3].*) # OS X 10.0.x
   lddlflags="${ldflags} -bundle -undefined suppress"
   ;;
1.*)       # OS X 10.1
   ldflags="${ldflags} -flat_namespace"
   lddlflags="${ldflags} -bundle -undefined suppress"
   ;;
[2-6].*)   # OS X 10.1.x - 10.2.x (though [2-4] never existed publicly)
   ldflags="${ldflags} -flat_namespace"
   lddlflags="${ldflags} -bundle -undefined suppress"
   ;;
[7-9].*)   # OS X 10.3.x - 10.5.x
   lddlflags="${ldflags} -bundle -undefined dynamic_lookup"
   case "$ld" in
       *MACOSX_DEVELOPMENT_TARGET*) ;;
       *) ld="env MACOSX_DEPLOYMENT_TARGET=10.3 ${ld}" ;;
   esac
   ;;
*)        # OS X 10.6.x - current
   # The MACOSX_DEPLOYMENT_TARGET is not needed,
   # but the -mmacosx-version-min option is always used.

   # We now use MACOSX_DEPLOYMENT_TARGET, if set, as an override by
   # capturing its value and adding it to the flags.
    case "$MACOSX_DEPLOYMENT_TARGET" in
    10.*)
      add_macosx_version_min ccflags $MACOSX_DEPLOYMENT_TARGET
      add_macosx_version_min ldflags $MACOSX_DEPLOYMENT_TARGET
      ;;
    '')
      # Empty MACOSX_DEPLOYMENT_TARGET is okay.
      ;;
    *)
      cat <<EOM >&4

*** Unexpected MACOSX_DEPLOYMENT_TARGET=$MACOSX_DEPLOYMENT_TARGET
***
*** Please either set it to 10.something, or to empty.

EOM
      exit 1
      ;;
    esac

    # Keep the prodvers leading whitespace (Configure magic).
    # Cannot use $osvers here since that is the kernel version.
    # sw_vers output                 what we want
    # "ProductVersion:    10.10.5"   "10.10"
    # "ProductVersion:    10.11"     "10.11"
        prodvers=`sw_vers|awk '/^ProductVersion:/{print $2}'|awk -F. '{print $1"."$2}'`
    case "$prodvers" in
    10.*)
      add_macosx_version_min ccflags $prodvers
      add_macosx_version_min ldflags $prodvers
      ;;
    *)
      cat <<EOM >&4

*** Unexpected product version $prodvers.
***
*** Try running sw_vers and see what its ProductVersion says.

EOM
      exit 1
    esac

   lddlflags="${ldflags} -bundle -undefined dynamic_lookup"
   ;;
esac

ldlibpthname='DYLD_LIBRARY_PATH';

# useshrplib=true results in much slower startup times.
# 'false' is the default value.  Use Configure -Duseshrplib to override.

cat > UU/archname.cbu <<'EOCBU'
# This script UU/archname.cbu will get 'called-back' by Configure 
# after it has otherwise determined the architecture name.
case "$ldflags" in
*"-flat_namespace"*) ;; # Backward compat, be flat.
# If we are using two-level namespace, we will munge the archname to show it.
*) archname="${archname}-2level" ;;
esac
EOCBU

# 64-bit addressing support. Currently strictly experimental. DFD 2005-06-06
case "$use64bitall" in
$define|true|[yY]*)
case "$osvers" in
[1-7].*)
     cat <<EOM >&4



*** 64-bit addressing is not supported for Mac OS X versions
*** below 10.4 ("Tiger") or Darwin versions below 8. Please try
*** again without -Duse64bitall. (-Duse64bitint will work, however.)

EOM
     exit 1
  ;;
*)
    case "$osvers" in
    8.*)
        cat <<EOM >&4



*** Perl 64-bit addressing support is experimental for Mac OS X
*** 10.4 ("Tiger") and Darwin version 8. System V IPC is disabled
*** due to problems with the 64-bit versions of msgctl, semctl,
*** and shmctl. You should also expect the following test failures:
***
***    ext/threads-shared/t/wait (threaded builds only)

EOM

        [ "$d_msgctl" ] || d_msgctl='undef'
        [ "$d_semctl" ] || d_semctl='undef'
        [ "$d_shmctl" ] || d_shmctl='undef'
    ;;
    esac

    case `uname -p` in 
    powerpc) arch=ppc64 ;;
    i386) arch=x86_64 ;;
    *) cat <<EOM >&4

*** Don't recognize processor, can't specify 64 bit compilation.

EOM
    ;;
    esac
    for var in ccflags cppflags ld ldflags
    do
       eval $var="\$${var}\ -arch\ $arch"
    done

    ;;
esac
;;
esac

##
# System libraries
##

# vfork works
usevfork='true';

# malloc wrap works
case "$usemallocwrap" in
'') usemallocwrap='define' ;;
esac

# our malloc works (but allow users to override)
case "$usemymalloc" in
'') usemymalloc='n' ;;
esac
# However sbrk() returns -1 (failure) somewhere in lib/unicore/mktables at
# around 14M, so we need to use system malloc() as our sbrk()
#
# sbrk() in Darwin deprecated since Mavericks (10.9), it still exists
# in Yosemite (10.10) but that is just an emulation, and fails for
# allocations beyond 4MB.  One should use e.g. mmap instead (or system
# malloc, as suggested above, that but is kind of backward).
malloc_cflags='ccflags="-DUSE_PERL_SBRK -DPERL_SBRK_VIA_MALLOC $ccflags"'

# Locales aren't feeling well.
LC_ALL=C; export LC_ALL;
LANG=C; export LANG;

#
# The libraries are not threadsafe as of OS X 10.1.
#
# Fix when Apple fixes libc.
#
case "$usethreads$useithreads" in
  *define*)
  case "$osvers" in
    [12345].*)     cat <<EOM >&4



*** Warning, there might be problems with your libraries with
*** regards to threading.  The test ext/threads/t/libc.t is likely
*** to fail.

EOM
    ;;
    *) usereentrant='define';;
  esac

esac

# Fink can install a GDBM library that claims to have the ODBM interfaces
# but Perl dynaloader cannot for some reason use that library.  We don't
# really need ODBM_FIle, though, so let's just hint ODBM away.
i_dbm=undef;

# Configure doesn't detect ranlib on Tiger properly.
# NeilW says this should be acceptable on all darwin versions.
ranlib='ranlib'

# Catch MacPorts gcc/g++ extra libdir
case "$($cc -v 2>&1)" in
*"MacPorts gcc"*) loclibpth="$loclibpth /opt/local/lib/libgcc" ;;
esac

##
# Build process
##

# Case-insensitive filesystems don't get along with Makefile and
# makefile in the same place.  Since Darwin uses GNU make, this dodges
# the problem.
firstmakefile=GNUmakefile;

# Parts of the system call setenv(), in particular in an atfork handler.
# This causes problems when the child tries to clean up environ[], so
# let libc manage environ[].
cat >> config.over <<'EOOVER'
if test "$d_unsetenv" = "$define" -a \
    `expr "$ccflags" : '.*-DPERL_USE_SAFE_PUTENV'` -eq 0; then
        ccflags="$ccflags -DPERL_USE_SAFE_PUTENV"
fi
EOOVER
@


1.2
log
@Update to perl 5.20.3

OK bluhm@@
@
text
@d27 6
d189 91
d282 2
a283 2
case "$osvers" in
1.[0-3].*)
d286 1
a286 1
1.*)
d290 1
a290 1
[2-6].*)
d294 1
a294 1
*) 
d301 50
d352 1
d444 5
d487 5
d500 10
@


1.1
log
@Initial revision
@
text
@d3 1
a3 1
# Wilfredo Sanchez <wsanchez@@apple.com>
d10 22
d33 35
a67 13
prefix='/usr';
siteprefix='/usr/local';
vendorprefix='/usr/local'; usevendorprefix='define';

# 4BSD uses /usr/share/man, not /usr/man.
# Don't put man pages in /usr/lib; that's goofy.
man1dir='/usr/share/man/man1';
man3dir='/usr/share/man/man3';

# Where to put modules.
privlib='/System/Library/Perl';
sitelib='/Local/Library/Perl';
vendorlib='/Network/Library/Perl';
d76 69
a144 11
# nm works.
usenm='true';

# Libc is in libsystem.
libc='/System/Library/Frameworks/System.framework/System';

# Optimize.
optimize='-O3';

# We have a prototype for telldir.
ccflags="${ccflags} -pipe -fno-common -DHAS_TELLDIR_PROTOTYPE";
a147 1
ld='cc';
d150 55
a204 3
dlsrc='dl_dyld.xs'; usedl='define';
cccdlflags='';
lddlflags="${ldflags} -bundle -undefined suppress";
d206 71
a276 1
useshrplib='true';
d285 57
a341 2
# malloc works
usemymalloc='n';
@


1.1.1.1
log
@virgin perl 5.6.0
@
text
@@


1.1.1.2
log
@stock perl 5.6.1
@
text
@d50 1
a50 1
cccdlflags=' '; # space, not empty, because otherwise we get -fpic
@


1.1.1.3
log
@stock perl 5.8.0 from CPAN
@
text
@d3 1
a3 1
# Wilfredo Sanchez <wsanchez@@mit.edu>
d11 13
a23 27
case "$prefix" in
'')
	# Default install; use non-system directories
	prefix='/usr/local'; # Built-in perl uses /usr
	siteprefix='/usr/local';
	vendorprefix='/usr/local'; usevendorprefix='define';

	# Where to put modules.
	privlib='/Library/Perl'; # Built-in perl uses /System/Library/Perl
	sitelib='/Library/Perl';
	vendorlib='/Network/Library/Perl';
	;;
'/usr')
	# We are building/replacing the built-in perl
	siteprefix='/usr/local';
	vendorprefix='/usr/local'; usevendorprefix='define';

	# Where to put modules.
	privlib='/System/Library/Perl';
	sitelib='/Library/Perl';
	vendorlib='/Network/Library/Perl';
	;;
esac

# 4BSD uses ${prefix}/share/man, not ${prefix}/man.
man1dir="${prefix}/share/man/man1";
man3dir="${prefix}/share/man/man3";
d35 3
d39 4
a42 47
if [ "x$optimize" = 'x' ]; then
    optimize='-O3'
fi

# -pipe: makes compilation go faster.
# -fno-common: we don't like commons.  Common symbols are not allowed
# in MH_DYLIB binaries, which is what libperl.dylib is.  You will fail
# to link without that option, unless you otherwise eliminate all commons
# by, for example, initializing all globals.
# --Fred Sánchez
ccflags="${ccflags} -pipe -fno-common"

# At least on Darwin 1.3.x:
#
# # define INT32_MIN -2147483648
# int main () {
#  double a = INT32_MIN;
#  printf ("INT32_MIN=%g\n", a);
#  return 0;
# }
# will output:
# INT32_MIN=2.14748e+09
# Note that the INT32_MIN has become positive.
# INT32_MIN is set in /usr/include/stdint.h by:
# #define INT32_MIN        -2147483648
# which seems to break the gcc.  Defining INT32_MIN as (-2147483647-1)
# seems to work.  INT64_MIN seems to be similarly broken.
# -- Nicholas Clark, Ken Williams, and Edward Moy
#
# This seems to have been fixed since at least Mac OS X 10.1.3,
# stdint.h defining INT32_MIN as (-INT32_MAX-1)
# -- Edward Moy
#
case "`grep '^#define INT32_MIN' /usr/include/stdint.h`" in
*-2147483648) ccflags="${ccflags} -DINT32_MIN_BROKEN -DINT64_MIN_BROKEN" ;;
esac

# cppflags='-traditional-cpp';
# avoid Apple's cpp precompiler, better for extensions
cppflags="${cppflags} -no-cpp-precomp"
# and ccflags needs them as well since we don't use cpp directly
ccflags="${ccflags} -no-cpp-precomp"

# Known optimizer problems.
case "`cc -v 2>&1`" in
*"3.1 20020105"*) toke_cflags='optimize=""' ;;
esac
a50 7
# ldflag: -flat_namespace is only available since OS X 10.1 (Darwin 1.4.1)
#    - but not in 10.0.x (Darwin 1.3.x)
# -- Kay Roepke
case "$osvers" in
1.[0-3].*)	;;
*)		ldflags="${ldflags} -flat_namespace" ;;
esac
a63 30

##
# Build process
##

# Locales aren't feeling well.
LC_ALL=C; export LC_ALL;
LANG=C; export LANG;

# Case-insensitive filesystems don't get along with Makefile and
# makefile in the same place.  Since Darwin uses GNU make, this dodges
# the problem.
firstmakefile=GNUmakefile;

#
# The libraries are not threadsafe as of OS X 10.1.
#
# Fix when Apple fixes libc.
#
case "$usethreads$useithreads$use5005threads" in
*define*)
cat <<EOM >&4

*** Warning, there might be problems with your libraries with
*** regards to threading.  The test ext/threads/t/libc.t is likely
*** to fail.

EOM
	;;
esac
@


1.1.1.4
log
@perl 5.8.2 from CPAN
@
text
@d3 1
a3 1
# Wilfredo Sanchez <wsanchez@@wsanchez.net>
a9 17
# Configure hasn't figured out the version number yet.  Bummer.
perl_revision=`awk '/define[ 	]+PERL_REVISION/ {print $3}' $src/patchlevel.h`
perl_version=`awk '/define[ 	]+PERL_VERSION/ {print $3}' $src/patchlevel.h`
perl_subversion=`awk '/define[ 	]+PERL_SUBVERSION/ {print $3}' $src/patchlevel.h`
version="${perl_revision}.${perl_version}.${perl_subversion}"

# Pretend that Darwin doesn't know about those system calls [perl #24122]
d_setregid='undef'
d_setreuid='undef'
d_setrgid='undef'
d_setruid='undef'

# This was previously used in all but causes three cases
# (no -Ddprefix=, -Dprefix=/usr, -Dprefix=/some/thing/else)
# but that caused too much grief.
# vendorlib="/System/Library/Perl/${version}"; # Apple-supplied modules

d12 3
a14 2
'')	# Default install; use non-system directories
	prefix='/usr/local';
d16 6
d23 2
a24 4
'/usr')	# We are building/replacing the built-in perl
	prefix='/';
	installprefix='/';
	bin='/usr/bin';
d26 6
a31 23
	# We don't want /usr/bin/HEAD issues.
	sitebin='/usr/local/bin';
	sitescript='/usr/local/bin';
	installusrbinperl='define'; # You knew what you were doing.
	privlib="/System/Library/Perl/${version}";
	sitelib="/Library/Perl/${version}";
	vendorprefix='/';
	usevendorprefix='define';
	vendorbin='/usr/bin';
	vendorscript='/usr/bin';
	vendorlib="/Network/Library/Perl/${version}";
	# 4BSD uses ${prefix}/share/man, not ${prefix}/man.
	man1dir='/usr/share/man/man1';
	man3dir='/usr/share/man/man3';
	# But users' installs shouldn't touch the system man pages.
	# Transient obsoleted style.
	siteman1='/usr/local/share/man/man1';
	siteman3='/usr/local/share/man/man3';
	# New style.
	siteman1dir='/usr/local/share/man/man1';
	siteman3dir='/usr/local/share/man/man3';
	;;
  *)	# Anything else; use non-system directories, use Configure defaults
d35 4
d49 3
a51 14
case "$optimize" in
'')
#    Optimizing for size also mean less resident memory usage on the part
# of Perl.  Apple asserts that this is a more important optimization than
# saving on CPU cycles.  Given that memory speed has not increased at
# pace with CPU speed over time (on any platform), this is probably a
# reasonable assertion.
if [ -z "${optimize}" ]; then
  case "`${cc:-gcc} -v 2>&1`" in
    *"gcc version 3."*) optimize='-Os' ;;
    *) optimize='-O3' ;;
  esac
else
  optimize='-O3'
a52 2
;;
esac
d55 6
a60 5
# -fno-common because common symbols are not allowed in MH_DYLIB
# -DPERL_DARWIN: apparently the __APPLE__ is not sanctioned by Apple
# as the way to differentiate Mac OS X.  (The official line is that
# *no* cpp symbol does differentiate Mac OS X.)
ccflags="${ccflags} -pipe -fno-common -DPERL_DARWIN"
d83 2
a84 2
case "$(grep '^#define INT32_MIN' /usr/include/stdint.h)" in
  *-2147483648) ccflags="${ccflags} -DINT32_MIN_BROKEN -DINT64_MIN_BROKEN" ;;
d87 2
a88 1
# Avoid Apple's cpp precompiler, better for extensions
d90 2
a91 4

# This is necessary because perl's build system doesn't
# apply cppflags to cc compile lines as it should.
ccflags="${ccflags} ${cppflags}"
d95 1
a95 1
  *"3.1 20020105"*) toke_cflags='optimize=""' ;;
d105 3
a107 2
# Perl bundles do not expect two-level namespace, added in Darwin 1.4.
# But starting from perl 5.8.1/Darwin 7 the default is the two-level.
d109 2
a110 17
1.[0-3].*)
   lddlflags="${ldflags} -bundle -undefined suppress"
   ;;
1.*)
   ldflags="${ldflags} -flat_namespace"
   lddlflags="${ldflags} -bundle -undefined suppress"
   ;;
[2-6].*)
   ldflags="${ldflags} -flat_namespace"
   lddlflags="${ldflags} -bundle -undefined suppress"
   ;;
*) lddlflags="${ldflags} -bundle -undefined dynamic_lookup"
   case "$ld" in
   *MACOSX_DEVELOPMENT_TARGET*) ;;
   *) ld="env MACOSX_DEPLOYMENT_TARGET=10.3 ${ld}" ;;
   esac
   ;;
d112 1
d114 1
a114 13

# useshrplib=true results in much slower startup times.
# 'false' is the default value.  Use Configure -Duseshrplib to override.

cat > UU/archname.cbu <<'EOCBU'
# This script UU/archname.cbu will get 'called-back' by Configure 
# after it has otherwise determined the architecture name.
case "$ldflags" in
*"-flat_namespace"*) ;; # Backward compat, be flat.
# If we are using two-level namespace, we will munge the archname to show it.
*) archname="${archname}-2level" ;;
esac
EOCBU
d123 6
a128 4
# our malloc works (but allow users to override)
case "$usemymalloc" in
'') usemymalloc='n' ;;
esac
d134 5
d145 2
a146 5
  *define*)
  case "$osvers" in
    [12345].*)     cat <<EOM >&4


d153 1
a153 4
    ;;
    *) usereentrant='define';;
  esac

a154 14

# Fink can install a GDBM library that claims to have the ODBM interfaces
# but Perl dynaloader cannot for some reason use that library.  We don't
# really need ODBM_FIle, though, so let's just hint ODBM away.
i_dbm=undef;

##
# Build process
##

# Case-insensitive filesystems don't get along with Makefile and
# makefile in the same place.  Since Darwin uses GNU make, this dodges
# the problem.
firstmakefile=GNUmakefile;
@


1.1.1.5
log
@Import of stock perl 5.8.5
@
text
@d92 1
d97 1
a97 1
ccflags="${ccflags} -fno-common -DPERL_DARWIN"
a184 5

# malloc wrap works
case "$usemallocwrap" in
'') usemallocwrap='define' ;;
esac
@


1.1.1.6
log
@perl 5.8.8 import
@
text
@d140 2
a141 21
usedl='define';

# 10.4 can use dlopen.
# 10.4 broke poll().
case "$osvers" in
[1-7].*)
    dlsrc='dl_dyld.xs';
    ;;
*)
    dlsrc='dl_dlopen.xs';
    d_poll='undef';
    i_poll='undef';
    ;;
esac

case "$ccdlflags" in		# If passed in from command line, presume user knows best
'')
   cccdlflags=' '; # space, not empty, because otherwise we get -fpic
;;
esac

d156 1
a156 2
*) 
   lddlflags="${ldflags} -bundle -undefined dynamic_lookup"
d158 2
a159 2
       *MACOSX_DEVELOPMENT_TARGET*) ;;
       *) ld="env MACOSX_DEPLOYMENT_TARGET=10.3 ${ld}" ;;
a177 36
# 64-bit addressing support. Currently strictly experimental. DFD 2005-06-06
if [ "$use64bitall" ]
then
case "$osvers" in
[1-7].*)
     cat <<EOM >&4



*** 64-bit addressing is not supported for Mac OS X versions
*** below 10.4 ("Tiger") or Darwin versions below 8. Please try
*** again without -D64bitall. (-D64bitint will work, however.)

EOM
     exit 1
  ;;
*)
    cat <<EOM >&4



*** Perl 64-bit addressing support is experimental for Mac OS X
*** 10.4 ("Tiger") and Darwin version 8. Expect a number of test
*** failures:
***    ext/IO/io_*   ext/IPC/sysV/t/*   lib/Net/Ping/t/450_service
***    Any test that uses sdbm

EOM
    for var in ccflags cppflags ld ldflags
    do
       eval $var="\$${var}\ -arch\ ppc64"
    done
    ;;
esac
fi

a193 3
# However sbrk() returns -1 (failure) somewhere in lib/unicore/mktables at
# around 14M, so we need to use system malloc() as our sbrk()
malloc_cflags='ccflags="-DUSE_PERL_SBRK -DPERL_SBRK_VIA_MALLOC $ccflags"'
a225 4

# Configure doesn't detect ranlib on Tiger properly.
# NeilW says this should be acceptable on all darwin versions.
ranlib='ranlib'
@


1.1.1.7
log
@import perl 5.10.0 from CPAN
@
text
@d220 4
a223 5
*** 10.4 ("Tiger") and Darwin version 8. System V IPC is disabled
*** due to problems with the 64-bit versions of msgctl, semctl,
*** and shmctl. You should also expect the following test failures:
***
***    ext/threads/shared/t/wait (threaded builds only)
a229 4

    [ "$d_msgctl" ] || d_msgctl='undef'
    [ "$d_semctl" ] || d_semctl='undef'
    [ "$d_shmctl" ] || d_shmctl='undef'
d263 1
a263 1
case "$usethreads$useithreads" in
@


1.1.1.8
log
@import perl 5.10.1
@
text
@d199 2
a200 2
case "$use64bitall" in
$define|true|[yY]*)
d209 1
a209 1
*** again without -Duse64bitall. (-Duse64bitint will work, however.)
d215 1
a215 3
    case "$osvers" in
    8.*)
        cat <<EOM >&4
d224 1
a224 1
***    ext/threads-shared/t/wait (threaded builds only)
a226 17

        [ "$d_msgctl" ] || d_msgctl='undef'
        [ "$d_semctl" ] || d_semctl='undef'
        [ "$d_shmctl" ] || d_shmctl='undef'
    ;;
    esac

    case `uname -p` in 
    powerpc) arch=ppc64 ;;
    i386) arch=x86_64 ;;
    *) cat <<EOM >&4

*** Don't recognize processor, can't specify 64 bit compilation.

EOM
    ;;
    esac
d229 1
a229 1
       eval $var="\$${var}\ -arch\ $arch"
d232 3
d237 1
a237 2
;;
esac
@


1.1.1.9
log
@import perl 5.16.3 from CPAN - worked on by Andrew Fresh and myself
@
text
@d16 5
a20 10
# Pretend that Darwin doesn't know about those system calls in Tiger
# (10.4/darwin 8) and earlier [perl #24122]
case "$osvers" in
[1-8].*)
    d_setregid='undef'
    d_setreuid='undef'
    d_setrgid='undef'
    d_setruid='undef'
    ;;
esac
d71 2
a72 4
# nm isn't known to work after Snow Leopard and XCode 4; testing with OS X 10.5
# and Xcode 3 shows a working nm, but pretending it doesn't work produces no
# problems.
usenm='false';
d124 1
a124 2
if [ "X`echo | ${cc} -no-cpp-precomp -E - 2>&1 >/dev/null`" = "X" ]; then
    cppflags="${cppflags} -no-cpp-precomp"
d126 3
a128 4
    # This is necessary because perl's build system doesn't
    # apply cppflags to cc compile lines as it should.
    ccflags="${ccflags} ${cppflags}"
fi
@


1.1.1.10
log
@Import perl-5.20.1
@
text
@d146 1
a167 5
esac

# Allow the user to override ld, but modify it as necessary below
case "$ld" in
    '') ld='cc';;
@


1.1.1.11
log
@Import perl-5.20.2
@
text
@d171 1
a171 8
    '') case "$cc" in
        # If the cc is explicitly something else than cc (or empty),
        # set the ld to be that explicitly something else.  Conversely,
        # if the cc is 'cc' (or empty), set the ld to be 'cc'.
        cc|'') ld='cc';;
        *) ld="$cc" ;;
        esac
        ;;
@


1.1.1.12
log
@Import perl-5.24.2
@
text
@a26 6
# finite() deprecated in 10.9, use isfinite() instead.
case "$osvers" in
[1-8].*) ;;
*) d_finite='undef' ;;
esac

d126 1
a126 2
if test -f /usr/include/stdint.h; then
  case "$(grep '^#define INT32_MIN' /usr/include/stdint.h)" in
d128 1
a128 2
  esac
fi
a180 91
# From http://ftp.netbsd.org/pub/pkgsrc/current/pkgsrc/mk/platform/Darwin.mk
# and https://trac.macports.org/wiki/XcodeVersionInfo
# and https://trac.macports.org/wiki/UsingTheRightCompiler
#
# OS, Kernel, Xcode Version
# Note that Xcode gets updates on older systems sometimes.
# pkgsrc generally expects that the most up-to-date xcode available for
# an OS version is installed
#
# Note that Apple hijacks the clang preprocessor symbols __clang_major__
# and __clang_minor__ so they cannot be used (easily) to detect the
# actual clang release.  For example:
#
# "Yosemite 10.10.x 14.x.y 6.3 (clang 3.6 as 6.1/602.0.49)"
#
# means that the Xcode 6.3 provided the clang 6.3 but called it 6.1
# (__clang_major__, __clang_minor__) and in addition the preprocessor
# symbol __apple_build_version__ was 6020049.
#
# Codename        OS      Kernel  Xcode
#
# Cheetah         10.0.x  1.3.1
# Puma            10.1    1.4.1
#                 10.1.x  5.x.y
# Jaguar          10.2.x  6.x.y
# Panther         10.3.x  7.x.y
# Tiger           10.4.x  8.x.y   2.0   (gcc4 4.0.0)
#                                 2.2   (gcc4 4.0.1)
#                                 2.2.1 (gcc 3.3)
#                                 2.5 ?
# Leopard         10.5.x  9.x.y   3.0   (gcc 4.0.1 default)
#                                 3.1   (gcc 4.2.1)
# Snow Leopard    10.6.x  10.x.y  3.2   (llvm gcc 4.2, clang 2.3 as 1.0)
#                                 3.2.1 (clang 1.0.1 as 1.0.1/24)
#                                 3.2.2 (clang 1.0.2 as 1.0.2/32)
#                                 3.2.3 (clang 1.5 as 1.5/60)
#                                 4.0.1 (clang 2.9 as 2.0/138)
# Lion            10.7.x  11.x.y  4.1   (llvm gcc 4.2.1, clang 3.0 as 2.1/163.7.1)
#                                 4.2   (clang 3.0 as 3.0/211.10.1)
#                                 4.3.3 (clang 3.1 as 3.1/318.0.61)
#                                 4.4   (clang 3.1 as 4.0/421.0.57)
# Mountain Lion   10.8.x  12.x.y  4.5   (clang 3.1 as 4.1/421.11.65, real gcc removed, there is gcc but it's really clang)
#                                 4.6   (clang 3.2 as 4.2/425.0.24)
#                                 5.0   (clang 3.3 as 5.0/500.2.75)
#                                 5.1   (clang 3.4 as 5.1/503.0.38)
#                                 5.1.1 (clang 3.4 as 5.1/503.0.40)
# Mavericks       10.9.x  13.x.y  6.0.1 (clang 3.5 as 6.0/600.0.51)
#                                 6.1   (clang 3.5 as 6.0/600.0.54)
#                                 6.1.1 (clang 3.5 as 6.0/600.0.56)
#                                 6.2   (clang 3.5 as 6.0/600.0.57)
# Yosemite        10.10.x 14.x.y  6.3   (clang 3.6 as 6.1/602.0.49)
#                                 6.3.1 (clang 3.6 as 6.1/602.0.49)
#                                 6.3.2 (clang 3.6 as 6.1/602.0.53)
# El Capitan      10.11.x 15.x.y  7.0   (clang 3.7 as 7.0/700.0.72)
#                                 7.1   (clang 3.7 as 7.0/700.1.76)
#                                 7.2   (clang 3.7 as 7.0.2/700.1.81)
#                                 7.2.1 (clang 3.7 as 7.0.2/700.1.81)
#                                 7.3   (clang 3.7 as 7.3.0/703.0.29)
#

# Processors Supported
#
# PowerPC (PPC):       10.0.x - 10.5.8 (final 10.5.x)
# PowerPC via Rosetta: 10.4.4 - 10.6.8 (final 10.6.x)
# IA-32:               10.4.4 - 10.6.8 (though still supported on x86-64)
# x86-64:              10.4.7 - current

# MACOSX_DEPLOYMENT_TARGET selects the minimum OS level we want to support
#
# It is needed for OS releases before 10.6.
#
# https://developer.apple.com/library/mac/documentation/DeveloperTools/Conceptual/cross_development/Configuring/configuring.html
#
# If it is set, we also propagate its value to ccflags and ldflags
# using the -mmacosx-version-min flag.  If it is not set, we use
# the OS X release as the min value for the flag.

# Adds "-mmacosx-version-min=$2" to "$1" unless it already is there.
add_macosx_version_min () {
  local v
  eval "v=\$$1"
  case " $v " in
  *"-mmacosx-version-min"*)
     echo "NOT adding -mmacosx-version-min=$2 to $1 ($v)" >&4
     ;;
  *) echo "Adding -mmacosx-version-min=$2 to $1" >&4
     eval "$1='$v -mmacosx-version-min=$2'"
     ;;
  esac
}

d183 2
a184 2
case "$osvers" in  # Note: osvers is the kernel version, not the 10.x
1.[0-3].*) # OS X 10.0.x
d187 1
a187 1
1.*)       # OS X 10.1
d191 1
a191 1
[2-6].*)   # OS X 10.1.x - 10.2.x (though [2-4] never existed publicly)
d195 1
a195 1
[7-9].*)   # OS X 10.3.x - 10.5.x
a201 50
*)        # OS X 10.6.x - current
   # The MACOSX_DEPLOYMENT_TARGET is not needed,
   # but the -mmacosx-version-min option is always used.

   # We now use MACOSX_DEPLOYMENT_TARGET, if set, as an override by
   # capturing its value and adding it to the flags.
    case "$MACOSX_DEPLOYMENT_TARGET" in
    10.*)
      add_macosx_version_min ccflags $MACOSX_DEPLOYMENT_TARGET
      add_macosx_version_min ldflags $MACOSX_DEPLOYMENT_TARGET
      ;;
    '')
      # Empty MACOSX_DEPLOYMENT_TARGET is okay.
      ;;
    *)
      cat <<EOM >&4

*** Unexpected MACOSX_DEPLOYMENT_TARGET=$MACOSX_DEPLOYMENT_TARGET
***
*** Please either set it to 10.something, or to empty.

EOM
      exit 1
      ;;
    esac

    # Keep the prodvers leading whitespace (Configure magic).
    # Cannot use $osvers here since that is the kernel version.
    # sw_vers output                 what we want
    # "ProductVersion:    10.10.5"   "10.10"
    # "ProductVersion:    10.11"     "10.11"
        prodvers=`sw_vers|awk '/^ProductVersion:/{print $2}'|awk -F. '{print $1"."$2}'`
    case "$prodvers" in
    10.*)
      add_macosx_version_min ccflags $prodvers
      add_macosx_version_min ldflags $prodvers
      ;;
    *)
      cat <<EOM >&4

*** Unexpected product version $prodvers.
***
*** Try running sw_vers and see what its ProductVersion says.

EOM
      exit 1
    esac

   lddlflags="${ldflags} -bundle -undefined dynamic_lookup"
   ;;
a202 1

a293 5
#
# sbrk() in Darwin deprecated since Mavericks (10.9), it still exists
# in Yosemite (10.10) but that is just an emulation, and fails for
# allocations beyond 4MB.  One should use e.g. mmap instead (or system
# malloc, as suggested above, that but is kind of backward).
a331 5
# Catch MacPorts gcc/g++ extra libdir
case "$($cc -v 2>&1)" in
*"MacPorts gcc"*) loclibpth="$loclibpth /opt/local/lib/libgcc" ;;
esac

a339 10

# Parts of the system call setenv(), in particular in an atfork handler.
# This causes problems when the child tries to clean up environ[], so
# let libc manage environ[].
cat >> config.over <<'EOOVER'
if test "$d_unsetenv" = "$define" -a \
    `expr "$ccflags" : '.*-DPERL_USE_SAFE_PUTENV'` -eq 0; then
        ccflags="$ccflags -DPERL_USE_SAFE_PUTENV"
fi
EOOVER
@


