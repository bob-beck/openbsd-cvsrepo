head	1.7;
access;
symbols
	OPENBSD_5_6:1.6.0.28
	OPENBSD_5_6_BASE:1.6
	OPENBSD_5_5:1.6.0.26
	OPENBSD_5_5_BASE:1.6
	OPENBSD_5_4:1.6.0.22
	OPENBSD_5_4_BASE:1.6
	OPENBSD_5_3:1.6.0.20
	OPENBSD_5_3_BASE:1.6
	OPENBSD_5_2:1.6.0.18
	OPENBSD_5_2_BASE:1.6
	OPENBSD_5_1_BASE:1.6
	OPENBSD_5_1:1.6.0.16
	OPENBSD_5_0:1.6.0.14
	OPENBSD_5_0_BASE:1.6
	OPENBSD_4_9:1.6.0.12
	OPENBSD_4_9_BASE:1.6
	OPENBSD_4_8:1.6.0.10
	OPENBSD_4_8_BASE:1.6
	OPENBSD_4_7:1.6.0.6
	OPENBSD_4_7_BASE:1.6
	OPENBSD_4_6:1.6.0.8
	OPENBSD_4_6_BASE:1.6
	OPENBSD_4_5:1.6.0.4
	OPENBSD_4_5_BASE:1.6
	OPENBSD_4_4:1.6.0.2
	OPENBSD_4_4_BASE:1.6
	OPENBSD_4_3:1.5.0.18
	OPENBSD_4_3_BASE:1.5
	OPENBSD_4_2:1.5.0.16
	OPENBSD_4_2_BASE:1.5
	OPENBSD_4_1:1.5.0.14
	OPENBSD_4_1_BASE:1.5
	OPENBSD_4_0:1.5.0.12
	OPENBSD_4_0_BASE:1.5
	OPENBSD_3_9:1.5.0.10
	OPENBSD_3_9_BASE:1.5
	OPENBSD_3_8:1.5.0.8
	OPENBSD_3_8_BASE:1.5
	OPENBSD_3_7:1.5.0.6
	OPENBSD_3_7_BASE:1.5
	OPENBSD_3_6:1.5.0.4
	OPENBSD_3_6_BASE:1.5
	OPENBSD_3_5:1.5.0.2
	OPENBSD_3_5_BASE:1.5
	OPENBSD_3_4:1.4.0.8
	OPENBSD_3_4_BASE:1.4
	OPENBSD_3_3:1.4.0.10
	OPENBSD_3_3_BASE:1.4
	OPENBSD_3_2:1.4.0.6
	OPENBSD_3_2_BASE:1.4
	OPENBSD_3_1:1.4.0.4
	OPENBSD_3_1_BASE:1.4
	OPENBSD_3_0:1.4.0.2
	OPENBSD_3_0_BASE:1.4
	SENDMAIL_8_12_0:1.1.1.3
	OPENBSD_2_9:1.3.0.2
	OPENBSD_2_9_BASE:1.3
	SENDMAIL_8_11_2:1.1.1.2
	OPENBSD_2_8:1.2.0.4
	OPENBSD_2_8_BASE:1.2
	OPENBSD_2_7:1.2.0.2
	OPENBSD_2_7_BASE:1.2
	SENDMAIL_8_10_0:1.1.1.1
	SENDMAIL_INC:1.1.1;
locks; strict;
comment	@# @;


1.7
date	2014.09.17.18.49.52;	author matthieu;	state dead;
branches;
next	1.6;
commitid	M7i5giHIoz3DMlTU;

1.6
date	2008.05.04.18.34.05;	author millert;	state Exp;
branches;
next	1.5;

1.5
date	2003.09.17.17.31.41;	author millert;	state Exp;
branches;
next	1.4;

1.4
date	2001.09.11.19.02.50;	author millert;	state Exp;
branches;
next	1.3;

1.3
date	2001.01.15.21.09.11;	author millert;	state Exp;
branches;
next	1.2;

1.2
date	2000.04.02.19.48.36;	author millert;	state Exp;
branches
	1.2.4.1;
next	1.1;

1.1
date	2000.04.02.19.05.42;	author millert;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2000.04.02.19.05.42;	author millert;	state Exp;
branches;
next	1.1.1.2;

1.1.1.2
date	2001.01.15.20.52.09;	author millert;	state Exp;
branches;
next	1.1.1.3;

1.1.1.3
date	2001.09.11.18.55.49;	author millert;	state Exp;
branches;
next	;

1.2.4.1
date	2001.05.31.00.32.01;	author miod;	state Exp;
branches;
next	;


desc
@@


1.7
log
@Bye.
@
text
@
README  smrsh - sendmail restricted shell.

This README file is provided as a courtesy of the CERT Coordination Center,
Software Engineering Institute, Carnegie Mellon University.  This file is
intended as a supplement to the CERT advisory CA-93:16.sendmail.vulnerability,
and to the software, smrsh.c, written by Eric Allman.



The smrsh(8) program is intended as a replacement for /bin/sh in the
program mailer definition of sendmail(8).  This README file describes
the steps needed to compile and install smrsh.

smrsh is a restricted shell utility that provides the ability to
specify, through a configuration, an explicit list of executable
programs.  When used in conjunction with sendmail, smrsh effectively
limits sendmail's scope of program execution to only those programs
specified in smrsh's configuration.

smrsh has been written with portability in mind, and uses traditional
Unix library utilities.  As such, smrsh should compile on most
Unix C compilers.

smrsh should build on most systems with the enclosed Build script:

	host.domain% sh ./Build

To compile smrsh.c by hand, use the following command:

	host.domain% cc -o smrsh smrsh.c

For machines that provide dynamic linking, it is advisable to compile
smrsh without dynamic linking.  As an example with the Sun Microsystems
compiler, you should compile with the -Bstatic option.

	host.domain% cc -Bstatic -o smrsh smrsh.c
		or
	host.domain% sh ./Build LDOPTS=-Bstatic

With gcc, the GNU C compiler, use the -static option.

	host.domain% cc -static -o smrsh smrsh.c
		or
	host.domain% sh ./Build LDOPTS=-static

The following C defines can be set defined to change the search path and
the bin directory used by smrsh.

-DSMRSH_PATH=\"path\"	\"/bin:/usr/bin:/usr/ucb\"	The default search
							path.
-DSMRSH_CMDDIR=\"dir\"	\"/usr/adm/sm.bin\"		The default smrsh
							program directory
 
These can be added to the devtools/Site/site.config.m4 file using the
global M4 macro confENVDEF or the smrsh specific M4 macro
conf_smrsh_ENVDEF.

As root, install smrsh in /usr/libexec.  Using the Build script:

	host.domain# sh ./Build install

For manual installation: install smrsh in the /usr/libexec
directory, with mode 511.

	host.domain# mv smrsh /usr/libexec
	host.domain# chmod 511 /usr/libexec/smrsh



Next, determine the list of commands that smrsh should allow sendmail
to run.  This list of allowable commands can be determined by:

   1.  examining your /etc/mail/aliases file, to indicate what commands
       are being used by the system.

   2.  surveying your host's .forward files, to determine what
       commands users have specified.

See the man page for aliases(5) if you are unfamiliar with the format of
these specifications. Additionally, you should include in the list,
popular commands such as /usr/ucb/vacation.

You should NOT include interpreter programs such as sh(1), csh(1),
perl(1), uudecode(1) or the stream editor sed(1) in your list of
acceptable commands.

If your platform doesn't have a default SMRSH_CMDDIR setting, you will
next need to create the directory /usr/adm/sm.bin and populate
it with the programs that your site feels are allowable for sendmail
to execute.   This directory is explicitly specified in the source
code for smrsh, so changing this directory must be accompanied with
a change in smrsh.c.


You will have to be root to make these modifications.

After creating the /usr/adm/sm.bin directory, either copy the programs
to the directory, or establish links to the allowable programs from
/usr/adm/sm.bin.  Change the file permissions, so that these programs
can not be modified by non-root users.  If you use links, you should
ensure that the target programs are not modifiable.

To allow the popular vacation(1) program by creating a link in the
/usr/adm/sm.bin directory, you should:

	host.domain# cd /usr/adm/sm.bin
	host.domain# ln -s /usr/ucb/vacation vacation




After populating the /usr/adm/sm.bin directory, you can now configure
sendmail to use the restricted shell.  Save the current sendmail.cf
file prior to modifying it, as a prudent precaution.

Typically, the program mailer is defined by a single line in the
sendmail configuration file, sendmail.cf.  This file is traditionally
found in the /etc, /usr/lib or /etc/mail directories, depending on
the UNIX vendor.

If you are unsure of the location of the actual sendmail configuration
file, a search of the strings(1) output of the sendmail binary, will
help to locate it.

In order to configure sendmail to use smrsh, you must modify the Mprog
definition in the sendmail.cf file, by replacing the /bin/sh specification
with /usr/libexec/smrsh.

As an example:

In most Sun Microsystems' sendmail.cf files, the line is:
Mprog,	P=/bin/sh,   F=lsDFMeuP,  S=10, R=20, A=sh -c $u

which should be changed to:
Mprog,	P=/usr/libexec/smrsh,   F=lsDFMeuP,  S=10, R=20, A=sh -c $u
          ^^^^^^^^^^^^^^^^^^

A more generic line may be:
Mprog,		P=/bin/sh, F=lsDFM, A=sh -c $u

and should be changed to;
Mprog,		P=/usr/libexec/smrsh, F=lsDFM, A=sh -c $u


After modifying the Mprog definition in the sendmail.cf file, if a frozen
configuration file is being used, it is essential to create a new one.
You can determine if you need a frozen configuration by discovering
if a sendmail.fc file currently exists in either the /etc/, /usr/lib,
or /etc/mail directories.  The specific location can be determined using
a search of the strings(1) output of the sendmail binary.

In order to create a new frozen configuration, if it is required:
	host.domain# /usr/lib/sendmail -bz

Now re-start the sendmail process.  An example of how to do this on
a typical system follows:

	host.domain# cat /var/run/sendmail.pid
	130
	/usr/sbin/sendmail -bd -q30m
	host.domain# /bin/kill -15 130
	host.domain# /usr/sbin/sendmail -bd -q30m


$Revision: 1.6 $, Last updated $Date: 2008/05/04 18:34:05 $
@


1.6
log
@Update to sendmail-8.14.3
@
text
@d166 1
a166 1
$Revision: 8.10 $, Last updated $Date: 2008/02/12 16:40:06 $
@


1.5
log
@Update to sendmail-8.12.10.  This includes a fix for a buffer overflow
in address parsing.  That fix (but not all of sendmail-8.12.10) has
been applied to OpenBSD 3.4 and the 3.2 and 3.2 -stable branches.
@
text
@d27 1
a27 1
	host.domain% sh Build
d39 1
a39 1
	host.domain% sh Build LDOPTS=-Bstatic
d45 1
a45 1
	host.domain% sh Build LDOPTS=-static
d61 1
a61 1
	host.domain# sh Build install
d166 1
a166 1
$Revision: 8.8.4.1 $, Last updated $Date: 2003/05/26 04:29:42 $
@


1.4
log
@merge in sendmail 8.12.0 with BSD Makefiles and mdoc man pages
@
text
@d47 2
d50 8
d166 1
a166 1
$Revision: 8.8 $, Last updated $Date: 2001/01/24 00:05:58 $
@


1.3
log
@sendmail 8.11.2 with BSD Makefiles
@
text
@d78 1
a78 1
If your platform doesn't have a default CMDDIR setting, you will
d156 1
a156 1
$Revision: 8.6.16.1 $, Last updated $Date: 2000/10/09 20:39:55 $
@


1.2
log
@Remove sendmail's `Build' scaffolding and add real Makefiles
praliases should be in section 1, not 8
Use arc4random(3) instead of random(3)
Add some sample OpenBSD .mc files
@
text
@d78 2
a79 2

You will next need to create the directory /usr/adm/sm.bin and populate
d156 1
a156 1
$Revision: 8.6 $, Last updated $Date: 1999/04/28 01:09:51 $
@


1.2.4.1
log
@Pull in patch from current:
Errata(028):
The signal handlers in sendmail contain code that is unsafe in the
context of a signal handler.  This leads to potentially serious race
conditions.  At the moment this is a theoretical attack only and can
only be exploited on the local host (if at all).
Fix(millert):
Update to sendmail 8.11.4:
8.11.4 revamps signal handling within the MTA in order to reduce
the likelihood of a race condition that can lead to heap
corruption as described in Michal Zalewski's advisory.  The
problems discussed in the advisory are not currently known to
be exploitable but we recommend upgrading to 8.11.4 in case a
method is found to exploit the signal handling race condition.
8.11.4 also fixes other bugs found since the release of 8.11.3.

See the RELEASE_NOTES file for more details.
@
text
@d78 2
a79 2
If your platform doesn't have a default CMDDIR setting, you will
next need to create the directory /usr/adm/sm.bin and populate
d156 1
a156 1
$Revision: 1.3 $, Last updated $Date: 2001/01/15 21:09:11 $
@


1.1
log
@Initial revision
@
text
@@


1.1.1.1
log
@stock sendmail 8.10.0 with $Id -> $Sendmail
@
text
@@


1.1.1.2
log
@sendmail 8.11.2
@
text
@d78 2
a79 2
If your platform doesn't have a default CMDDIR setting, you will
next need to create the directory /usr/adm/sm.bin and populate
d156 1
a156 1
$Revision: 8.6.16.1 $, Last updated $Date: 2000/10/09 20:39:55 $
@


1.1.1.3
log
@sendmail 8.12.0 with $Id tags converted to $Sendmail
@
text
@d78 1
a78 1
If your platform doesn't have a default SMRSH_CMDDIR setting, you will
d156 1
a156 1
$Revision: 8.8 $, Last updated $Date: 2001/01/24 00:05:58 $
@


