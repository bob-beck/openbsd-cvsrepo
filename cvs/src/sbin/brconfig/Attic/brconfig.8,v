head	1.72;
access;
symbols
	OPENBSD_4_6:1.71.0.4
	OPENBSD_4_6_BASE:1.71
	OPENBSD_4_5:1.70.0.2
	OPENBSD_4_5_BASE:1.70
	OPENBSD_4_4:1.69.0.6
	OPENBSD_4_4_BASE:1.69
	OPENBSD_4_3:1.69.0.4
	OPENBSD_4_3_BASE:1.69
	OPENBSD_4_2:1.69.0.2
	OPENBSD_4_2_BASE:1.69
	OPENBSD_4_1:1.68.0.2
	OPENBSD_4_1_BASE:1.68
	OPENBSD_4_0:1.58.0.2
	OPENBSD_4_0_BASE:1.58
	OPENBSD_3_9:1.53.0.2
	OPENBSD_3_9_BASE:1.53
	OPENBSD_3_8:1.52.0.4
	OPENBSD_3_8_BASE:1.52
	OPENBSD_3_7:1.52.0.2
	OPENBSD_3_7_BASE:1.52
	OPENBSD_3_6:1.50.0.2
	OPENBSD_3_6_BASE:1.50
	OPENBSD_3_5:1.49.0.2
	OPENBSD_3_5_BASE:1.49
	OPENBSD_3_4:1.46.0.2
	OPENBSD_3_4_BASE:1.46
	OPENBSD_3_3:1.41.0.2
	OPENBSD_3_3_BASE:1.41
	OPENBSD_3_2:1.38.0.2
	OPENBSD_3_2_BASE:1.38
	OPENBSD_3_1:1.34.0.2
	OPENBSD_3_1_BASE:1.34
	OPENBSD_3_0:1.27.0.2
	OPENBSD_3_0_BASE:1.27
	OPENBSD_2_9:1.23.0.2
	OPENBSD_2_9_BASE:1.23
	OPENBSD_2_8:1.17.0.2
	OPENBSD_2_8_BASE:1.17
	OPENBSD_2_7:1.11.0.2
	OPENBSD_2_7_BASE:1.11
	OPENBSD_2_6:1.2.0.2
	OPENBSD_2_6_BASE:1.2;
locks; strict;
comment	@.\" @;


1.72
date	2009.11.22.23.33.22;	author deraadt;	state dead;
branches;
next	1.71;

1.71
date	2009.05.04.18.05.01;	author jmc;	state Exp;
branches;
next	1.70;

1.70
date	2009.01.31.19.37.12;	author sobrado;	state Exp;
branches;
next	1.69;

1.69
date	2007.05.31.19.19.43;	author jmc;	state Exp;
branches;
next	1.68;

1.68
date	2007.01.01.20.47.55;	author jmc;	state Exp;
branches;
next	1.67;

1.67
date	2007.01.01.20.41.23;	author jmc;	state Exp;
branches;
next	1.66;

1.66
date	2007.01.01.20.38.21;	author jmc;	state Exp;
branches;
next	1.65;

1.65
date	2007.01.01.20.27.08;	author jmc;	state Exp;
branches;
next	1.64;

1.64
date	2007.01.01.20.11.17;	author jmc;	state Exp;
branches;
next	1.63;

1.63
date	2006.12.24.19.05.25;	author reyk;	state Exp;
branches;
next	1.62;

1.62
date	2006.12.11.22.11.48;	author reyk;	state Exp;
branches;
next	1.61;

1.61
date	2006.12.07.10.22.05;	author jmc;	state Exp;
branches;
next	1.60;

1.60
date	2006.12.03.13.41.19;	author reyk;	state Exp;
branches;
next	1.59;

1.59
date	2006.10.23.07.05.49;	author jmc;	state Exp;
branches;
next	1.58;

1.58
date	2006.07.25.12.45.08;	author jmc;	state Exp;
branches;
next	1.57;

1.57
date	2006.07.25.07.04.55;	author djm;	state Exp;
branches;
next	1.56;

1.56
date	2006.05.28.08.06.55;	author jmc;	state Exp;
branches;
next	1.55;

1.55
date	2006.05.27.19.37.24;	author hshoexer;	state Exp;
branches;
next	1.54;

1.54
date	2006.05.26.04.02.59;	author deraadt;	state Exp;
branches;
next	1.53;

1.53
date	2005.09.27.21.31.40;	author jmc;	state Exp;
branches;
next	1.52;

1.52
date	2004.12.14.08.58.21;	author camield;	state Exp;
branches;
next	1.51;

1.51
date	2004.09.29.02.25.19;	author mcbride;	state Exp;
branches;
next	1.50;

1.50
date	2004.05.04.18.50.48;	author jmc;	state Exp;
branches;
next	1.49;

1.49
date	2004.02.27.12.32.05;	author markus;	state Exp;
branches;
next	1.48;

1.48
date	2004.01.21.19.42.42;	author jmc;	state Exp;
branches;
next	1.47;

1.47
date	2003.12.07.06.13.23;	author deraadt;	state Exp;
branches;
next	1.46;

1.46
date	2003.06.27.13.10.51;	author henning;	state Exp;
branches;
next	1.45;

1.45
date	2003.06.25.09.44.55;	author henning;	state Exp;
branches;
next	1.44;

1.44
date	2003.06.03.13.16.07;	author jmc;	state Exp;
branches;
next	1.43;

1.43
date	2003.06.02.18.44.35;	author jason;	state Exp;
branches;
next	1.42;

1.42
date	2003.05.10.20.56.36;	author jmc;	state Exp;
branches;
next	1.41;

1.41
date	2003.03.07.06.30.38;	author david;	state Exp;
branches;
next	1.40;

1.40
date	2002.12.09.10.11.53;	author markus;	state Exp;
branches;
next	1.39;

1.39
date	2002.12.06.16.28.48;	author markus;	state Exp;
branches;
next	1.38;

1.38
date	2002.09.06.21.36.52;	author deraadt;	state Exp;
branches;
next	1.37;

1.37
date	2002.07.12.17.49.02;	author jason;	state Exp;
branches;
next	1.36;

1.36
date	2002.06.15.02.27.03;	author angelos;	state Exp;
branches;
next	1.35;

1.35
date	2002.06.09.08.13.05;	author todd;	state Exp;
branches;
next	1.34;

1.34
date	2002.01.17.15.55.30;	author espie;	state Exp;
branches;
next	1.33;

1.33
date	2001.12.21.19.55.09;	author angelos;	state Exp;
branches;
next	1.32;

1.32
date	2001.12.21.11.41.50;	author mpech;	state Exp;
branches;
next	1.31;

1.31
date	2001.12.15.08.40.56;	author jason;	state Exp;
branches;
next	1.30;

1.30
date	2001.12.13.20.16.48;	author mpech;	state Exp;
branches;
next	1.29;

1.29
date	2001.12.05.19.55.34;	author jason;	state Exp;
branches;
next	1.28;

1.28
date	2001.12.05.09.57.20;	author deraadt;	state Exp;
branches;
next	1.27;

1.27
date	2001.08.20.05.57.55;	author mpech;	state Exp;
branches;
next	1.26;

1.26
date	2001.08.02.18.37.34;	author mpech;	state Exp;
branches;
next	1.25;

1.25
date	2001.07.18.22.52.07;	author kjell;	state Exp;
branches;
next	1.24;

1.24
date	2001.05.14.02.43.12;	author jason;	state Exp;
branches;
next	1.23;

1.23
date	2001.03.26.05.37.28;	author aaron;	state Exp;
branches;
next	1.22;

1.22
date	2001.01.04.22.13.01;	author todd;	state Exp;
branches;
next	1.21;

1.21
date	2000.12.31.00.08.14;	author angelos;	state Exp;
branches;
next	1.20;

1.20
date	2000.12.28.03.40.20;	author jason;	state Exp;
branches;
next	1.19;

1.19
date	2000.12.12.03.41.21;	author jason;	state Exp;
branches;
next	1.18;

1.18
date	2000.11.06.01.08.06;	author aaron;	state Exp;
branches;
next	1.17;

1.17
date	2000.10.28.16.17.26;	author aaron;	state Exp;
branches;
next	1.16;

1.16
date	2000.10.26.18.32.29;	author jason;	state Exp;
branches;
next	1.15;

1.15
date	2000.10.24.18.39.34;	author provos;	state Exp;
branches;
next	1.14;

1.14
date	2000.10.24.17.38.36;	author beck;	state Exp;
branches;
next	1.13;

1.13
date	2000.09.06.07.38.16;	author mickey;	state Exp;
branches;
next	1.12;

1.12
date	2000.06.20.20.22.12;	author jason;	state Exp;
branches;
next	1.11;

1.11
date	2000.05.02.18.51.04;	author jason;	state Exp;
branches;
next	1.10;

1.10
date	2000.05.02.18.43.09;	author jason;	state Exp;
branches;
next	1.9;

1.9
date	2000.03.26.17.36.33;	author jason;	state Exp;
branches;
next	1.8;

1.8
date	2000.03.19.00.35.10;	author aaron;	state Exp;
branches;
next	1.7;

1.7
date	2000.03.18.22.55.54;	author aaron;	state Exp;
branches;
next	1.6;

1.6
date	2000.02.11.04.22.27;	author jason;	state Exp;
branches;
next	1.5;

1.5
date	2000.01.25.22.06.26;	author jason;	state Exp;
branches;
next	1.4;

1.4
date	2000.01.10.22.14.25;	author angelos;	state Exp;
branches;
next	1.3;

1.3
date	2000.01.01.19.14.23;	author deraadt;	state Exp;
branches;
next	1.2;

1.2
date	99.09.23.04.12.02;	author alex;	state Exp;
branches;
next	1.1;

1.1
date	99.09.01.03.28.01;	author deraadt;	state Exp;
branches;
next	;


desc
@@


1.72
log
@brconfig(8) functionality is now in ifconfig(8)
@
text
@.\"	$OpenBSD: brconfig.8,v 1.71 2009/05/04 18:05:01 jmc Exp $
.\"
.\" Copyright (c) 1999-2001 Jason L. Wright (jason@@thought.net)
.\" All rights reserved.
.\"
.\" Redistribution and use in source and binary forms, with or without
.\" modification, are permitted provided that the following conditions
.\" are met:
.\" 1. Redistributions of source code must retain the above copyright
.\"    notice, this list of conditions and the following disclaimer.
.\" 2. Redistributions in binary form must reproduce the above copyright
.\"    notice, this list of conditions and the following disclaimer in the
.\"    documentation and/or other materials provided with the distribution.
.\"
.\" THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS'' AND ANY EXPRESS OR
.\" IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
.\" WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
.\" DISCLAIMED.  IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT,
.\" INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
.\" (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
.\" SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
.\" HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT,
.\" STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
.\" ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
.\" POSSIBILITY OF SUCH DAMAGE.
.\"
.Dd $Mdocdate: May 4 2009 $
.Dt BRCONFIG 8
.Os
.Sh NAME
.Nm brconfig
.Nd manipulate bridge interfaces
.Sh SYNOPSIS
.Nm
.Op Fl Aa
.Op Ar interface
.Op Ar parameters
.Nm
.Ar interface Cm rule No {
.Cm block | pass No } {
.Cm in | out | in/out No } Cm on
.Ar interface
.Op Cm src Ar address
.Op Cm dst Ar address
.Op Cm tag Ar tagname
.Sh DESCRIPTION
The
.Nm
utility retrieves kernel state of bridge interfaces and allows
user control of these bridges.
Bridge devices create a logical link between two or more Ethernet interfaces
or encapsulation interfaces (see
.Xr gif 4 ) ,
which will selectively forward frames from each interface on the bridge
to every other interface on the bridge.
This can be used to isolate traffic between sets of machines on the same
segment and to provide a transparent filter for
.Xr ip 4
datagrams.
.Pp
The options are as follows:
.Bl -tag -width Ds
.It Fl A
The same as
.Fl a ,
but also lists additional status information.
.It Fl a
Lists the status of all bridges in the system.
This is the default if
.Nm
is invoked without arguments.
.El
.Pp
The following
.Ar parameters
may be set with
.Nm :
.Bl -tag -width Ds
.It Cm add Ar interface
Add
.Ar interface
as a member of the bridge.
The interface is put into promiscuous mode so
that it can receive every packet sent on the
network.
An interface can be a member of at most one bridge.
.It Cm addr
Display the addresses that have been learned by the bridge.
.It Cm addspan Ar interface
Add
.Ar interface
as a span port on the bridge.
See the
.Sx SPAN PORTS
section for more details.
.It Cm autoedge Ar interface
Automatically detect the spanning tree edge port status on
.Ar interface .
This is the default for interfaces added to the bridge.
.It Cm -autoedge Ar interface
Disable automatic spanning tree edge port detection on
.Ar interface .
.It Cm autoptp Ar interface
Automatically detect the point-to-point status on
.Ar interface
by checking the full duplex link status.
This is the default for interfaces added to the bridge.
.It Cm -autoptp Ar interface
Disable automatic point-to-point link detection on
.Ar interface .
.It Cm blocknonip Ar interface
Mark
.Ar interface
so that no non-IPv4, IPv6, ARP, or Reverse
ARP packets are accepted from it or forwarded to it from other
bridge member interfaces.
.It Cm -blocknonip Ar interface
Allow non-IPv4, IPv6, ARP, or Reverse ARP packets through
.Ar interface .
.It Cm del Ar interface
Alias for
.Cm delete .
.It Cm deladdr Ar address
Delete
.Ar address
from the cache.
.It Cm delete Ar interface
Remove
.Ar interface
from the bridge.
Promiscuous mode is turned off for the interface when it is
removed from the bridge.
.It Cm delspan Ar interface
Delete
.Ar interface
from the list of span ports of the bridge.
.It Cm discover Ar interface
Mark
.Ar interface
so that packets are sent out of the interface
if the destination port of the packet is unknown.
If the bridge has no address cache entry for the destination of
a packet, meaning that there is no static entry and no dynamically learned
entry for the destination, the bridge will forward the packet to all member
interfaces that have this flag set.
This is the default for interfaces added to the bridge.
.It Cm -discover Ar interface
Mark
.Ar interface
so that packets are not sent out of the interface
if the destination port of the packet is unknown.
Turning this flag
off means that the bridge will not send packets out of this interface
unless the packet is a broadcast packet, multicast packet, or a
packet with a destination address found on the interface's segment.
This, in combination with static address cache entries,
prevents potentially sensitive packets from being sent on
segments that have no need to see the packet.
.It Cm down
Stop the bridge from forwarding packets.
.It Cm edge Ar interface
Set
.Ar interface
as a spanning tree edge port.
An edge port is a single connection to the network and cannot create
bridge loops.
This allows a straight transition to forwarding.
.It Cm -edge Ar interface
Disable edge port status on
.Ar interface .
.It Cm flush
Remove all dynamically learned addresses from the cache.
.It Cm flushall
Remove all addresses from the cache including static addresses.
.It Cm flushrule Ar interface
Remove all Ethernet MAC filtering rules from
.Ar interface .
.It Cm fwddelay Ar time
Set the time (in seconds) before an interface begins forwarding packets.
Defaults to 15 seconds, minimum of 4, maximum of 30.
.It Cm hellotime Ar time
Set the time (in seconds) between broadcasting spanning tree protocol
configuration packets.
Defaults to 2 seconds, minimum of 1, maximum of 2.
This option is only supported in STP mode with rapid transitions disabled;
see the
.Cm proto
command for setting the protocol version.
.It Cm holdcnt Ar time
Set the transmit hold count, which is the number of spanning tree protocol
packets transmitted before being rate limited.
Defaults to 6, minimum of 1, maximum of 10.
.It Cm ifcost Ar interface Ar num
Set the spanning tree path cost of
.Ar interface
to
.Ar num .
Defaults to 55, minimum of 1, maximum of 200000000 in RSTP mode,
and maximum of 65535 in STP mode.
.It Cm -ifcost Ar interface
Automatically calculate the spanning tree priority of
.Ar interface
based on the current link speed, interface status, and spanning tree mode.
This is the default for interfaces added to the bridge.
.It Cm ifpriority Ar interface Ar num
Set the spanning tree priority of
.Ar interface
to
.Ar num .
Defaults to 128, minimum of 0, maximum of 240.
.It Cm learn Ar interface
Mark
.Ar interface
so that the source address of packets received from
the interface
are entered into the address cache.
This is the default for interfaces added to the bridge.
.It Cm -learn Ar interface
Mark
.Ar interface
so that the source address of packets received from interface
are not entered into the address cache.
.It Cm link0
Setting this flag stops all IP multicast packets from
being forwarded by the bridge.
.It Cm -link0
Clear the
.Cm link0
flag on the bridge interface.
.It Cm link1
Setting this flag stops all non-IP multicast packets from
being forwarded by the bridge.
.It Cm -link1
Clear the
.Cm link1
flag on the bridge interface.
.It Cm link2
Setting this flag causes all packets to be passed on to
.Xr ipsec 4
for processing, based on the policies established by the administrator
using the
.Xr ipsecctl 8
command and
.Xr ipsec.conf 5 .
If appropriate security associations (SAs) exist, they will be used to
encrypt or decrypt the packets.
Otherwise, any key management daemons such as
.Xr isakmpd 8
that are running on the bridge will be invoked to establish the
necessary SAs.
These daemons have to be configured as if they were running on the
host whose traffic they are protecting (i.e. they need to have the
appropriate authentication and authorization material, such as keys
and certificates, to impersonate the protected host(s)).
.It Cm -link2
Clear the
.Cm link2
flag on the bridge interface.
.It Cm maxaddr Ar size
Set the address cache size to
.Ar size .
The default is 100 entries.
.It Cm maxage Ar time
Set the time (in seconds) that a spanning tree protocol configuration is valid.
Defaults to 20 seconds, minimum of 6, maximum of 40.
.It Cm priority Ar num
Set the spanning priority of this bridge to
.Ar num .
Defaults to 32768, minimum of 0, maximum of 61440.
.It Cm proto Ar value
Force the spanning tree protocol version.
The available values are
.Ar rstp
to operate in the default Rapid Spanning Tree (RSTP) mode
or
.Ar stp
to force operation in Spanning Tree (STP) mode with rapid transitions disabled.
.It Cm ptp Ar interface
Set
.Ar interface
as a point-to-point link.
This is required for straight transitions to forwarding and
should be enabled for a full duplex link or a
.Xr trunk 4
with at least two physical links to the same network segment.
.It Cm -ptp Ar interface
Disable point-to-point link status on
.Ar interface .
This should be disabled for a half duplex link and for an interface
connected to a shared network segment,
like a hub or a wireless network.
.It Cm rule Op Ar rulespec
Add a filtering rule to an interface.
Rules have a similar syntax to those in
.Xr pf.conf 5 .
Rules can be used to selectively block or pass frames based on Ethernet
MAC addresses.
They can also tag packets for
.Xr pf 4
to filter on.
Rules are processed in the order in which they were added
to the interface, and the first rule matched takes the action (block or pass)
and, if given, the tag of the rule.
If no source or destination address is specified, the
rule will match all frames (good for creating a catchall policy).
.It Cm rulefile Ar filename
Load a set of rules from the file
.Ar filename .
.It Cm rules Ar interface
Display the active filtering rules in use on
.Ar interface .
.It Cm static Ar interface address
Add a static entry into the address cache pointing to
.Ar interface .
Static entries are never aged out of the cache or replaced, even if the address
is seen on a different interface.
.It Cm stp Ar interface
Enable spanning tree protocol on
.Ar interface .
.It Cm -stp Ar interface
Disable spanning tree protocol on
.Ar interface .
This is the default for interfaces added to the bridge.
.It Cm timeout Ar time
Set the timeout, in seconds, for addresses in the cache to
.Ar time .
The default is 240 seconds.
If
.Ar time
is set to zero, then entries will not be expired.
.It Cm up
Start the bridge forwarding packets.
.El
.Sh IPSEC BRIDGE
The bridge can also be used to tunnel Ethernet frames over IPv4 or
IPv6 by using the
.Xr gif 4
interface.
In addition to adding Ethernet interfaces,
one or more
.Xr gif 4 ,
interfaces are added as members of the bridge.
Ethernet frames sent
through the
.Xr gif 4
interfaces are encapsulated inside
.Xr ip 4
datagrams and sent across the network to another bridge, which
decapsulates the datagram and then processes the resulting Ethernet
frame as if it had originated on a normal Ethernet interface.
This effectively allows a layer-2 network to be extended from one point to
another, possibly through the Internet.
This mechanism may be used in
conjunction with IPsec by specifying the appropriate IPsec flows
between the two bridges.
To only protect the bridge traffic between
the two bridges, the transport protocol 97 (etherip) selector may be
used in
.Xr ipsec.conf 5
or
.Xr isakmpd 8 .
Otherwise, the Ethernet frames will be sent in the clear between the
two bridges.
.Pp
For example, given two physically separate Ethernet networks, the bridge can
be used as follows to make them appear as the same local area network.
If bridge1 on network1 has the external IP address 1.2.3.4 on fxp0,
bridge2 on network2 has the external IP address 4.3.2.1 on fxp0, and
both bridges have fxp1 on their internal network (network1 and network2,
respectively), the following configuration can be used to bridge
network1 and network2.
.Pp
First create the bridge interface,
then add the encapsulation interface and internal Ethernet interface
to the bridge interface:
.Bd -literal -offset indent
# ifconfig bridge0 create
# brconfig bridge0 add gif0 add fxp1
.Ed
.Pp
Create and configure the gif0 interface:
.Bd -literal -offset indent
(on bridge 1) # ifconfig gif0 create
(on bridge 1) # ifconfig gif0 tunnel 1.2.3.4 4.3.2.1
(on bridge 2) # ifconfig gif0 create
(on bridge 2) # ifconfig gif0 tunnel 4.3.2.1 1.2.3.4
.Ed
.Pp
Create Security Associations (SAs) between the external IP address of each
bridge and matching ingress flows by using the following
.Xr ipsec.conf 5
file on bridge1:
.Bd -literal -offset indent
esp from 1.2.3.4 to 4.3.2.1 spi 0x4242:0x4243 \e
	authkey file "auth1:auth2" enckey file "enc1:enc2"
flow esp proto etherip from 1.2.3.4 to 4.3.2.1
.Ed
.Pp
Now load these rules into the kernel by issuing the
.Xr ipsecctl 8
command:
.Bd -literal -offset indent
	# ipsecctl -f ipsec.conf
.Ed
.Pp
Appropriate
.Xr ipsec.conf 5
for bridge2:
.Bd -literal -offset indent
esp from 4.3.2.1 to 1.2.3.4 spi 0x4243:0x4242 \e
	authkey file "auth2:auth1" enckey file "enc2:enc1"
flow esp proto etherip from 4.3.2.1 to 1.2.3.4
.Ed
.Pp
And load them:
.Bd -literal -offset indent
	# ipsecctl -f ipsec.conf
.Ed
.Pp
To use
.Xr isakmpd 8
use this
.Xr ipsec.conf 5
on bridge1:
.Bd -literal -offset indent
ike esp proto etherip from 1.2.3.4 to 4.3.2.1
.Ed
.Pp
And that one on bridge2:
.Bd -literal -offset indent
ike esp proto etherip from 4.3.2.1 to 1.2.3.4
.Ed
.Pp
Bring up the internal interface (if not already up) and encapsulation
interface:
.Bd -literal -offset indent
# ifconfig fxp1 up
# ifconfig gif0 up
.Ed
.Pp
Finally, bring the bridge interface up and allow it to start processing
frames:
.Pp
.Dl # brconfig bridge0 up link2
.Pp
The internal interface on each bridge need not have an IP
address: the bridge can function without it.
.Pp
Note:  It is possible to put the above commands in the
.Xr hostname.if 5
and
.Xr bridgename.if 5
files, using the
.Sq !\&
operator.
.Sh SPANNING TREE
The bridge has support for 802.1D-2004 Spanning Tree Protocol (STP),
which can be used to detect and remove loops in a network topology.
Using the
.Cm stp
or
.Cm -stp
commands
to
.Nm ,
STP can be enabled or disabled on each port.
.Pp
The bridge will use the Rapid Spanning Tree Protocol (RSTP) by default
to allow rapid transitions to the forwarding state.
The
.Cm proto
command to
.Nm
can be used to force operation in the common Spanning Tree Protocol
without rapid state transitions.
Note that RSTP will be compatible with remote bridges running common STP.
.Pp
STP will not work on
.Xr gif 4
members because they lack a hardware MAC address.
.Sh SPAN PORTS
The bridge can have interfaces added to it as span ports.
Span ports transmit a copy of every frame received by the bridge.
This is most useful for snooping a bridged network passively on
another host connected to one of the span ports of the bridge.
Span ports cannot be bridge members; instead, the
.Cm addspan
and
.Cm delspan
commands are used to add and delete span ports to and from a bridge.
.Sh EXAMPLES
Create a bridge pseudo network device:
.Pp
.Dl # ifconfig bridge0 create
.Pp
Bring the Ethernet interfaces rl0 and xl0 up,
add them to the bridge, bridge0,
and have the bridge start forwarding packets:
.Bd -literal -offset indent
# ifconfig rl0 up
# ifconfig xl0 up
# brconfig bridge0 add rl0 add xl0 up
.Ed
.Pp
Retrieve a list of interfaces that are members of bridge0, and the addresses
learned by the bridge:
.Pp
.Dl # brconfig bridge0
.Pp
Stop bridge0 from forwarding packets:
.Pp
.Dl # brconfig bridge0 down
.Pp
Remove the interface xl0 from the bridge bridge0:
.Pp
.Dl # brconfig bridge0 delete xl0
.Pp
Flush all dynamically learned addresses from the address cache:
.Pp
.Dl # brconfig bridge0 flush
.Pp
Remove all addresses, including static addresses, from the address cache:
.Pp
.Dl # brconfig bridge0 flushall
.Pp
The following commands mark the xl0 interface so that it will not learn
addresses and add a static entry for the host 8:0:20:1e:2f:2b on the xl0
segment.
Finally, xl0 is marked so that it will not receive packets with
destinations not found in the address cache of bridge0.
This setup is the most secure,
and means that bogus MAC addresses seen by the xl0 side of the bridge
will not be propagated to the rest of the network.
Also, no packets will be sent onto the xl0 segment by the bridge unless they are
broadcast packets or are destined for 8:0:20:1e:2f:2b.
.Bd -literal -offset indent
# brconfig bridge0 -learn xl0 static xl0 8:0:20:1e:2f:2b
# brconfig bridge0 -discover xl0
.Ed
.Pp
The following commands will set up a filter so that 0:1:2:3:4:5 can send frames
through fxp0 only to 5:4:3:2:1:0, and 5:4:3:2:1:0 can return frames through
fxp0 only to 0:1:2:3:4:5.
All other traffic trying to go into or be sent from fxp0 will be blocked.
.Bd -literal -offset indent
# brconfig bridge0 rule pass in  on fxp0 \e
	src 0:1:2:3:4:5 dst 5:4:3:2:1:0
# brconfig bridge0 rule pass out on fxp0 \e
	src 5:4:3:2:1:0 dst 0:1:2:3:4:5
# brconfig bridge0 rule block in  on fxp0
# brconfig bridge0 rule block out on fxp0
.Ed
.Pp
The following commands will tag packets from and to 9:8:7:6:5:4 on fxp0 so that
.Xr pf 4
can refer to them using the
.Cm tagged
directive:
.Bd -literal -offset indent
# brconfig bridge0 rule pass in  on fxp0 src 9:8:7:6:5:4 tag boss
# brconfig bridge0 rule pass out on fxp0 dst 9:8:7:6:5:4 tag boss
.Ed
.Pp
An example
.Xr pf.conf 5
rule using this tag is:
.Pp
.Dl pass tagged boss queue q_med
.Sh SEE ALSO
.Xr bridge 4 ,
.Xr gif 4 ,
.Xr ip 4 ,
.Xr ipsec 4 ,
.Xr pf 4 ,
.Xr bridgename.if 5 ,
.Xr pf.conf 5 ,
.Xr ifconfig 8 ,
.Xr ipsecctl 8 ,
.Xr isakmpd 8
.Sh HISTORY
The
.Nm
command first appeared in
.Ox 2.5 .
.Sh AUTHORS
The
.Nm
command and the
.Xr bridge 4
kernel interface were written by
.An Jason L. Wright Aq jason@@thought.net
as part of an undergraduate independent study at the
University of North Carolina at Greensboro.
.Pp
Support for rapid spanning tree reconfigurations (RSTP) was added by
.An Andrew Thompson Aq thompsa@@freebsd.org
and ported to
.Ox
by
.An Reyk Floeter Aq reyk@@openbsd.org .
.Sh BUGS
There are some rather special network interface chipsets which will
not work in a bridge configuration.
Some chipsets have serious flaws when running in promiscuous mode, like the
TI ThunderLAN (see
.Xr tl 4 ) ,
which receives its own transmissions (this renders the address learning
cache useless).
Most other chipsets work fine though.
@


1.71
log
@in IPSEC BRIDGE:
- need to explicitly bring bridge0 up; from mpf
- final example needs "link2"; from bsd

ok mpf
@
text
@d1 1
a1 1
.\"	$OpenBSD: brconfig.8,v 1.70 2009/01/31 19:37:12 sobrado Exp $
d27 1
a27 1
.Dd $Mdocdate: January 31 2009 $
@


1.70
log
@write point-to-point in a consistent way.

jmc@@ has provided a complete list of manual pages to be fixed,
and suggested using uppercase (i.e., Point-to-Point) when discussing
the protocol, and lowercase (point-to-point) otherwise.

ok jmc@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: brconfig.8,v 1.69 2007/05/31 19:19:43 jmc Exp $
d27 1
a27 1
.Dd $Mdocdate: May 31 2007 $
d373 7
a379 4
Add the encapsulation interface and internal Ethernet interface to the bridge
interface:
.Pp
.Dl # brconfig bridge0 add gif0 add fxp1
d444 1
a444 1
.Dl # brconfig bridge0 up
@


1.69
log
@convert to new .Dd format;
@
text
@d1 1
a1 1
.\"	$OpenBSD: brconfig.8,v 1.68 2007/01/01 20:47:55 jmc Exp $
d27 1
a27 1
.Dd $Mdocdate$
d104 1
a104 1
Automatically detect the point to point status on
d109 1
a109 1
Disable automatic point to point link detection on
d281 1
a281 1
as a point to point link.
d287 1
a287 1
Disable point to point link status on
@


1.68
log
@some minor improvements;
@
text
@d1 1
a1 1
.\"	$OpenBSD: brconfig.8,v 1.67 2007/01/01 20:41:23 jmc Exp $
d27 1
a27 1
.Dd February 26, 1999
@


1.67
log
@find a better place for EXAMPLES;
@
text
@d1 1
a1 1
.\"	$OpenBSD: brconfig.8,v 1.66 2007/01/01 20:38:21 jmc Exp $
d252 1
a252 1
host whose traffic they are protecting (i.e., they need to have the
d443 2
a444 2
The internal interface, i.e., fxp1, on each bridge need not have an IP
address; the bridge can function without it.
d450 3
a452 1
files, using the ! operator.
@


1.66
log
@- use "interface", not "interface-name", consistently
- mark up "interface" consistently
- a little .Sx
@
text
@d1 1
a1 1
.\"	$OpenBSD: brconfig.8,v 1.65 2007/01/01 20:27:08 jmc Exp $
a333 78
.Sh EXAMPLES
Create a bridge pseudo network device:
.Pp
.Dl # ifconfig bridge0 create
.Pp
Bring the Ethernet interfaces rl0 and xl0 up,
add them to the bridge, bridge0,
and have the bridge start forwarding packets:
.Bd -literal -offset indent
# ifconfig rl0 up
# ifconfig xl0 up
# brconfig bridge0 add rl0 add xl0 up
.Ed
.Pp
Retrieve a list of interfaces that are members of bridge0, and the addresses
learned by the bridge:
.Pp
.Dl # brconfig bridge0
.Pp
Stop bridge0 from forwarding packets:
.Pp
.Dl # brconfig bridge0 down
.Pp
Remove the interface xl0 from the bridge bridge0:
.Pp
.Dl # brconfig bridge0 delete xl0
.Pp
Flush all dynamically learned addresses from the address cache:
.Pp
.Dl # brconfig bridge0 flush
.Pp
Remove all addresses, including static addresses, from the address cache:
.Pp
.Dl # brconfig bridge0 flushall
.Pp
The following commands mark the xl0 interface so that it will not learn
addresses and add a static entry for the host 8:0:20:1e:2f:2b on the xl0
segment.
Finally, xl0 is marked so that it will not receive packets with
destinations not found in the address cache of bridge0.
This setup is the most secure,
and means that bogus MAC addresses seen by the xl0 side of the bridge
will not be propagated to the rest of the network.
Also, no packets will be sent onto the xl0 segment by the bridge unless they are
broadcast packets or are destined for 8:0:20:1e:2f:2b.
.Bd -literal -offset indent
# brconfig bridge0 -learn xl0 static xl0 8:0:20:1e:2f:2b
# brconfig bridge0 -discover xl0
.Ed
.Pp
The following commands will set up a filter so that 0:1:2:3:4:5 can send frames
through fxp0 only to 5:4:3:2:1:0, and 5:4:3:2:1:0 can return frames through
fxp0 only to 0:1:2:3:4:5.
All other traffic trying to go into or be sent from fxp0 will be blocked.
.Bd -literal -offset indent
# brconfig bridge0 rule pass in  on fxp0 \e
	src 0:1:2:3:4:5 dst 5:4:3:2:1:0
# brconfig bridge0 rule pass out on fxp0 \e
	src 5:4:3:2:1:0 dst 0:1:2:3:4:5
# brconfig bridge0 rule block in  on fxp0
# brconfig bridge0 rule block out on fxp0
.Ed
.Pp
The following commands will tag packets from and to 9:8:7:6:5:4 on fxp0 so that
.Xr pf 4
can refer to them using the
.Cm tagged
directive:
.Bd -literal -offset indent
# brconfig bridge0 rule pass in  on fxp0 src 9:8:7:6:5:4 tag boss
# brconfig bridge0 rule pass out on fxp0 dst 9:8:7:6:5:4 tag boss
.Ed
.Pp
An example
.Xr pf.conf 5
rule using this tag is:
.Pp
.Dl pass tagged boss queue q_med
d486 78
@


1.65
log
@sort the list of parameters brconfig(8) accepts;
@
text
@d1 1
a1 1
.\"	$OpenBSD: brconfig.8,v 1.64 2007/01/01 20:11:17 jmc Exp $
d79 3
a81 3
.It Cm add Ar interface-name
Add the interface named by
.Ar interface-name
d89 3
a91 3
.It Cm addspan Ar interface-name
Add the interface named by
.Ar interface-name
d93 3
a95 1
See the SPAN PORTS section for more details.
d112 3
a114 1
Mark an interface so that no non-IPv4, IPv6, ARP, or Reverse
d118 1
a118 1
Allow non-IPv4, IPv6, ARP, or Reverse ARP packets through the
d120 1
a120 1
.It Cm del Ar interface-name
d124 6
a129 4
Delete an address from the cache.
.It Cm delete Ar interface-name
Remove the interface named by
.Ar interface-name
d133 3
a135 3
.It Cm delspan Ar interface-name
Delete the interface named by
.Ar interface-name
d138 3
a140 1
Mark an interface so that packets are sent out of the interface
d148 3
a150 1
Mark an interface so that packets are not sent out of the interface
d162 1
a162 1
Set the
d212 1
a212 1
Mark an interface so that the source address of packets received from
d214 2
d219 1
a219 1
Mark an interface so that the source address of packets received from
d221 1
d279 1
a279 1
Set the
d310 3
a312 2
Display the active filtering rules in use on the given interface.
.It Cm static Ar interface-name address
d314 1
a314 1
.Ar interface-name .
@


1.64
log
@- merge first two synopses
- standard options list
- sync usage()

started by a diff from stevesk;
usage() help from dlg;
ok reyk;
@
text
@d1 1
a1 1
.\"	$OpenBSD: brconfig.8,v 1.63 2006/12/24 19:05:25 reyk Exp $
a78 6
.It Cm up
Start the bridge forwarding packets.
.It Cm down
Stop the bridge from forwarding packets.
.It Cm addr
Display the addresses that have been learned by the bridge.
d87 2
a88 9
.It Cm delete Ar interface-name
Remove the interface named by
.Ar interface-name
from the bridge.
Promiscuous mode is turned off for the interface when it is
removed from the bridge.
.It Cm del Ar interface-name
Alias for
.Cm delete .
d94 15
a108 26
.It Cm delspan Ar interface-name
Delete the interface named by
.Ar interface-name
from the list of span ports of the bridge.
.It Cm maxaddr Ar size
Set the address cache size to
.Ar size .
The default is 100 entries.
.It Cm timeout Ar time
Set the timeout, in seconds, for addresses in the cache to
.Ar time .
The default is 240 seconds.
If
.Ar time
is set to zero, then entries will not be expired.
.It Cm static Ar interface-name address
Add a static entry into the address cache pointing to
.Ar interface-name .
Static entries are never aged out of the cache or replaced, even if the address
is seen on a different interface.
.It Cm deladdr Ar address
Delete an address from the cache.
.It Cm flush
Remove all dynamically learned addresses from the cache.
.It Cm flushall
Remove all addresses from the cache including static addresses.
d116 15
d149 52
a209 3
.It Cm flushrule Ar interface
Remove all Ethernet MAC filtering rules from
.Ar interface .
d246 33
d298 5
d310 9
a318 87
.It Cm proto Ar value
Force the spanning tree protocol version.
The available values are
.Ar rstp
to operate in the default Rapid Spanning Tree (RSTP) mode
or
.Ar stp
to force operation in Spanning Tree (STP) mode with rapid transitions disabled.
.It Cm maxage Ar time
Set the time (in seconds) that a spanning tree protocol configuration is valid.
Defaults to 20 seconds, minimum of 6, maximum of 40.
.It Cm fwddelay Ar time
Set the time (in seconds) before an interface begins forwarding packets.
Defaults to 15 seconds, minimum of 4, maximum of 30.
.It Cm hellotime Ar time
Set the time (in seconds) between broadcasting spanning tree protocol
configuration packets.
Defaults to 2 seconds, minimum of 1, maximum of 2.
This option is only supported in STP mode with rapid transitions disabled;
see the
.Cm proto
command for setting the protocol version.
.It Cm holdcnt Ar time
Set the transmit hold count, which is the number of spanning tree protocol
packets transmitted before being rate limited.
Defaults to 6, minimum of 1, maximum of 10.
.It Cm priority Ar num
Set the spanning priority of this bridge to
.Ar num .
Defaults to 32768, minimum of 0, maximum of 61440.
.It Cm ifpriority Ar interface Ar num
Set the spanning tree priority of
.Ar interface
to
.Ar num .
Defaults to 128, minimum of 0, maximum of 240.
.It Cm ifcost Ar interface Ar num
Set the spanning tree path cost of
.Ar interface
to
.Ar num .
Defaults to 55, minimum of 1, maximum of 200000000 in RSTP mode,
and maximum of 65535 in STP mode.
.It Cm -ifcost Ar interface
Automatically calculate the spanning tree priority of
.Ar interface
based on the current link speed, interface status, and spanning tree mode.
This is the default for interfaces added to the bridge.
.It Cm edge Ar interface
Set the
.Ar interface
as a spanning tree edge port.
An edge port is a single connection to the network and cannot create
bridge loops.
This allows a straight transition to forwarding.
.It Cm -edge Ar interface
Disable edge port status on
.Ar interface .
.It Cm autoedge Ar interface
Automatically detect the spanning tree edge port status on
.Ar interface .
This is the default for interfaces added to the bridge.
.It Cm -autoedge Ar interface
Disable automatic spanning tree edge port detection on
.Ar interface .
.It Cm ptp Ar interface
Set the
.Ar interface
as a point to point link.
This is required for straight transitions to forwarding and
should be enabled for a full duplex link or a
.Xr trunk 4
with at least two physical links to the same network segment.
.It Cm -ptp Ar interface
Disable point to point link status on
.Ar interface .
This should be disabled for a half duplex link and for an interface
connected to a shared network segment,
like a hub or a wireless network.
.It Cm autoptp Ar interface
Automatically detect the point to point status on
.Ar interface
by checking the full duplex link status.
This is the default for interfaces added to the bridge.
.It Cm -autoptp Ar interface
Disable automatic point to point link detection on
.Ar interface .
@


1.63
log
@it is not permitted to change the "hellotime" is in RSTP, but in STP mode.

thanks to Edy (email at edylie dot net)
ok jmc@@

oh spanning tree, oh spanning tree, ...
@
text
@d1 1
a1 1
.\"	$OpenBSD: brconfig.8,v 1.62 2006/12/11 22:11:48 reyk Exp $
d36 1
a36 2
.Nm
.Ar bridge-name
d39 1
a39 1
.Ar bridge-name Cm rule No {
d42 1
a42 1
.Ar interface-name
d61 9
a69 15
In the first synopsis, invoking
.Nm
with no arguments, or with the
.Fl a
or
.Fl A
flag, will list the status of all bridges in the system.
The
.Fl A
flag will also list additional status information.
In the second, its command line consists
of the name of a bridge and a set of operations to be
performed on that bridge.
The commands are executed in the order they were specified.
If no command is specified in the second synopsis, the
d71 2
a72 3
will display full status information about the bridge.
With the third synopsis, rules for filtering Ethernet MAC addresses can
be added to a bridge.
d74 3
a76 1
The following parameters may be set with
@


1.62
log
@refer to the RSTP point to point option as "PTP" instead of "P2P".
P2P is commonly used in relation to peer to peer networks, PTP is used
in various protocols for layer 2 point to point links (ie., full
duplex ethernet links).

note that the newly added brconfig commands [-]p2p and [-]autop2p will
change to [-]ptp and [-]autoptp.

suggested by Andrew Thompson (thompsa@@freebsd.org)
@
text
@d1 1
a1 1
.\"	$OpenBSD: brconfig.8,v 1.61 2006/12/07 10:22:05 jmc Exp $
d256 4
@


1.61
log
@remove extra dot; from jared r r spiegel
@
text
@d1 1
a1 1
.\"	$OpenBSD: brconfig.8,v 1.60 2006/12/03 13:41:19 reyk Exp $
d299 1
a299 1
.It Cm p2p Ar interface
d307 1
a307 1
.It Cm -p2p Ar interface
d313 1
a313 1
.It Cm autop2p Ar interface
d318 1
a318 1
.It Cm -autop2p Ar interface
@


1.60
log
@Add Rapid Spanning Tree Protocol support (802.1d-2004) based on work
by Andrew Thompson (thompsa@@freebsd.org). The local changes include
adoption to our bridge code, reduced stack usage and many other bits.
If stp is enabled, RSTP will now be used by default.

Thanks for help from Andrew.

This code has been in snaps for while now, commit encouraged by deraadt@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: brconfig.8,v 1.59 2006/10/23 07:05:49 jmc Exp $
d494 1
a494 1
ike esp proto etherip from 4.3.2.1. to 1.2.3.4
@


1.59
log
@no need to use "keep state" and "flags S/SA" in pf rules,
now that it is the default;

ok henning mcbride camield (ftp-proxy bits) deraadt
@
text
@d1 1
a1 1
.\"	$OpenBSD: brconfig.8,v 1.58 2006/07/25 12:45:08 jmc Exp $
d35 1
a35 1
.Op Fl a
d66 2
d69 3
d78 1
a78 1
will display status information about the bridge.
d238 8
d248 1
a248 1
Defaults to 20 seconds, minimum of 1, maximum of 255.
d251 1
a251 1
Defaults to 15 seconds, minimum of 1, maximum of 255.
d255 5
a259 1
Defaults to 2 seconds, minimum of 1, maximum of 255.
d263 1
a263 1
Defaults to 32768, minimum of 0, maximum of 65535.
d269 1
a269 1
Defaults to 128, minimum of 0, maximum of 255.
d275 46
a320 1
Defaults to 55, minimum of 1, maximum of 65535.
d518 2
a519 2
The bridge has support for 802.1D Spanning Tree Protocol (STP), which can
be used to detect and remove loops in a network topology.
d528 11
d577 7
@


1.58
log
@tweak;
@
text
@d1 1
a1 1
.\"	$OpenBSD: brconfig.8,v 1.57 2006/07/25 07:04:55 djm Exp $
d337 1
a337 1
.Dl pass tagged boss keep state queue q_med
@


1.57
log
@-a flag is now optional; prompted by steven@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: brconfig.8,v 1.56 2006/05/28 08:06:55 jmc Exp $
d66 1
a66 1
flag will list the status of all bridges in the system.
@


1.56
log
@apropriate -> appropriate
@
text
@d1 1
a1 1
.\"	$OpenBSD: brconfig.8,v 1.55 2006/05/27 19:37:24 hshoexer Exp $
d35 1
a35 1
.Fl a
d62 3
a64 1
In the first synopsis, the
d66 1
a66 3
flag will cause
.Nm
to list the status of all bridges in the system.
@


1.55
log
@replace ipsecadm with ipsecctl. ok and requested by deraadt@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: brconfig.8,v 1.54 2006/05/26 04:02:59 deraadt Exp $
d407 1
a407 1
Apropriate
@


1.54
log
@let us not talk about ipsecadm and vpn anymore; ok reyk
@
text
@d1 1
a1 1
.\"	$OpenBSD: brconfig.8,v 1.53 2005/09/27 21:31:40 jmc Exp $
d191 2
a192 1
command.
d363 1
a363 1
.Xr ipsecctl 8
d391 35
a425 1
bridge:
d427 1
a427 4
# ipsecadm new esp -spi 4242 -dst 4.3.2.1 -src 1.2.3.4 -enc 3des \e
	-auth md5 -keyfile keyfile1 -authkeyfile authkeyfile1
# ipsecadm new esp -spi 4243 -dst 1.2.3.4 -src 4.3.2.1 -enc 3des \e
	-auth md5 -keyfile keyfile2 -authkeyfile authkeyfile2
d430 1
a430 2
Set up ingress flows so that traffic is allowed between the two bridges
for the above associations:
d432 1
a432 4
(on bridge1) # ipsecadm flow -dst 4.3.2.1 -out \e
	-transport etherip -require -addr 1.2.3.4/32 4.3.2.1/32
(on bridge2) # ipsecadm flow -dst 1.2.3.4 -out \e
	-transport etherip -require -addr 4.3.2.1/32 1.2.3.4/32
@


1.53
log
@add examples of explicitly bringing ethernet ifs up;

from stefek zaba;
ok deraadt@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: brconfig.8,v 1.52 2004/12/14 08:58:21 camield Exp $
d190 1
a190 1
.Xr ipsecadm 8
d362 1
a362 1
.Xr ipsecadm 8
d460 1
a460 1
.Xr ipsecadm 8 ,
@


1.52
log
@link0 drops IP multicast, and link1 non-IP multicast.  Not the other way
around.  ok fgsch@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: brconfig.8,v 1.51 2004/09/29 02:25:19 mcbride Exp $
d264 8
a271 4
Add the Ethernet interfaces rl0 and xl0 to the bridge bridge0, and
have the bridge start forwarding packets:
.Pp
.Dl # brconfig bridge0 add rl0 add xl0 up
@


1.51
log
@Note that the spanning tree protocol is disabled by default on interfaces
added to the bridge.

From Benjamin Ewy <bewy@@pneservices.com>
@
text
@d1 1
a1 1
.\"	$OpenBSD: brconfig.8,v 1.50 2004/05/04 18:50:48 jmc Exp $
d172 1
a172 1
Setting this flag stops all non-IP multicast packets from
d179 1
a179 1
Setting this flags stops all IP multicast packets from
@


1.50
log
@from jared yanovich:

- better macros in SYNOPSIS
- rewording
- document the `rules' command
- shift EXAMPLES to standard format
@
text
@d1 1
a1 1
.\"	$OpenBSD: brconfig.8,v 1.49 2004/02/27 12:32:05 markus Exp $
d231 1
@


1.49
log
@mention ifconfig create; update gif(4) examples; ok henning, deraadt, fries
@
text
@d1 1
a1 1
.\"	$OpenBSD: brconfig.8,v 1.48 2004/01/21 19:42:42 jmc Exp $
d34 1
a34 1
.Nm brconfig
d36 1
a36 1
.Nm brconfig
d39 1
a39 1
.Nm brconfig
d41 2
a42 2
.Ar block | pass No } {
.Ar in | out | in/out No } on
d44 3
a46 3
.Op Ar src address
.Op Ar dst address
.Op Ar tag tagname
d49 1
a49 1
.Nm brconfig
d72 1
a72 1
.Nm brconfig
d78 1
a78 1
.Nm brconfig :
d100 1
a100 1
.It Cm del
d126 1
a126 1
Static entries are never aged out of the cache or replaced if the address
d201 1
a201 1
and certificates, to impersonate the protected host(s).
d208 2
a209 2
Rules have a similar syntax to
.Xr pf 4 .
d211 1
a211 1
MAC address.
d223 2
d259 4
a262 4
.Bl -tag -width brconfig
.It Cm # ifconfig bridge0 create
Create a bridge pseudo network device.
.It Cm # brconfig bridge0 add rl0 add xl0 up
d264 4
a267 2
start the bridge forwarding packets.
.It Cm # brconfig bridge0
d269 22
a290 13
learned by the bridge.
.It Cm # brconfig bridge0 down
Stop bridge0 from forwarding packets.
.It Cm # brconfig bridge0 delete xl0
Remove the interface xl0 from the bridge bridge0.
.It Cm # brconfig bridge0 flush
Flush all dynamically learned addresses from the address cache.
.It Cm # brconfig bridge0 flushall
Remove all addresses, including static addresses, from the address cache.
.It Cm # brconfig bridge0 -learn xl0 static xl0 8:0:20:1e:2f:2b
.It Cm # brconfig bridge0 -discover xl0
The examples above mark the xl0 interface so that it will not learn
addresses and adds a static entry for the host 8:0:20:1e:2f:2b on the xl0
d297 8
a304 7
Also, no packets will be sent on xl0 segment by the bridge unless they are
broadcast packets or are for 8:0:20:1e:2f:2b.
.It Cm "# brconfig bridge0 rule pass in on fxp0 src 0:1:2:3:4:5 dst 5:4:3:2:1:0"
.It Cm "# brconfig bridge0 rule pass out on fxp0 src 5:4:3:2:1:0 dst 0:1:2:3:4:5"
.It Cm # brconfig bridge0 rule block in on fxp0
.It Cm # brconfig bridge0 rule block out on fxp0
The above commands will set up a filter so that 0:1:2:3:4:5 can send frames
d306 12
a317 5
fxp0 to 0:1:2:3:4:5.
All other traffic trying to go into and be sent from fxp0 will be blocked.
.It Cm "# brconfig bridge0 rule pass in on fxp0 src 9:8:7:6:5:4 tag boss"
.It Cm "# brconfig bridge0 rule pass out on fxp0 dst 9:8:7:6:5:4 tag boss"
These commands will tag packets from and to 9:8:7:6:5:4 on fxp0 so that
d320 1
a320 1
.Ar tagged
d322 8
a331 1
.El
d333 1
a333 1
The bridge can also be used to tunnel ethernet frames over IPv4 or
d352 1
a352 1
conjunction with IPsec, by specifying the appropriate IPsec flows
d360 1
a360 1
Otherwise, the ethernet frames will be sent in the clear between the
d371 1
a371 1
Add the encapsulation interface and internal ethernet interface to bridge
d373 2
a374 3
.Bd -literal
# brconfig bridge0 add gif0 add fxp1
.Ed
d377 1
a377 1
.Bd -literal
d386 5
a390 7
.Bd -literal
# ipsecadm new esp -spi 4242 -dst 4.3.2.1 -src 1.2.3.4 \e
	-enc 3des -auth md5 -keyfile keyfile1 -authkeyfile authkeyfile1
.Ed
.Bd -literal
# ipsecadm new esp -spi 4243 -dst 1.2.3.4 -src 4.3.2.1 \e
	-enc 3des -auth md5 -keyfile keyfile2 -authkeyfile authkeyfile2
d395 1
a395 1
.Bd -literal
d404 1
a404 1
.Bd -literal
a410 3
.Bd -literal
# brconfig bridge0 up
.Ed
d412 3
a414 1
The internal interface, ie. fxp1, on each bridge need not have an IP
d431 1
a431 1
.Nm brconfig
d441 1
a441 1
Span ports cannot be bridge members, instead the
d451 1
d453 1
d459 1
a459 1
.Nm brconfig
@


1.48
log
@fix wording; from Ross L Richardson (PR 3641);
while i'm here, `\\' -> `\e' and kill a nasty Pp;
@
text
@d1 1
a1 1
.\"	$OpenBSD: brconfig.8,v 1.47 2003/12/07 06:13:23 deraadt Exp $
d258 2
d349 1
a349 1
Configure the gif0 interface:
d351 4
a354 2
(on bridge 1) # ifconfig gif0 giftunnel 1.2.3.4 4.3.2.1
(on bridge 2) # ifconfig gif0 giftunnel 4.3.2.1 1.2.3.4
d372 1
a372 2
	-transport etherip -require \e
	-addr 1.2.3.4 255.255.255.255 4.3.2.1 255.255.255.255
d374 1
a374 2
	-transport etherip -require \e
	-addr 4.3.2.1 255.255.255.255 1.2.3.4 255.255.255.255
@


1.47
log
@typo; lists-openbsd@@2ls4agd.net
@
text
@d1 1
a1 1
.\"	$OpenBSD: brconfig.8,v 1.46 2003/06/27 13:10:51 henning Exp $
d356 1
a356 1
# ipsecadm new esp -spi 4242 -dst 4.3.2.1 -src 1.2.3.4 \\
a358 1
.Pp
d360 1
a360 1
# ipsecadm new esp -spi 4243 -dst 1.2.3.4 -src 4.3.2.1 \\
d367 2
a368 2
(on bridge1) # ipsecadm flow -dst 4.3.2.1 -out \\
	-transport etherip -require \\
d370 2
a371 2
(on bridge2) # ipsecadm flow -dst 1.2.3.4 -out \\
	-transport etherip -require \\
d391 1
a391 1
Note:  It is possible to put all the following commands in the
@


1.46
log
@add an example for tagging
help and ok jmc@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: brconfig.8,v 1.45 2003/06/25 09:44:55 henning Exp $
d289 1
a289 1
through fxp0 only to 5:4:3:2:1, and 5:4:3:2:1:0 can return frames through
@


1.45
log
@allow bridge filter rules to specify a tag.
if a packet matches such a rule it is tagged accordingly and pf can
filter based on that tag.
this allows, for example, bridge to be used as classifier for pf, and thus
gives all the power of pf based on mac address filters.

please note that currently the bridge filters only apply to packets
which are not destined for the local host.

ok deraadt@@ jason@@ dhartmei@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: brconfig.8,v 1.44 2003/06/03 13:16:07 jmc Exp $
d292 9
@


1.44
log
@- section reorder
- some mdoc fixes
@
text
@d1 1
a1 1
.\"	$OpenBSD: brconfig.8,v 1.43 2003/06/02 18:44:35 jason Exp $
d46 1
d212 3
d217 1
a217 1
of the rule.
@


1.43
log
@nuke clause 3 & 4
@
text
@d1 1
a1 1
.\"	$OpenBSD: brconfig.8,v 1.42 2003/05/10 20:56:36 jmc Exp $
d289 1
a289 1
.Sh "IPSEC BRIDGE"
d417 5
a430 5
.Sh HISTORY
The
.Nm brconfig
command first appeared in
.Ox 2.5 .
@


1.42
log
@- setup -> set up
- .Xr to itself -> .Nm
@
text
@d1 1
a1 1
.\"	$OpenBSD: brconfig.8,v 1.41 2003/03/07 06:30:38 david Exp $
a13 5
.\" 3. All advertising materials mentioning features or use of this software
.\"    must display the following acknowledgement:
.\"	This product includes software developed by Jason L. Wright
.\" 4. The name of the author may not be used to endorse or promote products
.\"    derived from this software without specific prior written permission.
@


1.41
log
@spelling errors/typos
ok jmc@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: brconfig.8,v 1.40 2002/12/09 10:11:53 markus Exp $
d357 1
a357 1
Setup ingress flows so that traffic is allowed between the two bridges
d424 1
a424 1
.Xr brconfig 8
@


1.40
log
@allow setting of ifcost with brconfig.  enables selection of preferred
port/path to root bridge among several LANs.   unlike ifpriority, which
allows you to select designated port if serveral interfaces belong
to the same LAN;  ok jason@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: brconfig.8,v 1.39 2002/12/06 16:28:48 markus Exp $
d212 1
a212 1
Rules have a similiar syntax to
@


1.39
log
@fix linebreak in example; ok ho@@, jason@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: brconfig.8,v 1.38 2002/09/06 21:36:52 deraadt Exp $
d250 6
@


1.38
log
@remove Xr to photuris
@
text
@d1 1
a1 1
.\"	$OpenBSD: brconfig.8,v 1.37 2002/07/12 17:49:02 jason Exp $
d342 1
a342 1
# ipsecadm new esp -spi 4242 -dst 4.3.2.1 -src 1.2.3.4 \e\
d347 1
a347 1
# ipsecadm new esp -spi 4243 -dst 1.2.3.4 -src 4.3.2.1 \e\
d354 2
a355 2
(on bridge1) # ipsecadm flow -dst 4.3.2.1 -out \e\
	-transport etherip -require \e\
d357 2
a358 2
(on bridge2) # ipsecadm flow -dst 1.2.3.4 -out \e\
	-transport etherip -require \e\
@


1.37
log
@Mention that an interface can be a part of at most one bridge.
@
text
@d1 1
a1 1
.\"	$OpenBSD: brconfig.8,v 1.36 2002/06/15 02:27:03 angelos Exp $
a199 2
or
.Xr photurisd 8
d415 1
a415 2
.Xr isakmpd 8 ,
.Xr photurisd 8
@


1.36
log
@Document transparent IPsec.
@
text
@d1 1
a1 1
.\"	$OpenBSD: brconfig.8,v 1.35 2002/06/09 08:13:05 todd Exp $
d97 1
@


1.35
log
@rm trailing whitespace
@
text
@d1 1
a1 1
.\"	$OpenBSD: brconfig.8,v 1.34 2002/01/17 15:55:30 espie Exp $
d188 23
d415 3
a417 1
.Xr ipsecadm 8
@


1.34
log
@Typo, from Mns Nilsson <mansaxel@@sunet.se>
@
text
@d1 1
a1 1
.\"	$OpenBSD: brconfig.8,v 1.33 2001/12/21 19:55:09 angelos Exp $
d320 1
a320 1
# ipsecadm new esp -spi 4242 -dst 4.3.2.1 -src 1.2.3.4 \e\ 
d325 1
a325 1
# ipsecadm new esp -spi 4243 -dst 1.2.3.4 -src 4.3.2.1 \e\ 
d332 2
a333 2
(on bridge1) # ipsecadm flow -dst 4.3.2.1 -out \e\ 
	-transport etherip -require \e\ 
d335 2
a336 2
(on bridge2) # ipsecadm flow -dst 1.2.3.4 -out \e\ 
	-transport etherip -require \e\ 
@


1.33
log
@Forwarding loops no longer a problem.
@
text
@d1 1
a1 1
.\"	$OpenBSD: brconfig.8,v 1.32 2001/12/21 11:41:50 mpech Exp $
d191 1
a191 1
.Xr ipf 4 .
@


1.32
log
@Initial patch for a new mdoc issue.
Powered by @@mantoya:
o) kill extra line in the end of file;
o) kill extra space in the end of line;
o) replace blank lines with .Pp;

millert@@ ok
@
text
@d1 1
a1 1
.\"	$OpenBSD: brconfig.8,v 1.31 2001/12/15 08:40:56 jason Exp $
a415 6
.Pp
The packets generated by the
.Xr gif 4
interfaces must not cause transmission over one of the "real" ethernet
member interfaces of the bridge, or else an infinite packet forwarding loop
will occur.
@


1.31
log
@add support for creating span ports so that one can snoop a bridge
from another interface/machine/network.
@
text
@d1 1
a1 1
.\"	$OpenBSD: brconfig.8,v 1.30 2001/12/13 20:16:48 mpech Exp $
d70 1
a70 2
to 
list the status of all bridges in the system.
@


1.30
log
@o) start new sentence on a new line;
o) wrap long lines;
o) fix bogus .Xr usage;
o) we don't like blank lines;
o) always close .Bl tags;
o) OpenBSD -> .Ox;
o) don't like .Pp before .Ss;

millert@@ ok;
@
text
@d1 1
a1 1
.\"	$OpenBSD: brconfig.8,v 1.29 2001/12/05 19:55:34 jason Exp $
d3 1
a3 1
.\" Copyright (c) 1999, 2000 Jason L. Wright (jason@@thought.net)
d107 9
d376 10
@


1.29
log
@document -a better
@
text
@d1 1
a1 1
.\"	$OpenBSD: brconfig.8,v 1.28 2001/12/05 09:57:20 deraadt Exp $
d262 2
a263 1
interface.  In addition to adding Ethernet interfaces,
d266 2
a267 1
interfaces are added as members of the bridge.  Ethernet frames sent
d274 4
a277 3
frame as if it had originated on a normal Ethernet interface.  This
effectively allows a layer-2 network to be extended from one point to
another, possibly through the Internet. This mechanism may be used in
d279 2
a280 1
between the two bridges. To only protect the bridge traffic between
d355 2
a356 1
be used to detect and remove loops in a network topology.  Using the
@


1.28
log
@documentation nits
@
text
@d1 1
a1 1
.\"	$OpenBSD: brconfig.8,v 1.27 2001/08/20 05:57:55 mpech Exp $
d66 6
a71 2
In the first synopsis, the command
will list the status of all bridges in the system.
@


1.27
log
@Powered by @@mantoya.
o) fix bogus .Xr usage;

millert@@ ok.
@
text
@d1 1
a1 1
.\"	$OpenBSD: brconfig.8,v 1.26 2001/08/02 18:37:34 mpech Exp $
d219 1
a219 1
.It Cm brconfig bridge0 add rl0 add xl0 up
d222 1
a222 1
.It Cm brconfig bridge0
d225 1
a225 1
.It Cm brconfig bridge0 down
d227 1
a227 1
.It Cm brconfig bridge0 delete xl0
d229 1
a229 1
.It Cm brconfig bridge0 flush
d231 1
a231 1
.It Cm brconfig bridge0 flushall
d233 2
a234 2
.It Cm brconfig bridge0 -learn xl0 static xl0 8:0:20:1e:2f:2b
.It Cm brconfig bridge0 -discover xl0
d245 4
a248 4
.It Cm "brconfig bridge0 rule pass in on fxp0 src 0:1:2:3:4:5 dst 5:4:3:2:1:0"
.It Cm "brconfig bridge0 rule pass out on fxp0 src 5:4:3:2:1:0 dst 0:1:2:3:4:5"
.It Cm brconfig bridge0 rule block in on fxp0
.It Cm brconfig bridge0 rule block out on fxp0
@


1.26
log
@o) .Sh AUTHOR -> .Sh AUTHORS;
o) .Sh EXAMPLE -> .Sh EXAMPLES;
o) Delete .Sh OPTIONS. Text moved to .Sh DESCRIPTION;

millert@@ ok
@
text
@d1 1
a1 1
.\"	$OpenBSD: brconfig.8,v 1.25 2001/07/18 22:52:07 kjell Exp $
d58 1
a58 1
.Xr gif 4 ),
@


1.25
log
@try to clarify a double negative. ok jason@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: brconfig.8,v 1.24 2001/05/14 02:43:12 jason Exp $
d366 1
a366 1
.Sh AUTHOR
@


1.24
log
@Xr bridgename.if and hostname.if in section 5, not 8; spotted by James Cronin <james@@unfortu.net>
@
text
@d1 1
a1 1
.\"	$OpenBSD: brconfig.8,v 1.23 2001/03/26 05:37:28 aaron Exp $
d126 3
a128 3
Mark an interface so that no packets that are not IPv4, IPv6, ARP, or Reverse
ARP are accepted from it or are forwarded to it from other bridge member
interfaces.
@


1.23
log
@Typo: paramters -> parameters
@
text
@d1 1
a1 1
.\"	$OpenBSD: brconfig.8,v 1.22 2001/01/04 22:13:01 todd Exp $
d341 1
a341 1
.Xr hostname.if 8
d343 1
a343 1
.Xr bridgename.if 8
@


1.22
log
@spelling
@
text
@d1 1
a1 1
.\"	$OpenBSD: brconfig.8,v 1.21 2000/12/31 00:08:14 angelos Exp $
d78 1
a78 1
The following paramters may be set with
@


1.21
log
@Update example and text.
@
text
@d1 1
a1 1
.\"	$OpenBSD: brconfig.8,v 1.20 2000/12/28 03:40:20 jason Exp $
d281 1
a281 1
For example, given two physically seperate Ethernet networks, the bridge can
@


1.20
log
@make it obvious the key/authkey pairs can be distinct; Gordon Greene.
@
text
@d1 1
a1 1
.\"	$OpenBSD: brconfig.8,v 1.19 2000/12/12 03:41:21 jason Exp $
d58 1
a58 1
.Xr enc 4 ),
d255 4
a258 3
The bridge can also be used to tunnel ethernet frames through
.Xr ipsec 4
encapsulated interface.  In addition to adding Ethernet interfaces,
d260 1
a260 1
.Xr enc 4 ,
d263 2
a264 2
.Xr enc 4
interfaces are encrypted and/or authenticated and encapsulated in
d267 13
a279 5
decapsulates the datagram, decrypts and verifies the payload, and
then processes the resulting Ethernet frame as if it had originated
on a normal Ethernet interface.  This effectively allows a layer-2 network
to be extended from one point to another, possibly through the Internet,
without the traffic passing through in the clear.
d292 7
a298 1
# brconfig bridge0 add enc1 add fxp1
d316 4
a319 1
(on bridge1) # ipsecadm flow -dst 1.2.3.4 -in \e\ 
a321 12
(on bridge2) # ipsecadm flow -dst 4.3.2.1 -in \e\ 
	-transport etherip -require \e\ 
	-addr 1.2.3.4 255.255.255.255 4.3.2.1 255.255.255.255
.Ed
.Pp
Add the source and destination SAs to the encapsulation interface, and
start allowing traffic on the interface:
.Bd -literal
(on bridge1) # ifconfig enc1 dstsa 4.3.2.1/4242/esp
(on bridge1) # ifconfig enc1 srcsa 1.2.3.4/4243/esp
(on bridge2) # ifconfig enc1 dstsa 1.2.3.4/4243/esp
(on bridge2) # ifconfig enc1 srcsa 4.3.2.1/4242/esp
d328 1
a328 1
# ifconfig enc1 up
d356 1
a356 1
.Xr enc 4
d360 1
a360 1
.Xr enc 4 ,
d390 3
a392 3
The SAs used on the
.Xr enc 4
interfaces should not cause transmission over one of the "real" ethernet
@


1.19
log
@Add support for 802.1D spanning tree protocol.
NOTE: this requires recompiling brconfig with updated include files.
@
text
@d1 1
a1 1
.\"	$OpenBSD: brconfig.8,v 1.18 2000/11/06 01:08:06 aaron Exp $
d290 1
a290 1
	-enc 3des -auth md5 -keyfile keyfile -authkeyfile authkeyfile
d295 1
a295 1
	-enc 3des -auth md5 -keyfile keyfile -authkeyfile authkeyfile
@


1.18
log
@Correct an Xr: ipsecadm(4) -> ipsecadm(8); kent@@unit.liu.se
@
text
@d1 1
a1 1
.\"	$OpenBSD: brconfig.8,v 1.17 2000/10/28 16:17:26 aaron Exp $
d190 26
d339 13
@


1.17
log
@Reference enc(4) properly; nate@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: brconfig.8,v 1.16 2000/10/26 18:32:29 jason Exp $
d320 1
a320 1
.Xr ipsecadm 4
@


1.16
log
@update and fix ipsecadm usage example
@
text
@d1 1
a1 1
.\"	$OpenBSD: brconfig.8,v 1.15 2000/10/24 18:39:34 provos Exp $
d58 1
a58 1
.Xr 4 ),
@


1.15
log
@typo
@
text
@d1 1
a1 1
.\"	$OpenBSD: brconfig.8,v 1.14 2000/10/24 17:38:36 beck Exp $
d264 1
a264 1
	-enc 3des -auth md5 -keyfile keyfile -authkey authkeyfile
d269 1
a269 1
	-enc 3des -auth md5 -keyfile keyfile -authkey authkeyfile
d275 2
a276 2
(on bridge1) # ipsecadm flow -dst 1.2.3.4 -spi 4243 -ingress \e\ 
	-transport etherip \e\ 
d278 2
a279 2
(on bridge2) # ipsecadm flow -dst 4.3.2.1 -spi 4242 -ingress \e\ 
	-transport etherip \e\ 
@


1.14
log
@Fix example for ipsec bridge to use fxp1 throughout like it says
it does, instead of switching to fxp0. - spotted and reported
by Lars Josephson <hunter@@dina.kvl.dk>.
@
text
@d1 1
a1 1
.\"	$OpenBSD: brconfig.8,v 1.13 2000/09/06 07:38:16 mickey Exp $
d308 1
a308 1
Note:  It is possible to put all the following commands the
@


1.13
log
@it was ment to be -link1 before cut and paste had been executed
@
text
@d1 1
a1 1
.\"	$OpenBSD: brconfig.8,v 1.12 2000/06/20 20:22:12 jason Exp $
d295 1
a295 1
# ifconfig fxp0 up
d305 1
a305 1
The internal interface, ie. fxp0, on each bridge need not have an IP
@


1.12
log
@more info on what a bridge is (from bridge(4)).
@
text
@d1 1
a1 1
.\"	$OpenBSD: brconfig.8,v 1.11 2000/05/02 18:51:04 jason Exp $
d172 1
a172 1
.It Cm -link0
@


1.11
log
@note about SAs on enc interface
@
text
@d1 1
a1 1
.\"	$OpenBSD: brconfig.8,v 1.10 2000/05/02 18:43:09 jason Exp $
d56 9
@


1.10
log
@ipsec bridge documentation
@
text
@d1 1
a1 1
.\"	$OpenBSD: brconfig.8,v 1.9 2000/03/26 17:36:33 jason Exp $
a303 1
.Pp
d335 6
@


1.9
log
@fix rule example
@
text
@d1 1
a1 1
.\"	$OpenBSD: brconfig.8,v 1.8 2000/03/19 00:35:10 aaron Exp $
d219 86
d307 3
d311 2
a312 1
.Xr ifconfig 8
@


1.8
log
@Bring the format closer to ifconfig(8).
@
text
@d1 1
a1 1
.\"	$OpenBSD: brconfig.8,v 1.7 2000/03/18 22:55:54 aaron Exp $
d210 1
a210 1
.It Cm "brconfig bridge0 rule pass in on fxp0 8:0:1:2:3:4:5 dst 5:4:3:2:1:0"
@


1.7
log
@Remove hard sentence breaks, and some other cleanup along the way.
@
text
@d1 1
a1 1
.\"	$OpenBSD: brconfig.8,v 1.6 2000/02/11 04:22:27 jason Exp $
d43 1
a43 24
.Op Ar up
.Op Ar down
.Op Ar addr
.Op Ar add interface-name
.Op Ar delete interface-name
.Op Ar maxaddr size
.Op Ar timeout time
.Op Ar static interface-name address
.Op Ar deladdr address
.Op Ar flush
.Op Ar flushall
.Op Ar blocknonip interface-name
.Op Ar -blocknonip interface-name
.Op Ar discover interface-name
.Op Ar -discover interface-name
.Op Ar learn interface-name
.Op Ar -learn interface-name
.Op Ar rulefile file-name
.Op Ar flushrule interface-name
.Op Ar link0
.Op Ar link1
.Op Ar -link0
.Op Ar -link1
.Op Ar ...
d45 3
a47 1
.Ar bridge-name rule {block|pass} {in|out|in/out} on
d56 1
d69 2
a70 1
The available commands are:
d72 1
a72 1
.It Ar up
d74 1
a74 1
.It Ar down
d76 1
a76 1
.It Ar addr
d78 1
a78 1
.It Ar add interface-name
d85 1
a85 1
.It Ar delete interface-name
d91 4
a94 3
.It Ar del
Alias for `delete'.
.It Ar maxaddr size
d96 1
a96 1
.Cm size .
d98 1
a98 1
.It Ar timeout time
d100 1
a100 1
.Cm time .
d103 1
a103 1
.Cm time
d105 1
a105 1
.It Ar static interface-name address
d107 1
a107 1
.Cm interface-name .
d110 1
a110 1
.It Ar deladdr address
d112 1
a112 1
.It Ar flush
d114 1
a114 1
.It Ar flushall
d116 1
a116 1
.It Ar blocknonip interface
d120 1
a120 1
.It Ar -blocknonip interface
d122 2
a123 2
.Cm interface .
.It Ar discover interface
d131 1
a131 1
.It Ar -discover interface
d141 1
a141 1
.It Ar learn interface
d143 1
a143 1
.Cm interface
d146 1
a146 1
.It Ar -learn interface
d148 1
a148 1
.Cm interface
d150 1
a150 1
.It Ar flushrule interface
d152 2
a153 2
.Cm interface
.It Ar link0
d156 1
a156 1
.It Ar -link0
d158 1
a158 1
.Ar link0
d160 1
a160 1
.It Ar link1
d163 1
a163 1
.It Ar -link0
d165 1
a165 1
.Ar link1
d167 1
a167 1
.It Ar rule [rulespec]
d178 1
a178 1
.It Ar rulefile filename
d180 1
a180 1
.Cm filename .
@


1.6
log
@Use .An and Aq constructs
@
text
@d1 1
a1 1
.\"	$OpenBSD: brconfig.8,v 1.5 2000/01/25 22:06:26 jason Exp $
d40 1
a40 1
.Ar -a
d76 2
a77 1
user control of these bridges.  In the first synopsis, the command
d81 3
a83 3
performed on that bridge.  The commands are executed in
the order they were specified.  If no command is specified in
the second synopsis, the
d151 2
a152 1
if the destination port of the packet is unknown.  Turning this flag
d190 2
a191 1
MAC address.  Rules are processed in the order in which they were added
d193 2
a194 1
of the rule.  If no source or destination address is specified, the
d234 2
a235 2
fxp0 to 0:1:2:3:4:5.  All other traffic trying to go into and be sent from
fxp0 will be blocked.
a240 4
.Sh HISTORY
.Nm brconfig
first appeared in
.Ox 2.5 .
d250 5
d260 1
a260 1
.Xr tl 4 ),
d262 2
a263 1
cache useless).  Most other chipsets work fine though.
@


1.5
log
@add ethernet MAC filtering capability
also includes split of bridgeintr() with some optimizations for quicker
frame handling
@
text
@d1 1
a1 1
.\"	$OpenBSD: brconfig.8,v 1.4 2000/01/10 22:14:25 angelos Exp $
d246 4
a249 3
kernel interface were written by Jason L. Wright <jason@@thought.net> as
part of an undergraduate independent study
at the University of North Carolina at Greensboro.
@


1.4
log
@blocknonip flag -- use it on a per-interface basis to not accept from
and not forward to said interface traffic that's not
IPv4/IPv6/ARP/ReverseARP
@
text
@d1 1
a1 1
.\"	$OpenBSD: brconfig.8,v 1.3 2000/01/01 19:14:23 deraadt Exp $
d3 1
a3 1
.\" Copyright (c) 1999 Jason L. Wright (jason@@thought.net)
d60 2
d67 5
d85 2
d166 3
d183 12
d224 8
d251 2
a252 3
not work in a bridge configuration.  Some, like the Lite-On PNIC (see
.Xr pn 4 ),
have serious flaws when running in promiscuous mode, and others, like the
d255 2
a256 2
receive their own transmissions, which makes the address learning code
ineffective.  Most other chipsets work fine though.
@


1.3
log
@Xr bridgename.if(5)
@
text
@d1 1
a1 1
.\"	$OpenBSD: brconfig.8,v 1.2 1999/09/23 04:12:02 alex Exp $
d54 2
d124 7
@


1.2
log
@Typo fixes.
@
text
@d1 1
a1 1
.\"	$OpenBSD: brconfig.8,v 1.1 1999/09/01 03:28:01 deraadt Exp $
d194 1
@


1.1
log
@move brconfig to /sbin, where it belongs
@
text
@d1 1
a1 1
.\"	$OpenBSD: brconfig.8,v 1.14 1999/07/24 22:46:10 deraadt Exp $
d188 1
a188 1
will not be propogated to the rest of the network.
@

