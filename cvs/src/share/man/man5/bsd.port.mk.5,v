head	1.466;
access;
symbols
	OPENBSD_6_1:1.456.0.4
	OPENBSD_6_1_BASE:1.456
	OPENBSD_6_0:1.436.0.2
	OPENBSD_6_0_BASE:1.436
	OPENBSD_5_9:1.432.0.2
	OPENBSD_5_9_BASE:1.432
	OPENBSD_5_8:1.418.0.4
	OPENBSD_5_8_BASE:1.418
	OPENBSD_5_7:1.413.0.2
	OPENBSD_5_7_BASE:1.413
	OPENBSD_5_6:1.402.0.4
	OPENBSD_5_6_BASE:1.402
	OPENBSD_5_5:1.395.0.4
	OPENBSD_5_5_BASE:1.395
	OPENBSD_5_4:1.382.0.2
	OPENBSD_5_4_BASE:1.382
	OPENBSD_5_3:1.364.0.2
	OPENBSD_5_3_BASE:1.364
	OPENBSD_5_2:1.344.0.2
	OPENBSD_5_2_BASE:1.344
	OPENBSD_5_1_BASE:1.328
	OPENBSD_5_1:1.328.0.2
	OPENBSD_5_0:1.284.0.2
	OPENBSD_5_0_BASE:1.284
	OPENBSD_4_9:1.276.0.2
	OPENBSD_4_9_BASE:1.276
	OPENBSD_4_8:1.260.0.2
	OPENBSD_4_8_BASE:1.260
	OPENBSD_4_7:1.239.0.2
	OPENBSD_4_7_BASE:1.239
	OPENBSD_4_6:1.232.0.4
	OPENBSD_4_6_BASE:1.232
	OPENBSD_4_5:1.226.0.2
	OPENBSD_4_5_BASE:1.226
	OPENBSD_4_4:1.222.0.2
	OPENBSD_4_4_BASE:1.222
	OPENBSD_4_3:1.208.0.2
	OPENBSD_4_3_BASE:1.208
	OPENBSD_4_2:1.201.0.2
	OPENBSD_4_2_BASE:1.201
	OPENBSD_4_1:1.190.0.2
	OPENBSD_4_1_BASE:1.190
	OPENBSD_4_0:1.174.0.2
	OPENBSD_4_0_BASE:1.174
	OPENBSD_3_9:1.172.0.2
	OPENBSD_3_9_BASE:1.172
	OPENBSD_3_8:1.162.0.2
	OPENBSD_3_8_BASE:1.162
	OPENBSD_3_7:1.159.0.2
	OPENBSD_3_7_BASE:1.159
	OPENBSD_3_6:1.146.0.2
	OPENBSD_3_6_BASE:1.146
	OPENBSD_3_5:1.134.0.2
	OPENBSD_3_5_BASE:1.134
	OPENBSD_3_4:1.123.0.2
	OPENBSD_3_4_BASE:1.123
	OPENBSD_3_3:1.87.0.2
	OPENBSD_3_3_BASE:1.87
	OPENBSD_3_2:1.74.0.2
	OPENBSD_3_2_BASE:1.74
	OPENBSD_3_1:1.65.0.2
	OPENBSD_3_1_BASE:1.65
	OPENBSD_3_0:1.55.0.2
	OPENBSD_3_0_BASE:1.55
	OPENBSD_2_9:1.35.0.2
	OPENBSD_2_9_BASE:1.35
	OPENBSD_2_8:1.17.0.2
	OPENBSD_2_8_BASE:1.17;
locks; strict;
comment	@.\" @;


1.466
date	2017.08.22.10.40.27;	author espie;	state Exp;
branches;
next	1.465;
commitid	Dh2l8TipyaKT7Iqd;

1.465
date	2017.07.12.22.52.54;	author sthen;	state Exp;
branches;
next	1.464;
commitid	aWJp30GnVkAHDlUS;

1.464
date	2017.06.28.10.34.10;	author espie;	state Exp;
branches;
next	1.463;
commitid	OOQeYqIIj3w6WU0Y;

1.463
date	2017.06.28.10.33.08;	author espie;	state Exp;
branches;
next	1.462;
commitid	WUmdyKVnR4t11PSw;

1.462
date	2017.06.10.10.13.10;	author espie;	state Exp;
branches;
next	1.461;
commitid	UCSrqxAe4g34KxeU;

1.461
date	2017.06.10.10.12.06;	author espie;	state Exp;
branches;
next	1.460;
commitid	sXXjQ4EacxbNdaRz;

1.460
date	2017.06.05.21.54.07;	author sthen;	state Exp;
branches;
next	1.459;
commitid	xMirBZlGcMFZO9oz;

1.459
date	2017.05.31.10.06.02;	author jmc;	state Exp;
branches;
next	1.458;
commitid	7B1b2OTuneeDvb6L;

1.458
date	2017.05.31.08.12.27;	author espie;	state Exp;
branches;
next	1.457;
commitid	8mKXm4SMwEAZYskO;

1.457
date	2017.04.11.20.40.33;	author sthen;	state Exp;
branches;
next	1.456;
commitid	R1O0uNcNqq9EFdyL;

1.456
date	2017.03.01.10.41.40;	author espie;	state Exp;
branches;
next	1.455;
commitid	zK0PXefUwfXu6f86;

1.455
date	2017.02.20.14.29.55;	author espie;	state Exp;
branches;
next	1.454;
commitid	2KROWdWpTWMwFvc7;

1.454
date	2017.02.20.14.21.45;	author espie;	state Exp;
branches;
next	1.453;
commitid	nJOntkQhvZu1oOxz;

1.453
date	2017.02.19.16.12.28;	author espie;	state Exp;
branches;
next	1.452;
commitid	BFzi3oRBp1XhlQBW;

1.452
date	2017.02.19.10.55.35;	author espie;	state Exp;
branches;
next	1.451;
commitid	hHPo1GWQxFiqg6yM;

1.451
date	2017.02.19.10.07.21;	author espie;	state Exp;
branches;
next	1.450;
commitid	GriXTGebkJJz3Amc;

1.450
date	2017.02.18.15.13.00;	author espie;	state Exp;
branches;
next	1.449;
commitid	DL3r1SplZAhYdGhL;

1.449
date	2017.02.18.15.05.56;	author espie;	state Exp;
branches;
next	1.448;
commitid	N7lUrBl1WrciCFNY;

1.448
date	2017.02.18.14.36.24;	author espie;	state Exp;
branches;
next	1.447;
commitid	hkubkMuy4ocrfLry;

1.447
date	2017.02.18.14.29.23;	author espie;	state Exp;
branches;
next	1.446;
commitid	JEAsSnaHzcBFhC8H;

1.446
date	2017.01.29.21.37.17;	author jmc;	state Exp;
branches;
next	1.445;
commitid	LHIaZUunW0tCVnMl;

1.445
date	2017.01.29.20.53.20;	author danj;	state Exp;
branches;
next	1.444;
commitid	1i5KHjfGcbOOicfc;

1.444
date	2017.01.23.11.13.11;	author zhuk;	state Exp;
branches;
next	1.443;
commitid	SlmjbeREugZgSiL9;

1.443
date	2017.01.23.10.49.12;	author phessler;	state Exp;
branches;
next	1.442;
commitid	wzV654sjgtFtLIrc;

1.442
date	2017.01.01.01.08.11;	author tb;	state Exp;
branches;
next	1.441;
commitid	wnNuSAo7K6MoaRxC;

1.441
date	2016.11.03.17.13.40;	author danj;	state Exp;
branches;
next	1.440;
commitid	XEnomoW3ddV0rEtr;

1.440
date	2016.09.28.19.34.54;	author danj;	state Exp;
branches;
next	1.439;
commitid	PoDcqOLUOhJaNTC2;

1.439
date	2016.09.06.10.32.51;	author espie;	state Exp;
branches;
next	1.438;
commitid	3Nftxoo4H4CfePb0;

1.438
date	2016.08.18.12.29.53;	author sthen;	state Exp;
branches;
next	1.437;
commitid	vKjZZ5VlcI0cCapz;

1.437
date	2016.08.01.00.48.22;	author espie;	state Exp;
branches;
next	1.436;
commitid	7dPBn9Nn8009eFcr;

1.436
date	2016.05.17.13.42.28;	author espie;	state Exp;
branches;
next	1.435;
commitid	sPVxqICslzNF4EU5;

1.435
date	2016.04.25.19.24.42;	author tedu;	state Exp;
branches;
next	1.434;
commitid	nrtZxsobBLCi86f5;

1.434
date	2016.03.22.16.02.02;	author naddy;	state Exp;
branches;
next	1.433;
commitid	YFdh84WoO5s4tSEK;

1.433
date	2016.03.11.20.40.23;	author sthen;	state Exp;
branches;
next	1.432;
commitid	BVghdPI5SRSY5nAR;

1.432
date	2016.01.02.08.29.26;	author jmc;	state Exp;
branches;
next	1.431;
commitid	u1vLmsKQESavNALy;

1.431
date	2016.01.01.18.38.19;	author jasper;	state Exp;
branches;
next	1.430;
commitid	6CsvQMo1MdA6RGLy;

1.430
date	2015.12.28.23.30.59;	author mmcc;	state Exp;
branches;
next	1.429;
commitid	wAlWn3j7G7HdPgXQ;

1.429
date	2015.12.06.22.33.47;	author mmcc;	state Exp;
branches;
next	1.428;
commitid	TK7OxVlAZTTxGgKJ;

1.428
date	2015.11.23.10.01.45;	author jmc;	state Exp;
branches;
next	1.427;
commitid	Dvo97MsccFko48ag;

1.427
date	2015.10.12.10.27.22;	author sthen;	state Exp;
branches;
next	1.426;
commitid	ZVLsRj0lTzjbp5UF;

1.426
date	2015.09.23.01.38.36;	author schwarze;	state Exp;
branches;
next	1.425;
commitid	A5bkOTihbY3iX2e2;

1.425
date	2015.09.23.01.29.47;	author schwarze;	state Exp;
branches;
next	1.424;
commitid	vxjS161fiPO0F3xP;

1.424
date	2015.09.23.01.11.13;	author schwarze;	state Exp;
branches;
next	1.423;
commitid	vsGAfUK2RNph2US5;

1.423
date	2015.09.22.22.27.28;	author schwarze;	state Exp;
branches;
next	1.422;
commitid	JYJrUqGnRbnNgeuq;

1.422
date	2015.09.21.09.06.33;	author schwarze;	state Exp;
branches;
next	1.421;
commitid	r6eHfBwYqWXW6bOv;

1.421
date	2015.09.20.18.20.37;	author jmc;	state Exp;
branches;
next	1.420;
commitid	08QSkiFivvpmnpNR;

1.420
date	2015.09.16.19.59.57;	author schwarze;	state Exp;
branches;
next	1.419;
commitid	lKIXQlryTmCY8rSr;

1.419
date	2015.09.13.10.05.22;	author zhuk;	state Exp;
branches;
next	1.418;
commitid	EJbkj79rmmxHD9NN;

1.418
date	2015.07.30.08.03.50;	author jmc;	state Exp;
branches;
next	1.417;
commitid	jvvdSOl8gxNBg4aJ;

1.417
date	2015.07.04.15.07.54;	author espie;	state Exp;
branches;
next	1.416;
commitid	9ROBkUifNdSaCphp;

1.416
date	2015.04.05.13.33.06;	author sthen;	state Exp;
branches;
next	1.415;
commitid	1jDSMJEEL7dJ6Iag;

1.415
date	2015.04.03.10.19.22;	author ajacoutot;	state Exp;
branches;
next	1.414;
commitid	i9FH2sisKGROh14P;

1.414
date	2015.04.02.18.36.51;	author ajacoutot;	state Exp;
branches;
next	1.413;
commitid	bh0eVXjT8mth7Hse;

1.413
date	2015.02.24.14.05.50;	author espie;	state Exp;
branches;
next	1.412;
commitid	52UbHdS4LQhrgerK;

1.412
date	2014.12.23.14.05.16;	author espie;	state Exp;
branches;
next	1.411;
commitid	M0gHvYGr7SLEs5a5;

1.411
date	2014.11.09.01.12.59;	author schwarze;	state Exp;
branches;
next	1.410;
commitid	yalPDO7uJIRP3RyA;

1.410
date	2014.11.04.10.00.24;	author espie;	state Exp;
branches;
next	1.409;
commitid	LF4ZNmWDckqXU25o;

1.409
date	2014.11.03.19.51.16;	author bcallah;	state Exp;
branches;
next	1.408;
commitid	QVsWLsfFtnLwybvQ;

1.408
date	2014.10.02.23.52.09;	author stu;	state Exp;
branches;
next	1.407;
commitid	ALcFGUc1OVCUUXxR;

1.407
date	2014.09.13.15.13.44;	author naddy;	state Exp;
branches;
next	1.406;
commitid	7Bn0yTofZzLRUXrD;

1.406
date	2014.09.05.14.39.16;	author jasper;	state Exp;
branches;
next	1.405;
commitid	DjrUxeHRCGhFQ1e6;

1.405
date	2014.09.02.14.27.23;	author jasper;	state Exp;
branches;
next	1.404;
commitid	WNGvzv1lQ4lUT4Yv;

1.404
date	2014.08.10.11.23.02;	author jmc;	state Exp;
branches;
next	1.403;
commitid	0bzhS0RLlFOsEcoR;

1.403
date	2014.08.10.10.10.21;	author espie;	state Exp;
branches;
next	1.402;
commitid	7lkuos5TjF0UeuMk;

1.402
date	2014.07.23.10.19.51;	author espie;	state Exp;
branches;
next	1.401;
commitid	Id6g2eit7gcirpCg;

1.401
date	2014.07.14.08.22.10;	author zhuk;	state Exp;
branches;
next	1.400;
commitid	osJpQmVbTHJEsXlB;

1.400
date	2014.07.12.17.10.51;	author jmc;	state Exp;
branches;
next	1.399;
commitid	cDTvSBxEtG1QIsTk;

1.399
date	2014.07.12.09.38.39;	author espie;	state Exp;
branches;
next	1.398;
commitid	F1e2anQlaUTiYwsq;

1.398
date	2014.07.12.09.26.27;	author robert;	state Exp;
branches;
next	1.397;
commitid	pbMAdPvkrZJGUKCx;

1.397
date	2014.06.25.09.43.36;	author zhuk;	state Exp;
branches;
next	1.396;
commitid	fDedLpLmYsASR2il;

1.396
date	2014.03.18.22.36.31;	author miod;	state Exp;
branches;
next	1.395;

1.395
date	2014.02.11.10.35.11;	author espie;	state Exp;
branches;
next	1.394;

1.394
date	2014.01.18.00.18.06;	author naddy;	state Exp;
branches;
next	1.393;

1.393
date	2014.01.17.22.59.44;	author espie;	state Exp;
branches;
next	1.392;

1.392
date	2014.01.04.00.14.08;	author espie;	state Exp;
branches;
next	1.391;

1.391
date	2013.12.30.12.43.17;	author espie;	state Exp;
branches;
next	1.390;

1.390
date	2013.12.02.08.32.20;	author espie;	state Exp;
branches;
next	1.389;

1.389
date	2013.11.25.14.39.29;	author jmc;	state Exp;
branches;
next	1.388;

1.388
date	2013.11.25.14.14.44;	author sthen;	state Exp;
branches;
next	1.387;

1.387
date	2013.11.25.13.15.22;	author juanfra;	state Exp;
branches;
next	1.386;

1.386
date	2013.11.07.01.25.27;	author juanfra;	state Exp;
branches;
next	1.385;

1.385
date	2013.08.14.08.39.28;	author jmc;	state Exp;
branches;
next	1.384;

1.384
date	2013.08.10.10.17.36;	author miod;	state Exp;
branches;
next	1.383;

1.383
date	2013.08.07.07.21.03;	author espie;	state Exp;
branches;
next	1.382;

1.382
date	2013.07.16.18.38.51;	author schwarze;	state Exp;
branches;
next	1.381;

1.381
date	2013.07.08.18.28.11;	author landry;	state Exp;
branches;
next	1.380;

1.380
date	2013.06.24.15.56.29;	author jmc;	state Exp;
branches;
next	1.379;

1.379
date	2013.06.24.11.20.47;	author sthen;	state Exp;
branches;
next	1.378;

1.378
date	2013.06.21.13.06.54;	author espie;	state Exp;
branches;
next	1.377;

1.377
date	2013.06.19.08.56.32;	author espie;	state Exp;
branches;
next	1.376;

1.376
date	2013.05.09.15.05.52;	author rpe;	state Exp;
branches;
next	1.375;

1.375
date	2013.05.08.08.51.55;	author espie;	state Exp;
branches;
next	1.374;

1.374
date	2013.05.06.21.17.37;	author zhuk;	state Exp;
branches;
next	1.373;

1.373
date	2013.03.25.13.13.13;	author jmc;	state Exp;
branches;
next	1.372;

1.372
date	2013.03.25.10.21.39;	author landry;	state Exp;
branches;
next	1.371;

1.371
date	2013.03.21.08.30.29;	author ajacoutot;	state Exp;
branches;
next	1.370;

1.370
date	2013.03.10.22.27.41;	author espie;	state Exp;
branches;
next	1.369;

1.369
date	2013.03.09.09.03.48;	author espie;	state Exp;
branches;
next	1.368;

1.368
date	2013.03.09.00.11.38;	author espie;	state Exp;
branches;
next	1.367;

1.367
date	2013.03.08.10.11.55;	author espie;	state Exp;
branches;
next	1.366;

1.366
date	2013.03.04.15.54.33;	author jasper;	state Exp;
branches;
next	1.365;

1.365
date	2013.03.04.13.47.14;	author jasper;	state Exp;
branches;
next	1.364;

1.364
date	2013.02.16.11.35.12;	author ajacoutot;	state Exp;
branches;
next	1.363;

1.363
date	2013.02.03.16.04.24;	author jmc;	state Exp;
branches;
next	1.362;

1.362
date	2013.02.03.13.36.40;	author espie;	state Exp;
branches;
next	1.361;

1.361
date	2013.01.16.16.24.53;	author zhuk;	state Exp;
branches;
next	1.360;

1.360
date	2013.01.05.09.43.25;	author ajacoutot;	state Exp;
branches;
next	1.359;

1.359
date	2012.11.28.07.16.09;	author ajacoutot;	state Exp;
branches;
next	1.358;

1.358
date	2012.11.19.12.27.43;	author espie;	state Exp;
branches;
next	1.357;

1.357
date	2012.11.01.11.55.53;	author jmc;	state Exp;
branches;
next	1.356;

1.356
date	2012.11.01.10.38.29;	author espie;	state Exp;
branches;
next	1.355;

1.355
date	2012.08.31.18.54.39;	author jmc;	state Exp;
branches;
next	1.354;

1.354
date	2012.08.31.17.25.11;	author espie;	state Exp;
branches;
next	1.353;

1.353
date	2012.08.31.16.52.40;	author espie;	state Exp;
branches;
next	1.352;

1.352
date	2012.08.22.13.54.01;	author espie;	state Exp;
branches;
next	1.351;

1.351
date	2012.08.18.08.04.28;	author espie;	state Exp;
branches;
next	1.350;

1.350
date	2012.08.18.08.02.04;	author espie;	state Exp;
branches;
next	1.349;

1.349
date	2012.08.18.07.59.40;	author espie;	state Exp;
branches;
next	1.348;

1.348
date	2012.08.15.18.09.02;	author jmc;	state Exp;
branches;
next	1.347;

1.347
date	2012.08.15.10.49.05;	author espie;	state Exp;
branches;
next	1.346;

1.346
date	2012.08.05.10.51.41;	author espie;	state Exp;
branches;
next	1.345;

1.345
date	2012.08.03.12.10.03;	author espie;	state Exp;
branches;
next	1.344;

1.344
date	2012.07.07.15.37.35;	author espie;	state Exp;
branches;
next	1.343;

1.343
date	2012.06.25.12.26.59;	author espie;	state Exp;
branches;
next	1.342;

1.342
date	2012.06.18.12.16.19;	author espie;	state Exp;
branches;
next	1.341;

1.341
date	2012.06.08.21.01.22;	author sthen;	state Exp;
branches;
next	1.340;

1.340
date	2012.06.08.14.53.36;	author espie;	state Exp;
branches;
next	1.339;

1.339
date	2012.06.04.18.42.13;	author pascal;	state Exp;
branches;
next	1.338;

1.338
date	2012.05.28.09.51.17;	author espie;	state Exp;
branches;
next	1.337;

1.337
date	2012.05.28.09.43.47;	author espie;	state Exp;
branches;
next	1.336;

1.336
date	2012.05.15.13.19.43;	author sthen;	state Exp;
branches;
next	1.335;

1.335
date	2012.04.28.10.51.19;	author ajacoutot;	state Exp;
branches;
next	1.334;

1.334
date	2012.04.27.19.32.23;	author jeremy;	state Exp;
branches;
next	1.333;

1.333
date	2012.04.04.15.58.21;	author landry;	state Exp;
branches;
next	1.332;

1.332
date	2012.03.22.14.12.00;	author espie;	state Exp;
branches;
next	1.331;

1.331
date	2012.02.23.11.14.30;	author espie;	state Exp;
branches;
next	1.330;

1.330
date	2012.02.17.07.51.34;	author espie;	state Exp;
branches;
next	1.329;

1.329
date	2012.02.17.07.37.40;	author espie;	state Exp;
branches;
next	1.328;

1.328
date	2012.01.29.11.32.36;	author espie;	state Exp;
branches;
next	1.327;

1.327
date	2011.12.29.17.31.42;	author espie;	state Exp;
branches;
next	1.326;

1.326
date	2011.12.23.17.00.47;	author jmc;	state Exp;
branches;
next	1.325;

1.325
date	2011.12.20.14.37.46;	author fgsch;	state Exp;
branches;
next	1.324;

1.324
date	2011.12.09.12.02.06;	author espie;	state Exp;
branches;
next	1.323;

1.323
date	2011.12.09.10.36.26;	author espie;	state Exp;
branches;
next	1.322;

1.322
date	2011.12.04.00.10.28;	author espie;	state Exp;
branches;
next	1.321;

1.321
date	2011.12.03.23.48.56;	author espie;	state Exp;
branches;
next	1.320;

1.320
date	2011.12.03.23.37.20;	author espie;	state Exp;
branches;
next	1.319;

1.319
date	2011.12.03.23.19.28;	author espie;	state Exp;
branches;
next	1.318;

1.318
date	2011.12.03.23.01.21;	author schwarze;	state Exp;
branches;
next	1.317;

1.317
date	2011.12.03.22.27.57;	author espie;	state Exp;
branches;
next	1.316;

1.316
date	2011.12.03.20.49.16;	author espie;	state Exp;
branches;
next	1.315;

1.315
date	2011.12.03.20.45.01;	author espie;	state Exp;
branches;
next	1.314;

1.314
date	2011.12.03.20.39.58;	author espie;	state Exp;
branches;
next	1.313;

1.313
date	2011.12.03.20.34.16;	author espie;	state Exp;
branches;
next	1.312;

1.312
date	2011.12.03.20.24.09;	author espie;	state Exp;
branches;
next	1.311;

1.311
date	2011.12.03.20.20.28;	author jmc;	state Exp;
branches;
next	1.310;

1.310
date	2011.12.03.18.20.57;	author espie;	state Exp;
branches;
next	1.309;

1.309
date	2011.11.25.14.04.23;	author espie;	state Exp;
branches;
next	1.308;

1.308
date	2011.11.25.13.59.18;	author espie;	state Exp;
branches;
next	1.307;

1.307
date	2011.11.25.11.12.21;	author espie;	state Exp;
branches;
next	1.306;

1.306
date	2011.11.25.11.01.25;	author espie;	state Exp;
branches;
next	1.305;

1.305
date	2011.11.25.10.12.26;	author espie;	state Exp;
branches;
next	1.304;

1.304
date	2011.11.22.16.21.50;	author sthen;	state Exp;
branches;
next	1.303;

1.303
date	2011.11.22.16.01.30;	author jmc;	state Exp;
branches;
next	1.302;

1.302
date	2011.11.22.14.55.37;	author espie;	state Exp;
branches;
next	1.301;

1.301
date	2011.11.22.14.48.27;	author espie;	state Exp;
branches;
next	1.300;

1.300
date	2011.11.22.14.24.33;	author espie;	state Exp;
branches;
next	1.299;

1.299
date	2011.11.21.12.57.17;	author espie;	state Exp;
branches;
next	1.298;

1.298
date	2011.11.21.12.32.34;	author espie;	state Exp;
branches;
next	1.297;

1.297
date	2011.11.21.12.06.12;	author espie;	state Exp;
branches;
next	1.296;

1.296
date	2011.11.18.15.42.16;	author jmc;	state Exp;
branches;
next	1.295;

1.295
date	2011.11.18.11.12.47;	author espie;	state Exp;
branches;
next	1.294;

1.294
date	2011.10.21.17.31.23;	author espie;	state Exp;
branches;
next	1.293;

1.293
date	2011.10.21.17.28.34;	author espie;	state Exp;
branches;
next	1.292;

1.292
date	2011.10.21.17.27.00;	author espie;	state Exp;
branches;
next	1.291;

1.291
date	2011.10.16.14.58.13;	author jmc;	state Exp;
branches;
next	1.290;

1.290
date	2011.10.16.07.13.12;	author espie;	state Exp;
branches;
next	1.289;

1.289
date	2011.09.25.16.53.13;	author jmc;	state Exp;
branches;
next	1.288;

1.288
date	2011.09.25.08.00.32;	author espie;	state Exp;
branches;
next	1.287;

1.287
date	2011.09.21.09.07.47;	author espie;	state Exp;
branches;
next	1.286;

1.286
date	2011.09.03.15.09.10;	author espie;	state Exp;
branches;
next	1.285;

1.285
date	2011.08.29.18.48.31;	author matthew;	state Exp;
branches;
next	1.284;

1.284
date	2011.07.15.23.11.59;	author fgsch;	state Exp;
branches;
next	1.283;

1.283
date	2011.07.05.15.29.32;	author sthen;	state Exp;
branches;
next	1.282;

1.282
date	2011.07.05.15.16.10;	author sthen;	state Exp;
branches;
next	1.281;

1.281
date	2011.06.04.08.26.55;	author jmc;	state Exp;
branches;
next	1.280;

1.280
date	2011.06.01.12.05.13;	author espie;	state Exp;
branches;
next	1.279;

1.279
date	2011.05.13.14.40.29;	author sthen;	state Exp;
branches;
next	1.278;

1.278
date	2011.04.10.17.57.16;	author jasper;	state Exp;
branches;
next	1.277;

1.277
date	2011.04.03.07.25.29;	author espie;	state Exp;
branches;
next	1.276;

1.276
date	2010.12.11.10.41.30;	author martynas;	state Exp;
branches;
next	1.275;

1.275
date	2010.12.01.23.59.53;	author landry;	state Exp;
branches;
next	1.274;

1.274
date	2010.11.26.14.07.17;	author espie;	state Exp;
branches;
next	1.273;

1.273
date	2010.11.26.10.02.35;	author jmc;	state Exp;
branches;
next	1.272;

1.272
date	2010.11.26.07.46.31;	author espie;	state Exp;
branches;
next	1.271;

1.271
date	2010.11.14.11.18.30;	author espie;	state Exp;
branches;
next	1.270;

1.270
date	2010.11.13.10.43.20;	author espie;	state Exp;
branches;
next	1.269;

1.269
date	2010.10.27.17.20.06;	author espie;	state Exp;
branches;
next	1.268;

1.268
date	2010.10.25.04.54.25;	author jmc;	state Exp;
branches;
next	1.267;

1.267
date	2010.10.24.20.43.31;	author ajacoutot;	state Exp;
branches;
next	1.266;

1.266
date	2010.10.22.15.53.39;	author espie;	state Exp;
branches;
next	1.265;

1.265
date	2010.10.04.16.04.27;	author jmc;	state Exp;
branches;
next	1.264;

1.264
date	2010.10.04.10.35.24;	author espie;	state Exp;
branches;
next	1.263;

1.263
date	2010.10.04.10.32.47;	author espie;	state Exp;
branches;
next	1.262;

1.262
date	2010.09.06.16.28.21;	author espie;	state Exp;
branches;
next	1.261;

1.261
date	2010.09.06.12.06.56;	author jasper;	state Exp;
branches;
next	1.260;

1.260
date	2010.08.08.12.37.59;	author jmc;	state Exp;
branches;
next	1.259;

1.259
date	2010.08.07.19.40.45;	author espie;	state Exp;
branches;
next	1.258;

1.258
date	2010.08.07.08.33.35;	author espie;	state Exp;
branches;
next	1.257;

1.257
date	2010.07.18.21.22.36;	author jmc;	state Exp;
branches;
next	1.256;

1.256
date	2010.07.18.18.50.38;	author naddy;	state Exp;
branches;
next	1.255;

1.255
date	2010.07.11.07.19.05;	author espie;	state Exp;
branches;
next	1.254;

1.254
date	2010.07.10.10.49.15;	author jmc;	state Exp;
branches;
next	1.253;

1.253
date	2010.07.10.09.12.02;	author espie;	state Exp;
branches;
next	1.252;

1.252
date	2010.07.06.16.22.25;	author jmc;	state Exp;
branches;
next	1.251;

1.251
date	2010.07.06.12.42.55;	author espie;	state Exp;
branches;
next	1.250;

1.250
date	2010.07.04.17.30.30;	author espie;	state Exp;
branches;
next	1.249;

1.249
date	2010.06.20.07.59.53;	author espie;	state Exp;
branches;
next	1.248;

1.248
date	2010.06.17.13.28.17;	author jmc;	state Exp;
branches;
next	1.247;

1.247
date	2010.06.17.03.19.39;	author william;	state Exp;
branches;
next	1.246;

1.246
date	2010.06.16.12.14.40;	author espie;	state Exp;
branches;
next	1.245;

1.245
date	2010.06.16.12.07.39;	author espie;	state Exp;
branches;
next	1.244;

1.244
date	2010.05.01.10.30.41;	author espie;	state Exp;
branches;
next	1.243;

1.243
date	2010.04.08.16.59.49;	author jmc;	state Exp;
branches;
next	1.242;

1.242
date	2010.03.22.22.02.08;	author jmc;	state Exp;
branches;
next	1.241;

1.241
date	2010.03.21.11.40.39;	author ajacoutot;	state Exp;
branches;
next	1.240;

1.240
date	2010.03.20.19.16.57;	author espie;	state Exp;
branches;
next	1.239;

1.239
date	2010.02.26.19.27.09;	author espie;	state Exp;
branches;
next	1.238;

1.238
date	2010.02.12.15.20.13;	author jmc;	state Exp;
branches;
next	1.237;

1.237
date	2010.02.12.12.12.13;	author espie;	state Exp;
branches;
next	1.236;

1.236
date	2009.12.24.13.58.14;	author sthen;	state Exp;
branches;
next	1.235;

1.235
date	2009.10.13.14.40.24;	author landry;	state Exp;
branches;
next	1.234;

1.234
date	2009.08.17.21.39.41;	author sthen;	state Exp;
branches;
next	1.233;

1.233
date	2009.08.12.22.40.54;	author simon;	state Exp;
branches;
next	1.232;

1.232
date	2009.07.02.17.45.38;	author jakemsr;	state Exp;
branches;
next	1.231;

1.231
date	2009.06.16.11.25.30;	author sthen;	state Exp;
branches;
next	1.230;

1.230
date	2009.06.12.13.40.34;	author landry;	state Exp;
branches;
next	1.229;

1.229
date	2009.05.20.17.30.39;	author jmc;	state Exp;
branches;
next	1.228;

1.228
date	2009.05.19.19.43.17;	author espie;	state Exp;
branches;
next	1.227;

1.227
date	2009.05.16.22.19.06;	author simon;	state Exp;
branches;
next	1.226;

1.226
date	2009.01.24.11.41.26;	author espie;	state Exp;
branches;
next	1.225;

1.225
date	2008.10.29.12.35.10;	author espie;	state Exp;
branches;
next	1.224;

1.224
date	2008.10.26.19.30.18;	author jmc;	state Exp;
branches;
next	1.223;

1.223
date	2008.10.26.15.21.46;	author espie;	state Exp;
branches;
next	1.222;

1.222
date	2008.07.27.10.24.27;	author jmc;	state Exp;
branches;
next	1.221;

1.221
date	2008.07.26.11.31.03;	author espie;	state Exp;
branches;
next	1.220;

1.220
date	2008.07.26.11.05.32;	author espie;	state Exp;
branches;
next	1.219;

1.219
date	2008.07.22.20.53.13;	author espie;	state Exp;
branches;
next	1.218;

1.218
date	2008.07.04.10.55.55;	author espie;	state Exp;
branches;
next	1.217;

1.217
date	2008.06.10.11.07.00;	author jmc;	state Exp;
branches;
next	1.216;

1.216
date	2008.06.08.10.28.48;	author espie;	state Exp;
branches;
next	1.215;

1.215
date	2008.06.07.21.58.22;	author espie;	state Exp;
branches;
next	1.214;

1.214
date	2008.05.15.10.03.32;	author espie;	state Exp;
branches;
next	1.213;

1.213
date	2008.05.11.18.48.21;	author espie;	state Exp;
branches;
next	1.212;

1.212
date	2008.05.11.10.28.44;	author espie;	state Exp;
branches;
next	1.211;

1.211
date	2008.04.25.14.41.35;	author jmc;	state Exp;
branches;
next	1.210;

1.210
date	2008.04.07.11.19.40;	author espie;	state Exp;
branches;
next	1.209;

1.209
date	2008.03.24.14.41.35;	author ajacoutot;	state Exp;
branches;
next	1.208;

1.208
date	2008.01.12.16.04.35;	author jmc;	state Exp;
branches;
next	1.207;

1.207
date	2008.01.12.14.23.07;	author espie;	state Exp;
branches;
next	1.206;

1.206
date	2008.01.04.22.30.12;	author jmc;	state Exp;
branches;
next	1.205;

1.205
date	2008.01.04.17.55.49;	author espie;	state Exp;
branches;
next	1.204;

1.204
date	2007.12.21.19.24.50;	author jmc;	state Exp;
branches;
next	1.203;

1.203
date	2007.12.21.16.53.05;	author espie;	state Exp;
branches;
next	1.202;

1.202
date	2007.08.28.11.25.04;	author espie;	state Exp;
branches;
next	1.201;

1.201
date	2007.06.23.09.42.24;	author steven;	state Exp;
branches;
next	1.200;

1.200
date	2007.06.17.10.39.39;	author espie;	state Exp;
branches;
next	1.199;

1.199
date	2007.06.16.10.03.52;	author espie;	state Exp;
branches;
next	1.198;

1.198
date	2007.05.31.19.19.58;	author jmc;	state Exp;
branches;
next	1.197;

1.197
date	2007.05.31.15.20.32;	author jmc;	state Exp;
branches;
next	1.196;

1.196
date	2007.05.31.10.48.51;	author espie;	state Exp;
branches;
next	1.195;

1.195
date	2007.05.21.11.19.30;	author steven;	state Exp;
branches;
next	1.194;

1.194
date	2007.04.20.22.15.40;	author jmc;	state Exp;
branches;
next	1.193;

1.193
date	2007.04.20.20.16.37;	author steven;	state Exp;
branches;
next	1.192;

1.192
date	2007.04.03.10.17.00;	author espie;	state Exp;
branches;
next	1.191;

1.191
date	2007.03.30.13.46.24;	author espie;	state Exp;
branches;
next	1.190;

1.190
date	2007.02.06.19.01.24;	author espie;	state Exp;
branches;
next	1.189;

1.189
date	2007.01.18.06.34.56;	author steven;	state Exp;
branches;
next	1.188;

1.188
date	2007.01.17.13.16.11;	author steven;	state Exp;
branches;
next	1.187;

1.187
date	2006.12.26.20.35.59;	author steven;	state Exp;
branches;
next	1.186;

1.186
date	2006.12.21.16.27.23;	author ajacoutot;	state Exp;
branches;
next	1.185;

1.185
date	2006.12.11.21.30.55;	author espie;	state Exp;
branches;
next	1.184;

1.184
date	2006.12.01.17.49.38;	author espie;	state Exp;
branches;
next	1.183;

1.183
date	2006.11.26.22.03.54;	author jmc;	state Exp;
branches;
next	1.182;

1.182
date	2006.11.26.18.38.54;	author espie;	state Exp;
branches;
next	1.181;

1.181
date	2006.11.04.00.15.26;	author jmc;	state Exp;
branches;
next	1.180;

1.180
date	2006.11.04.00.14.12;	author jmc;	state Exp;
branches;
next	1.179;

1.179
date	2006.11.03.17.14.12;	author espie;	state Exp;
branches;
next	1.178;

1.178
date	2006.11.02.16.54.16;	author jmc;	state Exp;
branches;
next	1.177;

1.177
date	2006.11.02.10.18.07;	author espie;	state Exp;
branches;
next	1.176;

1.176
date	2006.11.02.10.12.17;	author espie;	state Exp;
branches;
next	1.175;

1.175
date	2006.11.02.09.57.04;	author espie;	state Exp;
branches;
next	1.174;

1.174
date	2006.08.02.09.09.38;	author espie;	state Exp;
branches;
next	1.173;

1.173
date	2006.07.01.11.10.42;	author espie;	state Exp;
branches;
next	1.172;

1.172
date	2006.01.07.15.24.31;	author jmc;	state Exp;
branches;
next	1.171;

1.171
date	2006.01.07.11.37.58;	author espie;	state Exp;
branches;
next	1.170;

1.170
date	2005.12.29.09.55.18;	author jmc;	state Exp;
branches;
next	1.169;

1.169
date	2005.12.28.12.20.26;	author espie;	state Exp;
branches;
next	1.168;

1.168
date	2005.11.19.09.32.47;	author sturm;	state Exp;
branches;
next	1.167;

1.167
date	2005.11.04.10.49.53;	author espie;	state Exp;
branches;
next	1.166;

1.166
date	2005.11.01.14.09.33;	author espie;	state Exp;
branches;
next	1.165;

1.165
date	2005.09.12.22.14.22;	author espie;	state Exp;
branches;
next	1.164;

1.164
date	2005.09.06.22.21.03;	author jmc;	state Exp;
branches;
next	1.163;

1.163
date	2005.09.04.22.35.48;	author espie;	state Exp;
branches;
next	1.162;

1.162
date	2005.07.26.19.43.07;	author jmc;	state Exp;
branches;
next	1.161;

1.161
date	2005.07.26.16.53.52;	author fgsch;	state Exp;
branches;
next	1.160;

1.160
date	2005.06.10.23.14.26;	author mjc;	state Exp;
branches;
next	1.159;

1.159
date	2005.03.14.15.31.04;	author jmc;	state Exp;
branches;
next	1.158;

1.158
date	2005.03.14.11.03.04;	author espie;	state Exp;
branches;
next	1.157;

1.157
date	2005.03.11.23.03.58;	author jmc;	state Exp;
branches;
next	1.156;

1.156
date	2004.12.02.21.55.23;	author jmc;	state Exp;
branches;
next	1.155;

1.155
date	2004.12.02.21.52.58;	author jmc;	state Exp;
branches;
next	1.154;

1.154
date	2004.11.27.10.01.54;	author espie;	state Exp;
branches;
next	1.153;

1.153
date	2004.11.17.11.01.55;	author espie;	state Exp;
branches;
next	1.152;

1.152
date	2004.11.17.10.51.37;	author espie;	state Exp;
branches;
next	1.151;

1.151
date	2004.10.11.10.41.16;	author espie;	state Exp;
branches;
next	1.150;

1.150
date	2004.10.11.10.34.56;	author espie;	state Exp;
branches;
next	1.149;

1.149
date	2004.09.19.09.00.51;	author pvalchev;	state Exp;
branches;
next	1.148;

1.148
date	2004.09.16.20.04.22;	author espie;	state Exp;
branches;
next	1.147;

1.147
date	2004.09.15.19.05.29;	author espie;	state Exp;
branches;
next	1.146;

1.146
date	2004.08.03.08.05.05;	author espie;	state Exp;
branches;
next	1.145;

1.145
date	2004.07.20.10.31.21;	author jmc;	state Exp;
branches;
next	1.144;

1.144
date	2004.07.20.05.44.34;	author espie;	state Exp;
branches;
next	1.143;

1.143
date	2004.07.11.20.46.32;	author espie;	state Exp;
branches;
next	1.142;

1.142
date	2004.06.28.18.14.11;	author sturm;	state Exp;
branches;
next	1.141;

1.141
date	2004.06.20.20.02.28;	author xsa;	state Exp;
branches;
next	1.140;

1.140
date	2004.06.06.21.54.59;	author jmc;	state Exp;
branches;
next	1.139;

1.139
date	2004.06.06.20.45.36;	author xsa;	state Exp;
branches;
next	1.138;

1.138
date	2004.06.06.11.49.39;	author espie;	state Exp;
branches;
next	1.137;

1.137
date	2004.05.27.09.12.21;	author jmc;	state Exp;
branches;
next	1.136;

1.136
date	2004.05.26.11.22.25;	author msf;	state Exp;
branches;
next	1.135;

1.135
date	2004.05.16.23.14.55;	author pvalchev;	state Exp;
branches;
next	1.134;

1.134
date	2004.02.18.13.39.02;	author xsa;	state Exp;
branches;
next	1.133;

1.133
date	2004.02.08.08.20.17;	author jmc;	state Exp;
branches;
next	1.132;

1.132
date	2004.02.07.22.43.48;	author espie;	state Exp;
branches;
next	1.131;

1.131
date	2004.02.07.22.05.53;	author espie;	state Exp;
branches;
next	1.130;

1.130
date	2004.01.28.22.09.10;	author espie;	state Exp;
branches;
next	1.129;

1.129
date	2004.01.22.21.32.43;	author espie;	state Exp;
branches;
next	1.128;

1.128
date	2004.01.18.07.55.34;	author sturm;	state Exp;
branches;
next	1.127;

1.127
date	2004.01.12.05.42.47;	author jolan;	state Exp;
branches;
next	1.126;

1.126
date	2004.01.04.10.00.22;	author jolan;	state Exp;
branches;
next	1.125;

1.125
date	2003.10.26.15.11.47;	author jmc;	state Exp;
branches;
next	1.124;

1.124
date	2003.09.18.09.49.43;	author jmc;	state Exp;
branches;
next	1.123;

1.123
date	2003.09.09.15.37.39;	author espie;	state Exp;
branches;
next	1.122;

1.122
date	2003.09.03.09.10.30;	author jmc;	state Exp;
branches;
next	1.121;

1.121
date	2003.08.21.20.24.12;	author espie;	state Exp;
branches;
next	1.120;

1.120
date	2003.08.15.00.10.01;	author espie;	state Exp;
branches;
next	1.119;

1.119
date	2003.08.11.20.14.35;	author espie;	state Exp;
branches;
next	1.118;

1.118
date	2003.08.04.14.03.17;	author espie;	state Exp;
branches;
next	1.117;

1.117
date	2003.07.31.11.11.02;	author espie;	state Exp;
branches;
next	1.116;

1.116
date	2003.07.28.20.02.44;	author sturm;	state Exp;
branches;
next	1.115;

1.115
date	2003.07.28.17.37.10;	author sturm;	state Exp;
branches;
next	1.114;

1.114
date	2003.07.25.12.54.42;	author espie;	state Exp;
branches;
next	1.113;

1.113
date	2003.07.23.12.46.29;	author espie;	state Exp;
branches;
next	1.112;

1.112
date	2003.07.18.18.35.11;	author espie;	state Exp;
branches;
next	1.111;

1.111
date	2003.07.18.18.23.18;	author espie;	state Exp;
branches;
next	1.110;

1.110
date	2003.07.15.10.52.19;	author espie;	state Exp;
branches;
next	1.109;

1.109
date	2003.07.14.23.47.17;	author espie;	state Exp;
branches;
next	1.108;

1.108
date	2003.07.14.18.51.37;	author jmc;	state Exp;
branches;
next	1.107;

1.107
date	2003.07.14.14.09.24;	author espie;	state Exp;
branches;
next	1.106;

1.106
date	2003.07.14.13.58.15;	author espie;	state Exp;
branches;
next	1.105;

1.105
date	2003.07.14.13.48.48;	author espie;	state Exp;
branches;
next	1.104;

1.104
date	2003.07.12.16.19.50;	author espie;	state Exp;
branches;
next	1.103;

1.103
date	2003.07.12.16.17.11;	author espie;	state Exp;
branches;
next	1.102;

1.102
date	2003.07.12.16.09.10;	author espie;	state Exp;
branches;
next	1.101;

1.101
date	2003.07.12.15.46.21;	author espie;	state Exp;
branches;
next	1.100;

1.100
date	2003.07.12.15.36.24;	author espie;	state Exp;
branches;
next	1.99;

1.99
date	2003.07.12.15.35.11;	author espie;	state Exp;
branches;
next	1.98;

1.98
date	2003.07.12.12.46.44;	author espie;	state Exp;
branches;
next	1.97;

1.97
date	2003.07.09.20.23.34;	author jmc;	state Exp;
branches;
next	1.96;

1.96
date	2003.07.09.10.37.51;	author espie;	state Exp;
branches;
next	1.95;

1.95
date	2003.07.09.06.05.08;	author pvalchev;	state Exp;
branches;
next	1.94;

1.94
date	2003.07.05.21.50.35;	author pvalchev;	state Exp;
branches;
next	1.93;

1.93
date	2003.07.01.10.00.29;	author jmc;	state Exp;
branches;
next	1.92;

1.92
date	2003.06.30.18.44.41;	author jmc;	state Exp;
branches;
next	1.91;

1.91
date	2003.06.30.12.18.37;	author espie;	state Exp;
branches;
next	1.90;

1.90
date	2003.06.06.13.28.13;	author jmc;	state Exp;
branches;
next	1.89;

1.89
date	2003.04.14.22.29.46;	author pvalchev;	state Exp;
branches;
next	1.88;

1.88
date	2003.04.03.07.56.28;	author jmc;	state Exp;
branches;
next	1.87;

1.87
date	2003.03.22.08.02.03;	author david;	state Exp;
branches;
next	1.86;

1.86
date	2003.03.06.04.03.40;	author david;	state Exp;
branches;
next	1.85;

1.85
date	2003.02.15.16.43.58;	author espie;	state Exp;
branches;
next	1.84;

1.84
date	2003.01.17.17.48.55;	author millert;	state Exp;
branches;
next	1.83;

1.83
date	2003.01.17.17.36.04;	author deraadt;	state Exp;
branches;
next	1.82;

1.82
date	2003.01.14.18.19.07;	author espie;	state Exp;
branches;
next	1.81;

1.81
date	2002.12.31.16.22.26;	author miod;	state Exp;
branches;
next	1.80;

1.80
date	2002.12.31.08.33.52;	author pvalchev;	state Exp;
branches;
next	1.79;

1.79
date	2002.12.30.02.41.33;	author espie;	state Exp;
branches;
next	1.78;

1.78
date	2002.11.25.10.18.24;	author avsm;	state Exp;
branches;
next	1.77;

1.77
date	2002.11.08.08.08.47;	author mpech;	state Exp;
branches;
next	1.76;

1.76
date	2002.10.29.08.29.37;	author pvalchev;	state Exp;
branches;
next	1.75;

1.75
date	2002.10.14.09.58.01;	author pvalchev;	state Exp;
branches;
next	1.74;

1.74
date	2002.08.29.07.34.31;	author wcobb;	state Exp;
branches;
next	1.73;

1.73
date	2002.08.07.15.49.57;	author avsm;	state Exp;
branches;
next	1.72;

1.72
date	2002.07.06.09.30.14;	author pvalchev;	state Exp;
branches;
next	1.71;

1.71
date	2002.06.19.11.40.33;	author mpech;	state Exp;
branches;
next	1.70;

1.70
date	2002.06.05.19.59.02;	author pvalchev;	state Exp;
branches;
next	1.69;

1.69
date	2002.05.13.00.45.09;	author espie;	state Exp;
branches;
next	1.68;

1.68
date	2002.05.03.15.03.02;	author espie;	state Exp;
branches;
next	1.67;

1.67
date	2002.04.24.21.38.36;	author espie;	state Exp;
branches;
next	1.66;

1.66
date	2002.04.17.17.12.59;	author espie;	state Exp;
branches;
next	1.65;

1.65
date	2002.04.02.16.03.47;	author espie;	state Exp;
branches;
next	1.64;

1.64
date	2002.03.16.00.56.47;	author espie;	state Exp;
branches;
next	1.63;

1.63
date	2002.03.02.13.41.02;	author espie;	state Exp;
branches;
next	1.62;

1.62
date	2002.02.18.20.57.07;	author pvalchev;	state Exp;
branches;
next	1.61;

1.61
date	2002.02.08.04.30.51;	author brad;	state Exp;
branches;
next	1.60;

1.60
date	2002.01.24.22.36.41;	author kjell;	state Exp;
branches;
next	1.59;

1.59
date	2001.12.29.21.44.07;	author avsm;	state Exp;
branches;
next	1.58;

1.58
date	2001.12.09.05.35.23;	author pvalchev;	state Exp;
branches;
next	1.57;

1.57
date	2001.11.17.10.44.28;	author espie;	state Exp;
branches;
next	1.56;

1.56
date	2001.11.11.13.57.31;	author heko;	state Exp;
branches;
next	1.55;

1.55
date	2001.10.07.11.36.09;	author espie;	state Exp;
branches;
next	1.54;

1.54
date	2001.10.07.11.03.57;	author espie;	state Exp;
branches;
next	1.53;

1.53
date	2001.10.05.14.45.54;	author mpech;	state Exp;
branches;
next	1.52;

1.52
date	2001.10.04.10.28.20;	author wilfried;	state Exp;
branches;
next	1.51;

1.51
date	2001.10.03.08.54.28;	author espie;	state Exp;
branches;
next	1.50;

1.50
date	2001.09.27.10.37.20;	author espie;	state Exp;
branches;
next	1.49;

1.49
date	2001.09.16.15.27.16;	author espie;	state Exp;
branches;
next	1.48;

1.48
date	2001.08.24.15.01.02;	author espie;	state Exp;
branches;
next	1.47;

1.47
date	2001.08.24.14.43.28;	author todd;	state Exp;
branches;
next	1.46;

1.46
date	2001.08.20.05.57.55;	author mpech;	state Exp;
branches;
next	1.45;

1.45
date	2001.08.17.11.13.58;	author mpech;	state Exp;
branches;
next	1.44;

1.44
date	2001.08.16.14.59.47;	author espie;	state Exp;
branches;
next	1.43;

1.43
date	2001.08.12.11.47.19;	author espie;	state Exp;
branches;
next	1.42;

1.42
date	2001.08.02.14.05.11;	author espie;	state Exp;
branches;
next	1.41;

1.41
date	2001.07.18.16.20.24;	author espie;	state Exp;
branches;
next	1.40;

1.40
date	2001.07.17.16.12.51;	author espie;	state Exp;
branches;
next	1.39;

1.39
date	2001.07.09.20.28.00;	author aaron;	state Exp;
branches;
next	1.38;

1.38
date	2001.07.03.12.11.49;	author espie;	state Exp;
branches;
next	1.37;

1.37
date	2001.06.24.07.30.29;	author pvalchev;	state Exp;
branches;
next	1.36;

1.36
date	2001.06.03.14.42.44;	author espie;	state Exp;
branches;
next	1.35;

1.35
date	2001.04.18.14.48.29;	author espie;	state Exp;
branches;
next	1.34;

1.34
date	2001.04.15.18.28.56;	author espie;	state Exp;
branches;
next	1.33;

1.33
date	2001.04.12.10.26.58;	author avsm;	state Exp;
branches;
next	1.32;

1.32
date	2001.04.10.17.48.10;	author espie;	state Exp;
branches;
next	1.31;

1.31
date	2001.03.28.22.00.59;	author naddy;	state Exp;
branches;
next	1.30;

1.30
date	2001.03.28.15.02.11;	author espie;	state Exp;
branches;
next	1.29;

1.29
date	2001.03.28.11.33.31;	author espie;	state Exp;
branches;
next	1.28;

1.28
date	2001.03.22.00.24.58;	author espie;	state Exp;
branches;
next	1.27;

1.27
date	2001.03.16.04.00.58;	author brad;	state Exp;
branches;
next	1.26;

1.26
date	2001.03.06.19.00.18;	author espie;	state Exp;
branches;
next	1.25;

1.25
date	2001.03.01.16.11.21;	author aaron;	state Exp;
branches;
next	1.24;

1.24
date	2001.01.16.07.05.41;	author espie;	state Exp;
branches;
next	1.23;

1.23
date	2001.01.16.04.23.56;	author angelos;	state Exp;
branches;
next	1.22;

1.22
date	2000.12.27.18.21.11;	author espie;	state Exp;
branches;
next	1.21;

1.21
date	2000.12.14.13.26.26;	author espie;	state Exp;
branches;
next	1.20;

1.20
date	2000.12.10.02.50.07;	author espie;	state Exp;
branches;
next	1.19;

1.19
date	2000.12.01.16.29.32;	author espie;	state Exp;
branches;
next	1.18;

1.18
date	2000.11.20.08.00.02;	author deraadt;	state Exp;
branches;
next	1.17;

1.17
date	2000.10.26.00.37.04;	author aaron;	state Exp;
branches;
next	1.16;

1.16
date	2000.09.23.12.38.34;	author espie;	state Exp;
branches;
next	1.15;

1.15
date	2000.09.19.18.43.48;	author espie;	state Exp;
branches;
next	1.14;

1.14
date	2000.09.17.16.39.18;	author espie;	state Exp;
branches;
next	1.13;

1.13
date	2000.09.16.13.51.24;	author espie;	state Exp;
branches;
next	1.12;

1.12
date	2000.09.11.18.11.28;	author espie;	state Exp;
branches;
next	1.11;

1.11
date	2000.07.11.13.06.46;	author espie;	state Exp;
branches;
next	1.10;

1.10
date	2000.07.11.13.00.48;	author espie;	state Exp;
branches;
next	1.9;

1.9
date	2000.07.11.12.28.30;	author espie;	state Exp;
branches;
next	1.8;

1.8
date	2000.07.09.15.08.48;	author espie;	state Exp;
branches;
next	1.7;

1.7
date	2000.07.04.16.28.33;	author espie;	state Exp;
branches;
next	1.6;

1.6
date	2000.07.04.16.08.58;	author aaron;	state Exp;
branches;
next	1.5;

1.5
date	2000.06.13.02.17.09;	author espie;	state Exp;
branches;
next	1.4;

1.4
date	2000.06.10.22.32.55;	author espie;	state Exp;
branches;
next	1.3;

1.3
date	2000.06.10.19.23.04;	author espie;	state Exp;
branches;
next	1.2;

1.2
date	2000.06.10.13.28.10;	author espie;	state Exp;
branches;
next	1.1;

1.1
date	2000.06.09.16.39.45;	author espie;	state Exp;
branches;
next	;


desc
@@


1.466
log
@explain new new COMPILER
@
text
@.\" $OpenBSD: bsd.port.mk.5,v 1.465 2017/07/12 22:52:54 sthen Exp $
.\"
.\" Copyright (c) 2000-2008 Marc Espie
.\"
.\" All rights reserved.
.\"
.\" Redistribution and use in source and binary forms, with or without
.\" modification, are permitted provided that the following conditions
.\" are met:
.\" 1. Redistributions of source code must retain the above copyright
.\"    notice, this list of conditions and the following disclaimer.
.\" 2. Redistributions in binary form must reproduce the above copyright
.\"    notice, this list of conditions and the following disclaimer in the
.\"    documentation and/or other materials provided with the distribution.
.\"
.\" THIS SOFTWARE IS PROVIDED BY THE DEVELOPERS ``AS IS'' AND ANY EXPRESS OR
.\" IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
.\" OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.
.\" IN NO EVENT SHALL THE DEVELOPERS BE LIABLE FOR ANY DIRECT, INDIRECT,
.\" INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT
.\" NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
.\" DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
.\" THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
.\" (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
.\" THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
.\"
.Dd $Mdocdate: July 12 2017 $
.Dt BSD.PORT.MK 5
.Os
.Sh NAME
.Nm bsd.port.mk
.Nd ports tree master Makefile fragment
.Sh SYNOPSIS
.Fd .include <bsd.port.mk>
.Sh DESCRIPTION
.Nm
contains the
.Xr ports 7
tree
.Xr make 1
framework, in the form of documented public targets,
variables and paths.
.Pp
Identifiers beginning with an underscore
are internal-use only and likely to change without
notice.
.Pp
This documentation contains sections covering targets, variables,
diagnostics, and filenames, ordered in alphabetic order, followed
by a section covering the fake framework, a section
explaining flavors and multi-packages, and a section covering
the generation of package information.
.Pp
It ends with sections covering obsolete targets, variables and files,
outlining conversion
methods from older incarnations of the ports tree or from other
.Bx
variants.
.Pp
.Nm
also uses quite a few helper scripts.
Those live under
.Pa ${PORTSDIR}/infrastructure/bin ,
and they do have manpages under
.Pa ${PORTSDIR}/infrastructure/man .
.Pp
Binary package details are mostly covered in
.Xr pkg_create 1
for the packing-list details,
and in
.Xr pkg_add 1
for the installation semantics.
.Pp
Common usage such as building every package in
the system is covered by
.Xr ports 7
and
.Xr bulk 8
instead, with
.Xr packages 7
providing an overview of the result.
.Sh TARGETS
.Bl -tag -width Ds
.It Cm {build,run,all,test}-dir-depends
Print all dependencies for a port in order to build it, run it, build and
run it, or to run regression tests.
The output is formatted as package specification pairs, in a form suitable
for
.Xr tsort 1 .
.It Cm full-{build,run,all,test}-depends
Print all dependencies a package depends upon for building, running,
or both, as a list of package names, sorted by dependency order with
.Xr tsort 1 ,
most dependent port first.
.It Cm {build,lib,test,run}-depends-list
Print a list of first level package specifications a port depends as
build dependencies, library dependencies, test dependencies or
run dependencies.
.It Cm print-{build,run}-depends
User convenience target that displays the result of
.Cm full-{build,run}-depends
in a more readable way.
.It Cm {pre,do,post}-*
Most standard targets can be specialized according to a given port's needs.
If defined,
the
.Cm pre-*
hook will be invoked before running the normal action;
the
.Cm do-*
hook will be invoked instead of the normal action;
the
.Cm post-*
hook will be invoked after the normal action.
Specialization hooks exist for
.Cm build ,
.Cm configure ,
.Cm distpatch ,
.Cm extract ,
.Cm fake ,
.Cm install ,
.Cm patch ,
.Cm test .
See individual targets for exceptions.
.It Cm all-lib-depends-args
Process the full
.Ev LIB_DEPENDS
list into a form suitable for
.Xr pkg_create 1 ,
see
.Cm print-package-args .
.It Cm build , Cm all
Default target.
Build the port.
Essentially invoke
.Bd -literal
env -i ${MAKE_ENV} ${MAKE_PROGRAM} ${MAKE_FLAGS} \e
	-f ${MAKE_FILE} ${ALL_TARGET}
.Ed
.It Cm check-register
Introspection target.
Verify from the ports tree, without building anything, that the current
subpackage will register okay
.Po
see
.Ev PLIST_REPOSITORY
.Pc .
.It Cm check-register-all
Apply
.Cm check-register
to all subpackages of the current port.
.It Cm checkpatch
Debugging version of the
.Cm patch
target that simulates invoking
.Xr patch 1 .
.It Cm checksum
Compute a
.Xr sha256 1
digest
of ${CHECKSUM_FILES} (files listed in DISTFILES and PATCHFILES) and
check it against ${CHECKSUM_FILE}, normally
.Pa distinfo .
In case of a mismatch, running
.Cm checksum
with
.Ev REFETCH Ns = Ns Cm true
will fetch alternative versions of files keyed on their checksum
fron the
.Ox
main archive site.
.It Cm clean
Clean ports contents.
By default, it will clean the work directory.
It can be invoked as
make clean='[depends build bulk work fake flavors dist install sub package
packages plist]'.
.Bl -tag -width packages
.It Va work
Clean work directory.
.It Va bulk
Clean bulk cookie.
.It Va build
Clean the
.Va WRKBUILD
directory (only useful if
.Va SEPARATE_BUILD
is set).
.It Va depends
Recurse into dependencies.
.It Va dist
Clean distribution files.
.It Va fake
Clean fake installation directory.
.It Va flavors
Clean all work directories.
.It Va install
Uninstall package.
.It Va package
Remove all copies of package file.
.It Va plist
Remove registered packing lists of all subpackages.
.It Va sub
With
.Va install
or
.Va package ,
clean subpackages as well.
.It Va packages
Shorthand for
.Sq sub package .
.It Va all
Shorthand for
.Sq work flavors packages plist .
.El
.It Cm clean-depends
Shorthand for
.Ql make clean=depends .
.It Cm configure
Configure the port.
By default,
.Cm configure
creates the ${WRKBUILD} directory (see SEPARATE_BUILD),
and runs whatever configuration methods are recorded in
.Ev CONFIGURE_STYLE .
.It Cm describe
Prints a one-line index entry of the port, suitable for
.Pa ${PORTSDIR}/INDEX .
.It Cm distclean
Shorthand for
.Ql make clean=dist .
.It Cm distpatch
Apply distribution patches only.
See
.Cm patch
and
.Ev PATCH_CASES
for details.
.It Cm dump-vars
Dump the values of all relevant variables in a port, prepended with the
port's FULLPKGPATH.
.It Cm extract
Extract the distribution files under
.Pa ${WRKDIR}
(but see
.Ev EXTRACT_ONLY
and
.Ev NO_DEPENDS ) .
Refer to
.Ev EXTRACT_CASES
for a complete description.
Do not use
.Cm pre-extract
and
.Cm do-extract
hooks.
.It Cm fake
Do a fake port installation, that is, simulate the port installation under
${WRKINST}.
There is no
.Cm do-fake
and
.Cm post-fake
hooks.
.Cm fake
actually uses
.Cm pre-fake ,
.Cm pre-install ,
.Cm do-install
and
.Cm post-install .
Override
.Cm pre-install ,
.Cm do-install ,
or
.Cm post-install
to change behavior.
Do not touch
.Cm pre-fake
unless you really know what you are doing.
See
.Sx THE FAKE FRAMEWORK
section below.
.It Cm fake-wantlib-args
Check
.Ev WANTLIB
against the list of installed packages and libraries in the ports tree.
See
.Cm print-package-args .
.It Cm fetch
Fetch the list of files in
.Ev DISTFILES
and
.Ev PATCHFILES
using ${FETCH_CMD}.
Files are normally retrieved from the list of sites in
.Ev MASTER_SITES .
.Pp
Appending
.Sq :0
to
.Sq :9
to an entry will let
${FETCH_CMD} retrieve from
.Ev MASTER_SITES0
to
.Ev MASTER_SITES9
instead.
If the rest of the entry parses as
.Sq Ar filename Ns { Ns Ar url Ns } Ns Ar sufx
${FETCH_CMD} will fetch
.Ar url Ns Ar sufx
instead, but store the result as
.Ar filename Ns Ar sufx .
.Pp
Transfers in progress are stored as
.Ar filenamesufx.part
and moved after completion.
.Pp
The ports framework uses
.Pa ${DISTDIR}/${DIST_SUBDIR}
(aliased to
.Pa ${FULLDISTDIR} )
to save the ports distribution files and patch files.
.Pp
If you want to fetch a significant number of distfiles quickly, say
all files relevant to a port,
.Cm dpb Fl F
is more efficient.
.Pp
Use of
.Cm {pre,do,post}-fetch
hooks is forbidden, as this would make mirroring of distfiles very complicated.
.Pp
See
.Ev CHECKSUMFILES ,
.Ev DISTDIR ,
.Ev DISTFILES ,
.Ev DIST_SUBDIR ,
.Ev FETCH_CMD ,
.Ev FETCH_MANUALLY ,
.Ev FETCH_SYMLINK_DISTFILES ,
.Ev FULLDISTDIR ,
.Ev MAKESUMFILES ,
.Ev MASTER_SITES ,
.Ev MASTER_SITES0 , ... ,
.Ev MASTER_SITES9 ,
.Ev PATCHFILES ,
.Ev SUPDISTFILES ,
.Ev REFETCH .
.It Cm fetch-all
Like
.Cm fetch ,
but also fetches
.Ev SUPDISTFILES ,
for use with e.g.,
.Cm makesum .
.It Cm generate-readmes
Generate READMEs and rc scripts from
.Pa ${PKGDIR}
into
.Pa ${WRKINST} .
Run after
.Cm fake
and before
.Cm package
or
.Cm update-plist .
Always rerun, as it is cheap enough.
.It Cm index
Top-level target, see
.Xr ports 7 .
.It Cm install-depends
Before package installation, install and verify dependencies constructed from
.Ev RUN_DEPENDS , LIB_DEPENDS ,
and
.Ev WANTLIB .
.It Cm install
Install the package after building.
See the description of
.Sx THE FAKE FRAMEWORK
for the non-intuitive details of the way
.Cm {pre,do,post}-install
hooks are actually used by the ports tree.
.It Cm install-all
Install all packages in a multi-packages port.
.It Cm lib-depends-args
Filter
.Ev LIB_DEPENDS
to keep only entries required by
.Ev WANTLIB ,
and output a list of dependencies suitable for
.Xr pkg_create 1 ,
see
.Cm print-package-args .
.It Cm lib-depends-check
Verify that the
.Ev LIB_DEPENDS
and
.Ev WANTLIB
are accurate for the port.
See
.Cm port-lib-depends-check ,
which is quicker.
.It Cm license-check
Check that
.Ev PERMIT_PACKAGE_*
settings match:
if any dependency has a more restrictive setting, warn about it.
This warning is advisory, because the automated license checking cannot
figure out which ports were used only for building and did not taint
the current port.
.It Cm lock
Manually obtain a lock on a given directory.
Output must be used to update environment variables.
The lock can be released with
.Cm unlock .
Seldom used, see
.Xr ports 7
for details.
.It Cm makesum
Run
.Xr sha256 1
on ${MAKESUMFILES}
that is, files listed in ${DISTFILES}, ${SUPDISTFILES} and ${PATCHFILES},
and store the result in ${CHECKSUM_FILE}, normally
.Pa distinfo .
Also store the lengths of all files for a quick check during
.Cm fetch .
.It Cm manpages-check
Verify that
.Xr makewhatis 8
can do a correct job with the port's manpages.
.It Cm no-lib-depends-args
Degenerate form of
.Cm lib-depends-args
that does not do anything.
See
.Cm print-package-args .
.It Cm no-wantlib-args
Degenerate form of
.Cm wantlib-args
that does not do anything.
See
.Cm print-package-args .
.It Cm package
Build a port package (or packages in a
.Ev MULTI_PACKAGES
case) from the fake installation.
Involves creating packaging information from templates
(see
.Ev COMMENT ,
.Ev SUBST_VARS
among others) and invoking
.Xr pkg_create 1
for each package in the
.Ev MULTI_PACKAGES
list.
If the repository already contains up-to-date packages, they are not rebuilt.
If PLIST_REPOSITORY is set, the resulting packaging information is compared
with existing stuff, and saved if new, with loud complaints if it changed
without a REVISION bump.
Arch-independent packages are created in ${PACKAGE_REPOSITORY}/no-arch,
and copied into ${PACKAGE_REPOSITORY}/${MACHINE_ARCH}/all as needed.
If ${PERMIT_PACKAGE_FTP} is set to
.Sq Yes ,
copies built packages into ${PACKAGE_REPOSITORY}/${MACHINE_ARCH}/ftp, using
hard links if possible.
If ${PERMIT_PACKAGE_CDROM} is set to
.Sq Yes ,
copies built packages into ${PACKAGE_REPOSITORY}/${MACHINE_ARCH}/cdrom, using
hard links if possible.
.It Cm patch
Apply distribution and
.Ox
specific patches.
Because of historical accident,
.Cm patch
does not follow the exact same scheme other standard targets do.
Namely,
.Cm patch
invokes
.Cm pre-patch
(if defined),
.Cm do-patch ,
and
.Cm post-patch ,
but the default
.Cm do-patch
target invokes
.Cm distpatch
directly.
So, if the
.Cm do-patch
target is overridden, it should still begin by calling
.Ql make distpatch ,
before applying
.Ox
specific patches.
Accordingly, the exact sequence of hooks is:
.Cm pre-patch ,
.Cm do-distpatch ,
.Cm post-distpatch ,
.Cm do-patch ,
.Cm post-patch .
If
.Pa ${PATCHDIR}
exists, the files described under
.Ev PATCH_LIST
will be applied under
.Ev WRKDIST .
See also
.Ev REORDER_DEPENDENCIES
for possible
.Cm post-patch
clean-up.
.It Cm peek-ftp
Connect to the first site in
.Ev MASTER_SITES ,
in the right directory, and leaves user at
.Xr ftp 1 Ns 's
prompt.
.It Cm pkglocatedb
Top-level target, see
.Xr ports 7 .
.It Cm port-lib-depends-check
Verify that the
.Ev LIB_DEPENDS
and
.Ev WANTLIB
hold all shared libraries used for every package in the port.
See
.Xr library-specs 7 .
This makes use of
.Cm print-plist-with-depends
to avoid actually building the packages, it only needs the
completion of the
.Cm fake
stage, and thus is quicker than
.Cm lib-depends-check ,
unless you already have all binary packages.
.It Cm port-wantlib-args
Resolve
.Ev WANTLIB
against the ports tree itself and system libraries, without looking at built
or installed packages, and writes a list of options suitable for
.Xr pkg_create 1 .
See
.Cm print-package-args .
.It Cm prepare
Before port building, install and verify dependencies constructed from
.Ev BUILD_DEPENDS ,
.Ev LIB_DEPENDS
and
.Ev WANTLIB .
In
.Ev MULTI_PACKAGES
setups,
see
.Sx FLAVORS AND MULTI_PACKAGES .
.It Cm print-package-args
Print all dependency-related information that will be passed as parameters
to
.Xr pkg_create 1 ,
e.g.,
.Fl W Ar wantlib
and
.Fl P Ar depends
lines.
.Pp
Those parameters are generated by
.Cm run-depends-args
for
.Ev RUN_DEPENDENCIES
handling, a form of
.Cm lib-depends-args
for
.Ev LIB_DEPENDS
and
.Ev WANTLIB
interaction,
and a form of
.Cm wantlib-args
for
.Ev WANTLIB
resolution.
.Pp
Variables
.Ev lib_depends_args
and
.Ev wantlib_args
control the exact behavior:
.Ev lib_depends_args
is normally set to
.Cm lib-depends-args ,
but will be set to
.Cm all-lib-depends-args
by
.Cm port-lib-depends-check ,
in order to have access to the full list of LIB_DEPENDS for figuring
out missing WANTLIB.
.Ev wantlib_args
is normally set to
.Cm wantlib-args
but it may be set to
.Cm port-wantlib-args
for introspection purposes,
to
.Cm fake-wantlib-args
to avoid some checks, or to
.Cm no-wantlib-args
to avoid expensive WANTLIB checks entirely.
.It Cm print-update-signature
Print the update signature, as computed using information from the ports tree,
in the same format used for
.Xr pkg_info 1
.Fl S .
.It Cm print-plist
Generate and print a package packing-list from the static information
present in the port.
.It Cm print-plist-all
Iterate over
.Cm print-plist
for all subpackages in a given port.
.It Cm print-plist-all-with-depends
Iterate over
.Cm print-plist-with-depends
for all subpackages in a given port.
.It Cm print-plist-contents
Generate and print package contents from the static information
present in the port.
In contrast with
.Cm print-plist ,
the package contents only consists of files, all tagged with category
markers such as @@file.
See
.Xr pkg_create 1 .
.It Cm print-plist-libs
Generate and print the list of static and dynamic libraries present in the port.
See
.Xr pkg_create 1 .
.It Cm print-plist-libs-with-depends
Like
.Cm print-plist-libs ,
but slower.
It also handles
.Ev LIB_DEPENDS ,
.Ev RUN_DEPENDS ,
and
.Ev WANTLIB ,
so that the packing-list has complete dependency information.
.It Cm print-plist-with-depends
Like
.Cm print-plist ,
but slower.
It also handles
.Ev LIB_DEPENDS ,
.Ev RUN_DEPENDS ,
and
.Ev WANTLIB ,
so that the packing-list is complete.
.It Cm rebuild
Force rebuild of the port.
.It Cm reinstall
Force reinstallation of a port, by first cleaning the old installation.
Seldom needed, as
.Cm update
will often do the right thing.
.It Cm repackage
Rebuild the packages of a port after removing existing packages.
.It Cm run-depends-args
Process
.Ev RUN_DEPENDS
and outputs a list of dependencies suitable for
.Xr pkg_create 1 ,
see
.Cm print-package-args .
.It Cm show
Invoked as make show=name, show the contents of ${name}.
Invoked as make show="name1 name2 ...",
show the contents of ${name1} ${name2} ...,
one variable value per line.
Mostly used from recursive makes, or to know the contents of another
port's variables without guessing wrongly.
.It Cm show-fake-size
Print the size of ${WRKINST}.
Used by some options of
.Xr dpb 1 ,
suitable for
.Ev BULK_TARGETS .
.It Cm show-prepare-results
Print the list of actual installed packages found out by
.Cm prepare .
.It Cm show-prepare-test-results
Print the list of actual installed packages found out by
.Cm prepare
and
.Cm test-depends .
.It Cm show-required-by
Print the list of
.Xr pkgpath 7
for all ports that will be affected by the
current port changing.
Works by walking the list of dependencies, in reverse.
.It Cm show-run-depends
Print all running dependencies for a port, one per-line, without duplicates.
.It Cm subpackage
Build a port package.
Exactly like
.Cm package ,
but affects only one single subpackage in multi-packages ports.
.It Cm show-size
Prints the size of the work directory.
Used by some options of
.Xr dpb 1 ,
suitable for
.Ev BULK_TARGETS .
.It Cm subupdate
Update an existing installation to a newer package, exactly
like
.Cm update ,
but affects only one single subpackage in multi-packages ports.
.It Cm test
Run regression tests for the port.
Essentially depend on a correct build and invoke
.Bd -literal
env -i ${ALL_TEST_ENV} ${MAKE_PROGRAM} ${ALL_TEST_FLAGS} \e
	-f ${MAKE_FILE} ${TEST_TARGET} ${TEST_LOG}
.Ed
.Pp
If a port needs some other ports installed to run regression tests,
use
.Ev TEST_DEPENDS .
If a port needs special configuration or build options to enable regression
testing, define a
.Sq test
.Ev FLAVOR .
.It Cm test-depends
Before running regression tests, Install and verify dependencies
constructed from
.Ev TEST_DEPENDS .
.It Cm unlock
Manually release a lock on a given directory.
See
.Cm lock .
.It Cm update-patches
Create or update patches for a port, using
.Xr update-patches 1 ,
which invokes
.Xr diff 1
between
.Pa file
and
.Pa file.orig ,
based on
.Pa file.orig
existence.
In order to generate a patch, the original file needs to be named
.Pa file.orig
and
.Pa file
edited.
After the target is invoked, the patches are placed under the
patches/ directory.
It moves existing patches from
.Pa patch-file
to
.Pa patch-file.orig .
.It Cm update
Update an existing installation to a newer package:
scan the installation for a package with the same
.Ev FULLPKGPATH ,
and update it using
.Sq pkg_add -r
if a newer package is available.
In multi-packages ports, all relevant packages are updated.
See
.Ev UPDATE_COOKIES_DIR
and
.Ev FORCE_UPDATE
as well.
.It Cm update-or-install
Update an installed package or perform a fresh installation,
by using
.Sq pkg_add -r .
Handles one single package in multi-packages ports.
See
.Ev UPDATE_COOKIES_DIR
and
.Ev FORCE_UPDATE
as well.
.It Cm update-or-install-all
Update installed packages or perform a fresh installation,
by using
.Sq pkg_add -r .
Handles all packages in multi-packages ports.
See
.Ev UPDATE_COOKIES_DIR
and
.Ev FORCE_UPDATE
as well.
.It Cm update-plist
Update the packing lists for a port, using the fake installation and the
existing packing lists.
.Cm update-plist
should produce a mostly correct
.Pa PLIST
file, handling GNU
.Xr info 1
files, setuid files, and empty directories.
It moves an existing file to
.Pa PLIST.orig .
If the generated list includes files and directories that shouldn't be
included, comment these like this:
.Bd -literal
@@comment unwanted-file
@@comment unwanted-dir/
.Ed
.Pp
Subsequent calls to
.Cm update-plist
will automatically recognize and handle such lines correctly.
.Pp
.Cm update-plist
may not handle flavor and multi-packages situations correctly yet, so beware.
.It Cm verbose-show
Similar to
.Cm show ,
except that it prefixes each value with the variable name, e.g.,
.Li VAR=value .
Also note that it does not show undefined variables, contrary to
.Cm show
which outputs blank lines for these.
.It Cm wantlib-args
Call
.Cm port-wantlib-args
and
.Cm fake-wantlib-args
and compare the results, errors out in case of discrepancies.
See
.Cm print-package-args .
.El
.Sh VARIABLES
Note that some variables are marked as
.Sq User settings ,
which means that individual ports should not modify them,
and that some variables are marked as
.Sq read-only ,
which means that they shouldn't ever be changed.
In a
.Ev MULTI_PACKAGES
setup, some variables have settings specific to a given subpackage.
See
.Sx FLAVORS AND MULTI_PACKAGES .
.Bl -tag -width Ds
.It Ev show
Invoked as make show=name, show the contents of ${name}.
Invoked as make show="name1 name2 ...", show the contents of
${name1} ${name2} ...,
one variable value per line.
.It Ev ALL_FAKE_FLAGS
Flags passed to ${MAKE} invocations during the fake process.
Equals
.Li ${MAKE_FLAGS} ${DESTDIRNAME}=${WRKINST} ${FAKE_FLAGS} .
Read-only.
.It Ev ALL_TEST_ENV
Environment passed to test.
Equals
.Li ${MAKE_ENV} ${TEST_ENV} .
Read-only.
.It Ev ALL_TEST_FLAGS
Flags passed to ${MAKE} invocations during test.
Equals
.Li ${MAKE_FLAGS} ${TEST_FLAGS} .
Read-only.
.It Ev ALL_TARGET
Target used to build software.
Default is
.Sq all .
Can be set to empty, to yield a package's default target.
.It Ev APM_ARCHS
Set to the list of
.Xr apm 4
architectures.
Read-only.
Use with
.Ev ONLY_FOR_ARCHS .
.It Ev ARCH
Current machine architecture.
Read-only.
.It Ev AUTOCONF
Location of the autoconf binary if needed.
Defaults to autoconf (though autoreconf might be more appropriate).
.It Ev AUTOCONF_DIR
Where to invoke autoconf if ${CONFIGURE_STYLE} includes autoconf.
Defaults to ${WRKSRC}.
.\" AUTOCONF_DIR should probably be a list, and be renamed to AUTOCONF_DIRS ?
.It Ev AUTOCONF_VERSION
Starting with
.Ox 3.3 ,
several versions of autoconf may coexist peacefully.
The main autoconf script is a shell wrapper in the
.Pa devel/metaauto
package, and similarly for automake.
Setting
.Ev AUTOCONF_VERSION
along with
.Ev CONFIGURE_STYLE
set to autoconf is the correct way to specify which one to use.
.Ev AUTOCONF_VERSION
defaults to 2.13.
If autoconf must be run manually,
.Ev MODGNU_AUTOCONF_DEPENDS
can be used to specify what packages to depend upon.
.It Ev AUTOHEADER
Location of the autoheader binary.
Defaults to autoheader.
.It Ev AUTOMAKE_VERSION
Several versions of automake may coexist peacefully.
.Ev AUTOMAKE_VERSION
must be set before trying to run automake.
Defaults to 1.4.
Note that even if
.Ev CONFIGURE_STYLE
includes automake,
automake should still be run manually during the right
.Cm configure
stage.
.It Ev AUTOUPDATE
Location of the autoupdate binary.
Defaults to autoupdate.
.It Ev BASE_PKGPATH
Full
.Xr pkgpath 7
to the current port, taking flavors into account.
See also
.Ev BUILD_PKGPATH ,
which also includes pseudo-flavors.
Read-only.
.It Ev BASELOCALSTATEDIR
User settings.
Base location for system-wide state directory.
Defaults to
.Pa ${VARBASE} .
See
.Ev LOCALSTATEDIR .
.It Ev BASESYSCONFDIR
User settings.
Base location for system-wide configuration files.
Defaults to
.Pa /etc .
See
.Ev SYSCONFDIR .
.It Ev BATCH
User settings.
Set to
.Sq Yes
to avoid ports that require user-interaction.
Use in conjunction with
.Ev INTERACTIVE
to simplify bulk-package builds.
.Pq See IGNORE .
.It Ev BE_ARCHS
Set to the list of big-endian architectures.
Read-only.
Use with
.Ev NOT_FOR_ARCHS
and
.Ev ONLY_FOR_ARCHS .
.It Ev BUILD_PACKAGES
The actual list of packages that will be built, once architecture problems
and pseudo-flavors have been taken into account.
See
.Sx FLAVORS AND MULTI_PACKAGES .
.It Ev BROKEN
Define only for broken ports, set to reason the port is broken.
See also
.Ev NO_IGNORE ,
.Ev TRY_BROKEN .
.It Ev BROKEN-<arch>
Define only for ports broken on a given architecture.
Distinct from
.Ev ONLY_FOR_ARCHS
and
.Ev NOT_FOR_ARCHS ,
which are used to mark ports for which support for some architectures
does not exist at all, or is completely obsolete.
.It Ev BSD_INSTALL_{PROGRAM,SCRIPT,DATA,MAN}[_DIR]
Macros passed to make and configure invocations.
Set based on corresponding INSTALL_* variables.
.It Ev BUILD_DEPENDS
List of other ports the current port needs to build correctly.
Each item has the form
.Sq [pkgspec:]pkgpath[:target] .
.Sq target
defaults to
.Sq install .
The package installed must conform to the
.Sq pkgspec ,
which is by default obtained from the dependent
.Sq pkgpath
.Po
see
.Ev PKGSPEC
.Pc .
If no installation is involved, the infrastructure will still check
that the directory would provide a package conforming to the
.Sq pkgspec .
.Sq pkgpath
is set relative to ${PORTSDIR},
see
.Xr pkgpath 7
for details.
Build dependencies are checked before the
.Cm extract
stage during
.Cm prepare .
.Pp
Build dependencies with a
.Cm patch ,
.Cm configure
or
.Cm build
target will be processed in a subdirectory of the working directory,
specifically, in ${WRKDIR}/some/directory,
with
.Pa some/directory
the directory part of the
.Sq pkgpath .
.It Ev BUILD_ONCE
User settings.
Defaults to
.Sq \&No .
Set to
.Sq Yes
during bulk builds.
.Pp
When
.Ev BUILD_ONCE
is set to
.Sq Yes ,
all
.Ev PSEUDO_FLAVORS
matching
.Sq no_*
will be disabled, unless the special pseudo-flavor
.Sq bootstrap
is also set.
.Pp
This is a bulk build optimisation, automatically set by
.Xr dpb 1 :
to avoid rebuilding the same package several times, a full bulk build will
strip most ports of pseudo-packages variations that remove subpackages.
.Pp
For instance, an individual package may depend on
.Pa databases/db/v4,no_java,no_tcl ,
to avoid bringing a jdk in during a quick build.
Nevertheless, during a full bulk build,
.Pa databases/db/v4
will only be built once, as the pseudo-flavor will be automatically removed.
.Pp
However, the extra
.Sq bootstrap
rule is needed to take build cycles into account.
For instance, the
.Pa x11/gnome/gvfs,-goa
subpackage depends on gnome-online-accounts, which in turn requires
.Pa x11/gnome/gvfs,-main
to build (through its dependencies).
So
.Pa x11/gnome/gvfs
has
.Li PSEUDO_FLAVORS = no_smb no_goa bootstrap
and the GNOME build first builds
.Pa x11/gnome/gvfs,no_smb,no_goa,bootstrap,-main
which is later used to rebuild
.Pa x11/gnome/gvfs .
.It Ev BUILD_PKGPATH
Full
.Xr pkgpath 7
to the current port, taking flavors and pseudo-flavors
into account.
See also
.Ev BASE_PKGPATH ,
which doesn't include pseudo-flavors.
Mostly useful to write dependencies for subpackages like this:
.Li "LIB_DEPENDS-foo=${BUILD_PKGPATH}"
and avoid starting to build a package with some other flavor combination.
See
.Xr pkgpath 7
on the subject of
.Sq pkgpath normalisation .
Read-only.
.It Ev BULK
User settings.
If set to
.Sq Yes ,
all successful package builds and installations will clean
their working directories, after invoking
any targets mentioned in BULK_TARGETS,
and commands mentioned in BULK_DO.
Can be set on a per-${PKGPATH} basis.
For instance, setting BULK_misc/screen=No
will override any BULK=Yes passed on the command line.
If set to
.Sq Auto ,
it will apply to dependencies, but not to the current port itself.
See
.Ev BULK_COOKIES_DIR .
Defaults to
.Sq Auto .
.It Ev BULK_COOKIES_DIR
User settings.
Used to store cookies for successful bulk-package builds, defaults to
.Pa ${PORTSDIR}/bulk/${MACHINE_ARCH} .
.It Ev BULK_DO
Commands to run after each bulk package build before cleaning up the
working directory.
Empty defaults.
Can be set on a per-${PKGPATH} basis, e.g.,
BULK_DO_${PKGPATH}=...
.It Ev BULK_FLAGS
Flags to pass to build each target in
.Ev BULK_TARGETS .
.It Ev BULK_TARGETS
Targets to run after each bulk package build before cleaning up the
working directory.
Empty defaults.
Can be set on a per-${PKGPATH} basis, e.g.,
BULK_TARGETS_${PKGPATH}=...
.It Ev BZIP2
Name of the bzip2 binary.
.It Ev CATEGORIES
List of descriptive categories into which this port falls.
Mandatory.
One entry must match the current pkgpath:
.Pa devel/gmake
must belong to the
.Sq devel
category.
See
.Cm link-categories ,
.Cm unlink-categories .
.It Ev CCACHE_DIR
Sets the cache directory used when
.Ev USE_CCACHE
is set to yes.
Defaults to ${WRKOBJDIR}/.ccache.
.It Ev CCACHE_ENV
Sets additional environment variables when
.Ev USE_CCACHE
is set to yes.
For instance, to enable verbose logging, set
CCACHE_ENV="CCACHE_LOGFILE=/tmp/ccache.log"
.It Ev CDIAGFLAGS
Flags appended to
.Ev CFLAGS
if
.Ev WARNINGS
is set.
.It Ev CFLAGS
Default flags passed to the compiler for building.
Many ports ignore it.
See also
.Ev COPTS ,
.Ev CDIAGFLAGS .
.It Ev CHECK_LIB_DEPENDS
User settings.
If set to
.Sq Yes ,
every package build will verify that shared libraries are correctly
registered.
This is essentially the same as running
.Ql make lib-depends-check
after each package build.
Defaults to
.Sq \&No ,
as this can be a big performance hit.
.It Ev CHECKSUMFILES
List of all files that need to be retrieved by
.Cm fetch ,
with
.Ev DIST_SUBDIR
prepended and with the master site selection extension removed.
Read-only.
See also
.Ev MAKESUMFILES .
.It Ev CHECKSUM_FILE
Location for this port's checksums, used by
.Cm checksum ,
and
.Cm makesum .
Defaults to
.Pa distinfo .
.It Ev CHECKSUM_PACKAGES
User settings.
Choose whether or not to checksum packages while building.
Deposits result in
.Pa ${PACKAGE_REPOSITORY}/${MACHINE_ARCH}/cksums/${FULLPKGNAME}.sha256 .
Can be set to
.Sq Yes
to compute a checksum for all packages,
.Sq cdrom
to compute it only for
.Ev PERMIT_PACKAGE_CDROM
packages
or to
.Sq ftp
to compute it only for
.Ev PERMIT_PACKAGE_FTP
packages.
Defaults to
.Sq no ,
which does not compute a checksum at all.
.It Ev CHOSEN_COMPILER
Read-only.
Compiler suite chosen by the
.Ev COMPILER
mechanism.
Set to
.Sq irrelevant
to disable
.Ev COMPILER .
.It Ev CLEANDEPENDS
If set to
.Sq Yes ,
the
.Cm clean
target will also clean dependencies.
Can be overridden on a per-${PKGPATH} basis,
by setting CLEANDEPENDS_${PKGPATH}.
.It Ev COMMENT
Short (no more than 60 characters) description of the port, used for
the package and the INDEX.
It should not start with an uppercase letter unless semantically
significant.
.It Ev COMMENT-foo
Same as COMMENT but used for sub package -foo in a multi-package setup.
.It Ev COMMENT-vanilla
Same as COMMENT but used for a flavored package, if the non-flavored comment
is inappropriate.
.It Ev COMMENT-foo-vanilla
Same as COMMENT but used for a sub-, flavored package.
.It Ev COMES_WITH
The first release where the port was made part of the standard
distribution.
If the current
.Ox
version is >= this version then a notice
will be displayed instead of the port being built.
.It Ev COMPILER
Select preferred compiler.
First element in the list that matches will be chosen.
.Bl -tag -width ports-gccxx
.It base-gcc
gcc 4.2 compiler from base
.It base-clang
clang compiler from base
.It gcc3
gcc 3 compiler from base
.It ports-gcc
gcc 4.9 compiler from ports
(heeds
.Ev MODGCC4_ARCHS
from the module)
.It ports-clang
clang compiler from ports
(heeds
.Ev MODCLANG_ARCHS
from the module)
.El
.Pp
The first compiler that matches criteria will be chosen.
On clang-based architectures, even though gcc is still compiled in base,
.Sq base-gcc
never matches.
.Pp
Defaults to base compilers, e.g.,
.Sq base-clang base-gcc gcc3 .
.Pp
As a transition mechanism,
.Sq gcc
is a shortcut for
.Sq base-clang ports-gcc
and
.Sq clang
is a shortcut for
.Sq base-clang ports-clang .
.Pp
Common reasons for explicitly setting
.Ev COMPILER
will most often be C++11 support, thread-local-storage support (emulated),
atomic operations on some arches, sometimes assembler support, ABI
compatibility with dependent/depending ports, or plain old internal compiler
errors.
.Pp
With
.Ev COMPILER
in effect,
.Ev MODGCC4_ARCHS
and
.Ev MODCLANG_ARCHS
default to
.Sq ${GCC49_ARCHS}
and
.Sq ${LLVM_ARCHS}
respectively.
.Pp
.Ev ONLY_FOR_ARCHS
will also be set if applicable.
.It Ev COMPILER_LANGS
The value of
.Ev COMPILER_LANGS
will be added to the respective module's supported langs.
Defaults to
.Sq c c++ .
Only
.Sq c
and
.Sq c++
are supported by this mechanism.
.Sq fortran
or
.Sq java
still need old modules annotations, so that it's possible
to select, e.g.,
.Sq gfortran
from gcc 4.9 while having clang from base.
See also
.Ev CHOSEN_COMPILER .
.It Ev COMPILER_LINKS
Used by
.Nm
and compiler
.Ev MODULES
to build scripts in
.Pa ${WRKDIR}/bin
to force setting compiler flags
.Po
.Fl B
is required for clang to find
.Pa ${WRKDIR}/bin/ld
as used by
.Ev USE_WXNEEDED
.Pc
and call
.Ev COMPILER_WRAPPER
if used.
.It Ev COMPILER_WRAPPER
External program used to "wrap" compilers.
Populated automatically by
.Ev USE_CCACHE
or can be set explicitly for other purposes (e.g. distcc).
.It Ev CONFIG_SITE_LIST
Used when
.Li CONFIGURE_STYLE=gnu ,
or with
.Li MODULES += gnu .
List of
.Pa config.site
fragments that will speed up gnu-configure, and prevent it from
preferring various gnu programs, unless
.Ev BUILD_DEPENDS
explicitly ask for them.
Read-only, available for debugging purposes.
.It Ev CLANG_ARCHS, GCC3_ARCHS , GCC4_ARCHS
List of architectures using Clang, GCC 3.3.6 or GCC 4.2.1 as the base compiler.
Read-only.
Use with
.Ev NOT_FOR_ARCHS
or
.Ev ONLY_FOR_ARCHS
to limit ports to architectures where they compile.
.It Ev CONFIGURE_ARGS
Arguments to pass to configure script.
Defaults are empty, except for
GNU-style configure, where prefix and sysconfdir are set.
.It Ev CONFIGURE_ENV
Basic environment passed to configure script (path and libtool setup).
GNU-style configure adds a lot more variables.
.It Ev CONFIGURE_SCRIPT
Set to name of script invoked by the
.Cm configure
target, if appropriate.
Should be either an absolute path, or relative to ${WRKSRC}.
.It Ev CONFIGURE_STYLE
Set to style of configuration that needs to happen.
.Pp
If
.Sq perl ,
assume
.Xr perl 1 Ns 's
.Xr ExtUtils::MakeMaker 3p
style.
Add
.Sq modbuild
to enable
.Xr Module::Build 3p ,
.Sq modbuild tiny
to enable
.Xr Module::Build::Tiny 3p ,
or
.Sq modinst
for
.Xr Module::Install 3p
style.
.Pp
If
.Sq gnu ,
assume
GNU configure style.
Add
.Sq dest
if port does not handle DESTDIR correctly, and needs to be configured to
add DESTDIR to prefixes
.Po
see also
.Ev DESTDIRNAME
.Pc .
Add
.Sq old
if port is an older autoconf port that does not recognize --sysconfdir.
Add
.Sq autoconf
if autoconf needs to be rerun first,
but set
.Sq no-autoheader
to prevent autoheader from running.
Add
.Sq automake
if automake may need to be rerun.
Otherwise, automake will be explicitly disabled.
Note that automake is never run automatically.
In order to use it,
.Ev CONFIGURE_STYLE
should include
.Sq automake
and there should be a
.Cm {pre,do}-configure
target running automake.
.Pp
If
.Sq imake ,
assume port configures using X11 ports Imakefile framework.
Add
.Sq noman
if port has no man pages the Imakefile should try installing.
.Pp
If
.Sq simple ,
there is a configure script, but it does not fit the normal GNU configure
conventions.
.Pp
Extensions may be defined by specific MODULES.
See
.Xr port-modules 5
for details.
.It Ev COPTS
User settings.
Supplementary options appended to ${CFLAGS} for building.
Since most ports ignore the COPTS convention, they are actually told to use
${CFLAGS} ${COPTS} as CFLAGS.
.It Ev CXXDIAGFLAGS
Flags appended to
.Ev CXXFLAGS
if
.Ev WARNINGS
is set.
.It Ev CXXFLAGS
Default flags passed to the C++ compiler for building.
Many ports ignore it.
.It Ev CXXOPTS
User settings.
Supplementary options appended to ${CXXFLAGS} for building.
.It Ev DESTDIR
See
.Ev DESTDIRNAME .
.It Ev DESTDIRNAME
Name of variable to set to ${WRKINST} while faking.
Usually DESTDIR.
To be used in the rare cases where a port heeds DESTDIR in a few
directories and needs to be configured with
.Sq gnu dest ,
so that those few directories do not get in the way.
.It Ev DISTDIR
User settings.
Directory where all ports distribution files and patchfiles are stashed.
Defaults to
.Pa ${PORTSDIR}/distfiles .
Override if distribution files are stored elsewhere.
Always use
.Ev FULLDISTDIR
to refer to ports' distribution files location, as it takes an eventual
.Ev DIST_SUBDIR
into account.
.It Ev DISTFILES
The main port's distribution files (the actual software source, except
for binary-only ports).
Will be retrieved from the MASTER_SITES (see
.Cm fetch ) ,
checksummed and extracted (see
.Cm checksum ,
.Cm extract ) .
.Ev DISTFILES
normally holds a list of files, possibly with
.Sq :0
to
.Sq :9
appended to select a different
.Ev MASTER_SITES .
.Pp
Each entry may optionally be of the form
.Sq Ar filename Ns { Ns Ar url Ns } Ns Ar sufx
to deal with sites that only offer archives as weird urls, doing the transfer
of
.Ar url Ns Ar sufx
into result file
.Ar filename Ns Ar sufx .
For instance, if
.Bd -literal
DISTFILES = minetest-{minetest/archive/}${V}${EXTRACT_SUFX}
.Ed
.Pp
then
.Cm fetch
will retrieve from url
.Sq minetest/archive/${V}${EXTRACT_SUFX}
into
.Sq minetest-${V}${EXTRACT_SUFX} .
.Pp
If ${DISTFILES} varies depending on FLAVORS or architecture,
use
.Ev SUPDISTFILES
to ensure distfiles mirroring and
.Cm makesum
proper operation.
.It Ev DISTNAME
Name used to identify the port.
See
.Ev DISTFILES
and
.Ev PKGNAME .
.It Ev DISTORIG
Suffix used by
.Cm distpatch
to rename original files.
Defaults to
.Pa .bak.orig .
Distinct from
.Pa .orig
to avoid confusing
.Cm update-patches .
.It Ev DIST_SUBDIR
Optional subdirectory of ${DISTDIR} where the current port's distribution
files and patchfiles will be located.
See target
.Cm fetch .
.It Ev DPB
Set by the distributed ports builder to only get the information it needs
from
.Cm dump-vars .
.It Ev ECHO_MSG
User settings.
Used to display
.Sq ===> Configuring for foo
and similar informative messages.
Override to turn off, for instance.
.It Ev ECHO_REORDER
User settings.
Set it to
.Sq echo
to see
.Ev REORDER_DEPENDENCIES
actions.
Silent by default.
.It Ev EPOCH
Epoch number of the current package.
Defaults to empty (no need for numbering changes), then
numbering starts at 0.
Gets automatically incorporated into
.Ev FULLPKGNAME
as
.Sq v${EPOCH}
to form a full package-name conforming to
.Xr packages-specs 7 .
.It Ev ERRORS
List of errors found while parsing the port's Makefile.
Display the errors before making any target, and if any error starts with
.Qq Fatal: ,
do not make anything.
For instance:
.Bd -literal -offset indent
\&.if !defined(COMMENT)
ERRORS+="Fatal: Missing comment"
\&.endif
.Ed
Porter can add to
.Ev ERRORS ,
for instance to flag erroneous combinations of
.Ev FLAVORS
(but see
.Ev ONLY_FOR_ARCHS
.Ev NOT_FOR_ARCHS
and
.Ev BROKEN
for other common issues).
.It Ev EXTRACT_CASES
In the normal extraction stage (when
.Ev EXTRACT_ONLY
is not empty), this is the contents of a case statement, used to extract files.
Fragments are automatically appended to extract tar, xz and zip
archives, so that the default case is more or less equivalent to the
following shell fragment:
.Bd -literal
set -e
cd ${WRKDIR}
for archive in ${EXTRACT_ONLY}
do
    case $$archive in
	*.tar.xz|*.tar.lzma)
	  xzcat ${FULLDISTDIR}/$$archive| tar xf -;;
	*.tar.lz)
	  lunzip -c ${FULLDISTDIR}/$$archive| tar xf -;;
	*.zip)
	  unzip -q ${FULLDISTDIR}/$$archive -d ${WRKDIR};;
	*.tar.bz2|*.tbz2|*.tbz)
	  bzip2 -dc ${FULLDISTDIR}/$$archive| tar xf -;;
	*.shar.gz|*.shar.Z|*.sh.Z|*.sh.gz)
	  gzcat ${FULLDISTDIR}/$$archive | /bin/sh;;
	*.shar|*.sh)
	  /bin/sh ${FULLDISTDIR}/$$archive;;
	*.tar)
	  tar xf ${FULLDISTDIR}/$$archive;;
	*)
	  gzip -dc ${FULLDISTDIR}/$$archive | tar xf -;;
    esac
done
.Ed
.It Ev EXTRACT_ONLY
Set to the list of distfiles to actually extract if some distfiles
should not be extracted during the
.Cm do-extract
stage.
Defaults to all distfiles, can even be set to empty.
.It Ev EXTRACT_SUFX
Used to set DISTFILES default value to ${DISTNAME}${EXTRACT_SUFX}.
The decompression tool needed will be automatically added as
.Ev BUILD_DEPENDS .
Default value is .tar.gz.
.It Ev FAKE_FLAGS
Extra flags passed to ${MAKE_PROGRAM} during the
fake invocation.
Empty by default.
Also see
.Ev ALL_FAKE_FLAGS .
.It Ev FAKE_SETUP
List of environment values normally set during fake invocations.
Exposed so that modules may provide their own
.Cm do-install .
Read-only,
see
.Sx THE FAKE FRAMEWORK
section for details.
.It Ev FAKE_TARGET
Target built by ${MAKE_PROGRAM} on fake invocation.
Defaults to ${INSTALL_TARGET}.
.It Ev FAKEOBJDIR
User settings.
If non empty, used as a base for the fake area.
The real fake directory ${WRKINST} is created there.
Can be set on a per-${PKGPATH} basis.
For instance, setting FAKEOBJDIR_www/mozilla=/tmp/obj
will affect only the mozilla port.
.It Ev FETCH_CMD
User settings.
Command used to fetch distribution files for this port.
Defaults to
.Xr ftp 1 .
Can be used to go through excessively paranoid firewalls.
Note that
.Ev FETCH_CMD
should support
.Fl C
and
.Fl o Ar dest .
.It Ev FETCH_MANUALLY
Some ports' distfiles cannot be fetched automatically for licensing reasons.
In this case, set
.Ev FETCH_MANUALLY
to a list of strings that will be displayed, one per line, e.g.,
.Bd -literal
FETCH_MANUALLY= "You must fetch foo-1.0.tgz"
FETCH_MANUALLY+="from http://www.fubar.com/ manually,"
FETCH_MANUALLY+="after reading and agreeing to the license."
.Ed
Behaves like
.Ev IS_INTERACTIVE
if some distribution files are missing.
.It Ev FETCH_PACKAGES
User settings.
If set to
.Sq Yes ,
the
.Cm package
target will download packages missing from the repository from locations in
${PKG_PATH} and place them into
.Pa ${PACKAGE_REPOSITORY}/${MACHINE_ARCH}/cache/ .
It will only build them if no suitable packages are found.
.It Ev FILESDIR
Location of other files related to the current port.
Default: files.
.It Ev FLAVOR
The port's current options.
Set by the user, and tested by the port to activate wanted functionalities.
.It Ev FLAVORS
List of all flavors keywords a port may match.
Used to sort FLAVOR into a canonical order to build the package name,
or to select the packing-list, and as a quick validity check.
See also
.Ev PSEUDO_FLAVORS .
.It Ev FLAVOR_EXT
Canonical list of flavors being set for the current build, dash-separated.
See
.Ev FULLPKGNAME .
.It Ev FORCE_UPDATE
User settings.
If set to
.Sq Yes ,
the
.Cm update
target will always update an installed package,
as soon as its signature differs,
and all dependencies that install packages will
also force an update.
If set to
.Sq hard ,
the
.Cm update
target will also update installed packages even when the signature
did not change.
.It Ev FULLDISTDIR
Complete path to directory where ${DISTFILES} and ${PATCHFILES} will be
located, to be used in hand-crafted extraction targets.
Read-only.
.It Ev FULLPKGNAME
Full name of the created package, taking flavors into account.
Defaults to ${PKGNAME}${FLAVOR_EXT}.
See also
.Ev EPOCH
and
.Ev REVISION .
.It Ev FULLPKGPATH
Path to the current port's directory, relative to ${PORTSDIR},
including flavors and subpackages.
See
.Xr pkgpath 7 .
.It Ev GH_*
Support for GitHub-hosted projects.
Leave empty for non hosted projects.
Yields a suitable default for
.Ev MASTER_SITES_GITHUB
and
.Ev DISTNAME .
.It Ev GH_ACCOUNT
Account name of the GitHub user hosting the project.
.It Ev GH_COMMIT
SHA1 commit id to fetch.
It is an error to specify ${GH_COMMIT} when ${GH_TAGNAME} is specified.
.It Ev GH_PROJECT
Name of the project on GitHub.
.It Ev GH_TAGNAME
Name of the tag to download.
Setting ${GH_TAGNAME} to master is invalid
and will throw an error.
${WRKDIST} is auto-generated based on the
${GH_TAGNAME} if specified, otherwise ${GH_COMMIT} will be used to generate
${WRKDIST}.
.It Ev GMAKE
Location of the GNU make binary, if needed.
Defaults to gmake.
.It Ev HOMEPAGE
URL to the homepage of the software, if applicable.
.It Ev IGNORE
For ignored ports, set to the reasons for which the port is ignored.
If non-empty, most common targets that do something (e.g.,
.Cm fetch ,
.Cm build ,
.Cm install No ... )
will be ignored.
See also
.Ev BATCH ,
.Ev BROKEN ,
.Ev FETCH_MANUALLY ,
.Ev IGNORE_IS_FATAL ,
.Ev IGNORE_SILENT ,
.Ev INTERACTIVE ,
.Ev IS_INTERACTIVE ,
.Ev NOT_FOR_ARCHS ,
.Ev NO_IGNORE ,
.Ev ONLY_FOR_ARCHS .
.It Ev IGNORE_IS_FATAL
User settings.
If set to
.Sq Yes ,
ignored ports will become fatal errors.
.It Ev IGNORE_SILENT
User settings.
If set to
.Sq Yes ,
do not print anything when ignoring a port.
.It Ev INSTALL_{PROGRAM,SCRIPT,DATA,MAN}[_DIR]
Macros to use to install a program, a script, data, or a man page (or the
corresponding directory), respectively.
.It Ev INSTALL_TARGET
Target invoked to install the software, during fake installation.
Default is
.Sq install .
.It Ev INTERACTIVE
User settings.
Set to
.Sq Yes
to skip all non-interactive ports.
Used in conjunction with
.Ev BATCH
to simplify bulk-package builds.
.It Ev IS_INTERACTIVE
Set to
.Sq Yes
if port needs human interaction to build.
Porters should strive to minimize
.Ev IS_INTERACTIVE
ports, by using
.Ev FLAVORS
for multiple choice ports, and by postponing human intervention
to package installation time.
.It Ev LE_ARCHS
Set to the list of little-endian architectures.
Read-only.
Use with
.Ev NOT_FOR_ARCHS
and
.Ev ONLY_FOR_ARCHS .
.It Ev LIB_DEPENDS
List of packages used by a port for its library dependencies.
Each item has the form
.Sq [pkgspec:]pkgpath .
Similar to
.Ev BUILD_DEPENDS
and
.Ev RUN_DEPENDS ,
but with specific rules:
.Ev LIB_DEPENDS
always turn into
.Ev BUILD_DEPENDS
.Po
but see
.Sx FLAVORS AND MULTI PACKAGES
.Pc .
.Pp
.Ev LIB_DEPENDS
is also used as a run-time dependency, and recorded in the package as
such, if any of the libraries mentioned in
.Ev WANTLIB
is a shared library that originates within the dependent port.
.Pp
See
.Xr library-specs 7
for more details.
.It Ev lib_depends_args
Controls the behavior of
.Xr pkg_create 1
related targets, see
.Cm print-package-args
for details.
.It Ev LIBCXX
List of standard C++ libraries for the base compiler.
Read-only.
Use in
.Ev WANTLIB .
.It Ev LIBTOOL
Location of the libtool binary.
Default:
.Pa /usr/bin/libtool .
.It Ev LIBTOOL_FLAGS
Arguments to pass to libtool.
If USE_LIBTOOL is set, the environment variable LIBTOOL is set
to ${LIBTOOL} ${LIBTOOL_FLAGS}.
.It Ev LLVM_ARCHS
Set to the list of architectures where LLVM/Clang could be used,
e.g., via lang/clang port module, see
.Xr port-modules 5 .
Read-only.
Use with
.Ev NOT_FOR_ARCHS
or
.Ev ONLY_FOR_ARCHS .
.It Ev LOCALBASE
where other ports have already been installed.
Default:
.Pa /usr/local .
.It Ev LOCALSTATEDIR
Location for this port's state directory, should always be derived
from
.Ev BASELOCALSTATEDIR ,
which defaults to
.Pa /var .
Passed to gnu configure scripts.
.It Ev LOCKDIR
User settings.
Defaults to
.Pa ${WRKOBJDIR}/locks .
If set, points to a local directory common for all instances of
concurrent ports builds.
.It Ev LOCK_CMD
Expands to a command that will acquire a lock, namely
.Xr dolock 1 .
See also
.Xr ports 7 .
.It Ev LOCK_VERBOSE
User settings.
Defaults to
.Sq \&No .
Set to
.Sq Yes
to show every acquire/release lock operation.
.It Ev LP64_ARCHS
Set to the list of 64-bit architectures.
Read-only.
Use with
.Ev NOT_FOR_ARCHS .
.It Ev MAINTAINER
Email address with full name of the port's maintainer.
Defaults to
.Mt ports@@openbsd.org .
.It Ev MAKE_ENV
Environment variables passed to make invocations and tests.
Sets at least PATH, PREFIX, LOCALBASE, X11BASE, CFLAGS, TRUEPREFIX, DESTDIR,
and the BSD_INSTALL_* macros.
.It Ev MAKE_FLAGS
Flags used for all make invocations, except for the
.Cm fake
stage, which adds
.Ev FAKE_FLAGS
(see
.Ev ALL_FAKE_FLAGS )
and for the
.Cm test
stage, which adds
.Ev TEST_FLAGS
(see
.Ev ALL_TEST_FLAGS ) .
.It Ev MAKE_FILE
Name of the Makefile used for ports building.
Defaults to Makefile.
Used after changing directory to ${WRKBUILD}.
.It Ev MAKE_PROGRAM
The make program that is used for building the port.
Set to ${MAKE} or ${GMAKE} depending on USE_GMAKE.
Read-only.
.It Ev MAKEFILE_LIST
Introspection variable, see
.Xr make 1 .
.It Ev MAKESUMFILES
List of all files that need to be retrieved by
.Cm fetch-all ,
with
.Ev DIST_SUBDIR
prepended and with master site selection extension removed.
Read-only.
See also
.Ev CHECKSUMFILES .
.It Ev MASTER_SITE_BACKUP
User settings.
List of sites to try after normal master sites, or before if
.Ev MASTER_SITE_OVERRIDE
is set to
.Sq Yes .
Normally includes ${MASTER_SITE_OPENBSD} and ${MASTER_SITE_FREEBSD}.
.It Ev MASTER_SITE_*
Lists of standard sites to retrieve files from, refer to
.Pa ${PORTSDIR}/infrastructure/templates/network.conf.template .
.It Ev MASTER_SITE_OVERRIDE
User settings.
Set to
.Sq Yes
to retrieve distfiles and patchfiles preferentially from the
${MASTER_SITE_BACKUP} sites.
Defaults to
.Sq \&No .
.It Ev MASTER_SITES
List of primary locations from which distribution files and patchfiles are
retrieved.
See the
.Cm fetch
target for details.
Defaults to ${MASTER_SITES_GITHUB} for GitHub-hosted projects,
see
.Ev GH_* .
See
.Xr ports 7
for user configuration.
.It Ev MASTER_SITES0 , ... , MASTER_SITES9
Supplementary locations from which distribution files and patchfiles are
retrieved.
.It Ev MESSAGE
File recorded in the package and displayed during installation.
Defaults to ${PKGDIR}/MESSAGE if this file exists.
Leave empty if no message is needed.
.It Ev MISSING_FILES
When
.Ev FETCH_MANUALLY
is set,
.Ev MISSING_FILES
will contain the list of missing distfiles or patchfiles that need to
be fetched manually.
Read-only.
.It Ev MTREE_FILE
.Xr mtree 8
specification to check when creating a PLIST with the
.Cm update-plist
target.
.Ev MTREE_FILE
can hold a list of file names, to which
.Pa ${PORTSDIR}/infrastructure/db/fake.mtree
is always appended.
These specifications are rooted at
.Pa ${WRKINST} ,
and are subject to
.Ev SUBST_VARS
substitution, to ease
.Pa ${PREFIX}
independence.
This feature is primarily intended for large, interconnected ports,
such as the kde suite, where a base package sets up a large, extra
directory hierarchy that would make the manual checking of packing lists
tedious.
.It Ev MODGNU_CONFIG_GUESS_DIRS
If a port uses config.guess outside WRKSRC, the directories
containing the other copies must be set here.
.It Ev MODPERL_ADJ_FILES
If any files have a Perl shebang line, which needs to be replaced
with
.Dq #!/usr/bin/perl ,
list them in
.Ev MODPERL_ADJ_FILES .
File paths here should be relative to
.Ev WRKSRC .
These files are patched automatically at the end of
.Cm pre-configure .
.It Ev MODPERL_BIN_ADJ
Shell fragment to patch the Perl interpreter path in executable scripts.
Used by
.Ev MODPERL_ADJ_FILES .
.It Ev MODPERL_BUILD_TARGET
Normal content of
.Cm do-build
when
.Ev CONFIGURE_STYLE
uses perl.
Provided as a separate variable if a port wants to override
.Cm do-build
for its own reasons.
.It Ev MODPERL_INSTALL_TARGET
Likewise for
.Cm do-install .
.It Ev MODPERL_TEST_TARGET
Likewise for
.Cm do-test .
.It Ev MODULES
External modules mechanism, documented separately.
Modules such as
.Sq imake
and
.Sq gnu
are normally included automatically with the right
.Ev CONFIGURE_STYLE .
Note that it is possible to
.Li CONFIGURE_STYLE = simple ,
.Li MODULES += gnu
to just get the effects of
.Ev CONFIG_SITE
and
.Ev MODGNU_CONFIG_GUESS_DIRS
along with the default
.Ev TEST_TARGET ,
in case the normal GNU configure script was wrapped in a separate script that
takes different arguments.
See
.Xr port-modules 5 .
.It Ev MULTI_PACKAGES
Set to a list of subpackage extensions for ports that create multiple packages.
See
.Sx FLAVORS AND MULTI_PACKAGES
below.
Especially read the part about
.Ev ONLY_FOR_ARCHS
when some of the packages only exist for some architectures.
.It NO_ARCH
Location for arch-independent packages.
Defaults to
.Sq no-arch .
Normally, packages are generated under ${PACKAGE_REPOSITORY}/${MACHINE_ARCH},
except for packages where PKG_ARCH=*, which end up under
${PACKAGE_REPOSITORY}/${NO_ARCH}.
.It Ev NOT_FOR_ARCHS
List of architectures on which this port does not build.
See also
.Ev ONLY_FOR_ARCHS .
.It Ev NO_BUILD
Set to
.Sq Yes
if port does not need any build stage.
.It Ev NO_CCACHE
Set to
.Sq Yes
to prevent ccache from being used when building a certain port,
even when
.Ev USE_CCACHE
is set.
.It Ev NO_CHECKSUM
Set to
.Sq Yes
by
.Xr dpb 1
to avoid
.Cm checksum
entirely,
as
.Xr dpb 1
already deals with checksums internally.
.It Ev NO_DEPENDS
User settings.
Don't verify build of dependencies.
Do not use in any ports Makefile.
This is only meant as a user convenience when, e.g., you just want to browse
through a given port's source and do not wish to trigger the build of
dependencies.
.It Ev NO_IGNORE
User settings.
If set to
.Sq Yes ,
avoid ignoring a port for the usual reasons.
Use, for instance, for fetching all distribution files, or for fixing a
broken port.
See also
.Ev IGNORE
and
.Ev TRY_BROKEN .
.It Ev NO_TEST
Port does not have any regression tests.
Only set to
.Sq Yes
for ports with no regression test.
It should be left alone for ports with empty regression tests, and for
ports with failing tests.
That way, if a subsequent update of a port acquires actual regression tests,
they will be picked up automatically.
.It Ev OLD_WRKDIR_NAME
Base name for
.Ev WRKDIR
in the old scheme without
.Ev WRKOBJDIR .
Mostly used as a value for
.Ev WRKDIR_LINKNAME ,
e.g.,
.Bd -literal
WRKDIR_LINKNAME = ${OLD_WRKDIR_NAME}
.Ed
.Pp
in
.Pa /etc/mk.conf .
Read-only.
.It Ev ONLY_FOR_ARCHS
List of architectures on which this port builds.
Can hold both processor-specific information (e.g., powerpc), and more
specific model information (e.g., macppc).
This is subpackage dependent.
Read the corresponding part of
.Sx FLAVORS AND MULTI_PACKAGES
if some subpackages should only be built on some architectures.
.It Ev OSREV
Revision number of
.Ox .
Read-only.
.It Ev PACKAGE_REPOSITORY
User settings.
Location for built packages.
Defaults to
.Pa ${PORTSDIR}/packages .
See
.Cm package
for details.
.It Ev PATCH
Command to use to apply all patches.
Defaults to
.Pa /usr/bin/patch .
.It Ev PATCHORIG
Suffix used by
.Cm patch
to rename original files, and
.Cm update-patches
to re-generate
.Pa ${PATCHDIR}/${PATCH_LIST}
by looking for files using this suffix.
Defaults to
.Pa .orig .
For a port that already contains
.Pa .orig
files in the ${DISTFILES},
set this to something else, such as
.Pa .pat.orig .
See also
.Cm distpatch ,
.Ev DISTORIG .
.It Ev PATCH_CASES
In the normal
.Cm distpatch
stage (when
.Ev PATCHFILES
is not empty), this is the contents of a case statement, used to apply
distribution patches.
Fragments are automatically appended to handle gzip'ed, bzip'ed and lzip'ed
patches, so that the default case is more or less equivalent to the following
shell fragment:
.Bd -literal
set -e
cd ${FULLDISTDIR}
for patchfile in ${_LIST_PATCHFILES}
do
    case $$patchfile in
	*.bz2)
	  bzip2 -dc $$patchfile | ${PATCH} ${PATCH_DIST_ARGS};;
	*.lz)
	  lunzip -c $$patchfile | ${PATCH} ${PATCH_DIST_ARGS};;
	*.Z|*.gz)
	  gzcat $$patchfile | ${PATCH} ${PATCH_DIST_ARGS};;
	*)
	  ${PATCH} ${PATCH_DIST_ARGS} <$$patchfile;;
    esac
done
.Ed
.It Ev PATCHDIR
Location for patches applied by the
.Cm patch
target.
Default:
.Pa patches .
.It Ev PATCHFILES
Files to fetch from the master sites like
.Ev DISTFILES ,
but serving a different purpose, as they hold distribution patches that
will be applied at the
.Cm patch
stage.
See also
.Ev SUPDISTFILES .
.It Ev PATCH_ARGS
Full list of options used while applying port's patches.
.It Ev PATCH_CHECK_ONLY
Set to
.Sq Yes
by the
.Cm checkpatch
target.
Don't touch unless the default
.Cm checkpatch
target needs to be redefined.
Ideally, user-defined patch subtargets ought to test checkpatch.
In practice, they don't.
.It Ev PATCH_DEBUG
If set to
.Sq Yes ,
the
.Cm patch
stage will output extra debug information.
.It Ev PATCH_DIST_ARGS
Full list of options used while applying distribution patches.
.It Ev PATCH_DIST_STRIP
Patch option used to strip directory levels while applying distribution
patches.
Defaults to -p0 .
.It Ev PATCH_LIST
Wildcard pattern of patches to select under ${PATCHDIR}.
Defaults to patch-*.
Note that filenames ending in .orig, or ~ are never applied.
Note that
.Ev PATCH_LIST
can hold absolute pathnames, for instance to share patches among similar
ports:
.Bd -literal
PATCH_LIST=${PORTSDIR}/x11/kde/libs2/patches/p-* patch-*
.Ed
.It Ev PATCH_STRIP
Patch option used to strip directory levels while applying port's patches.
Defaults to -p0 .
.It Ev PERMIT_DISTFILES_FTP , PERMIT_PACKAGE_CDROM , PERMIT_PACKAGE_FTP
Set to
.Sq Yes
if package or distribution files can be allowed on FTP sites or CD-ROM without
legal issues.
Set to reason not to otherwise.
PERMIT_* lines in the Makefile should be preceded with a comment explaining
details about licensing and patents issues the port may have.
Porters must be very thorough in their checks.
In case of doubt, ask.
.Pp
If
.Ev PERMIT_PACKAGE_CDROM
is set to
.Sq Yes ,
.Ev PERMIT_PACKAGE_FTP
and
.Ev PERMIT_DISTFILES_FTP
will default to
.Sq Yes .
.Pp
If
.Ev PERMIT_PACKAGE_FTP
is set to
.Sq Yes ,
.Ev PERMIT_DISTFILES_FTP
will default to
.Sq Yes .
.It Ev PKG_ADD
User settings.
Path to
.Xr pkg_add 1
command, with possible options.
.It Ev PKG_ARCH
Comma-separated list of architectures on which this package may install.
Defaults to ${MACHINE_ARCH},${ARCH}.
Use * for arch-independent packages.
.It Ev PKG_ARGS
Special arguments to pass to
.Xr pkg_create 1 ,
in addition to the default ones.
For mips64 and pic libraries, see
.Sx THE GENERATION OF PACKAGE INFORMATION .
.It Ev PKG_CREATE
User settings.
Path to
.Xr pkg_create 1
command, with possible options.
.It Ev PKG_CREATE_NO_CHECKS
Porters switch.
Set to
.Sq Yes
to avoid checking the ports tree when solving
.Ev WANTLIB
.Po
see
.Cm wantlib-args
.Pc .
May result in bogus packages that mix
.Cm @@depends
lines obtained from
the ports tree with
.Cm @@wantlib
lines that come from the installed system.
Set to
.Sq Warn
to have the differences printed as a warning instead of an error
.Po
the default
.Pc .
.It Ev PKG_DBDIR
User settings.
Path to package installation records.
Defaults to
.Pa /var/db/pkg .
.It Ev PKG_DELETE
User settings.
Path to
.Xr pkg_delete 1
command, with possible options.
.It Ev PKG_INFO
User settings.
Path to
.Xr pkg_info 1
command, with possible options.
.It Ev PKG_TMPDIR
See
.Xr pkg_add 1 .
Normally points to
.Pa /var/tmp ,
as per default.
.It Ev PORTHOME
Setting of env variable
.Ev HOME
for most shell invocations.
Default will trip ports that try to write into $HOME while building.
.It Ev PORTPATH
Path used by most shell invocations.
Don't override unless really needed.
.It Ev PORTSDIR
Root of the ports tree (default:
.Pa /usr/ports ) .
.It Ev PORTSDIR_PATH
Path used by dependencies and
.Pa bsd.port.subdir.mk
to look up package specifications.
Defaults to
.Pa ${PORTSDIR}:${PORTSDIR}/mystuff .
.It Ev PKGDIR
Location for packaging information (packing list, port description, messages).
.Cm update-plist
may create it.
Must be a valid directory.
Default: pkg.
.It Ev PKGFILE
Full path to the created package for the given subpackage.
Read-only.
.It Ev PKGFILES
Full path to all created packages.
Read-only.
.It Ev PKGNAME
Name of the created package.
Default is ${DISTNAME}.
This does not take flavors into account.
See
.Ev FULLPKGNAME
for that.
Specific revisions and epoch changes should be
handled by
.Ev REVISION
and
.Ev EPOCH
instead.
.It Ev PKGNAMES
Read-only.
List of all package names generated by the port, with
.Ev FLAVORS
and
.Ev BUILD_PACKAGES
taken into account.
Mostly used as
.Ql make show=PKGNAMES
to verify that bumped package names are correct.
.It Ev PKGNAME-foo
Package name for sub-package foo, if the default value
of ${PKGNAME}${SUBPACKAGE} is not appropriate.
.It Ev PKGPATH
Path to the current port's directory, relative to ${PORTSDIR}.
Read-only.
.It Ev PKGPATHS
Read-only.
List of all package paths generated by the port, with
.Ev FLAVORS
and
.Ev MULTI_PACKAGES
taken into account.
Order matches
.Ev PKGNAMES
exactly.
.It Ev PKGSPEC
Default package spec for using this port as a dependency.
Defaults to
.Sq stem-* ,
derived from the
.Ev FULLPKGNAME .
Do not override without very good reasons,
namely software that coexist as different incompatible versions with the
same stem, e.g., already a mess.
.It Ev PLIST_DB
Deprecated, see
.Ev PLIST_REPOSITORY .
.It Ev PLIST_REPOSITORY
User settings.
Base directory used to save generated packing-lists, as persistent information.
Packing-lists are processed by a script,
.Xr register-plist 1 ,
which complains when packing-lists change without a
.Ev REVISION
bump.
It also knows enough about package version numbers when something in the
package or its dependencies goes backward, thus catching
.Ev EPOCH
issues.
This directory is never cleaned during normal operation.
.Ql make clean=plist
should only ever be used during debugging by port maintainers.
Defaults to
.Pa ${PORTSDIR}/plist
.Po
plists actually get saved into
.Pa ${PLIST_REPOSITORY}/${MACHINE_ARCH}
.Pc .
If set to empty, will not register anything: very much unsafe.
.It Ev PORTS_BUILD_XENOCARA_TOO
EXPERIMENTAL.
Set to
.Sq Yes
to build xenocara through ports.
This is highly experimental and not recommended.
.It Ev PORTROACH
Controls the behavior of
.Pa misc/portroach
as documented in detail at
.Lk http://jasperla.github.io/portroach/docs/portroach-portconfig.txt .
.It Ev PREFIX
Base directory for the current port installation.
Usually ${LOCALBASE}, though some ports may elect a location under
.Pa ${VARBASE} ,
and some multi-package ports may install under several locations.
Additionally, firmware files generally install under
.Pa ${BASESYSCONFDIR} .
.It Ev PREPARE_CHECK_ONLY
Build settings.
Prevent the
.Cm prepare
stage from installing anything, let it just check dependencies, and
handle [:target] dependencies.
Mostly used by
.Xr dpb 1 ,
which already installs everything before running
.Cm prepare .
.It Ev PROGRESS_METER
User settings.
Defaults to
.Sq Yes .
Forces commands like
.Xr ftp 1
and
.Xr pkg_create 1
to use their progress-meter even in the absence of a terminal.
.It Ev PROPERTIES
List of properties specific to a given machine architecture.
Most often obtained through
.Xr bsd.port.arch.mk 5 .
These can be checked like this
.Bd -literal -offset indent
\&.include <bsd.port.arch.mk>
\&.if ${PROPERTIES:Mapm}
# then add build options specific to apm arches
\&...
\&.if !${PROPERTIES:Mlp64}
# build options specific to lp32 arches
\&...
.Ed
For
.Ev MULTI_PACKAGES
setup, use of
.Ev ONLY_FOR_ARCHS-sub
and
.Ev BUILD_PACKAGES
is generally preferred (and simpler).
Possible properties include
.Bl -tag -width mono
.It apm
architecture possesses suspend (apm) support.
.It be
architecture is big-endian.
.It gccN
gccN architecture.
.It le
architecture is little-endian.
.It lp64
lp64 architecture.
.It llvm
there is
.Pa lang/llvm
support on this architecture.
.It mono
there is
.Pa lang/mono
support on this architecture.
.El
.It Ev PSEUDO_FLAVOR
List of flavors in
.Ev FLAVOR
that are actually pseudo-flavors.
Only for introspection purposes.
Read-only.
.It Ev PSEUDO_FLAVORS
Extra list of flavors that do not register in package names, but are still
used to control build logic, and work directory names.
Its only use should be for disabling part of a multi-packages build,
for instance:
.Bd -literal
FLAVOR=no_gnome make package
.Ed
.Pp
Pseudo-flavors should be named as
.Sq no_something
to disable the build of subpackage
.Sq -something
.Po
and possibly some others, by restricting
.Ev BUILD_PACKAGES
.Pc .
Pseudo-flavors should always be handled through
.Xr bsd.port.arch.mk 5 .
A pseudo-flavor can remove several subpackages through the following
construct.
.Bd -literal -offset indent
# pseudo-flavor no_gui will also remove gtk and gtk3
MULTI_PACKAGES = -main -gtk -gtk3 -gui
# ...
\&.include <bsd.port.arch.mk>

# remove extra build components
\&.if !${BUILD_PACKAGES:M-gui}
BUILD_PACKAGES := ${BUILD_PACKAGES:N-gtk:N-gtk3}
\&.endif

# normal configure setup, e.g.,
\&.if ${BUILD_PACKAGES:M-gtk}
# ...
.Ed
.Pp
Caveat: creation of a separate working directory is mandatory for a
pseudo-flavor.
If, at a later time, a full build with all subpackages is required,
all the work will need to be done again.
.Pp
See also
.Ev BUILD_ONCE .
.It Ev RCDIR
Location for daemon startup scripts.
Defaults to
.Pa /etc/rc.d .
Do not change.
.It Ev REFETCH
User settings.
If set to true,
.Cm checksum
will analyze ${CHECKSUM_FILE}, and try retrieving files with the correct
checksum off
.Lk ftp.openbsd.org ,
in the directory
.Pa /pub/OpenBSD/distfiles/$cipher/$value/$file .
.It Ev REORDER_DEPENDENCIES
Points to a list of files that specify inter-dependencies for
.Xr make 1 .
If defined, each line of the file is either a comment (starting with #)
or a pair of two files: most_recent older.
At the end of
.Cm post-patch ,
.Xr touch 1
will be used to ensure those files are put in the proper order.
The files are assumed to be under
.Pa ${WRKSRC} .
The notation /file can be used to ask for a recursive search, e.g.,
to make sure that all Makefile.in are up to date.
See
.Pa ${PORTSDIR}/infrastructure/mk/automake.dep
for an example.
.It Ev REPORT_PROBLEM
See
.Xr ports 7 .
.It Ev REPORT_PROBLEM_LOGFILE
See
.Xr ports 7 .
.It Ev REVISION
Revision number of the current package.
Defaults to empty (very first package), then
numbering starts at 0.
Gets automatically incorporated into
.Ev FULLPKGNAME
as
.Sq p${REVISION}
to form a full package-name conforming to
.Xr packages-specs 7 .
.It Ev RUN_DEPENDS
Specification of ports this port needs installed to be functional.
Same format as
.Ev LIB_DEPENDS .
The corresponding packages will be built right before the
.Cm install
stage, and
.Xr pkg_add 1
will take care of installing them.
.It Ev SEPARATE_BUILD
Many GNU configure ports can be built in a directory distinct from the
place they were unpacked.
For some specific ports, this is even mandatory.
Set to
.Sq yes
or
.Sq simple
if this is the case.
The ports infrastructure will generate a separate ${WRKBUILD} directory
in which the port will be configured and built.
Wipe ${WRKBUILD} to start anew, but skipping the extract/patch stage.
.It Ev SETENV
Normally set to
.Li /usr/bin/env -i .
Prepended to every command invocation that requires a clean environment.
Do not override.
.It Ev SHARED_LIBS
List of shared libraries that the port may build, as a list of the form
.Sq libname
.Sq libversion .
Used to set variables of the form
.Ev LIBlibname_VERSION
that are then used for substitution by
.Xr pkg_create 1 .
The porter is responsible for making sure the port uses those version numbers
when shared libraries are built.
.Pp
The intent is that the
.Ox
ports system must have control over shared library versions because of global
changes that may require bumping the major version of every shared library in
the system, or simply because the third party programmers do not understand
the rules for shared library versions, thus breaking the update mechanism.
For that reason it is advised to set libversion to 0.0 when first importing a
port.
.Pp
Porters of software using libtool should make sure
.Ev MAKE_FLAGS
get propagated to the libtool invocations.
This should be enough in most cases.
.It Ev SKIPDIR
See
.Xr ports 7 .
.It Ev STATIC_PLIST
Normally set to
.Sq yes .
Can be set to no for ports that do not have a static plist.
Do not change without a very good reason.
Note that the only good reason to not have a static plist is for ports such
as
.Pa databases/ports-readmes
which actually build a bunch of files depending on the current ports tree.
This breaks all introspection mechanisms within the ports tree, including
.Pa databases/pkglocatedb
which will not include that port.
.It Ev STARTAFTER
See
.Xr ports 7 .
.It Ev STARTDIR
See
.Xr ports 7 .
.It Ev SUBPACKAGE
Set to the subpackage suffix when building a package in a multi-package port.
Read-only.
Used to test for dependencies or to adjust the package name.
.It Ev SUBST_CMD
A command that can be used to perform
.Ev SUBST_VARS
substitution on arbitrary files.
In normal mode,
.Pp
.Dl ${SUBST_CMD} file1 file2 ...
.Pp
will substitute files in place, creating backup copies of them.
In copy mode,
.Pp
.Dl ${SUBST_CMD} -c src1 dest1 src2 dest2
.Pp
will copy files over while performing the substitution, as suitable for
copying template files over from
.Pa ${FILESDIR}
to
.Pa ${PREFIX} ,
for instance.
This uses
.Xr pkg_subst 1
with suitable parameters.
Read-only.
.Pp
${SUBST_CMD}
can be used like
.Xr install 1 :
.Dl ${SUBST_CMD} Oo Fl g Ar group Oc Oo Fl o Ar owner Oc Oo Fl m Ar mode Oc file...
to set file
.Ar owner ,
.Ar group
and/or
.Ar mode .
.Pp
Note that
.Ev SUBST_CMD
is not really appropriate when variables have subpackage variations, like
.Ev PREFIX
or
.Ev FULLPKGNAME .
Use the appropriate
.Ev SUBST_CMD-sub
instead.
.It Ev SUBST_CMD-sub
.Ev SUBST_CMD
with subpackage-dependent semantics, like packing-list substitution.
It will substitute the right variable depending on the desired subpackage,
e.g.,
.Ev SUBST_CMD-foo
will substitute the value of
.Ev FULLPKGNAME-foo
for
.Li ${FULLPKGNAME} .
.It Ev SUBST_DATA , SUBST_MAN , SUBST_PROGRAM
Specialized versions of
.Ev SUBST_CMD
that use
.Fl c
and appropriate owner/group/mode for data, manpages and programs respectively.
.It Ev SUBST_VARS
Make variables whose values get substituted to create the actual package
information.
Always holds
.Ev ARCH ,
.Ev BASE_PKGPATH ,
.Ev FLAVOR_EXT ,
.Ev FULLPKGNAME ,
.Ev HOMEPAGE ,
.Ev LOCALBASE ,
.Ev MACHINE_ARCH ,
.Ev MAINTAINER ,
.Ev PREFIX ,
.Ev RCDIR ,
.Ev SYSCONFDIR ,
.Ev TRUEPREFIX ,
and
.Ev X11BASE .
The special construct
.Sq ${FLAVORS}
can be used in the packing-list to specify the current list of dash
separated flavors the port is compiled with (useful for cross-dependencies
in
.Ev MULTI_PACKAGES ) .
Add other
variables as needed.
Some variable names are prefixed by a ^.
This is only relevant for
.Cm update-plist ,
where it means the variable will only be substituted at the beginning of
a path.
.It Ev SUDO
User settings.
If set to
.Xr doas 1
in
.Xr mk.conf 5 ,
the ports tree will only invoke root's privileges for the parts that
really require it.
.It Ev SUPDISTFILES
Supplementary files that need to be retrieved under some specific
circumstances.
For instance, a port might need architecture-specific files.
.Ev SUPDISTFILES
should hold a list of all distribution files and patchfiles that are not
always needed, so that a mirror will be able to grab all files, or that
.Cm makesum
will work.
Having an overlap between
.Ev SUPDISTFILES
and
.Ev DISTFILES ,
.Ev PATCHFILES
is admissible, and in fact, expected, as it is much simpler to build
an error-free list of files to retrieve in that way.
See the xanim port for an example.
.It Ev SYSCONFDIR
Location for this port's configuration files, should always be derived
from
.Ev BASESYSCONFDIR ,
which defaults to
.Pa /etc .
Passed to gnu configure scripts and substituted in PLISTs.
.It Ev TAR
Name of the tar binary.
.It Ev TARGETS
Read-only.
Set to the list of special targets for a port
.Po
.Cm {pre,do,post}-*
and module hooks
.Pc .
Used by introspection tools such as the sqlports package.
.It Ev TEMPLATES
Base location for the templates used in the
.Cm readmes
target.
User settings.
Defaults to
.Pa ${PORTSDIR}/infrastructure/templates .
.It Ev TEST_DEPENDS
See
.Ev BUILD_DEPENDS
for specification.
Test dependencies are only checked if the
.Cm test
stage is invoked.
.It Ev TEST_ENV
Additional environment variables passed to tests.
Empty by default.
.It Ev TEST_FLAGS
Extra flags passed to ${MAKE_PROGRAM} to run the regression tests.
Empty by default.
.It Ev TEST_IS_INTERACTIVE
Set to
.Sq Yes
if port needs human interaction to run its tests, or set to
.Sq X11
if the tests need an active X11 display to work.
.It Ev TEST_LOG
Command used to log the results of regression tests to TEST_LOGFILE.
.It Ev TEST_LOGFILE
Log file containing the results of regression tests.
.It Ev TEST_TARGET
Target to run regression tests.
Defaults to
.Sq regress ,
except for
.Sq perl
and
.Sq gnu
.Ev CONFIGURE_STYLE ,
which default to
.Sq test
and
.Sq check ,
respectively.
.It Ev TRUEPREFIX
Read-only.
Mostly the same as ${PREFIX}, except it never gets ${DESTDIR} prepended
during
.Cm fake .
Refer to
.Sx THE FAKE FRAMEWORK
section for details.
.It Ev TRY_BROKEN
User settings.
If set to
.Sq Yes ,
don't set
.Ev IGNORE
for
.Ev BROKEN
ports, so that we will attempt to build them.
.It Ev UNLOCK_CMD
User settings.
If set, expands to a command that will release a lock.
This lock will reside in
.Pa ${LOCKDIR} .
.It Ev UNMESSAGE
File recorded in the package and displayed during deinstallation.
Defaults to ${PKGDIR}/UNMESSAGE if this file exists.
Leave empty if no message is needed.
.It Ev UNZIP
Name of the unzip binary.
.It Ev UPDATE_COOKIES_DIR
User settings.
Used to store cookies for package updates and defaults to
.Pa ${PORTSDIR}/update/${MACHINE_ARCH} .
If set to empty, will revert to a file under
.Pa ${WRKDIR} .
.It Ev USE_CCACHE
User settings.
Set to
.Sq Yes
to use ccache when building ports.
Adds a build dependency on devel/ccache, and sets up the build
environment so that it is used.
.It Ev USE_GMAKE
Set to
.Sq Yes
if GNU make (${GMAKE}) is needed for correct behavior of this port.
.It Ev USE_GROFF
Set to
.Sq Yes
to use groff to build manpages.
This sets groff as a build dependency, and also tells
.Xr pkg_create 1
to format manpages behind the scene using groff while building packages.
.It Ev USE_LIBTOOL
Defaults to
.Sq Yes .
Set to
.Sq gnu
if the base
.Xr libtool 1
is insufficient and GNU libtool is required.
Set to
.Sq \&No
to disable the use of
.Xr libtool 1
entirely; this should not be set under normal circumstances.
Adds dependencies if necessary, and passes LIBTOOL environment variable to
scripts invocations.
.It Ev USE_MFS
Set to
.Sq Yes
to build ports under an MFS filesystem
(see
.Xr mount_mfs 8 ) .
Mostly for use by
.Xr dpb 1
and not intended to be a user setting.
See
.Ev WRKOBJDIR_MFS
for configuration.
.It Ev USE_WXNEEDED
If set to
.Sq Yes ,
writes a wrapper script to ${WRKDIR}/bin/ld in
.Cm patch
to request that the linker adds an OPENBSD_WXNEEDED ELF section.
Use when a port requires memory mappings that are both executable
and writable and cannot be modified to avoid this.
.It Ev USE_X11
Normally, presence of ${X11BASE} is enforced by default for building ports.
But there is an experimental way to hook the xenocara build into
.Xr dpb 1 ,
which requires knowing whether a port requires X11 to already
be there.
.Pp
The infrastructure mostly sets
.Ev USE_X11
automatically based on
.Ev WANTLIB
values, there are a few ports (about 20) that require X11 components without
any library telltale.
.It Ev VARBASE
User settings.
Base location for ports that install stuff outside of
.Pa ${LOCALBASE} .
Defaults to
.Pa /var .
.It Ev WANTLIB
List of library specifications that a package will need.
May include system and X11 libraries.
See
.Xr library-specs 7
for more details.
.Pp
As a special extension,
.Ev WANTLIB
may include absolute paths, e.g.,
.Pa ${LOCALBASE}/lib/expat.=4
to distinguish between base libraries and port libraries.
Use with caution, this is very seldom needed.
.It Ev wantlib_args
Controls the behavior of
.Xr pkg_create 1
related targets, see
.Cm print-package-args
for details.
.It Ev WARNINGS
User settings.
If set to
.Sq Yes ,
add
.Ev CDIAGFLAGS
to
.Ev CFLAGS
and
.Ev CXXDIAGFLAGS
to
.Ev CXXFLAGS .
.It Ev WRKBUILD
Subdirectory of ${WRKDIR} where the actual build occurs.
Defaults to ${WRKSRC}, unless SEPARATE_BUILD is involved, in which case
it is set to an appropriate value.
.It Ev WRKCONF
Subdirectory of ${WRKDIR} where the actual configure set occurs.
Defaults to ${WRKBUILD}.
.It Ev WRKDIR
Location where all port activity occurs.
Apart from the actual port, may
hold all kinds of cookies that checkpoint the port's build.
Read-only.
Note that WRKDIR may be a symbolic link.
During ports building,
.Pa ${WRKDIR}/bin
is put at the front of the
.Ev PATH .
.It Ev WRKDIR_LINKNAME
Name of a symbolic link to create within the port directory which will
point to the port's ${WRKDIR}.
See
.Ev OLD_WRKDIRNAME .
.It Ev WRKDIST
Subdirectory of ${WRKDIR} in which the distribution files normally unpack.
Base for all patches.
Defaults to
.Pa ${WRKDIR}/${DISTNAME} .
Note that WRKDIST may be a symbolic link, if set to ${WRKDIR}.
.It Ev WRKSRC
Subdirectory of ${WRKDIR} where the actual source is.
Base for configuration (default: ${WRKDIST}).
Note that WRKSRC may be a symbolic link, if set to ${WRKDIR}.
.It Ev WRKINST
Subdirectory of ${WRKDIR} where port normally installs (see the
.Cm fake
target).
.It Ev WRKOBJDIR
Used as a base for the actual port working directory.
Defaults to
.Pa ${PORTSDIR}/pobj .
The real working directory ${WRKDIR} is created there.
Can be set on a per-${PKGPATH} basis.
For instance, setting WRKOBJDIR_www/mozilla=/tmp/obj
will affect only the mozilla port.
If explicitly unset (WRKOBJDIR=), the working directory is
created within the port directory.
.It Ev WRKOBJDIR_MFS
Alternate location for the port working directory.
The intent is to use an MFS based filesystem for small ports with
.Xr dpb 1 .
Active when
.Ev USE_MFS
is
.Sq Yes .
Defaults to
.Pa /tmp/pobj .
.It Ev X11BASE
Where X11 has been installed.
Default:
.Pa /usr/X11R6 .
.It Ev XAUTHORITY
Points to a suitable authority file for X11 interactive regression tests.
Defaults to
.Pa ${HOME}/.xauthority .
.It Ev XMKMF
Invocation of xmkmf for a
.Li CONFIGURE_STYLE=imake
port.
Defaults to xmkmf -a -DPorts.
The -DPorts is specific to
.Ox
and is always appended.
.It Ev YACC
Name of yacc program to pass to GNU-configure, defaults to yacc.
GNU-configure would always try to use bison otherwise, which leads to
unreproducible builds.
Set to bison if needed.
.El
.Sh DIAGNOSTICS
Note that some of these messages are actually emitted by some other external
commands, but grouped here for convenience: easier to look for in
.Xr dpb 1 Ns 's
logs.
.Bl -diag
.It "/bin/sh: cd .../pkg - No such file or directory"
Emitted during
.Cm generate-readmes.
.Pa ${PKGDIR}
must point to an existing directory, so that
.Nm
can be certain there are no
.Pa MESSAGEs
or
other files pertinent to the package.
.It "Discovered old directory in ..."
This message comes from
.Xr make-plist 1 .
A directory was found in the PLIST that used to be needed but is no longer,
because it's now accounted for through dependencies.
Indicates the old directory has been removed.
.It "Error: change in plist between ..."
Error message comes from
.Xr register-plist 1 .
.It "Error: duplicate item in packing-list"
Error message comes from
.Xr pkg_create 1 ,
and will result from incorrect packing-lists, such as including several
fragments with the same file, or having incorrect
.Ev PKG_ARGS-sub .
.It "Error: Libraries in packing-lists...and libraries from installed packages don't match"
The ports tree and the installed packages are out-of-sync.
Mixing library information from both sources might produce packages that can't
be installed elsewhere.
Cleanest fix is to update the out-of-date source (e.g., update the ports tree,
or build and install new packages).
Developers may use
.Ev PKG_CREATE_NO_CHECKS
instead, assuming they understand the implications.
See
.Cm print-package-args Pq Cm wantlib-args
for details.
.It "Fatal: can't flavor a SUBDIR"
A dependency mentions top_subdir,flavor.
Flavor would then be ignored, as it is only applied to individual ports.
.It "Fatal: can't subpackage a SUBDIR"
A dependency mentions top_subdir,-sub.
Subpackage would then be ignored, as it is only applied to individual ports.
.It "Fatal: flavor should never start with a digit"
This would utterly confuse
.Xr pkg_add 1 .
See
.Xr packages-specs 7 .
.It "Fatal: inclusion of <file> from <file>"
.Pa bsd.port.mk
or
.Pa bsd.port.subdir.mk
has been included from a
.Ev MODULE
or from
.Pa Makefile.inc ,
resulting in a double inclusion.
This would lead to weird results, such as
.Ev PKG_ARGS
being defined twice.
.It "Fatal: SUBPACKAGES should always begin with -: <offending list>"
That is the only way to differentiate between
.Ev FLAVOR
and
.Ev SUBPACKAGE
in
.Xr pkgpath 7
specifications.
.It "Fatal: building ports requires correctly installed X11"
All file sets of the base OS, including xenocara, must be installed
before building ports.
.It "Fatal: /usr/local/lib/X11/app-defaults should exist and be a symlink"
/usr/local/lib/X11/app-defaults is distributed as a symlink in the
xshare*.tgz file set.
If xenocara was not fully installed before packages were added, it may
have been created as a directory instead.
.It "Fatal: the licensing info for <pkgname> is incomplete..."
Every port must have explicit defines of all
.Ev PERMIT_*
values.
.It "Fatal: Use 'env FLAVOR=flavor make' instead"
Arguments specified after
.Xr make 1
are hardcoded for all recursive sub-makes, and very difficult to override.
Thus,
.Ev FLAVOR
must be specified in the environment instead.
.It "Fatal: Use 'env SUBPACKAGE=-sub make' instead"
Arguments specified after
.Xr make 1
are hardcoded for all recursive sub-makes, and very difficult to override.
Thus,
.Ev SUBPACKAGE
must be specified in the environment instead.
.It "ldconfig: <dir>: No such file or directory"
Usually produced by
.Xr pkg_add 1
running
.Xr ldconfig 8 .
Some tools such as GNU libtool will add directories living under
.Pa ${WRKINST}
to the shared library path during the
.Cm fake
stage.
Of course,
.Xr ldconfig 8
will later complain after the directory no longer exists.
The bogus tool should be fixed to conform to
.Ox
usage.
.It LIB_DEPENDS <spec> not needed for <FULLPKGPATH>
There doesn't seem to be any WANTLIB to match the given LIB_DEPENDS.
Thus, the LIB_DEPENDS won't turn into a @@depends line in the created package.
This is often because of confusion between LIB_DEPENDS and RUN_DEPENDS:
RUN_DEPENDS is needed for dlopen'd libraries.
.Pp
Might be intentional sometimes, if some compile flavors create static binaries,
for instance.
Also, will happen for multi-packages, where one sets LIB_DEPENDS to have
a given build dependency (and corresponding WANTLIB for a given SUBPACKAGE).
.Pp
See
.Cm print-package-args Pq Cm lib-depends-args
for details.
.It "Warning: FULLPKGNAME-sub defined but not FULLPKGPATH-sub"
.Ev FULLPKGNAME-sub
has been explicitly defined by the port, instead of relying on the default,
but no value of
.Ev FULLPKGPATH-sub
has been given.
This is often an error.
.It "Warning: symlink(s) point to non existent file."
Warning message comes from
.Xr pkg_create 1 .
The symlink resides in the fake area, under
.Pa ${WRKINST} .
This is only a warning because the symlink may point to a run-time dependency,
which obviously won't exist under
.Pa ${WRKINST}
at the time
.Ql make package
is run.
.It "Warning: @@option no-default-conflict with no @@conflict"
Warning message comes from
.Xr pkg_create 1 .
Most packages that waive "default-conflict" will have explicit conflict markers
instead.
Otherwise, the package will only conflict with the exact same version, with
some possible
.Ev REVISION
bumps.
Any other version or
.Ev FLAVOR
won't conflict.
This is generally an error, apart from very few ports like
.Pa devel/autoconf/* .
.It "groff produced empty result for <manpage>..."
Warning message comes from
.Xr pkg_create 1 .
Manpages are automatically formatted with
.Xr groff 1
if
.Ev USE_GROFF
is set.
The above message denotes an actual problem while formatting the page,
which should be addressed.
In the meantime,
.Xr pkg_create 1
still produces a package, but leaves the manpage unformatted, in the hope
that something will be able to make sense of it.
.El
.Sh FILES
.Bl -tag -width Ds
.It Pa ../Makefile.inc
Common Makefile fragment for a set of ports, included automatically.
.It Pa /cdrom/distfiles
Default path to a CD-ROM (or other media) full of distribution files.
.It Pa ${PORTSDIR}/distfiles
Default setup of ${DISTDIR}.
.It Pa ${DISTDIR}
Cache of all distribution files.
.It Pa distinfo
Checksum file.
Holds the output of
.Xr cksum 1 ,
using
.Xr sha256 1
for the port's ${DISTFILES} and ${PATCHFILES},
as well as the sizes of these files.
.It Pa ${DISTDIR}/${CHECKSUMFILES}
Cache of normal distribution files for a given port.
.It Pa ${DISTDIR}/${MAKESUMFILES}
Cache of all distribution files for a given port.
.It Pa ${PKGDIR}/DESCR
Description for the port.
Variables such as ${HOMEPAGE} and ${MAINTAINER} will be expanded
(see SUBST_VARS).
Multi-package ports will use DESCR${SUBPACKAGE}.
.It Pa ${PKGDIR}/README
.Ox
specific documentation for a port, that will be installed as
.Pa ${LOCALBASE}/share/doc/pkg-readmes/${FULLPKGNAME}
at the end of
.Cm fake .
Variables from
.Ev SUBST_VARS
will be expanded.
Multi-package ports will use
.Pa README${SUBPACKAGE} .
.It Pa ${PKGDIR}/<foo>.rc
Startup script for <foo>.
Will be installed as
.Ar ${RCDIR}/<foo>
at the end of
.Cm fake .
Variables from
.Ev SUBST_VARS
will be expanded.
.It Pa ${PORTSDIR}/infrastructure/db/fake.mtree
Specification used for populating ${WRKINST} at the start of
.Cm fake .
Use
.Cm pre-fake
if this is incomplete.
.It Pa ${PORTSDIR}/packages/${MACHINE_ARCH}
Default setup of ${PACKAGE_REPOSITORY}.
.It Pa ${PACKAGE_REPOSITORY}/no-arch
Location of arch-independent packages.
.It Pa ${PACKAGE_REPOSITORY}/${MACHINE_ARCH}/all
Location of all built packages.
.It Pa ${PACKAGE_REPOSITORY}/${MACHINE_ARCH}/cache
Location of packages retrieved through the network.
.It Pa ${PACKAGE_REPOSITORY}/${MACHINE_ARCH}/cksums
Location of checksums, see
.Ev CHECKSUM_PACKAGES .
.It Pa ${PACKAGE_REPOSITORY}/${MACHINE_ARCH}/cdrom
Location of packages suitable for the CD.
.It Pa ${PACKAGE_REPOSITORY}/${MACHINE_ARCH}/ftp
Location of packages suitable for FTP.
.It Pa ${PORTSDIR}/bulk/${MACHINE_ARCH}
Default setup of ${BULK_COOKIES_DIR}.
.It Pa ${PORTSDIR}/update/${MACHINE_ARCH}
Default setup of ${UPDATE_COOKIES_DIR}.
.It Pa ${PORTSDIR}/mystuff
Extra directory used to store local ports before committing them.
All depend targets will normally look there after the normal lookup fails.
See
.Ev PORTSDIR_PATH .
.El
.Sh THE FAKE FRAMEWORK
The
.Cm fake
target is used to install the port in a private directory first, ready for
packaging by the
.Cm package
target, so that the actual installation will use the package.
.Pp
Essentially,
.Cm fake
invokes a real install process after tweaking a few variables.
.Pp
.Cm fake
first creates a skeleton tree under ${WRKINST}, using the
.Xr mtree 8
specification
.Pa ${PORTSDIR}/infrastructure/db/fake.mtree .
.Pp
A
.Cm pre-fake
target may be used to complete that skeleton tree.
For instance, a few ports may need supplementary stuff to be present (as
it would be installed if the port's dependencies were present).
.Pp
If
.Cm {pre,do,post}-install
overrides are present, they are used with some
important changes, listed in
.Ev FAKE_SETUP :
.Bd -literal -offset indent
TRUEPREFIX=${PREFIX}
PREFIX=${WRKINST}${PREFIX}
${DESTDIRNAME}=${WRKINST}
.Ed
.Pp
Essentially, old install targets work transparently, except for a need to
change PREFIX to TRUEPREFIX for symbolic links and similar path lookups.
Specific traditional post install work can be simply removed, as it will
be taken care of by the package itself (for instance, ldconfig, or
texinfo's install-info).
.Pp
If no
.Cm do-install
override is present, the port is installed using
.Bd -literal -offset 2n
env -i ${MAKE_ENV} ${FAKE_SETUP} ${MAKE_PROGRAM} ${ALL_FAKE_FLAGS} -f ${MAKE_FILE} ${FAKE_TARGET}
.Ed
.Pp
Note that this does set both PREFIX and ${DESTDIRNAME}.
If a port's Makefile both heeds ${DESTDIRNAME},
and references PREFIX explicitly,
FAKE_FLAGS may rectify the problem by setting PREFIX=${PREFIX}
(which will do the right thing, since ${PREFIX} is a
.Xr make 1
construct which will not be seen by the shell).
.Pp
${FAKE_FLAGS} is used to set variables on
.Xr make 1
command line, which will override the port Makefile contents.
Thus, a port that mentions DESTDIR= does not need any patch to work with fake.
.Pp
Files such as
.Pa ${PKGDIR}/README*
or
.Pa ${PKGDIR}/*.rc
get copied to
.Pa ${WRKINST}
right after the end of
.Cm fake ,
during
.Cm generate-readmes
(see the
.Sx FILES
section above for details).
.Sh FLAVORS AND MULTI_PACKAGES
Starting with
.Ox 2.7 ,
each port can generate distinct packages through two orthogonal mechanisms:
FLAVORS and MULTI_PACKAGES.
.Pp
The current MULTI_PACKAGES mechanism was introduced after
.Ox 4.0 .
.Pp
The arch-dependent part was refined after
.Ox 5.0 .
.Pp
If a port can be compiled with several options, these options
should be turned into FLAVORS.
The port maintainer will set FLAVORS to be the list of possible options in
the Makefile.
When building the port, the package builder will set
.Li "FLAVOR='option1 option2...'"
to build a specific flavor of the port.
The Makefile should test the value of FLAVOR as follows:
.Bd -literal -offset indent
FLAVOR?=
\&.if ${FLAVOR:Moption1}
# what to do if option1
\&.endif
\&.if ${FLAVOR:Moption2}
# what to do if option2
\&.endif
.Ed
.Pp
.Nm
takes care of a few details, such as generating a distinct work directory for
each flavor, or creating a FULLPKGNAME by adding a dash separated list of
flavors to the base package name.
The order in which FLAVOR is specified does not matter: this dash separated
list will be reordered to match the ordering of FLAVORS.
.Pp
It is an error to specify an option in FLAVOR that does not appear in FLAVORS,
to prevent misspellings.
.Pp
In bulk package building, flavors can be specified as a comma
separated list after the package directory, e.g., SUBDIR+=vim,no_x11
.Po
see
.Xr pkgpath 7
.Pc
.Pp
Finally, package information will use templates with the canonical package
extension if they are available: if FLAVOR='option1 option2' and both
COMMENT and COMMENT-option1-option2 are available, COMMENT-option1-option2 will
be used.
.Pp
If one build of a port can generate several distinct packages, set
MULTI_PACKAGES accordingly.
Each extension of a MULTI_PACKAGES name should start with a dash, so that
they cannot be confused with FLAVORS.
In dependency checking and bulk builds, a subpackage can be
specified after a comma, e.g., SUBDIR+=quake,-server.
MULTI_PACKAGES only affects the actual package building step (and the
.Cm describe
step, since a MULTI_PACKAGES port will produce several descriptions).
.Pp
If MULTI_PACKAGES is set, the packaging stage happens once for every
subpackage, using subpackage-specific variables.
For instance, if MULTI_PACKAGES=-main -lib -server,
.Ev PKG_ARCH-main ,
.Ev PKG_ARCH-lib
and
.Ev PKG_ARCH-server
will be used for the subpackages respectively called
.Ev FULLPKGNAME-main ,
.Ev FULLPKGNAME-lib
and
.Ev FULLPKGNAME-server .
.Pp
All package information is also derived from
templates with SUBPACKAGE appended.
In the preceding example, the packing-list template for FULLPKGNAME-lib
must be in PLIST-lib.
.Pp
The following variables are subpackage dependent:
.Ev COMMENT ,
.Ev PKG_ARCH ,
.Ev PERMIT_PACKAGE_FTP ,
.Ev PERMIT_PACKAGE_CDROM ,
.Ev PKGFILE ,
.Ev PKGNAME ,
.Ev FULLPKGNAME ,
.Ev REVISION ,
.Ev EPOCH ,
.Ev FULLPKGPATH ,
.Ev RUN_DEPENDS ,
.Ev WANTLIB ,
.Ev LIB_DEPENDS ,
.Ev IGNORE ,
.Ev ONLY_FOR_ARCHS ,
.Ev NOT_FOR_ARCHS ,
.Ev PKG_ARGS ,
.Ev PREFIX ,
.Ev CATEGORIES ,
.Ev MESSAGE ,
.Ev UNMESSAGE ,
.Ev DESCR ,
.Ev PLIST ,
.Ev STATIC_PLIST ,
.Ev PKGSPEC .
.Pp
The usual non-MULTI_PACKAGES variables are simply used as default values
for all subpackages.
So, if you set
.Li "PKG_ARCH=*"
.Li "PKG_ARCH-main=i386"
then
.Ev PKG_ARCH-lib
and
.Ev PKG_ARCH-server
will both be
.Sq * .
.Pp
.Ev WANTLIB
and
.Ev LIB_DEPENDS
are special.
At the beginning of the build, during
.Cm prepare ,
all build dependencies will be checked,
which includes
.Ev LIB_DEPENDS ,
.Ev WANTLIB
for every subpackage.
As an exception, any
.Ev LIB_DEPENDS-sub
that references the current port will be ignored as a build dependency,
in order to avoid recursion.
.Pp
.Ev FULLPKGPATH
and
.Ev FULLPKGNAME
are special as well.
You must set
.Ev PKGNAME-sub
or
.Ev FULLPKGNAME-sub
for each subpackage, but
.Ev FULLPKGPATH-sub
is set automatically to the right value.
In very rare cases, one may override
.Ev FULLPKGPATH-sub .
(for instance, if one specific subpackage is not affected by option
settings that affect other subpackages, e.g., for include files packs).
.Pp
In terms of using the port, quite a few targets will have a subpackage
specific subtarget:
invoking
.Cm package
is the same as invoking
.Cm subpackage
for all subpackages,
invoking
.Cm install-all
is the same as invoking
.Cm install
for all subpackages,
and invoking
.Cm update
is the same as invoking
.Cm subupdate
for all subpackages.
.Pp
.Ev ONLY_FOR_ARCHS
and
.Ev NOT_FOR_ARCHS
interact with
.Ev MULTI_PACKAGES
and
.Ev IGNORE .
The infrastructure will automatically filter subpackages
that are not suitable for the current architecture.
Thus,
.Ev MULTI_PACKAGES
should always list all subpackages,
even things not buildable on the current architecture,
for indexing purposes.
.Pp
Starting with
.Ox 5.1 ,
.Xr bsd.port.arch.mk 5
should be used to simplify the handling of
.Ev MULTI_PACKAGES
in arch-dependent setups:
.Pp
Make sure
.Ev MULTI_PACKAGES ,
.Ev ONLY_FOR_ARCHS* ,
and
.Ev PSEUDO_FLAVORS
are defined correctly, then
.Bd -literal -offset indent
\&.include <bsd.port.arch.mk>
.Ed
.Pp
This will compute
.Ev BUILD_PACKAGES ,
the list of actual subpackages to build with the current setup,
by taking arch constraints and pseudo-flavors into account.
Then test
.Ev BUILD_PACKAGES
to set up the right configuration, e.g., to check if
.Ev SUBPACKAGE
.Ar -mono
should be built:
.Bd -literal -offset indent
\&.if ${BUILD_PACKAGES:M-mono}
.Ed
.Pp
The
.Pa lang/gcc/4.9
or
.Pa print/poppler
ports should provide examples of proper use.
.Pp
Note that
.Xr dpb 1
will break if all subpackages are not properly listed.
.Sh THE GENERATION OF PACKAGE INFORMATION
Starting after
.Ox 4.1
all package information is processed directly by
.Xr pkg_create 1
from templates in ${PKG_DIR}.
.Pp
.Bl -bullet -compact
.It
If not overridden by the user, determine which set of templates to use,
depending on the current SUBPACKAGE and FLAVOR information.
Set PLIST${SUBPACKAGE}, DESCR${SUBPACKAGE}, COMMENT${SUBPACKAGE}, MESSAGE${SUBPACKAGE}, UNMESSAGE${SUBPACKAGE} accordingly.
.It
Generate the actual DESCR, and if needed, MESSAGE, UNMESSAGE,
from the templates in ${DESCR}, ${MESSAGE}, ${UNMESSAGE}, by
substituting the variables in ${SUBST_VARS}, and by substituting
${FLAVORS} with the canonical flavor extension for this port,
e.g., if FLAVORS=no_map gfx qt2, if FLAVOR=gfx no_map, this is
.Sq -no_map-gfx .
.It
Generate the actual PLIST from the template ${PLIST},
by inserting fragments
and applying the same variable substitutions as other package information.
.El
.Pp
Note that ${COMMENT} is currently not substituted, to speed up
.Cm describe
generation.
.Pp
To avoid substitution, variables can be escaped as follows:
.Li "$\e{PREFIX}"
.Pp
If FLAVORS lists flv, then constructs such as the line
.Li "%%flv%%"
or
.Li "!%%flv%%"
in the packing-list template trigger the inclusion of
.Pa ${PKGDIR}/PFRAG.flv${SUBPACKAGE}
or
.Pa ${PKGDIR}/PFRAG.no-flv${SUBPACKAGE} .
Other fragments can be defined by simply adding
.Li "-Dfrag=1"
or
.Li "-Dfrag=0"
to
.Ev PKG_ARGS .
.Pp
If libraries are built using
.Pa bsd.lib.mk ,
special care should be taken for mips64* architectures,
which do not ever build
.Pa *pic.a
files (all mips code is pic already).
.Nm
automatically adds
.Li "-Dno_mips64=1"
or
.Li "-Dno_mips64=0"
to
.Ev PKG_ARGS ,
and the porter only needs to provide the appropriate fragment.
.Pp
.Xr pkg_add 1
now calls
.Xr ldconfig 8
directly, provided dynamic libraries have been annotated with
.Li "@@lib libthingy.so.5.0" .
Adding new directories to the dynamic loader cache has been
deprecated.
It is often better to let libraries be visible as a link
under ${LOCALBASE}.
Having a separate directory is enough to trick
.Xr ld 1
into grabbing the right version.
Libraries used only for
.Xr dlopen 3
do not need to be visible.
Some programs will prefer to use rpath to find their own libraries.
.Pp
The special
.Cm update-plist
target does a fairly good job of automatically generating the PLIST.
.Pp
If
.Ev PLIST_REPOSITORY
points to a directory, all packing-lists from packages generated by
.Xr pkg_create 1
during the
.Cm package
stage are saved in
.Pa ${PLIST_REPOSITORY}/${MACHINE_ARCH}
by a script:
.Pa ${PORTSDIR}/infrastructure/bin/register-plist .
This script strips some irrelevant information and normalizes the
packing-list somehow, and compares it to existing information, looking
for relevant changes.
Since a package name must always be changed when the packing-list changes,
any attempt to replace a packing-list of a given name with a different
packing-list will be flagged as an error.
.Pp
In MULTI_PACKAGES mode, there must be separate COMMENT, DESCR, and PLIST
templates for each SUBPACKAGE (and optional distinct MESSAGE, UNMESSAGE
files in a similar way).
This contrasts with the FLAVORS
situation, where all these files will automatically default to the
non-flavor version if there is no flavor-specific file around.
.Sh OBSOLETE TARGETS
.Bl -tag -width Ds
.It Cm addsum
Used for direct fiddling with
.Pa distinfo ,
made obsolete by the correct use of
.Ev SUPDISTFILES .
.It Cm cdrom-packages , ftp-packages
Links are now created during the
.Cm package
target.
.It Cm depends-list
Renamed into
.Cm full-build-depends .
.It Cm {build,run,lib}-depends
The dependency mechanism now meshes
.Ev BUILD_DEPENDS , LIB_DEPENDS , RUN_DEPENDS, WANTLIB
and
.Ev MULTI_PACKAGES .
Refer to
.Cm prepare , install-depends , test-depends .
.It Cm {pre,do}-extract
Don't override.
Set
.Ev EXTRACT_ONLY
to nothing and override
.Cm post-extract
instead.
.It Cm {pre,do,post}-fetch
These prevented bulk mechanisms from running properly.
.It Cm {pre,do,post}-package
There is no port that requires special treatment during packaging,
as
.Cm {pre,do,post}-install
should take care of every necessity.
.It Cm fetch-list , mirror-distfiles , fetch-makefile , mirror-maker , mirror-maker-fetch
Use
.Cm dpb Fl F
instead, see
.Xr mirroring-ports 7 .
.It Cm obj
Starting with
.Ox 3.3 ,
using
.Ev WRKOBJDIR
no longer creates a symlink between the current directory and
a subdirectory of ${WRKOBJDIR}, so
.Cm obj
is no longer applicable.
.It Cm print-depends
Use
.Cm print-build-depends
and
.Cm print-run-depends
instead.
.It Cm print-depends-list
Renamed into
.Cm print-build-depends .
.It Cm print-package-depends
Renamed into
.Cm print-run-depends .
.It Cm print-package-signature
Renamed into
.Cm print-update-signature .
.It Cm readme , readmes
replaced by the
.Pa databases/ports-readmes
port, using the Template Toolkit
.Po
.Pa textproc/p5-Template
.Pc
instead of hand-coded substitutions.
.El
.Sh OBSOLETE VARIABLES
.Bl -tag -width Ds
.It Ev BIN_PACKAGES
Old user settings.
The infrastructure always trusts the repository to contain correct packages.
So, if the package name did not change and if it exists in the repository,
it will not be rebuilt without manual user action.
.It Ev CATn
List of formatted manpages, per section.
.It Ev CATPREFIX
Location for storing formatted manpages.
Derived directly from
.Ev PREFIX .
.It Ev CDROM_PACKAGES
Old user settings.
Base location where packages suitable for a CD-ROM (see
PERMIT_PACKAGE_CDROM) will be placed.
Now hardwired to
.Pa ${PACKAGE_REPOSITORY}/${MACHINE_ARCH}/cdrom .
.It Ev COMMENT
Used to be the name of the comment file for a package.
It now holds the comment itself.
Some magic has been put in to allow for a seamless transition.
.It Ev CONFIGURE_SHARED
Used to default to --enable-shared or --disable-shared, depending on whether
the architecture supported shared libraries.
.It Ev DESCR_SRC
From
.Nx .
This is DESCR.
.Ox
does not give a specific name to the generated file.
It is not recommended to try to access it directly.
.It Ev EXTRACT_AFTER_ARGS
Was used to cobble together the normal extraction command, as
${EXTRACT_CMD} ${EXTRACT_BEFORE_ARGS} ${EXTRACT_AFTER_ARGS}.
Use
.Ev EXTRACT_CASES
instead.
.It Ev EXTRACT_BEFORE_ARGS
Likewise, use
.Ev EXTRACT_CASES
instead.
.It Ev EXTRACT_CMD
Likewise, use
.Ev EXTRACT_CASES
instead.
.It Ev FETCH_BEFORE_ARGS , FETCH_AFTER_ARGS
Set
.Ev FETCH_CMD
to point to a script that does any required special treatment instead.
.It Ev FETCH_DEPENDS
Used to specify dependencies that were needed to fetch files.
It is much easier to mirror locally weird distribution files.
.It Ev FTP_PACKAGES
User settings.
Base location where packages suitable for FTP (see
PERMIT_PACKAGE_FTP) will be placed.
Now hardwired to
.Pa ${PACKAGE_REPOSITORY}/${MACHINE_ARCH}/ftp .
.It Ev GNU_CONFIGURE
Use
.Ev CONFIGURE_STYLE
instead.
.It Ev HAS_CONFIGURE
Use
.Ev CONFIGURE_STYLE
instead.
.It Ev IGNOREFILES
Set to the list of files that can't be checksummed.
All uses of it have led to postponing the correct action: talking
to the software author and getting him to provide versioned archives.
.It Ev MANn
List of unformatted manpages, per section.
.It Ev MANPREFIX
Location for storing unformatted manpages.
Derived directly from
.Ev PREFIX .
.It Ev MASTERDIR
From
.Fx .
Used to organize a collection of ports that share most files.
.Ox
uses a single port with flavors or multi-packages to produce
package variations instead.
.It Ev MASTER_SITE_SUBDIR
Contents were used to replace
.Sq %SUBDIR%
in all
.Ev MASTER_SITES
variables.
Since
.Sq %SUBDIR%
almost always occur at the end of the directory,
the simpler
.Li ${VARIABLE:=subdir/}
construct is now used instead
.Po
taken from
.Nx
.Pc .
.It Ev MD5_FILE
Use
.Ev CHECKSUM_FILE
instead.
.It Ev MIRROR_DISTFILE
Use
.Ev PERMIT_DISTFILES_FTP
to determine which files can be mirrored instead.
See
.Xr mirroring-ports 7 .
.It Ev NEED_VERSION
Used to set a requirement on a specific revision of
.Nm
needed by a port.
No longer needed as
.Nm
should always be kept up to date.
.It Ev NO_CONFIGURE
If ${CONFIGURE_SCRIPT} does not exist, no automatic configuration will
be done anyway.
.It Ev NO_DESCRIBE
All ports should generate a description.
.It Ev NO_EXTRACT
Set EXTRACT_ONLY= instead.
.It Ev NO_INSTALL_MANPAGES
Use
.Ev CONFIGURE_STYLE
instead.
.It Ev NO_MTREE
Starting with
.Ox 2.7 ,
the operating system installation script runs the /usr/local specification
globally, instead of embedding it in each package.
So packages no longer record an
.Xr mtree 8
specification.
Use an explicit
.Sq @@exec
command if needed.
.It Ev NO_PACKAGE
All ports should generate a package, preferably before install.
.It Ev NO_PATCH
The absence of a patches directory does the same.
Use PATCHDIR and PATCH_LIST if patches need to be changed dynamically.
.It Ev NO_SHARED_ARCHS
Used to be set to the list of platforms that did not support shared libraries.
No such architectures remain.
.It Ev NO_SHARED_LIBS
Used to be set to
.Sq Yes
if platform did not support shared libraries.
.It Ev NO_WRKDIR
All ports should have a working directory, as this is necessary to store
cookies and keep state.
.It Ev NO_WRKSUBDIR
The same functionality is obtained by setting WRKDIST=${WRKDIR} .
.It Ev NOCLEANDEPENDS
Use CLEANDEPENDS instead.
.It Ev NOMANCOMPRESS
.Fx
ships with compressed man pages, and uses this variable to control
that behavior.
.It Ev OBJMACHINE
Starting with
.Ox 3.3 ,
setting
.Ev WRKOBJDIR
creates the whole
.Ev WRKDIR
hierarchy under ${WRKOBJDIR}, so
.Ev OBJMACHINE
is no longer useful.
.It Ev OPSYS
The operating system.
This ports tree is only used on
.Ox .
.It Ev OPSYS_VER
Use
.Ev OSREV
instead.
.It Ev PACKAGES
Base location for packages built, everything is based on
.Ev PACKAGE_REPOSITORY
now.
.It Ev PACKAGING
Used to be set during package creation, so that the port would test it
to tweak some settings at this point.
All its effects are now achieved through
.Ev MULTI_PACKAGES .
.It Ev PATCH_SITES
.Ev PATCHFILES
used to be retrieved from a separate site list.
For greater flexibility, all files are now retrieved from
.Ev MASTER_SITES ,
.Ev MASTER_SITES0 , ... ,
.Ev MASTER_SITES9 ,
using a
.Sq :0
to
.Sq :9
extension to the file name, e.g.,
.Bd -literal -offset indent
PATCHFILES=foo.diff.gz
PATCH_SITES=ftp://ftp.zoinx.org/pub/
.Ed
.Pp
becomes
.Bd -literal -offset indent
PATCHFILES=foo.diff.gz:0
MASTER_SITES0=ftp://ftp.zoinx.org/pub/
.Ed
.It Ev PERMIT_DISTFILES_CDROM
The
.Ox
project does not ship distfiles on cdrom.
Concentrate on real questions instead, make sure
.Ev PERMIT_PACKAGE_CDROM
is set correctly.
.It Ev PKG_CMD
Replaced by
.Ev PKG_CREATE .
.It Ev PKGREPOSITORY
Old user settings.
See
.Ev PACKAGE_REPOSITORY .
.It Ev PKGREPOSITORYBASE
Old user settings.
See
.Ev PACKAGE_REPOSITORY .
.It Ev PLIST_SRC
From
.Nx .
This is PLIST.
.Ox
does not give a specific name to the generated file.
It is not recommended to try to access them directly.
.It Ev PKGNAME
Used to refer to the full package name, has been superseded by
.Ev FULLPKGNAME-foo ,
for
.Ev SUBPACKAGE
-foo .
.Ev PKGNAME
now holds the package name, not taking multi-packages or flavors
into account.
Most ports are not concerned by this change.
.It Ev PLIST_SUBST
From
.Nx
and
.Fx .
Use SUBST_VARS instead.
.Ox
does not allow general substitutions of the form VAR=value, but uses
only a list of variables instead.
Most package files gets transformed, instead of only the packing list.
.It Ev PREFERRED_CIPHERS
Allowing user change of cryptographic digest is dangerous.
.It Ev RECURSIVE_FETCH_LIST
No longer needed with modern
.Xr mirroring-ports 7 .
.It Ev RESTRICTED
Port has cryptographic issues.
.Ox
focuses on
.Ev PERMIT_PACKAGE_{FTP,CDROM}
instead.
.It Ev SED_PLIST
Old pipeline for creating packing-lists at the ports level.
Necessary functionality has been integrated directly into
.Xr pkg_create 1 .
.It Ev SIGNING_PARAMETERS
Old user settings.
There is no longer any benefit to signing packages during creation.
.It Ev SCRIPTDIR
Old location for scripts related to the current port.
There is no reason for the semantic distinction, use
.Ev FILESDIR
for those.
.It Ev SCRIPTS_ENV
Used to contain the environment for invoking various scripts.
.Ev CONFIGURE_ENV
and
.Ev MAKE_ENV
are enough.
.It Ev SHARED_ONLY
Had to be set to
.Sq Yes
if port could only be built on architectures with shared libraries.
.It Ev USE_AUTOCONF
Use
.Ev CONFIGURE_STYLE
instead.
.It Ev USE_BZIP2
The framework will automatically detect the presence of
.Pa .tar.bz2
files to extract.
See also
.Ev BZIP2 , EXTRACT_CASES ,
and
.Ev EXTRACT_SUFX .
.It Ev USE_IMAKE
Use
.Ev CONFIGURE_STYLE
instead.
.It Ev USE_ZIP
The framework will automatically detect the presence of
.Pa .zip
files to extract.
See also
.Ev ZIP , EXTRACT_CASES ,
and
.Ev EXTRACT_SUFX .
.It Ev VARNAME
Use make show=name instead of make show VARNAME=name.
.It Ev WRKPKG
Directory used to build package information from the templates under
.Pa ${PKGDIR} .
This information is now built on the fly by
.Xr pkg_create 1 .
.El
.Sh OBSOLETE FILES
.Bl -tag -width Ds
.It Pa {files,patches,pkg}.${ARCH}
Offensive to introspection, makes it impossible to build a decent sqlports
on a given arch.
Hasn't been used for a long time, and there are lots of mechanisms such as
.Ev PKG_ARGS
and fragment substitution, or
.Ev PATCH_LIST
to achieve similar results.
.It Pa Makefile.${ARCH}
Likewise, offensive to introspection too.
.It Pa ${FILESDIR}/md5
Renamed to
.Pa distinfo
to match other
.Bx ,
and save directories.
.It Pa ${SCRIPTDIR}/{pre,do,post}-*
Identical functionality can be obtained through a
.Cm {pre,do,post}-*
target, invoking the script manually if necessary.
.It Pa ${SCRIPTDIR}/configure
No longer invoked automatically.
Just inline the instructions in
.Cm do-configure
in the Makefile, or put the script in ${FILESDIR} and
invoke it.
.It Pa ${PKGDIR}/COMMENT
Use COMMENT variable instead.
.It Pa ${PKGDIR}/DEINSTALL*
Use @@unexec annotations in the packing-list instead.
.It Pa ${PKGDIR}/INSTALL*
Use @@exec annotations in the packing-list instead.
.It Pa ${PKGDIR}/PLIST.{noshared,no-shared,shared}
Packaging list fragments to handle platforms that did not support
shared libraries.
.It Pa ${PKGDIR}/PLIST.sed
Use PLIST directly.
Until revision 1.295,
.Nm
did not substitute variables in the packing list unless this special form
was used.
.It Pa ${PKGDIR}/REQ*
Old requirement script.
Was mostly unused anyway.
.It Pa /usr/share/mk/bsd.port.mk
Original location of
.Nm .
The current file lives under
.Pa ${PORTSDIR}/infrastructure/mk/bsd.port.mk ,
whereas
.Pa /usr/share/mk/bsd.port.mk
is just a stub.
.It Pa {scripts,files,patches}.${OPSYS}
The
.Ox
ports tree focuses on robustness, not on being portable to other operating
systems.
In any case, portability should not need to depend on operating
system dependent patches.
.It Pa /usr/local/etc
Used by
.Fx
to marshall system configuration files.
All
.Ox
system configuration files are located in
.Pa /etc ,
or in a subdirectory of
.Pa /etc .
.El
.Sh SEE ALSO
.Xr ftp 1 ,
.Xr pkg_add 1 ,
.Xr pkg_create 1 ,
.Xr OpenBSD::Intro 3p ,
.Xr bsd.port.arch.mk 5 ,
.Xr mk.conf 5 ,
.Xr port-modules 5 ,
.Xr library-specs 7 ,
.Xr mirroring-ports 7 ,
.Xr packages-specs 7 ,
.Xr pkgpath 7 ,
.Xr ports 7
.Sh HISTORY
The ports mechanism originally came from
.Fx .
A lot of additions were taken from
.Nx
over the seminal years.
.Pp
Since 1998, the framework has been systematically cleaned-up and reorganized
to remove bugs.
New features have been carefully introduced, trying hard to avoid
inconsistencies.
.Pp
FLAVORS, MULTI_PACKAGES and FAKE are
.Ox
improvements.
Most recent additions do not come from another
.Bx .
.\" Voluntarily undocumented:
.\" AUTOCONF_ENV: probably not needed anyway, should be internal.
.Sh BUGS AND LIMITATIONS
.Ev LOCALBASE ,
.Ev X11BASE ,
.Ev SYSCONFDIR
and
.Ev PREFIX
are not heeded consistently.
Most of the ports tree will probably fall
apart if one tries to build/use stuff elsewhere.
@


1.465
log
@consistently use "User settings" instead of a mixture of this and a
couple of "User-settings" in bsd.port.mk(5).  ok espie@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.464 2017/06/28 10:34:10 espie Exp $
d27 1
a27 1
.Dd $Mdocdate: June 28 2017 $
d1216 1
a1216 1
Usually read-only.
d1252 34
a1285 4
Select a somewhat more recent compiler than gcc 4.2.1.
Set to a list containing
.Sq base
(clang compiler in base),
d1287 2
a1288 19
(clang compiler in ports),
or
.Sq gcc
(gcc 4.9 from ports).
The first compiler that matches criteria
.Po
.Ev MODCLANG_ARCHS
or
.Ev MODGCC4_ARCHS
from respective modules
.Pc
will be chosen.
On an architecture using
.Xr clang 1
as the default compiler,
clang from the base system will always be chosen,
so it is not necessary to list
.Sq base
unless it's the only suitable compiler.
d1290 1
a1290 1
Common reasons for using
d1304 7
a1310 1
.Sq * .
d1312 1
a1312 4
If
.Ev COMPILER
is in effect,
the value of
@


1.464
log
@and emphasize that PKGDIR must exist.
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.463 2017/06/28 10:33:08 espie Exp $
d845 1
a845 1
.Sq User-settings ,
d955 1
a955 1
User-settings.
d2502 1
a2502 1
User-settings.
@


1.463
log
@document generate-readmes and diagnostic for missing PKGDIR.
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.462 2017/06/10 10:13:10 espie Exp $
d27 1
a27 1
.Dd $Mdocdate: June 10 2017 $
d2390 3
@


1.462
log
@perl(1)'s ...
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.461 2017/06/10 10:12:06 espie Exp $
d358 12
d3117 10
d3433 4
a3436 2
at the end of
.Cm fake
@


1.461
log
@use mandoc annotations for flags and such
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.460 2017/06/05 21:54:07 sthen Exp $
d27 1
a27 1
.Dd $Mdocdate: June 5 2017 $
d1364 1
a1364 1
.Xr perl 1
@


1.460
log
@initial docs for COMPILER_WRAPPER and COMPILER_LINKS
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.459 2017/05/31 10:06:02 jmc Exp $
d27 1
a27 1
.Dd $Mdocdate: May 31 2017 $
d1308 10
a1317 3
to build scripts in ${WRKDIR}/bin to force setting compiler flags
(-B is required for clang to find ${WRKDIR}/bin/ld as used by
.Ev USE_WXNEEDED )
@


1.459
log
@minor tweaks;
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.458 2017/05/31 08:12:27 espie Exp $
d1303 16
@


1.458
log
@document COMPILER, this is getting to be clean enough to be documentable
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.457 2017/04/11 20:40:33 sthen Exp $
d27 1
a27 1
.Dd $Mdocdate: April 11 2017 $
d57 2
a58 1
.Bx variants.
d1242 1
a1242 1
.Sq base 
d1247 1
a1247 1
.Sq gcc 
d1259 1
a1259 1
as the default compiler, 
@


1.457
log
@- Mention LIBCXX, prompted by espie@@.

- Make it clear that CLANG_ARCHS, GCC3_ARCHS, GCC4_ARCHS refer to the base compiler.
Change "Clang 3.9.1" to just "Clang".
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.456 2017/03/01 10:41:40 espie Exp $
d27 1
a27 1
.Dd $Mdocdate: March 1 2017 $
d1202 9
d1238 64
@


1.456
log
@gc really old stuff that's not actually in use anymore
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.455 2017/02/20 14:29:55 espie Exp $
d27 1
a27 1
.Dd $Mdocdate: February 20 2017 $
d1242 1
a1242 1
List of architectures using Clang 3.9.1, GCC 3.3.6 or GCC 4.2.1.
d1750 5
@


1.455
log
@install-depends works as expected for multi-package setups.
it's prepare that's special.
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.454 2017/02/20 14:21:45 espie Exp $
a335 1
.Ev CDROM_SITE ,
a399 7
.It Cm link-categories
Create symbolic links in other directories that correspond to the port's
.Ev CATEGORIES .
Note that this does not affect bulk package building, since those links
don't appear in the upper-level Makefiles.
See also
.Cm unlink-categories .
a728 5
.It Cm unlink-categories
Remove symbolic links in other directories that correspond to the port's
.Ev CATEGORIES .
See also
.Cm link-categories .
a1147 12
.It Ev CDROM_SITE
Path to a local source that holds distribution files (usually a CD-ROM
or other similar media), used to retrieve distribution files before going
to the network.
Defaults to empty, set to
.Pa /cdrom/distfiles/${DIST_SUBDIR}
to check that path.
Distribution files are still copied or linked (see
.Ev FETCH_SYMLINK_DISTFILES )
into
.Ev DISTDIR
if they are found under CDROM_SITE.
a1583 7
.It Ev FETCH_SYMLINK_DISTFILES
User settings.
Set to
.Sq Yes
to link distribution files off
.Ev CDROM_SITE
instead of copying them.
@


1.454
log
@tighter documentation for dependency handling
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.453 2017/02/19 16:12:28 espie Exp $
d27 1
a27 1
.Dd $Mdocdate: February 19 2017 $
d352 3
a354 1
Also fetches
d362 2
a363 3
Before package installation, Install and verify dependencies constructed from
.Ev RUN_DEPENDS ,
.Ev LIB_DEPENDS ,
a365 5
In
.Ev MULTI_PACKAGES
setups,
see
.Sx FLAVORS AND MULTI_PACKAGES .
@


1.453
log
@more old mirror targets
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.452 2017/02/19 10:55:35 espie Exp $
a138 7
.It Cm build-depends
Verify the ports mentioned in
.Ev BUILD_DEPENDS ,
by checking the corresponding packages are actually installed,
and install the missing ports by recursing through the ports tree.
Deprecated, see
.Cm prepare .
a224 6
.It Cm depends
Check all the port's dependencies, that is:
.Cm build-depends ,
.Cm lib-depends ,
.Cm run-depends ,
.Cm test-depends .
d359 11
a378 3
.It Cm lib-depends
Verify that the library dependencies a port needs are actually there,
by checking the library specifications.
d550 2
a551 2
Prepare a port for building, by checking and installing all required
dependencies, constructed from
d554 1
a554 1
.Ev BUILD_DEPENDS .
a669 6
.It Cm run-depends
Verify the ports mentioned in
.Ev RUN_DEPENDS ,
by checking the corresponding packages are actually installed,
and install the missing ports by recursing through the ports tree.
Invoked right before installing the package.
d738 3
a740 4
Verify packages needed for regression tests, using the same scheme as
.Cm build-depends .
Only invoked when regression tests are run, or explicitly through
.Cm depends .
d1755 1
a1755 1
Libraries this port depends upon.
d1765 5
a1769 1
.Ev BUILD_DEPENDS .
a1770 1
On architectures that use dynamic libraries,
d2925 1
a2925 1
Extra list of library specifications that a package will need.
d3694 7
@


1.452
log
@more removing / simplifying of fetch stuff
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.451 2017/02/19 10:07:21 espie Exp $
a437 9
.It Cm mirror-maker
Top-level target, see
.Xr mirroring-ports 7 .
.It Cm mirror-maker-fetch
Debug target: generate the
.Cm mirror-maker
makefile fragment and use it
to fetch files, see
.Xr mirroring-ports 7 .
a2534 3
.It Ev RECURSIVE_FETCH_LIST
See
.Xr mirroring-ports 7 .
d3717 5
a3721 4
.It Cm fetch-list , mirror-distfiles , fetch-makefile
See
.Xr mirroring-ports 7
for more efficient and flexible ways to build mirrors.
d4014 3
@


1.451
log
@trailing space
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.450 2017/02/18 15:13:00 espie Exp $
d27 1
a27 1
.Dd $Mdocdate: February 18 2017 $
d167 4
a170 3
of distribution archives and distribution patches and
check it against ${CHECKSUM_FILE}.
Invoking
d174 2
a175 1
will try to fetch a version with the correct checksum from the
d177 1
a177 5
main archive site in the case of a checksum mismatch.
.Ev NO_CHECKSUM
can be used to bypass
.Cm checksum
(for instance, if it has already been done).
d227 1
a227 2
Might be a void operation.
Unless overridden,
d303 1
a303 2
Fetch the distribution files and patchfiles, using ${FETCH_CMD}.
Each file of the
d307 2
a308 1
lists is retrieved, if necessary, from the list of sites in
d311 1
a311 1
If a filename ends with a
d315 2
a316 1
extension, it will be retrieved from
d321 1
a321 2
After stripping that extension if necessary,
if the entry parses as
d323 1
a323 1
it will be fetched as
d325 1
a325 1
instead, yet still stored as
d328 3
a330 2
Transfers in progress will be stored as
.Ar filenamesufx.part .
d336 1
a336 6
to cache the ports distribution files and patch files.
Note that this framework is also used by mirroring scripts,
which will also retrieve
.Ev SUPDISTFILES ,
to fill with supplementary distribution files which are not needed for
every configuration.
d338 4
a341 6
Note that fetching a significant number of distfiles, or fetching all distfiles
relevant to a port and dependencies is better accomplished using
.Xr dpb 1
with the
.Fl F
option.
d346 1
d365 1
a365 1
also fetches
d426 8
a433 5
Create the ${CHECKSUM_FILE} list of recorded checksums by running the
cryptographic fingerprint sha256 on ${MAKESUMFILES}.
That normally includes ${DISTFILES}, ${SUPDISTFILES} and ${PATCHFILES}.
.Ev NO_CHECKSUM
can be used to avoid all checksumming steps.
a2044 1
User settings.
d2047 2
d2050 5
a2054 4
.Cm checksum ,
entirely.
Beware of the full implications of this mechanism, namely that it disables
the basic authentication mechanisms of the ports tree entirely.
@


1.450
log
@shorten description
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.449 2017/02/18 15:05:56 espie Exp $
d164 1
a164 1
Compute a 
@


1.449
log
@bye bye PREFERRED_CIPHERS
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.448 2017/02/18 14:36:24 espie Exp $
d164 1
a164 5
Check distribution archives and distribution patches control sum against
the results recorded in ${CHECKSUM_FILE},
using the proper cryptographic message digest 
.Po 
currently 
d166 3
a168 3
.Pc
All the files needed to recreate a port should be in ${CHECKSUMFILES} and
checksummed.
@


1.448
log
@bye bye addsum, use SUPDISTFILES correctly
also, NO_CHECKSUM is very specific and limited now
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.447 2017/02/18 14:29:23 espie Exp $
d166 5
a170 1
using the message digest (checksum) utilities listed in ${PREFERRED_CIPHERS}.
d181 3
a183 1
can be used to avoid all checksumming steps.
a2427 5
.It Ev PREFERRED_CIPHERS
List of cryptographic ciphers to use, in order of preference.
Default is
.Sq sha256 .
The first cipher that matches in ${CHECKSUM_FILE} is verified.
d3242 2
a3243 1
using ${PREFERRED_CIPHERS},
d4030 2
@


1.447
log
@tighter introduction
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.446 2017/01/29 21:37:17 jmc Exp $
d27 1
a27 1
.Dd $Mdocdate: January 29 2017 $
a123 5
.It Cm addsum
Complete the ${CHECKSUM_FILE} record of checksums with files that have been
added since
.Cm makesum .
Complain if anything does not match.
a1229 1
.Cm addsum ,
d2053 1
a2053 4
.Cm makesum ,
and
.Cm addsum
actions entirely.
d3708 5
@


1.446
log
@remove pesky blank line: sorry for not spotting this in previous;
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.445 2017/01/29 20:53:20 danj Exp $
d37 21
a57 3
holds all the standard routines used by the ports tree.
Some variables and targets are for its internal use only.
The rest is documented here.
a65 18
Other
.Bx
variants, as well as older versions of
.Nm ,
include other targets and variables.
Conversion methods are outlined here.
.Pp
Most variables and targets are documented, with very few exceptions.
.Pp
This documentation covers the current targets, variables and paths used by
.Nm .
There is a separate section covering the fake framework, a section
explaining flavors and multi-packages, and a section covering
the generation of package information.
.Pp
It ends with sections on obsolete constructs that a porter may need
when converting from other ports systems.
.Pp
d73 1
a73 1
Selected common user activity such as the building of every package in
d76 3
a78 1
instead.
d80 1
a80 1
provides an overview of the result.
@


1.445
log
@Document restrictions that apply to COMMENT

better wording from jmc@@, ok jmc@@ sthen@@
@
text
@d1 1
a1 2

.\" $OpenBSD: bsd.port.mk.5,v 1.444 2017/01/23 11:13:11 zhuk Exp $
d27 1
a27 1
.Dd $Mdocdate: January 23 2017 $
@


1.444
log
@Add LLVM_ARCHS description as well, to make more clear the distinction
between it and CLANG_ARCHS.

Clang comes before GCC in English, so sort the header itself, and move
and move the whole item up.
@
text
@d2 1
a2 1
.\" $OpenBSD: bsd.port.mk.5,v 1.443 2017/01/23 10:49:12 phessler Exp $
d1269 4
a1272 2
Short, one line description of the port, used for the package, and in the
INDEX.
@


1.443
log
@quick blurb about the upcoming CLANG_ARCHS variable
@
text
@d2 1
a2 1
.\" $OpenBSD: bsd.port.mk.5,v 1.442 2017/01/01 01:08:11 tb Exp $
d28 1
a28 1
.Dd $Mdocdate: January 1 2017 $
d1297 8
a1694 8
.It Ev GCC3_ARCHS , GCC4_ARCHS , CLANG_ARCHS
List of architectures using gcc 3.3.6, gcc 4.2.1, or clang 3.9.1.
Read-only.
Use with
.Ev NOT_FOR_ARCHS
or
.Ev ONLY_FOR_ARCHS
to limit ports to architectures where they compile.
d1818 9
@


1.442
log
@Hyphenate compound adjectives 'up-to-date', 'out-of-date' and 'well-known'
if they precede the noun and omit hyphens otherwise.

ok tj
@
text
@d1 2
a2 1
.\" $OpenBSD: bsd.port.mk.5,v 1.441 2016/11/03 17:13:40 danj Exp $
d28 1
a28 1
.Dd $Mdocdate: November 3 2016 $
d1687 2
a1688 2
.It Ev GCC3_ARCHS , GCC4_ARCHS
List of architectures using gcc 3.3.6, or gcc 4.2.1.
@


1.441
log
@Add a proper annotation for portroach documentation link

OK schwarze@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.440 2016/09/28 19:34:54 danj Exp $
d27 1
a27 1
.Dd $Mdocdate: September 28 2016 $
d2570 1
a2570 1
to make sure that all Makefile.in are up-to-date.
d3879 1
a3879 1
should always be kept up-to-date.
@


1.440
log
@Add a sentence about BUILD_DEPENDS automatically set with EXTRACT_SUFX

ok jmc@@ sthen@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.439 2016/09/06 10:32:51 espie Exp $
d27 1
a27 1
.Dd $Mdocdate: September 6 2016 $
d2417 1
a2417 1
http://jasperla.github.io/portroach/docs/portroach-portconfig.txt .
@


1.439
log
@byebye SIGNING_PARAMETERS
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.438 2016/08/18 12:29:53 sthen Exp $
d27 1
a27 1
.Dd $Mdocdate: August 18 2016 $
d1569 2
@


1.438
log
@document USE_WXNEEDED, feedback/ok jca jasper
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.437 2016/08/01 00:48:22 espie Exp $
d27 1
a27 1
.Dd $Mdocdate: August 1 2016 $
a2262 2
Signing options should be set separately in
.Ev SIGNING_PARAMETERS .
a2637 5
.It Ev SIGNING_PARAMETERS
User settings.
Set to
.Xr pkg_create 1
options for signing packages directly during their creation.
d4027 3
@


1.437
log
@document default for DISTDIR
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.436 2016/05/17 13:42:28 espie Exp $
d27 1
a27 1
.Dd $Mdocdate: May 17 2016 $
d2925 8
@


1.436
log
@Deprecate PLIST_DB. Prefer PLIST_REPOSITORY (same semantics, except that
ARCH gets appended automatically)
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.435 2016/04/25 19:24:42 tedu Exp $
d27 1
a27 1
.Dd $Mdocdate: April 25 2016 $
d3226 2
@


1.435
log
@remove systrace
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.434 2016/03/22 16:02:02 naddy Exp $
d27 1
a27 1
.Dd $Mdocdate: March 22 2016 $
d155 1
a155 1
.Ev PLIST_DB
d479 1
a479 1
If PLIST_DB is set, the resulting packaging information is compared
d2383 3
d2387 1
a2387 1
Directory used to save generated packing-lists, as persistent information.
d2401 5
a2405 1
.Pa ${PORTSDIR}/plist/${MACHINE_ARCH} .
d3675 1
a3675 1
.Ev PLIST_DB
d3680 3
a3682 1
stage are saved in that location by a script:
@


1.434
log
@The scaffolding to support architectures without shared libraries
has been removed from the ports infrastructure.  Gone are:
* variables CONFIGURE_SHARED, NO_SHARED_LIBS, NO_SHARED_ARCHS, SHARED_ONLY
* PROPERTIES value "no_shared"
* PFRAG.shared and PFRAG.no-shared files

Also drop mention of the long gone PROPERTIES value "elf".

ok sthen@@, ok & tweaks jmc@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.433 2016/03/11 20:40:23 sthen Exp $
d27 1
a27 1
.Dd $Mdocdate: March 11 2016 $
a2076 2
.It Ev NO_SYSTRACE
Port does not build with systrace-enabled build targets.
a2784 19
.It Ev SYSTRACE_FILTER
Location of the systrace filter file which is the basis for a port's
actual systrace policy file.
Defaults to
.Pa ${PORTSDIR}/infrastructure/db/systrace.filter .
.It Ev SYSTRACE_FILTER_CCACHE
Location of the supplementary systrace filter file which is used when
.Ev USE_CCACHE
is enabled.
Defaults to
.Pa ${PORTSDIR}/infrastructure/db/systrace.filter.ccache .
.It Ev SYSTRACE_SUBST_VARS
List of variables used in ${SYSTRACE_FILTER} that will be substituted
by their real value when creating the systrace policy file.
Always holds
.Ev WRKOBJDIR ,
.Ev PORTSDIR ,
and
.Ev DISTDIR .
a2917 5
.It Ev USE_SYSTRACE
User settings.
Set to
.Sq Yes
to protect port building with systrace.
a3286 4
.It Pa systrace.filter
List of additional port specific filters, included automatically.
.It Pa systrace.policy
List of additional port specific policies, included automatically.
@


1.433
log
@Document perl Module::Build::Tiny support in CONFIGURE_STYLE
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.432 2016/01/02 08:29:26 jmc Exp $
d27 1
a27 1
.Dd $Mdocdate: January 2 2016 $
d837 3
a839 6
should produce mostly correct
.Pa PLIST ,
.Pa PFRAG.shared
and
.Pa PFRAG.no-shared
files, handling shared libraries, GNU
d842 3
a844 6
It moves existing files to
.Pa PLIST.orig ,
.Pa PFRAG.shared.orig
and
.Pa PFRAG.no-shared.orig .
If the generated lists include files and directories that shouldn't be
a1307 5
.It Ev CONFIGURE_SHARED
Set by default to --enable-shared or --disable-shared, depending on whether
the architecture supports shared libraries.
Should be appended to CONFIGURE_ARGS, for ports that build dynamic libraries
and whose configure script supports these options.
a2026 5
See also
.Ev SHARED_ONLY .
Do not use instead of
.Ev SHARED_ONLY
without very good reasons.
a2076 14
.It Ev NO_SHARED_ARCHS
Set to the list of platforms that do not support shared libraries.
Read-only.
Use with
.Ev NOT_FOR_ARCHS .
.It Ev NO_SHARED_LIBS
Set to
.Sq Yes
if platform does not support shared libraries.
To be tested after including
.Nm ,
or
.Xr bsd.port.arch.mk 5 ,
if neither PFRAG.shared nor CONFIGURE_SHARED are enough.
d2466 1
a2466 1
.Bl -tag -width no_shared
a2472 3
.It elf
.Xr elf 5
architecture.
a2476 2
.It no_shared
architecture has no shared library support.
a2634 4
.It Ev SHARED_ONLY
Set to
.Sq Yes
if port can only be built on architectures with shared libraries.
d3635 1
a3635 1
by inserting shared/no-shared fragments, merging other fragments,
d3646 2
a3647 2
Constructs such as the line
.Li "%%SHARED%%"
d3649 3
a3651 3
.Li "!%%SHARED%%"
in the packing-list template trigger the inclusion of the
.Pa ${PKGDIR}/PFRAG.shared${SUBPACKAGE}
d3653 1
a3653 11
.Pa ${PKGDIR}/PFRAG.no-shared${SUBPACKAGE} .
.Pp
Similarly, if FLAVORS lists flav1, then the line
.Li "%%flav1%%"
(resp.
.Li "!%%flav1%%" )
will trigger the inclusion of
.Pa ${PKGDIR}/PFRAG.flav1${SUBPACKAGE}
(resp.
.Pa ${PKGDIR}/PFRAG.no-flav1${SUBPACKAGE} )
in the packing-list.
d3659 1
a3659 1
.Ev PKG_ARGS
d3695 1
a3695 2
target does a fairly good job of automatically generating PLIST and
PFRAG.shared fragments.
d3801 3
d3923 7
d3998 1
a3998 1
replaced by
d4056 4
d4126 3
a4128 3
.It Pa ${PKGDIR}/PLIST.noshared
Use PFRAG.shared or PFRAG.no-shared instead.
PLIST.noshared was too easy to forget when updating ports.
@


1.432
log
@tweak previous;
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.431 2016/01/01 18:38:19 jasper Exp $
d27 1
a27 1
.Dd $Mdocdate: January 1 2016 $
d1329 1
a1329 1
.Sq modbuild ,
d1331 4
a1334 2
.Xr perl 1
.Xr Module::Build 3p
@


1.431
log
@Mention that GH_* yield a default for DISTNAME
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.430 2015/12/28 23:30:59 mmcc Exp $
d27 1
a27 1
.Dd $Mdocdate: December 28 2015 $
d1705 2
a1706 1
.Ev MASTER_SITES_GITHUB and
@


1.430
log
@The last of the e-mail -> email.
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.429 2015/12/06 22:33:47 mmcc Exp $
d27 1
a27 1
.Dd $Mdocdate: December 6 2015 $
d1705 2
a1706 1
.Ev MASTER_SITES_GITHUB .
@


1.429
log
@Update reference from lang/gcc/4.2 to lang/gcc/4.9. From Daniel
Bolgheroni, discussed with espie@@.
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.428 2015/11/23 10:01:45 jmc Exp $
d27 1
a27 1
.Dd $Mdocdate: November 23 2015 $
d1857 1
a1857 1
E-mail address with full name of the port's maintainer.
@


1.428
log
@point to mount_mfs(8), not mfs(8);
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.427 2015/10/12 10:27:22 sthen Exp $
d27 1
a27 1
.Dd $Mdocdate: October 12 2015 $
d3641 1
a3641 1
.Pa lang/gcc/4.2
@


1.427
log
@fix case of PACkAGE_REPOSITORY; remco at dpub nl
               ^
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.426 2015/09/23 01:38:36 schwarze Exp $
d27 1
a27 1
.Dd $Mdocdate: September 23 2015 $
d2965 3
a2967 3
to build ports under an
.Xr mfs 8
filesystem.
d3077 1
a3077 3
The intent is to use an
.Xr mfs 8
based filesystem for small ports with
@


1.426
log
@minor .Pa cleanup, including one chunk from Michael Reed
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.425 2015/09/23 01:29:47 schwarze Exp $
d3339 1
a3339 1
.It Pa ${PACkAGE_REPOSITORY}/${MACHINE_ARCH}/ftp
@


1.425
log
@The best way to display complete command invocations including command
names, options and arguments are literal displays: .Bd -literal for
multiple lines, .Dl for single lines, and (in these cases) .Ql for
in-line displays.
Triggered by a different patch from Michael Reed.
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.424 2015/09/23 01:11:13 schwarze Exp $
d2581 1
a2581 1
.Pa ftp.openbsd.org ,
d3457 1
a3457 1
.Pa bsd.port.mk
@


1.424
log
@Obviously, .Ar is the wrong macro for Makefile targets - .Ar is for
placeholders to be replaced by something else by the user.
As these are fixed strings passed on the make(1) command line, use .Cm.
Trim some excessive indentation while here.
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.423 2015/09/22 22:27:28 schwarze Exp $
d27 1
a27 1
.Dd $Mdocdate: September 22 2015 $
d226 2
a227 1
Shorthand for make clean=depends.
d246 2
a247 1
Shorthand for make clean=dist.
d515 2
a516 1
make distpatch, before applying
d1223 1
a1223 1
.Nm make Ar lib-depends-check
d1268 3
a1270 2
.Sq make clean
will also clean dependencies.
d2383 1
a2383 1
.Sq make show=PKGNAMES
d2423 1
a2423 1
.Sq make clean=plist
d3245 1
a3245 1
.Li make package
@


1.423
log
@consistency: no need to restate the page name in .Nm over and over again;
Michael Reed <m dot reed at mykolab dot com>
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.422 2015/09/21 09:06:33 schwarze Exp $
d27 1
a27 1
.Dd $Mdocdate: September 21 2015 $
d80 2
a81 2
.Bl -tag -width do-configure
.It Ar {build,run,all,test}-dir-depends
d87 1
a87 1
.It Ar full-{all,build,run,test}-depends
d92 1
a92 1
.It Ar {build,lib,test,run}-depends-list
d96 1
a96 1
.It Ar print-{build,run}-depends
d98 1
a98 1
.Ar full-{build,run}-depends
d100 1
a100 1
.It Ar {pre,do,post}-*
d104 1
a104 1
.Ar pre-*
d107 1
a107 1
.Ar do-*
d110 1
a110 1
.Ar post-*
d113 8
a120 8
.Ar build ,
.Ar configure ,
.Ar distpatch ,
.Ar extract ,
.Ar fake ,
.Ar install ,
.Ar patch ,
.Ar test .
d122 1
a122 1
.It Ar addsum
d125 1
a125 1
.Ar makesum .
d127 1
a127 1
.It Ar all-lib-depends-args
d133 2
a134 2
.Ar print-package-args .
.It Ar build , Ar all
d142 1
a142 1
.It Ar build-depends
d148 2
a149 2
.Ar prepare .
.It Ar check-register
d157 1
a157 1
.It Ar check-register-all
d159 1
a159 1
.Ar check-register
d161 1
a161 1
.It Ar checkpatch
d163 1
a163 1
.Ar patch
d166 1
a166 1
.It Ar checksum
d173 1
a173 1
.Ar checksum
d181 1
a181 1
.It Ar clean
d225 1
a225 1
.It Ar clean-depends
d227 1
a227 1
.It Ar configure
d230 3
a232 2
Unless overridden, configure creates the ${WRKBUILD}
directory (see SEPARATE_BUILD),
d235 1
a235 1
.It Ar depends
d237 5
a241 5
.Ar build-depends ,
.Ar lib-depends ,
.Ar run-depends ,
.Ar test-depends .
.It Ar describe
d244 1
a244 1
.It Ar distclean
d246 1
a246 1
.It Ar distpatch
d249 1
a249 1
.Ar patch
d253 1
a253 1
.It Ar dump-vars
d256 1
a256 1
.It Ar extract
d267 1
a267 1
.Ar pre-extract
d269 1
a269 1
.Ar do-extract
d271 1
a271 1
.It Ar fake
d275 1
a275 1
.Ar do-fake
d277 1
a277 1
.Ar post-fake
d279 1
a279 1
.Ar fake
d281 3
a283 3
.Ar pre-fake ,
.Ar pre-install ,
.Ar do-install
d285 1
a285 1
.Ar post-install .
d287 2
a288 2
.Ar pre-install ,
.Ar do-install ,
d290 1
a290 1
.Ar post-install
d293 1
a293 1
.Ar pre-fake
d298 1
a298 1
.It Ar fake-wantlib-args
d303 2
a304 2
.Ar print-package-args .
.It Ar fetch
d352 1
a352 1
.Ar {pre,do,post}-fetch
d371 1
a371 1
.It Ar fetch-all
d375 2
a376 2
.Ar makesum .
.It Ar index
d379 1
a379 1
.It Ar install
d384 1
a384 1
.Ar {pre,do,post}-install
d386 1
a386 1
.It Ar install-all
d388 1
a388 1
.It Ar lib-depends
d391 1
a391 1
.It Ar lib-depends-args
d399 2
a400 2
.Ar print-package-args .
.It Ar lib-depends-check
d407 1
a407 1
.Ar port-lib-depends-check ,
d409 1
a409 1
.It Ar license-check
d417 1
a417 1
.It Ar link-categories
d423 2
a424 2
.Ar unlink-categories .
.It Ar lock
d428 1
a428 1
.Ar unlock .
d432 1
a432 1
.It Ar makesum
d438 1
a438 1
.It Ar manpages-check
d442 1
a442 1
.It Ar mirror-maker
d445 1
a445 1
.It Ar mirror-maker-fetch
d447 1
a447 1
.Ar mirror-maker
d451 1
a451 1
.It Ar no-lib-depends-args
d453 1
a453 1
.Ar lib-depends-args
d456 2
a457 2
.Ar print-package-args .
.It Ar no-wantlib-args
d459 1
a459 1
.Ar wantlib-args
d462 2
a463 2
.Ar print-package-args .
.It Ar package
d490 1
a490 1
.It Ar patch
d495 1
a495 1
.Ar patch
d498 1
a498 1
.Ar patch
d500 1
a500 1
.Ar pre-patch
d502 1
a502 1
.Ar do-patch ,
d504 1
a504 1
.Ar post-patch ,
d506 1
a506 1
.Ar do-patch
d508 1
a508 1
.Ar distpatch
d511 1
a511 1
.Ar do-patch
d517 5
a521 5
.Ar pre-patch ,
.Ar do-distpatch ,
.Ar post-distpatch ,
.Ar do-patch ,
.Ar post-patch .
d531 1
a531 1
.Ar post-patch
d533 1
a533 1
.It Ar peek-ftp
d539 1
a539 1
.It Ar pkglocatedb
d542 1
a542 1
.It Ar port-lib-depends-check
d551 1
a551 1
.Ar print-plist-with-depends
d554 1
a554 1
.Ar fake
d556 1
a556 1
.Ar lib-depends-check ,
d558 1
a558 1
.It Ar port-wantlib-args
d565 2
a566 2
.Ar print-package-args .
.It Ar prepare
d577 1
a577 1
.It Ar print-package-args
d588 1
a588 1
.Ar run-depends-args
d592 1
a592 1
.Ar lib-depends-args
d599 1
a599 1
.Ar wantlib-args
d611 1
a611 1
.Ar lib-depends-args ,
d613 1
a613 1
.Ar all-lib-depends-args
d615 1
a615 1
.Ar port-lib-depends-check ,
d620 1
a620 1
.Ar wantlib-args
d622 1
a622 1
.Ar port-wantlib-args
d625 1
a625 1
.Ar fake-wantlib-args
d627 1
a627 1
.Ar no-wantlib-args
d629 1
a629 1
.It Ar print-update-signature
d634 1
a634 1
.It Ar print-plist
d637 1
a637 1
.It Ar print-plist-all
d639 1
a639 1
.Ar print-plist
d641 1
a641 1
.It Ar print-plist-all-with-depends
d643 1
a643 1
.Ar print-plist-with-depends
d645 1
a645 1
.It Ar print-plist-contents
d649 1
a649 1
.Ar print-plist ,
d654 1
a654 1
.It Ar print-plist-libs
d658 1
a658 1
.It Ar print-plist-libs-with-depends
d660 1
a660 1
.Ar print-plist-libs ,
d668 1
a668 1
.It Ar print-plist-with-depends
d670 1
a670 1
.Ar print-plist ,
d678 1
a678 1
.It Ar rebuild
d680 1
a680 1
.It Ar reinstall
d683 1
a683 1
.Ar update
d685 1
a685 1
.It Ar repackage
d687 1
a687 1
.It Ar run-depends
d693 1
a693 1
.It Ar run-depends-args
d699 2
a700 2
.Ar print-package-args .
.It Ar show
d707 1
a707 1
.It Ar show-fake-size
d713 1
a713 1
.It Ar show-prepare-results
d715 2
a716 2
.Ar prepare .
.It Ar show-prepare-test-results
d718 1
a718 1
.Ar prepare
d720 2
a721 2
.Ar test-depends .
.It Ar show-required-by
d727 1
a727 1
.It Ar show-run-depends
d729 1
a729 1
.It Ar subpackage
d732 1
a732 1
.Ar package ,
d734 1
a734 1
.It Ar show-size
d740 1
a740 1
.It Ar subupdate
d743 1
a743 1
.Ar update ,
d745 1
a745 1
.It Ar test
d760 1
a760 1
.It Ar test-depends
d762 1
a762 1
.Ar build-depends .
d764 2
a765 2
.Ar depends .
.It Ar unlink-categories
d769 2
a770 2
.Ar link-categories .
.It Ar unlock
d773 2
a774 2
.Ar lock .
.It Ar update-patches
d796 2
a797 2
.Pa patch-file.orig
.It Ar update
d810 1
a810 1
.It Ar update-or-install
d820 1
a820 1
.It Ar update-or-install-all
d830 1
a830 1
.It Ar update-plist
d833 1
a833 1
.Ar update-plist
d855 1
a855 1
.Ar update-plist
d858 1
a858 1
.Ar update-plist
d860 1
a860 1
.It Ar verbose-show
d862 1
a862 1
.Ar show ,
d866 1
a866 1
.Ar show
d868 1
a868 1
.It Ar wantlib-args
d870 1
a870 1
.Ar port-wantlib-args
d872 1
a872 1
.Ar fake-wantlib-args
d875 1
a875 1
.Ar print-package-args .
d889 1
a889 1
.Bl -tag -width MASTER_SITES
d961 1
a961 1
.Ar configure
d1049 1
a1049 1
.Ar extract
d1051 1
a1051 1
.Ar prepare .
d1054 2
a1055 2
.Ar patch ,
.Ar configure
d1057 1
a1057 1
.Ar build
d1176 2
a1177 2
.Ar link-categories ,
.Ar unlink-categories .
d1227 1
a1227 1
.Ar fetch ,
d1236 2
a1237 2
.Ar addsum ,
.Ar checksum ,
d1239 1
a1239 1
.Ar makesum .
d1306 2
a1307 2
Set to name of script invoked by
.Ar configure
d1366 1
a1366 1
.Ar {pre,do}-configure
d1427 1
a1427 1
.Ar fetch ) ,
d1429 2
a1430 2
.Ar checksum ,
.Ar extract ) .
d1452 1
a1452 1
.Ar fetch
d1462 1
a1462 1
.Ar makesum
d1472 1
a1472 1
.Ar distpatch
d1479 1
a1479 1
.Ar update-patches .
d1484 1
a1484 1
.Ar fetch .
d1488 1
a1488 1
.Ar dump-vars .
d1569 1
a1569 1
.Ar do-extract
d1584 1
a1584 1
.Ar do-install .
d1629 1
a1629 1
.Ar package
d1662 1
a1662 1
.Ar update
d1670 1
a1670 1
.Ar update
d1724 3
a1726 3
.Ar fetch ,
.Ar build ,
.Ar install ...)
d1808 1
a1808 1
.Ar print-package-args
d1862 1
a1862 1
.Ar fake
d1867 3
a1869 1
and for the test stage, which adds
d1886 1
a1886 1
.Ar fetch-all ,
d1915 1
a1915 1
.Ar fetch
d1941 1
a1941 1
.Ar update-plist
d1970 1
a1970 1
.Ar pre-configure .
d1977 1
a1977 1
.Ar do-build
d1982 1
a1982 1
.Ar do-build
d1986 1
a1986 1
.Ar do-install .
d1989 1
a1989 1
.Ar do-test .
d2051 2
a2052 2
.Ar checksum ,
.Ar makesum ,
d2054 1
a2054 1
.Ar addsum
d2134 1
a2134 1
.Ar package
d2142 1
a2142 1
.Ar patch
d2144 1
a2144 1
.Ar update-patches
d2156 1
a2156 1
.Ar distpatch ,
d2159 3
a2161 1
In the normal distpatch stage (when
d2186 3
a2188 1
Location for patches applied by patch target.
d2196 1
a2196 1
.Ar patch
d2206 1
a2206 1
.Ar checkpatch
d2209 1
a2209 1
.Ar checkpatch
d2217 1
a2217 1
.Ar patch
d2297 1
a2297 1
.Ar wantlib-args
d2450 1
a2450 1
.Ar prepare
d2456 1
a2456 1
.Ar prepare .
d2574 1
a2574 1
.Ar checksum
d2586 1
a2586 1
.Ar post-patch ,
d2617 1
a2617 1
.Ar install
d2783 1
a2783 1
.Ar update-plist ,
d2801 1
a2801 1
.Ar makesum
d2843 1
a2843 1
.Ar {pre,do,post}-*
d2849 1
a2849 1
.Ar readmes
d2858 3
a2860 1
Test dependencies are only checked if the test stage is invoked.
d2895 1
a2895 1
.Ar fake .
d3011 1
a3011 1
.Ar print-package-args
d3058 2
a3059 2
Subdirectory of ${WRKDIR} where port normally installs (see
.Ar fake
d3135 3
a3137 1
See print-package-args (wantlib-args) for details.
d3203 1
a3203 1
.Ar fake
d3222 3
a3224 1
See print-package-args (lib-depends-args) for details.
d3273 1
a3273 1
.Bl -tag -width files/md5
d3301 1
a3301 1
.Ar fake .
d3312 1
a3312 1
.Ar fake .
d3318 1
a3318 1
.Ar fake .
d3320 1
a3320 1
.Ar pre-fake
d3353 1
a3353 1
.Ar fake
d3356 1
a3356 1
.Ar package
d3360 2
a3361 4
.Ar fake
invokes a real
.Ar install
process after tweaking a few variables.
d3363 1
a3363 1
.Ar fake
d3370 1
a3370 1
.Ar pre-fake
d3376 1
a3376 1
.Ar {pre,do,post}-install
d3393 1
a3393 1
.Ar do-install
d3419 1
a3419 1
.Ar fake
d3482 2
a3483 2
describe step, since a MULTI_PACKAGES port will produce several
descriptions).
d3547 1
a3547 1
.Ar prepare ,
d3577 1
a3577 1
.Ar package
d3579 1
a3579 1
.Ar subpackage
d3582 1
a3582 1
.Ar install-all
d3584 1
a3584 1
.Ar install
d3587 1
a3587 1
.Ar update
d3589 1
a3589 1
subupdate
d3673 1
a3673 1
.Ar describe
d3737 1
a3737 1
.Ar update-plist
d3746 1
a3746 1
.Ar package
d3763 2
a3764 2
.Bl -tag -width do-configure
.It Ar cdrom-packages , ftp-packages
d3766 1
a3766 1
.Ar package
d3768 1
a3768 1
.It Ar depends-list
d3770 2
a3771 2
.Ar full-build-depends
.It Ar {pre,do}-extract
d3776 1
a3776 1
.Ar post-extract
d3778 1
a3778 1
.It Ar {pre,do,post}-fetch
d3780 1
a3780 1
.It Ar {pre,do,post}-package
d3783 1
a3783 1
.Ar {pre,do,post}-install
d3785 1
a3785 1
.It Ar fetch-list , Ar mirror-distfiles , Ar fetch-makefile
d3789 1
a3789 1
.It Ar obj
d3796 1
a3796 1
.Ar obj
d3798 1
a3798 1
.It Ar print-depends
d3800 1
a3800 1
.Ar print-build-depends
d3802 1
a3802 1
.Ar print-run-depends
d3804 1
a3804 1
.It Ar print-depends-list
d3806 2
a3807 2
.Ar print-build-depends
.It Ar print-package-depends
d3809 2
a3810 2
.Ar print-run-depends
.It Ar print-package-signature
d3812 2
a3813 2
.Ar print-update-signature
.It Ar readme , readmes
d3823 1
a3823 1
.Bl -tag -width MASTER_SITES
d4123 1
a4123 1
.Bl -tag -width files/md5
d4141 3
a4143 2
Identical functionality can be obtained through a {pre,do,post}-* target,
invoking the script manually if necessary.
d4147 1
a4147 1
.Ar do-configure
@


1.422
log
@use .Sx; from Michael Reed <m dot reed at mykolab dot com> tweaked by me
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.421 2015/09/20 18:20:37 jmc Exp $
d27 1
a27 1
.Dd $Mdocdate: September 20 2015 $
d51 1
a51 1
.Nm bsd.port.mk ,
d58 1
a58 1
.Nm bsd.port.mk .
d2092 1
a2092 1
.Nm bsd.port.mk ,
d4158 1
a4158 1
.Nm bsd.port.mk .
@


1.421
log
@fix an Xr to pkg_create(1);
from michael reed
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.420 2015/09/16 19:59:57 schwarze Exp $
d27 1
a27 1
.Dd $Mdocdate: September 16 2015 $
d294 3
a296 4
Described in a separate section below
.Po
.Qq THE FAKE FRAMEWORK
.Pc .
d381 1
a381 1
.Qq THE FAKE FRAMEWORK
d575 1
a575 1
.Qq Flavors and multi-packages .
d887 1
a887 1
.Qq Flavors and multi-packages .
d1007 1
a1007 1
.Qq Flavors and multi-packages .
d1586 2
a1587 2
.Qq THE FAKE FRAMEWORK
for details.
d2011 1
a2011 1
.Qq Flavors and multi-packages
d2119 1
a2119 1
.Qq Flavors and multi-packages
d2274 1
a2274 1
.Qq The generation of package information .
d2888 2
a2889 2
.Qq THE FAKE FRAMEWORK
for details.
d3409 3
a3411 1
(see the FILES section above for details).
@


1.420
log
@use .Sq rather than manual `...' and fix two typos;
from Michael Reed <m dot reed at mykolab dot com>
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.419 2015/09/13 10:05:22 zhuk Exp $
d27 1
a27 1
.Dd $Mdocdate: September 13 2015 $
d563 1
a563 1
.Xr pkg-create 1 .
@


1.419
log
@Mark IGNORE_IS_FATAL and IGNORE_SILENT as user settings explicitly.

This makes syncing list of such variables with portcheck code easier.
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.418 2015/07/30 08:03:50 jmc Exp $
d27 1
a27 1
.Dd $Mdocdate: July 30 2015 $
d219 2
a220 1
Shorthand for `sub package'.
d222 2
a223 1
Shorthand for `work flavors packages plist'.
d863 1
a863 1
except that it prefixes each value with the variable name, e.g.
d3167 1
a3167 1
.It "Fatal: the licencing info for <pkgname> is incomplete..."
@


1.418
log
@switch references from sudo to doas;
ok deraadt
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.417 2015/07/04 15:07:54 espie Exp $
d27 1
a27 1
.Dd $Mdocdate: July 4 2015 $
d1738 1
d1743 1
@


1.417
log
@document PKGPATHS, used together with PKGNAMES.
fix PKGNAMES description (only relates to actual BUILD_PACKAGES)
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.416 2015/04/05 13:33:06 sthen Exp $
d27 1
a27 1
.Dd $Mdocdate: April 5 2015 $
d2779 1
a2779 1
.Xr sudo 8
@


1.416
log
@Don't use GH_COMMIT and GH_TAGNAME together. From Adam Wolk.
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.415 2015/04/03 10:19:22 ajacoutot Exp $
d27 1
a27 1
.Dd $Mdocdate: April 3 2015 $
d2366 1
a2366 1
.Ev MULTI_PACKAGES
d2377 10
@


1.415
log
@x11/gnome/gvfs is actually a better and simpler example.
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.413 2015/02/24 14:05:50 espie Exp $
d27 1
a27 1
.Dd $Mdocdate: February 24 2015 $
d1704 1
a1704 2
It is good practice to always specify
the commit id, even if ${GH_TAGNAME} was specified.
@


1.414
log
@devel/dconf is going to loose its cyclic dependency soon, so change the
example to use avahi.
@
text
@d1098 4
a1101 4
.Pa net/avahi,-gtk3
has dependencies which in turn requires
.Pa net/avahi,-main
to build.
d1103 1
a1103 1
.Pa net/avahi
d1105 3
a1107 3
.Li PSEUDO_FLAVORS = no_gui no_mono no_qt3 no_qt4 bootstrap
and the bulk build first builds
.Pa net/avahi,no_gui,no_mono,no_qt3,no_qt4,bootstrap,-main
d1109 1
a1109 1
.Pa net/avahi .
@


1.413
log
@typo, frantisek holop
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.412 2014/12/23 14:05:16 espie Exp $
d27 1
a27 1
.Dd $Mdocdate: December 23 2014 $
d1098 3
a1100 3
.Pa devel/dconf,-editor
subpackage depends on most of GNOME, which in turn requires
.Pa devel/dconf,-main
d1103 1
a1103 1
.Pa devel/dconf
d1105 3
a1107 3
.Li PSEUDO_FLAVORS = no_editor bootstrap
and the GNOME build first builds
.Pa devel/dconf,no_editor,bootstrap,-main
d1109 1
a1109 1
.Pa devel/dconf .
@


1.412
log
@missing test-depends thingy.
explicitly document that some lists are sorted
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.411 2014/11/09 01:12:59 schwarze Exp $
d27 1
a27 1
.Dd $Mdocdate: November 9 2014 $
d1201 1
a1201 1
.Ev FETCH_SYMLINK_DISFILES )
@


1.411
log
@* "shorthand" rather than "short-hand" and "short hand"
(to be consistent within this page; that's what most manuals use)
* misc/portscout was renamed to misc/portroach
* and two typos
all from <kaspars at bankovskis dot net>
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.410 2014/11/04 10:00:24 espie Exp $
d27 1
a27 1
.Dd $Mdocdate: November 4 2014 $
d87 1
a87 1
.It Ar full-{build,run,all}-depends
d89 3
a91 1
or both, as a list of package names.
@


1.410
log
@Xr to make.1 for MAKEFILE_LIST
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.409 2014/11/03 19:51:16 bcallah Exp $
d27 1
a27 1
.Dd $Mdocdate: November 3 2014 $
d222 1
a222 1
Short hand for make clean=depends.
d240 1
a240 1
Short-hand for make clean=dist.
d450 1
a450 1
that does not do anthing.
d577 1
a577 1
\&.e.g.,
d2411 1
a2411 1
.Pa misc/portscout
@


1.409
log
@Add a blurb about "Discovered old directory in ..." in the man page.
Direction/tweaks from sthen@@ espie@@
ok espie@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.408 2014/10/02 23:52:09 stu Exp $
d27 1
a27 1
.Dd $Mdocdate: October 2 2014 $
d1874 3
@


1.408
log
@Reorder alphabetically for test*, TEST_* and CDIAGFLAGS.

ok zhuk@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.407 2014/09/13 15:13:44 naddy Exp $
d27 1
a27 1
.Dd $Mdocdate: September 13 2014 $
d3085 6
@


1.407
log
@document default EXTRACT_CASES support for *.tar.lzma (reminded by juanfra@@)
and add more bzip2 cases
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.406 2014/09/05 14:39:16 jasper Exp $
d27 1
a27 1
.Dd $Mdocdate: September 5 2014 $
a675 20
.It Ar test
Run regression tests for the port.
Essentially depend on a correct build and invoke
.Bd -literal
env -i ${ALL_TEST_ENV} ${MAKE_PROGRAM} ${ALL_TEST_FLAGS} \e
	-f ${MAKE_FILE} ${TEST_TARGET} ${TEST_LOG}
.Ed
.Pp
If a port needs some other ports installed to run regression tests,
use
.Ev TEST_DEPENDS .
If a port needs special configuration or build options to enable regression
testing, define a
.Sq test
.Ev FLAVOR .
.It Ar test-depends
Verify packages needed for regression tests, using the same scheme as
.Ar build-depends .
Only invoked when regression tests are run, or explicitly through
.Ar depends .
d741 20
a1173 6
.It Ev CDIAGFLAGS
Flags appended to
.Ev CFLAGS
if
.Ev WARNINGS
is set.
d1185 6
a2555 35
.It Ev TEST_DEPENDS
See
.Ev BUILD_DEPENDS
for specification.
Test dependencies are only checked if the test stage is invoked.
.It Ev TEST_ENV
Additional environment variables passed to tests.
Empty by default.
.It Ev TEST_FLAGS
Extra flags passed to ${MAKE_PROGRAM} to run the regression tests.
Empty by default.
.It Ev TEST_IS_INTERACTIVE
Set to
.Sq Yes
if port needs human interaction to run its tests, or set to
.Sq X11
if the tests need an active X11 display to work.
.It Ev TEST_LOG
Command used to log the results of regression tests to TEST_LOGFILE.
.It Ev TEST_LOGFILE
Log file containing the results of regression tests.
.It Ev TEST_TARGET
Target to run regression tests.
Defaults to
.Sq regress ,
except for
.Sq perl
and
.Sq gnu
.Ev CONFIGURE_STYLE ,
which default to
.Sq test
and
.Sq check ,
respectively.
d2830 35
@


1.406
log
@PORTSCOUT -> PORTROACH
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.405 2014/09/02 14:27:23 jasper Exp $
d27 1
a27 1
.Dd $Mdocdate: September 2 2014 $
d1543 1
a1543 1
	*.tar.xz)
d1549 1
a1549 1
	*.tar.bz2)
@


1.405
log
@document new PORTSCOUT variable. w/ and ok espie@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.404 2014/08/10 11:23:02 jmc Exp $
d27 1
a27 1
.Dd $Mdocdate: August 10 2014 $
d2406 1
a2406 1
.It Ev PORTSCOUT
d2410 1
a2410 1
http://www.inerd.com/software/portscout/portconfig.html .
@


1.404
log
@some Ev fixes;
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.403 2014/08/10 10:10:21 espie Exp $
d2406 5
@


1.403
log
@Document SUBST_*
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.402 2014/07/23 10:19:51 espie Exp $
d27 1
a27 1
.Dd $Mdocdate: July 23 2014 $
d2755 1
a2755 1
.It Ev SUBST_DATA , SUBST_MAN, SUBST_PROGRAM
d3825 1
a3825 1
.It Ev FETCH_BEFORE_ARGS , Ev FETCH_AFTER_ARGS
@


1.402
log
@rephrase multi-packaged LIB_DEPENDS description to match fixed semantics.
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.401 2014/07/14 08:22:10 zhuk Exp $
d27 1
a27 1
.Dd $Mdocdate: July 14 2014 $
d2755 6
@


1.401
log
@Add TEST_ENV and ALL_TEST_ENV description.
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.400 2014/07/12 17:10:51 jmc Exp $
d27 1
a27 1
.Dd $Mdocdate: July 12 2014 $
d3502 1
a3502 1
which includes both
d3505 1
a3505 1
and the subpackage-specific versions of these.
@


1.400
log
@some basic formatting tweaks;
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.399 2014/07/12 09:38:39 espie Exp $
d680 1
a680 1
env -i ${MAKE_ENV} ${MAKE_PROGRAM} ${ALL_TEST_FLAGS} \e
d896 5
d1852 1
a1852 1
Environment variables passed to make invocations.
d2556 3
@


1.399
log
@a bit more detail
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.398 2014/07/12 09:26:27 robert Exp $
d257 1
a257 1
.Ev NO_DEPENDS ).
d1696 2
a1697 1
SHA1 commit id to fetch. It is good practice to always specify
d1702 4
a1705 2
Name of the tag to download. Setting ${GH_TAGNAME} to master is invalid
and will throw an error. ${WRKDIST} is auto-generated based on the
@


1.398
log
@document the GitHub support in bsd.port.mk
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.397 2014/06/25 09:43:36 zhuk Exp $
d27 1
a27 1
.Dd $Mdocdate: June 25 2014 $
d1688 5
d1702 1
a1702 1
and will throw an error. ${WRKDIST} is auto-generated based on the the
d1899 3
@


1.397
log
@Fix a couple of small nits.

okay espie@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.396 2014/03/18 22:36:31 miod Exp $
d27 1
a27 1
.Dd $Mdocdate: March 18 2014 $
d1688 12
@


1.396
log
@Retire hp300, mvme68k and mvme88k ports. These ports have no users, keeping
this hardware alive is becoming increasingly difficult, and I should heed the
message sent by the three disks which have died on me over the last few days.

Noone sane will mourn these ports anyway. So long, and thanks for the fish.
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.395 2014/02/11 10:35:11 espie Exp $
d27 1
a27 1
.Dd $Mdocdate: February 11 2014 $
d1022 1
a1022 2
.Sq install
if it is not specified.
d1633 1
a1633 1
Location of other files related to the current ports.
d1802 1
a1802 1
.Pa ${WRKOBJDIR}/locks
d1813 1
a1813 1
.Sq \&No
d2092 1
a2092 1
Default location for built packages.
d2553 1
a2553 1
.Sq check
d2987 1
a2987 1
Base for configuration (default: ${WRKDIST})
@


1.395
log
@rename "update-signature"
xr to NO_DEPENDS in extract description
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.394 2014/01/18 00:18:06 naddy Exp $
d27 1
a27 1
.Dd $Mdocdate: January 18 2014 $
d2081 2
a2082 2
Can hold both processor-specific information (e.g., m68k), and more
specific model information (e.g., hp300).
@


1.394
log
@correct crypto lingo; ok espie@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.393 2014/01/17 22:59:44 espie Exp $
d27 1
a27 1
.Dd $Mdocdate: January 17 2014 $
d255 3
a257 1
.Ev EXTRACT_ONLY ) .
d625 2
a626 2
.It Ar print-package-signature
Print the package signature, as computed using information from the ports tree,
d2246 1
a2246 1
Signature options should be set separately in
d3733 3
@


1.393
log
@signing got simpler
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.392 2014/01/04 00:14:08 espie Exp $
d27 1
a27 1
.Dd $Mdocdate: January 4 2014 $
d167 1
a167 1
using the cryptographic signature utilities listed in ${PREFERRED_CIPHERS}.
@


1.392
log
@vendor->signer
shorten pubkey -> pub (naddy@@)
\\ -> \e (jmc@@)
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.391 2013/12/30 12:43:17 espie Exp $
d27 1
a27 1
.Dd $Mdocdate: December 30 2013 $
a2644 2
In particular, home-made packages should set
.Li -DSIGNER=name .
@


1.391
log
@Document SIGNING_PARAMETERS
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.390 2013/12/02 08:32:20 espie Exp $
d27 1
a27 1
.Dd $Mdocdate: December 2 2013 $
d2646 1
a2646 1
.Li -DVENDOR=name .
@


1.390
log
@Document new DISTFILES extension
Document show-prepare-test-result
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.389 2013/11/25 14:39:29 jmc Exp $
d27 1
a27 1
.Dd $Mdocdate: November 25 2013 $
d2244 2
d2640 7
@


1.389
log
@replace an Ed mistakenly removed in -r1.186;
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.388 2013/11/25 14:14:44 sthen Exp $
d318 1
a318 1
.Sq Ar filename Ns { Ns Ar url Ns }
d320 1
a320 1
.Ar url
d322 1
a322 1
.Ar filename .
d325 1
a325 1
.Ar filename.part .
d730 5
d1428 1
d1430 1
a1430 1
.Sq Ar filename Ns { Ns Ar url Ns }
d1433 1
a1433 1
.Ar url
d1435 13
a1447 1
.Ar filename .
@


1.388
log
@Remove VMEM_WARNING, reminded by espie@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.387 2013/11/25 13:15:22 juanfra Exp $
d1537 1
@


1.387
log
@miod@@ increased the datasize of VAX from 40MB to 128MB. Now VAX can
use .xz files with big dictionaries like the other platforms.

ok brad@@ sthen@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.386 2013/11/07 01:25:27 juanfra Exp $
d27 1
a27 1
.Dd $Mdocdate: November 7 2013 $
a2898 7
.It Ev VMEM_WARNING
Set to
.Sq Yes
if the port requires a lot of memory to compile, and the user is
likely to see a message like
.Qq virtual memory exhausted
with the default process limits.
@


1.386
log
@Add the documentation related to the lzip change.

ok espie@@ sthen@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.385 2013/08/14 08:39:28 jmc Exp $
d27 1
a27 1
.Dd $Mdocdate: August 14 2013 $
a1536 3
.Ed
The use of xz archives is discouraged, as it makes things impossible to
build on vax.
@


1.385
log
@some Bx/Ox conversion;
From: Jan Stary
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.384 2013/08/10 10:17:36 miod Exp $
d27 1
a27 1
.Dd $Mdocdate: August 10 2013 $
d1521 2
d2108 1
a2108 1
Fragments are automatically appended to handle gzip'ed and bzip'ed
d2119 2
@


1.384
log
@No longer mention GCC2_ARCHS
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.383 2013/08/07 07:21:03 espie Exp $
d27 1
a27 1
.Dd $Mdocdate: August 7 2013 $
d48 3
a50 1
Other BSD variants, as well as older versions of
d4035 3
a4037 1
to match other BSD, and save directories.
d4119 2
a4120 1
Most recent additions do not come from another BSD.
@


1.383
log
@bye bye TRUST_PACKAGES
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.382 2013/07/16 18:38:51 schwarze Exp $
d27 1
a27 1
.Dd $Mdocdate: July 16 2013 $
d1659 2
a1660 2
.It Ev GCC2_ARCHS , GCC3_ARCHS , GCC4_ARCHS
List of architectures using gcc 2.95.3, gcc 3.3.5, or gcc 4.2.1.
@


1.382
log
@use .Mt for email address; ok jmc@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.381 2013/07/08 18:28:11 landry Exp $
d27 1
a27 1
.Dd $Mdocdate: July 8 2013 $
d1126 1
a1126 2
.Ev BULK_COOKIES_DIR ,
.Ev TRUST_PACKAGES .
a2800 8
.It Ev TRUST_PACKAGES
User settings.
If set to
.Sq Yes ,
dependency mechanisms will assume the database of installed packages is
correct.
See also
.Ev BULK .
@


1.381
log
@Document PKG_CREATE_NO_CHECKS=warn
ok espie@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.380 2013/06/24 15:56:29 jmc Exp $
d27 1
a27 1
.Dd $Mdocdate: June 24 2013 $
d1804 2
a1805 1
Defaults to ports@@openbsd.org.
@


1.380
log
@tweak previous;
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.379 2013/06/24 11:20:47 sthen Exp $
d2238 6
@


1.379
log
@Mention the checks for xenocara in DIAGNOSTICS, prompted by Jan Stary's mail.
Remove documentation about "<PORTSDIR> is a symlink" from DIAGNOSTICS; this is
no longer enforced by bsd.port.mk. feedback jca@@, ok espie
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.378 2013/06/21 13:06:54 espie Exp $
d27 1
a27 1
.Dd $Mdocdate: June 21 2013 $
d338 1
a338 1
.Xr dpb 8
d1518 1
a1518 1
    	*.tar.xz)
d1553 1
a1553 1
List of environment values normally set during fake invocations
@


1.378
log
@document FAKE_SETUP and VARBASE
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.377 2013/06/19 08:56:32 espie Exp $
d27 1
a27 1
.Dd $Mdocdate: June 19 2013 $
a3063 9
.It "Fatal: <PORTSDIR> is a symlink. Please set to the real directory"
A few ports get lost if
.Pa /usr/ports
points elsewhere.
You should set
.Ev PORTSDIR
in
.Pa /etc/mk.conf
to the real location of the ports directory.
d3072 8
@


1.377
log
@point users to dpb for big fetch
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.376 2013/05/09 15:05:52 rpe Exp $
d27 1
a27 1
.Dd $Mdocdate: May 9 2013 $
d373 2
a374 1
See the description of THE FAKE FRAMEWORK
d960 1
a960 1
.Pa /var .
d1552 8
d2355 1
a2355 1
.Pa /var ,
d2357 2
d2892 6
d3282 8
a3289 2
important changes: PREFIX is set to ${WRKINST}${PREFIX}, ${DESTDIRNAME}
is set to ${WRKINST}, and TRUEPREFIX is set to ${PREFIX}.
d3300 1
a3300 3
env -i ${MAKE_ENV}
PREFIX=${WRKINST}${PREFIX} ${DESTDIRNAME}=${WRKINST} TRUEPREFIX=${PREFIX}
${MAKE_PROGRAM} ${ALL_FAKE_FLAGS} -f ${MAKE_FILE} ${FAKE_TARGET}
@


1.376
log
@add [-m mode] to the SUBST_CMD example line

ok espie@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.375 2013/05/08 08:51:55 espie Exp $
d27 1
a27 1
.Dd $Mdocdate: May 8 2013 $
d335 7
@


1.375
log
@document DISTFILES extended syntax
split huge fetch description into separate paragraphs.
revive fetch-all, which is still very much alive.
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.374 2013/05/06 21:17:37 zhuk Exp $
d27 1
a27 1
.Dd $Mdocdate: May 6 2013 $
d2644 1
a2644 1
.Dl ${SUBST_CMD} Oo Fl g Ar group Oc Oo Fl o Ar owner Oc file...
@


1.374
log
@Document new MODPERL_ADJ_FILES and MODPERL_BIN_ADJ variables.

Based on text from and okay sthen@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.373 2013/03/25 13:13:13 jmc Exp $
d27 1
a27 1
.Dd $Mdocdate: March 25 2013 $
d304 1
d314 11
d335 1
d356 5
d1414 7
d1560 6
d2094 1
a2094 1
for patchfile in ${_PATCHFILES}
d3659 1
a3659 1
.It Ar fetch-all , Ar fetch-list , Ar mirror-distfiles , Ar fetch-makefile
@


1.373
log
@space between macro arg and punctuation;
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.372 2013/03/25 10:21:39 landry Exp $
d1855 14
@


1.372
log
@manpages under ${PORTSDIR}/infrastructure/man are in the default search
path since almost two years (r1.17 of man.conf) - fix corresponding
documentation.

From Timo Myyr on ports@@, thanks!
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.371 2013/03/21 08:30:29 ajacoutot Exp $
d27 1
a27 1
.Dd $Mdocdate: March 21 2013 $
d46 1
a46 1
.Pa ${PORTSDIR}/infrastructure/man.
@


1.371
log
@Adapt after default USE_LIBTOOL moved from No to Yes.

ok jasper@@ landry@@ espie@@ sthen@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.370 2013/03/10 22:27:41 espie Exp $
d27 1
a27 1
.Dd $Mdocdate: March 10 2013 $
d46 1
a46 2
.Pa ${PORTSDIR}/infrastructure/man ,
which is not currently part of the default manpath.
@


1.370
log
@document REGRESS -> TEST
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.369 2013/03/09 09:03:48 espie Exp $
d27 1
a27 1
.Dd $Mdocdate: March 9 2013 $
d1715 1
a1715 2
Location of the libtool binary for ports that set
.Ev USE_LIBTOOL
d2540 1
a2540 3
Porters of software using libtool should also set
.Ev USE_LIBTOOL
and make sure
d2786 2
d2789 4
a2792 2
.Sq Yes
if libtool is required for correct behavior of this port.
d2794 4
a2797 2
.Sq gnu
if the ports tree libtool is insufficient and GNU libtool is required.
@


1.369
log
@fix target name
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.368 2013/03/09 00:11:38 espie Exp $
d80 1
a80 1
.It Ar {build,run,all,regress}-dir-depends
d89 1
a89 1
.It Ar {build,lib,regress,run}-depends-list
d91 1
a91 1
build dependencies, library dependencies, regress dependencies or
d117 1
a117 1
.Ar regress .
d234 1
a234 1
.Ar regress-depends .
d647 1
a647 1
.It Ar regress
d651 2
a652 2
env -i ${MAKE_ENV} ${MAKE_PROGRAM} ${ALL_REGRESS_FLAGS} \e
	-f ${MAKE_FILE} ${REGRESS_TARGET} ${REGRESS_LOG}
d657 1
a657 1
.Ev REGRESS_DEPENDS .
d660 1
a660 1
.Sq regress
d662 1
a662 1
.It Ar regress-depends
d862 2
a863 2
.It Ev ALL_REGRESS_FLAGS
Flags passed to ${MAKE} invocations during regress.
d865 1
a865 1
.Li ${MAKE_FLAGS} ${REGRESS_FLAGS} .
d1771 2
a1772 2
and for the regress stage, which adds
.Ev REGRESS_FLAGS
d1774 1
a1774 1
.Ev ALL_REGRESS_FLAGS ) .
d1869 1
a1869 1
.It Ev MODPERL_REGRESS_TARGET
d1871 1
a1871 1
.Ar do-regress .
d1888 1
a1888 1
.Ev REGRESS_TARGET ,
d1958 2
a1959 2
.It Ev NO_REGRESS
Port does not have any regression targets.
d1962 2
a1963 2
for ports with no regression targets.
It should be left alone for ports with empty regression targets, and for
d2431 1
a2431 1
.It Ev REGRESS_DEPENDS
d2435 2
a2436 2
Regress dependencies are only checked if the regress stage is invoked.
.It Ev REGRESS_FLAGS
d2439 1
a2439 1
.It Ev REGRESS_IS_INTERACTIVE
d2445 3
a2447 3
.It Ev REGRESS_LOG
Command used to log the results of regression tests to REGRESS_LOGFILE.
.It Ev REGRESS_LOGFILE
d2449 1
a2449 1
.It Ev REGRESS_TARGET
@


1.368
log
@document simpler logic
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.367 2013/03/08 10:11:55 espie Exp $
d27 1
a27 1
.Dd $Mdocdate: March 8 2013 $
d124 1
a124 1
.It Ar all-lib-depends
@


1.367
log
@zap PERMIT_DISTFILES_CDROM
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.366 2013/03/04 15:54:33 jasper Exp $
d27 1
a27 1
.Dd $Mdocdate: March 4 2013 $
d2125 18
@


1.366
log
@i missed a list of ciphers that rogier krieger didn't miss. thanks.
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.365 2013/03/04 13:47:14 jasper Exp $
d2115 1
a2115 1
.It Ev PERMIT_{DISTFILES,PACKAGE}_{CDROM,FTP}
a3732 2
and
.Ev PERMIT_DISTFILES_CDROM
d3830 7
@


1.365
log
@sync with reality, only sha256 checksums are generated for distinfo.

prompted by a mail on ports@@ by rogier krieger
ok landry@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.364 2013/02/16 11:35:12 ajacoutot Exp $
d27 1
a27 1
.Dd $Mdocdate: February 16 2013 $
d2273 1
a2273 1
.Sq sha256 sha1 rmd160 md5 .
@


1.364
log
@Make it clear that USE_MFS is not meant to be set by a user. This
would prevent dumb people like yours truly wondering why dpb -M does not
do the right thing.

ok espie@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.363 2013/02/03 16:04:24 jmc Exp $
d27 1
a27 1
.Dd $Mdocdate: February 3 2013 $
d401 1
a401 1
cryptographic fingerprints sha256, sha1, md5 and rmd160 on ${MAKESUMFILES}.
@


1.363
log
@*an* mfs;
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.362 2013/02/03 13:36:40 espie Exp $
d2786 3
a2788 2
.Xr dpb 1 ,
see
@


1.362
log
@document USE_MFS and WRKOBJDIR_MFS
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.361 2013/01/16 16:24:53 zhuk Exp $
d27 1
a27 1
.Dd $Mdocdate: January 16 2013 $
d2782 1
a2782 1
to build ports under a
d2894 1
a2894 1
The intent is to use a
@


1.361
log
@Remove description of functionality that never was implemented, e.g.
CCACHE_DIR_${PKGPATH} .

ok sthen@@, jmc@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.360 2013/01/05 09:43:25 ajacoutot Exp $
d27 1
a27 1
.Dd $Mdocdate: January 5 2013 $
d2779 11
d2892 12
@


1.360
log
@Gnome > GNOME
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.359 2012/11/28 07:16:09 ajacoutot Exp $
d27 1
a27 1
.Dd $Mdocdate: November 28 2012 $
a1147 3
Can be set on a per-${PKGPATH} basis.
For instance, setting CCACHE_DIR_www/mozilla=/tmp/ccache
will affect only the mozilla port.
@


1.359
log
@Default LIBTOOL is /usr/bin/libtool.
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.358 2012/11/19 12:27:43 espie Exp $
d27 1
a27 1
.Dd $Mdocdate: November 19 2012 $
d1059 1
a1059 1
subpackage depends on most of Gnome, which in turn requires
d1066 1
a1066 1
and the Gnome build first builds
@


1.358
log
@document BULK change
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.357 2012/11/01 11:55:53 jmc Exp $
d27 1
a27 1
.Dd $Mdocdate: November 1 2012 $
d1721 1
a1721 1
.Pa ${LOCALBASE}/bin/libtool .
@


1.357
log
@tweak previous;
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.356 2012/11/01 10:38:29 espie Exp $
d1090 1
a1090 1
successful package builds and installations will clean
d1097 3
d1103 2
@


1.356
log
@document the return of USE_X11 and its reason.
also PORTS_BUILD_XENOCARA_TOO.

Don't use !!! if things break, it's your fault.
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.355 2012/08/31 18:54:39 jmc Exp $
d27 1
a27 1
.Dd $Mdocdate: August 31 2012 $
d2785 2
a2786 1
.Xr dpb 1 , which requires knowing whether a port requires X11 to already
@


1.355
log
@tweak previous;
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.354 2012/08/31 17:25:11 espie Exp $
d2262 6
d2782 12
a3879 2
.It Ev USE_X11
Presence of ${X11BASE} is now enforced by default for building ports.
@


1.354
log
@Document BUILD_ONCE. A bit tricky. Use actual examples from our current
tree.
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.353 2012/08/31 16:52:40 espie Exp $
a1021 1
.Pp
d1035 2
a1036 1
.Ev PSEUDO_FLAVORS matching
d3292 1
a3292 1
.Ev PKGSPEC ,
@


1.353
log
@document SUBST_CMD* again, hopefully for the last time.
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.352 2012/08/22 13:54:01 espie Exp $
d27 1
a27 1
.Dd $Mdocdate: August 22 2012 $
d1022 48
d2385 3
@


1.352
log
@be more direct about makesum and SUPDISTFILES.
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.351 2012/08/18 08:04:28 espie Exp $
d27 1
a27 1
.Dd $Mdocdate: August 18 2012 $
d2535 11
a2545 3
is subpackage-dependent and aware of subpackage semantics, like
packing-list substitution.
It will substitute the right variable depending on the current subpackage,
a3241 1
.Ev SUBST_CMD .
@


1.351
log
@forgot to document llvm property.
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.350 2012/08/18 08:02:04 espie Exp $
d402 1
d1347 6
a1352 2
See also
.Ev SUPDISTFILES .
@


1.350
log
@be more explicit about what mono is.
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.349 2012/08/18 07:59:40 espie Exp $
d2276 4
@


1.349
log
@document default change
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.348 2012/08/15 18:09:02 jmc Exp $
d27 1
a27 1
.Dd $Mdocdate: August 15 2012 $
d2277 3
a2279 1
there is mono support on this architecture.
@


1.348
log
@remove some unneeded Pp;
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.347 2012/08/15 10:49:05 espie Exp $
d1682 3
a1684 3
.Pa /tmp/portslocks .
If set, points to a directory common for all instances of concurrent ports
builds.
@


1.347
log
@document perl module new goodies
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.346 2012/08/05 10:51:41 espie Exp $
d27 1
a27 1
.Dd $Mdocdate: August 5 2012 $
a1652 1
.Pp
@


1.346
log
@expand documentation of SUBST_CMD to explain the subpackage-dependent nits
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.345 2012/08/03 12:10:03 espie Exp $
d27 1
a27 1
.Dd $Mdocdate: August 3 2012 $
d1803 15
@


1.345
log
@tell people target update-patches actually invokes script update-patches(1)
which is documented.

prompted by aja@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.344 2012/07/07 15:37:35 espie Exp $
d27 1
a27 1
.Dd $Mdocdate: July 7 2012 $
d2507 12
d3208 2
a3209 1
.Ev PKGSPEC .
@


1.344
log
@less accurate documentation...
as noticed by matthew@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.343 2012/06/25 12:26:59 espie Exp $
d27 1
a27 1
.Dd $Mdocdate: June 25 2012 $
d737 2
@


1.343
log
@automake has different naming rules, I was mistaken, those require conflict
markers...
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.342 2012/06/18 12:16:19 espie Exp $
d27 1
a27 1
.Dd $Mdocdate: June 18 2012 $
d1449 2
a1450 2
Set to the list of distfile to actually extract if not all ${DISTFILES}
should be extracted during the
d1453 1
a1453 1
Default value is ${DISTFILES}, can even be set to empty.
@


1.342
log
@document ports-readmes special-case
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.341 2012/06/08 21:01:22 sthen Exp $
d27 1
a27 1
.Dd $Mdocdate: June 8 2012 $
d2926 1
a2926 3
.Pa devel/autoconf/*
and
.Pa devel/automake/* .
@


1.341
log
@typo, PACKAGE_RPOSITORY
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.340 2012/06/08 14:53:36 espie Exp $
d2450 12
d3195 1
@


1.340
log
@document CHECKSUM_PACKAGES
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.339 2012/06/04 18:42:13 pascal Exp $
d27 1
a27 1
.Dd $Mdocdate: June 4 2012 $
d1152 1
a1152 1
.Pa ${PACKAGE_RPOSITORY}/${MACHINE_ARCH}/cksums/${FULLPKGNAME}.sha256 .
@


1.339
log
@Document BE_ARCHS and LE_ARCHS.

ok espie@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.338 2012/05/28 09:51:17 espie Exp $
d27 1
a27 1
.Dd $Mdocdate: May 28 2012 $
d1148 20
d2982 1
a2982 1
.It Pa ${PORTSDIR}/packages/${MACHINE_ARCH}/cdrom
d2990 3
d2995 1
a2995 1
.It Pa ${PORTSDIR}/packages/${MACHINE_ARCH}/ftp
@


1.338
log
@document no-lib-depends-args
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.337 2012/05/28 09:43:47 espie Exp $
d951 7
d1601 7
d2227 2
d2234 2
@


1.337
log
@document removal of make readmes
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.336 2012/05/15 13:19:43 sthen Exp $
d27 1
a27 1
.Dd $Mdocdate: May 15 2012 $
d417 6
@


1.336
log
@.Xr mk.conf(5) from bsd.port.mk(5) as it has useful information about
variables which affect port builds (DEBUG and so on).  ok ajacoutot@@ jasper@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.335 2012/04/28 10:51:19 ajacoutot Exp $
d27 1
a27 1
.Dd $Mdocdate: April 28 2012 $
d183 1
a183 1
packages plist readme]'.
a208 4
.It Va readmes
Clean files generated through the
.Ar readme
targets (html files).
a637 6
.It Ar readme
Create an html description of the current subpackage, including comments,
description, and dependencies.
.It Ar readmes
Create an html description of packages, including comments, description,
and dependencies.
a2314 5
.It Ev README_NAME
User settings.
Path to the template used to generate a readme html file.
Defaults to
.Pa ${TEMPLATES}/README.port .
d3418 8
@


1.335
log
@Document (BASE)LOCALSTATEDIR.
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.334 2012/04/27 19:32:23 jeremy Exp $
d27 1
a27 1
.Dd $Mdocdate: April 27 2012 $
d3806 1
@


1.334
log
@Remove mention of CHMOD and CHOWN variables, no longer used.

OK espie@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.333 2012/04/04 15:58:21 landry Exp $
d27 1
a27 1
.Dd $Mdocdate: April 4 2012 $
d932 7
d1641 7
@


1.333
log
@It's @@option no-default-conflict not option @@no-default-conflict
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.332 2012/03/22 14:12:00 espie Exp $
d27 1
a27 1
.Dd $Mdocdate: March 22 2012 $
a3438 12
.It Ev CHMOD
Full path to
.Xr chmod 1 ,
use
.Xr chmod 1
directly.
.It Ev CHOWN
Full path to
.Xr chmod 1 ,
use
.Xr chmod 1
directly.
@


1.332
log
@+ diagnostic
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.331 2012/02/23 11:14:30 espie Exp $
d27 1
a27 1
.Dd $Mdocdate: February 23 2012 $
d2858 1
a2858 1
.It "Warning: option @@no-default-conflict with no @@conflict"
@


1.331
log
@document cases where the warning can and should be ignored
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.330 2012/02/17 07:51:34 espie Exp $
d27 1
a27 1
.Dd $Mdocdate: February 17 2012 $
d2777 9
@


1.330
log
@don't label "warning messages" as "errors"
fetch-makefile is obsolete.
Xr ftp
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.329 2012/02/17 07:37:40 espie Exp $
d2819 1
a2819 1
.It LIB_DEPENDS spec not needed
d2822 1
a2822 1
This is most often because of confusion between LIB_DEPENDS and RUN_DEPENDS:
d2824 1
d2827 3
@


1.329
log
@add DIAGNOSTICS, for easy grepping thru logs.
as discussed with jmc@@, put the section in exposition order.
(we're not even a driver anyways)
sthen@@ likes it.
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.328 2012/01/29 11:32:36 espie Exp $
d27 1
a27 1
.Dd $Mdocdate: January 29 2012 $
a347 5
.It Ar fetch-makefile
Generate a makefile fragment suitable for fetching the files
in the current port.
See
.Xr mirroring-ports 7 .
d500 3
a502 1
in the right directory, and leaves user at ftp prompt.
d2835 1
a2835 1
Error message comes from
d2846 1
a2846 1
Error message comes from
d2862 1
a2862 1
Error message comes from
d3381 1
a3381 1
.It Ar fetch-all , Ar fetch-list , Ar mirror-distfiles
@


1.328
log
@document PKGFILES
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.327 2011/12/29 17:31:42 espie Exp $
d27 1
a27 1
.Dd $Mdocdate: December 29 2011 $
d2731 147
@


1.327
log
@document special use of MODULES += gnu
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.326 2011/12/23 17:00:47 jmc Exp $
d27 1
a27 1
.Dd $Mdocdate: December 23 2011 $
d2092 3
@


1.326
log
@some spelling fixes, found using freebsd's "igor" document verifier;
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.325 2011/12/20 14:37:46 fgsch Exp $
d27 1
a27 1
.Dd $Mdocdate: December 20 2011 $
d1167 3
a1169 1
.Li CONFIGURE_STYLE=gnu .
d1762 17
@


1.325
log
@s/TRUE_PREFIX/TRUEPREFIX/.
sthen@@ ok
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.324 2011/12/09 12:02:06 espie Exp $
d27 1
a27 1
.Dd $Mdocdate: December 9 2011 $
d1610 1
a1610 1
is a shared library that originates within the dependant port.
@


1.324
log
@point out one useful difference between show and verbose-show
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.323 2011/12/09 10:36:26 espie Exp $
d2530 1
a2530 1
.It Ev TRUE_PREFIX
@


1.323
log
@explain CONFIG_SITE_LIST purposes.
Refrain from making it user-available for now.
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.322 2011/12/04 00:10:28 espie Exp $
d27 1
a27 1
.Dd $Mdocdate: December 4 2011 $
d830 4
a833 1
.Li VAR=value
@


1.322
log
@more nits
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.321 2011/12/03 23:48:56 espie Exp $
d27 1
a27 1
.Dd $Mdocdate: December 3 2011 $
d1162 10
@


1.321
log
@nit, nit, nit
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.320 2011/12/03 23:37:20 espie Exp $
a2640 2
Ports that need to know the WRKDIR of another port must use
cd that_port_dir && make show=WRKDIR for this.
d2652 4
a2655 2
Subdirectory of ${WRKDIR} in which the distribution files normally unpacks.
Base for all patches (default: ${WRKDIR}/${DISTNAME}).
d2666 3
a2668 2
Used as a base for the actual port working directory (default:
${PORTSDIR}/pobj).
d2676 3
a2678 1
Where X11 has been installed (default: /usr/X11R6).
d2684 3
a2686 1
Invocation of xmkmf for CONFIGURE_STYLE=imake port.
d2693 2
a2694 2
(GNU-configure would always try to use bison otherwise, which leads to
unreproducible builds.)
d2704 1
a2704 1
cache of all distribution files.
d2713 1
a2713 1
cache of normal distribution files for a given port.
d2715 1
a2715 1
cache of all distribution files for a given port.
d2730 2
a2731 1
Multi-package ports will use README${SUBPACKAGE}.
d2733 1
a2733 1
startup script for <foo>.
d2779 1
a2779 1
target, so that the real installation will use the package.
d2797 1
a2797 1
it would be installed if the ports' dependencies were present).
d2799 3
a2801 1
If {pre,do,post}-install overrides are present, they are used with some
d2810 3
a2812 1
If no do-install override is present, the port is installed using
d2881 6
a2886 2
In recursive package building, flavors can be specified as a comma
separated list after the package directory, e.g., SUBDIR+=vim,no_x11.
d2897 1
a2897 1
In dependency checking and recursive builds, a subpackage can be
d2963 1
a2963 1
At the beginning of build, during
d2969 1
a2969 1
and the subpackage-specific version of these.
d2983 1
a2983 1
for each subpackage, and
d2986 2
a2987 2
In very rare cases, one can override
.Ev FULLPKGPATH-sub
d2991 1
a2991 1
In terms of implementation, quite a few targets will have a subpackage
d3075 1
a3075 5
Set ${PLIST${SUBPACKAGE}}, ${DESCR${SUBPACKAGE}}, ${COMMENT${SUBPACKAGE}}, ${MESSAGE${SUBPACKAGE}}, ${UNMESSAGE${SUBPACKAGE}} accordingly.
.It
Detect the existence of ${PKGDIR}/{REQ,INSTALL,DEINSTALL}${SUBPACKAGE}.
These are now deprecated.
Use @@exec and @@unexec annotations instead.
@


1.320
log
@a few more nits, such as more consistent annotations
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.319 2011/12/03 23:19:28 espie Exp $
d2091 1
a2091 1
default package spec for using this port as a dependency.
d2184 1
a2184 1
list of flavors in
d2191 1
a2191 1
used to control build logic, and e.g., working directory names.
d2318 3
a2320 2
Same format as BUILD_DEPENDS.
The corresponding packages will be built at
d2339 1
a2339 1
.Li /usr/bin/env -i
d2367 1
a2367 1
This should be enough, in most cases.
d2382 1
a2382 1
Set to the sub package suffix when building a package in a multi-package port.
d2404 3
d2409 1
a2409 1
.Ev SUBST_CMD
@


1.319
log
@more nits
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.318 2011/12/03 23:01:21 schwarze Exp $
d877 1
d1699 1
a1699 1
List of primary location from which distribution files and patchfiles are
d1703 1
a1703 1
target for more details.
d1721 1
d1750 1
a1750 1
Set to a list of package extensions for ports that create multiple packages.
d1756 1
a1756 1
as some of the packages only exist for some architectures.
d1758 1
a1758 1
Location for the arch-independent packages.
d1762 1
a1762 1
except for packages where PKG_ARCH=*, those end up under
d1774 3
a1776 1
Port does not need any build stage.
d1785 1
a1793 1
User settings.
d1795 1
a1795 1
entirely the basic authentication mechanisms of the ports tree.
d1811 3
a1813 1
.Ev IGNORE .
d1825 1
d1838 1
a1838 1
Port does not build with systrace enabled build targets.
d1920 3
a1922 1
Location for patches applied by patch target (default: patches).
d1935 3
a1937 1
Set to Yes by the
d1958 2
a1959 1
Wildcard pattern of patches to select under ${PATCHDIR} (default: patch-*).
d1982 1
d1989 1
a1989 1
Use * to mean any arch.
d1997 1
d2018 1
d2022 1
a2023 1
.It Ev PKG_DELETE
d2028 1
@


1.318
log
@Remove an OpenBSD-specific tweak regarding .Xr spacing
and make it compatible with bsd.lv mandoc and with groff-1.21.
This tweak was originally added for compatibility with groff-1.15,
which is no longer needed.

ok jmc@@ kristaps@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.317 2011/12/03 22:27:57 espie Exp $
d170 1
a170 1
.Ic checksum
d992 4
a995 1
Build dependencies are checked at the beginning of the extract stage.
d997 3
a999 2
Build dependencies that are not the default
.Ar package
d1001 1
a1001 1
.Ar install
d1003 5
a1007 1
specifically, in ${WRKDIR}/directory.
d1062 5
d1091 1
a1091 1
Path to a local database that holds distribution files (usually a CD-ROM
d1114 2
a1115 2
This is essentially the same as running make on
.Ar lib-depends-check
d1125 1
a1125 1
prepended and with master site selection extension removed.
d1135 2
a1136 1
Defaults to distinfo.
d1276 1
d1406 5
a1410 2
Set if not all ${DISTFILES} should be extracted at do-extract stage.
Default value is ${DISTFILES}.
d1415 2
a1416 1
Extra flags passed to ${MAKE_PROGRAM} on fake invocation.
d1418 2
d1424 1
d1431 1
a1434 1
User settings.
d1457 1
a1457 1
.Pa ${PACKAGE_REPOSITORY}/${MACHINE_ARCH}/cache/
d1468 1
a1468 1
(default: files).
d1515 1
a1515 1
Set to the list of architectures using gcc 2.95.3, gcc 3.3.5, or gcc 4.2.1.
d1526 1
a1526 1
Set to a link to the homepage of the software, if applicable.
d1528 1
a1528 1
Usually set to the reasons for which the port is ignored.
d1537 1
d1572 5
a1576 3
Usually implies NO_PACKAGE as well.
Porters should strive to minimize IS_INTERACTIVE ports, by using
FLAVORS for multiple choice ports, and by postponing human intervention
d1611 2
a1612 1
(default: ${LOCALBASE}/bin/libtool).
d1618 3
a1620 1
where other ports have already been installed (default: /usr/local)
d1635 1
a1635 1
.Sq No .
d1696 1
a1696 1
.Sq No .
@


1.317
log
@Nits
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.316 2011/12/03 20:49:16 espie Exp $
d170 3
a172 2
.Ar checksum
with REFETCH=true
d2098 3
a2100 2
.Xr ftp 1 ,
.Xr pkg_create 1 ...
@


1.316
log
@fix typo
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.315 2011/12/03 20:45:01 espie Exp $
d633 1
a633 1
so that the packing-list is complete.
d816 1
a816 1
@@comment @@dirrm unwanted-dir
d824 1
a824 1
does not handle flavor situations yet, so beware.
@


1.315
log
@more .Ev -> .Ar
explicit link to THE FAKE FRAMEWORK
reflect reality: *-fetch hooks are gone.
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.314 2011/12/03 20:39:58 espie Exp $
d456 1
a456 1
copies built packages into ${PACKAGE_REPOSITORY}/${MACHINE_ARCH}/cdrom}, using
@


1.314
log
@thinko
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.313 2011/12/03 20:34:16 espie Exp $
d270 1
a270 1
.Ev do-fake
d272 1
a272 1
.Ev post-fake
d276 3
a278 3
.Ev pre-fake ,
.Ev pre-install ,
.Ev do-install
d280 1
a280 1
.Ev post-install .
d282 2
a283 2
.Ev pre-install ,
.Ev do-install ,
d285 1
a285 1
.Ev post-install
d288 1
a288 1
.Ev pre-fake
d290 4
a293 1
Described in a separate section below.
d329 1
a329 2
hooks is strongly discouraged, and will probably be removed in the
near future, as this makes mirroring of distfiles very complicated.
@


1.313
log
@Builds -> Build.

flesh out prepare with reference to MULTI_PACKAGES.
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.312 2011/12/03 20:24:09 espie Exp $
d262 1
a262 1
.Ev pre-extract
d264 1
a264 1
.Ev do-extract
@


1.312
log
@more OBSOLETE stuff near the end, as it's less relevant
build-depends is less important and may vanish.
prepare is more important...
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.311 2011/12/03 20:20:28 jmc Exp $
d148 1
a148 1
Verifies from the ports tree, without building anything, that the current
d155 1
a155 1
Applies
d251 1
a251 1
Dumps the values of all relevant variables in a port, prepended with the
d346 1
a346 1
generates a makefile fragment for fetching the files
d365 1
a365 1
Filters
d369 1
a369 1
and outputs a list of dependencies suitable for
d418 3
a420 1
Debug target: generates the mirror-maker makefile fragment and use it
d430 1
a430 1
Build a port package (or packages in
d432 1
a432 1
cases) from the fake installation.
d523 1
a523 1
Resolves
d532 9
a540 1
dependencies.
d602 1
a602 1
Iterates over
d606 1
a606 1
Iterates over
d610 1
a610 1
Generate and print a package contents from the static information
d684 1
a684 1
Processes
d698 1
a698 1
Prints the size of ${WRKINST}.
d704 1
a704 1
Prints the list of actual installed packages found out by
d707 1
a707 1
Prints the list of
d713 1
a713 1
Prints all running dependencies for a port, one per-line, without duplicates.
d829 1
a829 1
Calls
d2801 1
a2801 1
\&.if ${FLAVOR:L:Moption1}
d2804 1
a2804 1
\&.if ${FLAVOR:L:Moption2}
d2897 2
a2898 1
At the beginning of build,
@


1.311
log
@tweak previous;
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.310 2011/12/03 18:20:57 espie Exp $
d57 1
a57 3
.Nm bsd.port.mk ,
followed by sections on obsolete constructs that a porter may need
when converting from other ports systems.
d62 3
d144 2
a145 1
Invoked right after creating the working directory.
d2705 5
a2709 4
.Sh OBSOLETE TARGETS
.Bl -tag -width do-configure
.It Ar cdrom-packages , ftp-packages
Links are now created during the
d2711 59
a2769 23
target.
.It Ar depends-list
Renamed into
.Ar full-build-depends
.It Ar {pre,do}-extract
Don't override.
Set
.Ev EXTRACT_ONLY
to nothing and override
.Ar post-extract
instead.
.It Ar {pre,do,post}-fetch
These prevented bulk mechanisms from running properly.
.It Ar {pre,do,post}-package
There is no port that requires special treatment during packaging,
as
.Ar {pre,do,post}-install
should take care of every necessity.
.It Ar fetch-all , Ar fetch-list , Ar mirror-distfiles
See
.Xr mirroring-ports 7
for more efficient and flexible ways to build mirrors.
.It Ar obj
d2771 374
a3144 10
.Ox 3.3 ,
using
.Ev WRKOBJDIR
no longer creates a symlink between the current directory and
a subdirectory of ${WRKOBJDIR}, so
.Ar obj
is no longer applicable.
.It Ar print-depends
Use
.Ar print-build-depends
a3532 401
.Sh THE FAKE FRAMEWORK
The
.Ar fake
target is used to install the port in a private directory first, ready for
packaging by the
.Ar package
target, so that the real installation will use the package.
.Pp
Essentially,
.Ar fake
invokes a real
.Ar install
process after tweaking a few variables.
.Pp
.Ar fake
first creates a skeleton tree under ${WRKINST}, using the
.Xr mtree 8
specification
.Pa ${PORTSDIR}/infrastructure/db/fake.mtree .
.Pp
A
.Ar pre-fake
target may be used to complete that skeleton tree.
For instance, a few ports may need supplementary stuff to be present (as
it would be installed if the ports' dependencies were present).
.Pp
If {pre,do,post}-install overrides are present, they are used with some
important changes: PREFIX is set to ${WRKINST}${PREFIX}, ${DESTDIRNAME}
is set to ${WRKINST}, and TRUEPREFIX is set to ${PREFIX}.
Essentially, old install targets work transparently, except for a need to
change PREFIX to TRUEPREFIX for symbolic links and similar path lookups.
Specific traditional post install work can be simply removed, as it will
be taken care of by the package itself (for instance, ldconfig, or
texinfo's install-info).
.Pp
If no do-install override is present, the port is installed using
.Bd -literal -offset 2n
env -i ${MAKE_ENV}
PREFIX=${WRKINST}${PREFIX} ${DESTDIRNAME}=${WRKINST} TRUEPREFIX=${PREFIX}
${MAKE_PROGRAM} ${ALL_FAKE_FLAGS} -f ${MAKE_FILE} ${FAKE_TARGET}
.Ed
.Pp
Note that this does set both PREFIX and ${DESTDIRNAME}.
If a port's Makefile both heeds ${DESTDIRNAME},
and references PREFIX explicitly,
FAKE_FLAGS may rectify the problem by setting PREFIX=${PREFIX}
(which will do the right thing, since ${PREFIX} is a
.Xr make 1
construct which will not be seen by the shell).
.Pp
${FAKE_FLAGS} is used to set variables on
.Xr make 1
command line, which will override the port Makefile contents.
Thus, a port that mentions DESTDIR= does not need any patch to work with fake.
.Pp
Files such as
.Pa ${PKGDIR}/README*
or
.Pa ${PKGDIR}/*.rc
get copied to
.Pa ${WRKINST}
at the end of
.Ar fake
(see the FILES section above for details).
.Sh FLAVORS AND MULTI_PACKAGES
Starting with
.Ox 2.7 ,
each port can generate distinct packages through two orthogonal mechanisms:
FLAVORS and MULTI_PACKAGES.
.Pp
The current MULTI_PACKAGES mechanism was introduced after
.Ox 4.0 .
.Pp
The arch-dependent part was refined after
.Ox 5.0 .
.Pp
If a port can be compiled with several options, these options
should be turned into FLAVORS.
The port maintainer will set FLAVORS to be the list of possible options in
the Makefile.
When building the port, the package builder will set
.Li "FLAVOR='option1 option2...'"
to build a specific flavor of the port.
The Makefile should test the value of FLAVOR as follows:
.Bd -literal -offset indent
FLAVOR?=
\&.if ${FLAVOR:L:Moption1}
# what to do if option1
\&.endif
\&.if ${FLAVOR:L:Moption2}
# what to do if option2
\&.endif
.Ed
.Pp
.Pa bsd.port.mk
takes care of a few details, such as generating a distinct work directory for
each flavor, or creating a FULLPKGNAME by adding a dash separated list of
flavors to the base package name.
The order in which FLAVOR is specified does not matter: this dash separated
list will be reordered to match the ordering of FLAVORS.
.Pp
It is an error to specify an option in FLAVOR that does not appear in FLAVORS,
to prevent misspellings.
.Pp
In recursive package building, flavors can be specified as a comma
separated list after the package directory, e.g., SUBDIR+=vim,no_x11.
.Pp
Finally, package information will use templates with the canonical package
extension if they are available: if FLAVOR='option1 option2' and both
COMMENT and COMMENT-option1-option2 are available, COMMENT-option1-option2 will
be used.
.Pp
If one build of a port can generate several distinct packages, set
MULTI_PACKAGES accordingly.
Each extension of a MULTI_PACKAGES name should start with a dash, so that
they cannot be confused with FLAVORS.
In dependency checking and recursive builds, a subpackage can be
specified after a comma, e.g., SUBDIR+=quake,-server.
MULTI_PACKAGES only affects the actual package building step (and the
describe step, since a MULTI_PACKAGES port will produce several
descriptions).
.Pp
If MULTI_PACKAGES is set, the packaging stage happens once for every
subpackage, using subpackage-specific variables.
For instance, if MULTI_PACKAGES=-main -lib -server,
.Ev PKG_ARCH-main ,
.Ev PKG_ARCH-lib
and
.Ev PKG_ARCH-server
will be used for the subpackages respectively called
.Ev FULLPKGNAME-main ,
.Ev FULLPKGNAME-lib
and
.Ev FULLPKGNAME-server .
.Pp
All package information is also derived from
templates with SUBPACKAGE appended.
In the preceding example, the packing-list template for FULLPKGNAME-lib
must be in PLIST-lib.
.Pp
The following variables are subpackage dependent:
.Ev COMMENT ,
.Ev PKG_ARCH ,
.Ev PERMIT_PACKAGE_FTP ,
.Ev PERMIT_PACKAGE_CDROM ,
.Ev PKGFILE ,
.Ev PKGNAME ,
.Ev FULLPKGNAME ,
.Ev REVISION ,
.Ev EPOCH ,
.Ev FULLPKGPATH ,
.Ev RUN_DEPENDS ,
.Ev WANTLIB ,
.Ev LIB_DEPENDS ,
.Ev IGNORE ,
.Ev ONLY_FOR_ARCHS ,
.Ev NOT_FOR_ARCHS ,
.Ev PKG_ARGS ,
.Ev PREFIX ,
.Ev CATEGORIES ,
.Ev MESSAGE ,
.Ev UNMESSAGE ,
.Ev DESCR ,
.Ev PLIST ,
.Ev PKGSPEC .
.Pp
The usual non-MULTI_PACKAGES variables are simply used as default values
for all subpackages.
So, if you set
.Li "PKG_ARCH=*"
.Li "PKG_ARCH-main=i386"
then
.Ev PKG_ARCH-lib
and
.Ev PKG_ARCH-server
will both be
.Sq * .
.Pp
.Ev WANTLIB
and
.Ev LIB_DEPENDS
are special.
At the beginning of build,
all build dependencies will be checked,
which includes both
.Ev LIB_DEPENDS ,
.Ev WANTLIB
and the subpackage-specific version of these.
As an exception, any
.Ev LIB_DEPENDS-sub
that references the current port will be ignored as a build dependency,
in order to avoid recursion.
.Pp
.Ev FULLPKGPATH
and
.Ev FULLPKGNAME
are special as well.
You must set
.Ev PKGNAME-sub
or
.Ev FULLPKGNAME-sub
for each subpackage, and
.Ev FULLPKGPATH-sub
is set automatically to the right value.
In very rare cases, one can override
.Ev FULLPKGPATH-sub
(for instance, if one specific subpackage is not affected by option
settings that affect other subpackages, e.g., for include files packs).
.Pp
In terms of implementation, quite a few targets will have a subpackage
specific subtarget:
invoking
.Ar package
is the same as invoking
.Ar subpackage
for all subpackages,
invoking
.Ar install-all
is the same as invoking
.Ar install
for all subpackages,
and invoking
.Ar update
is the same as invoking
subupdate
for all subpackages.
.Pp
.Ev ONLY_FOR_ARCHS
and
.Ev NOT_FOR_ARCHS
interact with
.Ev MULTI_PACKAGES
and
.Ev IGNORE .
The infrastructure will automatically filter subpackages
that are not suitable for the current architecture.
Thus,
.Ev MULTI_PACKAGES
should always list all subpackages,
even things not buildable on the current architecture,
for indexing purposes.
.Pp
Starting with
.Ox 5.1 ,
.Xr bsd.port.arch.mk 5
should be used to simplify the handling of
.Ev MULTI_PACKAGES
in arch-dependent setups:
.Pp
Make sure
.Ev MULTI_PACKAGES ,
.Ev ONLY_FOR_ARCHS* ,
and
.Ev PSEUDO_FLAVORS
are defined correctly, then
.Bd -literal -offset indent
\&.include <bsd.port.arch.mk>
.Ed
.Pp
This will compute
.Ev BUILD_PACKAGES ,
the list of actual subpackages to build with the current setup,
by taking arch constraints and pseudo-flavors into account.
Then test
.Ev BUILD_PACKAGES
to set up the right configuration, e.g., to check if
.Ev SUBPACKAGE
.Ar -mono
should be built:
.Bd -literal -offset indent
\&.if ${BUILD_PACKAGES:M-mono}
.Ed
.Pp
The
.Pa lang/gcc/4.2
or
.Pa print/poppler
ports should provide examples of proper use.
.Pp
Note that
.Xr dpb 1
will break if all subpackages are not properly listed.
.Sh THE GENERATION OF PACKAGE INFORMATION
Starting after
.Ox 4.1
all package information is processed directly by
.Xr pkg_create 1
from templates in ${PKG_DIR}.
.Pp
.Bl -bullet -compact
.It
If not overridden by the user, determine which set of templates to use,
depending on the current SUBPACKAGE and FLAVOR information.
Set ${PLIST${SUBPACKAGE}}, ${DESCR${SUBPACKAGE}}, ${COMMENT${SUBPACKAGE}}, ${MESSAGE${SUBPACKAGE}}, ${UNMESSAGE${SUBPACKAGE}} accordingly.
.It
Detect the existence of ${PKGDIR}/{REQ,INSTALL,DEINSTALL}${SUBPACKAGE}.
These are now deprecated.
Use @@exec and @@unexec annotations instead.
.It
Generate the actual DESCR, and if needed, MESSAGE, UNMESSAGE,
from the templates in ${DESCR}, ${MESSAGE}, ${UNMESSAGE}, by
substituting the variables in ${SUBST_VARS}, and by substituting
${FLAVORS} with the canonical flavor extension for this port,
e.g., if FLAVORS=no_map gfx qt2, if FLAVOR=gfx no_map, this is
.Sq -no_map-gfx .
.It
Generate the actual PLIST from the template ${PLIST},
by inserting shared/no-shared fragments, merging other fragments,
and applying the same variable substitutions as other package information.
.El
.Pp
Note that ${COMMENT} is currently not substituted, to speed up
.Ar describe
generation.
.Pp
To avoid substitution, variables can be escaped as follows:
.Li "$\e{PREFIX}"
.Pp
Constructs such as the line
.Li "%%SHARED%%"
or
.Li "!%%SHARED%%"
in the packing-list template trigger the inclusion of the
.Pa ${PKGDIR}/PFRAG.shared${SUBPACKAGE}
or
.Pa ${PKGDIR}/PFRAG.no-shared${SUBPACKAGE} .
.Pp
Similarly, if FLAVORS lists flav1, then the line
.Li "%%flav1%%"
(resp.
.Li "!%%flav1%%" )
will trigger the inclusion of
.Pa ${PKGDIR}/PFRAG.flav1${SUBPACKAGE}
(resp.
.Pa ${PKGDIR}/PFRAG.no-flav1${SUBPACKAGE} )
in the packing-list.
Other fragments can be defined by simply adding
.Li "-Dfrag=1"
or
.Li "-Dfrag=0"
to
.Ev PKG_ARGS
.Pp
If libraries are built using
.Pa bsd.lib.mk ,
special care should be taken for mips64* architectures,
which do not ever build
.Pa *pic.a
files (all mips code is pic already).
.Nm
automatically adds
.Li "-Dno_mips64=1"
or
.Li "-Dno_mips64=0"
to
.Ev PKG_ARGS ,
and the porter only needs to provide the appropriate fragment.
.Pp
.Xr pkg_add 1
now calls
.Xr ldconfig 8
directly, provided dynamic libraries have been annotated with
.Li "@@lib libthingy.so.5.0" .
Adding new directories to the dynamic loader cache has been
deprecated.
It is often better to let libraries be visible as a link
under ${LOCALBASE}.
Having a separate directory is enough to trick
.Xr ld 1
into grabbing the right version.
Libraries used only for
.Xr dlopen 3
do not need to be visible.
Some programs will prefer to use rpath to find their own libraries.
.Pp
The special
.Ar update-plist
target does a fairly good job of automatically generating PLIST and
PFRAG.shared fragments.
.Pp
If
.Ev PLIST_DB
points to a directory, all packing-lists from packages generated by
.Xr pkg_create 1
during the
.Ar package
stage are saved in that location by a script:
.Pa ${PORTSDIR}/infrastructure/bin/register-plist .
This script strips some irrelevant information and normalizes the
packing-list somehow, and compares it to existing information, looking
for relevant changes.
Since a package name must always be changed when the packing-list changes,
any attempt to replace a packing-list of a given name with a different
packing-list will be flagged as an error.
.Pp
In MULTI_PACKAGES mode, there must be separate COMMENT, DESCR, and PLIST
templates for each SUBPACKAGE (and optional distinct MESSAGE, UNMESSAGE
files in a similar way).
This contrasts with the FLAVORS
situation, where all these files will automatically default to the
non-flavor version if there is no flavor-specific file around.
@


1.310
log
@a few pieces of gnu.port.mk were not actually documented/documented correctly,
as noticed by Amit Kulkarni.
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.309 2011/11/25 14:04:23 espie Exp $
d27 1
a27 1
.Dd $Mdocdate: November 25 2011 $
d878 1
a878 1
The main autoconf script is a shell wrapper in the 
@


1.309
log
@document XAUTHORITY
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.308 2011/11/25 13:59:18 espie Exp $
d869 1
a869 1
Defaults to autoconf (though make autoreconf might be more appropriate).
d878 3
d886 2
d891 17
d1151 1
d1168 1
d1194 9
d1209 1
@


1.308
log
@document show-prepare-results
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.307 2011/11/25 11:12:21 espie Exp $
d2578 4
@


1.307
log
@show-size/show-fake-size
all parts of bsd.port.mk that I intended to document are accounted for
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.306 2011/11/25 11:01:25 espie Exp $
d691 3
@


1.306
log
@document targets related to dependency solving, finally
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.305 2011/11/25 10:12:26 espie Exp $
d664 1
a664 1
For rebuilding of the packages of a port, by first removing the old packages.
d685 6
d704 6
@


1.305
log
@document a few more odds and ends
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.304 2011/11/22 16:21:50 sthen Exp $
d27 1
a27 1
.Dd $Mdocdate: November 22 2011 $
d123 7
d289 6
d343 5
d362 9
d415 10
d518 8
d529 52
d589 8
d610 10
d630 3
d671 7
d691 7
d801 8
d1513 6
d2498 6
@


1.304
log
@document SYSTRACE_FILTER_CCACHE, prompted by espie@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.303 2011/11/22 16:01:30 jmc Exp $
d137 12
d1144 10
d1159 2
a1160 2
archives, so that the default case is equivalent to the following shell
fragment:
d1220 1
a1220 1
Automatically sets
d1390 2
a1391 1
Expands to a command that will acquire a lock.
d1476 1
a1476 1
if
d1657 2
a1658 2
patches, so that the default case is equivalent to the following shell
fragment:
d1749 16
d1848 9
a1856 2
Packing-lists are processed by a script, register-plist, which complains
when packing-lists change without a REVISION bump.
d1862 1
d2024 5
@


1.303
log
@zap eol whitespace.

please, people, run your man changes through "mandoc -Tlint" before comitting!
please!
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.302 2011/11/22 14:55:37 espie Exp $
d2175 6
@


1.302
log
@document NO_ARCH and PKGFILE
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.301 2011/11/22 14:48:27 espie Exp $
d809 1
a809 1
on the subject of 
d1499 1
a1499 1
except for packages where PKG_ARCH=*, those end up under 
@


1.301
log
@document MASTER_SITE_* and SETENV
(pending changes to bsd.port.mk to make sure MASTER_SITE_OVERRIDE is
always defined)
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.300 2011/11/22 14:24:33 espie Exp $
d1494 7
d1765 3
d3012 1
@


1.300
log
@reflect reality better.
DEF_UMASK will die.
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.299 2011/11/21 12:57:17 espie Exp $
d27 1
a27 1
.Dd $Mdocdate: November 21 2011 $
d1418 18
d2019 5
@


1.299
log
@avoid excessive parenthesis
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.298 2011/11/21 12:32:34 espie Exp $
d652 5
d723 3
d727 7
d772 16
a787 13
.Sq legacy
used to be a file to check.
The ports tree now uses
.Sq pkgspec
instead, as a package that must be installed prior to the build.
.Sq directory
is set relative to ${PORTSDIR}.
.Sq subpackage
is an optional subpackage name, to install instead of the default main
package name.
.Sq flavor ...
is a comma separated list of flavors.
By default, the dependency will build the default flavor.
d801 3
d807 4
d897 3
a1034 7
.It Ev DEF_UMASK
Correct value of umask for the port to build and package correctly.
Tested against the actual umask at
.Ar fake
time.
Default is 022.
Don't override.
d1330 1
a1330 1
.Sq [pkgspec:]directory[,-subpackage][,flavor ...] .
d1524 7
d1714 6
d1853 6
d1905 3
d2131 6
a2136 5
Location for ports system configuration files.
Defaults to
.Pa /etc ,
should never be set to
.Pa /usr/local/etc .
d2157 1
d2165 10
a2524 1
(default: ${PKGREPOSITORYBASE}/ftp)
d2642 3
a2644 2
Base location for packages built, renamed
.Ev PKGREPOSITORYBASE .
@


1.298
log
@document PREPARE_CHECK_ONLY
start referring to pkgpath.7
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.297 2011/11/21 12:06:12 espie Exp $
d1242 3
a1244 5
including flavors and subpackages
.Po
see
.Xr pkgpath 7
.Pc .
@


1.297
log
@point to pkgpath(7)
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.296 2011/11/18 15:42:16 jmc Exp $
d27 1
a27 1
.Dd $Mdocdate: November 18 2011 $
d549 3
a551 1
Prints the list of pkgpaths for all ports that will be affected by the
d715 3
a717 1
Full pkgpath to the current port, taking flavors into account.
d752 1
a752 1
.Sq [pkgspec:]directory[,-subpackage][,flavor ...][:target] .
d779 3
a781 1
Full pkgpath to the current port, taking flavors and pseudo-flavors
d784 1
a784 1
.Li "LIB_DEPENDS-foo=::${BUILD_PKGPATH}"
d1242 5
a1246 1
including flavors and subpackages.
d1766 10
@


1.296
log
@zap eol whitespace;
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.295 2011/11/18 11:12:47 espie Exp $
d3171 1
@


1.295
log
@surprise: PKG_ARGS was not yet documented.
Add a big blurb about mips64
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.294 2011/10/21 17:31:23 espie Exp $
d27 1
a27 1
.Dd $Mdocdate: October 21 2011 $
d1659 1
a1659 1
For mips64 and pic libraries, see 
@


1.294
log
@tell people to avoid pre,do,post fetch and install
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.293 2011/10/21 17:28:34 espie Exp $
d1405 7
d1655 6
d2917 1
d3102 15
@


1.293
log
@CHOWN/CHMOD are dead
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.292 2011/10/21 17:27:00 espie Exp $
a113 1
.Ar fetch ,
a114 1
.Ar package ,
d2337 7
@


1.292
log
@add elf to properties
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.291 2011/10/16 14:58:13 jmc Exp $
d27 1
a27 1
.Dd $Mdocdate: October 16 2011 $
d2384 12
@


1.291
log
@prefered->preferred;
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.290 2011/10/16 07:13:12 espie Exp $
d1780 3
@


1.290
log
@document PROPERTIES
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.289 2011/09/25 16:53:13 jmc Exp $
d27 1
a27 1
.Dd $Mdocdate: September 25 2011 $
d1773 1
a1773 1
is generally prefered (and simpler).
@


1.289
log
@zap trailing whitespace;
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.288 2011/09/25 08:00:32 espie Exp $
d1753 34
@


1.288
log
@initial documentation
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.287 2011/09/21 09:07:47 espie Exp $
d27 1
a27 1
.Dd $Mdocdate: September 21 2011 $
d1756 1
a1756 1
Its only use should be for disabling part of a multi-packages build, 
d1768 1
a1768 1
.Ev BUILD_PACKAGES 
d1791 1
a1791 1
pseudo-flavor.  
d2946 1
a2946 1
are defined correctly, then 
@


1.287
log
@bye bye, old freebsd cruft
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.286 2011/09/03 15:09:10 espie Exp $
d27 1
a27 1
.Dd $Mdocdate: September 3 2011 $
d726 5
d1500 2
d1756 2
a1757 1
Its main use is for disabling part of a multi-packages build, for instance:
d1762 30
a1791 1
Creation of a separate working directory is mandatory.
d2767 3
d2933 38
d3083 1
@


1.286
log
@document new stuff
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.285 2011/08/29 18:48:31 matthew Exp $
d27 1
a27 1
.Dd $Mdocdate: August 29 2011 $
d1190 1
a1190 1
(default: files.${ARCH} or files).
d1579 1
a1579 2
Location for patches applied by patch target (default: patches.${ARCH} or
patches).
d1679 1
a1679 1
Default: pkg.${ARCH} or pkg.
a2179 2
.It Pa Makefile.${ARCH}
Arch-dependent Makefile fragment, included automatically.
d2590 10
@


1.285
log
@No need to discourage xz distfiles because of sparc.

ok naddy@@, espie@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.284 2011/07/15 23:11:59 fgsch Exp $
d27 1
a27 1
.Dd $Mdocdate: July 15 2011 $
d1498 15
d2138 2
@


1.284
log
@document regress-depends-list.
espie@@ ok.
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.283 2011/07/05 15:29:32 sthen Exp $
d27 1
a27 1
.Dd $Mdocdate: July 5 2011 $
d1133 1
a1133 1
build on vax and very annoying on sparc.
@


1.283
log
@Document CCACHE_DIR and CCACHE_ENV.
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.282 2011/07/05 15:16:10 sthen Exp $
d88 1
a88 1
.It Ar {build,lib,run}-depends-list
d90 2
a91 1
build dependencies, library dependencies, or run dependencies.
@


1.282
log
@Document USE_CCACHE / NO_CCACHE.
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.281 2011/06/04 08:26:55 jmc Exp $
d27 1
a27 1
.Dd $Mdocdate: June 4 2011 $
d824 14
@


1.281
log
@tweak previous;
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.280 2011/06/01 12:05:13 espie Exp $
d27 1
a27 1
.Dd $Mdocdate: June 1 2011 $
d1433 7
d2022 7
@


1.280
log
@document xz support, explain why it's generally a bad idea
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.279 2011/05/13 14:40:29 sthen Exp $
d27 1
a27 1
.Dd $Mdocdate: May 13 2011 $
d1100 1
a1100 1
    	*.tar.xz) 
@


1.279
log
@Talk about USE_LIBTOOL=gnu; ok giovanni@@ landry@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.278 2011/04/10 17:57:16 jasper Exp $
d27 1
a27 1
.Dd $Mdocdate: April 10 2011 $
d1091 1
a1091 1
Fragments are automatically appended to extract tar and zip
d1100 2
d1117 2
@


1.278
log
@- remove MOTIF bits here too
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.277 2011/04/03 07:25:29 espie Exp $
d27 1
a27 1
.Dd $Mdocdate: April 3 2011 $
d2026 4
a2029 1
Adds correct dependencies, and passes LIBTOOL environment variable to
@


1.277
log
@document IGNORE changes.
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.276 2010/12/11 10:41:30 martynas Exp $
d27 1
a27 1
.Dd $Mdocdate: December 11 2010 $
a1409 3
.It Ev MOTIFLIB
Read-only.
Correct incantation to link with motif.
a2027 14
.It Ev USE_MOTIF
Set to
.Sq any
if port works with any version of motif;
.Sq lesstif
if port requires lesstif to work;
.Sq openmotif
if ports requires openmotif to work.
The
.Sq any
setting creates an extra flavor choice of
.Sq lesstif .
See also
.Ev MOTIFLIB
a2306 3
.It Ev HAVE_MOTIF
Old user settings.
No longer needed since OpenMotif is now free.
@


1.276
log
@update subst_vars list;  ok ajacoutot@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.275 2010/12/01 23:59:53 landry Exp $
d27 1
a27 1
.Dd $Mdocdate: December 1 2010 $
d1811 2
a1817 3
Set to
.Sq flavored
if distinct flavors of the port may share a common source tree.
d2767 1
d2843 3
a2845 1
.Ev MULTI_PACKAGES .
@


1.275
log
@Fix path to register-plist. Mikolaj Kucharski
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.274 2010/11/26 14:07:17 espie Exp $
d27 1
a27 1
.Dd $Mdocdate: November 26 2010 $
d1899 1
d1901 1
d1906 2
d1909 1
a1909 1
.Ev SYSCONFDIR .
@


1.274
log
@typo, noticed by Mikolaj Kucharski
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.273 2010/11/26 10:02:35 jmc Exp $
d2940 1
a2940 1
.Pa ${PORTSDIR}/infrastructure/packages/register-plist .
@


1.273
log
@tweak previous;
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.272 2010/11/26 07:46:31 espie Exp $
d2772 1
a2772 1
.Ev PKSPEC .
@


1.272
log
@document package-specs
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.271 2010/11/14 11:18:30 espie Exp $
d27 1
a27 1
.Dd $Mdocdate: November 14 2010 $
d1677 1
a1677 1
.Ev FULLPKGNAME.
@


1.271
log
@document the new simpler way to do specs
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.270 2010/11/13 10:43:20 espie Exp $
d27 1
a27 1
.Dd $Mdocdate: November 13 2010 $
d1672 9
d2771 2
a2772 1
.Ev PLIST .
@


1.270
log
@mention the helper scripts and how to get to their documentation.
be clearer about print-package-signature, that is it looks only at
the ports tree
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.269 2010/10/27 17:20:06 espie Exp $
d27 1
a27 1
.Dd $Mdocdate: October 27 2010 $
d744 1
a744 1
.Sq :[pkgspec]:directory[,-subpackage][,flavor ...][:target] .
d1279 1
a1279 1
.Sq :[pkgspec]:directory[,-subpackage][,flavor ...] .
@


1.269
log
@Document RCDIR and files copied from PKGDIR
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.268 2010/10/25 04:54:25 jmc Exp $
d27 1
a27 1
.Dd $Mdocdate: October 25 2010 $
d41 8
d474 2
a475 1
Print the package signature, in the same format used for
d744 1
a744 1
.Sq [legacy]:[pkgspec]:directory[,-subpackage][,flavor ...][:target] .
d1279 1
a1279 1
.Sq [legacy]:[pkgspec]:directory[,-subpackage][,flavor ...] .
@


1.268
log
@needs a full stop;
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.267 2010/10/24 20:43:31 ajacoutot Exp $
d27 1
a27 1
.Dd $Mdocdate: October 24 2010 $
d1632 1
a1632 2
Location for packaging information (packing list, port description, port
short description).
d1702 5
d1885 1
d2144 19
d2650 10
@


1.267
log
@Cope with USE_X11 removal from ports infrastructure.
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.266 2010/10/22 15:53:39 espie Exp $
d27 1
a27 1
.Dd $Mdocdate: October 22 2010 $
d1235 1
a1235 1
.Ev ONLY_FOR_ARCHS ,
@


1.266
log
@document USE_GROFF
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.265 2010/10/04 16:04:27 jmc Exp $
d27 1
a27 1
.Dd $Mdocdate: October 4 2010 $
a1235 1
.Ev USE_X11 .
a2023 4
.It Ev USE_X11
Set to
.Sq Yes
if port requires X11 to work.
d2495 2
@


1.265
log
@tweak previous;
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.264 2010/10/04 10:35:24 espie Exp $
d1993 7
@


1.264
log
@document TARGETS
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.263 2010/10/04 10:32:47 espie Exp $
d1412 1
a1412 1
is some of the packages only exist for some architectures.
@


1.263
log
@be more forceful in pointing people at MULTI_PACKAGES/ONLY_FOR_ARCHS
interaction.
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.262 2010/09/06 16:28:21 espie Exp $
d27 1
a27 1
.Dd $Mdocdate: September 6 2010 $
d1943 7
@


1.262
log
@over-eager doc, as noticed by the guys
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.261 2010/09/06 12:06:56 jasper Exp $
d1410 3
d1471 4
d2780 1
a2780 1
should list all subpackages,
d2783 3
@


1.261
log
@- sync description for clean.
- fix spello

ok espie@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.260 2010/08/08 12:37:59 jmc Exp $
d27 1
a27 1
.Dd $Mdocdate: August 8 2010 $
d1858 1
a1858 1
.Dl ${SUBST_CMD} Oo Fl g Ar group Oc Oo Fl m Ar mode Oc Oo Fl o Ar owner Oc file...
@


1.260
log
@zap trailing whitespace;
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.259 2010/08/07 19:40:45 espie Exp $
d27 1
a27 1
.Dd $Mdocdate: August 7 2010 $
d191 3
a193 1
Short-hand for `sub package'.
@


1.259
log
@document new default
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.258 2010/08/07 08:33:35 espie Exp $
d1664 1
a1664 1
Defaults to 
@


1.258
log
@explain quite a bit more what PLIST_DB does
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.257 2010/07/18 21:22:36 jmc Exp $
d27 1
a27 1
.Dd $Mdocdate: July 18 2010 $
d1664 2
a1665 1
Defaults to empty.
@


1.257
log
@packages-specs man page is section 7, not 5;
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.256 2010/07/18 18:50:38 naddy Exp $
d381 3
d1658 6
a1663 2
Directory used to save generated packing-lists, for further processing,
such as looking for unregistered conflicts.
@


1.256
log
@document OPSYS and OPSYS_VER as obsolete, mention OSREV; ok espie@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.255 2010/07/11 07:19:05 espie Exp $
d27 1
a27 1
.Dd $Mdocdate: July 11 2010 $
d1061 1
a1061 1
.Xr packages-specs 5 .
d1759 1
a1759 1
.Xr packages-specs 5 .
@


1.255
log
@thinko (found by Daniel Dickman)
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.254 2010/07/10 10:49:15 jmc Exp $
d27 1
a27 1
.Dd $Mdocdate: July 10 2010 $
d1463 1
a1463 5
.It Ev OPSYS
Always
.Ox .
Read-only.
.It Ev OPSYS_VER
d2356 8
d2439 1
a2439 1
old pipeline for creating packing-lists at the ports level.
@


1.254
log
@tweak;
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.253 2010/07/10 09:12:02 espie Exp $
d1195 1
a1195 1
.It Ev EPOCH
d1197 1
a1197 1
.It Ev REVISION .
@


1.253
log
@document EPOCH/REVISION
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.252 2010/07/06 16:22:25 jmc Exp $
d27 1
a27 1
.Dd $Mdocdate: July 6 2010 $
d1054 1
a1054 1
Defaults to empty (no need for numbering changes).
@


1.252
log
@zap trailing whitespace and fix some linewrap. please, developers, try and
avoid these when committing to man pages;
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.251 2010/07/06 12:42:55 espie Exp $
d476 4
d1052 10
d1194 4
d1635 6
d1754 10
d2674 2
@


1.251
log
@document that ONLY_FOR_ARCHS and NOT_FOR_ARCHS are now subpackage-dependent
(and why !)
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.250 2010/07/04 17:30:30 espie Exp $
d27 1
a27 1
.Dd $Mdocdate: July 4 2010 $
d2719 2
a2720 2
The infrastructure will automatically filter subpackages that are not suitable for the 
current architecture.
d2723 2
a2724 1
should list all subpackages, even things not buildable on the current architecture,
@


1.250
log
@document new semantics
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.249 2010/06/20 07:59:53 espie Exp $
d27 1
a27 1
.Dd $Mdocdate: June 20 2010 $
d2644 2
d2713 12
@


1.249
log
@Document locks mechanism changes to default.
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.248 2010/06/17 13:28:17 jmc Exp $
d27 1
a27 1
.Dd $Mdocdate: June 17 2010 $
d1248 17
a1264 7
.Sq lib_specs:[pkgspec]:directory[,-subpackage][,flavor ...][:target] .
Similar to BUILD_DEPENDS, except for
.Sq lib_specs ,
which is a comma-separated list of
.Sq lib_spec
of the form:
.Sq libname.[version.[subversion]] .
a1268 4
On architectures that use dynamic libraries,
.Ev LIB_DEPENDS
is also used as a run-time dependency, and recorded in the package as
such.
d1978 3
@


1.248
log
@- start sentence with a capital letter
- zap trailing whitespace
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.247 2010/06/17 03:19:39 william Exp $
d1275 2
@


1.247
log
@document WRKDIR_LINKNAME; ok espie@@ jmc@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.246 2010/06/16 12:14:40 espie Exp $
d27 1
a27 1
.Dd $Mdocdate: June 16 2010 $
d1278 1
a1278 1
expands to a command that will acquire a lock.
d1811 4
a1814 4
to set file 
.Ar owner , 
.Ar group 
and/or 
@


1.246
log
@fully document SUBST_CMD
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.245 2010/06/16 12:07:39 espie Exp $
d2008 3
@


1.245
log
@document PROGRESS_METER and a few other new changes
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.244 2010/05/01 10:30:41 espie Exp $
d27 1
a27 1
.Dd $Mdocdate: May 1 2010 $
d1806 10
@


1.244
log
@document STARTAFTER
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.243 2010/04/08 16:59:49 jmc Exp $
d27 1
a27 1
.Dd $Mdocdate: April 8 2010 $
d860 1
a860 1
Same as COMMENT but used for sub package foo in a multi-package setup.
d943 5
d1183 8
d1278 1
a1278 4
User settings.
If set, expands to a command that will acquire a lock.
This lock will reside in
.Pa ${LOCKDIR} .
d1281 7
d1290 1
d1556 4
d1564 4
d1573 8
d1640 8
d2332 3
@


1.243
log
@"document the no-autoheader flag in CONFIGURE_STYLE";
from Christopher Zimmermann

ok ajacoutot
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.242 2010/03/22 22:02:08 jmc Exp $
d27 1
a27 1
.Dd $Mdocdate: March 22 2010 $
d1732 3
@


1.242
log
@tweak; ok espie
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.241 2010/03/21 11:40:39 ajacoutot Exp $
d27 1
a27 1
.Dd $Mdocdate: March 21 2010 $
d925 4
a928 1
if autoconf needs to be rerun first.
@


1.241
log
@Document the new APM_ARCHS variable.

comments from espie@@ naddy@@ jasper@@
"looks good" jasper@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.240 2010/03/20 19:16:57 espie Exp $
d27 1
a27 1
.Dd $Mdocdate: March 20 2010 $
d714 2
a715 2
Intent distinct from 
.Ev ONLY_FOR_ARCHS ,
@


1.240
log
@Document BROKEN-<arch>
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.239 2010/02/26 19:27:09 espie Exp $
d27 1
a27 1
.Dd $Mdocdate: February 26 2010 $
d667 6
@


1.239
log
@fix TRY_BROKEN
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.238 2010/02/12 15:20:13 jmc Exp $
d27 1
a27 1
.Dd $Mdocdate: February 12 2010 $
d706 8
@


1.238
log
@zap trailing whitespace;
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.237 2010/02/12 12:12:13 espie Exp $
d704 2
a705 1
.Ev NO_IGNORE .
d1829 9
@


1.237
log
@document tweaks
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.236 2009/12/24 13:58:14 sthen Exp $
d27 1
a27 1
.Dd $Mdocdate: December 24 2009 $
d458 1
a458 1
Prepare a port for building, by checking and installing all required 
@


1.236
log
@In the descriptions of the obsolete USE_BZIP/USE_ZIP entries,
point people at where they should be looking instead.
ok espie@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.235 2009/10/13 14:40:24 landry Exp $
d27 1
a27 1
.Dd $Mdocdate: October 13 2009 $
d457 3
d1007 4
d1166 6
a1171 2
The port is ignored and ${IGNORE} is printed if defined.
Usually set to the reason the port is ignored.
d1175 1
d1183 4
@


1.235
log
@WRKOBJDIR defaults changed (obj -> pobj)
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.234 2009/08/17 21:39:41 sthen Exp $
d27 1
a27 1
.Dd $Mdocdate: August 17 2009 $
d2308 4
d2320 4
@


1.234
log
@Document that explicitly unset WRKOBJDIR gives the old behaviour of
putting ports work directories directly in the port directory.
Requested by frantisek holop. Wording tweak from jim@@, ok jmc@@,
pre-tweak version ok sobrado@@.
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.233 2009/08/12 22:40:54 simon Exp $
d27 1
a27 1
.Dd $Mdocdate: August 12 2009 $
d1924 1
a1924 1
${PORTSDIR}/obj).
@


1.233
log
@add modinst to CONFIGURE_STYLE list
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.232 2009/07/02 17:45:38 jakemsr Exp $
d27 1
a27 1
.Dd $Mdocdate: July 2 2009 $
d1929 2
@


1.232
log
@missing final `d' in `prepended'

ok deraadt@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.231 2009/06/16 11:25:30 sthen Exp $
d27 1
a27 1
.Dd $Mdocdate: June 16 2009 $
d885 4
@


1.231
log
@Typo: Use settings -> User settings.
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.230 2009/06/12 13:40:34 landry Exp $
d27 1
a27 1
.Dd $Mdocdate: June 12 2009 $
d1268 1
a1268 1
prepende and with master site selection extension removed.
@


1.230
log
@Document new WRKOBJDIR default value.
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.229 2009/05/20 17:30:39 jmc Exp $
d27 1
a27 1
.Dd $Mdocdate: May 20 2009 $
d807 1
a807 1
Use settings.
@


1.229
log
@zap trailing whitespace;
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.228 2009/05/19 19:43:17 espie Exp $
d27 1
a27 1
.Dd $Mdocdate: May 19 2009 $
d1919 2
a1920 1
If non empty, used as a base for the actual port working directory.
@


1.228
log
@reword FLAVORS/FLAVOR slightly to make it less confusing.
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.227 2009/05/16 22:19:06 simon Exp $
d27 1
a27 1
.Dd $Mdocdate: May 16 2009 $
d2439 1
a2439 1
If a port can be compiled with several options, these options 
d2441 1
a2441 1
The port maintainer will set FLAVORS to be the list of possible options in 
d2459 1
a2459 1
each flavor, or creating a FULLPKGNAME by adding a dash separated list of 
@


1.227
log
@document REGRESS_IS_INTERACTIVE=X11

missing comma sponsored by sthen@@
ok ajacoutot@@, sthen@@, jasper@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.226 2009/01/24 11:41:26 espie Exp $
d27 1
a27 1
.Dd $Mdocdate: January 24 2009 $
d2439 5
a2443 3
If a port can be compiled with several options, set FLAVORS to the list of
possible options in the Makefile.
When building the port, set
d2459 7
a2465 6
each flavor, or adding a dash separated list of options to the package
name.
The order in which FLAVOR is specified does not matter: the generated list,
called the canonical package extension, matches the ordering of FLAVORS.
Also, it is an error to specify an option in FLAVOR that does not appear
in FLAVORS.
@


1.226
log
@forward user to ports(7) for the few variables that are documented there
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.225 2008/10/29 12:35:10 espie Exp $
d27 1
a27 1
.Dd $Mdocdate: October 29 2008 $
d1599 3
a1601 1
if port needs human interaction to run its tests.
@


1.225
log
@Xr OpenBSD::Intro(3p)
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.224 2008/10/26 19:30:18 jmc Exp $
d27 1
a27 1
.Dd $Mdocdate: October 26 2008 $
d309 3
d364 3
d438 3
d1634 6
d1691 6
@


1.224
log
@missing full stop;
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.223 2008/10/26 15:21:46 espie Exp $
d2663 1
@


1.223
log
@document newer clean=build
(reminded by pirofti@@)
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.222 2008/07/27 10:24:27 jmc Exp $
d27 1
a27 1
.Dd $Mdocdate: July 27 2008 $
d165 1
a165 1
is set)
@


1.222
log
@bad comma;
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.221 2008/07/26 11:31:03 espie Exp $
d27 1
a27 1
.Dd $Mdocdate: July 26 2008 $
d153 1
a153 1
make clean='[depends bulk work fake flavors dist install sub package
d160 6
@


1.221
log
@note that fetch hooks are a real bad idea
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.220 2008/07/26 11:05:32 espie Exp $
d1792 1
a1792 1
Used to store cookies for package updates and, defaults to
@


1.220
log
@document update-or-install
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.219 2008/07/22 20:53:13 espie Exp $
d27 1
a27 1
.Dd $Mdocdate: July 22 2008 $
d282 4
@


1.219
log
@FAKE (the variable) died about 2 years ago...
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.218 2008/07/04 10:55:55 espie Exp $
d27 1
a27 1
.Dd $Mdocdate: July 4 2008 $
d561 20
d1788 1
a1788 1
Used to store cookies for package updates, defaults to
@


1.218
log
@no reason not to document that one can use ${WRKDIR}/bin to override
nasty commands dependencies.
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.217 2008/06/10 11:07:00 jmc Exp $
d27 1
a27 1
.Dd $Mdocdate: June 10 2008 $
a1019 11
.It Ev FAKE
Automatically set to
.Sq Yes
for most ports (and all new ports).
Indicates that the port, using
.Ev FAKE_FLAGS
magic, will properly fake installation into ${WRKINST}, to be packaged
and properly installed from the package.
Set to
.Sq No
in very rare cases, and during port creation.
@


1.217
log
@typo; from Tim van der Molen
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.216 2008/06/08 10:28:48 espie Exp $
d27 1
a27 1
.Dd $Mdocdate: June 8 2008 $
d1860 4
@


1.216
log
@explain about ^SYSCONFDIR
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.215 2008/06/07 21:58:22 espie Exp $
d27 1
a27 1
.Dd $Mdocdate: June 7 2008 $
d1682 1
a1682 1
Make variables whole values get substituted to create the actual package
@


1.215
log
@dyslexia
noticed by lanrdy@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.214 2008/05/15 10:03:32 espie Exp $
d27 1
a27 1
.Dd $Mdocdate: May 15 2008 $
d1702 5
@


1.214
log
@document CHECKSUMFILES/MAKESUMFILES
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.213 2008/05/11 18:48:21 espie Exp $
d27 1
a27 1
.Dd $Mdocdate: May 11 2008 $
d1663 1
a1663 1
.Ev VAR_SUBST
@


1.213
log
@remove final ' ' to please jmc@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.212 2008/05/11 10:28:44 espie Exp $
d139 1
a139 1
All the files needed to recreate a port should be in ${ALLFILES} and
d283 1
a283 1
.Ev ALLFILES ,
d292 1
d344 1
a344 1
cryptographic fingerprints sha256, sha1, md5 and rmd160 on ${ALLFILES}.
a609 5
.It Ev ALLFILES
List of all files that need to be retrieved by
.Ar fetch ,
with master site selection extension removed.
Read-only.
d776 9
d1235 9
d1904 4
a1907 2
.It Pa ${FULLDISTDIR}/${ALLFILES}
cache of distribution files for a given port.
@


1.212
log
@document port-lib-depends-check and print-plist-with-depends, goes into some
details of the tradeoffs involved.
Also update my copyright.
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.211 2008/04/25 14:41:35 jmc Exp $
d27 1
a27 1
.Dd $Mdocdate: April 25 2008 $
d432 1
a432 1
completion of the 
d1269 4
d2619 1
@


1.211
log
@missing full stop; from Jim Razmus
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.210 2008/04/07 11:19:40 espie Exp $
d3 1
a3 1
.\" Copyright (c) 2000 Marc Espie
d27 1
a27 1
.Dd $Mdocdate: April 7 2008 $
d314 1
a314 2
hold all shared libraries used for the port.
Applies to all packages in a multi-packages port.
d316 2
a317 1
.Xr library-specs 7 .
d421 16
d453 10
@


1.210
log
@document SUBST_CMD
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.209 2008/03/24 14:41:35 ajacoutot Exp $
d27 1
a27 1
.Dd $Mdocdate: March 24 2008 $
d632 1
a632 1
to avoid ports that require user-interaction
@


1.209
log
@- since we are in control of shared library versions, advise people to
use "0.0" for SHARED_LIBS version when importing a new port

ok espie@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.208 2008/01/12 16:04:35 jmc Exp $
d27 1
a27 1
.Dd $Mdocdate: January 12 2008 $
d1617 20
@


1.208
log
@tweak previous;
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.207 2008/01/12 14:23:07 espie Exp $
d1600 2
@


1.207
log
@finish documenting ALL_REGRESS_FLAGS
Document lock/unlock
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.206 2008/01/04 22:30:12 jmc Exp $
d27 1
a27 1
.Dd $Mdocdate: January 4 2008 $
d1195 1
a1195 1
.Ev ALL_REGRESS_FLAGS )
d1522 1
a1522 1
Extra Flags passed to ${MAKE_PROGRAM} to run the regression tests.
@


1.206
log
@zap trailing whitespace;
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.205 2008/01/04 17:55:49 espie Exp $
d333 8
d446 1
a446 1
env -i ${MAKE_ENV} ${MAKE_PROGRAM} ${REGRESS_FLAGS} \e
d496 4
d593 5
d1002 1
d1192 4
a1195 2
and for the regress stage, which uses
.Ev REGRESS_FLAGS .
d1522 2
a1523 2
Flags to pass to ${MAKE_PROGRAM} to run the regression tests.
Defaults to ${MAKE_FLAGS}.
@


1.205
log
@document new FAKE_FLAGS semantics.
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.204 2007/12/21 19:24:50 jmc Exp $
d27 1
a27 1
.Dd $Mdocdate: December 21 2007 $
d577 1
a577 1
Flags passed to ${MAKE} invocations during the fake process. 
d1171 1
a1171 1
.Ev FAKE_FLAGS 
@


1.204
log
@remove trailing whitespace;
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.203 2007/12/21 16:53:05 espie Exp $
d576 5
d984 1
a984 2
Flags passed to ${MAKE_PROGRAM} on fake invocation.
By default, ${DESTDIRNAME}=${WRKINST}.
d1170 4
a1173 2
stage, which uses
.Ev FAKE_FLAGS ,
d2276 1
a2276 1
${MAKE_PROGRAM} ${FAKE_FLAGS} -f ${MAKE_FILE} ${FAKE_TARGET}
@


1.203
log
@a few nits
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.202 2007/08/28 11:25:04 espie Exp $
d27 1
a27 1
.Dd $Mdocdate: August 28 2007 $
d776 1
a776 1
Set by default to --enable-shared or --disable-shared, depending on whether 
@


1.202
log
@yuck, shameful typo
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.201 2007/06/23 09:42:24 steven Exp $
d27 1
a27 1
.Dd $Mdocdate: June 23 2007 $
d245 9
d605 1
d657 1
d774 1
a774 1
Should be relative to ${WRKSRC}.
d776 2
a777 2
Set to --enable-shared or --disable-shared, depending on whether the
architecture supports shared libraries.
@


1.201
log
@document REGRESS_LOG*
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.200 2007/06/17 10:39:39 espie Exp $
d27 1
a27 1
.Dd $Mdocdate: June 17 2007 $
d2403 1
a2403 1
settings that affect over subpackages, e.g., for include files packs).
@


1.200
log
@explicit ties to the package system.
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.199 2007/06/16 10:03:52 espie Exp $
d27 1
a27 1
.Dd $Mdocdate: June 16 2007 $
d430 1
a430 1
	-f ${MAKE_FILE} ${REGRESS_TARGET}
d1491 4
@


1.199
log
@no reason for special handling of USE_SYSTRACE. We do not explain
how to set other user settings either.
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.198 2007/05/31 19:19:58 jmc Exp $
d27 1
a27 1
.Dd $Mdocdate: May 31 2007 $
d56 7
d67 2
@


1.198
log
@convert to new .Dd format;
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.197 2007/05/31 15:20:32 jmc Exp $
d27 1
a27 1
.Dd $Mdocdate$
d1687 1
a1690 2
Set by the user, e.g. in
.Pa /etc/mk.conf .
@


1.197
log
@tweak;
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.196 2007/05/31 10:48:51 espie Exp $
d27 1
a27 1
.Dd June 10, 2000
@


1.196
log
@Synchronize with reality.
Talk about `package information', there's no need for specialized language
like `packing information' (what the hell was I thinking ?).
Deprecate INSTALL, DEINSTALL, REQ after discussions with people.
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.195 2007/05/21 11:19:30 steven Exp $
d2180 2
a2181 1
Old requirement script. Was mostly unused anyways.
d2424 1
a2424 1
These are now deprecated. 
@


1.195
log
@update part about clean.

ok espie@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.194 2007/04/20 22:15:40 jmc Exp $
d54 1
a54 1
the generation of packing-lists.
a1747 5
.It Ev WRKPKG
Subdirectory of ${WRKBUILD} where package information gets generated.
Defaults to ${WKRBUILD}/pkg, do not override unless
.Sq pkg
conflicts with the port's conventions.
d2143 5
d2166 4
d2179 2
d2298 1
a2298 1
Finally, packing information will use templates with the canonical package
d2326 1
a2326 1
All packing information is also derived from
d2409 1
a2409 1
.Sh THE GENERATION OF PACKING INFORMATION
d2411 4
a2414 3
.Ox 2.7
(around revision 1.300 of bsd.port.mk), all packing information is
generated from templates in ${PKGDIR}.
d2423 2
a2424 2
Modify PKG_ARGS accordingly, to use the generated files, and add
dependencies to regenerate the files if the templates change.
d2427 1
a2427 3
REQ, INSTALL, DEINSTALL from the templates in ${DESCR}, ${MESSAGE},
${UNMESSAGE}, ${PKGDIR}/REQ${SUBPACKAGE},
${PKGDIR}/INSTALL${SUBPACKAGE}, ${PKGDIR}/DEINSTALL${SUBPACKAGE}, by
d2435 1
a2435 1
and applying the same variable substitutions as other packing information.
d2494 1
a2494 1
points to a directory, all packing-lists generated by
d2498 5
a2502 2
stage are saved in that location in a timeless format:
md5 and size information are removed, as well as build specificities.
d2508 2
a2509 2
templates for each SUBPACKAGE (and optional distinct MESSAGE, UNMESSAGE,
REQ, INSTALL, DEINSTALL files in a similar way).
@


1.194
log
@kill trailing whitespace;
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.193 2007/04/20 20:16:37 steven Exp $
d144 2
a145 1
make clean='[depends bulk work fake flavors dist install sub package packages]'.
d153 4
a158 2
.It Va dist
Clean distribution files.
d163 2
@


1.193
log
@add sha256 in a few places, and update distinfo description a bit.

reminded by Stuart Henderson

ok jasper@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.192 2007/04/03 10:17:00 espie Exp $
d704 1
a704 1
Defaults to 
@


1.192
log
@Document CHECK_LIB_DEPENDS.
Based on an idea by bernd and nikolai.
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.191 2007/03/30 13:46:24 espie Exp $
d312 1
a312 1
cryptographic fingerprints sha1, md5 and rmd160 on ${ALLFILES}.
d1438 1
a1438 1
.Sq sha1 rmd160 md5 .
d1785 4
a1788 5
.Xr md5 1 ,
.Xr sha1 1 ,
and
.Xr rmd160 1
for the ports ${DISTFILES} and ${PATCHFILES}.
@


1.191
log
@document ECHO_REORDER
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.190 2007/02/06 19:01:24 espie Exp $
d698 9
@


1.190
log
@typo
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.189 2007/01/18 06:34:56 steven Exp $
d880 8
@


1.189
log
@FULLPKGPATH is no longer read-only, and COMMENT is also subpackage dependent.

ok sturm@@ bernd@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.188 2007/01/17 13:16:11 steven Exp $
d940 1
a940 1
Target build by ${MAKE_PROGRAM} on fake invocation.
@


1.188
log
@describe BULK_DO variable
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.187 2006/12/26 20:35:59 steven Exp $
a1025 1
Read-only.
d2305 1
d2309 1
a2309 1
.Ev PKGNAME
d2316 1
a2316 1
.Ev CATEGORIES
d2319 1
a2319 1
.Ev DESCR
@


1.187
log
@FULL_DISTDIR -> FULLDISTDIR
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.186 2006/12/21 16:27:23 ajacoutot Exp $
d639 2
a640 1
any targets mentioned in BULK_TARGETS.
d651 6
@


1.186
log
@- PATCH_SITES -> PATCHSITES

ok bernd@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.185 2006/12/11 21:30:55 espie Exp $
d268 1
a268 1
.Ev FULL_DISTDIR ,
@


1.185
log
@document regress-dir-depends, after some prodding by janus.
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.184 2006/12/01 17:49:38 espie Exp $
d272 1
a272 1
.Ev PATCH_FILES ,
d2038 1
a2038 1
PATCH_FILES=foo.diff.gz
d2044 1
a2044 1
PATCH_FILES=foo.diff.gz:0
@


1.184
log
@give a more thorough list of subpackage-dependent variable,
rephrase description of package/subpackage to not give the impression
one explicitly invokes the other, since it doesn't...
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.183 2006/11/26 22:03:54 jmc Exp $
d62 3
a64 3
.It Ar {build,run,all}-dir-depends
Print all dependencies for a port in order to build it, run it,
or both.
@


1.183
log
@- kill trailing space
- new sentence, new line
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.182 2006/11/26 18:38:54 espie Exp $
d2302 3
d2342 17
a2358 1
In terms of implementation, quite a few targets will invoke a subpackage
d2360 1
d2362 4
a2365 2
will invoke
.Ar subpackage ,
d2367 4
a2370 2
will invoke
.Ar install ,
d2372 3
a2374 15
will invoke
subupdate ,
.Ar lib-depends-check
will invoke
.Ar sublib-depends-check ,
.Ar readme
will invoke
.Ar subreadme ,
.Ar describe
will invoke
.Ar subdescribe ,
and
.Ar dump-vars
will invoke
.Ar subdump-vars .
@


1.182
log
@document new MULTI_PACKAGES
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.181 2006/11/04 00:15:26 jmc Exp $
d559 2
a560 1
Current machine architecture. Read-only.
d628 1
a628 1
Full pkgpath to the current port, taking flavors and pseudo-flavors 
d1011 2
a1012 1
located, to be used in hand-crafted extraction targets. Read-only.
d2314 1
a2314 1
So, if you set 
@


1.181
log
@oops - forgot to kill trailing spaces;
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.180 2006/11/04 00:14:12 jmc Exp $
d537 5
d559 1
a559 1
Current machine architecture (read-only).
d579 2
d626 6
d1010 1
a1010 1
located, to be used in hand-crafted extraction targets (read-only).
d1012 1
a1012 1
Full name of the main created package, taking flavors into account.
a1013 3
.It Ev FULLPKGNAME-foo
Full package name for sub-package foo, if the default value is not
appropriate.
d1179 5
d1235 2
a1236 2
.Ox
(read-only).
d1239 2
a1240 5
.Ox
(read-only).
.It Ev PACKAGING
Defined while building packages, read-only.
See the description of FLAVORS AND MULTI_PACKAGES for a detailed explanation.
d1383 2
a1384 3
Name of the main created package.
Default is ${DISTNAME} for the main package,
and ${DISTNAME} for multi-package ports.
d1540 1
d2018 5
d2229 1
a2229 1
each port can generate several packages through two orthogonal mechanisms:
d2232 3
d2268 2
a2269 2
If a port can generate several useful packages, set MULTI_PACKAGES
accordingly.
d2278 17
a2294 5
If MULTI_PACKAGES is set, each element of MULTI_PACKAGES triggers a
recursive package build, with SUBPACKAGE set to the right value, and
PACKAGING defined.
For instance, if MULTI_PACKAGES=-lib -server,
make package will work as follows:
d2296 25
a2320 8
.Bl -bullet -compact
.It
Run env SUBPACKAGE= PACKAGING= make subpackage,
.It
Run env SUBPACKAGE=-lib PACKAGING=-lib make subpackage,
.It
Run env SUBPACKAGE=-server PACKAGING=-server make subpackage,
.El
d2322 14
a2335 9
The port's Makefile can test the value of SUBPACKAGE to specialize
processing for all sub packages.
Note that SUBPACKAGE can also be set for dependency checking, so be
careful to also test PACKAGING: the build stage is shared among all
subpackages, and tests often only make sense during the packaging stage.
All packing information is derived from
templates with SUBPACKAGE appended.
In the preceding example, the packing-list template for pkgname-foo
must be in PLIST-foo.
d2337 2
a2338 2
In terms of implementation, quite a few targets will recurse to take
multi-packages into account:
d2371 1
a2371 1
Set ${PLIST}, ${DESCR}, ${COMMENT}, ${MESSAGE}, ${UNMESSAGE} accordingly.
@


1.180
log
@tweaks;
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.179 2006/11/03 17:14:12 espie Exp $
d179 1
a179 1
directory (see SEPARATE_BUILD), 
d2115 1
a2115 1
.Ar do-configure 
@


1.179
log
@SCRIPTDIR and SCRIPTS_ENV are obsolete now.
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.178 2006/11/02 16:54:16 jmc Exp $
d2079 1
a2079 1
Used to contain the Environment for invoking various scripts.
d2113 2
a2114 1
No longer invoked automatically. Just inline the instructions in
@


1.178
log
@tweaks;
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.177 2006/11/02 10:18:07 espie Exp $
d179 1
a179 1
directory (see SEPARATE_BUILD), runs ${SCRIPTDIR}/configure if it exists,
a1478 3
.It Ev SCRIPTDIR
Location for scripts related to the current port (default: scripts.${ARCH}
or scripts).
d2073 11
d2112 5
@


1.177
log
@Document print-plist/print-plist-contents
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.176 2006/11/02 10:12:17 espie Exp $
d1231 2
a1232 1
Default location for built packages. Defaults to
d1333 1
a1333 1
if package or distribution files can be allowed on ftp sites or CD-ROM without
d1780 1
a1780 1
Location of packages suitable for ftp.
d1841 1
a1841 1
The infrastructure always trust the repository to contain correct packages.
d1854 1
a1854 1
Now hardwired to 
d1890 1
a1890 1
Base location where packages suitable for ftp (see
d1892 1
a1892 1
Now hardwired to 
d2282 1
a2282 1
.Ar sublib-depends-check,
@


1.176
log
@partially document the sub* stuff
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.175 2006/11/02 09:57:04 espie Exp $
d394 12
d433 3
@


1.175
log
@Document the new package repository structure, mark BIN_PACKAGES as obsolete,
explain update and subupdate.
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.174 2006/08/02 09:09:38 espie Exp $
d200 3
d281 2
d292 1
d971 1
a971 1
even if it is the same version,
d974 6
d2229 1
a2229 1
recursive make package, with SUBPACKAGE set to the right value, and
d2236 1
a2236 1
Run env SUBPACKAGE= PACKAGING= make package,
d2238 1
a2238 1
Run env SUBPACKAGE=-lib PACKAGING=-lib make package,
d2240 1
a2240 1
Run env SUBPACKAGE=-server PACKAGING=-server make package,
d2252 25
@


1.174
log
@grammar
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.173 2006/07/01 11:10:42 espie Exp $
d159 1
a159 1
Remove package file (and copies in ${CDROM_PACKAGES} and ${FTP_PACKAGES}).
d326 3
d331 1
a331 1
copies built packages into ${FTP_PACKAGES}, using
d335 1
a335 1
copies built packages into ${CDROM_PACKAGES}, using
d434 5
d472 1
a561 11
.It Ev BIN_PACKAGES
User settings.
If set to
.Sq Yes ,
the
.Ar package
target will trust a package built in the repository to be up-to-date,
and will not rebuild it if the work directory is absent.
See also
.Ev BULK ,
.Ev TRUST_PACKAGES .
a609 1
.Ev BIN_PACKAGES ,
a637 5
.It Ev CDROM_PACKAGES
User settings.
Base location where packages suitable for a CD-ROM (see
PERMIT_PACKAGE_CDROM) will be placed
(default: ${PKGREPOSITORYBASE}/cdrom)
d932 2
a933 1
${PKG_PATH}.
a967 5
.It Ev FTP_PACKAGES
User settings.
Base location where packages suitable for ftp (see
PERMIT_PACKAGE_FTP) will be placed
(default: ${PKGREPOSITORYBASE}/ftp)
d1202 7
d1302 10
a1320 6
.It Ev PKGREPOSITORY
User settings.
Location for packages built (default ${PKGREPOSITORYBASE}/all)
.It Ev PKGREPOSITORYBASE
User settings.
Base location for packages built (default ${PORTSDIR}/packages/${ARCH}).
a1576 1
.Ev BIN_PACKAGES ,
d1742 9
a1750 1
Default setup of ${CDROM_PACKAGES}.
d1752 1
a1752 3
Default setup of ${FTP_PACKAGES}.
.It Pa ${PORTSDIR}/packages/${MACHINE_ARCH}/all
Default setup of ${PKGREPOSITORY}.
d1811 5
d1822 6
d1860 7
d2003 8
a2010 10
.It Ev PERMIT_{DISTFILES,PACKAGE}_{CDROM,FTP}
Set to
.Sq Yes
if package or distribution files can be allowed on ftp sites or CD-ROM without
legal issues.
Set to reason not to otherwise.
PERMIT_* lines in the Makefile should be preceded with a comment explaining
details about licensing and patents issues the port may have.
Porters must be very thorough in their checks.
In case of doubt, ask.
@


1.173
log
@document peek-ftp
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.172 2006/01/07 15:24:31 jmc Exp $
d1823 1
a1823 1
It is not recommended to try to access them directly.
@


1.172
log
@kill trailing whitespace;
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.171 2006/01/07 11:37:58 espie Exp $
d377 4
@


1.171
log
@remove description of MODGNU_SHARED_LIBS, explain that SHARED_LIBS +
USE_LIBTOOL should be enough for libtool-using port.
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.170 2005/12/29 09:55:18 jmc Exp $
d1484 1
a1484 1
and make sure 
@


1.170
log
@whitespace and wording;
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.169 2005/12/28 12:20:26 espie Exp $
a1114 17
.It Ev MODGNU_SHARED_LIBS
Available if
.Ev CONFIGURE_STYLE
is gnu (or better).
Set to a list of the form
.Sq libname
.Sq extra-options .
This sets the variable
.Ev lib<libname>_la_LDFLAGS
to the correct invocation for libtool version numbering, based on
.Ev SHARED_LIBS.
For instance, with
SHARED_LIBS=foo 3.5,
MODGNU_SHARED_LIBS=foo '-no-undefined',
then
libfoo_la_LDFLAGS will be set to
libfoo_la_LDFLAGS=-version-info 3:5:0 -no-undefined.
d1482 6
a1487 3
See also
.Ev MODGNU_SHARED_LIBS
for libtool-based ports.
@


1.169
log
@Document basic SHARED_LIBS/MODGNU_SHARED_LIBS
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.168 2005/11/19 09:32:47 sturm Exp $
d1131 1
a1131 1
libfoo_la_LDFLAGS=-version-info 3:5:0 -no-undefined
d1483 1
a1483 1
.Sq libname 
d1489 1
a1489 1
The porter is responsible to make sure the port uses those version numbers 
d1496 1
a1496 1
the system, or simply because the third party programmers do not understand 
@


1.168
log
@mention port specific systrace.policy file
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.167 2005/11/04 10:49:53 espie Exp $
d1115 17
d1481 21
@


1.167
log
@document FETCH_PACKAGES. common work with sturm@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.166 2005/11/01 14:09:33 espie Exp $
d1732 2
@


1.166
log
@document show-required-by
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.165 2005/09/12 22:14:22 espie Exp $
d929 9
@


1.165
log
@frame -> fake.
almost everything is actually documented now.
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.164 2005/09/06 22:21:03 jmc Exp $
d423 4
@


1.164
log
@remove trailing whitespace;
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.163 2005/09/04 22:35:48 espie Exp $
d46 1
a46 3
This is not quite complete; a few variables and targets are not yet documented.
Mostly because undocumented stuff has fuzzy semantics, and it hasn't been
decided yet how to define it.
d52 1
a52 1
There is a separate section covering the frame framework, a section
@


1.163
log
@Document PKGNAMES, print-package-signature, PLIST_DB.
Fix a few minor errors.
Synch history with reality more.
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.162 2005/07/26 19:43:07 jmc Exp $
d2298 1
a2298 1
New features have been carefully introduced, trying hard to avoid 
@


1.162
log
@setup(n.) is one word; set up(v.) is two;
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.161 2005/07/26 16:53:52 fgsch Exp $
d286 2
d379 4
d1336 10
d1352 5
d1762 1
a1762 1
.It Ar print-run-depends
d2263 12
d2294 1
a2294 1
over the years.
d2296 4
a2299 2
When the file grew too large, it was cleaned up to restore some of
its speed and remove a lot of bugs.
d2304 1
@


1.161
log
@${PKGDIR}/COMMENT has been moved long ago to the COMMENT variable.  espie@@ ok.
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.160 2005/06/10 23:14:26 mjc Exp $
d670 1
a670 1
Same as COMMENT but used for sub package foo in a multi-package set up.
@


1.160
log
@too much cut and paste.
ok pvalchev@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.159 2005/03/14 15:31:04 jmc Exp $
d667 2
a668 1
Comment used for the package, and in the INDEX.
d670 1
a670 1
Comment used for sub package foo in a multi-package set up.
d672 2
a673 2
Comment used for a flavored package, if the non-flavored comment is
inappropriate.
d675 1
a675 1
Comment used for a sub-, flavored package.
a1676 6
.It Pa ${PKGDIR}/COMMENT
Short, one line description of the port, that is displayed by
.Xr pkg_info 1 ,
and appears in
.Pa ${PORTSDIR}/INDEX .
Name will be adjusted for flavored and multi-packages ports.
d1994 2
@


1.159
log
@whitespace;
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.158 2005/03/14 11:03:04 espie Exp $
d1533 1
a1533 1
.Pa ${PORTSDIR}/bulk/${MACHINE_ARCH} .
@


1.158
log
@document WANTLIB absolute paths.
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.157 2005/03/11 23:03:58 jmc Exp $
d1581 2
a1582 2
As a special extension, 
.Ev WANTLIB 
@


1.157
log
@cdrom/CDROM -> CD-ROM;
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.156 2004/12/02 21:55:23 jmc Exp $
d1580 7
@


1.156
log
@- fix SEE ALSO
- whitespace
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.155 2004/12/02 21:52:58 jmc Exp $
d631 1
a631 1
Base location where packages suitable for a CDROM (see
d1920 1
a1920 1
if package or distribution files can be allowed on ftp sites or cdrom without
@


1.155
log
@gnu -> GNU;

from michael knudsen;
ok espie@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.154 2004/11/27 10:01:54 espie Exp $
d52 1
a52 1
followed by sections on obsolete constructs that a porter may need 
d55 1
a55 1
explaining flavors and multi-packages, and a section covering 
d58 1
a58 1
Selected common user activity such as the building of every package in 
d449 1
a449 1
and update it using 
d2170 2
a2171 2
Generate the actual DESCR, and if needed, MESSAGE, UNMESSAGE, 
REQ, INSTALL, DEINSTALL from the templates in ${DESCR}, ${MESSAGE}, 
d2180 1
a2180 1
by inserting shared/no-shared fragments, merging other fragments, 
d2246 1
a2247 1
.Xr pkg_add 1 ,
d2250 2
a2251 2
.Xr packages-specs 7
.Xr ports 7 .
@


1.154
log
@document WANTLIB
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.153 2004/11/17 11:01:55 espie Exp $
d685 1
a685 1
gnu-style configure, where prefix and sysconfdir are set.
d688 1
a688 1
gnu-style configure adds a lot more variables.
d716 1
a716 1
gnu configure style.
d743 1
a743 1
there is a configure script, but it does not fit the normal gnu configure
d972 1
a972 1
Location of the gnu make binary, if needed.
d1419 1
a1419 1
Many gnu configure ports can be built in a directory distinct from the
d1539 1
a1539 1
if gnu make (${GMAKE}) is needed for correct behavior of this port.
d1639 2
a1640 2
Name of yacc program to pass to gnu-configure, defaults to yacc.
(gnu-configure would always try to use bison otherwise, which leads to
@


1.153
log
@Add a small TOC description to the synopsis, since people may not read
long enough to find out about fake, or flavors.
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.152 2004/11/17 10:51:37 espie Exp $
d1577 3
@


1.152
log
@document the update paraphernalia, even though it's still experimental.
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.151 2004/10/11 10:41:16 espie Exp $
d49 13
d2243 1
d2246 1
d2248 1
@


1.151
log
@respect alphabetical order better.
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.150 2004/10/11 10:34:56 espie Exp $
d432 12
d930 10
d1517 6
d1673 2
@


1.150
log
@full documentation for UNMESSAGE
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.149 2004/09/19 09:00:51 pvalchev Exp $
a515 7
.It Ev BROKEN
Define only for broken ports, set to reason the port is broken.
See also
.Ev NO_IGNORE .
.It Ev BSD_INSTALL_{PROGRAM,SCRIPT,DATA,MAN}[_DIR]
Macros passed to make and configure invocations.
Set based on corresponding INSTALL_* variables.
d527 7
a719 3
.It Ev MODGNU_CONFIG_GUESS_DIRS
If a port uses config.guess outside WRKSRC, the directories
containing the other copies must be set here.
d923 3
a940 21
.It Ev LIB_DEPENDS
Libraries this port depends upon.
Each item has the form
.Sq lib_specs:[pkgspec]:directory[,-subpackage][,flavor ...][:target] .
Similar to BUILD_DEPENDS, except for
.Sq lib_specs ,
which is a comma-separated list of
.Sq lib_spec
of the form:
.Sq libname.[version.[subversion]] .
See
.Xr library-specs 7
for more details.
.Pp
On architectures that use dynamic libraries,
.Ev LIB_DEPENDS
is also used as a run-time dependency, and recorded in the package as
such.
.It Ev FULLDISTDIR
Complete path to directory where ${DISTFILES} and ${PATCHFILES} will be
located, to be used in hand-crafted extraction targets (read-only).
d981 18
d1082 3
d1495 41
a1587 41
.It Ev USE_GMAKE
Set to
.Sq Yes
if gnu make (${GMAKE}) is needed for correct behavior of this port.
.It Ev USE_LIBTOOL
Set to
.Sq Yes
if libtool is required for correct behavior of this port.
Adds correct dependencies, and passes LIBTOOL environment variable to
scripts invocations.
.It Ev USE_MOTIF
Set to
.Sq any
if port works with any version of motif;
.Sq lesstif
if port requires lesstif to work;
.Sq openmotif
if ports requires openmotif to work.
The
.Sq any
setting creates an extra flavor choice of
.Sq lesstif .
See also
.Ev MOTIFLIB
.It Ev USE_SYSTRACE
Set to
.Sq Yes
to protect port building with systrace.
Set by the user, e.g. in
.Pa /etc/mk.conf .
.It Ev USE_X11
Set to
.Sq Yes
if port requires X11 to work.
.It Ev VMEM_WARNING
Set to
.Sq Yes
if the port requires a lot of memory to compile, and the user is
likely to see a message like
.Qq virtual memory exhausted
with the default process limits.
@


1.149
log
@document CDROM_SITE defaults to empty and what to set it to; ok espie
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.148 2004/09/16 20:04:22 espie Exp $
d1489 4
d2118 1
a2118 1
Set ${PLIST}, ${DESCR}, ${COMMENT}, ${MESSAGE} accordingly.
d2124 3
a2126 2
Generate the actual DESCR, and if needed, MESSAGE, REQ, INSTALL, DEINSTALL
from the templates in ${DESCR}, ${MESSAGE}, ${PKGDIR}/REQ${SUBPACKAGE},
d2193 2
a2194 2
templates for each SUBPACKAGE (and optional distinct MESSAGE, REQ, INSTALL,
DEINSTALL files in a similar way).
@


1.148
log
@document WRKCONF.
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.147 2004/09/15 19:05:29 espie Exp $
d613 3
a615 3
Defaults to
.Pa /cdrom/distfiles .
Set to empty to avoid checking any path.
@


1.147
log
@document that SED_PLIST is dead, explain about fragments/substitutions.
Document that DYNLIBDIR/NEWDYNLIBDIR is dead, and that libs must be
explicitly marked.
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.146 2004/08/03 08:05:05 espie Exp $
d1507 3
@


1.146
log
@document SHARED_ONLY
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.145 2004/07/20 10:31:21 jmc Exp $
a306 1
.Ev SED_PLIST ,
a1379 7
.It Ev SED_PLIST
Pipeline of commands used to create the actual packing list from the
PLIST template (usually ${PKGDIR}/PLIST).
.Nm
appends to it substitution commands corresponding to the port's
FLAVOR and variables from SUBST_VARS.
${SED_PLIST} is invoked as a pipeline after inserting PFRAG.shared fragments.
d1907 4
d2126 2
a2127 4
by inserting shared/no-shared fragments, applying a possible user-supplied
pipeline, merging other fragments, applying the same variable
substitutions as other packing information, and finally handling
dynamic libraries macros.
d2155 6
a2160 2
Fragments that cannot be handled by these simple rules
can always be specified in a custom SED_PLIST.
d2162 8
a2169 14
The constructs
.Li "DYNLIBDIR(directory)"
and
.Li "NEWDYNLIBDIR(directory)"
should be used in
.Pa ${PKGDIR}/PFRAG.shared${SUBPACKAGE}
to register directories that hold dynamic libraries (see
.Xr ldconfig 8 ) .
.Li "NEWDYNLIBDIR"
is meant for directories that will go away when the package is deleted.
If possible, it should not be used, because users also have to edit
.Pa rc.conf
to add the directory.
It is usually better to also let libraries be visible as a link
d2174 1
a2174 1
Note that libraries used only for
d2176 2
a2177 1
do not need NEWDYNLIBDIR.
@


1.145
log
@whitespace;
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.144 2004/07/20 05:44:34 espie Exp $
d1404 4
@


1.144
log
@Document locking infrastructure
ok naddy@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.143 2004/07/11 20:46:32 espie Exp $
d1020 1
a1020 1
This lock will reside in 
d1491 1
a1491 1
This lock will reside in 
@


1.143
log
@obsolete IGNOREFILES
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.142 2004/06/28 18:14:11 sturm Exp $
d1013 11
d1488 5
@


1.142
log
@better NO_REGRESS description

ok naddy
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.141 2004/06/20 20:02:28 xsa Exp $
d119 2
a120 4
Normally ${ALLFILES}
are checksummed, unless
.Ev IGNOREFILES
is set to a list of files to ignore.
d293 1
a293 2
cryptographic fingerprints sha1, md5 and rmd160 on ${ALLFILES} minus
${IGNOREFILES}.
a941 5
.It Ev IGNOREFILES
Set to the list of files that cannot be checksummed.
For use by ports which
fetch dynamically generated archives that can't be checksummed.
Avoid using IGNOREFILES whenever possible.
d1727 4
@


1.141
log
@
bye bye gdiff(1)...
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.140 2004/06/06 21:54:59 jmc Exp $
d1126 1
a1126 1
Port does not have any regression tests.
@


1.140
log
@kill double space;
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.139 2004/06/06 20:45:36 xsa Exp $
d417 1
a417 1
.Xr gdiff 1
@


1.139
log
@
`update-patches' uses gdiff(1) now for quite some time now,
not diff(1) anymore;
noticed by Rodolfo Gouveia <wolfshade boo netmadeira baa com>
okay espie@@.
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.138 2004/06/06 11:49:39 espie Exp $
d1366 1
a1366 1
to make sure that all Makefile.in  are up-to-date.
@


1.138
log
@document REORDER_DEPENDENCIES
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.137 2004/05/27 09:12:21 jmc Exp $
d417 1
a417 1
.Xr diff 1
@


1.137
log
@kill whitespace;
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.136 2004/05/26 11:22:25 msf Exp $
d363 5
d1354 16
@


1.136
log
@
Document 'perl modbuild' style for p5-Module-Build

ok sturm@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.135 2004/05/16 23:14:55 pvalchev Exp $
d683 1
a683 1
to enable 
@


1.135
log
@document LP64_ARCHS
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.134 2004/02/18 13:39:02 xsa Exp $
d680 6
@


1.134
log
@
sync the list of variables held in SUBST_VARS;
ok espie@@.
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.133 2004/02/08 08:20:17 jmc Exp $
d1010 4
@


1.133
log
@kill whitespace at EOL;
new sentence, new line;
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.132 2004/02/07 22:43:48 espie Exp $
d1379 1
d1381 2
@


1.132
log
@document per-${PKGPATH} settings.
document that WRKOBJDIR is always defined, but can be left empty now.
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.131 2004/02/07 22:05:53 espie Exp $
d400 1
a400 1
Invoked as make show="name1 name2 ...", 
d472 1
a472 1
Invoked as make show="name1 name2 ...", show the contents of 
d1069 2
a1070 1
Read-only.  Correct incantation to link with motif.
@


1.131
log
@document new show=name1 name2...
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.130 2004/01/28 22:09:10 espie Exp $
d569 3
d587 2
d638 2
d867 1
a867 1
If defined, used as a base for the fake area.
d869 3
d1494 1
a1494 1
If defined, used as a base for the actual port working directory.
d1496 3
@


1.130
log
@be explicit about fake hooks.
prompted by Sam Smith...
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.129 2004/01/22 21:32:43 espie Exp $
d399 4
a402 1
Invoked as show=name, show the contents of ${name}.
d471 4
a474 1
Invoked as make show=name, show the contents of variable name.
@


1.129
log
@document PKG_ARCH
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.128 2004/01/18 07:55:34 sturm Exp $
d207 12
d602 2
a603 2
.Pa /cdrom/distfiles
if this path exists.
@


1.128
log
@document port specific systrace.filter
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.127 2004/01/12 05:42:47 jolan Exp $
d1204 4
@


1.127
log
@FILESDIR no longer holds "at least the checksum file"

from Andrew Dalgleish
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.126 2004/01/04 10:00:22 jolan Exp $
d1569 2
@


1.126
log
@typo
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.125 2003/10/26 15:11:47 jmc Exp $
a871 1
Holds at least the checksum file, sometimes other files
@


1.125
log
@typos from Jared Yanovich;
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.124 2003/09/18 09:49:43 jmc Exp $
d1510 1
a1510 1
Defaults to xmkf -a -DPorts.
@


1.124
log
@typos from Aleksander Piotrowski;
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.123 2003/09/09 15:37:39 espie Exp $
d706 1
a706 1
User setttings.
d911 1
a911 1
Avoid using IGNOREFILES whenver possible.
@


1.123
log
@synch with reality.
ok deraadt@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.122 2003/09/03 09:10:30 jmc Exp $
d951 2
a952 2
Macros to use to install a program, a script, a man page, or data (or the
corresponding directory, respectively).
@


1.122
log
@- remove trailing whitespace
- fix an .Ar macro with too many args
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.121 2003/08/21 20:24:12 espie Exp $
d266 1
a266 1
.It Ar licence-check
@


1.121
log
@Document FAKEOBJDIR
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.120 2003/08/15 00:10:01 espie Exp $
d52 1
a52 1
Print all dependencies for a port in order to build it, run it, 
d58 1
a58 1
Print all dependencies a package depends upon for building, running, 
d269 1
a269 1
settings match: 
d1364 1
a1364 1
.Xr mk.conf ,
d1607 1
a1607 1
Renamed into 
@


1.120
log
@Document PORTSDIR_PATH
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.119 2003/08/11 20:14:35 espie Exp $
d841 3
@


1.119
log
@document license-check
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.118 2003/08/04 14:03:17 espie Exp $
d1224 6
d1564 3
a1566 1
All depend targets will look there after the normal lookup fails.
@


1.118
log
@document readmes and clean=readmes
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.117 2003/07/31 11:11:02 espie Exp $
d266 8
@


1.117
log
@Document more stuff:
{build,run,all}-dir-depends,
full-{build,run,all}-depends,
{build,lib,run}-depends-list,
print-{build,run}-depends,
build-depends, clean-depends, depends, lib-depends, regress-depends,
run-depends.
And obsolete: depends-list, print-depends, print-depends-list,
print-package-depends.

Almost everything is documented now.
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.116 2003/07/28 20:02:44 sturm Exp $
d151 4
d343 3
d1390 1
a1390 1
.Ar readme
@


1.116
log
@remove some withespace at EOL

noticed by jmc@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.115 2003/07/28 17:37:10 sturm Exp $
d51 16
d104 6
d160 2
d169 6
d253 3
a338 2
.It Ar print-depends
Print all dependencies for the given port.
d356 5
d365 6
a599 1
Note that distclean never recurses down to dependencies.
d1551 3
d1574 12
@


1.115
log
@document systrace related variables

espie@@ ok
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.114 2003/07/25 12:54:42 espie Exp $
d713 1
a713 1
Optional subdirectory of ${DISTDIR} where the current port's distribution 
d947 1
a947 1
List of primary location from which distribution files and patchfiles are 
d956 1
a956 1
Supplementary locations from which distribution files and patchfiles are 
d1019 1
a1019 1
Use, for instance, for fetching all distribution files, or for fixing a 
d1307 1
a1307 1
should hold a list of all distribution files and patchfiles that are not 
d1706 1
a1706 1
if package or distribution files can be allowed on ftp sites or cdrom without 
@


1.114
log
@Document FETCH_MANUALLY
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.113 2003/07/23 12:46:29 espie Exp $
d1036 2
d1325 13
d1426 6
@


1.113
log
@explain status of WRKDIST better (Olivier Cherrier)
Spell out `distribution files' instead of `distfiles' everywhere.
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.112 2003/07/18 18:35:11 espie Exp $
d208 1
d791 13
a803 3
.It Ev FETCH_DEPENDS
See BUILD_DEPENDS for specification.
Fetch dependencies are checked at the beginning of the extract stage.
d1547 3
@


1.112
log
@Document changes in the package repository area: no more
ftp-packages/cdrom-packages.
Renaming of files.
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.111 2003/07/18 18:23:18 espie Exp $
d124 1
a124 1
Clean distfiles.
d158 2
a159 2
Extract the distfiles under
.Pa ${WRKDIST}
d175 1
a175 1
Fetch the distfiles and patchfiles, using ${FETCH_CMD}.
d669 1
a669 1
Directory where all ports distfiles and patchfiles are stashed.
d672 1
a672 1
Override if distfiles are stored elsewhere.
d675 1
a675 1
to refer to ports' distfiles location, as it takes an eventual
d712 2
a713 2
Optional subdirectory of ${DISTDIR} where the current port's distfiles
and patchfiles will be located.
d785 1
a785 1
Command used to fetch distfiles for this port.
d936 2
a937 1
List of primary location from which distfiles and patchfiles are retrieved.
d945 2
a946 1
Supplementary locations from which distfiles and patchfiles are retrieved.
d1008 2
a1009 1
Use, for instance, for fetching all distfiles, or for fixing a broken port.
d1294 2
a1295 2
should hold a list of all distfiles and patchfiles that are not always
needed, so that a mirror will be able to grab all files, or that
d1355 1
a1355 1
Subdirectory of ${WRKDIR} where the source is normally unpacked.
d1671 2
a1672 2
if package or distfiles can be allowed on ftp sites or cdrom without legal
issues.
@


1.111
log
@document old RESTRICTED, CAT/MAN stuff.
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.110 2003/07/15 10:52:19 espie Exp $
a87 7
.It Ar cdrom-packages
If ${PERMIT_PACKAGE_CDROM} is set to
.Sq Yes ,
copies built packages into ${CDROM_PACKAGES}, using
hard links if possible.
See also
.Ev BULK .
d128 1
a128 1
Remove package file.
a215 7
.It Ar ftp-packages
If ${PERMIT_PACKAGE_FTP} is set to
.Sq Yes ,
copies built packages into ${FTP_PACKAGES}, using
hard links if possible.
See also
.Ev BULK .
d259 8
d492 1
a492 3
.Ar ftp-packages ,
.Ar cdrom-packages ,
and any other targets mentioned in BULK_TARGETS.
d507 1
a507 3
Defaults to
.Ar ftp-packages ,
.Ar cdrom-packages .
d526 1
a526 1
(default: ${PORTSDIR}/cdrom-packages/${ARCH})
d821 1
a821 1
(default: ${PORTSDIR}/ftp-packages/${ARCH})
a1033 2
.It Ev PACKAGES
Base location for packages built (default: ${PORTSDIR}/packages/${ARCH}).
d1135 6
d1457 1
a1457 1
.It Pa ${PORTSDIR}/cdrom-packages/${MACHINE_ARCH}
d1459 1
a1459 1
.It Pa ${PORTSDIR}/ftp-packages/${MACHINE_ARCH}
d1461 2
d1471 4
d1640 3
@


1.110
log
@Document cdrom-packages, ftp-packages, MOTIF_LIB, a few locations.
Add a few more `user settings'.
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.109 2003/07/14 23:47:17 espie Exp $
d1494 1
a1494 1
has become a no-operation.
d1498 6
d1544 6
d1699 6
@


1.109
log
@mark a few more variables as user settings.
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.108 2003/07/14 18:51:37 jmc Exp $
d88 7
d223 7
d506 1
d533 1
d828 1
d979 2
d1401 2
d1463 9
@


1.108
log
@some macro fixes;
ok espie@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.107 2003/07/14 14:09:24 espie Exp $
d439 1
d479 1
d711 1
d788 1
d986 1
d993 1
d1179 1
@


1.107
log
@document HAVE_MOTIF (obsolete), SUDO. Fix alphabetical ordering again.
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.106 2003/07/14 13:58:15 espie Exp $
d168 1
a168 1
.Ev do-extract 
d219 2
a220 2
for the non-intuitive details of the way 
.Ar {pre,do,post}-install 
d247 1
a247 1
.Ev MULTI_PACKAGES 
d253 1
a253 1
.Ev SUBST_VARS 
d257 2
a258 1
.Ev MULTI_PACKAGES list.
d277 1
a277 1
.Ar distpatch 
d318 1
a318 1
.It AR repackage
d385 2
a386 2
and that some variables are marked as 
.Sq read-only , 
d425 2
a426 2
.Sq Yes 
to avoid ports that require user-interaction 
d430 1
a430 3
.Po 
See IGNORE
.Pc .
d513 2
a514 1
.Ev WARNINGS is set.
d635 2
a636 1
.Ev WARNINGS is set.
d663 1
a663 1
.Pa ${PORTSDIR}/distfiles.
d707 1
a707 1
.Ar fetch.
d930 1
a930 1
.Xr ports 7 
d1021 1
a1021 1
.it Ev PACKAGING
d1621 2
a1622 1
Porters must be very thorough in their checks. In case of doubt, ask.
d1716 1
a1716 1
target is used to install the port in a private directory first, ready for 
@


1.106
log
@Recognize that documentation is coming along.
Document package, install.
Add some more Xrefs.
Nail down fake/package/install semantics more precisely.
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.105 2003/07/14 13:48:48 espie Exp $
d1257 8
d1485 4
d1497 3
a1499 4
.It Ev FETCH_BEFORE_ARGS , Ev FETCH_AFTER_ARGS
Set
.Ev FETCH_CMD
to point to a script that does any required special treatment instead.
@


1.105
log
@Document pre-extract/do-extract DO NOT use.
Document link-categories, unlink-categories, reinstall, repackage.
Obsolete: FETCH_BEFORE_ARGS, FETCH_AFTER_ARGS, NO_DESCRIBE, NO_PACKAGE.
Fix alphabetical ordering of USE_BZIP2 and USE_ZIP.
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.104 2003/07/12 16:19:50 espie Exp $
d46 1
a46 1
This is still incomplete; some variables and targets are not yet documented.
d217 1
a217 1
Install the port after building.
d219 3
a221 2
for the non-intuitive details of the way it is actually used by
the ports tree.
d245 13
d315 1
a315 1
.it Ar reinstall
d777 1
a777 1
.Pa /usr/bin/ftp .
d1703 4
a1706 3
target is used to install the port in a private directory first, package
that false installation, so that the real installation will use the
package.
d1920 2
@


1.104
log
@alphabetical sort is cool.
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.103 2003/07/12 16:17:11 espie Exp $
d165 5
d227 7
d301 4
d309 5
a1462 8
.It Ev USE_BZIP2
The framework will automatically detect the presence of
.Pa .tar.bz2
files to extract.
.It Ev USE_ZIP
The framework will automatically detect the presence of
.Pa .zip
files to extract.
d1471 4
d1520 2
d1539 2
d1627 4
d1635 4
@


1.103
log
@clean and thorough description of distpatch/patch.
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.102 2003/07/12 16:09:10 espie Exp $
d293 21
a343 21
.It Ar update-patches
Create or update patches for a port, using
.Xr diff 1
between
.Pa file
and
.Pa file.orig ,
based on
.Pa file.orig
existence.
In order to generate a patch, the original file needs to be named
.Pa file.orig
and
.Pa file
edited.
After the target is invoked, the patches are placed under the
patches/ directory.
It moves existing patches from
.Pa patch-file
to
.Pa patch-file.orig
@


1.102
log
@Document pre,do,post hooks.
Document describe, distclean, install.
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.101 2003/07/12 15:46:21 espie Exp $
d152 1
a152 6
.It Ar do-patch
Override for the default behavior of
.Ar patch .
It is usually better to override
.Ar post-patch ,
as
d154 3
a156 3
needs to invoke
.Ar distpatch
directly for historical reasons.
d249 3
a251 2
target recurses through
.Ar distpatch
d258 6
a263 3
See
.Ar distpatch
for the distribution patches-specific description.
@


1.101
log
@Document INTERACTIVE, HOMEPAGE, FULLPKGPATH.
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.100 2003/07/12 15:36:24 espie Exp $
d51 24
d145 5
d216 5
@


1.100
log
@remove the description of concurrent from SEPARATE_BUILD, this is only
confusing, and not used yet anyways.
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.99 2003/07/12 15:35:11 espie Exp $
d358 3
d748 4
d755 2
d807 8
@


1.99
log
@Document CDIAGFLAGS, CXXDIAGFLAGS, CXXFLAGS, DESTDIR, FAKE_TARGET.

More internal xrefs and user settings marked as such.
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.98 2003/07/12 12:46:44 espie Exp $
a1147 4
Set to
.Sq concurrent
if the build process does not modify anything under ${WRKSRC}.
The build process can then be run concurrently on different architectures.
@


1.98
log
@Distinguish some User settings variables.

Document and cross-reference more thoroughly:
FETCH_CMD, NO_CHECKSUM, BATCH, IGNORE, BROKEN, MASTER_SITES,
NO_IGNORE, PACKAGING, PKG_DBDIR, VARNAME, PERMIT_*.

Be more forceful in explaining the risks of NO_CHECKSUM and PERMIT_*.

Explain the role of FETCH_CMD better.
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.97 2003/07/09 20:23:34 jmc Exp $
d439 5
d464 2
a465 1
.Ev COPTS .
d556 1
d560 8
d569 1
d578 3
d700 3
d1205 1
d1207 1
d1217 12
@


1.97
log
@fix some lists and some typos;
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.96 2003/07/09 10:37:51 espie Exp $
d83 2
d146 1
a146 1
Fetch the distfiles and patchfiles.
d178 1
d197 2
d313 6
d353 12
d685 2
a686 1
No current port overrides the default.
d730 1
d753 16
a768 2
The port is ignored if set to
.Sq Yes .
d816 10
a854 1
.Pp
d861 12
d879 7
d913 3
d1009 5
d1203 1
a1203 1
cd that_port_dir && make show VARNAME=WRKDIR for this.
d1484 9
d1528 2
@


1.96
log
@Better formulation for USE_BZIP2/USE_ZIP.
Add SYSCONFDIR to the list of variables not heeded consistently.
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.95 2003/07/09 06:05:08 pvalchev Exp $
d605 1
a605 1
.Bd -literal -indent
d617 1
a617 1
.Bd -literal -indent
d876 1
a876 1
.Bd -literal -indent
d1524 4
a1527 4
.Bd -literal -indent offset
    env -i ${MAKE_ENV}
    PREFIX=${WRKINST}${PREFIX} ${DESTDIRNAME}=${WRKINST} TRUEPREFIX=${PREFIX}
    ${MAKE_PROGRAM} ${FAKE_FLAGS} -f ${MAKE_FILE} ${FAKE_TARGET}
d1554 8
a1561 8
.Bd -literal
    FLAVOR?=
    .if ${FLAVOR:L:Moption1}
    # what to do if option1
    .endif
    .if ${FLAVOR:L:Moption2}
    # what to do if option2
    .endif
d1661 1
a1661 1
.br
@


1.95
log
@mention maintainer is now recorded in description
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.94 2003/07/05 21:50:35 pvalchev Exp $
d1286 3
a1288 5
Use
.Ev EXTRACT_SUFX
or
.Ev EXTRACT_CASES
instead.
d1290 3
a1292 5
Use
.Ev EXTRACT_SUFX
or
.Ev EXTRACT_CASES
instead.
d1727 2
a1728 1
.Ev X11BASE
@


1.94
log
@fix inaccuracy in obsolete NO_CONFIGURE variable description
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.93 2003/07/01 10:00:29 jmc Exp $
d1219 1
a1219 1
Variables such as ${HOMEPAGE} will be expanded
@


1.93
log
@one more correction to a list, and add a .Pp;
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.92 2003/06/30 18:44:41 jmc Exp $
d1348 1
a1348 1
If ${FILESDIR}/configure does not exist, no automatic configuration will
@


1.92
log
@simplify a list, better format example;
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.91 2003/06/30 12:18:37 espie Exp $
d240 1
a240 3
env -i ${MAKE_ENV} ${MAKE_PROGRAM} ${REGRESS_FLAGS} \\
.Ed
.Bd -literal
d243 1
@


1.91
log
@update-plist handles multi-packages correctly, now.
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.90 2003/06/06 13:28:13 jmc Exp $
d61 1
a61 3
env -i ${MAKE_ENV} ${MAKE_PROGRAM} ${MAKE_FLAGS} \\
.Ed
.Bd -literal
@


1.90
log
@- section reorder
- macro fixes
- kill whitespace at EOL
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.89 2003/04/14 22:29:46 pvalchev Exp $
d287 1
a287 1
does not handle multi-packages nor flavor situations yet, so beware.
@


1.89
log
@document update-plist only, since "plist" target is the same thing,
remove useless references to it; hinted by espie
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.88 2003/04/03 07:56:28 jmc Exp $
d86 1
a86 1
Clean ports contents. 
d88 1
a88 1
It can be invoked as 
d262 1
a262 1
should produce mostly correct 
d337 2
a338 2
Setting 
.Ev AUTOCONF_VERSION 
d351 1
a351 1
the 
d367 1
a367 1
used to be a file to check. 
d381 4
a384 3
Build dependencies that are not the default 
.Ar package or 
.Ar install 
d388 1
a388 1
If set to 
d391 1
a391 1
their working directories, after invoking 
d406 1
a406 1
Targets to run after each bulk package build before cleaning up the 
d465 3
a467 1
If the current OpenBSD version is >= this version then a notice
d484 1
a484 1
Should be appended to CONFIGURE_ARGS, for ports that build dynamic libraries 
d504 1
a504 1
.Ev DESTDIRNAME 
d546 1
a546 1
directories and needs to be configured with 
d719 1
a719 1
See 
d766 2
a767 2
Flags used for all make invocations, except for the 
.Ar fake 
d770 1
a770 1
and for the regress stage, which uses 
d858 1
a858 1
to re-generate 
d863 2
a864 2
For a port that already contains 
.Pa .orig 
d932 1
a932 1
Note that 
d978 1
a978 1
Usually ${LOCALBASE}, though some ports may elect a location under 
d986 1
a986 1
FLAVOR=no_gnome make package 
d996 1
a996 1
checksum off 
d1002 1
a1002 1
.Ev BUILD_DEPENDS 
d1016 1
a1016 1
except for 
d1018 2
a1019 2
and 
.Sq gnu 
d1021 1
a1021 1
which default to 
d1175 1
a1175 1
setting creates an extra flavor choice of 
d1182 2
a1183 2
Set to 
.Sq Yes 
d1185 1
a1185 1
likely to see a message like 
d1316 1
a1316 1
Contents were used to replace 
d1318 1
a1318 1
in all 
d1326 2
a1327 2
construct is now used instead 
.Po 
d1329 1
a1329 1
.Nx 
d1399 1
a1399 1
.Ev MASTER_SITES0 , ...,
d1426 1
a1426 1
for 
d1473 1
a1473 1
The current file lives under 
d1475 1
a1475 1
whereas 
d1522 1
a1522 1
important changes: PREFIX is set to ${WRKINST}${PREFIX}, ${DESTDIRNAME} 
d1538 1
a1538 1
If a port's Makefile both heeds ${DESTDIRNAME}, 
d1592 1
a1592 1
In dependency checking and recursive builds, a subpackage can be 
d1615 1
a1615 1
Note that SUBPACKAGE can also be set for dependency checking, so be 
d1691 1
a1691 1
If possible, it should not be used, because users also have to edit 
d1693 2
a1694 2
to add the directory. 
It is usually better to also let libraries be visible as a link 
d1699 1
a1699 1
Note that libraries used only for 
d1714 3
a1716 8
.Sh BUGS AND LIMITATIONS
.Ev LOCALBASE ,
.Ev X11BASE
and
.Ev PREFIX
are not heeded consistently.
Most of the ports tree will probably fall
apart if one tries to build/use stuff elsewhere.
d1732 8
a1739 3
.Sh SEE ALSO
.Xr library-specs 7 ,
.Xr packages-specs 7
@


1.88
log
@CD-Rom, cd-rom -> CD-ROM
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.87 2003/03/22 08:02:03 david Exp $
d784 1
a784 1
.Ar plist
d1701 1
a1701 1
.Ar plist
@


1.87
log
@missing space between macro argument and comma
ok jmc@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.86 2003/03/06 04:03:40 david Exp $
d423 1
a423 1
Path to a local database that holds distribution files (usually a CD-Rom
d1202 1
a1202 1
Default path to a CD-Rom (or other media) full of distribution files.
@


1.86
log
@date should be written formally: .Dd Month day, year
also fixes a few misspellings of the month
ok henning@@ jmc@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.85 2003/02/15 16:43:58 espie Exp $
d271 1
a271 1
.Pa PLIST.orig, 
@


1.85
log
@quick explanation of autoconf changes.
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.84 2003/01/17 17:48:55 millert Exp $
d27 1
a27 1
.Dd June 10 2000
@


1.84
log
@Improve wording a bit; elf(5) was obviously written by a non-native
speaker of English and needs more help.
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.83 2003/01/17 17:36:04 deraadt Exp $
d333 12
@


1.83
log
@more; jmc@@prioris.mini.pw.edu.pl
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.82 2003/01/14 18:19:07 espie Exp $
d82 1
a82 1
will try to fetch a version without mismatched checksums off the
d84 1
a84 1
main archive site.
@


1.82
log
@Document WRKOBJDIR changes
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.81 2002/12/31 16:22:26 miod Exp $
d82 1
a82 1
will try to fetch a version of with mismatched checksums off the
d257 1
a257 1
port's variables without guessing wrong.
d428 1
a428 1
Location for this port checksums, used by
d436 1
a436 1
.Sq Yes
d467 1
a467 1
Set to --enable-shared or --disable-shared, depending whether the
d493 1
a493 1
if port is an older autoconf port, that does not recognize --sysconfdir.
d545 1
a545 1
The main port distribution files (the actual software source, except
a551 1
normally holds a list of files, possibly with :0
d554 1
a554 1
.Sq 0
d556 1
a556 1
.Sq 9
d665 1
a665 1
The port current options.
d710 1
a710 1
is also used as a running time dependency, and recorded in the package as
d936 2
a937 1
Root of the ports tree (default: /usr/ports).
d945 1
a945 1
and ${DISTNAME} for multi-packages ports.
d963 2
a964 1
Usually ${LOCALBASE}, though some ports may elect a location under /var,
d968 1
a968 1
used to control build logic, and e.g., working directories names.
d1119 1
a1119 1
Subdirectory of ${WRKDIR} where the source normally unpacked.
d1148 1
a1148 1
Add correct dependencies, and passes LIBTOOL environment variable to
d1415 1
a1415 1
now holds the package name, not taking multi-packages nor flavors
d1458 5
a1462 2
The current file lives under ${PORTSDIR}/infrastructure/mk/bsd.port.mk,
whereas /usr/share/mk/bsd.port.mk is just a stub.
@


1.81
log
@Prepare for the removal of amiga and sun3 platforms from the tree.
There has not been enough activity and interest towards these platform
to keep them lying in the tree.
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.80 2002/12/31 08:33:52 pvalchev Exp $
d1136 1
a1136 2
The real working directory is created there, and the port ${WRKDIR} is
just a link.
d1235 9
d1368 10
a1717 2
.\"
.\" Todo: OBJMACHINE
@


1.80
log
@document update-patches; help & ok espie
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.79 2002/12/30 02:41:33 espie Exp $
d824 1
a824 1
specific model information (e.g., amiga).
@


1.79
log
@add update-plist
okay pval@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.78 2002/11/25 10:18:24 avsm Exp $
d288 21
@


1.78
log
@succesful -> successful
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.77 2002/11/08 08:08:47 mpech Exp $
d258 30
@


1.77
log
@Time to cleanup:
o) start new sentence on a new line;
o) wrap long lines;
o) don't use .Pp before/after .Sh, .Ss;
o) OpenBSD -> .Ox;
o) typos;
o) close .Rs;
o) use space between arguments in tag, for example:
   .Xr blabla ) .

miod@@ ok
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.76 2002/10/29 08:29:37 pvalchev Exp $
d326 1
a326 1
succesful package builds and installations will clean
d336 1
a336 1
Used to store cookies for succesful bulk-package builds, defaults to
@


1.76
log
@Document IGNORE and COMES_WITH; ok espie
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.75 2002/10/14 09:58:01 pvalchev Exp $
d343 2
a344 1
working directory. Defaults to
d1271 2
a1272 1
needed by a port.  No longer needed as
@


1.75
log
@document USE_X11; from aleksander.piotrowski@@piestrak.waw.pl
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.74 2002/08/29 07:34:31 wcobb Exp $
d397 5
d664 3
@


1.74
log
@- replace empty lines by .Pp where appropriate.
- no empty lines at end of file.
ok mpech@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.73 2002/08/07 15:49:57 avsm Exp $
d1102 4
@


1.73
log
@PSEUDO_FLAVORS, from/ok espie
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.72 2002/07/06 09:30:14 pvalchev Exp $
d912 1
a912 1

@


1.72
log
@Move NEED_VERSION to "obsolete variables" section and describe
briefly what it used to be for.
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.71 2002/06/19 11:40:33 mpech Exp $
d615 2
d905 11
@


1.71
log
@Sync.
#include -> .include

naddy@@, espie@@ ok
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.70 2002/06/05 19:59:02 pvalchev Exp $
a733 7
.It Ev NEED_VERSION
Specific revision of
.Nm
needed by this ports tree.
Usually set to the current version of
.Nm
when port was built, and updated by port maintainers when needed.
d1242 6
@


1.70
log
@document "print-depends" target; ok espie
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.69 2002/05/13 00:45:09 espie Exp $
d34 1
a34 1
.Fd #include <bsd.port.mk>
@


1.69
log
@Document ${SITE:=subdir/}, say goodbye to MASTER_SITE_SUBDIR
Nifty idea, taken from NetBSD
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.68 2002/05/03 15:03:02 espie Exp $
d234 2
@


1.68
log
@md5 -> distinfo rename.
Noticed by Christian Edward Gruber.
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.67 2002/04/24 21:38:36 espie Exp $
d152 1
a152 3
.Ev MASTER_SITES ,
with %SUBDIR% substituted with
.Ev MASTER_SITE_SUBDIR .
d1219 16
@


1.67
log
@Document special rule for build dependencies. More complicated to explain,
simpler to use.
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.66 2002/04/17 17:12:59 espie Exp $
d1125 1
a1125 1
.It Pa ${FILESDIR}/md5
d1327 4
@


1.66
log
@Document bulk package building.

Stress important conditions that should be met for bugs to be avoided.
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.65 2002/04/02 16:03:47 espie Exp $
d317 6
@


1.65
log
@document lib-depends-check and manpages-check
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.64 2002/03/16 00:56:47 espie Exp $
d89 1
a89 1
make clean='[depends work fake flavors dist install sub package packages]'.
d93 2
d285 10
d317 23
d1023 8
d1561 1
a1561 1
do not need NEWDYNLIDIR.
@


1.64
log
@How to enable automake.
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.63 2002/03/02 13:41:02 espie Exp $
d186 6
d196 4
@


1.63
log
@Document PORTHOME.
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.62 2002/02/18 20:57:07 pvalchev Exp $
d389 4
@


1.62
log
@CDROM_SITE, not CDROM_DISTSITE; PR 2213
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.61 2002/02/08 04:30:51 brad Exp $
d818 5
@


1.61
log
@fix example usage of SUBPACKAGE.
--
Based on suggestion from PR# 2381
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.60 2002/01/24 22:36:41 kjell Exp $
d547 1
a547 1
.Ev CDROM_DISTSITE
@


1.60
log
@Xr library-specs(7). ok espie@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.59 2001/12/29 21:44:07 avsm Exp $
d1404 1
a1404 1
Run make package SUBPACKAGE= PACKAGING=,
d1406 1
a1406 1
Run make package SUBPACKAGE=-lib PACKAGING=-lib,
d1408 1
a1408 1
Run make package SUBPACKAGE=-server PACKAGING=-server,
@


1.59
log
@md5 -> distinfo
espie@@ ok
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.58 2001/12/09 05:35:23 pvalchev Exp $
d1538 1
@


1.58
log
@document MODGNU_CONFIG_GUESS_DIRS here, ok espie
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.57 2001/11/17 10:44:28 espie Exp $
d330 1
a330 1
Defaults to ${FILESDIR}/md5.
@


1.57
log
@reference library specs.
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.56 2001/11/11 13:57:31 heko Exp $
d399 3
@


1.56
log
@o Instead of copying the "virtual memory exhausted" warning for each
individual port, introduce a new variable for bsd.port.mk, VMEM_WARNING.
By setting this variable to `Yes', the user is given a warning about the
virtual memory requirements just before the pre-build stage.
o Also give some examples for different shells for what to do about
it, and mention login.conf(5). bash, for example, has a confusing
-v flag to ulimit.
o Document this in bsd.port.mk.5
espie@@ ok
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.55 2001/10/07 11:36:09 espie Exp $
d588 3
a590 1
See BUGS AND LIMITATIONS as well.
a1516 6
.Pp
.Ev LIB_DEPENDS
should only be a BUILD_DEPENDS on architectures without shared libraries.
If a
.Ev RUN_DEPENDS
is needed as well, it should be mentionned explicitly.
@


1.55
log
@Document REGRESS_IS_INTERACTIVE
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.54 2001/10/07 11:03:57 espie Exp $
d1023 7
@


1.54
log
@document REGRESS_FLAGS
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.53 2001/10/05 14:45:54 mpech Exp $
d635 1
a635 1
.Ar REGRESS_FLAGS .
d861 4
@


1.53
log
@Powered by @@mantoya:
o) start new sentence on a new line;
o) minor mdoc fixes;
millert@@ ok

Tip of the day:   www.mpechismazohist.com
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.52 2001/10/04 10:28:20 wilfried Exp $
d230 1
a230 1
env -i ${MAKE_ENV} ${MAKE_PROGRAM} ${MAKE_FLAGS} \\
d630 6
a635 2
Flags used for all make invocations, except for the fake stage, which uses
FAKE_FLAGS.
d849 3
a851 1
checksum off ftp.openbsd.org, in the directory
d854 3
a856 1
See BUILD_DEPENDS for specification.
d858 3
@


1.52
log
@e.g. and i.e. cleanup
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.51 2001/10/03 08:54:28 espie Exp $
d254 2
a255 1
with master site selection extension removed. Read-only.
d851 2
a852 1
Target to run regression tests. Defaults to
d922 2
a923 1
circumstances. For instance, a port might need architecture-specific files.
@


1.51
log
@Document regression testing framework.
Remove wishful thinking about FETCH_DEPENDS, though I would like this
curl vs. ftp issue fixed, darn it.
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.50 2001/09/27 10:37:20 espie Exp $
d1411 1
a1411 1
e.g, if FLAVORS=no_map gfx qt2, if FLAVOR=gfx no_map, this is
@


1.50
log
@Document PATCH_LIST extended behavior.
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.49 2001/09/16 15:27:16 espie Exp $
d226 16
a538 1
No current port uses FETCH_DEPENDS.
d688 2
d846 16
@


1.49
log
@partial documentation for the *_DEPENDS recent changes.
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.48 2001/08/24 15:01:02 espie Exp $
d781 7
@


1.48
log
@Clarify PATCHORIG.
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.47 2001/08/24 14:43:28 todd Exp $
d259 1
a259 3
.Sq file_to_test::directory[,-subpackage][,flavor ...][:target] .
The double :: is designed to allow wedging a package specification in the
near future.
d264 5
a268 5
.Sq file_to_test
is checked against the current path for ports (see PORTPATH), or as an absolute
file name.
The special name /nonexistent can be used to force a build
dependency (see the ghostscript port for an example).
d564 5
a568 3
Similar to BUILD_DEPENDS, except that
.Sq file_to_test
is replaced by a
d1452 4
a1455 2
is automatically both a BUILD_DEPENDS and a RUN_DEPENDS, whereas some
smarter, more intricate mechanism could be designed to minimize dependencies.
@


1.47
log
@implement $PATCHORIG, a variable with the ability to change from .orig to
another suffix for 'update-patches' and 'patch', since there are some
distfiles that have foo and foo.orig already; ok espie@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.46 2001/08/20 05:57:55 mpech Exp $
d703 3
a705 4
Suffix used by using the '-b' option of 
.Xr patch 1
(to determine original file suffix names) created
from ${PATCHDIR}/patch-* and
d707 3
a709 1
which generates the above patches looking for files with this suffix.
d712 4
a715 2
Set this if you have a port that already contains .orig files in the
${DISTFILES} to something else, such as
d717 3
@


1.46
log
@Powered by @@mantoya.
o) fix bogus .Xr usage;

millert@@ ok.
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.45 2001/08/17 11:13:58 mpech Exp $
d702 12
@


1.45
log
@o) {Open,Net,Free}BSD -> .{O,N,F}x;
o) "start sentence on new line" issues;
o) minimal -mdoc improvements;

millert@@ ok
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.44 2001/08/16 14:59:47 espie Exp $
d1398 1
a1398 1
.Xr ldconfig 8 ).
@


1.44
log
@Document new clean behavior.
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.43 2001/08/12 11:47:19 espie Exp $
d82 2
a83 1
will try to fetch a version of with mismatched checksums off the OpenBSD
@


1.43
log
@Document FULLPKGNAME changes.
Document PACKAGING.
Update sub/flavor dependencies explanations.
Semi-deprecate NEWDYNLIBDIR.
Synch make plist description.
Kill HAVE_MOTIF/REQUIRE_MOTIF entirely.
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.42 2001/08/02 14:05:11 espie Exp $
d84 27
d226 1
a226 1
Invoked with VARNAME=name, show the contents of VARNAME.
@


1.42
log
@More DESTDIR -> DESTDIRNAME changes.
Remove AM_MAKEFLAGS setting that has not been there since make handles
recursion posixly.
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.41 2001/07/18 16:20:24 espie Exp $
d524 1
a524 1
Full name of the created package, taking flavors into account.
d748 1
a748 1
Name of the created package.
d750 1
a750 1
and ${DISTNAME}${SUBPACKAGE} for multi-packages ports.
d1114 4
a1117 1
.Ev FULLPKGNAME .
a1263 1
This is not yet supported for dependencies.
d1274 2
d1281 2
a1282 1
recursive make package, with SUBPACKAGE set to the right value.
d1288 1
a1288 1
Run make package SUBPACKAGE=,
d1290 1
a1290 1
Run make package SUBPACKAGE=-lib,
d1292 1
a1292 1
Run make package SUBPACKAGE=-server,
d1297 3
d1373 11
d1387 2
a1388 2
target does a fairly good job of automatically generating PLIST-auto and
PFRAG.shared-auto fragments.
d1415 1
a1415 1
When the file grew too large, Marc Espie cleaned it up to restore some of
a1422 1
.\" HAVE_MOTIF, REQUIRE_MOTIF: need to revisit what these should mean.
@


1.41
log
@Document DESTDIRNAME
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.40 2001/07/17 16:12:51 espie Exp $
d488 1
a488 3
By default, DESTDIR=${WRKINST}.
If CONFIGURE_STYLE involves gnu, adds AM_MAKEFLAGS='DESTDIR=${WRKINST}' to
take automatic care of recent automaker recursive issues.
d1201 2
a1202 2
important changes: PREFIX is set to ${WRKINST}${PREFIX}, DESTDIR is set to
${WRKINST}, and TRUEPREFIX is set to ${PREFIX}.
d1212 1
a1212 1
    PREFIX=${WRKINST}${PREFIX} DESTDIR=${WRKINST} TRUEPREFIX=${PREFIX}
d1216 3
a1218 2
Note that this does set both PREFIX and DESTDIR.
If a port's Makefile both heeds DESTDIR, and references PREFIX explicitly,
@


1.40
log
@Document ERRORS
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.39 2001/07/09 20:28:00 aaron Exp $
d335 5
a339 1
add DESTDIR to prefixes.
d360 2
d369 7
@


1.39
log
@Fix typo; addresses PR/1931 from heko@@saitti.net
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.38 2001/07/03 12:11:49 espie Exp $
d417 11
@


1.38
log
@Fix negative flavor fragments description (Nikolay Sturm).
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.37 2001/06/24 07:30:29 pvalchev Exp $
d255 1
a255 1
List of descriptive categories into which this port fails.
@


1.37
log
@typos and spelling fixes; from jsyn@@nthought.com
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.36 2001/06/03 14:42:44 espie Exp $
d633 1
a633 1
if neither PFRAG.SHARED nor CONFIGURE_SHARED are enough.
d1314 1
a1314 1
.Li "%%!SHARED%%"
d1323 1
a1323 1
.Li "%%!flav1%%" )
@


1.36
log
@Document PATCH_CASES
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.35 2001/04/18 14:48:29 espie Exp $
d300 1
a300 1
unappropriate.
d370 1
a370 1
to refer to ports's distfiles location, as it takes an eventual
@


1.35
log
@Document USE_MOTIF
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.34 2001/04/15 18:28:56 espie Exp $
d652 23
@


1.34
log
@MULTI_PACKAGES limitations were removed, somewhat recently.
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.33 2001/04/12 10:26:58 avsm Exp $
d205 2
d623 4
d864 10
a873 2
.Sq Yes
if lesstif is needed for correct behavior of this port.
@


1.33
log
@Require full name in MAINTAINER; espie@@ ok, pointed out by aaron@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.32 2001/04/10 17:48:10 espie Exp $
d1216 2
a1217 3
Apart from the main package, created by default, each element of
MULTI_PACKAGES triggers a recursive make package, with SUBPACKAGE set to the
right value.
d1223 2
a1227 2
.It
Build the main package, by running make package SUBPACKAGE=''
a1235 5
.Pp
It is currently not possible to have a subpackage depend on the main
package, except by inserting an explicit
.Li "@@pkgdep"
command into the packing-list.
@


1.32
log
@Xref packages-specs
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.31 2001/03/28 22:00:59 naddy Exp $
d555 1
a555 1
E-mail address of the port's maintainer.
@


1.31
log
@- add NOT_FOR_ARCHS
- fix spelling, grammar
- fix sentence breaks
ok espie@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.30 2001/03/28 15:02:11 espie Exp $
d1353 2
@


1.30
log
@Document dependencies on subpackages and flavors.
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.28 2001/03/22 00:24:58 espie Exp $
d116 2
a117 1
Fetch the distfiles and patchfiles. Each file of the
d165 2
a166 1
specific patches. Because of historical accident,
d247 2
a248 2
is a comma separated list of flavors. By default, the dependency will build
the default flavor.
d253 3
a255 1
List of descriptive categories into which this port fails. Mandatory. See
d265 2
a266 1
to the network. Defaults to
d302 2
a303 1
Arguments to pass to configure script. Defaults are empty, except for
d365 2
a366 1
Override if distfiles are stored elsewhere. Always use
d373 2
a374 1
for binary-only ports). Will be retrieved from the MASTER_SITES (see
d390 2
a391 1
Name used to identify the port. See
d500 2
a501 2
Full name of the created package, taking flavors into account. Defaults to
${PKGNAME}${FLAVOR_EXT}.
d509 3
a511 2
Set to the list of files that cannot be checksummed. For used by ports
fetching dynamically generated archives that can't be checksummed.
d584 2
a585 1
is always appended.  These specifications are rooted at
d609 4
d616 3
a618 2
Don't verify build of dependencies. Do not use in any ports Makefile. This
is only meant as a user convenience when, e.g., you just want to browse
d629 3
a631 3
List of architectures on which this port builds.  Can hold both
processor-specific information (e.g., m68k), and more specific model
information (e.g., amiga).
d655 2
a656 1
stage. See also
d700 2
a701 1
This does not take flavors into account. See
d795 2
a796 2
an error-free list of files to retrieve in that way. See
the xanim port for an example.
d869 1
a869 1
unreproductible builds.)
@


1.29
log
@Status update.

Document rebuild, CONFIGURE_ARGS, CONFIGURE_ENV, NO_BUILD, NO_DEPENDS, YACC.
@
text
@d227 1
a227 1
.Sq file_to_test::directory[:target] .
d241 6
@


1.28
log
@Document FLAVOR_EXT, FULLPKGNAME, new COMMENT meaning
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.27 2001/03/16 04:00:58 brad Exp $
d46 3
a48 1
This is an incomplete draft; some variables and targets are not yet documented.
d61 3
a63 1
env -i ${MAKE_ENV} ${MAKE_PROGRAM} ${MAKE_FLAGS} \\\&\
d194 2
d290 6
d304 2
a305 2
Append to CONFIGURE_ARGS, for ports that build dynamic libraries and
whose configure script supports those options.
d592 7
d842 5
@


1.27
log
@deprecate USE_BZIP2 & USE_ZIP
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.26 2001/03/06 19:00:18 espie Exp $
d276 8
a283 6
File used as a comment for the package, and in the INDEX.
Set to
${PKGDIR}/COMMENT by default (with corrections for multi-packages and flavors).
If COMMENT starts with a dash, this is a literal string instead.
This can be used to leave a stub Makefile for removed ports and have a complete
INDEX entry without needing more files.
d464 4
d472 6
d658 6
a663 2
This is automatically altered to include flavors, so it is unwise to
base other variables on it.
d878 4
d1005 7
@


1.26
log
@Document MTREE_FILE improvements.
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.25 2001/03/01 16:11:21 aaron Exp $
a751 6
.It Ev USE_BZIP2
Set to Yes if port needs bzip2 to build properly.
This is automatic if EXTRACT_ONLY holds files matching *.bzip2.
.It Ev USE_ZIP
Set to Yes if port needs zip to build properly.
This is automatic if EXTRACT_ONLY holds files matching *.zip.
d881 12
@


1.25
log
@A slew of share/ man page fixes; nordin@@cse.ogi.edu. These have been sitting
in my INBOX since Nov 6, 2000, probably forgot about them since the tree was
frozen at that time.
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.24 2001/01/16 07:05:41 espie Exp $
d541 14
a554 2
By default,
.Pa ${PORTSDIR}/infrastructure/db/fake.mtree.
@


1.24
log
@Revert last commit.
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.23 2001/01/16 04:23:56 angelos Exp $
d1078 1
a1078 1
each port can generate several packages through two orthogonal mechanims:
d1157 1
a1157 1
If not overriden by the user, determine which set of templates to use,
@


1.23
log
@Document NO_BUILD.
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.22 2000/12/27 18:21:11 espie Exp $
a903 2
.It Ev NO_BUILD
Do not actually build the port.
@


1.22
log
@More stuff: checksum process, fix REFETCH description.
Describe CATEGORIES, DISTNAME.
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.21 2000/12/14 13:26:26 espie Exp $
d904 2
@


1.21
log
@Document additions to EXTRACT_CASES
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.20 2000/12/10 02:50:07 espie Exp $
d49 5
d67 13
d134 2
a135 4
Note that
.Ar fetch
can be invoked by mirroring scripts, in which case it will also
retrieve
d152 5
a156 1
.Ar refetch .
a189 9
.It Ar refetch
Try grabbing a version of the distfiles with the correct checksum off
the main
.Ox
mirror, if
.Ar fetch
+
.Ar checksum
failed.
d238 4
d263 5
a267 3
Location for this port checksums, used at
.Ar checksum
stage.
d361 5
d469 3
d648 6
d849 4
a852 12
.It Ar fetch-list
Use the more powerful
.Ar mirror-maker
and
.Ar fetch-makefile
targets instead.
.It Ar mirror-distfiles
Use the more powerful
.Ar mirror-maker
and
.Ar fetch-makefile
targets instead.
@


1.20
log
@Recursive makes are no longer a problem, since make now has the
POSIXly-correct behavior.

COMMENT is adjusted for flavors, DESCR is not (and this is intentional).
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.19 2000/12/01 16:29:32 espie Exp $
d381 4
@


1.19
log
@Describe more things
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.18 2000/11/20 08:00:02 deraadt Exp $
a1047 3
.Pp
Recursive makes are a problem, and will often need FAKE_FLAGS to be changed
to ensure that the right values are passed down to submakes.
d1085 1
a1085 1
DESCR and DESCR-option1-option2 are available, DESCR-option1-option2 will
@


1.18
log
@various Xr fixes; nordin@@cse.ogi.edu
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.17 2000/10/26 00:37:04 aaron Exp $
d54 1
a54 1
env -i ${MAKE_ENV} ${MAKE_PROGRAM} ${MAKE_FLAGS} \\\&\ 
d64 1
a64 1
Might be a no operation.
d82 3
a84 1
Extract the distfiles (but see
d86 3
d94 43
a136 1
Fetch the distfiles and patchfiles.
d140 20
d161 18
d186 4
d231 11
d319 1
a319 1
Directory where all ports distfiles are stashed.
d322 1
a322 1
Override if distfiles are stored elsewhere, but use
d324 20
a343 1
to refer to ports's distfiles location instead.
d419 6
d534 4
d540 1
a540 1
.Ox OpenBSD
d555 8
d667 6
d675 16
d705 3
a710 3
.It Ev USE_BZIP2
Set to Yes if port needs bzip2 to build properly.
This is automatic if EXTRACT_ONLY holds files matching *.bzip2.
d771 2
d775 2
d785 2
d912 1
a912 1
.Ev PATCH_FILES
@


1.17
log
@Some share/man fleshing.
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.16 2000/09/23 12:38:34 espie Exp $
d383 1
a383 1
.Xr mtree 1
d727 1
a727 1
.Xr mtree 1
d846 1
a846 1
.Xr mtree 1
@


1.16
log
@Document checkpatch/PATCH_CHECK_ONLY
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.15 2000/09/19 18:43:48 espie Exp $
d37 3
a39 2
holds all the standard routines used by the ports tree.  Some variables
and targets are for its internal use only.  The rest is documented here.
d41 4
a44 3
Other BSD, and older versions of
.Nm
included other targets and variables. Conversion methods are outlined here.
d46 1
a46 5
This is an incomplete draft, some variables and targets are not yet
documented.
.\"
.\"
.\"
d50 6
a55 3
Default target. Build the port. Essentially invoke
.Bd -literal -offset indent
    env -i ${MAKE_ENV} ${MAKE_PROGRAM} ${MAKE_FLAGS} -f ${MAKE_FILE} ${ALL_TARGET}
d63 5
a67 4
Configure the port. Might be a no operation. Unless overridden,
configure creates the ${WRKBUILD} directory (see SEPARATE_BUILD), runs
${SCRIPTDIR}/configure if it exists, and runs whatever configuration
methods are recorded in
d83 1
a83 1
.Ev EXTRACT_ONLY ).
d86 2
a87 1
${WRKINST}.  Described in a separate section below.
d95 3
a97 3
Invoked with VARNAME=name, show the contents of VARNAME.  Mostly used from
recursive makes, or to know the contents of another port's variables
without guessing wrong.
a98 3
.\"
.\"
.\"
d102 2
a103 1
Target used to build software. Default is
d109 2
a110 2
Location of the autoconf binary if needed. Defaults to autoconf (though maybe
autoreconf might be more appropriate).
d116 2
a117 2
Macros passed to make and configure invocations. Set based on corresponding
INSTALL_* variables.
d129 3
a131 3
is checked against the current path for ports (see PORTPATH),
or as an absolute
file name. The special name /nonexistent can be used to force a build
d143 2
a144 1
Default flags passed to the compiler for building. Many ports ignore it.
d150 2
a151 1
stage. Defaults to ${FILESDIR}/md5.
d156 2
a157 2
will also clean dependencies. Note that distclean  never recurses down to
dependencies.
d159 2
a160 1
File used as a comment for the package, and in the INDEX. Set to
d162 2
a163 2
If COMMENT starts with a dash, this is a literal string instead. This can
be used to leave a stub Makefile for removed ports and have a complete
d168 2
a169 1
target, if appropriate. Should be relative to ${WRKSRC}.
d208 2
a209 2
Supplementary options appended to ${CFLAGS} for building. Since most ports
ignore the COPTS convention, they are actually told to use
d215 3
a217 1
time. Default is 022. Don't override.
d219 4
a222 3
Directory where all ports distfiles are stashed. Defaults to
.Pa ${PORTSDIR}/distfiles.  Override if distfiles are stored elsewhere,
but use
d228 2
a229 1
to rename original files.  Defaults to
d237 2
a238 1
and patchfiles will be located. See target
d243 2
a244 1
and similar informative messages. Override to turn off, for instance.
d248 2
a249 2
is not empty), this is the contents of a case statement, used to extract
files. Fragments are automatically appended to extract tar and zip
d278 2
a279 1
for most ports (and all new ports). Indicates that the port, using
d282 2
a283 1
and properly installed from the package.  Set to
d287 4
a290 4
Flags passed to ${MAKE_PROGRAM} on fake invocation. By default,
DESTDIR=${WRKINST}. If CONFIGURE_STYLE involves gnu, adds
AM_MAKEFLAGS='DESTDIR=${WRKINST}' to take automatic care of recent automaker
recursive issues.
d292 2
a293 1
Command used to fetch distfiles for this port. Defaults to
d297 3
a299 2
See BUILD_DEPENDS for specification.  Fetch dependencies are checked at
the beginning of the extract stage. No current port uses FETCH_DEPENDS.
d301 3
a303 2
Location of other files related to the current ports. Holds at least the
checksum file, and sometimes other files (default: files.${ARCH} or files).
d305 2
a306 2
The port current options. Set by the user, and tested by the port to
activate wanted functionalities.
d308 3
a310 3
List of all flavors keywords a port may match. Used to sort FLAVOR into
a canonical order to build the package name, or to select the packing-list,
and as a quick validity check.
d316 2
a317 1
Location of the gnu make binary, if needed. Defaults to gmake.
d319 2
a320 1
Libraries this port depends upon. Similar to BUILD_DEPENDS, except that
d328 1
a328 1
On architectures that use dynamic  libraries,
d345 3
a347 2
if port needs human interaction to build. Usually implies NO_PACKAGE as
well.  Porters should strive to minimize IS_INTERACTIVE ports, by using
d355 3
a357 2
Arguments to pass to libtool. If USE_LIBTOOL is set, the environment variable
LIBTOOL is set to ${LIBTOOL} ${LIBTOOL_FLAGS}.
d361 2
a362 1
E-mail address of the port's maintainer. Defaults to ports@@openbsd.org.
d364 3
a366 3
Environment variables passed to make invocations. Sets at least
PATH, PREFIX, LOCALBASE, X11BASE, CFLAGS, TRUEPREFIX, DESTDIR and the
BSD_INSTALL_* macros.
d371 3
a373 2
Name of the Makefile used for ports building. Defaults to Makefile. Used
after changing directory to ${WRKBUILD}.
d375 3
a377 2
The make program that is used for building the port. Set to ${MAKE} or
${GMAKE} depending on USE_GMAKE. Read-only.
d379 3
a381 2
File recorded in the package and displayed during installation. Defaults
to ${PKGDIR}/MESSAGE if this file exists. Leave empty if no message is needed.
d386 2
a387 1
target.  By default,
d390 2
a391 2
Set to a list of package extensions for ports that create multiple
packages. See
d394 1
a394 1

d398 2
a399 1
needed by this ports tree. Usually set to the current version of
d405 2
a406 2
if platform does not support shared libraries.  To be tested after
including
d410 3
a412 1
Always OpenBSD (read-only).
d414 3
a416 1
Revision number of OpenBSD (read-only).
d420 2
a421 1
Command to use to apply all patches. Defaults to
d431 2
a432 1
target. Don't touch unless the default
d435 2
a436 2
Ideally, user-defined patch subtargets ought to test checkpatch. In
practice, they don't.
d447 2
a448 1
patches.  Defaults to -p0 .
d456 2
a457 1
Path used by most shell invocations. Don't override unless really needed.
d462 2
a463 1
short description). Default: pkg.${ARCH} or pkg.
d465 5
a469 3
Name of the created package.  Default is ${DISTNAME} for the main package,
and ${DISTNAME}${SUBPACKAGE} for multi-packages ports.  This is automatically
altered to include flavors, so it is unwise to base other variables on it.
d471 2
a472 1
Path to the current port's directory, relative to ${PORTSDIR}. Read-only.
d474 2
a475 2
List of cryptographic ciphers to use, in order of preference. Defaults
is
d479 3
a481 3
Base directory for the current port installation. Usually ${LOCALBASE},
though some ports may elect a location under /var, and some multi-packages
ports may install under several locations.
d484 2
a485 1
Same format as BUILD_DEPENDS.  The corresponding packages will be built at
d502 2
a503 1
place they were unpacked. For some specific ports, this is even mandatory.
d518 3
a520 3
Set to the sub package suffix when building a package in a multi-package
port. Read-only. Used to test for dependencies or to adjust the package
name.
d523 2
a524 1
information.  Always holds
d533 2
a534 1
Location for ports system configuration files. Defaults to
d536 1
a536 2
should
never be set to
d547 2
a548 2
Set to Yes if port needs zip to build properly. This is automatic if
EXTRACT_ONLY holds files matching *.zip.
d550 2
a551 2
Set to Yes if port needs bzip2 to build properly. This is automatic if
EXTRACT_ONLY holds files matching *.bzip2.
d553 3
a555 3
Subdirectory of ${WRKDIR} where the actual build occurs. Defaults to
${WRKSRC}, unless SEPARATE_BUILD is involved, in which case it is set
to an appropriate value.
d557 4
a560 2
Location where all port activity occurs.  Apart from the actual port, may
hold all kinds of cookies that checkpoint the port's build.  Read-only.
d562 1
a562 1
cd that_port_dir && make show VARNAME=WRKDIR  for this.
d565 2
a566 2
Subdirectory of ${WRKDIR} where the source normally unpacked. Base for all
patches (default: ${WRKDIR}/${DISTNAME}).
d569 2
a570 2
Subdirectory of ${WRKDIR} where the actual source is. Base for
configuration (default: ${WRKDIST})
d582 3
a584 2
If defined, used as a base for the actual port working directory. The real
working directory is created there, and the port ${WRKDIR} is just a link.
d602 3
a604 2
Invocation of xmkmf for CONFIGURE_STYLE=imake port. Defaults to
xmkf -a -DPorts.  The -DPorts is specific to
a607 3
.\"
.\"
.\"
d615 2
a616 1
Checksum file. Holds the output of
d618 1
a618 1
.Xr sha1 1
d623 4
a626 2
Description for the port. Variables such as ${HOMEPAGE} will be expanded
(see SUBST_VARS). Multi-packages ports will use DESCR${SUBPACKAGE}.
a639 3
.\"
.\"
.\"
d643 2
a644 1
Don't override. Set
a661 3
.\"
.\"
.\"
d669 2
a670 2
does not give a specific name to the generated file. It is not recommended
to try to access them directly.
d709 2
a710 1
to determine which files can be mirrored instead.  See
d716 1
a716 1
Set EXTRACT_ONLY=  instead.
d728 2
a729 1
specification.  Use an explicit
d733 2
a734 2
The absence of a patches directory does the same. Use PATCHDIR and
PATCH_LIST if patches need to be changed dynamically.
d748 2
a749 2
used to be retrieved from a separate site list. For greater flexibility,
all files are now retrieved from
d773 2
a774 2
does not give a specific name to the generated file. It is not recommended
to try to access them directly.
d783 2
a784 2
only a list of variables instead.  Most package files gets transformed,
instead of only the packing list.
a793 3
.\"
.\"
.\"
d800 2
a801 2
Use PFRAG.shared or PFRAG.no-shared instead.  PLIST.noshared was too easy
to forget when updating ports.
d803 2
a804 1
Use PLIST directly. Until revision 1.295,
d817 2
a818 1
systems. In any case, portability should not need to depend on operating
d823 2
a824 1
to marshall system configuration files. All
d826 4
a829 2
system configuration files are located in /etc, or in a subdirectory of
/etc.
a830 3
.\"
.\"
.\"
d837 1
a837 1

d852 3
a854 3
target may be used to complete that skeleton tree. For instance, a few
ports may  need supplementary stuff to be present (as it would be installed
if the ports' dependencies were present).
d872 3
a874 3
Note that this does set both PREFIX and DESTDIR. If a port's Makefile both
heeds DESTDIR, and references PREFIX explicitly, FAKE_FLAGS may rectify
the problem by setting PREFIX=${PREFIX}
d881 2
a882 2
command line, which will override the port Makefile contents. Thus, a
port that mentions DESTDIR=    does not need any patch to work with fake.
a885 3
.\"
.\"
.\"
d896 2
a897 2
to build a specific flavor of the port. The Makefile should test the value
of FLAVOR as follows:
d939 1
d950 5
a954 3
processing for all sub packages. All packing information is derived from
templates with SUBPACKAGE appended. In the preceding example, the
packing-list template for pkgname-foo must be in PLIST-foo.
a959 3
.\"
.\"
.\"
d965 1
a965 1

d1011 1
a1011 1
will  trigger the inclusion of
d1015 2
a1016 1
in the packing-list. Fragments that cannot be handled by these simple rules
d1037 2
a1038 1
DEINSTALL files in a similar way).  This contrasts with the FLAVORS
a1040 3
.\"
.\"
.\"
d1046 2
a1047 1
are not heeded consistently. Most of the ports tree will probably fall
a1052 3
.\"
.\"
.\"
a1065 1

@


1.15
log
@Better BUILD_DEPENDS doc.
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.14 2000/09/17 16:39:18 espie Exp $
d56 5
d397 8
@


1.14
log
@more
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.13 2000/09/16 13:51:24 espie Exp $
d123 2
a124 1
is checked against the current path, or as an absolute
@


1.13
log
@More variables documented
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.12 2000/09/11 18:11:28 espie Exp $
d129 2
d419 2
d449 1
a449 1
place they were unpacked.
d482 3
a484 1
.Pat /usr/local/etc .
d489 2
d497 4
a514 4
.It Ev WRKBUILD
Subdirectory of ${WRKDIR} where the actual build occurs. Defaults to
${WRKSRC}, unless SEPARATE_BUILD is involved, in which case it is set
to an appropriate value.
d1021 2
@


1.12
log
@Document EXTRACT_CASES
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.11 2000/07/11 13:06:46 espie Exp $
d44 1
a44 1
This is an incomplete draft, most variables and targets are not yet
d46 3
d91 3
d198 20
d219 3
a221 2
Optionally subdirectory of ${DISTDIR} where the current port's distfiles
and patchfiles will be located. See target fetch.
d235 1
a235 1
cd ${WKRDIR}
d270 4
d356 6
d381 3
d387 2
d392 8
a399 1
the make patch stage will output extra debug information.
d403 3
d437 1
a437 1
appends to it substitution commands corresponding to the the port's
d465 7
a471 1
information.  Always holds ARCH, HOMEPAGE, and PREFIX. Add other
d474 5
a478 2
Location for ports system configuration files. Defaults to /etc, should
never be set to /usr/local/etc.
d480 3
a482 1
Base location for the templates used in the readme target.
d544 32
d590 6
d597 3
d642 7
a732 29
.Sh FILES
.Bl -tag -width files/md5
.It Pa ../Makefile.inc
Common Makefile fragment for a set of ports, included automatically.
.It Pa Makefile.${ARCH}
Arch-dependent Makefile fragment, included automatically.
.It Pa ${FILESDIR}/md5
Checksum file. Holds the output of
.Xr md5 1 ,
.Xr sha1 1
and
.Xr rmd160 1
for the ports ${DISTFILES} and ${PATCHFILES}.
.It Pa ${PKGDIR}/DESCR
Description for the port. Variables such as ${HOMEPAGE} will be expanded
(see SUBST_VARS). Multi-packages ports will use DESCR${SUBPACKAGE}.
.It Pa ${PKGDIR}/COMMENT
Short, one line description of the port, that is displayed by
.Xr pkg_info 1 ,
and appears in
.Pa ${PORTSDIR}/INDEX .
Name will be adjusted for flavored and multi-packages ports.
.It Pa ${PORTSDIR}/infrastructure/db/fake.mtree
Specification used for populating ${WRKINST} at the start of
.Ar fake .
Use
.Ar pre-fake
if this is incomplete.
.El
d748 1
a748 1
.Nm .
d755 2
a756 1
systems.
d897 3
d993 3
d1012 1
@


1.11
log
@Document CONFIGURE_SHARED
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.10 2000/07/11 13:00:48 espie Exp $
d199 30
d420 6
d505 14
@


1.10
log
@Explains how FLAVORS and MULTI_PACKAGES work
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.9 2000/07/11 12:28:30 espie Exp $
d151 5
@


1.9
log
@Remove extraneous spaces.
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.8 2000/07/09 15:08:48 espie Exp $
d670 1
d691 68
a758 1
each port can generate several packages through two orthogonal mechanims.
a831 6
.Pp
In MULTI_PACKAGES mode, there is a main package that is built after several
SUBPACKAGEs: make package is invoked recursively, after setting SUBPACKAGE
to the right value. All SUBPACKAGEs should start with a dash, e.g.,
.Sq -lib
is a correct name.
@


1.8
log
@Explains how package information is generated.
Not satisfying yet, I need to take FLAVORS and MULTI_PACKAGES information
out of the way, so that not everything is jumbled together.
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.7 2000/07/04 16:28:33 espie Exp $
d36 1
a36 1
.Nm 
d40 1
a40 1
Other BSD, and older versions of 
d57 1
a57 1
methods are recorded in 
d62 1
a62 1
Override for the default behavior of 
d66 1
a66 1
as 
d69 1
a69 1
.Ar distpatch 
d72 1
a72 1
Extract the distfiles (but see 
d80 1
a80 1
Apply distribution and 
d91 1
a91 1
Target used to build software. Default is 
d108 1
a108 1
Each item has the form 
d111 3
a113 3
near future.  
.Sq target 
defaults to 
d116 1
a116 1
.Sq file_to_test 
d120 1
a120 1
.Sq directory 
d125 1
a125 1
PERMIT_PACKAGE_CDROM) will be placed 
d129 1
a129 1
See also 
d132 1
a132 1
Location for this port checksums, used at 
d136 1
a136 1
If set to 
d148 2
a149 2
Set to name of script invoked by 
.Ar configure 
d152 1
a152 1
Set to style of configuration that needs to happen. 
d155 1
a155 1
assume 
d163 1
a163 1
Add 
d191 1
a191 1
Used to display 
d195 1
a195 1
Automatically set to 
d198 1
a198 1
.Ev FAKE_FLAGS 
d200 1
a200 1
and properly installed from the package.  Set to 
d205 1
a205 1
DESTDIR=${WRKINST}. If CONFIGURE_STYLE involves gnu, adds 
d215 1
a215 1
The port current options. Set by the user, and tested by the port to 
d219 1
a219 1
a canonical order to build the package name, or to select the packing-list, 
d223 1
a223 1
PERMIT_PACKAGE_FTP) will be placed 
d230 1
a230 1
is replaced by a 
d236 2
a237 2
On architectures that use dynamic  libraries, 
.Ev LIB_DEPENDS 
d248 1
a248 1
Default is 
d259 1
a259 1
.Ev USE_LIBTOOL 
d291 3
a293 3
Specific revision of 
.Nm 
needed by this ports tree. Usually set to the current version of 
d297 1
a297 1
Set to 
d300 1
a300 1
including 
d313 1
a313 1
If set to 
d332 1
a332 1
is 
d343 1
a343 1
stage, and 
d347 2
a348 2
Pipeline of commands used to create the actual packing list from the 
PLIST template (usually ${PKGDIR}/PLIST). 
d350 1
a350 1
appends to it substitution commands corresponding to the the port's 
d358 6
a363 6
place they were unpacked. 
Set to 
.Sq simple 
if this is the case. 
The ports infrastructure will generate a separate ${WRKBUILD} directory 
in which the port will be configured and built. 
d378 1
a378 1
information.  Always holds ARCH, HOMEPAGE, and PREFIX. Add other 
d390 1
a390 1
Note that WRKDIR may be a symbolic link. 
d405 1
a405 1
Defaults to ${WKRBUILD}/pkg, do not override unless 
d409 2
a410 2
Subdirectory of ${WRKDIR} where port normally installs (see 
.Ar fake 
d432 1
a432 1
Invocation of xmkmf for CONFIGURE_STYLE=imake port. Defaults to 
d443 1
a443 1
Don't override. Set 
d445 2
a446 2
to nothing and override 
.Ar post-extract 
d449 4
a452 4
Use the more powerful 
.Ar mirror-maker 
and 
.Ar fetch-makefile 
d458 1
a458 1
From 
d460 1
a460 1
This is DESCR. 
d465 1
a465 1
Use 
d470 1
a470 1
.Ev CONFIGURE_STYLE 
d475 1
a475 1
Used to organize a collection of ports that share most files. 
d477 1
a477 1
uses a single port with flavors or multi-packages to produce 
d489 1
a489 1
Use 
d496 1
a496 1
globally, instead of embedding it in each package. 
d498 1
a498 1
.Xr mtree 1 
d517 1
a517 1
.Ev PATCH_FILES 
d519 1
a519 1
all files are now retrieved from 
d523 2
a524 2
using a 
.Sq :0 
d527 1
a527 1
extension to the file name, e.g., 
d539 1
a539 1
From 
d541 1
a541 1
This is PLIST. 
d547 1
a547 1
.Nx 
d550 1
a550 1
Use SUBST_VARS instead.  
d574 1
a574 1
Checksum file. Holds the output of 
d576 1
a576 1
.Xr sha1 1 
d584 1
a584 1
Short, one line description of the port, that is displayed by 
d586 1
a586 1
and appears in 
d590 1
a590 1
Specification used for populating ${WRKINST} at the start of 
d592 1
a592 1
Use 
d610 1
a610 1
Original location of 
d615 1
a615 1
The 
d637 1
a637 1
Essentially, 
d643 2
a644 2
.Ar fake 
first creates a skeleton tree under ${WRKINST}, using the 
d655 1
a655 1
If {pre,do,post}-install overrides are present, they are used with some 
d666 2
a667 2
    env -i ${MAKE_ENV} 
    PREFIX=${WRKINST}${PREFIX} DESTDIR=${WRKINST} TRUEPREFIX=${PREFIX} 
d677 1
a677 1
${FAKE_FLAGS} is used to set variables on 
d699 2
a700 2
If not overriden by the user, determine which set of templates to use, 
depending on the current SUBPACKAGE and FLAVOR information.  
d710 1
a710 1
substituting the variables in ${SUBST_VARS}, and by substituting 
d712 1
a712 1
e.g, if FLAVORS=no_map gfx qt2, if FLAVOR=gfx no_map, this is 
d715 4
a718 4
Generate the actual PLIST from the template ${PLIST}, 
by inserting shared/no-shared fragments, applying a possible user-supplied 
pipeline, merging other fragments, applying the same variable 
substitutions as other packing information, and finally handling 
d722 1
a722 1
Note that ${COMMENT} is currently not substituted, to speed up 
d733 1
a733 1
in the packing-list template trigger the inclusion of the 
d742 1
a742 1
will  trigger the inclusion of 
d749 1
a749 1
The constructs 
d757 1
a757 1
.Li "NEWDYNLIBDIR" 
d760 1
a760 1
The special 
d762 1
a762 1
target does a fairly good job of automatically generating PLIST-auto and 
d767 1
a767 1
to the right value. All SUBPACKAGEs should start with a dash, e.g., 
d771 1
a771 1
In MULTI_PACKAGES mode, there must be separate COMMENT, DESCR, and PLIST 
d787 1
a787 1
.Ev LIB_DEPENDS 
d793 1
a793 1
A lot of additions were taken from 
@


1.7
log
@Literal.... nroff is idiot enough not to bitch, #!@@#?x!
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.6 2000/07/04 16:08:58 aaron Exp $
d235 5
d403 5
d446 2
a447 1
.Ar post-extract instead.
d449 5
a453 1
Use the more powerful mirror-maker and fetch-makefile targets instead.
d627 3
d687 92
d799 4
@


1.6
log
@Beautify for espie.
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.5 2000/06/13 02:17:09 espie Exp $
d50 1
a50 1
.Bd -litteral -offset indent
d144 1
a144 1
If COMMENT starts with a dash, this is a litteral string instead. This can
d647 1
a647 1
.Bd -litteral -indent offset
@


1.5
log
@More
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.4 2000/06/10 22:32:55 espie Exp $
d506 1
a506 1
.Ev MASTER_SITES0 ,...
d513 3
a515 3
.Bd -litteral -offset indent
	PATCH_FILES=foo.diff.gz
	PATCH_SITES=ftp://ftp.zoinx.org/pub/
d517 1
d519 3
a521 4

.Bd -litteral -offset indent
	PATCH_FILES=foo.diff.gz:0
	MASTER_SITES0=ftp://ftp.zoinx.org/pub/
@


1.4
log
@More
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.3 2000/06/10 19:23:04 espie Exp $
d90 4
d176 3
d241 4
d261 2
d307 4
d321 4
d457 7
d473 4
d532 3
a534 1
.Nx .
@


1.3
log
@More
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.2 2000/06/10 13:28:10 espie Exp $
d99 4
a102 1
.It BUILD_DEPENDS
d137 6
d183 4
d231 3
d250 4
d257 3
d263 3
d320 7
d350 4
d421 7
d491 15
d632 3
@


1.2
log
@More flesh
@
text
@d1 1
a1 1
.\" $OpenBSD: bsd.port.mk.5,v 1.1 2000/06/09 16:39:45 espie Exp $
d92 3
d98 1
d120 8
d167 4
d205 2
d225 7
d234 3
d278 5
d315 1
a315 1
port. Read-only. Used to test for dependencies or adjusting the package
d352 1
a352 1
if gnu make is needed for correct behavior of this port.
d357 2
d363 5
d369 3
d392 4
d456 3
d593 3
@


1.1
log
@First cut at really documenting bsd.port.mk
@
text
@d1 1
a1 1
.\" $OpenBSD$
d48 39
d92 3
d122 33
d167 5
d178 7
d212 6
d243 2
d264 20
d289 18
d311 3
d320 8
d331 7
d341 8
d350 2
a351 1
If ${FILESDIR}/configure does
d354 10
d365 2
a366 2
The absence of a patches directory does the same. Use PATCH_DIR and
PATCH_LIST if patches must be changed dynamically.
d400 8
d431 6
d469 54
@

