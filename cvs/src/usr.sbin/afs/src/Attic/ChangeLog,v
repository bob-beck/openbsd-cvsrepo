head	1.6;
access;
symbols
	OPENBSD_5_2:1.5.0.38
	OPENBSD_5_2_BASE:1.5
	OPENBSD_5_1_BASE:1.5
	OPENBSD_5_1:1.5.0.36
	OPENBSD_5_0:1.5.0.34
	OPENBSD_5_0_BASE:1.5
	OPENBSD_4_9:1.5.0.32
	OPENBSD_4_9_BASE:1.5
	OPENBSD_4_8:1.5.0.30
	OPENBSD_4_8_BASE:1.5
	OPENBSD_4_7:1.5.0.26
	OPENBSD_4_7_BASE:1.5
	OPENBSD_4_6:1.5.0.28
	OPENBSD_4_6_BASE:1.5
	OPENBSD_4_5:1.5.0.24
	OPENBSD_4_5_BASE:1.5
	OPENBSD_4_4:1.5.0.22
	OPENBSD_4_4_BASE:1.5
	OPENBSD_4_3:1.5.0.20
	OPENBSD_4_3_BASE:1.5
	OPENBSD_4_2:1.5.0.18
	OPENBSD_4_2_BASE:1.5
	OPENBSD_4_1:1.5.0.16
	OPENBSD_4_1_BASE:1.5
	OPENBSD_4_0:1.5.0.14
	OPENBSD_4_0_BASE:1.5
	OPENBSD_3_9:1.5.0.12
	OPENBSD_3_9_BASE:1.5
	OPENBSD_3_8:1.5.0.10
	OPENBSD_3_8_BASE:1.5
	OPENBSD_3_7:1.5.0.8
	OPENBSD_3_7_BASE:1.5
	OPENBSD_3_6:1.5.0.6
	OPENBSD_3_6_BASE:1.5
	OPENBSD_3_5:1.5.0.4
	OPENBSD_3_5_BASE:1.5
	OPENBSD_3_4:1.5.0.2
	OPENBSD_3_4_BASE:1.5
	arla-20030805:1.1.1.3
	OPENBSD_3_3:1.4.0.4
	OPENBSD_3_3_BASE:1.4
	OPENBSD_3_2:1.4.0.2
	OPENBSD_3_2_BASE:1.4
	arla-0-35-7:1.1.1.2
	OPENBSD_3_1:1.3.0.8
	OPENBSD_3_1_BASE:1.3
	OPENBSD_3_0:1.3.0.6
	OPENBSD_3_0_BASE:1.3
	OPENBSD_2_9_BASE:1.3
	OPENBSD_2_9:1.3.0.4
	OPENBSD_2_8:1.3.0.2
	OPENBSD_2_8_BASE:1.3
	OPENBSD_2_7:1.2.0.4
	OPENBSD_2_7_BASE:1.2
	OPENBSD_2_6:1.2.0.2
	OPENBSD_2_6_BASE:1.2
	OPENBSD_2_5:1.1.1.1.0.4
	OPENBSD_2_5_BASE:1.1.1.1
	OPENBSD_2_4:1.1.1.1.0.2
	OPENBSD_2_4_BASE:1.1.1.1
	arla-0_9:1.1.1.1
	arla:1.1.1;
locks; strict;
comment	@# @;


1.6
date	2012.08.23.06.21.46;	author deraadt;	state dead;
branches;
next	1.5;

1.5
date	2003.08.05.09.16.14;	author hin;	state Exp;
branches;
next	1.4;

1.4
date	2002.06.07.04.49.04;	author hin;	state Exp;
branches;
next	1.3;

1.3
date	2000.09.11.14.40.28;	author art;	state Exp;
branches;
next	1.2;

1.2
date	99.04.30.01.59.03;	author art;	state Exp;
branches;
next	1.1;

1.1
date	98.09.14.21.52.51;	author art;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	98.09.14.21.52.51;	author art;	state Exp;
branches;
next	1.1.1.2;

1.1.1.2
date	2002.06.07.04.14.16;	author hin;	state Exp;
branches;
next	1.1.1.3;

1.1.1.3
date	2003.08.05.08.20.57;	author hin;	state Exp;
branches;
next	;


desc
@@


1.6
log
@the afs src tree can go away
@
text
@2003-07-15  Love  <lha@@stacken.kth.se>

	* nnpfs/bsd/nnpfs_dev-common.c: freebsd5.x needs
	nnpfs_block_sigset too

	* nnpfs/bsd/nnpfs_dev-common.c: drop support for freebsd 5.0 and
	only support freebsd 5.1

2003-07-01  Tomas Olsson <tol@@stacken.kth.se>

	* nnpfs/winnt/src/nnpfs_init.c (nnpfs_initdevice): use nnpfs_fsd_*
	wrappers

	* nnpfs/winnt/src/nnpfs_vops.c: defined wrappers (nnpfs_fsd_*) for
	all fsd entry points.
	(nnpfs_{handle_stale,data_valid}): some lock handling

	* nnpfs/winnt/src/nnpfs_node.c
	(nnpfs_{vrele,node_gc_all,close_data_handle,open_file,open_fh}):
	locking

	* nnpfs/winnt/src/nnpfs_message.c
	(nnpfs_message_{installdata,invalidnode}): lock MainResource

	* nnpfs/winnt/src/nnpfs_fastio.c (nnpfs_fastio_read): don't print
	buffer contents, use FsRtlE{nter,xit}FileSystem
	(nnpfs_createsec_acq): use FsRtlE{nter,xit}FileSystem
	(nnpfs_lazywrite_{acq,rel}): use node->lazy_writer

	* nnpfs/winnt/src/nnpfs_dnlc.c (*): more
	FsRtlE{nter,xit}FileSystem usage
	* nnpfs/winnt/src/nnpfs_dev.c (*): more FsRtlE{nter,xit}FileSystem
	usage

	* nnpfs/winnt/src/nnpfs_dev.c (nnpfs_devctl): renamed to
	nnpfs_fsd_devctl sprinkle some FsRtlE{nter,xit}FileSystem()

	* nnpfs/winnt/inc/nnpfs_proto.h: added DEFINE_IRP:s for wrappers
	for fsd entry points

	* nnpfs/winnt/inc/nnpfs_locl.h (nnpfs_node): store lazy writer
	thread

2003-06-26  Tomas Olsson <tol@@stacken.kth.se>

        * nnpfs/winnt/src/inc/nnpfs_locl.h 
	use FastMutex to protect zone allocation and nodelist 

        * nnpfs/winnt/src/nnpfs_{dev,dnlc,init,misc}.c 
	use FastMutex to protect zone allocation and nodelist 

	* nnpfs/winnt/src/nnpfs_node.c (*): use FastMutexes to protect
	zone allocation and node list
	(nnpfs_open_fh): added

	* nnpfs/winnt/src/nnpfs_message.c (nnpfs_message_gc_node): set
	STALE and call vgone() for unused nodes

	* nnpfs/winnt/src/nnpfs_vops.c (nnpfs_get_dummynode): clear
	wake_event
	(nnpfs_readwrite): hold PagingIoResource when paging

	* nnpfs/winnt/src/nnpfs_fastio.c (nnpfs_fastio_initmap): added
	(*): updated lock handling, use nnpfs_fastio_initmap

2003-06-12  Love  <lha@@stacken.kth.se>

	* appl/lib/arlalib.c: add more v4 glue

	* rxkad/rxkad_locl.h: protect v4 stuff with #ifdef HAVE_KRB4
	
	* appl/lib/Makefile.in: add krb5 includes
	
	* include/stds.h: s/HAVE_KERBEROS/KERBEROS/
	
	* appl/lib/appl_locl.h: add <krb5.h>
	
2003-06-11  Love  <lha@@stacken.kth.se>

	* appl/lib/arlalib.c: add krb5 support, untested
	
	* rxkad/rxk_serv.c: avoid warning
	
	* rxkad/rxk_serv.c: make rxkad_NewServerSecurityObject match
	prototype

	* appl/lib/arlalib.c: change enable to support krb5, now just fill
	in the blanks

2003-06-10  Love  <lha@@stacken.kth.se>

	* rxkad/Makefile.am: drop rxk_info.c its a server function
	
	* rx/rx_misc.c: drop osi_{Alloc,Free}, we use macros
	
	* lib/ko/koerror.c: wrap krb4 stuff with HAVE_KRB4
	
	* lib/ko/kocell.c: wrap krb4 stuff with krb4

	* configure.in: add AC_FUNC_KAFS_SETTOKEN_RXKAD
	
	* lib/ko/auth.c: wrap krb4 stuff with krb4, use kafs_settoken_rxkad
	
	* include/netbsd-lkm/Makefile: include <bsd.own.mk>
	
	* include/stds.h: more kerberos4 defines
	
	* appl/lib/arlalib.c: wrap krb4 stuff in HAVE_KRB4
	
	* appl/lib/appl_locl.h: wrap krb4 stuff in HAVE_KRB4
	
	* rxkad/Makefile.am: drop rxkad server end (to be build later as
	rxkad_server)

	* configure.in: make include k5 stuff in rxkad lib
	
	* arlad/arla_local.h: wrap krb4 stuff in HAVE_KRB4
	
	* arlad/arla.c: wrap krb4 stuff in HAVE_KRB4
	
	* arlad/Makefile.in: use krb5 cflags too
	
	* arlad/cred.h: use MAXKRB4TICKETLEN
	
	* rxkad/rxkad.h: provide MAXKRB4TICKETLEN
	
	* appl/perf/afsfsperf.c: wrap <krb.h> with HAVE_KRB4
	
	* lib/ko/auth.h: put ifdef HAVE_KRB4 around <krb.h>
	
	* arlad/{arla-cli.c,conn.c,cred.c,cred.h,messages.c}:
	remove depency on CREDENTIALS (and thus krb4) for rxkad

2003-06-04  Hans Insulander  <hin@@stacken.kth.se>

	* appl/vos/vos_listvldb.c: Remove \n from warnx()
	* appl/vos/vos.c: Missing \n on printout added
	* appl/afsutils/aklog.1: Spellfix
	* appl/afsutils/klog.c: Spellfix

2003-06-04  Tomas Olsson  <tol@@stacken.kth.se>

	* appl/afsutils/aklog.1: speling

2003-06-02  Love  <lha@@stacken.kth.se>

	* nnpfs/bsd: s/make_dead_vnode/nnpfs_make_dead_vnode/

	* nnpfs/bsd/nnpfs_message.c (nnpfs_message_installdata): use
	nnpfs_dnlc_purge instead of cache_purge

2003-05-21  Love  <lha@@stacken.kth.se>

	* appl/fs/fs.1: retreived->retrieved, from pjanzen@@openbsd via
	jmc@@openbsd

2003-05-06  Love  <lha@@stacken.kth.se>

	* appl/fs/fs_la.c (afs_getacl): a couple of off-by-one string
	bounds in sscanf, from Anil Madhavapeddy <avsm@@cvs.openbsd.org>
	via openbsd.

2003-04-25  Love  <lha@@stacken.kth.se>

	* appl/afsutils/unlog.1: remove unused .Ed fixe typos
	from jmc <jmc@@prioris.mini.pw.edu.pl>	
	
	* appl/afsutils/tokens.1: fixed bad .Fl usage, remove unused .El
	from jmc <jmc@@prioris.mini.pw.edu.pl>
	
2003-04-24  Love  <lha@@stacken.kth.se>

	* appl/lib/arlalib.h: s/managment/management/, from jmc
	<jmc@@prioris.mini.pw.edu.pl>
	* doc/storage.texi: s/managment/management/, from jmc
	<jmc@@prioris.mini.pw.edu.pl>

2003-04-16  Love  <lha@@stacken.kth.se>

	* ydr/output.c (cppfilesymbolname): new function, Convert filename
	into a cpp symbol
	(init_generate): use cppfilesymbolname
	(close_generator): ditto

2003-04-13  Love  <lha@@stacken.kth.se>

	* appl/pts/pts.c (pr_name2id): don't free memory on error
	
2003-04-10  Love  <lha@@stacken.kth.se>

	* arlad/messages.c (try_again): treat RXKADBADTICKET, RXKADBADKEY
	as key expired

	* arlad/volcache.c (get_info_loop): treat RXKADBADTICKET,
	RXKADBADKEY as key expired

2003-04-09  Love  <lha@@stacken.kth.se>

	* lib/ko/gensysname.c: s/strcpy/strlcpy/
	* tests/large-dir.c: s/strcpy/strlcpy/
	* rxkad/rxk_crpt.c: s/strcpy/strlcpy/
	* rx/rx_dumptrace.c: s/strcpy/strlcpy/
	
	* rx/rx_pkt.c: make osi_Msg sane
	* rx/rx.c: make osi_Msg sane
	* rx/rx_user.c: make osi_Msg sane add rx_vMsg
	* rx/rx_user.h: make osi_Msg sane
	
2003-04-08  Love  <lha@@stacken.kth.se>

	* arlad/arla_local.h: include <uae.h>
	
	* arlad/arla.c: init uae
	
	* rx/rxperf.c: replace sprint with snprintf
	
	* appl/fs/fs_copyacl.c: replace sprint with snprintf
	
	* appl/vos/vos_backup.c: replace sprint with asprintf
	
2003-04-08  Mattias Amnefelt  <mattiasa@@e.kth.se>

	* arlad/conn.c (re_probe): only increase ntries until threshold
	value. more readable logic for problelist removal
	(pinger): always schedule re_probe

	* arlad/arla_local.h: added argument f to assert_not_flag
	* arlad/conn.c (init_fs_context): Set rtt to half of its previous
	value if fileserver unreachable

2003-04-08  Love  <lha@@stacken.kth.se>

	* arlad/arla_local.h: include <uae.h>
	
	* arlad/arla.c: init uae
	
	* rx/rxperf.c: replace sprint with snprintf
	
	* appl/fs/fs_copyacl.c: replace sprint with snprintf
	
	* appl/vos/vos_backup.c: replace sprint with asprintf
	
2003-04-08  Mattias Amnefelt  <mattiasa@@e.kth.se>

	* arlad/fcache.c (unlink_lru_entry): assert_not_flag() on kernelp

2003-04-03  Love  <lha@@stacken.kth.se>

	* include/afssysdefs.h: freebsd 4 uses 210 freebsd 5 uses 339
	
	* configure.in: no longer change for chflags and lchflags, it was
	themis that needed it

2003-04-01  Love  <lha@@stacken.kth.se>

	* appl/afsutils/Makefile.in: avoid building klog when that we are
	not install it

	* rx/rxdebug.1: spelling, from jmc <jmc@@prioris.mini.pw.edu.pl>
	
	* appl/kalog/kalog.1: spelling, from jmc
	<jmc@@prioris.mini.pw.edu.pl>
	
	* appl/bos/bos.8: spelling, from jmc
	<jmc@@prioris.mini.pw.edu.pl>

	* arlad/{DynRootDB,arla.conf,ThisCell}.5arla-cli.8: spelling, from
	jmc <jmc@@prioris.mini.pw.edu.pl>

	* nnpfs/bsd/nnpfs_dev-bsd.c (nnpfs_dev): handle newer freebsd,
	from Mattias Amnefelt <mattiasa@@e.kth.se>

	* configure.in: check for d_psize and d_kqfilter
	
2003-03-17  Love  <lha@@stacken.kth.se>

	* lib/ko/koerror.c: s/Invaild/Invalid/
	
2003-03-13  Love  <lha@@stacken.kth.se>

	* util/log.c: log in LOG_NOTICE since LOG_INFO might get lost
	
2003-03-10  Love  <lha@@stacken.kth.se>

	* appl/afstool/at_fs_flush_cps.c: fix usage usage info
	
	* lib/ko/uae.h: remove dup
	
	* nnpfs/linux/nnpfs_load.c (init_module): do devfs_register_chrdev
	also when using a chardev, pointed out by Per Olofsson.

2003-03-09  Love  <lha@@stacken.kth.se>

	* configure.in: pull in arla_OPENSSL_COMPAT, add the -I to
	netbsd-lkm dir after the system KERNEL_CPPFLAGS
	
2003-03-08  Love  <lha@@stacken.kth.se>

	* appl/vos/vos_status.c: fix bad lp64 broken typecasts, make
	strftime buffer 128bytes
	* lib/ko/kocell.c: make strftime buffer 128 bytes
	* appl/afstool/at_fs_gettime.c: make strftime buffer 128 bytes
	* appl/afstool/at_u_debug.c: make strftime buffer 128 bytes
	
	* appl/vos/vos_examine.c: make strftime buffer 128 bytes
	* appl/vos/vos_status.c (printstatus): fix formating
	
2003-03-07  Love  <lha@@stacken.kth.se>

	* lib/ko/uae.c: add all missing errorcodes
	
	* lib/ko/uae.h: add UAE_ERROR_base remove dup
	
	* lib/ko/uae.h: add more error codes from derrick
	
2003-03-06  Love  <lha@@stacken.kth.se>

	* rxdef/common.h: add Capabilities
	
	* HACKING: automake appl/udebug/Makefile
	
	* include/Makefile.in: add uae.h
	
	* appl/afstool/at_fs_getcap.c: print string name of caps
	
	* appl/afstool: add support for RXAFS_GetCapabilities

	* rxdef/fs.xg: add GetCapabilities
	
	* appl/udebug: replace udebug with a shellscript that call afstool

	* NEWS: UAE
	
	* arlad/fs_errors.h: do uae translation
	
	* arlad/cmcb.c (SRXAFSCB_TellMeAboutYourself): tell server we
	support UAE

	* lib/ko/uae.c: comment how this should work
	
	* appl/perf/Makefile.in: adapt for uae
	
	* appl/afstool/Makefile.am: adapt for uae
	
	* lib/ko: Add infrastructure for 'Unified AFS errnos' (uae)

2003-03-05  Love  <lha@@stacken.kth.se>

	* appl/afstool: use getarg style --no-auth like the rest for the
	arguments, fix auth
	
	* appl/afstool: add ubik debug

	* appl/afstool/afstool.1: fs gettime
	
	* appl/afstool/at_locl.h: add mini_cachemanager_init and
	fs_gettime_cmd

	* appl/afstool/Makefile.am: add mini cm, gettime and link with
	librxcbserver

	* appl/afstool/at_fileserver.c: plug in gettime
	
	* appl/afstool/at_fs_gettime.c: fetch time from fileserver
	
	* appl/afstool/at_mini_cm.c: add yet another mini cache-manager
	
	* rx/rx_user.h (rxi_GetUDPSocket): return the portnumber we bound to
	* rx/rx_user.c (rxi_GetUDPSocket): return the portnumber we bound to

	* rx/rx.c: find out the portnumber we bound too
	
	* appl/afstool/afstool.c (main) call rx_Init(0)
	
	* arlad/cmcb.c: prefix callback manager stubs with S
	
	* ydr/output.c (generate_server_stub): prefix server stubs with S
	
	* ydr/output.c: move the server parsing stubs into private
	namespace and make them static

	* appl/afstool/at_fs_flush_cps.c: remove stale comment

	* appl/afstool/at_cm_{localcell,whoareyou}.c: make use of for loop
	to make it look like other code in same directory

	* appl/afstool/afstool.c: add aliases for fileserver (fs) and
	cachemanager (cm)

	* appl/perf/afsfsperf.c: add dummy for GetCellByNum and
	TellMeAboutYourself

	* arlad/cmcb.c: add dummy for GetCellByNum and implement
	TellMeAboutYourself
	
	* rxdef/cb.xg: add GetCellByNum and TellMeAboutYourself
	
	* appl/afstool/Makefile.am: install manpage
	
	* appl/afstool/at_cm_localcell.c: getarg-ify, make more sane
	* appl/afstool/at_cm_whoareyou.c: getarg-ify, make more sane
	* appl/afstool/afstool.1: getarg-ify, make more sane

	* appl/afstool/afstool.1: mdoc fixes
	
2003-03-04  Love  <lha@@stacken.kth.se>

	* arlad/poller.c (poller_foreach): new function
	
	* appl/afstool/afstool.1: manpage for afstool
	
	* configure.in: remove cbdebug
	
	* appl/afstool: fold in cbdebug

	* appl/cbdebug: remove cbdebug, move to afstool
	
	* appl/afstool/at_locl.h: add some more headers
	
	* appl/perf/Makefile.in: link agaist the new cb lib
	
	* arlad/Makefile.in: link agaist the new cb lib
	
	* rxdef/Makefile.in: split callback stubs to their own libs
	
	* configure.in (AC_OUTPUT): add appl/afstool/Makefile

	* HACKING: add appl/afstool/Makefile
	
	* appl/afstool: afstool

	* arlad/fcache.c: improve logging when giving back callbacks
	
	* appl/fs/fs_connect.c: add callback-connected, connect and
	refetch callback we had before

	* arlad/poller.c: add poller_foreach and poller_iter_func
	
	* arlad/poller.h: add poller_foreach and poller_iter_func
	
	* arlad/fcache.c (fcache_giveup_all_callbacks): first try poller +
	giveup_all_callbacks
	(giveup_all_callbacks): give up all callback with new rpc function
	RXAFS_GiveUpAllCallBacks.
	(throw_entry): conn can never be NULL, check for aliveness instead
	(fcache_reobtain_callbacks): conn can never be NULL

	* rxdef/fs.xg: add GiveUpAllCallBacks, and FlushCPS add commented
	out versions of 64 bit fetch/store data
	
2003-03-03  Love  <lha@@stacken.kth.se>

	* arlad/messages.c (nnpfs_message_getdata): make comptible with
	open and set the DATA_W if requested.
	
2003-02-28  Tomas Olsson  <tol@@stacken.kth.se>

	* nnpfs/linux/nnpfs_inodeops.c (nnpfs_file_mmap): don't iref

2003-02-28  Love  <lha@@stacken.kth.se>

	* tests/run-tests.in: add mmap-and-fork
	
	* tests/mmap-and-fork.c: mmap and fork test
	
	* nnpfs/bsd/nnpfs_node-bsd.c (nnpfs_dnlc_enter): use
	nnpfs_vfs_unlock instead of VOP_UNLOCK

2003-02-26  Love  <lha@@stacken.kth.se>

	* nnpfs/bsd/nnpfs_node-bsd.c: OpenBSD 3.3 will have NetBSD 1.5
	dnlc semantics

2003-02-24  Tomas Olsson  <tol@@stacken.kth.se>

	* nnpfs/linux/nnpfs_message.c (clear_all_children): don't throw
	negative dentries, and it's the children we drop

2003-02-24  Mattias Amnefelt  <mattiasa@@e.kth.se>

	* nnpfs/linux/nnpfs_inodeops.c: nnpfs_d_revalidate: always return
	true if root node

2003-02-22  Love  <lha@@stacken.kth.se>

	* Add support for netbsd 1.6O

	* configure.in: fix openbsd makefile probing
	
2003-02-21  Tomas Olsson  <tol@@stacken.kth.se>

	* nnpfs/linux/nnpfs_message.c (clear_all_children): drop negative
	dentries

	* arlad/messages.c (*): send messages to kernel before
	fcache_release()

2003-02-18  Tomas Olsson  <tol@@stacken.kth.se>

	* nnpfs/linux/nnpfs_message.c (nnpfs_d_remove): added
	(nnpfs_message_installnode): handle new inode != existing better
	(clear_all_children): use dcache_lock, don't use xdentry if null,
	use nnpfs_d_remove()
	(d_prune_aliases): use nnpfs_d_remove()

2003-02-17  Love  <lha@@stacken.kth.se>

	* configure.in: decrease world pain by setting AM_MAINTAINER_MODE,
	now Makefile.in isn't rebuilt when Makefile.am have a newer
	timestamp

2003-02-16  Tomas Olsson  <tol@@stacken.kth.se>

	* nnpfs/linux/nnpfs_message.c: make it compile

2003-02-16  Love  <lha@@stacken.kth.se>

	* nnpfs/linux/nnpfs_message.c (clear_all_children): throw way
	unused nodes more aggressively (that is, remove then, don't just
	unhash them)

2003-02-15  Love  <lha@@stacken.kth.se>

	* nnpfs/linux/nnpfs/nnpfs_locl.h: define I_DIRTY_DATASYNC to 0 if
	it isn't there

	* nnpfs/bsd/nnpfs_vnodeops-bsd.c: even more extensive casting to
	print lk_lockholder

	* nnpfs/bsd/nnpfs/nnpfs_locl.h: include <sys/inttypes.h> try to
	define nnpfs_uintptr_t
	
	* configure.in: check for uintptr_t
	
	* appl/lib/ka-procs.c: remove som more memsets
	
	* tests/run-tests.in (ARLA_TESTS): add kill-mh
	
	* tests/kill-mh: unpacking and removing the "right" files in the
	test tar-ball that will trigger a bug in the directory removing
	code if it doesn't that care and consider directory page
	(DIRBLKSIZ) bounderies correctly, bug report and tarfile came from
	Nickolai Zeldovich <kolya@@MIT.EDU>

	* arlad/bsd-subr.c (dir_remove_name): make sure the d_reclen is
	too large so it will cross a page boundary, found by
	kolya@@mit.edu.

2003-02-14  Love  <lha@@stacken.kth.se>

	* appl/lib/ka-procs.c: make compile with new openssl >= 0.9.7,
	ignore type of key schedule

	* nnpfs/bsd/nnpfs_vnodeops-bsd.c: freebsd current make
	lk_lockholder to the thread (or so my spies say), so just cast to
	long long and print with %llx

	* nnpfs/bsd/nnpfs/nnpfs_locl.h: malloc(9) waits by default,
	freebsd post 5.0 choose to remove the flag, provide glue
	
	* */*: add copyright notice
	
2003-02-14  Tomas Olsson  <tol@@stacken.kth.se>

	* tests/asu.c (is_pag): getgroups() might not include egid in
	groups list

	* tests/build-emacs-j: bsd make wants an arg after -j, use 4

	* nnpfs/linux/Makefile.in: don't build getcwd on ia64

	* configure.in: added AM_CONDITIONAL for LINUX_IA64

2003-02-13  Fallsjo <fallsjo@@stacken.kth.se>

	* .cvsignore: Honor new name of autom4te cache

2003-02-12  Love  <lha@@stacken.kth.se>

	* arlad/arlad.8: rxkad-level, default is crypt
	* arlad/arla.c (rxkad_level_string): default to crypt
	
2003-02-11  Love  <lha@@stacken.kth.se>

	* nnpfs/linux/nnpfs_vfsops.c (nnpfs_statfs): bump values some to
	make it more pretty from Harald Barth <haba@@pdc.kth.se>
	
	* arlad/cred.c (cred_add): use cred_delete instead of
	recycle_entry, so when the entry is still in use we don't stomp
	all over it
	
	also, sprinkel asserts all over the place to make sure we don't
	use root node or reuse nodes that still have refcount

2003-02-11  Tomas Olsson  <tol@@stacken.kth.se>

	* arlad/messages.c (nnpfs_message_getdata): set datausedp in entry

	* appl/perf/Makefile.in: move up arlautil before roken in LIBS

2003-02-10  Love  <lha@@stacken.kth.se>

	* lib/ko/afs_uuid.c: when we use a randomized uuid, set the
	multicast bit to make sure we don't collied witha a real
	(allocated) address.

2003-02-10  Tomas Olsson  <tol@@stacken.kth.se>

	* nnpfs/linux/nnpfs_syscalls.c: declare sys_call_table as its
	actual type

	* nnpfs/linux/nnpfs_syscalls-lossage.c: don't check for
	sys_call_table

	* nnpfs/linux/nnpfs/nnpfs_syscalls.h: check for sys_call_table

	* appl/perf/Makefile.in: move up LIB_roken in LIBS

	* lib/Makefile.am: build editline before sl

2003-02-08  Love  <lha@@stacken.kth.se>

	* tests/run-tests.in: add read-past-eof
	
	* tests/Makefile.in: add read-past-eof
	
	* tests/read-past-eof.c: test for read past end of file
	
	* nnpfs/bsd/nnpfs_vnodeops-netbsd.c (nnpfs_netbsd_read): don't
	premit reading past end of file (found with mozilla)

2003-02-07  Love  <lha@@stacken.kth.se>

	* arlad/messages.c: replace assert_kernelp with assert_flag
	
	* arlad/fcache.c: replace assert_kernelp with assert_flag
	
	* arlad/arla_local.h: replace assert_kernelp with assert_flag
	
	* nnpfs/linux/nnpfs_syscalls.c: use [] for now on sys_call_table
	
2003-02-04  Love  <lha@@stacken.kth.se>

	* configure.in (netbsd,openbsd): we really want -f flags too when
	building lkms

	* lib/bufdir/fdir.c: trust length of directory file more then the
	data in the top of the file, this is slightly broken because what
	really happen was that we just removed a entry, and then shrinked
	the file because it was the last entry (and thus decremented the
	page-count), refetched the length from the fileserver and then
	expected the pagecount == size / AFSPAGESIZE

	* nnpfs/bsd/nnpfs_wrap-bsd.c (nnpfs_uninstall): detach malloc
	types when we are all done not completly right, but better then
	before

	* nnpfs/bsd/nnpfs_wrap-bsd.c: move malloc_type_detach from
	nnpfs_stat to nnpfs_uninstall

2003-02-03  Love  <lha@@stacken.kth.se>

	* nnpfs/linux/nnpfs_syscalls.c:
	s/sys_call_function/nnpfs_sys_call_function/g

	* nnpfs/bsd/nnpfs_wrap-bsd.c: attach/detach malloc types when
	loading module

	* nnpfs/bsd/nnpfs/nnpfs_locl.h: type argument to malloc is
	malloc_type in netbsd 1.6N

2003-02-03  Tomas Olsson  <tol@@stacken.kth.se>

	* nnpfs/linux/nnpfs_syscalls-lossage.c: make it compile, ifdef,
	define

	* nnpfs/linux/nnpfs_syscalls.c (install_afs_syscall): call
	nnpfs_fixup_syscall_lossage()

	* nnpfs/linux/nnpfs/nnpfs_locl.h: added
	nnpfs_fixup_syscall_lossage

	* nnpfs/linux/Makefile.in: build nnpfs_syscalls-lossage.c

2003-02-02  Love  <lha@@stacken.kth.se>

	* nnpfs/linux/nnpfs_node.c (nnpfs_iget): use get_empty_inode for
	linux22

	* nnpfs/linux/nnpfs_message.c (nnpfs_message_installdata): only
	whine when there is a real failure to do a fh_to_dentry
	
	* nnpfs/linux/nnpfs_node.c (nnpfs_iget): use new_inode (and
	unlock_new_inode in case we have I_NEW)

2003-02-01  Love  <lha@@stacken.kth.se>

	* doc/themis.texi: drop themis, live a life of its own now
	
	* doc/oddities.texi: s/Themis/Arla timeline/
	
	* doc/timeline.texi: s/Themis/Oddities/
	
	* doc/arla.texi: drop @@include themis.texi
	
	* appl/lib/tokens.c: don't bail out if cell == NULL, then we want
	all cells

	* rx/Makefile.in: help libtool find libko
	
	* nnpfs/linux/nnpfs/nnpfs_locl.h: add typedef for
	nnpfs_sys_call_function

	* nnpfs/linux/nnpfs_syscalls-lossage.c: for you to make compile
	and work and start to use ok'ed to put in copyrighted to KTH by
	Chaskiel when I asked him

2003-01-28  Love  <lha@@stacken.kth.se>

	* appl/fs/fs_listquota.c: more spaceing, 8 number for printing
	used space it not enougth

	* tests/write-and-stat: test that detects if dncl is there, or if
	we just live on tbl (really detects another bug, but this is fine
	for now)

	* nnpfs/bsd/nnpfs_node-bsd.c (nnpfs_cnp_init): if we have a
	namei_hash, use it

	* nnpfs/bsd/nnpfs_vnodeops-netbsd.c: fix printing of b_blkno
	
2003-01-27  Love  <lha@@stacken.kth.se>

	* appl/perf/afsfsperf.c: make the tests table drivern, now you can
	write afsfsperf ... -tests get-time,bulk-status

	* tests/check-sysname: remove set -x
	
	* tests/run-tests.in: ARLA_TESTS: add check-sysname
	
	* tests/check-sysname: check if sysname seems to work
	
	* arlad/messages.c (nnpfs_message_getnode): replace #if 0 assert
	with assert_kernelp()

	* nnpfs/bsd/nnpfs_vnodeops-common.c (nnpfs_attr_valid): fix logic,
	request node from userland when we don't have one of requested
	token or don't have the pag in the pag cache.
	
	* nnpfs/bsd/nnpfs/nnpfs_locl.h: help SCARG-less freebsd some more
	
	* appl/perf/afsfsperf.c: add bulkstatus perf testing
	
	* rxdef/Makefile.in: add depenecy on common.h where needed
	
2003-01-25  Love  <lha@@stacken.kth.se>

	* arlad/fcache.c (resolve_mp): use fcache_verify_data instead of
	fcache_get_data

	* nnpfs/bsd/nnpfs_message.c (nnpfs_message_updatefid): use new
	function nnpfs_update_handle, now that there are a fid hash
	instead of a list, we can't just update the handle in the
	nnpfs_node.

	* nnpfs/bsd/nnpfs_node.c: add nnpfs_update_handle
	
	* nnpfs/bsd/nnpfs/nnpfs_node.h: add nnpfs_update_handle
	
	* arlad/messages.c (nnpfs_message_getdata): use entry->fid as fid
	since it might have changed because of resolved mp's
	
2003-01-24  Tomas Olsson  <tol@@stacken.kth.se>

	* tests/intr-read.c: wait on killed children

	* lwp/plwp.c (*): indent, clean up debugging

2003-01-24  Love  <lha@@stacken.kth.se>

	* tests/intr-read.c: add comment why we kill children, "they smell
	bad" :)

	* tests/intr-read.c: kill children when parents is done
	
	* appl/fs/fs_diskfree.c: from dup printf, from Nickolai Zeldovich
	
2003-01-23  Tomas Olsson  <tol@@stacken.kth.se>

	* lib/bufdir/fbuf.c (mmap_copyrx2fd): adjust mapped length to
	pagesize

2003-01-23  Love  <lha@@stacken.kth.se>

	* lib/bufdir/fbuf.c (mmap_copy{rx2fd,fd2rx}): make these handle
	off/len that are not a multiple of the pagesize.
	
2003-01-22  Love  <lha@@stacken.kth.se>

	* nnpfs/bsd/nnpfs_dev-common.c (nnpfs_block_sigset): make the
	three diffrent cases define a macro that later code can use, this
	to make it easier to block new signals, and while I'm here, ignore
	SIGINFO

2003-01-21  Mattias Amnefelt  <mattiasa@@e.kth.se>

	* appl/Makefile.in: don't build themis and mpp
	* configure.in: don't build themis and mpp
	* util/.cvsignore: ignore Makefile.in
	* appl/themis appl/mpp: removed, they are now in their own repos

2003-01-20  Love  <lha@@stacken.kth.se>

	* arlad/fcache.c (dynroot_update_entry): no more spare, change to
	update fields

	* arlad/dynroot.c (dynroot_update_entry): no more spare, change to
	real version

	* ydr/Makefile.am: ydr_SOURCES: add header files
	
	* ydr/Makefile.am: CLEANFILES = lex.c parse.c parse.h
	
	* ydr/Makefile.am: YFLAGS= -d
	
	* rxdef/common.h: make the last for elements match the rest of the
	code

	* rxdef/common.h: drop all long/short/unsigned stuff and replace
	all by c99 types

	* rxdef/common.h (AFSFetchStatus): fill in the now no longer spare
	bits of FetchStatus

	* lib/Makefile.am: add libvers
	
	* rxdef/Makefile.in: add EXEEXT to ydr
	
	* ydr: automakeify

	* ydr: 64 bits encodeing/decodeing support (require presence of
	htole64/le64toh) verified same output with:
	perl -pi -e 's/sizeof\(tmp\)/sizeof\(int32_t\)/g' *.[ch]
	for a in *.[ch] ; do diff -uw $a old/$a ; done

	* lib/ko/kocell.c (cell_getthiscell): if the cell is unconfigured,
	return "unknown-cell-missing-configuration"
	
2003-01-19  Love  <lha@@stacken.kth.se>

	* nnpfs/bsd/nnpfs_syscalls-common.c (*): use syscall_d_thread_t,
	syscall_thread_to_thread

	* nnpfs/bsd/nnpfs/nnpfs_syscalls.h (*): use syscall_d_thread_t
	
	* nnpfs/bsd/nnpfs_syscalls-wrap-bsd.c (sys_lkmnosys): use
	syscall_d_thread_t

	* nnpfs/bsd/nnpfs/nnpfs_locl.h: add yet another glue type
	syscall_d_thread_t, this is the process/thread argument that
	syscall are called with, add a syscall_thread_to_thread macro that
	converts from a syscall_d_thread_t to a d_thread_t

	* nnpfs/bsd/nnpfs_dev-common.c (nnpfs_cursig): in netbsd 1.6M
	CURSIG takes a struct lwp disable this for now

	* nnpfs/bsd/nnpfs_dev-bsd.c, nnpfs/bsd/nnpfs_dev-common.c
	nnpfs/bsd/nnpfs_dev-osf.c, nnpfs/bsd/nnpfs/nnpfs_dev.h:
	nnpfs_devopen_common dont need struct proc, remove it

	* appl/cbdebug/cbdebug.h: update to changed signature of cbgetconn()
	* appl/cbdebug/localcell.c: ditto
	* appl/cbdebug/whoareyou.c: ditto

	* appl/cbdebug/cbdebug.c (cbgetconn): make it possible for
	cbgetconn to return hostname if not passed in.
	(*): change to use afscallbackport

	* rx/Makefile.in: fix rx_trace that I manage to break
	
	* rx/rx.c: s/long/int32_t/;s/short/int16_t/ where apropriate
	* rx/rx.h: s/long/int32_t/;s/short/int16_t/ where apropriate
	* rx/rx_misc.c: s/long/int32_t/;s/short/int16_t/ where apropriate
	* rx/rx_misc.h: s/long/int32_t/;s/short/int16_t/ where apropriate
	* rx/rx_globs.h: s/long/int32_t/;s/short/int16_t/ where apropriate
	* rx/rx_pkt.c: s/long/int32_t/;s/short/int16_t/ where apropriate
	* rx/rx_pkt.h: s/long/int32_t/;s/short/int16_t/ where apropriate
	* rx/rx_user.c: s/long/int32_t/;s/short/int16_t/ where apropriate
	* rx/rx_rxdebug.c: s/long/int32_t/;s/short/int16_t/ where apropriate
	
	* rx/rx_multi.h: remove register, s/long/int32_t/ where aproporate
	
	* rx/rx_kern.h: remove register
	* rx/rx_event.h: remove register
	* rx/rx_event.c: remove register
	
2003-01-18  Love  <lha@@stacken.kth.se>

	* arlad/SuidCells.5: improve
	
	* arlad/DynRootDB.5: improve
	
2003-01-17  Love  <lha@@stacken.kth.se>

	* appl/udebug/udebug.c: print version with print_version()
	(and cleanup usage string)

	* appl/kalog/kalog.c: print version with print_version()
	
	* appl/cbdebug/cbdebug.c: print version with print_version()

	* appl/cbdebug/Makefile.in: add libvers
	
	* appl/amon/amon.c: print version with print_version()
	
	* appl/pts/pts.c: use arlalib_version_cmd for version
	
	* appl/fs/fs.c: use arlalib_version_cmd for version
	
	* appl/lib/arlalib.h: add arlalib_version_cmd
	
	* appl/fs/Makefile.in: add libvers

	* appl/fs/fs.c: print version with print_version()
	
	* appl/lib/arlalib.h: drop fslib_version
	
	* appl/lib/fs_lib.c: drop fslib_version
	
	* arlad/arla-cli.c: print version with print_version()
	
	* arlad/arlad.c: print version with print_version()
	
	* appl/perf/afsfsperf.c: print version now and then
	
	* configure.in: AC_OUTPUT: add lib/vers/Makefile
	
	* lib/vers: add from heimdal/kth-krb

2003-01-15  Love  <lha@@stacken.kth.se>

	* nnpfs/bsd/nnpfs/nnpfs_locl.h: add missing #endif
	
	* lib/ko/Makefile.am: split CPPFLAGS to target_CFLAGS
	
2003-01-14  Tomas Olsson  <tol@@stacken.kth.se>

	* arlad/messages.c (nnpfs_message_getdata): OR new flags into
	msg.flags

2003-01-14  Love  <lha@@stacken.kth.se>

	* arlad/fcache.c (read_data, write_data): be more careful how
	updating of ->length and usedbytes is done to make sure its
	correct

	* nnpfs/bsd/nnpfs/nnpfs_locl.h: freebsd removed SCARG in 5.0RC3
	and later

	* lib/ko/Makefile.am: s/SYSCONFDIR/sysconfdir/
	
2003-01-13  Love  <lha@@stacken.kth.se>

	* HACKING: spell
	
2003-01-11  Love  <lha@@stacken.kth.se>

	* rxkad: change from old afs int32/u_int32 to iso c99 int32_t/uint32_t

	* includes/stds.h: drop compat glue for rxkad

	* util: drop copy_dirname/copy_basename

	* arlad/arla-cli.c: inline copy_dirname/copy_basename

	* appl/lib/arlalib.c: (arlalib_get_cred_krb): rewrite the code
	that fetches the server key to be simpler

	* HACKING: more automake

	* **/Makefile.in: use libtool library for libarlautil and libko

	* lib/ko/gensysname.c: change to use getarg (instead of agetarg)
	to drop circular dependcy for libtool

	* conf/Makefile.in: (arla.conf): depend on the right file

	* appl/afsutils/klog.c: fix (stupid) warning with cast

	* appl/aafs-perl/Makefile.in: fix building

	* util/heap.c: (heap_remove): compare dummy with the right thing

	* lib/Makefile, lib/ko/Makefile: generate with automake

	* README: update to reality

2003-01-10  Tomas Olsson  <tol@@stacken.kth.se>

	* arlad/arla.conf.5: spelling, clarify, explain fake_stat

	* arlad/{kernel,fcache,messages}.c: indent

2003-01-10  Love  <lha@@stacken.kth.se>

	* HACKING: add util/Makefile as a automake file
	
	* util/Makefile.am: automakeify
	
	* util/*.h: unify header protection and make it arlalib specific

	* arlad/fcache.h (FCacheEntry): remove datap
	
	* arlad/{fcache.c,inter.c,dynroot.c,unknown-subr.c}:
	remove all references to datap, instead use '->length',
	'->fetch_data', or just remove the paranoid assert.

	the state log doesn't change (value still stored), its just
	ignored when reading back the state
	
	* arlad/poller.c: some poller log statments
	
2003-01-09  Love  <lha@@stacken.kth.se>

	* nnpfs/bsd/nnpfs: (nnpfs_message_installdata): pass
	NNPFS_LOCKLEAF to namei

	* nnpfs/bsd/nnpfs/nnpfs_locl.h: provide glue for namei flag
	LOCKLEAF

	* arlad/messages.c (nnpfs_message_{open,getdata}): set msg.flag
	correctly

	* includes/kafs.h: add AFSCOMMONIOC_GKK5SETTOK (in arla space for now)
	
	* arlad/cred.h: add prototype for rxgk cred handling
	
	* arlad/messages.c: add prototype for rxgk cred handling

	* arlad/inter.h: new signature of cm_open
	
	* arlad/inter.c (cm_open): simplify, let other do the hard work
	
	* arlad/messages.c: Split message_getdata and message_open for
	now. They are quite simular, but I want to see the diffrences
	between them. Also, this fixes inc-open (again) since I broke it
	before.

	* arlad/fcache.c (fcache_get_data): directories can fetch part of
	the file, explain why we shold remove `update attr case' in this
	function.
	(fcache_update_length): set wanted_length to min of len we have and
	length of file so we don't got off and fetch the whole thing.
	(sum_node): don't look at datap/attrp, length will be 0 when there
	isn't any data

2003-01-07  Love  <lha@@stacken.kth.se>

	* arlad/kernel.c: name the workers with their worker id
	
2003-01-06  Love  <lha@@stacken.kth.se>

	* appl/lib/tokens.c (arlalib_token_iter): if there is unknown
	error from k_pioctl, bail out

2003-01-03  Tomas Olsson  <tol@@stacken.kth.se>

	* lwp/plwp.h: include windows.h after roken.h

	* lwp/plwp.c (*): indent, cleanup, more debugging

	* lwp/plwp.c (LWP_INT_SIGNAL): use SetEvent(), not PulseEvent()
	(Create_Process_Part2): handle locks properly around LWP_INT_WAIT

For older ChangeLog entries see ChangeLog.2002
@


1.5
log
@Merge
@
text
@@


1.4
log
@merge
@
text
@d1 1
a1 1
2002-02-25  Love Hörnquist-Åstrand  <lha@@stevens.e.kth.se>
d3 2
a4 1
	* Release 0.35.7
d6 2
a7 1
2002-02-24  Love  <lha@@stacken.kth.se>
d9 1
a9 3
	* tests/fhbench.c: include timevalsub and rename it to tvsub
	
2002-02-08  Love  <lha@@stacken.kth.se>
d11 2
a12 4
	* xfs/linux/xfs_inodeops.c: 1.174->1.175: (xfs_file_mmap): pass in
	the xfs-inode to data_valid instead of the cache-node
	
2002-02-06  Love  <lha@@stacken.kth.se>
d14 3
a16 6
	* xfs/linux/xfs_dev.c: 1.87->1.88:
	(free_node): create yet another free function, this one does
	consistency checks and replaces xfs_free(xn, XFS_MEM_XNODE)
	(xfs_queue_inactive): if the channel is closed, just free the node
	(xfs_process_inactive_queue): use free_node()
	(xfs_empty_inactive_queue): use free_node()
d18 3
a20 4
	* xfs/linux/xfs_syscalls.c: 1.69->1.70: (xfs_fh_to_dentry):
	linux-2.4: after a get_super, we need to drop_super(), w/o this,
	the we will fail to unmount the super block of the
	cache-filesystem.
d22 2
a23 1
2002-02-05  Love  <lha@@stacken.kth.se>
d25 4
a28 2
	* tests/copy-and-diff-gnu-mirror: 1.7->1.8: don't run unless use
	are running -large tests
d30 4
a33 6
	* tests/run-tests.in: 1.76->1.78: add option -large that avoids
	running tests that uses up large amount of diskspace (like
	copy-and-diff-gnu-mirror), add new option -fail that make test-run
	stop after the first failure
	
2002-02-01  Magnus Ahltorp  <ahltorp@@nada.kth.se>
d35 2
a36 7
	* appl/mac/Arla_Configuration/ReadCells.m: 1.2->1.3: Added static
	on local functions
	* appl/mac/Arla_Configuration/Makefile.in: 1.6->1.7: Use install
	instead of tar
	* appl/mac/Arla_Configuration/DataSource.m: 1.12->1.13: Added
	static on local functions 1.12->1.13: (checkdaemonpid): give -p to
	ps
d38 2
a39 1
2002-02-01  Love  <lha@@stacken.kth.se>
d41 2
a42 3
	* xfs/linux: dual license xfs for linux under bsd/gpl, update
	copyright years. See xfs/linux/license for more detailed
	information.
d44 1
a44 3
	* xfs/linux/xfs_node.c: adding missing symbol xfs_null_aops
	
2002-02-01  Magnus Ahltorp  <ahltorp@@nada.kth.se>
d46 2
a47 1
	* lwp/Makefile.in: Remove superfluous -lroken
d49 2
a50 1
	* cf/check-roken.m4: Reference libroken directly instead of with -l
d52 3
a54 1
2002-02-01  Love  <lha@@stacken.kth.se>
d56 2
a57 5
	* conf/CellServDB: 1.62->1.63: (theory.cornell.edu): removed, from
	Ruth Mitchell <mitchell@@tc.cornell.edu> on info-afs@@transarc.com
	
	* Fix support for linux-2.4. This is only tested with 2.4.17,
	  older version will probably not work.
d59 3
a61 6
	xfs_inodeops.c: 1.165->1.166
	xfs_message.c: 1.99->1.102
	xfs_node.c: 1.56->1.58
	xfs_vfsops.c: 1.75->1.77
	xfs/xfs_fs.h: 1.23->1.24
	xfs/xfs_locl.h: 1.51->1.52
d63 2
a64 1
2002-01-31  Love  <lha@@stacken.kth.se>
d66 1
a66 3
	* configure.in: 1.526->1.527: check for list_del_init
	* cf/linux-func-init-mutex.m4: 1.6->1.7: make test work when
	init_MUTEX is a macro (late linux-2.2)
d68 1
a68 2
	* configure.in: 1.474->1.475: (linux): test for struct
	dcache_operations.d_delete returning void
d70 3
a72 1
	* cf/linux-d_delete-void.m4: 1.1: added from current
d74 5
a78 1
2002-01-30  Love  <lha@@stacken.kth.se>
d80 6
a85 3
	* xfs/linux/xfs_dev.c: part of 1.82->1.83: use init_MUTEX
	* xfs/linux/xfs/xfs_locl.h: add from current, local define of
	init_MUTEX
d87 2
a88 1
2002-01-28  Love  <lha@@stacken.kth.se>
d90 1
a90 2
	* xfs/include/xfs/xfs_message.h: 1.46->1.47: add symbol
	XFS_XDELETED
d92 7
a98 1
2002-01-25  Magnus Ahltorp  <ahltorp@@nada.kth.se>
d100 14
a113 2
	* appl/mac/Arla_Configuration: Build appl/mac/Arla_Configuration
	with normal make
d115 9
a123 7
	* configure.in: 1.510->1.511: Build appl/mac/Arla_Configuration
	with normal make

2002-01-25  Love  <lha@@stacken.kth.se>

	* configure.in: Disable (arlad/fbuf) mmap for darwin for now, we
	get 0 byte long files sometime.
d125 1
a125 12
2002-01-22  Love  <lha@@stacken.kth.se>

	* xfs/bsd/xfs_message.c: 1.52->1.53: handle struct
	mount.mnt_nvnodelist (FreeBSD 4.5 and higher)

	* xfs/bsd/xfs_node-bsd.c: 1.59->1.60: handle struct
	mount.mnt_nvnodelist (FreeBSD 4.5 and higher)

	* configure.in (1.523->1.524): (FreeBSD): never set smp flags to
	"no"
	 (FreeBSD): test for struct mount.mnt_nvnodelist (the new name for
	mnt_vnodelist in 4.5 and above)
d127 1
a127 7
	* configure.in: unbreak the --enable-smp for both linux and
	freebsd, for freebsd is plainly didn't work, and for linux it
	didn't autoprobe

2001-12-20  Love  <lha@@stacken.kth.se>

	* tests/hardlink3: 1.2->1.3: hardlink3 is not fast
d129 1
a129 2
	* xfs/bsd/xfs_vfsops-netbsd.c: create a xfs_reinit
	* configure.in: 1.507->1.508: check for vfs_reinit
d131 2
a132 3
	* configure.in: 1.521->1.522: (netbsd,openbsd): make sure we pass
	in -I$SYS to incl
	(KERNEL_CPPFLAGS) since the <bsd.lkm.mk> might not set it.
d134 1
a134 1
2001-12-20  Mattias Amnefelt  <mattiasa@@e.kth.se>
d136 4
a139 1
	* arlad/fcache.c (try_next_fs): return true for RXKADUNKNOWNKEY
d141 1
a141 1
2001-11-24  Mattias Amnefelt  <mattiasa@@e.kth.se>
d143 1
a143 2
	* rx/rxdebug.c (1.11->1.12) print byte and packetcounters as
	unsigned
d145 1
a145 1
2001-11-16  Mattias Amnefelt  <mattiasa@@e.kth.se>
d147 1
a147 3
	* appl/vos/vos_{un,}lock.c send request to syncsite
	* rx/rxdebug.c (1.10->1.11) servers do return statistics
	* appl/vos/vos_listvldb.c (1.12 -> 1.13) handle partitions > 'z'
d149 2
a150 1
2001-10-24  Magnus Ahltorp  <ahltorp@@nada.kth.se>
d152 1
a152 2
	* lib/bufdir/fbuf.c: 1.15->1.16: msync doesn't take protection
	flags
d154 2
a155 1
	* appl/mac/make-mac-package.sh: Changed to /Library/StartupItems
d157 1
a157 2
	* lib/bufdir/fbuf.c: 1.14->1.15: Added msync before munmap where
	necessary
d159 3
a161 1
	* lib/ko/Makefile.in: 1.35->1.36: Added LDFLAGS
d163 1
a163 1
	* appl/vos/Makefile.in: 1.17->1.18: Added LDFLAGS
d165 7
a171 1
	* appl/udebug/Makefile.in: 1.14->1.15: Added LDFLAGS
d173 4
a176 1
	* appl/fs/Makefile.in: 1.16->1.17: Added LDFLAGS
d178 1
a178 1
	* appl/pts/Makefile.in: 1.14->1.15: Added LDFLAGS
d180 4
a183 1
	* appl/bos/Makefile.in: 1.15->1.16: Added LDFLAGS
d185 1
a185 1
	* appl/afsutils/Makefile.in: 1.19->1.20: Added LDFLAGS
d187 3
a189 1
	* appl/Makefile.in: Only build kalog when we have tf_util
d191 2
a192 2
	* cf/check-kerberos.m4: 1.39->1.40: Added support for Mac OS X
	built-in kerberos and kth-krb with openssl
d194 2
a195 1
	* configure.in: 1.520->1.521: Don't use libroken in tf_util test.
d197 1
a197 1
2001-10-22  Love  <lha@@stacken.kth.se>
d199 4
a202 2
	* configure.in: freebsd[45]): when build with --enable-smp tag on
	APIC_IO since its needed (true for alpha too ?)
d204 6
a209 1
2001-10-22  Magnus Ahltorp  <ahltorp@@nada.kth.se>
d211 11
a221 2
	* configure.in: 1.517->1.519: Added -flat_namespace on Mac OS X.
	Only compile kalog if there is a tf_init.
d223 3
a225 1
2001-10-19  Magnus Ahltorp  <ahltorp@@nada.kth.se>
d227 3
a229 2
	* xfs/bsd/xfs_message.c: 1.70->1.72: (xfs_message_invalidnode):
	Don't treat node as used if only UBC uses it.
d231 1
a231 5
	* xfs/bsd/xfs_vnodeops-common.c: 1.77->1.78:
	(xfs_inactive_common): Clear dirty flag when fsync fails
	1.78->1.79: (xfs_read_common): Do not print out random memory
	1.79->1.80: (xfs_open_valid): Call xfs_handle_stale 1.79->1.80:
	Added xfs_handle_stale
d233 11
a243 4
	* xfs/bsd/xfs/xfs_locl.h: 1.50->1.51: xfs_set_vp_size is called
	ubc_setsize on Darwin

	* arlad/messages.c (xfs_message_getroot): Correct typo
d245 1
a245 1
2001-10-16  Magnus Ahltorp  <ahltorp@@nada.kth.se>
d247 1
a247 2
	* arlad/messages.c: 1.263->1.264: (xfs_message_getroot): Set
	tokens in installroot message
d249 1
a249 4
2001-10-14  Love  <lha@@stacken.kth.se>

	* conf/CellServDB: mc.vanderbilt.edu removed, from David Krause
	<david.w.krause@@vanderbilt.edu> on arla-drinkers
d251 2
a252 1
2001-10-11  Magnus Ahltorp  <ahltorp@@fridge.nada.kth.se>
d254 1
a254 1
	* Release 0.35.6
d256 2
a257 1
2001-10-09  Love  <lha@@stacken.kth.se>
d259 1
a259 2
	* arlad/fcache.c: (get_attr_bulk): avoid updating entries that are
	locked, fixes tests/hardlink3
d261 2
a262 1
	* tests/hardlink3: added test that trigged bulkstatus bug
d264 2
a265 1
2001-10-08  Magnus Ahltorp  <ahltorp@@nada.kth.se>
d267 2
a268 2
	* INSTALL: Updated
	* README: Updated
d270 2
a271 1
2001-10-04  Assar Westerlund  <assar@@sics.se>
d273 3
a275 4
	* appl/lib/ka-procs.c (ka_authenticate): handle k_afsklog
	* appl/afsutils/klog.c (get_afs_token), appl/afsutils/aklog.c
	(krb_afslog_uid): k_afslog -> k_afsklog_uid
	(which always was the old name)
d277 3
a279 1
2001-10-02  Love  <lha@@stacken.kth.se>
d281 1
a281 1
	* cf/check-kerberos.m4: replace -lroken with $LIB_roken
d283 1
a283 1
2001-10-01  Mattias Amnefelt  <mattiasa@@e.kth.se>
d285 6
a290 2
	* arlad/fcache.c (1.349->1.350) (get_root_of_volume): always try
	to get the best credential
d292 1
a292 1
2001-09-30  Magnus Ahltorp  <ahltorp@@nada.kth.se>
d294 4
a297 1
	* xfs/bsd/xfs/xfs_dev.h: Support three argument selrecord
d299 10
a308 1
	* xfs/bsd/xfs_dev-bsd.c: Support three argument selrecord
d310 7
a316 1
2001-09-28  Mattias Amnefelt  <mattiasa@@e.kth.se>
d318 9
a326 1
	* arlad/conn.h: increase fuzz by a factor of 1000
d328 3
a330 1
2001-09-26  Mattias Amnefelt  <mattiasa@@e.kth.se>
d332 6
a337 1
	* appl/vos/vos_listpart.c: null terminate agetarg list
d339 7
a345 1
2001-09-24  Magnus Ahltorp  <ahltorp@@nada.kth.se>
d347 1
a347 1
	* configure.in: Removed building of mac applications
d349 4
a352 1
2001-09-23  Assar Westerlund  <assar@@sics.se>
d354 4
a357 7
	* arlad/messages.c (1.261->1.262): (try_again): do not invalidate
	the volcache entry on VNOVOL, it's done in fcache.c:try_next_fs
	now
	* arlad/fcache.c (merge 1.347->1.348): (try_next_fs): send in fid
	too.  and mark volcache entry as invalid on VNOVOL and VMOVED.
	this way we actually mark volcache entries as invalid and refresh
	them even when there are other r/o clones that work
d359 2
a360 1
2001-09-21  Mattias Amnefelt  <mattiasa@@e.kth.se>
d362 8
a369 1
	* rx/rxdebug.c (GetVersion) Check return codes
d371 10
a380 1
2001-09-19  Mattias Amnefelt  <mattiasa@@e.kth.se>
d382 1
a382 4
	* appl/vos/vos_examine.c: Print info from vldb even if we can't 
	reach fileserver 
	* appl/vos/vos_examine.c: (printvolstat) only print volumeid when 
	clone exists
d384 2
a385 1
2001-09-18  Mattias Amnefelt  <mattiasa@@e.kth.se>
d387 2
a388 4
	* appl/vos/vos_examine.c: use VLSF_DONTUSE information
	* appl/vos/vos.c: added vos backup and vos backupsys
	* appl/vos/vos_common.c (get_vlentry): try to find
	dbserver if it's not given
d390 2
a391 1
2001-09-17  Mattias Amnefelt  <mattiasa@@e.kth.se>
d393 10
a402 12
	* rxdef/vldb.xg: use nvldbentry in ReleaseEntryN
	* appl/vos/vos_listvol.c: argument partition is aarg_optional_swless
	* appl/vos/vos_local.h: added backup, backupsys and volname
	* appl/vos/vos_backup.c: added
	* appl/vos/Makefile.in: added vos_backup.c
	* appl/vos/vos_listvldb.c: correct termination of listvldb
	* appl/vos/vos_listvldb.c: (listvldb_iter): use VL_ListAttributes 
	interface, and allow to mask on
	* appl/vos/vos_listvldb.c: serverna me and partition take volume 
	as argument, print volumeids
	* appl/vos/vos_backup.c (vos_backupsys): send volumename to
	vos_listvldb_iter
d404 3
a406 1
2001-09-17  Love  <lha@@stacken.kth.se>
d408 3
a410 3
	* xfs/bsd/xfs_node-bsd.c (free_all_xfs_nodes): if we have a
	vfs_deallocate_syncvnode, use that to free the syncer-node, indent
	* configure.in: check for vfs_deallocate_syncvnode
d412 3
a414 1
2001-09-15  Mattias Amnefelt  <mattiasa@@e.kth.se>
d416 11
a426 6
	* lib/ko/gensysname.c: find better sysname for alpha osf
	* appl/fs/fs.c (fsversion_cmd): test for correct number of
	arguments
	* rx/rxdebug.c: Use agetarg instead of libcmd
	* rx/Makefile.in: link rxdebug with libko
	* Makefile.in: build rx after libko
d428 3
a430 1
2001-09-14  Love  <lha@@stacken.kth.se>
d432 1
a432 6
	* arlad/messages.c: 1.257->1.258: (try_again): when fileserver
	busy or restarting, wait afs_BusyWaitPeriod seconds, this is the
	same timeout as transarc/openafs has.
	* arlad/arla.c: 1.137->1.138: set afs_BusyWaitPeriod to 15 (as
	transarc/openafs does)
	* arlad/arla_local.h: 1.66->1.67: export afs_BusyWaitPeriod
d434 2
a435 3
	* arlad/messages.c: 1.256->1.257: (vioc_new_cell): memset dbs,
	make sure we a static entry
	(timeout == 0)
d437 10
a446 1
2001-09-09  Mattias Amnefelt  <mattiasa@@e.kth.se>
d448 4
a451 1
	* rx/rxdebug.c (MakeCall): check return codes
d453 4
a456 1
2001-09-07  Magnus Ahltorp  <ahltorp@@nada.kth.se>
d458 1
a458 1
	* config.guess, config.sub: update to newer versions
d460 1
a460 1
2001-09-07  Love  <lha@@stacken.kth.se>
d462 3
a464 1
	* conf/CellServDB: 1.58->1.59: added dynarc.se
d466 7
a472 1
2001-09-06  Magnus Ahltorp  <ahltorp@@nada.kth.se>
d474 1
a474 2
	* xfs/solaris/xfs_node.c: 1.16->1.17: (new_xfs_node): Set tokens
	from message
d476 2
a477 1
2001-09-05  Magnus Ahltorp  <ahltorp@@nada.kth.se>
d479 1
a479 4
	* xfs/linux/xfs_node.c: 1.54->1.55: (new_xfs_node): Set tokens
	from message
	* xfs/bsd/xfs_node-bsd.c: 1.55->1.56: (new_xfs_node): Set tokens
	from message
d481 2
a482 1
2001-09-04  Magnus Ahltorp  <ahltorp@@nada.kth.se>
d484 1
a484 2
	* configure.in: Added selrecord test
	* cf/bsd-func-selrecord.m4: Added selrecord test
d486 1
a486 1
2001-09-04  Love  <lha@@stacken.kth.se>
d488 1
a488 3
	* arlad/fcache.c: 1.342->1.343: (find_first_fs): don't use entries
	maked by the vldb server as VLSF_DONTUSE, there are volumes marked
	up my the vldb server as non released volumes.
d490 1
a490 1
2001-09-04  Magnus Ahltorp  <ahltorp@@nada.kth.se>
d492 2
a493 2
	* arlad/conn.c: 1.64->1.65: (re_probe): If sleeping already,
	choose the earliest wakeup
d495 2
a496 1
2001-09-03  Love  <lha@@stacken.kth.se>
d498 1
a498 6
	* xfs/bsd/xfs_node-bsd.c: 1.54->1.55:
	(free_all_xfs_nodes/xfs_vflush): do magic with syncer-node on
	freebsd, this is since FreeBSD > 4.3 changed vflush api so we have
	to remove the mnt_syncer node first before calling vflush to avoid
	dying in a deadlock. break out vflush to a common function
	xfs_vflush().
d500 5
a504 1
2001-08-31  Magnus Ahltorp  <ahltorp@@nada.kth.se>
d506 1
a506 1
	* util/hash.c: 1.14->1.15: Added hashtabrelease
d508 3
a510 4
	* util/hash.c: 1.15->1.16: (hashtabcleantab): Free the correct
	pointer
	
	* util/hash.h: 1.6->1.7: Added hashtabrelease
d512 1
a512 1
2001-08-01  Love  <lha@@stacken.kth.se>
d514 1
a514 3
	* xfs/linux/xfs_syscalls.c: fix merge error
	
2001-07-26  Love  <lha@@stacken.kth.se>
d516 1
a516 5
	* appl/pts/pts.1: 1.1->1.2: remove .Pp before .Sh, from openbsd
	
	* xfs/bsd/xfs_vnodeops-bsd.c: 1.94->1.95, 1.96->1.97:
	(xfs_symlink): NetBSD 1.5X/OpenBSD current
	(aka version 200107) and above doesn't vput the created symlink
d518 3
a520 6
	* xfs/linux/xfs_syscalls.c: 1.66->1.67: (fhget_call): make
	`dentry' const and never dput it
	(user_path2dentry): define it differently for 2.3
	(sys_afs_int): move dput to the end of the function and call
	path_release in 2.3 1.65->1.66: (xfs_debug_print): call
	print_dentry
d522 1
a522 1
2001-07-26  Assar Westerlund  <assar@@stacken.kth.se>
d524 2
a525 5
	* xfs/linux/xfs_dev.c:1.80->1.81: (xfs_devwrite): do not set dumpable
	* arlad/arlad.c (arla_start): 1.9->1.10: set dumpable 
	with prctl if possible
	* arlad/arla_local.h: 1.63->1.64: add sys/prctl.h
	* configure.in: 1.496->1.497: check for sys/prctl.h
d527 2
a528 1
2001-07-25  Magnus Ahltorp  <ahltorp@@nada.kth.se>
d530 14
a543 2
	* xfs/bsd/xfs_vnodeops-bsd.c:1.95->1.96: (xfs_remove): call
	ubc_uncache after vput:ing (on osx/darwin)
d545 3
a547 1
2001-07-16  Love  <lha@@stacken.kth.se>
d549 1
a549 1
	* Release 0.35.5
d551 2
a552 1
2001-07-16  Love  <lha@@stacken.kth.se>
d554 3
a556 7
	* xfs/bsd/xfs_vnodeops-osf.c: 1.29->1.30: make *common functions
	not handle any vrele/vput. add the correct vrele's to the osf
	functions
	* xfs/bsd/xfs_vnodeops-common.c: 1.74->1.75: make *common
	functions not handle any vrele/vput
	* xfs/bsd/xfs_vnodeops-bsd.c: 1.93->1.94: make *common functions
	not handle any vrele/vput
d558 6
a563 1
2001-07-15  Love  <lha@@stacken.kth.se>
d565 2
a566 2
	* arlad/fcache.c: 1.337->1.338: (get_attr_bulk): make comparison
	simpler to understand
d568 1
a568 4
	* arlad/fcache.c: 1.337->1.337: (get_attr_bulk): when getting the
	fid to install the addr, use a fid will some !random value in it
	
2001-07-14  Love  <lha@@stacken.kth.se>
d570 1
a570 3
	* lib/cmd/Makefile.in: 1.5->1.6: link testc with @@LIBS@@
	* configure.in: 1.494->1.495: check for get_progname set_progname
	warnerr
d572 1
a572 1
2001-07-11  Mattias Amnefelt  <mattiasa@@e.kth.se>
d574 1
a574 2
	* xfs/bsd/bin/startarla.in: added support for dux
	* xfs/bsd/bin/Makefile.in: build startarla on dux
d576 1
a576 1
2001-07-09  Love  <lha@@stacken.kth.se>
d578 1
a578 3
	* lib/ko/kocell.c: 1.49->1.50: (host_sort): don't use E->name,
	since it might be NULL in case we did a ``fs newcell'', noted by
	Nickolai Zeldovich <kolya@@mit.edu>
d580 4
a583 1
2001-07-06  Love  <lha@@stacken.kth.se>
d585 2
a586 2
	* appl/lib/arlalib.c: 1.41->1.42: (arlalib_try_next_db): Use
	ARLA_CALL_DEAD instead of RX_CALL_DEAD
d588 6
a593 4
	* appl/pts/pts.c: 1.52->1.53: membership: Move error handling to
	outside of the server trying loop.  Handle non-existing users and
	groups.
2001-07-06  Mattias Amnefelt  <mattiasa@@e.kth.se>
d595 1
a595 2
	* conf/CellServDB changed vldb for it.kth.se according to
	<elu@@it.kth.se>
d597 1
a597 1
2001-07-06  Love  <lha@@stacken.kth.se>
d599 1
a599 4
	* rx/rx_pkt.c: 1.15->1.16: (rxi_SendDebugPacket): truncate the iov
	to the size of the outgoing packet
	
2001-06-27  Mattias Amnefelt  <mattiasa@@e.kth.se>
d601 1
a601 2
	* xfs/bsd/xfs_node-osf.c: (free_all_xfs_nodes) 1.23 -> 1.24 :
	vflush the mountpoint after relasing the root vnode
d603 3
a605 1
2001-06-11  Love  <lha@@stacken.kth.se>
d607 1
a607 3
	* arlad/DynRootDB.5: clarify what happens if .Nm doesn't exist
	
2001-06-06  Assar Westerlund  <assar@@sics.se>
d609 2
a610 1
	* xfs/solaris/bin: move startarla, mount_xfs from bin to sbin
d612 2
a613 1
2001-06-06  Magnus Ahltorp  <ahltorp@@fridge.nada.kth.se>
d615 1
a615 1
	* Release 0.35.4
d617 1
a617 1
2001-06-05  Magnus Ahltorp  <ahltorp@@nada.kth.se>
d619 1
a619 1
	* arlad/{inter.c,messages.c}: Disable attrusedp asserts
d621 1
a621 3
	* arlad/{adir.c,adir.h,inter.c,messages.c}: Renamed from
	adir_lookup_fcacheentry to adir_lookup. Removed old adir_lookup.
	Use new adir_lookup instead.
d623 1
a623 1
	* arlad/{discon_log.c,reconnect.c}: Disable nonworking functions.
d625 6
a630 1
2001-06-04  Mattias Amnefelt  <mattiasa@@e.kth.se>
d632 1
a632 4
	* xfs/bsd/xfs_vfsops-osf.c: test for vfs_swapvp and vfs_smoothsync
	* xfs/bsd/xfs_syscalls_common.c: don't use fhlookup on dux
	* configure.in: test for vfs_swapvp and vfs_smoothsync in struct
	vfsops (for dux)
d634 9
a642 1
2001-05-29  Mattias Amnefelt  <mattiasa@@e.kth.se>
d644 2
a645 10
	* xfs/bsd/xfs_{vnodeops,node}-osf.c: general update of the osf/1
	code. Doesn't crash immidiately
	* lib/sl/lex.l,ydr/lex.l: build with lex on dux 4.0d
	* arlad/Makefile.in: use correct syntax
	* cf/osf-func-vfs-name-hash.m4: function to find out more about 
	vfs_name_hash()
	* cf/try-compile-kernel.m4: use KERNEL_CC if it is defined
	* configure.in: find out more about vfs_name_hash on osf/1
	* appl/{afsutils,amon,asrvutil,bos,fs,kalog,pts,udebug,vos}/Makefile.in
	lib/ko/Makefile.in: build working makefile even if @@LIBS@@ is empty
d647 6
a652 1
2001-05-28  Magnus Ahltorp  <ahltorp@@nada.kth.se>
d654 3
a656 2
	* arlad/{dynroot.c,dynroot.h,fcache.c}: Make dynroot add
	CallerAccess to creds
d658 2
a659 1
2001-05-22  Magnus Ahltorp  <ahltorp@@nada.kth.se>
d661 1
a661 1
	* arlad/fcache.c: Allow setting of highvnodes.
d663 2
a664 1
2001-05-17  Magnus Ahltorp  <ahltorp@@nada.kth.se>
d666 2
a667 1
	* configure.in: Arla configuration program for Mac OS X
d669 2
a670 1
	* appl/mac/Makefile.in: Added mac directory
d672 1
a672 8
	* appl/mac/Arla_Configuration/English.lproj/InfoPlist.strings:
	Arla configuration program for Mac OS X
	
	* appl/mac/Arla_Configuration/English.lproj/MainMenu.nib/{classes.nib,
	info.nib, objects.nib}: Arla configuration program for Mac OS X

	* appl/mac/Arla_Configuration/Arla_Configuration.pbproj/
	project.pbxproj.in: Arla configuration program for Mac OS X
d674 2
a675 3
	* appl/mac/Arla_Configuration/{Controller.h, Controller.m,
	DataSource.h, DataSource.m, Makefile.in, ReadCells.h, ReadCells.m,
	arla.icns, main.m}: Arla configuration program for Mac OS X
d677 2
a678 2
	* arlad/messages.c (viocgetcacheparms): Return lowbytes and
	lowvnodes.
d680 2
a681 1
	* arlad/fcache.[ch]: Added fcache_lowbytes and fcache_lowvnodes.
d683 1
a683 1
2001-05-17  Love  <lha@@stacken.kth.se>
d685 1
a685 4
	* xfs/bsd/bin/startarla.in: remove symbol file before loading
	kernel module
	* xfs/bsd/bin/startarla.in: use /var/db so the data is kept after
	a crash
d687 2
a688 1
2001-05-07  Love  <lha@@stacken.kth.se>
d690 2
a691 2
	* xfs/bsd/xfs/xfs_locl.h: Fixed merge error, va_size_t differ
	between osf/1 other BSDs, this is correct in current
d693 2
a694 2
	* xfs/bsd/bin/startarla.in: same for platforms (macosx) using
	kmodload
d696 1
a696 3
	* xfs/bsd/bin/startarla.in: Store the output file from modload and
	modstat in /var/run so it will be possible to debug the kernel
	core
d698 10
a707 1
2001-05-07  Magnus Ahltorp  <ahltorp@@nada.kth.se>
d709 4
a712 1
	* arlad/inter.c (cm_open): assert attrusedp when setting datausedp
d714 3
a716 1
	* arlad/fcache.c (stale): Don't clear attrusedp and datausedp
d718 1
a718 2
	* arlad/messages.c: Assert or set attrusedp when setting datausedp
	(break_callback): Don't clear kernelp, attrusedp and datausedp
d720 2
a721 2
	* cf/linux-filldir-dt-type.m4: try actually calling a filldir_t
	function. just assigning a pointer is not a fatal error
d723 3
a725 2
	* arlad{DynRootDB.5,Makefile.in,arlad.8,dynroot.c}, lib/ko/{ko.h,
	kocell.c}: Add support for DynRootDB
d727 2
a728 1
2001-04-30  Love  <lha@@stacken.kth.se>
d730 3
a732 4
	* arlad/{arla.c,arla_local.h,arlad.c,arladeb.c,arladeb.h,arlad.8}:
	added option --cpu-usage
	* util/log.[ch]: added support for printing cpu usage on each line
	* configure.in: check for getrusage
d734 2
a735 1
2001-04-28  Love  <lha@@stacken.kth.se>
d737 3
a739 1
	* README: 1.78->1.79: openbsd
d741 4
a744 1
2001-04-28  Mattias Amnefelt  <mattiasa@@e.kth.se>
d746 11
a756 28
	* xfs/bsd/xfs_node-osf.c (xfs_dnlc_purge_mp) don't use
	cache_purgevfs() if not available
	* xfs/bsd/xfs_syscalls-wrap-osf.c: use sy_info in struct sysent on
	dux 5.1
	* xfs/bsd/xfs_vfsops-osf.c: added xfs_mountroot, xfs_swapvp,
	xfs_smoothsync from dux vfsops
	* configure.in: test for sys/vfs_proto.h sys/vnode.h and
	function cache_purgevfs()
	* xfs/bsd/xfs_node-osf.c: 
	(xfs_dnlc_enter): set ni_makeentry when calling cache_lookup
	(xfs_cnp_init): compute cache correctly
	* xfs/bsd/xfs_vnodeops-osf.c: set name in ndp->cn_nameptr when 
	symlinking
	* xfs/bsd/xfs_vnodeops-osf.c: xfs_{mkdir,create}: set
	ndp->cn_nameptr before calling lookup
	* xfs/bsd/xfs_vnodeops-osf.c (xfs_lookup): Need to set pointer to
	the parent directory.
	* xfs/bsd/xfs/xfs_locl.h, xfs/bsd/xfs_vnodeops-common.c: use
	va_size_t instead of u_quad_t
	* xfs/bsd/xfs_vfsops-common.c: Wrap vfs_getnewfsid in autoconf
	ifdef
	* xfs/bsd/xfs_node-osf.c: new function xfs_dnlc_lock, doing dnlc
	locking on osf
	* xfs/bsd/xfs_message.c: there is no vrecycle on osf
	* xfs/bsd/xfs_common.c, xfs/bsd/xfs_common-bsd.c: moved memcpy to
	xfs_common.c
	* configure.in: test for vfs_mountroot in vfsops and sy_info in
	sysent
d758 2
a759 1
2001-04-22  Love  <lha@@stacken.kth.se>
d761 4
a764 3
	* lib/ko/ports.c: 1.10->1.11: (ports_init): make quiet since
	people can't right and add services into their services file (or
	equivalent)
d766 3
a768 6
2001-04-21  Love  <lha@@stacken.kth.se>

	* arlad/cred.c: 1.34->1.36: remove cred from hashtab when its
	killed, update copyright
	* arlad/conn.c: 1.62->1.64: remove conn from hashtab when its
	killed.
d770 2
a771 4
2001-04-18  Love  <lha@@stacken.kth.se>

	* conf/CellServDB: 1.50->1.51: mit cells zone.mit.edu and
	ops.mit.edu have moved From Nickolai Zeldovich <kolya@@MIT.EDU>
d773 1
a773 2
	* appl/lib/tokens.c: 1.2->1.3: (arlalib_token_iter): return right
	thing, From Nickolai Zeldovich <kolya@@MIT.EDU>
d775 1
a775 3
	* appl/bos/bos_listusers.c: 1.6->1.7: (printusers): only print
	user when we are are getting back good data, From Nickolai
	Zeldovich <kolya@@MIT.EDU>
d777 1
a777 5
	* arlad/fcache.c: 1.325->1.326: (getacl): fix problem that opaque
	can be uninitialized when returning errors, when caller might do
	stupid things, found by Nickolai Zeldovich <kolya@@MIT.EDU>
	
2001-04-17  Love  <lha@@stacken.kth.se>
d779 1
a779 2
	* cf: quote argument to undefine, patch by 
	Hidvegi	<hzoli@@austin.ibm.com>
d781 2
a782 1
2001-04-12  Magnus Ahltorp  <ahltorp@@nada.kth.se>
d784 5
a788 1
	* configure.in: Compile with -traditional-cpp on Mac OS X
d790 2
a791 1
2001-04-05  Magnus Ahltorp  <ahltorp@@nada.kth.se>
d793 1
a793 3
	* configure.in, cf/check-kernel.m4,
	xfs/bsd/xfs_syscalls-wrap-macos.c: Make it build on Mac OS X
	release
d795 4
a798 1
2001-04-04  Love  <lha@@stacken.kth.se>
d800 4
a803 5
	* arlad/fcache.c: 1.324->1.325: (find_first_fs): memset context,
	in case we fail to update the volume, context will contains data
	that free_fs_server_context() will grok.
	
2001-03-25  Love  <lha@@stacken.kth.se>
d805 1
a805 2
	* xfs/linux/xfs_dev.c: 1.78->1.79: (xfs_message_rpc): ignore
	SIGSTOP, this make ptrace() work
d807 4
a810 1
2001-03-23  Love  <lha@@stacken.kth.se>
d812 1
a812 3
	* arlad/fcache.c (get_attr_bulk): if parent entry is missing data,
	bail out and force regular get_attr
	(getvolstat): remove unused code
d814 2
a815 1
2001-03-12  Love  <lha@@stacken.kth.se>
d817 2
a818 1
	* Release 0.35.3
d820 3
a822 1
	* util/heap.c (heap_new): don't fail if malloc(0) return NULL.
d824 1
a824 2
	* lib/ko/kocell.c: 1.47->1.78: handle cells with zero cells on
	computer with malloc returns NULL on malloc(0).
d826 2
a827 4
	* arlad/kernel.c: 1.27->1.29: handle case when running out of
	threads better

2001-03-06  Tomas Olsson  <tol@@stacken.kth.se>
d829 2
a830 1
	* tests/run-tests.in: 1.70->1.71: don't run compare-inum-mp
d832 2
a833 1
2001-03-04  Love  <lha@@stacken.kth.se>
d835 1
a835 3
	* xfs/linux/xfs_message.c: make got data w/o token more quiet
	* appl/lib/arlalib.h: 1.37->1.38: fs_checkvolumes
	* appl/lib/fs_lib.c: 1.31->1.32: fs_checkvolumes
d837 1
a837 2
	* include/afssysdefs.h: solaris 8 uses 65, openbsd uses 208,
	freebsd uses 339
d839 1
a839 5
	* ydr/output.c: 1.73->1.74: remember to code INOUT argument too
	* rxdef/pts.xg: 1.14->1.15: (ListOwned): over in INOUT
	
	* xfs/bsd/xfs_syscalls-wrap-bsd.c: 1.11->1.12: xfs_syscallent,
	check for HAVE_STRUCT_SYSENT_SY_FLAGS
d841 4
a844 1
	* appl/lib/tokens.c: 1.1->1.2: memset token
d846 2
a847 4
	* appl/fs/fs*: fs improvements
	
	* lib/ko/agetarg.c: 1.9->1.11 agetarg improvments
	* lib/ko/agetarg.h: 1.4->1.6
d849 1
a849 6
	* appl/vos/*.c: start to use get_servername()
	* arlad/volcache.c: 1.98->1.100: use volname_*, more gc issues
	
	* lib/ko/ko.h: 1.27->1.28: volname_specific, volname_canonicalize
	* lib/ko/vlmisc.c: 1.3->1.4: volname_specific,
	volname_canonicalize
d851 2
a852 4
	* appl/vos/vos_examine.c: 1.17->1.21
	* appl/vos/vos.c: 1.16->1.17: call tzset
	
2001-02-21  Love  <lha@@stacken.kth.se>
d854 1
a854 3
	* THANKS: 1.44->1.45: added s/390 contributors
	
	* arlad/arlad.8: 1.7->1.8: mandoc fix
d856 2
a857 3
	* lwp/{process.s390.S,make-process.o.sh.in,lwp_asm.c,LICENSE.s390}:
	pull up S/390 support from head, contributed by
	<Neale.Ferguson@@SoftwareAG-usa.com> and <adam@@sinenomine.net>
d859 4
a862 2
	* arlad/fcache.c: 1.318->1.319: (fcache_update_length): correct
	variable spelling
d864 2
a865 1
2001-02-18  Love  <lha@@stacken.kth.se>
d867 3
a869 2
	* arlad/fcache.c: 1.317->1.318: (fcache_update_length): remove
	overly paranoid assertion
d871 3
a873 1
2001-02-14  Love  <lha@@stacken.kth.se>
d875 3
a877 7
	* xfs/solaris/xfs_message.c: 1.27->1.28: xfs_message_installdata
	fix
	* xfs/solaris/bin/startarla.in: 1.3->1.4: only create /dev/xfs0
	symlink if it doesn't exist
	* xfs/solaris/xfs_vfsops.c: 1.18->1.19: turn printf into XFSDEB
	* xfs/solaris/xfs_node.c: 1.15->1.16: Corrected bad function call
	and declaration
d879 19
a897 2
	* appl/lib/ka-procs.c: 1.4->1.5: (get_password): fix problem noted
	by John Callaghan <jpc@@msu.edu>
d899 5
a903 1
2001-02-13  Assar Westerlund  <assar@@sics.se>
d905 2
a906 2
	* arlad/fcache.c 1.316->1.317: (fcache_update_length): rewrite the
	assert:s in a more robust way
d908 3
a910 1
2001-02-11  Love  <lha@@stacken.kth.se>
d912 5
a916 2
	* arlad/messages.c: 1.235->1.236: remove key when we get a rxkad
	message invalidkey.
d918 5
a922 1
2001-02-11  Assar Westerlund  <assar@@sics.se>
d924 15
a938 11
	* arlad/arladeb.c 1.24->1.25 (arla_vwarnx_with_fid): adapt to new
 	volcache_getname
	* arlad/fcache.c 1.315->1.316 (fcache_store_state): fix arla_warnx
	(getvolstat): use new volcache_getname
	* arlad/volcache.h 1.29->1.30 (volcacheentry): only store one name
	pointer
 	(the canonical name)
	(volcache_getname): update prototype
	* arlad/volcache.c 1.96->1.97: re-structure so that we only keep the
 	canonical name for a volume
	(volcache_getname): copy name out instead of returning it
d940 1
a940 5
	* xfs/solaris/xfs_vnodeops.c 1.38->1.39 (xfs_inactive): check the
 	v_count of the node since due to a race condition we can get nodes
 	that shouldn't really be thrown away here
	(xfs_getpage, xfs_putpage): read the cache node from the xfs_node
 	after calling xfs_data_valid
d942 5
a946 4
	* arlad/volcache.c: 1.97->1.98: re-do some of the ref-counting
 	logic and make it simpler

2001-02-02  Assar Westerlund  <assar@@sics.se>
d948 2
a949 2
	* appl/afsutils/aklog.c: 1.6->1.7: add fallback for
	krb_get_default_principal for krb libraries without it
d951 1
a951 1
2001-01-31  Love  <lha@@stacken.kth.se>
d953 3
a955 3
	* xfs/bsd/xfs_vnodeops-bsd.c: 1.88->1.89: (xfs_readdir): avoid
	looping when there is a (incorrect) entry with d_reclen==0.
	Patch from: Chris Csanady <ccsanady@@iastate.edu>
d957 2
a958 1
2001-01-30  Love  <lha@@stacken.kth.se>
d960 1
a960 1
	* Release 0.35.2
d962 1
a962 2
	* xfs/linux/xfs_vfsops.c: 1.71->1.72: (xfs_replace_root): update
	xfsf_attr2inode usage
d964 1
a964 1
	* conf/CellServDB: 1.49->1.50: biocenter.helsinki.fi
d966 1
a966 1
	* Release 0.35.1
d968 1
a968 5
	* xfs/*/xfs/xfs_fs.h: (xfs_attr2inode): update signature
	* xfs/*/xfs_node.c: (new_xfs_node): clean node
	(xfs_attr2inode): only clean node if needed
	* xfs/*/xfs_message.c: (xfs_message_installdata): clear node
	(xfs_message_installattr): don't clear node
d970 1
a970 1
2001-01-29  Love  <lha@@stacken.kth.se>
d972 1
a972 12
	* arlad/bsd-subr.c: 1.55->1.56: make XFS_DIRENT_BLOCKSIZE smaller
	since otherwise linux emulation code under freebsd will lose any
	entries that have it's end past 512 bytes.
	
2001-01-28  Love  <lha@@stacken.kth.se>

	* configure.in: 1.472->1.4.73: Fixed fatal typo in pthreads
	detection

	* xfs/linux/xfs_inodeops.c: 1.150->1.151: (xfs_lookup): fill in
	the whole getnode message inside the look, since xfs_message_rpc()
	might clobber it.
d974 1
a974 10
2001-01-25  Love  <lha@@stacken.kth.se>

	* Release 0.35
	
	* appl/fs/fs.c: 1.94->1.95: fs incompat command
	* appl/lib/fs_lib.c: 1.32->1.33: fs_incompat_renumber
	* appl/lib/arlalib.h: 1.38->1.39: fs_incompat_renumber
	
	* xfs/solaris/bin/startarla.in: 1.2->1.3: solaris 8 afs
	syscallnumber
d976 2
a977 5
	* xfs/linux/bin/Makefile.in: 1.21->1.22: s,XFS_BIN,XFS_SBIN,
	
	* arlad/conn.h: 1.24->1.25: new conn_clearcred signature
	* arlad/conn.c: 1.61->1.62: make conn_crearcred take mask
	* arlad/messages.c: 1.234->1.235: use new conn_clearcred
d979 1
a979 5
	* xfs/bsd/xfs/xfs_fs.h: 1.18->1.19: clean vattr fix
	* xfs/bsd/xfs_node-bsd.c: 1.47->1.48: clean vattr fix
	* xfs/bsd/xfs_message.c: 1.64->1.65: clean vattr fix
	
2001-01-15  Love  <lha@@stacken.kth.se>
d981 1
a981 5
	* include/kafs.h: 1.32->1.34: include/kafs.h: update arla pioctl's
	that are assigned to assigned to arla, added comments for arla
	pioctls
	
	WARNING this break compability with older versions of arla !
d983 2
a984 1
2001-01-09  Love  <lha@@stacken.kth.se>
d986 1
a986 6
	* lib/ko/agetarg.c: 1.8->1.9: (print_arg): fix formating error in
	help text From Nickolai Zeldovich <kolya@@MIT.EDU>
	
	* arlad/cred.c: 1.33->1.34: (cred_expire): dont try to get
	username since we are chroot()ed From Nickolai Zeldovich
	<kolya@@MIT.ED>
d988 1
a988 2
	* appl/vos/vos_partinfo.c: 1.7->1.8: end args with aarg_end, from
	Nickolai Zeldovich <kolya@@MIT.EDU>
d990 1
a990 1
2001-01-08  Love  <lha@@stacken.kth.se>
d992 1
a992 2
	* appl/kalog/kalog.c (main): use koerr_gettext to print error from
	ka_authenticate
d994 1
a994 6
	* lib/ko/koerror.c: ka errors
	
	* xfs/bsd/bin/umount_xfs.8: simplistic manualpage
	* xfs/bsd/bin/mount_xfs.8: simplistic manualpage
	* xfs/bsd/bin/Makefile.in (MANPAGES): mount_ffs.8, umount_xfs.8
	(install,uninstall): manualpages
d996 1
a996 2
	* lib/ko/agetarg.c (agetarg): fixed broken short option mandatory
	handleing
d998 1
a998 1
2001-01-07  Love  <lha@@stacken.kth.se>
d1000 1
a1000 7
	* arlad/fcache.c (purge_cred, fcache_get_data): update use of
	install_attr()
	* arlad/messages.c (install_attr): update take a flag field for
	fcacheentry2xfsnode()
	(fcacheentry2xfsnode): update to take a flag field and use it.
	(*): update to new signature of install_attr() and
	fcacheentry2xfsnode()
d1002 1
a1002 3
	* arlad/messages.h (FCACHE2XFSNODE_{ATTR,RIGHT,ALL}): flags for
	fcacheentry2xfsnode()
	(fcacheentry2xfsnode): update to take a flag field
d1004 1
a1004 3
	* rx/rx.c (rxi_CheckCall): return -2 is the call is freed.
	(rxi_ReapConnections): check if rxi_CheckCall returns -2, in that
	case the hash-bucket might have changed and we need to restart.
d1006 1
a1006 1
	* lib/ko/agetarg.c: make mandatory work for real
d1008 1
a1008 1
	* util/log.c (log_open): pass on name to lower open, free name
d1010 1
a1010 6
	* appl/lib/Makefile.in: add tokens.c
	* appl/lib/arlalib.c (arlalib_get_cred_afs): get token from kernel
	(arlalib_get_cred_krb): rename from arlalib_get_cred
	(arlalib_getsecurecontext): use arlalib_get_cred_afs()
	* appl/lib/tokens.c (arlalib_token_iter): new func to iterate all
	tokens.
d1012 1
a1012 7
	* xfs/bsd/xfs_dev-common.c (xfs_block_sigset): new function that
	remove signals we want to block from a sigset_t in some diffrent
	ways.
	(xfs_message_rpc): use xfs_block_sigset(); if there is a p_sigctx, use it.

	* xfs/solaris/xfs_vnodeops.c (xfs_map): remove the check that the
	mapping is off the end of the file, solaris vm works that way.
d1014 3
a1016 4
	* xfs/linux/xfs_message.c (xfs_invalid_xnode): don't mark
	directories as STALE
	* xfs/bsd/xfs_message.c (xfs_message_invalidnode): don't mark
	directories as STALE
d1018 2
a1019 1
	* rx/rx.c (rxi_FindPeer): init connQueue
d1021 1
a1021 10
2001-01-06  Love  <lha@@stacken.kth.se>

	* rx/rx.c (rxi_InsertPeer): change all connection that used the
	original peer that is about to die.
	(rx_NewConnection,rxi_FindConnection): attach this conn to the peer
	(rx_DestroyConnection): when the connection dies, deattach it
	from the peer.

	* rx/rx.h (rx_connection): add a queue_item that attaches this
	connection to its peer.
d1023 1
a1023 1
2001-01-06  Simon Josefsson  <jas@@nada.kth.se>
d1025 2
a1026 1
	* conf/CellServDB (extundo.com): add.
d1028 2
a1029 1
2001-01-06  Love  <lha@@stacken.kth.se>
d1031 2
a1032 2
	* appl/fs/fs.c (newcell_cmd): mark cell as mandatory and remove
	check
d1034 5
a1038 5
2001-01-05  Love  <lha@@stacken.kth.se>

	* rx/rx.c (rxi_DecongestionEvent): decrement the refcount after we
	are done, so that the peer doesn't get reclaimed if we block in
	rxi_Start(). From Nickolai Zeldovich <kolya@@mit.edu>.
d1040 1
a1040 2
	* appl/fs/fs.c (afs_listacl): just return if there a access
	failure.  From Nickolai Zeldovich <kolya@@mit.edu>
d1042 1
a1042 3
	* arlad/fcache.c (getacl): reset the opaque data structure in case
	we fail, make sure we free data when we fail. 
	From Nickolai Zeldovich <kolya@@mit.edu>
d1044 12
a1055 5
	* arlad/fcache.c (get_attr_bulk): pull out the host from the rx
	connection in case we need it later, then we don't need to used
	freed memory.  From Nickolai Zeldovich <kolya@@mit.edu>.
	
2001-01-04  Love  <lha@@stacken.kth.se>
d1057 1
a1057 2
	* lib/ko/agetarg.c (agetarg): check that the mandatory arguments
	are filled in, from Nickolai Zeldovich <kolya@@mit.edu>
d1059 3
a1061 2
	* appl/fs/fs.c (cmds): added "df" from Nickolai Zeldovich
	<kolya@@mit.edu>
d1063 2
a1064 1
2001-01-04  Mattias Amnefelt  <mattiasa@@e.kth.se>
d1066 1
a1066 2
	* appl/pts/pts.c (member_cmd): set conn_context to null before 
	using it.
d1068 1
a1068 1
2001-01-02  Love  <lha@@stacken.kth.se>
d1070 1
a1070 6
	* xfs/bsd/xfs_vnodeops-bsd.c (xfs_getpages): use VOP_GETPAGES()
	for BSDs that doesn't have vnode_pager_generic_getpages().
	
	* xfs/linux/bin/Makefile.in: install startarla in $prefix/sbin
	
2001-01-01  Assar Westerlund  <assar@@sics.se>
d1072 2
a1073 4
	* xfs/bsd/xfs_syscalls-common.c (fhget_call): always vrelease `vp'
	(fhopen_call): check `vp' first
	(xfs_pioctl_call): handle the weird case of someone sending a filename
	to debug
d1075 1
a1075 1
For older ChangeLog entries see ChangeLog.2000
@


1.3
log
@New Arla userland from Arla between 0.34.2 and current in arla cvs.
Too many new features and fixes to mention here.
@
text
@d1 1
a1 1
2000-08-27  Love  <lha@@stacken.kth.se>
d3 1
a3 25
	* xfs/solaris/xfs_node.c (new_xfs_node): protect nodes list
	(free_xfs_node): protect nodes list, make sure to update the
	next_node pointer
	(xfs_node_iter_start): start a iteration of the nodes list
	(xfs_node_iter_next): get next node in iteration
	(xfs_node_iter_stop): end iteration of the nodes list
	(xfs_node_find): use new list iteration function
	(free_all_xfs_nodes): use new list iteration function
	* xfs/solaris/xfs_message.c (xfs_message_gc_nodes): use new
	interation functions on nodelist
	* xfs/solaris/xfs_dev.c (xfs_dev_attach): call xfs_init_xfs() to
	init struct xfs
	(xfs_dev_detach): call xfs_destroy-xfs to free usage of struct xfs
	* xfs/solaris/xfs_wrap.c (_fini): disallow unloading of module
	that still used
	* xfs/solaris/xfs_vfsops.c (xfs_unloadable): return 0 is xfs is
	unloaded
	(xfs_init_xfs): init mutexed related to struct xfs
	(xfs_destroy_xfs): destroy mutexes related to struct xfs
	(xfs_uprintf_filsys): use literation functions
	* xfs/solaris/xfs/xfs_fs.h (struct xfs): added mutex'es for list
	protection add new prototypes
	* xfs/solaris/xfs_syscalls.c (xfs_uninstall_setgroups): avoid
	unload if never loaded
	(xfs_setgroups): protect with p->p_crlock
d5 1
a5 1
2000-08-26  Assar Westerlund  <assar@@sics.se>
d7 1
a7 17
	* xfs/solaris/xfs_dev.c: remove some old stuff make some macros
	into functions
	(xfs_message_rpc): add signals to blocked set

	* xfs/solaris/xfs_dev.c (xfs_message_rpc): mask SIGPOLL, SIGALRM,
	and SIGVTALRM while doing the rpc

2000-08-26  Love  <lha@@stacken.kth.se>

	* lib/ko/Makefile.in: change order of KRB4_LIB_FLAGS and libroken
	
	* xfs/solaris/xfs/xfs_locl.h: added <sys/signal.h>
	* xfs/solaris/xfs_dev.c: allocate xfs_channel->message_buf at
	attach/detach moment protect xfs_channel->message_buf with mutex
	convert some printf to XFSDEB
	* xfs/solaris/xfs_dev.c: lock messageq and sleepq, initial SMP
	support use a macro to get ddi_get_soft_state() add some comments
d9 1
a9 8
	* tests/write-closed2.c: include more stuff to make it work on
	solaris

2000-08-25  Love  <lha@@stacken.kth.se>

	* lwp/process.m68k.S: make the `register % hack' depend on __ELF__

2000-08-25  Assar Westerlund  <assar@@sics.se>
d11 2
a12 4
	* arlad/volcache.c: replace some strncpy with strlcpy, and make a
	too long volume name an error
	* arlad/fcache.c: replace some strcpy with strlcpy
	* arlad/arla.c (main): use the correct cell and not `0'
d14 1
a14 4
	* arlad/messages.c (try_again): get anonymous credentials in the
	correct cell
	(xfs_message_getroot, viocgettok)): use the correct cell and not `0'
	(viocsetacl): only malloc the required space
d16 6
a21 1
2000-08-24  Love  <lha@@stacken.kth.se>
d23 4
a26 6
	* arlad/arladeb{2,}.[ch]: new log_log
	* util/util-tester.c: added new test for log
	* util/log.[ch]: enable subsystem to log
	* util/log_log.3: added manualpage
	* util/Makefile.in (LIBS): change order of including libroken and
	@@LIBS@@
d28 1
a28 1
2000-08-21  Magnus Ahltorp  <ahltorp@@nada.kth.se>
d30 2
a31 1
	* xfs/solaris/bin: Added startarla and modctl
d33 6
a38 1
2000-08-20  Tomas Olsson  <tol@@stacken.kth.se>
d40 7
a46 2
	* rxdef/cb.xg: don't convert addr_in & subnetmask in struct
	interfaceAddr
d48 1
a48 1
	* tests/write-closed.c (doit): cast MAP_FAILED to void *
d50 3
a52 2
	* tests/write-closed2.c: include atypes.h
	(doit): cast MAP_FAILED to void *
d54 3
a56 1
2000-08-20  Assar Westerlund  <assar@@sics.se>
d58 1
a58 2
	* ydr/output.c: inherit flags to the elements of of an
	array/varray
d60 1
a60 1
	* tests/write-closed.c, write-closed2.c: new tests
d62 1
a62 1
2000-08-19  Assar Westerlund  <assar@@sics.se>
d64 5
a68 5
	* configure.in: update smp-test on linux to newer kernels: more
	header files are necessary when doing the cpp test and uppercase
	characters when grepping /proc/ksyms
	* cf/krb-bigendian.m4: re-write this so that it hopefully it works
	correctly
d70 6
a75 1
2000-08-17  Assar Westerlund  <assar@@sics.se>
d77 1
a77 4
	* xfs/bsd/xfs_vnodeops-common.c (xfs_fsync_common): give up and
 	throw away data when called from reclaim
	(xfs_inactive_common): use printf so that user seems the failed
	writing-back
d79 3
a81 2
	* xfs/bsd/xfs/xfs_locl.h: try including all vm-related files that
 	we find
d83 2
a84 2
	* configure.in: actually test if we found krb4 for deciding to
 	build rxkad, not just that we were looking for it
d86 1
a86 5
2000-08-16  Love  <lha@@stacken.kth.se>

	* appl/lib/fs_lib.c (fs_get_sysname): fix strlcpy
	(fs_getcells): fix strlcpy, argument i a len not a size
	* appl/lib/arlalib.h (fs_getcells): fix prototype
d88 1
a88 8
2000-08-15  Love  <lha@@stacken.kth.se>

	* arlad/messages.c (xfs_message_symlink): update usage of
	cm_symlink
	* arlad/inter.c (cm_symlink): convert to take a FCacheEntry
	instead of a VenusFid

2000-08-14  Assar Westerlund  <assar@@sics.se>
d90 3
a92 2
	* xfs/linux/xfs_message.c (clear_all_children): make it invalidate
	this dcache entry iff `parent'.  fix all callers.
d94 1
a94 1
2000-08-13  Love  <lha@@stacken.kth.se>
d96 2
a97 9
	* doc/arla.texi: add new files and nodes
	* doc/afs-basics.texi: spelling
	* doc/intro.texi: update platforms, and add arla-commit
	* doc/oddities.texi: mountpoints
	* doc/authors.texi: updata
	* doc/Makefile.in: added new files
	* doc/{storage,timeline}.texi: new random texts
	* doc/history.txt: merged into info document
	* doc/{partsofarla,,porting,servers,tools,ack,debugging}.texi: Id police
d99 1
a99 1
2000-08-13  Love  <lha@@stacken.kth.se>
d101 2
a102 1
	* arlad/arla.c (recover): don't revover by default
d104 2
a105 1
2000-08-13  Assar Westerlund  <assar@@sics.se>
d107 1
a107 1
	* configure.in: check for uvm/uvm_extern.h
d109 2
a110 6
	* xfs/bsd/xfs/xfs_locl.h: use uvm/uvm_extern.h instead of vm/vm*.h
 	if it exists

2000-08-11  Love  <lha@@stacken.kth.se>

	* configure.in: enable to disable compiling xfs
d112 1
a112 3
2000-08-10  Tomas Olsson  <tol@@stacken.kth.se>

	* lib/bufdir/fbuf.c (malloc_flush): reorder args to lseek()
d114 2
a115 1
2000-08-09  Mattias Amnefelt  <mattiasa@@e.kth.se>
d117 2
a118 1
	* conf/CellServDB: Updated club.cc.cmu.edu
d120 4
a123 5
2000-08-08  Love  <lha@@stacken.kth.se>

	* arlad/fcache.c (getroot): don't die when we cant find the root
	volume, don't enter volccache_getbyname more then one time XXX the
	later should be fixed in volcache
d125 3
a127 5
2000-08-06  Love  <lha@@stacken.kth.se>

	* Here was 0.34.1 relased, see the branch for releavant patches

2000-08-06  Assar Westerlund  <assar@@sics.se>
d129 1
a129 4
	* xfs/solaris/xfs_syscalls.c (remote_pioctl): also interpret ENXIO
	as the daemon not being there and therefore mapped into EINVAL
	
2000-08-06  Love  <lha@@stacken.kth.se>
d131 1
a131 3
	* appl/afsutils/Makefile.in (MANPAGES): += klog.1 aklog.1
	* appl/afsutils/aklog.1: add manulpage
	* appl/afsutils/*.1: mandoc'ify, and clean u
d133 2
a134 11
	* appl/afsutils/aklog.c: use "TheseCells" if there is no arguments
	* lib/ko/kocell.c (cell_expand_cell): expand in the same order as
	CellServDB
	(readthesecells): read a "TheseCells" file and add them to the ofst of
	TheseCells
	(addthesecell): add a new cell to the thesecells list, permit no dups.
	(cell_init): also parse the TheseCells files

	* appl/afsutils/aklog.c: Added aklog from Brandon S. Allbery
	<allbery@@ece.cmu.edu>, rewrote it a little bit.
	* appl/afsutils/Makefile.in: added aklog
d136 3
a138 5
	* appl/lib/arlalib.c (arlalib_get_viceid_servers): return the
	errorcode

	* cf/c-attribute.m4: check for old gcc that can't eat
	__attribute__ ((unused)) bar (void) { return ; }
d140 1
a140 1
	* Release 0.34
d142 1
a142 2
	* configure.in (CHECK_KERBEROS): need to check for both krb4 and
	krb5 since libkafs might depend on both.
d144 1
a144 1
2000-08-03  Love  <lha@@stacken.kth.se>
d146 2
a147 6
	* lib/cmd/cmd.c (parse_magic_options): don't abort(), break
	
2000-08-04  Love  <lha@@stacken.kth.se>

	* cf/check-kafs.m4: check if libkafs needs to be linked against
	libkrb5, libkrb4 or both
d149 1
a149 1
2000-08-02  Assar Westerlund  <assar@@sics.se>
d151 3
a153 4
	* arlad/fcache.c (get_attr_bulk): try to not leak memory from
 	bulkstatus.  handle any number of returned status
	* arlad/fcache.c (get_attr_bulk): actually break out when
	RXAFS_BulkStatus fails
d155 1
a155 3
	* arlad/arla.c: move chroot later
	
2000-08-02  Harald Barth  <haba@@pdc.kth.se>
d157 2
a158 2
	* LIESMICH: Polish german.
	* README: Small hint
d160 1
a160 1
2000-08-02  Assar Westerlund  <assar@@sics.se>
d162 2
a163 2
	* arlad/arla.c (main): chroot to cache_dir to avoid influencing
	anything
d165 1
a165 8
	* xfs/bsd/xfs_vnodeops-common.c (xfs_open_common): store the
	`cred' in the xfs_node for later
	(xfs_inactive_common): fsync the vnode (with the stored cred)
	* xfs/bsd/xfs_vnodeops-osf.c (xfs_open): call xfs_open_common
	* xfs/bsd/xfs_vnodeops-bsd.c (xfs_open): call xfs_open_common
	* xfs/bsd/xfs_node-bsd.c (xfs_getnewvnode): initialize `cred'
	(free_xfs_node): free `cred'
	* xfs/bsd/xfs/xfs_node.h (xfs_node): add `cred'
d167 1
a167 2
	* xfs/bsd/xfs_vfsops-common.c (xfs_mount_common): remove `length'
	parameter when copying
d169 1
a169 1
	* rx/rxdebug.c: printf format correctness
d171 1
a171 1
2000-07-30  Assar Westerlund  <assar@@sics.se>
d173 1
a173 5
	* lib/ko/kocell.c: complain once if we fail to open */ThisCell
	don't complain about missing SuidCells
	* lib/ko/kocell.c: do not write warnings about configuration files
	found in /usr/vice instead of /usr/arla.  read suid cell
	information on demand.
d175 1
a175 1
2000-07-28  Love  <lha@@stacken.kth.se>
d177 1
a177 2
	* lwp/make-process.o.sh.in (HOST_CPU): nbsd/pmax uses mipsl, catch
	that one too.
d179 1
a179 1
2000-07-24  Tomas Olsson <tol@@stacken.kth.se>
d181 2
a182 1
	* appl/fs/fs.c (mkmount_cmd): simple support for cell as third arg
d184 1
a184 1
2000-07-23  Assar Westerlund  <assar@@sics.se>
d186 1
a186 8
	* xfs/bsd/xfs_node-bsd.c (xfs_dnlc_lookup_int): always call
	cache_lookup with LOCKPARENT | ISLASTCN to make sure the returned
	parent node is locked.
	(xfs_dnlc_lock): implement common function for doing the first half of
	the required locking (the second half is done in xfs_lookup) after
	fetching an entry from the cache.  depending on the implementation
	of cache_lookup, this has to be done always or only when
	cache_lookup failed
d188 2
a189 13
	* xfs/bsd/xfs_dev-bsd.c: treat _LKM and KLD_MODULE the same way
	* xfs/bsd/xfs_syscalls-common.c: treat _LKM and KLD_MODULE the
	same way
	(lookup_node): remove unused `done'

2000-07-17  Love  <lha@@stacken.kth.se>

	* xfs/linux/*.c: dentry->d_child is atomic_t on linux 2.4-test3
	
2000-07-16  Love  <lha@@stacken.kth.se>

	* rx/rxperf.c: rx test perf program
        * conf/CellServDB (cs.unc.edu): update
d191 1
a191 6
2000-07-14  Simon Josefsson  <jas@@vic20.blipp.com>

	* cf/check-kerberos.m4 (AC_KRB4_INC_WHERE): Typo.
	(AC_KRB5_LIB_WHERE1): Try -lresolv too.

2000-07-12  Assar Westerlund  <assar@@sics.se>
d193 2
a194 2
	* xfs/bsd/xfs_message.c (xfs_message_invalidnode): try not to
 	throw away nodes that act as backing store for dirty vm objects
d196 1
a196 1
	* xfs/bsd/xfs_vnodeops-bsd.c (xfs_putpages): call underlying putpages
d198 2
a199 1
	* lwp/Makefile.in: always install lwp headerfile as lwp.h
d201 5
a205 4
	* xfs/include/xfs/xfs_message.h (XFS_FSYNC): add flag
	* xfs/linux/xfs_inodeops.c (xfs_fsync): add flag
	* xfs/*/xfs_vnodeops*.c (xfs_fsync): set fsync bit
	* arlad/inter.c (cm_close): propagate fsync bit to fs
d207 2
a208 5
	* arlad/messages.c (viocwhereis): use volcache_volid2bit and only
	return relevant file servers
	* arlad/fcache.c (find_first_fs): use volcache_volid2bit
	* arlad/volcache.h (volcache_volid2bit): add prototype
	* arlad/volcache.c (volcache_volid2bit): new function
d210 1
a210 1
2000-07-08  Love  <lha@@stacken.kth.se>
d212 1
a212 10
	* arlad/volcache.c (recycle_entry): assert the the entry isn't
	used, free any parent
	(get_free_entry): make sure the this node isn't a parent node before
	recycling it
	(volcache_getby{name,id}): if refcount == 0, 
	inc nactive_volcacheentries since the entry just started to
	be used (after try_reuse or creation)
	(add_entry_by{name,id}): move ++nactive_volcacheentries
	resposibility to caller.
	(try_reuse): relocate
d214 2
a215 1
2000-07-06  Assar Westerlund  <assar@@sics.se>
d217 1
a217 2
	* rx/rx_pkt.c (rxi_EncodePacketHeader, rxi_DecodePacketHeader):
	generalize the code to work where sizeof(u_int32_t) != 4
d219 2
a220 1
2000-07-03  Harald Barth  <haba@@pdc.kth.se>
d222 1
a222 3
	* tests/dir-tree: haba version, now without bash features
	* tests/shallow-tree: with haba dir-tree
	* tests/deep-tree: with haba dir-tree
d224 1
a224 8
2000-07-02  Assar Westerlund  <assar@@sics.se>
	
	* arlad/fcache.c (update_entry): look at `fake_mp'
	* arlad/arla_local.h (fake_mp): add
	* arlad/arla.c: add `--fake-mp'

	* arlad/fcache.c (followmountpoint): set parent
	* arlad/fcache.c: redo fake and real mountpoint stuff
d226 1
a226 2
	* arlad/messages.c (update_fid); try handling flags better
	(xfs_message_getdata): translate errors in common case
d228 2
a229 3
	* tests/visit-volumes: new test
	
2000-06-27  Love  <lha@@stacken.kth.se>
d231 1
a231 20
	* appl/bos/bos_status.c: indent and some cleaning
	* appl/bos/bos.c (cmds): added apropos, help, quit
	

2000-07-02  Tomas Olsson  <tol@@stacken.kth.se>

	* lib/ko/koerror.c (koerr_gettext): make ret const
	* lib/bufdir/fdir.c (fdir_creat): return EEXIST when appropriate

2000-07-01  Assar Westerlund  <assar@@sics.se>

	* arlad/inter.c (cm_symlink): do not let the user choose 0644 bits
	for a symlink, because then we could confuse it with a mount point

2000-06-30  Assar Westerlund  <assar@@sics.se>

	* appl/vos/vos_examine.c: be more robust when the volume server
	returns errors

2000-06-26 Love <lha@@stacken.kth.se>
d233 1
a233 5
	* arlad/messages.c (xfs_message_remove): it seems silly but remove
	can cause a bulkstatus, pass the parent to fcache_verify_attr to
	avoid a deadlock.

2000-06-26  Tomas Olsson  <tol@@stacken.kth.se>
d235 2
a236 2
	* lib/ko/koerror.c (koerr_gettext): never return NULL
	* tests/dir-tree: syntax
d238 1
a238 1
2000-06-25  Tomas Olsson  <tol@@stacken.kth.se>
d240 4
a243 1
	* appl/vos/vos_createentry.c: check helpflag
d245 1
a245 1
2000-06-25  Assar Westerlund  <assar@@sics.se>
d247 1
a247 13
	* appl/lib/arlalib.c (arlalib_get_viceid): update to
	cell_dbservers_by_id
	* arlad/volcache.c: adapt to new cell_dbservers_by_id
	* arlad/arla.c (usage): print help correctly
	* arlad/afsdir_check.c (usage): fix to print usage correctly
	* arlad/messages.c: adapt to new cell_dbservers_by_id and
	cell_new_dynamic
	* lib/ko/Makefile.in: remove kodebug
	* lib/ko/kocell.c: look up AFSDB records also for the case of an
	existing cell that has no database servers.  record cells
	dynamically added in CellServDB
	* lib/ko/ko_locl.h: remove kodebug.h
	* lib/ko/ko.h: update to new prototypes from kocell.c
d249 1
a249 25
	* xfs/linux/xfs_vfsops.c (xfs_put_inode): change back the i_count
 	test to the comparison it was
	(xfs_delete_inode): fix printf of i_count
	* xfs/linux/xfs_inodeops.c (xfs_release_file): use xfs_iread for
 	accessing i_count

	* arlad/fcache.c (purge_volume): handle wildcard cells that can
	result from volume callbacks from multi-homed file servers
	* arlad/volcache.c (volcache_invalidate): handle wildcard cells
	that can result from volume callbacks from multi-homed file
	servers

	* lib/ko/kocell.c: make all cell name comparisons case-insensitive

2000-06-24  Love  <lha@@stacken.kth.se>

	* rxdef/vldb.xg: add some more flag
	
2000-06-24  Harald Barth  <haba@@pdc.kth.se>

	* tests/rm-rf.c: closedir() is good - do not die from too many
	open files in big trees
	* tests/deep-tree: Fast version does a not-so-deep-tree
	* tests/create-files.c: Not only the first file should be of given
	size
d251 2
a252 1
2000-06-23  Assar Westerlund  <assar@@sics.se>
d254 1
a254 1
	* appl/afsutils/klog.c (main): use fgets for reading the password
d256 1
a256 1
2000-06-23  Love  <lha@@s3.kth.se>
d258 1
a258 6
	* xfs/linux/xfs_message.c (gc_vnode): use xfs_iread
	* xfs/linux/xfs_vfsops.c (xfs_read_super): set error = 0 when we
	use path_init/path_tree
	(xfs_put_inode,xfs_delete_inode): use xfs_iread
	* xfs/linux/xfs/xfs_locl.h (xfs_iread): use for reading of i_count
	(xfs_iref): change to use atomic_read
d260 1
a260 1
2000-06-22  Assar Westerlund  <assar@@sics.se>
d262 1
a262 4
	* xfs/solaris/xfs/xfs_msg_locl.h (xfs_message_updatefid): add
	prototype
	* xfs/solaris/xfs_message.c (xfs_message_updatefid): add
	* xfs/solaris/xfs_dev.c (xfs_message_receive): add updatefid
d264 1
a264 1
2000-06-19  Assar Westerlund  <assar@@sics.se>
d266 1
a266 5
	* arlad/subr.c (dentry2ino): actually handle all the cases:
	- . at the root of a volume
	- .. at the root of a volume
	- .. pointing to the root of the volume
	- all other
d268 1
a268 4
	* arlad/fcache.c (fcache_realfid): try to return the right fid for
	(*,1,1)
	* arlad/fcache.c (invalidator): check that the heap has not
	mutated while sleeping
d270 1
a270 2
	* appl/pts/pts.c (main): add an terminating element (NULL) in
	myargv
d272 1
a272 1
2000-06-18  Harald Barth  <haba@@pdc.kth.se>
d274 7
a280 1
	* LIESMICH: Follow README
d282 1
a282 1
2000-06-17  Assar Westerlund  <assar@@sics.se>
d284 1
a284 2
	* configure.in (openbsd): set _LKM (should really come from
	bsd.lkm.mk)
d286 1
a286 6
	* xfs/bsd/xfs_vnodeops-bsd.c (xfs_lookup): locking protocol is
	more complex.  if we're returning in *vpp the same node that we
	got in dvp, we should not unlock it.
	* xfs/bsd/xfs_vnodeops-common.c: add some extra (#if 0 code)
	(xfs_readdir): fetch length from cache vnode with getattr
	(xfs_reclaim_common): don't set v_data to NULL
d288 4
a291 1
2000-06-16  Assar Westerlund  <assar@@sics.se>
d293 1
a293 1
	* configure.in: check for com_err.h and et/com_err.h
d295 4
a298 3
	* xfs/linux/bin/arla.init.in: do start and top in a somewhat more
	debian-compatible way.  based on a patch from Adrian Bridgett
	<adrian.bridgett@@iname.com>
d300 1
a300 1
	* ydr/lex.h (yylex): add prototype
d302 12
a313 1
	* arlad/fcache.c (fcache_fhopen, fcache_fhget): do not probe
d315 1
a315 1
	* configure.in: check for com_err.h and et/com_err.h
d317 3
a319 7
	* xfs/linux/bin/arla.init.in: do start and top in a somewhat more
	debian-compatible way.  based on a patch from Adrian Bridgett
	<adrian.bridgett@@iname.com>

2000-06-15  Love  <lha@@s3.kth.se>

	* appl/afsutils/klog.c: backed out cmd changes
d321 1
a321 6
2000-06-12  Love  <lha@@s3.kth.se>

	* cf/check-kerberos.m4: do the krb4 extra lib check the same way
	as the krb5 case, there is no need to check for the include, since
	if the user have choose a prefix explicity, they get
	includedir=$prefix
d323 6
a328 1
2000-06-12  Assar Westerlund  <assar@@sics.se>
d330 1
a330 3
	* arlad/messages.c (break_callback): reset attrusedp and
 	datausedp, otherwise we still think they are in use when we turn
 	on kernelp again.
d332 6
a337 6
2000-06-12  Harald Barth  <haba@@pdc.kth.se>

	* doc/intro.texi: Be more precise about support status
	* doc/arla.info: Follows intro.texi
	* cf/check-kerberos.m4: run AC_KRB{4,5}_{LIB,INC}_WHERE even when
	                        --with-krb{4,5}=/path is specified
d339 3
a341 6
2000-06-10  Assar Westerlund  <assar@@sics.se>

	* lwp/process.sparc.S (sunos4): also define STACK_BIAS

	* tests/apwd.c: add verbosity.
	(getcwd_classic): print the correct string in the verbose output
d343 1
a343 1
	* tests: allow overriding FS
d345 1
a345 5
	* appl/fs/fs_local.h (PRIMARY_CELL, SETUID_HONORED,
 	OBSOLETE_VERSION): redefine in terms of constants from kafs.h
	* appl/fs/fs.c (afs_getcellstatus): use fs_getcellstatus
	(lsmount_cmd, rmmount_cmd): only print error messages when it actually
	failed
d347 1
a347 1
	* tests/apwd.c: clarify error messages
d349 1
a349 1
	* arlad/subr.c (dentry2ino): rewrite, hopefully simpler
d351 1
a351 10
	* arlad/xfs.h: update for new version handling
	* arlad/kernel.c (version_thread): update to new version message
	* arlad/xfs.c: update to new version message
	* xfs: (invalidnode): do not print warnings when node not found.
	(updatefid): add some implementations
	(version): add some handlers
	* xfs/include/xfs/xfs_message.h: make version number-based and not
	capability based.  change all modules.
	(XFS_ID_AFSDIR): add new flag for installdata
	(XFS_VERSION): set version
d353 1
a353 17
	* xfs/linux/xfs_inodeops.c (xfs_readdir): data is not valid when
	trying to read from a bad fake mount point, so do not print
	anything then

	* arlad/fcache.c (fcache_get_data): be more careful replacing a
	fake mount-point
	(find_volume): handle cases of missing types of volumes better

2000-06-10  Love  <lha@@s3.kth.se>

	* rx/Makefile.in (rxdebug): added @@LIBS@@
	
	* lib/cmd/testc.c (main): call set_progname
	
	* tests/rm-rf.c (main): do right with argc
	
	* arlad/xfs.c (*): try do to the right thing from kern_write()
d355 1
a355 3
	* xfs/linux/xfs_message.c (*): set return values to be negative
	
2000-06-09  Love  <lha@@s3.kth.se>
d357 2
a358 2
	* tests/run-tests.in: use rm-rf instead of rm -rf when removing
	the tree for paranoia resons.
d360 1
a360 3
	* tests/rm-rf.c (do_dir): if we have afs, try to do fs_rmmount on
	each directory
	(main): check for afs
d362 4
a365 3
	* appl/fs/fs.c (lsmount_cmd,rmmount_cmd): use fs_\1
	* appl/lib/fs_lib.c (fs_lsmount,fs_rmmount): added, moved from
	fs.c
d367 1
a367 2
	* arlad/fcache.c (fcache_get_data): set TYPE_LINK when converting
	to a mountpoint
d369 2
a370 7
	* arlad/messages.c (xfs_message_link): change if #if 1 to #if 0
	that I apprently changed with last commit, changed order of
	free:ing dir_entry
	(xfs_message_symlink): update to new
	break_callback, free dir_entry later
	(*): remove #if 0 code that tried to
	break_callback instead of installing new data.
d372 1
a372 1
2000-06-09  Harald Barth  <haba@@pdc.kth.se>
d374 5
a378 3
	* doc/authors.texi: spell

2000-06-08  Love  <lha@@s3.kth.se>
d380 2
a381 9
	* arlad/fcache.c (invalidator): updated to new style
	break_callback
	* arlad/messages.c (break_callback): make it take a FCacheEntry
	instead of a Fid, now it sets flags.kernelp = FALSE too.
	(*): update all calls to break_callback and updated semantics
	* arlad/messages.h (break_callback): update prototype
	
	* arlad/reconnect.c: fix compiler warnings
	* rx/Makefile.in (include_HEADERS): added rxgencon.h
d383 1
a383 1
2000-06-08  Assar Westerlund  <assar@@sics.se>
d385 6
a390 2
	* appl/vos/vos_status.c (vos_status): check for server and set
	cell
d392 1
a392 2
	* appl/bos/bos_status.c (bos_status): check for server and set
	cell
d394 1
a394 1
2000-06-08  Love  <lha@@s3.kth.se>
d396 2
a397 4
	* doc/partsofarla.texi: expand pioctl stuff
	* doc/servers.texi: point out again the importance of the
	"comments" in the CellServDB file
	* doc/afs-basics.texi: clearify CellServDB and AFSDB
d399 1
a399 7
2000-06-08  Harald Barth  <haba@@pdc.kth.se>

	* doc/afs-basics.texi: Added verbs to sentences and other spelling
	business.
	* doc/servers.texi: This should be said somewhere.

2000-06-07  Love  <lha@@s3.kth.se>
d401 1
a401 10
	* arlad/fcache.c (fcache_get_data): remove #if 1, that was for -t
	protection
	* arlad/arla.c (main): for -t call xfs_message_init()
	* arlad/kernel.h (kernel_args): remove device_file
	(kernel_device): added prototype
	* arlad/arla.c (main): call kernel_opendevice() where apropriate
	* arlad/kernel.c (kernel_opendevice): break out kern_open of
	kernel_interface
	(kern_interface): add the new "null" interface
	(null_{open,read,write}): "null" interface
d403 1
a403 2
	* doc/authors.texi: mention rhapsody port and disco code
	* doc/*.texi: spelling
d405 1
a405 1
2000-06-05  Harald Barth  <haba@@pdc.kth.se>
d407 1
a407 13
	* xfs/linux/xfs_message.c: change XFS{,_ID}_INVALID_DNLC
	* xfs/bsd/xfs_message.c: change XFS{,_ID}_INVALID_DNLC
	* xfs/solaris/xfs_message.c: change XFS{,_ID}_INVALID_DNLC
	* xfs/winnt/src/xfs_message.c: change XFS{,_ID}_INVALID_DNLC

2000-06-05  Love  <lha@@s3.kth.se>

	* ydr/output.c (genin): make input only arguments const
	
	* rxkad/osi_alloc.c (osi_Alloc,osi_Free): add prototype to avoid
	warning
	* rxkad/compat.c: added prototype for initialize_rxk_error_table()
	to avoid warning
d409 3
a411 7
	* doc/Makefile.in: remove some unused stuff
	* Makefile.in (SUBDIRS): += doc.
	
2000-06-05  Harald Barth  <haba@@pdc.kth.se>

	* xfs/include/xfs/xfs_message.h: name change:
	XFS{,_ID}_INVALID_DNLC
d413 6
a418 1
	* lib/bufdir/fdir.h: add const to VenusFid decls
d420 1
a420 3
	* arlad/messages.c: My compiler didn't like the report_fid
	declaration inside the do { } while when it is used in the while
	expression.
d422 5
a426 2
	* INSTALL: Added some comments about ports (for all the firewall
	owners)
d428 1
a428 1
2000-06-05  Assar Westerlund  <assar@@sics.se>
d430 2
a431 2
	* arlad/fcache.c (fcache_get_data): bump in new data for resolved
 	mount point
d433 1
a433 1
	* arlad/fcache.h (FCACHE_VERSION): bump
d435 1
a435 1
	* arlad: merge in `fake-mp' code
d437 1
a437 1
2000-06-04  Love  <lha@@s3.kth.se>
d439 7
a445 4
	* doc/afs-basics.texi: spelling, linked in into the tree.
	* doc/arla.texi: added "Description of AFS infrastructure"
	
2000-06-03  Love  <lha@@s3.kth.se>
d447 1
a447 2
	* arlad/cmcb.c (RXAFSCB_InitCallBackState{2,3}): update to new
	definitions
d449 2
a450 1
2000-06-02  Love  <lha@@s3.kth.se>
d452 2
a453 2
	* cf/krb-version.h: name the file ${PACKAGE}-version.h
	* arlad/arla.c: use <arla-version.h>
d455 1
a455 3
	* cf/check-kerberos.m4: try to not pollute the cache
	* ydr/output.c (encode_string): change order of %s left
	pharentesis
d457 3
a459 1
2000-06-02  Magnus Ahltorp  <ahltorp@@nada.kth.se>
d461 1
a461 1
	* rxdef/cb.xg: correct initcallbackstate confusion
d463 2
a464 1
	* rxdef/volumeserver.xg: added constants
d466 1
a466 1
2000-06-01  Love  <lha@@s3.kth.se>
d468 3
a470 2
	* appl/afsutils/klog.c: cmd-ify
	* appl/afsutils/klog.ctx: help text for mdoc page.
d472 1
a472 2
	* rx/Makefile.in: add and enable rxdebug, install/install rxdebug 
	* rx/rxdebug.c: clean up, made compile
d474 7
a480 9
	* lib/Makefile.in: add and enable cmd
	* lib/cmd/cmd.c(print_usage): added CMD_MANDOC stuff
	(cmd_PrintSyntaxManDoc): dont print argument twice with one
	command commands
	(*): s,params,parms,

	* lib/cmd/*: a cmd parser with mandoc support

2000-05-25  Love  <lha@@s3.kth.se>
d482 2
a483 3
	* tests/mkdir: more paranoia
	
2000-05-24  Assar Westerlund  <assar@@sics.se>
d485 1
a485 2
	* xfs/linux/xfs_message.c (gc_vnode): use d_prune_aliases
	(d_prune_aliases): define if !LINUX2_3
d487 2
a488 3
	* arlad/arla.c (print_dir): do not assume that strftime handles %F
	* cf/check-kerberos.m4: empty then-clause makes sh grumpy also add
	some more random libraries when seeking krb5
d490 1
a490 7
	* xfs/linux/xfs_inodeops.c (xfs_d_delete): make it always return
	an `int'.  the signature was changed in 2.3.99-pre9 and this
	should be safer.  removing the warning for older code would
	require an autoconf test
	* xfs/linux/xfs_syscalls.c (fhopen_call): declare `error'

2000-05-23  Assar Westerlund  <assar@@sics.se>
d492 2
a493 4
	* cf/check-kerberos.m4: make no to everything actually be no
	prepend -L to libraries
	* cf/check-kerberos.m4: handle given and not-given arguments
	better.  fix library checking loops
d495 1
a495 1
2000-05-23  Love  <lha@@s3.kth.se>
d497 1
a497 5
	* appl/lib/fs_lib.c (fs_invalidate): added
	* appl/fs/fs.c: (invalidate_cmd): added
	
	* cf/check-kerberos.m4 (krb5 compat) added KRB4_LIB_DIR
	(krb4) change order of extra libs and KRB4_LIB_DIR
d499 1
a499 2
	* xfs/linux/xfs_message.c (xfs_message_installnode): sync comment
	with code
d501 1
a501 1
2000-05-22  Assar Westerlund  <assar@@sics.se>
d503 1
a503 5
	* arlad/volcache.c (get_info_oop): conditionalize the use of
	RXKADEXPIRED
	* arlad/conn.c (conn_rxkad_level): conditionalize on KERBEROS
	* tests/*.c: always call set_progname.  make all tests buildable
	even without KERBEROS
d505 1
a505 7
	* xfs/linux/xfs_vfsops.c (make_root): no need to set valid to
	zero, since it's done in xfs_d_init
	* xfs/linux/xfs_syscalls.c (fhopen_call): call get_write_access
	* arlad/messages.c: make sure that all sub-functions of
	xfs_message_pioctl either send a wakeup themselves or that they
	get breaked from the switch and get handled at the end of
	xfs_message_pioctl.
d507 1
a507 8
	* tests/rename-under-feet.c (child_chdir): print cwd to fd 4
	* tests/run-tests.in (ARLA_TESTS): add rename-under-feet
	* tests/rename-under-feet.c (kill_child): do not be that brutal
	* tests/rename-under-feet.c (child_chdir): remember to exit in
	child
	* tests/rename-under-feet.c (child_chdir): print cwd in child
	* tests/rename-under-feet.c (child_chdir): invert fork-condition
	* tests/rename-under-feet.c: new test
d509 1
a509 1
2000-05-19  Assar Westerlund  <assar@@sics.se>
d511 3
a513 1
	* rxdef/Makefile.in (CLIENTSONBJS): add bos.cs.o
d515 3
a517 12
2000-05-19  Love  <lha@@s3.kth.se>

	* arlad/arla.c (print_dir): verbose info
	(arla_ls): ls -l

2000-05-18  Love  <lha@@s3.kth.se>

	* xfs/linux/xfs_inodeops.c (xfs_d_delete): remove unused code

2000-05-18  Assar Westerlund  <assar@@sics.se>

	* lib/ko/Makefile.in (LIBS): add all the known (and required libs)
d519 4
a522 1
2000-05-16  Assar Westerlund  <assar@@sics.se>
d524 1
a524 17
	* xfs/linux/xfs/xfs_locl.h (xfs_root): replace with
 	xfs_replace_root
	* xfs/linux/xfs_inodeops.c (xfs_d_validate): rename to
 	xfs_d_revalidate
	(xfs_as_writepage, xfs_as_readpage): update to signatures as of
	2.3.99-pre8
	(try_replacing): new function that tries to do a root-swap when it
	detects that we're using a fake root
	(xfs_dead_lookup): use try_replacing
	* xfs/linux/xfs_vfsops.c (make_root): install the new root before
 	replacing it
	* xfs/linux/xfs_vfsops.c (xfs_replace_root): new function for
 	replacing the root with a new one.  this just replaces the
 	`xfs_node' part of the root inode.
	(make_root_vnode): new function for making a `fake' root node
	* xfs/linux/xfs_node.c (clear_xfs_node): correct debug output to
 	print the correct function name
d526 10
a535 2
	* arlad/volcache.c (get_info_loop): make sure we re-try correctly
	when we get back `token expired'
d537 1
a537 5
	* ydr/output.c: handle the case of OUT parameters of type STRING
	<>.  they need to be `char **' and not only `char *'.  also fix
	problem with not passing STRINGs correctly to server-side work
	functions.
	* ydr/types.h (enum argtype): make named
d539 2
a540 1
	* rxdef/bos.xg: correct error codes and opcodes
d542 1
a542 1
2000-05-15  Love  <lha@@s3.kth.se>
d544 1
a544 12
	* Release 0.33.1
	
	* appl/lib/arlalib.c (arlalib_get_token_id): new function
	
	* tests/run-tests.in (ARLA_TESTS): added kotest
	* tests/kotest: added new test
	* lib/ko/Makefile.in: added kotest target
	* lib/ko/kocell.c (cell_expand_cell): add new function, inspired
	by allbery <allbery@@ECE.CMU.EDU>

	* cf/check-kerberos.m4 (AC_KRB4_LIB_WHERE1): break for-loop if
	entry found
d546 1
a546 1
2000-05-15  Assar Westerlund  <assar@@sics.se>
d548 1
a548 3
	* appl/afsutils/klog.c (afs_id): use arlalib_get_token_id_servers
	* appl/lib/arlalib.c (arlalib_get_token_id_servers): add
	(arlalib_get_token_id): fix
d550 1
a550 1
	* arlad/kernel.h (kern_read, kern_write): update prototypes
d552 2
a553 1
	* include/kafs.h (_PATH_ARLA_VICE): add
d555 2
a556 12
2000-05-14  Assar Westerlund  <assar@@sics.se>

	* arlad/kernel.c (*_read, *_write): change signatures to those of
	read and write

	* xfs/linux/Makefile.in (uninstall): remove SHARED_LIBS
	* conf/Makefile.in (CONF_FILES): add SuidCells
	* conf/SuidCells: add a default (empty)

	* tests/rm-rf.c, tests/kill-softly.c, tests/kill-softer.c: single
	unix standard (and probably posix) says that unlink(directory)
	should return EPERM and not EISDIR.  accept both.
d558 2
a559 1
	* make-release, make-relase.el: new files
d561 3
a563 3
	* xfs/bsd/xfs_vfsops-common.c (xfs_mount_common): we always have
	vfs_getnewfsid in all support OSes.  same thing with struct
	fstatfs.f_fstypename
d565 2
a566 2
	* xfs/bsd/xfs_vfsops-bsd.c (xfs_fhtovp): current should probably
	be curproc.  adding missing \n
d568 1
a568 3
	* xfs/*/xfs_syscalls*.c (remote_pioctl): convert ENODEV
	into EINVAL, otherwise kafs does not think there's pioctl support
	when arlad is not alive
d570 1
a570 1
2000-05-12  Assar Westerlund  <assar@@sics.se>
d572 4
a575 3
	* xfs/linux/xfs_syscalls.c (user_path2dentry): new function that's
	basically namei, but implemented different on 2.3 and earlier.
	(sys_afs_int): just map ENODEV to EINVAL (otherwise kafs is unhappy)
d577 1
a577 4
	* xfs/linux/xfs_message.c (xfs_message_installdata): use
	path_init/path_walk on 2.3 (lookup_dentry is dead).
	* xfs/linux/xfs_vfsops.c (xfs_read_super): use path_init/path_walk
	on 2.3 (lookup_dentry is dead).
d579 2
a580 6
2000-05-12  Love  <lha@@s3.kth.se>

	* xfs/winnt/bin/xfs-helper.c: added tcp-forwarder
	* lwp/plwp.c: (LWP_INT_WAIT): change windows code
	
	* xfs/winnt/bin/makefile: add more tools
d582 2
a583 2
	* arlad/xfs.c: use kern_write
	* arlad/kernel.[ch]: new kern interface
d585 3
a587 3
	* xfs/winnt/README: osr tools have moved
	
2000-05-10  Love  <lha@@s3.kth.se>
d589 1
a589 2
	* appl/fs/fs.c (arladebug_cmd, xfsdebug_cmd): try to be nicer when
	parseing commandline
d591 1
a591 1
2000-05-09  Love  <lha@@s3.kth.se>
d593 1
a593 2
	* cf/check-kerberos.m4 (AC_KRB4_LIB_WHERE1): added fbsd security
	compat (req com_err)
d595 2
a596 1
2000-05-09  Assar Westerlund  <assar@@sics.se>
d598 2
a599 2
	* xfs/bsd/xfs_dev-common.c (xfs_message_rpc): separate device was
 	closed from we got signal so we do not have to lie to the user
d601 2
a602 4
	* xfs/bsd/xfs_wrap-bsd.c (SYSCALL_MODULE): set `xfs_sycall_num' so
	all syscall installations work the same way
	* arlad/fcache.c (real-extra_file_name): a new function that does
	not do any checks and does the real work of fcache_extra_file_name
d604 1
a604 2
	* xfs/bsd/xfs/xfs_locl.h (osf): add forward declaration of struct
 	vop_generic_args
d606 4
a609 1
2000-05-07  Love  <lha@@s3.kth.se>
d611 1
a611 8
	* xfs/bsd/xfs_dev-common.c (xfs_cursig): osf glue
	(xfs_message_rpc, xfs_devread): use xfs_cursig
	* xfs/bsd/xfs_message.c (xfs_message_invalidnode): osf compat for
	v_writecount
	* xfs/bsd/xfs_dev-common.c (xfs_message_rpc): osf compat with
	P_WEXIT
	* lwp/make-process.o.sh.in (HOST_CPU): use globing for alpha
	* configure.in (osf): enable to use a specific build-tree
d613 3
a615 1
2000-05-07  Assar Westerlund  <assar@@sics.se>
d617 28
a644 3
	* arlad/fcache.c (fcache_create_file): unlink the (potential)
	extra directory
	(fcache_recover_state): bump current_vnodes
d646 1
a646 1
	* xfs/bsd/xfs_dev-common.c (xfs_message_rpc): set catch correctly
d648 3
a650 5
	* xfs/linux/xfs_dev.c (xfs_devopen, xfs_devclose, xfs_devread,
 	xfs_devwrite, xfs_devpoll): do lock and unlock kernel.  the new
 	world order requires us to do the locking here ourselves.  this
 	should not be a problem with older kernels, since we should be
 	able to call lock_kernel with the kernel already locked.
d652 1
a652 1
2000-05-06  Assar Westerlund  <assar@@sics.se>
d654 6
a659 2
	* appl/fs/fs.c (listcells_cmd): try to correct usage
	(afs_listcells): cells begin with one, not zero
d661 5
a665 1
2000-05-02  Love  <lha@@s3.kth.se>
d667 3
a669 3
	* xfs/winnt/src/xfs_deb.c (xfs_log): new version
	* tests/ga-test.c: make things arg_mandatory so they can be
	automagicly matched
d671 5
a675 1
2000-05-02  Love  <lha@@s3.kth.se>
d677 2
a678 1
	* Release 0.33
d680 1
a680 1
2000-05-01  Harald Barth  <haba@@pdc.kth.se>
d682 1
a682 2
	* appl/lib/Makefile.in: ln -s gets upset if the (target) file
	exists
d684 1
a684 1
	* lib/acl/Makefile.in: removed roken_rename.h rule.
d686 3
a688 1
2000-05-01  Assar Westerlund  <assar@@sics.se>
d690 1
a690 3
	* xfs/linux/xfs_message.c (xfs_message_installnode): if installing
 	on a positive dentry that already has the inode that we're
 	installing, set the dentry to valid.
d692 5
a696 2
	* xfs/bsd/xfs_vfsops-*bsd.c: use standard locking for dead vnodes
	* xfs/bsd/xfs_wrap-bsd.c (xfs_mod): print assigned numbers
d698 2
a699 1
	* appl/amon/Makefile.in (AMON_LIBS): re-order X libraries
d701 1
a701 1
2000-05-01  Love  <lha@@s3.kth.se>
d703 3
a705 2
	* configure.in: dectect netbsd1.4.2 and build everything static
	* INSTALL: note on netbsd1.4.2
d707 1
a707 1
2000-04-30  Love  <lha@@s3.kth.se>
d709 1
a709 2
	* xfs/linux/xfs_dev.c (xfs_fops): use new style struct init
	(*): break long lines
d711 7
a717 2
	* xfs/linux/xfs_inodeops.c (xfs_dentry_operations):
	s,d_validate,d_revalidate,
d719 1
a719 1
2000-04-30  Assar Westerlund  <assar@@sics.se>
d721 1
a721 3
	* arlad/fcache.c: correct some debug print update to new StoreData
	(add_to_invalidate): remove if already there
	* rxdef/fs.xg (StoreData): does not actually return a callback
d723 1
a723 5
	* xfs/linux/xfs_inodeops.c (xfs_dentry_operations): use new-style
 	struct initialization
	(xfs_readdir): print more errors
	* xfs/linux/xfs_vfsops.c (xfs_sops): use new-style struct
 	initialization
d725 12
a736 6
	* arlad/messages.c (xfs_message_rename): install data for child
 	directory when needed
	* arlad/inter.c (cm_rename): if we're moving a directory between
 	two directories, we need to fixup `..'
	* lib/bufdir/fdir.c (fdir_changefid): remove unused argument
	* tests/rename5.c: new test
d738 1
a738 1
2000-04-29  Assar Westerlund  <assar@@sics.se>
d740 11
a750 2
	* cf/check-kerberos.m4: change include order when testing for krb5
 	compat
d752 4
a755 3
	* configure.in: check for old libkafs
	* appl/afsutils/klog.c (get_afs_token): optionally call
 	k_afslog_uid (old name for krb_afslog_uid)
d757 7
a763 5
	* xfs/linux/xfs/xfs_locl.h (I_BLOCKS_BITS): define
	* xfs/linux/xfs_node.c (xfs_attr2inode): use >> instead of / to
	calculate # of blocks to make old gcc happy
	* xfs/linux/xfs_inodeops.c (update_from_cache_node): new function
	to update inode when cached node has changed.  call it.
d765 2
a766 1
2000-04-28  Love  <lha@@s3.kth.se>
d768 1
a768 2
	* xfs/linux/bin/arla.init.in: Added support for SuSE && YaST, add
	some documentation
d770 2
a771 4
	* xfs/winnt/inc/xfs_type.h: clearify what cpu we want (or not)
	* xfs/winnt/src/sources (SOURCES): added xfs.rc
	* xfs/winnt/src/xfs_vops.c: remove some warnings
	* xfs/winnt/src/xfs_init.c: move around and make it work
d773 1
a773 1
2000-04-28  Assar Westerlund  <assar@@sics.se>
d775 7
a781 2
	* arlad/fcache.c (add_to_invalidate): cancel the potential
 	sleeping beauty/beast (or invalidator)
d783 2
a784 6
	* xfs/linux/xfs_vfsops.c (xfs_read_super): use the LOOKUP_POSITIVE
 	constant instead of just `1'
	* xfs/linux/xfs_syscalls.c (fhopen_call): use dentry_open for 2.3
	* xfs/linux/xfs_message.c (xfs_message_installdata): use
 	lookup_dentry for 2.3 now that it has been exported (in
 	2.3.99pre6)
d786 1
a786 1
2000-04-27  Love  <lha@@s3.kth.se>
d788 2
a789 5
	* xfs/bsd/xfs/xfs_syscalls.h: export xfs_syscall_num
	* xfs/bsd/xfs_syscalls-wrap-freebsd.c (*):
	s,syscall_offset,xfs_syscall_num,
	* xfs/bsd/xfs_syscalls-wrap-bsd.c (*):
	s,syscall_offset,xfs_syscall_num,
d791 1
a791 1
2000-04-26  Magnus Ahltorp  <ahltorp@@nada.kth.se>
d793 2
a794 17
	* INSTALL: Added note about Mac OS X

	* xfs/bsd/bin/startarla.in: Added Mac OS X support

2000-04-23  Assar Westerlund  <assar@@sics.se>

	* configure.in (freebsd): always add `-O' to make the xfs module
	compile.  See FreeBSD PR kern/17614

2000-04-22  Assar Westerlund  <assar@@sics.se>

	* configure.in (freebsd): add `-mno-fp-regs' on alpha

2000-04-20  Assar Westerlund  <assar@@sics.se>

	* arlad/inter.c (cm_rename): use VenusFid_cmp when comparing old
	and new parent fid so that we actually perform a full comparison
d796 1
a796 1
2000-04-20  Love  <lha@@s3.kth.se>
d798 11
a808 8
	* tests/append-over-page.c: define MAP_FAILED for those whom lack
	it
	* configure.in: enable us to build lwp with windows threads,
	pthread and asm threads on cygwin
	* lwp/testlwp.c (main): do exit where approriate
	* lwp/plwp.c: define and use lwp_timerclear instead of timerclear
	* lwp/lock.h: clean up
	* xfs/winnt/README: expand what ddk you'll need
d810 5
a814 1
	* xfs/winnt/README: expand what ddk you'll need
d816 2
a817 1
2000-04-19  Assar Westerlund  <assar@@sics.se>
d819 1
a819 1
	* tests/mmap-shared-write.c: new test
d821 2
a822 1
2000-04-19  Love  <lha@@s3.kth.se>
d824 1
a824 3
	* cf/check-kerberos.m4: changed order of exporting varibles of
	krb5 and krb4 define kerberos in case we have krb5(only) too.
	rewrite krb5 compat stuff, and tune to death
d826 3
a828 1
	* tests/mkm-rmm: use setacl and more paranoia
d830 1
a830 1
	* conf/CellServDB (rhic): updated
d832 4
a835 1
2000-04-19  Assar Westerlund  <assar@@sics.se>
d837 3
a839 4
	* xfs/bsd/bin/startarla.in: call mknod for 128,0 if we're using an
	KLD module, because that for now means FreeBSD.  Since kern/9478
	has been laying waiting for over a year and since we always use
	that number, we might anyways just do that.
d841 5
a845 1
	* tests/mmap-shared-write.c: new test
d847 1
a847 1
2000-04-18  Love  <lha@@s3.kth.se>
d849 5
a853 2
	* cf/check-kerberos.m4: clean up, change order of krb5 and krb4
	test, make it work ?
d855 2
a856 1
2000-04-16  Assar Westerlund  <assar@@sics.se>
d858 3
a860 2
	* lwp/make-process.o.sh.in: allow overriding of CC, GCC, CPP, and
 	AS
d862 1
a862 8
	* xfs/linux/xfs_syscalls.c (fhget_call, xfs_fh_to_dentry): change
 	to make up the file-handle of
	(dev,inode,gen).
	(fhopen_call): first cut at opening files in 2.3.99-pre5
	* xfs/linux/xfs_message.c (xfs_message_installdata): skip using
 	open_namei and instead do walk_init/walk_name for 2.3.99-pre5
	* xfs/linux/xfs_vfsops.c (xfs_read_super): lookup_dentry changed
 	in 2.3.99pre-n (for some value of n).
d864 8
a871 2
	* arlad/messages.c (xfs_message_remove): don't set the data token
 	when installing the limbo entry if data is not installed
d873 5
a877 1
2000-04-14  Assar Westerlund  <assar@@sics.se>
d879 5
a883 6
	* tests/fs-sa-la: redirect output to avoid it without -verbose
	* arlad/fcache.c (setacl): release the FCacheEntry if we fail
	* arlad/messages.c (xfs_message_remove): don't return a bogus
	error when it was actually succesful

2000-04-13  Love  <lha@@s3.kth.se>
d885 3
a887 1
	* test/fs-sa-la: new test
d889 1
a889 2
	* xfs/linux/xfs_inodeops.c (xfs_follow_link): changed for
	2.3.99-pre4
d891 1
a891 2
	* xfs/linux/xfs_message.c (xfs_message_installdata): changed
	open_namei workings for 2.3.99-pre4
d893 6
a898 1
2000-04-12  Love  <lha@@s3.kth.se>
d900 2
a901 3
	* arlad/messages.c (xfs_message_remove): do installattr instead of
	installnode now that we have disabled the warning message in
	installattr.
d903 1
a903 1
2000-04-03  Love  <lha@@s3.kth.se>
d905 2
a906 1
	* tests/mkm-rmm: mount-point tests
d908 6
a913 1
2000-04-03  Assar Westerlund  <assar@@sics.se>
d915 2
a916 3
	* appl/pts/pts.c (*): use arlalib_try_next_db
	* appl/lib/arlalib.h (arlalib_try_next_db): add prototype
	* appl/lib/arlalib.c (arlalib_try_next_db): add
d918 1
a918 2
	* arlad/inter.c (cm_ftruncate): make sure we have the data before
 	truncating to non-zero length
d920 7
a926 6
	* arlad/fcache.c: revert the try_next_fs part of last commit
	* arlad/fcache.c (stale): remove clearing of `datap', only done in
 	`throw_data'
	(*): clarify find_first_fs - find_next_fs loop
	* appl/lib/arlalib.c (arlalib_first_db): allow explicit `host'
	(NULL means pick from cell-db)
d928 3
a930 8
	* appl/pts/pts.c: make remaining functions loop over db's.  allow
	all commands to use a specified db server.  const-ize some.
	* appl/pts/pts.c (pr_create, create_cmd): add `-owner'
	* appl/pts/pts.c (*): make all arg_printusage print the
	sub-command before the options
	* appl/pts/pts.c (pr_create): write debug correctly
	* appl/pts/pts.c (pr_create): make the handling of `id' more
 	obvious/correct/something
d932 3
a934 4
	* xfs/solaris/xfs_vnodeops.c (xfs_setattr): only send length and
 	mtime if we actually have data
	* xfs/bsd/xfs_vnodeops-common.c (xfs_setattr_common): only send
 	length and mtime if we actually have data
d936 10
a945 4
	* xfs/linux/xfs_vfsops.c (xfs_notify_change): only send length and
 	mtime if we actually have data
	* xfs/linux/xfs_inodeops.c (xfs_setattr): only send length and
 	mtime if we actually have data
d947 4
a950 2
	* xfs/linux/*.c: add (int) casts where required for
 	%.*s format strings
d952 7
a958 1
2000-04-01  Assar Westerlund  <assar@@sics.se>
d960 3
a962 1
	* xfs/*/xfs_dev.c (xfs_devread): only return entire messages
d964 5
a968 2
	* xfs/bsd/xfs_dev-common.c: add come const-ness
	(xfs_devread): print the signal that interrupted us
d970 4
a973 13
2000-03-28  Assar Westerlund  <assar@@sics.se>

	* appl/lib/arlalib.h (db_server_context): remove synchost and
	nconn

	* appl/lib/arlalib.c (arlalib_first_db, arlalib_next_db,
	free_db_server_context): new functions for looping over all
	database servers.  From Harald Barth <haba@@pdc.kth.se>
	* appl/pts/pts.c (examine_cmd, pr_adduser): use arlalib_first_db,
	arlalib_next_db to iterate over all db servers.
	(pr_create_user): loop over db servers
	* appl/lib/arlalib.h (db_server_context, arlalib_first_db,
	arlalib_next_db, free_db_server_context): add
d975 1
a975 1
2000-03-27  Love  <lha@@s3.kth.se>
d977 1
a977 1
	* xfs/linux/xfs/xfs_node.h (struct xfs_node): added coments
d979 2
a980 1
	* INSTALL: add --with-sys=dir and KERNEL_CFLAGS
d982 1
a982 1
2000-03-25  Assar Westerlund  <assar@@sics.se>
d984 3
a986 2
	* xfs/linux/xfs/xfs_node.h (struct xfs_node): remove unused field
	`i_ino'
d988 2
a989 17
	* xfs/linux/xfs_inodeops.c (xfs_readdir): ignore deleted entries
	with fileno == 0
	* configure.in (solaris): add test for vfsops.vfs_freevfs
	* xfs/solaris/xfs_vfsops.c (xfs_freevfs): add on solaris8
	* xfs/solaris/bin/mount_xfs.c: upgraded to be compatible with the
 	large changes in solaris 8 (in other words, do not print any
 	warnings if opening /etc/mnttab fails with ENOSYS)

	* xfs/linux/xfs_dev.c (xfs_message_rpc): print out the signal we
	got interrupted by

	* tests/readdir-vs-lstat.c (verify_inodes): do not care if we're
	not allowed to stat
	* tests/kill-softly.c (kill_one): both possitive and negative
	checks
	* tests/kill-softer.c (kill_one): both possitive and negative
	checks
d991 3
a993 123
	* configure.in: add freebsdelf* (new sysname invented by the new
	version of config.guess). also add netbsdelf*

	* xfs/linux/xfs_vfsops.c (xfs_notify_change): set size for regular
	files and always mtime.  move down inode_setattr.
	* xfs/bsd/xfs_vnodeops-common.c (xfs_setattr_common): set size on
	regular files and always mtime.  let `vap' have priority over
	xn->attr
	* xfs/solaris/xfs_vnodeops.c (xfs_setattr): always copy size and
	mtime, they can be more current.  only use seconds parts of mtime
	time stamp.  only set size on regular files.  let `vap' have
	priority over xn->attr

	* arlad/messages.c (xfs_message_remove): use `limbo_status' and
	not the potentially bad limbo_entry->status

2000-03-25  Love  <lha@@s3.kth.se>

	* xfs/linux/xfs_inodeops.c (xfs_write_file): make it work again

2000-03-24  Marcus Sundberg  <mackan@@stacken.kth.se>

	* xfs/linux/xfs_dev.c:
	Removed check for HAVE_STRUCT_FILE_OPERATIONS_FLUSH as it's not
	defined anymore.
	Changed xfs_devselect -> xfs_devpoll.

	* xfs/linux/xfs_inodeops.c:
	Fix typo (generic_read_file -> generic_file_read).
	Fixed warnings about unused declarations.

	* xfs/linux/xfs_load.c:
	Need to unregister_filesystem() if we can't register xfs0 device.

2000-03-24  Love  <lha@@s3.kth.se>

	* xfs/linux/xfs_inodeops.c: move functions around to make blocks
	of !LINUX2_3 code, start to use generic_file_{read,write} for
	linux 2.3, added more comment headers

	* configure.in: removed test for getattr and setattr for linux

2000-03-24  Assar Westerlund  <assar@@sics.se>

	* tests/append-over-page.c: new test

	* xfs/bsd/bin/mount_locl.h: add "xfs" for Darwin/MacOS X, and do
	#error if MOUNT_XFS is not defined
	* xfs/bsd/Makefile.in (xfs_vopdefs.h): generate from vnode_if.h
	instead of vnode_if.src
	(which might not always be present)

	* xfs/bsd/xfs_vfsops-bsd.c (xfs_fhlookup): initialize the vm
	object on Darwin/MacOS X

2000-03-24  Magnus Ahltorp  <ahltorp@@nada.kth.se>

	* lwp/process.m68k.S: Remove bogus .globl Added _C_LABEL around
	PRE_Block

2000-03-24  Assar Westerlund <assar@@sics.se>

        * xfs/bsd/xfs_node-bsd.c (xfs_cnp_init): handle the different hash
        function used on Darwin/MacOS X

        * xfs/bsd/xfs_dev-bsd.c (xfs_install_device): create devfs nodes
        for Darwin/MacOS X.  also remove them in xfs_uninstall_device

2000-03-22  Love  <lha@@s3.kth.se>

	* xfs/bsd/xfs_syscalls-wrap-bsd.c:
	s,HAVE_SYS_LKMNOSYS,HAVE_KERNEL_SYS_LKMNOSYS,

2000-03-21  Assar Westerlund  <assar@@sics.se>

	* xfs/bsd/xfs_dev-bsd.c (xfs_install_device): return error if
	installing cdev fails

2000-03-21  Love  <lha@@s3.kth.se>

	* xfs/bsd/xfs_dev-bsd.c (xfs_uninstall_device): cdevsw_remove
	return the entry it operated on or -1.

2000-03-18  Magnus Ahltorp  <ahltorp@@nada.kth.se>

	* xfs/bsd/*.c, xfs/bsd/xfs/*.h: More MacOS stuff

	* xfs/bsd/xfs/xfs_wrap.h, xfs/bsd/xfs_info.c,
	xfs/bsd/xfs_vfsops-macos.c: Added file

2000-03-20  Assar Westerlund  <assar@@sics.se>

	* appl/udebug/udebug.c: add `-long' mode.  based on a patch from
	Dr A V Le Blanc <LeBlanc@@mcc.ac.uk>

	* tests/run-tests.in: replace date +%s with date
 	+%Y-%m-%d-%H-%M-%S

2000-03-19  Love  <lha@@s3.kth.se>

	* xfs/linux/xfs_inodeops.c: major cleanup of operations struct's

	* tests/kill-softly.c: removed unused varible

	* xfs/linux/xfs/xfs_locl.h: implement DECLARE_FSTYPE for linux
	pre-2.3 add XFS_RESET_I_MAPPING

	* xfs/linux/xfs_vfsops.c (xfs_{get,put}_super):
	MOD_{INC,DEC}_USE_COUNT is done i vfs now

	* xfs/linux/xfs_load.c (xfs_fs_type): use DECLARE_FSTYPE

	* xfs/linux/xfs_message.c (xfs_message_installdata): use
	__open_namei for 2.3.99, set i_mapping for the xfs-node, clean
	printf's
	(xfs_message_invalidnode): clean i_mapping when loosing node

	* xfs/linux/xfs_inodeops.c (xfs_readlink): implement with
	page_readlink i 2.3
	(xfs_follow_link): implement with page_follow_link i 2.3
	(*): clean up
	(xfs_readdir): implement readdir with buffer-cache in 2.3
	(xfs_as_*): Opps when called
d995 3
a997 61
	* tests/run-tests.in: added date to tmpdir

	* xfs/linux/xfs_vfsops.c (xfs_statfs): update header

2000-03-18  Assar Westerlund  <assar@@sics.se>

	* xfs/bsd/xfs/xfs_locl.h (xfs_set_vp_size): introduce a generic
	macro for setting the size of a vnode.  use it.
	* xfs/bsd/xfs_message.c (xfs_message_installdata): call
	uvm_vnp_setsize with UVM
	* xfs/bsd/xfs_vnodeops-bsd.c (cleanup_cnp): add FREE_ZONE for
	macosx.  add xfs_pagein and xfs_pageout.  add some more ifdefs and
	debugs
	* xfs/bsd/xfs_vfsops-bsd.c (xfs_dead_lock): add hopefully the
	minimal amount of locking required for dead nodes
	* xfs/bsd/xfs_dev-common.c (xfs_message_rpc): handle the special
	case of the process cleaning up, in that case we cannot catch
	signals while sleeping
	* xfs/bsd/xfs_dev-bsd.c (xfs_uninstall_filesys): add debug print
	* xfs/bsd/xfs_common-bsd.c (xfs_alloc, xfs_free): use MALLOC and
	FREE, they exist everywhere

	* tests/mmap-vs-read.c, tests/mmap-vs-read2.c: new tests
	* tests/exit-wo-close.c: new test
	* tests/dd: avoid running test if there's no /dev/zero

2000-03-18  Love  <lha@@s3.kth.se>

	* configure.in: Added test for vfsops.vfs_done

	* xfs/bsd/xfs_vfsops-netbsd.c (xfs_vfsops): added vfs_done field
	(xfs_done): added

	* conf/CellServDB (postech.ac.kr): updated

2000-03-18  Magnus Ahltorp  <ahltorp@@nada.kth.se>

	* xfs/bsd/*.c: Change all %p to %lx

2000-03-17  Assar Westerlund  <assar@@sics.se>

	* rx/rx.h: use rxgencon.h.
	* ydr/output.c (generate_server_switch): return RXGEN_OPCODE if an
	unknown opcode is received.  From David Sanderson
	<david@@transarc.ibm.com>

	* tests/apwd.c: new file
	* tests/Makefile.in: add apwd

2000-03-16  Assar Westerlund  <assar@@sics.se>

	* configure.in: call AC_BSD_HEADER_VNODE_IF_H and remove old code
	for setting VNODE_IF_H

	* xfs/bsd/Makefile.in (MODULE_OBJS): use @@VNODE_IF_H@@
	* configure.in (VNODE_IF_H): set and subst

2000-03-16  Love  <lha@@s3.kth.se>

	* appl/afsutils/klog.c (main): alway set KRBTKFILE
	From Chris Wing
d999 1
a999 2
	* conf/CellServDB (src.uchicago.edu): updated
	(rhic): updated
d1001 2
a1002 1
2000-03-15  Assar Westerlund  <assar@@sics.se>
d1004 2
a1005 4
	* xfs/bsd/xfs_syscalls-wrap-freebsd.c
	(install_first_free_syscall): try_install_syscall returns 0 on
	success
	(from xfs_syscalls-wrap-bsd.c:1.6)
d1007 1
a1007 1
	* arlad/solaris-subr.c (flushbuf): always use `struct dirent64'
d1009 2
a1010 1
2000-03-13  Magnus Ahltorp  <ahltorp@@nada.kth.se>
d1012 1
a1012 2
	* configure.in: Set MODLOAD/MODUNLOAD in BSD. More MacOS
	stuff. Include sys/time.h when including sys/proc.h.
d1014 2
a1015 460
	* xfs/bsd/Makefile.in: Use the autoconf variable MODLOAD

2000-03-11  Love  <lha@@s3.kth.se>

	* appl/afsutils/*: Fixes by Chris Wing

	* lib/roken/getarg.[ch]: Chris Wing's arg_generic_string patch

	* xfs/include/xfs/xfs_messsage.h: cygwin glue

2000-03-11  Magnus Ahltorp  <ahltorp@@nada.kth.se>

	* (install_first_free_syscall): try_install_syscall returns 0 on
	success

2000-03-10  Assar Westerlund  <assar@@sics.se>

	* Release 0.32

2000-03-10  Assar Westerlund  <assar@@sics.se>

	* xfs/linux/xfs_vfsops.c (xfs_statfs): in 2.3.51, `struct statfs'
 	should not be copied to user-space, it's done by vfs_statfs
 	instead

	* arlad/fcache.c (getacl, setacl): store the retrieved status in
 	the fcache entry

	* arlad/messages.c (xfs_message_remove): work-around problems with
 	silly-flag
	(xfs_message_rmdir, xfs_message_rename): try do dir_remove_name

	* arlad/solaris-subr.c (dir_remove_name): use an maximal d_reclen
 	of DIRBUF.

	* appl/fs/fs.c (internal_mp): always follow symlinks when calling
	pioctl

	* arlad/solaris-subr.c (dir_remove_name): using a too large
	d_reclen is bad because readdir() can't cope with it being larger
	than the buffer size that's being used by opendir/readdir.  so
	let's take DIRBUF (defaulting to 1048) as a conservative estimate

	* xfs/solaris/xfs_dev.c (xfs_chpoll): always initialize return
 	values.  print correct function name in debug output.

2000-03-07  Assar Westerlund  <assar@@sics.se>

	* rxkad/compat.c: merge from krb4: fix incompatible protos
	* xfs/linux/Makefile.in (SHARED_LIBS): set unconditionally to
	libgetcwd.so.  We assume that there's always a getcwd.  based on a
	bug report by Dave Morrison <dave@@bnl.gov>

	* arlad/messages.c (xfs_message_remove): move up the setting of
	the silly flag to before get_attr, otherwise that call might fail.

2000-03-07  Love  <lha@@s3.kth.se>

	* util/log.c (log_open): when not finding the log, return NULL
	* arlad/arladeb.c (arla_loginit): fail when there is no valid log

2000-03-06  Love  <lha@@s3.kth.se>

	* xfs/linux/xfs_load.c (init_xfs_fs): no code after ret

2000-03-04  Magnus Ahltorp  <ahltorp@@nada.kth.se>

	* configure.in, lib/roken/signal.c, xfs/rhapsody/Makefile.in,
	xfs/rhapsody/xfs_wrap.c, xfs/rhapsody/xfs/kernelServer.h: Mac OS
	support

2000-03-04  Assar Westerlund  <assar@@sics.se>

	* xfs/linux/xfs_vfsops.c (make_dead_vnode): set `i_fop' on 2.3.x
	* xfs/linux/xfs_inodeops.c: fix up opreations vectors
	* xfs/linux/xfs_node.c (xfs_iget): conditionalize setting of
 	`i_fop'
	* xfs/linux/xfs_node.c (xfs_iget): set inode->i_fop
	* xfs/linux/xfs_message.c (xfs_message_installdata): set mapping
 	of the node to be that of the cache node.
	* xfs/linux/xfs_inodeops.c: adapt for 2.3.x (add address_space and
 	other stuff)

	* xfs/linux/xfs_inodeops.c (xfs_release_file): consider the vnode
 	as dirty if the cache node is

	* xfs/linux/xfs_inodeops.c (xfs_release_file): make debug prints
 	correct.  don't invalidate pages on 2.3.x

	* xfs/linux/xfs_message.c (xfs_message_installnode): use
 	full_name_hash - always works now
	* xfs/linux/xfs_inodeops.c: unifdef some
	* xfs/linux/getcwd.c: unifdef -UHAVE_STRUCT_NEW_STAT
	* configure.in (linux): remove unused tests

	* xfs/linux/bin/mount_xfs.c: new program
	* xfs/linux/bin/Makefile.in: add mount_xfs.
	(clean): remove arla and not arla.init
	* xfs/linux/xfs_vfsops.c (xfs_read_super): make reading of minor
 	device number work correctly
	* xfs/linux/xfs_vfsops.c (xfs_root): look at minor number
	(xfs_read_super): make into three arguments.  look at data if != NULL.
	(xfs_put_super): look at minor number
	* xfs/linux/xfs_dev.c (xfs_devread, xfs_devwrite, xfs_devselect):
	look at the minor device
	(xfs_print_sleep_queue): print sleep queues for all minor devices

	* xfs/linux/xfs_load.c (xfs_read_super): remove conditional
	* configure.in (AC_LINUX_FUNC_READ_SUPER_FOUR_ARGS): remove. not
	used any longer

2000-03-04  Love  <lha@@s3.kth.se>

	* arlad/arla.c: add checkservers to testmode

2000-03-02  Love  <lha@@s3.kth.se>

	* conf/CellServDB (ir.stadford.edu): renumber networks.

	* ydr/output.c (encode_string): make it alway not fail in the
	DECODE_RX case

2000-03-01  Assar Westerlund  <assar@@sics.se>

	* xfs/linux/xfs_inodeops.c (xfs_getattr, xfs_setattr): implement
	(xfs_write_file): set inode attributes even on 2.3

	* configure.in: test for inode_operations.default_file_ops
	* configure.in (linux): test for super_operations.notify_change
	* configure.in (linux): test for 2.3x getattr and setattr

	* xfs/linux/xfs_vfsops.c (xfs_delete_inode): always clear the
 	inode

2000-03-01  Love  <lha@@s3.kth.se>

	* xfs/linux/bin/Makefile.in (install): create @@sysconfdir@@ from
	Tino Schwarze <tino.schwarze@@informatik.tu-chemnitz.de>

2000-02-29  Assar Westerlund  <assar@@sics.se>

	* xfs/bsd/xfs_node-bsd.c (xfs_cnp_init): let it make some sense
	(xfs_dnlc_enter_name): use `xfs_cnp_init'

2000-02-28  Assar Westerlund  <assar@@sics.se>

	* xfs/solaris/xfs_vnodeops.c (xfs_rename): ignore errors if we
	fail to remove the `new' file
	(xfs_rmdir): remove the directory from the dnlc

	* tests/rename3: new test

	* xfs/linux/xfs_syscalls.c (xfs_debug_print): print # of nodes
	with XDEBNODE and no node

2000-02-26  Assar Westerlund  <assar@@sics.se>

	* arlad/fcache.c (getvolstat): if RXAFS_GetVolumeStatus does not
 	actually return a volume name, get it from the vldb instead

2000-02-26  Assar Westerlund  <assar@@sics.se>

	* Release 0.31

2000-02-26  Assar Westerlund  <assar@@sics.se>

	* xfs/solaris/xfs_node.c (xfs_dnlc_lookup): always return the node
 	holded
	* xfs/solaris/xfs_syscalls.c: more debug prints
	* xfs/solaris/xfs_vnodeops.c (xfs_lookup): don't hold, already
 	done by dnlc_lookup
	(xfs_remove): remove dnlc entry for non-existant node
	* xfs/solaris/xfs_message.c (xfs_message_installdata): always
 	clear dnlc if XFS_INVALID_DNLC
	(gc_vnode): prune dnlc when count <= 1 -> hopefully it will relase
	nodes

2000-02-24  Assar Westerlund  <assar@@sics.se>

	* configure.in (openbsd): use the same make magic as netbsd
	* xfs/bsd/xfs_vnodeops-common.c (xfs_inactive_common): don't send
 	any message to the daemon.  recycle the node immediately if it's
 	not valid.
	* xfs/bsd/xfs_message.c (xfs_message_invalidnode): only send
 	message on last close.  only invalidate name cache for children.
	* xfs/bsd/xfs_vnodeops-bsd.c (xfs_eopnotsupp, xfs_returnzero):
 	print name of operation

	* xfs/linux/xfs_vfsops.c (xfs_delete_inode): always queue
 	inactivation
	* xfs/linux/xfs_dev.c (xfs_queue_inactive): remove `chan'
	* xfs/linux/xfs_dev.c (xfs_queue_inactive,
 	xfs_empty_inactive_queue): take `xfs_channel *' instead of `int'
	* xfs/linux/xfs_dev.c (xfs_empty_invalid_queue): rename to
 	xfs_process_inactive_queue
	(xfs_empty_invalid_queue): new function to throw away nodes
	(xfs_devclose): call xfs_empty_invalid_queue
	* xfs/linux/xfs/xfs_common.h (XFS_MEM_XFSCACHE): remove, not used
	any longer
	* xfs/linux/xfs_common.c (xfs_tell_alloc): use printk consistenly
	* xfs/linux/xfs_inodeops.c (xfs_create, xfs_symlink, xfs_mkdir):
	set the gid
	* xfs/bsd/bin/startarla.in: add `-z' to arlad to be conservative
	* configure.in: add testing for int16 and u_int16
	* xfs/bsd/xfs_wrap-bsd.c (xfs_mod): add prototype (warn-hunting)
	* xfs/bsd/xfs_vnodeops-common.c (xfs_symlink_common): extra const
 	(more warning-hunting)
	* xfs/bsd/xfs_vfsops-common.c (xfs_unmount_common): move out
 	doforce as part of warning hunt

2000-02-20  Assar Westerlund  <assar@@sics.se>

	* xfs/bsd/xfs_vnodeops-osf.c (xfs_getpage): make it build on OSF5
	* xfs/bsd/xfs_vfsops-osf.c (xfs_fhtovp): try to handle both
	U_FD_SET and u_set_fe
	* xfs/bsd/xfs/xfs_fs.h: rename pag_t -> xfs_pag_t try to handle
	OSF that has `struct mount.m_info' instead of `m_data'
	* configure.in (osf): add test for ubc_lookup
	* configure.in (bsd): check for `struct mount.m_info'
	* configure.in: separate kernel_CFLAGS into kernel_CFLAGS and
	kernel_CPPFLAGS
	* configure.in: conditionalize <sys/cdefs.h>
	* configure.in (osf): cpus.h does not exist in all versions of
	OSF.  try inet.h instead.

2000-02-16  Assar Westerlund  <assar@@sics.se>

	* xfs/linux/xfs/xfs_node.h (xfs_node): add `invalid_list'
	* xfs/linux/xfs_vfsops.c (xfs_delete_inode): if we fail to send an
 	inactive node message
	(typically, because of out of memory), clear the node and add it to
	the inactive list
	* xfs/linux/xfs_node.c (new_xfs_node): initialize `invalid_list'
	(clear_xfs_node): does all that free_xfs_node does except the actual
	freeing
	* xfs/linux/xfs_inodeops.c (xfs_d_init): check xfs_alloc for
 	failure.  changed into returning error.  change callers.
	* xfs/linux/xfs_dev.c (xfs_channel): add `invalid_list'
	(xfs_queue_invalid, xfs_empty_invalid_queue): new functions for adding
	nodes to the list that should be invalidated and to iterate over
 	the list and invalidate
	* xfs/linux/Makefile.in (unload): add target

	* lwp/iomgr.c (IOMGR): retry also when the error code from select
 	is ENOMEM (this can happen on linux)

2000-02-16  Love  <lha@@s3.kth.se>

	* xfs/linux/xfs/xfs_common.h (xfs_alloc,xfs_free): new prototypes

	* xfs/linux/xfs_common.c (xfs_alloc,xfs_free): use constant for
	xfs_{allocs,frees}

	* xfs/linux/bin/arla.init.in (start): don't fail when insmod
	succeed, from "Krysak, Tony" <tony.krysak@@lmco.com>

2000-02-15  Assar Westerlund  <assar@@sics.se>

	* arlad/fcache.c (fs_downp): new function for figuring out if the
	return code means that this fs should be mark as down
	(find_next_fs): new parameter if the previous connection should be
	disabled
	* xfs/linux/Makefile.in (load): create a map file

2000-02-14  Assar Westerlund  <assar@@sics.se>

	* arlad/fcache.c: remove lots of bogus assert's remove trailing \n
	from arla_log fix some leaking of fcache entries add some missing
	post-conditions
	(fcache_realfid): also do the mount-point thing for (1,1)
	(get_root_of_volume): add parent reference to child volume
	* arlad/volcache.c (getbyid, getbyname): new static functions
	(*): set and use vol_refs
	(volcache_recover_state): find and set parent pointers
	(volcache_invalidate_ve): new function
	(volcache_volref, volcache_volfree): new functions for manipulating
	vol_refs remove trailing \n from arla_log
	* arlad/volcache.h (volcacheentry): add `vol_refs' and `parent'
	(VOLCACHE_VERSION): bump
	add new prototypes

	* arlad/bsd-subr.c (dir_remove_name): make the loop-invariant more
	correct.

2000-02-12  Assar Westerlund  <assar@@sics.se>

	* arlad/subr.c (dentry2ino): fix typo in looking for root of a
 	volume

	* arlad/messages.c (xfs_message_remove): set silly flag after
 	fetching attributes

	* appl/asrvutil/Makefile.in: s/KRB_INC_FLAGS/KRB4_INC_FLAGS/
	* xfs/solaris/bin/Makefile.in:
 	s/KRB_{INC,LIB}_FLAGS/KRB4_{INC,LIB}_FLAGS/ add Makefile-rule

	* arlad/solaris-subr.c: start using the generic function in subr.c
	* arlad/subr.h (write_dirent_args): use `off64_t' if it exists to
 	help solaris.  We might be able to define and use the maximal int
 	type instead?
	* configure.in (off64_t): test for

	* appl/lib/Makefile.in (arladeb.c): sprinkle srcdir to help
 	not-so-bright makes

	* cf/check-kafs.m4: add Id. remove duplicate -L

	* arlad/conn.c (re_probe): don't assert that `e' is dead.  it
 	might have woken up
	(print_conn, conn_status): remove trailing \n from arla_log
	* arlad/fprio.c (fprio_status): remove trailing \n in arla_log
	* arlad/cred.c (cred_status, print_cred): remove trailing \n from
 	arla_log

2000-02-07  Love  <lha@@s3.kth.se>

	* conf/CellServDB (cs.wisc.edu): updated

2000-02-05  Love  <lha@@s3.kth.se>

	* arlad/messages.c (xfs_message_rmdir): remove superflous
	fcache_release (dir_entry);
	(xfs_message_remove): same as above

2000-02-04  Assar Westerlund  <assar@@sics.se>

	* rx/rx.c (rxi_FindConnection): remember to update the peer in
 	`connection' when we discover that the corresponding host has
 	moved

2000-02-04  Love  <lha@@s3.kth.se>

	* xfs/linux/bin/arla.init.in (start): don't probe for xfs.o

2000-02-03  Love  <lha@@s3.kth.se>

	* xfs/linux/bin/Makefile.in (install): do ; right

2000-02-02  Love  <lha@@s3.kth.se>

	* xfs/linux/bin/Makefile.in (arla.init): don't write over local
	changes

	* arlad/fcache.c (do_read_attr): move out silly test
	(bulkstat_help_func): check also if the rights is cached for this pag
	and if node is uptodatep(), don't save the names if we aren't
	going to use them.
	(get_attr_bulk): added locking protocol, make sure names are free:ed
	when needeed, make sure fs_server_context is free:ed, break out
	updating of in-core node updating of install to kernel loop.
	(fcache_get_attr): make sure node is uptodate too, add check for
	silly rename, make sure we do the right thing with ``parent'',
	merge with get_entry
	(get_entry): remove

2000-01-30  Assar Westerlund  <assar@@sics.se>

	* xfs/linux/xfs_inodeops.c (xfs_write_file): move debug prints
	inside the relevant ifdefs.  remove commented-out and way old page
	invalidation

	* lib/ko/gensysname.c (printsysname): add ko.h to get rid of a
	warning

2000-01-30  Magnus Ahltorp  <ahltorp@@nada.kth.se>

	* xfs/linux/xfs/xfs_locl.h, xfs/linux/xfs/xfs_common.h,
	xfs/linux/xfs_inodeops.c, xfs/linux/xfs_dev.c,
	xfs/linux/xfs_common.c: Drop Linux 2.0 support

2000-01-29  Love  <lha@@s3.kth.se>

	* xfs/linux/xfs_cache.c: removed file

	* xfs/linux/Makefile.in (MODULE_SRCS): remove xfs_cache.c

	* xfs/linux/xfs_load.c: remove linux 2.0-ism

	* xfs/linux/xfs_syscalls.c: remove linux 2.0-ism

	* xfs/linux/xfs_vfsops.c: remove linux 2.0-ism

	* arlad/{arla.c,messages.c,conn.[ch]):use conn_rxkad_level instead
	of rxkad_min_level

	* xfs/linux/xfs_inodeops.c: remove 2.0-ism

	* arlad/inter.c (*): changed to use new fcache_get_attr

	* arlad/messages.c (*): changed to use new fcache_get_attr

	* arlad/fcache.h (fcache_get_attr): new style

	* arlad/fcache.c (fcache_bulkstatus_num): number of nodes to
	bulkstatus
	(get_attr_bulk): rename function, don't insert into kernel default
	(fcache_get_attr): change funtion to do bulkstatus if needed, do
	dynroot stuff here too.
	(bulkstat_help_func): check if the node is already cached

	* tests/compare-inum-mp: set the rights bits on the directory
	before creating the mountpoint

2000-01-26  Love  <lha@@s3.kth.se>

	* xfs/linux/xfs_inodeops.c (xfs_*lookup): removed 2.0-ism, at
	least its the same om 2.3.40 and 2.3.12+

	* arlad/messages.c (xfs_message_rmdir,unlink): be more carefull
	when releasing dir_entry. (this was fixed in the 0.29 branch but
	never pulled up)

	* xfs/linux/xfs_message.c (xfs_message_installattr): send a
	inactive node if we failed

	* conf/arla.spec.in: believed to work spec file for rpm's

	* conf/Makefile.in: added spec file

	* tests/read-vs-mmap.c: test both all-zeros and random bytes

2000-01-26  Marcus Sundberg  <mackan@@stacken.kth.se>

	* xfs/linux/xfs_inodeops.c: fix typos

2000-01-25  Assar Westerlund  <assar@@sics.se>

	* cf/check-kernel-var.m4: try to actually use the variable tested
	for so that this doesn't get optimized away by the compiler

2000-01-25  Love  <lha@@s3.kth.se>

	* xfs/linux/Makefile.in (doclean): remove libgetcwd.so

	* configure.in (linux): test for bmap and smap

	* xfs/linux/xfs_inodeops.c: add some rough linux2.3 support, at
	least it does crash now.  remove 2.0 code need some better
	autoconf test, assume 2.3.40

	* xfs/linux/xfs_message.c: removed linux 2.0 code and fixed
	printing of pointers

2000-01-24  Love  <lha@@s3.kth.se>

	* conf/CellServDB: added ops.mit.edu

	* xfs/linux/bin/Makefile.in (install): added missing ; and \ and
	removed osf/1-ism

2000-01-23  Assar Westerlund  <assar@@sics.se>

	* configure.in: use AC_PROG_CC_FLAGS

2000-01-23  Love  <lha@@s3.kth.se>

	* xfs/linux/{xfs_syscalls.c,xfs/xfs_locl.h}: setgroups32 patches
	from Chris Wing <wingc@@engin.umich.edu>

	* *{,*/*}{,/*}/Makefile.in: s,KRB_,KRB4_,
d1017 1
a1017 116
	* xfs/linux/Makefile.in (getarg.o): no -fPIC since it doesn't
	work, _syscall2 uses bx.

	* xfs/linux/bin/arla.init.in: added linuxconf glue

	* xfs/linux/bin/Makefile.in (sysconfdir): added

	* configure.in: use new macron for finding kerberos and kafs

	* cf/check-kafs.m4: more generic way of finding kafs

	* cf/check-kerberos.m4: more generic way of finding kerberos

2000-01-22  Love  <lha@@s3.kth.se>

	* xfs/linux/Makefile.in (getcwd.o): use -fPIC when compiling, its
	supposted to be faster acording to Greg Stark <gsstark@@mit.edu>

	* xfs/linux/bin/arla.init.in: try to use modprobe

	* arlad/inter.c (cm_getattr): make sure if we have attributes that
	we have rights for the user too

	* xfs/bsd/bin/Makefile.in (install): fix typo, noticed by matt
	<deberg@@mit.edu>

2000-01-21  Love  <lha@@s3.kth.se>

	* xfs/linux/xfs_inodeops.c (xfs_readdir): warning if cache file is NULL
	(xfs_do_readlink): warning if cache file is NULL

2000-01-20  Love  <lha@@s3.kth.se>

	* arlad/arla.c (main): check that we have a dbserver then running
	in -t

2000-01-19  Love  <lha@@s3.kth.se>

	* Release 0.30

2000-01-18  Love  <lha@@s3.kth.se>

	* ydr/parse.y (enumentries,enumbody): patch for automatic
	numbering from idea of Derrick J Brashear <shadow@@dementia.org>

2000-01-17  Love  <lha@@s3.kth.se>

	* tests/test-parallel1.c,tests/parallel1: create/chmod/unlink a
	file in 10 worker threads.

	* arlad/messages.c (xfs_message_remove): remember to set dir_entry
	to NULL.

	* arlad/messages.c (xfs_message_remove): don't release dir_entry
	when it's not used
	(viocsetacl): remove unused label

	* appl/fs/fs.c (afs_setacl): don't try to follow pointers when
	counter is 0

	* arlad/messages.c (viocsetacl): install the attributes when
	successful.

	* arlad/fcache.c (setacl): return the fcache entry when
	successful, remove the break_callback (its up to the caller (like
	rest of the code do it like this))

	* arlad/messages.c (xfs_message_remove): fixa
	remove-mountpoint-problem by doing operations in diffrent
	order. The problem is that the node still was in the namecache,
	and the we got a SoftAssert (on linux).

2000-01-16 Assar Westerlund  <assar@@sics.se>

	* rxkad/rxk_crpt.c: more here endian-ness tests from acconfig.h
	* acconfig.h: remove endian-ness defines.  they cause troubles be
 	being here and are only used in rxkad anyways

	* xfs/bsd/xfs_vnodeops-bsd.c (xfs_readdir): unify much more
	* xfs/bsd/xfs_node-bsd.c (xfs_dnlc_lookup): remove extra unused
 	variables

	* xfs/bsd/Makefile.in (vnode_if.h): handle vnode_if.h hiding in
 	../sys/vnode_if.h

2000-01-16  Love  <lha@@s3.kth.se>

	* lwp/Makefile.in: added dependency for rw.o (by Derrick J
	Brashear <shadow+@@andrew.cmu.edu>)

2000-01-07  Assar Westerlund  <assar@@sics.se>

	* lwp/make-process.o.sh.in: add -DASSEMBLER when running cpp
	* acconfig.h: don't look for endianess information in
	<sys/param.h> when assembling

	* acconfig.h: new ifdef-code to handle KRB_C_BIGENDIAN
	* configure.in: replace AC_C_BIGENDIAN with KRB_C_BIGENDIAN
	* cf/krb-endian.m4: better endian-ness.  stolen from Heimdal.

	* xfs/bsd/xfs_vfsops-bsd.c (xfs_fhtovp): should send `mode' and
	not `flags' to VOP_ACCESS.  Thanks to <tol@@stacken.kth.se> for
	debuggning help

	* arlad/messages.c (xfs_message_putdata): set correct error in
	wakeup

	* rxkad/rxk_clnt.c (rxkad_NewClientSecurityObject): make sure bit
 	31 is not set in the epoch.  this bit is used by rx to mean that
 	we should only match on connection-id and that means we never get
 	any port number updates when using NAT.

	* rx/rx.c (rxi_HasActiveCalls, rxi_FindService, rxi_DestroyPeer,
 	rxi_FindConnection, rxi_CheckCall, rxi_DecongestionEvent,
 	rxs_Release): static-ize
	(rxi_RemovePeer, rxi_InsertPeer, rxi_ChangePeer): new functions
d1019 1
a1019 61
	(rxi_FindConnection): only match based on host not port.  change saved
	port if it changes.  This allows much smoother function when
 	behind a NAT.  These devices from hell usually have a very short
 	timeout on UDP `sessions' and will assign you a new port without
 	you noticing.

2000-01-07  Love  <lha@@s3.kth.se>

	* xfs/solaris/Makefile.in (load): don't remove the load tree since
	savecore needs it.

Fri Jan  7 11:36:25 2000  Magnus Ahltorp  <ahltorp@@nada.kth.se>

	* xfs/linux/{xfs_message.c,xfs_inodeops.c,/xfs/xfs_common.h}:
	New installnode code

2000-01-07  Love  <lha@@s3.kth.se>

	* xfs/solaris/xfs_dev.c (xfs_message_receive): add support for
	XFS_MSG_{VERSION,GC_NODE}

	* xfs/solaris/xfs/xfs_msg_locl.h(xfs_message_{gc_nodes,version}):
	add prototypes

	* xfs/solaris/xfs_message.c (xfs_message_{gc_nodes,version}):
	implement
	(gc_vnode): try to gc a node

	* xfs/solaris/Makefile.in (AFS,mount,unmount): where we should
	mount afs

2000-01-05  Assar Westerlund  <assar@@sics.se>

	* arlad/fcache.c (fcache_get): take care to (re-)initialize all
 	fields when re-using an entry

	* tests/generic-build: add an optional argument that specifies
 	what the directory will be called for tarbolls where it's not the
 	same as the file name without .tar.gz

	* lwp/lock.h: introduce a new cpp symbol LOCK_TRACE that keeps
	track in the lock of where (file and line) it was locked.  add
	support to the locking macros.  remove some unused (and notdef)
	code.

2000-01-02  Assar Westerlund  <assar@@sics.se>

	* configure.in (CFLAGS): more warnings
	(freebsd3): test for vnode_if.pl and vnode_if.sh properly

	* xfs/bsd/Makefile.in (vnode_if.h): fix the tests for if the file
 	exists

	* lwp/make-process.o.sh.in: link the candidate assember file to
 	process.S before trying to assemble it

2000-01-02  Love  <lha@@s3.kth.se>

	* lwp/Makefile.in(PROCESS_S): spelled .S

	* lwp/make-process.o.sh.in(PROCESS_S): spelled .S
d1021 4
a1024 5
	* (Makefile.in,make-process.o.sh.in,lwp_elf.h,process.aix22.S,
	process.alpha.S,process.hpux.S,process.i386.S,process.ibm032.S,
	process.m68k.S,process.mips.S,process.patch.S,process.ppc.S,
	process.rios.S,process.sparc.S,process.vax.S): split (and remove)
	process.S to diffrent arch-files, add ELF support for 68k
d1026 1
a1026 1
For older ChangeLog entries see ChangeLog.1999
@


1.2
log
@upgrade Arla to fresher code. Too many new features and bugfixes.
@
text
@d1 1
a1 1
1999-04-12  Assar Westerlund  <assar@@sics.se>
d3 25
a27 1
	* arlad/Makefile.in (LDFLAGS): set
d29 1
a29 1
	* configure.in: LDFLAGS: substitute
d31 3
a33 1
1999-04-06  Love  <lha@@s3.kth.se>
d35 2
a36 2
	* arlad/messages.c (viocsetvolstat): Do not change volumename,
	motd or offlinemsg
d38 1
a38 3
	* arlad/fcache.c (fcache_get): Added check if we missed
	volume. Note that we should really either nuke the entry or check
	for e->volume == NULL everywhere.
d40 8
a47 7
1999-03-29  Love  <lha@@s3.kth.se>

	* arlad/messages.c (try_again) If we don't have EDQUOT use ENOSPC

1999-03-28  Robert Burgess  <rb@@stacken.kth.se>

	* Release 0.23
d49 2
a50 11
Sat Mar 27 05:16:49 1999  Assar Westerlund  <assar@@sics.se>

	* arlad/messages.c (vioc_get_cellstatus): reverse issuid test

	* configure.in (freebsd[34]): build KLD if kernel is ELF

	* xfs/bsd/xfs_syscalls-wrap-osf.c (rename sys_xfspioctl ->
 	xfspioctl)

	* xfs/bsd/xfs_syscalls-wrap-freebsd.c (rename sys_xfspioctl ->
 	xfspioctl)
d52 1
a52 2
	* xfs/bsd/xfs_syscalls-wrap-bsd.c (rename sys_xfspioctl ->
 	xfspioctl)
d54 1
a54 2
	* xfs/bsd/xfs_syscalls-common.c (rename sys_xfspioctl ->
 	xfspioctl)
d56 1
a56 1
	* xfs/bsd/xfs/xfs_syscalls.h (rename sys_xfspioctl -> xfspioctl)
d58 4
a61 18
1999-03-27  Robert Burgess  <rb@@stacken.kth.se>

	* Removed Solaris umount_xfs (the umount command that comes with
	Solaris works better)

	* xfs/solaris/xfs_syscalls.c (fhopen_call): Changed in_size check

Wed Mar 24 23:31:09 1999  Assar Westerlund  <assar@@sics.se>

	* arlad/arla.c: always do fork_late

1999-03-20  Love  <lha@@s3.kth.se>

	* xfs/bsd/xfs/xfs_node.h: Added test for LK_SHARED

	* xfs/bsd/xfs_message.c (xfs_message_installnode): lock node when
	doing vget
	(xfs_message_installdata): lock node when doing vget
d63 4
d68 1
a68 1
1999-03-19  Love  <lha@@s3.kth.se>
d70 6
a75 1
	* Snapshot 1999-03-19
d77 1
a77 1
	* arlad/volcache.h (volume_make_uptodate): new function
d79 1
a79 1
	* arlad/volcache.c (volume_make_uptodate): new function
d81 1
a81 3
	* arlad/messages.c (try_again): ARLA_VMOVED and ARLA_VNOVOL
	invalidates volcache
	(*): new useage of try_again()
d83 2
a84 4
	* arlad/fcache.c (find_first_fs): make sure the volume is uptodate
	(try_next_fs): ARLA_VMOVED and ARLA_VNOVOL are errornous and will break
	the search for next fileserver (they mean that we should update
	our vldb info)
d86 1
a86 2
	* lib/ko/koerror.c: Added <rx/rx.h>, <fs_errors.h> and fileserver
	converted errors.
d88 2
a89 2
	* arlad/messages.c (viocflushvolume): when flushing the volume,
	flush the volume from the volcache at the same time
d91 1
a91 1
	* ydr/parse.y: use create_type
d93 2
a94 1
	* ydr/types.c (create_type): New function
d96 1
a96 3
	* xfs/bsd/xfs/xfs_node.h: If LK_EXCLUSIVE isn't defined make sure
	we define it to 1, its used for compat with old vget() that
	doesn't use lockmgr locking-style
d98 1
a98 2
	* xfs/bsd/xfs_vfsops-common.c (xfs_root_common): return a locked
	vnode
d100 5
a104 3
	* xfs/bsd/xfs_message.c: (xfs_message_install{node,root}): do
	vrele() instead of vput() since we never locks the vnode in the
	vget
d106 1
a106 2
	* xfs/bsd/xfs_vnodeops-common.c (xfs_lookup_common): Get a lock on
	when returning it
d108 4
a111 1
1999-03-16  Love  <lha@@s3.kth.se>
d113 2
a114 2
	* include/Makefile.in: Break out generated headers and files that
	comes with the dist
d116 2
a117 1
Sun Mar 14 20:03:10 1999  Assar Westerlund  <assar@@sics.se>
d119 1
a119 1
	* appl/vos_local.h: update prototypes
d121 5
a125 2
	* appl/vos_listvldb.c (vos_listvldb_iter): complain if
 	find_db_cell_and_host fails
d127 4
a130 2
	* appl/vos_examine.c (printvolstat): complain if
 	find_db_cell_and_host fails
d132 1
a132 4
	* appl/vos_common.c (get_vlentry): write a comment to make Magnus
 	happy.  assume host != NULL.
	(new_vlentry): check and complain if find_db_cell_and_host fails
	(find_db_cell_and_host): comment and remove casts
d134 2
a135 2
	* rxkad/rxk_clnt.c (client_GetResponse): handle versions >=
 	RXKAD_VERSION and always generate a version 2 response
d137 1
a137 1
1999-03-12  Love  <lha@@s3.kth.se>
d139 9
a147 1
	* Snapshot 1999-03-12
d149 1
a149 1
	* ydr/parse.y: (TPOINTER): set symbol to NULL
d151 1
a151 3
	* arlad/fcache.c (find_first_fs): set num_conns to 0 for
	DISCONNECTED case
	(do_read_attr): check if disconnected and have bits
d153 1
a153 1
1999-03-11  Love  <lha@@s3.kth.se>
d155 1
a155 2
	* arlad/fcache.c (setacl): flush bits in kernel to make it 
	update acl
d157 2
a158 1
1999-03-10  Assar Westerlund  <assar@@sics.se>
d160 1
a160 2
	* rxdef/*.xg: include <config.h> and <roken.h>.  They are needed
	when building with !gcc
d162 3
a164 1
	* xfs/bsd/xfs/xfs_vfsops.h (xfs_fhopen): correct prototype
d166 1
a166 1
	* xfs/bsd/xfs/xfs_syscalls.h (xfs_pioctl_call): correct prototype
d168 1
a168 1
	* xfs/bsd/xfs_syscalls-common.c (lookup_node): printf format fix
d170 1
a170 1
1999-03-06  Love  <lha@@s3.kth.se>
d172 1
a172 2
	* appl/vos_syncsite.c (vos_syncsite): Added arguments (-cell and
	-no-resolve)
d174 5
a178 1
	* rxdef/volumeserver.xg (AFSVolCreateVolume): name is string
d180 1
a180 1
	* appl/vos_local.h: Added prototypes
d182 1
a182 2
	* appl/vos_listvldb.c (vos_listvldb_iter): use
	find_db_cell_and_host
d184 4
a187 1
	* appl/vos_examine.c (vos_examine): use find_db_cell_and_host
d189 11
a199 3
	* appl/vos_common.c (getvolumetype): document
	(new_vlentry): New function
	(find_db_cell_and_host): new function
d201 6
a206 1
	* appl/fs.c(apropos_cmd): use sl apropos
d208 2
a209 1
	* appl/Makefile.in: Added vos_createvolume.c vos_endtrans.c to vos
d211 1
a211 1
	* appl/vos_{createvolume,endtrans}.c: New files
d213 2
a214 1
Thu Mar  4 02:40:46 1999  Assar Westerlund  <assar@@sics.se>
d216 1
a216 1
	* appl/vos_listvldb.c (vos_listvldb_iter): const-ify
d218 3
a220 5
	* appl/vos_examine.c (printvolstat): use get_vlentry

	* appl/vos_common.c (get_vlentry): use arlalib_authflags_t

	* appl/vos_common.c (get_vlentry): new function
d222 2
a223 1
	* appl/vos_dump.c: new file
d225 1
a225 2
	* ydr/types.c (define_struct): handle already declared structures
	(set_struct_body_sym): new function
d227 4
a230 2
	* ydr/parse.y: handle forward declaration of struct and redundant
 	struct keywords
d232 1
a232 14
	* ydr/output.c (generating_multi): fix macro call code

	* ydr/lex.l: match the final newline on the #line-lines from cpp
 	so that we don't increment the lineno when we should not.

	* ydr: patches from Derrick J Brashear <shadow@@dementia.org> for
 	generating rx-multi macros

1999-03-04  Love  <lha@@s3.kth.se>

	* appl/*: started to use arlalib_getauthflag arlalib_authflags_t
	for unified -noauth and -local

	* appl/vos_listvldb.c: New file
d234 1
a234 2
	* appl/vos_local.h: Added prototypes for vos_listvldb() and
	vos_listvldb_iter()
d236 2
a237 1
	* appl/vos.c (cmds): added listvldb
d239 1
a239 1
	* appl/Makefile.in (vos): vos_listvldb
d241 2
a242 1
Thu Mar  4 02:40:46 1999  Assar Westerlund  <assar@@sics.se>
d244 8
a251 2
	* xfs/bsd/xfs_vfsops-netbsd.c (xfs_vfsops): add vfs_checkexp
 	conditionally
d253 2
a254 1
	* configure.in: check for vfsops.vfs_checkexp
d256 1
a256 3
	* rx/rx_pkt.c (rxi_ReadPacket): ignore errors from recvmsg
 	silently.
	(osi_NetSend): sendmsg can return ECONNREFUSED on linux.  ignore it.
d258 1
a258 1
	* rx/rx_user.c (rxi_GetUDPSocket): set SO_BSDCOMPAT. clean-up
d260 5
a264 1
	* include/Makefile.in (install): install stds.h
d266 1
a266 1
Wed Mar  3 13:10:15 1999  Marcus Sundberg  <mackan@@stacken.kth.se>
d268 2
a269 1
	* xfs/linux/getcwd.c: removed redundant fcntl.h so it works on glibc 2.1
d271 1
a271 1
Wed Mar  3 00:49:00 1999  Marcus Sundberg  <mackan@@stacken.kth.se>
d273 1
a273 2
	* configure.in, xfs/linux/xfs_load.c, xfs/linux/xfs/xfs_locl.h:
	Linux devfs support
d275 1
a275 1
Tue Mar  2 08:50:27 1999  Assar Westerlund  <assar@@sics.se>
d277 8
a284 1
	* rxdef/*.xg: more RPCs
d286 4
a289 1
	* rx/Makefile.in (install): install header files
d291 1
a291 1
	* lwp/Makefile.in (install): install include files from srcdir
d293 3
a295 1
	* lib/ko/Makefile.in: add vlmisc
d297 4
a300 2
	* arlad/volcache.c (vldb2vldbN): move to vlmisc.c
	(get_info_loop): less warnings
d302 2
a303 1
	* appl/arlalib.c: let all the functions take a cell argument
d305 1
a305 1
	* appl/appl_locl.h: add rx header files
d307 2
a308 1
	* appl/Makefile.in: vos: re-organize
d310 1
a310 1
	* lib/ko/vlmisc.c: new file
d312 1
a312 3
	* lib/acl/Makefile.in (INCLUDES): use include directory in srcdir
	(Makefile): add
	* appl/vos.c: clean-up
d314 4
a317 5
	* ydr/output.c (print_varray): correct code
	(init_generate): let all the files include the appropriate header
	files
	(print_type): make `string<>' generate `char *'
	(encode_string): allocate memory dynamically with string<>
d319 5
a323 5
	* arlad/volcache.c (recycle_entry): don't assume that num_ptr and
 	name_ptr are parallel
	(add_clone): add a parameter for the suffix_type
	(get_info_common): if there's no read-write volume, add the read-only
	volume with the vanilla name
d325 1
a325 3
	* arlad/fcache.c (find_first_fs): do not believe volumeId[type] to
 	be valid
	(find_volume): more paranoid checks for if the volumes really exist.
d327 10
a336 1
	* arlad/conn.c (pinger): re-structure the code
d338 1
a338 2
	* rx/rx_user.c (rxi_getUDPSocket): remove code for looping around
 	bind and for checking the port number
d340 2
a341 1
	* rx/Makefile.in (install): install headers
d343 5
a347 1
	* lwp/Makefile.in (install): install headers
d349 5
a353 1
Sun Feb 28 00:44:51 1999  Assar Westerlund  <assar@@sics.se>
d355 2
a356 3
	* ydr/output.c (init_generate): add inclusion of foo.{s,c}s.h in
 	foo.{c,s}s.c
	(generate_server_stub): use prefix when writing the prototype.
d358 2
a359 1
	* configure.in: freebsd34: nuke DIAGNOSTIC test
d361 3
a363 107
	* xfs/bsd/xfs_vnodeops-bsd.c: call zfreei instead of zfree

	* ydr/output.c: always generate includs for atypes.h and rx.h in
 	stubs

	* ydr/main.c (main): return an error if parse_errors is true.

	* ydr/lex.l: recognize `proc'
	  (error_message): set a flag when an error has occured.

	* ydr/lex.h (error_message): update prototype

	* ydr/parse.y: add prefix

	* ydr/lex.l: add prefix

	* lwp/Makefile.in (install): install lwp.h

	* ydr/Makefile.in (install): install ydr

	* ydr/output.c (generating): remove roken.h and arlad/fs_errors.h

	* rxdef/*.xg: arlad/fs_errors.h -> fs_errors.h

	* lwp/Makefile.in (clean): remove test programs.

	* include/Makefile.in: install some headers

	* ydr/parse.y (param_type): default to IN
	(memberdecl2): handle string without size

Sat Feb 27 20:11:28 1999  Johan Danielsson  <joda@@blubb.pdc.kth.se>

	* xfs/bsd/xfs_dev-common.c (xfs_uprintf_device): don't print junk

Sat Feb 27 12:01:35 1999  Assar Westerlund  <assar@@sics.se>

	* util/eefile.c, util/eefile.h: new files

	* ydr: Install patches from Derrick J Brashear
	<shadow@@dementia.org> for running several instances simultaneously.

1999-02-26  Love  <lha@@s3.kth.se>

	* xfs/bsd/xfs_vnodeops-common.c: (xfs_rename_common): Don't remove
	"tname". Arlad changes the fid if it exist (linux does this today)

	* configure.in: welcome back test for mnt_syncer

	* xfs/bsd/xfs_node-bsd.c: (free_all_xfs_nodes): check if we don't
	unmount and then skip mnt_syncer

	* xfs/bsd/xfs_node-osf.c: (free_all_xfs_nodes): third dummy
	argument

	* xfs/bsd/xfs_dev-common.c (xfs_devclose_common): pass on to
	free_all_xfs_nodes that we dont unmount

	* xfs/bsd/xfs_vfsops-common.c (xfs_unmount_common): pass on to
	free_all_xfs_nodes that we unmount

1999-02-25  Love  <lha@@s3.kth.se>

	* arlad/messages.c (xfs_message_rename): flush new dir from DNLC
	cache

1999-02-22  Love  <lha@@s3.kth.se>

	* xfs/bsd/xfs_dev-common.c:(xfs_devclose_common): Removed dead
	mnt_syncer code.

	* acconfig.h: HAVE_STRUCT_VOP_FSYNC_ARGS_A_FLAGS

	* xfs/bsd/xfs_vnodeops-bsd.c (xfs_fseek):
	HAVE_STRUCT_VOP_FSYNC_ARGS_A_FLAGS

	* configure.in: check for vop_fsync_args.a_flags

	* Release 0.22

	* arlad/fs_errors.h: catch VRESTARTING

	* arlad/messages.c: catch VRESTARTING.

	* xfs/bsd/bin/startarla.in: test for kld

Sun Feb 21 04:31:22 1999  Magnus Ahltorp  <map@@stacken.kth.se>

	* xfs/linux/xfs_message.c (xfs_message_installnode): Try a
 	requested entry first, then try any entry. Delete old alias from
 	alias chain before adding it.

Sat Feb 13 02:32:37 1999  Assar Westerlund  <assar@@sics.se>

	* xfs/bsd/xfs_syscalls-common.c (sys_xfspioctl): use
 	`xfs_proc_to_cred'

	* util/Makefile.in: add heaptest
	(check): new target

	* util/heaptest.c, util/util-tester.c: improve batchability a
 	little bit

	* util/Makefile.in (libutil_SRCS, libutil_OBJS): removed prio and
 	timeprio

	* util/prio.[ch], util/timeprio.[ch]: removed
d365 2
a366 18
	* util/mem.[ch]: removed.

	* xfs/linux/getcwd.c: handle both `struct stat' and `struct
 	new_stat'

	* acconfig.h (HAVE_STRUCT_NEW_STAT): add

	* configure.in: remove old BSD kernel functions not being called
 	any longer.  test for `struct new_stat' for linux

	* xfs/linux/getcwd.c: handle the case without getcwd

	* xfs/linux/getcwd.c: try to get the current directory by any of
 	these ways:
	a. the getcwd syscall
	b. /proc/self/cwd (only on 2.1)
 	c. by tracing the directory structure backwards and comparing
 	inode numbers
a367 5
	also make sure that buf == NULL works everywhere

	* xfs/bsd/xfs_vnodeops-bsd.c (xfs_lock, xfs_unlock): re-organize
 	the code so that we handle the case of there not being any flag
 	argument (with one argument vop_lock)
d369 1
a369 2
	* xfs/bsd/xfs/xfs_vnodeops.h (xfs_fsync_common, xfs_close_common):
 	update prototypes
d371 2
a372 2
	* xfs/bsd/xfs_vnodeops-common.c (xfs_fsync_common,
 	xfs_close_common): add `proc' argument
d374 1
a374 2
	* xfs/bsd/xfs_vnodeops-osf.c (xfs_fsync, xfs_close): adapt to
 	changing *-common functions
d376 2
a377 2
	* xfs/bsd/xfs_vnodeops-bsd.c (xfs_fsync, xfs_close): adapt to
 	changing *-common functions
d379 1
a379 3
	* xfs/bsd/xfs_vnodeops-bsd.c (xfs_lock, xfs_unlock, xfs_islocked):
 	re-introduce counted locking but only when flags & LK_TYPE_MASK,
 	otherwise the assymetry comes back to bite us.
d381 2
a382 1
	* xfs/bsd/Makefile.in (unload): add support for kld
d384 1
a384 2
	* configure.in (freebsd): generate vnode_if.[ch] and -I. to be
 	able to find them
d386 3
a388 1
Sat Feb  6 03:22:56 1999  Assar Westerlund  <assar@@sics.se>
d390 1
a390 2
	* xfs/bsd/xfs/xfs_vnodeops.h (xfs_fsync_common, xfs_close_common):
 	update prototypes
d392 2
a393 2
	* xfs/bsd/xfs_vnodeops-common.c (xfs_fsync_common,
 	xfs_close_common): add `proc' argument
d395 1
a395 2
	* xfs/bsd/xfs_vnodeops-osf.c (xfs_fsync, xfs_close): adapt to
 	changing *-common functions
d397 1
a397 2
	* xfs/bsd/xfs_vnodeops-bsd.c (xfs_fsync, xfs_close): adapt to
 	changing *-common functions
d399 1
a399 3
	* xfs/bsd/xfs_vnodeops-bsd.c (xfs_lock, xfs_unlock, xfs_islocked):
 	re-introduce counted locking but only when flags & LK_TYPE_MASK,
 	otherwise the assymetry comes back to bite us.
d401 19
a419 1
	* xfs/bsd/Makefile.in (unload): add support for kld
d421 5
a425 2
	* configure.in (freebsd): generate vnode_if.[ch] and -I. to be
 	able to find them
d427 1
a427 4
	* xfs/bsd/xfs_syscalls-common.c (xfs_debug): move the super-user
 	test to the setting of the debug level.  I don't quite remember
 	why I did this but I can see no harm in letting any user find out
 	the current debug level?
d429 1
a429 1
	* tests/run-tests.in: add --help
d431 3
a433 2
	* arlad/volcache.c (vldb2vldbN): constize and only copy the safe
 	number of servers
d435 5
a439 1
	* arlad/fcache.c: remove old code
d441 1
a441 1
	* arlad/inter.c: always set Result.error to make things simpler.
d443 1
a443 1
1999-02-05  Love  <lha@@s3.kth.se>
d445 1
a445 2
	* arlad/volcache.c (vldb2vldbN): Added bounce checking
	(get_info_loop): dont loop if old serve returns RXGEN_OPCODE
d447 6
a452 1
1999-02-05  Love  <lha@@s3.kth.se>
d454 1
a454 2
	* arlad/volcache.c (vldb2vldbN): New function
	(get_info_loop): Added fallback-code for old server
d456 4
a459 1
	* arlad/volcache.c (ConnCacheEntry): Added field flags.old
d461 1
a461 1
	* arlad/conn.c (new_connection): reset flags.old
d463 5
a467 1
	* arlad/arla_local.h: Added rxgencon.h
d469 4
a472 3
	* appl/fs.c (connect_cmd): return 0;
	(newcell_cmd): rewrote and started to use getarg
	(getmaxfprio): return 0
d474 2
a475 2
	* arlad/messages.c (viocgetwscell): len strlen(cellname)+1 as
	suggested by Chuck Lever <cel@@monkey.org>
d477 1
a477 1
Mon Feb  1 05:53:52 1999  Assar Westerlund  <assar@@sics.se>
d479 1
a479 3
	* lwp/plwp.c: include config.h
	(LWP_CreateProcess): call thr_yield if there's one
	(Create_Process_Part2): fix call to pthread_attr_setstacksize
d481 1
a481 2
	* acconfig.h: define __EXTENSIONS__ to make solaris' header files
 	happy.
d483 2
a484 1
	* configure.in: check for thr_yield
d486 6
a491 1
	* lwp/plwp.[ch]: new files with lwp-over-pthreads
d493 1
a493 1
	* lwp/rw.c: new file with test code
d495 1
a495 1
	* lwp/preempt.h: more prototypes
d497 3
a499 1
	* lwp/Makefile.in: support building with lwp-over-pthreads
d501 1
a501 2
	* include/Makefile.in (lwp.h): link in the correct file for
 	LWP/pthreads
d503 1
a503 1
	* appl/Makefile.in: handle linking with pthreads
d505 1
a505 1
	* arlad/Makefile.in: handle linking with pthreads
d507 3
a509 1
	* INSTALL: document --with-pthreads
d511 1
a511 2
	* configure.in (--with-pthreads): add code from Derrick J Brashear
 	<shadow@@dementia.org> for using pthreads
d513 3
a515 1
Sun Jan 31 20:48:57 1999  Assar Westerlund  <assar@@sics.se>
d517 4
a520 2
	* configure.in (irix): always add -DR4000 to cflags, otherwise it
 	seems to break. 
d522 1
a522 1
	* xfs/irix/xfs/xfs_syscalls.h: use correct include files
d524 3
a526 1
	* xfs/irix/xfs/xfs_node.h: port to Irix 6.4
d528 1
a528 1
	* xfs/irix/xfs/xfs_fs.h: port to Irix 6.4
d530 6
a535 1
	* xfs/irix/xfs_vnodeops.c: port to Irix 6.4
d537 1
a537 1
	* xfs/irix/xfs_vfsops.c: port to Irix 6.4
d539 2
a540 2
	* xfs/irix/xfs_syscalls.c: use `curprocp' instead of `u'.  that
 	makes it work under 6.4 as well
d542 1
a542 1
	* xfs/irix/xfs_node.c: port to Irix 6.4
d544 5
a548 2
	* xfs/irix/xfs_message.c (xfs_message_installdata): VOP_LOOKUP is
 	called differently under irix 6.4
d550 1
a550 2
	* xfs/irix/Makefile.in (LDFLAGS): always add -32
	(MOD): write in current directory and not source directory
d552 1
a552 1
	* configure.in (irix): correct and portabilize irix6.4-test
d554 10
a563 2
	* xfs/solaris/xfs_vnodeops.c (xfs_map): always cast len to
 	unsigned long in the debug output
d565 3
a567 2
	* xfs/bsd/xfs_vfsops-osf.c (xfs_root): send both proc and cred to
 	xfs_root_common
d569 3
a571 2
	* configure.in (irix): define IRIX_64 if running on Irix 6.4 or
 	above.
d573 1
a573 2
	* tests/dir-size-mismatch: use find | xargs rm to remove the
 	files, it was overflowing the argument size.
d575 11
a585 1
	* xfs/solaris/xfs/xfs_dev.h (intptr_t): define if there's none
d587 2
a588 1
	* acconfig.h (HAVE_INTPTR_T): add
d590 3
a592 2
	* configure.in: bump version to 0.22pre remove duplicate test for
 	syslog test for `intptr_t'
d594 3
a596 3
Sun Jan 31 17:51:34 1999  Assar Westerlund  <assar@@sics.se>
 
	* Release 0.21
d598 2
a599 2
	* configure.in (freebsd34): add -I. to kernel flags to find the
 	generated vnode_if.h
d601 7
a607 2
	* xfs/bsd/xfs_vnodeops-bsd.c (xfs_lock, xfs_unlock, xfs_islocked):
 	more debug output
d609 1
a609 1
Sat Jan 30 17:42:00 1999  Assar Westerlund  <assar@@sics.se>
d611 1
a611 2
	* tests/copy-and-diff-gnu-mirror: use correct fd.  From Simon
 	Josefsson <jas@@pdc.kth.se>
d613 1
a613 1
1999-01-28  Love  <lha@@s3.kth.se>
d615 9
a623 1
	* arlad/arla.c(arla_cp): Added copy command.
d625 1
a625 1
1999-01-24  Love  <lha@@s3.kth.se>
d627 2
a628 1
	* conf/Makefile.in(install): Install a empty SuidCells if there is no.
d630 2
a631 1
	* tests/run-tests.in: Print out that the test FAILED while running
d633 1
a633 2
	* xfs/bsd/Makefile.in: (xfs_vopdefs.h): Make the link even if
	'mkdir xfs' fails, and test if xfs is a dir
d635 6
a640 2
	* configure.in (freebsd[34]*) Add support for freebsd4, default to
	kld on freebsd4, add output from test
d642 3
a644 1
Tue Jan 19 20:31:50 1999  Assar Westerlund  <assar@@sics.se>
d646 1
a646 2
	* configure.in (irix): check for IP and cpu and add them to
 	KERNEL_CFLAGS
d648 10
a657 2
	* xfs/irix/Makefile.in: use KERNEL_CFLAGS for figuring out CPU and
 	such
d659 4
a662 89
Sat Jan 16 18:55:17 1999  Love <lha@@stacken.kth.se>

	* configure.in: check if VOP_LOCK takes one argument (NetBSD1.3.x)

	* xfs/bsd/xfs_vnodeops-bsd.c: Check if VOP_LOCK takes one argument

Tue Jan 12 01:16:12 1999  Assar Westerlund  <assar@@sics.se>

	* xfs/include/xfs/xfs_message.h (CACHEHANDLESIZE): bump to 80
 	(needed on Solaris 7 in 64bit mode)

	* lwp/process.S: add even more ifdef's to handle sparc v9

	* lwp/make-process.o.sh.in: use CC and AS from environment.
  	remove foo.c when we're done.

	* lwp/lwp.c (REGSIZE): on a sparc v9 the registers are also 8
 	bytes

	* lwp/lwp.h (lwp_context): try to use the correct amount for sparc
 	v9

	* rx/rx_user.c (rxi_Listener): use `rx_maxSocketNumber' when
 	selecting to avoid having to send the rather large FD_SETSIZE

	* rx/rx_pkt.h (rx_GetLong, rx_PutLong): use `u_int32_t' instead of
 	`long'

	* tests/build-gdb: change path for gdb.

	* tests/build-emacs: change path for emacs.  GNU has reorganized
 	their ftp server and moved all programs into subdirectories.

Sun Jan 10 07:25:51 1999  Assar Westerlund  <assar@@sics.se>

	* arlad/fprio.c (fprio_readin): don't print a warning if the file
 	cannot be opened.

	* xfs/linux/xfs_dev.c (xfs_message_rpc): also check for strange
 	positive return values.

	* xfs/bsd/xfs_wrap-bsd.c (SYSCALL_MODULE): replace index with
 	pointer
	(xfs_load): update prototype

	* xfs/bsd/xfs_vfsops-bsd.c (vfs_object_create): use the correct
 	number of arguments

	* INSTALL (--enable-kld): add

	* configure.in (freebsd3): change test for kernel object format
	(vfs_object_create): add test for number of arguments

	* xfs/bsd/xfs_vfsops-freebsd.c: preliminary support for syscall
 	KLD module

	* xfs/bsd/xfs/xfs_vfsops.h (xfs_root_common): update prototype

	* xfs/bsd/xfs_vfsops-common.c (xfs_root_common): take a `proc' as
 	argument.  call vget instead of vref.

	* xfs/bsd/xfs_vfsops-bsd.c (xfs_root): call new style
 	xfs_root_common update comments

	* xfs/bsd/xfs_syscalls-freebsd.c: preliminary support for syscall
 	KLD module

	* xfs/bsd/xfs_wrap-bsd.c: preliminary support for syscall KLD
 	module

	* arlad/messages.c (CELLSTATUS_{PRIMARY,SETUID}): use defines
	(vioc_gcpags): implement no-op

	* arlad/inter.c (cm_getattr): real_fid is always set.

	* appl/fs_lib.c (fs_gcpags): send in a correct (and empty) params
 	structure

	* appl/fs.c (gc_cmd): correct argc and string in printf
	(all): add XDEBNODE

	* configure.in (freebsd): use sysctl to get the name of the kernel
 	reorder the include files in the kernel compilation tests, it was
 	failing on FreeBSD-current

1999-01-05  Magnus Ahltorp  <map@@stacken.kth.se>

	* xfs/linux/xfs_vfsops.c: Do xfs_d_init() when building too to
	prevent dangling pointers
d664 4
a667 2
	* xfs/linux/xfs_message.c: Hopefully more correct invalidation of
	dentries
d669 1
a669 1
Tue Jan  5 00:07:51 1999  Assar Westerlund  <assar@@sics.se>
d671 1
a671 59
	* xfs/bsd/xfs_vfsops-openbsd.c (vfs_register, vfs_unregister):
 	define and use

	* include/kafs.h: add cell status flags

1999-01-03  Love  <lha@@s3.kth.se>

	* arlad/fcache.c
	(throw_entry,fcache_reobtain_callbacks,fcache_giveup_all_callbacks):
	if the fileserver is `down' don't give up callbacks

	* xfs/bsd/xfs_node-bsd.c (xfs_getnewvnode): Set field vnlock to 0
	(new_xfs_node): Use HAVE_LK_INTERLOCK

	* xfs/include/xfs/xfs_message.h: XFS_MSG_ADVLOCK confusion

	* xfs/bsd/xfs/xfs_node.h: Added locks confusion

	* lib/ko/kocell.c: Implement clue-code for
	cell_{is,set}suid{,by_{num,name}} and $SYSCONFDIR/SuidCells

	* lib/ko/ko.h (cell_issuid): new function
	(cell_issuid_by_name): new function
	(cell_issuid_by_num): new function
	(cell_setsuid_by_num): new function
	(struct cell_entry): Added field suid_cell

	* arlad/messages.c: added rpc messages advlock
	(vioc_get_cellsstatus): implement
	(vioc_get_cells): implement

	* appl/fs_local.h: afs_listcells()

	* xfs/bsd/xfs_vnodeops-bsd.c (xfs_invalid): dummyify since is
	break free 2.2.x
	(xfs_print): write
	(xfs_advlock): comment out comfusing code

	* arlad/fcache.c (update_entry): suid-flags cleaner

	* appl/fs.c:suidcells: New command, show all cells with suid cells
	marked. afs_listcells(): Rewritten


	* appl/fs_lib.c: fs_getcells(): New function fs_getcellstatus():
	New function

	* appl/alralib.c(hfs_getcells): New function fs_getcellstatus():
	New function

	* xfs/bsd/xfs_vfsops-freebsd.c(xfs_init (<3.0)): reset ptr's
	(vfs_register): set ptr before calling function

	* conf/CellServDB(stacken.kth.se): dog.stacken.kth.se ->
	fishburger.stacken.kth.se

1999-01-03  Assar Westerlund  <assar@@sics.se>

	* arlad/reconnect.c: add some more O_BINARY
d673 4
a676 1
	* arlad/messages.c: add some more O_BINARY
d678 2
a679 1
	* arlad/fcache.c: add some more O_BINARY
d681 1
a681 2
	* util/date_rfc822.c (date_time2rfc822): update from rfc822 to
	rfc1123 section 5.2.14
d683 2
a684 2
	* rx/rx_pkt.h (RX_FIRSTBUFFERSIZE): always define it to 1468
	(RX_CBUFFERSIZE): always define it to 1024
d686 1
a686 2
	* xfs/bsd/xfs_syscalls-freebsd.c: use `sysent' instead of
 	`aout_sysvec'
d688 3
a690 1
1999-01-02  Magnus Ahltorp  <map@@stacken.kth.se>
d692 2
a693 1
	* Changed getcwd.so to libgetcwd.so.
d695 1
a695 1
Thu Dec 31 12:13:10 1998  Assar Westerlund  <assar@@sics.se>
d697 2
a698 2
	* xfs/bsd/xfs_node-bsd.c (xfs_dnlc_enter): actually set nameiop to
 	CREATE.  (when did this disappear?)
d700 1
a700 1
Thu Dec 31 13:04:23 1998  Assar Westerlund  <assar@@sics.se>
d702 1
a702 1
	* arlad/volcache.c (volcache_getbyid): use correct hash table
d704 1
a704 2
	* arlad/volcache.c (recycle_entry): don't clear entire entry
	(volcache_getbyname, volcache_getbyname): restructure
d706 4
a709 2
	* xfs/linux/xfs_message.c (xfs_message_installnode): nuke benign
 	warning
d711 2
a712 1
Wed Dec 30 11:56:04 1998  Assar Westerlund  <assar@@sics.se>
d714 1
a714 1
	* tests/untar-emacs: esthetically corect on fd 3
d716 6
a721 4
	* configure.in (freebsd3): always try to guess the kernel object
 	format, also print it out to give the user the change to see if
 	the guess was wrong.  also, warn when building LKMs with a !aout
 	kernel (maybe we should just switch to KLDs in that case).
d723 1
a723 2
	* arlad/volcache.c (recycle_entry): hopefully work around
 	refcount-bug
d725 1
a725 1
Tue Dec 29 03:01:57 1998  Assar Westerlund  <assar@@sics.se>
d727 1
a727 1
	* tests/generic-build: get rid of warning messages from tar
d729 1
a729 1
	* configure.in (full_name_hash): more politically correct test.
d731 2
a732 1
	* configure.in: --with-sys: actually use the value.
d734 2
a735 4
	* arlad/messages.c (vioc_afs_sysname): send 4 bytes length and
 	then string
	* appl/fs_lib.c (fs_get_sysname): change to expect 4 bytes before
 	sysname string
d737 5
a741 2
	* arlad/arla.c (krb_get_err_text): fallback version.  Should
 	probably be somewhere else.  kroken?
d743 1
a743 1
	* configure.in: test for krb_get_err_text
d745 1
a745 2
	* configure.in: HAVE_BROKEN_FULL_NAME_HASH ->
 	HAVE_FULL_NAME_HASH_8BIT
d747 3
a749 4
	* xfs/linux/xfs/xfs_locl.h: conditionalize on replacing
 	full_name_hash

	* configure.in: test for broken full_name_hash
d751 2
a752 1
1998-12-28  Love  <lha@@s3.kth.se>
d754 3
a756 5
	* xfs/bsd/bin/Makefile.in(startarla): Build startarla via
 	startarla.new as suggested by Ken Raeburn <raeburn@@raeburn.org>

	* rx/Makefile.in(INCLUDE): typo, fix by Ken Raeburn
 	<raeburn@@raeburn.org>
d758 5
a762 1
	* Snapshot 0.21pre
d764 1
a764 1
Mon Dec 28 01:16:36 1998  Assar Westerlund  <assar@@sics.se>
d766 4
a769 2
	* xfs/bsd/xfs_vfsops-freebsd.c (xfs_init): kludge that might make
 	it work with kld modules
d771 1
a771 1
	* aclocal.m4: KERNEL_CFLAGS -> test_KERNEL_CFLAGS
d773 5
a777 1
	* configure.in: support for building kld modules. more tests
d779 2
a780 1
	* xfs/bsd/Makefile.in: support building a kld module
d782 1
a782 2
	* xfs/bsd/xfs_vfsops-freebsd.c (xfs_init): try with
 	vfs_add_vnodeops
d784 5
a788 2
	* xfs/bsd/xfs_vfsops-netbsd.c (xfs_init): vfs_opv_init depending
 	on NetBSD-version
d790 7
a796 2
	* configure.in: check for vfs_opv_init include <sys/module.h> in
 	some tests
d798 8
a805 1
	* xfs/bsd/xfs_wrap-bsd.c: update and conditionalize KLD_MODULE
d807 1
a807 2
	* arlad/messages.c (all_powerful_p): new function.  use it.
	(vioc_afs_sysname): fix reading of sysname
d809 1
a809 2
	* configure.in: new files to test for
	(freebsd3): try to make kld work
d811 1
a811 2
	* xfs/bsd/xfs_vfsops-netbsd.c: try without having a special vfs
 	for xfs dead vnodes
d813 2
a814 2
	* xfs/bsd/xfs_vfsops-netbsd.c: HAVE_VFS_ATTACH ->
 	HAVE_KERNEL_VFS_ATTACH
d816 1
a816 1
	* xfs/bsd/xfs_vfsops-freebsd.c (xfs_stat_filesys): add
d818 1
a818 1
	* xfs/bsd/xfs_vfsops-openbsd.c (xfs_stat_filesys): add
d820 1
a820 3
	* xfs/bsd/xfs_vfsops-netbsd.c (xfs_stat_filesys): add
	(xfs_install_filesys): try xfs first
	(xfs_uninstall_filesys): dito
d822 1
a822 3
	* xfs/bsd/xfs_wrap-bsd.c (xfs_unload): try unloading filesystem
 	first
	(xfs_may_unload): remove
d824 1
a824 2
	* xfs/bsd/xfs_vfsops-netbsd.c (vfs_attach): check for vfs_init
 	being NULL
d826 17
a842 1
	* include/Makefile.in (HEADERS): add heap.h
d844 2
a845 1
	* util/heap.c, util/heap.h: new files
d847 5
a851 1
	* util/Makefile.in: add heap.[ch]
d853 1
a853 1
	* arlad/fcache.c (add_to_invalidate): go backwards
d855 1
a855 2
	* util/list.h (listhead, listtail, listprev, listnext, listdata,
 	listemptyp, listnextp): made into inline functions
d857 9
a865 1
	* arlad/inter.c (cm_close): don't overwrite the error code.
d867 2
a868 2
	* arlad/fcache.c (fcache_update_length): assert against usedbytes
 	wrapping around
d870 1
a870 2
	* arlad/fcache.c (create_file, create_directory): don't touch
 	dir_entry->status.Length
d872 3
a874 1
	* arlad/fcache.c (create_symlink): update usedbytes
d876 1
a876 2
	* INSTALL: linux: add map's warning message about updating
 	getcwd.so
d878 3
a880 2
	* arlad/reconnect.c (reconnect_putdata): adapt to new semantics of
 	copyfd2rx
d882 2
a883 2
	* arlad/fcache.c (read_data): adapt to new semantics of copyrx2fd
	and copyfd2rx
d885 3
a887 2
	* arlad/fbuf.c: *_copyfd2rx, *_copyrx2fd: don't close the fd some
 	comments
d889 3
a891 1
	* arlad/fcache.c: assert that all closes are succesful.
d893 1
a893 1
	* arlad/adir.c: assert that all closes are succesful.
d895 3
a897 1
1998-12-24  Robert Burgess  <rb@@stacken.kth.se>
d899 2
a900 1
	* Release 0.20
d902 3
a904 1
1998-12-23  Assar Westerlund  <assar@@sics.se>
d906 1
a906 2
	* xfs/linux/getcwd.c (getcwd): If we fail with ENOSYS, fall back
 	on the old getcwd.  From <allbery@@ece.cmu.edu>
d908 3
a910 2
	* lib/ko/kocell.c (newcell): no dbnum
	(readcellservdb): init dbnum
d912 4
a915 2
	* arlad/messages.c (vioc_new_cell): new function
	(vioc_get_cell): fix bugs
d917 1
a917 1
	* lib/ko/ko.h: sync with kocell.c
d919 7
a925 1
	* lib/ko/kocell.c: re-organize and write some new functions
d927 3
a929 1
	* appl/fs.c: newcell: implement
d931 2
a932 1
	* appl/fs_lib.c (fs_newcell): implement
d934 1
a934 2
	* xfs/bsd/xfs_vfsops.c: move all xfs initialization code into
	xfs_vfsops-*bsd.c
d936 2
a937 1
	* configure.in (*bsd): use xfs_vfsops-*bsd.c
d939 1
a939 1
1998-12-22  Love  <lha@@s3.kth.se>
d941 2
a942 1
	* */*/*: Moved xfs's include files to xfs/
d944 4
a947 1
1998-12-21  Assar Westerlund  <assar@@sics.se>
d949 2
a950 1
	* arlad/cred.c (print_cred): print uid correctly
d952 1
a952 2
	* arlad/fcache.c (find_next_fs): made global
	(*): hopefully use try_next_fs properly
d954 8
a961 1
Sun Dec 20 17:52:17 1998  Assar Westerlund  <assar@@sics.se>
d963 1
a963 3
	* xfs/bsd/xfs_message.c (xfs_message_installnode): vget and vput
 	the parent node to prevent it from being recycled
	(xfs_message_installdata): vget and vput the vnode.
d965 3
a967 2
	* xfs/bsd/xfs_vnodeops-common.c (xfs_symlink_common): vput the
 	just created symlink...
d969 1
a969 2
	* arlad/messages.c (try_again): also translate error codes
	(*): realfid always contains the correct fid
d971 5
a975 1
	* arlad/fcache.c (try_next_fs): some more error codes
d977 1
a977 1
	* arlad/fs_errors.h: add some more error codes
d979 2
a980 1
	* arlad/fs_errors.h (VNOVOL, ARLA_VNOVOL): add
d982 1
a982 4
	* arlad/fcache.c (findconn): remove
	(try_next_fs): figure out if it's worth trying the next fs from the
	error code.  call it.
	(fcache_get): always set realfid
d984 3
a986 1
1998-12-19  Magnus Ahltorp  <map@@stacken.kth.se>
d988 1
a988 3
	* xfs/linux/xfs_inodeops.c: Prevent xfs_lookup from returning
	errno values below -1000 in 2.1 kernels. They would otherwise be
	dereferenced in other parts of the kernel.
d990 1
a990 1
	* arlad/fcache.c: Check for rw flag when looking for backup volume
d992 1
a992 1
	* arlad/reconnect.c: Use find_first_fs instead of find_conn
d994 2
a995 1
Sat Dec 19 01:34:23 1998  Assar Westerlund  <assar@@sics.se>
d997 1
a997 2
	* appl/fs.c: move around some more
	(apropos_cmd): implement
d999 1
a999 1
	* conf/CellServDB (transarc.com): updated cell entry
d1001 3
a1003 2
	* arlad/volcache.c (get_info_loop): call VL_GetEntryByNameN
 	instead of VL_GetEntryByName
d1005 2
a1006 2
	* arlad/fs_errors.h (conv_to_arla_errno): add unused.  this also
 	requires <roken.h>
d1008 1
a1008 1
	* arlad/fcache.c (fs_server_context): MAXNSERVERS -> NMAXNSERVERS
d1010 1
a1010 1
	* arlad/volcache.h (volcacheentry): use nvldbentry
d1012 2
a1013 1
1998-12-16  Magnus Ahltorp  <map@@stacken.kth.se>
d1015 1
a1015 1
	* xfs/linux/bin/startarla.in: start arlad with -z switch
d1017 2
a1018 1
1998-12-15  Assar Westerlund  <assar@@sics.se>
d1020 2
a1021 1
	* Release 0.19
d1023 1
a1023 2
	* xfs/solaris/xfs_dev.c (xfs_message_rpc): bzero the xfs_link's.
	why is this necessary?
d1025 3
a1027 2
	* xfs/solaris/xfs_node.c (xfs_dnlc_enter): handle the case of no
	NC_NAMLEN
d1029 5
a1033 2
	* xfs/solaris/xfs_syscalls.c (xfs_debug): new function
	(xfs_pioctl_call): call xfs_debug
d1035 6
a1040 2
	* xfs/irix/xfs_dev.c (xfs_message_wakeup_data): fix call to
	MUTEX_LOCK
d1042 1
a1042 2
	* arlad/fcache.c (find_next_fs): simplify
	(free_fs_server_context): simplify
d1044 2
a1045 1
	* tests: introduce and use AFSROOT
d1047 3
a1049 5
	* arlad/fcache.c (find_first_fs): only sort valid entries.
	estimate rtt:s before sorting.
	* arlad/volcache.c (get_info_loop): only sort valid entries.
	estimate rtt:s before sorting.
	* arlad/conn.c (conn_rtt_cmp): don't handle NULL pointers
d1051 5
a1055 2
	* arlad/conn.h (conncacheentry): add rtt
	(RTT_FUZZ): add
d1057 1
a1057 1
1998-12-14  Love  <lha@@s3.kth.se>
d1059 2
a1060 1
	* xfs/unknown/xfs_deb.h: dummy
d1062 4
a1065 1
Sun Dec 13 10:55:10 1998  Assar Westerlund  <assar@@sics.se>
d1067 1
a1067 1
	* Release 0.18
d1069 2
a1070 3
	* xfs/bsd/xfs_vnodeops-bsd.c (xfs_lock, xfs_unlock, xfs_islocked):
 	add a large comment describing the sad state of affairs and remove
 	all commented out code from the functions
d1072 6
a1077 1
	* ydr/parse.y: add syntax: error-function <function>
d1079 1
a1079 1
	* configure.in (AC_C_INLINE): test for
d1081 5
a1085 3
	* arlad/fcache.c (find_first_fs, find_next_fs): update to sort
 	filservers by rtt (+ random fuzz)
	(free_fs_server_context): new function
d1087 1
a1087 2
	* arlad/volcache.c (get_info_loop): get all db-servers and sort
 	them by rtt + random fuzz.
d1089 1
a1089 2
	* arlad/conn.c (conn_rtt_cmp): comparison function for rtt of two
 	entries.  adds a random fuzz to load balance.
d1091 1
a1091 2
	* arlad/conn.h (conn_rtt_cmp): function for comparing two entries
 	for rtt
d1093 1
a1093 1
Sun Dec 13 10:47:21 1998  Magnus Ahltorp  <map@@stacken.kth.se>
d1095 2
a1096 1
	* appl/fs.c: Added fs rmm.
d1098 1
a1098 3
	* arlad/messages.c: Change to new symlink creation
 	sematics. VIOC_AFS_DELETE_MT_PT added. VIOC_AFS_STAT_MT_PT code
 	rewritten.
d1100 1
a1100 2
	* arlad/inter.c: Do followmountpoint in cm_symlink in order to
 	install correct information into xfs
d1102 1
a1102 2
	* arlad/fcache.c: Don't to fcache_update_length when doing
 	directory operations. Put more paranoia into fcache_update_length
d1104 2
a1105 8
	* arlad/adir.c: Change to unsigned char in hash function

	* xfs/linux/xfs_message.c: Invalidate cache when directory is
 	installed.

	* tests/*: New tests.

Sat Dec 12 11:52:22 1998  Assar Westerlund  <assar@@sics.se>
d1107 1
a1107 1
	* xfs/bsd/Makefile.in (SYS): set from configure
d1109 8
a1116 1
	* configure.in (--with-sys): add
d1118 1
a1118 2
	* arlad/volcache.c (get_info_loop): try to return better errors.
  	also handle the case of an non-existing volume better.
d1120 1
a1120 2
	* arlad/fcache.c (followmountpoint): update some comments and move
 	some code.
d1122 1
a1122 1
	* arlad/fcache.c (followmountpoint): more comments.
d1124 1
a1124 2
	* arlad/fcache.c (followmountpoint): restructure and split up.
  	also return better errors.
d1126 3
a1128 1
	* arlad/messages.c (vioc_arladebug): new function
d1130 1
a1130 2
	* arlad/volcache.c (volcache_getby*): return ETIMEDOUT instead of
 	ENODEV
d1132 1
a1132 1
	* arlad/fcache.c (followmountpoint): don't nuke the error code
d1134 1
a1134 3
	* arlad/conn.c (pinger): ping one host per loop.  print debug
 	information correctly
	(conn_dead): print port number/services correctly.
d1136 4
a1139 2
	* appl/fs.c (checkservers_cmd): try to give better error messages
 	for non-existing cells
d1141 1
a1141 1
	* tests/Makefile.in (SRC_TESTS): add ls-afs
d1143 1
a1143 1
	* tests/ls-afs: new test
d1145 2
a1146 1
	* appl/arlalib.h (fserr): update prototype
d1148 1
a1148 3
	* appl/fs_lib.c (fserr): const-ize, print to stderr
	(fs_checkservers): copy cell name correctly. return correct return
 	value
d1150 2
a1151 1
	* appl/fs.c (checkservers): fixes
d1153 8
a1160 1
	* appl/arlalib.h: add prototype for fs_checkservers
d1162 2
a1163 2
	* appl/fs_lib.c (fs_checkservers): random fixups move around
 	#ifdef's
d1165 1
a1165 1
	* arlad/messages.c (viocckserv): some fixes
d1167 4
a1170 1
	* arlad/conn.h (conn_probe): add prototype
d1172 1
a1172 6
	* arlad/conn.c (pinger): run `conn_free' instead of just
 	decrementing the refcount when done with a connection.  if
 	somebody else killed it while we're using it, it should get
 	recycled.
	(conn_probe): new function
	(host_down): implement CKSERV_DONTPING and some other random stuff
d1174 4
a1177 2
	* xfs/linux/xfs_inodeops.c (xfs_write_file): return `i_blocks' in
 	units of `I_BLOCKS_UNIT'
d1179 2
a1180 2
	* xfs/linux/xfs_node.c (xfs_attr2inode): return `i_blocks' in
 	units of `I_BLOCKS_UNIT'
d1182 1
a1182 1
	* xfs/linux/xfs_locl.h (I_BLOCKS_UNIT): add
d1184 3
a1186 1
	* configure.in (VERSION): bump
d1188 1
a1188 1
1998-12-08  Love  <lha@@s3.kth.se>
d1190 1
a1190 2
	* tests/run-tests.in: new file, do it in shellscript instead
	of the makefile.
d1192 1
a1192 1
	* lib/roken/getarg.[ch]: Made arg_printusage() understand style.
d1194 3
a1196 2
	* */{,*/}*.c: Made world aware of that arg_printusage() took
	a style argument.
d1198 2
a1199 1
	* fs/fs_lib.c: stub for VIOCCKSERV
d1201 6
a1206 1
	* fs/fs.c: checkservers
d1208 8
a1215 1
	* arlad/conn.[ch]: conn_downhosts
d1217 4
a1220 1
	* arlad/messages.c: Non working viocckserv()
d1222 4
a1225 1
	* include/kafs.h: Flags for VIOCCKSERV
d1227 2
a1228 1
Tue Dec  8 00:49:26 1998  Robert Burgess  <rb@@stacken.kth.se>
d1230 1
a1230 1
	* Release 0.17.1
d1232 1
a1232 1
Tue Dec  8 00:47:49 1998  Magnus Ahltorp  <map@@stacken.kth.se>
d1234 2
a1235 1
	* xfs/*: Fix memory leak.
d1237 1
a1237 1
1998-12-06  Love  <lha@@s3.kth.se>
d1239 2
a1240 1
	* tests/find-and-cat-netbsd: cat netbsd 1.3.2
d1242 8
a1249 1
Sun Dec  6 20:00:25 1998  Assar Westerlund  <assar@@sics.se>
d1251 1
a1251 1
	* Release 0.17
d1253 1
a1253 1
	* appl/amon.c (main): no options to XtAppInitialize
d1255 1
a1255 1
	* configure.in (VERSION): bump
d1257 1
a1257 1
	* INSTALL: add --without-x
d1259 2
a1260 1
	* appl/Makefile.in (AMON_LIBS): add more libraries
d1262 7
a1268 2
	* appl/fs_lib.c (debug): new helper function
	(arla_debug): new function
d1270 2
a1271 1
	* appl/fs_local.h (arla_debug): add prototype
d1273 9
a1281 2
	* appl/fs.c (arladebug_cmd): new function
	(xfsdebug_cmd): fix parsing and unparsing of flags
d1283 9
a1291 1
	* appl/Makefile.in (fs): add arladeb.c
d1293 2
a1294 1
	* xfs/bsd/xfs_deb.c (xfsdeb): no XDEBANY
d1296 1
a1296 1
	* xfs/linux/xfs_syscalls.h: remove xfs_syscall debug stuff
d1298 1
a1298 1
	* xfs/linux/xfs_syscalls.c (handle_xfs_syscall): remove
d1300 1
a1300 1
	* xfs/include/xfs_debug.h (XDEBANY): remove
d1302 4
a1305 1
	* include/kafs.h (VIOC_ARLADEBUG): add
d1307 3
a1309 1
	* configure.in (VERSION): bump
d1311 2
a1312 1
1998-12-06  Love  <lha@@s3.kth.se>
d1314 1
a1314 2
	* arlad/messages.c (viocaviator): New funtion
	(xfs_message_pioctl): Add VIOC_AVIATOR case
d1316 3
a1318 1
	* appl/fs_lib.c (fs_getaviatorstats)new function
d1320 1
a1320 1
	* appl/arlalib.h (fs_getaviatorstats)new function
d1322 1
a1322 2
	* arlad/kernel.[ch]: added kernel_usedworkers() and
	kernel_highworkers()
d1324 1
a1324 1
	* include/kafs.h: added VIOC_AVIATOR
d1326 5
a1330 1
	* appl/amon.c: Break out stripChart and add workers
d1332 2
a1333 1
	* configure.in: Check for X.
d1335 1
a1335 1
	* appl/amon.c: New, monitor number of vnodes and kbytes used i cache.
d1337 2
a1338 1
Sun Dec  6 00:02:42 1998  Assar Westerlund  <assar@@sics.se>
d1340 1
a1340 4
	* arlad/arladeb.h (arla_deb_units): export new prototypes
	* arlad/arladeb.c (arla_deb_units): define in order.  define all
 	and almost-all properly
	(arla_log_set_level_num, arla_log_get_level_num): new functions
d1342 2
a1343 1
	* xfs/linux/setdebug.c: removed
d1345 2
a1346 1
	* xfs/linux/Makefile.in: removed setdebug
d1348 1
a1348 1
	* arlad/discon_log.c (log_head): initialize to zero by default
d1350 2
a1351 1
	* arlad/reconnect.c: static-ize some
d1353 1
a1353 1
	* arlad/darla.h: add prototypes
d1355 2
a1356 1
	* arlad/arla_local.h: include reconnect.h
d1358 1
a1358 1
	* arlad/reconnect.h: new file
d1360 2
a1361 1
	* appl/vos.c (main): initports -> ports_init
d1363 1
a1363 1
	* appl/pts.c (main): initports -> ports_init
d1365 1
a1365 2
	* lib/ko/ports.c (ports_num2name): new function
	(initports): renamed to ports_init.  changed all callers
d1367 2
a1368 1
	* arlad/volcache.c (vl_probe): new function
d1370 1
a1370 4
	* arlad/messages.c (try_again): print a warning and sleep while
 	waiting for a busy volume
	(viocgetacl, viocsetacl, viocgetvolstat, viocsetvolstat): call
	try_again
d1372 2
a1373 2
	* arlad/fcache.c (fs_probe): new function
	(invalidator): new debug messages
d1375 2
a1376 2
	* arlad/cred.c (cred_expire): print a message telling the user
 	that credentials have expired
d1378 1
a1378 3
	* arlad/conn.h (ConnCacheEntry): add `probe', `probe_le',
 	`probe_next', `ntries'
	(conn_get): new parameter `probe'
d1380 1
a1380 7
	* arlad/conn.c: probe servers that were marked as down.
	(re_probe, add_to_probe_list, pinger): new functions
	(conn_init): start a pinger thread
	(new_connection, add_connection, internal_get, conn_get): new
	parameter `probe' (a function that probes the service)
	(conn_dead): print message when loosing connection to a server
	(conn_alive): print message when a server comes up again
d1382 1
a1382 1
	* arlad/arla_local.h: add <pwd.h>
d1384 2
a1385 2
	* arlad/arla.c (main): init rx before conn.  initports ->
 	ports_init
d1387 2
a1388 1
	* xfs/irix/Makefile.in (CFLAGS): update with more magic flags
d1390 1
a1390 1
	* util/list.c (listempty): explicit cast to shut up SGI cc
d1392 4
a1395 2
	* tests/copy-and-diff-gnu-mirror: use find and cmp instead of diff
 	-r
d1397 8
a1404 1
	* arlad/discon_log.c (write_log_ent): add type to `index'
d1406 1
a1406 2
	* xfs/linux/xfs_message.c (xfs_message_installnode): use
 	xfs_full_name_hash instead of full_name_hash
d1408 1
a1408 2
	* xfs/linux/xfs_inodeops.c (xfs_readdir): use xfs_full_name_hash
 	instead of full_name_hash
d1410 15
a1424 2
	* xfs/linux/xfs_locl.h (xfs_full_name_hash): work-around for
 	broken full_name_in_hash in 2.1.131
d1426 3
a1428 2
	* xfs/linux/xfs_vfsops.c (xfs_delete_inode): correct type in debug
 	output
d1430 1
a1430 1
Sat Dec  5 00:35:05 1998  Assar Westerlund  <assar@@sics.se>
d1432 1
a1432 1
	* tests/Makefile.in (SRC_TESTS): add build-gdb
d1434 2
a1435 1
	* tests/build-emacs: use generic-build
d1437 1
a1437 1
	* tests/build-gdb: new test
d1439 1
a1439 1
	* tests/generic-build: new file
d1441 1
a1441 1
	* tests/strange-characters: new test
d1443 1
a1443 2
	* tests/read-vs-mmap.c, read-vs-mmap2.c, mmap-and-read.c: include
 	<time.h>
d1445 4
a1448 3
	* tests/Makefile.in: add copy-and-diff-gnu-mirror
	(check): generate more unique directory names so that several tests
	can be run in the same directory at the same time
d1450 2
a1451 1
	* tests/copy-and-diff-gnu-mirror: new test
d1453 1
a1453 2
	* arlad/kernel.c (worker): move `data' up front to make sure it's
 	more suitably aligned.  how should this really be done?
d1455 2
a1456 1
	* lwp/make-process.o.sh.in (irix): needs -n32 to as.
d1458 2
a1459 1
	* arlad/discon_log.h: clean-up
d1461 1
a1461 1
	* arlad/discon.h: clean-up
d1463 5
a1467 1
	* arlad/reconnect.c (reconnect_create): remove C++-comment
d1469 1
a1469 2
	* arlad/discon_log.c (update_log_ent): fix strange comment
 	look-a-likes
d1471 4
a1474 2
	* arlad/messages.c (afsstatus2xfs_attr): use ClientModTime instead
 	of ServerModTime
d1476 1
a1476 1
	* arlad/adir.c: spell-checking and updating of comments
d1478 1
a1478 2
	* arlad/fcache.c (find_next_fs): destroy previous connection.
  	change all callers.
d1480 2
a1481 1
	* arlad/fcache.c: call conn_dead at all the appropriate places
d1483 1
a1483 1
	* arlad/volcache.c (get_info_loop): mark conns as dead
d1485 1
a1485 5
	* arlad/conn.c (create_new_connections): init `parent'
	(recycle_conn): remove one reference to `parent'
	(internal_get): new function.  handle setting of parent.
	(conn_get): only return live servers
	(conn_dead, conn_alive): new functions
d1487 1
a1487 3
	* arlad/conn.h (ConnCacheEntry): `parent' points to a
 	security-cred-free instance
	(conn_dead, conn_alive): new functions
d1489 1
a1489 2
	* arlad/fcache.c (find_next_fs, find_first_fs): fill the daily
 	quota for comments.
d1491 1
a1491 2
	* arlad/fcache.c (find_next_fs): remember how far we got
	(getacl, setacl, getvolstat, setvolstat): always call fcache_release
d1493 1
a1493 1
1998-12-05  Love  <lha@@s3.kth.se>
d1495 2
a1496 2
	* arlad/arla.c: New option, --fork-late,-f that daemonify,
	when everything is setup and running.
d1498 1
a1498 1
1998-12-03  Love  <lha@@s3.kth.se>
d1500 1
a1500 1
	* Cleaned up disconnected code (no warnings).
d1502 1
a1502 1
Wed Dec  2 05:04:04 1998  Assar Westerlund  <assar@@sics.se>
d1504 3
a1506 1
	* arlad/messages.c (viocgetcell): update to use `cell_dbservers'
d1508 2
a1509 3
	* arlad/fcache.c (find_first_fs, find_next_fs): new functions.
  	use them.
	(findconn): dead.  reconnect code probably doesn't work
d1511 3
a1513 2
	* arlad/volcache.c (get_info_loop): new function to try all db
 	servers.  use it.
d1515 2
a1516 1
	* lib/ko/ko.h (cell_dbservers): new prototype
d1518 2
a1519 3
	* lib/ko/kocell.c (cell_dbservers): new function to list all DB
 	servers
	(cell_listdbserver, cell_finddbserver): removed
d1521 4
a1524 1
	* ydr/output.c (print_array, print_varray): fix printf types
d1526 2
a1527 1
Wed Dec  2 09:26:55 1998  Robert Burgess  <rb@@stacken.kth.se>
d1529 1
a1529 1
	* Release 0.16
d1531 4
a1534 1
Wed Dec  2 00:10:05 1998  Assar Westerlund  <assar@@sics.se>
d1536 2
a1537 1
	* tests/large-dir.c, tests/large-dir-16384: new files
d1539 1
a1539 1
	* tests/Makefile.in (TEST_PROGRAMS): add large-dir
d1541 2
a1542 1
	* tests/large-dir.c (creat_files): fix types
d1544 1
a1544 2
	* tests/mmap-and-read.c (generate_random_file): generate digits in
 	the different pages
d1546 1
a1546 2
	* configure.in: vm/vm_object.h, vm/vm_pager.h, vm/vnode_pager.h:
 	check for
d1548 1
a1548 1
	* util/hash.c (_add): add braces to make it do what I mean
d1550 3
a1552 1
	* util/hash.h (hashtabaddreplace): new prototype
d1554 1
a1554 2
	* util/hash.c (hashtabadd): renamed hashtabaddreplace
	(hashtabadd): don't replace existing entry
d1556 9
a1564 1
	* arlad/afs_dir.h (MAXPAGES): update comment
d1566 2
a1567 1
	* arlad/afsdir_check.c: handle large directories
d1569 2
a1570 3
	* arlad/adir.c (getpage): new function.  use it.
	(is_page_empty): new function
	handle large directories
d1572 5
a1576 54
	* tests/large-dir.c (creat_files): better close the files

	* xfs/bsd/xfs_message.c (xfs_message_installattr,
 	xfs_message_installdata): set pager size

	* xfs/bsd/xfs_locl.h: include vm/vm.h and vm/vm_extern.h

	* configure.in: VERSION: bump to 0.15
	vm/vm.h, vm/vm_extern.h: check for

	* arlad/reconnect.c: don't inlcude discon_fix.h

	* arlad/discon_fix.h: remove. not used anymore.

	* arlad/discon_log.c: don't inlcude discon_fix.h

	* arlad/arla_local.h: remove discon_fix.h

	* arlad/discon_log.h: replace vattr by xfs_attr and moved two
 	definitions here from discon_fix.h

1998-11-23  Love  <lha@@s3.kth.se>

	* Release 0.15

Sun Nov 22 00:35:33 1998  Assar Westerlund  <assar@@sics.se>

	* arlad/inter.c (cm_open): set result to zero if succesful

	* arlad/fs_errors.h: new file

	* arlad/messages.c (try_again): new function
	(xfs_message_*): rewritten to use a loop and call try_again to handle
	expiring kerberos credentials and busy volumes

	* arlad/kernel.c (WORKER_STACKSIZE): increase

	* tests/untar-emacs: progress to fd 3

	* tests/Makefile.in (check): give the tests a fd to stderr

	* tests/Makefile.in: add read-vs-mmap2

	* tests/read-vs-mmap2.c: new file

	* tests/Makefile.in (SRC_TESTS): add rename2
	(check): write output of failing tests into temporary files. run
	scripts with $(SHELL) -x

	* tests/Makefile.in: add mmap-and-read

	* arlad/inter.c (cm_mkdir): ReleaseSharedLock -> ReleaseWriteLock

	* arlad/fcache.h (fcache_update_length); add prototype
d1578 11
a1588 1
	* arlad/fcache.c (fcache_update_length): new function.  use it.
d1590 3
a1592 1
	* arlad/adir.c: call fcache_update_length at appropriate places
d1594 1
a1594 2
	* configure.in: don't test for <sys/dirent.h> test for
 	vfs_object_create and vnode_pager_setsize
d1596 1
a1596 1
	* tests/read-vs-mmap.c: new file
d1598 1
a1598 1
	* tests/hello-world.in: new file
d1600 1
a1600 1
	* tests/Makefile.in: hello-world, read-vs-mmap: add
d1602 2
a1603 1
	* arlad/fbuf.c (fbuf_buf): new function
d1605 1
a1605 1
	* arlad/fbuf.h (fbuf_buf): add prototype
d1607 2
a1608 1
	* arlad/fbuf.h: (fbuf_len): add prototype
d1610 3
a1612 1
	* arlad/fbuf.c (fbuf_len): add
d1614 2
a1615 1
	* tests/untar-emacs: add . in loop
d1617 1
a1617 1
	* xfs/bsd/xfs_vnodeops-bsd.c (xfs_getpages): report the error
d1619 2
a1620 2
	* xfs/bsd/xfs_vfsops-bsd.c (xfs_fhlookup): call vfs_object_create
 	if there's one.
d1622 1
a1622 2
	* xfs/bsd/xfs_vnodeops-common.c (xfs_write_comon): call
 	`vnode_pager_setsize' if there's one
d1624 2
a1625 1
1998-11-18  Love  <lha@@s3.kth.se>
d1627 1
a1627 2
	* xfs/bsd/xfs_vnodeops-bsd.c(xfs_{get,put}pages): use
	vnode_pager_generic_{put,get}pages if they exist.
d1629 3
a1631 1
Tue Nov 17 04:10:59 1998  Assar Westerlund  <assar@@sics.se>
d1633 1
a1633 1
	* xfs/bsd/bin/startarla.in: create /afs
d1635 2
a1636 1
	* arlad/bsd-subr.c (write_dirent): use _GENERIC_DIRSIZ
d1638 1
a1638 2
	* arlad/arla_local.h: only include <sys/dir.h> if there's no
 	<dirent.h>
d1640 2
a1641 1
1998-11-15  Love  <lha@@s3.kth.se>
d1643 1
a1643 4
	* arlad/inter.c(cm_rename): Check in new_name already exist, and
	delete it in that case, this should not happen. Suggested by
	Chuck Lever <chuckl@@netscape.com>. Relly a problem between 
	implementations of rename i bsd and linux xfs.
d1645 1
a1645 1
1998-11-14  Love  <lha@@s3.kth.se>
d1647 1
a1647 1
	* arlad/inter.c(cm_rename): use adir_lookup_fcacheentry()
d1649 10
a1658 1
	* arlad/adir.[ch]: New function adir_lookup_fcacheentry()
d1660 1
a1660 1
Fri Nov 13 05:31:27 1998  Assar Westerlund  <assar@@sics.se>
d1662 8
a1669 1
	* arlad/volcache.c (get_info_common): check for dfs fileset
d1671 21
a1691 1
	* rxdef/vldb.xg (VLF_DFSFILE_SET): added
d1693 1
a1693 1
Tue Nov 10 05:08:27 1998  Assar Westerlund  <assar@@sics.se>
d1695 12
a1706 2
	* arlad/fcache.c (fcache_get): handle the case of the entry
 	appearing while we were out looking for a free entry to put it in.
d1708 1
a1708 1
	* arlad/adir.c (adir_lookup): centry shouldn't be static
d1710 15
a1724 1
1998-11-08  Love  <lha@@s3.kth.se>
d1726 2
a1727 2
	* ydr/output.c: dont ydr the OUT arguments in server stub if
	function fails, ie returns != 0.
d1729 1
a1729 1
Sat Nov  7 17:22:58 1998  Assar Westerlund  <assar@@sics.se>
d1731 1
a1731 1
	* arlad/arla.c: new argument --workers
d1733 2
a1734 2
	* arlad/kernel.c (kernel_interface): dynamic number of worker
 	threads
d1736 2
a1737 1
	* arlad/{discon_fix.h,darla.h,discon_log.c,discon.h,discon_log.h,darla.c,reconnect.c}: new files (from wwshen)
d1739 1
a1739 1
	* include/kafs.h (CONNMODE_PARCONNECTED): new
d1741 5
a1745 4
	* arlad/messages.c (xfs_message_create): preliminary disconn
 	support
	(viocconnectmode): create and replay log on transitions between
	DISCONNECTED and CONNECTED
d1747 1
a1747 1
	* arlad/fcache.h: some new prototypes
d1749 14
a1762 2
	* arlad/cmcb.c (cmcb_init): not being able to create security
 	objects is a fatal error
d1764 2
a1765 15
	* arlad/fcache.c (throw_entry): signal threads waiting on fee
 	nodes
	(unlink_lru_entry): if there are no nodes, sleep until they appear.
	don't reuse nodes being used.
	(findconn): made global. handle disconnected mode
	(find_entry): remove bogus assert
	(fcache_unused): new function
	(fcache_giveup_all_callbacks): new function
	(fcache_reobtain_callbacks): new function
	(do_read_attr): more asserts
	(read_data): more asserts
	(write_data): try to handle disconnected mode
	(truncate_file): try to handle disconnected mode
	(create_file): dito
	(fcache_get): can't set volume if disconnected
d1767 1
a1767 3
	* arlad/adir.c (adir_lookup): remove static variables.  add more
 	asserts
	(adir_readdir): handle the case of broken pgcount in athena.mit.edu
d1769 2
a1770 2
	* arlad/kernel.c: create NUM_WORKERS worker threads to handle
 	messages from xfs
d1772 2
a1773 3
	* arlad/volcache.c (get_info): handle the case of getting back a
 	different name (seems to happen with DFS-servers).  move out some
 	common code.
d1775 3
a1777 1
1998-11-07  Assar Westerlund  <assar@@sics.se>
d1779 5
a1783 1
	* xfs/bsd/xfs_vfsops-bsd.c (xfs_dead_lookup): add
d1785 2
a1786 1
	* arlad/volcache.c: separate out the _byid and _byname functions.
d1788 1
a1788 1
1998-11-07  Love  <lha@@s3.kth.se>
d1790 6
a1795 1
	* appl/fs.c: Patches from Andrzej Filinski <andrzej@@daimi.aau.dk>
d1797 1
a1797 1
1998-11-04  Love  <lha@@s3.kth.se>
d1799 1
a1799 2
	* arlad/fbuf.c (malloc_create): Do lseek(fd, 0, SEEK_SET) before 
	reading in the file.
d1801 1
a1801 1
	* doc/oddities.texi: Added.
d1803 3
a1805 1
1998-11-02  Love  <lha@@s3.kth.se>
d1807 1
a1807 1
	* xfs/bsd/xfs_vfsops-bsd.c (xfs_fhopen): Fix for FreeBSD3.0
d1809 3
a1811 1
	* util/list.[ch] (listnextp): New function.
d1813 1
a1813 1
	* ydr/main.c: Call generate_tcpdump_patches().
d1815 1
a1815 2
	* ydr/parse.y: Call generate_printfunction{,_prototype} and
	generate_tcpdump_stub
d1817 1
a1817 1
	* ydr/output.h: Random prototypes for below functions.
d1819 1
a1819 86
	* ydr/output.c: Introduces concept of printing ydr structures,
	added random comment (in generated and !generated code).
	(td_file): where tcpdump patches ends up.
	(encode_*): Changed sematics for *_MEM, now do goto fail; instead
	of return
	(print_*): Implemented random functions and stubs for the rest.
	(display_type): entrypoint for printing functions
	
Mon Nov  2 05:11:25 1998  Assar Westerlund  <assar@@sics.se>

	* arlad/fcache.c (throw_data): check that the length of the cache
 	file agress with the status

	* arlad/arladeb.c (arla_deb_units): add `almost-all'

	* xfs/bsd/xfs_vnodeops-osf.c (xfs_create): don't print va_rawmode,
 	there's no such field in 4.0

	* xfs/bsd/xfs_vfsops-osf.c (xfs_root): moved the code to
 	xfs_root_common

	* xfs/bsd/xfs_vfsops.h (xfs_root_common, make_dead_vnode): add

	* xfs/bsd/xfs_vfsops-common.c (xfs_root_common): new function

	* xfs/bsd/xfs_vfsops-bsd.c (make_dead_vnode): set v_data in newly
 	created node
	(xfs_root): moved the code to xfs_root_common
	(xfs_install_filesys): use vfs_register if available

	* arlad/fcache.c (write_data): make sure `usedbytes' and
 	entry->status.Length is updated correctly even if we fail to write
 	the data to the server

	* aclocal.m4 (AC_C___ATTRIBUTE__): update to discover that the
 	support for __attribute__ in gcc 2.6.3 is not enough for us

Mon Nov  2 05:53:25 1998  Robert Burgess  <rb@@stacken.kth.se>

	* Release 0.14.1

1998-11-02  Love  <lha@@s3.kth.se>

	* README: Note about ultrix.

	* lib/acl/acl.h: Added stds.h, patch from Max
	<davros@@cyclone.Stanford.EDU>

Mon Nov  2 02:38:52 1998  Robert Burgess  <rb@@stacken.kth.se>

	* Release 0.14

1998-11-02  Love  <lha@@s3.kth.se>

	* xfs/bsd/xfs_vnodeops-bsd.c (xfs_{get,put}pages): Disable since
	it doesn't work.

1998-10-31  Love  <lha@@s3.kth.se>

	* configure.in (FreeBSD3.0): Ugly hack to check if we have
	DIAGNOSTIC in kernel.

	* xfs/bsd/xfs_vnodeops-common.c: FreeBSD3.0
	(xfs_rename-common): Removed common


Sat Oct 31 15:00:55 1998  Johan Danielsson  <joda@@hella.pdc.kth.se>

	* xfs/bsd/xfs_syscalls-common.c: make xfs_is_pag static

	* xfs/bsd/xfs_node-osf.c (vattr2xfs_attr): va_mode is u_short, not
 	mode_t
	
Sat Oct 31 03:42:23 1998  Assar Westerlund  <assar@@sics.se>

	* xfs/linux/xfs_inodeops.c (xfs_d_delete): make sure we have an
 	xfs_node to delete

	* xfs/solaris/bin/Makefile.in (check): add

	* arlad/inter.c (cm_rename): swap order of adir_creat and
 	adir_remove

Wed Oct 28 04:00:05 1998  Assar Westerlund  <assar@@sics.se>

	* xfs/bsd/xfs_syscalls-freebsd.c (xfs_syscall): fix typo
d1821 1
a1821 2
	* configure.in: vfsops: test for vfs_uninit and vfs_oidp struct
 	proc.p_retval: improve test vfs_register: test for
d1823 2
a1824 1
Sun Oct 25 20:36:37 1998  Johan Danielsson  <joda@@hella.pdc.kth.se>
d1826 11
a1836 1
	* arlad/arla.c: implement simple `wc' command
d1838 1
a1838 1
	* rx/rx_clock.c: STARTVALUE for UXP/V
d1840 3
a1842 1
	* lwp/make-process.o.sh.in: UXP/V
d1844 2
a1845 1
	* lwp/lwp.c: set regsize to 8 for UXP/V
d1847 1
a1847 1
	* lwp/process-vpp.s: LWP context switch for Fujitsu UXP/V
d1849 3
a1851 1
1998-10-25  Assar Westerlund  <assar@@sics.se>
d1853 1
a1853 1
	* configure.in (freebsd3): set VFS_LKM
d1855 1
a1855 1
Sun Oct 25 09:48:25 1998  Magnus Ahltorp  <map@@lroken.stacken.kth.se>
d1857 1
a1857 1
	* arlad: Added viocgetcacheparms
d1859 1
a1859 1
	* xfs/linux: Use filehandles in installdata. SMP fixes.
d1861 1
a1861 1
Sat Oct 24 02:11:00 1998  Magnus Ahltorp  <map@@lroken.stacken.kth.se>
d1863 1
a1863 1
	* xfs/linux: Added filehandle support
d1865 2
a1866 1
1998-10-24  Assar Westerlund  <assar@@sics.se>
d1868 1
a1868 2
	* xfs/bsd/xfs_message.c (xfs_message_installdata): revert second
	part of last change.
d1870 1
a1870 3
	* xfs/bsd/xfs_message.c (xfs_message_installdata): fall back to
	looking up cached by names if fhlookup fails.  do not reinstall
	the same node.
d1872 1
a1872 2
	* xfs/bsd/xfs_vfsops-common.c (xfs_unmount_common): conditionalize
	on HAVE_KERNEL_DOFORCE
d1874 1
a1874 3
	* xfs/bsd/Makefile.in (DEFS): remove DIAGNOSTICS.  defining this
	when it's defined in the kernel build would be a good idea but we
	currently have no way of knowing when that's the case.
d1876 6
a1881 2
	* arlad/adir.c (adir_lookup, adir_changefid): fcache_release
	properly
d1883 2
a1884 1
	* configure.in (doforce): check for
d1886 1
a1886 1
	* aclocal.m4 (AC_CHECK_KERNEL_VAR): new macro
d1888 2
a1889 1
	* xfs/bsd/bin/mount_xfs.c: handle two argument getvfsbyname
d1891 3
a1893 1
	* configure.in: getvfsbyname: check for two argument version
d1895 2
a1896 1
1998-10-23  Love  <lha@@natt.e.kth.se>
d1898 1
a1898 1
	* rxkad/rxkad_locl.h: #ifndef assert
d1900 1
a1900 5
	* appl/pts.c: Implemented: createuser, creategroup, delete, remove,
	rename, chown, setfields
	(pr_name2id): Bugfixed
	(prdebug): Added debugging variable, and added some output code.
	(main): Added cvs style debugging switch.
d1902 1
a1902 1
	* lib/ko/koerror.c: Added prerrors.
d1904 1
a1904 1
	* xfs/bsd/xfs_vnodeops-bsd.c (xfs_readdir): Cookies are off_t in NetBSD
d1906 1
a1906 1
1998-10-21  Love  <lha@@s3.kth.se>
d1908 1
a1908 2
	* xfs/bsd/xfs_vnodeops-bsd.c (xfs_readdir): No need to save cookies
	for netbsd.
d1910 2
a1911 2
	* ydr/output.c (encode_string): Check length of size-less TSTRING
	when decoding.
d1913 1
a1913 1
Wed Oct 21 22:41:29 1998  Johan Danielsson  <joda@@hella.pdc.kth.se>
d1915 1
a1915 1
	* xfs/bsd/xfs_node-bsd.c (xfs_cnp_init): init cn_proc
d1917 1
a1917 1
Mon Oct 19 01:47:22 1998  Assar Westerlund  <assar@@sics.se>
d1919 3
a1921 2
	* xfs/bsd/xfs_syscalls-common.c (fhget_call, remote_pioctl):
 	re-order code so that we always vrele vp
d1923 2
a1924 2
	* arlad/adir.c (adir_lookup): don't release the centry if
 	fcache_get fails
d1926 1
a1926 1
	* arlad/messages.c (viocvenuslog): only print rx stats if RX_DEBUG
d1928 1
a1928 1
	* xfs/bsd/xfs_msg_locl.h: new prototype
d1930 2
a1931 1
	* xfs/bsd/xfs_message.c (xfs_message_updatefid): new function
d1933 1
a1933 1
	* xfs/include/xfs_message.h (XFS_MESSAGE_UPDATEFID): new message
d1935 1
a1935 2
	* xfs/bsd/xfs_dev-common.c (xfs_message_receive): handle
 	XFS_MSG_UPDATEFID
d1937 1
a1937 3
	* arlad/messages.c (update_kernelfid): new function
	(xfs_message_pioctl): moved most of the operations into functions of
	their own
d1939 2
a1940 1
	* arlad/adir.h: new prototypes
d1942 1
a1942 16
	* arlad/adir.c (find_entry): new function
	(find_by_name): use find_entry
	(update_fid_by_name): new function
	(adir_changefid): new function
	(adir_emptyp): new function

1998-10-19  Assar Westerlund  <assar@@sics.se>

	* lwp/make-process.o.sh.in (irix): needs -n32 add -I../include to
	find config.h

	* lwp/process.S (hopefully) improve some of the conditional stuff.

Sun Oct 18 11:00:58 1998  Assar Westerlund  <assar@@sics.se>

	* xfs/bsd/xfs_vnodeops-bsd.c (xfs_mkdir): conditionalize vput
d1944 2
a1945 31
	* xfs/irix/xfs_vnodeops.c (xfs_write): merge solaris fix for
 	updating mtime and size
	(xfs_creat): merge solaris fix for truncating file
	(xfs_map): try to implement

Sun Oct 18 00:03:12 1998  Assar Westerlund  <assar@@sics.se>

	* xfs/bsd/xfs_vnodeops-bsd.c (xfs_symlink): fix call to
 	xfs_symlink_common

	* arlad/cred.h (cred_add_krb4): updated prototype

	* arlad/cred.c (cred_add_krb4): add `uid'

Sun Oct 18 00:02:36 1998  Johan Danielsson  <joda@@hella.pdc.kth.se>

	* xfs/bsd/xfs_node-osf.c (vattr2xfs_attr): cast VNOVAL to correct
 	type
	(xfs_cnp_init): fix hash calculation

	* xfs/bsd/xfs_vnodeops-*.c: don't pass cnp to various common
 	vnode-ops

Sat Oct 17 12:37:54 1998  Assar Westerlund  <assar@@sics.se>

	* xfs/bsd/xfs_vnodeops-common.c (xfs_lookup_common,
 	xfs_create_common): disable my create optimization

	* xfs/bsd/xfs_node-bsd.c (new_xfs_node): fix interlock stuff

	* arlad/adir.c (adir_lookup): disable cache
d1947 1
a1947 2
	* xfs/bsd/xfs_message.c (xfs_message_installdata): only purge
 	cache if XFS_INVALID_DNLC is set
d1949 1
a1949 1
	* arlad/messages.c: set installdata.flag
d1951 1
a1951 1
	* xfs/include/xfs_message.h (installdata): add a flag
d1953 1
a1953 1
Sat Oct 17 11:47:48 1998  Assar Westerlund  <assar@@sics.se>
d1955 1
a1955 2
	* arlad/messages.c (token_for_cell): return uid
	(xfs_message_pioctl VIOCSETTOK): remember uid
d1957 1
a1957 1
	* arlad/cred.c (cred_add): add `uid'
d1959 2
a1960 1
	* arlad/cred.h (CredCacheEntry): add uid
d1962 1
a1962 2
	* xfs/irix/xfs_vnodeops.c (xfs_readdir): look at the abi and
 	convert to irix5_dirent if needed
d1964 2
a1965 1
	* xfs/bsd/xfs_vnodeops-common.c: remove bsd-specific code
d1967 2
a1968 3
	* xfs/bsd/xfs_vnodeops-bsd.c (xfs_lookup, xfs_remove, xfs_rmdir,
 	xfs_link, xfs_symlink): move the freeing of the namei buffer here
 	from common
d1970 1
a1970 1
	* xfs/bsd/xfs_vfsops-osf.c (make_dead_vnode): fix prototype
d1972 2
a1973 2
	* xfs/bsd/xfs_syscalls-common.c: include <sys/ioccom.h> or
 	<sys/ioctl.h>
d1975 1
a1975 2
	* xfs/bsd/xfs_node-osf.c (xfs_dnlc_enter): do the negative cache
 	check
d1977 2
a1978 1
	* xfs/bsd/xfs_vnodeops-common.c: VOP_UNLOCK -> xfs_vfs_unlock
d1980 1
a1980 2
	* xfs/bsd/xfs_node-bsd.c (xfs_dnlc_enter): make sure there's no
 	entry already in the DNLC
d1982 1
a1982 2
	* xfs/bsd/xfs_message.c (xfs_message_installnode): removed cache
 	checking code
d1984 1
a1984 1
	* arlad/fcache.c (read_data): if copyrx2fd fails, bail out
d1986 2
a1987 1
Fri Oct 16 16:46:57 1998  Johan Danielsson  <joda@@hella.pdc.kth.se>
d1989 1
a1989 1
	* xfs/bsd/xfs_locl.h: #define cn_nameiop ni_nameiop
d1991 2
a1992 1
1998-10-16  Love  <lha@@s3.kth.se>
d1994 2
a1995 1
	* appl/fs*.[ch]: Added code to gc pags (compat).
d1997 3
a1999 1
	* include/kafs.h: Added VIOC_GCPAGS
d2001 2
a2002 1
1998-10-15  Love  <lha@@s3.kth.se>
d2004 2
a2005 1
	* INSTALL,configure.in: --enable-knfs
d2007 3
a2009 1
	* xfs/bsd/xfs_vnodeops.c(xfs_readdir): Added cookie creation code.
d2011 4
a2014 1
Wed Oct 14 05:41:34 1998  Assar Westerlund  <assar@@sics.se>
d2016 1
a2016 1
	* xfs/bsd/xfs_vnodeops.h: update prototypes
d2018 3
a2020 2
	* xfs/bsd/xfs_vnodeops-osf.c (xfs_mkdir, xfs_readdir): adapt to
 	new versions of -common functions
d2022 3
a2024 4
	* xfs/bsd/xfs_vnodeops-common.c (xfs_lookup_common): do not enter
 	negative entries if creating
	(xfs_mkdir_common): remove the OS-specific code
	(xfs_readdir): set `eofflag'
d2026 2
a2027 4
	* xfs/bsd/xfs_vnodeops-bsd.c (xfs_create): make sure to call
 	VOP_LOOKUP with cn_nameiop == LOOKUP
	(xfs_mkdir): do the post mkdir lookup
	(xfs_readdir): set eofflag
d2029 1
a2029 1
	* xfs/bsd/xfs_vfsops-bsd.c: replace printf with XFSDEB
d2031 2
a2032 1
	* xfs/bsd/xfs_syscalls-common.c (fhget_call): check suser
d2034 1
a2034 2
	* xfs/bsd/xfs_node-bsd.c (xfs_dnlc_enter_name): init more fields
 	in `cn'
d2036 3
a2038 4
	* xfs/bsd/xfs_message.c (xfs_message_installnode): make sure we
 	get rid of any negative entries before adding the new entry.  Is
 	this really needed?
	(xfs_message_installdata): remove old stuff
d2040 3
a2042 1
	* xfs/bsd/xfs_locl.h (xfs_proc_to_cred): new macro
d2044 3
a2046 1
	* xfs/bsd/Makefile.in (unload): fix for non-OSF1
d2048 2
a2049 1
	* xfs/bsd/bin/mount_locl.h (__progname): remove
d2051 4
a2054 1
	* xfs/bsd/xfs_vfsops.h (xfs_fhlookup): update prototype
d2056 4
a2059 20
	* xfs/bsd/xfs_vfsops-bsd.c (xfs_fhlookup): take `gen' and check it

	* lib/ko/gensysname.c (sysnames): remove all bsd entries

	* TODO: I think we do this (at least on some OSes)

	* xfs/bsd/xfs_dev-common.c (xfs_message_rpc): sigmask seems to be
 	defined on more systems than __sigmask.  are there any with only
 	__sigmask?

	* xfs/bsd/xfs_common.h: s/define/endif/

Thu Oct 15 05:29:19 1998  Assar Westerlund  <assar@@sics.se>

	* xfs/bsd/Makefile.in: use KERNEL_LD

	* xfs/bsd/xfs_locl.h: <vm/vm_zone.h>

	* configure.in (KERNEL_LD): set
	<vm/vm_zone.h>: check for
d2061 5
a2065 24
	* xfs/bsd/xfs_vnodeops-bsd.c: free pathnames with zfree if there's
 	a zfreei.

	* aclocal.m4 (AC_KERNEL): allow ac_kernel_ld to be already set
	(AC_HAVE_KERNEL_FUNC): use KERNEL_CLAGS.  should probably call
	AC_TRY_COMPILE_KERNEL directly

	* xfs/bsd/xfs_vnodeops-common.c: free pathnames with zfree if
 	there's a zfreei.

	* configure.in (freebsd3): add
	(vfc_mountroot in struct vfsconf): check for
	(zfreei, vfs_cache_lookup): check for

	* xfs/irix/xfs_vfsops.c (xfs_root): don't VN_HOLD
	(make_dead_vnode): use vn_alloc

	* xfs/bsd/xfs_vfsops-bsd.c: move around and reorganize the code

	* xfs/bsd/xfs_wrap-bsd.c: handle different versions of MOD_DEV

	* xfs/bsd/xfs_syscalls.h: re-organize SCARG & syscallarg

	* configure.in: add -I. before testing for VOP_LOCK & c:o
d2067 1
a2067 1
	* configure.in (freebsd): use /bin/sh and not $SHELL
d2069 2
a2070 1
	* acconfig.h (HAVE_STRUCT_PROC_P_RETVAL): add
d2072 1
a2072 2
	* configure.in (freebsd): generate vnode_if.[ch]
	(struct proc): look for `p_retval'
d2074 2
a2075 2
	* xfs/bsd/xfs_wrap-bsd.c: replace printf by XFSDEB
	(xfs_mod): handle MOD_DISPATCH
d2077 1
a2077 3
	* xfs/bsd/xfs_vnodeops-bsd.c (xfs_cachedlookup): new function
	(xfs_eopnotsupp): always return EOPNOTSUPP.  use instead of
	vn_default_error
d2079 2
a2080 1
	* xfs/bsd/xfs_syscalls.h (xfs_setpag_call, xfs_pioctl_call): add
d2082 2
a2083 4
	* xfs/bsd/xfs_syscalls-freebsd.c (xfs_syscall): move here.  handle
 	3.0 returning values
	(xfs_install_syscalls): try AFS_SYSCALL first, then first free lkm
	slot
d2085 3
a2087 1
	* xfs/bsd/xfs_syscalls-common.c (xfs_syscall): remove
d2089 2
a2090 3
	* xfs/bsd/xfs_syscalls-osf.c (xfs_syscall): move here
	(xfs_install_syscalls): try AFS_SYSCALL first, then AFS_SYSCALL2, and
	then first free lkm slot
d2092 1
a2092 3
	* xfs/bsd/xfs_syscalls-bsd.c (xfs_syscall): move here
	(xfs_install_syscalls): try AFS_SYSCALL first, then first free lkm
	slot
d2094 2
a2095 2
	* xfs/bsd/xfs_locl.h: <sys/filedesc.h>: move <sys/fctnl.h>:
 	include
d2097 3
a2099 2
	* xfs/bsd/xfs_dev-bsd.c (xfs_dev): modern FreeBSD has poll instead
 	of select
d2101 4
a2104 1
Sun Oct 11 16:15:04 1998  Johan Danielsson  <joda@@stp.pdc.kth.se>
d2106 1
a2106 2
	* xfs/bsd/xfs_vnodeops-{osf,bsd}.c (xfs_create): move some code from
	xfs_create_common here
d2108 2
a2109 2
	* xfs/bsd/xfs_vnodeops-common.c (xfs_create_common): remove
	architecture dependent code (specifically the call to VOP_LOOKUP)
d2111 2
a2112 2
	* xfs/bsd/xfs_dev-common.c (xfs_message_rpc): use __sigaddset if
	defined
d2114 2
a2115 1
Sat Oct 10 21:05:13 1998  Johan Danielsson  <joda@@hella.pdc.kth.se>
d2117 1
a2117 1
	* lib/ko/gensysname.c: add generic bsd handler
d2119 1
a2119 1
	* configure.in, lib/ko/ko_locl.h: sys/utsname.h
d2121 1
a2121 1
1998-10-09  Love  <lha@@s3.kth.se>
d2123 5
a2127 3390
	* ydr/output.c: (sizeof_type) TOPAQUE has a size (1).

Thu Oct  8 14:39:48 1998  Johan Danielsson  <joda@@hella.pdc.kth.se>

	* xfs/bsd/xfs_node-osf.c (new_xfs_node): move call to insmntque to
 	after initializing the vnode
	(so it will automagically create a VM object)

	* xfs/bsd/xfs_vfsops.h: xfs_fhlookup takes generation number iff
 	OSF/1

	* xfs/bsd/xfs_message.c (xfs_message_installdata): pass generation
 	number to xfs_fhlookup iff OSF/1

	* xfs/bsd/xfs_vfsops-osf.c: implement xfs_fhlookup, and xfs_fhopen

	* xfs/bsd/xfs_vfsops-common.c (xfs_mount_common): init OSF/1
 	f_fsid

	* xfs/bsd/xfs_dev-osf.c (xfs_install_device): try to install
 	device with major 64

	* xfs/bsd/xfs_syscalls-osf.c: try to install syscall at slot 232

	* xfs/bsd/xfs_syscalls-common.c: fixes for OSF/1

	* xfs/bsd/xfs_dev-common.c (xfs_devclose_common): cleanup,
 	(xfs_message_rpc): use xfs_curproc()

	* xfs/bsd/xfs_locl.h: xfs_curproc()

	* arlad/bsd-subr.c (conv_dir): check return value from
 	fcache_fhget

	* xfs/bsd/bin/mount_xfs.c: call set_progname, add `-F' option to
 	set mountflags (used by OSF/1 mount)

Wed Oct  7 21:28:14 1998  Johan Danielsson  <joda@@hella.pdc.kth.se>

	* lib/ko/gensysname.c: Add Digital UNIX/Alpha

Wed Oct  7 05:01:53 1998  Assar Westerlund  <assar@@sics.se>

	* xfs/linux/xfs_inodeops.c (xfs_follow_link): handle both two and
 	three argument versions

	* acconfig.h: HAVE_FOLLOW_LINK_THREE_ARGS: add

	* configure.in (linux): try looking in /proc/ksyms before
 	/proc/cpuinfo
	(follow_link): test for number of arguments

1998-10-05  Assar Westerlund  <assar@@sics.se>

	* Release 0.13

	* NEWS: updated

	* configure.in: bump to 0.13

	* arlad/irix-subr.c: use the correct size macro

	* INSTALL: add --disable-dynamic-afs and --enable-smp

	* xfs/irix/Makefile.in (unload): add

	* configure.in (linux): fall back on testing on /proc/cpuinfo
	(--enable-smp): add

	* configure.in (linux): do the smp test against the include-files
	instead of /proc

	* configure.in (linux): test for smp by looking in /proc/ksyms
	instead of /proc/cpuinfo

1998-10-04  Assar Westerlund  <assar@@sics.se>

	* arlad/fcache.c (stale): set sentenced iff already locked.
	changed all callers.

	* util/log.c (log_vprint_syslog): fflush

	* xfs/irix: much improved.  most stuff (except getdents) seems to
	work.

Sun Oct  4 03:44:53 1998  Magnus Ahltorp  <map@@stacken.kth.se>

	* acconfig.h configure.in: Check for read_super arguments.

	* xfs/linux/xfs_load.c: Fix read_super argument confusion.

1998-10-03  Love  <lha@@e.kth.se>

	* xfs/bsd/xfs_node-bsd.c(new_xfs_node): Broke out the 
	getnewvnode() code.
	(xfs_getnewvnode): new function, creates xnode too.

	* xfs/bsd/xfs_vfsops-{bsd.c,common.c}: Added strange knfs code.

Fri Oct  2 06:39:15 1998  Assar Westerlund  <assar@@sics.se>

	* arlad/volcache.c (get_info): remove bogus `we didn't get what we
 	asked for'-warning

	* xfs/linux/xfs_inodeops.c (xfs_readdir, xfs_follow_link): do
 	xfs_free

	* xfs/linux/xfs_dev.c (xfs_devread): do free

	* xfs/linux/xfs_common.c (xfs_alloc): debugging for xfs_allocs -
 	xfs_frees

	* xfs/linux/xdeb.h (XDEBMEM): add

	* ydr/symbol.c (printsymbol): unused

	* lwp/iomgr.c (IOMGR): correct printf format string

	* include/bits.c: some unused to get rid of warnings

	* arlad/messages.c (xfs_message_rpc): mark as unused to get rid of
 	a warning

	* acconfig.h (_GNU_SOURCE): define it

Wed Sep 30 06:39:08 1998  Assar Westerlund  <assar@@sics.se>

	* xfs/irix/xfs_dev.c (xfs_install_device): initialize the queues

	* xfs/irix/xfs_vfsops.c (xfs_mount): remove cdevsw check

Wed Sep 30 01:10:31 1998  Assar Westerlund  <assar@@sics.se>

	* Release 0.12

	* arlad/fcache.c (create_node): new function
	(fcache_get): call create_node if there is no cache node.

	* xfs/bsd/xfs_vnodeops-bsd.c (xfs_lock, xfs_unlock, xfs_islocked):
 	don't use vop_nolock/vop_nounlock/vop_noislocked

Tue Sep 29 04:07:14 1998  Assar Westerlund  <assar@@sics.se>

	* arlad/volcache.c (recycle_entry): release the filecache entry

	* arlad/fcache.c (fcache_get): assert that find_free_entry
 	succeeded

Mon Sep 28 00:51:45 1998  Assar Westerlund  <assar@@sics.se>

	* acconfig.h (HAVE_KERNEL_VFS_GETVFS): add

Sun Sep 27 11:55:55 1998  Assar Westerlund  <assar@@sics.se>

	* xfs/bsd/xfs_vfsops-bsd.c (xfs_may_uninstall_filesys): new
	(xfs_fhlookup): use vfs_getvfs

	* configure.in (vfs_getvfs): check for
	(linux): check for __SMP__

Sun Sep 27 11:55:54 1998  Assar Westerlund  <assar@@sics.se>

	* Release 0.11

	* xfs/bsd/xfs_vnodeops-bsd.c (xfs_islocked): faking always having
 	it locked is better.

	* xfs/bsd/xfs_vfsops-bsd.c (xfs_fhopen): bump v_writecount if
 	opening for wrinting

Sun Sep 27 11:29:46 1998  Assar Westerlund  <assar@@sics.se>

	* xfs/linux/Makefile.in: use KERNEL_CFLAGS

	* configure.in (linux): set KERNEL_CFLAGS
	use AC_HAVE_KERNEL_STRUCT_FIELD

	* aclocal.m4 (AC_HAVE_KERNEL_STRUCT_FIELD): new macro

Sun Sep 27 07:33:18 1998  Assar Westerlund  <assar@@sics.se>

	* arlad/adir.c (add_to_page): set flag

Sat Sep 26 19:45:37 1998  Robert Burgess  <rb@@stacken.kth.se>

	* Release 0.10

Sat Sep 26 19:28:00 1998  Assar Westerlund  <assar@@sics.se>

	* arlad/adir.c (adir_lookup): correct centry logic

	* lwp/Makefile.in (REALCFLAGS): add DEBUG

	* arlad/fbuf.c (mmap_copyrx2fd, mmap_copyfd2rx, malloc_copyrx2fd,
 	malloc_copyfd2rx): handle len == 0 properly

	* arlad/arla.c: use fcache_release

	* arlad/adir.c (adir_lookup): verify datap of cached directory

	* arlad/fcache.c (find_entry_nolock): new function
	(fcache_stale_entry): if entry is locked, sentence it
	(read_data): always call copyrx2fd
	(write_data): always call copyfd2rx
	(fcache_release): new function.  change all callers.

	* arlad/fcache.h (FCacheEntry): new flag `sentenced'
	(fcache_release): new function

Wed Sep 23 03:31:48 1998  Assar Westerlund  <assar@@sics.se>

	* xfs/solaris/xfs_common.c (memcpy): define in terms of bcopy
 	because gcc generates references to it and solaris doesn't have
 	any in the kernel

Sun Sep 20 06:18:09 1998  Assar Westerlund  <assar@@sics.se>

	* arlad/sunos-subr.c (conv_dir): `handle' should be `cache_name'

	* arlad/irix-subr.c (conv_dir): `handle' should be `cache_name'

	* arlad/hpux-subr.c (conv_dir): `handle' should be `cache_name'

	* arlad/linux-subr.c (conv_dir): `handle' should be `cache_name'

Thu Sep 17 00:26:08 1998  Assar Westerlund  <assar@@sics.se>

	* arlad/messages.c: conditionalize all tests of RXKADEXPIRED on
 	KERBEROS

	* xfs/bsd/xfs_message.c (xfs_message_installdata): use cache
 	handle

	* xfs/bsd/xfs_syscalls-common.c: use xfs_fh_args

	* xfs/bsd/xfs_syscalls.h (xfs_fh_args): define

	* xfs/bsd/xfs_vfsops.h (xfs_fhlookup): add prototype

	* xfs/bsd/xfs_vfsops-bsd.c (xfs_fhlookup): new function
	(xfs_fhopen): use `xfs_fhlookup'

1998-09-15  Love  <lha@@s3.kth.se>

	* xfs/linux/xfs_locl.h: Checked for HAVE_LINUX_MODVERSIONS_H
	and appied patch from Aaron M. Ucko <amu@@mit.edu>.

	* configure.in: - Added check for <linux/modversions.h>
	- Applied patch from  (Dima Ruban) <dima@@best.net>

Mon Sep 14 03:14:13 1998  Assar Westerlund  <assar@@sics.se>

	* xfs/solaris/xfs_vnodeops.c (xfs_read, xfs_write): complain if
 	not VREG

	* xfs/solaris/xfs_message.c (xfs_message_installdata): only purge
 	the name cache if this file had data before.

	* xfs/bsd/xfs_vnodeops-common.c (xfs_lookup_common): removed bogus
 	NCHNAMLEN test

	* xfs/bsd/xfs_node-bsd.c (xfs_dnlc_enter): check for NCHNAMLEN.
  	apparently freebsd-3.0 doesn't have any limit on the length of
 	file names in the dnlc.

	* conf/arla.conf: bump {high,low}_bytes

	* arlad/messages.c (xfs_message_mkdir): do an installdata of the
 	new directory

	* arlad/inter.c (cm_getattr): should be no need to set the tokens
 	here explicitly

	* arlad/adir.c: removed lots of magic, clean-up.
	(adir_lookup): add a one-entry cache of directories
	(adir_readdir): return entries in order stored in directory instead of
	hash table order (. and .. are always the two first entries)

1998-09-13  Johan Danielsson  <root@@chowder.pdc.kth.se>

	* configure.in: use AC_ELF_OBJECT_FORMAT, add -D_LKM to CFLAGS
	when checking for vfssw, (NetBSD) try to figure out KERNEL_CFLAGS
	in a more intelligent way, and make sure we have -mno-fp-regs on
	alpha

Sat Sep 12 23:34:14 1998  Assar Westerlund  <assar@@sics.se>

	* xfs/solaris/xfs_vnodeops.c (xfs_setattr): clear tokens before
 	rpc
	(xfs_link): arguments in correct order.  call lookup correctly
	(xfs_map): verify that the attributes are there.  fake handling the
	MAP_SHARED, PROT_WRITE-case

	* xfs/solaris/xfs_syscalls.c: solaris' uprintf doesn't understand
 	%p

	* arlad/messages.c (xfs_message_putattr): install the new
 	attributes

	* arlad/fcache.c (truncate_file): send (size, 0, size) to
 	StartRXAFS_StoreData.

1998-09-12  Love  <lha@@s3.kth.se>

	* ydr/output.c: Added missing adding of total_len for strings.
	Added RCSID to the generated files.

Sat Sep 12 03:01:36 1998  Assar Westerlund  <assar@@sics.se>

	* xfs/bsd/xfs_vfsops.h (xfs_mount_common): new prototype

	* xfs/bsd/xfs_vfsops-common.c (xfs_mount_common): const-ize
 	user_path

	* xfs/bsd/xfs_vfsops-bsd.c (xfs_fhopen): more debugging

	* xfs/bsd/xfs_syscalls-common.c (fhget_call, fhopen_call): new
 	prototypes

	* xfs/bsd/xfs_syscalls-freebsd.c (xfs_syscallent): correct number
 	of arguments

	* xfs/bsd/xfs_syscalls-bsd.c (xfs_syscallent): correct number of
 	arguments

	* arlad/fcache.c (fcache_fhget): check fhopen_working

Fri Sep 11 04:27:35 1998  Magnus Ahltorp  <map@@lroken.stacken.kth.se>

	* milko/{ptserver.c,pr.c}: First version of ptserver

Wed Sep  9 22:15:09 1998  Assar Westerlund  <assar@@sics.se>

	* xfs/bsd/xfs_syscalls.h (SCARG): better definition

	* xfs/bsd/xfs_syscalls-common.c: now even compiles

	* xfs/bsd/xfs_message.c (xfs_messge_installdata): don't use
 	non-existing variable `tmp'

	* rx: compilable without RXDEBUG

	* arlad/messages.c: remove unused variables

	* lib/ko/gensysname.c: add freebsd2.2

	* arlad/arla.c (arla_rx_status): conditionalize on RXDEBUG

	* arlad/Makefile.in (REALCFLAGS): add RXDEBUG

Tue Sep  8 01:21:25 1998  Assar Westerlund  <assar@@sics.se>

	* arlad/adir.c: new fcache_open_file

	* xfs/bsd/xfs_vfsops.h (xfs_fhopen): prototype

	* xfs/bsd/xfs_vfsops-bsd.c (xfs_fhopen): new function

	* xfs/bsd/xfs_syscalls-common.c (fhget_call, fhopen_call): new
 	functions
	(pioctl_call): restructure

	* xfs/solaris/bin/umount_xfs.c: include <config.h>
	add ID
	
	* xfs/solaris/bin/mount_xfs.c: include <config.h>
	add ID
	
	* xfs/solaris/bin/test-fhopen.c: new file

	* xfs/solaris/bin/Makefile.in (test-fhopen): add

	* xfs/solaris/xfs_vnodeops.c (xfs_space): implement for cmd ==
 	F_FREESP, fl->l_len == 0

	* xfs/solaris/xfs_vfsops.c (xfs_fhlookup, xfs_fhopen): new
 	functions

	* xfs/solaris/xfs_syscalls.h (xfs_fh_args): add

	* xfs/solaris/xfs_syscalls.c (fhget_call, fhopen_call): new
 	functions
	(pioctl_call): restructure

	* xfs/solaris/xfs_message.c (xfs_message_installdata): update to
 	new message.  use xfs_fhlookup

	* xfs/solaris/xfs_deb.h (XDEBLKM, XDEBSYS): define

	* xfs/sunos/xfs_message.c (xfs_message_installdata): update to new
 	message

	* xfs/rhapsody/xfs_message.c (xfs_message_installdata): update to
 	new message

	* xfs/linux/xfs_message.c (xfs_message_installdata): update to new
 	message

	* xfs/irix/xfs_message.c (xfs_message_installdata): update to new
 	message

	* xfs/include/xfs_message.h (CACHEHANDLESIZE): make fsid_t +
 	fhandle_t in size
	(xfs_message_installdata): add cache_name

	* xfs/bsd/xfs_message.c (xfs_message_installdata): update to new
 	message

	* xfs/aix/xfs_message.c (xfs_message_installdata): update to new
 	message

	* include/kafs.h (VIOC_FHGET, VIOCE_FHOPEN): define

	* arlad/inter.h (cm_open): update prototype

	* arlad/inter.c (cm_open): return cache_name and cache_handle

	* arlad/arla.c: update to new fcache_open_file

	* arlad/fcache.h (FCacheEntry): 32-ize.  replace `inode' with
 	index and cache-handle

	* arlad/fcache.c (fhopen, fcache_fhget): new functions
	(fcache_create_file): new function.  use.
	(fcache_open_file): use fhopen if it's working
	(fcache_open_file): remove mode argument.  change all callers.
	(find_entry): handle the case of being called from volcache before the
	fcache is initialized.
	(read_data, write_data): only call copyrx2fd/copyfd2rx if sizefs > 0

	* arlad/subr.h (conv_dir): update prototype

	* arlad/*-subr.c (conv_dir): return cache_name and handle.

	* arlad/Makefile.in (KAFS_LIBS): set
	(LIBS): add KAFS_LIBS
	
1998-09-06  Love  <lha@@s3.kth.se>

	* output.c: - Added bounce checking for memencoding.
	- Got rid of fail: label error message.

	* rx/rx.h: Added sys/param.h to get rid of warning.

Fri Aug 28 22:49:22 1998  Assar Westerlund  <assar@@sics.se>

	* util/strutil.h (strupr, strlwr): remove prototypes

	* util/strutil.c (strupr, strlwr): remove (they're already in
 	libroken)

Mon Aug 24 02:48:19 1998  Assar Westerlund  <assar@@sics.se>

	* xfs/solaris/xfs_vnodeops.c (xfs_create): truncate the file if
 	needed

	* xfs/solaris/xfs_vnodeops.c (xfs_create): existing file is no
 	error
	(xfs_write): update mtime and size from cache vnode

Tue Aug 11 18:34:33 1998  Johan Danielsson  <joda@@blubb.pdc.kth.se>

	* arlad/arla.c (read_conffile): use parse_units

Tue Aug  4 02:19:06 1998  Assar Westerlund  <assar@@sics.se>

	* xfs/bsd/xfs_vfsops-bsd.c (xfs_vfsops): conditionalize vfc_name

	* configure.in: check for `vfs_name' in `struct vfsops'

Fri Jul 31 00:15:38 1998  Robert Burgess  <rb@@stacken.kth.se>

	* Release 0.9
	
	* xfs/solaris: compiler warning cleanup

Thu Jul 30 23:04:46 1998  Assar Westerlund  <assar@@sics.se>

	* configure.in (netbsd): comments are `dnl' and not `/*' :-)

	* configure.in: --with-krb{4,5}: better values for include and lib
 	directory

	* xfs/linux/xfs_inodeops.c (xfs_write_file): set the f_pos of the
 	cached file before calling its write

Wed Jul 29 22:35:31 1998  Assar Westerlund  <assar@@sics.se>

	* TODO: optimistically remove the items that I think have been
 	fixed

	* arlad/fcache.c (unlink_lru_entry): don't remove entries with
 	refcount > 0
	(followmountpoint): set refcount on the root of the new volume, not on
	the mount point in the old one.

	* arlad/inter.c (cm_lookup): fix the handling of `..' over mount
 	points.

	* arlad/volcache.c (recycle_entry): decrement the refcounts of all
 	fcacheentries pointing to the root of any of the volumes of `e'

	* arlad/volcache.h (volcacheentry): remove `mount_point'

	* INSTALL: removed mknod from BSD installation instructions

	* xfs/bsd/bin/xfs_makedev: new file

	* xfs/bsd/bin/startarla.in: use xfs_makedev

	* xfs/bsd/bin/Makefile.in: install xfs_makedev

	* xfs/bsd/xfs_wrap-bsd.c: made it into a LKM_DEV.

	* xfs/bsd/xfs_dev-bsd.c (xfs_install_device, xfs_uninstall_device,
 	xfs_stat_device): removed all code for adding the device to the
 	cdevsw.

	* xfs/bsd/Makefile.in (load): use -p xfs_makedev

	* arlad/adir.c (adir_remove, adir_creat): assert the directory
 	having data

	* arlad/inter.c (cm_create, cm_mkdir, cm_symlink, cm_link,
 	cm_remove, cm_rmdir, cm_rename): make sure we have the data of the
 	directory

	* arlad/fbuf.c (malloc_truncate): call ftruncate

	* xfs/bsd/xfs_vfsops-common.c (xfs_mount_common): handle two
 	argument vfs_getnewfsid

	* configure.in: test for two argument vfs_getnewfsid

Tue Jul 28 23:36:47 1998  Assar Westerlund  <assar@@sics.se>

	* lwp/process.S: Applied patch for NetBSD/alpha from John Davison
 	<davisoja@@clarkson.edu>

	* ydr/output.c: try to handle error returns from rx_Read and
 	rx_Write

	* lib/ko/kocell.c: check memory allocation and clean-up

	* appl/fs.c (afs_listquota): don't divide by zero

	* arlad/fcache.c (followmountpoint): close fd if fbuf_create fails

1998-07-28  Love  <lha@@e.kth.se>

	* xfs/bsd/xfs_vfsops-osf.c(xfs_install_fs): Be paranoid about the size
	of the private data of struct vnode.

	* xfs/bsd/xfs_dev-common.c: (xfs_message_rpc):No code for sigwaitmask

1998-07-24  Love  <lha@@e.kth.se>

	* xfs/bsd/xfs_vfsops-osf.c: (xfs_root): Added uid check for osf.

	* appl/fs.c: Added VIOCNOP.

Fri Jul 24 19:15:45 1998  Magnus Ahltorp  <map@@lroken.stacken.kth.se>

	* arlad/messages.c: Added VIOCGETCELL, VIOCWHEREIS, VIOCNOP,
 	VIOCUNPAG and VIOC_AFS_STAT_MT_PT.

Fri Jul 24 09:53:19 1998  Assar Westerlund  <assar@@sics.se>

	* configure.in (int32, u_int32): test for

	* arlad/messages.c (xfs_message_create): try installing data for
 	the new file.

	* arlad/arla.c (temp_sysname): const-ize

Fri Jul 24 06:49:32 1998  Magnus Ahltorp <map@@stacken.kth.se>

	* xfs/linux/xfs_inodeops.c: Merged in patch from
	Aaron M. Ucko <amu@@mit.edu>.

	* xfs/linux: Made things work better on 2.0 and i386.

1998-07-24  Love  <lha@@e.kth.se>

	* appl/fs.c: fixed small bug in fs lsm.

Thu Jul 23 03:55:12 1998  Assar Westerlund  <assar@@sics.se>

	* xfs/bsd/xfs_vfsops-common.c (xfs_mount_common): use
 	vfs_getnewfsid is there's one.  From Dan Winship <danw@@MIT.EDU>

	* xfs/bsd/xfs_vfsops-bsd.c: use `struct vnodeopv_desc',
 	vfs_attach, and vfs_detach when applicable.  From Dan Winship
 	<danw@@MIT.EDU>

	* configure.in: more tests for modern NetBSD.  From Dan Winship
 	<danw@@MIT.EDU>

	* arlad/inter.c (expand_sys): new function for expanding @@sys
	(cm_lookup): expand @@sys anywhere in the name

	* xfs/bsd/xfs_vnodeops-common.c (xfs_inactive_common): handle the
 	case of an already clean vnode.

	* xfs/bsd/xfs_node-bsd.c (free_xfs_node): remove bogus comment

	* arlad/fcache.c (create_{file,symlink,directory}): update the
 	acccache and anonacess

	* arlad/volcache.c: rename recover_state -> volcache_recover_state

	* xfs/bsd/xfs_vnodeops-bsd.c (xfs_islocked): return 0 as a
 	fallback

	* xfs/bsd/xfs_vnodeops.h (xfs_vfs_readlock, xfs_vfs_writelock,
 	xfs_vfs_unlock): new macros for encapsulating the locking

	* xfs/bsd/xfs_vfsops-osf.c (xfs_root): remove ifdef __osf__

	* xfs/bsd/xfs_vfsops-bsd.c (xfs_root): remove ifdef __osf__

Wed Jul 22 05:00:08 1998  Assar Westerlund  <assar@@sics.se>

	* arlad/fcache.h (create_symlink): update prototype

	* arlad/fcache.c: keep better track of the number of used bytes
 	(usedbytes)

	* rxdef/fs.xg (Symlink): correct

	* arlad/fcache.c (fcache_file_name): cast `inode' to unsigned

	* lib/ko/gensysname.c: restructured, cleaned up and added new
 	sysnames

	* util/strmatch.c: const-ize

	* arlad/adir.c: replace magic numbers with expressions based on
 	constants from afs_dir.h

	* arlad/arla.c (main): set the sysname from arla_getsysname

Tue Jul 21 04:55:00 1998  Assar Westerlund  <assar@@sics.se>

	* arlad/adir.c (adir_remove): eliminate trailing empty pages

	* arlad/adir.c (adir_remove): use the actual size of the converted
 	directory instead of that from status

	* arlad/adir.c (adir_lookup, adir_readdir): use the actual size of
 	the converted directory instead of that from status

	* xfs/bsd/xfs_vnodeops-bsd.c (xfs_revoke): implement

	* configure.in (vop_revoke, genfs_revoke): check for

	* configure.in (vop_noislocked, genfs_nolock, genfs_nounlock,
 	genfs_noislocked): check for

	* xfs/bsd/xfs_vnodeops-bsd.c (xfs_lock, xfs_unlock, xfs_islocked):
 	try to use default operations

Mon Jul 20 04:51:11 1998  Assar Westerlund  <assar@@sics.se>

	* configure.in: openbsd2.3: remove
	more kernel tests
	
	* lwp/lwp.h (lwp_context): add linkRegister and conditionRegister
 	for powerpc

	* xfs/bsd: restructured

	* arlad/arla.c (connected_levels): fix misspelling

Mon Jul 20 01:49:28 1998  Robert Burgess  <rb@@stacken.kth.se>

	* Release 0.8

Sun Jul 19 10:41:44 1998  Mattias Amnefelt  <mattiasa@@stacken.kth.se>

	* appl/vos.c: added support for busy volumes

Fri Jul 17 18:21:10 1998  Magnus Ahltorp  <map@@lroken.stacken.kth.se>

	* configure.in, xfs/linux/Makefile.in, xfs/linux/getcwd.c: Added
 	getcwd shared library to make getcwd work better in 2.1.

Fri Jul 17 03:10:48 1998  Assar Westerlund  <assar@@sics.se>

	* arlad/fcache.c (fcache_recover_state): make sure the volume of
 	the entry we read back actually exists, otherwise just ignore it.

Thu Jul 16 02:06:28 1998  Assar Westerlund  <assar@@sics.se>

	* configure.in: selinfo.si_pid test removed

	* lib/ko/gensysname.c (printsysname): arla_getsysname should
 	return a const string

	* lib/ko/ko.h (arla_getsysname): const-ize

	* arlad/volcache.c (volcache_getbyname, volcache_getbyid):
 	restructure tail so that refcount is return whenn e != NULL

	* xfs/openbsd2.3/xfs_vnodeops.c (xfs_lookup): set *vpp to NULL at
 	the beginning

	* xfs/bsd/xfs_vnodeops.c (xfs_lookup_common): set *vpp to NULL at
 	the beginning

1998-07-15  Love  <lha@@s3.kth.se>

	* lib/ko/gensysname.c: Added generation of a sysname function.

Tue Jul 14 16:35:31 1998  Assar Westerlund  <assar@@sics.se>

	* xfs/bsd/bin/mount_xfs.c: conditionalize on autoconf symbols
 	instead of on __FreeBSD__

	* configure.in (getvfsbyname,vfsisloadable,vfsload): check for
 	them

1998-07-14  Love  <lha@@s3.kth.se>

	* arlad/services.h: Added VOTE_SERVICE and DISK_SERVICE

	* appl/udebug.c: Added the udebug program.

	* appl/vos.c: Added command syncsite (only work on local cell)

	* appl/arlalib.[ch]: arlalib_getsyncsite() does not work,
	I can't see why it shouldn't work thou.

	* appl/appl_locl.h: added <err.h> and <ubib*>

	* appl/Makefile: Added udebug

	* rxdef/ubik.xg: Added

	* xfs/bsd/bin/mount_xfs.c: Added patch from Alec Wolman 
        <wolman@@cs.washington.edu> to add the right argument to mount
        for FreeBSD

Mon Jul 13 20:50:09 1998  Assar Westerlund  <assar@@sics.se>

	* lwp/make-process.o.sh.in (aix): for some odd reason the aix
 	assembler is happier if we always say we have a RIOS
	
	* ydr/Makefile.in: compat with stupid makes

	* xfs/sunos/Makefile.in: compat with stupid makes

	* xfs/linux/Makefile.in: compat with stupid makes

	* util/Makefile.in: compat with stupid makes

	* rxdef/Makefile.in: compat with stupid makes

	* lwp/process.S: rhapsody fixes

	* arlad/volcache.c (recycle_entry): only decrement fe->refcount
 	if we found the node.

	* arlad/kernel.c (process_message): remove `proc_msg: byte = %d'

	* arlad/fcache.c (count): rename to inode_count
	(fcache_stale_entry): always call stale
	(fcache_find): check if find_entry succeeded

	* arlad/conn.c (conn_get): check securityindex and cred, otherwise
 	we could end up not having any connection for (0,0) and loose when
 	we get a callback

	* arlad/arla.c (newwalk): patches from Alec Wolman
 	<wolman@@cs.washington.edu>

	* arlad/Makefile.in: compat with stupid makes

	* lib/Makefile.in: compat with stupid makes

	* appl/Makefile.in: compat with stupid makes

	* THANKS: Alec Wolman <wolman@@cs.washington.edu>

	* Makefile.in: compat with stupid makes

	* configure.in (KERNEL_INCLUDE): include -I
	(rhapsody): add
	some more field tests

	* config.{guess,sub}: rhapsody

	* xfs/rhapsody: Rhapsody port from Alexandra Ellwood <lxs@@MIT.EDU>

Thu Jul  9 16:14:50 1998  Assar Westerlund  <assar@@sics.se>

	* xfs/linux/xfs_inodeops.c (xfs_write_file): 2.0-fix

Mon Jul 13 06:35:55 1998  Magnus Ahltorp  <map@@lroken.stacken.kth.se>

	* xfs/linux: Locking corrected and locking debugging added

	* xfs/linux: Changed to new lookup method

Sun Jul 12 16:39:05 1998  Johan Danielsson  <joda@@emma.pdc.kth.se>

	* xfs/bsd/*: Merge OSF/1 changes.

	* xfs/bsd/xfs_dev.h: make xfs_devopen static, and add prototype
 	for xfs_func_is_devopen that does the comparison

	* xfs/bsd/xfs_deb.h: unsigned int

	* xfs/bsd/xfs_deb.c: unsigned int

	* xfs/bsd/xfs_common.c: use xfs_malloc

	* configure.in: Add support for OSF/1.

	* xfs/bsd/bin/{mount_xfs,umount_xfs}.c: use <mount_locl.h>

	* xfs/bsd/bin/mount_locl.h: common include file for mount/umount

	* xfs/bsd/bin/mntopts.h: remove __P from the single prototype (to
 	avoid having to add a definition for __P) -- all compilers (gcc
 	and DEC CC knows prototypes anyway).

	* xfs/bsd/bin/Makefile.in: some fixes for OSF/1: conditionally
 	build `startarla', and add include and link paths for roken.

	* rxkad/rxk_crpt.c: __alpha is LE

Thu Jul  9 22:18:25 MET DST 1998  Mattias Amnefelt  <mattiasa@@stacken.kth.se>

	* appl/Makefile.in: Changed so we use libroken included in
	  arla insead of the one which comes with kth-krb.

1998-07-08  Love  <lha@@e.kth.se>

	* xfs/bsd/{xfs_vfsops.c,xfs_wrap.c} Check if we can unload 
	before we even try, since on NetBSD you can unload a
	mounted filesystem, that will crash in next sync.

Wed Jul  8 01:44:15 1998  Assar Westerlund  <assar@@sics.se>

	* arlad/fcache.c (creat_nodes): use IOMGR_Select instead of
 	LWP_DispatchProcess to give the iomgr thread the chance to run

	* xfs/aix/xfs_syscalls.c (xfs_setpag_call): generate the pag
 	correctly

1998-07-07  Love  <lha@@e.kth.se>

	* util/{time,}prio.[ch], util-tester.c: Added.

Tue Jul  7 02:41:05 1998  Magnus Ahltorp  <map@@lroken.stacken.kth.se>

	* xfs/linux/xfs_vfsops.c: Use print_aliases() and
	set xfsp->root to NULL when unmounting

	* xfs/linux/xfs_common.[ch]: Added print_aliases()

Mon Jul  6 19:56:34 1998  Assar Westerlund  <assar@@sics.se>

	* xfs/bsd/xfs_dev.c: obvious xfs_vfs_busy fix

Mon Jul  6 12:59:51 1998  Mattias Amnefelt  <mattiasa@@sundance.stacken.kth.se>

	* appl/vos.c: correct parsing of partition names

	* appl/appl_locl.h: #include <ctype.h>

Mon Jul  6 12:29:04 1998  Johan Danielsson  <joda@@emma.pdc.kth.se>

	* xfs/bsd/Makefile.in: Get KERNEL_CFLAGS from configure.

	* xfs/bsd/xfs_dev.c: Add wrapper for vfs_busy.

	* xfs/bsd/xfs_vnodeops.c: Add wrapper for VOP_LOCK/VOP_UNLOCK.

	* configure.in: Add KERNEL_CFLAGS for *BSD and OSF/1. Test for
 	three valued vfs_busy, and two valued VOP_LOCK.

	* aclocal.m4: AC_TRY_COMPILE_KERNEL, that adds KERNEL_CFLAGS to
 	CFLAGS during test.

Sun Jul  5 20:26:02 1998  Assar Westerlund  <assar@@sics.se>

	* arlad/fcache.c (fcache_find): new function add invalidating and
 	vnode creating threads

	* arlad/fcache.h (FCacheEntry): rename `listentry' -> `lru_le'.
  	add `invalid_le'
	(fcache_find): add prototype

	* util/list.c (listaddbefore, listaddafter): new functions

Sun Jul  5 03:28:44 1998  Assar Westerlund  <assar@@sics.se>

	* arlad/arla.c: new option `--cache-dir'

Sun Jul  5 04:28:02 1998  Magnus Ahltorp  <map@@lroken.stacken.kth.se>

	* xfs/linux/xfs_vfsops.c: Fix 2.1 {put,delete}_inode weirdness

	* xfs/linux/xfs_message.c: Fix callback handling

Sun Jul  5 04:24:14 1998  Magnus Ahltorp  <magnus@@dike.aladdin.se>

	* xfs/linux/xfs_inodeops.c: Clear vm maps when closing file.

Sat Jul  4 16:21:44 1998  Magnus Ahltorp  <magnus@@dike.aladdin.se>

	* xfs/linux/xfs_inodeops.c: 2.0 fixes

Sat Jul  4 05:53:01 1998  Magnus Ahltorp  <map@@lroken.stacken.kth.se>

	* xfs/linux/*: Big rewrite of different things. Works somewhat
	(writes	sometimes do the wrong thing) on 2.1, 2.0 is untested.
	The file system may now be mounted before arlad is started.

Fri Jul  3 19:38:22 1998  Assar Westerlund  <assar@@sics.se>

	* arlad/arla_local.h: this ugliness seems required

Wed Jul  1 21:34:42 1998  Assar Westerlund  <assar@@sics.se>

	* arlad/fcache.c (fcache_get): remove the old entry from the free
 	list before adding the new one.
	
Sat Jun 27 12:46:20 1998  Assar Westerlund  <assar@@sics.se>

	* xfs/linux/xfs_syscalls.c (sys_afs): correct check for
 	copy_{from,to}_user.  Always return -errno.

	* xfs/linux/xfs_common.h (copy_to_user, copy_from_user): these
 	functions should return the number of uncopied bytes.

	* configure.in: remove uid_t size test

	* xfs/include/xfs_message.h: use __kernel_foo_t

	* xfs/include/xfs_attr.h: define __kernel_foo_t if they are not
 	already defined and use them.

	* xfs/bsd/xfs_node.c (vattr2xfs_attr): cast to `mode_t' otherwise
 	it breaks on modern NetBSD

Thu Jun 25 06:04:01 1998  Assar Westerlund  <assar@@sics.se>

	* arlad/adir.c (add_to_page): don't index off the end of the page.

1998-06-24  Love Hornquist-Astrand  <root@@junkyard.stacken.kth.se>

	* doc/partsofarla.texi: Added info about libkafs and pioctl()

Mon Jun 22 17:34:53 1998  Robert Burgess  <rb@@stacken.kth.se>

	* xfs/solaris/xfs_vfsops.c: debug panic patch from:
	John Hawkinson <jhawk@@bbnplanet.com>

1998-06-22  Love  <lha@@e.kth.se>

	* Added doc/*.texi

1998-06-21  Love  <lha@@e.kth.se>

	* lib/sl/sl.[ch]: Added SL_BADCOMMAND

	* appl/{fs,vos}.c: Fixes for sl.

	* configure.in: Added patch for afslib from: 
	Mark Eichin <eichin@@kitten.gen.ma.us>

Fri Jun 19 20:43:42 1998  Assar Westerlund  <assar@@sics.se>

	* appl/fs.c (connect_cmd): correct comparison against `dis'

Wed Jun 17 17:08:39 1998  Robert Burgess  <rb@@stacken.kth.se>

	* Release 0.7.2

Sat Jun 13 03:32:39 1998  Assar Westerlund  <assar@@sics.se>

	* appl/vos.c (printpartinfo): use bogus field

1998-06-09  Love  <lha@@e.kth.se>

	* lwp/make-process.o.sh.in: The new magic way of building process.o

Tue Jun  9 10:11:03 1998  Magnus Ahltorp  <map@@stacken.kth.se>

	* Release 0.7.1

	* major bug fixes

Mon Jun  8 18:07:12 1998  Robert Burgess  <rb@@stacken.kth.se>

	* Release 0.7

1998-06-08  Love  <lha@@e.kth.se>

	* arlad/fcache.c: Try to do sane things with callback->ExpirationTime.
	(Assume that ExpirationTime is a relative time)

	* util/log.c(log_vprint_file): Print date when logging to file/stderr.

Mon Jun  8 15:14:10 1998  Assar Westerlund  <assar@@sics.se>

	* xfs/openbsd2.3/xfs_syscalls.c: merge in
 	xfs/bsd/xfs_syscalls.c:1.26->1.27

	* xfs/bsd/xfs_syscalls.c (xfs_setpag_call): only copy the required
 	gids and return the new cred

Sun Jun  7 10:57:18 1998  Assar Westerlund  <assar@@sics.se>

	* configure.in: add irix

Sun Jun  7 07:23:07 1998  Robert Burgess  <rb@@stacken.kth.se>

	* xfs/{solaris,aix,sunos}/xfs_messages.c
	(xfs_message_invalidroot): clear tokens when invalidating

	* arlad/fcache.c (fcache_init): set fprioritylevel at init

Sun Jun  7 07:19:35 1998  Magnus Ahltorp  <map@@lroken.stacken.kth.se>

	* acconfig.h, configure.in, lib/roken/roken.h:
	Autodetect linux htonl weirdness 

Thu Jun  4 00:12:37 1998  Assar Westerlund  <assar@@sics.se>

	* arlad/arla.c: new option `--recover' or `-z' for recovering
 	(not) stored state

	* arlad/fcache.c (fcache_init): new parameter `recover'

	* arlad/volcache.c (volcache_init): new parameter `recover'

Wed Jun  3 23:41:42 1998  Assar Westerlund  <assar@@sics.se>

	* arlad/fcache.c (do_read_attr): make sure we don't return -1

Tue Jun  2 19:16:15 1998  Assar Westerlund  <assar@@sics.se>

	* xfs/linux/xfs_locl.h: include <linux/modversions.h> to get
 	versioned names of exported kernel symbols

Tue May 26 22:54:33 1998  Assar Westerlund  <assar@@sics.se>

	* acconfig.h (VFS_NEED_PROCP): remove

	* configure.in (openbsd2.3): remove old junk

Mon May 25 04:16:26 1998  Artur Grabowski  <art@@stacken.kth.se>

	* arlad/messages.c: fix reading of links when only having
	'l' rights

	* xfs/*bsd*/xfs_vnodeops.c: change size and mtime of files when
	writing to them.

Mon May 25 00:58:17 1998  Assar Westerlund  <assar@@sics.se>

	* Release 0.6

	* lwp/Makefile.in: more uglyness for process.S

	* util/Makefile.in: link mmaptime_test with libroken

1998-05-24  Love  <lha@@e.kth.se>

	* util/mmaptime_test.c: Added

	* arlad/messages.c(vioc_fpriostatus): FPRIO_{GET,SET}MAX

	* arlad/fcache.c(restore_state): Set priority too.
	(do_read_attr): Check for disconnected mode, if we got
		attr just return, otherwise return ENETDOWN.
	(read_data): Check for disconnected mode.
	(fcache_get): Check for disconnected mode.
	(uptodatep): Check for connected logging mode.
	
	* arlad/conn.c(conn_free): When in disconnected mode conn
	sets to NULL.

	* appl/{arlalib.h,fs.c,fs_lib.c,fs_local.h}: Added
	{set,get}maxfprio.

Sat May 23 07:24:22 1998  Assar Westerlund  <assar@@sics.se>

	* appl/appl_locl.h: include <sys/param.h>

	* arlad/aix-subr.c: new file

	* arlad/linux-subr.c (conv_dir): got rid of stupid warning

	* arlad/arla.c (arla_cat): check return values from fcache*

	* configure.in: check for h_errno, h_errlist, and h_nerr

	* aclocal.m4: add check-declaration and check-var

Fri May 22 21:34:30 1998  Assar Westerlund  <assar@@sics.se>

	* arlad/fcache.c (fcache_get): check return value from
 	volcache_getbyid.

Wed May 20 02:56:14 1998  Assar Westerlund  <assar@@sics.se>

	* arlad/arla.c: add `--port'

	* getarg.c: fix some of the getarg bugs

Tue May 19 17:18:31 1998  Magnus Ahltorp  <map@@lroken.stacken.kth.se>

	* xfs/linux: Fixed varous pointer conversions.
	Moved glibc support to the correct place.
	Added random code for debug control syscall.

1998-05-18  Love  <lha@@e.kth.se>

	* lwp/process.S: Add linux alpha support

	* xfs/bsd/xfs_syscalls.c: Log to XDEBSYS instead of XDEBMSG

	* include/kafs.h: Added new PIOCTL (50) for VIOC_FPRIOSTATUS
	Added defines and structs for FPRIOSTATUS.

	* conf/arla.conf: Added fpriority, default to 100

	* arlad/messages.c: Added vioc_fpriostatus

	* arlad/inter.c:(log_operation) dont log operations when in
	connected mode.

	* arlad/fcache.c: Added fprioritylevel and made use of it in
	emergency_remove_file() and in cleaner thread.

	* arla/arla_local.h: Added new state of connected_mode,
	CONNECTEDLOG

	* arlad/arla.c: Added fpriority to the conf file

	* appl/fs.c: (getarg) Added {add,remove,get}removepriority, 
	and version.
	(connect) changed fs_connect syntax
	({get,set}crypt) changed fs_*crypt syntax
	({set,get,remove}prio) added calls
	(fserr) moved to fs_lib.c and changed syntax
	(fsversion) print version of fs.c and fs_lib.c
	(afs_getfid) moved to fs_lib
	
	* appl/arlalib.h: Added fs_* prototypes

Sat May 16 11:41:19 1998  Magnus Ahltorp  <map@@lroken.stacken.kth.se>

	* xfs/linux: Merged in Linux 2.1 support

Sat May 16 06:44:16 1998  Assar Westerlund  <assar@@sics.se>

	* xfs/solaris/xfs_vnodeops.c: fix use of VOP_RWLOCK and
 	VOP_RWUNLOCK

	* xfs/aix/bin: add umount_xfs and mount_xfs.

	* xfs/aix/xfs_vfsops.c (xfs_mount): find the device path

	* xfs/aix/xfs_dev.c: init `event_word' to EVENT_NULL

	* xfs/aix/xfs_deb.h: Use uprintf instead of printf to make it
 	possible to see the messages.

Tue May 12 17:29:39 1998  Assar Westerlund  <assar@@sics.se>

	* lwp/process.S: grammar fix

Sun May 10 02:25:47 1998  Magnus Ahltorp  <map@@lroken.stacken.kth.se>

	* xfs/linux/xfs_inodeops.c: Fixed create, mkdir, rmdir, rename
	in 2.1 branch

	* xfs/linux/{xfs_message.c,xfs_inodeops.c}:
	Addded more correct handling of dcache in 2.1 branch

Sat May  9 11:41:10 1998  Assar Westerlund  <assar@@sics.se>

	* xfs/solaris/xfs_vnodeops.c: replace VN_HOLD/VN_RELE by
 	VOP_RWLOCk/VOP_RWUNLOCK before calling VOP-funktions in ufs.

	* configure.in: aix

	* xfs/solaris/xfs_message.c (xfs_message_installdata): replace
 	printf by XFSDEB.  Extra ASSERT for rb.

Thu May  7 04:00:30 1998  Assar Westerlund  <assar@@sics.se>

	* xfs/aix: new directory

1998-05-06  Assar Westerlund  <assar@@sics.se>

	* xfs/solaris/xfs_message.c: try to purge the dnlc once in a while

	* xfs/solaris/xfs_node.c (vattr2xfs_attr): check for AT_TYPE
	(vattr2xfs_attr, xfs_attr2vattr): correct panic string

Tue May  5 10:45:15 1998  Assar Westerlund  <assar@@sics.se>

	* ydr/output.c (encode_string): zero-terminate string when
 	decoding.

1998-05-05  Love  <lha@@s3.kth.se>

	* configure.in: Check for dbm.

	* arla/arla.c: Added flushfid command in -t mode.

 	* milko/bufcache.{c,h}: Added experimental bufcache.

Sun May  3 04:29:01 1998  Assar Westerlund  <assar@@sics.se>

	* xfs/solaris/xfs_vnodeops.c: return ENOSYS instead of EINVAL.
	implement some trivial vnodeops

	* xfs/solaris/xfs_vfsops.c: return ENOSYS instead of EINVAL for
 	non-implemented vfs-operations

Sat May  2 03:00:35 1998  Assar Westerlund  <assar@@sics.se>

	* **/Makefile.in: add `DESTDIR' and `uninstall:'

	* arlad/fcache.c: got rid of some stupid warnings
	updated to new volcache root volume stuff

	* arlad/volcache.c: renamed volcache_rootvolume ->
 	volcache_get_rootvolume
	(volcache_set_rootvolume): new function

	* arlad/cred.c (cred_add): remove any old entry before adding the
 	new one.

	* arlad/messages.c: try to handle expiring credentials in lots of
 	places
	(viocgettok): remember to free the cred.

	* arlad/fcache.c (read_data): handle the case of the file not
 	fitting in the cache.
	(getroot): print the errors correctly
	(getacl, setacl, getvolumestatus, setvolumestatus): don't destroy the
	error code

	* arlad/fbuf.c: rename all arguments fbuf -> f to avoid namespace
 	invasion.

	* arlad/bsd-subr.c (conv_dir): get rid of a stupid varning

	* arlad/cred.c (cred_expire): new function

	* arlad/messages.c: try to handle expiring credentials.

Fri May  1 22:20:23 1998  Assar Westerlund  <assar@@sics.se>

	* configure.in: call AC_C___ATTRIBUTE__

	* aclocal.m4 (AC_C___ATTRIBUTE__): new macro for testing for
 	`__attribute__'
	(AC_C___FUNCTION__, AC_FUNC_NTOHL): conservative default when
	cross-compiling

1998-04-30  Love  <lha@@s3.kth.se>

	* ydr/output.c: No #define FOO_BAR_SIZE 0

	* conf/services.h: No more errormessages...

	* arlad/{fcache.c, arlad.c}: Added --root-vol=root.afs

	* milko/* Added random stuff.

Mon Apr 27 22:11:55 1998  Assar Westerlund  <assar@@sics.se>

	* ydr/lex.l: parse more types of #line-lines.
	renamed all tokens to T_FOO

	* lwp/lwp.h: <sys/types.h> and <sys/select.h>

	* lwp/Makefile.in: rs6000.
	try harder preprocessing process.S
	
	* appl/Makefile.in: add AIX_EXTRA_KAFS

	* configure.in: aix

	* aclocal.m4: AC_KRB_SYS_AIX added

Sun Apr 19 15:36:35 1998  Assar Westerlund  <assar@@sics.se>

	* xfs/bsd/Makefile.in (vop_defs.h): generate list of vops.  From
 	"Per Boussard, ERA/T/ED" <per@@era-t.ericsson.se>

	* xfs/bsd/xfs_locl.h: include vop_defs.h

Sun Apr 19 08:09:43 1998  Assar Westerlund  <assar@@sics.se>

	* xfs/openbsd2.3/xfs_vfsops.c (xfs_mount): set `f_files' correctly

	* xfs/bsd/xfs_vfsops.c (xfs_mount): set `f_files' correctly

Wed Apr 15 04:52:27 1998  Robert Burgess  <rb@@abc.se>

	* Release 0.5

	* xfs/solaris/xfs_node.c: set blksize/nblocks

Tue Apr 14 23:59:08 1998  Magnus Ahltorp  <map@@lroken.stacken.kth.se>

	* xfs/linux/xfs_load.c: Changed major number to the newly
 	allocated 103

Tue Apr  7 05:32:26 1998  Robert Burgess  <rb@@stacken.kth.se>

	* arlad/fcache.c: Added VIOCSETAL support

	* arlad/messages.c: Moved some checks here from xfs_syscalls.c

Mon Apr  6 05:19:44 1998  Magnus Ahltorp  <map@@lroken.stacken.kth.se>

	* xfs/linux/xfs_vfsops.c: Added xfs_statfs

	* xfs/linux/xfs_syscalls.c: Merged in new syscall style from bsd

	* arlad/messages.c: Free opaque after use

Sun Apr  5 12:50:56 1998  Assar Westerlund  <assar@@sics.se>

	* xfs/bsd/xfs_node.c (xfs_dnlc_lookup): print debug output
 	correctly.

	* arlad/cred.c (cred_delete): new function

Sun Apr  5 05:49:27 1998  Robert Burgess  <rb@@stacken.kth.se>

	* arlad/fcache.c: Added VIOCGETVOLSTAT/VOLCSETVOLSTAT support
	
Sun Apr  5 05:31:52 1998  Assar Westerlund  <assar@@sics.se>

	* arlad/fcache.c (truncate_file): decrement usedbytes iff the data
	was cached.

	* arlad/adir.c (adir_mkdir): zero out hash table.

	* arlad/afsdir_check.c: use arla_log

	* arlad/Makefile.in (afsdir_check): link with arladeb.o

Sun Apr  5 01:25:00 1998  Assar Westerlund  <assar@@sics.se>

	* ydr/output.c (gendeclare): handle strings

Sat Apr  4 20:39:18 1998  Assar Westerlund  <assar@@sics.se>

	* configure.in: add a --disable-mmap

	* aclocal.m4 (AC_HAVE_GETCONF): call AC_CHECK_PROG properly

Sat Apr  4 14:00:06 1998  Assar Westerlund  <assar@@sics.se>

	* appl/Makefile.in: link with RXKAD and KAFS in the correct order

Fri Apr  3 09:19:53 1998  Love H-Astrand  <lha@@ksk.sala.se>

	* lib/ko/port.[ch]: Moved and added more ports.

Fri Apr  3 05:30:19 1998  Assar Westerlund  <assar@@sics.se>

	* lib/ko/koerror.c: const-ize

	* arlad/arla.c: new option `-n'

	* arlad/*.c: rationalize and use new debug levels and functions

	* util/log.c: change LOG_DEBUG -> LOG_INFO

	* util/log.h: add __attribute__

	* arlad/arladeb.c: add new debug levels.
	add arla_{v,}{err,warn}{,x}

Thu Apr  2 05:07:29 1998  Assar Westerlund  <assar@@sics.se>

	* configure.in: use AC_STRUCT_SOCKADDR_HAS_SA_LEN

	* aclocal.m4 (AC_STRUCT_SOCKADDR_HAS_SA_LEN): added

	* rx/rx_user.c (GetIFInfo): rewrite so that it actually works.

Tue Mar 31 07:52:39 1998  Assar Westerlund  <assar@@sics.se>

	* xfs/bsd/xfs_vnodeops.c (xfs_lookup): better debug output for
 	negative caching

	* xfs/bsd/xfs_message.c (xfs_message_installnode): purge the name
 	cache
	(xfs_message_installdata): purge the name cache iff it's a directory

Mon Mar 30 17:45:45 1998  Love Hörnquist-Åstrand  <lha@@stacken.kth.se>

	* Added autoconf test for glibc. 
	From: Brad Keryan <keryan@@andrew.cmu.edu>

Mon Mar 30 12:01:50 1998  Magnus Ahltorp  <map@@lroken.stacken.kth.se>

	* xfs/linux/xfs_inodeops.c: added mkdir and rmdir

	* xfs/linux/xfs_inodeops.c: xfs_readdir checks for inode numbers
 	in the name cache

Mon Mar 30 00:27:22 1998  Love Hornquist-Astrand  <lha@@stacken.kth.se>

	* aclocal.m4: Autoconf test for getconf, and getconf LFS_{C,LD}FLAGS

Sun Mar 29 14:25:28 1998  Magnus Ahltorp  <map@@lroken.stacken.kth.se>

	* xfs/linux: Merged in access control from bsd.

	* xfs/linux: Fixed various things. Should work much better.

Sun Mar 29 03:21:39 1998  Assar Westerlund  <assar@@sics.se>

	* arlad/arla.c: new option `connected-mode' for setting initial
 	connected mode

	* arlad/fcache.c (do_read_attr, read_data): set anonaccess
	
	* configure.in: remove test for winsock.h.  added test for recvmsg
	and sendmsg.

	* rx/rx_mach.h: cygwin doesn't have SIOCGIFCONF.  From Dan Winship
 	<danw@@MIT.EDU>

	* arlad/*.c: Use O_BINARY.  From Dan Winship <danw@@mit.edu>

Sat Mar 28 10:34:30 1998  assar westerlund  <assar@@sics.se>

	* xfs/bsd/xfs_common.c (install): use DESTDIR

	* arlad/bsd-subr.c (write_dirent): conditionalize on
 	HAVE_STRUCT_DIRENT_D_TYPE

	* configure.in: check for `d_type' in `struct dirent'

Sat Mar 28 10:15:29 1998  Assar Westerlund  <assar@@sics.se>

	* aclocal.m4 (AC_HAVE_STRUCT_FIELD): added

1998-03-28  Love Hörnquist-Åstrand  <lha@@s3.kth.se>

	* *: USE_MMAPTIME

	* configure.in: Added --enable-mmaptime

	* arlad/{messages,arlad}.c: Added no kerberos fix from
	Dan Winship <danw@@mit.edu>

1998-03-27  Love Hornquist-Astrand  <lha@@ksk.sala.se>

	* util/mmaptime.[ch]: Added (not working yet)

Fri Mar 27 03:41:45 1998  Assar Westerlund  <assar@@sics.se>

	* arlad/arla.c (newwalk): handle symlink followed by more path

	* xfs/bsd/xfs_vnodeops.c (xfs_lookup): enter negative entires in
	name cache when arlad returns ENOENT

	* xfs/bsd/xfs_node.c (xfs_dnlc_lookup): change signature to be
 	more compatible with cache_lookup

	* arlad/arla.c (arla_cat): release lock

Thu Mar 26 02:21:48 1998  Assar Westerlund  <assar@@sics.se>

	* Release 0.4

	* lwp/process.S: rhapsody/powerpc
	
	* lwp/Makefile.in: Add powerpc and rhapsody.
	
	* **/Makefile.in: Use KRB_INC_FLAGS
	
	* configure.in, aclocal.m4: Test for krb v5.  From <lxs@@mit.edu>

Wed Mar 25 04:26:56 1998  Assar Westerlund  <assar@@sics.se>

	* xfs/linux/xfs_dev.c (xfs_devwrite): return the correct value.
  	also check for bogus size == 0

	* xfs/{linux,sunos,solaris}: update to new style xfs_message.h

	* xfs/bsd/xfs_msg_locl.h: new file

	* xfs/bsd/xfs_wrap.c: do DISPATCH the `correct' way

	* xfs/bsd/xfs_message.c: add `struct proc *p' to xfs_message_*

	* xfs/bsd/xfs_node.c (new_xfs_node): now takes a `struct proc *p'

	* xfs/bsd/xfs_dev.c: add `struct proc *p' to xfs_message_*

	* xfs/bsd/xfs_dev.h: add prototypes for xfs_message_*

	* arlad/messages.c: made all xfs_message_* functions static

	* arlad/messages.h: add proto for xfs_message_receive

	* xfs/include/xfs_message.h: Removed all the prototypes.

	* xfs/bsd/xfs_vnodeops.c: s/EINVAL/EOPNOTSUPP/

	* xfs/bsd/xfs_dev.c (xfs_message_wakeup_data): correct debug
 	output

	* arlad/messages.c(afsrights2xfsrights): change arguments.

	* xfs/linux/xfs_load.c (init_module): don't print
 	xfs_message_installnode, it's static now.

Tue Mar 24 00:24:18 1998  Assar Westerlund  <assar@@sics.se>

	* xfs/bsd/xfs_vfsops.c (xfs_mount): copy in the arguments.  From
 	Karl Ramm <kcr@@mit.edu>.
	
Tue Mar 24 19:53:50 1998  Robert Burgess  <rb@@stacken.kth.se>

	* arlad/fcache.c: Added VIOCGETAL support
	
Tue Mar 24 02:03:43 1998  Assar Westerlund  <assar@@sics.se>

	* xfs/linux/xfs_dev.c (xfs_devwrite): fix?

	* arlad/kernel.c: also collect statistics on the number of
 	messages per read

	* arlad/messages.c: more stats

	* arlad/messages.c: count the number of send/recd messages

	* xfs/include/xfs_message.h (XFS_MSG_COUNT): added

	* arlad/*-subr.c (conv_dir): use `fcache_extra_file_name' and do
 	locking correctly.

	* xfs/bsd/xfs_vnodeops.c (xfs_seek): return 0.

	* Makefile.in (configure): ignore errors

	* arlad/arla.c (main): don't malloc and free device_file

	* appl/fs.c: added `getcrypt' and `setcrypt'

	* xfs/bsd/xfs_syscalls.c (xfs_pioctl_call): add
 	VIOC_[GS]ETRXKCRYPT

	* include/kafs.h (VIOC_[GS]ETRXKCRYPT): added

	* arlad/bsd-subr.c (write_dirent): set `d_type'

Sun Mar 22 19:25:18 1998  Assar Westerlund  <assar@@sics.se>

	* Release 0.3

	* configure.in: don't clobber CFLAGS

	* xfs/bsd/xfs_syscalls.c (xfs_pioctl_call): use
	`a_followSymlinks'.  Call `suser' instead of == 0

	* arlad/solaris-subr.c: handle the weirdness in the solaris dirent
 	format

	* arlad/afsdir_check.c (check): removed bogus code

	* xfs/solaris: major rewriting and fixing.

Sun Mar 22 02:47:59 1998  Love Hornquist-Astrand  <lha@@stacken.kth.se>

	* appl/fs.c,arlad/messages.c,xfs/{bsd,openbsd2.3,linux}:
	Added VIOCCONNECTMODE

Sat Mar 21 15:20:52 1998  Assar Westerlund  <assar@@sics.se>

	* arlad/fcache.c (read_data, write_data, truncate_file): kill the
 	call if an error occurs.

	* configure.in: tweak CFLAGS and -I/usr/athena

	* arlad/conn.c (conn_get): connected_mode test

	* arlad/volcache.c (volume_uptodatep): look at connected_mode

	* arlad/fcache.c (uptodatep): look at `connected_mode'

	* arlad/arla.c: new option `--debug'

	* arlad/arladeb.c (arla_log_set_level, arla_log_get_level,
 	arla_log_print_levels): new functions

	* arlad/kernel.c (process_message): handle multiple messages

	* xfs/{sunos,solaris,linux}/xfs_dev.c: merge in changes from bsd

	* arlad/messages.c(xfs_send_message_wakeup_multiple): new
 	function.  use it.

	* lwp/iomgr.c: re-wrote the handling of fd_set's

	* xfs/bsd/xfs_dev.c (xfs_devread, xfs_devwrite): implement
 	multiple messages per read/write

Sat Mar 21 06:45:42 1998  Artur Grabowski  <art@@squit.stacken.kth.se>

	* doc/* : added a few docs about Arla.

Fri Mar 20 08:19:36 1998  Artur Grabowski  <art@@squit.stacken.kth.se>

	* xfs/{openbsd2.3,bsd}/xfs_vfsops.c (xfs_unmount): fix unmounting.

Fri Mar 20 04:30:33 1998  Assar Westerlund  <assar@@sics.se>

	* xfs/bsd/xfs_vnodeops.c (xfs_fetch_rights): new function used by
 	`xfs_access'
	(xfs_read, xfs_write, xfs_readdir, xfs_readlink): vop_lock and
	vop_unlock

Thu Mar 19 22:31:20 1998  Assar Westerlund  <assar@@sics.se>

	* ydr/output.c (init_generate): change path of rx.h

	* xfs/bsd/xfs_vnodeops.c(xfs_fsync): send correct flags to
 	do_fsync

	* arlad/fbuf.c (mmap_copyrx2fd, malloc_copyrx2fd): check result of
 	ftruncate

	* arlad: moved kerberos includes to arla_local.h

	* include/Makefile.in: remove stds.h, kafs.h add rxkad.h service.h
	
	* **/Makefile.in: remove unused INCLUDES

Thu Mar 19 12:27:47 1998  Love Hörnquist-Åstrand  <lha@@s3.kth.se>

	* app/fs/fs.c: 
	(fserr): Implemented and changed on all used use on all places.
	(afs_getfid): Added VIOCGETFID
	(quit_cmd): use return instead of exit();

Wed Mar 18 21:52:31 1998  Assar Westerlund  <assar@@sics.se>

	* arlad/fcache.c (create_directory): create the directory locally
 	instead of fetching it from the file server

	* arlad/adir.c (dir_mkdir): new function

	* arlad/fcache.c (stale): don't bother if the callback is already
 	dropped

Wed Mar 18 10:58:44 1998  Magnus Ahltorp  <map@@lroken.stacken.kth.se>

	* xfs/linux/xfs_vfsops.c: Added xfs_write_inode

	* xfs/linux/xfs_inodeops.c: Added permission checking and write support

Wed Mar 18 03:11:51 1998  Artur Grabowski  <art@@squit.stacken.kth.se>

	* xfs/{openbsd2.3,bsd}/{xfs_fs.h,xfs_node.c}: xfs_has_pag implemented.

	* xfs/{openbsd2.3,bsd}/xfs_node.c (new_xfs_node): set anonrights.

	* xfs/openbsd2.3/xfs_vfsops.c: small fix to {un,}installation.

	* xfs/{openbsd2.3,bsd}/xfs_vnodeops.c
	(xfs_access): implement correctly

	* xfs/{openbsd2.3,bsd}/xfs_node.h: add an anonrights field to
	xfs_node.

	* xfs/{openbsd2.3,bsd}/xfs_message.c
	(xfs_message_installattr, xfs_message_installdata): set anonrights.

	* xfs/include/xfs_message.h: add anonrights, change id from u_int
	to pag_t, add masks for rights.

	* arlad/messages.c
	(afsrights2xfsrights): implement.
	(fcacheentry2xfsnode): add handling of access rights.
	(most functions): access rights handling with changed cm_attr.

	* arlad/inter.c
	(getrights): correct implementation.
	(checkright): correct implementation.
	(cm_getattr): handling of access rights.

	* arlad/fcache.c
	(create_new_entries): initialize acccache.
	(recover_state): Do not recover rights.
	(findaccess): pag 0 doesn't mean that it's unauthorized.

	* ChangeLog: updated.

Tue Mar 17 06:05:26 1998  Artur Grabowski  <art@@squit.stacken.kth.se>

	* lwp/iomgr.c: some speed optimizations on selecting.

Tue Mar 17 03:09:56 1998  Love Hornquist-Astrand  <lha@@foo.ksk.sala.se>

	* Make arlad /dev/xfs0 working again.

	* lib/ko/koerror.c: Fallback on strerror().

	* xfs/bsd/{xfs_dev.c,xfs_vnodeops.c,xfs_locl.h}: Started to
	use #ifdef HAVE_VOP_FOO for everything.

	* xfs/bsd/xfs_dev.c: NetBSD 1.3 and OpenBSD 2.2 doesn't have
	vop_{get,put}pages_desc.

Tue Mar 17 01:24:55 1998  Assar Westerlund  <assar@@sics.se>

	* xfs/*: moved xfs/*.h to .

	* xfs/bsd/xfs_vnodeops.c: fixed vop_t

	* xfs/solaris/Makefile.in: renamed xfs.mod -> xfs

	* lwp/Makefile.in: check if the compiler is gcc not if it's called
 	gcc

	* **: renames lots of `errno' to `error'

	* xfs/linux/Makefile.in: include KRB_INC_DIR last

Mon Mar 16 21:38:06 1998  Artur Grabowski  <art@@squit.stacken.kth.se>

	* lwp/process.S: close a comment and let lwp work on ppc. (reported
	to work)

Mon Mar 16 20:55:52 1998  Magnus Ahltorp  <map@@lroken.stacken.kth.se>

	* xfs/linux/xfs_inodeops.c: Fixed bug in xfs_readdir

Mon Mar 16 02:54:53 1998  Assar Westerlund  <assar@@sics.se>

 	* Release 0.2

	* NEWS, THANKS: new files.

	* include/Makefile.in: add parse_units.h and resolve.h

Sun Mar 15 00:56:47 1998  Assar Westerlund  <assar@@sics.se>

	* arlad/volcache.c (volume_uptodatep): new function
	(recover_state): don't mark recovered volumes as valid

	* xfs/sunos/xfs_vnodeops.c (xfs_inactive): use the flag field on
 	the inactivenode message

	* xfs/solaris/xfs_vnodeops.c (xfs_inactive): use the flag field on
 	the inactivenode message

	* xfs/openbsd2.3/xfs_vnodeops.c (xfs_reclaim): use the flag field
 	on the inactivenode message

	* xfs/linux/xfs_vfsops.c (xfs_put_inode): set flag in inactivenode
 	message

	* xfs/include/xfs_message.h (xfs_message_inactivenode): new `flag'
 	field

	* xfs/bsd/xfs_vnodeops.c (xfs_close): only call `do_fsync' if the
 	file was oppened for writing and was actually changed.
	(xfs_inactive): send an inactivenode message
	(xfs_reclaim): use the correct flag on the inactivenode message

	* arlad/messages.c (xfs_message_inactive): look at the flags
	(xfs_message_create & c:o): use the correct realfid

	* arlad/inter.c: update to new FCacheEntry

	* arlad/fcache.c (throw_entry): only give up a callback if we have
 	any.
	(recover_state): init `count'
	(fcache_stale_entry): call stale iff flags.kernelp
	(fcache_get_data): don't get data if the shows that it hasn't changed.

	* arlad/fcache.h (FCacheEntry): remove `nreaders' and `nwriters'.
  	add `flags.kernelp'

	* arlad/adir.c (create_new_page): return page1
	(add_to_page): only loop till ENTRIESPERPAGE - 2
	(adir_creat): don't use status.Length, it might already have been
	increased by the file server.  more and more correct checks.

	* appl/vos.c (printvolstat): const-ized

	* appl/arlalib.h: const-ized

	* appl/arlalib.c: const-ized

Sat Mar 14 14:39:25 1998  Assar Westerlund  <assar@@sics.se>

	* include/Makefile.in: add err.h

	* rx/rx_pkt.[ch]: don't assume sizeof(void) == 1

Sat Mar 14 14:08:02 1998  Assar Westerlund  <assar@@sics.se>

	* arlad/cmcb.c (RXAFSCB_CallBack): remove warning message

	* arlad/{ports,arla,messages}.c: no \n to arla_log

	* rxkad/rxk_locl.c (rxkad_check_packet): kludge around.

	* README: update installation instructions

	* arlad/arla.c: add options for rxkad_level and device.

Sat Mar 14 13:56:55 1998  Magnus Ahltorp  <map@@lroken.stacken.kth.se>

	* arlad/Makefile.in: Added libko dependencies in arlad

Fri Mar 13 05:06:37 1998  Assar Westerlund  <assar@@sics.se>

	* xfs/linux/xfs_inodeops.c (xfs_readlink): call `set_fs'

	* xfs/bsd/xfs_vnodeops.c (do_fsync): reset the XFS_DATA_DIRTY flag
	(xfs_remove): remove the name from the dnlc
	(xfs_mmap, xfs_bmap, xfs_getpages, xfs_putpages): dummy functions

	* xfs/bsd/xfs_message.c: spell-check the printfs

	* util/fnameutil.[ch]: rename {base,dir}name to copy_\1name

	* rxdef/pts.xg: fix broken declarations

	* include/Makefile.in: add getarg.h

	* arlad/volcache.h (volcacheentry): add `validp'

	* arlad/volcache.c: change `freelist' to be a `lrulist'
	(recover_state, volcache_store_state): new functions
	(volcache_invalidate): new function

	* arlad/inter.c (cm_init,cm_store_state,log_operation): new
 	functions
	(*): call log_operation
	(*): const-ized some arguments

	* arlad/fcache.h: update prototypes

	* arlad/fcache.c (fcache_store_state,recover_state): new functions
	(fcache_init): don't create cachedir. try to recover state.
	(*): return ENETDOWN if findconn fails
	(do_read_attr): throw data if DataVersion has changed
	(truncate_file): use O_CREAT
	(create_file): create a empty cache file
	(*): const-ized some arguments
	(fcache_get_data): DTRT

	* arlad/cmcb.c (RXAFSCB_CallBack): handle volume callbacks.

	* arlad/arladeb.h: add ADEBVOLCACHE and ADEBCM

	* arlad/arla.c (newwalk): return int.  change callers.  handle
 	signals by storing state
	(main): use getarg. chdir to cachedir before initializing

	* configure.in: fix sys/dir.h and dirent.h test.
	call AC_KRB_VERSION

	* aclocal.m4 (AC_KRB_VERSION): new macro

	* TODO: update

Thu Mar 12 15:22:50 1998  Love Hornquist-Astrand  <lha@@stacken.kth.se>

	* configure.in,aclocal.m4,acconfig.h,lib/roken/resolve.c: 
	Added HAVE__RES

	* configure.in, aclocal.m4: Added tests for krb-libs,and includes.

Thu Mar  5 22:20:54 1998  Magnus Ahltorp  <map@@lroken.stacken.kth.se>

	* xfs/linux/xfs_inodeops.c: More correct error handling
	and -Wall pleasing.

Thu Mar  7 05:50:10 1998  Love Hörnquist-Åstrand  <lha@@s3.kth.se>

	* rxdef/pts.xg: Added broken xg def.

Wed Mar  4 03:23:19 1998  Love Hornquist-Astrand  <lha@@stacken.kth.se>

	* arla/*.c: Added arla_log and started to used.

	* util/log.c: Added log_vlog.

	* arlad/messages.c: Moved vicofluchvolume outsize #ifdef KERBEROS
 	and added stub for VIOCGETAL.

Tue Mar  3 21:16:06 1998  Love Hornquist-Astrand  <lha@@stacken.kth.se>

	* xfs/linux/xfs_inodeops.c: fixes memoryleak and xfs_readdir()
	on linux != sparc. from amu@@mit.edu (Aaron M. Ucko)

Tue Mar  3 00:00:55 1998  Assar Westerlund  <assar@@sics.se>

	* arlad/inter.c (cm_lookup): const-ized parameters

	* xfs/{sunos,solaris}/{,bin/}Makefile.in: set exec_prefix
	(install): removed '-m 444'

	* rxdef/volumeserver.xg: remove stds.h

	* lib/{ko,tl}/Makefile.in (install): removed '-m 444'

	* arlad/arla.c (newwalk): follow symlinks
	(main): try harder getting kerberos credentials

	* appl/appl_locl.h: include <atypes.h>

Mon Mar  2 13:32:42 1998  Love Hornquist-Astrand  <lha@@stacken.kth.se>

	* appl/vos.c: Vos exa now uses libko/kocell.

	* lib/ko/kocell.c: Moved from arlad/cell.c, and turned
	arlad/cell.c to a dummy.

	* configure.in,include/stds.h.in: Added autoconf test 
	for krb_principal

	* Made a bunch of links to include/ from all .h files
	to make the compile lines more sane.

	* arla/{fcache.c,volcache.c} Added use of libkoerror.

Mon Mar  2 01:00:09 1998  Johan Danielsson  <joda@@emma.pdc.kth.se>

	* arlad/bsd-subr.c: Horrible hack for DEC Unix.

Sun Mar  1 06:42:00 1998  Assar Westerlund  <assar@@sics.se>

	* Release 0.1

	* arlad/fcache.c (do_read_attr): invalidate data if we have it
 	cached and DataVersion has changed.

	* xfs/bsd/xfs_node.c (new_xfs_node): postpone vget-ing

	* xfs/bsd/bin/Makefile.in: set PROGS and clean properly

	* xfs/bsd/xfs_message.c (xfs_message_isntallnode): more debug

	* xfs/bsd/Makefile.in (doclean): clean properly
	(CFLAGS): remove Wall (it is set by configure)

	* rx/rx.h: remove stupid includes

	* conf/Makefile.in: don't overwrite existing configuration files

	* configure.in: remove unused tests

	* xfs/bsd/xfs_message.c (xfs_message_installdata): don't
 	VOP_UNLOCK unlocked vnode.

	* util/list.c: more paranoia

	* arlad/bsd-subr.c (conv_dir): free buf

	* arlad/adir.c (adir_readdir): do `.' and `..'-magic correctly.

Fri Feb 27 23:37:39 1998  Assar Westerlund  <assar@@sics.se>

	* arlad/fcache.c: better error reports when rx calls fail.

Fri Feb 27 07:09:08 1998  Artur Grabowski  <art@@squit.stacken.kth.se>

	* arlad/*-subr.c: truncate files when opening a dircache file.

Fri Feb 27 04:56:58 1998  Artur Grabowski  <art@@squit.stacken.kth.se>

	* arlad/arladeb.h: ADEBFCACHE added
	
	* arlad/fcache.c: don't break dead xfs-callbacks.
	
	* arlad/adir.c: put '.' and '..' in front of a readdir. Some systems
	seem to like it that way.

Thu Feb 26 01:30:44 1998  Love Hornquist-Astrand  <lha@@stacken.kth.se>

	* arlad/fcache.c,messages.c: VIOC_FLUSHVOLUME

	* Now semiworking (no good parsing) vos listvol, it was a feature
 	in ydr.

	* ydr/output.c: 
	  - long -> int32 fix
	  - Fix for use of temporary variables.

Mon Feb 23 06:38:18 1998  Love Hornquist-Astrand  <lha@@stacken.kth.se>

	* xfs/bsd/xfs_syscalls.c: Merged in changes from obsd23.

	* lib/roken/roken.h: ssize_t added.

	* lib/roken/roken.h: sunos select fix.

	* lib/roken/roken.h,acconfig.h, configure.in: sunos select fix.

	* VIOC_VENUSLOG: Almost.

Mon Feb 23 01:17:43 1998  Artur Grabowski  <art@@stacken.kth.se>

	* xfs/openbsd2.3: (xfs_pioctl) cleanup and VIOCSETCACHE

	* arlad/messages.c, fcache.c: VIOCSETCACHE

Mon Feb 23 02:10:51 1998  Assar Westerlund  <assar@@sics.se>

	* Release 0.0

	* arlad/arla.c (main): try to get tokens for the local cell.

	* appl/appl_locl.h: include rxkad.h iff KERBEROS

	* arlad/fcache.c (read_data): make sure we never go over
 	`highbytes'

	* lwp/Makefile.in: add hpux

	* configure.in: add hpux

	* rx/rx_pkt.c(rxi_ReadPacket): fix from <per@@era-t.ericsson.se>
 	for handling strange packets.

	* rxdef/vldb.xg: MAXNAMELEN -> VLDB_MAXNAMELEN

	* rx/rx_locl.h: include <atypes.h>

	* lib/ko/ko.h: include <atypes.h>

	* arlad/messages.c: always include <kafs.h>

	* arlad/arla.c: made `conf_params' static to make it initable.

	* arlad/Makefile.in: coompatible with stupid make

	* appl/Makefile.in: use KAFS_LIBS

	* configure.in: set KAFS_LIBS

	* arlad/arla.c: allow setting of low and high-water marks.

	* configure.in: test if strtok_r needs a prototype

	* rxdef/Makefile.in: remove new junk files

	* ydr/main.c: changed the way of running cpp :-(

Mon Feb 23 05:55:54 1998  Artur Grabowski  <art@@squit.stacken.kth.se>

	* xfs/openbsd2.3: (xfs_pioctl) cleanup and VIOCSETCACHE

	* arlad/messages.c, fcache.c: VIOCSETCACHE

	* appl/fs.c: setcachesize implmeneted.

	* arlad/arla.c: Added reading of a configuration file. 

Sun Feb 22 20:51:47 1998  Love Hornquist-Astrand  <lha@@stacken.kth.se>

	* xfs/bsd/xfs_vnodeops.c(xfs_link): Added OpenBSD and NetBSD 
	compability

	* configure.in, include/stds.h, rxkad/rxkad.h: Added test for
	{,u_}int32, and added those for rxkad.

	* appl/vos.c: Fixing listpart, but the total is still wrong.

	* appl/vos.c: Added libko to parts of vos.c

	* lib/ko: Added libko, vlserver, volserver and rxkad errorcodes
	and messages.

Sun Feb 22 15:59:30 1998  Assar Westerlund  <assar@@sics.se>

	* arlad/volcache.c (print_entry): print every volume only once.

Sun Feb 22 15:23:31 1998  Johan Danielsson  <joda@@emma.pdc.kth.se>

	* lwp/iomgr.c (struct IoRequest): add `next' pointer instead of
 	bogus use of `result'.

	* lwp/lwp.c: Include <string.h>, replace "0x%x" with "%p".

	* rx/*: Use rx_locl.h
	  - replace bcopy with memcpy
	  - remove `register'
	  - change long -> int32
	  - don't depend on sizeof(whatever) being correct

	* rx/rx_user.c: Clean up osi_Panic.

	* rx/rx_pkt.c: Cleanup rx_Slow{Read,Write}Packet.

	* appl/vos.c: htonl(vlentry.serverNumber)

Sun Feb 22 06:10:55 1998  Assar Westerlund  <assar@@sics.se>

	* ydr/lex.l (yywrap): conditionalize

Sun Feb 22 01:11:17 1998  Assar Westerlund  <assar@@sics.se>

	* arlad/messages.c (xfs_message_pioctl): implement VIOCGETTOK

	* xfs/bsd/xfs_syscalls.c (xfs_pioctl_call): implement `VIOCGETTOK'

	* rxkad: updated to a more modern version.

	* xfs/bsd/xfs_vnodeops.c (xfs_link, xfs_rename): implement

	* arlad/messages.c (xfs_message_link, xfs_message_rename):
 	implement

	* arlad/inter.c (cm_link, cm_rename): new functions

	* arlad/fcache.c (create_link, rename_file): new functions
	all functions are now careful not to use any OUT parameters from
 	rpc's that fail.

	* xfs/bsd/xfs_node.c (xfs_node_find): cleaner

	* arlad/fbuf.c: re-did the fbuf-interface

	* arlad/bsd-subr.c (write_dirent): do special for ".." iff
 	flags.mountp

	* arlad/volcache.c (recycle_entry): removed a bogus `hashtabdel'

	* rx/rx_pkt.c (rxi_ReadPacket): case `RX_HEADER_SIZE' to int when
 	comparing again `nbytes', otherwise we lose :-(

	* xfs/bsd/xfs_node.c (xfs_node_find): a dead vnode might still be
 	on the mount-list, check for that.

Sat Feb 21 23:14:47 Love Hornquist-Astrand  <lha@@foo.ksk.sala.se>

	* arlad/adir.c(adir_remove): Use length when deleting a entry 
	in a afsdir.

	* arlad/fcache.c: Return ENOMEM when not finding a cred for the
	new cell (this should never fail, we should allways be able to find a
	 rx_null cred.)

	* xfs/bsd/xfs_vnodeops.c: Define xfs_vop_t for Open|NetBSD for
	typecasting --> getting less errors.

	* arlad/fcache.c: Use CRED_ANY when we hit a remote cell,
	and doesn't find a "native" cred.

Sat Feb 21 18:14:47 1998  Assar Westerlund  <assar@@sics.se>

	* arlad/messages.c (xfs_message_symlink): new function

	* arlad/inter.c (cm_symlink): new function

	* arlad/fcache.c (create_symlink): new function

	* xfs/bsd/xfs_vnodeops.c (xfs_symlink): implement

	* xfs/bsd/xfs_vnodeops.c (xfs_lookup): more SAVENAME voodoo
	(xfs_remove, xfs_rmdir, xfs_abortop): implement functions

	* arlad/messages.c (xfs_message_mkdir, xfs_message_rmdir): new
 	functions

	* arlad/inter.c (cm_mkdir, cm_rmdir): new functions

	* arlad/fcache.c (create_directory, remove_file,
 	remove_directory): new files

	* arlad/afsdir_check.c: more paranoid tests

	* arlad/adir.c: squash some almost fence-post bugs.

	* xfs/include/xfs_message.h (xfs_message_remove): added cred

	* arlad/afs_dir.h: start using sized types

	* arlad/messages.c (xfs_message_create): convert and push down the
 	updated directory

	* arlad/inter.c (cm_create): create the file in the local cached
 	copy of the directory.

	* arlad/fbuf.c: re-organized.
	(truncatefilebuffer): new function

	* arlad/adir.c (adir_lookup): test to see that `dir' is a
 	directory.
	(adir_readdir): dito
	(adir_creat): new function for adding an entry to a directory.
	(aidr_remove): new function for removing an entry from a directory.

	* arald/afsdir_check.c: new program

Sat Feb 21 16:00:00  Love Hornquist-Astrand  <lha@@foo.ksk.sala.se>

	* arlad/arla.c, rx/r.c: Added rx-status.

Fri Feb 20 09:32:52 1998  Assar Westerlund  <assar@@sics.se>

	* arlad/fcache.c: return better error codes than ENODEV (except in
 	two cases)

Thu Feb 19 23:17:25 1998  Love Hornquist-Astrand  <lha@@foo.ksk.sala.se>

	* xfs/bsd/xfs_syscalls.c, arlad/messages.c: Added VIOC_GET_WS_CELL.

	* xfs/include/xfs_messages.h: Added handle to pioctl msg.

Thu Feb 19 02:47:52 1998  Love Hornquist-Astrand  <lha@@stacken.kth.se>

	* xfs/bsd/syscalls.c, arlad/message.c: VIOC_FILE_CELL_NAME.

	* xfs/bsd/xfs_vnodeops.c(xfs_mkdir): Send right message and 
	save us a panic

	* include/kafs.h: Added more pioctl calls.

	* appl/vos.c: Added to option to query a specific server in vos exa
	and added options -host, -cell and -noauth.

	* arlad/arla.c: begining for sysname in -t mode.

	* arlad/cell.c: Ask diffrent vldb-server each time.

Thu Feb 19 06:05:43 1998  Assar Westerlund  <assar@@sics.se>

	* include/kafs.h: added

	* arlad/fcache.c: re-wrote

	* arlad/volcache.c: re-wrote

	* arlad/messages.c (VIOC_AFS_SYSNAME): remove
	(afsstatus2xfs_attr): fix
	(xfs_message_*): updated

	* arlad/inter.c (getrights, checkright): commented out, I didn't
 	bother to fix them now.
	(cm_lookup): add test for `@@sys'
	(cm_remove, cm_link): commented out

	* arlad/fbuf.c: remove #undef HAVE_MMAP and make the code compile.

	* arlad/conn.c: re-wrote

	* arlad/cred.c: re-wrote

	* arlad/cmcb.c (RXAFSCB_InitCallBackState): do something

	* arlad/cell.c: rename all functions to cell_
	(cell_num2name): new function
	fix fopen format strings
	removed all locks (sorry Love)

	* arlad/arla.c: Use `tmpce'
	(arla_{conn,vol,cred,fcache}_status): new functions

	* arlad/adir.c (adir_lookup): update to new fcache-interface.  use
 	CredCacheEntry.  don't handle @@sys
	(adir_readdir): update to new fcache-interface.  use CredCacheEntry

	* ydr/output.c: add copyright
	(gen1): make TIN arguments `const'

	* xfs/bsd/Makefile.in (CFLAGS): add `-Wno-unused'

	* xfs/bsd/xfs_node.c (xfs_attr2vattr): set `va_blocksize' to a
 	reasonable value.

	* util/hash.c (hashtabnew): check malloc return value at correct
 	place.

	* arlad/Makefile.in: more includes link with libraries in correct
 	order

	* makesnap: don't hardcode cvsbin and CVSROOT

Thu Feb 12 01:38:21 1998  Assar Westerlund  <assar@@sics.se>

	* ydr/output.c: include rx.h

	* ydr/main.c: does it have to be this hairy to run a simple cpp
 	portably?

	* xfs/solaris/xfs_node.c (new_xfs_node): use correct set of
 	attributes

	* xfs/include/xfs_message.h: moved xfs_msg_node and related
 	defintions here from xfs/*/xfs/xfs_node.h

	* lwp/q.c: renamed {ins,rem}que to lwp_\1

	* arlad/irix-subr.c: new file

	* aclocal.m4: stolen BASH_CHECK_DEV_FD from bash

	* configure.in: Add testing for /dev/fd.
	correct gcc test.
	stub support for irix.

Wed Feb 11 02:18:51 1998  Assar Westerlund  <assar@@sics.se>

	* lib/roken/{snprintf.c,mini_inetd.c,getarg.c}: merged in newer
 	code.

	* configure.in: moved util and ydr from subdirs to AC_OUTPUT

1998-02-10  Per Andersson  <ppan@@joker.cntw.com>

	* INSTALL: Changed sunos(4) instructions to match current version

Tue Feb 10 02:52:51 1998  Assar Westerlund  <assar@@sics.se>

	* lwp: renamed process.s -> process.S

	* aclocal.m4(AC_GROK_TYPE): test for ktypes.h

	* xfs/sunos/Makefile.in: rewrote and vpath-ed.

	* xfs/sunos: updated to changes elsewhere.

	* arlad/arla_local.h: use <dirent.h> xor <sys/dir.h>

	* arlad/afs_dir.h: rename PAGESIZE -> AFS_PAGESIZE

	* include/bits.c: test for ktypes.h

	* configure.in: test for ktypes.h

	* include/{bits.c,Makefile.in}: generate atypes.h

	* xfs/solaris: new directory

	* arlad/solaris-subr.c: new file

	* ydr/lex.l: handle more kinds of #-lines

	* rxkad/Makefile.in: work-around for stupid solaris make

	* rxdef/Makefile.in: remove BSD/GNU-special and use explicit rules
 	instead.

	* rx/Makefile.in: work-around for stupid solaris make

	* lwp/iomgr.c: add <fcntl.h>

	* lwp/Makefile.in: more magic for preprocessing and assembling
 	process.s

	* arlad/sunos-subr.c (fcacheentry2xfsnode, conv_dir): update to
 	new signatures

	* arlad/conn.c (markasdown): don't initialize `d' in declaration

	* Makefile.in: add include to SUBDIRS

	* configure.in: replace @@CANONICAL_HOST@@
	add solaris
	check for -lsocket, -lnsl and -lresolv
	generate Makefile in include
	
Tue Feb  3 16:16:42 1998  Love Hörnquist-Åstrand  <lha@@e.kth.se>

	* util/hash.c(hashjpw): Some typecasting to save the world.

	* lib/roken/snprint.c: Removed #if 0

	* configure.in: Added check for gcc and -Wall

Fri Jan 30 19:58:51 1998  Love Hornquist-Astrand  <lha@@stacken.kth.se>

	* arlad/{conn.c,fcache.c,volcache.c}: Fixed conn locking.

Wed Jan 28 05:43:44 1998  Artur Grabowski  <art@@stacken.kth.se>

	* Cleaned up most of the warnings in arlad, lwp, rx* and some other
	  small things.

	* lwp: ANSI-prototypes.

	* rx: ANSI-prototypes. Indentation, cleanup

Wed Jan 28 01:00:00 1998 Niklas Hallqvist <nh@@stacken.kth.se>

	* BSDmake compatibility

	* Build from local libsl
	
Thu Jan 22 22:13:57 1998  Magnus Holmberg  <mho@@stacken.kth.se>

	* xfs/include/xfs_message.h: Argh! Whoever came up with the bright
 	idea of having userland xfs_message_receive() and kernel
 	xfs_message_receive() have the same name and share the same
 	prototype?

	* xfs/include/xfs_message.h, configure.in, acconfig.h:
	Gross hack to support both old and new VFS.

Wed Jan 21 12:52:44 1998  Assar Westerlund  <assar@@sics.se>

	* xfs/linux/xfs_inodeops.c (xfs_close): use XFS_{READ,WRITE}

	* xfs/bsd/xfs_vnodeops.c (xfs_close): use XFS_{READ,WRITE}.
  	always call cm_close, independent of the dirty flag.  arlad needs
 	to now how many processes have this file open.

	* arlad/inter.c(cm_close): use XFS_READ & c:o

	* xfs/include/xfs_message.h: introduced flags:
 	XFS_{READ,WRITE,...}

Wed Jan 21 03:54:15 1998  Magnus Holmberg  <mho@@stacken.kth.se>

	* xfs/openbsd2.3:
		VFS Lite2 changes.
		Merged from .../xfs/bsd.
		-Wall.

Mon Jan 19 03:30:53 1998  Magnus Ahltorp  <map@@lroken.stacken.kth.se>

	* arlad/*-subr.c, arlad/messages.c: Merged xfs_attr stuff into messages.c

	* Changed linux xfs to use xfs_attr and changed everything to include
	xfs/include/xfs_message.h

Mon Jan 19 04:46:36 1998  Assar Westerlund  <assar@@sics.se>

	* xfs/include/xfs_message.h: add ID. remove old junk

	* xfs/include/xfs_attr.h (XA_SET_*): Use correct field name.
	(xfs_file_type): fix typo

	* xfs/bsd/xfs_node.c (vattr2xfs_attr, xfs_attr2vattr): new
 	functions

Sun Jan 18 12:19:26 1998  Assar Westerlund  <assar@@sics.se>

	* xfs/bsd/Makefile.in (MODULE): use `mv -f'
	(unload): correct symbol is `xfs_mod'

	* arlad/fcache.c (writefile): don't send the length of data in the
 	stream.
	
Sun Jan 18 23:57:11 1998  Love H-Åstrand <lha@@foo.ksk.sala.se>

	* xfs/bsd/bin/startarla.in: a startscript, using autoconf.

	* xfs/bsd/xfs_dev.c(xfs_devclose): Make sure we dont unmount a
	not mounted filesystem.
	
Sun Jan 18 12:19:26 1998  Assar Westerlund  <assar@@sics.se>

	* arlad/conn.c (getconnection): restructured.  Make all
 	unauthenticated connections with cred == 0.  Try to add an
 	unauthenticated connection at the same time as a authenticated
 	one.  This is used when receiving and breaking callbacks.

	* arlad/conn.h (ConnCacheEntry): add `securityclass'

	* xfs/bsd/bin/mount_xfs.c: DTRT with __progname and err*

	* xfs/bsd/Makefile.in (unload): use modunload

	* arlad/*-subr.c: no need to specify cachedir.

	* arlad/fcache.c: allow specification of cachedir

	* arlad/arla.c (main): specify cachedir when calling initfcache

	* Makefile.in: clean and simplify

	* xfs/bsd/xfs_dev.c: use = instead of bcopy

Sun Jan 18 15:14:58 CET 1998  Love H-Åstrand <lha@@foo.ksk.sala.se>

	* Added configure option --with-arlacachedir

Sun Jan 18 01:20:45 1998  Love H-Åstrand <lha@@foo.ksk.sala.se>

	* arla/cafe-au-lait.c: Added new file.

	* Added target install and made arla/cell.c use prefix for
	CellServDB and ThisCell.
	
	* xfs/bsd/xfs_dev.c(xfs_uninstall_device): Fixed unload bug for
	net|open-bsd

	* xfs/bsd/xfs_vfs_ops.c: Fixed kernel panic for net|openbsd, 
	it may work now. Tried to fix it for freebsd too.

Thu Jan 15 23:24:52 1998  Magnus Holmberg  <mho@@stacken.kth.se>

	* xfs/openbsd2.3/xfs_vnodeops.c: Fixed arguments to vnode
 	functions to match new vfs.

Thu Jan 15 06:10:37 1998  Assar Westerlund  <assar@@sics.se>

	* configure.in: test for symorder.  use xfs/bsd

	* xfs/bsd: new unified bsd xfs-module

Thu Jan 15 01:14:35 1998  Love Hornquist-Astrand  <lha@@foo.ksk.sala.se>

	* xfs/openbsd/xfs_vnodeops.c: Added use of XFS_ANONYMOUSID when we
	dont have a cred. Setting pag_t.pag to 0 is a bad idea, since we
	use uid when the user doesn't have a pag...

Thu Jan 15 00:52:16 1998  Magnus Ahltorp  <map@@lroken.stacken.kth.se>

	* xfs/linux/xfs_vfsops.c: Made xfs_put_inode tell arla when an
 	inode goes inactive

	* arlad/fcache.c: Hopefully more correct locking

Tue Jan 13 23:10:03 1998  Assar Westerlund  <assar@@sics.se>

	* arlad/fcache.c (openfile): changed to return error and fd as
 	parameter.

	* arlad/Makefile.in: use @@LIB_readline@@

	* configure.in: stolen editline-tests from krb4

	* aclocal.m4: stolen AC_FIND_FUNC_NO_LIBS from krb4

	* arlad/arla.c: junked lots of old code. 
	wrote a new simple command-line mode for `-t'.

	* arlad/cmcb.c (RXAFSCB_Probe, RXAFSCB_InitCallBackState,
 	RXAFSCB_CallBack): print the IP-address

	* arlad/Makefile.in: renamed arla -> arlad. 
	link with sl and related libraries

	* configure.in: make sure we have a working version of autoconf
 	don't create any xfs-makefiles if we have a unsupported OS

1998-01-13  Per Andersson  <ppan@@joker.cntw.com>

	* Arladaemons name changed to 'arlad' in INSTALL

Tue Jan 13 19:23:10 1998  Love Hornquist-Astrand  <lha@@stacken.kth.se>

	* Added sl and editline

	* Added pag support for net/open-bsd

	* Added libroken

Mon Jan 12 23:12:15 1998  Magnus Ahltorp  <map@@lroken.stacken.kth.se>

	* arlad/messages.c,xfs/{linux,openbsd,freebsd}:
	Moved to pag authentication, added set sysname,
	added set pag in linux

Mon Jan 12 00:59:55 1998  Magnus Ahltorp  <magnus@@dike.aladdin.se>

	* xfs/linux/xfs_syscalls.c: Added set pag.

Sun Jan 11 05:14:44 1998  Assar Westerlund  <assar@@sics.se>

	* rxkad/rxk_crpt.c: resurrect bswap and conditionalize it on
 	EFF_NTOHL

	* configure.in: use AC_FUNC_NTOHL

	* aclocal.m4 (AC_FUNC_NTOHL): new macro

	* ydr: added support for the 'multi' keyword

Sun Jan 11 00:19:46 1998  Love Hornquist-Astrand  <lha@@stacken.kth.se>

	* xfs/openbsd/xfs_locl.h: Added prototype for xfs_get_pag and
 	added som include files (removed those include files all over)

	* xfs/openbsd/xfs_vfsops.c: Added the type of fs to the
 	mp->mnt_stat struct

	* xfs/openbsd/xfs_syscalls.c: Added pag support

	* xfs/openbsd/xdeb.h: Added XDEBSYS

	* xfs/openbsd/xfs_dev.c(xfs_devclose): Lock the mointpoint when 
	freeing the xfsnodes

Sat Jan 10 04:21:31 1998  Assar Westerlund  <assar@@sics.se>

	* arlad/{bsd,linux,sunos}-subr.c (conv_dir): don't ReleaseReadLock

	* arlad/fcache.c: allow reuse of the cache files

	* arlad/messages.c (xfs_message_getroot): use `cm_getattr'

	* arlad/inter.c (cm_getattr): return real_fid as a parameter.

	* arla/thash.[ch], arla/vlstr.h: removed.

	* ydr/output.c (generate_server_switch): write prototype to header
 	file.

	* lwp/Makefile.in: add mips/irix

	* arlad/volcache.c: clean-up:
	cell -> int32_t
	const-ize
	
	* arlad/ports.c (initports): use the official IANA names and
 	enable the code.

	* arlad/{linux,sunos,bsd}-subr.c (write_dirent): const-ize

	* arlad/conn.c: all cells are int32_t

	* arlad/cell.c: all cells are int32_t

	* arlad/cmcb.c: clean-up

	* arlad/adir.c (afs_lookup): return int.  removed old code.
  	clean-up.

	* lwp/Makefile.in: fix ranlib

	* arlad/cell.c: restructured a tiny bit and added some (void)

	* arlad/fcache.c (getroot): return error code.  changed all callers.

	* arlad/kernel.c: `struct fd_set' should be `fd_set'

	* include/config.h.in: removed

	* xfs/openbsd2.3/xfs_vfsops.c (xfs_mount): replaced VOP_UNLOCK by
 	vput

	* xfs/openbsd/xfs_vfsops.c (xfs_mount): do vput instead of
 	VOP_UNLOCK.

Fri Jan  9 21:32:54 1998  Assar Westerlund  <assar@@sics.se>

	* configure.in: test for header files used by fs

Fri Jan  9 20:55:05 1998  Robert Burgess  <rb@@bobby.stacken.kth.se>

	* appl/fs.{c,h}: added

Fri Jan  9 18:29:28 1998  Assar Westerlund  <assar@@sics.se>

	* xfs/*/xfs/xfs_node.h: define xfs_attr

	* xfs/linux/xfs/attr.h: xfs_attr must be a type and not a struct.

	* bin/umount_xfs.c: does not work.  replaced with the
 	openbsd-version.

	* arlad/kernel.c: new file with generic kernel interface code.

	* arlad/{bsd,sunos,linux}-subr.c: OS-specific functions
	
	* arlad/messages.c: new file with the generic message code.
	
	* conf/CellServDB: A recent version.
	
Fri Jan  9 17:23:08 1998  Love H-Astrand  <lha@@ksk.sala.se>

	* Added milko/aefs: Added Äckligt fs, and cleaned up

	* configure: Removed

Fri Jan  9 17:25:21 1998  Magnus Ahltorp  <map@@lroken.stacken.kth.se>

	* arlad/linux-messages.c: getattr and creds fixed

Fri Jan  9 13:53:50 1998  Artur Grabowski  <art@@squit.stacken.kth.se>

	* xfs/openbsd: cleanup

	* xfs/openbsd: add flags to free_all_xfs_nodes to allow forced unmount

Fri Jan  9 12:17:20 1998  Artur Grabowski  <art@@squit.stacken.kth.se>

	* Made the definite move of mount_xfs and other binaries into
	xfs/@@sys/bin

Fri Jan  9 05:23:13 1998  Magnus Ahltorp  <map@@lroken.stacken.kth.se>

	* arlad/adir.c: Moved pointer dereference to after initialization
 	of the pointer

1998-01-08  Per Andersson  <ppan@@joker.cntw.com>

	* Added very preliminary installation instructions in ./INSTALL

Thu Jan  8 11:05:40 1998  Magnus Ahltorp  <map@@lroken.stacken.kth.se>

	* arlad/fbuf.c: Truncate file before close

	* arlad/inter.c, arlad/fcache.c: Made cm_lookup handle EACCES

Thu Jan  8 03:28:55 1998  Assar Westerlund  <assar@@sics.se>

	* arlad/fcache.c: changed getfile and getattr to return an error
	code.  fixed all callers.

	* lwp/preempt.c: ifdef SA_NODEFER

	* ydr/lex.l: always print error messages with `error_message'.
	use global `filename'.
 	be careful when setting `filename' from cpp-lines

	* ydr/types.h: add TINOUT

	* ydr/parse.y: add INOUT and int

	* ydr/output.c (encode_symbol): add default catch-all.
	add handling of INOUT.
	rename `result' -> `_result'
	
	* ydr/lex.l: add INOUT

	* rxdef/Makefile.in (CLIENTLIB, SERVERLIB): run ranlib.
	(clean): remove more files.

	* rx/rx_queue.h: renamed _Q() to _RX_QUEUE(): it conflicts with _Q
 	from <ctype.h>

	* configure, include/config.h.in: regenerated

	* configure.in: remove rxgen

	* rxdef/Makefile.in: add more file types to ydr rule

	* lwp/preempt.c, lwp/iomgr.c: use RETSIGTYPE

	* arlad/volcache.c: use `u_int32_t' for volumes.

	* arlad/fcache.c (writefile): fix sprintf call.

	* configure.in: add AC_TYPE_SIGNAL

	* arlad/msg.c: removed

Wed Jan  7 19:54:57 1998  Love H-Astrand  <lha@@ksk.sala.se>

	* arlad/*.xg, arlad/common.h: Removed them, then live in rxdef/ now

Wed Jan  7 10:00:25 1998  Magnus Ahltorp  <magnus@@dike.aladdin.se>

	* xfs/linux/Makefile: removed

	* xfs/linux/Makefile.in: Added

Wed Jan  7 07:40:02 1998  Artur Grabowski  <art@@squit.stacken.kth.se>

	* xfs: mount_xfs and umount_xfs moved from openbsd to xfs/bin

	* xfs/bin: new mount_xfs with argument parsing and correct syntax

Wed Jan  7 05:31:16 1998  Artur Grabowski  <art@@squit.stacken.kth.se>

	* xfs/openbsd/mount_xfs.c: mount_xfs mow mounts with fstype "xfs"
	and not from command-line

Tue Jan  6 07:03:38 1998  Artur Grabowski  <art@@squit.stacken.kth.se>

	* appl/vos.c: new command-interface for vos

Tue Jan  6 05:22:13 1998  Love Hornquist-Astrand  <lha@@stacken.kth.se>

	* arlad/inter.c(cm_setattr): Using error from writeattr()

	* arlad/fcache.c(writeattr): Using the error we got back from 
	RXAFSStoreStatus()

	* xfs/openbsd/Makefile.in: Added -e to modload

Tue Jan  6 05:06:40 1998  Magnus Ahltorp  <map@@lroken.stacken.kth.se>

	* arlad/adir.c: Added @@sys support

	* arlad/linux-messages.c: Added putdata, putattr, create,
 	pioctl. Cleaned up a lot.

	* xfs/linux/xfs_syscalls.c: First real version

	* xfs/linux/xfs_inodeops.c: Added open, read, readdir, readlink,
 	followlink

	* xfs/linux/xfs_dev.c: Added xfs_message_wakeup_data

Tue Jan  6 04:16:53 1998  Artur Grabowski  <art@@squit.stacken.kth.se>

	* fixed xfs/openbsd/umount_xfs and compilation problems with mount
	and umount

Mon Jan  5 17:30:41 1998  Love Hornquist-Astrand  <lha@@stacken.kth.se>

	* xfs/openbsd/mod.c: Dont need the diffence between net and open,
 	use modload -e

	* arlad/fcache.c: Fixed bug that made arla write the old length of
 	the file

	* xfs/openbsd/xfs_node.c: Fixed long filename, and added a one
 	entry cache for them.

	* xfs/openbsd/xfs_dev.c: Added some really ugly workarounds for
 	differences between *BSD

Mon Jan  5 05:10:41 1998  Love Hornquist-Astrand  <lha@@stacken.kth.se>

	* xfs/openbsd/mount_xfs.c: More errorchecking and removed compat
 	junk
	
Sun Jan  4 22:30:37 1998  Love Hörnquist-Åstrand  <lha@@stacken.kth.se>

	* */*/*: Removed all (?) reference to u_long cred and started to
	use pag_t cred. Dont know how much vill break.

	* xfs/openbsd/xfs/xfs_message.h: added xfs_cred and pag_t

Sat Jan  3 21:51:56 1998  Magnus Ahltorp  <map@@lroken.stacken.kth.se>

	* xfs/linux/xfs_syscalls.c: Added

	* xfs/linux/xfs_inodeops.c: Released inode after use

Sat Jan  3 20:24:37 1998  Magnus Ahltorp  <map@@lroken.stacken.kth.se>

	* xfs/linux/xfs_cache.c: Added

	* xfs/linux/xfs_node.c: Added cache purging in
 	free_all_xfs_nodes()

	* xfs/linux/xfs_common.h: Cleaned up and changed syntax for xfs_free

	* xfs/linux/xfs_common.c, xfs/linux/xfs_dev.c,
	xfs/linux/xfs_node.c: Changed syntax for xfs_free

	* xfs/linux/xfs_inodeops.c, xfs/linux/xfs_message.c: Changed to xfs_cache

	* xfs/linux/xfs_vfsops.c: Added xfs_put_inode

Sat Jan  3 08:37:08 1998  Love Hornquist-Astrand  <lha@@stacken.kth.se>

	* arlad/bsd-messages.c(xfs_message_create): New function

	* arlad/inter.c(cm_close): Fixed flags semantics

	* arlad/fcache.c(writefile): Fix AFSStoreStatus mask

	* xfs/openbsd/xfs/xfs_message.h: Added flag to struct
 	xfs_message_putdata, so we know what to do.

	* arlad/bsd-messages.c: Implemented xfs_message_putdata()

	* xfs/openbsd/xfs_vnodeops.c(xfs_close, xfs_fsync): Added writesupport

Sat Jan  3 05:27:51 1998  Assar Westerlund  <assar@@sics.se>

	* xfs_message.c: merge in changes from ../openbsd

	* xfs_vnodeops.c (xfs_read): panic if cache vnode == NULL

	* arlad/bsd-messages.c (xfs_message_getnode,xfs_message_getattr):
 	mask XFS_DATA_MASK from `msg.node.tokens'

Sat Jan  3 00:55:46 1998  Magnus Ahltorp  <map@@lroken.stacken.kth.se>

	* arlad/inter.c: Changed cm_getattr to check for the correct rights

	* xfs/linux/xfs_inodeops.c: Fixed return value from xfs_lookup

Fri Jan  2 23:34:22 1998  Love Hörnquist-Åstrand  <e96_lho@@e.kth.se>

	* xfs/openbsd/xfs_message.c(xfs_message_invalidnode): Fixed tokens
 	in xfsnode

Fri Jan  2 20:46:03 1998  Assar Westerlund  <assar@@sics.se>

	* xfs_vnodeops.c: mrege in changes from ../openbsd

	* arlad/bsd-messages.c (vattr2afsstorestatus): remove mask

Fri Jan  2 20:47:20 1998  Love Hörnquist-Åstrand  <e96_lho@@e.kth.se>

	* xfs/openbsd/xfs_vnodeops.c: Fixed xfs_write()

	* arlad/bsd-messages.c: Added vattr2afsstorestatus() and cleaned up

	* arlad/arla_local.h: Added vattr2afsstorestatus() defines

Fri Jan  2 12:47:20 1998  Love Hörnquist-Åstrand  <e96_lho@@e.kth.se>

	* xfs/openbsd/xfs_vnodeops.c: putattr support working when ATTR
 	not opened RW

	* arlad/inter.c (cm_setattr): Return error message if writeattr fail

	* arlad/fcache.h: Fixed writeattr call

	* arlad/fcache.c: Adding support for chmod

	* arlad/arla_local.h: Added {fs,vldb}.cs.c to get prototypes,
	and fixed the error that was discoved

Fri Jan  2 04:27:06 1998  Assar Westerlund  <assar@@sics.se>

	* arlad/cmcb.c (RXAFSCB_CallBack): handle the case of there not
 	being enough callbacks.

Fri Jan  2 03:42:43 1998  Magnus Ahltorp  <map@@lroken.stacken.kth.se>

	* arlad/linux-messages.c: Made getnode and getroot work

	* xfs/linux/xfs_inodeops.c: Added xfs_lookup

	* xfs/linux/xfs_message.c: Fixed inode number bug

Thu Jan  1 22:53:15 1998  Assar Westerlund  <assar@@sics.se>

	* rx/Makefile.in: removed all xdr*

	* rx/rx_misc.c: remove xdr.h and use malloc/free instead of
 	mem_alloc/mem_free

	* ydr/Makefile.in: bsd-make compatible

Thu Jan  1 19:13:40 1998  Magnus Ahltorp  <map@@lroken.stacken.kth.se>

	* xfs/linux/xfs_dev.c: Fixed some inits.

Thu Jan  1 17:31:08 1998  Assar Westerlund  <assar@@sics.se>

	* arlad/arla.c (main): fix call to conv_dir

Wed Dec 31 18:17:15 1997  Love H-Astrand  <lha@@ksk.sala.se>

	* milko/ss2fs/file.c: Bugfixes, not done

	* milko/mutil/dirpage.c: Moved to here

	* milko/mutil/fdrxop.c: Added file

Wed Dec 31 13:11:01 1997  Love H-Astrand  <lha@@ksk.sala.se>

	* milko/ss2fs/ss2dir.c: Added file
	
Wed Dec 31 00:30:07 1997  Assar Westerlund  <assar@@sics.se>
	
	* xfs/xfs_message.h (xfs_message_wakeup_data): added

	* xfs_dev.c (xfs_message_wakeup_data): copied from ../openbsd

	* Makefile.in: removed duplicate ydr

	* rx/rx_pkt.c (rxi_ReadPcket): use a sensible length test.

	* rx/rx_null.h: prototypize
 	rxnull_New{Server,Client}SecurityObject

	* xfs/xfs_message.h (xfs_message_pioctl): add `outsize' add some
 	prototypes

	* arlad/cred.h: only include <des.h> and <krb.h> iff KERBEROS

	* arlad/conn.c (getconnection): ifdef KERBEROS for krbdata

	* arlad/bsd-messages.c (xfs_message_pioctl): (VIOCSETTOK,
 	VIOCUNLOG): ifdef KERBEROS

	* arlad/arla.c (get_cred): ifdef KERBEROS.

	* arlad/Makefile.in: use autoconf'd RXKAD_LIBS

	* configure.in: set RXKAD_LIBS

	* util/fnameutil.c (dirname): return "." for local files.

	* ydr/output.c (init_generate): include the same set of headers in
 	all generated .c-files.

	* lwp/Makefile.in: separate cpu vs OS definitions

Tue Dec 30 22:08:55 1997  Magnus Ahltorp  <map@@lroken.stacken.kth.se>

	* xfs/linux/xfs_inodeops.c: Added
	
	* xfs/linux/xfs_node.c: Inode values now based on xfs_node
 	pointer. Some more functions ported.

	* xfs/linux/xfs_message.c: Initial linux port

Tue Dec 30 21:11:01 1997  Love H-Astrand  <lha@@ksk.sala.se>

	* milko/ss2fs/file.c: Added even more junk

	* rxdef/Makefile.in: Removed that common.h link, using -I

Mon Dec 29 17:23:25 1997  Assar Westerlund  <assar@@sics.se>

	* util/fnameutil.c (dirname): new function

Fri Dec 26 22:54:12 1997  Love H-Astrand  <lha@@ksk.sala.se>

	* configure.in: Added ufs01fs & co

	* milko/ss2fs: Added

	* milko/ufs01fs: Added

	* milko: Cleaned up and started to migrate in ss2fs

Wed Dec 24 03:25:51 1997  Magnus Ahltorp <map@@hefaistos.abc.se>

	* xfs/linux: Added nfs like allocation of inodes

	* xfs/linux/xfs/attr.h, arlad/linux-messages.c: Added xfs_attr

Mon Dec 22 12:38:26 1997  Love H-Astrand  <lha@@ksk.sala.se>

	* ydr/lex.l: We now recognise {u_,}int{16,32}_t

Sun Dec 21 10:30:42 1997  Love H-Astrand  <lha@@ksk.sala.se>

	* Makefile.in: Added rxdef

Fri Dec 19 05:08:24 1997  Love Hornquist-Astrand  <lha@@stacken.kth.se>

	* xfs/openbsd/xfs_dev.c: Added wakedup_data function in xfs end

	* arlad/fcache.c: Added sysname

	* xfs/openbsd/xfs/xfs_message.h: Added wakedup_data function and
 	struct

	* xfs/openbsd/xfs_syscalls.c: Started adding of sysname

	* arlad/volcache.c: Added VOLCACHEADDDYNAMIC

Wed Dec 17 08:39:02 1997  Love Hornquist-Astrand  <lha@@stacken.kth.se>

	* TODO: Fixed getcwd() ?

	* arlad/bsd-messages.c: Added error checking and fixed error msg

	* arlad/arla_local.h: Added debuggingmacro

	* Makefile.in: Changed to ydr

	* arlad/fcache.c: getcwd & ydr

	* arlad/bsd-messages.c: Working pwd, there is still bugs in
 	there...

1997-12-10  Love Hornquist-Astrand  <lha@@foo.ksk.sala.se>

	* arlad/inter.c: Made tokens support more sane

	* xfs/openbsd/*: Added support for NetBSD

Tue Dec  9 03:38:52 1997  Love Hornquist-Astrand  <lha@@stacken.kth.se>

	* arlad/inter.c: cm_open(): Not quite ready yet.

	* arlad/inter.c: Added test för datausedp;

Mon Dec  8 20:52:09 1997  Assar Westerlund  <assar@@sics.se>

	* arlad/bsd-messages.c (afsstatus2vattr): use VNOVAL
	(xfs_message_getnode): cleanup

	* configure.in: test for more header files.

	* ydr: new version.

Thu Dec  4 14:51:05 1997  Love Hornquist-Astrand  <lha@@stacken.kth.se>

	* TODO: Added vos and rxdef

Sat Nov 29 02:18:57 1997  Love Hornquist-Astrand  <lha@@stacken.kth.se>

	* appl/vos.c: listvol does not work, yet

	* appl/vos.c: Almost working, just lacking CellServDB parsing

	* appl/arlalib.c: Added more junk

Fri Nov 28 17:00:17 1997  Love Hornquist-Astrand  <lha@@stacken.kth.se>

	* appl/vos.c: More working code

	* appl/arlalib.c: First version

Tue Nov 25 20:45:20 1997  Love Hornquist-Astrand  <lha@@stacken.kth.se>

	* rxgen/main.c: Fixed configure test for CPP

Wed Nov 19 13:03:58 1997  Love Hornquist-Astrand  <lha@@foo.ksk.sala.se>

	* milko/dirpage.c: Added 

	* milko/inodedb.c: Added 

	* milko/diskio.c: Made more usable

Tue Nov 18 23:54:11 1997  Magnus Ahltorp  <map@@stacken.kth.se>

	* configure.in: Fixed bug that turned off kerberos default

Tue Nov 18 06:13:17 1997  Magnus Ahltorp  <map@@stacken.kth.se>

	* Added support for different include and lib paths in kerberos.
	Clean up configure.

Sat Nov 15 15:31:24 1997  Love H-Astrand  <lha@@jenny.ksk.sala.se>

	* lwp/lwp.c: Added support for posix signals, added RCSID()

	* lwp/preempt.c: Added support for posix signals

	* lwp/lwp.h: Added check for posix-signals

	* acconfig.h: Added check for posix-signals

	* configure.in: Added check for sys/ioccom.h

	* arla/Makefile.in: Added @@CFLAGS@@
	
Sat Nov 15 11:41:33 1997  Magnus Ahltorp  <map@@stacken.kth.se>

	* configure.in, Makefile.in: Added support for conditional
	build of rxkad

Fri Nov 14 09:36:20 1997  Magnus Ahltorp  <map@@stacken.kth.se>

	* configure.in: Cleaned up and added messages

Fri Nov 14 08:54:26 1997  Magnus Ahltorp  <map@@stacken.kth.se>

	* configure.in: Added support for --with-krb4.

	* acconfig.h: Removed superfluous #define KERBEROS
	
Thu Nov 13 05:42:30 1997  Artur Grabowski  <art@@stacken.kth.se>

	* xfs/openbsd/xfs_node.c: Fixed the removing of vnodes from the
 	list of all vnodes in the fs. :)

Wed Nov 12 22:00:28 1997  Love Hornquist-Astrand  <lha@@stacken.kth.se>

	* arlad/volcache.c: Added gc

Wed Nov 12 04:40:46 1997  Love Hornquist-Astrand  <lha@@stacken.kth.se>

	* arlad/conn.c: Added gc

	* arlad/bsd-messages.c: Added check for invalid rpc calls

	* arlad/cred.c: Made a cred_remove() remove all connection in the
 	connection cache too.

	* arlad/bsd-messages.c: Cleaned up the code.

	* arlad/conn.c: Added support to remove a connection from the
 	connection cache, we still dont gc.

	* util/hash.c: Added hashtabcleantab()

Mon Nov 10 01:11:38 1997  Assar Westerlund  <assar@@sics.se>

	* added lots of copyrights.

	* lib/rxkad: updated

	* acconfig.h: -DKERBEROS

	* xfs/freebsd/xfs/xfs_message.h: added pioctl

Sun Nov  9 19:16:25 1997  Love Hornquist-Astrand  <lha@@stacken.kth.se>

	* arlad/cred.h: Cleanup, added support to clean tokens based on
 	uid.

	* xfs/openbsd/xfs_syscalls.c: Added support for VIOCUNLOG

	* xfs/openbsd/xfs/xfs_message.h: Added uid to struct
 	xfs_message_pioctl, in some magic way we should support PAGs too.

	* arlad/bsd-messages.c: Added support for VIOCUNLOG

Sun Nov  9 17:25:27 1997  Love Hornquist-Astrand  <lha@@stacken.kth.se>

	* xfs/openbsd/xfs/xfs_message.h: Added xfs_message_pioctl

	* xfs/openbsd/kafs.h: Added

	* xfs/openbsd/xfs_syscalls.c: Added VIOCSETTOK

	* arlad/bsd-messages.c: Working cred

Sat Nov  8 19:58:46 1997  Love Hornquist-Astrand  <lha@@stacken.kth.se>

	* arlad/cred.c: Added putkrb4cred()

Fri Nov  7 20:57:09 1997  Love Hornquist-Astrand  <lha@@stacken.kth.se>

	* rx/rx_user.c: Removed rx warning messages

	* arlad/conn.c: After 24h hacking, working rxkad !

Thu Nov  6 22:28:33 1997  Love Hornquist-Astrand  <lha@@stacken.kth.se>

	* arlad/arla.c: Added kerberos support, not working, yet.

	* arlad/Makefile.in: Added support for rxkad, assume krb4 world

	* Makefile.in: Added rxkad

	* arlad/cred.h: Fixed.

	* arlad/cred.c: Fixed some more

Thu Nov  6 18:05:59 1997  Artur Grabowski  <art@@bobby.stacken.kth.se>

	* arlad/bsd-kernel.c: fixed exit on error from device.

Thu Nov  6 17:34:27 1997  Love Hornquist-Astrand  <lha@@stacken.kth.se>

	* arlad/arla.c: Init credcache

	* arlad/conn.c: Added support for rxkad

Thu Nov  6 17:34:27 1997  Love Hornquist-Astrand  <lha@@stacken.kth.se>

	* arlad/cred.h: Made it buildable and spell checked.

	* arlad/cred.c: Made it buildable.

Thu Nov  6 17:31:09 1997  Artur Grabowski  <art@@bobby.stacken.kth.se>

	* xfs/openbsd/xfs_vfsops.c: fixed the releasing of vnodes.

	* xfs/openbsd/xfs_vnodeops.c: cleaned up.

	* Learned to use ChangeLog. (hopefully)

Thu Nov  6 02:38:20 1997 Love Hornquist-Astrand  <lha@@foo.ksk.sala.se>

	* arlad/cred.h: Added 
	
	* arlad/cred.c: Added

	* milko/diskio.c: Started to read the inode instead of makeing up data.

	* milko/build_a_inode.c: more features
	
Tue Nov  4 03:03:03 1997  Love Hornquist-Astrand  <lha@@stacken.kth.se>

	* rxkad/*.[ch]: s/int32/int32_t/g

	* configure.in: Added some more tests.

	* rxkad/Makefile.in: Living in a krb4 work, assar will shot me.

	* aclocal.m4: Added checks for types (int32 & co)

Sun Nov  2 17:24:22 1997  Assar Westerlund  <assar@@sics.se>

	* xfs_vnodeops.c (xfs_data_valid): set `msg.tokens'
	(xfs_lookup): copy name to `msg' correctly

	* xfs_vfsops.c (xfs_root): set `msg.cred'

	* xfs_node.c (free_xfs_node): reset data

	* xfs_message.c (xfs_message_installdata): unlock the cache vnode
 	after lookup

	* xfs_dev.c (xfs_message_rpc): copy back from temporary memory to
 	`message'

	* arlad/inter.c (cm_open): set enty->tokens correctly

	* arlad/Makefile.in: use `test -h' instead of `test -L'

Sat Nov  1 02:06:18 1997  Love H-Astrand  <lha@@ksk.sala.se>

	* arlad/Makefile.in: Fixed so we can build in another directory
 	then src

        * aclocal.m4: Added
	
Thu Oct 30 01:46:51 1997  Love Hornquist-Astrand  <lha@@stacken.kth.se>

	* configure.in: Fixed linux include stuff

	* arlad/linux*: Added linux specific files

	* configure.in: Added milko.

	* milko/Makefile.in: Fixed for merging into arla-tree

Wed Oct 29 22:52:15 1997  Assar Westerlund  <assar@@sics.se>

	* arlad/volcache.c (findvolname, findvolid): check for getvolname
 	returning an error

Sun Oct 26 17:59:11 1997  Magnus Ahltorp  <map@@wakko.stacken.kth.se>

	* xfs/linux/xfs_common.c: Linuxified

Sat Oct 25 19:01:45 1997  Love Hornquist-Astrand  <lha@@stacken.kth.se>

	* lwp/lwp.c: Ansified

	* lwp/iomgr.c: Ansified
	
Sat Oct 25 17:05:21 1997  Assar Westerlund  <assar@@sics.se>

	* xfs/freebsd: use mp->mnt_vnodelist instead of xfsp->nodes

	* xfs/freebsd/Makefile.in: new autoconf'ed makefile

Sat Oct 25 15:53:31 1997  Love Hornquist-Astrand  <lha@@stacken.kth.se>

	* lwp/Makefile.in: Grrrr gcc -E är dum.

	* Makefile.in: Added rx and rxgenbuilding

	* lwp/Makefine.in: Added support for multippel processors
	
Sat Oct 25 15:48:38 1997  Assar Westerlund  <assar@@sics.se>

	* xfs/linux/xfs: new files

Sat Oct 25 14:23:45 1997  Love Hornquist-Astrand  <lha@@stacken.kth.se>

	* configure.in: Removed some configure.in's

Sat Oct 25 14:15:11 1997  Magnus Ahltorp  <map@@wakko.stacken.kth.se>

	* xfs/linux/xfs_dev.c: Merged in the real file and adopted it to
 	Linux

Sat Oct 25 05:46:29 1997  Magnus Ahltorp  <map@@stacken.kth.se>

	* xfs/linux/xfs_dev.c: Moved device stuff here 

	* xfs/linux/super.c: Working filesystem

Fri Oct 24 18:33:36 1997  Magnus Ahltorp  <map@@stacken.kth.se>

	* xfs/linux/super.c: Almost working empty filesystem.

Fri Oct 24 17:20:40 1997  Assar Westerlund  <assar@@sics.se>

	* rx/Makefile.in: replaced junk makefile with a new one

	* arlad/Makefile.in: much clean-up and improvements

	* Makefile.in: much clean-up and improvements

	* configure.in: much clean-up and improvements

	* xfs/Makefile.in: stub makefile

	* lib/util/ip.[ch]: resurrected

	* lib/lwp/q.c: resurrected
	
d2129 1
@


1.1
log
@Initial revision
@
text
@d1 2583
@


1.1.1.1
log
@Initial version of Arla, a free implementation of an AFS cache-manager.
(second try, hopefully into the correct repository this time)
@
text
@@


1.1.1.2
log
@Import of arla-0.35.7
@
text
@d1 1
a1 1
2002-02-25  Love Hörnquist-Åstrand  <lha@@stevens.e.kth.se>
d3 2
a4 1
	* Release 0.35.7
d6 3
a8 1
2002-02-24  Love  <lha@@stacken.kth.se>
d10 1904
a1913 3
	* tests/fhbench.c: include timevalsub and rename it to tvsub
	
2002-02-08  Love  <lha@@stacken.kth.se>
d1915 1
a1915 4
	* xfs/linux/xfs_inodeops.c: 1.174->1.175: (xfs_file_mmap): pass in
	the xfs-inode to data_valid instead of the cache-node
	
2002-02-06  Love  <lha@@stacken.kth.se>
d1917 2
a1918 6
	* xfs/linux/xfs_dev.c: 1.87->1.88:
	(free_node): create yet another free function, this one does
	consistency checks and replaces xfs_free(xn, XFS_MEM_XNODE)
	(xfs_queue_inactive): if the channel is closed, just free the node
	(xfs_process_inactive_queue): use free_node()
	(xfs_empty_inactive_queue): use free_node()
d1920 2
a1921 4
	* xfs/linux/xfs_syscalls.c: 1.69->1.70: (xfs_fh_to_dentry):
	linux-2.4: after a get_super, we need to drop_super(), w/o this,
	the we will fail to unmount the super block of the
	cache-filesystem.
d1923 1
a1923 1
2002-02-05  Love  <lha@@stacken.kth.se>
d1925 1
a1925 2
	* tests/copy-and-diff-gnu-mirror: 1.7->1.8: don't run unless use
	are running -large tests
d1927 4
a1930 4
	* tests/run-tests.in: 1.76->1.78: add option -large that avoids
	running tests that uses up large amount of diskspace (like
	copy-and-diff-gnu-mirror), add new option -fail that make test-run
	stop after the first failure
d1932 7
a1938 1
2002-02-01  Magnus Ahltorp  <ahltorp@@nada.kth.se>
d1940 1
a1940 7
	* appl/mac/Arla_Configuration/ReadCells.m: 1.2->1.3: Added static
	on local functions
	* appl/mac/Arla_Configuration/Makefile.in: 1.6->1.7: Use install
	instead of tar
	* appl/mac/Arla_Configuration/DataSource.m: 1.12->1.13: Added
	static on local functions 1.12->1.13: (checkdaemonpid): give -p to
	ps
d1942 1
a1942 1
2002-02-01  Love  <lha@@stacken.kth.se>
d1944 1
a1944 3
	* xfs/linux: dual license xfs for linux under bsd/gpl, update
	copyright years. See xfs/linux/license for more detailed
	information.
d1946 4
a1949 3
	* xfs/linux/xfs_node.c: adding missing symbol xfs_null_aops
	
2002-02-01  Magnus Ahltorp  <ahltorp@@nada.kth.se>
d1951 1
a1951 1
	* lwp/Makefile.in: Remove superfluous -lroken
d1953 1
a1953 1
	* cf/check-roken.m4: Reference libroken directly instead of with -l
d1955 1
a1955 1
2002-02-01  Love  <lha@@stacken.kth.se>
d1957 1
a1957 2
	* conf/CellServDB: 1.62->1.63: (theory.cornell.edu): removed, from
	Ruth Mitchell <mitchell@@tc.cornell.edu> on info-afs@@transarc.com
d1959 9
a1967 2
	* Fix support for linux-2.4. This is only tested with 2.4.17,
	  older version will probably not work.
d1969 1
a1969 6
	xfs_inodeops.c: 1.165->1.166
	xfs_message.c: 1.99->1.102
	xfs_node.c: 1.56->1.58
	xfs_vfsops.c: 1.75->1.77
	xfs/xfs_fs.h: 1.23->1.24
	xfs/xfs_locl.h: 1.51->1.52
d1971 1
a1971 1
2002-01-31  Love  <lha@@stacken.kth.se>
d1973 3
a1975 3
	* configure.in: 1.526->1.527: check for list_del_init
	* cf/linux-func-init-mutex.m4: 1.6->1.7: make test work when
	init_MUTEX is a macro (late linux-2.2)
d1977 1
a1977 2
	* configure.in: 1.474->1.475: (linux): test for struct
	dcache_operations.d_delete returning void
d1979 4
a1982 3
	* cf/linux-d_delete-void.m4: 1.1: added from current
	
2002-01-30  Love  <lha@@stacken.kth.se>
d1984 4
a1987 3
	* xfs/linux/xfs_dev.c: part of 1.82->1.83: use init_MUTEX
	* xfs/linux/xfs/xfs_locl.h: add from current, local define of
	init_MUTEX
d1989 1
a1989 1
2002-01-28  Love  <lha@@stacken.kth.se>
d1991 1
a1991 2
	* xfs/include/xfs/xfs_message.h: 1.46->1.47: add symbol
	XFS_XDELETED
d1993 2
a1994 1
2002-01-25  Magnus Ahltorp  <ahltorp@@nada.kth.se>
d1996 1
a1996 2
	* appl/mac/Arla_Configuration: Build appl/mac/Arla_Configuration
	with normal make
d1998 1
a1998 2
	* configure.in: 1.510->1.511: Build appl/mac/Arla_Configuration
	with normal make
d2000 2
a2001 1
2002-01-25  Love  <lha@@stacken.kth.se>
d2003 2
a2004 4
	* configure.in: Disable (arlad/fbuf) mmap for darwin for now, we
	get 0 byte long files sometime.
	
2002-01-22  Love  <lha@@stacken.kth.se>
d2006 1
a2006 2
	* xfs/bsd/xfs_message.c: 1.52->1.53: handle struct
	mount.mnt_nvnodelist (FreeBSD 4.5 and higher)
d2008 2
a2009 2
	* xfs/bsd/xfs_node-bsd.c: 1.59->1.60: handle struct
	mount.mnt_nvnodelist (FreeBSD 4.5 and higher)
d2011 2
a2012 4
	* configure.in (1.523->1.524): (FreeBSD): never set smp flags to
	"no"
	 (FreeBSD): test for struct mount.mnt_nvnodelist (the new name for
	mnt_vnodelist in 4.5 and above)
d2014 1
a2014 3
	* configure.in: unbreak the --enable-smp for both linux and
	freebsd, for freebsd is plainly didn't work, and for linux it
	didn't autoprobe
d2016 1
a2016 1
2001-12-20  Love  <lha@@stacken.kth.se>
d2018 2
a2019 1
	* tests/hardlink3: 1.2->1.3: hardlink3 is not fast
d2021 33
a2053 2
	* xfs/bsd/xfs_vfsops-netbsd.c: create a xfs_reinit
	* configure.in: 1.507->1.508: check for vfs_reinit
d2055 10
a2064 3
	* configure.in: 1.521->1.522: (netbsd,openbsd): make sure we pass
	in -I$SYS to incl
	(KERNEL_CPPFLAGS) since the <bsd.lkm.mk> might not set it.
d2066 1
a2066 1
2001-12-20  Mattias Amnefelt  <mattiasa@@e.kth.se>
d2068 1
a2068 1
	* arlad/fcache.c (try_next_fs): return true for RXKADUNKNOWNKEY
d2070 1
a2070 1
2001-11-24  Mattias Amnefelt  <mattiasa@@e.kth.se>
d2072 1
a2072 2
	* rx/rxdebug.c (1.11->1.12) print byte and packetcounters as
	unsigned
d2074 3
a2076 1
2001-11-16  Mattias Amnefelt  <mattiasa@@e.kth.se>
d2078 1
a2078 3
	* appl/vos/vos_{un,}lock.c send request to syncsite
	* rx/rxdebug.c (1.10->1.11) servers do return statistics
	* appl/vos/vos_listvldb.c (1.12 -> 1.13) handle partitions > 'z'
d2080 2
a2081 1
2001-10-24  Magnus Ahltorp  <ahltorp@@nada.kth.se>
d2083 1
a2083 2
	* lib/bufdir/fbuf.c: 1.15->1.16: msync doesn't take protection
	flags
d2085 1
a2085 1
	* appl/mac/make-mac-package.sh: Changed to /Library/StartupItems
d2087 2
a2088 2
	* lib/bufdir/fbuf.c: 1.14->1.15: Added msync before munmap where
	necessary
d2090 1
a2090 1
	* lib/ko/Makefile.in: 1.35->1.36: Added LDFLAGS
d2092 1
a2092 1
	* appl/vos/Makefile.in: 1.17->1.18: Added LDFLAGS
d2094 1
a2094 1
	* appl/udebug/Makefile.in: 1.14->1.15: Added LDFLAGS
d2096 2
a2097 1
	* appl/fs/Makefile.in: 1.16->1.17: Added LDFLAGS
d2099 2
a2100 1
	* appl/pts/Makefile.in: 1.14->1.15: Added LDFLAGS
d2102 2
a2103 1
	* appl/bos/Makefile.in: 1.15->1.16: Added LDFLAGS
d2105 2
a2106 1
	* appl/afsutils/Makefile.in: 1.19->1.20: Added LDFLAGS
d2108 1
a2108 1
	* appl/Makefile.in: Only build kalog when we have tf_util
d2110 1
a2110 2
	* cf/check-kerberos.m4: 1.39->1.40: Added support for Mac OS X
	built-in kerberos and kth-krb with openssl
d2112 1
a2112 1
	* configure.in: 1.520->1.521: Don't use libroken in tf_util test.
d2114 1
a2114 1
2001-10-22  Love  <lha@@stacken.kth.se>
d2116 60
a2175 2
	* configure.in: freebsd[45]): when build with --enable-smp tag on
	APIC_IO since its needed (true for alpha too ?)
d2177 17
a2193 1
2001-10-22  Magnus Ahltorp  <ahltorp@@nada.kth.se>
d2195 1
a2195 2
	* configure.in: 1.517->1.519: Added -flat_namespace on Mac OS X.
	Only compile kalog if there is a tf_init.
d2197 1
a2197 1
2001-10-19  Magnus Ahltorp  <ahltorp@@nada.kth.se>
d2199 1
a2199 2
	* xfs/bsd/xfs_message.c: 1.70->1.72: (xfs_message_invalidnode):
	Don't treat node as used if only UBC uses it.
d2201 2
a2202 5
	* xfs/bsd/xfs_vnodeops-common.c: 1.77->1.78:
	(xfs_inactive_common): Clear dirty flag when fsync fails
	1.78->1.79: (xfs_read_common): Do not print out random memory
	1.79->1.80: (xfs_open_valid): Call xfs_handle_stale 1.79->1.80:
	Added xfs_handle_stale
d2204 2
a2205 2
	* xfs/bsd/xfs/xfs_locl.h: 1.50->1.51: xfs_set_vp_size is called
	ubc_setsize on Darwin
d2207 1
a2207 1
	* arlad/messages.c (xfs_message_getroot): Correct typo
d2209 1
a2209 1
2001-10-16  Magnus Ahltorp  <ahltorp@@nada.kth.se>
d2211 1
a2211 2
	* arlad/messages.c: 1.263->1.264: (xfs_message_getroot): Set
	tokens in installroot message
d2213 1
a2213 1
2001-10-14  Love  <lha@@stacken.kth.se>
d2215 5
a2219 4
	* conf/CellServDB: mc.vanderbilt.edu removed, from David Krause
	<david.w.krause@@vanderbilt.edu> on arla-drinkers
	
2001-10-11  Magnus Ahltorp  <ahltorp@@fridge.nada.kth.se>
d2221 2
a2222 1
	* Release 0.35.6
d2224 1
a2224 1
2001-10-09  Love  <lha@@stacken.kth.se>
d2226 3
a2228 2
	* arlad/fcache.c: (get_attr_bulk): avoid updating entries that are
	locked, fixes tests/hardlink3
d2230 1
a2230 1
	* tests/hardlink3: added test that trigged bulkstatus bug
d2232 27
a2258 1
2001-10-08  Magnus Ahltorp  <ahltorp@@nada.kth.se>
d2260 1
a2260 2
	* INSTALL: Updated
	* README: Updated
d2262 1
a2262 1
2001-10-04  Assar Westerlund  <assar@@sics.se>
d2264 1
a2264 4
	* appl/lib/ka-procs.c (ka_authenticate): handle k_afsklog
	* appl/afsutils/klog.c (get_afs_token), appl/afsutils/aklog.c
	(krb_afslog_uid): k_afslog -> k_afsklog_uid
	(which always was the old name)
d2266 1
a2266 1
2001-10-02  Love  <lha@@stacken.kth.se>
d2268 18
a2285 1
	* cf/check-kerberos.m4: replace -lroken with $LIB_roken
d2287 23
a2309 1
2001-10-01  Mattias Amnefelt  <mattiasa@@e.kth.se>
d2311 1
a2311 2
	* arlad/fcache.c (1.349->1.350) (get_root_of_volume): always try
	to get the best credential
d2313 1
a2313 1
2001-09-30  Magnus Ahltorp  <ahltorp@@nada.kth.se>
d2315 1
a2315 1
	* xfs/bsd/xfs/xfs_dev.h: Support three argument selrecord
d2317 1
a2317 1
	* xfs/bsd/xfs_dev-bsd.c: Support three argument selrecord
d2319 1
a2319 1
2001-09-28  Mattias Amnefelt  <mattiasa@@e.kth.se>
d2321 1
a2321 1
	* arlad/conn.h: increase fuzz by a factor of 1000
d2323 1
a2323 1
2001-09-26  Mattias Amnefelt  <mattiasa@@e.kth.se>
d2325 1
a2325 1
	* appl/vos/vos_listpart.c: null terminate agetarg list
d2327 1
a2327 1
2001-09-24  Magnus Ahltorp  <ahltorp@@nada.kth.se>
d2329 2
a2330 1
	* configure.in: Removed building of mac applications
d2332 1
a2332 1
2001-09-23  Assar Westerlund  <assar@@sics.se>
d2334 1
a2334 7
	* arlad/messages.c (1.261->1.262): (try_again): do not invalidate
	the volcache entry on VNOVOL, it's done in fcache.c:try_next_fs
	now
	* arlad/fcache.c (merge 1.347->1.348): (try_next_fs): send in fid
	too.  and mark volcache entry as invalid on VNOVOL and VMOVED.
	this way we actually mark volcache entries as invalid and refresh
	them even when there are other r/o clones that work
d2336 1
a2336 1
2001-09-21  Mattias Amnefelt  <mattiasa@@e.kth.se>
d2338 1
a2338 1
	* rx/rxdebug.c (GetVersion) Check return codes
d2340 2
a2341 1
2001-09-19  Mattias Amnefelt  <mattiasa@@e.kth.se>
d2343 1
a2343 4
	* appl/vos/vos_examine.c: Print info from vldb even if we can't 
	reach fileserver 
	* appl/vos/vos_examine.c: (printvolstat) only print volumeid when 
	clone exists
d2345 1
a2345 1
2001-09-18  Mattias Amnefelt  <mattiasa@@e.kth.se>
d2347 1
a2347 4
	* appl/vos/vos_examine.c: use VLSF_DONTUSE information
	* appl/vos/vos.c: added vos backup and vos backupsys
	* appl/vos/vos_common.c (get_vlentry): try to find
	dbserver if it's not given
d2349 2
a2350 1
2001-09-17  Mattias Amnefelt  <mattiasa@@e.kth.se>
d2352 1
a2352 12
	* rxdef/vldb.xg: use nvldbentry in ReleaseEntryN
	* appl/vos/vos_listvol.c: argument partition is aarg_optional_swless
	* appl/vos/vos_local.h: added backup, backupsys and volname
	* appl/vos/vos_backup.c: added
	* appl/vos/Makefile.in: added vos_backup.c
	* appl/vos/vos_listvldb.c: correct termination of listvldb
	* appl/vos/vos_listvldb.c: (listvldb_iter): use VL_ListAttributes 
	interface, and allow to mask on
	* appl/vos/vos_listvldb.c: serverna me and partition take volume 
	as argument, print volumeids
	* appl/vos/vos_backup.c (vos_backupsys): send volumename to
	vos_listvldb_iter
d2354 2
a2355 1
2001-09-17  Love  <lha@@stacken.kth.se>
d2357 25
a2381 3
	* xfs/bsd/xfs_node-bsd.c (free_all_xfs_nodes): if we have a
	vfs_deallocate_syncvnode, use that to free the syncer-node, indent
	* configure.in: check for vfs_deallocate_syncvnode
d2383 52
a2434 1
2001-09-15  Mattias Amnefelt  <mattiasa@@e.kth.se>
d2436 1
a2436 6
	* lib/ko/gensysname.c: find better sysname for alpha osf
	* appl/fs/fs.c (fsversion_cmd): test for correct number of
	arguments
	* rx/rxdebug.c: Use agetarg instead of libcmd
	* rx/Makefile.in: link rxdebug with libko
	* Makefile.in: build rx after libko
d2438 1
a2438 1
2001-09-14  Love  <lha@@stacken.kth.se>
d2440 64
a2503 10
	* arlad/messages.c: 1.257->1.258: (try_again): when fileserver
	busy or restarting, wait afs_BusyWaitPeriod seconds, this is the
	same timeout as transarc/openafs has.
	* arlad/arla.c: 1.137->1.138: set afs_BusyWaitPeriod to 15 (as
	transarc/openafs does)
	* arlad/arla_local.h: 1.66->1.67: export afs_BusyWaitPeriod
	
	* arlad/messages.c: 1.256->1.257: (vioc_new_cell): memset dbs,
	make sure we a static entry
	(timeout == 0)
d2505 1
a2505 1
2001-09-09  Mattias Amnefelt  <mattiasa@@e.kth.se>
d2507 1
a2507 1
	* rx/rxdebug.c (MakeCall): check return codes
d2509 1
a2509 1
2001-09-07  Magnus Ahltorp  <ahltorp@@nada.kth.se>
d2511 1
a2511 1
	* config.guess, config.sub: update to newer versions
d2513 1
a2513 1
2001-09-07  Love  <lha@@stacken.kth.se>
d2515 1
a2515 1
	* conf/CellServDB: 1.58->1.59: added dynarc.se
d2517 5
a2521 1
2001-09-06  Magnus Ahltorp  <ahltorp@@nada.kth.se>
d2523 1
a2523 2
	* xfs/solaris/xfs_node.c: 1.16->1.17: (new_xfs_node): Set tokens
	from message
d2525 1
a2525 1
2001-09-05  Magnus Ahltorp  <ahltorp@@nada.kth.se>
d2527 2
a2528 4
	* xfs/linux/xfs_node.c: 1.54->1.55: (new_xfs_node): Set tokens
	from message
	* xfs/bsd/xfs_node-bsd.c: 1.55->1.56: (new_xfs_node): Set tokens
	from message
d2530 2
a2531 1
2001-09-04  Magnus Ahltorp  <ahltorp@@nada.kth.se>
d2533 1
a2533 2
	* configure.in: Added selrecord test
	* cf/bsd-func-selrecord.m4: Added selrecord test
d2535 1
a2535 1
2001-09-04  Love  <lha@@stacken.kth.se>
d2537 6
a2542 5
	* arlad/fcache.c: 1.342->1.343: (find_first_fs): don't use entries
	maked by the vldb server as VLSF_DONTUSE, there are volumes marked
	up my the vldb server as non released volumes.
	
2001-09-04  Magnus Ahltorp  <ahltorp@@nada.kth.se>
d2544 1
a2544 2
	* arlad/conn.c: 1.64->1.65: (re_probe): If sleeping already,
	choose the earliest wakeup
d2546 1
a2546 1
2001-09-03  Love  <lha@@stacken.kth.se>
d2548 2
a2549 6
	* xfs/bsd/xfs_node-bsd.c: 1.54->1.55:
	(free_all_xfs_nodes/xfs_vflush): do magic with syncer-node on
	freebsd, this is since FreeBSD > 4.3 changed vflush api so we have
	to remove the mnt_syncer node first before calling vflush to avoid
	dying in a deadlock. break out vflush to a common function
	xfs_vflush().
d2551 1
a2551 1
2001-08-31  Magnus Ahltorp  <ahltorp@@nada.kth.se>
d2553 1
a2553 1
	* util/hash.c: 1.14->1.15: Added hashtabrelease
d2555 1
a2555 2
	* util/hash.c: 1.15->1.16: (hashtabcleantab): Free the correct
	pointer
d2557 4
a2560 1
	* util/hash.h: 1.6->1.7: Added hashtabrelease
d2562 1
a2562 1
2001-08-01  Love  <lha@@stacken.kth.se>
d2564 3
a2566 3
	* xfs/linux/xfs_syscalls.c: fix merge error
	
2001-07-26  Love  <lha@@stacken.kth.se>
d2568 1
a2568 5
	* appl/pts/pts.1: 1.1->1.2: remove .Pp before .Sh, from openbsd
	
	* xfs/bsd/xfs_vnodeops-bsd.c: 1.94->1.95, 1.96->1.97:
	(xfs_symlink): NetBSD 1.5X/OpenBSD current
	(aka version 200107) and above doesn't vput the created symlink
d2570 1
a2570 6
	* xfs/linux/xfs_syscalls.c: 1.66->1.67: (fhget_call): make
	`dentry' const and never dput it
	(user_path2dentry): define it differently for 2.3
	(sys_afs_int): move dput to the end of the function and call
	path_release in 2.3 1.65->1.66: (xfs_debug_print): call
	print_dentry
d2572 1
a2572 1
2001-07-26  Assar Westerlund  <assar@@stacken.kth.se>
d2574 1
a2574 5
	* xfs/linux/xfs_dev.c:1.80->1.81: (xfs_devwrite): do not set dumpable
	* arlad/arlad.c (arla_start): 1.9->1.10: set dumpable 
	with prctl if possible
	* arlad/arla_local.h: 1.63->1.64: add sys/prctl.h
	* configure.in: 1.496->1.497: check for sys/prctl.h
d2576 1
a2576 1
2001-07-25  Magnus Ahltorp  <ahltorp@@nada.kth.se>
d2578 1
a2578 2
	* xfs/bsd/xfs_vnodeops-bsd.c:1.95->1.96: (xfs_remove): call
	ubc_uncache after vput:ing (on osx/darwin)
d2580 1
a2580 1
2001-07-16  Love  <lha@@stacken.kth.se>
d2582 1
a2582 1
	* Release 0.35.5
d2584 1
a2584 1
2001-07-16  Love  <lha@@stacken.kth.se>
d2586 1
a2586 7
	* xfs/bsd/xfs_vnodeops-osf.c: 1.29->1.30: make *common functions
	not handle any vrele/vput. add the correct vrele's to the osf
	functions
	* xfs/bsd/xfs_vnodeops-common.c: 1.74->1.75: make *common
	functions not handle any vrele/vput
	* xfs/bsd/xfs_vnodeops-bsd.c: 1.93->1.94: make *common functions
	not handle any vrele/vput
d2588 1
a2588 1
2001-07-15  Love  <lha@@stacken.kth.se>
d2590 1
a2590 2
	* arlad/fcache.c: 1.337->1.338: (get_attr_bulk): make comparison
	simpler to understand
d2592 1
a2592 4
	* arlad/fcache.c: 1.337->1.337: (get_attr_bulk): when getting the
	fid to install the addr, use a fid will some !random value in it
	
2001-07-14  Love  <lha@@stacken.kth.se>
d2594 1
a2594 3
	* lib/cmd/Makefile.in: 1.5->1.6: link testc with @@LIBS@@
	* configure.in: 1.494->1.495: check for get_progname set_progname
	warnerr
d2596 1
a2596 1
2001-07-11  Mattias Amnefelt  <mattiasa@@e.kth.se>
d2598 1
a2598 2
	* xfs/bsd/bin/startarla.in: added support for dux
	* xfs/bsd/bin/Makefile.in: build startarla on dux
d2600 1
a2600 1
2001-07-09  Love  <lha@@stacken.kth.se>
d2602 2
a2603 3
	* lib/ko/kocell.c: 1.49->1.50: (host_sort): don't use E->name,
	since it might be NULL in case we did a ``fs newcell'', noted by
	Nickolai Zeldovich <kolya@@mit.edu>
d2605 1
a2605 1
2001-07-06  Love  <lha@@stacken.kth.se>
d2607 1
a2607 7
	* appl/lib/arlalib.c: 1.41->1.42: (arlalib_try_next_db): Use
	ARLA_CALL_DEAD instead of RX_CALL_DEAD
	
	* appl/pts/pts.c: 1.52->1.53: membership: Move error handling to
	outside of the server trying loop.  Handle non-existing users and
	groups.
2001-07-06  Mattias Amnefelt  <mattiasa@@e.kth.se>
d2609 1
a2609 2
	* conf/CellServDB changed vldb for it.kth.se according to
	<elu@@it.kth.se>
d2611 1
a2611 1
2001-07-06  Love  <lha@@stacken.kth.se>
d2613 1
a2613 4
	* rx/rx_pkt.c: 1.15->1.16: (rxi_SendDebugPacket): truncate the iov
	to the size of the outgoing packet
	
2001-06-27  Mattias Amnefelt  <mattiasa@@e.kth.se>
d2615 1
a2615 2
	* xfs/bsd/xfs_node-osf.c: (free_all_xfs_nodes) 1.23 -> 1.24 :
	vflush the mountpoint after relasing the root vnode
d2617 1
a2617 1
2001-06-11  Love  <lha@@stacken.kth.se>
d2619 1
a2619 3
	* arlad/DynRootDB.5: clarify what happens if .Nm doesn't exist
	
2001-06-06  Assar Westerlund  <assar@@sics.se>
d2621 2
a2622 1
	* xfs/solaris/bin: move startarla, mount_xfs from bin to sbin
d2624 1
a2624 1
2001-06-06  Magnus Ahltorp  <ahltorp@@fridge.nada.kth.se>
d2626 1
a2626 1
	* Release 0.35.4
d2628 1
a2628 1
2001-06-05  Magnus Ahltorp  <ahltorp@@nada.kth.se>
d2630 1
a2630 1
	* arlad/{inter.c,messages.c}: Disable attrusedp asserts
d2632 1
a2632 3
	* arlad/{adir.c,adir.h,inter.c,messages.c}: Renamed from
	adir_lookup_fcacheentry to adir_lookup. Removed old adir_lookup.
	Use new adir_lookup instead.
d2634 1
a2634 3
	* arlad/{discon_log.c,reconnect.c}: Disable nonworking functions.
	
2001-06-04  Mattias Amnefelt  <mattiasa@@e.kth.se>
d2636 1
a2636 4
	* xfs/bsd/xfs_vfsops-osf.c: test for vfs_swapvp and vfs_smoothsync
	* xfs/bsd/xfs_syscalls_common.c: don't use fhlookup on dux
	* configure.in: test for vfs_swapvp and vfs_smoothsync in struct
	vfsops (for dux)
d2638 2
a2639 1
2001-05-29  Mattias Amnefelt  <mattiasa@@e.kth.se>
d2641 1
a2641 10
	* xfs/bsd/xfs_{vnodeops,node}-osf.c: general update of the osf/1
	code. Doesn't crash immidiately
	* lib/sl/lex.l,ydr/lex.l: build with lex on dux 4.0d
	* arlad/Makefile.in: use correct syntax
	* cf/osf-func-vfs-name-hash.m4: function to find out more about 
	vfs_name_hash()
	* cf/try-compile-kernel.m4: use KERNEL_CC if it is defined
	* configure.in: find out more about vfs_name_hash on osf/1
	* appl/{afsutils,amon,asrvutil,bos,fs,kalog,pts,udebug,vos}/Makefile.in
	lib/ko/Makefile.in: build working makefile even if @@LIBS@@ is empty
d2643 1
a2643 1
2001-05-28  Magnus Ahltorp  <ahltorp@@nada.kth.se>
d2645 1
a2645 2
	* arlad/{dynroot.c,dynroot.h,fcache.c}: Make dynroot add
	CallerAccess to creds
d2647 1
a2647 1
2001-05-22  Magnus Ahltorp  <ahltorp@@nada.kth.se>
d2649 1
a2649 1
	* arlad/fcache.c: Allow setting of highvnodes.
d2651 1
a2651 1
2001-05-17  Magnus Ahltorp  <ahltorp@@nada.kth.se>
d2653 1
a2653 1
	* configure.in: Arla configuration program for Mac OS X
d2655 1
a2655 1
	* appl/mac/Makefile.in: Added mac directory
d2657 1
a2657 5
	* appl/mac/Arla_Configuration/English.lproj/InfoPlist.strings:
	Arla configuration program for Mac OS X
	
	* appl/mac/Arla_Configuration/English.lproj/MainMenu.nib/{classes.nib,
	info.nib, objects.nib}: Arla configuration program for Mac OS X
d2659 1
a2659 2
	* appl/mac/Arla_Configuration/Arla_Configuration.pbproj/
	project.pbxproj.in: Arla configuration program for Mac OS X
d2661 1
a2661 3
	* appl/mac/Arla_Configuration/{Controller.h, Controller.m,
	DataSource.h, DataSource.m, Makefile.in, ReadCells.h, ReadCells.m,
	arla.icns, main.m}: Arla configuration program for Mac OS X
d2663 1
a2663 2
	* arlad/messages.c (viocgetcacheparms): Return lowbytes and
	lowvnodes.
d2665 1
a2665 1
	* arlad/fcache.[ch]: Added fcache_lowbytes and fcache_lowvnodes.
d2667 1
a2667 1
2001-05-17  Love  <lha@@stacken.kth.se>
d2669 1
a2669 4
	* xfs/bsd/bin/startarla.in: remove symbol file before loading
	kernel module
	* xfs/bsd/bin/startarla.in: use /var/db so the data is kept after
	a crash
d2671 1
a2671 1
2001-05-07  Love  <lha@@stacken.kth.se>
d2673 1
a2673 5
	* xfs/bsd/xfs/xfs_locl.h: Fixed merge error, va_size_t differ
	between osf/1 other BSDs, this is correct in current
	
	* xfs/bsd/bin/startarla.in: same for platforms (macosx) using
	kmodload
d2675 1
a2675 3
	* xfs/bsd/bin/startarla.in: Store the output file from modload and
	modstat in /var/run so it will be possible to debug the kernel
	core
d2677 1
a2677 1
2001-05-07  Magnus Ahltorp  <ahltorp@@nada.kth.se>
d2679 1
a2679 1
	* arlad/inter.c (cm_open): assert attrusedp when setting datausedp
d2681 2
a2682 1
	* arlad/fcache.c (stale): Don't clear attrusedp and datausedp
d2684 1
a2684 2
	* arlad/messages.c: Assert or set attrusedp when setting datausedp
	(break_callback): Don't clear kernelp, attrusedp and datausedp
d2686 1
a2686 2
	* cf/linux-filldir-dt-type.m4: try actually calling a filldir_t
	function. just assigning a pointer is not a fatal error
d2688 1
a2688 2
	* arlad{DynRootDB.5,Makefile.in,arlad.8,dynroot.c}, lib/ko/{ko.h,
	kocell.c}: Add support for DynRootDB
d2690 1
a2690 1
2001-04-30  Love  <lha@@stacken.kth.se>
d2692 1
a2692 4
	* arlad/{arla.c,arla_local.h,arlad.c,arladeb.c,arladeb.h,arlad.8}:
	added option --cpu-usage
	* util/log.[ch]: added support for printing cpu usage on each line
	* configure.in: check for getrusage
d2694 1
a2694 1
2001-04-28  Love  <lha@@stacken.kth.se>
d2696 1
a2696 1
	* README: 1.78->1.79: openbsd
d2698 1
a2698 1
2001-04-28  Mattias Amnefelt  <mattiasa@@e.kth.se>
d2700 2
a2701 28
	* xfs/bsd/xfs_node-osf.c (xfs_dnlc_purge_mp) don't use
	cache_purgevfs() if not available
	* xfs/bsd/xfs_syscalls-wrap-osf.c: use sy_info in struct sysent on
	dux 5.1
	* xfs/bsd/xfs_vfsops-osf.c: added xfs_mountroot, xfs_swapvp,
	xfs_smoothsync from dux vfsops
	* configure.in: test for sys/vfs_proto.h sys/vnode.h and
	function cache_purgevfs()
	* xfs/bsd/xfs_node-osf.c: 
	(xfs_dnlc_enter): set ni_makeentry when calling cache_lookup
	(xfs_cnp_init): compute cache correctly
	* xfs/bsd/xfs_vnodeops-osf.c: set name in ndp->cn_nameptr when 
	symlinking
	* xfs/bsd/xfs_vnodeops-osf.c: xfs_{mkdir,create}: set
	ndp->cn_nameptr before calling lookup
	* xfs/bsd/xfs_vnodeops-osf.c (xfs_lookup): Need to set pointer to
	the parent directory.
	* xfs/bsd/xfs/xfs_locl.h, xfs/bsd/xfs_vnodeops-common.c: use
	va_size_t instead of u_quad_t
	* xfs/bsd/xfs_vfsops-common.c: Wrap vfs_getnewfsid in autoconf
	ifdef
	* xfs/bsd/xfs_node-osf.c: new function xfs_dnlc_lock, doing dnlc
	locking on osf
	* xfs/bsd/xfs_message.c: there is no vrecycle on osf
	* xfs/bsd/xfs_common.c, xfs/bsd/xfs_common-bsd.c: moved memcpy to
	xfs_common.c
	* configure.in: test for vfs_mountroot in vfsops and sy_info in
	sysent
d2703 1
a2703 1
2001-04-22  Love  <lha@@stacken.kth.se>
d2705 1
a2705 3
	* lib/ko/ports.c: 1.10->1.11: (ports_init): make quiet since
	people can't right and add services into their services file (or
	equivalent)
d2707 1
a2707 1
2001-04-21  Love  <lha@@stacken.kth.se>
d2709 3
a2711 4
	* arlad/cred.c: 1.34->1.36: remove cred from hashtab when its
	killed, update copyright
	* arlad/conn.c: 1.62->1.64: remove conn from hashtab when its
	killed.
d2713 4
a2716 1
2001-04-18  Love  <lha@@stacken.kth.se>
d2718 14
a2731 5
	* conf/CellServDB: 1.50->1.51: mit cells zone.mit.edu and
	ops.mit.edu have moved From Nickolai Zeldovich <kolya@@MIT.EDU>
	
	* appl/lib/tokens.c: 1.2->1.3: (arlalib_token_iter): return right
	thing, From Nickolai Zeldovich <kolya@@MIT.EDU>
d2733 2
a2734 3
	* appl/bos/bos_listusers.c: 1.6->1.7: (printusers): only print
	user when we are are getting back good data, From Nickolai
	Zeldovich <kolya@@MIT.EDU>
d2736 1
a2736 5
	* arlad/fcache.c: 1.325->1.326: (getacl): fix problem that opaque
	can be uninitialized when returning errors, when caller might do
	stupid things, found by Nickolai Zeldovich <kolya@@MIT.EDU>
	
2001-04-17  Love  <lha@@stacken.kth.se>
d2738 1
a2738 2
	* cf: quote argument to undefine, patch by 
	Hidvegi	<hzoli@@austin.ibm.com>
d2740 1
a2740 1
2001-04-12  Magnus Ahltorp  <ahltorp@@nada.kth.se>
d2742 1
a2742 1
	* configure.in: Compile with -traditional-cpp on Mac OS X
d2744 1
a2744 1
2001-04-05  Magnus Ahltorp  <ahltorp@@nada.kth.se>
d2746 1
a2746 3
	* configure.in, cf/check-kernel.m4,
	xfs/bsd/xfs_syscalls-wrap-macos.c: Make it build on Mac OS X
	release
d2748 1
a2748 1
2001-04-04  Love  <lha@@stacken.kth.se>
d2750 2
a2751 5
	* arlad/fcache.c: 1.324->1.325: (find_first_fs): memset context,
	in case we fail to update the volume, context will contains data
	that free_fs_server_context() will grok.
	
2001-03-25  Love  <lha@@stacken.kth.se>
d2753 1
a2753 2
	* xfs/linux/xfs_dev.c: 1.78->1.79: (xfs_message_rpc): ignore
	SIGSTOP, this make ptrace() work
d2755 2
a2756 1
2001-03-23  Love  <lha@@stacken.kth.se>
d2758 1
a2758 3
	* arlad/fcache.c (get_attr_bulk): if parent entry is missing data,
	bail out and force regular get_attr
	(getvolstat): remove unused code
d2760 1
a2760 1
2001-03-12  Love  <lha@@stacken.kth.se>
d2762 1
a2762 1
	* Release 0.35.3
d2764 1
a2764 7
	* util/heap.c (heap_new): don't fail if malloc(0) return NULL.
	
	* lib/ko/kocell.c: 1.47->1.78: handle cells with zero cells on
	computer with malloc returns NULL on malloc(0).
	
	* arlad/kernel.c: 1.27->1.29: handle case when running out of
	threads better
d2766 1
a2766 1
2001-03-06  Tomas Olsson  <tol@@stacken.kth.se>
d2768 1
a2768 1
	* tests/run-tests.in: 1.70->1.71: don't run compare-inum-mp
d2770 1
a2770 1
2001-03-04  Love  <lha@@stacken.kth.se>
d2772 1
a2772 12
	* xfs/linux/xfs_message.c: make got data w/o token more quiet
	* appl/lib/arlalib.h: 1.37->1.38: fs_checkvolumes
	* appl/lib/fs_lib.c: 1.31->1.32: fs_checkvolumes
	
	* include/afssysdefs.h: solaris 8 uses 65, openbsd uses 208,
	freebsd uses 339
	
	* ydr/output.c: 1.73->1.74: remember to code INOUT argument too
	* rxdef/pts.xg: 1.14->1.15: (ListOwned): over in INOUT
	
	* xfs/bsd/xfs_syscalls-wrap-bsd.c: 1.11->1.12: xfs_syscallent,
	check for HAVE_STRUCT_SYSENT_SY_FLAGS
d2774 1
a2774 1
	* appl/lib/tokens.c: 1.1->1.2: memset token
d2776 1
a2776 11
	* appl/fs/fs*: fs improvements
	
	* lib/ko/agetarg.c: 1.9->1.11 agetarg improvments
	* lib/ko/agetarg.h: 1.4->1.6
	
	* appl/vos/*.c: start to use get_servername()
	* arlad/volcache.c: 1.98->1.100: use volname_*, more gc issues
	
	* lib/ko/ko.h: 1.27->1.28: volname_specific, volname_canonicalize
	* lib/ko/vlmisc.c: 1.3->1.4: volname_specific,
	volname_canonicalize
d2778 1
a2778 4
	* appl/vos/vos_examine.c: 1.17->1.21
	* appl/vos/vos.c: 1.16->1.17: call tzset
	
2001-02-21  Love  <lha@@stacken.kth.se>
d2780 1
a2780 7
	* THANKS: 1.44->1.45: added s/390 contributors
	
	* arlad/arlad.8: 1.7->1.8: mandoc fix
	
	* lwp/{process.s390.S,make-process.o.sh.in,lwp_asm.c,LICENSE.s390}:
	pull up S/390 support from head, contributed by
	<Neale.Ferguson@@SoftwareAG-usa.com> and <adam@@sinenomine.net>
d2782 1
a2782 2
	* arlad/fcache.c: 1.318->1.319: (fcache_update_length): correct
	variable spelling
d2784 1
a2784 1
2001-02-18  Love  <lha@@stacken.kth.se>
d2786 1
a2786 2
	* arlad/fcache.c: 1.317->1.318: (fcache_update_length): remove
	overly paranoid assertion
d2788 1
a2788 1
2001-02-14  Love  <lha@@stacken.kth.se>
d2790 1
a2790 7
	* xfs/solaris/xfs_message.c: 1.27->1.28: xfs_message_installdata
	fix
	* xfs/solaris/bin/startarla.in: 1.3->1.4: only create /dev/xfs0
	symlink if it doesn't exist
	* xfs/solaris/xfs_vfsops.c: 1.18->1.19: turn printf into XFSDEB
	* xfs/solaris/xfs_node.c: 1.15->1.16: Corrected bad function call
	and declaration
d2792 1
a2792 2
	* appl/lib/ka-procs.c: 1.4->1.5: (get_password): fix problem noted
	by John Callaghan <jpc@@msu.edu>
d2794 1
a2794 1
2001-02-13  Assar Westerlund  <assar@@sics.se>
d2796 1
a2796 2
	* arlad/fcache.c 1.316->1.317: (fcache_update_length): rewrite the
	assert:s in a more robust way
d2798 1
a2798 1
2001-02-11  Love  <lha@@stacken.kth.se>
d2800 1
a2800 4
	* arlad/messages.c: 1.235->1.236: remove key when we get a rxkad
	message invalidkey.
	
2001-02-11  Assar Westerlund  <assar@@sics.se>
d2802 1
a2802 11
	* arlad/arladeb.c 1.24->1.25 (arla_vwarnx_with_fid): adapt to new
 	volcache_getname
	* arlad/fcache.c 1.315->1.316 (fcache_store_state): fix arla_warnx
	(getvolstat): use new volcache_getname
	* arlad/volcache.h 1.29->1.30 (volcacheentry): only store one name
	pointer
 	(the canonical name)
	(volcache_getname): update prototype
	* arlad/volcache.c 1.96->1.97: re-structure so that we only keep the
 	canonical name for a volume
	(volcache_getname): copy name out instead of returning it
d2804 1
a2804 5
	* xfs/solaris/xfs_vnodeops.c 1.38->1.39 (xfs_inactive): check the
 	v_count of the node since due to a race condition we can get nodes
 	that shouldn't really be thrown away here
	(xfs_getpage, xfs_putpage): read the cache node from the xfs_node
 	after calling xfs_data_valid
d2806 1
a2806 2
	* arlad/volcache.c: 1.97->1.98: re-do some of the ref-counting
 	logic and make it simpler
d2808 1
a2808 1
2001-02-02  Assar Westerlund  <assar@@sics.se>
d2810 1
a2810 2
	* appl/afsutils/aklog.c: 1.6->1.7: add fallback for
	krb_get_default_principal for krb libraries without it
d2812 1
a2812 1
2001-01-31  Love  <lha@@stacken.kth.se>
d2814 1
a2814 3
	* xfs/bsd/xfs_vnodeops-bsd.c: 1.88->1.89: (xfs_readdir): avoid
	looping when there is a (incorrect) entry with d_reclen==0.
	Patch from: Chris Csanady <ccsanady@@iastate.edu>
d2816 1
a2816 1
2001-01-30  Love  <lha@@stacken.kth.se>
d2818 1
a2818 1
	* Release 0.35.2
d2820 3
a2822 2
	* xfs/linux/xfs_vfsops.c: 1.71->1.72: (xfs_replace_root): update
	xfsf_attr2inode usage
d2824 1
a2824 1
	* conf/CellServDB: 1.49->1.50: biocenter.helsinki.fi
d2826 5
a2830 1
	* Release 0.35.1
d2832 1
a2832 5
	* xfs/*/xfs/xfs_fs.h: (xfs_attr2inode): update signature
	* xfs/*/xfs_node.c: (new_xfs_node): clean node
	(xfs_attr2inode): only clean node if needed
	* xfs/*/xfs_message.c: (xfs_message_installdata): clear node
	(xfs_message_installattr): don't clear node
d2834 1
a2834 1
2001-01-29  Love  <lha@@stacken.kth.se>
d2836 16
a2851 5
	* arlad/bsd-subr.c: 1.55->1.56: make XFS_DIRENT_BLOCKSIZE smaller
	since otherwise linux emulation code under freebsd will lose any
	entries that have it's end past 512 bytes.
	
2001-01-28  Love  <lha@@stacken.kth.se>
d2853 1
a2853 2
	* configure.in: 1.472->1.4.73: Fixed fatal typo in pthreads
	detection
d2855 1
a2855 3
	* xfs/linux/xfs_inodeops.c: 1.150->1.151: (xfs_lookup): fill in
	the whole getnode message inside the look, since xfs_message_rpc()
	might clobber it.
d2857 2
a2858 1
2001-01-25  Love  <lha@@stacken.kth.se>
d2860 1
a2860 1
	* Release 0.35
d2862 5
a2866 6
	* appl/fs/fs.c: 1.94->1.95: fs incompat command
	* appl/lib/fs_lib.c: 1.32->1.33: fs_incompat_renumber
	* appl/lib/arlalib.h: 1.38->1.39: fs_incompat_renumber
	
	* xfs/solaris/bin/startarla.in: 1.2->1.3: solaris 8 afs
	syscallnumber
d2868 1
a2868 5
	* xfs/linux/bin/Makefile.in: 1.21->1.22: s,XFS_BIN,XFS_SBIN,
	
	* arlad/conn.h: 1.24->1.25: new conn_clearcred signature
	* arlad/conn.c: 1.61->1.62: make conn_crearcred take mask
	* arlad/messages.c: 1.234->1.235: use new conn_clearcred
d2870 1
a2870 5
	* xfs/bsd/xfs/xfs_fs.h: 1.18->1.19: clean vattr fix
	* xfs/bsd/xfs_node-bsd.c: 1.47->1.48: clean vattr fix
	* xfs/bsd/xfs_message.c: 1.64->1.65: clean vattr fix
	
2001-01-15  Love  <lha@@stacken.kth.se>
d2872 1
a2872 5
	* include/kafs.h: 1.32->1.34: include/kafs.h: update arla pioctl's
	that are assigned to assigned to arla, added comments for arla
	pioctls
	
	WARNING this break compability with older versions of arla !
d2874 2
a2875 1
2001-01-09  Love  <lha@@stacken.kth.se>
d2877 1
a2877 6
	* lib/ko/agetarg.c: 1.8->1.9: (print_arg): fix formating error in
	help text From Nickolai Zeldovich <kolya@@MIT.EDU>
	
	* arlad/cred.c: 1.33->1.34: (cred_expire): dont try to get
	username since we are chroot()ed From Nickolai Zeldovich
	<kolya@@MIT.ED>
d2879 1
a2879 2
	* appl/vos/vos_partinfo.c: 1.7->1.8: end args with aarg_end, from
	Nickolai Zeldovich <kolya@@MIT.EDU>
d2881 1
a2881 1
2001-01-08  Love  <lha@@stacken.kth.se>
d2883 1
a2883 2
	* appl/kalog/kalog.c (main): use koerr_gettext to print error from
	ka_authenticate
d2885 1
a2885 1
	* lib/ko/koerror.c: ka errors
d2887 1
a2887 4
	* xfs/bsd/bin/umount_xfs.8: simplistic manualpage
	* xfs/bsd/bin/mount_xfs.8: simplistic manualpage
	* xfs/bsd/bin/Makefile.in (MANPAGES): mount_ffs.8, umount_xfs.8
	(install,uninstall): manualpages
d2889 1
a2889 2
	* lib/ko/agetarg.c (agetarg): fixed broken short option mandatory
	handleing
d2891 1
a2891 1
2001-01-07  Love  <lha@@stacken.kth.se>
d2893 1
a2893 7
	* arlad/fcache.c (purge_cred, fcache_get_data): update use of
	install_attr()
	* arlad/messages.c (install_attr): update take a flag field for
	fcacheentry2xfsnode()
	(fcacheentry2xfsnode): update to take a flag field and use it.
	(*): update to new signature of install_attr() and
	fcacheentry2xfsnode()
d2895 1
a2895 3
	* arlad/messages.h (FCACHE2XFSNODE_{ATTR,RIGHT,ALL}): flags for
	fcacheentry2xfsnode()
	(fcacheentry2xfsnode): update to take a flag field
d2897 1
a2897 3
	* rx/rx.c (rxi_CheckCall): return -2 is the call is freed.
	(rxi_ReapConnections): check if rxi_CheckCall returns -2, in that
	case the hash-bucket might have changed and we need to restart.
d2899 1
a2899 1
	* lib/ko/agetarg.c: make mandatory work for real
d2901 3
a2903 8
	* util/log.c (log_open): pass on name to lower open, free name
	
	* appl/lib/Makefile.in: add tokens.c
	* appl/lib/arlalib.c (arlalib_get_cred_afs): get token from kernel
	(arlalib_get_cred_krb): rename from arlalib_get_cred
	(arlalib_getsecurecontext): use arlalib_get_cred_afs()
	* appl/lib/tokens.c (arlalib_token_iter): new func to iterate all
	tokens.
d2905 1
a2905 4
	* xfs/bsd/xfs_dev-common.c (xfs_block_sigset): new function that
	remove signals we want to block from a sigset_t in some diffrent
	ways.
	(xfs_message_rpc): use xfs_block_sigset(); if there is a p_sigctx, use it.
d2907 1
a2907 7
	* xfs/solaris/xfs_vnodeops.c (xfs_map): remove the check that the
	mapping is off the end of the file, solaris vm works that way.
	
	* xfs/linux/xfs_message.c (xfs_invalid_xnode): don't mark
	directories as STALE
	* xfs/bsd/xfs_message.c (xfs_message_invalidnode): don't mark
	directories as STALE
d2909 1
a2909 3
	* rx/rx.c (rxi_FindPeer): init connQueue
	
2001-01-06  Love  <lha@@stacken.kth.se>
d2911 2
a2912 5
	* rx/rx.c (rxi_InsertPeer): change all connection that used the
	original peer that is about to die.
	(rx_NewConnection,rxi_FindConnection): attach this conn to the peer
	(rx_DestroyConnection): when the connection dies, deattach it
	from the peer.
d2914 1
a2914 4
	* rx/rx.h (rx_connection): add a queue_item that attaches this
	connection to its peer.
	
2001-01-06  Simon Josefsson  <jas@@nada.kth.se>
d2916 1
a2916 1
	* conf/CellServDB (extundo.com): add.
d2918 1
a2918 1
2001-01-06  Love  <lha@@stacken.kth.se>
d2920 1
a2920 2
	* appl/fs/fs.c (newcell_cmd): mark cell as mandatory and remove
	check
d2922 1
a2922 1
2001-01-05  Love  <lha@@stacken.kth.se>
d2924 1
a2924 3
	* rx/rx.c (rxi_DecongestionEvent): decrement the refcount after we
	are done, so that the peer doesn't get reclaimed if we block in
	rxi_Start(). From Nickolai Zeldovich <kolya@@mit.edu>.
d2926 1
a2926 12
	* appl/fs/fs.c (afs_listacl): just return if there a access
	failure.  From Nickolai Zeldovich <kolya@@mit.edu>
	
	* arlad/fcache.c (getacl): reset the opaque data structure in case
	we fail, make sure we free data when we fail. 
	From Nickolai Zeldovich <kolya@@mit.edu>
	
	* arlad/fcache.c (get_attr_bulk): pull out the host from the rx
	connection in case we need it later, then we don't need to used
	freed memory.  From Nickolai Zeldovich <kolya@@mit.edu>.
	
2001-01-04  Love  <lha@@stacken.kth.se>
d2928 1
a2928 2
	* lib/ko/agetarg.c (agetarg): check that the mandatory arguments
	are filled in, from Nickolai Zeldovich <kolya@@mit.edu>
d2930 1
a2930 2
	* appl/fs/fs.c (cmds): added "df" from Nickolai Zeldovich
	<kolya@@mit.edu>
d2932 1
a2932 1
2001-01-04  Mattias Amnefelt  <mattiasa@@e.kth.se>
d2934 1
a2934 2
	* appl/pts/pts.c (member_cmd): set conn_context to null before 
	using it.
d2936 1
a2936 1
2001-01-02  Love  <lha@@stacken.kth.se>
d2938 1
a2938 2
	* xfs/bsd/xfs_vnodeops-bsd.c (xfs_getpages): use VOP_GETPAGES()
	for BSDs that doesn't have vnode_pager_generic_getpages().
a2939 8
	* xfs/linux/bin/Makefile.in: install startarla in $prefix/sbin
	
2001-01-01  Assar Westerlund  <assar@@sics.se>

	* xfs/bsd/xfs_syscalls-common.c (fhget_call): always vrelease `vp'
	(fhopen_call): check `vp' first
	(xfs_pioctl_call): handle the weird case of someone sending a filename
	to debug
a2940 1
For older ChangeLog entries see ChangeLog.2000
@


1.1.1.3
log
@Import of arla -current as of Aug 5 2003

ok todd@@ deraadt@@
@
text
@d1 1
a1 1
2003-07-15  Love  <lha@@stacken.kth.se>
d3 1
a3 2
	* nnpfs/bsd/nnpfs_dev-common.c: freebsd5.x needs
	nnpfs_block_sigset too
d5 1
a5 2
	* nnpfs/bsd/nnpfs_dev-common.c: drop support for freebsd 5.0 and
	only support freebsd 5.1
d7 3
a9 1
2003-07-01  Tomas Olsson <tol@@stacken.kth.se>
d11 4
a14 2
	* nnpfs/winnt/src/nnpfs_init.c (nnpfs_initdevice): use nnpfs_fsd_*
	wrappers
d16 6
a21 3
	* nnpfs/winnt/src/nnpfs_vops.c: defined wrappers (nnpfs_fsd_*) for
	all fsd entry points.
	(nnpfs_{handle_stale,data_valid}): some lock handling
d23 4
a26 3
	* nnpfs/winnt/src/nnpfs_node.c
	(nnpfs_{vrele,node_gc_all,close_data_handle,open_file,open_fh}):
	locking
d28 1
a28 2
	* nnpfs/winnt/src/nnpfs_message.c
	(nnpfs_message_{installdata,invalidnode}): lock MainResource
d30 2
a31 4
	* nnpfs/winnt/src/nnpfs_fastio.c (nnpfs_fastio_read): don't print
	buffer contents, use FsRtlE{nter,xit}FileSystem
	(nnpfs_createsec_acq): use FsRtlE{nter,xit}FileSystem
	(nnpfs_lazywrite_{acq,rel}): use node->lazy_writer
d33 6
a38 4
	* nnpfs/winnt/src/nnpfs_dnlc.c (*): more
	FsRtlE{nter,xit}FileSystem usage
	* nnpfs/winnt/src/nnpfs_dev.c (*): more FsRtlE{nter,xit}FileSystem
	usage
d40 7
a46 2
	* nnpfs/winnt/src/nnpfs_dev.c (nnpfs_devctl): renamed to
	nnpfs_fsd_devctl sprinkle some FsRtlE{nter,xit}FileSystem()
d48 1
a48 2
	* nnpfs/winnt/inc/nnpfs_proto.h: added DEFINE_IRP:s for wrappers
	for fsd entry points
d50 3
a52 2
	* nnpfs/winnt/inc/nnpfs_locl.h (nnpfs_node): store lazy writer
	thread
d54 3
a56 1
2003-06-26  Tomas Olsson <tol@@stacken.kth.se>
d58 1
a58 2
        * nnpfs/winnt/src/inc/nnpfs_locl.h 
	use FastMutex to protect zone allocation and nodelist 
d60 1
a60 2
        * nnpfs/winnt/src/nnpfs_{dev,dnlc,init,misc}.c 
	use FastMutex to protect zone allocation and nodelist 
d62 1
a62 3
	* nnpfs/winnt/src/nnpfs_node.c (*): use FastMutexes to protect
	zone allocation and node list
	(nnpfs_open_fh): added
d64 5
a68 2
	* nnpfs/winnt/src/nnpfs_message.c (nnpfs_message_gc_node): set
	STALE and call vgone() for unused nodes
d70 6
a75 3
	* nnpfs/winnt/src/nnpfs_vops.c (nnpfs_get_dummynode): clear
	wake_event
	(nnpfs_readwrite): hold PagingIoResource when paging
d77 1
a77 2
	* nnpfs/winnt/src/nnpfs_fastio.c (nnpfs_fastio_initmap): added
	(*): updated lock handling, use nnpfs_fastio_initmap
d79 3
a81 1
2003-06-12  Love  <lha@@stacken.kth.se>
d83 2
a84 1
	* appl/lib/arlalib.c: add more v4 glue
d86 1
a86 1
	* rxkad/rxkad_locl.h: protect v4 stuff with #ifdef HAVE_KRB4
d88 20
a107 7
	* appl/lib/Makefile.in: add krb5 includes
	
	* include/stds.h: s/HAVE_KERBEROS/KERBEROS/
	
	* appl/lib/appl_locl.h: add <krb5.h>
	
2003-06-11  Love  <lha@@stacken.kth.se>
d109 2
a110 1
	* appl/lib/arlalib.c: add krb5 support, untested
d112 1
a112 4
	* rxkad/rxk_serv.c: avoid warning
	
	* rxkad/rxk_serv.c: make rxkad_NewServerSecurityObject match
	prototype
d114 2
a115 2
	* appl/lib/arlalib.c: change enable to support krb5, now just fill
	in the blanks
d117 2
a118 1
2003-06-10  Love  <lha@@stacken.kth.se>
d120 4
a123 5
	* rxkad/Makefile.am: drop rxk_info.c its a server function
	
	* rx/rx_misc.c: drop osi_{Alloc,Free}, we use macros
	
	* lib/ko/koerror.c: wrap krb4 stuff with HAVE_KRB4
d125 3
a127 1
	* lib/ko/kocell.c: wrap krb4 stuff with krb4
d129 1
a129 14
	* configure.in: add AC_FUNC_KAFS_SETTOKEN_RXKAD
	
	* lib/ko/auth.c: wrap krb4 stuff with krb4, use kafs_settoken_rxkad
	
	* include/netbsd-lkm/Makefile: include <bsd.own.mk>
	
	* include/stds.h: more kerberos4 defines
	
	* appl/lib/arlalib.c: wrap krb4 stuff in HAVE_KRB4
	
	* appl/lib/appl_locl.h: wrap krb4 stuff in HAVE_KRB4
	
	* rxkad/Makefile.am: drop rxkad server end (to be build later as
	rxkad_server)
d131 1
a131 1
	* configure.in: make include k5 stuff in rxkad lib
d133 2
a134 1
	* arlad/arla_local.h: wrap krb4 stuff in HAVE_KRB4
d136 3
a138 14
	* arlad/arla.c: wrap krb4 stuff in HAVE_KRB4
	
	* arlad/Makefile.in: use krb5 cflags too
	
	* arlad/cred.h: use MAXKRB4TICKETLEN
	
	* rxkad/rxkad.h: provide MAXKRB4TICKETLEN
	
	* appl/perf/afsfsperf.c: wrap <krb.h> with HAVE_KRB4
	
	* lib/ko/auth.h: put ifdef HAVE_KRB4 around <krb.h>
	
	* arlad/{arla-cli.c,conn.c,cred.c,cred.h,messages.c}:
	remove depency on CREDENTIALS (and thus krb4) for rxkad
d140 1
a140 1
2003-06-04  Hans Insulander  <hin@@stacken.kth.se>
d142 1
a142 4
	* appl/vos/vos_listvldb.c: Remove \n from warnx()
	* appl/vos/vos.c: Missing \n on printout added
	* appl/afsutils/aklog.1: Spellfix
	* appl/afsutils/klog.c: Spellfix
d144 1
a144 1
2003-06-04  Tomas Olsson  <tol@@stacken.kth.se>
d146 2
a147 1
	* appl/afsutils/aklog.1: speling
d149 1
a149 1
2003-06-02  Love  <lha@@stacken.kth.se>
d151 3
a153 1
	* nnpfs/bsd: s/make_dead_vnode/nnpfs_make_dead_vnode/
d155 1
a155 2
	* nnpfs/bsd/nnpfs_message.c (nnpfs_message_installdata): use
	nnpfs_dnlc_purge instead of cache_purge
d157 2
a158 1
2003-05-21  Love  <lha@@stacken.kth.se>
d160 1
a160 2
	* appl/fs/fs.1: retreived->retrieved, from pjanzen@@openbsd via
	jmc@@openbsd
d162 2
a163 1
2003-05-06  Love  <lha@@stacken.kth.se>
d165 1
a165 3
	* appl/fs/fs_la.c (afs_getacl): a couple of off-by-one string
	bounds in sscanf, from Anil Madhavapeddy <avsm@@cvs.openbsd.org>
	via openbsd.
d167 1
a167 1
2003-04-25  Love  <lha@@stacken.kth.se>
d169 1
a169 7
	* appl/afsutils/unlog.1: remove unused .Ed fixe typos
	from jmc <jmc@@prioris.mini.pw.edu.pl>	
	
	* appl/afsutils/tokens.1: fixed bad .Fl usage, remove unused .El
	from jmc <jmc@@prioris.mini.pw.edu.pl>
	
2003-04-24  Love  <lha@@stacken.kth.se>
d171 1
a171 4
	* appl/lib/arlalib.h: s/managment/management/, from jmc
	<jmc@@prioris.mini.pw.edu.pl>
	* doc/storage.texi: s/managment/management/, from jmc
	<jmc@@prioris.mini.pw.edu.pl>
d173 1
a173 1
2003-04-16  Love  <lha@@stacken.kth.se>
d175 1
a175 4
	* ydr/output.c (cppfilesymbolname): new function, Convert filename
	into a cpp symbol
	(init_generate): use cppfilesymbolname
	(close_generator): ditto
d177 1
a177 1
2003-04-13  Love  <lha@@stacken.kth.se>
d179 1
a179 3
	* appl/pts/pts.c (pr_name2id): don't free memory on error
	
2003-04-10  Love  <lha@@stacken.kth.se>
d181 2
a182 2
	* arlad/messages.c (try_again): treat RXKADBADTICKET, RXKADBADKEY
	as key expired
d184 1
a184 2
	* arlad/volcache.c (get_info_loop): treat RXKADBADTICKET,
	RXKADBADKEY as key expired
d186 1
a186 1
2003-04-09  Love  <lha@@stacken.kth.se>
d188 2
a189 4
	* lib/ko/gensysname.c: s/strcpy/strlcpy/
	* tests/large-dir.c: s/strcpy/strlcpy/
	* rxkad/rxk_crpt.c: s/strcpy/strlcpy/
	* rx/rx_dumptrace.c: s/strcpy/strlcpy/
d191 6
a196 6
	* rx/rx_pkt.c: make osi_Msg sane
	* rx/rx.c: make osi_Msg sane
	* rx/rx_user.c: make osi_Msg sane add rx_vMsg
	* rx/rx_user.h: make osi_Msg sane
	
2003-04-08  Love  <lha@@stacken.kth.se>
d198 2
a199 11
	* arlad/arla_local.h: include <uae.h>
	
	* arlad/arla.c: init uae
	
	* rx/rxperf.c: replace sprint with snprintf
	
	* appl/fs/fs_copyacl.c: replace sprint with snprintf
	
	* appl/vos/vos_backup.c: replace sprint with asprintf
	
2003-04-08  Mattias Amnefelt  <mattiasa@@e.kth.se>
d201 5
a205 3
	* arlad/conn.c (re_probe): only increase ntries until threshold
	value. more readable logic for problelist removal
	(pinger): always schedule re_probe
d207 2
a208 3
	* arlad/arla_local.h: added argument f to assert_not_flag
	* arlad/conn.c (init_fs_context): Set rtt to half of its previous
	value if fileserver unreachable
d210 1
a210 1
2003-04-08  Love  <lha@@stacken.kth.se>
d212 1
a212 11
	* arlad/arla_local.h: include <uae.h>
	
	* arlad/arla.c: init uae
	
	* rx/rxperf.c: replace sprint with snprintf
	
	* appl/fs/fs_copyacl.c: replace sprint with snprintf
	
	* appl/vos/vos_backup.c: replace sprint with asprintf
	
2003-04-08  Mattias Amnefelt  <mattiasa@@e.kth.se>
d214 2
a215 1
	* arlad/fcache.c (unlink_lru_entry): assert_not_flag() on kernelp
d217 1
a217 1
2003-04-03  Love  <lha@@stacken.kth.se>
d219 2
a220 1
	* include/afssysdefs.h: freebsd 4 uses 210 freebsd 5 uses 339
d222 1
a222 2
	* configure.in: no longer change for chflags and lchflags, it was
	themis that needed it
d224 1
a224 1
2003-04-01  Love  <lha@@stacken.kth.se>
d226 1
a226 2
	* appl/afsutils/Makefile.in: avoid building klog when that we are
	not install it
d228 2
a229 1
	* rx/rxdebug.1: spelling, from jmc <jmc@@prioris.mini.pw.edu.pl>
d231 1
a231 2
	* appl/kalog/kalog.1: spelling, from jmc
	<jmc@@prioris.mini.pw.edu.pl>
d233 1
a233 2
	* appl/bos/bos.8: spelling, from jmc
	<jmc@@prioris.mini.pw.edu.pl>
d235 2
a236 2
	* arlad/{DynRootDB,arla.conf,ThisCell}.5arla-cli.8: spelling, from
	jmc <jmc@@prioris.mini.pw.edu.pl>
d238 1
a238 2
	* nnpfs/bsd/nnpfs_dev-bsd.c (nnpfs_dev): handle newer freebsd,
	from Mattias Amnefelt <mattiasa@@e.kth.se>
d240 4
a243 3
	* configure.in: check for d_psize and d_kqfilter
	
2003-03-17  Love  <lha@@stacken.kth.se>
d245 1
a245 3
	* lib/ko/koerror.c: s/Invaild/Invalid/
	
2003-03-13  Love  <lha@@stacken.kth.se>
d247 1
a247 1
	* util/log.c: log in LOG_NOTICE since LOG_INFO might get lost
d249 1
a249 1
2003-03-10  Love  <lha@@stacken.kth.se>
d251 2
a252 6
	* appl/afstool/at_fs_flush_cps.c: fix usage usage info
	
	* lib/ko/uae.h: remove dup
	
	* nnpfs/linux/nnpfs_load.c (init_module): do devfs_register_chrdev
	also when using a chardev, pointed out by Per Olofsson.
d254 1
a254 1
2003-03-09  Love  <lha@@stacken.kth.se>
d256 1
a256 4
	* configure.in: pull in arla_OPENSSL_COMPAT, add the -I to
	netbsd-lkm dir after the system KERNEL_CPPFLAGS
	
2003-03-08  Love  <lha@@stacken.kth.se>
d258 1
a258 10
	* appl/vos/vos_status.c: fix bad lp64 broken typecasts, make
	strftime buffer 128bytes
	* lib/ko/kocell.c: make strftime buffer 128 bytes
	* appl/afstool/at_fs_gettime.c: make strftime buffer 128 bytes
	* appl/afstool/at_u_debug.c: make strftime buffer 128 bytes
	
	* appl/vos/vos_examine.c: make strftime buffer 128 bytes
	* appl/vos/vos_status.c (printstatus): fix formating
	
2003-03-07  Love  <lha@@stacken.kth.se>
d260 1
a260 7
	* lib/ko/uae.c: add all missing errorcodes
	
	* lib/ko/uae.h: add UAE_ERROR_base remove dup
	
	* lib/ko/uae.h: add more error codes from derrick
	
2003-03-06  Love  <lha@@stacken.kth.se>
d262 1
a262 9
	* rxdef/common.h: add Capabilities
	
	* HACKING: automake appl/udebug/Makefile
	
	* include/Makefile.in: add uae.h
	
	* appl/afstool/at_fs_getcap.c: print string name of caps
	
	* appl/afstool: add support for RXAFS_GetCapabilities
d264 1
a264 3
	* rxdef/fs.xg: add GetCapabilities
	
	* appl/udebug: replace udebug with a shellscript that call afstool
d266 1
a266 6
	* NEWS: UAE
	
	* arlad/fs_errors.h: do uae translation
	
	* arlad/cmcb.c (SRXAFSCB_TellMeAboutYourself): tell server we
	support UAE
d268 1
a268 7
	* lib/ko/uae.c: comment how this should work
	
	* appl/perf/Makefile.in: adapt for uae
	
	* appl/afstool/Makefile.am: adapt for uae
	
	* lib/ko: Add infrastructure for 'Unified AFS errnos' (uae)
d270 1
a270 1
2003-03-05  Love  <lha@@stacken.kth.se>
d272 1
a272 4
	* appl/afstool: use getarg style --no-auth like the rest for the
	arguments, fix auth
	
	* appl/afstool: add ubik debug
d274 7
a280 4
	* appl/afstool/afstool.1: fs gettime
	
	* appl/afstool/at_locl.h: add mini_cachemanager_init and
	fs_gettime_cmd
d282 1
a282 2
	* appl/afstool/Makefile.am: add mini cm, gettime and link with
	librxcbserver
d284 1
a284 8
	* appl/afstool/at_fileserver.c: plug in gettime
	
	* appl/afstool/at_fs_gettime.c: fetch time from fileserver
	
	* appl/afstool/at_mini_cm.c: add yet another mini cache-manager
	
	* rx/rx_user.h (rxi_GetUDPSocket): return the portnumber we bound to
	* rx/rx_user.c (rxi_GetUDPSocket): return the portnumber we bound to
d286 1
a286 10
	* rx/rx.c: find out the portnumber we bound too
	
	* appl/afstool/afstool.c (main) call rx_Init(0)
	
	* arlad/cmcb.c: prefix callback manager stubs with S
	
	* ydr/output.c (generate_server_stub): prefix server stubs with S
	
	* ydr/output.c: move the server parsing stubs into private
	namespace and make them static
d288 4
a291 1
	* appl/afstool/at_fs_flush_cps.c: remove stale comment
d293 1
a293 2
	* appl/afstool/at_cm_{localcell,whoareyou}.c: make use of for loop
	to make it look like other code in same directory
d295 4
a298 2
	* appl/afstool/afstool.c: add aliases for fileserver (fs) and
	cachemanager (cm)
d300 1
a300 2
	* appl/perf/afsfsperf.c: add dummy for GetCellByNum and
	TellMeAboutYourself
d302 12
a313 10
	* arlad/cmcb.c: add dummy for GetCellByNum and implement
	TellMeAboutYourself
	
	* rxdef/cb.xg: add GetCellByNum and TellMeAboutYourself
	
	* appl/afstool/Makefile.am: install manpage
	
	* appl/afstool/at_cm_localcell.c: getarg-ify, make more sane
	* appl/afstool/at_cm_whoareyou.c: getarg-ify, make more sane
	* appl/afstool/afstool.1: getarg-ify, make more sane
d315 1
a315 3
	* appl/afstool/afstool.1: mdoc fixes
	
2003-03-04  Love  <lha@@stacken.kth.se>
d317 3
a319 3
	* arlad/poller.c (poller_foreach): new function
	
	* appl/afstool/afstool.1: manpage for afstool
d321 1
a321 3
	* configure.in: remove cbdebug
	
	* appl/afstool: fold in cbdebug
d323 6
a328 11
	* appl/cbdebug: remove cbdebug, move to afstool
	
	* appl/afstool/at_locl.h: add some more headers
	
	* appl/perf/Makefile.in: link agaist the new cb lib
	
	* arlad/Makefile.in: link agaist the new cb lib
	
	* rxdef/Makefile.in: split callback stubs to their own libs
	
	* configure.in (AC_OUTPUT): add appl/afstool/Makefile
d330 1
a330 3
	* HACKING: add appl/afstool/Makefile
	
	* appl/afstool: afstool
d332 6
a337 1
	* arlad/fcache.c: improve logging when giving back callbacks
d339 3
a341 2
	* appl/fs/fs_connect.c: add callback-connected, connect and
	refetch callback we had before
d343 1
a343 10
	* arlad/poller.c: add poller_foreach and poller_iter_func
	
	* arlad/poller.h: add poller_foreach and poller_iter_func
	
	* arlad/fcache.c (fcache_giveup_all_callbacks): first try poller +
	giveup_all_callbacks
	(giveup_all_callbacks): give up all callback with new rpc function
	RXAFS_GiveUpAllCallBacks.
	(throw_entry): conn can never be NULL, check for aliveness instead
	(fcache_reobtain_callbacks): conn can never be NULL
d345 1
a345 4
	* rxdef/fs.xg: add GiveUpAllCallBacks, and FlushCPS add commented
	out versions of 64 bit fetch/store data
	
2003-03-03  Love  <lha@@stacken.kth.se>
d347 1
a347 4
	* arlad/messages.c (nnpfs_message_getdata): make comptible with
	open and set the DATA_W if requested.
	
2003-02-28  Tomas Olsson  <tol@@stacken.kth.se>
d349 1
a349 1
	* nnpfs/linux/nnpfs_inodeops.c (nnpfs_file_mmap): don't iref
d351 1
a351 1
2003-02-28  Love  <lha@@stacken.kth.se>
d353 1
a353 3
	* tests/run-tests.in: add mmap-and-fork
	
	* tests/mmap-and-fork.c: mmap and fork test
d355 1
a355 2
	* nnpfs/bsd/nnpfs_node-bsd.c (nnpfs_dnlc_enter): use
	nnpfs_vfs_unlock instead of VOP_UNLOCK
d357 2
a358 1
2003-02-26  Love  <lha@@stacken.kth.se>
d360 1
a360 2
	* nnpfs/bsd/nnpfs_node-bsd.c: OpenBSD 3.3 will have NetBSD 1.5
	dnlc semantics
d362 4
a365 1
2003-02-24  Tomas Olsson  <tol@@stacken.kth.se>
d367 1
a367 2
	* nnpfs/linux/nnpfs_message.c (clear_all_children): don't throw
	negative dentries, and it's the children we drop
d369 2
a370 1
2003-02-24  Mattias Amnefelt  <mattiasa@@e.kth.se>
d372 1
a372 2
	* nnpfs/linux/nnpfs_inodeops.c: nnpfs_d_revalidate: always return
	true if root node
d374 5
a378 1
2003-02-22  Love  <lha@@stacken.kth.se>
d380 2
a381 1
	* Add support for netbsd 1.6O
d383 1
a383 3
	* configure.in: fix openbsd makefile probing
	
2003-02-21  Tomas Olsson  <tol@@stacken.kth.se>
d385 6
a390 2
	* nnpfs/linux/nnpfs_message.c (clear_all_children): drop negative
	dentries
d392 1
a392 2
	* arlad/messages.c (*): send messages to kernel before
	fcache_release()
d394 1
a394 1
2003-02-18  Tomas Olsson  <tol@@stacken.kth.se>
d396 4
a399 5
	* nnpfs/linux/nnpfs_message.c (nnpfs_d_remove): added
	(nnpfs_message_installnode): handle new inode != existing better
	(clear_all_children): use dcache_lock, don't use xdentry if null,
	use nnpfs_d_remove()
	(d_prune_aliases): use nnpfs_d_remove()
d401 1
a401 1
2003-02-17  Love  <lha@@stacken.kth.se>
d403 3
a405 3
	* configure.in: decrease world pain by setting AM_MAINTAINER_MODE,
	now Makefile.in isn't rebuilt when Makefile.am have a newer
	timestamp
d407 5
a411 1
2003-02-16  Tomas Olsson  <tol@@stacken.kth.se>
d413 6
a418 1
	* nnpfs/linux/nnpfs_message.c: make it compile
d420 1
a420 1
2003-02-16  Love  <lha@@stacken.kth.se>
d422 5
a426 3
	* nnpfs/linux/nnpfs_message.c (clear_all_children): throw way
	unused nodes more aggressively (that is, remove then, don't just
	unhash them)
d428 1
a428 1
2003-02-15  Love  <lha@@stacken.kth.se>
d430 2
a431 2
	* nnpfs/linux/nnpfs/nnpfs_locl.h: define I_DIRTY_DATASYNC to 0 if
	it isn't there
d433 1
a433 2
	* nnpfs/bsd/nnpfs_vnodeops-bsd.c: even more extensive casting to
	print lk_lockholder
d435 1
a435 14
	* nnpfs/bsd/nnpfs/nnpfs_locl.h: include <sys/inttypes.h> try to
	define nnpfs_uintptr_t
	
	* configure.in: check for uintptr_t
	
	* appl/lib/ka-procs.c: remove som more memsets
	
	* tests/run-tests.in (ARLA_TESTS): add kill-mh
	
	* tests/kill-mh: unpacking and removing the "right" files in the
	test tar-ball that will trigger a bug in the directory removing
	code if it doesn't that care and consider directory page
	(DIRBLKSIZ) bounderies correctly, bug report and tarfile came from
	Nickolai Zeldovich <kolya@@MIT.EDU>
d437 1
a437 3
	* arlad/bsd-subr.c (dir_remove_name): make sure the d_reclen is
	too large so it will cross a page boundary, found by
	kolya@@mit.edu.
d439 7
a445 1
2003-02-14  Love  <lha@@stacken.kth.se>
d447 1
a447 2
	* appl/lib/ka-procs.c: make compile with new openssl >= 0.9.7,
	ignore type of key schedule
d449 2
a450 3
	* nnpfs/bsd/nnpfs_vnodeops-bsd.c: freebsd current make
	lk_lockholder to the thread (or so my spies say), so just cast to
	long long and print with %llx
d452 2
a453 4
	* nnpfs/bsd/nnpfs/nnpfs_locl.h: malloc(9) waits by default,
	freebsd post 5.0 choose to remove the flag, provide glue
	
	* */*: add copyright notice
d455 1
a455 1
2003-02-14  Tomas Olsson  <tol@@stacken.kth.se>
d457 3
a459 2
	* tests/asu.c (is_pag): getgroups() might not include egid in
	groups list
d461 1
a461 1
	* tests/build-emacs-j: bsd make wants an arg after -j, use 4
d463 2
a464 1
	* nnpfs/linux/Makefile.in: don't build getcwd on ia64
d466 1
a466 1
	* configure.in: added AM_CONDITIONAL for LINUX_IA64
d468 3
a470 1
2003-02-13  Fallsjo <fallsjo@@stacken.kth.se>
d472 1
a472 8
	* .cvsignore: Honor new name of autom4te cache

2003-02-12  Love  <lha@@stacken.kth.se>

	* arlad/arlad.8: rxkad-level, default is crypt
	* arlad/arla.c (rxkad_level_string): default to crypt
	
2003-02-11  Love  <lha@@stacken.kth.se>
d474 2
a475 2
	* nnpfs/linux/nnpfs_vfsops.c (nnpfs_statfs): bump values some to
	make it more pretty from Harald Barth <haba@@pdc.kth.se>
d477 4
a480 6
	* arlad/cred.c (cred_add): use cred_delete instead of
	recycle_entry, so when the entry is still in use we don't stomp
	all over it
	
	also, sprinkel asserts all over the place to make sure we don't
	use root node or reuse nodes that still have refcount
d482 2
a483 1
2003-02-11  Tomas Olsson  <tol@@stacken.kth.se>
d485 1
a485 1
	* arlad/messages.c (nnpfs_message_getdata): set datausedp in entry
d487 4
a490 1
	* appl/perf/Makefile.in: move up arlautil before roken in LIBS
d492 2
a493 1
2003-02-10  Love  <lha@@stacken.kth.se>
d495 1
a495 3
	* lib/ko/afs_uuid.c: when we use a randomized uuid, set the
	multicast bit to make sure we don't collied witha a real
	(allocated) address.
d497 3
a499 1
2003-02-10  Tomas Olsson  <tol@@stacken.kth.se>
d501 1
a501 2
	* nnpfs/linux/nnpfs_syscalls.c: declare sys_call_table as its
	actual type
d503 1
a503 2
	* nnpfs/linux/nnpfs_syscalls-lossage.c: don't check for
	sys_call_table
d505 1
a505 1
	* nnpfs/linux/nnpfs/nnpfs_syscalls.h: check for sys_call_table
d507 1
a507 1
	* appl/perf/Makefile.in: move up LIB_roken in LIBS
d509 1
a509 1
	* lib/Makefile.am: build editline before sl
d511 3
a513 1
2003-02-08  Love  <lha@@stacken.kth.se>
d515 1
a515 1
	* tests/run-tests.in: add read-past-eof
d517 6
a522 6
	* tests/Makefile.in: add read-past-eof
	
	* tests/read-past-eof.c: test for read past end of file
	
	* nnpfs/bsd/nnpfs_vnodeops-netbsd.c (nnpfs_netbsd_read): don't
	premit reading past end of file (found with mozilla)
d524 1
a524 1
2003-02-07  Love  <lha@@stacken.kth.se>
d526 10
a535 9
	* arlad/messages.c: replace assert_kernelp with assert_flag
	
	* arlad/fcache.c: replace assert_kernelp with assert_flag
	
	* arlad/arla_local.h: replace assert_kernelp with assert_flag
	
	* nnpfs/linux/nnpfs_syscalls.c: use [] for now on sys_call_table
	
2003-02-04  Love  <lha@@stacken.kth.se>
d537 1
a537 2
	* configure.in (netbsd,openbsd): we really want -f flags too when
	building lkms
d539 2
a540 6
	* lib/bufdir/fdir.c: trust length of directory file more then the
	data in the top of the file, this is slightly broken because what
	really happen was that we just removed a entry, and then shrinked
	the file because it was the last entry (and thus decremented the
	page-count), refetched the length from the fileserver and then
	expected the pagecount == size / AFSPAGESIZE
d542 1
a542 3
	* nnpfs/bsd/nnpfs_wrap-bsd.c (nnpfs_uninstall): detach malloc
	types when we are all done not completly right, but better then
	before
d544 1
a544 2
	* nnpfs/bsd/nnpfs_wrap-bsd.c: move malloc_type_detach from
	nnpfs_stat to nnpfs_uninstall
d546 1
a546 1
2003-02-03  Love  <lha@@stacken.kth.se>
d548 1
a548 2
	* nnpfs/linux/nnpfs_syscalls.c:
	s/sys_call_function/nnpfs_sys_call_function/g
d550 1
a550 2
	* nnpfs/bsd/nnpfs_wrap-bsd.c: attach/detach malloc types when
	loading module
d552 5
a556 2
	* nnpfs/bsd/nnpfs/nnpfs_locl.h: type argument to malloc is
	malloc_type in netbsd 1.6N
d558 2
a559 1
2003-02-03  Tomas Olsson  <tol@@stacken.kth.se>
d561 3
a563 2
	* nnpfs/linux/nnpfs_syscalls-lossage.c: make it compile, ifdef,
	define
d565 2
a566 2
	* nnpfs/linux/nnpfs_syscalls.c (install_afs_syscall): call
	nnpfs_fixup_syscall_lossage()
d568 1
a568 2
	* nnpfs/linux/nnpfs/nnpfs_locl.h: added
	nnpfs_fixup_syscall_lossage
d570 1
a570 1
	* nnpfs/linux/Makefile.in: build nnpfs_syscalls-lossage.c
d572 4
a575 1
2003-02-02  Love  <lha@@stacken.kth.se>
d577 1
a577 2
	* nnpfs/linux/nnpfs_node.c (nnpfs_iget): use get_empty_inode for
	linux22
d579 2
a580 2
	* nnpfs/linux/nnpfs_message.c (nnpfs_message_installdata): only
	whine when there is a real failure to do a fh_to_dentry
d582 2
a583 2
	* nnpfs/linux/nnpfs_node.c (nnpfs_iget): use new_inode (and
	unlock_new_inode in case we have I_NEW)
d585 3
a587 1
2003-02-01  Love  <lha@@stacken.kth.se>
d589 1
a589 10
	* doc/themis.texi: drop themis, live a life of its own now
	
	* doc/oddities.texi: s/Themis/Arla timeline/
	
	* doc/timeline.texi: s/Themis/Oddities/
	
	* doc/arla.texi: drop @@include themis.texi
	
	* appl/lib/tokens.c: don't bail out if cell == NULL, then we want
	all cells
d591 1
a591 4
	* rx/Makefile.in: help libtool find libko
	
	* nnpfs/linux/nnpfs/nnpfs_locl.h: add typedef for
	nnpfs_sys_call_function
d593 1
a593 3
	* nnpfs/linux/nnpfs_syscalls-lossage.c: for you to make compile
	and work and start to use ok'ed to put in copyrighted to KTH by
	Chaskiel when I asked him
d595 2
a596 1
2003-01-28  Love  <lha@@stacken.kth.se>
d598 2
a599 2
	* appl/fs/fs_listquota.c: more spaceing, 8 number for printing
	used space it not enougth
d601 2
a602 3
	* tests/write-and-stat: test that detects if dncl is there, or if
	we just live on tbl (really detects another bug, but this is fine
	for now)
d604 1
a604 2
	* nnpfs/bsd/nnpfs_node-bsd.c (nnpfs_cnp_init): if we have a
	namei_hash, use it
d606 4
a609 3
	* nnpfs/bsd/nnpfs_vnodeops-netbsd.c: fix printing of b_blkno
	
2003-01-27  Love  <lha@@stacken.kth.se>
d611 1
a611 2
	* appl/perf/afsfsperf.c: make the tests table drivern, now you can
	write afsfsperf ... -tests get-time,bulk-status
d613 1
a613 1
	* tests/check-sysname: remove set -x
d615 30
a644 6
	* tests/run-tests.in: ARLA_TESTS: add check-sysname
	
	* tests/check-sysname: check if sysname seems to work
	
	* arlad/messages.c (nnpfs_message_getnode): replace #if 0 assert
	with assert_kernelp()
d646 1
a646 11
	* nnpfs/bsd/nnpfs_vnodeops-common.c (nnpfs_attr_valid): fix logic,
	request node from userland when we don't have one of requested
	token or don't have the pag in the pag cache.
	
	* nnpfs/bsd/nnpfs/nnpfs_locl.h: help SCARG-less freebsd some more
	
	* appl/perf/afsfsperf.c: add bulkstatus perf testing
	
	* rxdef/Makefile.in: add depenecy on common.h where needed
	
2003-01-25  Love  <lha@@stacken.kth.se>
d648 3
a650 2
	* arlad/fcache.c (resolve_mp): use fcache_verify_data instead of
	fcache_get_data
d652 1
a652 4
	* nnpfs/bsd/nnpfs_message.c (nnpfs_message_updatefid): use new
	function nnpfs_update_handle, now that there are a fid hash
	instead of a list, we can't just update the handle in the
	nnpfs_node.
d654 4
a657 1
	* nnpfs/bsd/nnpfs_node.c: add nnpfs_update_handle
d659 4
a662 1
	* nnpfs/bsd/nnpfs/nnpfs_node.h: add nnpfs_update_handle
d664 10
a673 2
	* arlad/messages.c (nnpfs_message_getdata): use entry->fid as fid
	since it might have changed because of resolved mp's
d675 1
a675 1
2003-01-24  Tomas Olsson  <tol@@stacken.kth.se>
d677 2
a678 1
	* tests/intr-read.c: wait on killed children
d680 1
a680 1
	* lwp/plwp.c (*): indent, clean up debugging
d682 1
a682 1
2003-01-24  Love  <lha@@stacken.kth.se>
d684 1
a684 2
	* tests/intr-read.c: add comment why we kill children, "they smell
	bad" :)
d686 9
a694 3
	* tests/intr-read.c: kill children when parents is done
	
	* appl/fs/fs_diskfree.c: from dup printf, from Nickolai Zeldovich
d696 1
a696 1
2003-01-23  Tomas Olsson  <tol@@stacken.kth.se>
d698 2
a699 2
	* lib/bufdir/fbuf.c (mmap_copyrx2fd): adjust mapped length to
	pagesize
d701 1
a701 1
2003-01-23  Love  <lha@@stacken.kth.se>
d703 3
a705 4
	* lib/bufdir/fbuf.c (mmap_copy{rx2fd,fd2rx}): make these handle
	off/len that are not a multiple of the pagesize.
	
2003-01-22  Love  <lha@@stacken.kth.se>
d707 1
a707 4
	* nnpfs/bsd/nnpfs_dev-common.c (nnpfs_block_sigset): make the
	three diffrent cases define a macro that later code can use, this
	to make it easier to block new signals, and while I'm here, ignore
	SIGINFO
d709 1
a709 1
2003-01-21  Mattias Amnefelt  <mattiasa@@e.kth.se>
d711 7
a717 4
	* appl/Makefile.in: don't build themis and mpp
	* configure.in: don't build themis and mpp
	* util/.cvsignore: ignore Makefile.in
	* appl/themis appl/mpp: removed, they are now in their own repos
d719 1
a719 1
2003-01-20  Love  <lha@@stacken.kth.se>
d721 1
a721 2
	* arlad/fcache.c (dynroot_update_entry): no more spare, change to
	update fields
d723 1
a723 2
	* arlad/dynroot.c (dynroot_update_entry): no more spare, change to
	real version
d725 3
a727 1
	* ydr/Makefile.am: ydr_SOURCES: add header files
d729 2
a730 1
	* ydr/Makefile.am: CLEANFILES = lex.c parse.c parse.h
d732 2
a733 1
	* ydr/Makefile.am: YFLAGS= -d
d735 2
a736 2
	* rxdef/common.h: make the last for elements match the rest of the
	code
d738 13
a750 2
	* rxdef/common.h: drop all long/short/unsigned stuff and replace
	all by c99 types
d752 4
a755 2
	* rxdef/common.h (AFSFetchStatus): fill in the now no longer spare
	bits of FetchStatus
d757 1
a757 1
	* lib/Makefile.am: add libvers
d759 1
a759 1
	* rxdef/Makefile.in: add EXEEXT to ydr
d761 3
a763 1
	* ydr: automakeify
d765 2
a766 4
	* ydr: 64 bits encodeing/decodeing support (require presence of
	htole64/le64toh) verified same output with:
	perl -pi -e 's/sizeof\(tmp\)/sizeof\(int32_t\)/g' *.[ch]
	for a in *.[ch] ; do diff -uw $a old/$a ; done
d768 1
a768 4
	* lib/ko/kocell.c (cell_getthiscell): if the cell is unconfigured,
	return "unknown-cell-missing-configuration"
	
2003-01-19  Love  <lha@@stacken.kth.se>
d770 2
a771 2
	* nnpfs/bsd/nnpfs_syscalls-common.c (*): use syscall_d_thread_t,
	syscall_thread_to_thread
d773 1
a773 4
	* nnpfs/bsd/nnpfs/nnpfs_syscalls.h (*): use syscall_d_thread_t
	
	* nnpfs/bsd/nnpfs_syscalls-wrap-bsd.c (sys_lkmnosys): use
	syscall_d_thread_t
d775 7
a781 4
	* nnpfs/bsd/nnpfs/nnpfs_locl.h: add yet another glue type
	syscall_d_thread_t, this is the process/thread argument that
	syscall are called with, add a syscall_thread_to_thread macro that
	converts from a syscall_d_thread_t to a d_thread_t
d783 2
a784 2
	* nnpfs/bsd/nnpfs_dev-common.c (nnpfs_cursig): in netbsd 1.6M
	CURSIG takes a struct lwp disable this for now
d786 1
a786 3
	* nnpfs/bsd/nnpfs_dev-bsd.c, nnpfs/bsd/nnpfs_dev-common.c
	nnpfs/bsd/nnpfs_dev-osf.c, nnpfs/bsd/nnpfs/nnpfs_dev.h:
	nnpfs_devopen_common dont need struct proc, remove it
d788 2
a789 3
	* appl/cbdebug/cbdebug.h: update to changed signature of cbgetconn()
	* appl/cbdebug/localcell.c: ditto
	* appl/cbdebug/whoareyou.c: ditto
d791 1
a791 3
	* appl/cbdebug/cbdebug.c (cbgetconn): make it possible for
	cbgetconn to return hostname if not passed in.
	(*): change to use afscallbackport
d793 2
a794 11
	* rx/Makefile.in: fix rx_trace that I manage to break
	
	* rx/rx.c: s/long/int32_t/;s/short/int16_t/ where apropriate
	* rx/rx.h: s/long/int32_t/;s/short/int16_t/ where apropriate
	* rx/rx_misc.c: s/long/int32_t/;s/short/int16_t/ where apropriate
	* rx/rx_misc.h: s/long/int32_t/;s/short/int16_t/ where apropriate
	* rx/rx_globs.h: s/long/int32_t/;s/short/int16_t/ where apropriate
	* rx/rx_pkt.c: s/long/int32_t/;s/short/int16_t/ where apropriate
	* rx/rx_pkt.h: s/long/int32_t/;s/short/int16_t/ where apropriate
	* rx/rx_user.c: s/long/int32_t/;s/short/int16_t/ where apropriate
	* rx/rx_rxdebug.c: s/long/int32_t/;s/short/int16_t/ where apropriate
d796 1
a796 7
	* rx/rx_multi.h: remove register, s/long/int32_t/ where aproporate
	
	* rx/rx_kern.h: remove register
	* rx/rx_event.h: remove register
	* rx/rx_event.c: remove register
	
2003-01-18  Love  <lha@@stacken.kth.se>
d798 11
a808 5
	* arlad/SuidCells.5: improve
	
	* arlad/DynRootDB.5: improve
	
2003-01-17  Love  <lha@@stacken.kth.se>
d810 5
a814 2
	* appl/udebug/udebug.c: print version with print_version()
	(and cleanup usage string)
d816 2
a817 3
	* appl/kalog/kalog.c: print version with print_version()
	
	* appl/cbdebug/cbdebug.c: print version with print_version()
d819 1
a819 11
	* appl/cbdebug/Makefile.in: add libvers
	
	* appl/amon/amon.c: print version with print_version()
	
	* appl/pts/pts.c: use arlalib_version_cmd for version
	
	* appl/fs/fs.c: use arlalib_version_cmd for version
	
	* appl/lib/arlalib.h: add arlalib_version_cmd
	
	* appl/fs/Makefile.in: add libvers
d821 2
a822 15
	* appl/fs/fs.c: print version with print_version()
	
	* appl/lib/arlalib.h: drop fslib_version
	
	* appl/lib/fs_lib.c: drop fslib_version
	
	* arlad/arla-cli.c: print version with print_version()
	
	* arlad/arlad.c: print version with print_version()
	
	* appl/perf/afsfsperf.c: print version now and then
	
	* configure.in: AC_OUTPUT: add lib/vers/Makefile
	
	* lib/vers: add from heimdal/kth-krb
d824 1
a824 1
2003-01-15  Love  <lha@@stacken.kth.se>
d826 3
a828 5
	* nnpfs/bsd/nnpfs/nnpfs_locl.h: add missing #endif
	
	* lib/ko/Makefile.am: split CPPFLAGS to target_CFLAGS
	
2003-01-14  Tomas Olsson  <tol@@stacken.kth.se>
d830 1
a830 2
	* arlad/messages.c (nnpfs_message_getdata): OR new flags into
	msg.flags
d832 4
a835 1
2003-01-14  Love  <lha@@stacken.kth.se>
d837 3
a839 3
	* arlad/fcache.c (read_data, write_data): be more careful how
	updating of ->length and usedbytes is done to make sure its
	correct
d841 5
a845 2
	* nnpfs/bsd/nnpfs/nnpfs_locl.h: freebsd removed SCARG in 5.0RC3
	and later
d847 1
a847 3
	* lib/ko/Makefile.am: s/SYSCONFDIR/sysconfdir/
	
2003-01-13  Love  <lha@@stacken.kth.se>
d849 3
a851 1
	* HACKING: spell
d853 1
a853 1
2003-01-11  Love  <lha@@stacken.kth.se>
d855 2
a856 1
	* rxkad: change from old afs int32/u_int32 to iso c99 int32_t/uint32_t
d858 3
a860 1
	* includes/stds.h: drop compat glue for rxkad
d862 1
a862 1
	* util: drop copy_dirname/copy_basename
d864 8
a871 1
	* arlad/arla-cli.c: inline copy_dirname/copy_basename
d873 5
a877 2
	* appl/lib/arlalib.c: (arlalib_get_cred_krb): rewrite the code
	that fetches the server key to be simpler
d879 5
a883 1
	* HACKING: more automake
d885 5
a889 1
	* **/Makefile.in: use libtool library for libarlautil and libko
d891 1
a891 2
	* lib/ko/gensysname.c: change to use getarg (instead of agetarg)
	to drop circular dependcy for libtool
d893 6
a898 1
	* conf/Makefile.in: (arla.conf): depend on the right file
d900 2
a901 1
	* appl/afsutils/klog.c: fix (stupid) warning with cast
d903 1
a903 1
	* appl/aafs-perl/Makefile.in: fix building
d905 2
a906 1
	* util/heap.c: (heap_remove): compare dummy with the right thing
d908 6
a913 1
	* lib/Makefile, lib/ko/Makefile: generate with automake
d915 2
a916 1
	* README: update to reality
d918 1
a918 1
2003-01-10  Tomas Olsson  <tol@@stacken.kth.se>
d920 7
a926 1
	* arlad/arla.conf.5: spelling, clarify, explain fake_stat
d928 3
a930 1
	* arlad/{kernel,fcache,messages}.c: indent
d932 3
a934 1
2003-01-10  Love  <lha@@stacken.kth.se>
d936 1
a936 1
	* HACKING: add util/Makefile as a automake file
d938 1
a938 1
	* util/Makefile.am: automakeify
d940 6
a945 1
	* util/*.h: unify header protection and make it arlalib specific
d947 7
a953 1
	* arlad/fcache.h (FCacheEntry): remove datap
d955 4
a958 3
	* arlad/{fcache.c,inter.c,dynroot.c,unknown-subr.c}:
	remove all references to datap, instead use '->length',
	'->fetch_data', or just remove the paranoid assert.
d960 1
a960 2
	the state log doesn't change (value still stored), its just
	ignored when reading back the state
d962 10
a971 1
	* arlad/poller.c: some poller log statments
d973 1
a973 1
2003-01-09  Love  <lha@@stacken.kth.se>
d975 1
a975 2
	* nnpfs/bsd/nnpfs: (nnpfs_message_installdata): pass
	NNPFS_LOCKLEAF to namei
d977 1
a977 2
	* nnpfs/bsd/nnpfs/nnpfs_locl.h: provide glue for namei flag
	LOCKLEAF
d979 2
a980 2
	* arlad/messages.c (nnpfs_message_{open,getdata}): set msg.flag
	correctly
d982 8
a989 1
	* includes/kafs.h: add AFSCOMMONIOC_GKK5SETTOK (in arla space for now)
d991 3
a993 1
	* arlad/cred.h: add prototype for rxgk cred handling
d995 3
a997 3
	* arlad/messages.c: add prototype for rxgk cred handling

	* arlad/inter.h: new signature of cm_open
d999 1
a999 6
	* arlad/inter.c (cm_open): simplify, let other do the hard work
	
	* arlad/messages.c: Split message_getdata and message_open for
	now. They are quite simular, but I want to see the diffrences
	between them. Also, this fixes inc-open (again) since I broke it
	before.
d1001 2
a1002 7
	* arlad/fcache.c (fcache_get_data): directories can fetch part of
	the file, explain why we shold remove `update attr case' in this
	function.
	(fcache_update_length): set wanted_length to min of len we have and
	length of file so we don't got off and fetch the whole thing.
	(sum_node): don't look at datap/attrp, length will be 0 when there
	isn't any data
d1004 2
a1005 1
2003-01-07  Love  <lha@@stacken.kth.se>
d1007 1
a1007 3
	* arlad/kernel.c: name the workers with their worker id
	
2003-01-06  Love  <lha@@stacken.kth.se>
d1009 2
a1010 2
	* appl/lib/tokens.c (arlalib_token_iter): if there is unknown
	error from k_pioctl, bail out
d1012 1
a1012 1
2003-01-03  Tomas Olsson  <tol@@stacken.kth.se>
d1014 6
a1019 3
	* lwp/plwp.h: include windows.h after roken.h

	* lwp/plwp.c (*): indent, cleanup, more debugging
d1021 4
a1024 2
	* lwp/plwp.c (LWP_INT_SIGNAL): use SetEvent(), not PulseEvent()
	(Create_Process_Part2): handle locks properly around LWP_INT_WAIT
d1026 1
a1026 1
For older ChangeLog entries see ChangeLog.2002
@


