head	1.4;
access;
symbols
	OPENBSD_3_7:1.3.0.8
	OPENBSD_3_7_BASE:1.3
	OPENBSD_3_6:1.3.0.6
	OPENBSD_3_6_BASE:1.3
	OPENBSD_3_5:1.3.0.4
	OPENBSD_3_5_BASE:1.3
	apache_1_3_29-mod_ssl_2_8_16:1.1.1.2
	OPENBSD_3_4:1.3.0.2
	OPENBSD_3_4_BASE:1.3
	apache_1_3_28-mod_ssl_2_8_15:1.1.1.2
	OPENBSD_3_3:1.2.0.4
	OPENBSD_3_3_BASE:1.2
	apache_1_3_27-mod_ssl_2_8_12:1.1.1.1
	apache_1_3_27:1.1.1.1
	OPENBSD_3_2:1.2.0.2
	OPENBSD_3_2_BASE:1.2
	apache_1_3_26:1.1.1.1
	apache:1.1.1
	OPENBSD_3_1:1.1.0.2
	OPENBSD_3_1_BASE:1.1;
locks; strict;
comment	@# @;


1.4
date	2005.07.26.14.22.24;	author jmc;	state dead;
branches;
next	1.3;

1.3
date	2003.08.21.13.11.31;	author henning;	state Exp;
branches;
next	1.2;

1.2
date	2002.07.19.21.31.13;	author henning;	state Exp;
branches;
next	1.1;

1.1
date	2002.02.12.07.56.46;	author beck;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2002.07.19.21.27.22;	author henning;	state Exp;
branches;
next	1.1.1.2;

1.1.1.2
date	2003.08.21.12.53.29;	author henning;	state Exp;
branches;
next	;


desc
@@


1.4
log
@from tamas tevesz:
==> removal of language alternatives from manual/ and manual/mod/.

ok henning@@
@
text
@<?xml version="1.0" encoding="iso-2022-jp"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ja" lang="ja">
  <head>


    <title>Apache の環境変数</title>
  </head>
  <!-- English revision: 1.20 -->
  <!-- Background white, links blue (unvisited), navy (visited), red (active) -->
  <body bgcolor="#ffffff" text="#000000" link="#0000ff"
  vlink="#000080" alink="#ff0000">
        <div align="CENTER">
      <img src="images/sub.gif" alt="[APACHE DOCUMENTATION]" /> 

      <h3>Apache HTTP Server</h3>
    </div>



    <h1 align="center">Apache における環境変数</h1>

    <p>Apache HTTP サーバは<em>環境変数</em>と呼ばれる、名前のついた
    変数に情報を記憶する仕組みを提供しています。この情報はログ収集や
    アクセス誓罎覆匹里い蹐い蹐柄犧遒鮴制御するために使うことができます。
    これらの変数は CGI スクリプトなどの外部プログラムと通信するためにも
    使われます。この文書はそれらの変数の操作方法と使用方法をいくつか
    紹介します。</p>


    <p>これらの変数は<em>環境変数</em>と呼ばれていますが、オペレーティング
    システムによって誓罎気譴討い覺超竸瑤汎韻犬任呂△蠅泙擦鵝
実際は、これらの変数は Apache の内部構造の中に記憶され、操作されています。
    それらは、CGI や SSI スクリプトに渡されたときだ世院⊆尊櫃
オペレーティングシステムの環境変数になります。サーバ自身が
    実行されているオペレーティングシステムの環境を操作したい場合は、
    オペレーティングシステムのシェルが提供している標準の環境変数の
    操作方法を使わなければなりません。</p>

    <ul>
      <li><a href="#setting">環境変数の誓瀋鹿畩鹿跚
殊蘊釈鱚羹■蜴腆ぢ環境変数の使用</a></li>

      <li><a href="#special">特別な目的の環境変数</a></li>

      <li><a href="#examples">例</a></li>
    </ul>
    <hr />

    <h2><a id="setting" name="setting">環境変数の誓瀋鹿畩鹿莢

儒痰跂闥粤鮟⊂
儒鮠
儒跚芬就陟昭齡鳫鈑ぢ関連モジュール</strong><br />
         <br />
         <a href="mod/mod_env.html">mod_env</a><br />
         <a href="mod/mod_rewrite.html">mod_rewrite</a><br />
         <a href="mod/mod_setenvif.html">mod_setenvif</a><br />
         <a href="mod/mod_unique_id.html">mod_unique_id</a><br />
         </td>

        <td valign="top"><strong>関連ディレクティブ</strong><br />
         <br />
         <a
        href="mod/mod_setenvif.html#browsermatch">BrowserMatch</a><br />
         <a
        href="mod/mod_setenvif.html#browsermatchnocase">BrowserMatchNoCase</a><br />
         <a href="mod/mod_env.html#passenv">PassEnv</a><br />
         <a
        href="mod/mod_rewrite.html#RewriteRule">RewriteRule</a><br />
         <a href="mod/mod_env.html#setenv">SetEnv</a><br />
         <a
        href="mod/mod_setenvif.html#setenvif">SetEnvIf</a><br />
         <a
        href="mod/mod_setenvif.html#setenvifnocase">SetEnvIfNoCase</a><br />
         <a href="mod/mod_env.html#unsetenv">UnsetEnv</a><br />
         </td>
      </tr>
    </table>

    <h3>基本的な環境の操作</h3>

    <p>Apache において環境変数を誓瀋蠅垢覦貳峇靄榲癖，蓮
無条件に環境変数を誓瀋蠅垢竢粤肖續梼閼緇
ディレクティブを使用することです。 <code>PassEnv</code> 
    ディレクティブにより、Apache が起動されたシェルの
    環境変数を渡すこともできます。</p>

    <h3>リクエスト毎に条件に基づいて誓瀋蠅垢鹿莖
腫ぢより柔斉霎性を高めるために、mod_setenvif
    で提供されているディレクティブを使用することで、リクエストの
    特誓亡陲鼎い憧超竸瑤鮴設定することができます。例えば、特定のブラウザ
    (User-Agent) のリクエストや特定の Referer [意図的な綴りです]
    (訳注: 誓気靴つ屬蠅繙纈鱚ですが、HTTP の仕様では Referer
    となっています) ヘッダ世弔辰燭箸里瀛竸瑤鮴設定することができます。
    mod_rewrite の <code>RewriteRule</code> ディレクティブにおいて
    環境変数を誓瀋蠅垢竢粤詔貼鹿竢粤オプションを使用することで、
    より柔斉陲弊設定を行なうことができます。</p>

    <h3>一意な識別子</h3>

    <p>mod_unique_id は、非常に限られた条件の下で
    「すべて」のリクエストについて、一意であることが保証されている値を環境変数
    <code>UNIQUE_ID</code> に誓瀋蠅靴泙后
鹿霈

取馨標準 CGI 変数</h3>

    <p>Apache の誓瀋螢侫．ぅ襪農設定された環境変数とシェルから渡される
    環境変数に加えて、CGI スクリプトと SSI ページには <a
    href="misc/FAQ.html#cgi-spec">CGI の仕様</a>で要求されている、
    リクエストのメタ情報を持った環境変数の組が提供されます。
    </p>

    <h3>いくつかの注意</h3>

    <ul>
      <li>環境を操作するディレクティブを使って標準 CGI
      変数を上書きしたり変更したりすることはできません。</li>

      <li>CGI スクリプトを起動するために <a href="suexec.html">suexec</a>
      が使用されている場合、CGI スクリプトが起動するために、環境変数は<em
      >安全</em>な環境変数の組に誓依気譴泙后
この安全な環境変数の集合は、コンパイル時に <code>suexec.c</code>
      で定義されます。</li>

      <li>移植誓里燭瓩法超竸瑤量樵阿魯▲襯侫．戰奪函
数字とアンダ澄璽好灰訳注: '_') だ世韻蘋成ります。
      さらに、最初の文字は数字であってはいけません。
      この誓造帽腓錣覆な源派ぢスクリプトと SSI
      ページに渡されるときにアンダ澄璽好灰△肪峇垢気譴泙后
鹿跚鹿取

取仮釈篏♭皷鈑釶辣就蜴腆ぢ環境変数の使用</a></h2>


    <table border="1">
      <tr>
        <td valign="top"><strong>関連モジュール</strong><br />
         <br />
         <a href="mod/mod_access.html">mod_access</a><br />
         <a href="mod/mod_cgi.html">mod_cgi</a><br />
         <a href="mod/mod_include.html">mod_include</a><br />
         <a href="mod/mod_log_config.html">mod_log_config</a><br />
         <a href="mod/mod_rewrite.html">mod_rewrite</a><br />
         </td>

        <td valign="top"><strong>関連ディレクティブ</strong><br />
         <br />
         <a href="mod/mod_access.html#allow">Allow</a><br />
         <a
        href="mod/mod_log_config.html#customlog">CustomLog</a><br />
         <a href="mod/mod_access.html#deny">Deny</a><br />
         <a
        href="mod/mod_log_config.html#logformat">LogFormat</a><br />
         <a
        href="mod/mod_rewrite.html#RewriteCond">RewriteCond</a><br />
         <a
        href="mod/mod_rewrite.html#RewriteRule">RewriteRule</a><br />
         </td>
       </tr>
    </table>

    <h3>CGI スクリプト</h3>

    <p>環境変数の主な利用法の一つは、CGI スクリプトに情報を伝えることです。
    上で誓睫誓されているように、CGI スクリプトに渡される環境変数は Apache
    の誓瀋蠅砲茲蠕設定される変数に加えて、リクエストの標準のメタ情報を含んでいます。
    詳細は <a href="howto/cgi.html">CGI チュートリアル</a> を参照してくだ世気ぁ
鹿霈


取馨嗷ページ</h3>

    <p>
    mod_include の <code>server-parsed</code> ハンドラで処理される
    server-parsed (SSI) ドキュメントでは、<code>echo</code>
    要素を使用すると環境変数が出力されます。
    また、ページのある部分がリクエストの誓舛鳳犬栃儿垢気譴襪茲Δ法
環境変数をフロー誓耆彖任濃箸Δ海箸任泙后楮戮
釈鱚羹∵阯皷譬肖喇ぢチュートリアル</a> を参照してくだ世気ぁ
鹿霈

取馨アクセス誓鹿莖
腫昭竢粤鍾跛阯鳫緕鹿竢粤ディレクティブと <code>deny from env=</code>
    ディレクティブを使用して、サーバへのアクセスを環境変数の値で誓罎垢襪海箸任泙后
若閼緇嚆鉚膚鹿竢粤ディレクティブと組み合わせることで、クライアントの特誓亡陲鼎い
サーバへのアクセス誓罎鮟誓軟に行なうことができるようになります。
    例えば、これらのディレクティブを使用して、特定のブラウザ (User-Agent)
    からのアクセスを拒否することができます。
    </p>

    <h3>条件付きログ記録</h3>

    <p>
    <code>LogFormat</code> ディレクティブのオプション <code>%e</code>
    を使用することで、環境変数をアクセスログに記録することができます。さらに、
    <code>CustomLog</code> ディレクティブの条件分岐式を使用することで、
    環境変数の値によってリクエストをログに記録するかどうかを決めることができます。
    <code>SetEnvIf</code> ディレクティブと組み合わせることで、
    どのリクエストをログに記録するかを柔斉陲棒制御することが可能になります。例えば、
    <code>gif</code> で終わるファイル名へのリクエストはログに記録しない、
    違うサブネットのクライアントからのリクエストだ世韻鬟蹈阿傍燭垢襦△箸いα鬚椎修任后
鹿霈

取馨孀の書き換え</h3>

    <p><code>RewriteCond</code> ディレクティブで<em>評価文字列</em>として
    <code>%{ENV:...}</code> 式を指定することで、mod_rewrite
    の書き換えエンジンが環境変数に基いて条件分岐を行なうことができます。
    mod_rewrite が使用可能な変数で <code>ENV:</code> が前についていない変数は、
    実際は環境変数ではないということに注意してくだ世気ぁ
それらは他のモジュールからは使用できない mod_rewrite 用の特別な変数です。
    </p>
    <hr />

    <h2><a id="special" name="special">特別な目的の環境変数</a></h2>


    <p>
    互換誓量簑蠅魏魴茲垢襪燭瓩法団蠅離薀ぅ▲鵐箸板命靴討い襪箸
草痺蒹ぢの動作を変更できる機構が導入されました。できるだ世噂誓軟にするために、
    これらの機構は環境変数を定義することで呼び出されます。普通は、
    <a href="mod/mod_setenvif.html#browsermatch">BrowserMatch</a>
    ディレクティブを使いますが、例えば <a href="mod/mod_env.html#setenv"
    >SetEnv</a> ディレクティブや <a href="mod/mod_env.html#passenv"
    >PassEnv</a> ディレクティブも使用することができます。
    </p>

    <h2>downgrade-1.0</h2>

    <p>これを指定することで、リクエストが HTTP/1.0
    より新しいプロトコルの場合でも、HTTP/1.0 として扱われます。</p>

    <h2>force-no-vary</h2>

    <p>応答ヘッダ世薀ぅ▲鵐箸冒蕕譴訌阿竢粤蕉癇閼緇
フィールドを取り除きます。
    クライアントの中にはこのフィールドを誓気靴鮗瓩靴覆い發里△蠅泙
┝蓿繙就迚黹鈿焜跚緕頏閧跂逑譬ぢクライアントの既知の問題</a>
    のページを参照してくだ世気ぢ。この変数を誓瀋蠅垢襪海箸任修量簑蠅魏麋
することができます。この変数を誓瀋蠅垢襪函首闔臂肬鱆絖鱚齔闔黼鹿齡鳫鈑が誓瀋蠅気譴燭海箸砲覆蠅泙后鹿霈

取仮肬鱆絖鱚齔闔黼鹿莢
腫ぢこれが誓瀋蠅気譴討い襪函⊂錣墺亊窺での応答になります。この機能は、
    元々は AOL のプロキシの問題のために実装されました。クライアントの中には、
    HTTP/1.1 の応答を返されると誓気靴虻遒靴覆い發里△襪發靴譴泙擦鵝
この機能を使用することで、そのようなクライアントとの間の互換誓簑蠅魏魴茲任泙后鹿霈

取仮鈿諷辮瘡蝟綣仮

腫ぢこれが誓瀋蠅気譴討い訃豺腓蓮釈鱚羹閼闥絎蔗迪ｋ繞鞜跚硝繞霑跚鹿畩ぢを使用しないようにします。</p>

    <h2>suppress-error-charset</h2>
    <p><i>1.3.26 と 2.0.40 以降のバージョンで使用可能</i></p>
    <p>Apache がクライアントのリクエストに応じてリダ瀬ぅ譽箸鮃圓覆Δ箸
レスポンスにはクライアントが自動的にリダ瀬ぅ譽箸鯆匹┐覆ぢ追わない)ときの
    ために表示されるテキストが含まれています。Apache は通常はこのテキストは
    使われている文字セットである ISO-8859-1 とします。</p>
    <p>しかし、リダ瀬ぅ譽叛先が別の文字セットを使っている場合、
    標準に準拠していないブラウザでは、リダ瀬ぅ譽叛先の実際の文字セットの
    代わりに、リダ瀬ぅ譽噺気諒源札奪箸鮖箸辰討靴泙Δ海箸△蠅泙后
これは、例えばギリシャ文字が文字化けしたりすることになります。</p>
    <p>この環境変数を誓瀋蠅垢襪函鞜竏はリダ瀬ぅ譽噺気離謄好箸諒源札奪
は省略するようになり、そのような標準に準拠していないブラウザでもリダ瀬ぅ譽
誓茲諒源札奪箸鮴正しく使うことができるようになります。</p>
    <hr />

    <h2><a id="examples" name="examples">例</a></h2>

    <h3>おかしな挙動をするクライアントに対してプロトコルの動作を変更する</h3>

    <p>クライアントに関する既知の問題に対処するために、以下の行を
    httpd.conf に入れることを推奨しています。</p>
<pre>
#
# The following directives modify normal HTTP response behavior.
# The first directive disables keepalive for Netscape 2.x and browsers that
# spoof it. There are known problems with these browser implementations.
# The second directive is for Microsoft Internet Explorer 4.0b2
# which has a broken HTTP/1.1 implementation and does not properly
# support keepalive when it is used on 301 or 302 (redirect) responses.
#
BrowserMatch "Mozilla/2" nokeepalive
BrowserMatch "MSIE 4\.0b2;" nokeepalive downgrade-1.0 force-response-1.0

#
# The following directive disables HTTP/1.1 responses to browsers which
# are in violation of the HTTP/1.0 spec by not being able to grok a
# basic 1.1 response.
#
BrowserMatch "RealPlayer 4\.0" force-response-1.0
BrowserMatch "Java/1\.0" force-response-1.0
BrowserMatch "JDK/1\.0" force-response-1.0
</pre>

    <h3>画像へのリクエストをアクセスログに記録しない</h3>

    <p>この例では、画像へのリクエストがアクセスログに現れないようにします。
    これを変更することで、特定のディレクトリのログ収集をやめたり、
    特定のホストからのリクエストのログ収集をやめたりすることが簡単にできます。
    </p>
<pre>
    SetEnvIf Request_URI \.gif image-request
    SetEnvIf Request_URI \.jpg image-request
    SetEnvIf Request_URI \.png image-request
    CustomLog logs/access_log env=!image-request
</pre>

    <h3>「画像の盗用」を防ぐ</h3>

    <p>この例は、別のサーバにいる人が、あなたのサーバにある画像を
    inline 画像として使用することを防ぎます。
    これは推奨されている誓瀋蠅任呂△蠅泙擦鵑△△觚堕蠅気譴疹靴任詫任后
ここでは、すべての画像は /web/images というディレクトリにあると仮定します。
    </p>
<pre>
    SetEnvIf Referer "^http://www.example.com/" local_referal
    # Allow browsers that do not send Referer info
    SetEnvIf Referer "^$" local_referal
    &lt;Directory /web/images&gt;
       Order Deny,Allow
       Deny from all
       Allow from env=local_referal
    &lt;/Directory&gt;
</pre>

    <p><em>注:</em> 'referer' と 'referal' の綴りは意図的なものです (訳注:
    誓気靴つ屬蠅繙纈鱚と referral)。</p>

    <p>この手法に関する詳しい情報は ApacheToday のチュートリアル &quot;<a
    href="http://apachetoday.com/news_story.php3?ltsn=2000-06-14-002-01-ps"
    >Keeping Your Images from Adorning Other Sites</a>&quot;
    を参照してくだ世気ぁ鹿霈
取

取瘡蜃扈杜堙劬樵鞜竏挽墅纈鮗馨
釈鱚羹〓昭蜊齟秉∫轣艱鶩蜴粤芍罌踉就侮粤昭
鹿硼糯鹿蔗迪

窺跫尖纈艱

誓


窺跫尖纈艱

絶臼
甕次鈑跚鼈纐蜩蜿邵箒甼蓿繙就迴箝迴籖黼鉚蜀譯択阯黼鰺癆竏⊂択阯黼鰺癆竏鹿畩錫
箏畄蓿繙就迴箝迴籖黼鉚蜀譯択阯黼鰺癆竏麗秩黼⊂択阯黼鰺癆竏麗秩黼鹿畩錫
箏畄蓿繙就迴箝迴籖黼鉚蜀譯嚆鉚膚⊂嚆鉚膚鹿畩錫
箏畄蓿繙就迴箝迴籖黼鉚蜀譯嚆鉚膚麗秩黼⊂嚆鉚膚麗秩黼鹿畩錫
箍挟

窺跫請鞜竏窺凱桶閼燗鼬辣鱧
絶臼
甕次鈑跚鼈纐蜩蜿邵箍蔚
甦腫ぢ多くのオペレーティングシステムは、<em>環境変数</em>と呼ばれる、
    情報の保存、伝達のための機能を提供しています。動作方法を誓罎靴燭蝓
断スクリプトのような他のプログラムと通信したりするために、Apache
    は多くの方法で環境変数を使います。この文書では、Apache
    における環境変数の使用法をいくつか誓睫誓します。
    </p>

@


1.1.1.1
log
@import apache 1.3.26 + mod_ssl 2.8.10
@
text
@d11 1
a11 1
  <!-- English revision: 1.18 -->
d25 7
a31 16
    <p>Apache HTTP サーバは<em>環境変数</em>と呼ばれる、名前のついた
    変数に情報を記憶する仕組みを提供しています。この情報はログ収集や
    アクセス誓罎覆匹里い蹐い蹐柄犧遒鮴制御するために使うことができます。
    これらの変数は CGI スクリプトなどの外部プログラムと通信するためにも
    使われます。この文書はそれらの変数の操作方法と使用方法をいくつか
    紹介します。</p>


    <p>これらの変数は<em>環境変数</em>と呼ばれていますが、オペレーティング
    システムによって誓罎気譴討い覺超竸瑤汎韻犬任呂△蠅泙擦鵝
実際は、これらの変数は Apache の内部構造の中に記憶され、操作されています。
    それらは、CGI や SSI スクリプトに渡されたときだ世院⊆尊櫃
オペレーティングシステムの環境変数になります。サーバ自身が
    実行されているオペレーティングシステムの環境を操作したい場合は、
    オペレーティングシステムのシェルが提供している標準の環境変数の
    操作方法を使わなければなりません。</p>
@


1.1.1.2
log
@import apache 1.3.28 and mod_ssl 2.8.15
@
text
@d11 1
a11 1
  <!-- English revision: 1.20 -->
d69 1
a69 1
        href="mod/mod_setenvif.html#browsermatch">BrowserMatch</a><br />
d71 1
a71 1
        href="mod/mod_setenvif.html#browsermatchnocase">BrowserMatchNoCase</a><br />
d77 1
a77 1
        href="mod/mod_setenvif.html#setenvif">SetEnvIf</a><br />
d79 1
a79 1
        href="mod/mod_setenvif.html#setenvifnocase">SetEnvIfNoCase</a><br />
a263 14

    <h2>suppress-error-charset</h2>
    <p><i>1.3.26 と 2.0.40 以降のバージョンで使用可能</i></p>
    <p>Apache がクライアントのリクエストに応じてリダ瀬ぅ譽箸鮃圓覆Δ箸
レスポンスにはクライアントが自動的にリダ瀬ぅ譽箸鯆匹┐覆ぢ追わない)ときの
    ために表示されるテキストが含まれています。Apache は通常はこのテキストは
    使われている文字セットである ISO-8859-1 とします。</p>
    <p>しかし、リダ瀬ぅ譽叛先が別の文字セットを使っている場合、
    標準に準拠していないブラウザでは、リダ瀬ぅ譽叛先の実際の文字セットの
    代わりに、リダ瀬ぅ譽噺気諒源札奪箸鮖箸辰討靴泙Δ海箸△蠅泙后
これは、例えばギリシャ文字が文字化けしたりすることになります。</p>
    <p>この環境変数を誓瀋蠅垢襪函鞜竏はリダ瀬ぅ譽噺気離謄好箸諒源札奪
は省略するようになり、そのような標準に準拠していないブラウザでもリダ瀬ぅ譽
誓茲諒源札奪箸鮴正しく使うことができるようになります。</p>
@


