head	1.31;
access;
symbols
	OPENBSD_5_5:1.30.0.20
	OPENBSD_5_5_BASE:1.30
	OPENBSD_5_4:1.30.0.16
	OPENBSD_5_4_BASE:1.30
	OPENBSD_5_3:1.30.0.14
	OPENBSD_5_3_BASE:1.30
	OPENBSD_5_2:1.30.0.12
	OPENBSD_5_2_BASE:1.30
	OPENBSD_5_1_BASE:1.30
	OPENBSD_5_1:1.30.0.10
	OPENBSD_5_0:1.30.0.8
	OPENBSD_5_0_BASE:1.30
	OPENBSD_4_9:1.30.0.6
	OPENBSD_4_9_BASE:1.30
	OPENBSD_4_8:1.30.0.4
	OPENBSD_4_8_BASE:1.30
	OPENBSD_4_7:1.30.0.2
	OPENBSD_4_7_BASE:1.30
	OPENBSD_4_6:1.29.0.4
	OPENBSD_4_6_BASE:1.29
	OPENBSD_4_5:1.28.0.4
	OPENBSD_4_5_BASE:1.28
	OPENBSD_4_4:1.28.0.2
	OPENBSD_4_4_BASE:1.28
	OPENBSD_4_3:1.27.0.10
	OPENBSD_4_3_BASE:1.27
	OPENBSD_4_2:1.27.0.8
	OPENBSD_4_2_BASE:1.27
	OPENBSD_4_1:1.27.0.6
	OPENBSD_4_1_BASE:1.27
	OPENBSD_4_0:1.27.0.4
	OPENBSD_4_0_BASE:1.27
	OPENBSD_3_9:1.27.0.2
	OPENBSD_3_9_BASE:1.27
	OPENBSD_3_8:1.26.0.2
	OPENBSD_3_8_BASE:1.26
	OPENBSD_3_7:1.24.0.2
	OPENBSD_3_7_BASE:1.24
	OPENBSD_3_6:1.21.0.2
	OPENBSD_3_6_BASE:1.21
	OPENBSD_3_5:1.20.0.2
	OPENBSD_3_5_BASE:1.20
	apache_1_3_29-mod_ssl_2_8_16:1.1.1.5
	OPENBSD_3_4:1.18.0.2
	OPENBSD_3_4_BASE:1.18
	apache_1_3_28-mod_ssl_2_8_15:1.1.1.4
	OPENBSD_3_3:1.17.0.2
	OPENBSD_3_3_BASE:1.17
	apache_1_3_27-mod_ssl_2_8_12:1.1.1.3
	apache_1_3_27:1.1.1.3
	OPENBSD_3_2:1.16.0.2
	OPENBSD_3_2_BASE:1.16
	apache_1_3_26:1.1.1.2
	OPENBSD_3_1:1.15.0.2
	OPENBSD_3_1_BASE:1.15
	OPENBSD_3_0:1.13.0.2
	OPENBSD_3_0_BASE:1.13
	OPENBSD_2_9_BASE:1.12
	OPENBSD_2_9:1.12.0.2
	OPENBSD_2_8:1.10.0.4
	OPENBSD_2_8_BASE:1.10
	OPENBSD_2_7:1.10.0.2
	OPENBSD_2_7_BASE:1.10
	OPENBSD_2_6:1.8.0.2
	OPENBSD_2_6_BASE:1.8
	OPENBSD_2_5:1.6.0.2
	OPENBSD_2_5_BASE:1.6
	OPENBSD_2_4:1.3.0.2
	OPENBSD_2_4_BASE:1.3
	apache_1_3_2:1.1.1.1
	apache:1.1.1;
locks; strict;
comment	@ * @;


1.31
date	2014.04.22.14.47.26;	author henning;	state dead;
branches;
next	1.30;

1.30
date	2010.02.25.07.49.53;	author pyr;	state Exp;
branches;
next	1.29;

1.29
date	2009.06.02.23.36.40;	author pyr;	state Exp;
branches;
next	1.28;

1.28
date	2008.05.09.08.06.28;	author mbalmer;	state Exp;
branches;
next	1.27;

1.27
date	2006.02.22.15.07.12;	author henning;	state Exp;
branches;
next	1.26;

1.26
date	2005.06.15.00.00.16;	author niallo;	state Exp;
branches;
next	1.25;

1.25
date	2005.03.28.23.26.51;	author niallo;	state Exp;
branches;
next	1.24;

1.24
date	2005.02.09.12.13.09;	author henning;	state Exp;
branches;
next	1.23;

1.23
date	2004.12.06.13.14.10;	author henning;	state Exp;
branches;
next	1.22;

1.22
date	2004.12.02.19.42.46;	author henning;	state Exp;
branches;
next	1.21;

1.21
date	2004.06.07.04.21.30;	author brad;	state Exp;
branches;
next	1.20;

1.20
date	2003.11.17.18.57.05;	author henning;	state Exp;
branches
	1.20.2.1;
next	1.19;

1.19
date	2003.10.29.10.10.59;	author henning;	state Exp;
branches;
next	1.18;

1.18
date	2003.08.21.13.11.35;	author henning;	state Exp;
branches
	1.18.2.1;
next	1.17;

1.17
date	2002.10.07.20.23.06;	author henning;	state Exp;
branches
	1.17.2.1;
next	1.16;

1.16
date	2002.07.19.21.31.15;	author henning;	state Exp;
branches
	1.16.2.1;
next	1.15;

1.15
date	2002.03.29.02.08.05;	author beck;	state Exp;
branches;
next	1.14;

1.14
date	2002.02.12.07.56.49;	author beck;	state Exp;
branches;
next	1.13;

1.13
date	2001.06.20.18.06.14;	author brad;	state Exp;
branches;
next	1.12;

1.12
date	2001.03.29.10.21.41;	author beck;	state Exp;
branches;
next	1.11;

1.11
date	2000.12.15.22.17.59;	author beck;	state Exp;
branches;
next	1.10;

1.10
date	2000.03.19.11.17.04;	author beck;	state Exp;
branches;
next	1.9;

1.9
date	2000.01.25.18.29.42;	author beck;	state Exp;
branches;
next	1.8;

1.8
date	99.10.01.21.54.19;	author beck;	state Exp;
branches;
next	1.7;

1.7
date	99.09.29.06.29.30;	author beck;	state Exp;
branches;
next	1.6;

1.6
date	99.03.01.04.28.34;	author beck;	state Exp;
branches;
next	1.5;

1.5
date	99.03.01.01.05.58;	author beck;	state Exp;
branches;
next	1.4;

1.4
date	98.11.10.07.44.49;	author deraadt;	state Exp;
branches;
next	1.3;

1.3
date	98.10.11.19.45.11;	author beck;	state Exp;
branches;
next	1.2;

1.2
date	98.10.01.17.29.26;	author beck;	state Exp;
branches;
next	1.1;

1.1
date	98.10.01.17.19.38;	author beck;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	98.10.01.17.19.38;	author beck;	state Exp;
branches;
next	1.1.1.2;

1.1.1.2
date	2002.07.19.21.28.39;	author henning;	state Exp;
branches;
next	1.1.1.3;

1.1.1.3
date	2002.10.07.19.48.12;	author henning;	state Exp;
branches;
next	1.1.1.4;

1.1.1.4
date	2003.08.21.12.53.38;	author henning;	state Exp;
branches;
next	1.1.1.5;

1.1.1.5
date	2003.11.17.17.03.20;	author henning;	state Exp;
branches;
next	;

1.16.2.1
date	2003.11.04.18.27.43;	author miod;	state Exp;
branches;
next	;

1.17.2.1
date	2003.10.30.01.46.14;	author margarida;	state Exp;
branches;
next	;

1.18.2.1
date	2003.10.31.00.20.31;	author brad;	state Exp;
branches;
next	1.18.2.2;

1.18.2.2
date	2004.06.10.03.55.18;	author brad;	state Exp;
branches;
next	;

1.20.2.1
date	2004.06.10.02.09.05;	author brad;	state Exp;
branches;
next	;


desc
@@


1.31
log
@this commit is really florian@@'s, since he's the one who made removal
of our forked apache possible by his work on nginx and slowcgi, but he
doesn't want it - so it is my pleasure to tedu it. I spent so much work
on chroot in it 10 years ago - and am very happy to see it go now, nginx
is a far better choice today.
Bye bye, Apache, won't miss you.
@
text
@/* $OpenBSD: httpd.h,v 1.30 2010/02/25 07:49:53 pyr Exp $ */

/* ====================================================================
 * The Apache Software License, Version 1.1
 *
 * Copyright (c) 2000-2003 The Apache Software Foundation.  All rights
 * reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 *
 * 1. Redistributions of source code must retain the above copyright
 *    notice, this list of conditions and the following disclaimer.
 *
 * 2. Redistributions in binary form must reproduce the above copyright
 *    notice, this list of conditions and the following disclaimer in
 *    the documentation and/or other materials provided with the
 *    distribution.
 *
 * 3. The end-user documentation included with the redistribution,
 *    if any, must include the following acknowledgment:
 *       "This product includes software developed by the
 *        Apache Software Foundation (http://www.apache.org/)."
 *    Alternately, this acknowledgment may appear in the software itself,
 *    if and wherever such third-party acknowledgments normally appear.
 *
 * 4. The names "Apache" and "Apache Software Foundation" must
 *    not be used to endorse or promote products derived from this
 *    software without prior written permission. For written
 *    permission, please contact apache@@apache.org.
 *
 * 5. Products derived from this software may not be called "Apache",
 *    nor may "Apache" appear in their name, without prior written
 *    permission of the Apache Software Foundation.
 *
 * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
 * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
 * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
 * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
 * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
 * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
 * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
 * SUCH DAMAGE.
 * ====================================================================
 *
 * This software consists of voluntary contributions made by many
 * individuals on behalf of the Apache Software Foundation.  For more
 * information on the Apache Software Foundation, please see
 * <http://www.apache.org/>.
 *
 * Portions of this software are based upon public domain software
 * originally written at the National Center for Supercomputing Applications,
 * University of Illinois, Urbana-Champaign.
 */

#ifndef APACHE_HTTPD_H
#define APACHE_HTTPD_H

#ifdef __cplusplus
extern "C" {
#endif

/*
 * Define APACHE6 so that additional modules depending on Apache can
 * tell if this a pacthed apache-1.3.*. With this definition apache6
 * is working together with e.g. the ap-perl module in NetBSD.
 */
#define APACHE6 1

/*
 * httpd.h: header for simple (ha! not anymore) http daemon
 */

/* Headers in which EVERYONE has an interest... */

#include "ap_config.h"
#include "ap_mm.h"
#include "ap_alloc.h"
/*
 * Include the Extended API headers.
 * Don't move the position. It has to be after ap_alloc.h because it uses the
 * pool stuff but before buff.h because the buffer stuff uses the EAPI, too.
 */
#include "ap_hook.h"
#include "ap_ctx.h"
#include "buff.h"
#include "ap.h"

/* ----------------------------- config dir ------------------------------ */

/* Define this to be the default server home dir. Most things later in this
 * file with a relative pathname will have this added.
 */
#ifndef HTTPD_ROOT
#define HTTPD_ROOT "/usr/local/apache"
#endif /* HTTPD_ROOT */

/* Default location of documents.  Can be overridden by the DocumentRoot
 * directive.
 */
#ifndef DOCUMENT_LOCATION
#define DOCUMENT_LOCATION  HTTPD_ROOT "/htdocs"
#endif /* DOCUMENT_LOCATION */

/* Max. number of dynamically loaded modules */
#ifndef DYNAMIC_MODULE_LIMIT
#define DYNAMIC_MODULE_LIMIT 64
#endif

/* Default administrator's address */
#define DEFAULT_ADMIN "[no address given]"

/* The target name of the installed Apache */
#ifndef TARGET
#define TARGET "httpd"
#endif

/*
 * --------- You shouldn't have to edit anything below this line ----------
 *
 * Any modifications to any defaults not defined above should be done in the 
 * respective config. file.
 *
 */


/* -- Internal representation for a HTTP protocol number, e.g., HTTP/1.1 -- */

#define HTTP_VERSION(major,minor) (1000*(major)+(minor))
#define HTTP_VERSION_MAJOR(number) ((number)/1000)
#define HTTP_VERSION_MINOR(number) ((number)%1000)


/* -------------- Port number for server running standalone --------------- */

#define DEFAULT_HTTP_PORT	80
#define DEFAULT_HTTPS_PORT	443
#define ap_is_default_port(port,r)	((port) == ap_default_port(r))
#define ap_http_method(r)   (((r)->ctx != NULL && ap_ctx_get((r)->ctx, \
    "ap::http::method") != NULL) ? ((char *)ap_ctx_get((r)->ctx,       \
    "ap::http::method")) : "http")
#define ap_default_port(r)  (((r)->ctx != NULL && ap_ctx_get((r)->ctx, \
    "ap::default::port") != NULL) ? atoi((char *)ap_ctx_get((r)->ctx,  \
    "ap::default::port")) : DEFAULT_HTTP_PORT)

/* --------- Default user name and group name running standalone ---------- */
/* --- These may be specified as numbers by placing a # before a number --- */

#ifndef DEFAULT_USER
#define DEFAULT_USER "#-1"
#endif
#ifndef DEFAULT_GROUP
#define DEFAULT_GROUP "#-1"
#endif

#ifndef DEFAULT_ERRORLOG
#define DEFAULT_ERRORLOG "logs/error_log"
#endif /* DEFAULT_ERRORLOG */

#ifndef DEFAULT_PIDLOG
#define DEFAULT_PIDLOG "logs/httpd.pid"
#endif
#ifndef DEFAULT_SCOREBOARD
#define DEFAULT_SCOREBOARD "logs/apache_runtime_status"
#endif
#ifndef DEFAULT_LOCKFILE
#define DEFAULT_LOCKFILE "logs/accept.lock"
#endif

/* Define this to be what your HTML directory content files are called */
#ifndef DEFAULT_INDEX
#define DEFAULT_INDEX "index.html"
#endif

/* Define this to 1 if you want fancy indexing, 0 otherwise */
#ifndef DEFAULT_INDEXING
#define DEFAULT_INDEXING 0
#endif

/* Define this to be what type you'd like returned for files with unknown */
/* suffixes.  MUST be all lower case. */
#ifndef DEFAULT_CONTENT_TYPE
#define DEFAULT_CONTENT_TYPE "text/plain"
#endif

/* Define this to be what your per-directory security files are called */
#ifndef DEFAULT_ACCESS_FNAME
#define DEFAULT_ACCESS_FNAME ".htaccess"
#endif /* DEFAULT_ACCESS_FNAME */

/* The name of the server config file */
#ifndef SERVER_CONFIG_FILE
#define SERVER_CONFIG_FILE "conf/httpd.conf"
#endif

/* The name of the document config file */
#ifndef RESOURCE_CONFIG_FILE
#define RESOURCE_CONFIG_FILE "conf/srm.conf"
#endif

/* The name of the MIME types file */
#ifndef TYPES_CONFIG_FILE
#define TYPES_CONFIG_FILE "conf/mime.types"
#endif

/* The name of the access file */
#ifndef ACCESS_CONFIG_FILE
#define ACCESS_CONFIG_FILE "conf/access.conf"
#endif

/* Whether we should enable rfc1413 identity checking */
#ifndef DEFAULT_RFC1413
#define DEFAULT_RFC1413 0
#endif
/* The default directory in user's home dir */
#ifndef DEFAULT_USER_DIR
#define DEFAULT_USER_DIR "public_html"
#endif

/* The default path for CGI scripts if none is currently set */
#ifndef DEFAULT_PATH
#define DEFAULT_PATH "/bin:/usr/bin:/usr/ucb:/usr/bsd:/usr/local/bin"
#endif

/* The path to the shell interpreter, for parsed docs */
#ifndef SHELL_PATH
#define SHELL_PATH "/bin/sh"
#endif /* SHELL_PATH */

/* The path to the suExec wrapper, can be overridden in Configuration */
#ifndef SUEXEC_BIN
#define SUEXEC_BIN  HTTPD_ROOT "/bin/suexec"
#endif

/* The default string lengths */
#define MAX_STRING_LEN HUGE_STRING_LEN
#define HUGE_STRING_LEN 8192

/* The timeout for waiting for messages */
#ifndef DEFAULT_TIMEOUT
#define DEFAULT_TIMEOUT 300
#endif

/* The timeout for waiting for keepalive timeout until next request */
#ifndef DEFAULT_KEEPALIVE_TIMEOUT
#define DEFAULT_KEEPALIVE_TIMEOUT 15
#endif

/* The number of requests to entertain per connection */
#ifndef DEFAULT_KEEPALIVE
#define DEFAULT_KEEPALIVE 100
#endif

/* The size of the server's internal read-write buffers */
#define IOBUFSIZE 8192

/* The max number of regex captures that can be expanded by ap_pregsub */
#define AP_MAX_REG_MATCH 10

/* Number of servers to spawn off by default --- also, if fewer than
 * this free when the caretaker checks, it will spawn more.
 */
#ifndef DEFAULT_START_DAEMON
#define DEFAULT_START_DAEMON 5
#endif

/* Maximum number of *free* server processes --- more than this, and
 * they will die off.
 */

#ifndef DEFAULT_MAX_FREE_DAEMON
#define DEFAULT_MAX_FREE_DAEMON 10
#endif

/* Minimum --- fewer than this, and more will be created */

#ifndef DEFAULT_MIN_FREE_DAEMON
#define DEFAULT_MIN_FREE_DAEMON 5
#endif

/* Limit on the total --- clients will be locked out if more servers than
 * this are needed.  It is intended solely to keep the server from crashing
 * when things get out of hand.
 *
 * We keep a hard maximum number of servers, for two reasons --- first off,
 * in case something goes seriously wrong, we want to stop the fork bomb
 * short of actually crashing the machine we're running on by filling some
 * kernel table.  Secondly, it keeps the size of the scoreboard file small
 * enough that we can read the whole thing without worrying too much about
 * the overhead.
 */
#ifndef HARD_SERVER_LIMIT
#define HARD_SERVER_LIMIT 256
#endif

/*
 * Special Apache error codes. These are basically used
 *  in http_main.c so we can keep track of various errors.
 *
 *   APEXIT_OK:
 *     A normal exit
 *   APEXIT_INIT:
 *     A fatal error arising during the server's init sequence
 *   APEXIT_CHILDINIT:
 *     The child died during it's init sequence
 *   APEXIT_CHILDFATAL:
 *     A fatal error, resulting in the whole server aborting.
 *     If a child exits with this error, the parent process
 *     considers this a server-wide fatal error and aborts.
 *
 */
#define APEXIT_OK		0x0
#define APEXIT_INIT		0x2
#define APEXIT_CHILDINIT	0x3
#define APEXIT_CHILDFATAL	0xf

/*
 * (Unix, OS/2 only)
 * Interval, in microseconds, between scoreboard maintenance.  During
 * each scoreboard maintenance cycle the parent decides if it needs to
 * spawn a new child (to meet MinSpareServers requirements), or kill off
 * a child (to meet MaxSpareServers requirements).  It will only spawn or
 * kill one child per cycle.  Setting this too low will chew cpu.  The
 * default is probably sufficient for everyone.  But some people may want
 * to raise this on servers which aren't dedicated to httpd and where they
 * don't like the httpd waking up each second to see what's going on.
 */
#ifndef SCOREBOARD_MAINTENANCE_INTERVAL
#define SCOREBOARD_MAINTENANCE_INTERVAL 1000000
#endif

/*
 * Unix only:
 * Path to Shared Memory Files
 */
#ifndef EAPI_MM_CORE_PATH
#define EAPI_MM_CORE_PATH "logs/mm"
#endif
#ifndef EAPI_MM_CORE_MAXSIZE
#define EAPI_MM_CORE_MAXSIZE 1024*1024*1 /* max. 1MB */
#endif

/* Number of requests to try to handle in a single process.  If <= 0,
 * the children don't die off.  That's the default here, since I'm still
 * interested in finding and stanching leaks.
 */

#ifndef DEFAULT_MAX_REQUESTS_PER_CHILD
#define DEFAULT_MAX_REQUESTS_PER_CHILD 0
#endif

#ifndef DEFAULT_THREADS_PER_CHILD
#define DEFAULT_THREADS_PER_CHILD 50
#endif
#ifndef DEFAULT_EXCESS_REQUESTS_PER_CHILD
#define DEFAULT_EXCESS_REQUESTS_PER_CHILD 0
#endif

/* Constrain the rlimits of the child processes */
#ifndef DEFAULT_MAX_CPU_PER_CHILD
#define DEFAULT_MAX_CPU_PER_CHILD 0
#endif
#ifndef DEFAULT_MAX_DATA_PER_CHILD
#define DEFAULT_MAX_DATA_PER_CHILD 0
#endif
#ifndef DEFAULT_MAX_NOFILE_PER_CHILD
#define DEFAULT_MAX_NOFILE_PER_CHILD 0
#endif
#ifndef DEFAULT_MAX_RSS_PER_CHILD
#define DEFAULT_MAX_RSS_PER_CHILD 0
#endif
#ifndef DEFAULT_MAX_STACK_PER_CHILD
#define DEFAULT_MAX_STACK_PER_CHILD 0
#endif

/* The maximum length of the queue of pending connections, as defined
 * by listen(2).  Under some systems, it should be increased if you
 * are experiencing a heavy TCP SYN flood attack.
 *
 * It defaults to 511 instead of 512 because some systems store it
 * as an 8-bit datatype; 512 truncated to 8-bits is 0, while 511 is
 * 255 when truncated.
 */

#ifndef DEFAULT_LISTENBACKLOG
#define DEFAULT_LISTENBACKLOG 511
#endif

/* Limits on the size of various request items.  These limits primarily
 * exist to prevent simple denial-of-service attacks on a server based
 * on misuse of the protocol.  The recommended values will depend on the
 * nature of the server resources -- CGI scripts and database backends
 * might require large values, but most servers could get by with much
 * smaller limits than we use below.  The request message body size can
 * be limited by the per-dir config directive LimitRequestBody.
 *
 * Internal buffer sizes are two bytes more than the DEFAULT_LIMIT_REQUEST_LINE
 * and DEFAULT_LIMIT_REQUEST_FIELDSIZE below, which explains the 8190.
 * These two limits can be lowered (but not raised) by the server config
 * directives LimitRequestLine and LimitRequestFieldsize, respectively.
 *
 * DEFAULT_LIMIT_REQUEST_FIELDS can be modified or disabled (set = 0) by
 * the server config directive LimitRequestFields.
 */
#ifndef DEFAULT_LIMIT_REQUEST_LINE
#define DEFAULT_LIMIT_REQUEST_LINE 8190
#endif /* default limit on bytes in Request-Line (Method+URI+HTTP-version) */
#ifndef DEFAULT_LIMIT_REQUEST_FIELDSIZE
#define DEFAULT_LIMIT_REQUEST_FIELDSIZE 8190
#endif /* default limit on bytes in any one header field  */
#ifndef DEFAULT_LIMIT_REQUEST_FIELDS
#define DEFAULT_LIMIT_REQUEST_FIELDS 100
#endif /* default limit on number of request header fields */

/*
 * The default default character set name to add if AddDefaultCharset is
 * enabled.  Overridden with AddDefaultCharsetName.
 */
#define DEFAULT_ADD_DEFAULT_CHARSET_NAME "iso-8859-1"

/*
 * The below defines the base string of the Server: header. Additional
 * tokens can be added via the ap_add_version_component() API call.
 *
 * The tokens are listed in order of their significance for identifying the
 * application.
 *
 * "Product tokens should be short and to the point -- use of them for
 * advertizing or other non-essential information is explicitly forbidden."
 *
 * Example: "Apache/1.1.0 MrWidget/0.1-alpha" 
 */

#define SERVER_BASEVENDOR   "Apache Group"
#define SERVER_BASEPRODUCT  "Apache"
#define SERVER_BASEREVISION "1.3.29"
#define SERVER_BASEVERSION  SERVER_BASEPRODUCT "/" SERVER_BASEREVISION

#define SERVER_PRODUCT  SERVER_BASEPRODUCT
#define SERVER_REVISION SERVER_BASEREVISION
#define SERVER_VERSION  SERVER_PRODUCT "/" SERVER_REVISION
enum server_token_type {
	SrvTk_MIN,	   /* eg: Apache/1.3.0 */
	SrvTk_OS,	   /* eg: Apache/1.3.0 (UNIX) */
	SrvTk_FULL,	   /* eg: Apache/1.3.0 (UNIX) PHP/3.0 FooBar/1.2b */
	SrvTk_PRODUCT_ONLY /* eg: Apache */
};

API_EXPORT(const char *) ap_get_server_version(void);
API_EXPORT(void) ap_add_version_component(const char *component);
API_EXPORT(const char *) ap_get_server_built(void);
API_EXPORT(void) ap_add_config_define(const char *define);

/* Numeric release version identifier: MMNNFFRBB: major minor fix final beta
 * Always increases along the same track as the source branch.
 * For example, Apache 1.4.2 would be '10402100', 2.5b7 would be '20500007'.
 */
#define APACHE_RELEASE 10329100

#define SERVER_PROTOCOL "HTTP/1.1"
#ifndef SERVER_SUPPORT
#define SERVER_SUPPORT "http://www.apache.org/"
#endif

#define DECLINED -1		/* Module declines to handle */
#define DONE -2			/* Module has served the response completely
				 *  - it's safe to die() with no more output
				 */
#define OK 0			/* Module has handled this stage. */


/* ----------------------- HTTP Status Codes  ------------------------- */

/* The size of the static array in http_protocol.c for storing
 * all of the potential response status-lines (a sparse table).
 * A future version should dynamically generate the table at startup.
 */
#define RESPONSE_CODES 55

#define HTTP_CONTINUE                      100
#define HTTP_SWITCHING_PROTOCOLS           101
#define HTTP_PROCESSING                    102
#define HTTP_OK                            200
#define HTTP_CREATED                       201
#define HTTP_ACCEPTED                      202
#define HTTP_NON_AUTHORITATIVE             203
#define HTTP_NO_CONTENT                    204
#define HTTP_RESET_CONTENT                 205
#define HTTP_PARTIAL_CONTENT               206
#define HTTP_MULTI_STATUS                  207
#define HTTP_MULTIPLE_CHOICES              300
#define HTTP_MOVED_PERMANENTLY             301
#define HTTP_MOVED_TEMPORARILY             302
#define HTTP_SEE_OTHER                     303
#define HTTP_NOT_MODIFIED                  304
#define HTTP_USE_PROXY                     305
#define HTTP_TEMPORARY_REDIRECT            307
#define HTTP_BAD_REQUEST                   400
#define HTTP_UNAUTHORIZED                  401
#define HTTP_PAYMENT_REQUIRED              402
#define HTTP_FORBIDDEN                     403
#define HTTP_NOT_FOUND                     404
#define HTTP_METHOD_NOT_ALLOWED            405
#define HTTP_NOT_ACCEPTABLE                406
#define HTTP_PROXY_AUTHENTICATION_REQUIRED 407
#define HTTP_REQUEST_TIME_OUT              408
#define HTTP_CONFLICT                      409
#define HTTP_GONE                          410
#define HTTP_LENGTH_REQUIRED               411
#define HTTP_PRECONDITION_FAILED           412
#define HTTP_REQUEST_ENTITY_TOO_LARGE      413
#define HTTP_REQUEST_URI_TOO_LARGE         414
#define HTTP_UNSUPPORTED_MEDIA_TYPE        415
#define HTTP_RANGE_NOT_SATISFIABLE         416
#define HTTP_EXPECTATION_FAILED            417
#define HTTP_UNPROCESSABLE_ENTITY          422
#define HTTP_LOCKED                        423
#define HTTP_FAILED_DEPENDENCY             424
#define HTTP_INTERNAL_SERVER_ERROR         500
#define HTTP_NOT_IMPLEMENTED               501
#define HTTP_BAD_GATEWAY                   502
#define HTTP_SERVICE_UNAVAILABLE           503
#define HTTP_GATEWAY_TIME_OUT              504
#define HTTP_VERSION_NOT_SUPPORTED         505
#define HTTP_VARIANT_ALSO_VARIES           506
#define HTTP_INSUFFICIENT_STORAGE          507
#define HTTP_NOT_EXTENDED                  510

#define DOCUMENT_FOLLOWS    HTTP_OK
#define PARTIAL_CONTENT     HTTP_PARTIAL_CONTENT
#define MULTIPLE_CHOICES    HTTP_MULTIPLE_CHOICES
#define MOVED               HTTP_MOVED_PERMANENTLY
#define REDIRECT            HTTP_MOVED_TEMPORARILY
#define USE_LOCAL_COPY      HTTP_NOT_MODIFIED
#define BAD_REQUEST         HTTP_BAD_REQUEST
#define AUTH_REQUIRED       HTTP_UNAUTHORIZED
#define FORBIDDEN           HTTP_FORBIDDEN
#define NOT_FOUND           HTTP_NOT_FOUND
#define METHOD_NOT_ALLOWED  HTTP_METHOD_NOT_ALLOWED
#define NOT_ACCEPTABLE      HTTP_NOT_ACCEPTABLE
#define LENGTH_REQUIRED     HTTP_LENGTH_REQUIRED
#define PRECONDITION_FAILED HTTP_PRECONDITION_FAILED
#define SERVER_ERROR        HTTP_INTERNAL_SERVER_ERROR
#define NOT_IMPLEMENTED     HTTP_NOT_IMPLEMENTED
#define BAD_GATEWAY         HTTP_BAD_GATEWAY
#define VARIANT_ALSO_VARIES HTTP_VARIANT_ALSO_VARIES

#define ap_is_HTTP_INFO(x)         (((x) >= 100)&&((x) < 200))
#define ap_is_HTTP_SUCCESS(x)      (((x) >= 200)&&((x) < 300))
#define ap_is_HTTP_REDIRECT(x)     (((x) >= 300)&&((x) < 400))
#define ap_is_HTTP_ERROR(x)        (((x) >= 400)&&((x) < 600))
#define ap_is_HTTP_CLIENT_ERROR(x) (((x) >= 400)&&((x) < 500))
#define ap_is_HTTP_SERVER_ERROR(x) (((x) >= 500)&&((x) < 600))

#define ap_status_drops_connection(x) \
                                   (((x) == HTTP_BAD_REQUEST)           || \
                                    ((x) == HTTP_REQUEST_TIME_OUT)      || \
                                    ((x) == HTTP_LENGTH_REQUIRED)       || \
                                    ((x) == HTTP_REQUEST_ENTITY_TOO_LARGE) || \
                                    ((x) == HTTP_REQUEST_URI_TOO_LARGE) || \
                                    ((x) == HTTP_INTERNAL_SERVER_ERROR) || \
                                    ((x) == HTTP_SERVICE_UNAVAILABLE) || \
				    ((x) == HTTP_NOT_IMPLEMENTED))

/* Methods recognized (but not necessarily handled) by the server.
 * These constants are used in bit shifting masks of size int, so it is
 * unsafe to have more methods than bits in an int.  HEAD == M_GET.
 */
#define M_GET        0
#define M_PUT        1
#define M_POST       2
#define M_DELETE     3
#define M_CONNECT    4
#define M_OPTIONS    5
#define M_TRACE      6
#define M_PATCH      7
#define M_PROPFIND   8
#define M_PROPPATCH  9
#define M_MKCOL     10
#define M_COPY      11
#define M_MOVE      12
#define M_LOCK      13
#define M_UNLOCK    14
#define M_INVALID   15

#define METHODS     16

#define CGI_MAGIC_TYPE "application/x-httpd-cgi"
#define INCLUDES_MAGIC_TYPE "text/x-server-parsed-html"
#define INCLUDES_MAGIC_TYPE3 "text/x-server-parsed-html3"
#define MAP_FILE_MAGIC_TYPE "application/x-type-map"
#define ASIS_MAGIC_TYPE "httpd/send-as-is"
#define DIR_MAGIC_TYPE "httpd/unix-directory"
#define STATUS_MAGIC_TYPE "application/x-httpd-status"

/*
 * Define the HTML doctype strings centrally.
 */
#define DOCTYPE_HTML_2_0  "<!DOCTYPE HTML PUBLIC \"-//IETF//" \
                          "DTD HTML 2.0//EN\">\n"
#define DOCTYPE_HTML_3_2  "<!DOCTYPE HTML PUBLIC \"-//W3C//" \
                          "DTD HTML 3.2 Final//EN\">\n"
#define DOCTYPE_HTML_4_0S "<!DOCTYPE HTML PUBLIC \"-//W3C//" \
                          "DTD HTML 4.0//EN\"\n" \
                          "\"http://www.w3.org/TR/REC-html40/strict.dtd\">\n"
#define DOCTYPE_HTML_4_0T "<!DOCTYPE HTML PUBLIC \"-//W3C//" \
                          "DTD HTML 4.0 Transitional//EN\"\n" \
                          "\"http://www.w3.org/TR/REC-html40/loose.dtd\">\n"
#define DOCTYPE_HTML_4_0F "<!DOCTYPE HTML PUBLIC \"-//W3C//" \
                          "DTD HTML 4.0 Frameset//EN\"\n" \
                          "\"http://www.w3.org/TR/REC-html40/frameset.dtd\">\n"

/* Just in case your linefeed isn't the one the other end is expecting. */
#define LF 10
#define CR 13
#define CRLF "\015\012"
#define OS_ASC(c) (c)

/* Possible values for request_rec.read_body (set by handling module):
 *    REQUEST_NO_BODY          Send 413 error if message has any body
 *    REQUEST_CHUNKED_ERROR    Send 411 error if body without Content-Length
 *    REQUEST_CHUNKED_DECHUNK  If chunked, remove the chunks for me.
 *    REQUEST_CHUNKED_PASS     Pass the chunks to me without removal.
 */
#define REQUEST_NO_BODY          0
#define REQUEST_CHUNKED_ERROR    1
#define REQUEST_CHUNKED_DECHUNK  2
#define REQUEST_CHUNKED_PASS     3

/* Things which may vary per file-lookup WITHIN a request ---
 * e.g., state of MIME config.  Basically, the name of an object, info
 * about the object, and any other info we may ahve which may need to
 * change as we go poking around looking for it (e.g., overridden by
 * .htaccess files).
 *
 * Note how the default state of almost all these things is properly
 * zero, so that allocating it with pcalloc does the right thing without
 * a whole lot of hairy initialization... so long as we are willing to
 * make the (fairly) portable assumption that the bit pattern of a NULL
 * pointer is, in fact, zero.
 */

/* This represents the result of calling htaccess; these are cached for
 * each request.
 */
struct htaccess_result {
	char *dir;	/* the directory to which this applies */
	int override;	/* the overrides allowed for the .htaccess file */
	void *htaccess;	/* the configuration directives */
	/* the next one, or NULL if no more; N.B. never change this */
	const struct htaccess_result *next;
};

typedef struct conn_rec conn_rec;
typedef struct server_rec server_rec;
typedef struct request_rec request_rec;
typedef struct listen_rec listen_rec;

#include "util_uri.h"

enum proxyreqtype {
    NOT_PROXY=0,
    STD_PROXY,
    PROXY_PASS
};

struct request_rec {

	ap_pool *pool;
	conn_rec *connection;
	server_rec *server;

	request_rec *next;		/* If we wind up getting redirected,
				 * pointer to the request we redirected to.
				 */
	request_rec *prev;		/* If this is an internal redirect,
				 * pointer to where we redirected *from*.
				 */

	request_rec *main;	/* If this is a sub_request (see request.h) 
				 * pointer back to the main request.
				 */

	/* Info about the request itself... we begin with stuff that only
	* protocol.c should ever touch...
	*/

	char *the_request;	/* First line of request, so we can log it */
	int assbackwards;		/* HTTP/0.9, "simple" request */
	enum proxyreqtype proxyreq;/* A proxy request (calculated during
				 * post_read_request or translate_name) */
	int header_only;		/* HEAD request, as opposed to GET */
	char *protocol;		/* Protocol, as given to us, or HTTP/0.9 */
	int proto_num;		/* Number version of protocol; 1.1 = 1001 */
	const char *hostname;	/* Host, as set by full URI or Host: */

	time_t request_time;	/* When the request started */

	const char *status_line;	/* Status line, if set by script */
	int status;			/* In any case */

	/* Request method, two ways; also, protocol, etc..
	* Outside of protocol.c,
	* look, but don't touch.
	*/

	const char *method;		/* GET, HEAD, POST, etc. */
	int method_number;		/* M_GET, M_POST, etc. */

	/*
	allowed is a bitvector of the allowed methods.

	A handler must ensure that the request method is one that
	it is capable of handling.  Generally modules should DECLINE
	any request methods they do not handle.  Prior to aborting the
	handler like this the handler should set r->allowed to the list
	of methods that it is willing to handle.  This bitvector is used
	to construct the "Allow:" header required for OPTIONS requests,
	and METHOD_NOT_ALLOWED and NOT_IMPLEMENTED status codes.

	Since the default_handler deals with OPTIONS, all modules can
	usually decline to deal with OPTIONS.  TRACE is always allowed,
	modules don't need to set it explicitly.

	Since the default_handler will always handle a GET, a
	module which does *not* implement GET should probably return
	METHOD_NOT_ALLOWED.  Unfortunately this means that a Script GET
	handler can't be installed by mod_actions.
	*/
	int allowed;		/* Allowed methods - for 405, OPTIONS, etc */

	int sent_bodyct;		/* byte count in stream is for body */
	off_t bytes_sent;		/* body byte count, for easy access */
	time_t mtime;		/* Time the resource was last modified */

	/* HTTP/1.1 connection-level features */

	int chunked;		/* sending chunked transfer-coding */
	int byterange;		/* number of byte ranges */
	char *boundary;		/* multipart/byteranges boundary */
	const char *range;		/* The Range: header */
	off_t clength;		/* The "real" content length */

	long remaining;		/* bytes left to read */
	long read_length;		/* bytes that have been read */
	int read_body;		/* how the request body should be read */
	int read_chunked;		/* reading chunked transfer-coding */
	unsigned expecting_100;	/* is client waiting for a 100 response? */

	/* MIME header environments, in and out.  Also, an array containing
	* environment variables to be passed to subprocesses, so people can
	* write modules to add to that environment.
	*
	* The difference between headers_out and err_headers_out is that the
	* latter are printed even on error, and persist across internal
	* redirects (so the headers printed for ErrorDocument handlers will
	* have them).
	*
	* The 'notes' table is for notes from one module to another, with no
	* other set purpose in mind...
	*/

	table *headers_in;
	table *headers_out;
	table *err_headers_out;
	table *subprocess_env;
	table *notes;

	/* content_type, handler, content_encoding, content_language, and all
	* content_languages MUST be lowercased strings.  They may be pointers
	* to static strings; they should not be modified in place.
	*/
	const char *content_type;	/* Break these out we dispatch on 'em */
	const char *handler;	/* What we *really* dispatch on */

	const char *content_encoding;
	const char *content_language;	/* for back-compat. only- do not use */
	array_header *content_languages;	/* array of (char*) */

	char *vlist_validator;      /* variant list validator (if negotiated) */

	int no_cache;
	int no_local_copy;

	/* What object is being requested (either directly, or via include
	* or content-negotiation mapping).
	*/

	char *unparsed_uri;	/* the uri without any parsing performed */
	char *uri;			/* the path portion of the URI */
	char *filename;		/* filename if found, otherwise NULL */
	char *path_info;
	char *args;			/* QUERY_ARGS, if any */
	struct stat finfo;	/* ST_MODE set to zero if no such file */
	uri_components parsed_uri;	/* components of uri, dismantled */

	/* Various other config info which may change with .htaccess files
	* These are config vectors, with one void* pointer for each module
	* (the thing pointed to being the module's business).
	*/

	void *per_dir_config;	/* Options set in config files, etc. */
	void *request_config;	/* Notes on *this* request */

	/*
	* a linked list of the configuration directives in the .htaccess files
	* accessed by this request.
	* N.B. always add to the head of the list, _never_ to the end.
	* that way, a sub request's list can (temporarily) point to a parent's
	* list
	*/
	const struct htaccess_result *htaccess;

	/* On systems with case insensitive file systems (Windows, OS/2, etc.),
	* r->filename is case canonicalized (folded to either lower or upper
	* case, depending on the specific system) to accomodate file access
	* checking. case_preserved_filename is the same as r->filename
	* except case is preserved. There is at least one instance where Apache
	* needs access to the case preserved filename: Java class files
	* published with WebDAV need to preserve filename case to make the
	* Java compiler happy.
	*/
	char *case_preserved_filename;

	/* Things placed at the end of the record to avoid breaking binary
	* compatibility.  It would be nice to remember to reorder the entire
	* record to improve 64bit alignment the next time we need to break
	* binary compatibility for some other reason.
	*/

	ap_ctx *ctx;
};


/* Things which are per connection
 */

struct conn_rec {

	ap_pool *pool;
	server_rec *server;
	server_rec *base_server;/* Physical vhost this conn come in on */
	void *vhost_lookup_data;	/* used by http_vhost.c */

	/* Information about the connection itself */

	int child_num;		/* The number of the child handling conn_rec */
	BUFF *client;		/* Connection to the guy */

	/* Who is the client? */

	struct sockaddr_storage local_addr;	/* local address */
	struct sockaddr_storage remote_addr;	/* remote address */
	char *remote_ip;		/* Client's IP address */
	char *remote_host;		/* Client's DNS name, if known.
				 * NULL if DNS hasn't been checked,
				 * "" if it has and no address was found.
				 * N.B. Only access this though
				 * get_remote_host() */
	char *remote_logname;	/* Only ever set if doing rfc1413 lookups.
				 * N.B. Only access this through
				 * get_remote_logname() */
	char *user;			/* If an authentication check was made,
				 * this gets set to the user name.  We assume
				 * that there's only one user per connection(!)
				 */
	char *ap_auth_type;		/* Ditto. */

	unsigned aborted:1;		/* Are we still talking? */
	signed int keepalive:2;	/* Are we using HTTP Keep-Alive?
				 * -1 fatal error, 0 undecided, 1 yes */
	unsigned keptalive:1;	/* Did we use HTTP Keep-Alive? */
	signed int double_reverse:2;/* have we done double-reverse DNS?
				 * -1 yes/failure, 0 not yet, 1 yes/success */
	int keepalives;		/* How many times have we used it? */
	char *local_ip;		/* server IP address */
	char *local_host;		/* used for ap_get_server_name when
				 * UseCanonicalName is set to DNS
				 * (ignores setting of HostnameLookups) */
	ap_ctx *ctx;
};

/* Per-vhost config... */

/* The address 255.255.255.255, when used as a virtualhost address,
 * will become the "default" server when the ip doesn't match other vhosts.
 */
#define DEFAULT_VHOST_ADDR 0xfffffffful

typedef struct server_addr_rec server_addr_rec;
struct server_addr_rec {
	server_addr_rec *next;
	struct sockaddr_storage host_addr;	/* The bound address, for this server */
	unsigned short host_port;	/* The bound port, for this server */
	char *virthost;			/* The name given in <VirtualHost> */
};

struct server_rec {

	server_rec *next;

	/* description of where the definition came from */
	const char *defn_name;
	unsigned defn_line_number;

	/* Full locations of server config info */

	char *srm_confname;
	char *access_confname;

	/* Contact information */

	char *server_admin;
	char *server_hostname;
	unsigned short port;	/* for redirects, etc. */

	/* Log files --- note that transfer log is now in the modules... */

	char *error_fname;
	FILE *error_log;
	int loglevel;

	/* Module-specific configuration for server, and defaults... */

	int is_virtual;		/* true if this is the virtual server */
	void *module_config;	/* Config vector containing pointers to
				 * modules' per-server config structures.
				 */
	void *lookup_defaults;	/* MIME type info, etc., before we start
				 * checking per-directory info.
				 */
	/* Transaction handling */

	server_addr_rec *addrs;
	int timeout;		/* Timeout, in seconds, before we give up */
	int keep_alive_timeout;	/* Seconds we'll wait for another request */
	int keep_alive_max;		/* Maximum requests per connection */
	int keep_alive;		/* Use persistent connections? */
	int send_buffer_size;	/* size of TCP send buffer (in bytes) */

	char *path;			/* Pathname for ServerPath */
	int pathlen;		/* Length of path */

	array_header *names;	/* Normal names for ServerAlias servers */
	array_header *wild_names;/* Wildcarded names for ServerAlias servers */

	uid_t server_uid;     /* effective user id when calling exec wrapper */
	gid_t server_gid;    /* effective group id when calling exec wrapper */

	int limit_req_line;      /* limit on size of the HTTP request line    */
	int limit_req_fieldsize; /* limit on size of any request header field */
	int limit_req_fields;    /* limit on number of request header fields  */

	ap_ctx *ctx;
};

/* These are more like real hosts than virtual hosts */
struct listen_rec {
	listen_rec *next;
	struct sockaddr_storage local_addr;	/* local IP address and port */
	int fd;
	int used;			/* Only used during restart */
	/* more stuff here, like which protocol is bound to the port */
};

/* Prototypes for utilities... util.c.  */
extern void ap_util_init(void);

/* Time */
extern API_VAR_EXPORT const char ap_month_snames[12][4];
extern API_VAR_EXPORT const char ap_day_snames[7][4];

API_EXPORT(struct tm *) ap_get_gmtoff(int *tz);
API_EXPORT(char *) ap_get_time(void);
API_EXPORT(char *) ap_field_noparam(pool *p, const char *intype);
API_EXPORT(char *) ap_ht_time(pool *p, time_t t, const char *fmt, int gmt);
API_EXPORT(char *) ap_gm_timestr_822(pool *p, time_t t);

/* String handling. The *_nc variants allow you to use non-const char **s as
   arguments (unfortunately C won't automatically convert a char ** to a const
   char **) */

API_EXPORT(char *) ap_getword(pool *p, const char **line, char stop);
API_EXPORT(char *) ap_getword_nc(pool *p, char **line, char stop);
API_EXPORT(char *) ap_getword_white(pool *p, const char **line);
API_EXPORT(char *) ap_getword_white_nc(pool *p, char **line);
API_EXPORT(char *) ap_getword_nulls(pool *p, const char **line, char stop);
API_EXPORT(char *) ap_getword_nulls_nc(pool *p, char **line, char stop);
API_EXPORT(char *) ap_getword_conf(pool *p, const char **line);
API_EXPORT(char *) ap_getword_conf_nc(pool *p, char **line);

API_EXPORT(const char *) ap_size_list_item(const char **field, int *len);
API_EXPORT(char *) ap_get_list_item(pool *p, const char **field);
API_EXPORT(int) ap_find_list_item(pool *p, const char *line, const char *tok);

API_EXPORT(char *) ap_get_token(pool *p, const char **accept_line,
    int accept_white);
API_EXPORT(int) ap_find_token(pool *p, const char *line, const char *tok);
API_EXPORT(int) ap_find_last_token(pool *p, const char *line, const char *tok);

API_EXPORT(int) ap_is_url(const char *u);
API_EXPORT(int) ap_unescape_url(char *url);
API_EXPORT(void) ap_no2slash(char *name);
API_EXPORT(void) ap_getparents(char *name);
API_EXPORT(char *) ap_escape_path_segment(pool *p, const char *s);
API_EXPORT(char *) ap_os_escape_path(pool *p, const char *path, int partial);
#define ap_escape_uri(ppool,path) ap_os_escape_path(ppool,path,1)
API_EXPORT(char *) ap_escape_html(pool *p, const char *s);
API_EXPORT(char *) ap_construct_server(pool *p, const char *hostname,
    unsigned port, const request_rec *r);
API_EXPORT(char *) ap_escape_logitem(pool *p, const char *str);
API_EXPORT(size_t) ap_escape_errorlog_item(char *dest, const char *source,
    size_t buflen);
API_EXPORT(char *) ap_escape_shell_cmd(pool *p, const char *s);

API_EXPORT(int) ap_count_dirs(const char *path);
API_EXPORT(char *) ap_make_dirstr_prefix(char *d, const char *s, int n);
API_EXPORT(char *) ap_make_dirstr_parent(pool *p, const char *s);
/* deprecated.  The previous two routines are preferred. */
API_EXPORT(char *) ap_make_dirstr(pool *a, const char *s, int n);
API_EXPORT(char *) ap_make_full_path(pool *a, const char *dir, const char *f);

API_EXPORT(int) ap_is_matchexp(const char *str);
API_EXPORT(int) ap_strcmp_match(const char *str, const char *exp);
API_EXPORT(int) ap_strcasecmp_match(const char *str, const char *exp);
API_EXPORT(char *) ap_stripprefix(const char *bigstring, const char *prefix);
API_EXPORT(char *) ap_strcasestr(const char *s1, const char *s2);
API_EXPORT(char *) ap_pbase64decode(pool *p, const char *bufcoded);
API_EXPORT(char *) ap_pbase64encode(pool *p, char *string);
API_EXPORT(char *) ap_uudecode(pool *p, const char *bufcoded);
API_EXPORT(char *) ap_uuencode(pool *p, char *string);

API_EXPORT(int)    ap_regexec(const regex_t *preg, const char *string,
    size_t nmatch, regmatch_t pmatch[], int eflags);
API_EXPORT(size_t) ap_regerror(int errcode, const regex_t *preg,
    char *errbuf, size_t errbuf_size);
API_EXPORT(char *) ap_pregsub(pool *p, const char *input, const char *source,
    size_t nmatch, regmatch_t pmatch[]);

API_EXPORT(void) ap_content_type_tolower(char *);
API_EXPORT(void) ap_str_tolower(char *);
API_EXPORT(int) ap_ind(const char *, char);	/* Sigh... */
API_EXPORT(int) ap_rind(const char *, char);

API_EXPORT(char *) ap_escape_quotes (pool *p, const char *instring);
API_EXPORT(void) ap_remove_spaces(char *dest, char *src);

/* Common structure for reading of config files / passwd files etc. */
typedef struct {
    int (*getch) (void *param);	/* a getc()-like function */
    /* a fgets()-like function */
    void *(*getstr) (void *buf, size_t bufsiz, void *param);
    int (*close) (void *param);	/* a close hander function */
    void *param;		/* the argument passed to getch/getstr/close */
    const char *name;		/* the filename / description */
    unsigned line_number;	/* current line number, starting at 1 */
} configfile_t;

/* Open a configfile_t as FILE, return open configfile_t struct pointer */
API_EXPORT(configfile_t *) ap_pcfg_openfile(pool *p, const char *name);

/* Allocate a configfile_t handle with user defined functions and params */
API_EXPORT(configfile_t *) ap_pcfg_open_custom(pool *p, const char *descr,
    void *param, int(*getc_func)(void*),
    void *(*gets_func) (void *buf, size_t bufsiz, void *param),
    int(*close_func)(void *param));

/* Read one line from open configfile_t, strip LF, increase line number */
API_EXPORT(int) ap_cfg_getline(char *buf, size_t bufsize, configfile_t *cfp);

/* Read one char from open configfile_t, increase line number upon LF */
API_EXPORT(int) ap_cfg_getc(configfile_t *cfp);

/* Detach from open configfile_t, calling the close handler */
API_EXPORT(int) ap_cfg_closefile(configfile_t *cfp);

/* Misc system hackery */

API_EXPORT(uid_t) ap_uname2id(const char *name);
API_EXPORT(gid_t) ap_gname2id(const char *name);
API_EXPORT(int) ap_is_directory(const char *name);
API_EXPORT(int) ap_is_rdirectory(const char *name);
API_EXPORT(int) ap_can_exec(const struct stat *);
API_EXPORT(void) ap_chdir_file(const char *file);

#ifndef HAVE_CANONICAL_FILENAME
/*
 *  We can't define these in os.h because of dependence on pool pointer.
 */
#define ap_os_canonical_filename(p,f)  (f)
#define ap_os_case_canonical_filename(p,f)  (f)
#define ap_os_systemcase_filename(p,f)  (f)
#else
API_EXPORT(char *) ap_os_canonical_filename(pool *p, const char *file);
#define ap_os_case_canonical_filename(p,f) ap_os_canonical_filename(p,f)
#define ap_os_systemcase_filename(p,f) ap_os_canonical_filename(p,f)
#endif


API_EXPORT(char *) ap_get_local_host(pool *);
API_EXPORT(struct sockaddr *) ap_get_virthost_addr(char *hostname,
    unsigned short *port);

extern API_VAR_EXPORT time_t ap_restart_time;

/*
 * Apache tries to keep all of its long term filehandles (such as log files,
 * and sockets) above this number.  This is to workaround problems in many
 * third party libraries that are compiled with a small FD_SETSIZE.  There
 * should be no reason to lower this, because it's only advisory.  If a file
 * can't be allocated above this number then it will remain in the "slack"
 * area.
 *
 * Only the low slack line is used by default.
 */
#ifndef LOW_SLACK_LINE
#define LOW_SLACK_LINE	15
#endif

/*
 * The ap_slack() function takes a fd, and tries to move it above the indicated
 * line.  It returns an fd which may or may not have moved above the line, and
 * never fails.  If the high line was requested and it fails it will also try
 * the low line.
 */
int ap_slack(int fd, int line);
#define AP_SLACK_LOW	1
#define AP_SLACK_HIGH	2

API_EXPORT(char *) ap_escape_quotes(pool *p, const char *instr);

/*
 * Redefine assert() to something more useful for an Apache...
 */
API_EXPORT(void) ap_log_assert(const char *szExp, const char *szFile, int nLine)
    __attribute__((noreturn));
#define ap_assert(exp) ((exp) ? (void)0 : ap_log_assert(#exp,__FILE__,0))

#define OPTIMIZE_TIMEOUTS

/* A set of flags which indicate places where the server should raise(SIGSTOP).
 * This is useful for debugging, because you can then attach to that process
 * with gdb and continue.  This is important in cases where one_process
 * debugging isn't possible.
 */
#define SIGSTOP_DETACH			1
#define SIGSTOP_MAKE_CHILD		2
#define SIGSTOP_SPAWN_CHILD		4
#define SIGSTOP_PIPED_LOG_SPAWN		8
#define SIGSTOP_CGI_CHILD		16

#ifdef DEBUG_SIGSTOP
extern int raise_sigstop_flags;
#define RAISE_SIGSTOP(x)	do { \
	if (raise_sigstop_flags & SIGSTOP_##x) raise(SIGSTOP);\
    } while (0)
#else
#define RAISE_SIGSTOP(x)
#endif

API_EXPORT(extern const char *) ap_psignature(const char *prefix, request_rec *r);

/* strtoul does not exist on sunos4. */
#ifdef strtoul
#undef strtoul
#endif
#define strtoul strtoul_is_not_a_portable_function_use_strtol_instead

#ifdef __cplusplus
}
#endif

#endif	/* !APACHE_HTTPD_H */
@


1.30
log
@fix some fallout from the >2G commit. namely allow for all byte counters to
report the correct size when it exceeds a long's capacity.

From Dan Harnett <daniel @@ harnett . name>
@
text
@d1 1
a1 1
/* $OpenBSD: httpd.h,v 1.29 2009/06/02 23:36:40 pyr Exp $ */
@


1.29
log
@Fix the way apache reports Content-Length by promoting the clength field
of request_rec from long to off_t, which makes it 64bit on i386.
This allows files bigger than 2gig to be correctly served on arches
where long is only 32bits.

Warning: this introduces an ABI break, and hence some third party
apache modules will need to be rebuilt to correctly link to this new
apache.

ok miod@@, deraadt@@
@
text
@d1 1
a1 1
/* $OpenBSD: httpd.h,v 1.28 2008/05/09 08:06:28 mbalmer Exp $ */
d738 1
a738 1
	long bytes_sent;		/* body byte count, for easy access */
@


1.28
log
@Add support for IPv6 while keeping the default at IPv4 to not break
existing installations.  See the documentation for the IPv6 related
configuration.

This changes the module ABI since addresses are now struct addrinfo.

This has been tested by many people and run on production machines
for several months.

feedback many, ok todd
@
text
@d1 1
a1 1
/* $OpenBSD: httpd.h,v 1.27 2006/02/22 15:07:12 henning Exp $ */
d747 1
a747 1
	long clength;		/* The "real" content length */
@


1.27
log
@allow ressource limits for child processes to be set.
from Chris Kuethe <chris.kuethe@@gmail.com>
running at UofA for months now, ok beck niallo, also tested mbalmer
@
text
@d1 1
a1 1
/* $OpenBSD: httpd.h,v 1.26 2005/06/15 00:00:16 niallo Exp $ */
d69 7
d857 2
a858 2
	struct sockaddr_in local_addr;	/* local address */
	struct sockaddr_in remote_addr;	/* remote address */
d898 1
a898 1
	struct in_addr host_addr;	/* The bound address, for this server */
d900 1
a900 1
	char *virthost;		/* The name given in <VirtualHost> */
d952 1
a952 1
	uid_t server_uid;      /* effective user id when calling exec wrapper */
d960 1
a960 1
	};
d962 2
a963 2
	/* These are more like real hosts than virtual hosts */
	struct listen_rec {
d965 1
a965 1
	struct sockaddr_in local_addr;	/* local IP address and port */
d971 1
a971 3
/* Prototypes for utilities... util.c.
 */

d1106 1
a1106 1
API_EXPORT(unsigned long) ap_get_virthost_addr(char *hostname,
@


1.26
log
@zap usage of __LINE__ so we can do KNF without binary changes.

ok henning@@
@
text
@d1 1
a1 1
/* $OpenBSD: httpd.h,v 1.25 2005/03/28 23:26:51 niallo Exp $ */
d355 17
@


1.25
log
@KNF

no binary changes.
@
text
@d1 1
a1 1
/* $OpenBSD$ */
d1120 1
a1120 1
#define ap_assert(exp) ((exp) ? (void)0 : ap_log_assert(#exp,__FILE__,__LINE__))
@


1.24
log
@cleanup and unifdef'ing, no change in object files
work by Daniel Ouellet <daniel@@presscom.net>
@
text
@d1 2
d80 1
a80 1
 * pool stuff but before buff.h because the buffer stuff uses the EAPI, too. 
d116 1
a116 1
/* 
d120 1
a120 1
 * respective config. file. 
d137 6
a142 2
#define ap_http_method(r)   (((r)->ctx != NULL && ap_ctx_get((r)->ctx, "ap::http::method") != NULL) ? ((char *)ap_ctx_get((r)->ctx, "ap::http::method")) : "http")
#define ap_default_port(r)  (((r)->ctx != NULL && ap_ctx_get((r)->ctx, "ap::default::port") != NULL) ? atoi((char *)ap_ctx_get((r)->ctx, "ap::default::port")) : DEFAULT_HTTP_PORT)
d308 1
a308 1
 *                 
d332 1
a332 1
 * Path to Shared Memory Files 
d361 2
a362 2
 * It defaults to 511 instead of 512 because some systems store it 
 * as an 8-bit datatype; 512 truncated to 8-bits is 0, while 511 is 
d397 1
a397 1
 * The default default character set name to add if AddDefaultCharset is 
d409 1
a409 1
 * "Product tokens should be short and to the point -- use of them for 
d424 4
a427 4
    SrvTk_MIN,		/* eg: Apache/1.3.0 */
    SrvTk_OS,		/* eg: Apache/1.3.0 (UNIX) */
    SrvTk_FULL,		/* eg: Apache/1.3.0 (UNIX) PHP/3.0 FooBar/1.2b */
    SrvTk_PRODUCT_ONLY	/* eg: Apache */
d447 1
a447 1
#define DONE -2			/* Module has served the response completely 
d628 5
a632 5
    char *dir;			/* the directory to which this applies */
    int override;		/* the overrides allowed for the .htaccess file */
    void *htaccess;		/* the configuration directives */
/* the next one, or NULL if no more; N.B. never change this */
    const struct htaccess_result *next;
d650 3
a652 3
    ap_pool *pool;
    conn_rec *connection;
    server_rec *server;
d654 1
a654 1
    request_rec *next;		/* If we wind up getting redirected,
d657 1
a657 1
    request_rec *prev;		/* If this is an internal redirect,
d661 1
a661 1
    request_rec *main;		/* If this is a sub_request (see request.h) 
d665 7
a671 7
    /* Info about the request itself... we begin with stuff that only
     * protocol.c should ever touch...
     */

    char *the_request;		/* First line of request, so we can log it */
    int assbackwards;		/* HTTP/0.9, "simple" request */
    enum proxyreqtype proxyreq;/* A proxy request (calculated during
d673 4
a676 4
    int header_only;		/* HEAD request, as opposed to GET */
    char *protocol;		/* Protocol, as given to us, or HTTP/0.9 */
    int proto_num;		/* Number version of protocol; 1.1 = 1001 */
    const char *hostname;	/* Host, as set by full URI or Host: */
d678 1
a678 1
    time_t request_time;	/* When the request started */
d680 2
a681 2
    const char *status_line;	/* Status line, if set by script */
    int status;			/* In any case */
d683 4
a686 3
    /* Request method, two ways; also, protocol, etc..  Outside of protocol.c,
     * look, but don't touch.
     */
d688 2
a689 2
    const char *method;		/* GET, HEAD, POST, etc. */
    int method_number;		/* M_GET, M_POST, etc. */
d691 1
a691 1
    /*
d710 2
a711 71
    */
    int allowed;		/* Allowed methods - for 405, OPTIONS, etc */

    int sent_bodyct;		/* byte count in stream is for body */
    long bytes_sent;		/* body byte count, for easy access */
    time_t mtime;		/* Time the resource was last modified */

    /* HTTP/1.1 connection-level features */

    int chunked;		/* sending chunked transfer-coding */
    int byterange;		/* number of byte ranges */
    char *boundary;		/* multipart/byteranges boundary */
    const char *range;		/* The Range: header */
    long clength;		/* The "real" content length */

    long remaining;		/* bytes left to read */
    long read_length;		/* bytes that have been read */
    int read_body;		/* how the request body should be read */
    int read_chunked;		/* reading chunked transfer-coding */
    unsigned expecting_100;	/* is client waiting for a 100 response? */

    /* MIME header environments, in and out.  Also, an array containing
     * environment variables to be passed to subprocesses, so people can
     * write modules to add to that environment.
     *
     * The difference between headers_out and err_headers_out is that the
     * latter are printed even on error, and persist across internal redirects
     * (so the headers printed for ErrorDocument handlers will have them).
     *
     * The 'notes' table is for notes from one module to another, with no
     * other set purpose in mind...
     */

    table *headers_in;
    table *headers_out;
    table *err_headers_out;
    table *subprocess_env;
    table *notes;

    /* content_type, handler, content_encoding, content_language, and all
     * content_languages MUST be lowercased strings.  They may be pointers
     * to static strings; they should not be modified in place.
     */
    const char *content_type;	/* Break these out --- we dispatch on 'em */
    const char *handler;	/* What we *really* dispatch on           */

    const char *content_encoding;
    const char *content_language;	/* for back-compat. only -- do not use */
    array_header *content_languages;	/* array of (char*) */

    char *vlist_validator;      /* variant list validator (if negotiated) */

    int no_cache;
    int no_local_copy;

    /* What object is being requested (either directly, or via include
     * or content-negotiation mapping).
     */

    char *unparsed_uri;		/* the uri without any parsing performed */
    char *uri;			/* the path portion of the URI */
    char *filename;		/* filename if found, otherwise NULL */
    char *path_info;
    char *args;			/* QUERY_ARGS, if any */
    struct stat finfo;		/* ST_MODE set to zero if no such file */
    uri_components parsed_uri;	/* components of uri, dismantled */

    /* Various other config info which may change with .htaccess files
     * These are config vectors, with one void* pointer for each module
     * (the thing pointed to being the module's business).
     */
d713 98
a810 27
    void *per_dir_config;	/* Options set in config files, etc. */
    void *request_config;	/* Notes on *this* request */

/*
 * a linked list of the configuration directives in the .htaccess files
 * accessed by this request.
 * N.B. always add to the head of the list, _never_ to the end.
 * that way, a sub request's list can (temporarily) point to a parent's list
 */
    const struct htaccess_result *htaccess;

    /* On systems with case insensitive file systems (Windows, OS/2, etc.), 
     * r->filename is case canonicalized (folded to either lower or upper 
     * case, depending on the specific system) to accomodate file access
     * checking. case_preserved_filename is the same as r->filename 
     * except case is preserved. There is at least one instance where Apache 
     * needs access to the case preserved filename: Java class files published 
     * with WebDAV need to preserve filename case to make the Java compiler 
     * happy.
     */
    char *case_preserved_filename;

/* Things placed at the end of the record to avoid breaking binary
 * compatibility.  It would be nice to remember to reorder the entire
 * record to improve 64bit alignment the next time we need to break
 * binary compatibility for some other reason.
 */
d812 1
a812 1
    ap_ctx *ctx;
d821 16
a836 16
    ap_pool *pool;
    server_rec *server;
    server_rec *base_server;	/* Physical vhost this conn come in on */
    void *vhost_lookup_data;	/* used by http_vhost.c */

    /* Information about the connection itself */

    int child_num;		/* The number of the child handling conn_rec */
    BUFF *client;		/* Connection to the guy */

    /* Who is the client? */

    struct sockaddr_in local_addr;	/* local address */
    struct sockaddr_in remote_addr;	/* remote address */
    char *remote_ip;		/* Client's IP address */
    char *remote_host;		/* Client's DNS name, if known.
d841 1
a841 1
    char *remote_logname;	/* Only ever set if doing rfc1413 lookups.
d844 1
a844 1
    char *user;			/* If an authentication check was made,
d848 1
a848 1
    char *ap_auth_type;		/* Ditto. */
d850 2
a851 2
    unsigned aborted:1;		/* Are we still talking? */
    signed int keepalive:2;	/* Are we using HTTP Keep-Alive?
d853 2
a854 2
    unsigned keptalive:1;	/* Did we use HTTP Keep-Alive? */
    signed int double_reverse:2;/* have we done double-reverse DNS?
d856 3
a858 3
    int keepalives;		/* How many times have we used it? */
    char *local_ip;		/* server IP address */
    char *local_host;		/* used for ap_get_server_name when
d861 1
a861 1
    ap_ctx *ctx;
d873 4
a876 4
    server_addr_rec *next;
    struct in_addr host_addr;	/* The bound address, for this server */
    unsigned short host_port;	/* The bound port, for this server */
    char *virthost;		/* The name given in <VirtualHost> */
d881 1
a881 1
    server_rec *next;
d883 3
a885 3
    /* description of where the definition came from */
    const char *defn_name;
    unsigned defn_line_number;
d887 1
a887 1
    /* Full locations of server config info */
d889 2
a890 2
    char *srm_confname;
    char *access_confname;
d892 1
a892 1
    /* Contact information */
d894 3
a896 3
    char *server_admin;
    char *server_hostname;
    unsigned short port;	/* for redirects, etc. */
d898 1
a898 1
    /* Log files --- note that transfer log is now in the modules... */
d900 3
a902 3
    char *error_fname;
    FILE *error_log;
    int loglevel;
d904 1
a904 1
    /* Module-specific configuration for server, and defaults... */
d906 2
a907 2
    int is_virtual;		/* true if this is the virtual server */
    void *module_config;	/* Config vector containing pointers to
d910 1
a910 1
    void *lookup_defaults;	/* MIME type info, etc., before we start
d913 1
a913 24
    /* Transaction handling */

    server_addr_rec *addrs;
    int timeout;		/* Timeout, in seconds, before we give up */
    int keep_alive_timeout;	/* Seconds we'll wait for another request */
    int keep_alive_max;		/* Maximum requests per connection */
    int keep_alive;		/* Use persistent connections? */
    int send_buffer_size;	/* size of TCP send buffer (in bytes) */

    char *path;			/* Pathname for ServerPath */
    int pathlen;		/* Length of path */

    array_header *names;	/* Normal names for ServerAlias servers */
    array_header *wild_names;	/* Wildcarded names for ServerAlias servers */

    uid_t server_uid;        /* effective user id when calling exec wrapper */
    gid_t server_gid;        /* effective group id when calling exec wrapper */

    int limit_req_line;      /* limit on size of the HTTP request line    */
    int limit_req_fieldsize; /* limit on size of any request header field */
    int limit_req_fields;    /* limit on number of request header fields  */

    ap_ctx *ctx;
};
d915 30
a944 7
/* These are more like real hosts than virtual hosts */
struct listen_rec {
    listen_rec *next;
    struct sockaddr_in local_addr;	/* local IP address and port */
    int fd;
    int used;			/* Only used during restart */        
/* more stuff here, like which protocol is bound to the port */
d979 2
a980 1
API_EXPORT(char *) ap_get_token(pool *p, const char **accept_line, int accept_white);
d993 1
a993 1
				    unsigned port, const request_rec *r);
d996 1
a996 1
                                           size_t buflen);
d1012 1
a1012 1
API_EXPORT(char *) ap_pbase64encode(pool *p, char *string); 
d1014 1
a1014 1
API_EXPORT(char *) ap_uuencode(pool *p, char *string); 
d1017 3
a1019 3
                              size_t nmatch, regmatch_t pmatch[], int eflags);
API_EXPORT(size_t) ap_regerror(int errcode, const regex_t *preg, 
                               char *errbuf, size_t errbuf_size);
d1021 1
a1021 1
                              size_t nmatch, regmatch_t pmatch[]);
d1034 2
a1035 1
    void *(*getstr) (void *buf, size_t bufsiz, void *param); /* a fgets()-like function */
d1047 1
a1047 2
    void *param,
    int(*getc_func)(void*),
d1084 2
a1085 1
API_EXPORT(unsigned long) ap_get_virthost_addr(char *hostname, unsigned short *port);
d1119 1
a1119 1
			    __attribute__((noreturn));
@


1.23
log
@kill more dead code, mostly inside #ifdef SOMENONSENSEONSTUPIDOSES
joint work by Michael Knudsen <e@@molioner.dk> and Daniel Ouellet
<daniel@@presscom.net> with my input
no change in binaries
@
text
@d1086 1
a1086 4
 * Only the low slack line is used by default.  If HIGH_SLACK_LINE is defined
 * then an attempt is also made to keep all non-FILE * files above the high
 * slack line.  This is to work around a Solaris C library limitation, where it
 * uses an unsigned char to store the file descriptor.
a1090 1
/* #define HIGH_SLACK_LINE      255 */
a1110 5
/* The optimized timeout code only works if we're not MULTITHREAD and we're
 * also not using a scoreboard file
 */
#if !defined (MULTITHREAD) && \
    (defined (USE_MMAP_SCOREBOARD) || defined (USE_SHMGET_SCOREBOARD))
a1111 1
#endif
@


1.22
log
@big time httpd cleanup
this diff removes a lot of #ifdef'd stuff that is irrelevant for us.
done by Daniel Ouellet after my advice.
tested by many, ok miod@@
@
text
@a72 1
#ifdef EAPI
a73 1
#endif
a79 1
#ifdef EAPI
a81 1
#endif /* EAPI */
a134 1
#ifdef EAPI
a136 4
#else /* EAPI */
#define ap_http_method(r)	"http"
#define ap_default_port(r)	DEFAULT_HTTP_PORT
#endif /* EAPI */
a327 1
#ifdef EAPI
a333 1
#endif
a426 1
#ifdef EAPI
a427 1
#endif /* EAPI */
a802 1
#ifdef EAPI
a803 1
#endif /* EAPI */
a851 1
#ifdef EAPI
a852 1
#endif /* EAPI */
a925 1
#ifdef EAPI
a926 1
#endif /* EAPI */
a1049 4
#ifdef NEED_STRERROR
char *strerror(int err);
#endif

a1101 3
#ifdef NO_SLACK
#define ap_slack(fd,line)   (fd)
#else
a1104 1
#endif
@


1.21
log
@Apache does not filter terminal escape sequences from its error logs, which
could make it easier for attackers to insert those sequences into terminal
emulators containing vulnerabilities related to escape sequences.

CAN-2003-0020

ok henning@@
@
text
@a94 11
#ifdef OS2
/* Set default for OS/2 file system */
#define HTTPD_ROOT "/os2httpd"
#elif defined(WIN32)
/* Set default for Windows file system */
#define HTTPD_ROOT "/apache"
#elif defined(BEOS) || defined(BONE)
#define HTTPD_ROOT "/boot/home/apache"
#elif defined(NETWARE)
#define HTTPD_ROOT "sys:/apache"
#else
a95 1
#endif
a101 4
#ifdef OS2
/* Set default for OS/2 file system */
#define DOCUMENT_LOCATION  HTTPD_ROOT "/docs"
#else
a102 1
#endif
a138 4
#ifdef NETWARE
#define ap_http_method(r) ap_os_http_method((void*)r)
#define ap_default_port(r) ap_os_default_port((void*)r)
#else
a145 1
#endif
a157 3
#if defined(OS2) || defined(WIN32)
#define DEFAULT_ERRORLOG "logs/error.log"
#else
a158 1
#endif
a188 4
#ifdef OS2
/* Set default for OS/2 file system */
#define DEFAULT_ACCESS_FNAME "htaccess"
#else
a189 1
#endif
a227 4
#if defined(OS2) || defined(WIN32)
/* Set default for OS/2 and Windows file system */
#define SHELL_PATH "CMD.EXE"
#else
a228 1
#endif
a293 5
#ifdef WIN32
#define HARD_SERVER_LIMIT 1024
#elif defined(NETWARE)
#define HARD_SERVER_LIMIT 2048
#else
a295 1
#endif
a578 3
#ifdef CHARSET_EBCDIC
#define ASCIITEXT_MAGIC_TYPE_PREFIX "text/x-ascii-" /* Text files whose content-type starts with this are passed thru unconverted */
#endif /*CHARSET_EBCDIC*/
a601 1
#ifndef CHARSET_EBCDIC
a605 14
#else /* CHARSET_EBCDIC */
#include "ap_ebcdic.h"
/* OSD_POSIX uses the EBCDIC charset. The transition ASCII->EBCDIC is done in
 * the buff package (bread/bputs/bwrite), so everywhere else, we use
 * "native EBCDIC" CR and NL characters. These are therefore defined as
 * '\r' and '\n'.
 * NB: this is not the whole truth - sometimes \015 and \012 are contained
 * in literal (EBCDIC!) strings, so these are not converted but passed.
 */
#define CR '\r'
#define LF '\n'
#define CRLF "\r\n"
#define OS_ASC(c) (os_toascii[c])
#endif /* CHARSET_EBCDIC */
a809 11
#ifdef CHARSET_EBCDIC
    /* We don't want subrequests to modify our current conversion flags.
     * These flags save the state of the conversion flags when subrequests
     * are run.
     */
    struct {
        unsigned conv_in:1;    /* convert ASCII->EBCDIC when read()ing? */
        unsigned conv_out:1;   /* convert EBCDIC->ASCII when write()ing? */
    } ebcdic;
#endif

a1024 9
#if defined(OS2) || defined(WIN32)
API_EXPORT(char *) ap_double_quotes(pool *p, const char *str);
API_EXPORT(char *) ap_caret_escape_args(pool *p, const char *str);
#endif

#ifdef OS2
void os2pathname(char *path);
#endif

a1090 10
#ifdef WIN32
API_EXPORT(char *) ap_os_case_canonical_filename(pool *pPool, const char *szFile);
API_EXPORT(char *) ap_os_systemcase_filename(pool *pPool, const char *szFile);
#elif defined(OS2)
API_EXPORT(char *) ap_os_case_canonical_filename(pool *pPool, const char *szFile);
API_EXPORT(char *) ap_os_systemcase_filename(pool *pPool, const char *szFile);
#elif defined(NETWARE)
API_EXPORT(char *) ap_os_case_canonical_filename(pool *pPool, const char *szFile);
#define ap_os_systemcase_filename(p,f) ap_os_case_canonical_filename(p,f)
#else
a1093 1
#endif
a1094 4
#ifdef CHARSET_EBCDIC
API_EXPORT(int)    ap_checkconv(struct request_rec *r);    /* for downloads */
API_EXPORT(int)    ap_checkconv_in(struct request_rec *r); /* for uploads */
#endif /*#ifdef CHARSET_EBCDIC*/
@


1.20
log
@merge apache 1.3.29 and mod_ssl 2.8.16
ok brad@@
@
text
@d1075 2
@


1.20.2.1
log
@MFC:
Fix by brad@@

Apache does not filter terminal escape sequences from its error logs, which
could make it easier for attackers to insert those sequences into terminal
emulators containing vulnerabilities related to escape sequences.

CAN-2003-0020
@
text
@a1074 2
API_EXPORT(size_t) ap_escape_errorlog_item(char *dest, const char *source,
                                           size_t buflen);
@


1.19
log
@security fix from upcoming apache 1.3.29:
     SECURITY: CAN-2003-0542 (cve.mitre.org)
     Fix buffer overflows in mod_alias and mod_rewrite which occurred if
     one configured a regular expression with more than 9 captures.
     [Andr Malo]

ok markus@@
@
text
@d464 1
a464 1
#define SERVER_BASEREVISION "1.3.28"
d488 1
a488 1
#define APACHE_RELEASE 10328100
@


1.18
log
@merge
@
text
@d294 3
@


1.18.2.1
log
@SECURITY FIX
Fixed by henning@@
CAN-2003-0542 (cve.mitre.org)
Fix buffer overflows in mod_alias and mod_rewrite which occurred if
one configured a regular expression with more than 9 captures.

ok deraadt@@ henning@@
@
text
@a293 3
/* The max number of regex captures that can be expanded by ap_pregsub */
#define AP_MAX_REG_MATCH 10

@


1.18.2.2
log
@MFC:
Fix by brad@@

Apache does not filter terminal escape sequences from its error logs, which
could make it easier for attackers to insert those sequences into terminal
emulators containing vulnerabilities related to escape sequences.

CAN-2003-0020
@
text
@a1074 2
API_EXPORT(size_t) ap_escape_errorlog_item(char *dest, const char *source,
                                           size_t buflen);
@


1.17
log
@merge apache 1.3.27 and mod_ssl 2.8.11
@
text
@d4 1
a4 1
 * Copyright (c) 2000-2002 The Apache Software Foundation.  All rights
d156 4
a163 3
#ifdef NETWARE
#define ap_http_method(r) ap_os_http_method(r)
#else
a164 1
#endif
d167 1
d461 1
a461 1
#define SERVER_BASEREVISION "1.3.27"
d485 1
a485 1
#define APACHE_RELEASE 10327100
@


1.17.2.1
log
@SECURITY FIX
Errata #9
Fixed by henning@@
CAN-2003-0542 (cve.mitre.org)
Fix buffer overflows in mod_alias and mod_rewrite which occurred if
one configured a regular expression with more than 9 captures.

ok deraadt@@ henning@@
@
text
@a292 3
/* The max number of regex captures that can be expanded by ap_pregsub */
#define AP_MAX_REG_MATCH 10

@


1.16
log
@merge
@
text
@d460 1
a460 1
#define SERVER_BASEREVISION "1.3.26"
d484 1
a484 1
#define APACHE_RELEASE 10326100
@


1.16.2.1
log
@SECURITY FIX
Errata #022 (henning@@)
CAN-2003-0542 (cve.mitre.org)
Fix buffer overflows in mod_alias and mod_rewrite which occurred if
one configured a regular expression with more than 9 captures.

ok deraadt@@ henning@@
@
text
@a292 3
/* The max number of regex captures that can be expanded by ap_pregsub */
#define AP_MAX_REG_MATCH 10

@


1.15
log
@fix half baked abortion of a merge to 1.3.23 and take
tree to apache-1.3.24+mod+ssl2.8.8
@
text
@a177 9
/* The name of the log files */
#ifndef DEFAULT_XFERLOG
#if defined(OS2) || defined(WIN32)
#define DEFAULT_XFERLOG "logs/access.log"
#else
#define DEFAULT_XFERLOG "logs/access_log"
#endif
#endif /* DEFAULT_XFERLOG */

d460 1
a460 1
#define SERVER_BASEREVISION "1.3.24"
d484 1
a484 1
#define APACHE_RELEASE 10324100
d1070 1
@


1.14
log
@Apache 1.3.23+mod_ssl-2.8.6-1.3.23 merge
@
text
@d4 1
a4 1
 * Copyright (c) 2000 The Apache Software Foundation.  All rights
d469 1
a469 1
#define SERVER_BASEREVISION "1.3.23"
d493 1
a493 1
#define APACHE_RELEASE 10323100
d1098 5
a1104 1
char *ap_double_quotes(pool *p, char *str);
d1179 3
@


1.13
log
@merge mod_ssl 2.8.4
--
Ok'd by: beck@@
@
text
@d160 3
d164 1
d337 2
d469 1
a469 1
#define SERVER_BASEREVISION "1.3.19"
d493 1
a493 1
#define APACHE_RELEASE 10319100
d658 1
a658 1
#include "ebcdic.h"
d842 1
a842 1
    char *filename;
d875 11
d1181 4
a1184 4
#ifdef _OSD_POSIX
extern const char *os_set_account(pool *p, const char *account);
extern int os_init_job_environment(server_rec *s, const char *user_name, int one_process);
#endif /* _OSD_POSIX */
d1186 2
a1187 2
char *ap_get_local_host(pool *);
unsigned long ap_get_virthost_addr(char *hostname, unsigned short *port);
@


1.12
log
@Apache 1.3.19+mod_ssl 2.8.1 merge - also adds shared build of mod_headers
and mod_expire
@
text
@d157 2
a158 2
#define ap_http_method(r)   (ap_ctx_get((r)->ctx, "ap::http::method") != NULL ? ((char *)ap_ctx_get((r)->ctx, "ap::http::method")) : "http")
#define ap_default_port(r)  (ap_ctx_get((r)->ctx, "ap::default::port") != NULL ? atoi((char *)ap_ctx_get((r)->ctx, "ap::default::port")) : DEFAULT_HTTP_PORT)
@


1.11
log
@apache 1.3.14 + mod_ssl 2.7.1 merge
@
text
@d2 4
a5 1
 * Copyright (c) 1995-1999 The Apache Group.  All rights reserved.
d12 1
a12 1
 *    notice, this list of conditions and the following disclaimer. 
d19 20
a38 23
 * 3. All advertising materials mentioning features or use of this
 *    software must display the following acknowledgment:
 *    "This product includes software developed by the Apache Group
 *    for use in the Apache HTTP server project (http://www.apache.org/)."
 *
 * 4. The names "Apache Server" and "Apache Group" must not be used to
 *    endorse or promote products derived from this software without
 *    prior written permission. For written permission, please contact
 *    apache@@apache.org.
 *
 * 5. Products derived from this software may not be called "Apache"
 *    nor may "Apache" appear in their names without prior written
 *    permission of the Apache Group.
 *
 * 6. Redistributions of any form whatsoever must retain the following
 *    acknowledgment:
 *    "This product includes software developed by the Apache Group
 *    for use in the Apache HTTP server project (http://www.apache.org/)."
 *
 * THIS SOFTWARE IS PROVIDED BY THE APACHE GROUP ``AS IS'' AND ANY
 * EXPRESSED OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
 * PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE APACHE GROUP OR
d40 7
a46 7
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT
 * NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
 * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT,
 * STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
 * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED
 * OF THE POSSIBILITY OF SUCH DAMAGE.
d50 7
a56 6
 * individuals on behalf of the Apache Group and was originally based
 * on public domain software written at the National Center for
 * Supercomputing Applications, University of Illinois, Urbana-Champaign.
 * For more information on the Apache Group and the Apache HTTP server
 * project, please see <http://www.apache.org/>.
 *
d101 1
a101 1
#elif defined(BEOS)
d463 1
a463 1
#define SERVER_BASEREVISION "1.3.14"
d487 1
a487 1
#define APACHE_RELEASE 10314100
a1158 2
/* XXX: This makes little sense for NETWARE ... NETWARE is case insensitive?
 */
@


1.10
log
@apache 1.3.12 + mod_ssl 2.6.2 merge
@
text
@d75 1
a75 1
#include "alloc.h"
d78 1
a78 1
 * Don't move the position. It has to be after alloc.h because it uses the
d460 8
a467 2
#define SERVER_BASEVERSION "Apache/1.3.12"	/* SEE COMMENTS ABOVE */
#define SERVER_VERSION  SERVER_BASEVERSION
d471 2
a472 1
    SrvTk_FULL		/* eg: Apache/1.3.0 (UNIX) PHP/3.0 FooBar/1.2b */
d486 1
a486 1
#define APACHE_RELEASE 10312100
d857 11
d1073 1
d1098 1
d1138 1
d1154 3
d1158 2
@


1.9
log
@Apache 1.3.11 + mod_ssl 2.5.0 merge
@
text
@d272 1
a272 1
#define SUEXEC_BIN  HTTPD_ROOT "/sbin/suexec"
d442 6
d460 1
a460 1
#define SERVER_BASEVERSION "Apache/1.3.11"	/* SEE COMMENTS ABOVE */
d479 1
a479 1
#define APACHE_RELEASE 10311100
d1055 1
@


1.8
log
@change default values in here to sane ones for OpenBSD. suexec.h stuff
gets set in config, but DEFAULT_PATH in httpd.h was an interesting polyglot
of hoary old stuff from the RiscOS days...
@
text
@d102 2
d257 1
a257 1
#define DEFAULT_PATH "/bin:/usr/bin:local/bin"
d454 1
a454 1
#define SERVER_BASEVERSION "Apache/1.3.9"	/* SEE COMMENTS ABOVE */
d473 1
a473 1
#define APACHE_RELEASE 10309100
d635 2
d648 2
d694 6
d723 1
a723 1
    int proxyreq;		/* A proxy request (calculated during
d987 1
a987 1
    int used;			/* Only used during restart */
@


1.7
log
@Apache 1.3.9 + Mod_ssl 2.4.2 - now builds with apaci nastiness.
@
text
@d255 1
a255 1
#define DEFAULT_PATH "/bin:/usr/bin:/usr/ucb:/usr/bsd:/usr/local/bin"
@


1.6
log
@mod_ssl-2.2.3-1.3.4 (will require libssl-1.1 for https to work, but
mostly harmless otherwise).
@
text
@d72 3
d100 2
d103 1
a103 1
#define HTTPD_ROOT "/var/www"
d173 1
a173 2
#ifdef OS2
/* Set default for OS/2 file system */
d181 1
a181 2
#ifdef OS2
/* Set default for OS/2 file system */
d328 3
d333 1
d371 13
d452 1
a452 1
#define SERVER_BASEVERSION "Apache/1.3.4"       /* SEE COMMENTS ABOVE */
d471 1
a471 1
#define APACHE_RELEASE 10304100
d597 1
d599 1
a599 2
#define METHODS     15
#define M_INVALID   31
d612 17
d720 1
a720 1
    char *status_line;		/* Status line, if set by script */
d727 1
a727 1
    char *method;		/* GET, HEAD, POST, etc. */
d885 4
a888 1

d990 1
d1007 4
d1037 3
a1039 1
API_EXPORT(char *) ap_uudecode(pool *, const char *);
d1041 1
d1044 1
d1047 4
d1052 1
a1052 1
			   size_t nmatch, regmatch_t pmatch[]);
@


1.5
log
@Apache 1.3.4 merge
@
text
@d73 9
d148 4
d154 1
d443 3
d800 4
d848 4
d924 4
@


1.4
log
@fix htdocs path; evanc@@concer.to
@
text
@d2 1
a2 1
 * Copyright (c) 1995-1998 The Apache Group.  All rights reserved.
d113 5
d418 1
a418 1
#define SERVER_BASEVERSION "Apache/1.3.3"	/* SEE COMMENTS ABOVE */
d430 1
a430 1
/* Numeric release version identifier: major minor bugfix betaseq
d432 1
a432 2
 * For a final release, 'betaseq' should be set to '99'.
 * For example, Apache 1.4.2 should be '1040299'
d434 1
a434 1
#define APACHE_RELEASE 1030399
d454 1
a454 1
#define RESPONSE_CODES 54
d494 1
d502 1
d531 2
a532 1
#define status_drops_connection(x) (((x) == HTTP_BAD_REQUEST)           || \
d541 19
d561 2
a562 9
#define METHODS 8
#define M_GET 0
#define M_PUT 1
#define M_POST 2
#define M_DELETE 3
#define M_CONNECT 4
#define M_OPTIONS 5
#define M_TRACE 6
#define M_INVALID 7
d714 1
d745 2
a782 1
    unsigned expecting_100;     /* is client waiting for a 100 response? */
d947 1
a947 1
#define escape_uri(ppool,path) ap_os_escape_path(ppool,path,1)
d1021 3
d1025 2
d1029 7
d1040 1
a1040 1
extern int os_init_job_environment(server_rec *s, const char *user_name);
d1087 1
a1087 1
#define ap_assert(exp) (void)( (exp) || (ap_log_assert(#exp, __FILE__, __LINE__), 0) )
@


1.3
log
@Apache 1.3.3 merge + proxy_segv fix
@
text
@d101 1
a101 1
#define DOCUMENT_LOCATION  HTTPD_ROOT "/var/www/htdocs"
@


1.2
log
@fix retarded default paths
@
text
@d413 1
a413 1
#define SERVER_BASEVERSION "Apache/1.3.2"	/* SEE COMMENTS ABOVE */
d430 1
a430 1
#define APACHE_RELEASE 1030299
d446 5
a450 1
#define RESPONSE_CODES 38
d454 1
d462 1
d469 1
d486 4
d497 1
d755 7
@


1.1
log
@Initial revision
@
text
@d89 1
a89 1
#define HTTPD_ROOT "/usr/local/apache"
d101 1
a101 1
#define DOCUMENT_LOCATION  HTTPD_ROOT "/htdocs"
@


1.1.1.1
log
@Apache 1.3.2
@
text
@@


1.1.1.2
log
@import apache 1.3.26 + mod_ssl 2.8.10
@
text
@d2 1
a2 4
 * The Apache Software License, Version 1.1
 *
 * Copyright (c) 2000-2002 The Apache Software Foundation.  All rights
 * reserved.
d9 1
a9 1
 *    notice, this list of conditions and the following disclaimer.
d16 23
a38 20
 * 3. The end-user documentation included with the redistribution,
 *    if any, must include the following acknowledgment:
 *       "This product includes software developed by the
 *        Apache Software Foundation (http://www.apache.org/)."
 *    Alternately, this acknowledgment may appear in the software itself,
 *    if and wherever such third-party acknowledgments normally appear.
 *
 * 4. The names "Apache" and "Apache Software Foundation" must
 *    not be used to endorse or promote products derived from this
 *    software without prior written permission. For written
 *    permission, please contact apache@@apache.org.
 *
 * 5. Products derived from this software may not be called "Apache",
 *    nor may "Apache" appear in their name, without prior written
 *    permission of the Apache Software Foundation.
 *
 * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
 * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
 * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
d40 7
a46 7
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
 * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
 * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
 * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
 * SUCH DAMAGE.
d50 6
a55 7
 * individuals on behalf of the Apache Software Foundation.  For more
 * information on the Apache Software Foundation, please see
 * <http://www.apache.org/>.
 *
 * Portions of this software are based upon public domain software
 * originally written at the National Center for Supercomputing Applications,
 * University of Illinois, Urbana-Champaign.
d72 1
a72 1
#include "ap_alloc.h"
a87 4
#elif defined(BEOS) || defined(BONE)
#define HTTPD_ROOT "/boot/home/apache"
#elif defined(NETWARE)
#define HTTPD_ROOT "sys:/apache"
a112 5
/* The target name of the installed Apache */
#ifndef TARGET
#define TARGET "httpd"
#endif

a133 3
#ifdef NETWARE
#define ap_http_method(r) ap_os_http_method(r)
#else
a134 1
#endif
d147 10
d158 2
a159 1
#if defined(OS2) || defined(WIN32)
d248 1
a248 1
#define SUEXEC_BIN  HTTPD_ROOT "/bin/suexec"
a305 5
#ifdef WIN32
#define HARD_SERVER_LIMIT 1024
#elif defined(NETWARE)
#define HARD_SERVER_LIMIT 2048
#else
a307 1
#endif
a400 6
 * The default default character set name to add if AddDefaultCharset is 
 * enabled.  Overridden with AddDefaultCharsetName.
 */
#define DEFAULT_ADD_DEFAULT_CHARSET_NAME "iso-8859-1"

/*
d413 2
a414 8
#define SERVER_BASEVENDOR   "Apache Group"
#define SERVER_BASEPRODUCT  "Apache"
#define SERVER_BASEREVISION "1.3.26"
#define SERVER_BASEVERSION  SERVER_BASEPRODUCT "/" SERVER_BASEREVISION

#define SERVER_PRODUCT  SERVER_BASEPRODUCT
#define SERVER_REVISION SERVER_BASEREVISION
#define SERVER_VERSION  SERVER_PRODUCT "/" SERVER_REVISION
d418 1
a418 2
    SrvTk_FULL,		/* eg: Apache/1.3.0 (UNIX) PHP/3.0 FooBar/1.2b */
    SrvTk_PRODUCT_ONLY	/* eg: Apache */
d425 1
a425 1
/* Numeric release version identifier: MMNNFFRBB: major minor fix final beta
d427 2
a428 1
 * For example, Apache 1.4.2 would be '10402100', 2.5b7 would be '20500007'.
d430 1
a430 1
#define APACHE_RELEASE 10326100
d446 1
a446 5
/* The size of the static array in http_protocol.c for storing
 * all of the potential response status-lines (a sparse table).
 * A future version should dynamically generate the table at startup.
 */
#define RESPONSE_CODES 55
a449 1
#define HTTP_PROCESSING                    102
a456 1
#define HTTP_MULTI_STATUS                  207
a462 1
#define HTTP_TEMPORARY_REDIRECT            307
a478 5
#define HTTP_RANGE_NOT_SATISFIABLE         416
#define HTTP_EXPECTATION_FAILED            417
#define HTTP_UNPROCESSABLE_ENTITY          422
#define HTTP_LOCKED                        423
#define HTTP_FAILED_DEPENDENCY             424
a485 2
#define HTTP_INSUFFICIENT_STORAGE          507
#define HTTP_NOT_EXTENDED                  510
d513 1
a513 2
#define ap_status_drops_connection(x) \
                                   (((x) == HTTP_BAD_REQUEST)           || \
a521 20
/* Methods recognized (but not necessarily handled) by the server.
 * These constants are used in bit shifting masks of size int, so it is
 * unsafe to have more methods than bits in an int.  HEAD == M_GET.
 */
#define M_GET        0
#define M_PUT        1
#define M_POST       2
#define M_DELETE     3
#define M_CONNECT    4
#define M_OPTIONS    5
#define M_TRACE      6
#define M_PATCH      7
#define M_PROPFIND   8
#define M_PROPPATCH  9
#define M_MKCOL     10
#define M_COPY      11
#define M_MOVE      12
#define M_LOCK      13
#define M_UNLOCK    14
#define M_INVALID   15
d523 9
a531 1
#define METHODS     16
a543 17
/*
 * Define the HTML doctype strings centrally.
 */
#define DOCTYPE_HTML_2_0  "<!DOCTYPE HTML PUBLIC \"-//IETF//" \
                          "DTD HTML 2.0//EN\">\n"
#define DOCTYPE_HTML_3_2  "<!DOCTYPE HTML PUBLIC \"-//W3C//" \
                          "DTD HTML 3.2 Final//EN\">\n"
#define DOCTYPE_HTML_4_0S "<!DOCTYPE HTML PUBLIC \"-//W3C//" \
                          "DTD HTML 4.0//EN\"\n" \
                          "\"http://www.w3.org/TR/REC-html40/strict.dtd\">\n"
#define DOCTYPE_HTML_4_0T "<!DOCTYPE HTML PUBLIC \"-//W3C//" \
                          "DTD HTML 4.0 Transitional//EN\"\n" \
                          "\"http://www.w3.org/TR/REC-html40/loose.dtd\">\n"
#define DOCTYPE_HTML_4_0F "<!DOCTYPE HTML PUBLIC \"-//W3C//" \
                          "DTD HTML 4.0 Frameset//EN\"\n" \
                          "\"http://www.w3.org/TR/REC-html40/frameset.dtd\">\n"

a547 2
#define CRLF "\015\012"
#define OS_ASC(c) (c)
d549 1
a549 1
#include "ap_ebcdic.h"
a558 2
#define CRLF "\r\n"
#define OS_ASC(c) (os_toascii[c])
a602 6
enum proxyreqtype {
    NOT_PROXY=0,
    STD_PROXY,
    PROXY_PASS
};

d626 1
a626 1
    enum proxyreqtype proxyreq;/* A proxy request (calculated during
d635 1
a635 1
    const char *status_line;	/* Status line, if set by script */
d642 1
a642 1
    const char *method;		/* GET, HEAD, POST, etc. */
a682 1
    unsigned expecting_100;	/* is client waiting for a 100 response? */
a712 2
    char *vlist_validator;      /* variant list validator (if negotiated) */

d722 1
a722 1
    char *filename;		/* filename if found, otherwise NULL */
a742 28

    /* On systems with case insensitive file systems (Windows, OS/2, etc.), 
     * r->filename is case canonicalized (folded to either lower or upper 
     * case, depending on the specific system) to accomodate file access
     * checking. case_preserved_filename is the same as r->filename 
     * except case is preserved. There is at least one instance where Apache 
     * needs access to the case preserved filename: Java class files published 
     * with WebDAV need to preserve filename case to make the Java compiler 
     * happy.
     */
    char *case_preserved_filename;

#ifdef CHARSET_EBCDIC
    /* We don't want subrequests to modify our current conversion flags.
     * These flags save the state of the conversion flags when subrequests
     * are run.
     */
    struct {
        unsigned conv_in:1;    /* convert ASCII->EBCDIC when read()ing? */
        unsigned conv_out:1;   /* convert EBCDIC->ASCII when write()ing? */
    } ebcdic;
#endif

/* Things placed at the end of the record to avoid breaking binary
 * compatibility.  It would be nice to remember to reorder the entire
 * record to improve 64bit alignment the next time we need to break
 * binary compatibility for some other reason.
 */
a786 4
    char *local_ip;		/* server IP address */
    char *local_host;		/* used for ap_get_server_name when
				 * UseCanonicalName is set to DNS
				 * (ignores setting of HostnameLookups) */
d866 1
a866 1
    int used;			/* Only used during restart */        
a880 1
API_EXPORT(char *) ap_field_noparam(pool *p, const char *intype);
a896 4
API_EXPORT(const char *) ap_size_list_item(const char **field, int *len);
API_EXPORT(char *) ap_get_list_item(pool *p, const char **field);
API_EXPORT(int) ap_find_list_item(pool *p, const char *line, const char *tok);

d907 1
a907 1
#define ap_escape_uri(ppool,path) ap_os_escape_path(ppool,path,1)
a910 1
API_EXPORT(char *) ap_escape_logitem(pool *p, const char *str);
d923 1
a923 5
API_EXPORT(char *) ap_stripprefix(const char *bigstring, const char *prefix);
API_EXPORT(char *) ap_strcasestr(const char *s1, const char *s2);
API_EXPORT(char *) ap_pbase64decode(pool *p, const char *bufcoded);
API_EXPORT(char *) ap_pbase64encode(pool *p, char *string); 
API_EXPORT(char *) ap_uudecode(pool *p, const char *bufcoded);
a924 6

#if defined(OS2) || defined(WIN32)
API_EXPORT(char *) ap_double_quotes(pool *p, const char *str);
API_EXPORT(char *) ap_caret_escape_args(pool *p, const char *str);
#endif

a928 4
API_EXPORT(int)    ap_regexec(const regex_t *preg, const char *string,
                              size_t nmatch, regmatch_t pmatch[], int eflags);
API_EXPORT(size_t) ap_regerror(int errcode, const regex_t *preg, 
                               char *errbuf, size_t errbuf_size);
d930 1
a930 1
                              size_t nmatch, regmatch_t pmatch[]);
a937 1
API_EXPORT(void) ap_remove_spaces(char *dest, char *src);
a976 1
API_EXPORT(int) ap_is_rdirectory(const char *name);
a980 3
/*
 *  We can't define these in os.h because of dependence on pool pointer.
 */
a981 2
#define ap_os_case_canonical_filename(p,f)  (f)
#define ap_os_systemcase_filename(p,f)  (f)
a983 13
#ifdef WIN32
API_EXPORT(char *) ap_os_case_canonical_filename(pool *pPool, const char *szFile);
API_EXPORT(char *) ap_os_systemcase_filename(pool *pPool, const char *szFile);
#elif defined(OS2)
API_EXPORT(char *) ap_os_case_canonical_filename(pool *pPool, const char *szFile);
API_EXPORT(char *) ap_os_systemcase_filename(pool *pPool, const char *szFile);
#elif defined(NETWARE)
API_EXPORT(char *) ap_os_case_canonical_filename(pool *pPool, const char *szFile);
#define ap_os_systemcase_filename(p,f) ap_os_case_canonical_filename(p,f)
#else
#define ap_os_case_canonical_filename(p,f) ap_os_canonical_filename(p,f)
#define ap_os_systemcase_filename(p,f) ap_os_canonical_filename(p,f)
#endif
d986 4
a989 4
#ifdef CHARSET_EBCDIC
API_EXPORT(int)    ap_checkconv(struct request_rec *r);    /* for downloads */
API_EXPORT(int)    ap_checkconv_in(struct request_rec *r); /* for uploads */
#endif /*#ifdef CHARSET_EBCDIC*/
d991 2
a992 2
API_EXPORT(char *) ap_get_local_host(pool *);
API_EXPORT(unsigned long) ap_get_virthost_addr(char *hostname, unsigned short *port);
d1035 1
a1035 1
#define ap_assert(exp) ((exp) ? (void)0 : ap_log_assert(#exp,__FILE__,__LINE__))
@


1.1.1.3
log
@import apache 1.3.27 and mod_ssl 2.8.11
@
text
@a72 3
#ifdef EAPI
#include "ap_mm.h"
#endif
a73 9
/*
 * Include the Extended API headers.
 * Don't move the position. It has to be after ap_alloc.h because it uses the
 * pool stuff but before buff.h because the buffer stuff uses the EAPI, too. 
 */
#ifdef EAPI
#include "ap_hook.h"
#include "ap_ctx.h"
#endif /* EAPI */
a143 4
#ifdef EAPI
#define ap_http_method(r)   (((r)->ctx != NULL && ap_ctx_get((r)->ctx, "ap::http::method") != NULL) ? ((char *)ap_ctx_get((r)->ctx, "ap::http::method")) : "http")
#define ap_default_port(r)  (((r)->ctx != NULL && ap_ctx_get((r)->ctx, "ap::default::port") != NULL) ? atoi((char *)ap_ctx_get((r)->ctx, "ap::default::port")) : DEFAULT_HTTP_PORT)
#else /* EAPI */
a149 1
#endif /* EAPI */
a353 13
/*
 * Unix only:
 * Path to Shared Memory Files 
 */
#ifdef EAPI
#ifndef EAPI_MM_CORE_PATH
#define EAPI_MM_CORE_PATH "logs/mm"
#endif
#ifndef EAPI_MM_CORE_MAXSIZE
#define EAPI_MM_CORE_MAXSIZE 1024*1024*1 /* max. 1MB */
#endif
#endif

d430 1
a430 1
#define SERVER_BASEREVISION "1.3.27"
a445 3
#ifdef EAPI
API_EXPORT(void) ap_add_config_define(const char *define);
#endif /* EAPI */
d451 1
a451 1
#define APACHE_RELEASE 10327100
a848 4

#ifdef EAPI
    ap_ctx *ctx;
#endif /* EAPI */
a896 3
#ifdef EAPI
    ap_ctx *ctx;
#endif /* EAPI */
a968 4

#ifdef EAPI
    ap_ctx *ctx;
#endif /* EAPI */
@


1.1.1.4
log
@import apache 1.3.28 and mod_ssl 2.8.15
@
text
@d4 1
a4 1
 * Copyright (c) 2000-2003 The Apache Software Foundation.  All rights
a155 4
#ifdef NETWARE
#define ap_http_method(r) ap_os_http_method((void*)r)
#define ap_default_port(r) ap_os_default_port((void*)r)
#else
d160 3
d164 1
a166 1
#endif
d460 1
a460 1
#define SERVER_BASEREVISION "1.3.28"
d484 1
a484 1
#define APACHE_RELEASE 10328100
@


1.1.1.5
log
@import Apache 1.3.29 and mod_ssl 2.8.16
@
text
@a293 3
/* The max number of regex captures that can be expanded by ap_pregsub */
#define AP_MAX_REG_MATCH 10

d461 1
a461 1
#define SERVER_BASEREVISION "1.3.29"
d485 1
a485 1
#define APACHE_RELEASE 10329100
@


