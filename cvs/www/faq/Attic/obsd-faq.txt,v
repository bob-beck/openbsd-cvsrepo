head	1.43;
access;
symbols;
locks; strict;
comment	@# @;


1.43
date	2016.01.12.09.33.37;	author tb;	state dead;
branches;
next	1.42;
commitid	29FK5yA8COFCHIJF;

1.42
date	2015.11.03.02.48.43;	author nick;	state Exp;
branches;
next	1.41;
commitid	FLjGeOBrHUQBeMil;

1.41
date	2015.10.29.16.51.56;	author nick;	state Exp;
branches;
next	1.40;
commitid	w0EiCI83MsZ9rNwl;

1.40
date	2015.10.18.20.02.31;	author nick;	state Exp;
branches;
next	1.39;
commitid	AsR6jIQR6sPm03V3;

1.39
date	2015.06.05.12.04.13;	author nick;	state Exp;
branches;
next	1.38;
commitid	PrEEysas9MrvKsrs;

1.38
date	2015.03.01.02.36.59;	author nick;	state Exp;
branches;
next	1.37;
commitid	UiZYG5d8hcVoFnQy;

1.37
date	2014.11.06.15.09.17;	author kurt;	state Exp;
branches;
next	1.36;
commitid	tJLbLSlsDs1UAKx2;

1.36
date	2014.09.26.11.41.47;	author nick;	state Exp;
branches;
next	1.35;
commitid	SvIp39tXWd1uS4OG;

1.35
date	2014.03.06.18.38.35;	author nick;	state Exp;
branches;
next	1.34;

1.34
date	2003.04.30.22.37.32;	author nick;	state dead;
branches;
next	1.33;

1.33
date	2003.01.05.19.29.10;	author nick;	state Exp;
branches;
next	1.32;

1.32
date	2002.06.24.12.09.54;	author espie;	state Exp;
branches;
next	1.31;

1.31
date	2002.03.11.00.05.13;	author millert;	state Exp;
branches;
next	1.30;

1.30
date	2002.03.05.02.49.06;	author millert;	state Exp;
branches;
next	1.29;

1.29
date	2002.02.02.05.17.17;	author chris;	state Exp;
branches;
next	1.28;

1.28
date	2002.01.12.01.41.19;	author ericj;	state Exp;
branches;
next	1.27;

1.27
date	2001.09.10.19.26.32;	author jufi;	state Exp;
branches;
next	1.26;

1.26
date	2001.08.08.21.06.33;	author jsyn;	state Exp;
branches;
next	1.25;

1.25
date	2001.07.02.20.48.36;	author jufi;	state Exp;
branches;
next	1.24;

1.24
date	2001.06.14.22.57.02;	author fgsch;	state Exp;
branches;
next	1.23;

1.23
date	2000.05.15.02.36.51;	author wvdputte;	state Exp;
branches;
next	1.22;

1.22
date	2000.02.28.01.25.14;	author ericj;	state Exp;
branches;
next	1.21;

1.21
date	2000.02.12.21.35.43;	author aaron;	state Exp;
branches;
next	1.20;

1.20
date	2000.01.20.22.35.12;	author ericj;	state Exp;
branches;
next	1.19;

1.19
date	99.12.06.20.17.40;	author ericj;	state Exp;
branches;
next	1.18;

1.18
date	99.11.24.20.53.40;	author ericj;	state Exp;
branches;
next	1.17;

1.17
date	99.10.19.01.31.56;	author ericj;	state Exp;
branches;
next	1.16;

1.16
date	99.10.08.16.07.34;	author ericj;	state Exp;
branches;
next	1.15;

1.15
date	99.10.04.15.08.13;	author chris;	state Exp;
branches;
next	1.14;

1.14
date	99.09.24.22.14.48;	author ericj;	state Exp;
branches;
next	1.13;

1.13
date	99.09.22.23.32.28;	author ericj;	state Exp;
branches;
next	1.12;

1.12
date	99.09.01.03.57.50;	author ericj;	state Exp;
branches;
next	1.11;

1.11
date	99.08.31.00.49.20;	author chris;	state Exp;
branches;
next	1.10;

1.10
date	99.08.10.19.02.58;	author ericj;	state Exp;
branches;
next	1.9;

1.9
date	99.07.21.05.47.59;	author ericj;	state Exp;
branches;
next	1.8;

1.8
date	99.06.30.18.13.48;	author ericj;	state Exp;
branches;
next	1.7;

1.7
date	99.06.28.21.29.28;	author ericj;	state Exp;
branches;
next	1.6;

1.6
date	99.06.25.18.53.51;	author ericj;	state Exp;
branches;
next	1.5;

1.5
date	99.06.22.18.57.35;	author ericj;	state Exp;
branches;
next	1.4;

1.4
date	99.06.18.21.35.24;	author ericj;	state Exp;
branches;
next	1.3;

1.3
date	99.06.18.21.30.04;	author ericj;	state Exp;
branches;
next	1.2;

1.2
date	99.06.09.00.04.29;	author wvdputte;	state Exp;
branches;
next	1.1;

1.1
date	99.05.30.23.34.39;	author ericj;	state Exp;
branches;
next	;


desc
@@


1.43
log
@Remove {obsd,pf}-faq.txt.  Unanimous agreement from many.
@
text
@1
                                 OpenBSD
Frequently Asked Questions

----------------------------------------------------------------------------------------------

This FAQ is supplemental documentation to the man pages, available both in the installed
system and online. The FAQ covers the active release of OpenBSD, currently v5.8. There are
likely features and changes to features in the development version (-current) of OpenBSD that
are not covered in the FAQ.

Quick Links:

Upgrade Guide: 5.7 to 5.8  Following -current
Porter's Handbook          Port Testing Guide
Manual pages               Bug Reporting
Mailing lists              PF User's Guide

The FAQ is available in text form as well:  OpenBSD FAQ  PF User's Guide

----------------------------------------------------------------------------------------------

[                    ] [FAQ Search]
1 - Introduction to OpenBSD

  * 1.1 - What is OpenBSD?
  * 1.2 - On what systems does OpenBSD run?
  * 1.3 - Why might I want to use OpenBSD?
  * 1.4 - Is OpenBSD really free?
  * 1.5 - How can I help support OpenBSD?
  * 1.6 - Who maintains OpenBSD?
  * 1.7 - When is the next release of OpenBSD?
  * 1.8 - What is included with OpenBSD?
  * 1.9 - What is new in OpenBSD 5.8?
  * 1.10 - Can I use OpenBSD as a desktop system?
  * 1.11 - Why is/isn't ProductX included?

2 - Getting to know OpenBSD

  * 2.1 - Web Pages
  * 2.2 - Mailing Lists
  * 2.3 - Manual Pages
  * 2.4 - Reporting Bugs

3 - Getting started with OpenBSD

  * 3.1 - Buying an OpenBSD CD set
  * 3.2 - Buying OpenBSD T-Shirts
  * 3.3 - Does OpenBSD provide an ISO image for download?
  * 3.4 - Downloading via HTTP, RSYNC
  * 3.5 - Verifying your download
  * 3.6 - Selecting Hardware
  * 3.7 - What is an appropriate "first system" to learn OpenBSD on?

4 - OpenBSD 5.8 Installation Guide

  * 4.1 - Overview of the OpenBSD installation procedure
  * 4.2 - Pre-installation checklist
  * 4.3 - Creating bootable OpenBSD install media
  * 4.4 - Booting OpenBSD install media
  * 4.5 - Performing a simple install
  * 4.6 - Details for a more complex install
  * 4.7 - What files are needed for installation?
  * 4.8 - How should I partition my disk?
  * 4.9 - Multibooting OpenBSD (amd64, i386)
  * 4.10 - Sending your dmesg to dmesg@@openbsd.org after the install
  * 4.11 - Adding a file set after install
  * 4.12 - What is 'bsd.rd'?
  * 4.13 - Common installation problems
  * 4.14 - Customizing the install process
  * 4.15 - How can I install a number of similar systems?
  * 4.16 - How can I get a dmesg(8) to report an install problem?

5 - Building the System from Source

  * 5.1 - OpenBSD's Flavors
  * 5.2 - Why should I build my system from source?
  * 5.3 - Building OpenBSD from source
  * 5.4 - Building a release
  * 5.5 - Building X
  * 5.6 - Why do I need a custom kernel?
  * 5.7 - Building a custom kernel
  * 5.8 - Boot-time configuration
  * 5.9 - Using config(8) to change your kernel
  * 5.10 - Getting more verbose output during boot
  * 5.11 - Common Problems when Compiling and Building

6 - Networking

  * 6.1 - Before we go any further
  * 6.2 - Initial network setup
  * 6.3 - How do I filter and firewall with OpenBSD?
  * 6.4 - Dynamic Host Configuration Protocol (DHCP)
  * 6.6 - Tuning networking parameters
  * 6.7 - Using NFS
  * 6.9 - Setting up a bridge with OpenBSD
  * 6.10 - How do I boot using PXE?
  * 6.11 - The Common Address Redundancy Protocol (CARP)
  * 6.12 - Using OpenNTPD
  * 6.13 - What are my wireless networking options?
  * 6.14 - How can I do equal-cost multipath routing?

7 - Keyboard and Display Controls

  * 7.1 - How do I remap the keyboard? (wscons)
  * 7.2 - Is there console mouse support in OpenBSD?
  * 7.3 - Accessing the console scrollback buffer. (some amd64, i386, Alpha)
  * 7.4 - How do I switch consoles? (amd64, i386, Zaurus, some Alpha)
  * 7.5 - How can I use a console resolution of 80x50? (some amd64, i386, Alpha)
  * 7.6 - How do I use a serial console?
  * 7.7 - How do I blank my console? (wscons)
  * 7.8 - EVERYTHING I TYPE AT THE LOGIN PROMPT IS IN CAPS!
  * 7.9 - What is tmux(1)?

8 - General Questions

  * 8.1 - I forgot my root password... What do I do!
  * 8.2 - X won't start, I get lots of error messages
  * 8.3 - Can I use programming language "L" on OpenBSD?
  * 8.8 - Is there any way to use my floppy drive if it's not attached during boot?
  * 8.9 - OpenBSD Bootloader (i386, amd64 specific)
  * 8.10 - Using S/Key on your OpenBSD system
  * 8.12 - Does OpenBSD support SMP?
  * 8.13 - I sometimes get Input/output error when trying to use my tty devices
  * 8.14 - What web browsers are available for OpenBSD?
  * 8.15 - How do I use the mg editor?
  * 8.16 - Ksh does not appear to read my .profile!
  * 8.17 - Why does my /etc/motd file get written over when I modified it?
  * 8.20 - Antialiased and TrueType fonts in X
  * 8.21 - Does OpenBSD support any journaling filesystems?
  * 8.22 - Reverse DNS or Why is it taking so long for me to log in?
  * 8.23 - Why do the OpenBSD web pages not conform to HTML4/XHTML?
  * 8.24 - Why is my clock off by twenty-some seconds?
  * 8.25 - Why is my clock off by several hours?

9 - Migrating to OpenBSD

  * 9.1 - Tips for users of other Unix-like Operating Systems
  * 9.2 - Dual boot of Linux and OpenBSD
  * 9.3 - Converting your Linux (or other Sixth Edition-style) password file to BSD-style.
  * 9.4 - Running Linux binaries on OpenBSD
  * 9.5 - Accessing your Linux files from OpenBSD

10 - System Management

  * 10.1 - When I try to su to root it says that I'm in the wrong group
  * 10.2 - How do I duplicate a filesystem?
  * 10.3 - How do I start daemons with the system? (Overview of rc(8))
  * 10.4 - Introducing doas(1) -- or -- What happened to sudo?
  * 10.8 - I made changes to /etc/passwd with vi(1), but the changes didn't seem to take
    place. Why?
  * 10.9 - How do I add a user? or delete a user?
  * 10.10 - How do I create a ftp-only account?
  * 10.11 - Setting up user disk quotas
  * 10.13 - Setting up an Anonymous FTP Server
  * 10.14 - Confining users to their home directories in ftpd(8).
  * 10.15 - Applying patches in OpenBSD.
  * 10.17 - Can I change the root shell?
  * 10.18 - What else can I do with ksh?
  * 10.19 - Directory services, in particular YP
  * 10.20 - Character sets and localization

11 - The X Window System

  * 11.1 - Introduction to X
  * 11.2 - Configuring X
  * 11.4 - Starting X
  * 11.5 - Customizing X

12 - Hardware and Platform-Specific Questions

  * 12.1 - General hardware notes
  * 12.2 - DEC Alpha
  * 12.3 - AMD 64
  * 12.4 - ARM-based appliances
  * 12.7 - HP Precision Architecture (PA-RISC)
  * 12.8 - i386
  * 12.9 - Landisk
  * 12.10 - Luna88k
  * 12.11 - MacPPC
  * 12.14 - SGI
  * 12.15 - SPARC
  * 12.16 - UltraSPARC
  * 12.17 - DEC VAX
  * 12.18 - Sharp Zaurus

13 - Multimedia

  * 13.1 - How do I configure my audio device?
  * 13.2 - Playing different kinds of audio
  * 13.3 - How can I play audio CDs in OpenBSD?
  * 13.4 - Can I use OpenBSD to record audio samples?
  * 13.5 - How do I setup an audio server?
  * 13.6 - What can I do if I have audio problems?
  * 13.7 - How do I use my MIDI instruments?
  * 13.8 - Tell me about Ogg Vorbis and MP3 encoding?
  * 13.9 - How can I playback video DVDs in OpenBSD?
  * 13.10 - How do I burn CDs and DVDs?
  * 13.11 - But I want my media files in format FOO.
  * 13.12 - Is it possible to play streaming media under OpenBSD?
  * 13.13 - Can I have a Java plugin in my web browser? (i386 & amd64 only)
  * 13.14 - Can I have a Flash plugin in my web browser?

14 - Disk Setup

  * 14.1 - Disks and Partitions
  * 14.2 - Using OpenBSD's fdisk(8)
  * 14.3 - Using OpenBSD's disklabel(8)
  * 14.4 - Adding extra disks in OpenBSD
  * 14.5 - How is swap handled?
  * 14.6 - Soft Updates
  * 14.7 - How do OpenBSD/i386 and OpenBSD/amd64 boot?
  * 14.8 - What are the issues regarding large drives with OpenBSD?
  * 14.9 - Installing Bootblocks - i386/amd64 specific
  * 14.10 - Preparing for disaster: Backing up and Restoring from tape.
  * 14.11 - Mounting disk images in OpenBSD
  * 14.12 - Help! I'm getting errors with IDE DMA!
  * 14.14 - Why does df(1) tell me I have over 100% of my disk used?
  * 14.15 - Recovering partitions after deleting the disklabel
  * 14.16 - Can I access data on filesystems other than FFS?
  * 14.17 - Can I use a flash memory device with OpenBSD?
  * 14.18 - Optimizing disk performance
  * 14.19 - Why aren't we using async mounts?
  * 14.20 - Duplicating your root partition: altroot
  * 14.21 - How do I use softraid(4)?

15 - The OpenBSD packages and ports system

  * 15.1 - Introduction
  * 15.2 - Package management
  * 15.3 - Working with ports
  * 15.4 - FAQ
  * 15.5 - Reporting problems
  * 15.6 - Helping us

PF User's Guide

  * Basic Configuration
      + Getting Started
      + Lists and Macros
      + Tables
      + Packet Filtering
      + Network Address Translation
      + Traffic Redirection (Port Forwarding)
      + Shortcuts For Creating Rulesets
  * Advanced Configuration
      + Runtime Options
      + Anchors
      + Address Pools and Load Balancing
      + Packet Tagging (Policy Filtering)
  * Additional Topics
      + Logging
      + Performance
      + Issues with FTP
      + Authpf: User Shell for Authenticating Gateways
      + Firewall Redundancy with CARP and pfsync
  * Example Rulesets
      + Firewall for Home or Small Office

----------------------------------------------------------------------------------------------
The FAQ maintainer is Stuart Henderson.
Past contributors include Nick Holland, Steven Mestdagh, Joel Knight, Eric Jackson, Wim
Vandeputte and Chris Cappuccio.

Questions and comments regarding this FAQ may be directed to misc@@openbsd.org. General
questions about OpenBSD should be directed to the appropriate mail list.


OpenBSD FAQ Copyright (C) 1998-2015 OpenBSD
$OpenBSD: obsd-faq.txt,v 1.42 2015/11/03 02:48:43 nick Exp $

2
==============================================================================

1 - Introduction to OpenBSD

------------------------------------------------------------------------------

Table of Contents

  * 1.1 - What is OpenBSD?
  * 1.2 - On what systems does OpenBSD run?
  * 1.3 - Why might I want to use OpenBSD?
  * 1.4 - Is OpenBSD really free?
  * 1.5 - How can I help support OpenBSD?
  * 1.6 - Who maintains OpenBSD?
  * 1.7 - When is the next release of OpenBSD?
  * 1.8 - What is included with OpenBSD?
  * 1.9 - What is new in OpenBSD 5.8?
  * 1.10 - Can I use OpenBSD as a desktop system?
  * 1.11 - Why is/isn't ProductX included?

------------------------------------------------------------------------------

1.1 - What is OpenBSD?

The OpenBSD project produces a freely available, multi-platform 4.4BSD-based
UNIX-like operating system. Our goals place emphasis on correctness, security,
standardization, and portability.

This FAQ specifically covers only the most recent release of OpenBSD, version
5.8.

1.2 - On what systems does OpenBSD run?

OpenBSD 5.8 runs on the following platforms:

  * alpha - Available on CD
  * amd64 - Available on CD
  * aviion - Download only
  * armish - Download only
  * hppa - Available on CD
  * i386 - Available on CD
  * landisk - Download only
  * luna88k - Download only
  * loongson - Download only
  * macppc - Available on CD
  * octeon - Download only
  * sgi - Download only
  * socppc - Download only
  * sparc - Available on CD
  * sparc64 - Available on CD
  * vax - Download only
  * zaurus - Download only

Available on CD means the official CD set includes that platform and a small
selection of useful packages. Base system CD ISO images can also be downloaded
for most other platforms. These images are not the same as the official CD
sets.

More information on OpenBSD platforms can be found on the Platforms page.

People sometimes ask why we support so many "odd" machines. The short answer
is, "because we want to". If enough skilled people (sometimes, "enough" is
only one really skilled person!) wish to maintain support for a platform, it
will be supported. There are practical benefits to keeping OpenBSD
multi-platform: when new platforms come out, the code tree is relatively free
of portability-breaking bugs and design flaws. The OpenBSD platforms include
32 bit and 64 bit processors, little and big endian machines, and many
different designs. And yes, supporting "unusual" platforms has helped produce
a higher-quality code base for more "common" platforms.

1.3 - Why might I want to use OpenBSD?

New users frequently want to know whether OpenBSD is superior to some other
free UNIX-like operating system. That question is largely unanswerable and is
the subject of countless (and useless) religious debates. Do not, under any
circumstances, ask such a question on an OpenBSD mailing list.

Below are some reasons why we think OpenBSD is a useful operating system:

  * OpenBSD runs on many different hardware platforms.
  * OpenBSD is thought of by many security professionals as the most secure
    UNIX-like operating system, as the result of a never-ending comprehensive
    source code security audit.
  * OpenBSD is a full-featured UNIX-like operating system available in source
    form at no charge.
  * OpenBSD integrates cutting-edge security technology suitable for building
    firewalls and private network services in a distributed environment.
  * OpenBSD benefits from strong ongoing development in many areas, offering
    opportunities to work with emerging technologies with an international
    community of programmers and end-users.
  * OpenBSD attempts to minimize the need for customization and tweaking. For
    the vast majority of users, OpenBSD "Just Works" on their hardware for
    their application. Not only is tweaking and customizing rarely needed, it
    is actively discouraged.

However, whether OpenBSD is right for you is a question that only you can
answer.

1.4 - Is OpenBSD really free?

OpenBSD is all free. The binaries are free. The source is free. All parts of
OpenBSD have reasonable copyright terms permitting free redistribution. This
includes the ability to REUSE most parts of the OpenBSD source tree, either
for personal or commercial purposes. OpenBSD includes NO further restrictions
other than those implied by the original BSD license. Software which is
written under stricter licenses cannot be included in the regular distribution
of OpenBSD. This is intended to safeguard the free use of OpenBSD. For
example, OpenBSD can be freely used for personal use, for academic use, by
government institutions, by non-profit making organizations and by commercial
organizations. OpenBSD, or parts of it, can also be freely incorporated into
commercial products.

People sometimes ask if it bothers us that our free work is put into
commercial products. The answer is, we would prefer that our good code be
widely used rather than have commercial software vendors reimplement and
create badly coded or incompatible alternative solutions to already solved
problems. For example, it is likely that SSH is a widely used protocol due to
this freedom, much more widely used than if restrictions had been placed on
how people used the OpenSSH code. If a free SSH solution was not available for
vendors to use (in their multitude of rapidly developed products), they would
have written or purchased some crummy off-the shelf version instead.

This isn't to say we would object to financial or hardware support in thanks.
In fact, it is stunning how little support of any kind comes from companies
that depend upon OpenBSD (or OpenSSH) for their products, but there is no
requirement of compensation.

For further reading on other popular licenses read: OpenBSD Copyright Policy.

The maintainers of OpenBSD support the project largely from their own pockets.
This includes the time spent programming for the project, equipment used to
support the many ports, the network resources used to distribute OpenBSD to
you, and the time spent answering questions and investigating users' bug
reports. The OpenBSD developers are not independently wealthy and even small
contributions of time, equipment, and resources make a big difference.

1.5 - How can I help support OpenBSD?

We are greatly indebted to the people and organizations that have contributed
to the OpenBSD project. They are acknowledged by name on the donations page.

OpenBSD has a constant need for several types of support from the user
community. If you find OpenBSD useful, you are strongly encouraged to find a
way to contribute. If none of the suggestions below are right for you, feel
free to propose an alternative by sending e-mail to donations@@openbsd.org.

  * Buy an OpenBSD CD set. It includes the current full release of OpenBSD,
    and is bootable on many platforms. It also generates revenue to support
    the OpenBSD project, and reduces the strain on network resources used to
    deliver the distribution via the Internet. This inexpensive three CD set
    includes full source. Remember, your friends need their own copy!
  * Donate money. The project has a constant need for cash to pay for
    equipment, network connectivity, and expenses relating to CD publishing.
    Manufacturing CDs requires an up-front out-of-pocket investment for the
    OpenBSD developers, without guaranteed return. Send e-mail to
    donations@@openbsd.org to find out how to contribute. Even small donations
    make a profound difference.
  * Donate equipment and parts. The project has a constant need for general
    and specific hardware. Items such as IDE, SCSI, SATA and SAS disks, and
    various types of RAM are always welcome. For other types of hardware such
    as computer systems and motherboards, you should inquire as to current
    need. Write to donations@@openbsd.org to arrange for shipment.
  * Donate your time and skills. Programmers who enjoy writing operating
    systems are naturally always welcome, but there are literally dozens of
    other ways that people can be useful. Follow mailing lists and help answer
    new-user questions.
  * Help maintain documentation by submitting new FAQ material (to
    misc@@openbsd.org). Form a local user group and get your friends hooked on
    OpenBSD. Make a case to your employer for using OpenBSD at work. If you're
    a student, talk to your professors about using OpenBSD as a learning tool
    for Computer Science or Engineering courses. It's also worth mentioning
    one of the most important ways you should not try to "help" the OpenBSD
    project: do not waste your time engaging in operating system flame wars.
    It does not help the project to find new users and can cause substantial
    harm to important relationships that developers have with other
    developers.

1.6 - Who maintains OpenBSD?

OpenBSD is maintained by a development team spread across many different
countries. The project is coordinated by Theo de Raadt, located in Canada.

1.7 - When is the next release of OpenBSD?

The OpenBSD team makes a new release every six months, with target release
dates in May and November. More information on the development cycle can be
found here.

1.8 - What is included with OpenBSD?

OpenBSD is distributed with a number of third-party software products,
including:

  * X.org 7.7, the X Window environment, with local patches. Installed with
    the x*.tgz install file sets.
  * GCC versions 4.2.1 or 3.3.6 (depending on your platform) GNU C Compiler.
    Installed as part of the comp58.tgz file set.
  * Perl 5.20.2, with patches and improvements from the OpenBSD team.
  * LibreSSL, OpenBSD's replacement for OpenSSL.
  * SQLite 3.8.9, with patches and improvements from the OpenBSD team.
  * NSD 4.1.3 authoritative DNS server.
  * Unbound 1.5.4
  * Ncurses 5.7
  * Binutils 2.17 with patches.
  * gdb 6.3 with patches.
  * Less 458 with patches.
  * Awk Aug 10, 2011 version
  * OpenSSH 7.0
  * OpenSMTPD v5.4.4 Secure, simple and reliable Mail Transport Agent (MTA).
  * OpenNTPD Secure and simple Network Time Protocol implementation.
  * OpenBGPD and OpenOSPFD routing applications.
  * httpd, OpenBSD's own web server

As can be seen, the OpenBSD team often patches third-party products
(typically) to improve the security or quality of the code. In some cases, the
user will see no difference in operation, in other cases, there ARE
operational differences which may impact some users. Keep these enhancements
in mind before blindly adding different versions of the same software. You may
get a bigger version number, but a less secure system.

Of course, additional applications can be added through the OpenBSD packages
and ports system.

1.9 - What is new in OpenBSD 5.8?

The complete list of changes made to OpenBSD 5.7 to create OpenBSD 5.8 can be
found on plus58.html, and highlights on the OpenBSD 5.8 Information page,
however here are a few changes the OpenBSD team anticipate will require or
warrant some special note to people upgrading or installing OpenBSD 5.8 who
are familiar with older versions:

  * sudo removed in favor of doas(1). sudo is available as a package if
    needed. More info on doas(1) here
  * Root logins via SSH are actively discouraged. Default is to prohibit root
    login via SSH.
  * SSHv1 disabled at compile time. You shouldn't be using this anyway. Some
    other insecure protocols are disabled at runtime (i.e., config file
    options can reactivate), but some old clients may notice. This is a clue
    you should upgrade your client.
  * OpenNTPD active by default on new installs, and will by default use
    pool.ntp.org. You can reconfigure it by editing /etc/ntpd.conf(5) or
    disable it in /etc/rc.conf.local.

1.10 - Can I use OpenBSD as a desktop system?

This question is often asked in exactly this manner -- with no explanation of
what the asker means by "desktop". The only person who can answer that
question is you, as it depends on what your needs and expectations are.

While OpenBSD has a great reputation as a "server" operating system, it can be
and is used on the desktop. Many "desktop" applications are available through
packages and ports. As with all operating system decisions, the question is:
can it do the job you desire in the way you wish? You must answer this
question for yourself.

It might be worth noting that a large amount of OpenBSD development is done on
laptops running OpenBSD.

1.11 - Why is/isn't ProductX included?

People often ask why a particular product is or isn't included with OpenBSD.
The answer is based on two things: the wishes of the developers and
compatibility with the goals of the project. A product will not be included
simply because it is "nifty" -- it must also be "free" for use, distribution
and modification by our standards. A product must also be stable and secure --
a bigger version number does not always mean a better product.

License is often the biggest problem: we want OpenBSD to remain usable by any
person anywhere in the world for any purpose.

Another major consideration is the wishes of the developers. The OpenBSD
developers are the ultimate judges of what does and doesn't go into the
project. Just because an application is "good" doesn't mean the OpenBSD
project wishes to devote the resources needed to maintaining it, or that they
will share other's enthusiasm about its place in OpenBSD.

Some commonly asked questions about third-party products:

  * Why isn't Postfix included?
    The license is not free, and thus can not be considered.
  * Why isn't qmail or djbdns included?
    Neither program is what many Unix users "expect" out of a mail or DNS
    application.
  * Why is a web server included? It isn't needed by many people!
    Because the developers want it.
  * Why isn't bzip2 included instead of gzip?
    Performance is horrible, and benefit is minimal. Impact on slower
    platforms, such as VAX, would be unacceptable.
  * Why isn't there a graphical or curses(3) based installer?
    For a number of reasons, including the goal of keeping the installation
    boot media able to be a single floppy disk, the fact that one installer
    can be used on all platforms in all configurations, and the fact that
    after the second or third OpenBSD install, most users find the OpenBSD
    installation system among the fastest and easiest installers of any OS.
    Most developers and users greatly prefer the speed, power, and ease of use
    of the current installer to any of the more "colorful" or "pretty"
    installers on some other platforms.
  * Will ZFS be added to OpenBSD?
    Not unless someone can convince Oracle to change the license for it to
    something compatible with OpenBSD policy.

In most cases, these topics have been discussed in painful detail on the mail
lists, please see archives if you need more information.

Of course, if you wish to use one of these packages and your use is compatible
with the license of the products, no one will stop you (that wouldn't be very
free if we tried, would it?). However, your needs may change -- you may not
want to develop a "Killer Application" that you can't sell, distribute, or get
rich from because you incorporated non-free software into it.

------------------------------------------------------------------------------

==============================================================================

2 - Getting to know OpenBSD

------------------------------------------------------------------------------

Table of Contents

  * 2.1 - Web Pages
  * 2.2 - Mailing Lists
  * 2.3 - Manual Pages
  * 2.4 - Reporting Bugs

------------------------------------------------------------------------------

2.1 - Web Pages of Interest

The official website for the OpenBSD project is located at: http://
www.OpenBSD.org.

A lot of valuable information can be found here regarding all aspects of the
OpenBSD project.

The OpenBSD Journal is an OpenBSD-focused news and opinion site.

OpenBSDsupport.org is a site collecting "user maintained" documentation of
varying quality, but often covering topics not in this FAQ or other official
documentation.

Many users have set up sites and pages with OpenBSD specific information. As
with everything on the Internet, a good search engine is going to make your
life easier, as will a healthy dose of skepticism. As always, do not blindly
enter commands you do not understand into your computer.

2.2 - Mailing Lists

The OpenBSD project maintains several popular mailing lists which users should
subscribe to and follow. To subscribe to a mailing list, send an e-mail
message to majordomo@@openbsd.org. That address is an automated subscription
service. In the body of your message, on a single line, you should include a
subscribe command for the list you wish to join. For example:

    subscribe announce

The list processor will reply to you, asking for confirmation of your intent
to join the list, so that others can not subscribe you to a flood of unwanted
e-mail. The message will include instructions for several different ways to
confirm, including a list server web page link, responding to the confirmation
message or responding to majordomo@@openbsd.org. Use whatever method is
convenient to you. You will note that all three techniques involve a unique
and time limited identifying number, such as A56D-70D4-52C3, again to make
sure you are really the person who requested this mail list subscription (this
is real "opt-in").

Once you have confirmed your intent to join, you will be immediately added to
the list, and the list processor will notify you that you were successfully
added.

To unsubscribe from a list, you will again send an e-mail message to
majordomo@@openbsd.org. It might look like this:

    unsubscribe announce

If you have any difficulties with the mailing list system, please first read
the help file which can be obtained by sending an e-mail message to
majordomo@@openbsd.org with a message body of "help".

Your subscription to the OpenBSD mail lists can also be maintained through the
web interface at http://lists.openbsd.org.

Some of the more popular OpenBSD mailing lists are:

  * announce - Important announcements. This is a low-volume list.
  * security-announce - Announcements of security issues. This is a low volume
    list.
  * misc - General user questions and answers. This is the most active list,
    and should be the "default" for most questions.
  * bugs - Bugs received via sendbug(1) and discussions about them.
  * source-changes - Automated mailing of CVS source tree changes. Every time
    a developer commits a change to the OpenBSD source tree, CVS will send out
    a copy of the (usually brief) commit message via this list.
  * ports - Discussion of the OpenBSD Ports Tree.
  * ports-changes - Automated mailing of ports-specific CVS source tree
    changes.
  * advocacy - Discussion on advocating OpenBSD, and topics that are just too
    off-topic for misc.

Before posting a question on misc or any other mailing list, please check the
archives, for most common questions have been asked repeatedly. While it might
be the first time you have encountered the problem or question, others on the
mailing lists may have seen the same question several times in the last week,
and may not appreciate seeing it again. If asking a question possibly related
to hardware, always include a dmesg(8)!

You can find several archives, other mailing list guidelines and more
information on the mailing lists page.

An unofficial mailing list that may be of interest to new users of OpenBSD and
Unix is the OpenBSD Newbies list.

2.3 - Manual Pages

OpenBSD comes with extensive documentation in the form of manual pages.
Considerable effort is made to make sure the man pages are up-to-date and
accurate. In all cases, the man pages are considered the authoritative source
of information for OpenBSD.

To access the manual pages, be sure that you installed the man58.tgz file set.

Here is a list of some of the most useful manual pages for new users:

Getting Started

  * afterboot(8) - things to check after the first complete boot.
  * help(1) - help for new users and administrators.
  * hier(7) - layout of filesystems.
  * man(1) - display the on-line manual pages.
  * intro(1) - introduction to general commands, also see the intros to the
    other sections of the manual: intro(2), intro(3), intro(4) (note: intro(4)
    is platform specific), intro(5), intro(6), intro(7), intro(8), and intro
    (9).
  * adduser(8) - command for adding new users.
  * vipw(8) - edit the master password file.
  * disklabel(8) - read and write disk pack label.
  * reboot, halt(8) - stop and restart the system.
  * shutdown(8) - close down the system at a given time.
  * dmesg(8) - redisplay the kernel boot messages.
  * doas(1) - don't log in as root, but run commands as root.
  * mg(1) - emacs-like text editor.

For more advanced users

  * boot(8) - system bootstrapping procedures.
  * boot_config(8) - how to change kernel configuration at boot.
  * gcc-local(1) - OpenBSD-specific modifications to gcc(1).
  * ifconfig(8) - configure network interface parameters.
  * login.conf(5) - format of the login class configuration file.
  * netstat(1) - show network status.
  * release(8) - build an OpenBSD release.
  * sendbug(1) - send a problem report (PR) about OpenBSD to a central support
    site.
  * style(9) - OpenBSD kernel source code style guide.
  * sysctl(8) - get or set kernel state.

You can find all the OpenBSD man pages on the web at http://www.openbsd.org/
cgi-bin/man.cgi as well as on your computer if you install the man58.tgz file
set.

In general, if you know the name of a command or a manual page, you can read
it by executing "man command". For example: "man vi" to read about the vi
editor. If you don't know the name of the command, or if "man command" doesn't
find the manual page, you can search the manual page database by executing
"apropos something" or "man -k something", where "something" is a likely word
that might appear in the title of the manual page you're looking for. For
example:

    # apropos "time zone"
    tzfile (5) - time zone information
    zdump (8) - time zone dumper
    zic (8) - time zone compiler

The parenthetical numbers indicate the section of the manual in which that
page can be found. In some cases, you may find manual pages with identical
names living in separate sections of the manual. For example, assume that you
want to know the format of the configuration files for the cron daemon. Once
you know the section of the manual for the page you want, you would execute
"man n command", where n is the manual section number.

    # man -k cron
    cron (8) - clock daemon
    crontab (1) - maintain crontab files for individual users
    crontab (5) - tables for driving cron
    # man 5 crontab

For many, having a hardcopy of the man page can be useful. Here are the
guidelines to making a printable copy of a man page.

How do I display a man page source file (i.e. one whose filename ends in a
number, like tcpdump.8)?

These are found throughout the src tree. The man pages are found in the tree
unformatted, and many times, through the use of CVS, they will be updated. To
view these pages, simply:

    # mandoc <file> | more

How do I get a plain man page with no formatting or control characters?

This is helpful to get the man page straight, with no non-printable
characters.

    # man <command> | col -b

How can I get a PostScript copy of a man page that's print-ready?

Note that <file> must be the man page source file (probably a file that ends
in a number e.g. tcpdump.8). The PostScript versions of the man pages look
very nice. They can be printed or viewed on-screen with a program like gv
(GhostView). GhostView can be found in our packages collection. Use the
following mandoc(1) command options for getting a PostScript version from an
OpenBSD system man page:

    # mandoc -Tps <file> > outfile.ps

What are info files?

Some of the documentation for OpenBSD comes in the form of info files,
typically contained in /usr/share/info. This is an alternative form of
documentation provided by GNU. Many of these files are more up to date than
the manual pages provided by GNU, and can be accessed with the info(1)
command. For example, to view information about the GNU compiler, gcc(1),
type:

    # info gcc

After using info, you will really appreciate our man pages!

How do I get color man pages on XTerm?

The default configuration file for xterm(1) does not display color man pages.
In order to get color output, copy the file /usr/X11R6/share/X11/app-defaults/
XTerm-color to your home directory, and rename it ".Xdefaults". Be careful not
to overwrite any current settings in ".Xdefaults". This file contains all the
settings you need to enable color in XTerm. However, three lines need to be
uncommented before this can work:

    !*VT100*colorULMode: on
    !*VT100*underLine: off
    !*VT100*colorBDMode: on

The rest of this file allows you to choose colors for various settings. The
relevant ones to the man pages are:

    *VT100*colorUL: yellow
    *VT100*colorBD: white

That produces rather hellish looking man pages, so customize as necessary: may
we suggest red for "colorUL" and magenta for "colorBD"? There is also a man
page viewer for X11 available, xman(1), which provides an alternative
(graphical) interface to the manual pages. See the manual pages for xterm and
xman for more information.

How do I write my own manual page?

If you wish to write your own man page for an application you have written,
there is a handy reference guide provided in mdoc(7).

2.4 - Reporting Bugs

Before crying "Bug!", please make sure that is really what you are dealing
with. If instead, you are not understanding how something is done in OpenBSD
or how it works, and can't find out how to resolve the problem using the
manual pages or the OpenBSD website, use the mail lists (usually
misc@@openbsd.org) to request help. If this is your first OpenBSD experience,
be realistic: you probably did not discover an unknown bug. Also note that
faulty hardware can mimic a software bug, please verify the current condition
of your hardware before deciding you have found a "bug".

Finally, before submitting any bug report, please read http://www.openbsd.org/
report.html.

Proper bug reporting is one of the most important responsibilities of end
users. Very detailed information is required to diagnose most serious bugs.
Developers frequently get bugs reports via e-mail such as this:

From: joeuser@@example.com
To: bugs@@openbsd.org
Subject: HELP!!!

I have a PC and it won't boot!!!!! It's a 486!!!!!

Hopefully most people understand why such reports get summarily deleted. All
bug reports should contain detailed information. If Joe User had really
expected someone to help find this bug, he or she would have supplied more
information... something like this:

From: smartuser@@example.com
To: bugs@@openbsd.org
Subject: 3.3-beta panics on a SPARCStation2

OpenBSD 3.2 installed from an official CD-ROM installed and ran fine
on this machine.

After doing a clean install of 3.3-beta from an FTP mirror, I find the
system randomly panics after a period of use, and predictably and
quickly when starting X.

This is the dmesg output:

OpenBSD 3.3-beta (GENERIC) #9: Mon Mar 17 12:37:18 MST 2003
    deraadt@@sparc.openbsd.org:/usr/src/sys/arch/sparc/compile/GENERIC
real mem = 67002368
avail mem = 59125760
using 200 buffers containing 3346432 bytes of memory
bootpath: /sbus@@1,f8000000/esp@@0,800000/sd@@1,0
mainbus0 (root): SUNW,Sun 4/75
cpu0 at mainbus0: CY7C601 @@ 40 MHz, TMS390C602A FPU; cache chip bug
- trap page uncached
cpu0: 64K byte write-through, 32 bytes/line, hw flush cache enabled
memreg0 at mainbus0 ioaddr 0xf4000000
clock0 at mainbus0 ioaddr 0xf2000000: mk48t02 (eeprom)
timer0 at mainbus0 ioaddr 0xf3000000 delay constant 17
auxreg0 at mainbus0 ioaddr 0xf7400003
zs0 at mainbus0 ioaddr 0xf1000000 pri 12, softpri 6
zstty0 at zs0 channel 0 (console i/o)
zstty1 at zs0 channel 1
zs1 at mainbus0 ioaddr 0xf0000000 pri 12, softpri 6
zskbd0 at zs1 channel 0: reset timeout
zskbd0: no keyboard
zstty2 at zs1 channel 1: mouse
audioamd0 at mainbus0 ioaddr 0xf7201000 pri 13, softpri 4
audio0 at audioamd0
sbus0 at mainbus0 ioaddr 0xf8000000: clock = 20 MHz
dma0 at sbus0 slot 0 offset 0x400000: rev 1+
esp0 at sbus0 slot 0 offset 0x800000 pri 3: ESP100A, 25MHz, SCSI ID 7
scsibus0 at esp0: 8 targets
sd0 at scsibus0 targ 1 lun 0: <SEAGATE, ST1480 SUN0424, 8628> SCSI2 0/direct fixed
sd0: 411MB, 1476 cyl, 9 head, 63 sec, 512 bytes/sec, 843284 sec total
sd1 at scsibus0 targ 3 lun 0: <COMPAQPC, DCAS-32160, S65A> SCSI2 0/direct fixed
sd1: 2006MB, 8188 cyl, 3 head, 167 sec, 512 bytes/sec, 4110000 sec total
le0 at sbus0 slot 0 offset 0xc00000 pri 5: address 08:00:20:13:10:b9
le0: 16 receive buffers, 4 transmit buffers
cgsix0 at sbus0 slot 1 offset 0x0: SUNW,501-2325, 1152x900, rev 11
wsdisplay0 at cgsix0
wsdisplay0: screen 0 added (std, sun emulation)
fdc0 at mainbus0 ioaddr 0xf7200000 pri 11, softpri 4: chip 82072
fd0 at fdc0 drive 0: 1.44MB 80 cyl, 2 head, 18 sec
root on sd0a
rootdev=0x700 rrootdev=0x1100 rawdev=0x1102


This is the panic I got when attempting to start X:

panic: pool_get(mclpl): free list modified: magic=78746572; page 0xfaa93000;
 item addr 0xfaa93000
Stopped at      Debugger+0x4:   jmpl            [%o7 + 0x8], %g0
RUN AT LEAST 'trace' AND 'ps' AND INCLUDE OUTPUT WHEN REPORTING THIS PANIC!
DO NOT EVEN BOTHER REPORTING THIS WITHOUT INCLUDING THAT INFORMATION!
ddb> trace
pool_get(0xfaa93000, 0x22, 0x0, 0x1000, 0x102, 0x0) at pool_get+0x2c0
sosend(0x16, 0xf828d800, 0x0, 0xf83b0900, 0x0, 0x0) at sosend+0x608
soo_write(0xfac0bf50, 0xfac0bf70, 0xfac9be28, 0xfab93190, 0xf8078f24, 0x0)
at soo_write+0x18
dofilewritev(0x0, 0xc, 0xfac0bf50, 0xf7fff198, 0x1, 0xfac0bf70) at
dofilewritev+0x12c
sys_writev(0xfac87508, 0xfac9bf28, 0xfac9bf20, 0xf80765c8, 0x1000, 0xfac0bf70)
at sys_writev+0x50
syscall(0x79, 0xfac9bfb0, 0x0, 0x154, 0xfcffffff, 0xf829dea0) at syscall+0x220
slowtrap(0xc, 0xf7fff198, 0x1, 0x154, 0x1, 0xfac87508) at slowtrap+0x1d8
ddb> ps
   PID   PPID   PGRP    UID  S       FLAGS  WAIT       COMMAND
 27765   8819  29550      0  3        0x86  netio      xconsole
  1668  29550  29550      0  3      0x4086  poll       fvwm
 15447  29550  29550      0  3     0x44186  poll       xterm
  8819  29550  29550     35  3      0x4186  poll       xconsole
  1238  29550  29550      0  3      0x4086  poll       xclock
 29550  25616  29550      0  3      0x4086  pause      sh
  1024  25523  25523      0  3     0x40184  netio      XFree86
*25523  25616  25523     35  2     0x44104             XFree86
 25616  30876  30876      0  3      0x4086  wait       xinit
 30876  16977  30876      0  3      0x4086  pause      sh
 16977      1  16977      0  3      0x4086  ttyin      csh
  5360      1   5360      0  3        0x84  select     cron
 14701      1  14701      0  3     0x40184  select     sendmail
 12617      1  12617      0  3        0x84  select     sshd
 27515      1  27515      0  3       0x184  select     inetd
  1904      1   1904      0  2        0x84             syslogd
  9125      1   9125      0  3        0x84  poll       dhclient
     7      0      0      0  3    0x100204  crypto_wa  crypto
     6      0      0      0  3    0x100204  aiodoned   aiodoned
     5      0      0      0  3    0x100204  syncer     update
     4      0      0      0  3    0x100204  cleaner    cleaner
     3      0      0      0  3    0x100204  reaper     reaper
     2      0      0      0  3    0x100204  pgdaemon   pagedaemon
     1      0      1      0  3      0x4084  wait       init
     0     -1      0      0  3     0x80204  scheduler  swapper

Thank you!

See report.html for more information on creating and submitting bug reports.
Detailed information about your hardware is necessary if you think the bug
could be in any way related to your hardware or hardware configuration.
Usually, dmesg(8) output is sufficient in this respect. A detailed description
of your problem is necessary. You will note that the dmesg described the
hardware, the text explained why Smart User thought the system was not broken
(ran 3.2 properly), how this crash was caused (starting X), and the output of
the debugger's "ps" and "trace" commands. In this case, Smart User provided
output captured on a serial console; if you can not do that, you will have to
use paper and pencil to record the crash. (This was a real problem, and the
information in the above report helped lead to a repair of this issue which
impacted Sun4c systems.)

If Smart User had a working OpenBSD system, he would have used the sendbug(1)
utility to submit his bug report. Obviously you can't use sendbug(1) when your
system won't boot, but you should use it whenever possible. You will still
need to include detailed information about what happened, the exact
configuration of your system, and how to reproduce the problem. The sendbug(1)
command requires that your system be able to send electronic mail successfully
on the Internet. Note that the mail server uses spamd(8) based greylisting, so
it may take half an hour or so before the mail server accepts your bug report,
so please be patient.

After submitting a bug report via sendbug(1), you may be contacted by
developers for additional information or with patches that need testing. You
can also monitor the archives of the bugs@@openbsd.org mailing list, details on
the mailing list page.

How do I get more useful info for developers?

Here are a few additional tips:

Lost the "Panic message"?
Under some circumstances, you may lose the very first message of a panic,
stating the reason for the panic. This is a very important message, so you
want to report it, as well. You can get this back by using the "show panic"
command in ddb> like this:

ddb> show panic
0:      kernel: page fault trap, code=0
ddb>

In this case, the panic string was "Kernel: page fault trap, code=0".

Special note for SMP systems:
You should get a "trace" from each processor as part of your report:

ddb{0}> trace
pool_get(d05e7c20,0,dab19ef8,d0169414,80) at pool_get+0x226
fxp_add_rfabuf(d0a62000,d3c12b00,dab19f10,dab19f10) at fxp_add_rfabuf+0xa5
fxp_intr(d0a62000) at fxp_intr+0x1e7
Xintr_ioapic0() at Xintr_ioapic0+0x6d
--- interrupt ---
idle_loop+0x21:
ddb{0}> machine ddbcpu 1
Stopped at      Debugger+0x4:   leave
ddb{1}> trace
Debugger(d0319e28,d05ff5a0,dab1bee8,d031cc6e,d0a61800) at Debugger+0x4
i386_ipi_db(d0a61800,d05ff5a0,dab1bef8,d01eb997) at i386_ipi_db+0xb
i386_ipi_handler(b0,d05f0058,dab10010,d01d0010,dab10010) at i386_ipi_handler+0x
4a
Xintripi() at Xintripi+0x47
--- interrupt ---
i386_softintlock(0,58,dab10010,dab10010,d01e0010) at i386_softintlock+0x37
Xintrltimer() at Xintrltimer+0x47
--- interrupt ---
idle_loop+0x21:
ddb{1}>

Repeat the "machine ddbcpu x" followed by "trace" for each processor in your
machine.

How do I gather further information from a kernel crash?

A typical kernel crash on OpenBSD might look like this: (things to watch for
are marked with bold font)

kernel: page fault trap, code=0
Stopped at    _pf_route+0x263:        mov     0x40(%edi),%edx
ddb>

The first command to run from the ddb> prompt is "trace" (see ddb(4) for
details):

ddb> trace
_pf_route(e28cb7e4,e28bc978,2,1fad,d0b8b120) at _pf_route+0x263
_pf_test(2,1f4ad,e28cb7e4,b4c1) at _pf_test+0x706
_pf_route(e28cbb00,e28bc978,2,d0a65440,d0b8b120) at _pf_route+0x207
_pf_test(2,d0a65440,e28cbb00,d023c282) at _pf_test+0x706
_ip_output(d0b6a200,0,0,0,0) at _ip_output+0xb67
_icmp_send(d0b6a200,0,1,a012) at _icmp_send+0x57
_icmp_reflect(d0b6a200,0,1,0,3) at _icmp_reflect+0x26b
_icmp_input(d0b6a200,14,0,0,d0b6a200) at _icmp_input+0x42c
_ipv4_input(d0b6a200,e289f140,d0a489e0,e289f140) at _ipv4_input+0x6eb
_ipintr(10,10,e289f140,e289f140,e28cbd38) at _ipintr+0x8d
Bad frame pointer: 0xe28cbcac
ddb>

This tells us what function calls lead to the crash.

To find out the particular line of C code that caused the crash, you can do
the following:
Find the source file where the crashing function is defined in. In this
example, that would be pf_route() in sys/net/pf.c. Recompile that source file
with debug information:

# cd /usr/src/sys/arch/$(uname -m)/compile/GENERIC/
# rm pf.o
# DEBUG=-g make pf.o

Then use objdump(1) to get the disassembly:

# objdump --line --disassemble --reloc pf.o >pf.dis

In the output, grep for the function name (pf_route in our example):

# grep "<_pf_route>:" pf.dis
00007d88 <_pf_route>:

Take this first hex number and add the offset from the 'Stopped at' line:
0x7d88 + 0x263 == 0x7feb.
Scroll down to that line (the assembler instruction should match the one
quoted in the 'Stopped at' line), then up to the nearest C line number:

# more pf.dis
/usr/src/sys/arch/i386/compile/GENERIC/../../../../net/pf.c:3872
    7fe7:       0f b7 43 02             movzwl 0x2(%ebx),%eax
    7feb:       8b 57 40                mov    0x40(%edi),%edx
    7fee:       39 d0                   cmp    %edx,%eax
    7ff0:       0f 87 92 00 00 00       ja     8088 <_pf_route+0x300>

So, it's precisely line 3872 of pf.c that crashes:

# cat -n pf.c | head -n 3872 | tail -n 1
3872          if ((u_int16_t)ip->ip_len <= ifp->if_mtu) {

Note that the kernel that produced the crash output and the object file for
objdump must be compiled from the exact same source file, otherwise the
offsets won't match.

If you provide both the ddb> trace output and the relevant objdump section,
that's very helpful.

------------------------------------------------------------------------------

==============================================================================

3 - Getting started with OpenBSD

------------------------------------------------------------------------------

Table of Contents

  * 3.1 - Buying an OpenBSD CD set
  * 3.2 - Buying OpenBSD T-Shirts
  * 3.3 - Does OpenBSD provide an ISO image for download?
  * 3.4 - Downloading via HTTP, RSYNC or AFS
  * 3.5 - Verifying your download
  * 3.6 - Selecting Hardware
  * 3.7 - What is an appropriate "first system" to learn OpenBSD on?

------------------------------------------------------------------------------

3.1 - Buying an OpenBSD CD set

Purchasing an OpenBSD CD set is generally the best way to get started. Visit
the ordering page to purchase your copy: OpenBSD ordering page.

There are many good reasons to own an OpenBSD CD set:

  * CD sales support ongoing development of OpenBSD.
  * Development of a multi-platform operating system requires constant
    investment in equipment.
  * Your support in the form of a CD set purchase has a real impact on future
    development.
  * The CDs contains binaries (and source) for the most popular supported
    platforms.
  * The CDs are bootable on several platforms, and can be used to bootstrap a
    machine without a pre-existing installed operating system.
  * The CDs are useful for bootstrapping even if you choose to install a
    snapshot.
  * Installing from CD is faster! Installing from CD preserves network
    connectivity resources.
  * OpenBSD CDs always come with very nice stickers. Your system isn't fully
    complete without these. You can only get these stickers by buying a CD set
    or donating hardware.
  * The CD set is complete enough to bring up a full development environment
    without any network connection at all.

If you're installing a release version of OpenBSD, you should use an official
CD set.

3.2 - Buying OpenBSD T-Shirts

Yes, OpenBSD has T-shirts for your wearing enjoyment. You can view these at
the OpenBSD T-shirts page. Enjoy :)

3.3 - Does OpenBSD provide an ISO image for download?

For select platforms, yes!

Most platforms that are able to boot from CD-ROM have ISO images available for
download which can be used to create bootable OpenBSD install CD-ROMs. Both
"full install" (all files needed for a full OpenBSD install, named
install58.iso) and "boot only" (for installing from a network file source,
named cd58.iso) ISOs are provided for these platforms.

Note, these ISO files are not the same as the official CD set. These images
are for single platforms, and do not include any of the pre-compiled packages,
stickers, or artwork that the official CD set does.

The OpenBSD project does not make the ISO images used to master the official
CDs available for download. The reason is simply that we would like you to buy
the CD sets to help fund ongoing OpenBSD development. The official OpenBSD
CD-ROM layout is copyright Theo de Raadt. Theo does not permit people to
redistribute images of the official OpenBSD CDs. As an incentive for people to
buy the CD set, some extras are included in the package as well (artwork,
stickers etc).

Note that only the CD layout is copyrighted, OpenBSD itself is free. Nothing
precludes someone else from downloading OpenBSD and making their own CD.

Those that need or want a bootable USB drive can use the install58.fs
(bootable, plus install sets) or miniroot58.fs (just bootable, file sets are
pulled down via network) files, which can be imaged onto a USB flash disk or
other storage device.

3.4 - Downloading via HTTP, RSYNC or AFS

There are numerous international mirror sites offering HTTP access to OpenBSD
releases and snapshots. RSYNC and AFS access are also available. You should
always use the site nearest to you. Before you begin fetching a release or
snapshot, you may wish to use ping(8) and traceroute(8) to determine which
mirror site is nearest to you and whether that mirror is performing
adequately. Of course, your OpenBSD release CD is always closer than any
mirror. Access information is here:

OpenBSD Download page.

3.5 - Verifying your download

In the same directory as the installation sets, each mirror includes a file
named SHA256 which contains checksums of the various installation files. You
can confirm that none of the downloaded files were mangled in transit using
the sha256(1) command:

    $ sha256 -c SHA256

Starting with OpenBSD 5.5, you can also use signify(1) to verify your files:

    $ signify -C -p /etc/signify/openbsd-58-base.pub -x SHA256.sig install58.iso
    Signature Verified
    install58.iso: OK

which will verify the file install58.iso. Note that you will need the public
key files for OpenBSD 5.8 (and the signify program!) in order to do this.

3.6 - Selecting Hardware

Selecting appropriate hardware to run your OpenBSD system on is important, as
it can mean the difference between success and failure of a project.

If you are shopping for a new PC, whether you are buying it piece by piece or
completely pre-built, you want to make sure first that you are buying reliable
parts. In the PC world, this is not easy. Bad or otherwise unreliable or
mismatched parts can make OpenBSD run poorly and crash often. The best advice
we can give is to be careful, and buy brands and parts that have been reviewed
by an authority you trust. Sometimes, a higher-price machine is a better
quality machine. Other times, it is simply more expensive.

There are certain things that will help bring out the maximum performance of
your system:

  * Let the application choose the hardware: It is usually better to make an
    adjustment to the hardware you were planning on using rather than
    compromising on your application design because you have something you
    "really wanted to use".
  * Identify your bottlenecks: Don't pay extra for the cutting-edge processor
    if your application is restricted by disk I/O. Don't pay for fast disk if
    your system is restricted by network speed. Don't pay for much of anything
    if your bottleneck is a 128kbps DSL line.
  * Keep it simple: Simple hardware usually has simple problems. Complex
    hardware that isn't supposed to ever break may take you a long time to
    repair when it breaks anyway.
  * Use hardware you understand, or learn the new hardware before you
    implement a production system: Regardless of the technical merits of the
    hardware, committing to use a particular type of hardware before you have
    become familiar with it, both how it works and how it fails, is foolish.
  * Use multiple disks: Instead of buying one large disk, buy multiple smaller
    disks. While this may cost more, distributing the load over multiple
    spindles will decrease the amount of time necessary to access data on the
    disks. And, with more spindles, you can get more reliability and faster
    data access with RAID.
  * Break up large blocks of storage: Many people make the mistake of
    designing a system that stores large amounts of data to have one Big Block
    of Storage. This is usually a bad design. You will usually find it much
    better to break up your storage into manageable blocks. This has many
    advantages, two of the biggest being that you can add more storage later
    when you need it easily (you weren't going to get the requirements
    estimate right, no one ever does), and you can buy a small amount of
    storage now, and add much more later when the price will have most likely
    dropped and the capacity will have increased.
  * Avoid cheap network adapters: OpenBSD supports a plethora of cheap network
    adapters. These adapters work great in home systems, and low or moderate
    throughput business and research environments. But, if you need high
    throughput and low impact on your server, you are better off buying a
    quality network adapter. Unfortunately, some name-brand adapters are not
    much better than the cheap adapters, and some potentially good adapters do
    not have accurate documentation available to write good drivers. Gigabit
    adapters often perform better than 10Mbps/100Mbps adapters, even when used
    on slower speed networks, due to superior buffering.

3.7 - What is an appropriate "first system" to learn OpenBSD on?

While OpenBSD will run on a smaller, older and less powerful computer than
just about any other modern OS, if you are just getting started with OpenBSD,
using too little machine can be frustrating. The following guidelines are ONLY
guidelines; OpenBSD will run very well on much more modest equipment than is
listed here, but it may be more frustrating than needed for a first-time user.

  * Platform: Use a platform you are familiar with already. When you are
    learning a new operating system, it is a very bad time to also be learning
    a new platform. We'll assume you are going to be using the i386 or amd64
    platforms here, as they are probably the ones most people are familiar
    with. Once you are familiar with OpenBSD, though, it makes a good
    introduction to other platforms.
  * Processor: 233MHz Pentium II or better processor. Yes, OpenBSD will run on
    a 25MHz 80486, but you won't want to do the experimenting and messing up
    and reloading you need to do to really get to know the system on a slow
    machine. The primary irritation you will first encounter with a processor
    slower than this is the time it takes to SSH into the box.
  * 128M RAM or better: If you wish to run X, 256M would be a better starting
    point.
  * Hard disk: A 1G hard disk will give you an easy install of a simple
    system, such as a firewall, DNS server, or similar. If you wish to rebuild
    the system from source, you will probably want a 8G disk. SATA or IDE
    disks are recommended to start with. If you have a much larger disk, don't
    feel the obligation to allocate all the disk initially -- there is nothing
    wrong with leaving 72G of an 80G hard disk unallocated if all you need is
    8G.
  * Network adapter: Use a PCI or PCIe adapter. If you are planning on putting
    multiple network adapters in the machine, write the MAC address on the
    spine of the card before putting the cover on. While the urge to use that
    old ISA adapter you have may be strong, resist. You probably don't
    remember how to properly configure it.
  * Multibooting: For your first OpenBSD installation, don't attempt to
    multiboot with another OS. Multibooting is a difficult process to get
    right, and you must understand all the OSs involved well before attempting
    this, which is clearly not the case on your first installation. It is very
    possible you could accidently delete all data on the system. Rather, use a
    dedicated computer, or at least, a dedicated disk on a machine.
  * Laptops: While many laptops work very well with OpenBSD, they are
    sometimes not the easiest systems to get running well, so a laptop might
    not be the best choice for your first OpenBSD install. However, once you
    are comfortable with OpenBSD, a laptop can be a very useful tool.
  * New hardware: Brand new, cutting-edge hardware is sometimes not yet
    supported by OpenBSD, so for your first OpenBSD system, a slightly older
    machine is recommended.

Obviously, "the more, the better" to a point. While OpenBSD's requirements are
very modest, some popular applications seemingly use as much processor and
memory as you can throw at the system.

------------------------------------------------------------------------------

==============================================================================

4 - OpenBSD 5.8 Installation Guide

------------------------------------------------------------------------------

Table of Contents

  * 4.1 - Overview of the OpenBSD installation procedure
  * 4.2 - Pre-installation checklist
  * 4.3 - Creating bootable OpenBSD install media
      + 4.3.1 - Creating a boot CD
      + 4.3.2 - Creating floppies
      + 4.3.4 - Creating a bootable install flash drive from Unix
  * 4.4 - Booting OpenBSD install media
  * 4.5 - Performing a simple install
      + 4.5.1 - Starting the install
      + 4.5.2 - The Install Questions
      + 4.5.3 - Setting up disks
      + 4.5.4 - Choosing installation media and file sets
      + 4.5.5 - First Boot!
      + 4.5.6 - One Last Thing...
  * 4.6 - Details for a more complex install
      + 4.6.1 - Setting up the network
      + 4.6.2 - Setting the time zone
      + 4.6.3 - Custom fdisk(8) layout
      + 4.6.4 - Custom disklabel layout
  * 4.7 - What files are needed for installation?
  * 4.8 - How should I partition my disk?
  * 4.9 - Multibooting OpenBSD (amd64, i386)
  * 4.10 - Sending your dmesg to dmesg@@openbsd.org after the install
  * 4.11 - Adding a file set after install
  * 4.12 - What is 'bsd.rd'?
  * 4.13 - Common installation problems
      + 4.13.2 - My i386 won't boot after install
      + 4.13.3 - My machine booted, but hung at the ssh-keygen process
      + 4.13.4 - Why don't the downloadable images include SHA256.sig?
      + 4.13.5 - My fdisk partition table is trashed or blank!
      + 4.13.6 - I have no floppy or CD-ROM on my machine
      + 4.13.7 - I got the message "Failed to change directory" when doing an
        install!
  * 4.14 - Customizing the install process
  * 4.15 - How can I install a number of similar systems?
  * 4.16 - How can I get a dmesg(8) to report an install problem?

------------------------------------------------------------------------------

4.1 - Overview of the OpenBSD installation procedure

OpenBSD has long been respected for its simple and straight forward
installation process, which is very consistent across all platforms.

All platforms use a very similar installation procedure, however there are
some minor differences in details on a few platforms. In all cases, you are
urged to read the platform-specific INSTALL document in the platform directory
on the CD-ROM or FTP sites (for example, i386/INSTALL.i386, macppc/
INSTALL.macppc or sparc/INSTALL.sparc).

The OpenBSD installer is a special kernel with a number of utilities and
install scripts embedded in a pre-loaded RAM disk. After this kernel is
booted, the operating system is extracted from a number of compressed tar(1)
(.tgz) files from a source other than this pre-loaded RAM disk. There are
several ways to boot this install kernel:

  * Floppy disk: At this point, if you are running a system that only has
    floppy support, we will consider you an advanced user who probably doesn't
    need this FAQ for guidance.
  * CD-ROM: On several platforms a CD-ROM image (cd58.iso for just booting, or
    install58.iso for the entire install) is provided allowing creation of a
    bootable CD-ROM.
  * Existing partition: The RAM disk kernel can be booted off an already
    existing partition for an upgrade or reinstall.
  * Network: Some platforms support booting over a network (for example using
    PXE or other network boot).
  * Writing a file system image to disk (miniroot): Typically, these are
    written to a USB device to boot up the install kernel.

Not every platform supports all boot options:

  * alpha: Floppy, CD-ROM, network, writing a floppy image to hard disk.
  * amd64: Floppy, CD-ROM, miniroot, network.
  * armish: Varies by machine.
  * aviion: Network, existing OS partition.
  * hppa: Network.
  * i386: Floppy, CD-ROM, miniroot, network.
  * landisk: Miniroot, installed using another computer.
  * loongson: Miniroot, existing OS partition.
  * luna88k: Network.
  * macppc: CD-ROM, network.
  * octeon: Network.
  * sgi: Network, CDROM.
  * socppc: Network.
  * sparc: Floppy, CD-ROM, network, writing image to existing swap partition.
  * sparc64: Floppy (U1/U2 only), CD-ROM, network, writing image to existing
    partition.
  * vax: Floppy, network.
  * zaurus: Boot bsd.rd from Linux partition. See INSTALL.zaurus for details.

All platforms can also use a bsd.rd to reinstall or upgrade.

Once the install kernel is booted, you have several options of where to get
the install file sets. Again, not every platform supports every option.

  * CD-ROM: Of course, we prefer you use the Official CD-ROM set, but you can
    also use install58.iso or you can make your own.
  * HTTP: Either one of the OpenBSD HTTP mirror sites or your own local web
    server holding the file sets.
  * Local disk partition: In many cases, you can install file sets from
    another partition on a local hard disk. For example, on i386, you can
    install from a FAT partition or a CD-ROM formatted in ISO9660, Rock Ridge
    or Joliet format. In some cases, you will have to manually mount the file
    system before using it.
  * NFS: Some platforms support using NFS mounts for the file sets.

4.2 - Pre-installation checklist

Before you start your install, you should have some idea what you want to end
up with. You will want to know the following items, at least:

  * Machine name.
  * Hardware installed and available:
      + Verify compatibility with your platform's hardware compatibility page.
      + If ISA, you also need to know hardware settings, and confirm they are
        as OpenBSD requires.
  * Install method to be used (CD-ROM, HTTP, etc.).
  * Should an important bug be found, how will the system be patched?
      + If done locally, you will need to have sufficient space available for
        the source tree and building it.
      + Otherwise, you will need access to another machine to build a patched
        release on.
  * Desired disk layout:
      + Does existing data need to be saved elsewhere?
      + Will OpenBSD coexist on this system with another OS? If so, how will
        each system be booted? Will you need to install a "boot manager"?
      + Will the entire disk be used for OpenBSD, or do you want to keep an
        existing partition/OS (or space for a future one)?
      + How do you wish to sub-partition the OpenBSD part of your disk?
  * Network settings, if not using DHCP:
      + Domain name.
      + Domain Name Server(s) (DNS) address.
      + IP addresses and subnet masks for each NIC.
      + Gateway address.
  * Will you be running the X Window System?

4.3 - Creating bootable OpenBSD install media

Before creating install media, you may wish to verify the signatures on your
downloads.

Note that it is not possible for the downloaded files to directly check
themselves -- an altered download would always say the files validated
perfectly, of course!

As examples, we will look at the installation images available for the i386
and sparc platforms.

The i386 platform has five separate installation disk images to choose from:

  * cd58.iso is an ISO9660 image that can be used to create a bootable CD with
    most popular CD-ROM creation software on most platforms. This image has
    the widest selection of drivers, and is usually the recommended choice if
    your hardware can boot from a CDROM.
  * install58.iso is an ISO9660 image, containing all the standard install
    files. This file can be used to create a CD that can do a stand-alone
    OpenBSD install.
  * floppy58.fs (Desktop PC) supports many older machines that lack bootable
    CDROMs. Not recommended for modern hardware.
  * miniroot58.fs is a disk image, can be written to a bootable device, such
    as a USB flash drive, and booted for the install. This is equivalent to
    using the cd58.iso for install. File sets would then be pulled down via
    network; they are not on this file system.
  * install58.fs much like miniroot58.fs, but includes all the file sets for
    install. This is equivalent to using install58.iso.

The sparc platform has four separate installation disk images to choose from:

  * floppy58.fs supports systems with a floppy disk.
  * cd58.iso is an ISO image usable to make your own CD for booting SPARC
    systems with a CD-ROM.
  * miniroot58.fs can be written to a swap partition and booted.
  * install58.iso is an ISO9660 image, containing all the standard install
    files. This file can be used to create a CD that can do a stand-alone
    OpenBSD install.

On modern platforms, you are best advised to not use floppy install boot
images, as in some of the "bigger" platforms (such as amd64, sparc64), the
floppy images have had to have a lot of drivers and utilities cut out, which
can make installation much more difficult.

4.3.1 - Making a CD-ROM

You can create a CD-ROM using the cd58.iso or install58.iso files. The exact
details here are left to the reader to determine with the tools they have at
their disposal. Do note that the goal is to create a CD based on the image
file, not to put the ISO file on a CD as a single file.

In OpenBSD, you can create a CD from an ISO image using cdio(1):

  # cdio tao cd58.iso

Modern Windows and Macintosh systems can directly create CDs from ISO images.

Other Unix-like systems use applications such as cdrkit.

4.3.2 - Creating floppies

Creating floppies in OpenBSD can be done with the fdformat(1) to prep the disk
and dd(1). to write the image, then cmp(1) to verify the write was good.
Similar process and tools can be used on other Unix platforms.

Creating floppies on Windows can be done with the native low-level formatting
tools, and a program like ntrw which can be retrieved from the tools directory
on any of the FTP mirrors.

4.3.3 - Creating a bootable install flash drive from Unix

A bootable USB flash drive (or a CF/SD/other card, external hard disk, etc)
can be created by installing the target device on a Unix machine via any
recognized adapters, then copying over the image with dd

Here is an OpenBSD example, assuming the device was recognized as "sd6":

  # dd if=/location/install58.fs of=/dev/rsd6c bs=1m

Details of this will vary on other platforms -- the important things are:

  * if= the location and name of the image file
  * of= the name of the device being written to -- the device must be the
    ENTIRE device (in BSD language, the 'c' partition), and a raw I/O device
    (the 'r' in front of the device "sd6"), not a block mode device. In some
    Linux variants, it might be "/dev/sdg" (all of the seventh ("g") sd disk).
  * bs=1m sets a block size of one megabyte (1024K), which typically greatly
    increases the creation speed. Size is not critical.

4.4 - Booting OpenBSD install media

Booting i386/amd64

Booting an install media on the i386 and amd64 PC platforms is nothing new to
most people. Your system will have to be instructed to boot from whatever
media you have chosen to use, usually through a BIOS setup option. If you want
to boot from CD or a USB device, your system BIOS must be able to and be set
to do so. Note that some machines are buggy with regard to booting from USB
devices; a BIOS update may help.

You can also install by booting bsd.rd from an existing OpenBSD partition, or
over the network using the PXE boot process.

Booting sparc/sparc64

NOTE: On the sparc64 platform, only the SBus machines (Ultra 1, Ultra 2) are
bootable from floppy.

You will need the system to be at a monitor ROM prompt, which typically looks
like "ok ". If you are using a Sun keyboard, press and hold "STOP" while
tapping "A". If using a serial console, a BREAK should return you to the
monitor prompt.

Use the following command to boot from the floppy:

  ok boot floppy

Usually, you can boot from the CDROM drive of a Sun system from the boot
prompt by typing 'boot cdrom':

  ok boot cdrom

4.5 - Performing a simple install

OpenBSD's new installer is designed to install and configure OpenBSD in a very
usable default configuration with very little user intervention. In fact, you
can often just hit ENTER a number of times to get a good OpenBSD install,
moving your hands to the rest of the keyboard only to enter the root password.

The installer will create a partitioning plan based on the size of your hard
disk. While this will NOT be a perfect layout for all people, it provides a
good starting point and a good overall strategy for figuring out what you
need.

We will start with a very simple install, with brief discussions of the
options provided, and using the magic of hypertext links, allow you to read
more on the topics that interest you and explore your options.

Installation notes for each platform are on the install CDs and FTP servers,
in the file INSTALL.<plat>, where <plat> is your platform, for instance, i386.

4.5.1 - Starting the install

Whatever your means of booting is, it is now time to use it. During the boot
process, the kernel and all of the programs used to install OpenBSD are loaded
into memory. Once the install kernel is booted, the boot media is no longer
needed, everything runs from the RAM disk. You can actually remove the CD,
flash drive or floppy you booted from at this point, assuming you don't need
it for installation files.

At almost any point during the OpenBSD install process, you can terminate the
current install attempt by hitting CTRL-C and can restart it without rebooting
by running install at the shell prompt. You can also enter a "!" at most
places in the installation to get to a shell prompt, then exit the shell to
return to the installer.

When your boot is successful, you will see a lot of text messages scroll by.
This text, on many architectures in white on blue, is the dmesg, the kernel
telling you what devices have been found and how they are hooked to other
devices. A copy of this text is saved as /var/run/dmesg.boot.

Then, you will see the following:

  ...
  root on rd0a swap on rd0b dump on rd0b
  erase ^?, werase ^W, kill ^U, intr ^C, status ^T

  Welcome to the OpenBSD/i386 5.8 installation program.
  (I)nstall, (U)pgrade, (A)utoinstall or (S)hell? i

And with that, we reach our first question. You have the four options shown:

  * Install: Load OpenBSD onto the system, overwriting whatever may have been
    there. Note that it is possible to leave some partitions untouched in this
    process, such as a /home, but otherwise, assume everything else is
    overwritten.
  * Upgrade: Install a new set of install files on this machine, but do not
    overwrite any configuration information, user data, or additional
    programs. No disk formatting is done, nor are the /etc or /var directories
    overwritten. A few important notes:
      + After the install, you will have to manually merge the changes into
        your system before you can expect it to be fully functional. This is
        an important step which must be done, as otherwise certain key
        services (such as pf(4)) may not start.
      + The Upgrade process is not designed to skip releases! While this will
        often work, it is not supported. For OpenBSD 5.8, upgrading 5.7 to 5.8
        is the only supported upgrade. If you have to upgrade from an older
        version, upgrade to intermediate versions first, or if the system is
        very out-of-date, consider a complete reinstall.
    More information on upgrading between releases can be found in the OpenBSD
    Upgrade Guide 5.8.
  * Autoinstall: This option causes the installer to attempt to fetch an
    installer response file specified by the local DHCP server. This is
    documented in autoinstall(8). Autoinstall files can be "one-for-all", or
    customized by machine's MAC address. If the machine boots via PXE or other
    network booting system, the autoinstall process will start automatically
    after a brief pause if configured and no user intervention takes place.
  * Shell: Sometimes, you need to perform repairs or maintenance to a system
    which will not (or should not) boot to a normal kernel. This option will
    allow you to do maintenance to the system. A number of important utilities
    are available on the boot media.

We are assuming you are choosing "(I)nstall" here.

4.5.2 - The Install Questions

Now we start getting the questions that will define how the system is set up.
You will note that in most cases, all the questions are asked up front, then
the installation takes place. If you have a slow computer or a slow Internet
connection, you will be able to answer these questions, walk away, come back
later and only have to reboot the system to complete the install.

  At any prompt except password prompts you can escape to a shell by
  typing '!'. Default answers are shown in []'s and are selected by
  pressing RETURN.  You can exit this program at any time by pressing
  Control-C, but this can leave your system in an inconsistent state.

  Choose your keyboard layout ('?' or 'L' for list) [default] Enter

In most cases, the default keyboard layout (or terminal type if a serial
console install is being done) is appropriate; however don't just take the
default, respond appropriately.

  System hostname? (short form, e.g. 'foo') puffy

This value, along with the DNS domain name (specified below), will be saved in
the file /etc/myname, which is used during normal boot to set the hostname of
the system. If you do not set the domain name of the system, the default value
of 'my.domain' will be used.

  Available network interfaces are: fxp0 vlan0.
  Which one do you wish to configure? (or 'done') [fxp0] Enter

vlan0 is the VLAN virtual interface. For our purposes here, we are going to
ignore this option and stick to the physical interfaces. If you have multiple
physical interfaces, they will be listed here. Note that they are identified
by driver name, not generic Ethernet devices. In this case, "fxp0" refers to
the first device using the fxp(4) driver, fxp1 would be the second device,
etc. More on device naming is in FAQ 6.

After selecting the device you wish to configure, you will now configure it.
In many cases, you will want to configure it using DHCP:

  IPv4 address for fxp0? (or 'dhcp' or 'none') [dhcp] Enter
  DHCPDISCOVER on fxp0 to 255.255.255.255 port 67 interval 1
  DHCPOFFER from 192.168.1.250 (08:00:20:94:0b:c8)
  DHCPREQUEST on fxp0 to 255.255.255.255 port 67
  DHCPACK from 192.168.1.250 (08:00:20:94:0b:c8)
  bound to 192.168.1.199 -- renewal in 43200 seconds.

DHCP will configure the IP address, subnet mask, default gateway, DNS domain
name and DNS servers. If you are not using DHCP, you will need to specify all
these things manually; see the more detailed discussion below.

If you have any IPv6 configuration to do or there are other interfaces to
configure (or you don't like how you configured the previous one), you can do
that now, but in our case, we are done:

  IPv6 address for fxp0? (or 'rtsol' or 'none') [none] Enter
  Available network interfaces are: fxp0 vlan0.
  Which one do you wish to configure? (or 'done') [done] Enter
  Using DNS domainname example.org
  Using DNS nameservers at 192.168.1.252

Now, we set the root account password:

  Password for root account? (will not echo) er8Eeheix0ei
  Password for root account? (again) er8Eeheix0ei

Use a secure password for the root account. Remember, on the Internet, they
ARE out to get into your computer, and they will be trying lots of common
passwords people think are really clever.

You will later be given a chance to create an administrative account and
disable remote (SSH) access to the root account, but you still want a good
password on your root account.

  Start sshd(8) by default? [yes] Enter

Usually, you will want sshd(8) running. If your application has no need for
sshd(8), there is a small theoretical security advantage to not having it
running.

  Do you expect to run the X Window System? [yes] Enter

Not all systems will ask if you expect to run X, those that do ask require a
sysctl to be set to use X. Answering "y" here will modify /etc/sysctl.conf to
include the line machdep.allowaperture=1 or machdep.allowaperture=2, depending
on your system.

If you do not intend to run X on this system or are not sure, answer 'N' here,
as you can easily change it by editing /etc/sysctl.conf and rebooting, should
you need to later. There is a potential security advantage to leaving this
aperture driver xf86(4) disabled, as the graphics engine on a modern video
card could potentially be used to alter memory beyond the processor's control.
Note that non-graphical applications that require X libraries and utilities to
run do NOT need this sysctl to be set.

  Do you want the X Window System to be started by xdm(1)? [no] y

xdm(1) starts the X environment at system boot. We'd recommend doing this at
install only if you are very confident that X will work on your system by
default. Otherwise, configure X before setting up xdm(1).

  Change the default console to com0? [no] Enter

Sometimes, you want a system to use a serial port as a console instead of a
keyboard and monitor. Answering "y" here will cause the installer to prompt
you for a serial bit rate and configure the system to use the serial port for
a console instead of the monitor and keyboard. Some platforms do this
automatically if no keyboard is attached, these platforms will not ask this
question.

  Setup a user? (enter a lower-case loginname, or 'no') [no] nick
  Full name for user nick? [nick] Nick Holland
  Password for user nick? (will not echo) Tu0xie9onahJ
  Password for user nick? (again) Tu0xie9onahJ
  WARNING: root is targeted by password guessing attacks, pubkeys are safer.
  Allow root ssh login? (yes, no, prohibit-password) [no] Enter

You are being given an opportunity to create a user OTHER than root for system
maintenance. This user will be a member of the "wheel" group so they can run
su(1) and mail addressed to root will be forwarded to them. If you create a
user here, you are given the option of disabling root logins via SSH, as you
can do all administration remotely with the user you have created. If you
later change your mind, you can edit the PermitRootLogin line in /etc/ssh/
sshd_config.

Note that if you wish to create the user, enter the user's name, not "y" or
"yes".

  What timezone are you in? ('?' for list) [Canada/Mountain] US/Michigan

OpenBSD assumes your computer's real-time clock (RTC) is set to GMT, but you
also have to specify what time zone you are in. There may be several valid
answers for your physical location. Hitting "?" at the prompt will help guide
you to finding the best (most specific) time zone name.

Note that the installer will quite often guess correctly for your time zone,
and you can then just hit "Enter".

More on setting the time zone here.

4.5.3 - Setting up disks

Important Note: Users with a large hard disk (larger than was commonly
available when your computer was made) will want to see this section before
going any further.

Laying out your disk appropriately is probably the most difficult part of an
OpenBSD install. The good news is the default layout works well for learning
OpenBSD.

Setting up disks in OpenBSD varies a bit between platforms. For i386, amd64,
macppc, zaurus and armish, disk setup is done in two stages. First, the
OpenBSD slice of the hard disk is defined using fdisk(8), then that slice is
subdivided into OpenBSD partitions using disklabel(8).

Some users may be a little confused by the terminology used here. It will
appear we are using the word "partition" in two different ways. This
observation is correct. There are two layers of partitioning in the above
OpenBSD platforms, the first, one could consider the Operating System
partitioning, which is how multiple OSs on one computer mark out their own
space on the disk, and the second one is how the OpenBSD partition is
sub-partitioned into individual filesystems. The first layer is visible as a
disk partition to DOS, Windows, and any other OS that uses this disk layout
system, the second layer of partitioning is visible only to OpenBSD and those
OSs which can directly read an OpenBSD filesystem.

OpenBSD's new installer attempts to make your disk layout tasks easier by
having a sane default for "general" use. Note that many people will still want
to customize the default, or use their own disk layout, but new users should
probably start with this configuration until they see what they need to do
differently. Note that the default layout will vary depending on how large
your disk system is.

For now, we'll take the defaults on our 60G disk.

  Available disks are: wd0.
  Which one is the root disk? (or 'done') [wd0] Enter
  Use DUIDs rather than device names in fstab? [yes] Enter
  Disk: wd0       geometry: 7296/255/63 [117210240 Sectors]
  Offset: 0       Signature: 0xAA55
              Starting         Ending         LBA Info:
   #: id      C   H   S -      C   H   S [       start:        size ]
  -------------------------------------------------------------------------------
   0: 07      0   1   1 -   7295 254  63 [           0:   117210177 ] NTFS
   1: 00      0   0   0 -      0   0   0 [           0:           0 ] unused
   2: 00      0   0   0 -      0   0   0 [           0:           0 ] unused
   3: 00      0   0   0 -      0   0   0 [           0:           0 ] unused
  Use (W)hole disk or (E)dit the MBR? [whole] Enter
  Setting OpenBSD MBR partition to whole wd0...done.

Note that this disk has a pre-existing partition on it -- using "whole" disk
will remove it!.

Setting up the "whole" disk for OpenBSD does a number of important things:

  * Erases any existing partitions on the disk.
  * Creates an MBR and disk signature so the disk can be booted.
  * Creates an OpenBSD partition using the entire disk.
  * Sets that partition as "active".

There are many times when you won't want to do that, including:

  * You wish to retain other OS partitions.
  * You wish to retain "setup", "suspend to disk", or other system partitions.
  * You wish to build a multibooting system.

Note that it is critical that a new (or never-used for booting) drive has a
valid MBR, a valid signature, an OpenBSD partition, and a partition flagged as
"active". If you don't do these things using the "Use whole disk" option, you
need to make sure they get done manually.

More information on fdisk partitioning your disk below.

Now we will break up our OpenBSD fdisk partition into OpenBSD disk partitions
using disklabel(8):

  Setting OpenBSD MBR partition to whole wd0...done.
  The auto-allocated layout for wd0 is:
  #                size           offset  fstype [fsize bsize  cpg]
    a:          1024.0M               64  4.2BSD   2048 16384    1 # /
    b:           510.5M          2097216    swap
    c:         57231.6M                0  unused
    d:          4096.0M          3142688  4.2BSD   2048 16384    1 # /tmp
    e:          4606.5M         11531264  4.2BSD   2048 16384    1 # /var
    f:          2048.0M         20965312  4.2BSD   2048 16384    1 # /usr
    g:          1024.0M         25159616  4.2BSD   2048 16384    1 # /usr/X11R6
    h:          7054.3M         27256768  4.2BSD   2048 16384    1 # /usr/local
    i:          2025.3M         41704064  4.2BSD   2048 16384    1 # /usr/src
    j:          2048.0M         45851808  4.2BSD   2048 16384    1 # /usr/obj
    k:         32795.0M         50046112  4.2BSD   2048 16384    1 # /home
  Use (A)uto layout, (E)dit auto layout, or create (C)ustom layout? [a] Enter

The installer has presented us with its proposed "Auto layout" for OpenBSD
partitions on our disk, which we are going to accept.

If the proposed layout is not appropriate for your needs, you can, of course,
edit the default or customize it completely, more details on the disklabel
partitioning below.

NOTE for re-installers: The new installer will not clear your old disklabel if
you chose "(C)ustom Layout", but you will need to re-specify each mount point
using the 'n' option in disklabel(8).

The installer now creates those partitions and creates file systems on them
using newfs(8), and mounts them for installation.

You will note there is a c partition we seem to have ignored. This partition
is your entire hard disk; don't attempt to alter it.

4.5.4 - Choosing installation media and file sets

Next, you will get a chance to choose your installation media. In this case,
we will install from an HTTP (web) server.

  Location of sets? (cd disk http or 'done') [cd] http
  HTTP proxy URL? (e.g. 'http://proxy:8080', or 'none') [none] Enter
  Server? (hostname, list#, 'done' or '?') [ftp5.usa.openbsd.org] mirror.example.org

If you can't remember your favorite (or any!) mirror's location, the installer
will often be able to come up with a default of a mirror which will work well
for you. Otherwise, hit "?" to have a list of mirrors displayed, and select
the number of a mirror that will work well for you.

  Server directory? [pub/OpenBSD/5.8/i386] Enter

You can now adjust the list of file sets.

  Select sets by entering a set name, a file name pattern or 'all'. De-select
  sets by prepending a '-' to the set name, file name pattern or 'all'. Selected
  sets are labelled '[X]'.
      [X] bsd           [X] base58.tgz    [X] game58.tgz    [X] xfont58.tgz
      [X] bsd.rd        [X] comp58.tgz    [X] xbase58.tgz   [X] xserv58.tgz
      [ ] bsd.mp        [X] man58.tgz     [X] xshare58.tgz
  Set name(s)? (or 'abort' or 'done') [done] Enter

At a bare minimum, you need to have a kernel (bsd) and base58.tgz file set.
Unless you know what you are doing, stick with the default sets. You can add
and remove file sets using "+" and "-" characters in front of the file set
name, and also use wildcards:

  * -comp58.tgz removes comp58.tgz
  * +bsd.mp adds bsd.mp
  * -x* removes all X components

But again, we'll take the default. This machine is a single-processor system,
so bsd.mp is not installed, but everything else is. If it could later be
upgraded to a multi-processor system, you might want to install bsd.mp as well
(it is relatively very small, but then it is easy to add later, too).

And now, we start our install! This is the point at which you might want to
come back later if you have a slow computer or Internet connection, though
with a fast computer and local files, this process may take just a couple
minutes or less!

If the install process can find the file SHA256.sig in the install source AND
it can find sufficient space to pull over the install file sets to verify the
signatures before installation, the file sets will be verified. If either of
those cases are not true (i.e., installing from an install58.iso or
install58.fs, or your hard disk is too small to "pre-load" the files), you
will be presented with a message:

  Directory does not contain SHA256.sig. Continue without verification? [no]

or

  Cannot determine prefetch area. Continue without verification? [no]

Note that this is not saying that verification failed, it says that
verification can't be done. If you are satisfied with your trust of the source
of the files, hit "y" and your install will take place as normal (though
without the "Get/Verify" steps you see below). Note that on slow hardware, the
"Get/Verify" step can take quite a while.

  Get/Verify SHA256.sig   100% |**************************|  1534       00:01
  Siguature Verified
  Verifying  bsd          100% |**************************| 10292 KB    00:05
  Verifying  bsd.rd       100% |**************************|  6867 KB    00:03
  Verifying  base58.tgz   100% |**************************| 51721 KB    00:26
  Verifying  comp58.tgz   100% |**************************| 45434 KB    00:28
  Verifying  man58.tgz    100% |**************************|  8780 KB    00:06
  Verifying  game58.tgz   100% |**************************|  2649 KB    00:02
  Verifying  xbase58.tgz  100% |**************************| 16510 KB    00:06
  Verifying  xshare58.tgz 100% |**************************|  4383 KB    00:04
  Verifying  xfont58.tgz  100% |**************************| 39072 KB    00:17
  Verifying  xserv58.tgz  100% |**************************| 18509 KB    00:15
  Installing bsd          100% |**************************| 10384 KB    00:00
  Installing bsd.rd       100% |**************************|  6803 KB    00:00
  Installing base58.tgz   100% |**************************| 51618 KB    00:22
  Extracting etc.tgz      100% |**************************|   109 KB    00:00
  Installing comp58.tgz   100% |**************************| 45434 KB    00:17
  Installing man58.tgz    100% |**************************|  8780 KB    00:06
  Installing game58.tgz   100% |**************************|  2649 KB    00:00
  Installing xbase58.tgz  100% |**************************| 16510 KB    00:03
  Extracting xetc.tgz     100% |**************************|  9156       00:00
  Installing xshare58.tgz 100% |**************************|  4383 KB    00:05
  Installing xfont58.tgz  100% |**************************| 39072 KB    00:10
  Installing xserv58.tgz  100% |**************************| 18509 KB    00:06
  Location of sets? (cd disk http or 'done') [done] Enter

Yes, it is asking us again where we wish to install things from. This is so
that missed, forgotten or failed file sets can be re-installed, and also so
custom file sets can be installed.

Again, we just take the default, we are done installing files

  Time appears wrong.  Set to 'Sat Oct 18 09:21:38 EST 2015'? [yes] Enter

If the system can reach an NTP server, you may get this message to set the
system clock accurately.

  Saving configuration files...
  Making all device nodes...done.

  CONGRATULATIONS! Your OpenBSD install has been successfully completed!
  To boot the new system, enter 'reboot' at the command prompt.
  When you login to your new system the first time, please read your mail
  using the 'mail' command.

  #

4.5.5 - First boot!

OpenBSD is now installed on your system and ready for its first boot, but
before you do...

Before you reboot

At this point, your system is installed and ready to be rebooted and
configured for service. Before doing this, however, it would be wise to check
out the Errata page to see if there are any bugs that would immediately impact
you.

After you reboot

On your first boot, SSH keys will be generated. On modern computers, this will
take a few seconds, you may not even notice it happening. On older systems, it
may take many minutes, potentially even an hour or more for really slow
systems.

One of your first things to read after you install your system is afterboot
(8).

you may also find the following links useful:

  * Adding users in OpenBSD
  * Initial Network Setup
  * Man Pages of popular/useful commands
  * OpenBSD man pages on the Web
  * The OpenBSD Packages and Ports system for installing software

4.5.6 - One last thing...

The OpenBSD developers ask you to Send in a copy of your dmesg. This is really
appreciated by the developers, and ultimately, all users.

4.6 - Details for a more complex install

Sometimes you can't just take the defaults. Here are some more details on
parts of the installation process.

4.6.1 - Setting up the network

If you don't have a DHCP server available, you will have to set up your
network adapter(s) manually. Here's an example:

  Which one do you wish to configure? (or 'done') [xl0] Enter
  IPv4 address for xl0? (or 'dhcp' or 'none') [dhcp] 192.168.1.37
  Netmask? [255.255.255.0] 255.255.254.0
  IPv6 address for xl0? (or 'rtsol' or 'none') [none] Enter

After that set of questions, you will be given a chance to configure any other
network adapters that your machine has. If you specify another network adapter
here, the above questions repeat.

  Available network interfaces are: xl0 vlan0.
  Which one do you wish to configure? (or 'done') [done]

Now, you will set up the default gateway and DNS servers, things that impact
all network adapters:

  Default IPv4 route? (IPv4 address, 'dhcp' or 'none') 192.168.1.1
  add net default: gateway 192.168.1.1
  DNS domain name? (e.g. 'bar.com') [my.domain] example.org
  DNS nameservers? (IP address list or 'none') [none] 192.168.1.250 192.168.1.251

Note that multiple DNS servers can be listed, separated by spaces.

Sometimes, you will have to do something more, for example set up a wireless
access key or hard-set a duplex or speed setting (don't do this unless you
absolutely HAVE to, fixing your switch configuration is a much better idea!).
You are now given a chance to drop to the shell and do any manual
configuration that you would like.

  Do you want to do any manual network configuration? [no] y
  Type 'exit' to return to install.
  # ifconfig xl0 media
  xl0: flags=8843<UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST> mtu 1500
          lladdr 00:08:74:2c:df:9c
          groups: egress
          media: Ethernet autoselect (100baseTX full-duplex)
          status: active
          supported media:
                  media 10baseT
                  media 10baseT mediaopt full-duplex
                  media 100baseTX
                  media 100baseTX mediaopt full-duplex
                  media autoselect
          inet 192.168.1.37 netmask 0xfffffe00 broadcast 192.168.1.255
  # ifconfig xl0 media 100baseTX mediaopt full-duplex
  # ifconfig xl0
  xl0: flags=8843<UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST> mtu 1500
          lladdr 00:08:74:2c:df:9c
          groups: egress
          media: Ethernet 100baseTX full-duplex
          status: active
          inet6 fe80::208:74ff:fe2c:df9c%xl0 prefixlen 64 scopeid 0x1
          inet 192.168.1.37 netmask 0xfffffe00 broadcast 192.168.1.255
  # exit
...setup resumes...

(back to where we might have been)

4.6.2 - Setting the Time Zone

Time in Unix is not a simple thing (or put another way, time in Unix is a
really simple thing, human time is a politically manipulated mess). Time zone
files help the system convert Unix time (the number of seconds past midnight
GMT, Jan 1, 1970) to human time, taking into account things like time zones,
daylight savings time (DST), DST rule changes, etc. They also include the
history of changes.

Multiple time zone definition files will sometimes give the same current time,
but may have different history. For example, EST5EDT and US/Michigan have the
same time NOW, but back in 1975, the rules were different, so if you were
doing math with dates and times that involved 1975, you would care about the
differences. You should use the most specific and accurate timezone file you
can for your region, rather than one that just gives the correct time at this
moment.

OpenBSD's installer will help you find an appropriate time zone file for you
if you are not sure. Simply hit "?" at each prompt, and the installer will
show you options. If the first level of answers doesn't suite you, pick a
continent or country, and look at your options there:

  What timezone are you in? ('?' for list) [right/EST5EDT] ?
  Africa/      Chile/       GB-Eire      Israel       NZ-CHAT      UCT
  America/     Cuba         GMT          Jamaica      Navajo       US/
  Antarctica/  EET          GMT+0        Japan        PRC          UTC
  Arctic/      EST          GMT-0        Kwajalein    PST8PDT      Universal
  Asia/        EST5EDT      GMT0         Libya        Pacific/     W-SU
  Atlantic/    Egypt        Greenwich    MET          Poland       WET
  Australia/   Eire         HST          MST          Portugal     Zulu
  Brazil/      Etc/         Hongkong     MST7MDT      ROC          posix/
  CET          Europe/      Iceland      Mexico/      ROK          posixrules
  CST6CDT      Factory      Indian/      Mideast/     Singapore    right/
  Canada/      GB           Iran         NZ           Turkey
  What timezone are you in? ('?' for list) [right/EST5EDT] US
  What sub-timezone of 'US' are you in? ('?' for list) ?
  Alaska          Central         Hawaii          Mountain        Samoa
  Aleutian        East-Indiana    Indiana-Starke  Pacific
  Arizona         Eastern         Michigan        Pacific-New
  What sub-timezone of 'US' are you in? ('?' for list) Michigan

We've now set the time to "US/Michigan". This creates a symbolic link in /etc
pointing to the appropriate zoneinfo file in /usr/share/zoneinfo, something
like this:

      /etc/localtime -> /usr/share/zoneinfo/US/Michigan

Note the directory "right/", this directory includes leap second adjustments,
but otherwise duplicates the standard zoneinfo choices. More here.

(back to where we might have been)

4.6.3 - Custom fdisk(8) layout

Note: only some OpenBSD platforms use fdisk at all, and usually, only i386 and
amd64 users will have to worry about getting fancy with fdisk. Users of most
other fdisk(8) using platforms generally don't have to worry about
multibooting or setup/diagnostic partitions. For this reason, this section is
focused on i386 and amd64.

fdisk(8) is used to mark off the OpenBSD part of your hard disk. It helps mark
off the part of the disk used by OpenBSD from the parts used by other OSs or
system functions.

If you have a partition on your disk you wish to retain or wish to leave space
for another partition, you will NOT want to chose "(W)hole disk", but will
need to edit the partition table with fdisk(8). More information on manually
running fdisk(8) can be found here. Before working with any system that has
data you don't wish to lose, make sure you have a good backup. It is very easy
in this process to clobber important data, so make sure you are ready to get
it back, if need be.

If you are adding OpenBSD to an existing system, you will probably need to
create some free space on your system before installing OpenBSD. This will
usually involve deleting or possibly reducing the size of existing partitions.
The program gparted has been found useful for shrinking the partitions of many
popular OSs, making it possible to install OpenBSD on the freed space.

In this example, we will assume we are starting with a blank 40G disk and wish
to create a multiboot system, reserving 5G at the beginning of the disk for
Windows, and the rest for OpenBSD. Note that a blank drive has to have valid
MBR boot code and signature written to the disk before it can be booted.

The process is very much the same for working around an existing partition,
you just need to skip over the parts where we create the Windows partition and
worry about installing the MBR boot code.

  Available disks are: wd0.
  Which one is the root disk? (or 'done') [wd0] Enter
  MBR has invalid signature; not showing it.

If the disk had a valid MBR in place, it would show you the existing partition
table, which can be a good way to show if a disk may have data on it already.

  Use (W)hole disk or (E)dit the MBR? [whole] e

  You will now create a single MBR partition to contain your OpenBSD data. This
  partition must have an id of 'A6'; must *NOT* overlap other partitions; and
  must be marked as the only active partition.  Inside the fdisk command, the
  'manual' command describes all the fdisk commands in detail.

  Disk: wd0       geometry: 4998/255/63 [80293248 Sectors]
  Offset: 0       Signature: 0x0
              Starting         Ending         LBA Info:
   #: id      C   H   S -      C   H   S [       start:        size ]
  -------------------------------------------------------------------------------
   0: 00      0   0   0 -      0   0   0 [           0:           0 ] unused
   1: 00      0   0   0 -      0   0   0 [           0:           0 ] unused
   2: 00      0   0   0 -      0   0   0 [           0:           0 ] unused
   3: 00      0   0   0 -      0   0   0 [           0:           0 ] unused
Enter 'help' for information
fdisk: 1>

First of all notice the fdisk prompt. The number "1" indicates the first level
of partition tables -- if you were editing an extended partition, it would be
"2" (or bigger). Extended partitions are partitions which have their own
sub-partition table, getting around the IBM AT four partition design limit.
Extended partitions won't be covered here.

First, we will make partition "0" a 5G Windows partition (using NTFS), and
partition "1" will be our OpenBSD partition using the rest of the disk.

  fdisk: 1> e 0
              Starting         Ending         LBA Info:
   #: id      C   H   S -      C   H   S [       start:        size ]
  -------------------------------------------------------------------------------
   0: 00      0   0   0 -      0   0   0 [           0:           0 ] unused
  Partition id ('0' to disable)  [0 - FF]: [0] (? for help)

Since we don't know by memory what the partition ID is for NTFS, we hit "?"
here to get a list.

  Partition id ('0' to disable)  [0 - FF]: [0] (? for help) ?
  Choose from the following Partition id values:
  00 unused         20 Willowsoft     66 NetWare 386    A9 NetBSD
  01 DOS FAT-12     24 NEC DOS        67 Novell         AB MacOS X boot
  02 XENIX /        27 Win Recovery   68 Novell         AF MacOS X HFS+
  03 XENIX /usr     38 Theos          69 Novell         B7 BSDI filesy*
  04 DOS FAT-16     39 Plan 9         70 DiskSecure     B8 BSDI swap
  05 Extended DOS   40 VENIX 286      75 PCIX           BF Solaris
  06 DOS > 32MB     41 Lin/Minux DR   80 Minix (old)    C0 CTOS
  07 NTFS           42 LinuxSwap DR   81 Minix (new)    C1 DRDOSs FAT12
  08 AIX fs         43 Linux DR       82 Linux swap     C4 DRDOSs < 32M
  09 AIX/Coherent   4D QNX 4.2 Pri    83 Linux files*   C6 DRDOSs >=32M
  0A OS/2 Bootmgr   4E QNX 4.2 Sec    84 OS/2 hidden    C7 HPFS Disbled
  0B Win95 FAT-32   4F QNX 4.2 Ter    85 Linux ext.     DB CPM/C.DOS/C*
  0C Win95 FAT32L   50 DM             86 NT FAT VS      DE Dell Maint
  0E DOS FAT-16     51 DM             87 NTFS VS        E1 SpeedStor
  0F Extended LBA   52 CP/M or SysV   8E Linux LVM      E3 SpeedStor
  10 OPUS           53 DM             93 Amoeba FS      E4 SpeedStor
  11 OS/2 hidden    54 Ontrack        94 Amoeba BBT     EB BeOS/i386
  12 Compaq Diag.   55 EZ-Drive       99 Mylex          EE EFI GPT
  14 OS/2 hidden    56 Golden Bow     9F BSDI           EF EFI Sys
  16 OS/2 hidden    5C Priam          A0 NotebookSave   F1 SpeedStor
  17 OS/2 hidden    61 SpeedStor      A5 FreeBSD        F2 DOS 3.3+ Sec
  18 AST swap       63 ISC, HURD, *   A6 OpenBSD        F4 SpeedStor
  19 Willowtech     64 NetWare 2.xx   A7 NEXTSTEP       FF Xenix BBT
  1C ThinkPad Rec   65 NetWare 3.xx   A8 MacOS X
  Partition id ('0' to disable)  [0 - FF]: [0] (? for help) 07

Now we define its starting and ending points:

  Do you wish to edit in CHS mode? [n]

CHS mode allows you to specify disk space in Cylinders, Heads and Sectors.
Keep in mind that for modern hard disks, the CHS numbers are completely bogus,
just three numbers that translate to a sector on the disk, which is translated
to your drives physical geometry (which probably varies across the disk
anyway).

If you answer "y" here, you will be prompted for the starting and ending
cylinder, head and sector. If you answer "no" here (as we will), you will be
prompted for starting sector and the size. Editing by CHS is often easier when
working around an existing partition, starting sector and size is often easier
when you want to quickly create a partition of a given size.

  offset: [0] 64

The fdisk platforms need gap before the first partition. The exact amount will
not matter on modern machines, OpenBSD defaults to 64 sectors. This is
recommended for performance reasons on modern disks, and does not matter on
older disks.

  size: [0] 5g
  Rounding to nearest cylinder: 10490381

The "Size" value can be the number of sectors (512 bytes each), or the desired
capacity when followed by a "k", "m" or "g". When editing using offset and
size, fdisk will round your partition so it ends on a cylinder boundary
(OpenBSD doesn't care about this, and it is possible no modern OS cares about
this, but some might have at one time).

Now, let's look at our new partition:

  fdisk:*1> p
  Disk: wd0       geometry: 4998/255/63 [80293248 Sectors]
  Offset: 0       Signature: 0x0
              Starting         Ending         LBA Info:
   #: id      C   H   S -      C   H   S [       start:        size ]
  -------------------------------------------------------------------------------
   0: 07      0   1   2 -    652 254  63 [          64:    10490381 ] NTFS
   1: 00      0   0   0 -      0   0   0 [           0:           0 ] unused
   2: 00      0   0   0 -      0   0   0 [           0:           0 ] unused
   3: 00      0   0   0 -      0   0   0 [           0:           0 ] unused
  fdisk:*1>

Note that the prompt now includes an "*", this means there are unsaved
changes.

We've now created our Windows partition. Note that this partition is so far
just reserved space on the disk, it isn't formatted; no file system exists
here. You will worry about that when you install Windows; we've accomplished
our goal of reserving space for the Windows partition to be created later.

Now we create our OpenBSD partition. In this case, the partition ID will be
"A6".

  fdisk:*1> e 1
              Starting         Ending         LBA Info:
   #: id      C   H   S -      C   H   S [       start:        size ]
  -------------------------------------------------------------------------------
   1: 00      0   0   0 -      0   0   0 [           0:           0 ] unused
  Partition id ('0' to disable)  [0 - FF]: [0] (? for help) a6
  Do you wish to edit in CHS mode? [n] Enter
  offset: [0]

Uh-oh! What's our offset? Simple -- the offset of the previous partition plus
the size of the partition, in this case, 64+10490381 = 10490445.

  offset: [0] 10490445
  size: [0] *
  fdisk:*1>

Note that here, we entered "*" as the size, meaning "rest of the disk". Again,
we could have entered the size in sectors, "m" or "g" if we wanted to leave
space for something else.

Now we look at our partition table:

  fdisk:*1> p
  Disk: wd0       geometry: 4998/255/63 [80293248 Sectors]
  Offset: 0       Signature: 0x0
              Starting         Ending         LBA Info:
   #: id      C   H   S -      C   H   S [       start:        size ]
  -------------------------------------------------------------------------------
   0: 07      0   1   1 -    652 254  63 [          64:    10490381 ] NTFS
   1: A6    653   0   1 -   4998   5  63 [    10490445:    69802803 ] OpenBSD
   2: 00      0   0   0 -      0   0   0 [           0:           0 ] unused
   3: 00      0   0   0 -      0   0   0 [           0:           0 ] unused
  fdisk:*1>

WE AREN'T DONE YET!
This disk is not yet bootable! As it was a brand new disk, the disk's MBR was
completely blank. The "Signature: 0x0" message there shows there is not a
valid signature (0xAA55), which indicates there definitely is not a valid boot
code. Of course, you could have a valid signature without valid boot code,
through either random bad luck or damage to the existing boot code, but an
invalid signature pretty well indicates you are lacking boot code, so we will
install it now using the "update" command:

  fdisk:*1> update
  Machine code updated.
  fdisk:*1>

We also have to "flag" a partition as "active" so the boot ROM knows what
partition to boot from:

  fdisk:*1> f 1
  Partition 1 marked active.

Now, let's see how it looks:

  fdisk:*1> p
  Disk: wd0       geometry: 4998/255/63 [80293248 Sectors]
  Offset: 0       Signature: 0xAA55
              Starting         Ending         LBA Info:
   #: id      C   H   S -      C   H   S [       start:        size ]
  -------------------------------------------------------------------------------
   0: 07      0   1   1 -    652 254  63 [          64:    10490381 ] NTFS
  *1: A6    653   0   1 -   4998   5  63 [    10490445:    69802803 ] OpenBSD
   2: 00      0   0   0 -      0   0   0 [           0:           0 ] unused
   3: 00      0   0   0 -      0   0   0 [           0:           0 ] unused
  fdisk:*1>

A checklist of things you want to make sure about before you exit fdisk(8):

  * Valid signature?
  * non-overlapping partitions?
  * OpenBSD partition with an "A6" id?
  * Proper partition (probably OpenBSD) flagged active?

(Back to where we may have been)

4.6.4 - Custom disklabel layout

Inside the OpenBSD fdisk(8) partition, we use disklabel(8) to create OpenBSD
file system partitions. OpenBSD labels its file system partitions using
sixteen letters, "a" through "p". Partition "a" on the boot disk is defined as
the root partition, "b" on the boot disk is the default swap partition. "c" on
all disks is the "whole disk" partition, it is used by programs that have to
have raw access to the physical disk, such as fdisk(8) and disklabel(8). The
"c" partition is created automatically for you, and should not be deleted or
changed. The remaining letters are available for you to define mount points
on. You may skip letters, you can define them in any order, and they can be in
any order on the disk (although some platforms do have a requirement for where
the "a" partition is). You can also leave gaps in the disk that are
unallocated, and allocate them later, or potentially enlarge existing
partitions later into that unallocated space using growfs(8).

All partitions which have native FFS partitions on them should be within the
OpenBSD fdisk(8) partition, however non-OpenBSD partitions can (and usually
should) be outside the OpenBSD fdisk partition.

More information on using disklabel can be found here.

More information on why partitioning is beneficial and strategy for creating a
good partitioning plan are below.

The OpenBSD installer will attempt to auto-partition your disk in a usable,
"general purpose" configuration, based on the size of your disk. If your disk
is big enough, unused space will be allocated to the /home partition. While
this is often quite useful, it doesn't satisfy all users' needs.

For our example, we'll assume we are building a static web server for some of
our friends to use. We have a machine attached to a modest Internet
connection, with a 40G disk, with most of it used for OpenBSD (with the same
5G Windows partition as the example above. Why? Maybe this system has a RAID
controller which is supported by OpenBSD, but manageable only from within
Windows. More likely, because the FAQ editor doesn't feel like maintaining
lots of different example systems).

The web pages served by an OpenBSD web server will be in /var/www, and very
little will be stored in /home, so this indicates a definite change from the
default that needs to be made. For the sake of discussion, we'll also assume
that we won't need to rebuild the OS from source on this machine (we'll do
that elsewhere). The system will not run X, however being that some web
applications expect X to be installed, we will have X installed. The machine
is not overly powerful, it can't have more than 1G RAM in it, and it is
unlikely our application will ever desire more than that.

So, after a bit of thought, our plan is to partition the system like this:

  * / - root: 100m. This will be 'a'.
  * swap: 1G (so we'll always have enough space for a core dump), this will be
    partition 'b'
  * /usr: 2g, partition d
  * /tmp: 100m (we don't anticipate much use of this), partition e
  * /usr/local: 2g, partition f
  * /usr/X11R6: 1g, partition g
  * /home: 1g, partition h
  * /var: 1g (that's a lot of system log files), partition j
  * /var/www: rest of disk, partition k

  The auto-allocated layout for wd0 is:
  #                size           offset  fstype [fsize bsize  cpg]
    a:          1024.0M         10490445  4.2BSD   2048 16384    1 # /
    b:           252.1M         12587597    swap
    c:         39205.7M                0  unused
    d:          2319.3M         13103933  4.2BSD   2048 16384    1 # /tmp
    e:          3653.9M         17853877  4.2BSD   2048 16384    1 # /var
    f:          1149.8M         25337016  4.2BSD   2048 16384    1 # /usr
    g:          1024.0M         27691862  4.2BSD   2048 16384    1 # /usr/X11R6
    h:          3422.6M         29789014  4.2BSD   2048 16384    1 # /usr/local
    i:          5122.3M               63    NTFS
    j:          1848.7M         36798433  4.2BSD   2048 16384    1 # /usr/src
    k:          1848.7M         40584654  4.2BSD   2048 16384    1 # /usr/obj
    l:         17540.2M         44370875  4.2BSD   2048 16384    1 # /home
  Use (A)uto layout, (E)dit auto layout, or create (C)ustom layout? [a] c

If we had only minor revisions, we'd probably opt to "Edit" the custom layout
rather than starting from a clean slate, but we are going to do things the
hard way here.

  You will now create an OpenBSD disklabel inside the OpenBSD MBR
  partition. The disklabel defines how OpenBSD splits up the MBR partition
  into OpenBSD partitions in which filesystems and swap space are created.
  You must provide each filesystem's mountpoint in this program.

  The offsets used in the disklabel are ABSOLUTE, i.e. relative to the
  start of the disk, NOT the start of the OpenBSD MBR partition.

  Label editor (enter '?' for help at any prompt)
  > p
  OpenBSD area: 10490445-80293248; size: 69802803; free: 69802803
  #                size           offset  fstype [fsize bsize  cpg]
    c:         80293248                0  unused
    i:         10490381               64    NTFS
  >

Note there are already two partitions here -- the "c" partition which is
always there and created for you, but disklabel(8) has also noticed the
existing NTFS partition and assigned it a disklabel partition so it could
potentially be accessed by OpenBSD (note, at this time, NTFS support is
experimental and requires a custom kernel but FAT/FAT32 support is quite
good).

We will now create our partitions. We will start with the "a" partition, our
root partition:

  > a a
  offset: [10490445] Enter
  size: [69802803] 100m
  Rounding to cylinder: 208845
  FS type: [4.2BSD]  Enter
  mount point: [none] /
  >

Note that disklabel defaulted to the first available OpenBSD sector on the
disk, which is what we want. It also defaulted to a size of all available
space, which is NOT what we want. Here we overrode it with our preferred size,
which can be specified in sectors, "M" or "G".

You will usually want to use the default FS type of "4.2BSD" for a FFS (Fast
File System) or FFS2 partition, though other types you may find useful include
"swap" and "RAID".

Finally is the mount point. Our "a" partition is the root partition, by
definition.

Now, we do swap, which is our 'b' partition (again, this is a requirement --
'b' on your boot disk is swap):

  > a b
  offset: [10699290] Enter
  size: [69593958] 1g
  Rounding to cylinder: 2104515
  FS type: [swap] Enter
  >

Again, disklabel correctly calculated our starting sector, and presented us
with a suggested size of "entire remaining space", which we again overrode
with our desired size. Since this is the 'b' partition, disklabel assumed it
was to be used for swap, and when we confirmed that, it didn't bother to ask
us a mount point.

We are now ready to create the rest of the partitions.

  > a d
  offset: [12803805] Enter
  size: [67489443] 2g
  Rounding to cylinder: 4209030
  FS type: [4.2BSD] Enter
  mount point: [none] /usr
  > a e
  offset: [17012835] Enter
  size: [63280413] 100m
  Rounding to cylinder: 208845
  FS type: [4.2BSD] Enter
  mount point: [none] /tmp
  > a f
  offset: [17221680] Enter
  size: [63071568] 2g
  Rounding to cylinder: 4209030
  FS type: [4.2BSD] Enter
  mount point: [none] /usr/local
  > a g
  offset: [21430710] Enter
  size: [58862538] 1g
  Rounding to cylinder: 2104515
  FS type: [4.2BSD] Enter
  mount point: [none] /usr/X11R6
  > a h
  offset: [23535225] Enter
  size: [56758023] 1g
  Rounding to cylinder: 2104515
  FS type: [4.2BSD] Enter
  mount point: [none] /home
  > a j
  offset: [25639740] Enter
  size: [54653508] 1g
  Rounding to cylinder: 2104515
  FS type: [4.2BSD] Enter
  mount point: [none] /var
  > a k
  offset: [27744255] Enter
  size: [52548993] Enter
  FS type: [4.2BSD] Enter
  mount point: [none] /var/www
  >

Note that on the /var/www partition ("k"), we just took the default to use all
remaining available disk space. With modern monstrously huge drives, this is
usually a bad idea. If you know you will never use it, don't allocate it, and
save it for some future use.

Now, let's look at our results, using the "p" and "p m" commands:

  > p
  OpenBSD area: 10490445-80293248; size: 69802803; free: 0
  #                size           offset  fstype [fsize bsize  cpg]
    a:           208845         10490445  4.2BSD   2048 16384    1 # /
    b:          2104515         10699290    swap
    c:         80293248                0  unused
    d:          4209030         12803805  4.2BSD   2048 16384    1 # /usr
    e:           208845         17012835  4.2BSD   2048 16384    1 # /tmp
    f:          4209030         17221680  4.2BSD   2048 16384    1 # /usr/local
    g:          2104515         21430710  4.2BSD   2048 16384    1 # /usr/X11R6
    h:          2104515         23535225  4.2BSD   2048 16384    1 # /home
    i:         10490381               64    NTFS
    j:          2104515         25639740  4.2BSD   2048 16384    1 # /var
    k:         52548993         27744255  4.2BSD   2048 16384    1 # /var/www
  > p m
  OpenBSD area: 10490445-80293248; size: 34083.4M; free: 0.0M
    #                size           offset  fstype [fsize bsize  cpg]
    a:           102.0M         10490445  4.2BSD   2048 16384    1 # /
    b:          1027.6M         10699290    swap
    c:         39205.7M                0  unused
    d:          2055.2M         12803805  4.2BSD   2048 16384    1 # /usr
    e:           102.0M         17012835  4.2BSD   2048 16384    1 # /tmp
    f:          2055.2M         17221680  4.2BSD   2048 16384    1 # /usr/local
    g:          1027.6M         21430710  4.2BSD   2048 16384    1 # /usr/X11R6
    h:          1027.6M         23535225  4.2BSD   2048 16384    1 # /home
    i:          5122.3M               64    NTFS
    j:          1027.6M         25639740  4.2BSD   2048 16384    1 # /var
    k:         25658.7M         27744255  4.2BSD   2048 16384    1 # /var/www
  >

Like with fdisk, you don't want your OpenBSD disklabel partitions to overlap
(other than the 'c' partition, which overlaps everything, of course).

Write your changes and quit disklabel:

  > w
  > q
  No label changes.
  newfs: reduced number of fragments per cylinder group from 13048 to 12992 to
  enlarge last cylinder group
  /dev/rwd0a: 102.0MB in 208844 sectors of 512 bytes
  5 cylinder groups of 25.38MB, 1624 blocks, 3328 inodes each
  /dev/rwd0h: 1027.6MB in 2104512 sectors of 512 bytes
  6 cylinder groups of 202.47MB, 12958 blocks, 25984 inodes each
  newfs: reduced number of fragments per cylinder group from 13048 to 12992 to
  enlarge last cylinder group
  /dev/rwd0e: 102.0MB in 208844 sectors of 512 bytes
  5 cylinder groups of 25.38MB, 1624 blocks, 3328 inodes each
  /dev/rwd0d: 2055.2MB in 4209028 sectors of 512 bytes
  11 cylinder groups of 202.47MB, 12958 blocks, 25984 inodes each
  /dev/rwd0g: 1027.6MB in 2104512 sectors of 512 bytes
  6 cylinder groups of 202.47MB, 12958 blocks, 25984 inodes each
  /dev/rwd0f: 2055.2MB in 4209028 sectors of 512 bytes
  11 cylinder groups of 202.47MB, 12958 blocks, 25984 inodes each
  /dev/rwd0j: 1027.6MB in 2104512 sectors of 512 bytes
  6 cylinder groups of 202.47MB, 12958 blocks, 25984 inodes each
  /dev/rwd0k: 25658.7MB in 52548992 sectors of 512 bytes
  127 cylinder groups of 202.47MB, 12958 blocks, 25984 inodes each
  /dev/wd0a on /mnt type ffs (rw, asynchronous, local)
  /dev/wd0h on /mnt/home type ffs (rw, asynchronous, local, nodev, nosuid)
  /dev/wd0e on /mnt/tmp type ffs (rw, asynchronous, local, nodev, nosuid)
  /dev/wd0d on /mnt/usr type ffs (rw, asynchronous, local, nodev)
  /dev/wd0g on /mnt/usr/X11R6 type ffs (rw, asynchronous, local, nodev)
  /dev/wd0f on /mnt/usr/local type ffs (rw, asynchronous, local, nodev)
  /dev/wd0j on /mnt/var type ffs (rw, asynchronous, local, nodev, nosuid)
  /dev/wd0k on /mnt/var/www type ffs (rw, asynchronous, local, nodev, nosuid)

  Let's install the sets!
...

(Back to where we may have been)

4.7 - What files are needed for installation?

The complete OpenBSD installation is broken up into a number of separate file
sets. Not every application requires every file set, however new users are
recommended to install ALL of them. Here is an overview of each:

  * bsd - This is the Kernel. Required
  * bsd.mp - Multi-processor (SMP) kernel (only some platforms)
  * bsd.rd - RAM disk kernel
  * base58.tgz - Contains the base OpenBSD system Required
  * comp58.tgz - Contains the compiler and its tools, headers and libraries.
  * man58.tgz - Contains man pages
  * game58.tgz - Contains the games for OpenBSD
  * xbase58.tgz - Contains the base libraries and utilities for X11
  * xfont58.tgz - Contains X11's font server and fonts
  * xserv58.tgz - Contains X11's X servers
  * xshare58.tgz - Contains manpages, locale settings, includes, etc. for X

Why do I have to install X for my non-graphical application?

Even if you have no intention of running X, some third party packages require
the libraries or other utilities in X to be installed on your system. These
applications can sometimes be satisfied simply by installing just xbase58.tgz,
the rest of X is not always needed. Many people resist installing X on their
system without valid reason:

  * By itself, installing X does not cause any program to execute on the
    system.
  * By itself, installing X on a system does not change the risk of external
    security issues.
  * If someone is already ON your system, they can most likely install
    whatever they wish, so the presence or absence of the X does not
    appreciably change the situation.
  * The only parts of X that are running are the parts required by your
    application.
  * The space required for X is relatively modest on modern hardware.

People sometimes waste a lot of time and effort trying to pick through
xbase58.tgz and pull out just the files they need to install their
application. This is not only pointless, but an effort that would have to be
repeated for each upgrade cycle, which probably means you will not upgrade
your system properly, creating REAL security problems.

IF you need X, just install it. It won't hurt you any more than the
application you are needing it for will.

I don't want to install the compilers

Ok, don't, but please don't tell yourself this is for "security reasons". By
the time someone is far enough into your system that the presence or absence
of the compiler matters, they are far enough in they can install a compiler
themselves. However, the compXX.tgz file set is relatively big and has a lot
of files in it, so it can take a while to install and upgrade, and on slow or
small systems, this can matter.

If you do decide to not install the compiler, you will probably need another
system to maintain and build updated software on. There are far more systems
that have been compromised because of improper maintenance than there have
been because a compiler was installed.

4.8 - How should I partition my disk?

Obviously, the answer to this question varies tremendously based on your use
of the system. OpenBSD can be installed in as little as 512M, but using that
small of a device is something for advanced users. Until you have some
experience, an 8G or larger hard disk is recommended to start with.

Unlike many other OSs, OpenBSD encourages users to partition their disk into a
number of partitions, rather than having just one or two big partitions. There
are a number of reasons to partition your disk:

  * Security: You can mark some filesystems as 'nosuid', 'nodev', 'noexec',
    'readonly', etc. This is done for you by the install process, if you use
    the recommended partitions.
  * Stability: A user, or a misbehaved program, can fill a filesystem with
    garbage if they have write permissions for it. Your critical programs,
    which hopefully run on a different filesystem, do not get interrupted.
  * Speed: A filesystem which gets written to frequently may get somewhat
    fragmented. (Luckily, the ffs filesystem that OpenBSD uses is not prone to
    heavy fragmentation.)
  * Integrity: If one filesystem is corrupted for some reason then your other
    filesystems are most likely still OK.
  * Size: Many machines have limits on the area of a disk where the boot ROM
    can load the kernel from. In some cases, this limit may be very small
    (504M for an older 486), in other cases, a much larger limit (for example,
    2G, 8G, or 128G on i386 systems). As the kernel can end up anywhere within
    the root partition, the entire root partition should be within this area.
    For more details, see this section. A good guideline might be to keep your
    / partition completely below 2G, unless you know your platform (and
    particular machine) can handle more (or less) than that.
  * Read-only: You can mount partitions that you never or rarely need to write
    to as "Read-only" most of the time, which will eliminate the need for fsck
    (8) after a crash or power interruption, and may help prevent unintended
    data alteration.
  * fsck(8): Very large partitions require more RAM to fsck(8), and on
    small-memory systems, you can end up having to use swap, resulting in very
    long fsck times.

Given sufficient disk space, OpenBSD's installer will default to the following
partitions:

  * / - root: In addition to being where the other file systems are mounted,
    the root file system holds all the files needed to boot OpenBSD. This
    includes the kernel, plus the basic utilities in /sbin and /bin, the
    configuration files in /etc, and the device directory, /dev which are all
    used to bring up the system. The root file system can be as small as 60M,
    though 200M to 500M is easier for a machine that will last through many
    upgrade cycles. The 'a' partition of your boot drive becomes your root
    partition automatically. SOME platforms place restrictions on the physical
    location on the disk (i.e., must be at start of disk) in order to boot.
  * Swap: In addition to swap, this partition is also used for storing core
    dumps after system crashes, so it is suggested that the swap space (if set
    up at all) be bigger than the largest amount of RAM you are likely to ever
    install on the machine. Read more about this in FAQ 14, Swap.
  * /tmp: This is a world-writeable directory used for (as the name implies!)
    temporary storage. Most systems can get by with very modest amounts of
    storage here, 50M is usually many times what you should ever need, though
    there are a few applications which can use much, much more. While this
    directory is world-writable, when it is a separate partition, OpenBSD
    defaults to mounting it nodev and nosuid, which minimizes how it can be
    used to abuse your system. Files left unattended here will be purged
    automatically, this is NOT for long term storage!
  * /var: This directory and mount point is used for a LOT of things, and
    depending on your uses, may be a prime candidate to subdivide into more
    partitions. Some of the things that end up here (and potential additional
    mount points):
      + /var/log: System logs.
      + /var/mail: Incoming mail boxes.
      + /var/spool: Outgoing mail (and other things)
      + /var/www: OpenBSD's web server lives here.
      + /var/tmp: This is a "persistent" temporary file directory, as files
        placed here are NOT purged on reboot. For example, vi(1) uses this
        directory for temporary storage, so if your computer crashes or is
        rebooted while you are editing a file, the files here can be used to
        recover your editing session. Files left here over 24 hours though
        will be purged by the nightly cleanup scripts, daily(8).
      + /var/crash: If the system panics, it will attempt to save a core dump
        in the swap partition before rebooting. This core dump will then be
        saved to /var/crash upon reboot, so /var will need at least as much
        free space as the system has RAM for this to work automatically.
  * /usr: This is where most of OpenBSD resides. Program binaries, libraries,
    documentation, manual pages, etc. are all located in the /usr directory.
    The files in this mount point are relatively unchanging -- in many cases,
    you could easily mount the /usr partition read-only with no other system
    changes until your next upgrade or update.
  * /usr/X11R6: This is where the X Window system resides. The X binaries,
    font files, libraries, etc. all are here. The only part of X not here is
    the configuration files.
  * /usr/local: On a default OpenBSD installation, this mount point/directory
    is completely empty. It is used for locally installed binaries and
    libraries for local applications.
  * /usr/src: This directory holds the basic system source files, excluding X
    and ports. This directory is empty by default, you have to load it as
    detailed in FAQ 5.
  * /usr/obj: This directory is populated during the build process with the
    object and binary files. Having this directory a separate mount point
    allows it to be formatted rather than erased file by file, which can be
    significantly faster.
  * /home: This is where user files go. Having this a separate partition makes
    it easy to completely reinstall your system; simply don't format this
    partition on reload.

Some additional thoughts on partitioning:

  * For your first attempt at an experimentation system, one big / partition
    and swap may be easiest until you know how much space you need. By doing
    this you will be sacrificing some of the default security features of
    OpenBSD that require separate filesystems for /, /tmp, /var, /usr and /
    home. However, you probably should not be going into production with your
    first OpenBSD install.
  * A system exposed to the Internet or other hostile forces should have a
    separate /var (and maybe even a separate /var/log) for logging.
  * A /home partition can be nice. New version of the OS? Wipe and reload
    everything else, leave your /home partition untouched. Remember to save a
    copy of your configuration files, though!
  * A separate partition for anything which may accumulate a large quantity of
    files that may need to be deleted can be faster to reformat and recreate
    than to delete. See the building by source FAQ for an example (/usr/obj).
  * If you wish to rebuild your system from source for any reason, the source
    will be in /usr/src. If you don't make a separate partition for /usr/src,
    make sure /usr has sufficient space.
  * A commonly forgotten fact: you do not have to allocate all space on a
    drive when you set the system up! Since you will now find it a challenge
    to buy a new drive smaller than 100G, it can make sense to leave a chunk
    of your drive unallocated. If you outgrow a partition, you can allocate a
    new partition from your unused space, duplicate your existing partition to
    the new partition, change /etc/fstab to point to the new partition,
    remount, you now have more space.
  * If you make your partitions too close to the minimum size required, you
    will probably regret it later, when it is time to upgrade your system.
  * If you make very large partitions, keep in mind that performing filesystem
    checks using fsck(8) requires about 1M of RAM per gigabyte of filesystem
    size, and may be very time-consuming or not even feasible on older, slower
    systems (please also refer to this section).
  * If you permit users to write to /var/www (i.e., personal web pages), you
    might wish to put it on a separate partition, so you can use quotas to
    restrict the space they use, and if they fill the partition, no other
    parts of your system will be impacted.
  * You may also want to create an /altroot partition, as described in daily
    (8). This can make a daily copy of your / partition, giving you an extra
    copy of your kernel and /etc configuration files should something happen
    to your root partition. Obviously, the /altroot partition needs to be at
    least as big as /. If you have a second drive and have something else
    duplicating the rest of your disk, either software softraid(4) or a
    periodic copy using dump(8)/restore(8), this disk can be bootable after
    the removal of the primary disk.
  * Compiling some ports from source can take huge amounts of space on your /
    usr and /tmp partitions. This is another reason we suggest using
    pre-compiled packages instead.
  * At least some editors use /var/tmp for scratch space, and this often needs
    to be as big or bigger than the largest file you edit. If you plan on
    editing 500M files, your /var or /var/tmp partition will need to be much
    larger than your might have planned on.

4.9 - Multibooting OpenBSD (amd64, i386)

Multibooting is having several operating systems on one computer, and some
means of selecting which OS is to boot. It is not a trivial task! If you don't
understand what you are doing, you may end up deleting large amounts of data
from your computer. New OpenBSD users are strongly encouraged to start with a
blank hard drive on a dedicated machine, and then practice your desired
configuration on a non-production system before attempting a multiboot
configuration on a production machine. FAQ 14 has more information about the
OpenBSD boot process.

Preferably use one of the four primary MBR partitions for booting OpenBSD
(i.e., extended partitions may not work).

Note that Windows 7 and Vista can resize their system partitions: go to the
Control Panel, search for "partition", and enter the corresponding system
tool. Right click on a partition, and you will notice you can shrink it. Its
main limitation is that the Windows Exchange File can't be moved, so if you
need more space, you may have to move/disable it.

Here are several options to multibooting:

Setting active partitions

This is probably the most overlooked, and yet, sometimes the best solution for
multibooting. Simply set the active partition in whatever OS you are currently
using to be the one you want to boot by default when you next boot. Virtually
every OS offers a program to do this; OpenBSD's is fdisk(8), similar named
programs are in Windows 9x and DOS, and many other operating systems. This can
be highly desirable for OSs or systems which take a long time to shut down and
reboot -- you can set it and start the reboot process, then walk away, grab a
cup of coffee, and come back to the system booted the way you want it -- no
waiting for the Magic Moment to select the next OS.

Boot floppy

If you have a system that is used to boot OpenBSD infrequently (or don't wish
other users of the computer to note anything has changed), consider using a
boot floppy. Simply use one of the standard OpenBSD install floppies, and
create an /etc/boot.conf file (yes, you will also have to create an /etc
directory on the floppy) with the contents:

     boot hd0a:/bsd

to cause the system to boot from hard drive 0, OpenBSD partition 'a', kernel
file /bsd. Note you can also boot from other drives with a line like: "boot
hd2a:/bsd" to boot off the third hard drive on your system. To boot from
OpenBSD, slip your floppy in, reboot. To boot from the other OS, eject the
floppy, reboot. (You can, of course, use this floppy to make a bootable CD,
too.)

The boot(8) program is loaded from the floppy, it then looks for and reads /
etc/boot.conf. The "boot hd0a:/bsd" line instructs boot(8) where to load the
kernel from -- in this case, the first HD the BIOS sees. Keep in mind, only a
small file (/boot) is loaded from the floppy -- the system loads the entire
kernel off the hard disk, so this only adds about five seconds to the boot
process.

Windows NT/2000/XP NTLDR

To multiboot OpenBSD and Windows NT/2000/XP, you can use NTLDR, the boot
loader that NT uses. To multiboot with NT, you need a copy of your OpenBSD
Partition Boot Record (PBR). After running installboot, you can copy it to a
file using dd(1), following a process similar to:

        # dd if=/dev/rsd0a of=openbsd.pbr bs=512 count=1

Note: this is a really good time to remind you that blindly typing commands in
you don't understand is a really bad idea. This line will not work directly on
most computers. It is left to the reader to adapt it to their machine.

Now boot NT and put openbsd.pbr in C:. Add a line like this to the end of C:\
BOOT.INI:

        c:\openbsd.pbr="OpenBSD"

When you reboot, you should be able to select OpenBSD from the NT loader menu.
There is much more information available about NTLDR at the NTLDR Hacking
Guide.

On Windows XP you can also edit the boot information using the GUI; see the XP
Boot.ini HOWTO.

Programs that do much of this for you are available, for example, BootPart.
This program can be run from Windows NT/2000/XP, and will fetch the OpenBSD
PBR, place it on your NT/2000/XP partition, and will add it to C:\BOOT.INI.

Note: The Windows NT/2000/XP boot loader is only capable of booting OSs from
the primary hard drive. You can not use it to load OpenBSD from the second
drive on a system.

Windows Vista

With Vista, Microsoft dropped NTLDR support in favor of their newer Boot
Configuration Data (BCD) store used for controlling the boot environment.
Since BOOT.INI is no longer available for customization, a command-line
utility, bcdedit, takes its place.

Once OpenBSD's PBR is copied to Vista's system partition, the following three
commands are required to select and boot OpenBSD when the system is restarted:

    C:\Windows\system32> bcdedit /create /d "OpenBSD/i386" /application bootsector
    The entry {05a763ce-d81b-11db-b3ec-000000000000} was successfully created.

    C:\Windows\System32>

The GUID returned here, 05a763ce-d81b-11db-b3ec-000000000000, is shown for
illustrative reasons. Take note of the GUID displayed when you run this
command as this value will need to be copied into the following commands.
Simply copying the GUID shown above will not work.

The following two commands are also required:

    C:\Windows\system32> bcdedit /set {05a763ce-d81b-11db-b3ec-000000000000} device boot
    The operation completed successfully.

    C:\Windows\system32> bcdedit /set {05a763ce-d81b-11db-b3ec-000000000000} path \openbsd.pbr
    The operation completed successfully.

    C:\Windows\system32>

This must be run in a shell with administrative privileges. Once you've
located cmd.exe, right click to be able to select "run as administrator".

Note the absolute pathname of the imported PBR file. Do not add a drive letter
as it is assumed that the file is placed in the system partition. bcdedit will
not complain about an explicit drive specification, but the boot manager will
later balk claiming that it cannot resolve the designated pathname.

Upon rebooting, Vista will be listed first in the boot manager ultimately
followed by OpenBSD. Selecting either entry will boot the corresponding
operating system.

If nothing happens, look around in the control panel for boot information.
Most likely, your Windows boot is set up with no delay, so you don't see the
boot menu. You can also use this to boot OpenBSD by default.

For more information, consult bcdedit's help by issuing:

    C:\Windows\system32> bcdedit /?

or by searching Microsoft's documentation and Website. A good introduction can
be found in this TechNet Frequently Asked Questions article.

For those who find manual configuration daunting, EasyBCD provides a GUI
alternative.

Windows 7

Microsoft has enhanced BCD since releasing Vista to allow multiple versions of
Windows to be booted through bcdedit. Because of this greater control, five
commands are required to configure a multiboot environment with OpenBSD.

After copying OpenBSD's PBR into Windows 7's system partition, issue the
following command to initialize the needed registry hive:

    C:\Windows\system32> bcdedit /create /d "OpenBSD/i386" /application bootsector
    The entry {0154a872-3d41-11de-bd67-a7060316bbb1} was successfully created.

    C:\Windows\system32>

As admonished before, the {0154a872-3d41-11de-bd67-a7060316bbb1} GUID is
system-dependent. Note the value you receive when executing, and copy it into
the following commands:

    C:\Windows\system32> bcdedit /set {0154a872-3d41-11de-bd67-a7060316bbb1} device boot
    The operation completed successfully.

    C:\Windows\system32> bcdedit /set {0154a872-3d41-11de-bd67-a7060316bbb1} path \openbsd.pbr
    The operation completed successfully.

    C:\Windows\system32> bcdedit /set {0154a872-3d41-11de-bd67-a7060316bbb1} device partition=c:
    The operation completed successfully.

    C:\Windows\system32> bcdedit /displayorder {0154a872-3d41-11de-bd67-7060316bbb1} /addlast
    The operation completed successfully.

    C:\Windows\system32>

Other boot loaders

Some other bootloaders OpenBSD users have used successfully include GAG, The
Ranish Partition Manager, rEFIt, and GRUB.

Time zone issues

OpenBSD expects the computer's real-time clock to be set to UTC (Universal
Coordinated Time). Some other OSs expect the real-time clock to be set to
local time. Obviously, this can create a bit of a problem if you are using
both OSs on the same computer. One or the other is most likely going to have
to be adapted. More info on doing this is in FAQ 8 - Why is my clock off by
several hours?

4.10 - Sending your dmesg to dmesg@@openbsd.org after the install

Just to remind people, it's important for the OpenBSD developers to keep track
of what hardware works, and what hardware doesn't work perfectly, including
the hardware sensors that are found in machines.

A quote from /usr/src/etc/root/root.mail

    If you wish to ensure that OpenBSD runs better on your machines, please do us
    a favor (after you have your mail system configured!) and type something like:
     # (dmesg; sysctl hw.sensors) | \
            mail -s "Sony VAIO 505R laptop, apm works OK" dmesg@@openbsd.org
    so that we can see what kinds of configurations people are running.  As shown,
    including a bit of information about your machine in the subject or the body
    can help us even further.  We will use this information to improve device driver
    support in future releases.  (Please do this using the supplied GENERIC kernel,
    not for a custom compiled kernel, unless you're unable to boot the GENERIC
    kernel.  If you have a multi-processor machine, dmesg results of both GENERIC.MP
    and GENERIC kernels are appreciated.)  The device driver information we get from
    this helps us fix existing drivers. Thank you!

Make sure you send email from an account that is able to also receive email so
developers can contact you if they have something they want you to test or
change in order to get your setup working. It's not important at all to send
the email from the same machine that is running OpenBSD, so if that machine is
unable to receive email, just

$ (dmesg; sysctl hw.sensors) | mail your-account@@yourmail.dom

and then forward that message to

 dmesg@@openbsd.org

where your-account@@yourmail.dom is your regular email account.

NOTES

  * Please send only GENERIC kernel dmesgs. Custom kernels that have device
    drivers removed are not helpful.
  * If you have a supported multiprocessor system and normally run the
    GENERIC.MP kernel, it is helpful to developers to see the dmesg output of
    both the GENERIC kernel and the GENERIC.MP kernel, so please send both of
    them in separate emails.
  * The dmesgs are received on a computer using the spamd spam rejection
    system. This may cause your dmesg to not be accepted by the mail servers
    for a period of time. Be patient, after half an hour to an hour or so, it
    will get through.

The method above is very easy, but if you have chosen not to configure mail on
your OpenBSD system, you should still send your dmesg to the developers. Save
your dmesg output to a text file.

$ (dmesg; sysctl hw.sensors) > ~/dmesg.txt

Then transfer this file (using FTP/scp/floppydisk/carrier-pigeon/...) to the
system you normally use for email. Since the dmesg output you send in is
processed automatically, be sure to check the following when using alternate
email clients/systems:

  * Configure your email client to send messages as plain text; do not use
    HTML-formatted email.
  * Turn off any forced line break feature. Many email clients are configured
    to insert line breaks at 72 columns (the norm for mailing lists).
  * Make sure your email client does not reformat messages into "text-flow"
    nonsense.
  * Do not send the dmesg output as file attachment. Put the dmesg output into
    the body of the message.

4.11 - Adding a file set after install

"Oh no! I forgot to add a file set when I did the install!"

Sometimes, you realize you really DID need comp58.tgz (or any other system
component) after all, but you didn't realize this at the time you installed
your system. Good news: There are two easy ways to add file sets after the
initial install:

Using the upgrade process

Simply boot your install media (CD-ROM or Floppy), and choose Upgrade (rather
than Install). When you get to the lists of file sets to install, choose the
sets you neglected to install first time around, select your source, and let
it install them for you.

Using tar(1)

The install file sets are simply compressed tar files, and you can expand them
manually from the directory in which the file sets reside:

  # tar -C / -xzvphf comp58.tgz

Do NOT forget the 'p' option in the above command in order to restore the file
permissions properly!

One common mistake is to think you can use pkg_add(1) to add missing file
sets. This does not work. pkg_add(1) is the package management tool to install
third party software. It handles package files, not generic tar files like the
install sets.

If you are installing the xbase file set on your system for the first time
using tar(1) and without rebooting, the shared library cache must be updated
after the installation using ldconfig(8). To add all the X libraries to the
cache:

    # ldconfig -m /usr/X11R6/lib

Alternatively, you can just reboot your system, and this will be done
automatically by the rc(8) startup script.

4.12 - What is 'bsd.rd'?

bsd.rd is a "RAM Disk" kernel. This file can be very useful; many developers
are careful to keep it on the root of their system at all times.

Calling it a "RAM Disk kernel" describes the root filesystem of the kernel --
rather than being a physical drive, the utilities available after the boot of
bsd.rd are stored in the kernel, and are run from a RAM-based filesystem.
bsd.rd also includes a healthy set of utilities to allow you to do system
maintenance and installation.

On some platforms, bsd.rd is actually the preferred installation technique --
you place this kernel on an existing filesystem, boot it, and run the install
from it. On most platforms, if you have a running older version of OpenBSD,
you can FTP a new version of bsd.rd, reboot from it, and install a new version
of OpenBSD without using any removable media at all.

Here is an example of booting bsd.rd on an i386 system:

  Using Drive: 0 Partition: 3
  reading boot.....
  probing: pc0 com0 com1 apm mem[639k 255M a20=on]
  disk: fd0 hd0+
  >> OpenBSD/i386 BOOT 3.26
  boot> boot hd0a:/bsd.rd
. . . normal boot to install . . .

As indicated, you will be brought to the install program, but you can also
drop to the shell to do maintenance on your system.

The general rule on booting bsd.rd is to change your boot kernel from /bsd to
bsd.rd through whatever means used on your platform.

4.13 - Common installation problems

4.13.2 - My i386 won't boot after install

Your install seemed to go fine, but on first boot, you see no sign of OpenBSD
attempting to boot. There are a few common reasons for this problem:

  * No partition was flagged active in fdisk(8). To fix this, reboot the
    machine using the boot floppy or media, and "flag" a partition as "active"
    (bootable). See here and here.
  * No valid boot loader was ever put on the disk. If you hit "Enter" or
    answer "w" to the "Use (W)hole disk or (E)dit the MBR?" question during
    the install, or use the "reinit" option of fdisk(8), the OpenBSD boot
    record is installed on the Master Boot Record of the disk; otherwise, the
    existing master boot code is untouched. This will be a problem if no other
    boot record existed. One solution is to boot the install media again, drop
    to the shell and invoke fdisk(8) to update the MBR code from the command
    line:

        # fdisk -u wd0

    Note: the "update" option within the interactive ("-e") mode of fdisk will
    not write the signature bytes required to make the disk bootable.
  * In some rare occasions, something may go wrong with the second stage boot
    loader install. Reinstalling the second stage boot loader is discussed
    here.

4.13.3 - My (older, slower) machine booted, but hung at the ssh-keygen steps

It is very likely your machine is running fine, just taking a while to do the
ssh key generation process. A SPARCStation2 or a slow 80486 may take several
hours to complete the ssh-keygen(1) steps. Just let it finish; it is only done
once per install.

4.13.4 - Why aren't the downloadable images self-signed?

If you use install58.iso or install58.fs, you will find the installer will
complain about no SHA256.sig file, and thus, it can't verify the files during
the installation.

It is not possible to usefully have the complete installer verify the sets.
After all, if someone were to make a "rogue" install58.iso file, they would
almost certainly change the installer to say everything verified successfully.
Thus, you must verify your installer downloads separately.

4.13.5 - My fdisk partition table is trashed or blank!

Occasionally, a user will find a system will work, but when doing an fdisk
wd0, they see a completely blank (or sometimes, garbage) partition table. This
is usually caused by having created a partition in fdisk(8) which had an
offset of zero sectors, rather than the one track offset it should have (note:
this is assuming the i386 or amd64 platform. Other platforms have different
offset requirements, some need NO offset). The system then boots using the
PBR, not using the MBR.

While this configuration can work, it can be a maintenance problem and should
be fixed. To fix this, the disk's file systems must generally be recreated
from scratch (though if you REALLY know what you are doing, you may be able to
recreate just your disklabel and MBR, and only lose and have to rebuild the
first OpenBSD partition on the disk).

4.13.6 - I have no floppy or CD-ROM on my machine

Some computers people might want to run OpenBSD on lack any obvious way to
install OpenBSD, having no floppy or CD-ROM drive. Either the machine was
designed without it (for example, many laptops and "flash" based machines,
like Soekris and ALIX systems), or the boot devices have failed or been
removed, and would be difficult to replace. Here are some tips and techniques
you can use to get OpenBSD installed on these systems.

  * Network boot, using PXE (i386 or amd64) or diskless(8) (other platforms).
  * External USB CD-ROM or USB floppy, if your machine can boot from one.
  * USB Flash disk or hard disk, again if your computer can boot from a USB
    device. Prepare the device on another computer as described in FAQ 14.
    Boot from it, but choose the bsd.rd kernel, then install as normal. You
    could also have the file sets pre-loaded on the flash media, as well.
  * Worst case, if none of the above is suitable, you can usually pull the
    disk out of the target system, use suitable adapters to install it in a
    "normal" computer, install OpenBSD, then replace the disk back in the
    target system. OpenBSD will then boot nicely in the target machine, though
    you will very possibly have to adjust the network configuration. You may
    also have to adjust /etc/fstab if you (for example) did your install using
    a USB->IDE/SATA adapter or your target or install machine uses ahci(4) and
    the other does not. IDE and some SATA disks will normally be recognized as
    wd(4) devices, but if attached to a USB adapter, will come up as sd(4). A
    SATA disk attached to a pciide(4) interface will come up as wd(4), but
    attached to an ahci(4) interface, will come up as a sd(4) device. However,
    once you correct the /etc/fstab file, the system will generally boot just
    fine.

In all cases, remember that the machine had an OS installed on it before, and
it was usually intended that the OS could be reloaded in the field. How this
was originally intended to be done will often provide you a good idea how you
can install OpenBSD now.

4.13.7 - I got a "Continue without verification?" message during install!

The verification process consists of fetching the SHA256.sig file, then
fetching all the install files to the local hard disk and verifying their
signatures. If either the signature file is unavailable or there is
insufficient disk space for that extra copy of the files, verification will
not be possible, and you will get that message. If you trust your source, this
should not be a problem. If you do not trust your source, you can manually
verify the files as detailed here.

4.14 - Customizing the install process

siteXX.tgz file

The OpenBSD install/upgrade scripts allow the selection of a user-created set
called "siteXX.tgz", where XX is the release version (e.g. 58). The siteXX.tgz
file set is, like the other file sets, a gzip(1) compressed tar(1) archive
rooted in '/' and is un-tarred like the other sets with the options xzphf.
This set will be installed last, after all other file sets.

This file set allows the user to add to and/or override the files installed in
the 'normal' sets and thus customize the installation or upgrade.

You can also create and use hostname-specific install sets, which are named
siteXX-<hostname>.tgz, for example, "site58-puffy.tgz". This allows easy
per-host customized installations, upgrades, or disaster recovery.

Some example uses of a siteXX.tgz file:

  * Create a siteXX.tgz file that contains all the file changes you made since
    first installing OpenBSD. Then, if you have to re-create the system you
    simply select siteXX.tgz during the re-install and all of your changes are
    replicated on the new system.
  * Create a series of machine specific directories that each contain a
    siteXX.tgz file that contains files specific to those machine types.
    Installation of machines (e.g. boxes with different graphics cards) of a
    particular category can be completed by selecting the appropriate
    siteXX.tgz file.
  * Put the files you routinely customize in a same or similar way in a
    siteXX.tgz file -- /etc/skel files, /etc/pf.conf, /etc/rc.conf.local, etc.

install.site/upgrade.site scripts

As the last step in the install/upgrade process, the scripts look in the root
directory of the newly installed/upgraded system for install.site or
upgrade.site, as appropriate to the current process, and runs this script in
an environment chrooted to the installed/upgraded system's root. Remember, the
upgrade is done from a booted file system, so your target file system is
actually mounted on /mnt. However, because of the chroot, your script can be
written as if it is running in the "normal" root of your file system. Since
this script is run after all the files are installed, you have much of the
functionality of the full system when your script runs. Keep in mind that you
are running a minimal kernel, not all features are available, and due to space
constraints, things that work today may not work in a future release.

Note that the install.site script would have to be in a siteXX.tgz file, while
the upgrade.site script could be put in the root directory before the upgrade,
or could be put in a siteXX.tgz file.

The scripts can be used to do many things:

  * Remove files that are installed/upgraded that you don't want present on
    the system.
  * Remove/upgrade/install the packages you want on the installed system (may
    not work for all packages!).
  * Do an immediate backup/archive of the new system before you expose it to
    the rest of the world.
  * Use rdate(8) to set the system time.
  * Have a set of arbitrary commands be run after the first boot. This will
    happen if install.site is used to append any such commands to an
    rc.firsttime(8) file (appending to this file is necessary since the
    installer itself may write to this file). At boot time, rc.firsttime is
    executed once then deleted.

The combination of siteXX.tgz and install.site/upgrade.site files is intended
to give users broad customization capabilities without having to build their
own custom install sets.

Note: if you will be doing your install from an http server, you will need to
add your site*.tgz file(s) to the file index.txt in the source directory in
order for them to be listed as an option at install time. This is not needed
for other install methods.

4.15 - How can I install a number of similar systems?

Here are some tools you can use when you have to deploy a number of similar
OpenBSD systems.

siteXX.tgz and install/upgrade.site files

See the above article.

Restore from dump(8)

On most platforms, the boot media includes the restore(8) program, which can
be used to restore a backup made by dump(8). Thus, you could boot from a
floppy, CD, or bsd.rd file, then fdisk, disklabel, and restore the desired
configuration from tape or other media, and install the boot blocks. More
details here.

Disk imaging

Unfortunately, there are no known disk imaging packages which are FFS-aware
and can make an image containing only the active file space. Most of the major
disk imaging solutions will treat an OpenBSD partition as a "generic"
partition, and can make an image of the whole disk. This often accomplishes
your goal, but usually with huge amounts of wasted space -- an empty, 10G /
home partition will require 10G of space in the image, even if there isn't a
single file in it. While you can typically install a drive image to a larger
drive, you would not be able to directly use the extra space, and you would
not be able to install an image to a smaller drive.

If this is an acceptable situation, you may find the dd command will do what
you need, allowing you to copy one disk to another, sector-for-sector. This
would provide the same functionality as commercial programs without the cost.

4.16 - How can I get a dmesg(8) to report an install problem?

When reporting a problem, it is critical to include the complete system dmesg
(8). However, often when you need to do this, it is because the system is
working improperly or won't install so you may not have disk, network, or
other resources you need to get the dmesg to the appropriate mail list. There
are other ways, however:

  * Floppy disk: The boot disks and CD-ROM have enough tools to let you record
    your dmesg to an MSDOS floppy disk for reading on another machine. Place
    an MSDOS formatted floppy in your disk drive and execute the following
    commands:

         mount -t msdos /dev/fd0a /mnt
         dmesg >/mnt/dmesg.txt
         umount /mnt

    If you have another OpenBSD system, you can also write it to an OpenBSD
    compatible floppy -- often, the boot floppy has enough room on it to hold
    the dmesg. In that case, leave off the "-t msdos" above.

  * Serial Console: Using a serial console and capturing the output on another
    computer is often the best way to capture diagnostic information -
    particularly if the computer panics immediately after boot. As well as a
    second computer, you will need a suitable serial cable (often a null-modem
    cable), and a terminal emulator program that can capture screen output to
    file.

    General information on setting up a serial console is provided elsewhere
    in the FAQ; in order to capture a log of the install, the following
    commands are usually sufficient.

    i386

    At the boot loader prompt, enter

        boot> set tty com0

    This will tell OpenBSD to use the first serial port (often called COM1 or
    COMA in PC documentation) as a serial console. The default baud rate is
    9600.

    Sparc/Sparc64

    These machines will automatically use a serial console if started without
    a keyboard present. If you have a keyboard and monitor attached, you can
    still force the system to use a serial console with the following
    invocation at the ok prompt.

        ok setenv input-device ttya
        ok setenv output-device ttya
        ok reset

------------------------------------------------------------------------------

==============================================================================

5 - Building the System from Source

------------------------------------------------------------------------------

Table of Contents

  * 5.1 - OpenBSD's Flavors
  * 5.2 - Why should I build my system from source?
  * 5.3 - Building OpenBSD from source
      + 5.3.1 - Overview
      + 5.3.2 - Install or upgrade to closest available binares
      + 5.3.3 - Fetching the appropriate source code
      + 5.3.4 - Building the kernel
      + 5.3.5 - Building userland
  * 5.4 - Building a release
  * 5.5 - Building X
  * 5.6 - Why do I need a custom kernel?
  * 5.7 - Building a custom kernel
  * 5.8 - Boot-time configuration
  * 5.9 - Using config(8) to change your kernel
  * 5.10 - Getting more verbose output during boot
  * 5.11 - Common problems, tips and questions when compiling and building
      + 5.11.1 - The build stopped with a "Signal 11" error
      + 5.11.2 - "make build" fails with "cannot open output file snake: is a
        directory"
      + 5.11.3 - My IPv6-less system doesn't work!
      + 5.11.4 - Oops! I forgot to make the /usr/obj directory first!
      + 5.11.5 - Put /usr/obj on its own partition
      + 5.11.6 - How do I not build parts of the tree?
      + 5.11.7 - Where can I learn more about the build process?
      + 5.11.8 - I didn't see any snapshots on the FTP site. Where did they
        go?
      + 5.11.9 - How do I bootstrap a newer version of the compiler (gcc)?
      + 5.11.10 - What is the best way to update /etc, /var, and /dev?
      + 5.11.11 - Is there an easy way to make all the file hierarchy changes?
      + 5.11.12 - Can I cross-compile? Why not?

------------------------------------------------------------------------------

5.1 - OpenBSD's Flavors

There are three "flavors" of OpenBSD:

  * -release: The version of OpenBSD shipped every six months on CD.
  * -stable: Release, plus patches considered critical to security and
    reliability.
  * -current: Where new development work is presently being done, and
    eventually, it will turn into the next release.

Graphically, the development of these flavors looks something like this:

           ,------o-----------o----X                    5.5 Stable
           |      .           .
           |      .    ,------o---------o----X          5.6 Stable
           |      .    |      .         .
           |      .    |      .    ,----o----------o--> 5.7 Stable
           |      .    |      .    |    .          .
           |      .    |      .    |    .    ,-----o--> 5.8 Stable
           |      .    |      .    |    .    |     .
           |      .    |      .    |    .    |     .
     -->5.5Rel----->5.6Rel----->5.7Rel----->5.8Rel----> Current

              Time --->

-Current is where active development work is done, and eventually, it will
turn into the next -release of OpenBSD. Every six months, when a new version
of OpenBSD is released, -current is tagged, and becomes -release: a frozen
point in the history of the source tree. Each -release is never changed; it is
what is on the CDs and FTP servers.

-Stable is based on -release, and is a branch from the main development path
of OpenBSD. When very important fixes are made to -current, they are "back
ported" (merged) into the -stable branches; because of this, -stable is also
known as the "patch branch." In the above illustration, the vertical dotted
lines denote bug fixes being incorporated into the -stable branches. You will
also note that in the above example, the 5.5-stable branch came to an end with
5.7-release, and the 5.6-stable branch came to an end with 5.8-release -- old
releases are typically supported up to two releases back. It takes resources
and time to support older versions; while we might like to provide ongoing
support for old releases, we would rather focus on new features. The -stable
branch is, by design, very easy to build from -release of the same version
(i.e., going from 5.8-release to 5.8-stable).

The -stable branch is -release plus patches found on the errata page. The
operation of -stable is the same as the -release it is based on. If the man
pages have to change, it probably won't go into -stable. In other words, new
device support and new features will NOT be added to -stable.

It is worth pointing out that the name "-stable" is not intended to imply that
-current is unreliable or less robust in production. Rather, the APIs (how the
programs talk to the OS) and features of -current are changing and evolving,
whereas the operation and APIs of -stable are the same as the release it is
based on, so you shouldn't have to relearn features of your system or change
any configuration files, or have any problem adding additional applications to
your system.

In fact, as our hope is to continually improve OpenBSD, the goal is that
-current should be more reliable, more secure, and of course, have greater
features than -stable. Put bluntly, the "best" version of OpenBSD is -current.

Most users should be running either -stable or -release. That being said, many
people do run -current on production systems, and it is important that people
do so to identify bugs and test new features. However, if you don't know how
to properly describe, diagnose and deal with a problem, don't tell yourself
(or anyone else) that you are "helping the project" by running -current. "It
didn't work!" is not a useful bug report. "The recent changes to the pciide
driver broke compatibility with my Slugchip-based IDE interface, dmesg of
working and broken systems follow..." might be a useful report.

There are times when "normal" users may wish to live on the cutting edge and
run -current. The most common reason is that the user has a device which is
not supported by -release (and thus, not -stable), or wishes to use a new
feature of -current. In this case, the choice may be either -current or not
using the device, and -current may be the lesser evil. However, one should not
expect hand-holding from the developers.

Snapshots

Between formal releases of OpenBSD, snapshots are made available through the
FTP sites. As the name implies, these are builds of whatever code is in the
tree at the instant the builder grabbed a copy of the code for that particular
platform. It is possible, though hopefully unlikely, you may uncover bugs in
snapshots, this is the reason they are built and distributed. If you find a
bug in a snapshot, make sure it is reported.

If you desire to run -current, a recent snapshot is usually all you need, and
upgrading to a snapshot is a required starting point before attempting to
build -current from source.

It is sometimes asked if there is any way to get a copy of exactly the code
used to build a snapshot. The answer is no. First, there is no significant
benefit to this. Second, the snapshots are built as desired, as time permits,
and as resources become available. On fast platforms, several snapshots may be
released in one day. On slower platforms, it may take a week or more to build
a snapshot. Providing tags or markers in the source tree for each snapshot
would be quite impractical. Third, snapshots often contain experimental code
that isn't yet committed to the tree.

Upgrade vs. Update

You will often see references to "upgrading" and "updating" OpenBSD installs.
Even though these words have similar meanings, they are used slightly
differently in OpenBSD.

Upgrading is the process of installing a newer version of OpenBSD, with new
functionality. For example, going from v5.7 to v5.8, or going from the June
12th snapshot to the June 20th snapshot. When upgrading, you will typically
have to consult either Following -current or the Upgrade guide (when changing
releases) to make the changes required to run the upgraded version of OpenBSD.
Updating is the process of applying patches to a system to improve the
operation WITHOUT changing the basic functionality or binary compatibility.
This is typically done by following the source patching process or by
following the stable process. When you "update" your system, it goes from a
-release to a -stable (or patched -release) of the same release version, for
example, 5.7-release to 5.7-stable. You may then later update it to a newer
-stable of the same release version. The update process is typically very
painless, as no /etc files or other system configurations need to be changed.

So, you may install a system (for example, 5.6-release) from CD, then update
it to 5.6-stable a few times, then upgrade it to 5.7-release from CD, and
update that a few times before upgrading it again to the 5.8-release.

Keeping Things in Sync

It is important to understand that OpenBSD is an Operating System, intended to
be taken as a whole, not a kernel with a bunch of utilities stuck on. You must
make sure your kernel, "userland" (the supporting utilities and files) and
ports tree are all in sync, or unpleasant things will happen. Said another way
(because people just keep making the error), you can not run brand new ports
on a month old system, or rebuild a kernel from -current source and expect it
to work properly with a -release userland. Yes, this does mean you need to
upgrade your system if you want to run a new program which was added to the
ports tree today. Sorry, but again, OpenBSD has limited resources available.

One should also understand that the upgrade process is supported in only one
direction: from older to newer, and from -stable to -current. You can not run
5.8-current (or a snapshot), then decide you are living too dangerously, and
step back to 5.8-stable. You are on your own if you choose any path other than
the supported option of reloading your system from scratch, do not expect
assistance from the OpenBSD development team.

Yes, this does mean you should think before committing yourself to using
-current.

5.2 - Why do I need to compile the system from source?

Actually, you very possibly do not.

Some reasons why NOT to build from source:

  * Compiling your own system as a way of upgrading it is not supported.
  * You will NOT get better system performance by compiling your own system.
  * Changing compiler options is more likely to break your system than to
    improve it.

Some reasons why you might actually wish or need to build from source:

  * Test or develop new features.
  * Compiling the system puts a lot of stress on the computer, it can be a way
    to make sure the system you just put together or acquired is actually in
    pretty good operational condition.
  * You wish to follow the stable branch.
  * You wish to make a highly customized version of OpenBSD for some special
    application.

The OpenBSD team puts out new snapshots based on -current code on a very
regular basis for all platforms. It is likely this will be all you need for
running -current.

The most common reason to build from source is to follow the -stable branch,
where building from source is the only supported option.

If you are compiling -current from source, it is HIGHLY recommended that you
only do so from a machine which you have full console access to. There will be
times in the development process where the mismatch between your new kernel
and your old userland may render the system inaccessible via network. This is
not an issue when properly building -stable.

5.3 - Building OpenBSD from source

5.3.1 - Overview of the building process

Building OpenBSD from source involves a number of steps:

  * Upgrading to the closest available binariies.
  * Fetching the appropriate source code.
  * Building the new kernel and booting from it.
  * Building "userland" ("make build").

There are a couple additional steps that some users may wish to perform,
depending on the purpose of the build and if X is installed:

  * Building a "release".
  * Building X.

5.3.2 - Install or Upgrade to closest available binaries

The first step in building from source is to make sure you have the closest
available binaries installed. Use this table to look at where you are, where
you wish to go, and what binary you should start with:

+----------------------------------------------------------------------------+
|You are at  |Goal       |Binary upgrade to|then ...                         |
|------------+-----------+-----------------+---------------------------------|
|Old -release|New release|Newest release   |Done!                            |
|------------+-----------+-----------------+---------------------------------|
|-release    |-stable    |Newest release   |Fetch & build -stable            |
|------------+-----------+-----------------+---------------------------------|
|Old -stable |-stable    |Newest release   |Fetch & build -stable            |
|------------+-----------+-----------------+---------------------------------|
|-release    |-current   |Latest snapshot  |(optional) Fetch & build -current|
|------------+-----------+-----------------+---------------------------------|
|Old -current|-current   |Latest snapshot  |(optional) Fetch & build -current|
+----------------------------------------------------------------------------+

It is recommended that you install the binary sets by using the "Upgrade"
option of the install media. If that is not possible, you can also unpack the
binary sets as described here. Regardless, you must do the entire upgrade
process, including creating any users or other /etc directory changes needed.

5.3.3 - Fetching the appropriate source code

OpenBSD source is managed using the CVS version control system, and cvs(1) is
used to pull a copy of the desired source to your local machine for
compilation. This can be done by using an AnonCVS server (a machine holding a
publicly accessible copy of the entire CVS repository used by the OpenBSD
project) or from a local CVS repository you maintain using the CVSync or rsync
programs available as packages. If you have multiple machines you wish to
maintain source code trees on, you may find it worth having a local CVS
repository, created and maintained using CVSync or rsync.

After deciding which AnonCVS server you wish to use, you must "checkout" the
source tree, after that, you then maintain the tree by running "updates", to
pull updated files to your local tree.

The cvs(1) command has many options, some of them are required to checkout and
update a useful tree. Other commands can cause a broken tree. Following and
understanding directions here is important.

Following -current

    In this case, we will assume we are using a public AnonCVS server,
    anoncvs@@anoncvs.example.org:/cvs. We will also assume you are using sh(1)
    as your command shell, if you are using a different shell, you will have
    to adjust some of these commands.

    To checkout a -current CVS src tree, you can use the following:

        # cd /usr
        # export CVSROOT=anoncvs@@anoncvs.example.org:/cvs
        # cvs -d$CVSROOT checkout -P src

    Once you have a tree, you can update it at a later time:

        # cd /usr/src
        # export CVSROOT=anoncvs@@anoncvs.example.org:/cvs
        # cvs -d$CVSROOT up -Pd

Following -Stable

    If you wish to check out an alternative "branch" of the tree, such as the
    -stable branch, you will use the "-r" modifier to your checkout:

        # cd /usr
        # export CVSROOT=anoncvs@@anoncvs.example.org:/cvs
        # cvs -d$CVSROOT checkout -rOPENBSD_5_8 -P src

    This will pull the src files from the OPENBSD_5_8 branch, which is also
    known as the "Patch branch" or "-stable". You would update the code
    similarly:

        # cd /usr/src
        # export CVSROOT=anoncvs@@anoncvs.example.org:/cvs
        # cvs -d$CVSROOT up -rOPENBSD_5_8 -Pd

    Actually, CVS is nice enough to stick a "Tag" in the checked out file
    system, so you don't have to remember the "-rOPENBSD_5_8" part of the
    command line, it will remember this until you explicitly clear them or set
    a new tag by using the "-A" option to "update". However, it is probably
    better to provide too much info in your CVS command lines than too little.

While only the "src" tree has been shown so far, you will do the same steps
for "xenocara" and "ports". As all parts of OpenBSD must be kept in sync, all
trees you use should be checked out and updated at the same time. You can
combine the checkouts into one line (-stable shown):

    # export CVSROOT=anoncvs@@anoncvs.example.org:/cvs
    # cd /usr
    # cvs -d$CVSROOT checkout -rOPENBSD_5_8 -P src ports xenocara

However, updates must be done directory-by-directory.

At this point, whether you followed -stable or -current you should have a
usable source tree. Be very careful which tree you grab -- it is easy to try
to compile -current when aiming for -stable.

Pre-loading the tree: src.tar.gz, sys.tar.gz

While you can download the entire source tree from an AnonCVS server, you can
sometimes save time and bandwidth by "pre-loading" your source tree with the
source files from either the OpenBSD CD or from an FTP server. This is
particularly true if you are running -stable, as relatively few files change
between this version and the -release it is based on.

To extract the source tree from the CD to /usr/src (assuming the CD is mounted
on /mnt):

    # cd /usr/src; tar xzf /mnt/src.tar.gz
    # cd /usr; tar xzf /mnt/xenocara.tar.gz
    # cd /usr; tar xzf /mnt/ports.tar.gz

The source files available for download from the FTP servers are separated
into two files to minimize the download time for those wishing to work with
only one part of the tree. The two files are sys.tar.gz, which contains the
files used to create the kernel, and src.tar.gz which contains all the other
"userland" utilities except the ports tree and the X11 sources. In general,
however, you will usually want both of them installed. Assuming the downloaded
files, src.tar.gz and sys.tar.gz, are in /usr:

    # cd /usr/src
    # tar xzf ../sys.tar.gz
    # tar xzf ../src.tar.gz
    # cd /usr
    # tar xzf xenocara.tar.gz
    # tar xzf ports.tar.gz

Not all people will wish to unpack all the file sets, but as the system must
be kept in sync, you will generally need to set up all parts of the tree.

Common CVS tips

  * As indicated earlier, some options are mandatory to get a valid src tree
    in OpenBSD. The "-P" option above is one of those: It "prunes" (removes)
    directories that are empty. Over the years, directories have been created
    and deleted in the OpenBSD source tree, and sometimes the names of old
    directories are currently used as file names. Without the "-P" option,
    your newly checked-out tree WILL NOT successfully compile.

    Much the same with the -d option on the 'update' command -- it creates new
    directories that may have been added to the tree since your initial
    checkout. To get a successful update, you must use the -Pd options.

  * Experienced CVS users may wonder why the CVSROOT was specified and used in
    this example, as cvs(1) will record the CVS server's location in the
    checked out tree. This is correct, however there are enough times where
    one may need to override the default anoncvs server, many people recommend
    always specifying the repository explicitly. It is also worth noting that
    while the CVSROOT environment variable can be used directly by cvs(1), it
    is used only if nothing else overrides it (i.e., cvs(1) would have an
    error without it), whereas specifying it in the cvs(1) command line
    overrides all other values.

  * It is often useful to use a .cvsrc in your home directory to specify
    defaults for some of these options. An example .cvsrc file:

        $ more ~/.cvsrc
        cvs -q -danoncvs@@anoncvs.example.org:/cvs
        diff -up
        update -Pd
        checkout -P

    This file would cause cvs(1) to use the anoncvs@@anoncvs.example.org:/cvs
    server, suppress usually unneeded output ("-q" is "quiet") for all
    operations, a "cvs up" command defaults to using the -Pd, a "cvs diff"
    defaults to providing "unified diffs" due to the "-u", and a "cvs
    checkout" will use the "-P" option. While this is convenient, if you
    forget this file exists, or try to run commands you got used to on a
    machine without this file, you will have problems.

  * As the source trees consist of large numbers of mostly small files,
    turning on soft updates for the partition the source tree is on will often
    give significantly better performance.

  * To see the files in the tree that have changed most recently, do a:

        # cd /usr/src/etc
        # ls -lt |more

  * To see all the changes in /etc between arbitrary versions of OpenBSD, you
    can use CVS. For example, to see the changes between 5.7 and 5.8 do a:

        # cd /usr/src/etc
        # cvs diff -u -rOPENBSD_5_7 -rOPENBSD_5_8

    To see the changes between 5.8 and -current ("HEAD"), use:

        # cd /usr/src/etc
        # cvs diff -u -rOPENBSD_5_8 -rHEAD

5.3.4 - Building the kernel

We will assume you wish to build a standard (GENERIC or GENERIC.MP) kernel
here. Normally, this is what you want to do. Do not consider building a custom
kernel if you have not mastered the standard building process.

Obviously, the kernel is a VERY hardware dependent portion of the system. The
source for the kernel is in the /usr/src/sys directory. Some parts of the
OpenBSD kernel code are used on all platforms, others are very specific to one
processor or one architecture. If you look in the /usr/src/sys/arch/
directory, you may see some things that look a little confusing -- for
example, there are mac68k, m68k and mvme68k directories. In this case, the
mvme68k and mac68k systems both use the same processor, but the machines they
are based on are very different, and thus require a very different kernel
(there is much more to a computer's design than its processor!). However,
parts of the kernel are common, those parts are kept in the m68k directory. If
you are simply building a kernel, the base architecture directories like m68k
are not anything for you to worry about, you will be working exclusively with
the "compound architecture" directories, such as mvme68k.

Kernels are built based on kernel configuration files, which are located in
the /usr/src/sys/arch/<your platform>/conf directory. Building the kernel
consists of using the config(8) program to create and populate a kernel
compile directory, which will end up in /usr/src/sys/arch/<your platform>/
compile/<KernelName>. For this example, we will assume you are using the i386
platform:

    # cd /usr/src/sys/arch/i386/conf
    # config GENERIC
    # cd ../compile/GENERIC
    # make clean && make
        [...lots of output...]
    # make install

Replace "i386" in the first line with your platform name. The machine(1)
command can tell you what your platform name is, so an obvious generalization
would be to use the command "cd /usr/src/sys/arch/`machine`/conf" instead on
the first line.

At this point, reboot your machine to activate this new kernel. Note that the
new kernel should be running before the next step, though if you have followed
the above advice about upgrading to the most recent available snapshot, it may
not matter as much. Sometimes, however, APIs change, and the old kernel will
be unable to run new applications, but the new kernel will generally support
the old ones.

Note that you can build a kernel without root access, but you must have root
to install the kernel.

5.3.5 - Building the userland

There is a specific process used by OpenBSD. Processes used on other OSs you
may have been familiar with will most likely not work on OpenBSD, and will get
you laughed at when you ask why.

  * Clear your /usr/obj directory and rebuild symbolic links:

        # rm -rf /usr/obj/*
        # cd /usr/src
        # make obj

    Note that the use of the /usr/obj directory is mandatory. Failing to do
    this step before building the rest of the tree will likely leave your src
    tree in bad shape.

  * Make sure all the appropriate directories are created.

        # cd /usr/src/etc && env DESTDIR=/ make distrib-dirs

  * Build the system:

        # cd /usr/src
        # make build

    This compiles and installs all the "userland" utilities in the appropriate
    order. This is a fairly time consuming step -- a very fast machine may be
    able to complete it in well under an hour, a very slow machine may take
    many days. When this step is complete, you have newly compiled binaries in
    place on your system.

  * If building -current: Update /dev and /etc, with the changes listed in
    current.html. If following -stable after a proper upgrade process or an
    install of the proper starting binary, this step is not needed or desired.

5.4 - Building a Release

What is a "release", and why would I want to make one?

A release is the complete set of files that can be used to install OpenBSD on
another computer. If you have only one computer running OpenBSD, you really
don't have any reason to make a release, as the above build process will do
everything you need. An example use of the release process would be to build
-stable on a fast machine, then make a release to be installed on all your
other machines in your office.

The release process uses the binaries created in the /usr/obj directory in the
building process above, so you must successfully complete the build first, and
nothing must disturb the /usr/obj directory. A time where this might be a
problem is if you use a memory disk as your /usr/obj for a little extra
performance in the build process, you would not want to reboot the computer
between the "build" and "release" steps!

The release process requires two work directories, which we will call DESTDIR
and RELEASEDIR. All the files that are part of a "clean" OpenBSD install will
be copied to their proper place within the DESTDIR. They will then be tar(1)ed
up and placed in the RELEASEDIR. At the end of the process, RELEASEDIR will
hold the completed OpenBSD release. The release process will also use the /mnt
location, so this should not be used by anything while the release process is
running. For the purpose of example, we will use the DESTDIR of /usr/dest and
the RELEASEDIR of /usr/rel.

The release process involves a utility, crunchgen(8), which is used to create
a single executable file made up of many individual binaries. The name this
single executable file is invoked by determines which component binary is run.
This is how a number of individual program files are squeezed into the ramdisk
kernel that exists on boot floppies and other boot media.

You must have root privileges to make a release.

Doing a release

Define our DESTDIR and RELEASEDIR environment variables:

    # export DESTDIR=/usr/dest
    # export RELEASEDIR=/usr/rel

We now clear the DESTDIR and create the directories if needed:

    # test -d ${DESTDIR} && mv ${DESTDIR} ${DESTDIR}.old && rm -rf ${DESTDIR}.old &
    # mkdir -p ${DESTDIR} ${RELEASEDIR}

RELEASEDIR does not normally need to be empty before starting the release
process, however, if there are changes in the release files or their names,
old files may be left laying around. You may wish to also erase this directory
before starting.

We now make the release itself:

    # cd /usr/src/etc
    # make release

After the release is made, it is a good idea to check the release to make sure
the tar files are matching what is in the DESTDIR. The output of this step
should be very minimal.

    # cd /usr/src/distrib/sets
    # sh checkflist

You now have complete and checked release file sets in the RELEASEDIR. These
files can now be used to install or upgrade OpenBSD on other machines.

The authoritative instructions on making a release are in release(8).

Note: if you wish to distribute the resultant files by HTTP for use by the
upgrade or install scripts, you will need to add an "index.txt" file, which
contains the list of all the files in your newly created release.

    # /bin/ls -nT >index.txt

Once you have the complete release made, you can use those files for a
standard install or upgrade on another machine, or if updating a machine to a
new -stable, simply unpack the tar files in the root directory of the target
machine.

5.5 - Building X (Xenocara)

Starting with X.org v7, X switched to a "modular build" system, splitting the
x.org source tree into more than three hundred more-or-less independent
packages.

To simplify life for OpenBSD users, a "meta-build" called Xenocara was
developed. This system "converts" X back into one big tree to be built in one
process. As an added bonus, this build process is much more similar to the
build process used by the rest of OpenBSD than the previous versions were.

The official instructions for building X exist in your machine's /usr/xenocara
/README file and in release(8).

Getting source code

The "usual" location for the xenocara source tree is /usr/xenocara, and the
source is stored in the xenocara module in CVS. So, the checkout process is
this:

    $ cd /usr
    $ cvs -qdanoncvs@@anoncvs.example.org:/cvs checkout -P xenocara

Building Xenocara

For building the standard xenocara tree as supported by OpenBSD, no external
tools are needed.

    # cd /usr/xenocara
    # rm -rf /usr/xobj/*
    # make bootstrap
    # make obj
    # make build

If you wish to make actual modifications to the source code, you will probably
need to add several packages. Details are in the /usr/xenocara/README file.

Making a release

This is similar to the main system release process. After successfully
building X, you will define a DESTDIR and RELEASEDIR, with the same purposes
as above. The RELEASEDIR can be the same directory as the main system
RELEASEDIR, but DESTDIR will be erased and rebuilt in this process. If done
carefully, this is not a problem, but using a separate DESTDIR may be "safer".

For this example, we will use a DESTDIR and RELEASEDIR of /usr/dest and /usr/
rel, respectively. This must be done after the above build process.

    # cd /usr/xenocara
    # export DESTDIR=/usr/dest
    # export RELEASEDIR=/usr/rel
    # test -d ${DESTDIR} && mv ${DESTDIR} ${DESTDIR}- && \
         rm -rf ${DESTDIR}- &
    # mkdir -p ${DESTDIR} ${RELEASEDIR}
    # make release

When this process is completed, you will have a set of release files in the
$RELEASEDIR.

5.6 - Why do I need a custom kernel?

Actually, you probably don't.

A custom kernel is a kernel built with a configuration file other than the
provided GENERIC configuration file. A custom kernel can be based on -release,
-stable or -current code, just as a GENERIC kernel can be. While compiling
your own GENERIC kernel is supported by the OpenBSD team, compiling your own
custom kernel is not.

The standard OpenBSD kernel configuration (GENERIC) is designed to be suitable
for most people. More people have broken their system by trying to tweak their
kernel than have improved system operation. There are some people that believe
that you must customize your kernel and system for optimum performance, but
this is not true for OpenBSD. Only the most advanced and knowledgeable users
with the most demanding applications need to worry about a customized kernel
or system.

Some reasons you might want or need to build a custom kernel:

  * You really know what you are doing, and want to shoe-horn OpenBSD onto a
    computer with a small amount of RAM by removing device drivers you don't
    need.
  * You really know what you are doing, and wish to remove default options or
    add options which may not have been enabled by default (and have good
    reason to do so).
  * You really know what you are doing, and wish to enable experimental
    options.
  * You really know what you are doing, and have a special need that is not
    met by GENERIC, and aren't going to ask why it doesn't work if something
    goes wrong.

Some reasons why you should not build a custom kernel:

  * You do not need to, normally.
  * You will not get a faster system.
  * You are likely to make a less reliable machine.
  * You will not get any support from developers.
  * You will be expected to reproduce any problem with a GENERIC kernel before
    developers take any problem report seriously.
  * Users and developers will laugh at you when you break your system.
  * Custom compiler options usually do a better job of exposing compiler
    problems than improving system performance.

Removing device drivers may speed the boot process on your system, but can
complicate recovery should you have a hardware problem, and is very often done
wrong. Removing device drivers will not make your system run faster by any
noticeable amount, though can produce a smaller kernel. Removing debugging and
error checking can result in a measurable performance gain, but will make it
impossible to troubleshoot a system if something goes wrong.

Again, developers will usually ignore bug reports dealing with custom kernels,
unless the problem can be reproduced in a GENERIC kernel as well. You have
been warned.

5.7 - Building a custom kernel

It is assumed you have read the above, and really enjoy pain. It is also
assumed that you have a goal that can not be achieved by either a Boot time
configuration (UKC>) or by config(8)ing a GENERIC kernel. If all of this is
not true, you should stick to using GENERIC. Really.

OpenBSD kernel generation is controlled by configuration files, which are
located in the /usr/src/sys/arch/<arch>/conf/ directory by default. All
architectures have a file, GENERIC, which is used to generate the standard
OpenBSD kernel for that platform. There may also be other configuration files
which are used to create kernels with different focuses, for example, for
minimal RAM, diskless workstations, etc.

The configuration file is processed by config(8), which creates and populates
a compilation directory in ../compile, on a typical installation, that would
be in /usr/src/sys/arch/<arch>/compile/. config(8) also creates a Makefile,
and other files required to successfully build the kernel.

Kernel Configuration Options are options that you add to your kernel
configuration that place certain features into your kernel. This allows you to
have exactly the support you want, without having support for unneeded
devices. There are a multitude of options that allow you to customize your
kernel. Here we will go over only some of them, those that are most commonly
used. Check the options(4) man page for a complete list of options, and as
these change from time to time, you should make sure you use a man page for
the same version of OpenBSD you are building. You can also check the example
configuration files that are available for your architecture.

Do not add, remove, or change options in your kernel unless you actually have
a reason to do so! Do not edit the GENERIC configuration file!! The only
kernel configuration which is supported by the OpenBSD team is the GENERIC
kernel, the combination of the options in /usr/src/sys/arch/<arch>/conf/
GENERIC and /usr/src/sys/conf/GENERIC as shipped by the OpenBSD team (i.e.,
NOT edited). Reporting a problem on a customized kernel will almost always
result in you being told to try to reproduce the problem with a GENERIC
kernel. Not all options are compatible with each other, and many options are
required for the system to work. There is no guarantee that just because you
manage to get a custom kernel compiled that it will actually run. There is no
guarantee that a kernel that can be "config(8)ed" can be built.

You can see the platform-specific configuration files here:

  * alpha Kernel Configuration Files
  * i386 Kernel Configuration Files
  * macppc Kernel Configuration Files
  * sparc Kernel Configuration Files
  * sparc64 Kernel Configuration Files
  * vax Kernel Configuration Files
  * hppa Kernel Configuration Files
  * Other Arch's

Look closely at these files and you will notice a line near the top similar
to:

     include "../../../conf/GENERIC"

This means that it is referencing another configuration file, one that stores
platform-independent options. When creating your kernel configuration, be sure
to look through sys/conf/GENERIC.

Kernel configuration options should be placed in your kernel configuration
file in the format of:

    option      name

or

    option      name=value

For example, to place option "DEBUG" in the kernel, add a line like this:

    option      DEBUG

Options in the OpenBSD kernel are translated into compiler preprocessor
options, therefore an option like DEBUG would have the source compiled with
option -DDEBUG, which is equivalent to doing a #define DEBUG throughout the
kernel.

Sometimes, you may wish to disable an option that is already defined,
typically in the "src/sys/conf/GENERIC" file. While you could modify a copy of
that file, a better choice would be to use the rmoption statement. For
example, if you really wanted to disable the in-kernel debugger (not
recommended!), you would add a line such as:

     rmoption DDB

in your kernel configuration file. option DDB is defined in src/sys/conf/
GENERIC, but the above rmoption line deactivates it.

Once again, please see options(4) for more information about the specifics of
these options. Also note that many of the options also have their own manual
pages -- always read everything available about an option before adding or
removing it from your kernel.

Building a custom kernel

In this case, we will build a kernel that supports the boca(4) ISA multi-port
serial card. This card is not in the GENERIC kernel, due to conflicts with
other drivers. There are two common ways to make a custom kernel: copy the
GENERIC config file to another name and edit it, or create a "wrapper" file
that "includes" the standard GENERIC kernel and any options you need that
aren't in GENERIC. In this case, our wrapper file looks like this:

    include "arch/i386/conf/GENERIC"

    boca0  at       isa? port 0x100 irq 10     # BOCA 8-port serial cards
    com*   at       boca? slave ?

The two lines regarding the boca(4) card are copied from the commented out
lines in GENERIC, with the IRQ adjusted as needed. The advantage to using this
"wrapper" file is any unrelated changes in GENERIC are updated automatically
with any other source code update. The disadvantage is one can not remove
devices (though in general, that's a bad idea, anyway).

The other way to generate a custom kernel is to make a copy of the standard
GENERIC, giving it another name, then editing it as needed. The disadvantage
to this is later updates to the GENERIC configuration file have to be merged
into your copy, or you have to remake your configuration file.

In either event, after making your custom kernel configuration file, use
config(8) and make the kernel as documented above.

Full instructions for creating your own custom kernel are in the config(8) man
page.

5.8 - Boot-Time Configuration

Sometimes when booting your system you might notice that the kernel finds your
device but maybe at the wrong IRQ. And maybe you need to use this device right
away. Well, without rebuilding the kernel you can use OpenBSD's boot time
kernel configuration. This will only correct your problem for one time. If you
reboot, you will have to repeat this procedure. So, this is only meant as a
temporary fix, and you should correct the problem using config(8). Your kernel
does however need option BOOT_CONFIG in the kernel, which GENERIC does have.

Most of this document can be found in the man page boot_config(8).

To boot into the User Kernel Config, or UKC, use the -c option at boot time.

    boot> boot hd0a:/bsd -c

Or whichever kernel it is you want to boot. Doing this will bring up a UKC
prompt. From here you can issue commands directly to the kernel specifying
devices you want to change or disable or even enable.

Here is a list of common commands in the UKC.

  * add device - Add a device through copying another
  * change devno | device - Modify one or more devices
  * disable devno | device - Disable one or more devices
  * enable devno | device - Enable one or more devices
  * find devno | device - Find one or more devices
  * help - Short summary of these commands
  * list - List ALL known devices
  * exit/quit - Continue Booting
  * show [attr [val]] - Show devices with an attribute and optional with a
    specified value

Once you have your kernel configured, use quit or exit and continue booting.
After doing so, you should make the change permanent in your kernel image, as
described in Using config(8) to change your kernel.

5.9 - Using config(8) to change your kernel

The -e and -u options with config(8) can be extremely helpful and save wasted
time compiling your kernel. The -e flag allows you to enter the UKC or User
Kernel Config on a running system. These changes will then take place on your
next reboot. The -u flag tests to see if any changes were made to the running
kernel during boot, meaning you used boot -c to enter the UKC while booting
your system.

The following example shows the disabling of the ep* devices in the kernel.
For safety's sake you must use the -o option which writes the changes out to
the file specified. For example : config -e -o bsd.new /bsd will write the
changes to bsd.new. The example doesn't use the -o option, therefore changes
are just ignored, and not written back to the kernel binary. For more
information pertaining to error and warning messages read the config(8) man
page.

    # config -e /bsd
    WARNING: no output file specified
    OpenBSD 5.8 (GENERIC) #1066: Sun Aug 16 02:33:00 MDT 2015
        deraadt@@i386.openbsd.org:/usr/src/sys/arch/i386/compile/GENERIC
    Enter 'help' for information
    ukc> ?
            help                                Command help list
            add             dev                 Add a device
            base            8|10|16             Base on large numbers
            change          devno|dev           Change device
            disable         attr val|devno|dev  Disable device
            enable          attr val|devno|dev  Enable device
            find            devno|dev           Find device
            list                                List configuration
            lines           count               # of lines per page
            show            [attr [val]]        Show attribute
            exit                                Exit, without saving changes
            quit                                Quit, saving current changes
            timezone        [mins [dst]]        Show/change timezone
            bufcachepercent [number]            Show/change BUFCACHEPERCENT
            nkmempg         [number]            Show/change NKMEMPAGES
    ukc> list
      0 video* at uvideo* flags 0x0
      1 audio* at uaudio*|sb0|sb*|gus0|pas0|ess*|wss0|wss*|ym*|eap*|envy*|eso*|sv*|n
    eo*|cmpci*|clcs*|clct*|auacer*|auglx*|auich*|auixp*|autri*|auvia*|azalia*|fms*|m
    aestro*|esa*|yds*|emu* flags 0x0
      2 midi* at umidi*|sb0|sb*|ym*|mpu*|mpu*|autri*|eap*|envy* flags 0x0
      3 drm* at inteldrm*|radeondrm* flags 0x0
      4 inteldrm* at vga0|vga* flags 0x0
      5 radeondrm* at vga0|vga* flags 0x0
      6 radio* at udsbr*|bktr0|fms* flags 0x0
      7 vscsi0 at root flags 0x0
      8 softraid0 at root flags 0x0
      9 nsphy* at url*|udav*|mos*|axe*|aue*|xe*|ef*|hme*|lii*|bce*|ale*|alc*|age*|jm
    e*|et*|nfe*|stge*|vge*|bnx*|bge*|lge*|nge*|msk*|sk*|ste*|se*|sis*|wb*|tl*|vte*|v
    r*|pcn*|sf*|ti*|gem*|ne0|ne1|ne2|ne*|ne*|ne*|epic*|sm0|sm*|dc*|dc*|re*|re*|rl*|r
    l*|mtd*|fxp*|fxp*|xl*|xl*|ep0|ep*|ep*|ep*|ep*|ep* phy -1 flags 0x0
     10 nsphyter* at url*|udav*|mos*|axe*|aue*|xe*|ef*|hme*|lii*|bce*|ale*|alc*|age*
    |jme*|et*|nfe*|stge*|vge*|bnx*|bge*|lge*|nge*|msk*|sk*|ste*|se*|sis*|wb*|tl*|vte
    *|vr*|pcn*|sf*|ti*|gem*|ne0|ne1|ne2|ne*|ne*|ne*|epic*|sm0|sm*|dc*|dc*|re*|re*|rl
    *|rl*|mtd*|fxp*|fxp*|xl*|xl*|ep0|ep*|ep*|ep*|ep*|ep* phy -1 flags 0x0
    [...snip...]
    ukc> disable ep
     98 ep* disabled
     99 ep* disabled
    301 ep0 disabled
    302 ep* disabled
    303 ep* disabled
    360 ep* disabled
    ukc> quit
    not forced

In the above example, all ep* devices are disabled in the kernel and will not
be probed. In some situations where you have used the UKC during boot, via
boot -c, you will need these changes to be written out permanently. To do this
you need to use the -u option. In the following example, the computer was
booted into the UKC and the wi(4) device was disabled. Since changes made with
boot -c are NOT permanent, these changes must be written out. This example
writes the changes made from boot -c into a new kernel binary bsd.new.

    # config -e -u -o bsd.new /bsd
    OpenBSD 5.8 (GENERIC) #1066: Sun Aug 16 02:33:00 MDT 2015
        deraadt@@i386.openbsd.org:/usr/src/sys/arch/i386/compile/GENERIC
    Processing history...
    167 wi* disabled
    168 wi* disabled
    443 wi* disabled
    Enter 'help' for information
    ukc> quit

5.10 - Getting more verbose output during boot

Getting more verbose output can be very helpful when trying to debug problems
when booting. If you have a problem wherein your boot floppy won't boot and
need to get more information, simply reboot. When you get to the "boot>"
prompt, boot with boot -c. This will bring you into the UKC>, then do:

    UKC> verbose
    autoconf verbose enabled
    UKC> quit

Now you will be given extremely verbose output upon boot.

5.11 - Common problems, tips and questions when compiling and building

Most of the time, problems in the build process are caused by not following
the above directions carefully. There are occasional real problems with
building -current from the most recent snapshot, but failures when building
-release or -stable are almost always user error.

Most problems are usually one of the following:

  * Failing to start from the appropriate binary, including attempting to
    upgrade from source or assuming a week old snapshot is "close enough".
  * Checking out the wrong branch of the tree.
  * Not following the process.
  * Trying to customize or "optimize" your system.

Here are some additional problems you might encounter, however:

5.11.1 - The build stopped with a "Signal 11" error

Building OpenBSD and other programs from source is a task which pushes
hardware harder than most others, making intensive use of CPU, disk and
memory. As a result, if you have hardware which has a problem, the most likely
time for that problem to appear is during a build. Signal 11 failures are
typically caused by hardware problems, very often memory problems, but can
also be CPU, main board, or heat issues. Your system may actually be very
stable otherwise, but unable to compile programs.

You will probably find it best to repair or replace the components that are
causing trouble, as problems may show themselves in other ways in the future.
If you have hardware which you really wish to use and causes you no other
problem, simply install a snapshot or a release.

For much more information, see the Sig11 FAQ.

5.11.2 - "make build" fails with "cannot open output file snake: is a
directory"

This is the result of two separate errors:

  * You did not fetch or update your CVS tree properly. When doing a CVS
    checkout operation, you must use the "-P" option, when you update your
    source tree with CVS, you must use "-Pd" options to cvs(1), as documented
    above. These options make sure new directories are added and removed from
    the tree as OpenBSD evolves.
  * You did not properly create the obj directory before your build. Building
    the tree without a /usr/obj directory is not supported.

It is important to carefully follow the instructions when fetching and
building your tree.

5.11.3 - My IPv6-less system doesn't work!

Yes. Please do not make modifications to the base system that you don't
understand the implications of. One "little" change in the kernel can have
very large impact to the entire rest of the system. Please re-read this.

5.11.4 - Oops! I forgot to make the /usr/obj directory first!

By doing a "make build" before doing a "make obj", you will end up with the
object files scattered in your /usr/src directory. This is a bad thing. If you
wish to try to avoid re-fetching your entire src tree again, you can try the
following to clean out obj files:

    # cd /usr/src
    # find . -type l -name obj | xargs rm
    # make cleandir
    # rm -rf /usr/obj/*
    # make obj

5.11.5 - Tip: Put /usr/obj on its own partition

If you build often, you may find it faster to put /usr/obj on its own
partition. The benefit is simple, it is typically faster to:

    # umount /usr/obj
    # newfs YourObjPartition
    # mount /usr/obj

than to "rm -rf /usr/obj/*".

5.11.6 - How do I not build parts of the tree?

Sometimes, you may wish to not build certain parts of the tree, typically
because you have installed a replacement for an included application from
packages, or wish to make a "smaller" release for whatever reason. The
solution to this is to use the SKIPDIR option of /etc/mk.conf.

Note: it is possible to make a broken system this way. The results of this
option are not supported by the OpenBSD project.

5.11.7 - Where can I learn more about the build process?

Here are some other resources:

  * release(8)
  * config(8)
  * mk.conf(5)
  * options(4)
  * /usr/src/Makefile
  * Patch Branches (-stable)
  * (for X) /usr/X11R6/README on your installed system

5.11.8 - I didn't see any snapshots on the FTP site. Where did they go?

Snapshots may be removed as they become old (or no longer relevant) or near
the time of a new -release.

5.11.9 - How do I bootstrap a newer version of the compiler (gcc)?

You should really just install the latest snapshot.

5.11.10 - What is the best way to update /etc, /var, and /dev?

Building the OpenBSD tree does not modify files in /etc automatically. This
means it is always up to the administrator to make the necessary modifications
there. To update files in these directories, use the sysmerge(8) utility.

This process is detailed in the upgrade document.

5.11.11 - Is there an easy way to make all the file hierarchy changes?

From time to time, files or directories are added to, or removed from the file
hierarchy. Also, ownership information for portions of the filesystem may
change. This is done automatically by sysmerge(8) utility, but for reference,
it can also be done using the mtree(8) utility.

First, fetch the latest source, then do the following:

    # cd /usr/src/etc/mtree
    # install -c -o root -g wheel -m 600 special /etc/mtree
    # install -c -o root -g wheel -m 444 4.4BSD.dist /etc/mtree
    # mtree -qdef /etc/mtree/4.4BSD.dist -p / -u

Your file hierarchy should now be up to date (but running sysmerge(8) is
easier!).

5.11.12 - Can I cross-compile? Why not?

Cross-compiling tools are in the system, for use by developers bringing up a
new platform. However, they are not maintained for general use.

When the developers bring up support for a new platform, one of the first big
tests is a native-build. Building the system from source puts considerable
load on the OS and machine, and does a very good job of testing how well the
system really works. For this reason, OpenBSD does all the build process on
the platform the build is being used for, also known as "native building".
Without native building, it is much more difficult to be sure that the various
platforms are actually running reliably, and not just booting.

------------------------------------------------------------------------------

==============================================================================

6 - Networking

------------------------------------------------------------------------------

Table of Contents

  * 6.1 - Before we go any further
  * 6.2 - Network configuration
      + 6.2.1 - Identifying and setting up your network interfaces
      + 6.2.2 - Default gateway
      + 6.2.3 - DNS resolution
      + 6.2.4 - Host name
      + 6.2.5 - Activating the changes
      + 6.2.6 - Checking routes
      + 6.2.7 - Setting up your OpenBSD box as a gateway
      + 6.2.8 - Setting up aliases on interfaces
      + 6.2.9 - Adding and Replacing NICs
  * 6.3 - How do I filter and firewall with OpenBSD?
  * 6.4 - Dynamic Host Configuration Protocol (DHCP)
      + 6.4.1 - DHCP Client
      + 6.4.2 - DHCP Server
  * 6.6 - Tuning networking parameters
  * 6.7 - Using NFS
  * 6.9 - Setting up a bridge with OpenBSD
  * 6.10 - How do I boot using PXE?
  * 6.11 - The Common Address Redundancy Protocol (CARP)
  * 6.12 - Using OpenNTPD
  * 6.13 - What are my wireless networking options?
  * 6.14 - How can I do equal-cost multipath routing?

------------------------------------------------------------------------------

6.1 - Before we go any further

For the bulk of this document, it helps if you have read and at least
partially understood the Kernel Configuration and Setup section of the FAQ,
and the ifconfig(8) and netstat(1) man pages.

If you are a network administrator, and you are setting up routing protocols,
if you are using your OpenBSD box as a router, if you need to go in depth into
IP networking, you really need to read Understanding IP Addressing. This is an
excellent document. "Understanding IP Addressing" contains fundamental
knowledge to build upon when working with IP networks, especially when you
deal with or are responsible for more than one network.

If you are working with applications such as web servers, ftp servers, and
mail servers, you may benefit greatly by reading the RFCs. Most likely, you
can't read all of them. Pick some topics that you are interested in, or that
you use in your network environment. Look them up, find out how they are
intended to work. The RFCs define many (thousands of) standards for protocols
on the Internet and how they are supposed to work.

6.2 - Network configuration

Normally, OpenBSD is initially configured by the installation process.
However, it is good to understand what is happening in this process and how it
works. All network configuration is done using simple text files in the /etc
directory.

6.2.1 - Identifying and setting up your network interfaces

In OpenBSD, interfaces are named for the type of card, not for the type of
connection. You can see your network card get initialized during the booting
process, or after the booting process using the dmesg(8) command. For example,
here is the part of dmesg for a Intel Fast Ethernet network card, which uses
the device name fxp:

    fxp0 at pci0 dev 10 function 0 "Intel 82557" rev 0x0c: irq 5, address 00:02:b3:2b:10:f7
    inphy0 at fxp0 phy 1: i82555 10/100 media interface, rev. 4

This device uses the fxp driver, and here is assigned the number 0. The number
is assigned based on various criteria, depending upon the card and other
details of the system. In most cases today in common hardware, cards are
assigned by the order they are found during bus probing (first fxp found is
fxp0, second is fxp1, etc.). Users of unusual or very old hardware (ISA) may
find devices numbered by hardware resource settings (ISA ne2 is I/O 280 IRQ 9
even if there is no ne1 or ne0), or MAC address.

You can find out what network interfaces have been identified by using the
ifconfig(8) utility. The following command will show all network interfaces on
a system. This sample output shows us only one physical Ethernet interface, an
fxp(4).

    $ ifconfig
    lo0: flags=8049<UP,LOOPBACK,RUNNING,MULTICAST> mtu 33200
            priority: 0
            groups: lo
            inet6 ::1 prefixlen 128
            inet6 fe80::1%lo0 prefixlen 64 scopeid 0x3
            inet 127.0.0.1 netmask 0xff000000
    fxp0: flags=8843<UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST> mtu 1500
            lladdr 00:04:ac:dd:39:6a
            priority: 0
            media: Ethernet autoselect (100baseTX full-duplex)
            status: active
            inet 10.0.0.38 netmask 0xffffff00 broadcast 10.0.0.255
            inet6 fe80::204:acff:fedd:396a%fxp0 prefixlen 64 scopeid 0x1
    enc0: flags=0<>
            priority: 0
            groups: enc
            status: active
    pflog0: flags=141<UP,RUNNING,PROMISC> mtu 33200
            priority: 0
            groups: pflog

As you can see here, ifconfig(8) gives us a lot more information than we need
at this point. But, it still allows us to see our interface. In the above
example, the interface card is already configured. This is obvious because an
IP network is already configured on fxp0, hence the values "inet 10.0.0.38
netmask 0xffffff00 broadcast 10.0.0.255". Also, the UP and RUNNING flags are
set.

Finally, you will notice several other interfaces come enabled by default.
These are virtual interfaces that serve various functions. The following
manual pages describe them:

  * lo - Loopback Interface
  * pflog - Packet Filter Logging Interface
  * enc - Encapsulating Interface

Other virtual interfaces are automatically created on-demand, including:

  * sl - SLIP Network Interface
  * ppp - Point to Point Protocol
  * tun - Tunnel Network Interface
  * bridge - Ethernet Bridge Interface
  * vlan - IEEE 802.1Q Encapsulation Interface
  * svlan - IEEE 802.1AD Provider Bridges (QinQ)
  * gre - GRE/MobileIP Encapsulation Interface
  * gif - Generic IPv4/IPv6 Tunnel Interface
  * carp - Common Address Redundancy Protocol Interface
  * mpe - MPLS Provider Edge
  * vether - Virtual Ethernet Interface
  * trunk - link aggregation and link failover interface
  * vxlan - virtual extensible local area network tunnel interface
  * mpe - MPLS Provider Edge

Interfaces are configured at boot time using /etc/hostname.if files, where if
is replaced by the full name of each interface and each interface has its own
file. The example above would use the file /etc/hostname.fxp0.

The layout of this file is simple:

    address_family address netmask broadcast [other options]

Much more detail about the format of this file can be found in the hostname.if
(5) man page. You will need to read this for less trivial configurations.

A typical interface configuration file, configured for an IPv4 address, would
look like this:

    $ cat /etc/hostname.fxp0
    inet 10.0.0.38 255.255.255.0 NONE

In this case, we have defined an IPv4 (inet) address, with an IP address of
10.0.0.38, a subnet mask of 255.255.255.0 and no specific broadcast address
(which will default to 10.0.0.255 in this case).

You could also specify media types for Ethernet, say, if you wanted to force
100baseTX full-duplex mode.

    inet 10.0.0.38 255.255.255.0 NONE media 100baseTX mediaopt full-duplex

(Of course, you should never force full duplex mode unless both sides of the
connection are set to do this! In the absence of special needs, media settings
should be excluded. A more likely case might be to force 10base-T or half
duplex when your infrastructure requires it.)

Or, you may want to use special flags specific to a certain interface. The
format of the hostname file doesn't change much!

    $ cat /etc/hostname.vlan0
    inet 172.21.0.31 255.255.255.0 NONE vlan 2 vlandev fxp1

6.2.2 - Default gateway

Put the IP of your gateway in the file /etc/mygate. This will allow for your
gateway to be set upon boot. This file consists of one line, with just the
address of this machine's gateway address:

    10.0.0.1

It is possible to use a symbolic name there, but be careful: you can't assume
things like the resolver are fully configured or even reachable until AFTER
the default gateway is configured. In other words, it had better be an IP
address or something that is defined in the /etc/hosts file.

6.2.3 - DNS Resolution

DNS resolution is controlled by the file /etc/resolv.conf. Here is an example
of a /etc/resolv.conf file:

    search example.com
    nameserver 125.2.3.4
    nameserver 125.2.3.5
    lookup file bind

In this case, the default domain name will be example.com, there are two DNS
resolvers, 125.2.3.4 and 125.2.3.5 specified, and the /etc/hosts file will be
consulted before the DNS resolvers are.

As with virtually all Unix (and many non-Unix) systems, there is an /etc/hosts
file which can be used to specify systems that are not in (or if used with the
above "lookup" priority, not as desired in) the formal DNS system.

If you are using DHCP, you'll want to read 6.4 - DHCP taking note of
resolv.conf.tail(5).

6.2.4 - Host name

Every Unix machine has a name. In OpenBSD, the name is specified as a "Fully
Qualified Domain Name" (FQDN) in one line in the file /etc/myname. If this
machine is named "puffy" and in the domain "example.com", the file would
contain the one line:

    puffy.example.com

6.2.5 - Activating the changes

From here, you can either reboot or run the /etc/netstart script. You can do
this by simply typing (as root):

    # sh /etc/netstart
    writing to routing socket: File exists
    add net 127: gateway 127.0.0.1: File exists
    writing to routing socket: File exists
    add net 224.0.0.0: gateway 127.0.0.1: File exists

Notice that a few errors were produced. By running this script, you are
reconfiguring things which are already configured. As such, some routes
already exist in the kernel routing table. From here your system should be up
and running. Again, you can check to make sure that your interface was setup
correctly with ifconfig(8).

Even though you can completely reconfigure networking on an OpenBSD system
without rebooting, a reboot is HIGHLY recommended after any significant
reconfiguration. The reason for this is the environment at boot is somewhat
different than it is when the system is completely up and running. For
example, if you had specified a DNS-resolved symbolic name in any of the
files, you would probably find it worked as expected after reconfigure, but on
initial boot, your external resolver may not be available, so the
configuration will fail.

6.2.6 - Checking routes

You can check your routes via netstat(1) or route(8). If you are having
routing problems, you may want to use the -n flag to route(8) which prints the
IP addresses rather than doing a DNS lookup and displaying the hostname. Here
is an example of viewing your routing tables using both programs.

    $ netstat -rn
    Routing tables

    Internet:
    Destination        Gateway            Flags     Refs     Use    Mtu  Interface
    default            10.0.0.1           UGS         0       86      -  fxp0
    127/8              127.0.0.1          UGRS        0        0      -  lo0
    127.0.0.1          127.0.0.1          UH          0        0      -  lo0
    10.0.0/24          link#1             UC          0        0      -  fxp0
    10.0.0.1           aa:0:4:0:81:d      UHL         1        0      -  fxp0
    10.0.0.38          127.0.0.1          UGHS        0        0      -  lo0
    224/4              127.0.0.1          URS         0        0      -  lo0

    Encap:
    Source             Port  Destination        Port  Proto SA(Address/SPI/Proto)

    $ route show
    Routing tables

    Internet:
    Destination      Gateway            Flags
    default          10.0.0.1           UG
    127.0.0.0        LOCALHOST          UG
    localhost        LOCALHOST          UH
    10.0.0.0         link#1             U
    10.0.0.1         aa:0:4:0:81:d      UH
    10.0.0.38        LOCALHOST          UGH
    BASE-ADDRESS.MCA LOCALHOST          U

6.2.7 - Setting up your OpenBSD box as a forwarding gateway

This is the basic information you need to set up your OpenBSD box as a gateway
(also called a router). If you are using OpenBSD as a router on the Internet,
we suggest that you also read the Packet Filter setup instructions below to
block potentially malicious traffic. Also, due to the low availability of IPv4
addresses from network service providers and regional registries, you may want
to look at Network Address Translation for information on conserving your IP
address space.

The GENERIC kernel already has the ability to allow IP Forwarding, but needs
to be turned on. You should do this using the sysctl(8) utility. To change
this permanently you should edit the file /etc/sysctl.conf to allow for IP
Forwarding. To do so add this line in that configuration file.

    net.inet.ip.forwarding=1

To make this change without rebooting you would use the sysctl(8) utility
directly. Remember though that this change will no longer exist after a
reboot, and needs to be run as root.

    # sysctl net.inet.ip.forwarding=1
    net.inet.ip.forwarding: 0 -> 1

Now modify the routes on the other hosts on both sides. This is often done
with static route entries, but more advanced networks can make use of the rich
suite of routing daemons included as part of OpenBSD to pass routes to other
systems. These include OpenBGPD, ospfd(8), ospf6d(8), ldpd(8) and ripd(8).
Additionally the ports collection includes software such as bird, igmpproxy
and quagga. OpenBSD supports several T1, HSSI, ATM, FDDI and serial (PPP/SLIP)
interfaces, and of course many Ethernet devices (including 10Gb).

6.2.8 - Setting up aliases on an interface

OpenBSD has a simple mechanism for setting up IP aliases on an interface. To
do this simply edit the file /etc/hostname.<if>. This file is read upon boot
by the /etc/netstart(8) script, which is part of the rc startup hierarchy. For
the example, we assume that the user has an interface dc0 and is on the
network 192.168.0.0. Other important information:

  * IP for dc0 is 192.168.0.2
  * NETMASK is 255.255.255.0

A few side notes about aliases. In OpenBSD you use the interface name only.
There is no difference between the first alias and the second alias. Unlike
some other operating systems, OpenBSD doesn't refer to them as dc0:0, dc0:1.
If you are referring to a specific aliased IP address with ifconfig, or adding
an alias, be sure to say "ifconfig int alias" instead of just "ifconfig int"
at the command line. You can delete aliases with "ifconfig int delete".

Assuming you are using multiple IP addresses which are in the same IP subnet
with aliases, your netmask setting for each alias becomes 255.255.255.255.
They do not need to follow the netmask of the first IP bound to the interface.
In this example, /etc/hostname.dc0, two aliases are added to the device dc0,
which, by the way, was configured as 192.168.0.2 netmask 255.255.255.0.

    # cat /etc/hostname.dc0
    inet 192.168.0.2 255.255.255.0 NONE media 100baseTX
    inet alias 192.168.0.3 255.255.255.255
    inet alias 192.168.0.4 255.255.255.255

Once you've made this file, it just takes a reboot for it to take effect. You
can, however, bring up the aliases by hand using the ifconfig(8) utility. To
bring up the first alias you would use the command:

    # ifconfig dc0 inet alias 192.168.0.3 netmask 255.255.255.255

(but again, a reboot is recommended to make sure you entered everything as you
expected it to be!)

To view these aliases you must use the command:

    $ ifconfig -A
    dc0: flags=8863<UP,BROADCAST,NOTRAILERS,RUNNING,SIMPLEX,MULTICAST>
            media: Ethernet manual
            inet 192.168.0.2 netmask 0xffffff00 broadcast 192.168.0.255
            inet 192.168.0.3 netmask 0xffffffff broadcast 192.168.0.3

6.2.9 - Adding and Replacing NICs

You may have to replace or add a network adapter on an OpenBSD system, maybe
upgrading the capabilities of the system or repairing failed hardware. This
will require some reconfiguration. The good news is this is relatively easy,
though there are some things to be aware of.

Key is understanding how OpenBSD names NICs -- we'll ignore "special" cases
like ISA devices which probably shouldn't be used in important applications
today. Unlike some OSs which try to remember any network adapter the installed
OS has ever seen, OpenBSD does not remember a NICs identification between
boots -- it names them in order that they are found. In most cases, this is
far simpler for you, as the system will always identify a NIC the same way in
the same hardware configuration, and when configurations change, the results
are easily understood.

Here are some cases:

  * Replace a NIC with an identical device: This would be the case when you
    move the disk system from a failed machine to another identical machine,
    or install an image or full backup to identical hardware. In this case,
    things are easy -- no change in configuration will be needed, other than
    perhaps changing the IP address in the hostname.if if needed.
  * Replace a NIC with a different device: This would also be the case when
    one moves a disk system to a non-identical machine. In this case, simply
    rename the old hostname.if file to match the new device. For example, if
    you replace an fxp(4) device which was fxp0 (first fxp) with a re(4)
    device, which would end up as re0, you could rename /etc/hostname.fxp0 to
    /etc/hostname.re0 and your new re0 device would take over the
    configuration of the old fxp0 device. If you might someday restore the
    original configuration, you may prefer to make the new file a hard link to
    the original, rather than renaming it.
  * Replacing one of several similar cards with a different type: Let's assume
    you have a machine with fxp0, fxp1 and fxp2, and fxp0 fails.
    Unfortunately, you don't have a spare similar fxp card, so you need to
    replace it with an em(4) card. This gets a little ugly, as fxp1 and fxp2
    will rename themselves:

        old  -> new
        fxp0 -> em0
        fxp1 -> fxp0
        fxp2 -> fxp1

    Again, you will rename your /etc/hostname.* accordingly:

        # cd /etc
        # mv hostname.fxp0 hostname.em0
        # mv hostname.fxp1 hostname.fxp0
        # mv hostname.fxp2 hostname.fxp1

  * Adding a new NIC to an existing system: If your added NIC is of a
    different type, it will be the "0" device of whatever driver it is. For
    example, if you are adding a bge(4) device to a machine with only a rl(4)
    device, life is easy -- the new device will be bge0, create an appropriate
    /etc/hostname.bge0.

    The more difficult variation is when you are adding a new card of the same
    type as another in the machine. Most add-on NICs will have the MAC address
    of the card somewhere written on the card. Make note of this, insert the
    card, and look at the dmesg and note the identifier of the new NIC and its
    relationship to the earlier NICs. You may find that ALL the existing NICs
    have changed number. You may be able to put the new NIC in a different
    slot to change the identifier as desired, but if the earlier devices were
    on-board, you may have no options, and have to adjust the hostname.if
    files.
  * Total Confusion: Sometimes, things get totally confused. Maybe your new
    machine has lots of multi-port NICs, or several on-board NICs and you
    aren't quite sure how they are identified, or changes were made with less
    care than might be hoped for, and now you aren't sure what is what.

    The first thing to note is that ifconfig(8) will tell you both the MAC
    address and the link status of each port. So first trick might be to mark
    add-in cards with their MAC addresses. Second trick in a confused
    situation can be to simply attach ONE unknown NIC to a switch port at a
    time, and look for which NIC in ifconfig(8) is now showing a link. Once
    you have a few ports identified, you will often figure out the rest
    quickly.

In addition to the hostname.if files, any other file that deals with hardware
interfaces will have to be adjusted. Some likely candidates might include:

  * /etc/pf.conf
  * CARP configuration (/etc/hostname.carp*)
  * Bridge configuration (/etc/hostname.bridge*)
  * Trunk configuration (/etc/hostname.trunk*)

6.3 - How do I filter and firewall with OpenBSD?

Packet Filter (from here on referred to as PF) is OpenBSD's system for
filtering IP traffic and doing Network Address Translation. PF is also capable
of normalizing and conditioning IP traffic and providing bandwidth control and
packet prioritization, and can be used to create powerful and flexible
firewalls. It is described in the PF User's Guide.

6.4 - Dynamic Host Configuration Protocol (DHCP)

Dynamic Host Configuration Protocol is a way to configure network interfaces
"automatically". OpenBSD can be a DHCP server (configuring other machines), a
DHCP client (configured by another machine), and in some cases, can be both.

6.4.1 - DHCP Client

To use the DHCP client dhclient(8) included with OpenBSD, edit /etc/
hostname.xl0 (this is assuming your main Ethernet interface is xl0. Yours
might be ep0 or fxp0 or something else.) All you need to put in this hostname
file is 'dhcp':

    # echo dhcp > /etc/hostname.xl0

This will cause OpenBSD to automatically start the DHCP client on boot.
OpenBSD will gather its IP address, default gateway, and DNS servers from the
DHCP server.

If you want to start a DHCP client from the command line, make sure /etc/
dhclient.conf exists, then try:

    # dhclient fxp0

Where fxp0 is the interface on which you want to receive DHCP.

No matter how you start the DHCP client, you can edit the /etc/dhclient.conf
file to not update your DNS according to the dhcp server's idea of DNS by
first uncommenting the 'request' lines in it (they are examples of the default
settings, but you need to uncomment them to override dhclient's defaults.)

    request subnet-mask, broadcast-address, time-offset, routers,
          domain-name, domain-name-servers, host-name, lpr-servers, ntp-servers;

and then remove domain-name-servers. Of course, you may want to remove
host-name, or other settings too.

By changing options in your dhclient.conf(5) file, you're telling the DHCP
client how to build your resolv.conf(5) file. The DHCP client overrides any
information you already have in resolv.conf(5) with the information it
retrieves from the DHCP server. Therefore, you'll lose any changes you made
manually to resolv.conf.

There are two mechanisms available to prevent this:

  * OPTION MODIFIERS (default, supersede, prepend, and append) allow you to
    override any of the options in dhclient.conf(5).
  * resolv.conf.tail(5) allows you to append anything you want to the
    resolv.conf(5) file created by dhclient(8).

An example would be if you're using DHCP but you want to append lookup file
bind to the resolv.conf(5) created by dhclient(8). There is no option for this
in dhclient.conf so you must use resolv.conf.tail to preserve this.

    # echo "lookup file bind" > /etc/resolv.conf.tail

Now your resolv.conf(5) should include "lookup file bind" at the end.

    nameserver 192.168.1.1
    nameserver 192.168.1.2
    lookup file bind

6.4.2 - DHCP Server

If you want to use OpenBSD as a DHCP server dhcpd(8), edit /etc/rc.conf.local
so that it contains the line dhcpd_flags="". For example:

     # echo 'dhcpd_flags=""' >>/etc/rc.conf.local

This will run dhcpd, and it will attach to all NICs which have valid
configurations in /etc/dhcpd.conf. You may specify individual interfaces
instead of all by naming them explicitly, for example, dhcpd_flags="xl1 xl2
xl3".

Then, edit /etc/dhcpd.conf. The options are pretty self-explanatory.

        option  domain-name "example.com";
        option  domain-name-servers 192.168.1.3, 192.168.1.5;

        subnet 192.168.1.0 netmask 255.255.255.0 {
                option routers 192.168.1.1;

                range 192.168.1.32 192.168.1.127;
        }

This will tell your DHCP clients that the domain to append to DNS requests is
example.com (so, if the user types in 'telnet joe' then it will send them to
joe.example.com). It will point them to DNS servers 192.168.1.3 and
192.168.1.5. For hosts that are on the same network as an Ethernet interface
on the OpenBSD machine, which is in the 192.168.1.0/24 range, it will assign
them an IP address between 192.168.1.32 and 192.168.1.127. It will set their
default gateway as 192.168.1.1.

If you want to start dhcpd(8) from the command line, after editing /etc/
dhcpd.conf, try:

     # /etc/rc.d/dhcpd start
     dhcpd(ok)

If there were fatal configuration errors, it will exit and let you know that
it failed to start ("dhcpd(failed)"), and tell you why in /var/log/messages.

If you are serving DHCP to a Windows box, you may want dhcpd(8) to give the
client a 'WINS' server address. To make this happen, just add the following
line to your /etc/dhcpd.conf:

     option    netbios-name-servers    192.168.92.55;

(where 192.168.92.55 is the IP of your Windows or Samba server.) See
dhcp-options(5) for more options that your DHCP clients may want.

6.6 - Tuning networking parameters

One goal of OpenBSD is to have the system Just Work for the vast majority of
our users. Twisting knobs you don't understand is far more likely to break the
system than it is to improve its performance. Always start from the default
settings, and only adjust things you actually see a problem with.

VERY FEW people will need to adjust any networking parameters!

6.6.1 - I don't want the kernel to dynamically allocate a certain port

From sysctl(8):

    To set the list of reserved TCP ports that should not be allocated by the
    kernel dynamically:

          # sysctl net.inet.tcp.baddynamic=749,750,751,760,761,871

    This can be used to keep daemons from stealing a specific port that an-
    other program needs to function.  List elements may be separated by com-
    mas and/or whitespace.

    It is also possible to add or remove ports from the current list:

          # sysctl net.inet.tcp.baddynamic=+748
          # sysctl net.inet.tcp.baddynamic=-871

6.7 - Simple NFS usage

NFS, or Network File System, is used to share a filesystem over the network. A
few choice man pages to read before trying to setup a NFS server are:

  * nfsd(8)
  * mountd(8)
  * exports(5)

This section will go through the steps for a simple setup of NFS. This example
details a server on a LAN, with clients accessing NFS on the LAN. It does not
talk about securing NFS. We presume you have already setup packet filtering or
other firewalling protection, to prevent outside access. If you are allowing
outside access to your NFS server, and you have any kind of sensitive data
stored on it, we strongly recommend that you employ IPsec. Otherwise, people
can potentially see your NFS traffic. Someone could also pretend to be the IP
address which you are allowing into your NFS server. There are several attacks
that can result. When properly configured, IPsec protects against these types
of attacks.

Setting up an NFS Server

These services must be enabled and running on the server:

  * portmap(8)
  * mountd(8)
  * nfsd(8)

By default each of these is disabled in OpenBSD. Add the following lines to
rc.conf.local(8) to enable them:

    portmap_flags=""
    mountd_flags=""
    nfsd_flags="-tun 4"

The next step is to configure the list of filesystems that will be made
available for clients to mount.

In this example, we have a server with IP address 10.0.0.1. This server will
be serving NFS only to clients within its own subnet. All of this is
configured in the /etc/exports file. This file lists which filesystems you
wish to have accessible via NFS and defines who is able to access them. There
are many options that you can use in /etc/exports; it is best that you read
the exports(5) man page. For our example server, we've setup an exports file
that looks like this:

    #
    # NFS exports Database
    # See exports(5) for more information.  Be very careful, misconfiguration
    # of this file can result in your filesystems being readable by the world.
    /work -alldirs -ro -network=10.0.0 -mask=255.255.255.0

This means that the local filesystem /work will be made available via NFS. The
-alldirs option specifies that clients will be able to mount at any point
under /work as well as /work itself. For example, if there was a directory
called /work/monday, clients could mount /work (and have access to all files/
directories underneath that directory) or they could mount /work/monday and
have access to just the files/directories contained there. The -ro option
specifies that clients will only be granted read-only access. The last two
arguments specify that only clients within the 10.0.0.0 network using a
netmask of 255.255.255.0 will be authorized to mount this filesystem. This is
important for some servers that are accessible by different networks.

Another important security note: don't just add a filesystem to /etc/exports
without some kind of list of allowed host(s). Without a list of hosts which
can mount a particular directory, anyone who can reach your server will be
able to mount your NFS exported directories.

Now you can start the server services. You can either reboot (after enabling
them as per the instructions above) or run them manually.

    # /etc/rc.d/portmap start
    # /etc/rc.d/mountd start
    # /etc/rc.d/nfsd start

The nfsd_flags enable TCP (-t) and UDP (-u) connections and enable 4 instances
(-n) of nfsd to run. You should set an appropriate number of NFS server
instances handle the maximum number of concurrent client requests that you
want to service by adjusting the nfsd_flags line in rc.conf.local.

You're now ready to mount the exported filesystems from the client(s).

Remember: If you make changes to /etc/exports while NFS is already running,
you need to make mountd aware of this! Just HUP mountd and the changes will
take affect.

    # /etc/rc.d/mountd reload

Mounting NFS Filesystems

NFS filesystems can be mounted from a client without needing to enable any
services or daemons. They can be mounted just like any other filesystem.

NFS filesystems should be mounted via mount(8), or more specifically,
mount_nfs(8). To mount a filesystem /work on host 10.0.0.1 to local filesystem
/mnt, do this (note that you don't need to use an IP address; mount will
resolve host names):

    # mount -t nfs 10.0.0.1:/work /mnt

To have that filesystem mounted at boot, add something like this to /etc/
fstab:

    10.0.0.1:/work /mnt nfs rw 0 0

It is important that you use 0 0 at the end of this line so that your computer
does not try to fsck the NFS filesystem on boot. The other standard security
options, such as noexec, nodev, and nosuid, should also be used where
applicable. For example:

    10.0.0.1:/work /mnt nfs rw,nodev,nosuid 0 0

This way, no devices or setuid programs on the NFS server can subvert security
measures on the NFS client. If you are not mounting programs which you expect
to run on the NFS client, add noexec to this list.

When accessing an NFS mount as the root user, the server automatically maps
root's access to username "nobody" and group "nobody". This is important to
know when considering file permissions. For example, take a file with these
permissions:

    -rw-------    1 root     wheel           0 Dec 31 03:00 _daily.B20143

If this file was on an NFS share and the root user tried to access this file
from the NFS client, access would be denied. This is because the server uses
the credentials of the user "nobody" when root tries to access the file. Since
the user nobody doesn't have permissions to access the file, access is denied.

The user and group that root are mapped to are configurable via the exports(5)
file on the NFS server.

Checking Stats on NFS

One thing to check to ensure NFS is operating properly is that all the daemons
have properly registered with RPC. To do this, use rpcinfo(8).

    $ rpcinfo -p 10.0.0.1
       program vers proto   port
        100000    2   tcp    111  portmapper
        100000    2   udp    111  portmapper
        100005    1   udp    633  mountd
        100005    3   udp    633  mountd
        100005    1   tcp    916  mountd
        100005    3   tcp    916  mountd
        100003    2   udp   2049  nfs
        100003    3   udp   2049  nfs
        100003    2   tcp   2049  nfs
        100003    3   tcp   2049  nfs

During normal usage, there are a few other utilities that allow you to see
what is happening with NFS. One is showmount(8), which allows you to view what
is currently mounted and who is mounting it. There is also nfsstat(1) which
shows much more verbose statistics. To use showmount(8), try /usr/bin/
showmount -a host. For example:

    $ /usr/bin/showmount -a 10.0.0.1
    All mount points on 10.0.0.1:
    10.0.0.37:/work

This output shows that the client 10.0.0.37 has mounted the /work export being
served from the server at 10.0.0.1.

6.9 - Setting up a network bridge in OpenBSD

A bridge is a link between two or more separate networks. Unlike a router,
packets transfer through the bridge "invisibly" -- logically, the two network
segments appear to be one segment to nodes on either side of the bridge. The
bridge will only forward packets that have to pass from one segment to the
other, so among other things, they provide an easy way to reduce traffic in a
complex network and yet allow any node to access any other node when needed.

Note that because of this "invisible" nature, an interface in a bridge may or
may not have an IP address of its own. If it does, the interface has
effectively two modes of operation, one as part of a bridge, the other as a
normal, stand-alone NIC. If neither interface has an IP address, the bridge
will pass network data, but will not be externally maintainable (which can be
a feature).

A simple example of a bridge application

One of my computer racks has a number of older systems, none of which have a
built-in 10BASE-TX NIC. While they all have an AUI or AAUI connector, my
supply of transceivers is limited to coax. One of the machines on this rack is
an OpenBSD-based terminal server which is always on and connected to the
high-speed network. Adding a second NIC with a coax port will allow me to use
this machine as a bridge to the coax network.

This system has two NICs in it now, an Intel EtherExpress/100 (fxp0) and a
3c590-Combo card (ep0) for the coax port. fxp0 is the link to the rest of my
network and will thus have an IP address, ep0 is going to be for bridging only
and will have no IP address. Machines attached to the coax segment will
communicate as if they were on the rest of my network. So, how do we make this
happen?

The file hostname.fxp0 contains the configuration info for the fxp0 card. This
machine is set up using DHCP, so its file looks like this:

    $ cat /etc/hostname.fxp0
    dhcp NONE NONE NONE

No surprises here.

The ep0 card is a bit different, as you might guess:

    $ cat /etc/hostname.ep0
    up media 10base2

Here, we are instructing the system to activate this interface using ifconfig
(8) and set it to 10BASE-2 (coax). No IP address or similar information needs
to be specified for this interface. The options the ep card accepts are
detailed in its man page.

Now, we need to set up the bridge. Bridges are initialized by the existence of
a file named something like hostname.bridge0. Here is an example for my
situation here:

    $ cat /etc/hostname.bridge0
    add fxp0
    add ep0
    up

This is saying set up a bridge consisting of the two NICs, fxp0 and ep0, and
activate it. Does it matter which order the cards are listed? No, remember a
bridge is very symmetrical -- packets flow in and out in both directions.

That's it! Reboot, and you now have a functioning bridge.

A bridge acting as a DHCP server

Let's say we have a small system which has four vr(4) interfaces, vr0 through
vr3. We want to bridge vr1, vr2 and vr3 together, leaving out vr0 for an
uplink (a cable modem for instance). We also want to serve IP addresses
through DHCP over the bridged interfaces. Being a DHCP server and an uplink
router, the box needs to have an IP address on the bridged network (contrary
to the previous example in which the bridging box was not visible on the
network).

It is not possible to assign an IP address directly to a bridge(4) interface.
The IP address should be added to one of the member interfaces, but we cannot
use a physical interface as the link might be down, in which case the address
would not be reachable. Fortunately, starting with OpenBSD 4.7, there is a
virtual Ethernet interface driver vether(4) that can be used for that purpose.
We will add it to the bridge, assign the IP address to it and make dhcpd(8)
listen there.

Notes:

  * The DHCP server configuration is not described yet again in this section
    but the addressing scheme used here is the same.
  * This will also be the uplink router for your bridged network, so we will
    use IP address 192.168.1.1 to match the DHCP server configuration.
  * We will not cover the uplink, routing or firewalling configuration here.

First mark vr1, vr2 and vr3 as up:

    $ cat /etc/hostname.vr1
    up
    $ cat /etc/hostname.vr2
    up
    $ cat /etc/hostname.vr3
    up

Then create the vether0 configuration:

    $ cat /etc/hostname.vether0
    inet 192.168.1.1 255.255.255.0 192.168.1.255
    up

We configure the bridge interface to contain all the above interfaces:

    $ cat /etc/hostname.bridge0
    add vether0
    add vr1
    add vr2
    add vr3
    up

And finally we make dhcpd(8) listen on the vether0 interface:

    $ grep ^dhcpd_flags= /etc/rc.conf.local
    dhcpd_flags="vether0"

Reboot and voila`!

Filtering on a bridge

While there are certainly uses for a simple bridge like this, it is likely you
might want to DO something with the packets as they go through your bridge. As
you might expect, Packet Filter can be used to restrict what traffic goes
through your bridge.

Keep in mind, by the nature of a bridge, the same data flows through both
interfaces, so you only need to filter on one interface. Your default "Pass
all" statements would look something like this:

    pass in  on ep0  all
    pass out on ep0  all
    pass in  on fxp0 all
    pass out on fxp0 all

Now, let's say I wish to filter traffic hitting these old machines, I want
only Web and SSH traffic to reach them. In this case, we are going to let all
traffic in and out of the ep0 interface, but filter on the fxp0 interface,
using keep state to handle the reply data:

    # Pass all traffic through ep0
    pass in quick on ep0 all
    pass out quick on ep0 all

    # Block fxp0 traffic
    block in  on fxp0 all
    block out on fxp0 all

    pass in quick on fxp0 proto tcp from any to any port {22, 80} \
         flags S/SA keep state

Note that this rule set will prevent anything but incoming HTTP and SSH
traffic from reaching either the bridge machine or any of the other nodes
"behind" it. Other results could be had by filtering the other interface.

To monitor and control the bridge you have created, use the ifconfig(8)
command, which can also be used to create a bridge after boot.

Tips on bridging

  * It is HIGHLY recommended that you filter on only one interface. While it
    is possible to filter on both, you really need to understand this very
    well to do it right.
  * By using the blocknonip option of ifconfig(8) or in hostname.bridge0, you
    can prevent non-IP traffic (such as IPX or NETBEUI) from slipping around
    your filters. This may be important in some situations, but you should be
    aware that bridges work for all kinds of traffic, not just IP.
  * Bridging requires that the NICs be in a "Promiscuous mode" -- they listen
    to ALL network traffic, not just that directed at the interface. This will
    put a higher load on the processor and bus than one might expect. Some
    NICs don't work properly in this mode, the TI ThunderLAN chip (tl(4)) is
    an example of a chip that won't work as part of a bridge.

6.10 - How do I boot using PXE? (i386, amd64)

The Preboot Execution Environment, or PXE, is a way to boot a computer from
the network, rather than from a hard disk, a floppy or a CD-ROM. The
technology was originally developed by Intel, but is supported by most major
network card and computer manufacturers now. Note that there are several
different network boot protocols, PXE is relatively recent. Traditionally, PXE
booting is done using ROMs on the NIC or mainboard of the system, but boot
floppies are available from various sources that will permit PXE booting, as
well. Many ROMs on older NICs support network booting but do NOT support PXE;
OpenBSD/i386 or amd64 cannot currently be booted across the network by these.

How does PXE booting work?

First, it is wise to understand how OpenBSD boots on i386 and amd64 platforms.
Upon starting the boot process, the PXE-capable NIC broadcasts a DHCP request
over the network. The DHCP server will assign the adapter an IP address, and
gives it the name of a file to be retrieved from a tftp(1) server and
executed. This file then conducts the rest of the boot process. For OpenBSD,
the file is pxeboot, which takes the place of the standard boot(8) file.
pxeboot(8) is then able to load and execute a kernel (such as bsd or bsd.rd)
from the same tftp(1) server.

How do I do it?

The first and obvious step is you must have a PXE-boot capable computer or
network adapter. Some documentation will indicate all modern NICs and
computers are PXE capable, but this is clearly not true -- many low cost
systems do not include PXE ROMs or use an older network boot protocol. You
also need a properly configured DHCP and TFTP server.

Assuming an OpenBSD machine is the source of the boot files (this is NOT
required), your DHCP server dhcpd.conf file will need to have the following
line:

    filename "pxeboot";

to have the DHCP server offer that file to the booting workstation. For
example:

    shared-network LOCAL-NET {
            option  domain-name "example.com";
            option  domain-name-servers 192.168.1.3, 192.168.1.5;

            subnet 192.168.1.0 netmask 255.255.255.0 {
                    option routers 192.168.1.1;
                    filename "pxeboot";
                    range 192.168.1.32 192.168.1.127;
                    default-lease-time 86400;
                    max-lease-time 90000;
            }
    }

You will also have to activate the tftpd(8) daemon. This is typically done by
adding "tftpd_flags=/tftpboot" to your /etc/rc.conf.local file. tftpd(8)
serves files from a particular directory, in the case of this line, that
directory is /tftpboot, which we will use for this example. Obviously, this
directory needs to be created and populated. Typically, you will have only a
few files here for PXE booting:

  * pxeboot, the PXE boot loader (serving the same function as boot on a
    disk-based system).
  * bsd.rd, the install kernel or bsd, a customized kernel.
  * /etc/boot.conf, a boot configuration file.

Note that /etc/boot.conf is only needed if the kernel you wish to boot from is
not named bsd, or other pxeboot defaults are not as you need them (for
example, you wish to use a serial console). You can test your tftpd(8) server
using a tftp(1) client, making sure you can fetch the needed files.

When your DHCP and TFTP servers are running, you are ready to try it. You will
have to activate the PXE boot on your system or network card; consult your
system documentation. Once you have it set, you should see something similar
to the following:

    Intel UNDI, PXE-2.0 (build 067)
    Copyright (C) 1997,1998 Intel Corporation

    For Realtek RTL 8139(X) PCI Fast Ethernet Controller v1.00 (990420)

    DHCP MAC ADDR: 00 E0 C5 C8 CF E1
    CLIENT IP: 192.168.1.76  MASK: 255.255.255.0  DHCP IP: 192.168.1.252
    GATEWAY IP: 192.168.1.1
    probing: pc0 com0 com1 apm pxe![2.1] mem[540k 28m a20=on]
    disk: hd0*
    net: mac 00:e0:c5:c8:cf:e1, ip 192.168.1.76, server 192.168.1.252
    >> OpenBSD/i386 PXEBOOT 3.23
    boot>

At this point, you have the standard OpenBSD boot prompt. If you simply type
"bsd.rd" here, you will then fetch the file bsd.rd from the TFTP server.

    >> OpenBSD/i386 PXEBOOT 3.23
    boot> bsd.rd
    booting tftp:bsd.rd: 4375152+733120 [58+122112+105468]=0x516d04
    entry point at 0x100120

    Copyright (c) 1982, 1986, 1989, 1991, 1993
            The Regents of the University of California.  All rights reserved.

    Copyright (c) 1995-2013 OpenBSD.  All rights reserved.  http://www.OpenBSD.org

    OpenBSD 5.8 (RAMDISK_CD) #1038: Sun Aug 16 02:43:32 MDT 2015
      ...

The bsd.rd install kernel will now boot.

Can I boot OpenBSD kernels other than bsd.rd using PXE?

Yes, although with the tools currently in OpenBSD, PXE booting is primarily
intended for installing the OS.

6.11 - The Common Address Redundancy Protocol (CARP)

6.11.1 - What is CARP and how does it work?

CARP is a tool to help achieve system redundancy, by having multiple computers
creating a single, virtual network interface between them, so that if any
machine fails, another can respond instead, and/or allowing a degree of load
sharing between systems. CARP is an improvement over the Virtual Router
Redundancy Protocol (VRRP) standard. It was developed after VRRP was deemed to
be not free enough because of a possibly-overlapping Cisco patent. For more
information on CARP's origins and the legal issues surrounding VRRP, please
visit this page.

To avoid legal conflicts, Ryan McBride (with help from Michael Shalayeff,
Marco Pfatschbacher and Markus Friedl) designed CARP to be fundamentally
different. The inclusion of cryptography is the most prominent change, but
still only one of many.

How it works: CARP is a multicast protocol. It groups several physical
computers together under one or more virtual addresses. Of these, one system
is the master and responds to all packets destined for the group, the other
systems act as hot spares. No matter what the IP and MAC address of the local
physical interface, packets sent to the CARP address are returned with the
CARP information.

At configurable intervals, the master advertises its operation on IP protocol
number 112. If the master goes offline, the other systems in the CARP group
begin to advertise. The host that's able to advertise most frequently becomes
the new master. When the main system comes back up, it becomes a back up host
by default, although if it's more desirable for one host to be master whenever
possible (e.g. one host is a fast Sun Fire V120 and the others are
comparatively slow SPARCstation IPCs), you can so configure them.

While highly redundant and fault-tolerant hardware minimizes the need for
CARP, it doesn't erase it. There's no hardware fault tolerance that's capable
of helping if someone knocks out a power cord, or if your system administrator
types reboot in the wrong window. CARP also makes it easier to make the patch
and reboot cycle transparent to users, and easier to test a software or
hardware upgrade--if it doesn't work, you can fall back to your spare until
fixed.

There are, however, situations in which CARP won't help. CARP's design does
require that the members of a group be on the same physical subnet with a
static IP address, although with the introduction of the carpdev directive,
there is no more need for IP addresses on the physical interfaces. Similarly,
services that require a constant connection to the server (such as SSH or IRC)
will not be transparently transferred to the other system--though in this
case, CARP can help with minimizing downtime. CARP by itself does not
synchronize data between applications, this has to be done through
"alternative channels" such as pfsync(4) (for redundant filtering), manually
duplicating data between boxes with rsync, or whatever is appropriate for your
application.

6.11.2 - Configuration

CARP's controls are located in two places: sysctl(8) and ifconfig(8). Let's
look at the sysctls first.

The first sysctl, net.inet.carp.allow, defines whether the host handles CARP
packets at all. Clearly, this is necessary to use CARP. This sysctl is enabled
by default.

The second, net.inet.carp.log, logs CARP state changes, bad packets and other
errors. Set to log state changes by default.

Third, net.inet.carp.preempt enables natural selection among CARP hosts. The
most fit for the job (that is to say, able to advertise most frequently) will
become master. Disabled by default, meaning a system that is not a master will
not attempt to (re)gain master status.

All these sysctl variables are documented in sysctl(3).

For the remainder of CARP's configuration, we rely on ifconfig(8). The
CARP-specific commands advbase and advskew deal with the interval between CARP
advertisements. The formula (in seconds) is advskew divided by 256, then added
to advbase. advbase can be used to decrease network traffic or allow longer
latency before a backup host takes over; advskew lets you control which host
will be master without much delaying failover (should that be required).

Next, pass sets a password, and vhid sets the virtual host identifier number
of the CARP group. You need to assign a unique number for each CARP group,
even if (for load balancing purposes) they share the same IP address. CARP is
limited to 255 groups.

Finally, carpdev specifies which physical interface belongs to this particular
CARP group. By default, whichever interface has an IP address in the same
subnet assigned to the CARP interface will be used.

Let's put all these settings together in a basic configuration. Let's say
you're deploying two identically configured Web servers, rachael (192.168.0.5)
and pris (192.168.0.6), to replace an older system that was at 192.168.0.7.
The commands:

    rachael# ifconfig carp0 create
    rachael# ifconfig carp0 vhid 1 pass tyrell carpdev fxp0 \
        192.168.0.7 netmask 255.255.255.0

create the carp0 interface and give it a vhid of 1, a password of tyrell, and
the IP address 192.168.0.7 with mask 255.255.255.0. Assign fxp0 as the member
interface. To make it permanent across reboots, you can create an /etc/
hostname.carp0 file that looks like this:

    inet 192.168.0.7 255.255.255.0 192.168.0.255 vhid 1 pass tyrell carpdev fxp0

Note that the broadcast address is specified in that line, in addition to the
vhid and the password. Failing to do this is a common cause of errors, as it
is needed as a place holder.

Do the same on pris. Whichever system brings the CARP interface up first will
be master (assuming that preempt is disabled; the opposite is true when
preempt is enabled).

But let's say you're not deploying from scratch. Rachael was already in place
at the address 192.168.0.7. How do you work around that? Fortunately, CARP can
deal with this situation. You simply assign the address to the CARP interface
and leave the physical interface specified by the `carpdev' keyword without an
IP address. However, it tends to be cleaner to have an IP for each system--it
makes individual monitoring and access much simpler.

Let's add another layer of complexity; we want rachael to stay master when
possible. There are several reasons we might want this: hardware differences,
simple prejudice, "if this system isn't master, there's a problem," or knowing
the default master without doing scripting to parse and email the output of
ifconfig.

On rachael, we'll use the sysctl we created above, then edit /etc/sysctl.conf
to make it permanent.

    rachael# sysctl net.inet.carp.preempt=1

We'll do configuration on pris, too:

    pris# ifconfig carp0 advskew 100

This slightly delays pris's advertisements, meaning rachael will be master
when alive.

Note that if you are using PF on a CARP'd computer, you must pass "proto carp"
on all involved interfaces, with a line similar to:

    pass on fxp0 proto carp keep state

6.11.3 - Load balancing

Flash forward a few months. Our company of the previous example has grown to
the point where a single internal Web server is just barely managing the load.
What to do? CARP to the rescue. It's time to try load balancing. Create a new
CARP interface and group on rachael:

    rachael# ifconfig carp1 create
    rachael# ifconfig carp1 vhid 2 advskew 100 pass bryant carpdev fxp0 \
        192.168.0.7 netmask 255.255.255.0

On pris, we'll create the new group and interface as well, then set the
"preempt" sysctl:

    pris# ifconfig carp1 create
    pris# ifconfig carp1 vhid 2 pass bryant carpdev fxp0 \
        192.168.0.7 netmask 255.255.255.0
    pris# sysctl net.inet.carp.preempt=1

Now we have two CARP groups with the same IP address. Each group is skewed
toward a different host, which means rachael will stay master of the original
group, but pris will take over the new one.

While these examples are for a two-machine cluster, the same principles apply
to more systems. Please note, however, that it's not expected that you will
achieve perfect 50/50 distribution between the two machines--CARP uses a hash
of the originating IP address to determine which system handles the request,
rather than by load.

6.11.4 - More Information on CARP

  * carp(4)
  * ifconfig(8)
  * sysctl(8)
  * sysctl(3)
  * Firewall Failover with pfsync and CARP by Ryan McBride

6.12 - Using OpenNTPD

Accurate time is important for many computer applications. However, many
people have noticed that their $5 watch can keep better time than their $2000
computer. In addition to knowing what time it is, it is also often important
to synchronize computers so that they all agree on what time it is. For some
time, ntp.org has produced a Network Time Protocol (RFC1305, RFC2030)
application, available through ports, which can be used to synchronize clocks
on computers over the Internet. However, it is a nontrivial program to set up,
difficult code to audit, and has a large memory requirement. In short, it
fills an important role for some people, but it is far from a solution for
all.

OpenNTPD is an attempt to resolve some of these problems, making a
trivial-to-administer, safe and simple NTP compatible way to have accurate
time on your computer. OpenBSD's ntpd(8) is controlled with an easy to
understand configuration file, /etc/ntpd.conf.

Simply activating ntpd(8) through rc.conf.local will result in your computer's
clock slowly moving towards, then keeping itself synchronized to, the
pool.ntp.org servers, a collection of publicly available time servers. Once
your clock is accurately set, ntpd will hold it at a high degree of accuracy,
however, if your clock is more than a few minutes off, it is highly
recommended that you bring it close to accurate initially, as it may take days
or weeks to bring a very-off clock to sync. You can do this using the "-s"
option of ntpd(8) or any other way to accurately set your system clock.

6.12.1 - "But OpenNTPD isn't as accurate as the ntp.org daemon!"

That may be true. That is not OpenNTPD's design goal, it is intended to be
free, simple, reliable and secure. If you really need microsecond precision
more than the benefits of OpenNTPD, feel free to use ntp.org's ntpd, as it
will remain available through ports and packages. There is no plan or desire
to have OpenNTPD bloated with every imaginable feature.

6.12.2 - "Someone has claimed that OpenNTPD is 'harmful'!"

Some people have not understood the goals of OpenNTPD -- a simple, secure and
easy to maintain way to keep your computer's clock accurate. If accurate time
keeping is important, a number of users have reported better results from
OpenNTPD than from ntp.org's ntpd. If security is important, OpenNTPD's code
is much more readable (and thus, auditable) and was written using native
OpenBSD function calls like strlcpy, rather than more portable functions like
strcpy, and written to be secure from the beginning, not "made secure later".
If having more people using time synchronization is valuable, OpenNTPD makes
it much easier for larger numbers of people to use it. If this is "harmful",
we are all for it.

There are applications where the ntp.org ntpd is more appropriate; however it
is felt that for a large majority of the users, OpenNTPD is more than
sufficient.

A more complete response to this by one of the maintainers of OpenNTPD can be
read here.

6.12.3 - Why can't my other machines synchronize to OpenNTPD?

ntpd(8) does not listen on any address by default. So in order to use it as a
server, you have to uncomment the "#listen on *" line in /etc/ntpd.conf and
restart the ntpd(8) daemon. Of course, if you wish it to listen on a
particular IP address rather than all available addresses and interfaces,
replace the "*" with the desired address.

When you have ntpd(8) listening, it may happen that other machines still can't
synchronize to it! A freshly started ntpd(8) daemon (for example, if you just
restarted it after modifying ntpd.conf) refuses to serve time information to
other clients until it adjusts its own clock to a reasonable level of
stability first. When ntpd(8) considers its own time information stable, it
announces it by a "clock now synced" message in /var/log/daemon. Even if the
system clock is pretty accurate in the beginning, it can take up to 10 minutes
to get in sync, and hours or days if the clock is not accurately set at the
start.

6.13 - What are my wireless networking options?

OpenBSD has support for a number of wireless chipsets:

  * acx(4) TI ACX100/ACX111. ^(AP)
  * an(4) Aironet Communications 4500/4800.
  * ath(4) driver for Atheros 802.11a/b/g. ^(AP)
  * athn(4) driver for Atheros 802.11/a/g/n devices. ^(AP)
  * atu(4) Atmel AT76C50x USB 802.11b
  * atw(4) ADMtek ADM8211.
  * bwi(4) Broadcom AirForce 802.11b/g
  * cnwi(4) Xircom CreditCard Netwave
  * ipw(4) Intel PRO/Wireless 2100 802.11b.
  * iwi(4) Intel PRO/Wireless 2200BG/2225BG/2915ABG 802.11a/b/g.
  * iwm(4) Intel Wireless 7260/7265/3160 802.11a/ac/b/g/n.
  * iwn(4) Intel WiFi Link 4965/5100/5300 802.11a/b/g/Draft-N wireless.
  * malo(4) Marvell Libertas 802.11b/g
  * otus(4) Atheros USB 802.11a/g/n
  * pgt(4) Conexant/Intersil Prism GT Full-MAC 802.11a/b/g. ^(AP)
  * ral(4) and ural(4) [USB] Ralink Technology RT25x0 802.11a/b/g. ^(AP)
  * rsu(4) Realtek RTL8188SU/RTL8192SU USB 802.11b/g/n
  * rtw(4) Realtek 8180 802.11b. ^(AP)
  * rum(4) Ralink Technology RT2501USB. ^(AP)
  * run(4) Ralink Technology USB 802.11a/b/g/Draft-N
  * uath(4) Atheros USB 802.11a/b/g
  * upgt(4) Conexant/Intersil PrismGT SoftMAC USB 802.11b/g
  * urtw(4) Realtek RTL8187L USB 802.11b/g
  * urtwn(4) Realtek RTL8188CU/RTL8192CU USB 802.11b/g/n
  * wi(4) Prism2/2.5/3. ^(AP)
  * wpi(4) Intel PRO/Wireless 3945ABG.
  * zyd(4) ZyDAS ZD1211/ZD1211B USB 802.11b/g

^(AP) indicates card can be used as an access point.

Adapters based on these chips can be used much like any other network adapter
to connect an OpenBSD system to an existing wireless network, configured using
the standard ifconfig(8) (please see the manual pages for precise details).
Some of these cards can also be used in the "Host-Based Access Point" mode,
permitting them to be made into the wireless access point for your network as
part of your firewall.

Note that in order to use some of these cards, you will need to acquire the
firmware files, which the manufacturers refuse to allow free distribution of,
so they can not be included with OpenBSD. When possible, the man pages linked
above include contact information so you can contact the right people at the
manufacturers to let them know what you feel about this, or to let them know
what other product you have purchased instead.

Another option to consider for using your OpenBSD-based firewall to provide
wireless access is to use a conventional NIC and an external bridging Access
Point. This has the added advantage of letting you easily position the antenna
where it is most effective, which is often not directly on the back of your
firewall.

Configuring your wireless adapter

Your wireless adapter can be configured through a hostname.if(5) file as other
network adapters are, but as they have more options, they will often be more
complicated.

An example of a wireless hostname file might be:

    nwid puffyuberalles
    wpakey puffyguffy
    dhcp

or

    inet 10.0.0.157 255.255.255.0
    nwid puffyuberalles
    wpakey puffyguffy

Note that the dhcp should be AFTER the other configuration lines, as the
network adapter will not be able to request the DHCP until it is configured.

trunk(4)ing your wireless adapter

Many laptops have both a wireless and a hard-wired adapter. Sometimes, you may
be directly connected to your high speed network and want the full performance
of the wire, other times, you will be using the wireless. You probably don't
want to reconfigure your machine each time you switch locations.

You COULD set up both interfaces with DHCP, but then you would have to wait
for the unused interface to time out while booting, plus things would be a
little confusing if you had both resources available, and switching between
the two resources would be a bit annoying.

Using a trunk(4) device may simplify your life. trunk(4)s are virtual
interfaces made up of one or more other network interfaces. In this case, we
will use a laptop with a wired bge0 and a wireless iwn0 interface. Using these
two interfaces we will build an interface, trunk0, then use DHCP to get an IP
address for this virtual interface. If we have a cable available, we want to
use it, but if not we want to use the wireless interface.

To do this, we first configure the two physical ports. As we are just
assigning them to a combined trunk0 interface, we won't do much of anything
with the wired interface other than activate it:

    # cat /etc/hostname.bge0
    up

The wireless interface, however, needs a bit more configuration. It will need
to attach to our wireless WPA-protected network:

    # cat /etc/hostname.iwn0
    nwid puffynet
    wpakey mysecretkey
    up

Now, our trunk interface is defined like this:

    # cat /etc/hostname.trunk0
    trunkproto failover trunkport bge0
    trunkport iwn0
    dhcp

The trunk is set up to be in "failover" mode, so either interface can be used,
but if both are available, it will prefer the bge0 port, since that is the
first added to the trunk device.

6.14 - How can I do equal-cost multipath routing?

Equal-cost multipath routing refers to having multiple routes in the routing
table for the same network, such as the default route, 0.0.0.0/0. When the
kernel is doing a route lookup to determine where to send packets destined to
that network, it can choose from any of the equal-cost routes. In most
scenarios, multipath routing is used to provide redundant uplink connections,
e.g., redundant connections to the Internet.

The route(8) command is used to add/change/delete routes in the routing table.
The -mpath argument is used when adding multipath routes.

    # route add -mpath default 10.130.128.1
    # route add -mpath default 10.132.0.1

Verify the routes:

    # netstat -rnf inet | grep default
    default     10.130.128.1      UGS       2      134      -     fxp1
    default     10.132.0.1        UGS       0      172      -     fxp2

In this example we can see that one default route points to 10.130.128.1 which
is accessible via the fxp1 interface, and the other points to 10.132.0.1 which
is accessible via fxp2.

Since the mygate(5) file does not yet support multipath default routes, the
above commands should be added to the bottom of the hostname.if(5) files for
the fxp1 and fxp2 interfaces. The /etc/mygate file should then be deleted.

/etc/hostname.fxp1
    !route add -mpath default 10.130.128.1
/etc/hostname.fxp2
    !route add -mpath default 10.132.0.1

Lastly, don't forget to activate the use of multipath routes by enabling the
proper sysctl(3) variable.

    # sysctl net.inet.ip.multipath=1
    # sysctl net.inet6.ip6.multipath=1

Be sure to edit sysctl.conf(5) to make the changes permanent.

Now try a traceroute to different destinations. The kernel will load balance
the traffic over each multipath route.

    # traceroute -n 154.11.0.4
    traceroute to 154.11.0.4 (154.11.0.4), 64 hops max, 60 byte packets
     1  10.130.128.1  19.337 ms  18.194 ms  18.849 ms
     2  154.11.95.170  17.642 ms  18.176 ms  17.731 ms
     3  154.11.5.33  110.486 ms  19.478 ms  100.949 ms
     4  154.11.0.4  32.772 ms  33.534 ms  32.835 ms

    # traceroute -n 154.11.0.5
    traceroute to 154.11.0.5 (154.11.0.5), 64 hops max, 60 byte packets
     1  10.132.0.1  14.175 ms  14.503 ms  14.58 ms
     2  154.11.95.38  13.664 ms  13.962 ms  13.445 ms
     3  208.38.16.151  13.964 ms  13.347 ms  13.788 ms
     4  154.11.0.5  30.177 ms  30.95 ms  30.593 ms

For more information about how the route is chosen, please refer to RFC2992,
"Analysis of an Equal-Cost Multi-Path Algorithm".

It's worth noting that if an interface used by a multipath route goes down
(i.e., loses carrier), the kernel will still try to forward packets using the
route that points to that interface. This traffic will of course be blackholed
and end up going nowhere. It's highly recommended to use ifstated(8) to check
for unavailable interfaces and adjust the routing table accordingly.

------------------------------------------------------------------------------

==============================================================================

7 - Keyboard and Display Controls

------------------------------------------------------------------------------

Table of Contents

  * 7.1 - How do I remap the keyboard? (wscons)
  * 7.2 - Is there console mouse support in OpenBSD?
  * 7.3 - Accessing the console scrollback buffer. (some amd64, i386, Alpha)
  * 7.4 - How do I switch consoles? (amd64, i386, Zaurus, some Alpha)
  * 7.5 - How can I use a console resolution of 80x50? (some amd64, i386,
    Alpha)
  * 7.6 - How do I use a serial console?
  * 7.7 - How do I blank my console? (wscons)
  * 7.8 - EVERYTHING I TYPE AT THE LOGIN IS IN CAPS!
  * 7.9 - What is tmux(1)?

------------------------------------------------------------------------------

7.1 - How do I remap the keyboard? (wscons)

Most modern OpenBSD platforms use the wscons(4) console driver.

With wscons(4) consoles, most options can be controlled using the wsconsctl(8)
utility. For example, to change keymappings with wsconsctl(8) one would
execute the following:

    # wsconsctl keyboard.encoding=uk

In the next example, we will remap "Caps Lock" to be "Control L" (the left
control key):

    # wsconsctl keyboard.map+="keysym Caps_Lock = Control_L"

7.2 - Is there console mouse support in OpenBSD?

For the alpha, amd64 and i386 platforms, OpenBSD provides wsmoused(8), a port
of FreeBSD's moused(8). It can be enabled automatically at startup by copying
and editing the appropriate line from rc.conf to rc.conf.local(8).

7.3 - Accessing the Console Scrollback Buffer (some amd64, i386, Alpha)

On a few platforms and hardware combinations, OpenBSD provides a console
scrollback buffer. This allows you to see information that has already
scrolled past your screen. To move up and down in the buffer, simply use the
key combinations [SHIFT]+[PGUP] and [SHIFT]+[PGDN].

The default scrollback buffer, or the number of pages that you can move up and
view, is 8. This is a feature of the vga(4) driver, so it will not work
without a VGA card on any platform (many Alpha systems have TGA video), or on
hardware that uses drm(4).

Due to space limitations, the install kernels do not provide the scrollback
function. Switching consoles will clear the scrollback buffer.

Users needing this functionality may wish to use tmux instead, which provides
scroll back and many other functions on all platforms.

7.4 - How do I switch consoles? (amd64, i386, Zaurus, some Alpha)

On amd64, i386 and Alpha systems with vga(4) cards, OpenBSD provides six
virtual terminals by default, /dev/ttyC0 through /dev/ttyC5. ttyC4 is reserved
for use by the X Window system, leaving five text consoles. You can switch
between them using [CTRL]+[ALT]+[F1], [CTRL]+[ALT]+[F2], [CTRL]+[ALT]+[F3],
[CTRL]+[ALT]+[F4] and [CTRL]+[ALT]+[F6].

The X environment uses ttyC4, [CTRL]+[ALT]+[F5]. When using X, the [CTRL]+
[ALT]+[Fn] keys will take you to the text screens; [CTRL]+[ALT]+[F5] will take
you back to the graphical environment.

If you wish to have more than the default number of virtual consoles, use the
wsconscfg(8) command to create screens for ttyC6, ttyC7 and above. For
example:

    wsconscfg -t 80x25 6

will create a virtual terminal for ttyC6, accessed by [CTRL]+[ALT]+[F7]. Don't
forget to add this command to your rc.local(8) file if you want the extra
screen the next time you boot the computer.

Note that you will not get a "login:" prompt on the newly-created virtual
console unless you set it to "on" in /etc/ttys(5), and either reboot or send
init(8) a HUP signal using kill(1).

On the Zaurus, two virtual terminals (/dev/ttyC0 and /dev/ttyC1) are available
by default, accessible with [ALT]+[CALENDAR] and [ALT]+[ADDRESS] (The [ALT]
key is the one right of the left [CTRL] key).

7.5 - How do I use a console resolution of 80x50? (some amd64, i386, Alpha)

amd64, i386, and Alpha users with VGA but non-drm(4) display adapters normally
get a console screen of 25 lines of 80 characters. However, many VGA video
cards are capable of displaying a higher text resolution of 50 lines of 80
characters.

First, a font that supports the desired resolution must be loaded using the
wsfontload(8) command. The standard 80x25 text screen uses 8x16 pixel fonts;
to double the number of lines we will have to use 8x8 pixel fonts.

After that, we will have to delete and recreate a virtual console at the
desired screen resolution, using the wsconscfg(8) command.

This can be done automatically at boot by adding the following lines to the
end of your rc.local(8) file:

    wsfontload -h 8 -e ibm /usr/share/misc/pcvtfonts/vt220l.808
    wsconscfg -dF 5
    wsconscfg -t 80x50 5

As with any modification to your system configuration, it is recommended you
spend some time with the man pages to understand what these commands do.

The first line above loads the 8x8 font. The second line deletes screen 5
(which would be accessed by [CTRL]+[ALT]+[F6]). The third line creates a new
screen 5 with 50 lines of 80 characters each. If you do this, you will see
your primary screen, and the other three default virtual consoles, come up in
the standard 80x25 mode, but a new screen 5 at 80x50 accessible through [CTRL]
+[ALT]+[F6].

Remember that [CTRL]+[ALT]+[F1] is screen 0 (ttyC0). If you wish to alter
other screens, simply repeat the delete and add screen steps for whichever
screens you want running at the 80x50 resolution.

You should avoid changing screen 4 (ttyC4, [CTRL]+[ALT]+[F5]), which is used
by X as a graphical screen. It is also not possible to change the resolution
of the primary console device (i.e., ttyC0).

As one might expect, all these commands can be run as root at the command
prompt.

Note: this will not work on all video cards. Unfortunately, not all video
cards support the uploaded fonts that wscons(4) requires to achieve the 80x50
text mode. In these cases, you might wish to consider running X. Cards
supported by the drm(4) driver will have a higher resolution anyway, but can
not use these uploaded fonts.

7.6 - How do I use a serial console?

There are many reasons you may wish to use a serial console for your OpenBSD
system:

  * Recording console output (for documentation).
  * Remote management.
  * Easier maintenance of a large quantity of machines
  * Providing a useful dmesg from machines which might otherwise be difficult
    to get one from.
  * Providing an accurate "trace" and "ps" output if your system crashes so
    developers can have a chance to fix the problem.

OpenBSD supports serial console on most platforms, however details vary
greatly between platforms.

Note that serial interfacing is NOT a trivial task -- you will often need
unusual cables, and ports are not standardized between machines, in some
cases, not even consistent on one machine. It is assumed you know how to
select the appropriate cable to go between your computer and the device acting
as your serial terminal. A full tutorial on serial interfacing is beyond the
scope of this article, however, we offer one hint: just because the ends plug
in doesn't mean it will work.

/etc/ttys change

There are two parts to getting a functional serial console on an OpenBSD
system. First, you must have OpenBSD use your serial port as a console for
status and single user mode. This part is very platform dependent. Second, you
must enable the serial port to be used as an interactive terminal, so a user
can log into it when running multi-user. This part is fairly similar between
platforms, and is detailed here.

Terminal sessions are controlled by the /etc/ttys file. Before OpenBSD will
give you a "login:" prompt at a device, it has to be enabled in /etc/ttys,
after all, there are other uses for a serial port other than for a terminal.
In platforms which typically have an attached keyboard and screen as a
console, the serial terminal is typically disabled by default. We'll use the
i386 platform as an example. In this case, you must edit the line that reads:

     tty00   "/usr/libexec/getty std.9600"   unknown off

to read something like:

     tty00   "/usr/libexec/getty std.9600"   vt220   on secure

Here, tty00 is the serial port we are using as a console. vt220 is the termcap
(5) entry that matches YOUR terminal (other likely options might include
vt100, xterm, etc.). The "on" activates the getty for that serial port so that
a "login:" prompt will be presented, the "secure" permits a root (uid 0) login
at this console (which may or may not be what you desire), and the "9600" is
the terminal baud rate. Resist the urge to crank the baud rate up to the
maximum your hardware can support, as you are more likely to create problems
than benefit. Most systems have a "default" speed (supported by default by the
boot ROM and/or the boot loader, often 9600), use this unless you have real
reason to use something different.

Note that you can use a serial console for install without doing this step, as
the system is running in single user mode, and not using getty for login.

On some platforms and some configurations, you must bring the system up in
single user mode to make this change if a serial console is all you have
available.

amd64 and i386

To direct the boot process to use the serial port as a console, create or edit
your /etc/boot.conf file to include the line:

     set tty com0

to use the first serial port as your console. The default baud rate is
9600bps, this can be changed with a /etc/boot.conf line using the stty option.
This file is put on your boot drive, which could also be your install floppy,
or the command can be entered at the boot> prompt from the OpenBSD
second-stage boot loader for a one-time (or first time) serial console usage.

amd64 and i386 notes:

  * OpenBSD numbers the serial ports starting at tty00, DOS/Windows labels
    them starting at COM1. So, keep in mind tty02 is COM3, not COM2.
  * Some systems may be able to operate without a video card in the machine,
    but certainly not all -- many systems consider this an error condition.
    Some machines will even refuse to work easily without a keyboard attached.
  * Some systems are capable of redirecting all BIOS keyboard and screen
    activity to a serial port through a configuration option, so the machine
    can be completely maintained through the serial port. Your results may
    vary -- when using this feature, some BIOSs may prevent the bootloader
    from seeing the serial port, and thus, the kernel will not be told to use
    it. Some BIOSs have an option to "Continue Console Redirection after POST"
    (Power On Self Test), this should be set to "OFF", so the boot loader and
    the kernel can handle their own console. Unfortunately, this feature is
    not universal.
  * PC compatible computers are not designed to be run from a serial console,
    unlike some other platforms. Even those systems that support a serial
    console usually have it as a BIOS configuration option -- and should the
    configuration information get corrupted, you will find the system looking
    for a standard monitor and keyboard again. You generally must have some
    way to get a monitor and keyboard to your amd64 and i386 systems in an
    emergency.
  * You will need to edit /etc/ttys as above.

SPARC and UltraSPARC

These machines are designed to be completely maintainable with a serial
console. Simply remove the keyboard from the machine, and the system will run
serial.

SPARC and UltraSPARC notes

  * The serial ports on a SPARC are labeled ttya, ttyb, etc.
  * Unlike some other platforms, it is not necessary to make any changes to /
    etc/ttys to use a serial console.
  * The SPARC/UltraSPARC systems interpret a BREAK signal on the console port
    to be the same as a STOP-A command, and kicks the system back to the Forth
    prompt, stopping any application and operating system at that point. This
    is handy when desired, but unfortunately, some serial terminals at
    power-down and some RS-232 switching devices send something the computer
    interprets as a break signal, halting the machine. Test before you go into
    production.
  * If you have a keyboard and monitor attached, you can still force the
    serial console to be used instead by using the following commands at the
    ok prompt:

         ok setenv input-device ttya
         ok setenv output-device ttya
         ok reset


    If the keyboard and monitor (ttyC0) are active in /etc/ttys (above), you
    can use the keyboard and monitor in X.

MacPPC

The MacPPC machines are configured for a serial console through OpenFirmware.
Use the commands:

     ok setenv output-device scca
     ok setenv input-device scca
     ok reset-all


Set your serial console to 57600bps, 8N1.

MacPPC notes

  * Unfortunately, serial console is not directly possible on most MacPPCs.
    While most of these machines do have serial hardware, it isn't accessible
    outside the machine. Fortunately, a few companies offer add-on devices for
    several Macintosh models which will make this port available for use as a
    serial console (or other uses). Use your favorite search engine and look
    for "Macintosh internal serial port".
  * You will have to change tty00 in /etc/ttys to on and set the speed to
    57600 instead of the default of 9600 as detailed above in single user mode
    before booting multi-user and having the serial console functional.

7.7 - How do I blank my console? (wscons)

If you wish to blank your console after a period of inactivity without using
X, you can alter the following wscons(4) variables:

  * display.vblank set to on will disable the vertical sync pulse, which will
    cause many monitors to go into an "energy saver" mode. This will require
    more time to bring the screen back on, but will reduce energy consumption
    and heat production of newer monitors. When set to off, the display will
    blank, but the monitor will still be receiving the normal horizontal and
    vertical sync pulses, so the unblanking will be almost instant.
  * display.screen_off determines the blanking time in thousandths of a
    second, i.e., 60000 would set the timeout to one minute.
  * display.kbdact determines if keyboard activity will restore the blanked
    screen. Usually, this is desirable.
  * display.outact determines if screen output will restore the blanked
    screen.

You can set these variables at the command line using the wsconsctl(8)
command:

     # wsconsctl display.screen_off=60000
     display.screen_off -> 60000

or set them permanently by editing /etc/wsconsctl.conf so these changes take
place at next boot:

     display.vblank=on               # enable vertical sync blank
     display.screen_off=600000       # set screen blank timeout to 10 minutes
     display.kbdact=on               # Restore screen on keyboard input
     display.outact=off              # Restore screen on display output

The blanker is activated when either display.kbdact or display.outact is set
to "on". Yes, one of those two must be "off".

7.8 - EVERYTHING I TYPE AT THE LOGIN PROMPT IS IN CAPS!

This is a feature, not a bug, actually.

Virtually all Unix commands and user names are entered using all lowercase.
However, some very old terminals were only capable of uppercase characters,
making them difficult, if not impossible, to use with Unix. As a workaround,
if you entered your user name in all uppercase, getty(8) would assume your
terminal was "lowercase challenged", and simply interpret everything you type
as lowercase, while echoing it as uppercase. If you have a mixed-case or
uppercase password, this will make login impossible.

Hitting CTRL-D at the login prompt will cause getty(8) to terminate, and init
(8) will relaunch a new one, which will accept uppercase and lowercase
properly.

7.9 - What is tmux?

For those familiar with the "screen" program, provided as a package, or window
(1) which used to be in base, it may be easiest to answer this by saying that
tmux(1) performs many of the functions as screen and window, with many
additional features.

For those not familiar with these programs, tmux is a terminal multiplexer.
This is a program which allows a number of other processes to share the same
screen for input and output. In tmux, such a collection of programs is known
as a session, with each program contained in a tmux window.

In addition to sharing the terminal, tmux lets you detach a session and its
windows from the screen, leave them continue running in the background, and
later reattach them to the same or to a different screen. A session may be
detached manually or through an unexpected event such as network
disconnection; in either case, the programs survive and continue running as
normal.

tmux also has many other features such as splitting a single window into
multiple sections (known as panes), a history of text printed in each window,
copying and pasting text between windows, configurable key bindings, and
terminal locking. Take a look at the tmux(1) man page for further information.

How do I use tmux?

The first step is to run tmux:

    $ tmux

This starts a new tmux with a single new session (called "0") and creates a
client displaying it on screen. Most of the screen will show a window
containing a shell prompt, and you will notice the last line is occupied by a
status line. This shows the name of the session in square brackets on the
left, the window title (normally empty for shells) and the time on the right,
and a summary of the current open windows in the middle. In your new session,
the currently open windows will contain one entry, for example:

    0:ksh*

A brief aside regarding terminals: on OpenBSD, applications are made aware of
the capabilities of the terminal by the TERM environment variable. This is set
to the name of an entry in the terminfo(5) database and tells programs that
the terminal, for example, supports colour, or has the ability to insert
lines, or many other things. An important thing to note is that the "xterm"
entry in the database does not include colour, so tmux will not use colour in
xterm by default, TERM should be set to "xterm-xfree86" instead if colour is
desired (the "XTerm*termName" X resource may be set in .Xdefaults to use this
for all xterms). It is also important that TERM in shells started inside tmux
is set to "screen" or programs run from them may not display correctly - tmux
will set this itself, but care should be taken not to override it in shell
startup files.

Returning to the status line, the number "0" is the window index, "ksh" the
name of the window, and the "*" indicates this is the current window displayed
above the status line. Any typing is passed on to the shell and any output
displayed. For example, if you start "top":

    $ top

It will run as normal, occupying the part of the screen above the status line.
You may also notice that the window name in the status line has changed from
"ksh" to "top" - tmux renames windows to reflect the program currently running
in them.

Now, let's say you want to detach tmux from the screen and return to the
original shell from which you started it. A tmux session may be detached by
first pressing the Ctrl and b keys together, and then the d key. The Ctrl-b
key combination (shortened in tmux and its man page to "C-b") is known as the
prefix key and is used to tell tmux that the next key pressed is an
instruction that it should perform some action, rather than passing the key
through to the program in the window.

After pressing Ctrl-b d and returning to the shell prompt, reattach the tmux
session using the "attach" command:

    $ tmux attach

The tmux session will reappear, with the status line and "top" still happily
running. (If you instead run tmux again without arguments, a second session
will be created, named "1".)

Next, let's create a second window. This is done using the "c" key: press the
prefix key, Ctrl-b, then the "c" key. A new window will be created and again a
shell prompt displayed on screen. The status line will be updated to show the
new window:

    0:top- 1:ksh*

The "-" after "top" shows the previously current window (the last window).
Pressing Ctrl-b c again creates another new shell:

    0:top  1:ksh- 2:ksh*

There are several commands for moving between windows. From window 2, you can
move the previous window, number 1, by typing Ctrl-b p. Ctrl-b n moves to the
next window: in this case, there is no window 3 so the current window wraps to
window 0. You can also press Ctrl-b w to get an interactive menu of open
windows, Ctrl-b l to move to the last window (the one marked with "-"), or
Ctrl-b 0 to move to window 0, Ctrl-b 1 for window 1 and so on up to Ctrl-b 9
for window 9. So, to get back to "top" in window 0, you can press Ctrl-b 0 to
go directly to window 0, Ctrl-b p twice to move via window 1, Ctrl-b n to wrap
from window 2 to window 0, or press Ctrl-b w and select window 0 from the
list.

Sometimes you may want to create a window running a program directly, without
using a shell first. This can be done from the tmux command prompt. Pressing
the Ctrl-b : key sequence changes the status line to display a ":" prompt at
which commands may be entered. All the tmux commands are documented in the man
page. In this case the "new-window" command is needed. Many commands have
shorthand aliases which may be used instead of typing the full name; for
"new-window" this is "neww". So, to create a new window running tetris(6),
type:

    neww tetris

The new window will close when tetris exits, or may be forcibly killed using
the Ctrl-b & key binding. This will first prompt for confirmation and if
given, close the window and terminate the program running in it.

Another common requirement is renaming a window. This can be done with the
Ctrl-b , key binding. The status line will change to display a "
(rename-window)" prompt at which the new name may be entered. Renaming a
window turns off automatic renaming for that window, to reenable that feature,
press Ctrl-b : to get to the command prompt and enter the following (more on
what this means is in the next section):

    setw -u automatic-rename

One other important key is worth remembering: Ctrl-b ?. This will show a list
of all the tmux keys and the commands they execute. For example, Ctrl-b ?
shows that the c key is bound to the "new-window" command and the n key to the
"next-window" command.

Configuring tmux

Many users want to customise the way tmux looks or behaves. This is done
through the configuration file, ~/.tmux.conf. This file is a list of tmux
commands which are executed when tmux is initially started, before the first
session is created. All tmux commands are documented in the man page, but a
few common examples you might want to put in your configuration file are
discussed below.

The most common requirement is setting options. There are two types of option
in tmux: session options and window options. Session options control the
behaviour of a session and window options of an individual window. For both
there is a set of global options. When tmux comes to decide on an options
value for a particular session or window, it looks first at the options local
to that window; if the option has not been set, the global option value is
used.

Session options are set with the "set-option" (alias "set") command and window
options with the "set-window-option" command (alias "setw"). To set a global
option, use the "-g" flag, if this is left out the option is set for the
current window or session. These commands also accept a few other flags, such
as "-u" to unset a local option and allow a window or session to inherit the
global option again.

In the configuration file, it is usual to set global options. Let's look at
some examples customising the status line:

    set -g status-bg blue
    set -g status-right '#(sysctl vm.loadavg)'
    setw -g window-status-current-attr underscore

Putting these three commands in .tmux.conf and restarting tmux changes the
status line background to blue, puts the current load average on the right
side and underlines the current window. The status line may be turned off
entirely with:

    set -g status off

There are a large number of other options; another handy one is changing to vi
(1)-style key bindings at the command prompt and in the window list and other
tmux interactive modes:

    set -g status-keys vi
    setw -g mode-keys vi

The current options and their values may be listed with the "show-options" and
"show-window-options" commands. Like the set commands these accept "-g" to
show the global options.

Another common task for the configuration file is adding or modifying tmux
command key bindings, that is the commands that are executed after you press
Ctrl-b with another key. These are added or changed with the "bind-key"
command (alias "bind") and removed with the "unbind-key" command (alias
"unbind"). Two examples of using "bind-key" are:

    bind C-d detach
    bind / neww 'exec top'

The first line creates a binding for Ctrl-b Ctrl-d to detach tmux, the same as
the default Ctrl-b d, and the second binds Ctrl-b / to create a new window
running top.

Many people like to use a different prefix key than Ctrl-b. This can be
achieved using both the "set-option" and key binding commands to alter the
prefix key option and change so that pressing the prefix twice continues to
pass the same key through to the window. To change the prefix key to Ctrl-a:

    set -g prefix C-a
    unbind C-b
    bind C-a send-prefix

The final useful thing to do in the configuration file is to create an initial
set of windows when tmux starts. This is slightly more complicated than the
previous examples. In tmux, a session cannot have no windows, and you cannot
create windows without a session. So, to have windows created by the
configuration file you must first create a session to contain them. For
example (note that "new" is the alias for the "new-session" command):

    new -d 'exec top'
    neww -d
    neww -d

These commands create a new session with "top" running in the first window,
then create two additional windows. The "-d" flags instruct tmux not to try to
attach the new session or to make the new windows the current window. Before
putting these lines into .tmux.conf, there is one other issue. When executed
without arguments, tmux runs the "new-session" command, so when starting tmux
with "tmux" from the shell, the configuration file tells tmux to create one
session, then the command from the shell tells it to create another, so you
end up with two sessions. To avoid this, tmux should be started with "tmux
attach" when creating a session from the configuration file - this means it
will create the session from .tmux.conf then immediately attach to it without
creating a second session.

Advanced tmux usage

This section briefly covers some of the more advanced features available in
tmux. See the man page for more information.

In tmux, you can copy and paste text between windows. This is done by copying
the text in copy mode and then pasting it with the paste command. To enter
copy mode, press Ctrl-b [. In copy mode (with the "mode-keys" window option
set to emacs, for vi keys see the man page) the arrow keys may be used to
position the cursor, Ctrl-Space starts the selection and Ctrl-w copies. You
can also use Page Up, Page Down, Ctrl-a and Ctrl-e to move the cursor around.
Press q or Escape to exit copy mode. After that, Ctrl-b ] will paste the
copied text into the current window as if you had typed it directly.

tmux is quite scriptable, and most commands that may be entered from the
command prompt or bound to a key may be executed from the shell. Almost all
tmux commands accept an optional "-t" argument which specifies the session or
window on which to act. For example, this command:

    $ tmux kill-window -t0:1

will kill window 1 in session 0. And:

    $ tmux new-window -tmysession

creates a new window in the session named "mysession". Many commands accept
other arguments, for example the "new-window" command accepts a "-n" option to
give the name of the new window, and "new-session" accepts several arguments
to specify the attributes of the initial window created with the session.
These arguments may naturally be used when a command is bound to a key or
executed from the command prompt as well.

Another useful feature is the ability to split a single window into several
sections, called panes. You can split a window vertically (top to bottom) with
the Ctrl-b " key combination, and horizontally with the Ctrl-b % combination.
A pane can be resized up or down with Ctrl-b Alt-Up and Ctrl-b Alt-Down and
the active pane changed with Ctrl-b o. In addition, a window split in that way
may be changed into one of a number of fixed layouts, which may be cycled
through with Ctrl-b Space.

------------------------------------------------------------------------------

==============================================================================

8 - General Questions

------------------------------------------------------------------------------

Table of Contents

  * 8.1 - I forgot my root password, what do I do now?
  * 8.2 - X won't start, I get lots of error messages
  * 8.3 - Can I use programming language "L" on OpenBSD?
  * 8.4 - What is the ports tree?
  * 8.5 - What are packages?
  * 8.6 - Should I use Ports or Packages?
  * 8.8 - Is there any way to use my floppy drive if it's not attached during
    boot?
  * 8.9 - OpenBSD Bootloader (i386, amd64 specific)
  * 8.10 - Using S/Key on your OpenBSD system
  * 8.12 - What OpenBSD platforms support SMP?
  * 8.13 - I sometimes get Input/output error when trying to use my tty
    devices
  * 8.14 - What web browsers are available for OpenBSD?
  * 8.15 - How do I use the mg editor?
  * 8.16 - ksh(1) does not appear to read my .profile!
  * 8.17 - Why does my /etc/motd file get written over when I modified it?
  * 8.20 - Antialiased and TrueType fonts in X
  * 8.21 - Does OpenBSD support any journaling filesystems?
  * 8.22 - Reverse DNS or Why is it taking so long for me to log in?
  * 8.23 - Why do the OpenBSD web pages not conform to HTML4/XHTML?
  * 8.24 - Why is my clock off by twenty-some seconds?
  * 8.25 - Why is my clock off by several hours?

------------------------------------------------------------------------------

8.1 - I forgot my root password, what do I do now?

The basic process to regain root is to boot into single user mode, mount the
relevant partitions (/ and /usr), run passwd(1) to change the root password.
You can then boot and login normally.

The detailed process:

  * Boot into single user mode. This part of the process varies from platform
    to platform. For amd64 and i386 platforms, the second stage boot loader,
    boot(8), pauses for a few seconds to give you a chance to provide
    parameters to the kernel. This prompt looks like this:

        probing: pc0 com0 com1 apm mem[636k 190M a20=on]
        disk: fd0 hd0+
        >> OpenBSD/i386 BOOT 3.26
        boot>

    At this point, enter "boot -s" to bring the system up in single user mode:

        boot> boot -s

    Most other platforms send parameters to the kernel via the boot ROM.

    Of course the problem before this will probably be getting the system to
    shut down. Most likely, this will involve hitting the reset button or the
    power button. While hardly desirable, there usually isn't any alternative.
    Don't worry too much, OpenBSD's file system is very robust.
  * Mount the partitions. Both "/" and /usr will need to be mounted
    read-write. Assuming they are on separate partitions (as they should be),
    the following will work:

        # fsck -p / && mount -uw /
        # fsck -p /usr && mount /usr

  * Run passwd(1) to change the root password. As you already have root
    privileges (from being in single-user mode), it will not ask you to
    provide your current password.
  * boot into multiuser mode. This can be done by either entering "CTRL-D" to
    resume the normal boot process, or by entering the reboot(8) command.

If this is a non-personal machine, you should probably use doas(1) to give
multiple (trusted) people the ability to execute root commands.

"Wait. That looked too easy! That isn't very secure!" If an attacker has
physical access to your system, they win, regardless of the OS on the
computer. There are ways to force the use of a password on single-user mode
(see ttys(5)), or eliminate the pause on i386/amd64 (see boot.conf), but
practically speaking, getting around those tricks is also pretty easy (One
way: boot floppy or CDROM, edit or replace password file). You can try to
prevent that, but then someone will pull the hard disk out of your computer.
Making your computer difficult to manage properly isn't real security, and if
you don't have the physical machine secured, you have no real security.

Note: many "remote management" systems give most of the functionality of
physical access to the computer, and that needs to be considered. Don't tell
yourself the system is secure if there is a way for an attacker to grab
console, insert a virtual floppy and force a reboot of the machine. They might
as well have physical access to the system. The console management system is
likely not as secure as OpenBSD...

8.2 - X won't start, I get lots of error messages

A common cause for X problems is the machdep.allowaperture sysctl(8) setting.
Since this defaults to being disabled on OpenBSD, this is a fairly likely
cause of the problem.

You need to edit /etc/sysctl.conf and set machdep.allowaperture=2 (or 1,
depending upon your platform). This will allow X to access the aperture
driver, xf86(4), upon the next reboot. It can not be made available after
boot. This can also be set during install if you answer "Y" when you are asked
whether you expect to run the X Window System.

OpenBSD requires that the aperture driver be activated on alpha, amd64, i386,
macppc and sparc64 platforms to control access to the video boards. Other
platforms use a safer way to handle the video system, and do not need this
(and do not have it in their kernel). If you do not anticipate using X on your
system, it is recommended that you not enable the aperture driver.

For more information about configuring and using X on your platform, see the /
usr/X11R6/README file on your installed system.

8.3 - Can I use programming language "L" on OpenBSD?

You will find support for many common programming languages either in the base
system (more specifically in the baseXX.tgz and compXX.tgz file sets), or in
the packages and ports system. It is recommended that you install the required
file set or package containing the specific compiler you want to use, instead
of building it from source. For some compilers, building from source requires
a lot of system resources and is often unneeded unless you have specific needs
or there is no package available.

The following table attempts to give an overview of compilers for different
languages, where you can find them, and whether there are any issues or
limitations with them. Some of these are limited to certain platforms. This
can be seen either by examining a search result through the ports tree, and
noting what is mentioned in "Archs", or by inspecting the port's Makefile
directly. In the latter case, look for lines containing ONLY_FOR_ARCHS,
NOT_FOR_ARCHS, BROKEN, etc.

Note: For ease of use, this article provides an alphabetical list, without
distinguishing between different categories of programming languages. This is
not a comprehensive list of everything that is available or can be used on
OpenBSD. If you feel there are inaccuracies or issues which are not mentioned
here, feel free to report that.

+----------------------------------------------------------------------------+
|Language |Where?     |Notes                                                 |
|---------+-----------+------------------------------------------------------|
|Awk      |base58.tgz,|                                                      |
|         |awk(1)     |                                                      |
|         |-----------+------------------------------------------------------|
|         |lang/gawk  |GNU awk                                               |
|---------+-----------+------------------------------------------------------|
|C, C++   |comp58.tgz,|The C/C++ compilers in the base system have been      |
|         |gcc(1)     |audited and they have several security enhancements   |
|         |           |(e.g. ProPolice) enabled by default. Please see       |
|         |           |gcc-local(1) for details. They will also emit warnings|
|         |           |when using unsafe functions such as sprintf(), strcpy |
|         |           |(), strcat(), tmpnam(), etc. Most platforms use gcc   |
|         |           |4.2.1.                                                |
|         |-----------+------------------------------------------------------|
|         |lang/gcc   |These compilers have not gone through the security    |
|         |devel/llvm |audit and do not contain security enhancements like   |
|         |           |those in the base system. The gcc binaries are renamed|
|         |           |egcc, eg++, etc. to avoid confusion with their        |
|         |           |counterparts in the base system.                      |
|---------+-----------+------------------------------------------------------|
|Caml     |lang/ocaml |Objective Caml                                        |
|---------+-----------+------------------------------------------------------|
|COBOL    |lang/      |                                                      |
|         |open-cobol |                                                      |
|---------+-----------+------------------------------------------------------|
|Erlang   |lang/erlang|                                                      |
|---------+-----------+------------------------------------------------------|
|Fortran  |lang/g77   |Only Fortran 77 support.                              |
|         |-----------+------------------------------------------------------|
|         |lang/gcc   |Fortran 95 is also supported by egfortran in gcc 4.0  |
|         |           |and above. This new compiler is available as a        |
|         |           |subpackage (f95) of gcc.                              |
|---------+-----------+------------------------------------------------------|
|Haskell  |lang/ghc   |                                                      |
|         |-----------+------------------------------------------------------|
|         |lang/nhc98 |                                                      |
|---------+-----------+------------------------------------------------------|
|Java     |devel/jdk  |OpenJDK - 1.7 as a package on amd64 and i386          |
|         |-----------+------------------------------------------------------|
|         |www/       |Browser plugin and web start for OpenJDK.             |
|         |icedtea-web|                                                      |
|         |-----------+------------------------------------------------------|
|         |devel/     |Large IDE; works with OpenJDK.                        |
|         |eclipse    |                                                      |
|         |-----------+------------------------------------------------------|
|         |devel/     |Another IDE; works with OpenJDK.                      |
|         |netbeans   |                                                      |
|---------+-----------+------------------------------------------------------|
|Lisp     |lang/clisp |                                                      |
|---------+-----------+------------------------------------------------------|
|Lua      |lang/lua   |Additional Lua libraries and auxiliary utilities are  |
|         |           |available in the ports tree.                          |
|---------+-----------+------------------------------------------------------|
|Perl     |base58.tgz,|Many Perl modules are available in the ports tree, so |
|         |perl(1)    |search there first before installing modules from     |
|         |           |CPAN.                                                 |
|---------+-----------+------------------------------------------------------|
|Perl 6   |lang/rakudo|                                                      |
|---------+-----------+------------------------------------------------------|
|PHP      |lang/php   |Plenty of subpackages are available for different PHP |
|         |           |modules.                                              |
|---------+-----------+------------------------------------------------------|
|Prolog   |lang/      |GNU Prolog compiler.                                  |
|         |gprolog    |                                                      |
|         |-----------+------------------------------------------------------|
|         |lang/      |SWI-Prolog environment.                               |
|         |swi-prolog |                                                      |
|---------+-----------+------------------------------------------------------|
|Python   |lang/python|Other ports are using Python 2.7 by default.          |
|---------+-----------+------------------------------------------------------|
|Ruby     |lang/ruby  |                                                      |
|---------+-----------+------------------------------------------------------|
|Scheme   |lang/      |                                                      |
|         |chicken    |                                                      |
|         |-----------+------------------------------------------------------|
|         |lang/      |                                                      |
|         |scheme48   |                                                      |
|         |-----------+------------------------------------------------------|
|         |lang/scm   |                                                      |
|         |-----------+------------------------------------------------------|
|         |shells/scsh|                                                      |
|---------+-----------+------------------------------------------------------|
|Smalltalk|lang/squeak|                                                      |
|---------+-----------+------------------------------------------------------|
|Tcl      |lang/tcl   |                                                      |
+----------------------------------------------------------------------------+

Other development tools

Additionally, there are many other development tools available within the base
system or as packages or ports. A few examples:

  * Unix shells: ksh and csh in the base system, many others (e.g. zsh, tcsh)
    in the shells subdirectory of the ports tree.
  * "make" utilities: the traditional BSD make(1) program is in the base
    system, and the ports tree contains other flavors which are required to
    compile some software.
  * Graphical toolkits: many popular graphical toolkits (e.g. GTK+, Tk, Qt,
    wxWidgets, ...) have been ported to OpenBSD. They can be found in the x11
    subdirectory of the ports tree.
  * Version control systems: GNU CVS as used by the OpenBSD project is in the
    base system, and the ports tree contains a few others (git, subversion,
    mercurial, bazaar, fossil, ...).

8.4 - What is the ports tree?

Please see FAQ 15, Working with ports.

8.5 - What are packages?

Please see FAQ 15, Package management.

8.6 - Should I use Ports or Packages?

Please see FAQ 15.

8.8 - Is there any way to use my floppy drive if it's not attached during
boot?

You need to set the kernel to always assume the floppy is attached, even if
not detected during the hardware probe, by setting the 0x20 flag bit on fdc
(4). This can be done by using User Kernel Config or config(8) to alter your
kernel,

    # config -e -f /bsd
    OpenBSD 5.8 (GENERIC) #1066: Sun Aug 16 02:33:00 MDT 2015
        deraadt@@i386.openbsd.org:/usr/src/sys/arch/i386/compile/GENERIC
    Enter 'help' for information
    ukc> change fd*
    254 fd* at fdc0 drive -1 flags 0x0
    change [n] y
    drive [-1] ? ENTER
    flags [0] ? 0x20
    254 fd* changed
    254 fd* at fdc0 drive -1 flags 0x20
    ukc> q
    Saving modified kernel.
    #

8.9 - OpenBSD Bootloader (i386, amd64 specific)

When booting your OpenBSD system, you have probably noticed the boot prompt.

    boot>

For most people, you won't have to do anything here. It will automatically
boot if no commands are given. But sometimes problems arise, or special
functions are needed. That's where these options will come in handy. To start
off, you should read through the boot(8) man page. Here we will go over the
most common used commands for the bootloader.

To start off, if no commands are issued, the bootloader will automatically try
to boot /bsd. If that fails it will try /obsd, and if that fails, it will try
/bsd.old. You can specify a kernel by hand by typing:

    boot> boot hd0a:/bsd

or

    boot> b /bsd

This will boot the kernel named bsd from the 'a' partition of the first BIOS
recognized hard disk.

Here is a brief list of options you can use with the OpenBSD kernel.

  * -a : This will allow you to specify an alternate root device after booting
    the kernel.
  * -c : This allows you to enter the boot time configuration. Check the Boot
    Time Config section of the FAQ.
  * -s : This is the option to boot into single user mode.
  * -d : This option is used to dump the kernel into ddb. Keep in mind that
    you must have DDB built into the kernel.

These are entered in the format of: boot [ image [-acds]]

For further reading you can read boot(8)'s man page.

8.10 - S/Key

S/Key is a ``one-time password'' authentication system. It can be useful for
people who don't have the ability to use an encrypted channel which protects
their authentication credentials in transit, as can be established using ssh
(1).

WARNING: One-time password systems only protect authentication information.
They do not prevent network eavesdroppers from gaining access to private
information. Furthermore, if you are accessing a secure system A, it is
recommended that you do this from another trusted system B, to ensure nobody
is gaining access to system A by logging your keystrokes or by capturing and/
or forging input and output on your terminal devices.

The S/Key system generates a sequence of one-time (single use) passwords from
a user's secret passphrase along with a challenge received from the server, by
means of a secure hash function. The system is only secure if the secret
passphrase is never transferred over the network. Therefore initializing or
changing your secret passphrase MUST be done over a secure channel, such as
ssh(1) or the console.

OpenBSD's S/Key implementation can use a variety of algorithms as the one-way
hash function. The following algorithms are available:

  * md4
  * md5
  * sha1
  * rmd160.

Setting up S/Key - The first steps

To start off the directory /etc/skey must exist. If this directory is not in
existence, have the super-user create it. This can be done simply by doing:

    # skeyinit -E

Once that directory is in existence, you can initialize your S/Key. To do this
you must use skeyinit(1). Since skeyinit(1) will be asking you for your S/Key
secret passphrase, you must run this over a secure channel, as explained
above! The program will even remind you of this. With skeyinit(1), you will
first be prompted for your password to the system. This is the same password
that you used to log into the system. Once you have authorized yourself with
your system password, you will be asked for your S/Key secret passphrase. This
is NOT your system password. Your secret passphrase must be at least 10
characters. We suggest using a memorable phrase containing several words as
the secret passphrase. Here is an example user being added.

    $ skeyinit
    Reminder - Only use this method if you are directly connected
               or have an encrypted channel.  If you are using telnet,
               exit with no password and use skeyinit -s.
    Password:
    [Adding ericj with md5]
    Enter new secret passphrase:
    Again secret passphrase:

    ID ericj skey is otp-md5 100 oshi45820
    Next login password: HAUL BUS JAKE DING HOT HOG

One line of particular importance in here is ID ericj skey is otp-md5 100
oshi45820. This gives a lot of information to the user. Here is a breakdown of
the sections and their importance.

  * otp-md5 - This shows which one-way hash was used to create your One-Time
    Password (otp).
  * 100 - This is your sequence number. This is a number from 100 down to 1.
    Once it reaches one, another secret passphrase must be created by running
    skeyinit(1).
  * oshi45820 - This is the key.

But of more immediate importance is your one-time password. Your one-time
password consists of 6 small words, combined together this is your one-time
password, spaces and all. The one-time password printed by skeyinit cannot be
used to login (there is a usage for this first one-time password, see skeyinit
(1)). To be able to log in, a one-time password corresponding to the challenge
printed by the login process has to be computed using skey(1). The next
section will show how to do that.

Actually using S/Key to login.

By now your skey has been initialized. You're ready to login. Here is an
example session using S/Key to login. To perform an S/Key login, you append
:skey to your login name.

    $ ftp localhost
    Connected to localhost.
    220 oshibana.shin.ms FTP server (Version 6.5/OpenBSD) ready.
    Name (localhost:ericj): ericj:skey
    331- otp-md5 96 oshi45820
    331 S/Key Password:
    230- OpenBSD 5.8 (GENERIC) #1066: Sun Aug 16 02:33:00 MDT 2015
    230-
    230- Welcome to OpenBSD: The proactively secure Unix-like operating system.
    230-
    230- Please use the sendbug(1) utility to report bugs in the system.
    230- Before reporting a bug, please try to reproduce it with the latest
    230- version of the code.  With bug reports, please try to ensure that
    230- enough information to reproduce the problem is enclosed, and if a
    230- known fix for it exists, include that as well.
    230-
    230 User ericj logged in.
    Remote system type is UNIX.
    Using binary mode to transfer files.
    ftp> quit
    221 Goodbye.

Note that ":skey" was appended to the username. This tells ftpd to
authenticate using S/Key. Some of you might have noticed that the sequence
number has changed to otp-md5 96 oshi45820. This is because by now S/Key has
been used to login several times. But how do you get your one-time password?
Well, to compute the one-time password, you'll need to know what sequence
number you're using and your key. As you're probably thinking, how can you
remember which sequence number you're on?

When you are logging in, the login process prints a line containing the needed
information, which you can use to generate a one-time password on the spot
using another trusted computer accesses by a secure channel, by copy-pasting
the line into a command shell:

    otp-md5 96 oshi45820

After typing your passphrase, your one-time password will be printed, which
you can then copy-paste to the S/Key Password prompt to log in. Not only is
otp-md5 a description of the hash used, it is also an alternate name for the
skey(1) command.

If you already are logged in and want to generate a one-time password for the
next login, use skeyinfo(1), it will tell you what to use for the next login.
For example, the following will generate another one-time password for a login
that can be made in the future. (remember this is being carried out from a
secure channel).

    $ skeyinfo
    95 oshi45820

An even better way is to use skeyinfo -v, which outputs a command suitable to
be run in the shell. For instance:

    $ skeyinfo -v
    otp-md5 95 oshi45820

So, the simplest way to generate the next S/Key password is just:

    $ `skeyinfo -v`
    Reminder - Do not use this program while logged in via telnet.
    Enter secret passphrase:
    NOOK CHUB HOYT SAC DOLE FUME

Note the backticks in the above example.

Many of you won't always have a secure connection or a trusted local computer
to create these passwords, and creating them over an insecure connection isn't
feasible, so how can you create multiple passwords at one time? You can supply
skey(1) with a number of how many passwords you want created. This can then be
printed out and taken with you wherever you go.

    $ otp-md5 -n 5 95 oshi45820
    Reminder - Do not use this program while logged in via telnet.
    Enter secret passphrase:
    91: SHIM SET LEST HANS SMUG BOOT
    92: SUE ARTY YAW SEED KURD BAND
    93: JOEY SOOT PHI KYLE CURT REEK
    94: WIRE BOGY MESS JUDE RUNT ADD
    95: NOOK CHUB HOYT SAC DOLE FUME

Notice here though, that the bottom password should be the first used, because
we are counting down from 100.

Using S/Key with ssh(1) and telnet(1)

Using S/Key with ssh(1) or telnet(1) is done in pretty much the same fashion
as with ftp--you simply tack ":skey" to the end of your username. Example:

    $ ssh -l ericj:skey localhost
    otp-md5 98 oshi45821
    S/Key Password: SCAN OLGA BING PUB REEL COCA
    Last login: Thu Apr  7 12:21:48 on ttyp1 from 156.63.248.77
    OpenBSD 5.8 (GENERIC) #1066: Sun Aug 16 02:33:00 MDT 2015

    Welcome to OpenBSD: The proactively secure Unix-like operating system.

    Please use the sendbug(1) utility to report bugs in the system.
    Before reporting a bug, please try to reproduce it with the latest
    version of the code.  With bug reports, please try to ensure that
    enough information to reproduce the problem is enclosed, and if a
    known fix for it exists, include that as well.

    You have mail.
    $

8.12 - What OpenBSD platforms support SMP?
(Symmetric Multi-Processor)

SMP is supported on the OpenBSD/i386, OpenBSD/amd64, OpenBSD/mvme88k, OpenBSD/
sparc64 (including the UltraSPARC T1/T2/T2+ processors), OpenBSD/macppc,
OpenBSD/sgi (Octane only), OpenBSD/hppa, and OpenBSD/alpha platforms.

A separate SMP kernel, "bsd.mp", is provided with the install file sets. If
multiple processors are detected at install time, is automatically installed
as the default boot kernel, /bsd, and the single processor kernel is renamed /
bsd.sp.

If you add additional processors to a system which was installed with only one
processor, you will want to install the appropriate bsd.mp kernel, rename your
existing /bsd to /bsd.sp, and rename /bsd.mp to /bsd.

It is hoped that other SMP-capable platforms will be supported in the future.
On most other platforms, OpenBSD will run on an SMP system, but only utilizing
one processor. The exception to this is the SPARC platform -- OpenBSD/sparc
will sometimes require that extra MBus modules be removed for the system to
boot.

8.13 - I get Input/output error when trying to use my tty devices

You need to use /dev/cuaXX for connections initiated from the OpenBSD system,
the /dev/ttyXX devices are intended only for terminal or dial-in usage. While
it was possible to use the tty devices in the past, the OpenBSD kernel is no
longer compatible with this usage.

From cua(4):

For hardware terminal ports, dial-out is supported through matching device
nodes called calling units. For instance, the terminal called /dev/tty03 would
have a matching calling unit called /dev/cua03. These two devices are normally
differentiated by creating the calling unit device node with a minor number
128 greater than the dial-in device node. Whereas the dial-in device (the tty)
normally requires a hardware signal to indicate to the system that it is
active, the dial-out device (the cua) does not, and hence can communicate
unimpeded with a device such as a modem. This means that a process like getty
(8) will wait on a dial-in device until a connection is established.
Meanwhile, a dial-out connection can be established on the dial-out device
(for the very same hardware terminal port) without disturbing anything else on
the system. The getty(8) process does not even notice that anything is
happening on the terminal port. If a connecting call comes in after the
dial-out connection has finished, the getty(8) process will deal with it
properly, without having noticed the intervening dial-out action.

8.14 - What web browsers are available for OpenBSD?

The base ftp utility also supports HTTP and HTTPS URLs for file downloading.

Some more advanced browsers available include (in no particular order):

Graphical (X) Browsers

  * Konqueror Installed as part of the KDE desktop environment.
  * Links+ Another fast and small graphical browser. (Also has a text-only
    mode)
  * Firefox and SeaMonkey Feature-filled browsers. SeaMonkey includes many
    non-browser features (mail client, IRC client, etc.), Firefox is just a
    browser, based on Mozilla.
  * Opera Commercial browser, i386 only (requires Linux emulation).
  * Midori, a WebKit-based browser from the Xfce project.
  * Chromium the open source version of the Google Chrome browser, i386/amd64
    only (so far).
  * Xombrero a minimalist browser with vi-like keyboard operations in addition
    to traditional browser behavior
  * Conkeror a keyboard-oriented, highly-customizable, highly-extensible web
    browser based on Mozilla.
  * Surf Extremely minimal webbrowser based on WebKit/GTK+.
  * Dillo Fast and lightweight, based on Fast Light ToolKit and custom
    rendering engine (note: no javascript support).
  * Netsurf Lightweight web browser based on custom rendering engine (note: no
    javascript support).
  * Epiphany GNOME web browser based on WebKit.
  * Arora Simple Qt4-based browser using WebKit.

Console (Text mode) Browsers

  * Lynx The text web browser
  * Elinks Feature-rich, can render both frames and tables, highly
    customizable.
  * W3M Has table and frame support (also has a graphical mode).
  * Links Has table support.
  * retawq Interactive, multi-threaded text mode web browser.

Most of the abovementioned browsers are available as pre-compiled packages on
the FTP servers, with some also on the CD-ROM. After the installation of the
ports tree, all can also be found in the /usr/ports/www/ directory.

As most of the graphical browsers are very large and require quite some time
to download and compile, one should seriously consider the use of packages
where available.

8.15 - How do I use the mg editor?

mg(1) is a micro Emacs-style text editor included in OpenBSD. Micro means that
it's a small implementation which is mostly similar to the text editor
features of GNU Emacs. It does not implement many of Emacs' other features
(including mail and news functionality, as well as modes for Lisp, C++, Lex,
Awk, Java, etc...).

A concise tutorial is included with OpenBSD (located at /usr/share/doc/mg/
tutorial).

8.16 - ksh(1) does not appear to read my .profile!

There are two likely reasons for ksh(1) to seemingly ignore a user's .profile
file.

  * .profile is not owned by the user. To fix for username,

        # chown username ~username/.profile

  * You are using ksh(1) from within X Window System

    Under xterm(1), argv[0] for ksh(1) is not prepended with a dash ("-").
    Prepending a dash to argv[0] will cause csh(1) and ksh(1) to know they
    should interpret their login files. (For csh(1) that's .login, with a
    separate .cshrc that is always run when csh(1) starts up. With ksh(1),
    this is more noticeable because there is only one startup script,
    .profile. This file is ignored unless the shell is a login shell.)

    To fix this, add the line "XTerm*loginShell: true" to the file .Xdefaults
    in your home directory. Note, this file does not exist by default, you may
    have to create it.

        $ echo "XTerm*loginShell: true" >> ~/.Xdefaults

    You may not have had to do this on other systems, as some installations of
    X Window System come with this setting as default. OpenBSD has chosen to
    follow the X.org behavior.

8.17 - Why does my /etc/motd file get overwritten when I modified it?

On every boot of the system, the /etc/motd(5) file is modified by /etc/rc(8):
everything up to (but not including) the first blank line is replaced with the
version information of the active kernel. Therefore, when editing /etc/motd,
ensure that material intended to persist across system boots is placed after
the first blank line.

8.20 - Antialiased and TrueType fonts in X

See this document.

8.21 - Does OpenBSD support any journaling filesystems?

No it doesn't. We use a different mechanism to achieve similar results called
Soft Updates. Please read FAQ 14 - Soft Updates to get more details.

8.22 - Reverse DNS
     - or -
Why is it taking so long for me to log in?

Many new users to OpenBSD experience a two minute login delay when using
services such as ssh or ftp. This can also be experienced when using a proxy,
such as ftp-proxy, or when sending mail.

This is almost always due to a reverse-DNS problem. DNS is Domain Name
Services, the system the Internet uses to convert a name, such as
"www.openbsd.org" into a numeric IP address. Another task of DNS is the
ability to take a numeric address and convert it back to a "name", this is
"Reverse DNS".

In order to provide better logging, OpenBSD performs a reverse-DNS lookup on
any machine that attaches to it in many different ways, including ssh, ftp,
ftp-proxy. Unfortunately, in some cases, the machine that is making the
connection does not have a proper reverse DNS entry.

An example of this situation:

A user sets up an OpenBSD box as a firewall and gateway to their internal home
network, mapping all their internal computers to one external IP using NAT.
They may also use it as an outbound mail relay. They follow the installation
guidelines, and are very happy with the results, except for one thing -- every
time they try to attach to the box in any way, they end up with a two minute
delay before things happen.

What is going on:

From a workstation behind the NAT of the gateway with an unregistered IP
address of 192.168.1.35, the user uses ssh to access the gateway system. The
ssh client prompts for username and password, and sends them to the gateway
box. The gateway then tries to figure out who is trying to log in by
performing a reverse DNS lookup of 192.168.1.35. The problem is 192.168.0.0
addresses are for private use, so a properly configured DNS server outside
your network knows it should have no information about those addresses. Some
will quickly return an error message, in these cases, OpenBSD will assume
there is no more information to be gained, and it will quickly give up and
just admit the user. Other DNS servers will not return ANY response. In this
case you will find yourself waiting for the OpenBSD name resolver to time out,
which takes about two minutes before the login will be permitted to continue.
In the case of ftp-proxy, some ftp clients will timeout before the reverse DNS
query times out, leading to the impression that ftp-proxy isn't working.

This can be quite annoying. Fortunately, it is an easy thing to fix.

Fix, using /etc/hosts:

The simplest fix is to populate your /etc/hosts file with all the workstations
you have in your internal network, and ensure that your /etc/resolv.conf file
contains the line lookup file bind which ensures that the resolver knows to
start with the /etc/hosts file, and failing that, to use the DNS servers
specified by the "nameserver" lines in your /etc/resolv.conf file.

Your /etc/hosts file will look something like this:

::1 localhost.in.example.org localhost
127.0.0.1 localhost.in.example.org localhost
192.168.1.1 gw.in.example.org gw
192.168.1.20 scrappy.in.example.org scrappy
192.168.1.35 shadow.in.example.org shadow

Your resolv.conf file will look something like this:

search in.example.org
nameserver 24.2.68.33
nameserver 24.2.68.34
lookup file bind

A common objection to this is "But, I use DHCP for my internal network! How
can I configure my /etc/hosts?" Rather easily, actually. Just enter lines for
all the addresses your DHCP server is going to give out, plus any static
devices:

::1 localhost.in.example.org localhost
127.0.0.1 localhost.in.example.org localhost
192.168.1.1 gw.in.example.org gw
192.168.1.20 scrappy.in.example.org scrappy
192.168.1.35 shadow.in.example.org shadow
192.168.1.100 d100.in.example.org d100
192.168.1.101 d101.in.example.org d101
192.168.1.102 d102.in.example.org d102
         [... snip ...]
192.168.1.198 d198.in.example.org d198
192.168.1.199 d199.in.example.org d199

This case assumes you have the DHCP range set to 192.168.1.100 through
192.168.1.199, plus the three static definitions as listed at the top of the
file.

If your gateway must use DHCP for configuration, you may well find you have a
problem -- dhclient will overwrite your /etc/resolv.conf every time the lease
is renewed, which will remove the "lookup file bind" line. This can be solved
by putting the line "lookup file bind" in the file /etc/resolv.conf.tail.

Fix, using a local DNS server

Details on this are somewhat beyond the scope of this document, but the basic
trick is to setup your favorite DNS server, and make sure it knows it is
authoritative for both forward and reverse DNS resolution for all nodes in
your network, and make sure your computers (including your gateway) know to
use it as a DNS server.

8.23 - Why do the OpenBSD web pages not conform to HTML4/XHTML?

The present web pages have been carefully crafted to work on a wide variety of
actual browsers going back to browser versions 4.0 and later. We do not want
to make these older pages conform to HTML4 or XHTML until we're sure that they
will also work with older browsers; it's just not a priority. We welcome new
contributors, but suggest you work on writing code, or on documenting new
aspects of the system, not on tweaking the existing web pages to conform to
newer standards.

8.24 - Why is my clock off by twenty-some seconds?

When using rdate(8) to synchronize your clock to a NTP server, you may find
your clock is off by twenty-some seconds from your local definition of time.

This is caused by a difference between the UTC (Coordinated Universal Time,
based on astronomical observations) time and TAI (International Atomic Time,
based on atomic clocks) time. To compensate for variations in the earth's
rotation, "leap seconds" are inserted into UTC, but TAI is unadjusted. These
leap seconds are the cause of this discrepancy. For a more detailed
description, search the web for "leap seconds UTC TAI".

Addressing the problem is fairly simple. In most countries you will get the
correct time if you use the "-c" parameter to rdate(8) and use a time zone out
of the directory /usr/share/zoneinfo/right/. For example, if you are located
in Germany, you could use these commands:

     # cd /etc && ln -sf /usr/share/zoneinfo/right/CET localtime
     # rdate -ncv ptbtime1.ptb.de

In other countries, the rules may differ.

8.25 - Why is my clock off by several hours?

By default, OpenBSD assumes your hardware clock is set to UTC (Universal
Coordinated Time) rather than local time, assumed by some other operating
systems, which can cause problems when multibooting.

Many other operating systems, can be configured to do the same, which avoids
this problem altogether.

If having the hardware clock set to UTC is a problem, you can change the
default behavior of OpenBSD using config(8). For example, to configure OpenBSD
to use a hardware clock set to US/Eastern (5 hours behind UTC, so 300
minutes):

    # config -ef /bsd
    OpenBSD 5.8 (GENERIC) #1066: Sun Aug 16 02:33:00 MDT 2015
        deraadt@@i386.openbsd.org:/usr/src/sys/arch/i386/compile/GENERIC
    Enter 'help' for information
    ukc> timezone 300
    timezone = 300, dst = 0
    ukc> quit
    Saving modified kernel.

See options(4) and search for option "TIMEZONE=value" for more information.

Normally, the time zone is set during install. If you have need to change the
time zone, you can create a new symbolic link to the appropriate time zone
file in /usr/share/zoneinfo. For example, to set the machine to use EST5EDT as
the new local time zone:

    # ln -fs /usr/share/zoneinfo/EST5EDT /etc/localtime

See also:

  * date(1)
  * "Why is my clock off by twenty-some seconds?"
  * OpenBSD's NTPD

------------------------------------------------------------------------------

==============================================================================

9 - Migrating to OpenBSD

------------------------------------------------------------------------------

Table of Contents

  * 9.1 - Tips for users of other Unix-like Operating Systems
  * 9.2 - Dual boot of Linux and OpenBSD
  * 9.3 - Converting your Linux (or other Sixth Edition-style) password file
    to BSD-style.
  * 9.4 - Running Linux binaries on OpenBSD
  * 9.5 - Accessing your Linux files from OpenBSD

For more information for Linux users, please refer to http://sites.inka.de/
mips/unix/bsdlinux.html.
------------------------------------------------------------------------------

9.1 - Tips for users of other Unix-like Operating Systems

While OpenBSD is a very traditional Unix-like operating system and will be
very familiar to those who have used other Unix-like systems, there are
important differences. New users to OpenBSD must look at their own experience:
if your only knowledge of Unix is some experience with one variant of Linux,
you may find OpenBSD "strange". Rest assured, Linux looks pretty strange to
anyone who starts from OpenBSD. You must recognize the difference between
"standard" and your experience.

If you learned Unix from any of the good books on general Unix, understanding
the "Unix philosophy" and then extended your knowledge to a particular
platform, you will find OpenBSD to be a very "true" and familiar Unix. If you
learned Unix using a "type this to do that" process or a book such as "Learn
PinkBeenie v8.3 in 31.4 Hours", and told yourself you "know Unix", you will
most likely find OpenBSD very different.

One important difference between OpenBSD and many other operating systems is
the documentation. OpenBSD developers take great pride in the system man
pages. The man pages are the authoritative source of OpenBSD documentation --
not this FAQ, not third-party independently maintained pages, not "HOWTO"s,
etc. When a developer makes a change to the system, they are expected to
update the man pages along with their change to the system code, not "later"
or "when they get around to it" or "when someone complains". A manual page
exists for virtually every program, utility, driver, configuration file, and
so on on the stock system. It is expected that a user will check the man pages
before asking for help on the mail lists.

Here are some of the commonly encountered differences between OpenBSD and
other Unix variants.

  * OpenBSD is a fairly pure "BSD-Style" Unix, following the 4.4BSD design
    closely. Linux and Solaris are "System V" style systems. Some Unix-like
    operating systems (including some Linux distributions) mix many SysV and
    BSD characteristics. A common place where this causes confusion is the
    startup scripts, OpenBSD uses the traditional BSD4.4-style rc(8) style.
  * OpenBSD is a complete system, intended to be kept in sync. It is not a
    "Kernel plus utilities" that can be upgraded separately from each other.
    Failure to keep your system (kernel, user utilities, and applications) in
    sync will result in bad things happening.
  * As many applications are not developed to directly compile and run on an
    OpenBSD environment, OpenBSD has a ports tree, a system where users can
    easily acquire code, patch it for OpenBSD, install dependencies, compile
    it, install and remove it in a standardized and maintainable way.
    Pre-compiled packages are created and distributed by the OpenBSD ports
    team. Users are encouraged to use these packages over compiling their own.
  * OpenBSD uses CVS to keep track of source code changes. OpenBSD pioneered
    anonymous CVS, which allows anyone to extract the full source tree for any
    version of OpenBSD (from 2.0 to current, and all revisions of all files in
    between) at any time, and you can access the most recent changes within
    hours of its commit. There is also a very convenient and easy to use web
    interface to CVS at http://cvsweb.openbsd.org/.
  * OpenBSD produces an official release available on CD and FTP every six
    months on a predefined schedule. Snapshots for all supported platforms are
    made semi-regularly with the current development code. It is the goal that
    the source tree is kept fully buildable and the resultant system usable at
    all times. The tree is occasionally broken, but this is an extraordinary
    event that will be corrected rapidly, not something that will be permitted
    to continue.
  * OpenBSD has gone through heavy and continual security auditing to ensure
    the quality (and thus, security) of the code.
  * OpenBSD's kernel is /bsd.
  * The names of hard disks are usually /dev/wd (IDE) and /dev/sd (SCSI or
    devices emulating SCSI disks).
  * /sbin/route with no arguments in Linux gives the state of all the active
    routes, under OpenBSD (and many other OSs), you need the "show" parameter,
    or do a "netstat -r".
  * OpenBSD does NOT support Journaling Filesystems like ReiserFS, IBM's JFS
    or SGI's XFS. Instead we use the Soft Updates feature of the already very
    robust Unix Fast File System (FFS) to accomplish the goals of performance
    and stability.
  * OpenBSD comes with Packet Filter (PF), not ipfw, ipchains, netfilter,
    iptables, or ipf. This means that Network Address Translation (known as
    IP-Masquerading in Linux), queuing, and filtering is done through pfctl
    (8), pf(4), and pf.conf(5). See the PF User's Guide for detailed
    configuration information.
  * Interface address is stored in /etc/hostname.<interfacename> (for example,
    /etc/hostname.em0 for a NIC using the em(4) driver). It can contain a
    hostname (resolved in /etc/hosts) instead of an IP address.
  * The machine name is in /etc/myname.
  * The default gateway is in /etc/mygate.
  * OpenBSD's default shell is /bin/ksh, which is pdksh, the Public Domain
    Korn shell. Other included shells are csh and sh. Shells such as bash and
    tcsh can be added as packages or installed from ports. Users familiar with
    bash are encouraged to try ksh(1) before loading bash on their system --
    it does what most people desire of bash.
  * Password management on OpenBSD is different from password management on
    some other Unix-like operating systems. The actual passwords are stored in
    the file master.passwd(5) which is readable only by root. This file should
    be altered only with the vipw program.
  * Devices are named by driver, not by type. For example, there are no eth*
    devices. It would be em0 for an Intel PRO/1000 Ethernet card, bge0 for a
    Broadcom BCM57xx or BCM590x Ethernet device, ral0 for a RaLink wireless
    device, etc. All of these drivers have man pages in section 4. So, to find
    more information about the features supported by the PRO/1000 driver, you
    can do "man 4 em".
  * OpenBSD/i386, amd64, and several other platforms use a "two layer" disk
    partitioning system, where the first layer is the fdisk, BIOS-visible
    partition, familiar to most users of IBM compatible computers. The second
    layer is the disklabel, a traditional BSD partitioning system. OpenBSD
    supports up to 15 disklabel partitions on a disk, all residing within one
    fdisk partition. This permits OpenBSD to coexist with other OSs, including
    other Unix-like OSs. OpenBSD must be one of the four "primary" partitions.
  * Some other OSs encourage you to customize your kernel for your machine.
    OpenBSD users are encouraged to simply use the standard GENERIC kernel
    provided and tested by the developers. Users attempting to "customize" or
    "optimize" their kernel usually cause far more problems than they solve,
    and will not be supported by developers.
  * OpenBSD works hard to maintain the license policy and security of the
    project. For this reason, some newer versions of some software which fail
    to meet either the license or security goals of the project have not and
    may never be integrated into OpenBSD. Security and free licensing will
    never take a back seat to having the biggest version number.

9.2 - Dual booting Linux and OpenBSD (amd64/i386)

Multibooting is not trivial, and it requires an understanding of ALL the
operating systems you wish to have coexist on the machine. The GRUB loader
commonly used with Linux can boot OpenBSD as a generic operating system. From
time to time, GRUB tries to natively handle OpenBSD booting -- using this
feature is NOT recommended, as there is no coordination with OpenBSD
development, and so this feature is often broken, and there's really no need
for it. Just use OpenBSD's boot code, and what GRUB terms "Chain Loading" to
invoke it.

A GRUB entry which could boot OpenBSD installed on the second MBR partition
(partition "1" in OpenBSD's fdisk) might look like:

    menuentry "OpenBSD" {
            set root=(hd0,2)
            chainloader +1
    }

Your milage will vary.

9.3 - Converting your Linux (or other Sixth Edition-style) password file to
BSD-style

First, figure out if your Linux password file is shadowed or not. If it is,
install John the Ripper from packages or ports (security/john) and use the
unshadow utility that comes with it to merge your passwd and shadow files into
one Sixth Edition-style file.

Using your Linux password file, we'll call it linux_passwd, you need to add in
::0:0 between fields four and seven. awk(1) does this for you.

    # cat linux_passwd | awk -F : '{printf("%s:%s:%s:%s::0:0:%s:%s:%s\n", \
    > $1,$2,$3,$4,$5,$6,$7); }' > new_passwd

At this point, you want to edit the new_passwd file and remove the root and
other system entries that are already present in your OpenBSD password file or
aren't applicable with OpenBSD (all of them). Also, make sure there are no
duplicate usernames or user IDs between new_passwd and your OpenBSD box's /etc
/passwd. The easiest way to do this is to start with a fresh /etc/passwd.

    # cat new_passwd >> /etc/master.passwd
    # pwd_mkdb -p /etc/master.passwd

The last step, pwd_mkdb is necessary to rebuild the /etc/spwd.db and /etc/
pwd.db files. It also creates a Sixth Edition-style password file (minus
encrypted passwords) at /etc/passwd for programs which use it. OpenBSD uses a
stronger encryption for passwords, blowfish, which is very unlikely to be
found on any system which uses full Sixth Edition-style password files. To
switch over to this stronger encryption, simply have the users run 'passwd'
and change their password. The new password they enter will be encrypted with
your default setting (usually blowfish unless you've edited /etc/login.conf).
Or, as root, you can run passwd username.

9.4 - Running Linux binaries on OpenBSD

OpenBSD/i386 is able to run Linux binaries when the kernel is compiled with
the COMPAT_LINUX option and the runtime sysctl kern.emul.linux is also set. If
you are using the GENERIC kernel (which you should be), COMPAT_LINUX is
already enabled, and you will just need to do:

    # sysctl kern.emul.linux=1

For this to be done automatically each time the computer boots, remove the #
(comment) character at the beginning of the line

    #kern.emul.linux=1      # enable running Linux binaries

in /etc/sysctl.conf, so that it reads

    kern.emul.linux=1       # enable running Linux binaries

and reboot your system to have it take effect.

To run any Linux binaries that are not statically linked (most of them), you
need to follow the instructions on the compat_linux(8) manual page.

A simple way to get most of the useful Linux libraries is to install the
fedora/base package from your nearest FTP mirror. To find out more about the
packages and ports system read FAQ 15 - The OpenBSD Packages and Ports System.
To install the above mentioned package you would issue

    # export PKG_PATH=ftp://your.ftp.mirror/pub/OpenBSD/5.8/packages/i386/
    # pkg_add -i fedora_base

Note that pkg_add(1) will automatically execute sysctl to set kern.emul.linux
to the correct value upon adding this package. However, it does not change /
etc/sysctl.conf, so if you wish Linux emulation to be enabled by default, you
need to modify kern.emul.linux there.

9.5 - Accessing your Linux files from OpenBSD

OpenBSD supports the EXT2 file system for read/write, and can read EXT4. For
further information, see FAQ 14.

------------------------------------------------------------------------------

==============================================================================

10 - System Management

------------------------------------------------------------------------------

Table of Contents

  * 10.1 - When I try to su to root it says that I'm in the wrong group.
  * 10.2 - How do I duplicate a filesystem?
  * 10.3 - How do I start daemons with the system? (Overview of rc(8))
  * 10.4 - Introducing doas(1) -- or -- what happened to sudo?
  * 10.8 - I made changes to /etc/passwd with an editor, but the changes
    didn't seem to take place. Why?
  * 10.9 - How do I add a user? Or delete a user?
  * 10.10 - How do I create a ftp-only account?
  * 10.11 - Setting up user disk quotas
  * 10.13 - Setting up an Anonymous FTP Server
  * 10.14 - Confining users to their home directories in ftpd(8)
  * 10.15 - Applying patches in OpenBSD
  * 10.17 - Can I change the root shell?
  * 10.18 - What else can I do with ksh?
  * 10.19 - Directory services
      + 10.19.1 - Which directory services are available?
      + 10.19.2 - YP security considerations
      + 10.19.3 - Setting up a YP server
      + 10.19.4 - Setting up a YP client
  * 10.20 - Character sets and localization
      + 10.20.1 - Configuring the active character set
      + 10.20.2 - Changing the language used in application messages

------------------------------------------------------------------------------

10.1 - Why does it say that I'm in the wrong group when I try to su root?

On OpenBSD, users who are in the wheel group are allowed to use su(1) to
become root. Otherwise, the user will receive an error.

If you are creating new users with adduser(8), you can add them to the wheel
group by answering "wheel" at the "Invite user into other groups:" prompt.
Existing users must be added to the wheel group by hand. Here is an example of
a /etc/group entry which has had the user ericj added to the wheel group:

    wheel:*:0:root,ericj

If you want to give access to superuser privileges without adding users to the
wheel group, you can use doas(1).

10.2 - How do I duplicate a filesystem?

To duplicate your filesystem use dump(8) and restore(8). For example, to
duplicate everything under directory SRC to directory DST, do a:

    # cd /SRC; dump 0f - . | (cd /DST; restore -rf - )

dump is designed to give you plenty of backup capabilities, and it may be an
overkill if you just want to duplicate a part of a (or an entire) filesystem.
The command tar(1) may be faster for this operation. The format looks very
similar:

    # cd /SRC; tar cf -  . | (cd /DST; tar xpf - )

10.3 - How do I start daemons with the system? (Overview of rc(8))

OpenBSD itself uses an rc(8) style startup. This uses a few key files for
startup.

  * /etc/rc - Main script. Should not be edited.
  * /etc/rc.conf - Configuration file used by /etc/rc to set startup
    parameters for the system. Should not be edited.
  * /etc/rc.conf.local - Configuration file that overrides settings in /etc/
    rc.conf so you don't have to touch /etc/rc.conf itself, which is important
    when upgrading your system.
  * /etc/netstart - Script used to initialize the network. Shouldn't be
    edited.
  * /etc/rc.local - Script used for local administration. This is where new
    daemons or host specific information can be set.
  * /etc/rc.securelevel - Script which runs commands that must be run before
    the security level changes. See init(8)
  * /etc/rc.shutdown - Script run on shutdown. Put anything you want done
    before shutdown in this file. See rc.shutdown(8)

How does rc(8) work?

The main files a system administrator should concentrate on are /etc/rc.conf
(for guidance), /etc/rc.conf.local (for changes), /etc/rc.local and /etc/
rc.shutdown. To get a look of how the rc(8) procedure works, here is the flow:

After the kernel is booted, /etc/rc is started:

  * Filesystems are checked.
  * Default configuration variables are read in from /etc/rc.conf, then local
    changes to those variables are read from /etc/rc.conf.local. Settings in
    rc.conf.local will override those in rc.conf.
  * Filesystems are mounted
  * Clears out /tmp and preserves any editor files
  * Configures the network via /etc/netstart
      + Configures your interfaces up.
      + Sets your hostname, domainname, etc.
  * Starts system daemons
  * Performs various other checks (quotas, savecore, etc)
  * Runs /etc/rc.firsttime
  * Runs /etc/rc.local
  * Processes local and package scripts in /etc/rc.d

Starting Daemons and Services that come with OpenBSD

Most daemons and services that come with OpenBSD are controlled on boot by
variables defined in the /etc/rc.conf configuration file. Take a look at the /
etc/rc.conf file. You'll see lines similar to this:

    ftpd_flags=NO           # for non-inetd use: ftpd_flags=""

A line like this shows that ftpd(8) is not to start up with the system (at
least not as a daemon via rc(8); ftpd is often run out of inetd(8), see
Anonymous FTP FAQ to read more about this). Each line has a comment showing
you the flags for common usage of that daemon or service. This doesn't mean
that you must run that daemon or service with those flags. Read the relevant
manual page to see how you can have that daemon or service start up in any way
you like.

We strongly suggest you do not alter /etc/rc.conf itself. Instead, create or
edit the file /etc/rc.conf.local, copy just the lines you need to change from
/etc/rc.conf and adjust them as you like. This makes future upgrades easier --
all the changes are in the one file that isn't touched during upgrade.

For example, here is the default line pertaining to ntpd(8).

    ntpd_flags=NO          # for normal use: ""

Here you can see that starting up ntpd normally requires no flags, so a line
like ntpd_flags="" added to /etc/rc.conf.local will do the job. But to start
ntpd with options, such as -s to immediately update the system clock at boot
you would need a line like ntpd_flags="-s" instead.

Starting up local daemons and configuration

For other daemons which you might install on the system via packages or other
ways, you could use the /etc/rc.local file. For example, I've installed a
daemon which lies at /usr/local/sbin/daemonx. I want it to start at boot time.
I could put an entry into /etc/rc.local like this:

    if [ -x /usr/local/sbin/daemonx ]; then
            echo 'Starting daemonx'; /usr/local/sbin/daemonx
    fi

(If the daemon does not automatically detach on startup, remember to add a "&"
at the end of the command line.)

From now on, this daemon will be started at boot. You will be able to see any
errors on boot, a normal boot with no errors would show a line like this:

    Starting daemonx

The /etc/rc.d/ directory

OpenBSD's system daemons ("services") are started, stopped and controlled by /
etc/rc.d. All system daemons are handled by these scripts, and most add-in
packages are as well.

These scripts, one per daemon, are invoked by rc. The order for system daemons
is coded into rc, and the order for add-in packages is managed by the
pkg_scripts environment variable, which would be set in /etc/rc.conf.local.
Note that simply placing a script in this directory does not cause it to be
run on boot; the name of the script must be specified in the pkg_scripts
variable to start on boot.

The starting of system scripts is determined by entries in the /etc/
rc.conf.local file. For example, /etc/rc.d/ntpd does not start ntpd(8) unless
/etc/rc.conf or /etc/rc.conf.local contains a line defining the "ntpd_flags"
variable. To help make sure your system will come up as expected on the next
boot, the rc.d scripts will not run their daemon if the appropriate variable
is not defined. You can, of course, manually invoke /usr/sbin/ntpd directly
with whatever options you wish, if you wish to run the program manually.

Note that rather than having each script in rc.d managing the entire startup,
shutdown, reload, restart, and check operations, most rc.d scripts can be
reduced to specifying a very few variables, and invoking the rc.subr script,
which manages most of the standard way of doing these tasks.

For example, our above daemonx application could be started with a /etc/rc.d/
daemonx file consisting of:

    #!/bin/sh

    daemon="/usr/local/sbin/daemonx"

    . /etc/rc.d/rc.subr

    rc_cmd $1

and adding the daemon name to the pkg_scripts variable in /etc/rc.conf.local.

rc.shutdown

/etc/rc.shutdown is a script that is run at shutdown. Anything you want done
before the system shuts down should be added to this file.

10.4 - Introducing doas(1) -- or -- What happened to sudo?

10.4.1 - What is doas(1)?

doas(1) allows a user to temporarily run commands as the root (or other) user.
For example, if appropriately configured,

    $ doas fdisk sd1

allows you to run the command fdisk(8) as if you were root. Key words there
are "appropriately configured", of course. You don't want average users to be
able to get root privileges for any command they wish to run! Typically,
though certainly not required, users in the "wheel" group are given permission
to run commands with doas.

10.4.2 - Why doas(1)?

One common challenge when professionally administering computers is the
contradictory requirements of multiple people being able to manage every
machine and that account passwords should not shared. doas(1) solves this
problem by permitting a certain subset of your users (for example, members of
the "wheel" group) to run predetermined commands (often, all commands) as
another user (often root). Now, anyone can run administrative commands, only
needing to authenticate as themselves, they do not need to use the root
account or know the root password.

An added advantage of "doas" is all activity is logged. It is possible to find
out who ran an application.

Using a properly configured doas(1) on OpenBSD, one can completely disable the
root account, eliminating all root password management issues.

It is also considered good practice by many to use doas when absolutely
necessary to run a command as root, rather than sitting at a root console
prompt. This way, an erroneously typed command is less likely to have
catastrophic results. However, this is subject to some debate. It is possible
to cause as much chaos and havoc with a "finger-memory" (or just incorrect
command) invocation of doas as it is when logged in as root. For this reason,
we do not blindly side with those that chant "always use 'doas', never use
'root'!" or spend hours making things happen without root. Notably, if you set
doas to not require a the confirmation of your password, any script or
application running as you can invoke doas(1) to make any changes to your
system as root. For this reason, for personal systems, it is probably better
to either just use su(1) to elevate one's self to root status, or use doas(1)
with the password option.

10.4.3 - "Sounds like sudo!"

Yes, doas(1) was inspired by sudo. doas(1) is OpenBSD's replacement for the
sudo command.

The complexity of sudo has prevented the importing of the most current
versions, and the complexity of the sudoers config file has discouraged many
users from doing anything other than uncomment one line in the conf file. In
short, sudo's code is too complicated for the way most users use it, and its
configuration is too difficult for more advanced uses.

doas(1) is intended to have a simpler, and thus hopefully more secure code
base and a simpler configuration file. From a user standpoint, the two are
very similar.

For those needing the functionality of sudo, it's available as a package

10.4.4 - Using doas(1) -- basic doas.conf(5)

A very basic doas.conf might look like this:

    permit keepenv { PKG_PATH ENV PS1 SSH_AUTH_SOCK } :wheel

This file gives users in the wheel group no password root-level access to all
commands, with the environment variables PKG_PATH, ENV, PS1, and SSH_AUTH_SOCK
passed through to the program you are invoking. The user will be asked to
verify their password before the command is run.

A more sophisticated dosas.conf(5) file which would permit you to build
OpenBSD from source using doas(1) without entering your password every time
might be:

    permit nopass keepenv { PKG_PATH ENV PS1 SSH_AUTH_SOCK } :wheel
    permit nopass keepenv { \
        FTPMODE PKG_CACHE PKG_PATH SM_PATH SSH_AUTH_SOCK \
        DESTDIR DISTDIR FETCH_CMD FLAVOR GROUP MAKE MAKECONF \
        MULTI_PACKAGES NOMAN OKAY_FILES OWNER PKG_DBDIR \
        PKG_DESTDIR PKG_TMPDIR PORTSDIR RELEASEDIR SHARED_ONLY \
        SUBPACKAGE WRKOBJDIR SUDO_PORT_V1 } :wsrc

While the "nopass" option makes using "doas" very easy, it can also be invoked
by any script or program, without the user's knowledge or permission. For this
reason, systems used as general purpose workstations should probably not use
the "nopass" option, if using doas(1) at all. The alternative is using su(1)
and the root password to use the root account.

If you don't like the idea of any script or program you run being able to
silently invoke doas(1) to run something as root, but you find typing your
password over and over annoying, you may want to create a user for
administrative tasks, such as "admin", and have a doas.conf file like this:

    permit :wheel as admin
    permit nopass admin

Now, anyone who is in the wheel group can become "admin" with just one entry
of their password, and then admin can run the commands they wish without a
password until they drop back to their normal user.

10.8 - I edited /etc/passwd, but the changes didn't seem to take place. Why?

If you edit /etc/passwd directly, your changes will be lost. OpenBSD generates
/etc/passwd dynamically with pwd_mkdb(8). The main password file in OpenBSD is
/etc/master.passwd. According to pwd_mkdb(8),

    FILES
         /etc/master.passwd  current password file
         /etc/passwd         a 6th Edition-style password file
         /etc/pwd.db         insecure password database file
         /etc/pwd.db.tmp     temporary file
         /etc/spwd.db        secure password database file
         /etc/spwd.db.tmp    temporary file

In a traditional Unix password file, such as /etc/passwd, everything including
the user's encrypted password is available to anyone on the system (and is a
prime target for programs such as Crack). 4.4BSD introduced the master.passwd
file, which has an extended format (with additional options beyond those
provided by /etc/passwd) and is only readable by root. For faster access to
data, the library calls which access this data normally read /etc/pwd.db and /
etc/spwd.db.

OpenBSD does come with a tool with which you should edit your password file.
It is called vipw(8). Vipw will use vi (or your favourite editor defined per
$EDITOR) to edit /etc/master.passwd. After you are done editing, it will
re-create /etc/passwd, /etc/pwd.db, and /etc/spwd.db as per your changes. Vipw
also takes care of locking these files, so that if anyone else attempts to
change them at the same time, they will be denied access.

10.9 - What is the best way to add and delete users?

OpenBSD provides two commands for easily adding users to the system:

  * adduser(8)
  * user(8)

You can also add users by hand, using vipw(8), but this is more difficult for
most operations.

The easiest way to add a user in OpenBSD is to use the adduser(8) script. You
can configure adduser(8) by editing /etc/adduser.conf. adduser(8) allows for
consistency checks on /etc/passwd, /etc/group, and shell databases. It will
create the entries and $HOME directories for you. It can even send a message
to the user welcoming them. Here is an example user, testuser, being added to
a system. He/she will be given the $HOME directory /home/testuser, made a
member of the group guest, and given the shell /bin/ksh.

    # adduser
    Use option ``-silent'' if you don't want to see all warnings and questions.

    Reading /etc/shells
    Check /etc/master.passwd
    Check /etc/group

    Ok, let's go.
    Don't worry about mistakes. There will be a chance later to correct any input.
    Enter username []: testuser
    Enter full name []: Test FAQ User
    Enter shell csh ksh nologin sh [ksh]: ksh
    Uid [1002]: Enter
    Login group testuser [testuser]: guest
    Login group is ``guest''. Invite testuser into other groups: guest no
    [no]: no
    Login class authpf daemon default staff [default]: Enter
    Enter password []: Type password, then Enter
    Enter password again []: Type password, then Enter

    Name:        testuser
    Password:    ****
    Fullname:    Test FAQ User
    Uid:         1002
    Gid:         31 (guest)
    Groups:      guest
    Login Class: default
    HOME:        /home/testuser
    Shell:       /bin/ksh
    OK? (y/n) [y]: y
    Added user ``testuser''
    Copy files from /etc/skel to /home/testuser
    Add another user? (y/n) [y]: n
    Goodbye!

To delete users you should use the rmuser(8) utility. This will remove all
existence of a user. It will remove any crontab(1) entries, their $HOME dir
(if it is owned by the user), and their mail. Of course it will also remove
their /etc/passwd and /etc/group entries. Next is an example of removing the
user that was added above. Notice you are prompted for the name, and whether
or not to remove the user's home directory.

    # rmuser
    Enter login name for user to remove: testuser
    Matching password entry:

    testuser:$2a$07$ZWnBOsbqMJ.ducQBfsTKUe3PL97Ve1AHWJ0A4uLamniLNXLeYrEie:1002
    :31::0:0:Test FAQ User:/home/testuser:/bin/ksh

    Is this the entry you wish to remove? y
    Remove user's home directory (/home/testuser)? y
    Updating password file, updating databases, done.
    Updating group file: done.
    Removing user's home directory (/home/testuser): done.

Adding users via user(8)

These tools are less interactive than the adduser(8) command, which makes them
easier to use in scripts.

The full set of tools is:

  * group(8)
  * groupadd(8)
  * groupdel(8)
  * groupinfo(8)
  * groupmod(8)
  * user(8)
  * useradd(8)
  * userdel(8)
  * userinfo(8)
  * usermod(8)

Actually adding users

The command /usr/sbin/user is just a frontend to the rest of the /usr/sbin/
user* commands. Therefore, the following commands can be added by using user
add or useradd, which form you chose doesn't change the results at all.
Remember, since user(8) is not interactive, the easiest way to add users is
with adduser(8).

useradd(8) is less daunting to use if you know the default settings
beforehand. These settings are located in usermgmt.conf(5) and can be viewed
by doing:

    $ user add -D
    group           users
    base_dir        /home
    skel_dir        /etc/skel
    shell           /bin/csh
    inactive        0
    expire          Null (unset)
    range           1000..60000

These defaults will be used unless you specify alternatives with the command
line options. For example, we want the user to be added to the group guest,
not users. One more little hurdle with adding users, is that passwords must be
specified on the command line. Importantly, the passwords must be encrypted,
so you need to use the encrypt(1) utility. For example: OpenBSD's passwords by
default use the Blowfish algorithm for 6 rounds. Here is an example to create
an encrypted password to give to useradd(8).

    $ encrypt -p -b 6
    Enter string:
    $2a$06$YOdOZM3.4m6MObBXjeZtBOWArqC2.uRJZXUkOghbieIvSWXVJRzlq

Now that we have an encrypted password, we are ready to add the user. We will
add the same user with the same specifications as the user we added above, via
adduser(8).

    # user add -p '$2a$06$YOdOZM3.4m6MObBXjeZtBOWArqC2.uRJZXUkOghbieIvSWXVJRzlq' -u 1002 \
    -s /bin/ksh -c "Test FAQ User" -m -g guest testuser

Note: Make sure to use ' ' (single quotes) around the password string, not " "
(double quotes) as the shell will interpret these before sending it to user
(8). In addition to that, make sure you specify the -m option if you want the
user's home directory created and the files from /etc/skel copied over.

To see that the user was created correctly, we can use many different
utilities. Below are a few commands you can use to quickly check that
everything was created correctly.

    $ ls -la /home
    total 14
    drwxr-xr-x   5 root      wheel   512 May 12 14:29 .
    drwxr-xr-x  15 root      wheel   512 Apr 25 20:52 ..
    drwxr-xr-x  24 ericj     wheel  2560 May 12 13:38 ericj
    drwxr-xr-x   2 testuser  guest   512 May 12 14:28 testuser
    $ id testuser
    uid=1002(testuser) gid=31(guest) groups=31(guest)
    $ finger testuser
    Login: testuser                         Name: Test FAQ User
    Directory: /home/testuser               Shell: /bin/ksh
    Last login Sat Apr 22 16:05 (EDT) on ttyC2
    No Mail.
    No Plan.

In addition to these commands, user(8) provides its own utility to show user
characteristics, called userinfo(8).

    $ userinfo testuser
    login   testuser
    passwd  *
    uid     1002
    groups  guest
    change  Wed Dec 31 19:00:00 1969
    class
    gecos   Test FAQ User
    dir     /home/testuser
    shell   /bin/ksh
    expire  Wed Dec 31 19:00:00 1969

Removing users

To remove users with the user(8) hierarchy of commands, you will use userdel
(8). This is a very simple, yet usable command. To remove the user created in
the last example, simply:

    # userdel -r testuser

Notice the -r option, which must be specified if you want the users home
directory to be deleted as well. Alternatively, you can specify -p and not -r
and this will lock the user's account, but not remove any information.

10.10 - How do I create an ftp-only account (not anonymous FTP!)?

There are a few ways to do this, but a very common way to do such is to add "/
usr/bin/false" into "/etc/shells". Then when you set a users shell to "/usr/
bin/false", they will not be able log in interactively, but will be able to
use ftp capabilities. You may also want to restrict access by Confining users
to their home directory in ftpd.

10.11 - Setting up Quotas

Quotas are used to limit user's space that they have available to them on your
disk drives. It can be very helpful in situations where you have limited
resources. Quotas can be set by user and/or by group.

The first step to setting up quotas is to make sure that "option QUOTA" is in
your Kernel Configuration. This option is in the GENERIC kernel. After this,
you need to mark in /etc/fstab the filesystems which will have quotas enabled.
The keywords userquota and groupquota should be used to mark each filesystem
that you will be using quotas on. By default, the files quota.user and
quota.group will be created at the root of that filesystem to hold the quota
information. This default can be overridden by specifying the file name with
the quota option in /etc/fstab, such as "userquota=/var/quotas/quota.user".
Here is an example /etc/fstab that has one filesystem with userquotas enabled,
and the quota file in a non-standard location:

    /dev/wd0a / ffs rw,userquota=/var/quotas/quota.user 1 1

Now it's time to set the user's quotas. To do so you use the utility edquota
(8). A simple use is just "edquota <user>". edquota(8) will use vi(1) to edit
the quotas unless the environmental variable EDITOR is set to a different
editor. For example:

    # edquota ericj

This will give you output similar to this:

    Quotas for user ericj:
    /: KBytes in use: 62, limits (soft = 0, hard = 0)
            inodes in use: 25, limits (soft = 0, hard = 0)

To add limits, edit it to give results like this:

    Quotas for user ericj:
    /: KBytes in use: 62, limits (soft = 1000, hard = 1050)
            inodes in use: 25, limits (soft = 0, hard = 0)

Note that the quota allocation is in 1k blocks. In this case, the softlimit is
set to 1000k, and the hardlimit is set to 1050k. A softlimit is a limit where
the user is just warned when they cross it and have until their grace period
is up to get their disk usage below their limit. Grace periods can be set by
using the -t option on edquota(8). After the grace period is over the
softlimit is handled as a hardlimit. This usually results in an allocation
failure.

Now that the quotas are set, you need to turn the quotas on. To do this use
quotaon(8). For example:

    # quotaon -a

This will go through /etc/fstab to turn on the filesystems with quota options.
Now that quotas are up and running, you can view them using quota(1). Using a
command of "quota <user>" will give that user's information. When called with
no arguments, the quota(1) command will give your quota statistics. For
example:

    # quota ericj

Will result in output similar to this:

    Disk quotas for user ericj (uid 1001):
         Filesystem  blocks   quota   limit   grace   files   quota   limit   grace
                  /      62    1000    1050              27       0       0

By default quotas set in /etc/fstab will be started on boot. To turn them off
use

    # quotaoff -a

10.13 - Setting up Anonymous FTP Services

Anonymous FTP allows users without accounts to access files on your computer
via the File Transfer Protocol. This will give an overview of setting up the
anonymous FTP server, and its logging, etc.

Adding the FTP account

To start off, you need to have an ftp account on your system. This account
should not have a usable password. Here we will set the login directory to /
home/ftp, but you can put it wherever you want. When using anonymous ftp, the
ftp daemon will chroot itself to the home directory of the ftp user. To read
up more on that, read the ftpd(8) and chroot(2) man pages. Here is an example
of adding the ftp user. I will do this using adduser(8). We also need to add /
usr/bin/false to our /etc/shells, this is the "shell" that we will be giving
to the ftp user. This won't allow them to login, even though we will give them
an empty password. To do this you can simply do

    # echo /usr/bin/false >> /etc/shells

After this, you are ready to add the ftp user:

    # adduser
    Use option ``-silent'' if you don't want to see all warnings and questions.

    Reading /etc/shells
    Check /etc/master.passwd
    Check /etc/group

    Ok, let's go.
    Don't worry about mistakes. There will be a chance later to correct any input.
    Enter username []: ftp
    Enter full name []: anonymous ftp
    Enter shell csh false ksh nologin sh [ksh]: false
    Uid [1002]: Enter
    Login group ftp [ftp]: Enter
    Login group is ``ftp''. Invite ftp into other groups: guest no
    [no]: Enter
    Login class authpf daemon default staff [default]: Enter
    Enter password []: Enter
    Disable password logins for the user? (y/n) [n]: y

    Name:        ftp
    Password:    ****
    Fullname:    anonymous ftp
    Uid:         1002
    Gid:         1002 (ftp)
    Groups:      ftp
    Login Class: default
    HOME:        /home/ftp
    Shell:       /usr/bin/false
    OK? (y/n) [y]: Enter
    Added user ``ftp''
    Copy files from /etc/skel to /home/ftp
    Add another user? (y/n) [y]: n
    Goodbye!

Directory Setup

Along with the user, this created the directory /home/ftp (though you can use
other locations as well, of course). There are some changes that we will have
to make to get it ready for anonymous ftp. Again these changes are explained
in the ftpd(8) man page.

You do not need to make a /home/ftp/usr or /home/ftp/bin directory.

  * /home/ftp - This is the main directory. It should be changed to be owned
    by root and to have permissions of 555. It should not be writable by the
    "ftp" user!
  * /home/ftp/etc - This is entirely optional and not recommended, as it only
    serves to give out information on users which exist on your box. If you
    want your anonymous ftp directory to appear to have user and group names
    attached to your files, you should copy /etc/pwd.db and /etc/group to this
    directory. This directory should be mode 511, and the two files should be
    mode 444. These are used to give owner names as opposed to numbers. There
    are no passwords stored in pwd.db, they are all in spwd.db, so don't copy
    that over. Without the user files, the files will have their group and
    owners shown as numbers, which is rarely a problem.
  * /home/ftp/pub - This is a standard directory to place files in which you
    wish to share. This directory should also be mode 555.

Note that all these directories should be owned by ''root''. Here is a listing
of what the directories should look like after their creation.

    # pwd
    /home
    # ls -laR ftp
    total 5
    dr-xr-xr-x  5 root  ftp    512 Jul  6 11:33 .
    drwxr-xr-x  7 root  wheel  512 Jul  6 10:58 ..
    dr-x--x--x  2 root  ftp    512 Jul  6 11:34 etc
    dr-xr-xr-x  2 root  ftp    512 Jul  6 11:33 pub

    ftp/etc:
    total 43
    dr-x--x--x  2 root  ftp    512 Jul  6 11:34 .
    dr-xr-xr-x  5 root  ftp    512 Jul  6 11:33 ..
    -r--r--r--  1 root  ftp    316 Jul  6 11:34 group
    -r--r--r--  1 root  ftp  40960 Jul  6 11:34 pwd.db

    ftp/pub:
    total 2
    dr-xr-xr-x  2 root  ftp  512 Jul  6 11:33 .
    dr-xr-xr-x  5 root  ftp  512 Jul  6 11:33 ..

Starting up the server and logging

You can choose to start ftpd either by inetd(8) or from the rc scripts.
Generally, running ftpd as a daemon from the rc scripts is recommended and is
what we will show here; a sample line for running it from inetd(8) is
commented out in the default /etc/inetd.conf.

Here is an example line to add to /etc/rc.conf.local to start ftpd(8) at boot.

    ftpd_flags="-llUSA"

The options used here are:

  * ll - detailed logging to syslog.
  * U - log users so who(1) and similar programs can see them.
  * S - log transfers to /var/log/ftpd.
  * A - permit only anonymous FTP transfers.

It is not necessary to give startup options to ftpd to allow anonymous
connections; the preceding steps of creating the 'ftp' user is sufficient.
However, to stop anonymous connections it isn't necessary to undo everything,
just restart ftpd with the -n option included. Anonymous connections are then
disabled.

Other relevant files

  * /etc/ftpwelcome - This holds the Welcome message for people once they have
    connected to your ftp server.
  * /etc/motd - This holds the message for people once they have successfully
    logged into your ftp server.
  * .message - This file can be placed in any directory. It will be shown once
    a user enters that directory.

10.14 - Confining users to their home directories in ftpd(8)

By default, when logging in by ftp, users can change to any directory on the
filesystem that they have access to. This may not be desirable in some cases.
It is possible to restrict what users may see through ftp sessions by
chrooting them to their home directory.

If you only wish to allow chrooted ftp logins, use the -A option to ftpd(8).

If you wish to apply them more finely, OpenBSD's login capability
infrastructure and ftpd(8) together make this easy.

Users in a login class with the ftp-chroot variable set are automatically
chrooted. Additionally, you can add a username to the file /etc/ftpchroot to
chroot those usernames. A user only needs to be listed in one of these
locations.

10.15 - Applying patches in OpenBSD

Even with OpenBSD, bugs happen. Some bugs may lead to reliability issues
(i.e., something may cause the system to stop functioning as desired). Other
bugs may lead to security vulnerabilities (which may allow others to "use"
your computer in unintended and unauthorized ways). When a critical bug is
found, the fix will be committed to the -current source tree, and patches will
be released for the supported releases of OpenBSD. These patches appear on the
errata web page, and are separated into "common" errata that impact all
platforms, and errata that impact only one or more, but not all, platforms.

Note, however, that patches aren't released for new features or additional
hardware support for OpenBSD, and are only published for important reliability
fixes or security problems that should be addressed right away on impacted
systems (which is often NOT all systems, depending on their purpose).

There are three ways to update your system with patched code:

  * Upgrade your system to -current. As all fixes are applied to the -current
    code base, updating your system to the latest snapshot is a very good way
    to apply fixed code. However, running -current is not for everyone.
  * Update your system to -stable. This is done by fetching or updating your
    source tree using the appropriate -stable branch, and recompiling the
    kernel and userland files. Overall, this is probably the easiest way,
    though it takes longer (as the entire system gets recompiled) and a
    complete source checkout can take a long time if you have limited
    bandwidth available.
  * Patch, compile and install individual impacted files. This is what we will
    use for our example below. While this requires less bandwidth and
    typically less time than an entire cvs(1) checkout/update and source code
    compilation, this is sometimes the most difficult option, as there is no
    one universal set of instructions to follow. Sometimes you must patch,
    recompile and install one application, other times, you might have to
    recompile entire sections of the tree if the problem is in a library file.

Again, patching individual files is not always simple, so give serious thought
to following the -stable (or "patch") branch of OpenBSD. Mixing and matching
of patching solutions can be done if you understand how everything works, but
new users should pick one method and stick with it.

How are "errata" patches different from what is in the CVS tree?

All patches posted to the errata web page are patches directly against the
indicated release's source tree. Patches against the latest CVS tree might
also include other changes that wouldn't be wanted on a release system. This
is important: If you have installed a snapshot, checked out the source trees
at the time you obtained that snapshot and attempt to patch it using a
published patch, you may well find the patch doesn't apply, as that code may
have changed.

Applying patches.

Patches for OpenBSD are distributed as unified diffs, which are text files
that hold differences to the original source code. They are NOT distributed in
binary form. This means that to apply a patch you must have the source code
from the RELEASE version of your system available. In general, it is advisable
to acquire the entire source tree before applying a patch. If you are running
a release from an official CDROM, the source trees are available as files on
disk 3, and these can also be downloaded from the FTP servers. We will assume
you have the entire tree checked out.

For our example here, we will look at patch 011 for OpenBSD 5.6, dealing with
pppoe(4) connections. Without this patch, MAC addresses could get corrupted.
People using PPPOE needed this patch, however those who didn't may have had no
particular need to install it. Let's look at the patch:

    # more 011_pppoe.patch.sig
    Apply patch using:

        signify -Vep /etc/signify/openbsd-56-base.pub -x 011_pppoe.patch.sig \
            -m - | (cd /usr/src && patch -p0)

    Then build and install a new kernel.

    Index: sys/net/if_ethersubr.c
    ===================================================================
    RCS file: /cvs/src/sys/net/if_ethersubr.c,v
    retrieving revision 1.174
    diff -u -p -r1.174 if_ethersubr.c
    --- sys/net/if_ethersubr.c      12 Jul 2014 18:44:22 -0000      1.174
    +++ sys/net/if_ethersubr.c      1 Dec 2014 17:48:55 -0000
    @@@@ -673,7 +673,12 @@@@ decapsulate:
                            goto done;

                    eh_tmp = mtod(m, struct ether_header *);
    -               memcpy(eh_tmp, eh, sizeof(struct ether_header));
    +               /*
    +                * danger!
    +                * eh_tmp and eh may overlap because eh
    +                * is stolen from the mbuf above.
    +                */
    +               memmove(eh_tmp, eh, sizeof(struct ether_header));
     #ifdef PIPEX
                    if (pipex_enable) {
                            struct pipex_session *session;

As you will note, the top of the patch includes brief instructions on applying
it. As of OpenBSD 5.5, patches are cryptographically signed with the signify
(1) tool. We will assume you have put this patch into your current working
directory, in which case the following steps are used:

    # signify -Vep /etc/signify/openbsd-56-base.pub -x 011_pppoe.patch.sig \
      -m - | (cd /usr/src && patch -p0)
    Hmm...  Looks like a unified diff to me...
    The text leading up to this was:
    --------------------------
    |
    |OpenBSD 5.6 errata 11, Dec 5, 2014:
    |
    |An incorrect memcpy call would result in corrupted MAC addresses when
    |using PPPOE.
    |
    |Apply patch using:
    |
    |    signify -Vep /etc/signify/openbsd-56-base.pub -x 011_pppoe.patch.sig \
    |        -m - | (cd /usr/src && patch -p0)
    |
    |Then build and install a new kernel.
    |
    |Index: sys/net/if_ethersubr.c
    |===================================================================
    |RCS file: /cvs/src/sys/net/if_ethersubr.c,v
    |retrieving revision 1.174
    |diff -u -p -r1.174 if_ethersubr.c
    |--- sys/net/if_ethersubr.c     12 Jul 2014 18:44:22 -0000      1.174
    |+++ sys/net/if_ethersubr.c     1 Dec 2014 17:48:55 -0000
    --------------------------
    Patching file sys/net/if_ethersubr.c using Plan A...
    Hunk #1 succeeded at 673.              <-- Look for this message!
    done

Note the "Hunk #1 succeeded" message above. This indicates the patch was
applied successfully. Many patches are more complex than this one, and will
involve multiple hunks and multiple files, in which case you should verify
that all hunks succeeded on all files. If they did not, it normally means your
source tree was different in some way from the release source tree the patch
was created from, or you didn't follow instructions carefully, or your patch
was mangled. Patches are very sensitive to "white space" -- copying and
pasting from your browser will often change tab characters into spaces or
otherwise alter the white space of a file, making it not apply.

At this point, you can build and install the new kernel, then reboot the
system as normal.

Not all patches are for the kernel. In some cases, you will have to rebuild
individual utilities. At other times, will require recompiling all utilities
statically linked to a patched library. Follow the guidance in the header of
the patch and, if uncertain, rebuild the entire system.

Patches that are irrelevant to your particular system need not be applied --
usually. For example, if you did not use PPPOE connections on your system, you
would not benefit from the above patch. However, patches are assumed to be
applied "in order" -- it is possible that a later patch is dependent upon an
earlier one. Be aware of this if you elect to "pick and choose" which patches
you apply, and if in doubt, apply them all in order.

10.17 - Can I change the root shell?

It is sometimes said that one should never change the root shell, though there
is no reason not to in OpenBSD.

The default shell for root on OpenBSD is ksh.

A traditional Unix guideline is to only use statically compiled shells for
root, because if your system comes up in single user mode, non-root partitions
won't be mounted and dynamically linked shells won't be able to access
libraries located in the /usr partition. This isn't actually a significant
issue for OpenBSD, as the system will prompt you for a shell when it comes up
in single user mode, and the default is sh. The three standard shells in
OpenBSD (csh, sh and ksh) are all statically linked, and thus usable in single
user mode.

10.18 - What else can I do with ksh?

In OpenBSD, ksh is pdksh, the Public Domain Korn Shell, and is the same binary
as sh.

Users comfortable with bash, often used on Linux systems, will probably find
ksh very familiar. Ksh(1) provides most of the commonly used features in bash,
including tab completion, command line editing and history via the arrow keys,
and CTRL-A/CTRL-E to jump to beginning/end of the command line. If other
features of bash are desired, bash itself can be loaded via either packages or
ports.

The command prompt of ksh can easily be changed to something providing more
information than the default "$ " by setting the PS1 variable. For example,
inserting the following line:

    export PS1='$PWD $ '

in your /etc/profile produces the following command prompt:

    /home/nick $

See the file /etc/ksh.kshrc, which includes many useful features and examples,
and may be invoked in your user's .profile.

OpenBSD's ksh(1) has been enhanced with a number of "special characters" for
the primary prompt string, PS1, similar to those used in bash. For example:

    \e - Insert an ASCII escape character.
    \h - The hostname, minus domain name.
    \H - The full hostname, including domain name.
    \n - Insert a newline character.
    \t - The current time, in 24-hour HH:MM:SS format.
    \u - The current user's username.
    \w - The current working directory. $HOME is abbreviated as `~'.
    \W - The basename of the current working directory.
    \$ - Displays "#" for root users, "$" for non-root users.

(see the ksh(1) man page for more details, and many, many more special
characters! Also note the "$" character has special meaning inside double
quotes, so handle it carefully)

One could use the following command:

    export PS1="\n\u@@\H\n\w \\$ "

to give an overly verbose but somewhat useful prompt.

10.19 - Directory services

OpenBSD can be used for both servers and clients of databases containing user
credentials, group information and other network-related data.

10.19.1 - Which directory services are available?

Of course, you could use various directory services on OpenBSD. But YP is the
only one that can be accessed directly using standard C-library functions like
getpwent(3), getgrent(3), gethostbyname(3) and so on. Thus, if you keep your
data in a YP database, you do not need to copy it to local configuration files
like master.passwd(5) before you can use it, for example to authenticate
system users.

YP is a directory service compatible with Sun Microsystems NIS (Network
Information System). See yp(8) for an overview of the available manual pages.
Be careful, some operating systems contain directory services bearing similar
names but all the same being incompatible, for example NIS+.

To use other directory services except YP, you either need to populate local
configuration files from the directory, or you need a YP frontend to the
directory. For example, you can use the sysutils/login_ldap port when you
choose the former, while the ypldap(8) daemon provides the latter.

For some applications, simply synchronizing a small number of configuration
files among a group of machines using tools like cron(8), scp(1) or rsync
(available from ports) constitutes an easy and robust alternative to a
full-blown directory service.

10.19.2 - YP security considerations

For compatibility reasons, all security features built into the OpenBSD
implementation of YP are switched off by default. Even when they are all
switched on, the NIS protocol is still inherently insecure for two reasons:
All data, including sensitive data like password hashes, is transmitted
unencrypted across the network, and neither the client nor the server can
reliably verify each other's identity.

Thus, before setting up any YP server, you should consider whether these
inherent security flaws are acceptable in your context. In particular, YP is
inadequate if potential attackers have physical access to your network.
Anybody gaining root access to any computer connected to your network segments
carrying YP traffic can bind your YP domain and retrieve its data. In some
cases, passing YP traffic through SSL or IPSec tunnels might be an option.

10.19.3 - Setting up a YP server

 1. A YP server serves a group of clients called a "domain". You should first
    select a domain name; it can be an arbitrary string and need not be
    related in any way to DNS domain names. Choosing a random name like
    "Eepoo5vi" can marginally improve security, though the effect is mostly in
    security by obscurity. In case you need to maintain several distinct YP
    domains, it's probably better to choose descriptive names like "sales",
    "marketing" and "research" in order to forestall system administration
    errors caused by obscurity. Also note that some versions of SunOS require
    using the host's DNS domain name, so your choice might be restricted in a
    network including such hosts.

    Use the domainname(1) utility to set the domain name, and put it into the
    file defaultdomain(5) to have it automatically set at system startup time.

        echo "puffynet" > /etc/defaultdomain
        domainname `cat /etc/defaultdomain`

 2. Initialise the YP server using the interactive command

        ypinit -m

    At this point, it is not necessary to specify slave servers yet. To add
    slave servers, you can rerun ypinit(8) later, using the -u option. Setting
    up at least one slave server for each domain is useful to avoid service
    interruptions, should the master server ever go down or lose network
    connectivity, in particular since client processes trying to access YP
    maps block indefinitely until they receive the requested information.
    Thus, YP service interruptions typically render the client hosts
    completely unusable until YP is back to service.
 3. Decide where to store the source files to generate your YP maps from.
    Keeping the server configuration separate from the served configuration
    helps to control which information will be served and which won't, so the
    default /etc often isn't the best choice.

    The only inconvenience caused by changing the source directory is that you
    will not be able to add, remove and modify users and groups in the YP
    domain using utilities like user(8) and group(8). Instead, you will have
    to edit the configuration files with a text editor.

    To define the source directory, edit the file /var/yp/`domainname`/
    Makefile and change the DIR variable, e.g.

        DIR=/etc/yp/src/puffynet

 4. Consider customizing other variables in /var/yp/`domainname`/Makefile. See
    Makefile.yp(8) for details.

    For example, even in case you use the default source directory /etc, you
    do not usually need all accounts and groups existing on the server on all
    your client hosts. In particular, not serving the root account and thus
    keeping root's password hash confidential is often beneficial to security.
    Review the values of MINUID, MAXUID, MINGID and MAXGID and adjust them to
    you needs.

    If all your YP clients run OpenBSD or FreeBSD, exclude the encrypted
    passwords from the passwd maps by setting UNSECURE="" in /var/yp/
    `domainname`/Makefile.

    The former practice of editing the template file /var/yp/Makefile.yp is no
    longer recommended. Changes to that file affect all domains initialized
    after the change, but do not affect domains initialized before the change,
    so this is error-prone either way: You both risk that the intended changes
    do not take effect, and you risk to forget about them and have them affect
    other domains later which they were never intended for.
 5. Create the source directory and populate it with the configuration files
    you need. See Makefile.yp(8) to learn which YP maps require which source
    files. For the format of the individual configuration files, refer to
    passwd(5), group(5), hosts(5) and so on, and look at the examples in /etc.
 6. Create the initial version of your YP maps using the commands

        cd /var/yp
        make

    Do not worry about error messages from yppush(8) right now. The YP server
    is not yet running.
 7. YP uses rpc(3) (remote procedure calls) to communicate with clients, so it
    is necessary to enable portmap(8). To do so, edit rc.conf.local(8) and set
    portmap_flags="". This will start the portmapper on next boot. You can
    avoid rebooting by also starting it manually:

        echo 'portmap_flags=""' >> /etc/rc.conf.local
        portmap

 8. Consider using either the securenet(5) or the ypserv.acl(5) security
    feature of the YP server daemon. But be aware that both of these only
    provide IP based access control. Thus, they only help as long as potential
    attackers have neither physical access to the hardware of the network
    segments carrying your YP traffic nor root access to any host connected to
    those network segments.
 9. Finally, start the YP server daemon:

        ypserv

    It will automatically be restarted at boot time as long as the directory /
    var/yp/`domainname` continues to exist.
10. To test the new server, consider making it its own client, following the
    instructions in the first part of the next section. In case you don't want
    the server to use its own maps, you can disable the client part after the
    test with the following commands:

        pkill ypbind
        rm -rf /var/yp/binding

11. If you wish to allow users to change their passwords from client machines,
    then you must enable yppasswdd(8):

        echo 'yppasswdd_flags="-d /etc/yp/src/puffynet"' >> /etc/rc.conf.local
        rpc.yppasswdd

    In case you left the source directory at the default /etc, just use
    yppasswdd_flags="".
12. Remember that each time you change a file sourced by a YP map, you must
    regenerate your YP maps.

        cd /var/yp
        make

    This updates all database files in /var/yp/`domainname`, with one
    exception: The file ypservers.db, listing all YP master and slave servers
    associated with the domain, is created directly from ypinit -m and
    modified exclusively by ypinit -u. In case you accidentally delete it, run
    ypinit -u to recreate it from scratch.

10.19.4 - Setting up a YP client

Setting up a YP client involves two distinct parts. First, you must get the YP
client daemon running, binding your client host to a YP server. Completing the
following steps will allow you to retrieve data from the YP server, but that
data will not yet be used by the system:

 1. Like on the server, you must set the domain name and enable the
    portmapper:

        echo "puffynet" > /etc/defaultdomain
        domainname `cat /etc/defaultdomain`
        echo 'portmap_flags=""' >> /etc/rc.conf.local
        portmap

 2. It is recommended to provide a list of YP servers in the configuration
    file /etc/yp/`domainname`. Otherwise, the YP client daemon will use
    network broadcasts to find YP servers for its domain. Explicitly
    specifying the servers is both more robust and marginally less open to
    attack. If you have not set up any slave servers, just put the host name
    of the master server into /etc/yp/`domainname`.
 3. The YP client daemon is called ypbind(8). Starting it manually will create
    the directory /var/yp/binding, such that it will be automatically
    restarted at boot time.

        ypbind

 4. If all went well you should be able to query the YP server using ypcat(1)
    and see your passwd map returned.

        ypcat passwd
        bob:*:5001:5000:Bob Nuggets:/home/bob:/usr/local/bin/zsh
        ...

    Other useful tools for debugging your YP setup include ypmatch(1) and
    yptest(8).

The second part of configuring a YP client involves editing local
configuration files such that certain YP maps get used by various system
facilities. Not all servers serve all standard maps supported by the operating
system, some servers serve additional non-standard maps, and you are by no
means compelled to use all those maps. Which of the available maps shall or
shall not be used, and for which purposes they shall be used, is fully at the
discretion of the client host's system administrator.

For a list of standard YP maps and their standard usage, see Makefile.yp(8).
The most common use cases include:

  * If you want to include all user accounts from the YP domain, append the
    default YP marker to the master password file and rebuild the password
    database:

        echo '+:*::::::::' >> /etc/master.passwd
        pwd_mkdb -p /etc/master.passwd

    For details on selective inclusion and exclusion of user accounts, see
    passwd(5). To test whether inclusion actually works, use the id(1)
    utility.
  * If you want to include all groups from the YP domain, append the default
    YP marker to the group file:

        echo '+:*::' >> /etc/group

    For details on selective group inclusion, see group(5).
  * If you are distributing hostnames via YP, you should now review
    resolv.conf(5) and check that the name service lookup order is correct.
    Most users will require a line like this:

        lookup file yp bind

10.20 - Character sets and localization

OpenBSD uses the ASCII character set by default. It also supports the Latin
(ISO-8859-*), KOI-8, and Unicode (UTF-8) character sets.

10.20.1 - Configuring the active character set

To use one of the extended character sets, the LC_CTYPE environment variable
must be set to the name of a supported locale. LC_CTYPE will only affect the
character set available to applications. It will not change the language used
for application messages.

The list of supported locales can be obtained by running the command:

    locale -a

The LC_CTYPE environment variable can be set in one of the following ways:

  * If logging in via xdm(1) add a line such as

        export LC_CTYPE="en_US.UTF-8"

    to ~/.xsession before starting the window manager (see the section on
    customizing X for details). This example enables the Unicode (UTF-8)
    character set and will also cause applications such as xterm(1) to enable
    UTF-8 mode by default.
  * If logging in via the text console add a line such as

        export LC_CTYPE="en_US.ISO8859-1"

    to ~/.profile. Note that the text console supports ASCII and ISO8859-1
    only. It does not support UTF-8.

Few utilities in the base system support UTF-8 at this time. Most will use
ASCII in the UTF-8 locale. However, many programs from the ports collection do
support UTF-8.

UTF-8 can also be used with specific applications only by starting those
applications in uxterm(1). This works even if the login session uses a
non-UTF-8 locale.

When logging into remote systems with ssh(1), the LC_CTYPE environment
variable is not propagated and will need to be manually set to the same value
used by the local terminal.

10.20.2 - Changing the language used in application messages

The language used for application messages can be changed by setting the
LC_MESSAGES environment variable to the name of a supported locale. This can
be done in the same way as described for LC_CTYPE above. Both LC_MESSAGES and
LC_CTYPE should be set to the same value.

Few utilities in the base system support languages other than English at this
time. However, many programs from the ports collection support localized
messages in various languages. They will fall back to English if the desired
language is not available.

------------------------------------------------------------------------------

==============================================================================

11 - The X Window System

------------------------------------------------------------------------------

Table of Contents

  * 11.1 - Introduction to X
  * 11.2 - Configuring X
  * 11.4 - Starting X
  * 11.5 - Customizing X

------------------------------------------------------------------------------

11.1 - Introduction to X

The X Window System (sometimes just called "X", other times, incorrectly
called "X Windows") is the environment which provides graphics services to
OpenBSD and other Unix-based systems. However, by itself, X provides very
little: one also must have a "Window Manager", to present a user interface.
Most of the "personality" one will feel from X will be due to the window
manager, rather than X itself. OpenBSD ships with a free version of the fvwm
(1) and cwm(1) window managers, although you may wish to use any of the other
window managers that are in packages. Search using a key of "window manager"
for a list of the many window managers available.

X is considered a "client-server" structured protocol, however the terminology
is sometimes confusing. The computer with the graphics on the screen is the "X
Server". The application which directs the X server what to put on its screen
is the "X Client", even though it may be a much more powerful computer in a
data center. This model can be used to have large, processor intensive
applications (X clients) running on a very powerful machine, using the X
Server running on a small, low power machine on your desk for their user
interface.

It is possible to run X clients on a system without any graphical support. For
example, one could have an application (the X client) running on an armv7
system, displaying its output on a SPARC's graphical display (the X server).
Since X is a well-defined, cross-platform protocol, it is even possible to
have an X application running on (for example) a Solaris machine use an
OpenBSD machine for its display.

The client and server can also be running on the same machine, and for most of
this section, that will be the assumption.

11.1.1 - How much computer do I need to run X?

X itself is a pretty large program, a fast computer will be appreciated if you
are starting it and stopping it regularly. However, once running, it performs
pretty responsively on a very modest computer. To get responsive display
performance on some platforms, even for just text, you will want to run X.
These platforms, such as sparc and sparc64, were intended to be used with a
graphical interface, and the text console performance is very poor.

That being said, the point of running X is usually to run X applications. Some
X applications are very lean, others will seemingly take and use all the
processor and RAM you can give them. Of course, some users just like to use X
to provide a large number of xterm(1)s, which can be done on very modest
hardware.

11.1.2 - Can I have any kind of graphics without X?

Assuming you won't accept ASCII graphics, that requires some kind of
framebuffer console driver. Some operating systems provide this, but there is
not currently one for OpenBSD, nor is there much interest among developers for
one.

11.2 - Configuring X

Good news: In the vast majority of hardware in most platforms, X requires no
configuration at all, it Just Works.

The details of manual configuration of X varies considerably from platform to
platform. In all cases, there will be instructions and other platform-specific
information in /usr/X11R6/README in the installed system.

Several platforms require the xf86(4) X aperture driver, which provides access
to the memory and I/O ports of a VGA board and the PCI configuration registers
required by the X servers. This driver must be enabled before it is used,
either by answering "yes" to this question during install:

    Do you expect to run the X window System [no]

or by changing the value of machdep.allowaperture to the appropriate non-zero
value in /etc/sysctl.conf for your platform, and rebooting the machine (this
sysctl cannot be changed after boot has been completed for security reasons).
There are security implications to this, so do not do this if you do not need
it.

11.2.1 - alpha

No X server, only X clients.

11.2.2 - amd64

/usr/X11R6/README for amd64.

In some cases, set machdep.allowaperture=2 in /etc/sysctl.conf. If needed,
this is usually prompted for by the installer.

For the vast majority of users, X on amd64 auto-configures successfully, so no
further configuration is needed.

11.2.3 - armish

No X servers, only X clients.

11.2.5 - hppa

No X server, only X clients.

11.2.6 - i386

/usr/X11R6/README for i386.

In some cases, set machdep.allowaperture=2 in /etc/sysctl.conf. If needed,
this is usually prompted for by the installer.

For the vast majority of users, X on i386 auto-configures successfully, so no
further configuration is needed.

11.2.7 - landisk

No X servers, only X clients.

11.2.8 - loongson

No configuration needed.

11.2.9 - luna88k

/usr/X11R6/README for luna88k.

11.2.10 - macppc

/usr/X11R6/README for macppc.

Set machdep.allowaperture=2 in /etc/sysctl.conf.

Supported Macintosh PPC systems can be run in one of two different ways:
"accelerated" and "framebuffer" (unaccelerated).

In the "framebuffer" mode, the system will be running with 8 bits per pixel,
and the video resolution is controlled by the Macintosh environment, so you
will probably want to keep a small MacOS section on your disk to adjust these
settings. This mode has the advantage of "Just Working", however it can be
frustratingly inflexible (for example, altering resolution may require booting
MacOS).

If your Macintosh has an ATI-based video system, it can run using an
accelerated X server, which gives better performance and more control in the
OpenBSD environment. The NVIDIA video cards in some macppc systems will also
work in many cases. The README file has details on configuring the accelerated
driver, start by using the sample file there.

While the README file details using the standard Apple one-button mouse with
X, unless you are using a laptop, it is highly recommended that you just buy a
modern third-party USB mouse with three or more buttons.

CRT iMacs and X

iMacs have a very unusual (in this day) CRT, in that it has a fixed horizontal
scan frequency. Attempting to use a horizontal sweep speed outside a very
narrow range will cause the monitor to not light up. The following lines,
added to xorg.conf in the Section "Monitor" area seem to make a lot of
CRT-based iMacs in the 333MHz to 500MHz range (and possibly more!) work well:

            HorizSync       60.0 - 60.0
            VertRefresh     43.0 - 117.0

You may wish to restrict the lower limit of VertRefresh to values that you are
more likely to find acceptable, for example 70.

11.2.13 - sgi

X runs on the O2 system's frame buffer in unaccelerated mode.

11.2.14 - sparc

/usr/X11R6/README for sparc.

With a single supported framebuffer, there is no configuration needed. If you
wish to use a multi-headed configuration, see the above README file for
details.

Resolution is controlled by the firmware before booting OpenBSD.

11.2.15 - sparc64

/usr/X11R6/README for sparc64.

Most simple configurations now "Just Work". If yours does not or you wish to
get fancy, see the above README file.

11.2.16 - vax

No X servers, only X clients.

11.2.17 - zaurus

/usr/X11R6/README for zaurus.

No configuration needed, X "Just Works".

11.4 - Starting X

There are two common ways to run X:

11.4.1 - On Demand:

Log in to a console as normal, then run startx(1).

11.4.2 - Boot directly into X:

This is done using xdm(1), the X Display Manager. xdm(1) is started as root,
normally by rc, and presents a login prompt. Upon successful login, it starts
an X session for that user. If or when that X session should be terminated
(including by hitting CTRL-ALT-Backspace), xdm(1) will return, prompting the
user to login again. For this reason, do NOT attempt to start xdm(1) from /etc
/rc.conf.local until you have verified X works as you wish, or your machine
may become very difficult to manage! (worst case: boot single user, as if you
lost your password, and edit out the xdm_flags line in your /etc/rc.conf.local
file.)

On some platforms, you will need to disable the console getty(8) to use xdm
(1).

11.5 - Customizing X

11.5.1 - Introduction

OpenBSD's default X environment is fully functional, but you may wish to
customize it. You may wish to change the background pattern or color, or you
may wish to change the Window Manager (the program that most defines your X
environment), or change the applications that are started when X starts.

The default window manager in OpenBSD is fvwm(1). Fvwm is a good, general
purpose window manager, but it is hardly your only choice; it isn't even the
only window manager included with OpenBSD (see cwm(1) and twm(1)). A large
number of window managers are also available through packages.

Similar to the system startup script, X has a process it goes through to set
up the user environment. More accurately, it has more than one process; which
process is used depends on how you start X. Understanding how X starts will
help you understand how to customize your work environment the way you wish it
to be.

Note that you can customize the environment on both a system-wide and user
level. It is probably best to do user level changes rather than to change the
system defaults, as the user scripts are stored in the user's home directory,
so you will have less merging of files to do when upgrading to a new version
of OpenBSD.

11.5.2 - startx(1) startup

startx(1) looks for the file .xinitrc in the user's home directory. .xinitrc
is usually a shell script, which can start as many X "client" (applications
that use X) programs as desired. When this script exits, the X server shuts
down. Generally, most of the programs run by this script should run in the
background, though the last one should run in the foreground (typically the
window manager); when it exits, the script will exit, and X will be shutdown.

In the simplest case, this can be as little as just the name of the window
manager you wish to invoke:

    cwm

Or you can get a little more fancy:

    xconsole -geometry -0+0 -fn 5x7 &
    oclock -geometry 75x75-0-0 &
    xsetroot -solid grey &
    cwm

That will start the xconsole(1) which provides a copy of any text that the
kernel would have sent to the console (which is now covered by the graphical
screen), an analog clock, oclock(1), and sets the background to a solid grey
background with xsetroot(1) all before invoking the cwm(1) window manager.
Note that only the window manager is not "backgrounded" with an "&" character.
This means that X will stay running until cwm(1) exits.

If a user's home directory does not have a .xinitrc file in it, the system's /
etc/X11/xinit/xinitrc file is used. This file can provide you some additional
ideas for your .xinitrc script.

11.5.3 - xdm(1) startup

xdm(1) is usually started by the system startup scripts, but for testing
purposes (recommended, until you know your have your X config right!), it can
be run as root.

xdm(1) has a lot of other functionality that won't be touched on here, but for
our purposes, xdm will present the user with a login screen, get and verify a
user name and password, and then give the user their X environment. When X
shuts down, either deliberately or accidently, xdm will start it back up
again. This is why you want to make sure X is configured properly before using
xdm(1), and certainly before having xdm(1) start at boot, otherwise, you may
have some difficulty getting control of the machine.

When xdm(1) starts, it runs the /etc/X11/xdm/Xsession, which will check to see
if the user has a .xsession file in their home directory. So, if you wish to
change your default window manager, simply invoke it (and maybe other things)
in .xsession. Again, any programs you want started with X (for example, maybe
three xterm(1)s) can be placed here, but all should be backgrounded except for
your window manager, as again, when that exits, your X session will be ended.
In this case, xdm(1) will restart X and bring you back to a login screen.

11.5.4 - Trying a new window manager

You can invoke a particular window manager when you load X without altering
any defaults like this:

    $ startx /usr/local/bin/fluxbox

Several window managers (including cwm(1) and fvwm(1)) offer the ability to
change window managers on the fly, without restarting X or any of your
applications. Your new window manager replaces your old one; exiting the
newly-loaded window manager terminates X, it does not return you back to your
previous window manager. fvwm(1) allows you to start a different window
manager by left clicking on the background ("root window"), chose "(Re)Start",
then pick your preferred window manager (however, note that you will need to
add your alternative window managers to your .fvwmrc file (the system-wide
default is /usr/X11R6/lib/X11/fvwm/.fvwmrc)). cwm(1) allows you to invoke
another window manager by hitting Ctrl-Alt-w, and typing in the manager you
wish to switch to.

Once you have found a window manager you like, you can set it as the final
program run by your startup scripts as described above.

------------------------------------------------------------------------------

==============================================================================

12 - Hardware and Platform-Specific Questions

------------------------------------------------------------------------------

Table of Contents

  * 12.1 - General hardware notes
      + 12.1.1 - PCI
      + 12.1.2 - ISA
      + 12.1.3 - A device is "recognized" but says "not configured" in dmesg
      + 12.1.4 - I have a card listed as "supported", but it doesn't work!
      + 12.1.5 - Are WinModems supported?
      + 12.1.6 - What happened to the Adaptec RAID support (aac)?
      + 12.1.7 - My ami(4) card will only support one logical disk!
      + 12.1.8 - How do I activate my crypto accelerator card?
  * 12.2 - DEC Alpha
  * 12.3 - AMD 64
      + 12.3.1 - Can I run OpenBSD/amd64 on my Intel P4 or AMD Sempron?
      + 12.3.2 - Can I run my i386 binary on OpenBSD/amd64?
      + 12.3.3 - Is it always better to run OpenBSD/amd64 on processors that
        support it?
  * 12.4 - ARM-based appliances
  * 12.7 - HP Precision Architecture (PA-RISC)
  * 12.8 - i386
      + 12.8.1 - ISA NICs
      + 12.8.2 - OpenBSD won't work on my 80386/80386SX/80486SX system
      + 12.8.3 - My dmesg shows multiple devices sharing the same interrupt
      + 12.8.4 - My keyboard/mouse keeps locking up (or goes crazy)!
      + 12.8.5 - My Soekris/Alix/Lanner performs poorly
      + 12.8.6 - I get "missing interrupt" errors on my CF device
      + 12.8.7 - Is this really new CPU supported?
  * 12.9 - Landisk
  * 12.10 - Luna88k
  * 12.11 - MacPPC
      + 12.11.1 - My bm(4) network adapter doesn't work!
  * 12.14 - SGI
  * 12.15 - SPARC
  * 12.16 - UltraSPARC
      + 12.16.1 - My UltraSPARC won't boot from the floppy image
  * 12.17 - DEC VAX
      + 12.17.1 - Can I use the SIMH VAX simulator?
  * 12.18 - Sharp Zaurus
      + 12.18.1 - USB devices aren't working properly

------------------------------------------------------------------------------

12.1 - General hardware notes

12.1.1 - PCI devices

  * PCI devices are mostly self-configuring -- the computer and OS will
    allocate resources to the cards as required.
  * Interrupts can be shared on the PCI bus. Not only can they be, the system
    will often perform better when the IRQs are shared, especially on i386
    systems.
  * There are several different PCI bus standards. You will occasionally find
    a PCI2.2 specification card that will just not work in a PCI2.1
    specification system. Also, many cards with on-board bridges (such as,
    multi-port network cards) will not work well in older systems.
  * The PCI bus supports two levels of signaling, 3.3V and 5V. Cards that work
    with 3.3V signaling have a second notch cut in their PCI connector. Most
    PCI cards use 5V signaling, which is used by most computers. The Soekris
    single-board computers (Net45x1 and Net4801) are commonly-encountered
    computers that only support 3.3V signaling.

12.1.2 - ISA devices

  * ISA devices cannot share resources, and in general, must be manually
    configured to settings that don't conflict with other devices in the
    system.
  * Some ISA devices are "Plug and Play" (isapnp(4)) -- if you have any
    problem with these devices, though, verify their configuration in your
    dmesg(8), ISAPnP doesn't always work as desired.
  * In general, if you have a choice, most people are best advised to avoid
    ISA cards in favor of PCI. ISA cards are more difficult to configure and
    have a much greater negative impact on the system's performance.

12.1.3 - My device is "recognized" but says "not configured" in dmesg

In short, it means your device is not supported by the kernel you are using,
so you will not be able to use it.

PCI and many other types of devices offer identifying information so that the
OS can properly recognize and support devices. Adding recognition is easy,
adding support is often not. Here is part of a dmesg with two examples of "not
configured" devices:

    ...
    vendor "Intel", unknown product 0x5201 (class network subclass ethernet,
    rev 0x03) at pci2 dev 9 function 1 not configured
    ...
    "Intel EE Pro 100" rev 0x03 at pci2 dev 10 function 0 not configured
    ...

The first one (a network adapter) had its vendor code identified and the
general type of card was determined, but not the precise model of the card.
The second example was another network adapter, this one a developer had seen
and had entered into the identification file that is used to identify the
card. In both cases, however, the cards will be non-functional, as both are
shown as "not configured", meaning no driver has attached to the card.

What can I do about a not configured device?

  * If the device or card you are seeing is not one you need, you can safely
    ignore the "not configured" devices, they will not hurt your system. Some
    "special purpose" devices are deliberately left unconfigured so the
    system's BIOS will handle them.
  * In some cases, it is just a variation of an already supported device, in
    which case, it may be relatively easy for a developer to add support for
    the new card. In other cases, it may be a totally unsupported chip set or
    implementation (such as the above examples). In that case, a new driver
    would have to be written, which may not even be possible if the device is
    not fully documented. You are certainly welcome to write a driver for the
    device yourself.
  * If you are running an install kernel, the device may not be supported by
    the install media you used, but may be supported by a different boot disk.
    This is a common issue with users of some popular SCSI cards who misread
    the footnotes on the i386 platform page and try all the boot floppies
    their SCSI card is NOT supported on, rather than the one that it is
    supported on.
  * If you are running a modified kernel, you may have removed support for a
    device you now need. In general, removing devices from a kernel is a bad
    idea. This is one reason why.
  * Before reporting a "not configured" device, make sure you have first
    tested the most recent snapshot, as support may already have been added,
    and check the mail list archives to see if the issue has been discussed
    already. Remember, however, if you are using an older version of OpenBSD,
    you will generally have to upgrade to get the benefit of any new driver
    written.

12.1.4 - I have a card listed as "supported", but it doesn't work!

Unfortunately, many manufacturers use product model numbers to indicate
marketplace position, rather than the technical nature of a product. For this
reason, you may buy a product with the same name or model number as a product
listed in the platform pages, but end up with a totally different product that
may not work with OpenBSD. For example, many early wireless network adapters
were based on the Prism2 chip set, using the (wi(4)) driver, but later, when
lower-cost chips became available, many manufacturers changed their product to
use chips for which no open source drivers exist, but never changed their
model numbers. Wireless network adapters, unfortunately, are far from the only
example of this.

12.1.5 - Are WinModems supported?

WinModems are low-cost modems which rely on the processor to do much of the
signal processing normally done in hardware in a "real" modem. Due to the
variety of incompatible and typically undocumented WinModem chips, there is no
support for WinModems in OpenBSD, and this is not likely to change.

12.1.6 - What happened to the Adaptec RAID support (aac)?

Adaptec has refused to provide useful and accurate documentation about their
FSA-based (aac(4)) RAID controllers. As these RAID controllers seem to be very
buggy, this documentation is critical for a useful driver. Since this driver
was so unreliable, it was removed from the GENERIC kernel.

I can compile my own kernel with aac(4) support, right?

Sure. But what part of "unreliable" did you fail to understand? This isn't an
"experimental" feature, this is a known-flawed driver. Maybe it works with
some variations of hardware sufficiently well to be usable, but we don't
recommend betting your data on it.

12.1.7 - My ami(4) card will only support one logical disk!

There is a known bug with ami(4) which will cause data corruption if you use
more than one volume on some controllers. On controllers with this issue,
OpenBSD will limit you to one logical disk, resulting in a message in your
dmesg that looks like:

    ami0: FW A.04.03, BIOS vA.04.03, 4MB RAM
    ami0: 3 channels, 16 targets, 2 logical drives
    ami0: firmware buggy, limiting access to first logical disk
    scsibus0 at ami0: 1 targets

12.1.8 - How do I activate my crypto accelerator card?

Supported crypto accelerator hardware, such as the hifn(4) based cards will
"just work" when installed in an OpenBSD system. No activation or other
configuration is needed.

The overhead of talking to one of these devices will sometimes negate much or
all of the benefit of offloading the processor of the crypto tasks. Your
results may vary widely depending on the task you have to accomplish.

12.2 - DEC Alpha

[nothing yet]

12.3 - AMD 64

12.3.1 - Can I run OpenBSD/amd64 on my Intel P4 or AMD Sempron?

In the case of many recent processors, the answer is "yes". Unfortunately,
trying to find out which processor variations do and which do not properly
support the amd64 instruction set is difficult. It is usually easier to just
try it and see if it works.

Processors that do not support the amd64 instruction set will fail very early
when booting the kernel; there will be no question about "does it work?" in
your mind.

12.3.2 - Can I run my i386 binary on OpenBSD/amd64?

No.

OpenBSD/amd64 is a totally separate platform from OpenBSD/i386, and at this
point, no binary compatibility is provided. As OpenBSD encourages open source
applications, there is not much interest in binary compatibility across
platforms with developers.

Note that the OpenBSD/amd64 and OpenBSD/i386 boot loaders will load each
other's kernels, making it easier to reinstall a system with the "other"
platform. However, it has to be a complete "wipe and reinstall" operation --
left-over binaries from the "previous" installation will most likely make your
life unpleasant.

12.3.3 - Is it always better to run OpenBSD/amd64 on processors that support
it?

Not always.

There are a number of reasons one may desire to use OpenBSD/i386 over OpenBSD/
amd64, even on hardware that supports amd64 code:

  * Need for i386 binary (or other OS) compatibility.
  * Need to run applications that are not "64 bit clean".
  * Need for ability to move disks to another machine that isn't amd64 capable
  * For some applications and on some hardware, OpenBSD/i386 may outperform
    OpenBSD/amd64. Relatively few people will ever experience this, and work
    is on-going to eliminate as many of these situations as possible.

12.4 - ARM-based appliances

[nothing yet]

12.7 - HPPA

[nothing yet]

12.8 - i386

12.8.1 - ISA NICs

As OpenBSD runs well on older hardware, users often will end up using ISA NICs
on OpenBSD systems. ISA hardware requires much more configuration and
understanding than does PCI hardware. In general, you can't just stuff the
card in the computer and expect it to magically work. In many machines, if
your ISA device is not in a "Plug 'n' Play" (PNP) mode, you must reserve the
resources the card uses in the system's BIOS.

3Com 3C509B ep(4)

This is an excellent performing (relatively speaking) ISA NIC, supported by
the ep(4) driver. The 'B' version can be distinguished from the non-B version
by labeling on the card and by the larger "main" chip on the board
(approximately 2.5cm on a side for the 'B' version, vs. 2cm on a side on the
older version), and will provide better performance on a loaded or dual
network card system. The 3C509B ships configured in a PNP mode, which
unfortunately does not comply with standards, and causes problems in OpenBSD's
isapnp(4) support. The adapter is picked up first as a non-PNP device, then
again after the PNP support comes on-line, resulting in an extra NIC showing
in the dmesg. This may work fine, or it may cause other problems. It is highly
recommended that the 3C509B cards have PNP mode disabled and manually
configured to non-conflicting settings using the 3Com DOS-based configuration
utilities before configuration.

The ep(4) driver will pick the cards up at any hardware combination that does
not conflict with other devices in the system.

If you have multiple 3C509 cards in your system, it is recommended that you
label the cards' spine with the MAC address, and use the dmesg to identify
which is which.

Note that the 3C509, the 3C905 and the 3C590 are often confused. The 3C509 is
a 10Mbps ISA card, the 3C905 and 3C590 are PCI cards.

NE2000

The original NE2000 NIC was developed in the mid-1980s by Novell. Since then,
many manufacturers have produced cards that are very similar, which are
generally called NE2000-compatibles, or clones. Performance of these clone
cards varies greatly. While some older NE2000-compatible cards performed very
well, many of the later ones perform poorly. NE2000-compatibles are supported
by the ne(4) driver in OpenBSD.

OpenBSD will handle some ISAPNP-capable NE2000-compatible cards well if the
ISAPNP mode is turned on. Other cards will have to be set using either jumpers
or a DOS-based configuration utility. Unfortunately, as the original NE2000
cards did not have software configuration or ISAPNP support, there are no
standards for this -- you need the utility that will have been originally
supplied with your specific card. This can often be difficult to obtain.

The ne(4) driver supports three configurations of the ISA NE2000 card in the
GENERIC OpenBSD kernel:

     ne0:  port 0x240 irq 9
     ne1:  port 0x300 irq 10
     ne2:  port 0x280 irq 9

If these settings are not acceptable, you can adjust them using User Kernel
Configuration (UKC).

Note that the ne(4) driver is fairly "dumb" -- only the I/O port is probed, if
any of the above I/O addresses is detected, the corresponding IRQ is assumed.
dmesg(8) will not reflect the actual IRQ of the adapter in the case of ISA ne
(4) drivers. If this is not the actual IRQ your card is set to, it will not
work.

Note that there are non-ISA cards that use the ne(4) driver -- PCI and PCMCIA
ne(4) cards exist. These notes do not apply to them, these devices are
auto-configuring.

12.8.2 - OpenBSD won't work on my 80386/80386SX/80486SX system!

80386SX/DX

Support for the 80386DX and 80386SX processors was dropped beginning with
OpenBSD 4.2. In addition to limitations of the 80386 chip, the systems are
just too slow and rarely had enough RAM and the required FPU to run OpenBSD.

80486SX

The 80486SX chip was a "low-cost" version of the 80486, which, like the 80386,
lacked the hardware floating point support OpenBSD requires. Fortunately, full
80486DX chips are fairly available, and is an easy upgrade in most systems.

The 80486DX and newer chips run OpenBSD fine.

12.8.3 - My dmesg shows multiple devices sharing the same Interrupt (IRQ)!

This is entirely acceptable, and in fact, even desirable for PCI devices. This
is a design feature of the PCI bus. Some people will say that sharing
interrupt requests (IRQs) is bad, however they are either confusing the
situation with the ISA bus (where IRQ sharing is not permitted), or past
experience with broken hardware or software.

ISA devices can not share IRQs. If you find ISA devices sharing IRQs, you must
correct this problem.

12.8.4 - My keyboard/mouse keeps locking up (or goes crazy)!

This is most often seen when using a "switch box" (sometimes called a "KVM
switch") to attach multiple computers to one keyboard, monitor and mouse. You
can experiment with different brand and design switch boxes, but OpenBSD seems
to be more sensitive to switching the mouse than some other operating systems.
The problem is usually just the switching of the mouse. If you are not using
the mouse, the solution is simple: don't attach the mouse cable to the
computer. If you are using the mouse, an easy solution is "one mouse per
computer", and switch just the keyboard and monitor. You may find using a PS/2
Mouse -> USB port adapter (so OpenBSD sees a USB mouse) will work around this
problem. If you just want console access to the machine, you may wish to
consider using a serial console instead.

12.8.5 - My Soekris/Alix/Lanner performs poorly

These machines are quiet, low-power, small and modest cost PC class systems,
and many OpenBSD users are quite pleased with them. However, it must be
remembered the processors, NICs, and other devices on the system are all
chosen for low power consumption, not performance. While they are suitable for
many applications, they are not high performance machines compared to
contemporary full-feature machines.

12.8.6 - I get "missing interrupt" errors on my CF device

With some CF systems, such as early Soekris 4801 systems and some CF adapters,
the DMA support is not properly wired up, so you might see messages such as:

    pciide0:0:0: bus-master DMA error: missing interrupt, status=0x20

In these cases, you will need to disable DMA in the wd(4) driver to avoid this
problem. This can be done using ukc to install, then config(8) to change it
permanently:

    ukc> change wd
     42 wd* at wdc*|pciide* channel -1 flags 0x0
    change [n] y
    channel [-1] ?
    flags [0] ? 0x0ff0
     42 wd* changed
     42 wd* at wdc*|pciide* channel -1 flags 0xff0
    ukc> quit

12.8.7 - Is this really new CPU supported?

The issue of support is rarely the CPU itself, it is almost always the
surrounding and supporting hardware.

Most likely, yes, the latest CPU is supported just fine. The surrounding
support hardware may not work if it is significantly different than earlier
versions. If you have problems with new hardware, make sure you try a snapshot
before making a bug report.

12.9 - Landisk

[nothing yet]

12.10 - Luna88k

[nothing yet]

12.11 - MacPPC

12.11.1 - My bm(4) network adapter doesn't work!

The bm driver, supporting the BMAC chip used on some MacPPC systems (including
early iMacs) has issues. A usb NIC is recommended for these systems at this
time.

12.14 - SGI

[nothing yet]

12.15 - SPARC

[nothing yet]

12.16 - UltraSPARC (sparc64)

12.16.1 - My UltraSPARC won't boot from the floppy image

Only the Ultra 1/1e and Ultra 2 can boot any OS from floppy disk. Use CD-ROM,
Miniroot, or network boot to do your installation instead.

12.17 - DEC VAX

12.17.1 - Can I use the SIMH VAX simulator?

Yes!

The SIMH VAX simulator can be used to effectively emulate a real VAX.
Instructions can be found in the OpenBSD/vax on SIMH page.

12.18 - Sharp Zaurus

12.18.1 - USB devices aren't working properly

The Zaurus has very little current available on its USB port, so many USB
devices will not work if they are directly attached to it. You will need to
use a powered USB hub to run these devices.

------------------------------------------------------------------------------

==============================================================================

13 - Multimedia

------------------------------------------------------------------------------

Table of Contents

  * 13.1 - How do I configure my audio device?
  * 13.2 - Playing different kinds of audio
  * 13.3 - How can I play audio CDs in OpenBSD?
  * 13.4 - Can I use OpenBSD to record audio samples?
  * 13.5 - How do I setup an audio server?
  * 13.6 - What can I do if I have audio problems?
  * 13.7 - How do I use my MIDI instruments?
  * 13.8 - Tell me about Ogg Vorbis and MP3 encoding?
  * 13.9 - How can I playback video DVDs in OpenBSD?
  * 13.10 - How do I burn CDs and DVDs?
      + 13.10.1 - Introduction and basic setup
      + 13.10.2 - Writing CDs
      + 13.10.3 - Writing DVDs
  * 13.11 - But I want my media files in format FOO.
  * 13.12 - Is it possible to play streaming media under OpenBSD?
  * 13.13 - Can I have Java support in my web browser? (amd64 only)
  * 13.14 - Can I have Flash support in my web browser?

------------------------------------------------------------------------------

13.1 - How do I configure my audio device?

The devices in OpenBSD that are related to audio are: /dev/audio, /dev/sound,
/dev/audioctl and /dev/mixer. For a good overview of the audio driver layer,
please read the audio(4) manual page.

All supported audio drivers are already included in the GENERIC kernel so
there is no need for extra configuration or installation of drivers. To find
out about options for your specific sound chip, you must find out which sound
chip you have. Supported chips may be found on the hardware compatibility page
for your platform. When you already have OpenBSD running, look for a sound
driver in the output of the dmesg(8) command, and read its manual page to find
more specific information like options and other details about the driver. An
example of an audio chip in a dmesg output is:

    auich0 at pci0 dev 31 function 5 "Intel 82801BA AC97" rev 0x04: irq 10, ICH2 AC97
    ac97: codec id 0x41445360 (Analog Devices AD1885)
    ac97: codec features headphone, Analog Devices Phat Stereo
    audio0 at auich0

OpenBSD base provides two tools for monitoring and configuring audio devices.
audioctl(1) is used for the audio processing parameters, such as encoding,
sample rate and number of channels, while mixerctl(1) is used for the mixing
parameters, such as channel source, gain level and mute.

The following command uses audioctl(1) to display the default processing
parameters of an audio device.

    $ audioctl -f /dev/audio
    ...

Note that -f /dev/audio was used explicitly. Opening /dev/audio causes the
audio device to reset to the default parameters, which is what we wanted to
see.

audioctl(1) is also quite useful for exploring the capabilities of an audio
device. For example, to see if the device supports some common sample rates,
you could simply try setting the playback rate:

    $ audioctl play.rate=48000
    play.rate: -> 48000
    $ audioctl play.rate=44100
    play.rate: -> 44100
    $ audioctl play.rate=22050
    audioctl: set failed: Invalid argument
    $ audioctl play.rate=8000
    audioctl: set failed: Invalid argument
    $

This device supports 48000 and 44100 Hz playback rates, but not 22050 or 8000.
Note that if a sample rate is not supported, there is not always an error
message, but the returned sample rate is not the one that was desired.

    $ audioctl play.rate=48000
    play.rate: -> 48000
    $ audioctl play.rate=44100
    play.rate: -> 48000
    $ audioctl play.rate=22050
    play.rate: -> 48000
    $ audioctl play.rate=8000
    play.rate: -> 48000
    $

This device supports 48000 Hz playback only.

Audio hardware is usually capable of at least some minimal mixing. Running
mixerctl(1) with no arguments will list the device's mixer controls and
current settings.

    $ mixerctl
    ...

Some devices have only a handful of controls, some have a hundred or more.
Note that not every option of every audio chip necessarily reaches the outside
world. So there may be, for example, more outputs listed than are physically
available on a sound card or motherboard.

There are a few controls that are common to many devices:

  * outputs.master controls the playback output level
  * inputs.dac controls the level from the DAC (digital to analog converter),
    used when playing an audio file
  * record.source controls what inputs are mixed into the ADC (analog to
    digital converter), used when recording
  * record.volume or record.record controls the input level of the ADC

The controls of an audio device may be labeled differently. For instance,
there might not be an outputs.master as above, but there is an outputs.outputs
which does the same thing. Usually the controls have a meaningful label, but
sometimes one must simply try different settings to see what effect each
control has.

Some devices use what is known as EAPD, which stands for external amplifier
power down. However, this is just another on/off switch. It is probably
refered to as "power down" because it is often used for power saving, which
means this type of control is more often found in laptops. Sometimes it is
necessary to set controls with eapd or extamp in their name to on to get an
output signal.

As a basic example of common mixerctl usage, to set the volume of the left and
right channels to 200, you would issue

    $ mixerctl outputs.master=200,200
    outputs.master: 255,255 -> 207,207

Notice how the value becomes 207. The reason for this is that this audio
device has an AC'97 codec, which uses only 5 bits for volume control, leading
to only 32 possible values. Other hardware could have different resolution.

To unmute the master channel, you would do

    $ mixerctl outputs.master.mute=off
    outputs.master.mute: on -> off

To make the changes take affect on each reboot, edit /etc/mixerctl.conf, for
example:

    $ cat /etc/mixerctl.conf
    outputs.master=200,200
    outputs.master.mute=off
    outputs.headphones=160,160
    outputs.headphones.mute=off

13.2 - Playing different kinds of audio

Digitized audio

Lossless audio formats (AU, PCM, WAV, FLAC, TTA)

Some of the lossless audio formats may be played without the need for third
party software, provided they contain the uncompressed digital samples in
chunks of bytes. These formats include Sun audio (AU), raw PCM files (without
headers), and RIFF WAV.

OpenBSD comes with aucat(1), a program for recording and playing uncompressed
audio. The following example will play a WAV file.

    $ aucat -i filename.wav

aucat(1) supports both headerless and WAV audio files with the -i option.
aucat also plays Sun audio files where the audio data is encoded as 8 kHz
monaural mulaw, which is the most common encoding for this type of audio file.

It is also possible to play uncompressed audio data by passing it directly to
the audio device. To do this, you need to know its main parameters: encoding
type, number of channels, sample rate, bits per sample. If you don't know
this, you might find out with the file(1) utility:

    $ file music.au
    music.au:  Sun/NeXT audio data: 16-bit linear PCM, stereo, 44100 Hz

    $ file music.wav
    music.wav: Microsoft RIFF, WAVE audio data, 16 bit, stereo 44100 Hz

The only remaining things to know about these example files is that they use
little-endian byte ordering and signed linear quantization. You could figure
this out by reading the header with hexdump(1). If you are using a headerless
(raw) file, there is no way to know the parameters beforehand. Set the
following parameters accordingly using audioctl(1).

    play.encoding=slinear_le
    play.rate=44100
    play.channels=2
    play.precision=16

Next, pass the audio file to the sound device:

    $ cat music.au > /dev/sound

If you applied the correct settings, you should be hearing what you expected.

Note: Always use /dev/sound, not /dev/audio, if you want the settings you
applied with audioctl to stay in place.

There are, of course, other utilities you can use to play these files. Such as
XMMS which is available in packages and ports and can play numerous other
audio formats.

Apart from the above, there are audio formats which use lossless data
compression. Examples are the Free Lossless Audio Codec (FLAC) and TTA. The
FLAC implementation has been ported to OpenBSD and may be found under audio/
flac in packages and ports.

Audio formats using lossy compression (Ogg Vorbis, MP3, WMA, AAC)

Lossy compression methods are often used for audio or other media files. The
idea is that an amount of data is thrown away during compression, but in such
a way that the compressed result is still very usable and has a good enough
quality to be played. The advantage is that these techniques enable much
higher compression ratios, resulting in reduced disk space and bandwidth
requirements.

A good example is the free, open and unpatented Ogg Vorbis format. To play Ogg
Vorbis files, you can use the ogg123 utility, which is bundled in the audio/
vorbis-tools package. For example:

    $ ogg123 music.ogg

    Audio Device:   Sun audio driver output

    Playing: music.ogg
    Ogg Vorbis stream: 2 channel, 44100 Hz
    Time: 00:02.95 [02:21.45] of 02:24.40  (133.1 kbps)  Output Buffer  87.5%

Of course, Ogg Vorbis plugins exist for many other audio software.

Another example is the very popular MPEG-1 Audio Layer 3 (MP3) encoding, which
has, however, its share of licensing and patent issues. Many tools can play
MP3 files, just have a look through the audio section of the packages and
ports system and pick one you like.

How about the proprietary Windows Media Audio (WMA) format? Files of this type
can be played using x11/mplayer which uses the FFmpeg framework.

A good starting point to learn more about different audio file formats is this
Wikipedia article: Audio file formats.

Synthesized sound

MIDI

The Musical Instrument Digital Interface (MIDI) protocol, is handled by MIDI
devices. If you don't have a MIDI synthesizer, but you wish to play a standard
MIDI file (SMF), you can use software to render MIDI data, generating audio
files. By default, the audio/timidity port renders MIDI files and play them on
the audio device:

    $ timidity file.mid

MOD

A Soundtracker module is a binary format that mixes audio samples with
sequencing orders, making it possible to play rather long pieces of digital
music with reasonably good quality.

The easiest way to play your favorite MOD files on OpenBSD is probably to use
the XMMS software, available through packages and ports. You should install
the -mikmod subpackage for XMMS to let it use the MikMod sound library, which
supports the MOD, S3M, IT and XM module formats.

You will also find a number of so-called "trackers" in the audio section of
the packages and ports collection, e.g. tracker, soundtracker. With these
trackers you can not only play but also generate your own modules. Note,
however, that not every tracker format is supported by the tools in the ports
tree. You are always welcome to submit a port of your favorite tracker
software.

13.3 - How can I play audio CDs in OpenBSD?

It is possible to play audio CDs by either having the CD drive play the disc
and send analog audio to the sound card, or by reading the audio data and
sending the digital samples to the sound card over the PCI bus.

To play an audio CD using the analog output of your CD-ROM drive, you can

  * Use the headphones output, usually at the front side of the drive.
  * Connect the audio output at the back side of the drive to your audio card.
    Yes, this is a supplementary cable next to the data (SATA/IDE/SCSI) and
    power cables.

A nice command line utility called cdio(1), has been included in the base
system. Called without parameters, it will enter interactive mode. If you want
to play the CD right away, just enter

    $ cdio play

This will play from the first CD-ROM drive, cd0, by default. Note that the
user running cdio should have permissions to read the CD-ROM device (e.g. /dev
/rcd0c). As this device is only readable by root or the operator group by
default, for convenience you may want to add the user to the operator group by
adjusting this group's line in /etc/group. Alternatively, you can modify the
file permissions of the device as needed.

Note that you may need to unmute the CD input of the mixer. Just like the
outputs, the actual name of this input may vary between systems, but you will
be using a command like:

    $ mixerctl inputs.cd.mute=off

It is also possible that there is no analog audio connection between your CD
drive and audio device. In this case you could use cdio's cdplay command to
send the CD audio data to the sound card through the PCI bus.

    $ cdio cdplay

If you prefer a beautiful GUI, there are plenty of X11-based CD players in the
packages and ports collection. Just have a look in the audio section.

13.4 - Can I use OpenBSD to record audio samples?

Yes. Most devices support recording. aucat(1) comes with OpenBSD and can be
used for recording.

    $ aucat -o file.wav

The above command will start the recording of a file in WAV format. Press
[CTRL]-C to finish the recording. The file will contain signed 16-bit stereo
samples, sampled at 48kHz. Other sample formats, sample rates and number of
channels can be recorded. See the manual for more details.

Use aucat to play the file back:

    $ aucat -i file.wav

If recording seemed to work, but playback of the recording was silent or not
what was expected, the mixer probably needs some configuration. Make sure that
you select the right device to record from and that the source is unmuted. You
can set the necessary parameters using mixerctl(1). For example:

    inputs.mic.mute=off
    inputs.mic.preamp=on
    inputs.mic.source=mic0
    record.source=mic
    record.volume=255,255
    record.volume.mute=off
    record.mic=255
    record.mic.mute=off

These are settings for recording from a microphone. Pre-amplifying has been
enabled, otherwise the recorded sound can be pretty silent on some systems.
However, pre-amplifying can also be quite loud on other systems.

13.5 - How do I setup an audio server?

What's the sndiod(1) audio server

The sndiod(1) daemon is an intermediate layer between audio or MIDI programs
and the hardware. It performs the necessary audio processing to allow any
program to work on any supported hardware. It exposes at least one sub-device
that any number of audio programs can connect to and use as if it were audio
hardware. During playback, sndiod receives audio data concurrently from all
programs, mixes it and sends the result to the hardware device. Similarly,
during recording it duplicates audio data recorded from the device and sends
it to all programs.

By default, it accepts connections from programs running on the same system
only; it initializes only when programs are using its services, thus,
consuming a negligible amount of system resources. Systems with no audio
hardware can use sndiod to keep hot-pluggable devices usable by default at
virtually no cost.

Do I need an audio server?

If applications you use are compatible with your hardware and you don't plan
to run multiple applications concurrently, then you don't strictly need an
audio server. Since OpenBSD 5.1, sndiod(1) is started by default at boot time.
There is no more reason to disable sndiod(1) on a system with no audio
hardware than there is to disable getty(8) on a headless system.

Note that sndiod can be bypassed by using rsnd/0 as audio device instead of
the default one.

What latency do I need?

The latency is the time between when a program takes the decision to play a
sample and when the user hears the sample. Since audio data is always
buffered, this delay is proportional to the audio buffer size. The following
values are recommended:

  * Real-time synthesizers: 5ms. This is the time it takes between hitting a
    key on your MIDI keyboard and actually hearing the note. Roughly, 5ms
    corresponds to the time it takes for the sound to propagate 1.75m.
  * Games: 50ms. This is the time between when you see an event and you hear
    the corresponding sound.
  * Movie players and alike: 500ms and more. Such applications ``know'' the
    sound to play in advance, and send audio data in such a way that it is
    played simultaneously with the corresponding picture.

The smaller audio buffers are (to achieve low latency), the larger the
probability to overrun/underrun is. Buffer overruns/underruns result in
``stuttering'' of the sound.

sndiod(1) imposes a minimum latency on all audio applications, and the default
latency is 160ms. If you plan to use applications that require a lower
latency, use the ``-b'' option to select the desired latency (expressed in
number of frames). For instance, at 48000 samples/second, 50ms latency
corresponds to:

    48000 samples/second x 0.050 seconds = 2400 samples

then add:

sndiod_flags="-b2400"

to /etc/rc.conf.local.

Does low latency improve audio-video synchronization?

No. Synchronizing audio to video doesn't require low latency. Synchronization
problems are often caused by the software itself (poor implementation,
bugs, ...). Forcing the application to use smaller buffers (by starting sndiod
(1) in low latency mode) may hide the actual problem in some cases and give
the feeling that the software works better, but obviously the right thing to
do is to start searching for the corresponding bug.

How to use a remote sound card?

sndiod(1) can be configured to accept connections from the network allowing
other machines to use the sound card as well. On the remote system (the one
with the sound card) add:

sndiod_flags="-L-"

to /etc/rc.conf.local. On the local system, configure your program to use:

snd@@hostname/0

where ``hostname'' is the address of the remote system. The AUDIODEVICE
environment variable could be set to the above value to make the remote sound
card the default audio device.

Note that any system able to connect to TCP port 11025 of the remote host,
will be able to use the audio device. For privacy reasons only one user from
one system may have connections to it at a given time. If multiple systems
have to use the audio device simultaneously, the sndio(7) authorization cookie
must be the same. For instance, copy your ~/.aucat_cookie to all accounts that
may use the audio device.

To avoid glitches, TCP traffic on port 11025 could be prioritized with the
packet filter. With the default configuration sndiod will consume around 200kB
/s of network bandwidth.

13.6 - What can I do if I have audio problems?

If you do not hear anything when playing audio, it's possible there is a mixer
control turned to low or simply muted. See section 13.1 - How do I configure
my audio device for configuring the mixer. Please unmute all inputs and
outputs before reporting a problem.

If sound is distorted, it could be that your sound card only supports a single
or limited set of sample rates or encodings. See section 13.1 - How do I
configure my audio device for examples of determining what parameters your
audio device supports.

If your device only supports unusual encodings or only one or a few sample
rates and applications you use do not perform the necessary format
conversions, consider using aucat(1) as audio server. See section 13.5 - How
do I setup an audio server?

If you are still experiencing trouble, here are some things to consider:

  * Some old ISA cards have particular quirks:
      + Some need to be configured with a different I/O address and IRQ value
        to avoid conflicts with other hardware. You can easily try different
        combinations using the User Kernel Configuration (UKC).
      + It is possible that a less than optimal driver attaches to the sound
        device, and that you can get better results using another driver. This
        is not the easiest thing to spot, but take a closer look at your dmesg
        (8) output, and find the lines where audio drivers attach. If you see
        more than one sound driver attaching (or trying to), test them one at
        a time by disabling some and leaving one enabled using the User Kernel
        Configuration (UKC).
  * Find information about your sound device. Use the documentation, or use an
    internet search engine to find its specifications. For ac97(4) and azalia
    (4) devices, look for documentation for both the controller and the codec.
    They may actually help you find the source of the problem.

If you believe your device should be working, but for whatever reason isn't,
then it's time for a little debugging. The following steps can determine if
data is being processed by the DAC.

    $ cat > /dev/audio < /dev/zero &
    [1] 9926
    $ audioctl play.{seek,samples,errors}
    play.seek=48000
    play.samples=3312000
    play.errors=0
    $ audioctl play.{seek,samples,errors}
    play.seek=57600
    play.samples=7065600
    play.errors=0
    $ audioctl play.{seek,samples,errors}
    play.seek=48000
    play.samples=9379200
    play.errors=0
    $ kill %1
    $ fg %1
    cat > /dev/audio < /dev/zero
    Terminated

Here we see that the processed data count play.samples increases each time we
check, so data is flowing. We also see that the device is keeping enough data
buffered play.seek that the device has not underrun any samples play.errors.
That's good too.

Note that even if you had speakers plugged in when running the above test, you
should not have heard anything. The test sends zeros to the device, which is
silence for all currently supported default encodings.

Since we know the device can process data, it's a good idea to check the mixer
settings again. Make sure all outputs and all inputs are unmuted and are at a
reasonable level.

If at this point you are still having problems, it's probably time to file a
bug report. Besides the normal bug report information such as a full dmesg and
description of the problem, please also include the default output of mixerctl
-v and the output of the above test for DAC processing.

13.7 - How do I use my MIDI instruments?

The Musical Instrument Digital Interface (MIDI) protocol provides a
standardized and efficient means to represent musical performance information
as electronic data. A MIDI data contain only instructions needed by a
synthesizer to play the sounds, rather than the sounds. More information:
Tutorial on MIDI and Music Synthesis.

To play MIDI data, a synthesizer connected to a MIDI port of the machine is
required. Similarly, to record a MIDI data a MIDI instrument is required (eg.
a MIDI keyboard). Certain sound cards contain embedded MIDI synthesizers that
are attached as MIDI ports. Advanced MIDI instruments may contain multiple
subparts (synthesizers, keyboards, control surfaces, etc...), they appear as
multiple MIDI ports on OpenBSD.

When you already have OpenBSD running, look for MIDI ports in the output of
the dmesg(8) command. An example of MIDI ports in a dmesg output is:

    umidi0 at uhub2 port 2 configuration 1 interface 0 "Roland Roland XV-2020" rev 1.10/1.00 addr 2
    midi0 at umidi0: <USB MIDI I/F>
    umidi1 at uhub1 port 2 configuration 1 interface 1 "Evolution Electronics Ltd. USB Keystation 61es" rev 1.00/1.25 addr 3
    midi1 at umidi1: <USB MIDI I/F>

It shows three MIDI ports, known by sndio(7) as:

  * rmidi/0 - synthesizer connected by USB
  * rmidi/1 - a MIDI master keyboard

They are backed by the /dev/rmidi0 and /dev/rmidi1 character devices. The
latter are handy for testing the hardware, bypassing most software layers. To
test your MIDI keyboard, you can use the hexdump(1) utility to display MIDI
data you're playing on it:

    $ hexdump -e '1/1 "%02x\n"' < /dev/rmidi0
    90
    3c
    71
    ...

The output of the keyboard can be connected to the input of the synthesizer,
as follows:

    $ cat -u < /dev/rmidi0 > /dev/rmidi1

Now you can hear on the synthesizer what you're playing on the MIDI keyboard.

The main utility to play standard MIDI files is midiplay(1). Playing a
standard MIDI file, in this example through the synthesizer, is as easy as:

    $ midiplay -f rmidi/0 file.mid

The sndiod(1) server exposes MIDI thru ports, allowing programs to send each
other MIDI data. For instance, if you have no hardware synthesizer connected,
you could start a software one (like the audio/fluidsynth port), and then use
it as MIDI output:

    $ midiplay -f midithru/0 file.mid

To record MIDI files, you can use the smfrec utility bundled in the audio/
midish port, for instance:

    $ smfrec -d rmidi/0 -i rmidi/1 file.mid

will record what is played on the keyboard (rmidi/1) while sending it in
real-time on the synthesizer (rmidi/0) so you can hear what you're playing.
More complicated operations like editing, routing, mixing and transforming
MIDI data, can be achieved using the rmidish utility bundled in the audio/
midish port.

13.8 - Tell me about Ogg Vorbis and MP3 encoding?

These formats were already mentioned in Playing different kinds of audio. In
this section we will give a brief introduction about encoding such files. If
you are interested in learning how these audio compression codecs work,
further reading may be found through these Wikipedia articles about Vorbis and
MP3.

Ogg Vorbis

Encoding raw, WAV or AIFF format audio to Ogg Vorbis may be done with the
oggenc utility, contained in the audio/vorbis-tools package, which is
available through OpenBSD's packages and ports system.

Say you have a number of WAV files ready to encode, for example your favorite
album you just extracted from its CD. To encode all these files using an
approximate bit rate of 192 kbps, you could issue a command like

    $ oggenc *.wav -b 192

When finished, this will give you a set of .ogg files in the current
directory. More extensive examples, as well as encoding options, can be found
in the oggenc manual page.

MPEG-1 Audio Layer 3 (MP3)

If for some reason you want to use the MP3 format, you can use "Lame ain't an
MP3 encoder" (LAME), an educational tool to be used for learning about MP3
encoding. Lame is included in the OpenBSD ports tree. Note that due to MP3
patents, you will not find this package on the official CD sets.

Below is a simple example of encoding a WAV file with a bit rate of 192 kbps:

    $ lame -b 192 track01.wav track01.mp3

For all options and details, please consult the manual page that comes with
lame.

13.9 - How can I playback video DVDs in OpenBSD?

OpenBSD supports DVD media through the ISO 9660 filesystem which is also used
on CD-ROMs, and, since OpenBSD 3.8, also through the newer Universal Disk
Format (UDF) filesystem which is found on some DVDs. However, almost all
DVD-Video and DVD-ROM discs use the UDF bridge format, which is a combination
of the DVD MicroUDF (subset of UDF 1.02) and ISO 9660 filesystems. It is used
for backward compatibility reasons.

As most computers with DVD-ROM drives use software decoding, it is recommended
to have at least a 350-MHz Pentium II or equivalent CPU to have good quality
playback.

Some popular media players, supporting DVD playback, have been ported to
OpenBSD. Examples are ogle, mplayer, xine, and kaffeine. Please read the
installation instructions that come with these packages, because these tools
may need further setup. With these utilities, it is possible to playback the
DVD by directly accessing the raw device. Of course, it is also possible to
mount a DVD first using mount_cd9660(8), and play the files on this or any
other mounted filesystem.

Notes:

  * Nearly all DVDs you buy are encrypted using the Content Scrambling System
    (CSS). To be able to playback these encrypted DVDs, you can use the libdvd
    library, also available through packages and ports.
  * Be aware that a region code may be present on your DVD disk(s). This
    should not be much of a problem when playing DVDs on a computer.

13.10 - How do I burn CDs and DVDs?

13.10.1 - Introduction and basic setup

You should first make sure your CD/DVD writer has been recognized and
configured by the kernel. Most SCSI devices are supported. SATA, IDE/ATAPI and
USB devices are supported through SCSI emulation. You will quickly find your
device in a dmesg(8) output. Just look for lines beginning with "cd", for
example

    cd0 at scsibus0 targ 0 lun 0: <TOSHIBA, CD-ROM XM-5702B, 2826> SCSI0 5/cdrom removable
    cd1 at scsibus1 targ 4 lun 0: <PLEXTOR, CD-R PX-R412C, 1.04> SCSI2 5/cdrom removable

But cdrecord -scanbus does not work!

Yes. OpenBSD uses a different device namespace than the OS for which the
cdrecord utility was written. All configured devices should be in the dmesg
output, as mentioned above. The information you need is right there.

Error: mount_cd9660: /dev/cd2c on /mnt/cdrom: No such file or directory

By default, the OpenBSD installer creates only two cd device nodes, cd0 and
cd1. To start using your cd2 device, you must create the necessary device
nodes for it. The recommended way to do that is using the MAKEDEV(8) (select
your specific platform) script:

    # cd /dev
    # ./MAKEDEV cd2

In what follows, we will mostly be accessing the CD/DVD writer through the raw
character device, not the block device.

Checking CD/DVD writer operation

It is recommended to check whether your CD/DVD writer is working correctly. In
this example, I'll be using this USB 2.0 DVD writer:

    cd2 at scsibus2 targ 1 lun 0: <LITE-ON, DVDRW LDW-851S, GS0C> SCSI0 5/cdrom removable

Try to use it by mounting an existing CD/DVD in it. If desired, you could also
check the transfer rate you are getting when copying files to your hard disk.
The time(1) command will be your willing assistant.

If something goes wrong here and you are getting errors during this phase, it
is wise to fix the problem and not to start writing a CD/DVD yet.

I want to write a CD here! Can we get on with it?

Before proceeding, it is a good idea to keep a few words of advice in mind:

  * Do not run any disk-intensive jobs while writing a CD/DVD. Doing this will
    reduce the throughput to your CD/DVD writer. If the throughput drops below
    what the writer is expecting for too long, its buffer will run empty. This
    phenomenon is also known as a "buffer underrun".
  * Prevent shocks during writing as this may cause the laser beam to drift
    from its track, which may lead to errors on the disc.
  * Not every DVD writer supports every DVD format, see below.

13.10.2 - Writing CDs

Creating data CD-ROMs

First, you will want to create an ISO 9660 filesystem to put on a CD-ROM. To
do this you can use the mkhybrid(8) utility in the base system, or the mkisofs
utility which comes with the cdrtools package and which does a better job with
large file trees. In the examples below, we will use mkhybrid, although
mkisofs usage is very similar.

As an example usage, let's say I wanted to store the OpenBSD kernel sources in
an ISO 9660 image:

    $ mkhybrid -R -o sys.iso /usr/src/sys

    Using ALTQ_RMC.000;1 for  /usr/src/sys/altq/altq_rmclass_debug.h (altq_rmclass.h)
    ...
    Using IEEE8021.00H;1 for  /usr/src/sys/net80211/ieee80211_amrr.c (ieee80211.c)
     10.89% done, estimate finish Sat Nov  3 08:01:23 2007
     21.78% done, estimate finish Sat Nov  3 08:01:28 2007
    ...
     87.12% done, estimate finish Sat Nov  3 08:01:31 2007
     98.01% done, estimate finish Sat Nov  3 08:01:32 2007
    Total translation table size: 0
    Total rockridge attributes bytes: 896209
    Total directory bytes: 2586624
    Path table size(bytes): 11886
    Max brk space used 0
    45919 extents written (89 Mb)

The -R option tells mkhybrid to create Rock Ridge extensions in the ISO 9660
image. The Rock Ridge Interchange Protocol was created to support POSIX
filesystem semantics in ISO 9660 filesystems, such as longer file names,
ownerships, permissions, file links, soft links, device nodes, deep file
hierarchies (more than 8 levels of subdirectories), etc.

If you want the long file names on your CD-ROM to be readable on Windows or
DOS systems, you should add the -J flag to include Joliet extensions in the
ISO 9660 image as well.

After creating the filesystem, you can verify it by mounting the ISO 9660
image. If all is well, you are now ready to burn the CD-R(W). The easiest way
to do this is to use the cdio(1) utility.

If you are using multi-write media such as CD-RW, you will need to blank the
media before burning it.

    # cdio -f cd1c blank

You are now ready to burn the image created in the above example to a blank
CD-R(W). You could use a command similar to:

    # cdio -f cd1c tao sys.iso

With the options specified above, we're asking cdio to use the second CD-ROM
device as the CD writer.

To verify whether the CD-ROM has been written correctly, you can mount it and
check whether everything is there. To mount the filesystem, you should use the
block device for the CD-ROM drive, which in this case is still the CD writer:

    # mount /dev/cd1c /mnt/cdrom

Creating audio CDs

To burn audio CDs, you can again use cdio(1) with the tao -a option.

As an example, I'll be making a backup copy of one of my music CDs. This
involves two steps:

 1. Fetch the audio tracks from the original CD. For example:

        # cdio -f cd1c cdrip

    This command will extract a series of WAV files from your second CD-ROM
    drive to your disk.
 2. Write the audio tracks to a blank CD. For example:

        # cdio -f cd1c tao -a *.wav

13.10.3 - Writing DVDs

There are a few important things about DVD you should know about before
proceeding to write your own DVDs.

Important notes:

  * If you really want to know all about DVD, I suggest you read the very
    extensive DVD FAQ document to start with.
  * This section has seen only very limited testing, and we certainly have not
    tried every possible media and writer combination. Nevertheless, we have
    had, or have heard of, positive experiences with all of the DVD formats
    mentioned below.

Different DVD formats

There are a number of different DVD formats. Commonly used are the DVD-R,
DVD-RW, DVD+R, and DVD+RW formats (R means writable once, RW means it can be
rewritten a few thousand times). They are pretty much competing standards.

A pretty different format is DVD-RAM, which was mainly developed as a data
drive and has advanced packet writing functions, allowing it to be used like a
kind of optical hard disk. DVD-RAM is not recommended for video usage as video
gets written to the discs in a format not compatible with normal DVD players.

The important thing is you use media which suit your DVD writer. If you expect
compatibility with other DVD players, watch your step and be sure to read this
section of the DVD FAQ.

DVD writing speed

It may be useful to point out that DVD speed indications differ from CD-ROM
speed indications. The following table gives an overview:

+----------------------------------------------------------------------------+
|DVD read/write speed|Transfer rate (MB/s)|  Equivalent CD-R(W) read/write   |
|                    |                    |              speed               |
|--------------------+--------------------+----------------------------------|
|         1x         |        1.32        |                9x                |
|--------------------+--------------------+----------------------------------|
|         2x         |        2.64        |               18x                |
|--------------------+--------------------+----------------------------------|
|         4x         |        5.28        |               36x                |
|--------------------+--------------------+----------------------------------|
|         8x         |       10.57        |               72x                |
+----------------------------------------------------------------------------+

As can been seen from the table, the transfer rates are relatively high, and
you should check whether your bus (SCSI, IDE/ATAPI, SATA, USB) is performant
enough to handle this throughput. Especially the older USB 1.0 and 1.1
interfaces work at slower transfer rates, with maximal rates of 1.5 Mbit/s and
12 Mbit/s, respectively. That means USB 1.0 has a maximal throughput of 178.8
kByte/s and USB 1.1 has a maximal throughput of 1.43 MB/s. USB 2.0 is much
faster: 480 Mbit/s or 57.2 MB/s. In general, the speed of SCSI, SATA, and IDE/
ATAPI buses should be just fine.

Writing the DVD

Basically, the process is very similar to writing CD-R(W)s. The software used,
however, is different. At the moment, the best option is growisofs from the
sysutils/dvd+rw-tools package. This utility writes an ISO 9660 image to the
DVD medium. All recordable DVD formats are supported by the dvd+rw-tools.

In case you want to find out more info about the media in your DVD writer (for
example if you lost the info label in the jewel case or are just disorganized
like me), you can use the dvd+rw-mediainfo utility. There are two options to
write the DVD:

  * Pre-master an ISO 9660 from your data, storing the image on your hard
    disk; then write this image to the DVD.
  * Write an ISO 9660 from your data immediately to the DVD.

I created a pre-mastered ISO 9660 image from the OpenBSD CVS modules (src,
xenocara, ports and www) contained in the /cvs directory on my disk. I used
the following command, which looks very similar to the one I used to create
the CD-ROM image above.

    $ mkhybrid -r -o cvs.iso /cvs

If desired, check the ISO 9660 filesystem by mounting the image. To write this
image (about 2 GB) to an empty DVD disc, one could use:

    # growisofs -dvd-compat -Z /dev/rcd2c=cvs.iso
    Executing 'builtin_dd if=cvs.iso of=/dev/rcd2c obs=32k seek=0'
    /dev/rcd2c: pre-formatting blank DVD+RW...
    /dev/rcd2c: "Current Write Speed" is 4.1x1385KBps.
      23822336/1545832448 ( 1.5%) @@3.9x, remaining 5:19
      42172416/1545832448 ( 2.7%) @@3.9x, remaining 5:20
      60522496/1545832448 ( 3.9%) @@3.9x, remaining 4:54
    ...
    1504706560/1545832448 (97.3%) @@3.9x, remaining 0:07
    1523318784/1545832448 (98.5%) @@3.9x, remaining 0:04
    1541898240/1545832448 (99.7%) @@3.9x, remaining 0:00
    /dev/rcd2c: flushing cache
    /dev/rcd2c: writing lead-out
    /dev/rcd2c: reloading tray

The -Z option tells growisofs to burn an initial session to the device, which
in this case is my DVD writer, attached to cd2. The -dvd-compat option closes
the disk, which means no more sessions can be appended to it. This should
provide better compatibility with video DVD players and some older DVD-ROM
units.

Notice how growisofs indicates the writing speed, in this case 3.9x DVD speed,
which is what could be expected from the media and writer combination, as
indicated by dvd+rw-mediainfo.

If you are short on disk space and cannot store an ISO 9660 image for a DVD,
you can write your data directly to the DVD. Let's first do a dry run, which
simulates the creation of the filesystem.

    # growisofs -dry-run -Z /dev/rcd2c -R /cvs

If this succeeds, just leave out the -dry-run option and start burning the
DVD.

    # growisofs -Z /dev/rcd2c -R /cvs

It is also possible to append data to an existing DVD, by using the -M option,
which merges a new session to an existing one:

    # growisofs -M /dev/rcd2c -R /mydata

For more information about growisofs, refer to the manual page.

When you have finished writing the DVD, mount it and see whether everything
you expected to be there, is indeed there.

Why am I not getting the writing speed I expected?

Instead of the above writing output, you may see something like:

       4784128/1545832448 ( 0.3%) @@0.7x, remaining 26:50
       7929856/1545832448 ( 0.5%) @@0.7x, remaining 29:05
      14123008/1545832448 ( 0.9%) @@0.7x, remaining 27:06
    ...

which is much slower. It means you are somehow not getting enough throughput
on whatever bus your DVD writer is using. In the above example, the USB DVD
writer was attached to a machine on which the ehci(4) driver, used by USB 2.0
controllers, failed to initialize properly. As always, you are welcome to
provide patches and test results. The DVD writer fell back to the slower USB
1.1 interface, which causes reduced throughput. Indeed, USB 1.1 is limited to
12 Mbit/s, which amounts to 1.43 MB/s or 1.08x in DVD speed terms. The DVD
writer falls back to a lower pace than the maximum, to reduce the risk of
buffer underruns.

13.11 - But I want my media files in format FOO.

Converting between different audio formats

Let's say we want to process the sound recording from FAQ 13 - Audio
Recording. This recording has been stored in the raw format. It will be useful
to convert it, because the raw format does not include headers and the
recording parameters will need to be specified at every usage of the file.

One sound conversion tool is audio/sox, available through packages and ports.
sox supports AIFF, AU, MP3, Ogg Vorbis, RIFF WAV and raw formats, as well as
some of the more exotic audio formats out there. Below is an example for
converting the recording to RIFF WAV format.

    $ sox -U -c 1 -r 8000 -b myvoice.raw myvoice.wav

Note that the specified parameters correspond to the recording parameters
specified before the recording. This was just an example. More audio-related
libraries and software can be used for audio conversion.

Note: It is not recommended to convert between different lossy compression
formats. For instance, the MP3 and Vorbis codecs throw away different parts of
an original audio waveform. Therefore, when converting a MP3 file to Ogg
Vorbis, the end result will probably sound worse than the original MP3.

Converting between different video formats

It's important to make a clear distinction between

  * the container file format - popular examples are MP4, OGG, MPEG, MOV, AVI,
    ASF.
  * the video codec - for example MPEG-1, MPEG-2, MPEG-4 compliant codecs
    (like Xvid and DivX), FFmpeg, WMV, ... - read this Wikipedia article about
    video codecs to find out more.

In OpenBSD, support for MPEG and AVI containers is most mature at this time.

Two popular utilities are multimedia/transcode and mencoder (part of x11/
mplayer). They use or can use the libavcodec library as part of the graphics/
ffmpeg port, which generates good quality output. You can, of course, also use
ffmpeg directly. It should also be possible to use the XviD encoder in
multimedia/xvidcore.

The documentation that comes with these packages, under the form of manual
pages or HTML documents in /usr/local/share/doc, contains many examples, so it
is HIGHLY recommended to read those documents.

13.12 - Is it possible to play streaming media under OpenBSD?

Yes, it is. Many audio and video streams will work just fine, on a limited
number of platforms. A few of them will not.

This is not meant to be a complete, overly detailed answer to have every
possible streaming format work on any hardware architecture. You may want to
learn more about streaming media to start with. A slightly dated but still
good starting point is this chapter about streaming media from the O'Reilly
book titled Designing Web Audio.

The first thing to understand is that there are a number of different
streaming protocols around. The streaming protocol defines how the streams
will be sent over the network. They have been developed to allow efficient
transmission of audio/video over the internet in real-time. Mostly, the
streaming protocol is a (Layer 7) application protocol, which can use either
UDP or TCP (Layer 4) transport protocols. The User Datagram Protocol (UDP) is
very suited for this type of application since it doesn't do any
retransmission of packets or other overhead. A number of specialized but
proprietary protocols have been developed, e.g. Microsoft Media Services (MMS)
and the Real Time Streaming Protocol (RTSP). As we will see, HTTP (which uses
TCP) is sometimes used as well, even though it does not allow serving streams
at a steady bitrate like UDP, RTSP and MMS.

Next, there is the streaming format, which is how the audio/video data has
been organized and can be played. The most widely used streaming formats are
MP3, Real Audio (RA, RM) and Windows Media (ASF), all proprietary
technologies. Occasionally you will also encounter streams in the open Ogg
Vorbis format.

As an example, I'll explain in a few steps how I get to listen to Radio 1, one
of the Belgian national radio stations. Browser-embedded plugins are not
available on OpenBSD, so the story is usually not an instant "click and play".

  * Determine the streaming protocol and format.
    This is usually indicated on the website where you access the stream. In
    this case, I followed the link "Listen live" from the main site, and it's
    telling me my operating system is not supported. They are being nice by
    saying I can also listen to their MP3 streams without their embedded Flash
    player. Apart from that, a list of links to the national radio stations
    appears, allowing me to proceed to the next step. Note that I used a
    JavaScript-enabled browser to get this far.
  * Figure out the precise URL.
    Many websites link to a container metafile or playlist (such as M3U, ASX,
    RAM), which contains the actual location of the stream. Just save the
    file, and read the URL from it. In my example this is

        $ ftp http://internetradio.vrt.be/dab/hoeluisteren/pc/help/gebruiksvoorwaarden/stream_11.m3U
        $ cat stream_11.m3U
        http://mp3.streampower.be/radio1-mid.mp3
        http://mp3.streampower.be/radio1-low.mp3
        http://mp3.streampower.be/radio1-high.mp3

    It looks like I can even choose between low, medium and high quality
    streams. Other websites may contain some JavaScript code to generate the
    URL. In that case, the best tip is: dig up the HTML source and scripts it
    refers to. There is a good chance you can reconstruct the URL from it.
  * To play streams, your best bet is probably x11/mplayer, which is available
    through packages and ports. It supports most of the streaming protocols
    and formats, and has been reported to work on amd64, i386, powerpc and
    sparc64 platforms. But there are alternatives: ogg123 from audio/
    vorbis-tools (for Ogg Vorbis streams), audio/mpg123 and audio/mpg321 (for
    MP3 streams), XMMS in audio/xmms and the Videolan Client in x11/vlc.
    Continuing the example:

        $ mplayer -loop 0 http://mp3.streampower.be/radio1-mid.mp3

  * Optionally, you may want to make it a little easier by including an alias
    in your .profile:

        alias radio1='mplayer -loop 0 http://mp3.streampower.be/radio1-mid.mp3'

Windows Media (ASF) streams will often work, though they may contain data in
formats supported only through the graphics/win32-codecs port, which runs on
i386 only ('pkg_info win32-codecs' will tell you which codecs). Some Real
Audio streams can be made to work on i386 using mplayer in conjunction with
the graphics/win32-codecs and emulators/fedora/base ports (see this thread on
the ports mailing list).

13.13 - Can I have Java support in my web browser? (amd64 only)

Just install the icedtea-web package. In your browser, check for the list of
detected plugins (about:config in Mozilla-based browsers, about:plugins in www
/epiphany or about: in www/midori) and ensure icedtea-web is there.

Note that due to the security issues with java applets on the web, most
browsers disable java support by default, you will be prompted for your
explicit consent to run applets via icedtea-web.

13.14 - Can I have Flash support in my web browser?

The Flash plugin is distributed by Adobe in binary form only. Adobe does not
provide a native OpenBSD plugin. Considering their security record, we thank
them for this neglect.

If you are just looking to watch flash videos from common websites, there are
a number of options in packages, including: get_flash_videos, minitube,
youtube-dl, get_iplayer and yt. Also, the Gnash project has made a lot of
progress lately, and may fill your needs.

------------------------------------------------------------------------------

==============================================================================

14 - Disk Setup

------------------------------------------------------------------------------

Table of Contents

  * 14.1 - Disks and Partitions
  * 14.2 - Using OpenBSD's fdisk(8)
  * 14.3 - Using OpenBSD's disklabel(8)
  * 14.4 - Adding extra disks in OpenBSD
  * 14.5 - How is swap handled?
      + 14.5.1 - About swap
      + 14.5.2 - Swapping to a partition
      + 14.5.3 - Swapping to a file
  * 14.6 - Soft Updates
  * 14.7 - How do OpenBSD/i386 and OpenBSD/amd64 boot?
  * 14.8 - What are the issues regarding large drives with OpenBSD?
  * 14.9 - Installing Bootblocks
  * 14.10 - Preparing for disaster: Backing up and Restoring from tape.
  * 14.11 - Mounting disk images in OpenBSD
  * 14.12 - Help! I'm getting errors with IDE DMA!
  * 14.14 - Why does df(1) tell me I have over 100% of my disk used?
  * 14.15 - Recovering partitions after deleting the disklabel
  * 14.16 - Can I access data on filesystems other than FFS?
      + 14.16.1 - The partitions are not in my disklabel! What should I do?
  * 14.17 - Can I use a flash memory device with OpenBSD?
      + 14.17.1 - Flash memory as a portable storage device
      + 14.17.2 - Flash memory as bootable storage
      + 14.17.3 - How can I make a "Live" bootable USB device?
  * 14.18 - Optimizing disk performance
      + 14.18.1 - Soft updates
      + 14.18.2 - Size of the namei() cache
  * 14.19 - Why aren't we using async mounts?
  * 14.20 - Duplicating your root partition: altroot
  * 14.21 - How do I use softraid(4)?
      + 14.21.1 - Doing the install
      + 14.21.3 - Softraid notes
      + 14.21.4 - Disaster recovery
      + 14.21.5 - Softraid Crypto

------------------------------------------------------------------------------

14.1 - Disks and Partitions

The details of setting up disks in OpenBSD vary between platforms, so you
should read the installation instructions in the INSTALL.<arch> file for your
platform to determine the specifics for your system.

Drive identification

OpenBSD handles mass storage with two drivers on most platforms, depending
upon the normal command set that kind of device supports:

  * wd(4): IDE disks (and devices that look like IDE disks, for example, SATA,
    MFM or ESDI disks, or a flash device with an appropriate adapter) attached
    to a wdc(4) or pciide(4) interface.
  * sd(4): Devices that utilize SCSI commands, such as SCSI disks attached to
    a SCSI adapter, USB disks, SATA disks attached to an ahci(4) interface,
    and disk arrays attached to a RAID controller.

The first drive of a particular type identified by OpenBSD will be drive '0',
the second will be '1', etc. So, the first IDE-like disk will be wd0, the
third SCSI-like disk will be sd2. If you have two SCSI-like drives and three
IDE-like drives on a system, you would have sd0, sd1, wd0, wd1, and wd2 on
that machine. The order is based on the order they are found during hardware
discovery at boot. There are a few key points to keep in mind:

  * Drives may not be numbered in the same order as your boot ROM attempts to
    boot them (i.e., your system may attempt to boot what OpenBSD identifies
    as wd2 or sd1). Sometimes you may be able to change this, sometimes not.
  * Removing or adding a disk may impact the identity of other drives on the
    system.

Partitioning

Due to historical reasons, the term "partition" is regularly used for two
different things in OpenBSD and this leads to some confusion.

The two types of "partitions" are:

  * "disklabel partitions" created with disklabel(8) (often called "filesystem
    partitions").
  * "fdisk partitions" created with fdisk(8) (often called "partition table
    partitions" or "Master Boot Record (MBR) partitions").

All OpenBSD platforms use disklabel(8) as the primary way to manage OpenBSD
filesystem partitions, but only some platforms also require using fdisk(8) to
manage Partition Table partitions. On the platforms that use fdisk partitions,
one fdisk partition is used to hold all of the OpenBSD file systems, this
partition is then sliced up into disklabel partitions. These disklabel
partitions are labeled "a" through "p". A few of these are "special":

  * a -- On the boot disk, the 'a' partition is your root partition.
  * b -- On the boot disk, the 'b' partition is automatically used as a swap
    partition.
  * c -- On all disks, the 'c' partition is the entire disk, from the first
    sector to the last. (Hint: if you wish to totally clear a drive, you write
    zeros to the 'c' partition of the drive. More commonly, the 'c' partition
    is used by utilities like 'fdisk' to install boot loaders, partition
    tables, etc.)

Partition identification

An OpenBSD filesystem is identified by the disk it is on, plus the file system
partition on that disk. So, file systems may be identified by identifiers like
"sd0a" (the "a" partition of the first "sd" device), "wd2h" (the "h" partition
of the third "wd" device), or "sd1c" (the entire second sd device). The device
files would be /dev/sd0a for the block device, /dev/rsd0a would be the device
file for the "raw" (character) device.

Some utilities will let you use the "shortcut" name of a partition (i.e.,
"sd0d") or a drive (i.e., "wd1") instead of the actual device name ("/dev/
sd0d" or "/dev/wd1c", respectively).

Note again that if you put data on wd2d, then later remove wd1 from the system
and reboot, your data is now on wd1d, as your old wd2 is now wd1. However, a
drive's identification won't change after boot, so if a USB drive is unplugged
or fails, it won't change the identification of other drives until reboot.

Disklabel Unique Identifiers

Disks can also be identified by Disklabel Unique Identifiers (DUIDs), a 16 hex
digit number, managed by the diskmap(4) device. This number is generated
automatically as a random number when a disklabel is first created, though
defaults to all zeros on an existing (pre OpenBSD 4.8) labels. disklabel(8)
can be used to change the UID if desired. These UIDs are "persistent" -- if
you identify your disks this way, drive "f18e359c8fa2522b" will always be
f18e359c8fa2522b, no matter what order or how it is attached. You can specify
partitions on the disk by appending a period and the partition letter, for
example, f18e359c8fa2522b.d is the 'd' partition of the disk f18e359c8fa2522b
and will ALWAYS refer to the same chunk of storage, no matter what order the
device is attached to the system, or what kind of interface it is attached to.

These UIDs can be used to identify the disks almost anywhere a partition or
device would be specified, for example in /etc/fstab (which uses them by
default in new installs) or in command lines. Of course, disks and partitions
may also be identified in the traditional way, by device, unit number and
partition (i.e., /dev/sd1f), and this can be done interchangeably.

It is worth noting that the DUID is a property of the disklabel, though as
OpenBSD only supports one disklabel per disk, this is mostly academic.

14.2 - Using fdisk(8)

Be sure to check the fdisk(8) man page.

fdisk(8) is used on some platforms (i386, amd64, macppc, zaurus and armish) to
create a partition recognized by the system boot ROM, into which the OpenBSD
disklabel partitions can be placed. Other platforms do not need or use fdisk
(8). fdisk(8) can also be used for manipulations of the Master Boot Record
(MBR), which can impact all operating systems on a computer. Unlike the
fdisk-like programs on some other operating systems, OpenBSD's fdisk assumes
you know what you want to do, and for the most part, it will let you do what
you need to do, making it a powerful tool to have on hand. It will also let
you do things you shouldn't or didn't intend to do, so it must be used with
care.

Normally, only one OpenBSD fdisk partition will be placed on a disk. That
partition will be subdivided by disklabel into OpenBSD filesystem partitions.

To just view your partition table using fdisk, use:

    # fdisk sd0


Which will give an output similar to this:

    Disk: sd0       geometry: 553/255/63 [8883945 Sectors]
    Offset: 0       Signature: 0xAA55
             Starting       Ending       LBA Info:
     #: id    C   H  S -    C   H  S [       start:      size   ]
    ------------------------------------------------------------------------
    *0: A6    3   0  1 -  552 254 63 [       48195:     8835750 ] OpenBSD
     1: 12    0   1  1 -    2 254 63 [          63:       48132 ] Compaq Diag.
     2: 00    0   0  0 -    0   0  0 [           0:           0 ] unused
     3: 00    0   0  0 -    0   0  0 [           0:           0 ] unused

In this example we are viewing the fdisk output of the first SCSI-like drive.
We can see the OpenBSD partition (id A6) and its size. The * tells us that the
OpenBSD partition is the bootable partition.

In the previous example we just viewed our information. What if we want to
edit our partition table? Well, to do so we must use the -e flag. This will
bring up a command line prompt to interact with fdisk.

    # fdisk -e wd0
    Enter 'help' for information
    fdisk: 1> help
            help            Command help list
            manual          Show entire OpenBSD man page for fdisk
            reinit          Re-initialize loaded MBR (to defaults)
            setpid          Set the identifier of a given table entry
            disk            Edit current drive stats
            edit            Edit given table entry
            flag            Flag given table entry as bootable
            update          Update machine code in loaded MBR
            select          Select extended partition table entry MBR
            swap            Swap two partition entries
            print           Print loaded MBR partition table
            write           Write loaded MBR to disk
            exit            Exit edit of current MBR, without saving changes
            quit            Quit edit of current MBR, saving current changes
            abort           Abort program without saving current changes
    fdisk: 1>

Here is an overview of the commands you can use when you choose the -e flag.

  * help Display a list of commands that fdisk understands in the interactive
    edit mode.
  * reinit Initialize the currently selected, in-memory copy of the boot
    block. This is a handy way to quickly slap a "full-disk" OpenBSD partition
    in place, update the boot code, and in general, make the system ready for
    OpenBSD (and nothing but OpenBSD).
  * disk Display the current drive geometry that fdisk is using. You are given
    a chance to edit it if you wish.
  * setpid Change the partition identifier of the given partition table entry.
    This command is particularly useful for reassigning an existing partition
    to OpenBSD.
  * edit Edit a given table entry in the memory copy of the current boot
    block. You may edit either in CHS geometry mode, or in sector offsets and
    sizes.
  * flag Make the given partition table entry bootable. Only one entry can be
    marked bootable. If you wish to boot from an extended partition, you will
    need to mark the partition table entry for the extended partition as
    bootable.
  * update Update the machine code in the memory copy of the currently
    selected boot block.
  * select Select and load into memory the boot block pointed to by the
    extended partition table entry in the current boot block.
  * swap Swaps two MBR entries, so you can re-order the MBR.
  * print Print the currently selected in-memory copy of the boot block and
    its MBR table to the terminal.
  * write Write the in-memory copy of the boot block to disk. You will be
    asked to confirm this operation.
  * exit Exit the current level of fdisk, either returning to the previously
    selected in-memory copy of a boot block, or exiting the program if there
    is none.
  * quit Exit the current level of fdisk, either returning to the previously
    selected in-memory copy of a boot block, or exiting the program if there
    is none. Unlike exit it does write the modified block out.
  * abort Quit program without saving current changes.

fdisk tricks and tips

  * fdisk(8) offers the ability to specify partitions both in raw sectors and
    in Cylinder/Head/Sector formats. Both options are given for a reason --
    some tasks are easier accomplished one way, others the other way. Don't
    lock yourself into only using one option.
  * A totally blank disk will need to have the master boot record's boot code
    written to the disk before it can boot. You can use the "reinit" or
    "update" options to do this. If you fail to do this, you can write a valid
    partition table with fdisk, but not have a bootable disk. You may wish to
    update the existing boot code anyway if you are uncertain of its origin.
  * If your system has a "maintenance" or "diagnostic" partition, it is
    recommended that you leave it in place or install it BEFORE installing
    OpenBSD.
  * For historical reasons, "q" saves changes and exits the program, and "x"
    exits without saving. This is the opposite of what many people are now
    used to in other environments. fdisk(8) does not warn before saving the
    changes, so use with care.

14.3 - Using OpenBSD's disklabel(8)

What is disklabel(8)?

First, be sure to read the disklabel(8) man page.

The details of setting up disks in OpenBSD varies somewhat between platforms.
For i386, amd64, macppc, zaurus, and armish, disk setup is done in two stages.
First, the OpenBSD slice of the hard disk is defined using fdisk(8), then that
slice is subdivided into OpenBSD partitions using disklabel(8).

All OpenBSD platforms, however, use disklabel(8) as the primary way to manage
OpenBSD partitions. Platforms that also use fdisk(8) place all the disklabel
(8) partitions in a single fdisk partition.

Labels hold certain information about your disk, like your drive geometry and
information about the filesystems on the disk. The disklabel is then used by
the bootstrap program to access the drive and to know where filesystems are
contained on the drive. You can read more in-depth information about disklabel
in the disklabel(5) man page.

On some platforms, disklabel helps overcome architecture limitations on disk
partitioning. For example, on i386, you can have 4 primary partitions, but
with disklabel(8), you use one of these 'primary' partitions to store all of
your OpenBSD partitions (for example, 'swap', '/', '/usr', '/var', etc.), and
you still have 3 more partitions available for other OSs.

disklabel(8) during OpenBSD's install

One of the major parts of OpenBSD's install is your initial creation of
labels. During the install you use disklabel(8) to create your separate
partitions. As part of the install process, you can define your mount points
from within disklabel(8), but you can change these later in the install or
post-install, as well.

There is not one "right" way to label a disk, but there are many wrong ways.
Before attempting to label your disk, see this discussion on partitioning and
partition sizing.

For an example of using disklabel(8) during install, see the Custom disklabel
layout part of the Installation Guide.

Using disklabel(8) after install

After install, one of the most common reasons to use disklabel(8) is to look
at how your disk is laid out. The following command will show you the current
disklabel, without modifying it:

    # disklabel wd0 <-- Or whatever disk device you'd like to view
    type: ESDI
    disk: ESDI/IDE disk
    label: SAMSUNG HD154UI
    duid: d920a43a5a56ad5f
    flags:
    bytes/sector: 512
    sectors/track: 63
    tracks/cylinder: 16
    sectors/cylinder: 1008
    cylinders: 2907021
    total sectors: 2930277168
    boundstart: 64
    boundend: 2930272065
    drivedata: 0

    16 partitions:
    #                size           offset  fstype [fsize bsize  cpg]
      a:          1024064               64  4.2BSD   2048 16384    1 # /
      b:          4195296          1024128    swap
      c:       2930277168                0  unused
      d:          4195296          5219424  4.2BSD   2048 16384    1 # /usr
      e:          4195296          9414720  4.2BSD   2048 16384    1 # /tmp
      f:         20972448         13610016  4.2BSD   2048 16384    1 # /var
      h:          2097632         34582464  4.2BSD   2048 16384    1 # /home

Note how this disk has only part of its disk space allocated at this time.
Disklabel offers two different modes for editing the disklabel, a built-in
command-driven editor (this is how you installed OpenBSD originally), and a
full editor, such as vi(1). You may find the command-driven editor "easier",
as it guides you through all the steps and provides help upon request, but the
full-screen editor has definite use, too.

Let's add a partition to the above system.

    Warning: Any time you are fiddling with your disklabel, you are putting
    all the data on your disk at risk. Make sure your data is backed up before
    editing an existing disklabel!

We will use the built-in command-driven editor, which is invoked using the
"-E" option to disklabel(8).

    # disklabel -E wd0
    ...
    > a k
    offset: [36680096]
    size: [2893591969] 1T
    Rounding to cylinder: 2147483536
    FS type: [4.2BSD]
    > p m
    OpenBSD area: 64-2930272065; size: 1430796.9M; free: 364310.8M
    #                size           offset  fstype [fsize bsize  cpg]
      a:           500.0M               64  4.2BSD   2048 16384    1 # /
      b:          2048.5M          1024128    swap
      c:       1430799.4M                0  unused
      d:          2048.5M          5219424  4.2BSD   2048 16384    1 # /usr
      e:          2048.5M          9414720  4.2BSD   2048 16384    1 # /tmp
      f:         10240.5M         13610016  4.2BSD   2048 16384    1 # /var
      h:          1024.2M         34582464  4.2BSD   2048 16384    1 # /home
      k:       1048575.9M         36680192  4.2BSD   8192 65536    1
    > q
    Write new label?: [y]

In this case, disklabel(8) was kind enough to calculate a good starting offset
for the partition. In many cases, it will be able to do this, but if you have
"holes" in the disklabel (i.e., you deleted a partition, or you just like
making your life miserable) you may need to sit down with a paper and pencil
to calculate the proper offset. Note that while disklabel(8) does some sanity
checking, it is very possible to do things very wrong here. Be careful,
understand the meaning of the numbers you are entering.

On most OpenBSD platforms, there are sixteen disklabel partitions available,
labeled "a" through "p". (some "specialty" systems may have only eight). Every
disklabel should have a 'c' partition, with an "fstype" of "unused" that
covers the entire physical drive. If your disklabel is not like this, it must
be fixed, the "D" option (below) can help. Never try to use the "c" partition
for anything other than accessing the raw sectors of the disk, do not attempt
to create a file system on "c". On the boot device, "a" is reserved for the
root partition, and "b" is the swap partition, but only the boot device makes
these distinctions. Other devices may use all fifteen partitions other than
"c" for file systems.

Disklabel tricks and tips

  * Get help: In the command-driven mode, hitting "?" will produce a list of
    available commands. "M" will show the man page for disklabel(8).
  * Reset to default: In some cases, you may wish to completely restart from
    scratch and delete all existing disklabel information. The "D" command
    will reset the label back to default, as if there had never been a
    disklabel on the drive.
  * Duplicating a disklabel: In some cases, you may wish to duplicate the
    partitioning from one disk to another, but not precisely (for example, you
    wish to have the same partitions, but on different sizes of drives). Use
    the '-e' (full-screen editor) mode of disklabel(8) to capture the
    partitions of the "model" drive, paste it into the new drive, remove the
    model's 'c' partition, save, and you have copied the disk layout to the
    other drive without altering its basic parameters.
  * (sparc/sparc64) Don't put swap at the very beginning of your disk. While
    Solaris often puts swap at the very beginning of a disk, OpenBSD requires
    the boot partition to be at the beginning of the disk.
  * (fdisk platforms) Leave first track free: On platforms using fdisk(8), you
    should leave the first logical track unused, both in disklabel(8) and in
    fdisk(8). On "modern" computers (i.e., almost everything that will run
    OpenBSD), the exact amount doesn't really matter, though for performance
    reasons on the newest disks, having partitions aligned at 4k boundaries is
    good for performance. For this reason, OpenBSD now defaults to starting
    the first partition at block 64 instead of 63.
  * Devices without a disklabel: If a device does not currently have an
    OpenBSD disklabel on it but has another file system (for example, a disk
    with a pre-existing FAT32 file system), the OpenBSD kernel will "create"
    one in memory, and that can form the basis of a formal OpenBSD disklabel
    to be stored on disk. However, if a disklabel is created and saved to
    disk, and a non-OpenBSD file system is added later, the disklabel will not
    be automatically updated. You must do this yourself if you wish OpenBSD to
    be able to access this file system. More on this below.
  * "q" vs. "x": For historical reasons, while in the command-driven editor
    mode, "q" saves changes and exits the program, and "x" exits without
    saving. This is the opposite of what many people are now used to in other
    environments. disklabel(8) does warn before saving the changes, though it
    will "x" quickly and quietly.
  * Auto-partitioning: New users are encouraged to use the 'A' command to
    auto-create a recommended disklabel. You can then edit or alter the
    auto-created label as you need.

14.4 - Adding extra disks in OpenBSD

Well once you get your disk installed PROPERLY you need to use fdisk(8) (i386
only) and disklabel(8) to set up your disk in OpenBSD.

For i386 folks, start with fdisk. Other architectures can ignore this. In the
below example we're adding a third SCSI-like drive to the system.

    # fdisk -i sd2

This will initialize the disk's "real" partition table for exclusive use by
OpenBSD. Next you need to create a disklabel for it. This will seem confusing.

    # disklabel -e sd2

    (screen goes blank, your $EDITOR comes up)
    type: SCSI
    ...bla...
    sectors/track: 63
    total sectors: 6185088
    ...bla...
    16 partitions:
    #        size   offset    fstype   [fsize bsize   cpg]
      c:  6185088        0    unused        0     0         # (Cyl.    0 - 6135)
      d:  1405080       63    4.2BSD     1024  8192    16   # (Cyl.    0*- 1393*)
      e:  4779945  1405143    4.2BSD     1024  8192    16   # (Cyl. 1393*- 6135)

First, ignore the 'c' partition, it's always there and is for programs like
disklabel to function! Fstype for OpenBSD is 4.2BSD. Total sectors is the
total size of the disk. Say this is a 3 gigabyte disk. Three gigabytes in disk
manufacturer terms is 3000 megabytes. So divide 6185088/3000 (use bc(1)). You
get 2061. So, to make up partition sizes for a, d, e, f, g, ... just multiply
X*2061 to get X megabytes of space on that partition. The offset for your
first new partition should be the same as the "sectors/track" reported earlier
in disklabel's output. For us it is 63. The offset for each partition
afterwards should be a combination of the size of each partition and the
offset of each partition (except the 'c' partition, since it has no play into
this equation.)

Or, if you just want one partition on the disk, say you will use the whole
thing for web storage or a home directory or something, just take the total
size of the disk and subtract the sectors per track from it. 6185088-63 =
6185025. Your partition is

        d:  6185025       63    4.2BSD     1024  8192    16

If all this seems needlessly complex, you can just use disklabel -E to get the
same partitioning mode that you got on your install disk! There, you can just
use "96M" to specify "96 megabytes", or 96G for 96 gigs.

That was a lot. But you are not finished. Finally, you need to create the
filesystem on that disk using newfs(8).

    # newfs sd2d

Or whatever your disk was named as per OpenBSD's disk numbering scheme. (Look
at the output from dmesg(8) to see what your disk was named by OpenBSD.)

Now figure out where you are going to mount this new partition you just
created. Say you want to put it on /u. First, make the directory /u. Then,
mount it.

    # mkdir /u
    # mount /dev/sd2d /u

Finally, add it to /etc/fstab(5).

    /dev/sd2d /u ffs rw 1 1

What if you need to migrate an existing directory like /usr/local? You should
mount the new drive in /mnt and copy /usr/local to the /mnt directory.
Example:

    # cd /usr/local && pax -rw -p e . /mnt

Edit the /etc/fstab(5) file to show that the /usr/local partition is now /dev/
sd2d (your freshly formatted partition). Example:

    /dev/sd2d /usr/local ffs rw 1 1

Reboot into single user mode with boot -s, move the existing /usr/local to /
usr/local-backup (or delete it if you feel lucky) and create an empty
directory /usr/local. Then reboot the system, and voila, the files are there!

14.5 - How is swap handled?

14.5.1 - About swap

Historically, all kinds of rules have been tossed about to guide
administrators on how much swap to configure on their machines. The problem,
of course, is there are few "normal" applications.

One non-obvious use for swap is to be a place the kernel can dump a copy of
what is in core in the event of a system panic for later analysis. For this to
work, you must have a swap partition (not a swap file) at least as large as
your RAM. By default, the system will save a copy of this dump to /var/crash
on reboot, so if you wish to be able to do this automatically, you will need
sufficient free space on /var. However, you can also bring the system up
single-user, and use savecore(8) to dump it elsewhere.

Many types of systems may be appropriately configured with no swap at all. For
example, firewalls should not swap in normal operation. Machines with flash
storage generally should not swap. If your firewall is flash based, you may
benefit (slightly) by not allocating a swap partition, though in most other
cases, a swap partition won't actually hurt anything; most disks have more
than enough space to allocate a little to swap.

There are all kinds of tips about optimizing swap (where on the disk, separate
disks, etc.), but if you find yourself in a situation where optimizing swap is
an issue, you probably need more RAM. In general, the best optimization for
swap is to not need it.

In OpenBSD, swap is managed with the swapctl(8) program, which adds, removes,
lists and prioritizes swap devices and files.

14.5.2 - Swapping to a partition

On OpenBSD, the 'b' partition of the boot drive is used by default and
automatically for swap. No configuration is needed for this to take place. If
you do not wish to use swap on the boot disk, do not define a "b" partition.
If you wish to use swap on other partitions or on other disks, you need to
define these partitions in /etc/fstab with lines something like:

    /dev/sd3b none swap sw 0 0
    /dev/sd3d none swap sw 0 0

14.5.3 - Swapping to a file

(Note: if you are looking to swap to a file because you are getting "virtual
memory exhausted" errors, you should try raising the per-process limits first
with csh(1)'s unlimit, or sh(1)'s ulimit.)

Sometimes, your initial guess about how much swap you need proves to be wrong,
and you have to add additional swap space, occasionally in a hurry (as in,
"Geez, at the rate it is burning swap, we'll be wedged in five minutes"). If
you find yourself in this position, adding swap space as a file on an existing
file system can be a quick fix.

The file must not reside on a filesystem which has soft updates enabled (they
are disabled by default). To start out, you can see how much swap you
currently have and how much you are using with the swapctl(8) utility. You can
do this by using the command:

    $ swapctl -l
    Device      512-blocks     Used    Avail Capacity  Priority
    swap_device      65520        8    65512     0%    0

This shows the devices currently being used for swapping and their current
statistics. In the above example there is only one device named "swap_device".
This is the predefined area on disk that is used for swapping. (Shows up as
partition b when viewing disklabels) As you can also see in the above example,
that device isn't getting much use at the moment, but for the purposes of this
document, we will act as if an extra 32M is needed.

The first step to setting up a file as a swap device is to create the file.
It's best to do this with the dd(1) utility. Here is an example of creating
the file /var/swap that is 32M in size.

    # dd if=/dev/zero of=/var/swap bs=1k count=32768
    32768+0 records in
    32768+0 records out
    33554432 bytes transferred in 20 secs (1677721 bytes/sec)

Once this has been done, we can turn on swapping to that device. Use the
following command to turn on swapping to this device

    # chmod 600 /var/swap
    # swapctl -a /var/swap

Now we need to check to see if it has been correctly added to the list of our
swap devices.

    $ swapctl -l
    Device      512-blocks     Used    Avail Capacity  Priority
    swap_device      65520        8    65512     0%    0
    /var/swap        65536        0    65536     0%    0
    Total           131056        8   131048     0%

Now that the file is setup and swapping is being done, you need to add a line
to your /etc/fstab file so that this file is configured on the next boot time
also. If this line is not added, you won't have this swap device configured.

    $ cat /etc/fstab
    /dev/wd0a / ffs rw 1 1
    /var/swap /var/swap swap sw 0 0

14.6 - Soft Updates

Soft updates is based on an idea proposed by Greg Ganger and Yale Patt and
developed for FreeBSD by Kirk McKusick. Soft updates imposes a partial
ordering on the buffer cache operations which permits the requirement for
synchronous writing of directory entries to be removed from the FFS code.
Thus, a large performance increase is seen in disk writing performance.

Enabling soft updates must be done with a mount-time option. When mounting a
partition with the mount(8) utility, you can specify that you wish to have
soft updates enabled on that partition. Below is a sample /etc/fstab(5) entry
that has one partition sd0a that we wish to have mounted with soft updates.

    /dev/sd0a / ffs rw,softdep 1 1

Note to sparc users: Do not enable soft updates on sun4 or sun4c machines.
These architectures support only a very limited amount of kernel memory and
cannot use this feature. However, sun4m machines are fine.

14.7 - How do OpenBSD/i386 and OpenBSD/amd64 boot?

The boot process for OpenBSD/i386 and OpenBSD/amd64 is not trivial, and
understanding how it works can be useful to troubleshoot a problem when things
don't work. There are four key pieces to the boot process:

 1. Master Boot Record (MBR): The Master Boot Record is the first 512 bytes on
    the disk. It contains the primary partition table and a small program to
    load the Partition Boot Record (PBR). Note that in some environments, the
    term "MBR" is used to refer to only the code portion of this first block
    on the disk, rather than the whole first block (including the partition
    table). It is critical to understand the meaning of "initialize the MBR"
    -- in the terminology of OpenBSD, it would involve rewriting the entire
    MBR, clearing any existing partition table, not just the code, as it might
    on some systems. You will often not want to do this. Instead, use fdisk(8)
    's "-u" command line option ("fdisk -u wd0") to (re)install the MBR boot
    code.

    While OpenBSD includes its own MBR code, you are not obliged to use it, as
    virtually any MBR code can boot OpenBSD. The MBR is manipulated by the
    fdisk(8) program, which is used both to edit the partition table, and also
    to install the MBR code on the disk.

    OpenBSD's MBR announces itself with the message:

        Using drive 0, partition 3.

    showing the disk and partition it is about to load the PBR from. In
    addition to the obvious, it also shows a trailing period ("."), which
    indicates this machine is capable of using LBA translation to boot. If the
    machine were incapable of using LBA translation, the above period would
    have been replaced with a semicolon (";"), indicating CHS translation:

        Using drive 0, partition 3;

    Note that the trailing period or semicolon can be used as an indicator of
    the "new" OpenBSD MBR, introduced with OpenBSD 3.5.

 2. Partition Boot Record (PBR): The Partition Boot Record, also called the
    PBR or biosboot(8) (after the name of the file that holds the code) is the
    first 512 bytes of the OpenBSD partition of the disk. The PBR is the
    "first-stage boot loader" for OpenBSD. It is loaded by the MBR code, and
    has the task of loading the OpenBSD second-stage boot loader, boot(8).
    Like the MBR, the PBR is a very tiny section of code and data, only 512
    bytes, total. That's not enough to have a fully filesystem-aware
    application, so rather than having the PBR locate /boot on the disk, the
    BIOS-accessible location of /boot is physically coded into the PBR at
    installation time.

    The PBR is installed by installboot(8), which is further described later
    in this document. The PBR announces itself with the message:

        Loading...

    printing a dot for every file system block it attempts to load. Again, the
    PBR shows if it is using LBA or CHS to load, if it has to use CHS
    translation, it displays a message with a semicolon:

        Loading;...

 3. Second Stage Boot Loader, /boot: /boot is loaded by the PBR, and has the
    task of accessing the OpenBSD file system through the machine's BIOS, and
    locating and loading the actual kernel. boot(8) also passes various
    options and information to the kernel.

    boot(8) is an interactive program. After it loads, it attempts to locate
    and read /etc/boot.conf, if it exists (which it does not on a default
    install), and processes any commands in it. Unless instructed otherwise by
    /etc/boot.conf, it then gives the user a prompt:

        probing: pc0 com0 com1 apm mem[636k 190M a20=on]
        disk: fd0 hd0+
        >> OpenBSD/i386 BOOT 3.26
        boot>

    It gives the user (by default) five seconds to start giving it other
    tasks, but if none are given before the timeout, it starts its default
    behavior: loading the kernel, bsd, from the root partition of the first
    hard drive. The second-stage boot loader probes (examines) your system
    hardware, through the BIOS (as the OpenBSD kernel is not loaded). Above,
    you can see a few things it looked for and found:
      + pc0 - the standard keyboard and video display of an i386 system.
      + com0, com1 - Two serial ports
      + apm - Advanced Power Management BIOS functions
      + 636k 190M - The amount of conventional (below 1M) and extended (above
        1M) memory it found
      + fd0 hd0+ - The BIOS disk devices found, in this case, one floppy and
        one hard disk.
    The '+' character after the "hd0" indicates that the BIOS has told /boot
    that this disk can be accessed via LBA. When doing a first-time install,
    you will sometimes see a '*' after a hard disk -- this indicates a disk
    that does not seem to have a valid OpenBSD disk label on it.

 4. Kernel: /bsd: This is the goal of the boot process, to have the OpenBSD
    kernel loaded into RAM and properly running. Once the kernel has loaded,
    OpenBSD accesses the hardware directly, no longer through the BIOS.

So, the very start of the boot process could look like this:

    Using drive 0, partition 3.                      <- MBR
    Loading....                                      <- PBR
    probing: pc0 com0 com1 apm mem[636k 190M a20=on] <- /boot
    disk: fd0 hd0+
    >> OpenBSD/i386 BOOT 3.26
    boot>
    booting hd0a:/bsd 4464500+838332 [58+204240+181750]=0x56cfd0
    entry point at 0x100120

    [ using 386464 bytes of bsd ELF symbol table ]
    Copyright (c) 1982, 1986, 1989, 1991, 1993       <- Kernel
            The Regents of the University of California.  All rights reserved.
    Copyright (c) 1995-2015 OpenBSD.  All rights reserved.  http://www.OpenBSD.org

    OpenBSD 5.8 (GENERIC) #1066: Sun Aug 16 02:33:00 MDT 2015
        deraadt@@i386.openbsd.org:/usr/src/sys/arch/i386/compile/GENERIC
       ...

What can go wrong

  * Bad/invalid/incompatible MBR: Usually, a used hard disk has some MBR code
    in place, but if the disk is new or moved from a different platform, AND
    you don't answer "w" to the "Use (W)hole disk or (E)dit the MBR?" question
    of the installation process, you may end up with a disk without a valid
    MBR, and thus, it will not be bootable, even though it has a valid
    partition table.

    You may install the OpenBSD MBR on your hard disk using the fdisk program.
    Boot from your install media, choose "Shell" to get a command prompt:

        # fdisk -u wd0

    You may also install a specific MBR to disk using fdisk:

        # fdisk -u -f /usr/mdec/mbr wd0

    which will install the file /usr/mdec/mbr as your system's MBR. This
    particular file on a standard OpenBSD install happens to be the standard
    MBR that is also built into fdisk, but any other MBR could be specified
    here.

  * Invalid /boot location installed in PBR: When installboot(8) installs the
    partition boot record, it writes the block number and offset of /boot's
    inode into the PBR. Therefore, deleting and replacing /boot without
    re-running installboot(8) will render your system unbootable, as the PBR
    will load whatever happens to be pointed to by the inode specified in it,
    which will almost certainly no longer be the desired second-stage boot
    loader! Since /boot is being read using BIOS calls, old versions of the
    PBR were sensitive to BIOS disk translation. If you altered the drive's
    geometry (i.e., took it out of one computer that uses CHS translation and
    moving it into one that uses LBA translation, or even changed a
    translation option in your BIOS), it would have appeared to the BIOS to be
    in a different location (a different numerical block must be accessed to
    get the same data from the disk), so you would have had to run installboot
    (8) before the system could be rebooted. The new (as of OpenBSD 3.5 and
    later) PBR is much more tolerant to changes in translation.

As the PBR is very small, its range of error messages is pretty limited, and
somewhat cryptic. Most likely messages are:

  * ERR R -- BIOS returned an error when trying to read a block from the disk.
    Usually means exactly what it says: your disk wasn't readable.
  * ERR M -- An invalid magic(5) number was read in the second-stage
    bootloader's header. This generally means whatever it was that was read in
    was NOT /boot, usually meaning installboot(8) was run incorrectly, the /
    boot file was altered, or you have exceeded your BIOS's ability to read a
    large disk.

Other error messages are detailed in the biosboot(8) manual page.

For more information on the i386 boot process, see:

  * boot_i386(8)
  * http://www.ata-atapi.com/hiw.html Hale Landis' "How it Works" documents.

14.8 - What are the issues regarding large drives with OpenBSD?

OpenBSD supports both FFS and FFS2 (also known as UFS and UFS2) file systems.
FFS is the historic OpenBSD file system, FFS2 is new as of 4.3. Before looking
at the limits of each system, we need to look at some more general system
limits.

Of course, the ability of file system and the abilities of particular hardware
are two different things. A newer 250G IDE hard disk may have issues on older
(pre >137G standards) interfaces (though for the most part, they work just
fine), and some very old SCSI adapters have been seen to have problems with
more modern drives, and some older BIOSs will hang when they encounter a
modern sized hard disk. You must respect the abilities of your hardware and
boot code, of course.

Partition size and location limitations

Unfortunately, the full ability of the OS isn't available until AFTER the OS
has been loaded into memory. The boot process has to utilize (and is thus
limited by) the system's boot ROM.

For this reason, the entire /bsd file (the kernel) must be located on the disk
within the boot ROM addressable area. This means that on some older i386
systems, the root partition must be completely within the first 504M, but
newer computers may have limits of 2G, 8G, 32G, 128G or more. It is worth
noting that many relatively new computers which support larger than 128G
drives actually have BIOS limitations of booting only from within the first
128G. You can use these systems with large drives, but your root partition
must be within the space supported by the boot ROM.

Note that it is possible to install a 40G drive on an old 486 and load OpenBSD
on it as one huge partition, and think you have successfully violated the
above rule. However, it might come back to haunt you in a most unpleasant way:

  * You install on the 40G / partition. It works, because the base OS and all
    its files (including /bsd) are within the first 504M.
  * You use the system, and end up with more than 504M of files on it.
  * You upgrade, and copy your new /bsd over the old one.
  * You reboot.
  * You get a message such as "ERR M" or other problems on boot.

Why? Because when you copied "over" the new /bsd file, it didn't overwrite the
old one, it got relocated to a new location on the disk, probably outside the
504M range the BIOS supported. The boot loader was unable to fetch the file /
bsd, and the system hung.

To get OpenBSD to boot, the boot loaders (biosboot(8) and /boot in the case of
i386/amd64) and the kernel (/bsd) must be within the boot ROM's supported
range, and within their own abilities. To play it safe, the rule is simple:

    The entire root partition must be within the computer's BIOS (or boot ROM)
    addressable space.

Some non-i386 users think they are immune to this, however most platforms have
some kind of boot ROM limitation on disk size. Finding out for sure what the
limit is, however, can be difficult.

This is another good reason to partition your hard disk, rather than using one
large partition.

fsck(8) time and memory requirements

Another consideration with large file systems is the time and memory required
to fsck(8) the file system after a crash or power interruption. One should not
put a 120G file system on a system with 32M of RAM and expect it to
successfully fsck(8) after a crash. A rough guideline is the system should
have at least 1M of available memory for every 1G of disk space to
successfully fsck the disk. Swap can be used here, but at a very significant
performance penalty, so severe that it is usually unacceptable, except in
special cases.

The time required to fsck the drive may become a problem as the file system
size expands, but you only have to fsck the disk space that is actually
allocated to mounted filesystems. This is another reason NOT to allocate all
your disk space Just Because It Is There. Keeping file systems mounted RO or
not mounted helps keep them from needing to be fsck(8)ed after tripping over
the power cord. Reducing the number of inodes (using the -i option of newfs)
can also improve fsck time -- assuming you really don't need them.

Don't forget that if you have multiple disks on the system, they could all end
up being fsck(8)ed after a crash at the same time, so they could require more
RAM than a single disk.

FFS vs. FFS2

Using FFS, OpenBSD supports an individual file system of up to 2^31-1, or
2,147,483,647 blocks, and as each block is 512 bytes, that's a tiny amount
less than 1T. FFS2 is capable of much larger file systems, though other limits
will be reached long before the file system limits will be reached.

The boot/installation kernels only support FFS, not FFS2, so key system
partitions (/, /usr, /var, /tmp) should not be FFS2, or severe maintenance
problems can arise (there should be no reason for those partitions to be that
large, anyway). For this reason, very large partitions should only be used for
"non-system" partitions, for example, /home, /var/www/, /bigarray, etc.

Note that not all controllers and drivers support large disks. For example,
ami(4) has a limit of 2TB per logical volume. Always be aware of what was
available when a controller or interface was manufactured, and don't just rely
on "the connectors fit".

Disks larger than 2TB

The MBR system used on PCs only directly understands disks up to 2TB in size.
fdisk(8) will show disks larger than 2TB as only 2TB. This does not in any way
hinder OpenBSD's ability to utilize larger disks, as the MBR is used only to
bootstrap the OS. Once the OS is running, the file systems are defined by the
disklabel, which does not have a 2TB limit.

To use a disk larger than 2TB, create an OpenBSD partition on the disk using
fdisk, whatever size fdisk will let you. When you label the disk with
disklabel(8), use the "b" option to set the OpenBSD boundaries (which
defaulted to the size of the OpenBSD fdisk partition) to cover the entire
disk. Now you can create your partitions as you wish. You must still respect
the abilities of your BIOS, which will have the limitation of only
understanding fdisk partitions, so your 'a' partition should be entirely
within the fdisk-managed part of the disk, in addition to any BIOS
limitations.

14.9 - Installing Bootblocks (most, but not all platforms)

OpenBSD has a very robust boot loader that is quite indifferent to drive
geometries, however, it is sensitive to where the file /boot resides on the
disk. If you do something that causes boot(8) to be moved to a new place on
the disk (actually, a new inode), you will "break" your system, preventing it
from booting properly. To fix your boot block so that you can boot normally,
just use any boot media (CD, floppy, network, USB) to get a boot> prompt, then
type "boot hd0a:/bsd" to force it to boot from the first hard disk (and not
the boot media). Your machine should come up normally. You now need to
reinstall the first-stage boot loader (biosboot(8)) based on the position of
the /boot file, using the installboot(8) program.

Our example will assume your boot disk is sd0 (but for IDE it would be wd0,
etc.):

    # installboot sd0

installboot(8) copies over a new second stage boot loader to /boot and
installs the first stage boot loader to look for it in the right place.

14.10 - Preparing for disaster: Backing up and Restoring from tape

Introduction:

If you plan on running what might be called a production server, it is
advisable to have some form of backup in the event one of your fixed disk
drives fails, or the data is otherwise lost.

This information will assist you in using the standard dump(8)/restore(8)
utilities provided with OpenBSD. More advanced backup utilities, such as
"Bacula" are available through packages for backing up multiple servers to
disk and tape.

Backing up to tape:

Backing up to tape requires knowledge of where your file systems are mounted.
You can determine how your filesystems are mounted using the mount(8) command
at your shell prompt. You should get output similar to this:

    # mount
    /dev/sd0a on / type ffs (local)
    /dev/sd0h on /usr type ffs (local)

In this example, the root (/) filesystem resides physically on sd0a which
indicates a SCSI-like fixed disk 0, partition a. The /usr filesystem resides
on sd0h, which indicates SCSI-like fixed disk 0, partition h.

Another example of a more advanced mount table might be:

    # mount
    /dev/sd0a on / type ffs (local)
    /dev/sd0d on /var type ffs (local)
    /dev/sd0e on /home type ffs (local)
    /dev/sd0h on /usr type ffs (local)

In this more advanced example, the root (/) filesystem resides physically on
sd0a. The /var filesystem resides on sd0d, the /home filesystem on sd0e and
finally /usr on sd0h.

To backup your machine, you will need to feed dump the name of each fixed disk
partition. Here is an example of the commands needed to backup the simpler
mount table listed above:

    # /sbin/dump -0au -f /dev/nrst0 /dev/rsd0a
    # /sbin/dump -0au -f /dev/nrst0 /dev/rsd0h
    # mt -f /dev/rst0 rewind

For the more advanced mount table example, you would use something similar to:

    # dump -0au -f /dev/nrst0 /dev/rsd0a
    # dump -0au -f /dev/nrst0 /dev/rsd0d
    # dump -0au -f /dev/nrst0 /dev/rsd0e
    # dump -0au -f /dev/nrst0 /dev/rsd0h
    # mt -f /dev/rst0 rewind

You can review the dump(8) man page to learn exactly what each command line
switch does. Here is a brief description of the parameters used above:

  * 0 - Perform a level 0 dump, get everything
  * a - Attempt to automatically determine tape media length
  * u - Update the file /etc/dumpdates to indicate when backup was last
    performed
  * f - Which tape device to use (/dev/nrst0 in this case)

Finally which partition to backup (/dev/rsd0a, etc.)

The mt(1) command is used at the end to rewind the drive. Review the mt man
page for more options (such as eject).

If you are unsure of your tape device name, use dmesg to locate it. An example
tape drive entry in dmesg might appear similar to:

    st0 at scsibus0 targ 5 lun 0: <ARCHIVE, Python 28388-XXX, 5.28>

You may have noticed that when backing up, the tape drive is accessed as
device name "nrst0" instead of the "st0" name that is seen in dmesg. When you
access st0 as nrst0 you are accessing the same physical tape drive but telling
the drive to not rewind at the end of the job and access the device in raw
mode. To back up multiple file systems to a single tape, be sure you use the
non-rewind device, if you use a rewind device (rst0) to back up multiple file
systems, you'll end up overwriting the prior filesystem with the next one dump
tries to write to tape. You can find a more elaborate description of various
tape drive devices in the dump man page.

If you wanted to write a small script called "backup", it might look something
like this:

    echo "  Starting Full Backup..."
    dump -0au -f /dev/nrst0 /dev/rsd0a
    dump -0au -f /dev/nrst0 /dev/rsd0d
    dump -0au -f /dev/nrst0 /dev/rsd0e
    dump -0au -f /dev/nrst0 /dev/rsd0h
    echo
    echo -n "  Rewinding Drive, Please wait..."
    mt -f /dev/rst0 rewind
    echo "Done."
    echo

If scheduled nightly backups are desired, cron(8) could be used to launch your
backup script automatically.

It will also be helpful to document (on a scrap of paper) how large each file
system needs to be. You can use "df -h" to determine how much space each
partition is currently using. This will be handy when the drive fails and you
need to recreate your partition table on the new drive.

Restoring your data will also help reduce fragmentation. To ensure you get all
files, the best way of backing up is rebooting your system in single user
mode. File systems do not need to be mounted to be backed up. Don't forget to
mount root (/) r/w after rebooting in single user mode or your dump will fail
when trying to write out dumpdates. Enter "bsd -s" at the boot> prompt for
single user mode.

Viewing the contents of a dump tape:

After you've backed up your file systems for the first time, it would be a
good idea to briefly test your tape and be sure the data on it is as you
expect it should be.

You can use the following example to review a catalog of files on a dump tape:

    # restore -tvs 1 -f /dev/rst0

This will cause a list of files that exist on the 1st partition of the dump
tape to be listed. Following along from the above examples, 1 would be your
root (/) file system.

To see what resides on the 2nd tape partition and send the output to a file,
you would use a command similar to:

    # restore -tvs 2 -f /dev/rst0 > /home/me/list.txt

If you have a mount table like the simple one, 2 would be /usr, if yours is a
more advanced mount table 2 might be /var or another fs. The sequence number
matches the order in which the file systems are written to tape.

Restoring from tape:

The example scenario listed below would be useful if your fixed drive has
failed completely. In the event you want to restore a single file from tape,
review the restore man page and pay attention to the interactive mode
instructions.

If you have prepared properly, replacing a disk and restoring your data from
tape can be a very quick process. The standard OpenBSD install/boot CD already
contains the required restore utility as well as the binaries required to
partition and make your new drive bootable. In most cases, a CD and your most
recent dump tape is all you'll need to get back up and running.

After physically replacing the failed disk drive, the basic steps to restore
your data are as follows:

  * Boot from the OpenBSD install/boot floppy. At the menu selection, choose
    Shell. Write protect and insert your most recent back up tape into the
    drive.
  * Using the fdisk(8) command, create a primary OpenBSD partition on this
    newly installed drive. Example:

        # fdisk -e sd0

    See fdisk FAQ for more info.
  * Using the disklabel command, recreate your OpenBSD partition table inside
    that primary OpenBSD partition you just created with fdisk. Example:

        # disklabel -E sd0

    (Don't forget swap, see disklabel FAQ for more info)
  * Use the newfs command to build a clean file system on each partition you
    created in the above step. Example:

        # newfs /dev/rsd0a
        # newfs /dev/rsd0h

  * Mount your newly prepared root (/) file system on /mnt. Example:

        # mount /dev/sd0a /mnt

  * Change into that mounted root file system and start the restore process.
    Example:

        # cd /mnt
        # restore -rs 1 -f /dev/rst0

  * You'll want this new disk to be bootable, use the following to write a new
    MBR to your drive. Example:

        # fdisk -i sd0

  * In addition to writing a new MBR to the drive, you will need to install
    boot blocks to boot from it. The following is a brief example:

        # installboot -v -r /mnt sd0

  * Your new root file system on the fixed disk should be ready enough so you
    can boot it and continue restoring the rest of your file systems. Since
    your operating system is not complete yet, be sure you boot back up with
    single user mode. At the shell prompt, issue the following commands to
    unmount and halt the system:

        # umount /mnt
        # halt

  * Remove the install/boot floppy from the drive and reboot your system. At
    the OpenBSD boot> prompt, issue the following command:

        boot> bsd -s

    The bsd -s will cause the kernel to be started in single user mode which
    will only require a root (/) file system.
  * Assuming you performed the above steps correctly and nothing has gone
    wrong, you should end up at a prompt asking you for a shell path or press
    return. Press return to use sh. Next, you'll want to remount root in r/w
    mode as opposed to read only. Issue the following command:

        # mount -u -w /

  * Once you have re-mounted in r/w mode, you can continue restoring your
    other file systems. Example:

        (simple mount table)
        # mount /dev/sd0h /usr; cd /usr; restore -rs 2 -f /dev/rst0

        (more advanced mount table)
        # mount /dev/sd0d /var; cd /var; restore -rs 2 -f /dev/rst0
        # mount /dev/sd0e /home; cd /home; restore -rs 3 -f /dev/rst0
        # mount /dev/sd0h /usr; cd /usr; restore -rs 4 -f /dev/rst0

    You could use "restore rvsf" instead of just rsf to view names of objects
    as they are extracted from the dump set.
  * Finally after you finish restoring all your other file systems to disk,
    reboot into multiuser mode. If everything went as planned, your system
    will be back to the state it was in as of your most recent back up tape
    and ready to use again.

14.11 - Mounting disk images in OpenBSD

To mount a disk image (ISO images, disk images created with dd, etc.) in
OpenBSD you must configure a vnd(4) device. For example, if you have an ISO
image located at /tmp/ISO.image, you would take the following steps to mount
the image.

    # vnconfig vnd0 /tmp/ISO.image
    # mount -t cd9660 /dev/vnd0c /mnt

Notice that since this is an ISO-9660 image, as used by CDs and DVDs, you must
specify type of cd9660 when mounting it. This is true, no matter what type,
e.g. you must use type ext2fs when mounting Linux disk images.

To unmount the image, use the following commands.

    # umount /mnt
    # vnconfig -u vnd0

For more information, refer to the vnconfig(8) man page.

14.12 - Help! I'm getting errors with IDE DMA!

DMA IDE transfers, supported by pciide(4) are unreliable with many
combinations of older hardware.

OpenBSD is aggressive and attempts to use the highest DMA Mode it can
configure. This will cause corruption of data transfers in some configurations
because of buggy motherboard chipsets, buggy drives, and/or noise on the
cables. Luckily, Ultra-DMA modes protect data transfers with a CRC to detect
corruption. When the Ultra-DMA CRC fails, OpenBSD will print an error message
and try the operation again.

    wd2a:  aborted command, interface CRC error reading fsbn 64 of 64-79
    (wd2 bn 127; cn 0 tn 2 sn 1), retrying

After failing a couple times, OpenBSD will downgrade to a slower (hopefully
more reliable) Ultra-DMA mode. If Ultra-DMA mode 0 is hit, then the drive
downgrades to PIO mode.

UDMA errors are often caused by low quality or damaged cables. Cable problems
should usually be the first suspect if you get many DMA errors or unexpectedly
low DMA performance. It is also a bad idea to put the CD-ROM on the same
channel with a hard disk.

If replacing cables does not resolve the problem and OpenBSD does not
successfully downgrade, or the process causes your machine to lock hard, or
causes excessive messages on the console and in the logs, you may wish to
force the system to use a lower level of DMA or UDMA by default. This can be
done by using UKC or config(8) to change the flags on the wd(4) device.

14.14 - Why does df(1) tell me I have over 100% of my disk used?

People are sometimes surprised to find they have negative available disk
space, or more than 100% of a filesystem in use, as shown by df(1).

When a filesystem is created with newfs(8), some of the available space is
held in reserve from normal users. This provides a margin of error when you
accidently fill the disk, and helps keep disk fragmentation to a minimum.
Default for this is 5% of the disk capacity, so if the root user has been
carelessly filling the disk, you may see up to 105% of the available capacity
in use.

If the 5% value is not appropriate for you, you can change it with the tunefs
(8) command.

14.15 - Recovering partitions after deleting the disklabel

If you have a damaged partition table, there are various things you can
attempt to do to recover it.

Firstly, panic. You usually do so anyways, so you might as well get it over
with. Just don't do anything stupid. Panic away from your machine. Then relax,
and see if the steps below won't help you out.

A copy of the disklabel for each disk is saved in /var/backups as part of the
daily system maintenance. Assuming you still have the var partition, you can
simply read the output, and put it back into disklabel.

In the event that you can no longer see that partition, there are two options.
Fix enough of the disk so you can see it, or fix enough of the disk so that
you can get your data off. Depending on what happened, one or other of those
may be preferable (with dying disks you want the data first, with sloppy
fingers you can just have the label)

The first tool you need is scan_ffs(8) (note the underscore, it isn't called
"scanffs"). scan_ffs(8) will look through a disk, and try and find partitions
and also tell you what information it finds about them. You can use this
information to recreate the disklabel. If you just want /var back, you can
recreate the partition for /var, and then recover the backed up label and add
the rest from that.

disklabel(8) will update both the kernel's understanding of the disklabel, and
then attempt to write the label to disk. Therefore, even if the area of the
disk containing the disklabel is unreadable, you will be able to mount(8) it
until the next reboot.

14.16 - Can I access data on filesystems other than FFS?

Yes. Other supported filesystems include: ext2/3/4 (Linux), ISO9660 and UDF
(CD-ROM, DVD media), FAT (MS-DOS and Windows), NFS, NTFS (Windows). Some of
them have limited support; for instance read-only.

We will give a general overview on how to use one of these filesystems under
OpenBSD. To be able to use a filesystem, it must be mounted. For details and
mount options, please consult the mount(8) manual page, and that of the mount
command for the filesystem you will be mounting, e.g. mount_msdos,
mount_ext2fs, ...

First, you must know on which device your filesystem is located. This can be
simply your first hard disk, wd0 or sd0, but it may be less obvious. All
recognized and configured devices on your system are mentioned in the output
of the dmesg(1) command: a device name, followed by a one-line description of
the device. For example, my first CD-ROM drive is recognized as follows:

    cd0 at scsibus0 targ 0 lun 0: <COMPAQ, DVD-ROM LTD163, GQH3> SCSI0 5/cdrom removable

For a much shorter list of available disks, you can use sysctl(8). The command

    # sysctl hw.disknames

will show all disks currently known to your system, for example:

    hw.disknames=sd0:303c29298c315c77,cd0:,fd0:

At this point, it is time to find out which partitions are on the device, and
in which partition the desired filesystem resides. Therefore, we examine the
device using disklabel(8). The disklabel contains a list of partitions, with a
maximum number of 16. Partition c always indicates the entire device.
Partitions a-b and d-p are used by OpenBSD. Partitions i-p may be
automatically allocated to file systems of other operating systems. In this
case, I'll be viewing the disklabel of my hard disk, which contains a number
of different filesystems.

NOTE: OpenBSD was installed after the other operating systems on this system,
and during the install a disklabel containing partitions for the native as
well as the foreign filesystems was installed on the disk. However, if you
install foreign filesystems after the OpenBSD disklabel was already installed
on the disk, you need to add or modify them manually afterwards. This will be
explained in this subsection.

    # disklabel wd0

    # using MBR partition 2: type A6 off 20338290 (0x1365672) size 29318625 (0x1bf5de1)
    # /dev/rwd0c:
    type: ESDI
    disk: ESDI/IDE disk
    label: ST340016A
    duid: d920a43a5a56ad5f
    flags:
    bytes/sector: 512
    sectors/track: 63
    tracks/cylinder: 16
    sectors/cylinder: 1008
    cylinders: 16383
    total sectors: 78165360
    boundstart: 20338290
    boundend: 49656915
    drivedata: 0

    16 partitions:
    #             size        offset  fstype [fsize bsize  cpg]
      a:        408366      20338290  4.2BSD   2048 16384   16 # /
      b:       1638000      20746656    swap
      c:      78165360             0  unused
      d:       4194288      22384656  4.2BSD   2048 16384   16 # /usr
      e:        409248      26578944  4.2BSD   2048 16384   16 # /tmp
      f:      10486224      26988192  4.2BSD   2048 16384   16 # /var
      g:      12182499      37474416  4.2BSD   2048 16384   16 # /home
      i:         64197            63 unknown
      j:      20274030         64260 unknown
      k:       1975932      49656978   MSDOS
      l:       3919797      51632973 unknown
      m:       2939832      55552833  ext2fs
      n:       5879727      58492728  ext2fs
      o:      13783707      64372518  ext2fs


As can be seen in the above output, the OpenBSD partitions are listed first.
Next to them are a number of ext2 partitions and one MSDOS partition, as well
as a few 'unknown' partitions. On i386 and amd64 systems, you can usually find
out more about those using the fdisk(8) utility. For the curious reader:
partition i is a maintenance partition created by the vendor, partition j is a
NTFS partition and partition l is a Linux swap partition.

Once you have determined which partition it is you want to use, you can move
to the final step: mounting the filesystem contained in it. Most filesystems
are supported in the GENERIC kernel: just have a look at the kernel
configuration file, located in the /usr/src/sys/arch/<arch>/conf directory. If
you want to use one of the filesystems not supported in GENERIC, you will need
to build a custom kernel.

When you have gathered the information needed as mentioned above, it is time
to mount the filesystem. Let's assume a directory /mnt/otherfs exists, which
we will use as a mount point where we will mount the desired filesystem. In
this example, we will mount the ext2 filesystem in partition m:

    # mount -t ext2fs /dev/wd0m /mnt/otherfs

If you plan to use this filesystem regularly, you may save yourself some time
by inserting a line for it in /etc/fstab, for example something like:

    /dev/wd0m /mnt/otherfs ext2fs rw,noauto,nodev,nosuid 0 0

Notice the 0 values in the fifth and sixth field. This means we do not require
the filesystem to be dumped, and checked using fsck. Generally, those are
things you want to have handled by the native operating system associated with
the filesystem.

14.16.1 - The partitions are not in my disklabel! What should I do?

If you install foreign filesystems on your system (often the result of adding
a new operating system) after you have already installed OpenBSD, a disklabel
will already be present, and it will not be updated automatically to contain
the new foreign filesystem partitions. If you wish to use them, you need to
add or modify these partitions manually using disklabel(8).

As an example, I have modified one of my existing ext2 partitions: using
Linux's fdisk program, I've reduced the size of the 'o' partition (see
disklabel output above) to 1G. We will be able to recognize it easily by its
starting position (offset: 64372518) and size (13783707). Note that these
values are sector numbers, and that using sector numbers (not megabytes or any
other measure) is the most exact and safest way of reading this information.

Before the change, the partition looked like this using OpenBSD's fdisk(8)
utility (leaving only relevant output):

    # fdisk wd0
    . . .
    Offset: 64372455        Signature: 0xAA55
             Starting       Ending       LBA Info:
     #: id    C   H  S -    C   H  S [       start:      size   ]
    ------------------------------------------------------------------------
     0: 83 4007   1  1 - 4864 254 63 [    64372518:    13783707 ] Linux files*
    . . .

As you can see, the starting position and size are exactly those reported by
disklabel(8) earlier. (Dont' be confused by the value indicated by "Offset":
it is referring to the starting position of the extended partition in which
the ext2 partition is contained.)

After changing the partition's size from Linux, it looks like this:

    # fdisk wd0
    . . .
    Offset: 64372455        Signature: 0xAA55
             Starting       Ending       LBA Info:
     #: id    C   H  S -    C   H  S [       start:      size   ]
    ------------------------------------------------------------------------
     0: 83 4007   1  1 - 4137 254 63 [    64372518:     2104452 ] Linux files*
    . . .

Now this needs to be changed using disklabel(8). For instance, you can issue
disklabel -e wd0, which will invoke an editor specified by the EDITOR
environment variable (default is vi). Within the editor, change the last line
of the disklabel to match the new size:

      o:       2104452      64372518  ext2fs

Save the disklabel to disk when finished. Now that the disklabel is up to date
again, you should be able to mount your partitions as described above.

You can follow a very similar procedure to add new partitions.

14.17 - Can I use a flash memory device with OpenBSD?

14.17.1 - Flash memory as a portable storage device

Normally, the memory device should be recognized upon plugging it into a port
of your machine. Shortly after inserting it, a number of messages are written
to the console by the kernel. For instance, when I plug in my USB flash memory
device, I see the following on my console:

    umass0 at uhub1 port 1 configuration 1 interface 0
    umass0: LEXR PLUG DRIVE LEXR PLUG DRIVE, rev 1.10/0.01, addr 2
    umass0: using SCSI over Bulk-Only
    scsibus2 at umass0: 2 targets
    sd0 at scsibus2 targ 1 lun 0: <LEXAR, DIGITAL FILM, /W1.> SCSI2 0/direct removable
    sd0: 123MB, 512 bytes/sec, 251904 sec total

These lines indicate that the umass(4) (USB mass storage) driver has been
attached to the memory device, and that it is using the SCSI system. The last
two lines are the most important ones: they are saying to which device node
the memory device has been attached, and what the total amount of storage
space is. If you somehow missed these lines, you can still see them afterwards
with the dmesg(1) command. The reported CHS geometry is a rather fictitious
one, as the flash memory is being treated like any regular SCSI disk.

We will discuss two scenarios below.

The device is new/empty and you want to use it with OpenBSD only

You will need to initialize a disklabel onto the device, and create at least
one partition. Please read Using OpenBSD's disklabel and the disklabel(8)
manual page for details about this.

In this example I created just one partition a in which I will place a FFS
filesystem:

    # newfs sd0a
    Warning: inode blocks/cyl group (125) >= data blocks (62) in last
        cylinder group. This implies 1984 sector(s) cannot be allocated.
    /dev/rsd0a:     249856 sectors in 122 cylinders of 64 tracks, 32 sectors
            122.0MB in 1 cyl groups (122 c/g, 122.00MB/g, 15488 i/g)
    super-block backups (for fsck -b #) at:
     32,

Let's mount the filesystem we created in the a partition on /mnt/flashmem.
Create the mount point first if it does not exist.

    # mkdir /mnt/flashmem
    # mount /dev/sd0a /mnt/flashmem

You received the memory device from someone with whom you want to exchange
data

There is a considerable chance the other person is not using OpenBSD, so there
may be a foreign filesystem on the memory device. Therefore, we will first
need to find out which partitions are on the device, as described in FAQ 14 -
Foreign Filesystems.

    # disklabel sd0

    # /dev/rsd0c:
    type: SCSI
    disk: SCSI disk
    label: DIGITAL FILM
    flags:
    bytes/sector: 512
    sectors/track: 32
    tracks/cylinder: 64
    sectors/cylinder: 2048
    cylinders: 123
    total sectors: 251904
    rpm: 3600
    interleave: 1
    trackskew: 0
    cylinderskew: 0
    headswitch: 0           # microseconds
    track-to-track seek: 0  # microseconds
    drivedata: 0

    16 partitions:
    #             size        offset  fstype [fsize bsize  cpg]
      c:        251904             0  unused      0     0      # Cyl     0 -   122
      i:        250592            32   MSDOS                   # Cyl     0*-   122*

As can be seen in the disklabel output above, there is only one partition i,
containing a FAT filesystem created on a Windows machine. As usual, the c
partition indicates the entire device.

Let's now mount the filesystem in the i partition on /mnt/flashmem.

    # mount -t msdos /dev/sd0i /mnt/flashmem

Now you can start using it just like any other disk.

WARNING: You should always unmount the filesystem before unplugging the memory
device. If you don't, the filesystem may be left in an inconsistent state,
which may result in data corruption.

Upon detaching the memory device from your machine, you will again see the
kernel write messages about this to the console:

    umass0: at uhub1 port 1 (addr 2) disconnected
    sd0 detached
    scsibus2 detached
    umass0 detached

14.17.2 - Flash memory as bootable storage

One can also use flash memory in various forms as bootable disk with OpenBSD.
This can be done with both USB devices (assuming your computer can boot from a
USB flash device, not all can), or with a non-USB (i.e., CF) device with an
IDE or SATA adapter. (Non-USB devices attached with a USB adapter are treated
as USB devices.) In some cases, you may actually use a device in both ways
(load the media in a USB adapter, but run it in an IDE adapter).

A flash device attached to a USB port will show up as a sd(4) SCSI-like
device. When attached to an IDE adapter, it will show up as a wd(4) device.

In the case of flash media in an IDE adapter, it can be booted from any system
that could boot from an IDE hard disk on the same adapter. In every sense, the
system sees the flash media as an IDE disk. Simply configure the hardware
appropriately, then install OpenBSD to the flash disk as normal.

In the case of booting from a USB device, your system must be able to boot
from the USB device without being distracted by other devices on the system.
Note that if your intention is to make a portable boot environment on a USB
device, you really want to use DUIDs, rather than the traditional "/dev/sd0X"
notation. The USB device will show up as a SCSI disk, sometimes sd0. Without
DUIDs, if you plug this device into a system which already has a few SCSI-like
disks (i.e., devices attached to an ahci(4) interface) on it, it will probably
end up with a different identifier, which will complicate carrying the flash
device from system to system, as you would have to update /etc/fstab. Using
DUIDs completely resolves this issue.

Some notes:

  * Speed: In general, flash devices are much slower than hard disks,
    especially when it comes to writing. Using soft updates will help this
    considerably, as will using the "noatime" mount option.
  * "Write fatigue": Much has been written about the finite number of times an
    individual flash cell can be rewritten before failure. Practically
    speaking, however, there are many ways a flash device can fail, write
    fatigue is just one of them. Modern flash devices will verify writes, and
    in the event of failure, will automatically remap the failed sectors with
    one of the many spare sectors. Most users with most flash devices will not
    have to worry about "write fatigue". You would probably experience more
    down time due to failure of "clever" tricks done to avoid writing to the
    flash drive than you will by just using the drives as read-write media.
  * Reliability: The fact that flash media has no moving parts has prompted
    many people to assume the flash media is inherently more reliable than
    hard disks. It is not wise to assume that switching to flash means you
    don't need to worry about data loss or drive failure. People have reported
    considerable variation in flash media quality, it is probably best to
    consider flash storage as a silent and low-power alternative to disk
    rather than a failure-free storage media.
  * Creating a bootable USB flash drive: While a USB device can only be booted
    on a machine which can boot from USB drives, it can be created on any
    machine with supported USB hardware. You will, of course, be unable to
    test your work until you can get to a USB bootable system.
  * Going from IDE to USB interfaces: Since flash media can be readable and
    writable through USB, IDE and other adapters, you can create bootable
    media with one type of adapter but maintain or use it with another type of
    adapter.
  * Mixing OpenBSD and other partitions on one device: OpenBSD treats the
    flash disk as any other disk so one can use fdisk(8) to partition a flash
    device, as you would any hard disk. You can then have OpenBSD file systems
    on one partition, and use another partition for another file system, for
    example, FAT32. However, not all OSs treat USB devices as "equals".
    Windows, at least, will not attempt to use or create a partition that
    doesn't start at the beginning of the device, nor will the Windows
    partitioning tools allow you to partition the disk, though it will respect
    existing partitions. So, if you wish to create a USB flash drive that is
    bootable with OpenBSD, but also functions as a FAT32-capable device on
    other OSs, you would want to do something like this:
     1. Partition the media with OpenBSD's fdisk, creating a partition of the
        type you desire for Windows to use at the beginning of the disk, and
        an OpenBSD partition at the end of the disk.
     2. Install OpenBSD as normal to the OpenBSD fdisk partition, don't forget
        to flag the OpenBSD partition as "Active" for booting.
     3. Format the other partition. This can be (and perhaps should be) done
        on the "target" OS (Windows, in this case).
    Note that if the other partition's type is chosen appropriately, it is
    possible to have OpenBSD access both partitions on the device. So, a
    Windows user could populate the FAT32 partition with MP3 files which could
    be played when they booted from the OpenBSD partition.

14.17.3 - How do I create a bootable "Live" USB device?

It is very easy to create a bootable USB flash (or other!) drive that can be
used as a "live" OpenBSD system without installing OpenBSD on the local hard
disk of a machine. Obviously, the target machine must be bootable from a USB
device, but the initial load can actually be done from any machine with a USB
interface.

Some reasons you may want to do this:

  * A portable, secure "machine" you can carry with you in your pocket.
  * Fix problems in OpenBSD and other installs with tools that aren't
    available with bsd.rd.
  * Evaluate hardware for OpenBSD compatibility at the point of purchase.
  * Install machines that lack any other form of boot media.
  * Collect dmesg outputs from your friends' computers! (As OpenBSD's dmesg is
    useful for identifying hardware, this can be a good way to prep for the
    install of OTHER OSs on a machine -- make sure you have all the needed
    drivers before starting).

Creating such a "live OpenBSD drive" is simple.

  * Mount your USB drive to the machine you are installing from.
  * Boot your favorite OpenBSD install media.
  * Install as normal, being careful to select your flash drive as the install
    target.
  * Boot from your newly created USB device.

That's it!

There are some things you may want to do after the install to improve your
results:

  * Install all packages and utilities you are likely to wish to have
    available.
  * Different target machines will likely have different NICs. You could
    create a bunch of hostname.if(5) files in /etc, each containing just dhcp,
    for all the NICs you are likely to encounter (fxp0, re0, rl0, bge0, bnx0,
    em0, etc.) on USB-bootable machines, plus maybe sample wireless config
    files as well. OpenBSD will ignore all hostname.if(5) files for devices
    not present at boot time.
  * You may wish to have a copy of the install files and maybe any desired
    package .tgz files so you can use the drive as an install media (boot
    bsd.rd instead of letting it boot normally).
  * On many machines, X will "Just Work" with no config file, but you may wish
    to collect X config files for those systems that require them.
  * Soft updates will be something you will want to use.
  * For maximum flexibility, you probably want to use i386 rather than amd64.
    However, if you wish to use it as an install media, you could have an
    amd64 bsd.rd and install files in addition to i386.
  * Use DUIDs to identify your partitions (default).
  * You may find it desirable to have a FAT partition on the USB drive, create
    it as detailed above.
  * You may wish to use softraid(4) to encrypt a data partition.

14.18 - Optimizing disk performance

Disk performance is a significant factor in the overall speed of your
computer. It becomes increasingly important when your computer is hosting a
multi-user environment (users of all kinds, from those who log-in
interactively to those who see you as a file-server or a web-server). Data
storage constantly needs attention, especially when your partitions run out of
space or when your disks fail. OpenBSD has a few options to increase the speed
of your disk operations.

  * Soft Updates
  * Size of the namei() cache

14.18.1 - Soft updates

An important tool that can be used to speed up your system is soft updates.
One of the slowest operations in the traditional BSD file system is updating
metainfo (which happens, among other times, when you create or delete files
and directories). Soft updates attempts to update metainfo in RAM instead of
writing to the hard disk each and every single metainfo update. Another effect
of this is that the metainfo on disk should always be complete, although not
always up to date. You can read more about soft updates in the Soft updates
FAQ entry.

14.18.2 - Size of the namei() cache

The name-to-inode translation (a.k.a., namei()) cache controls the speed of
pathname to inode(5) translation. A reasonable way to derive a value for the
cache, should a large number of namei() cache misses be noticed with a tool
such as systat(1), is to examine the system's current computed value with
sysctl(8), (which calls this parameter "kern.maxvnodes") and to increase this
value until either the namei() cache hit rate improves or it is determined
that the system does not benefit substantially from an increase in the size of
the namei() cache. After the value has been determined, you can set it at
system startup time with sysctl.conf(5).

14.19 - Why aren't we using async mounts?

Question: "I simply do "mount -u -o async /" which makes one package I use
(which insists on touching a few hundred things from time to time) usable. Why
is async mounting frowned upon and not on by default (as it is in some other
unixen)? Isn't it a much simpler, and therefore, a safer way of improving
performance in some applications?"

Answer: "Async mounts are indeed faster than sync mounts, but they are also
less safe. What happens in case of a power failure? Or a hardware problem? The
quest for speed should not sacrifice the reliability and the stability of the
system. Check the man page for mount(8)."

             async   All I/O to the file system should be done asynchronously.
                     This is a dangerous flag to set since it does not guaran-
                     tee to keep a consistent file system structure on the
                     disk.  You should not use this flag unless you are pre-
                     pared to recreate the file system should your system
                     crash.  The most common use of this flag is to speed up
                     restore(8) where it can give a factor of two speed in-
                     crease.

On the other hand, when you are dealing with temp data that you can recreate
from scratch after a crash, you can gain speed by using a separate partition
for that data only, mounted async. Again, do this only if you don't mind the
loss of all the data in the partition when something goes wrong. For this
reason, mfs(8) partitions are mounted asynchronously, as they will get wiped
and recreated on a reboot anyway.

14.20 - Duplicating your root partition: altroot

OpenBSD provides an "altroot" facility in the daily scripts. If the
environment variable ROOTBACKUP=1 is set in either /etc/daily.local or root's
crontab(5), and a partition is specified in /etc/fstab as mounting to /altroot
with the mount options of "xx", every night the entire contents of the root
partition will be duplicated to the /altroot partition. Assuming we want to
back up our root partition to wd1a, we add the following to /etc/fstab

    /dev/wd1a /altroot ffs xx 0 0

and set the appropriate environment variable in /etc/daily.local:

    # echo ROOTBACKUP=1 >>/etc/daily.local

As the altroot process will capture your /etc directory, this will make sure
any configuration changes there are updated daily.

This is a "disk image" copy done with dd(8), not a file-by-file copy, so your
/altroot partition should be exactly the same size as your root partition or
larger. Also, excessively large root partitions should be avoided so the
process does not take too long.

For full redundancy, the rest of the partitions should be duplicated as well,
using softraid disk, dump(8)/restore(8), rsync, etc. It can be done manually,
or part of a regular schedule, such as the weekly.local, daily.local, or
monthly.local scripts.

Generally, you will want your "altroot" partition to be on a different disk
that has been configured to be fully bootable should the primary disk fail. It
is possible to have an "altroot" on the same disk as your boot drive, but the
benefit of this is limited.

Note that we did not specify the altroot device by DUID, but by device name.
We probably want to be pushing from the boot device to the secondary device,
which can end up changing if the drive order is changed. For this reason, you
may want to specify the root and altroot in /etc/fstab as a device name, not a
DUID.

14.21 - How do I use softraid(4)?

Softraid(4) works by emulating a scsibus(4) with sd(4) devices made by
combining a number of OpenBSD disklabel(8) partitions ("chunks") into a
virtual disk ("volume") with the desired RAID strategy ("discipline"), such as
RAID0, RAID1, RAID4, RAID5 or Crypto. (Note: only RAID0, RAID1 and Crypto are
fully supported at the moment.)

This virtual disk is treated as any other disk -- first partitioned with fdisk
(8) (on fdisk platforms) and then with disklabel(8), partitions have file
systems made, mounted, then used.

Some words on RAID in general:

  * Before implementing any RAID solution, understand what it will and will
    not do for you. It is not a replacement for a good backup strategy. It
    will not keep your system running through every hardware failure. It may
    not keep your system running through a simple disk failure. In the case of
    software RAID, it won't guarantee the ability to boot from the surviving
    drive if your computer could not otherwise do so.
  * Before going into production, you must understand how you use your RAID
    solution to recover from failures. The time to do this is BEFORE your
    system has had a failure event. Poorly implemented RAID will often cause
    more down time than it will prevent. This is even more true if it has
    caused you to become complacent on your backups or other disaster
    planning.
  * The bigger your RAIDed partitions are, the longer it will take to recover
    from an "event". In other words, this is an especially bad time to
    allocate all of your cheap 500G drives just because they are there.
    Remirroring 500G drives takes a much longer time than mirroring the 4G
    that you actually use. One advantage of software mirroring is one can
    control how much of those "huge" drives is actually used in a RAID set.
  * There is a reflex to try to RAID as much of your system as possible.
    Mirroring your boot partition in a software RAID system is difficult, and
    often pointless, as most PC hardware has difficulty booting from any drive
    other than its primary boot drive. Even hardware which CAN boot from other
    drives will often have difficulty determining when a drive has failed to
    avoid booting from it. OpenBSD's "altroot" system can actually be BETTER
    for some applications, as it provides a copy of old configuration
    information in case a change does not work quite as intended.
  * RAID provides redundancy only for the disk system. Many applications need
    more redundancy than just the disks, and for some applications, RAID can
    be just added complication, rather than a real benefit. An example of this
    is a CARP'd set of firewalls provide complete fail over redundancy. In
    this case, adding RAID (either via hardware or softraid) is just added
    complication.

14.21.1 - Doing the install

Softraid disk space can be created using free (or added!) chunks of disk space
after install, but that is just a special (and simple) case of adding softraid
during install.

The tools to assemble your softraid system are in the basic OpenBSD install
(for adding softraid devices after install), but they are also available on
the CD-ROM and bsd.rd installation kernels. They do not exist on the floppies
due to space issues; one simple work-around is to do a very minimal OpenBSD
install from floppy, then boot from bsd.rd on your installed system and
re-build as desired.

The installation process will be a little different than the standard OpenBSD
install, as you will want to drop to the shell and create your softraid(4)
drive before doing the install. Once the softraid(4) disk is created, you will
perform the install relatively normally, placing the partitions you wish to be
RAIDed on the newly configured drive.

You can pre-create just the RAID partitions and assemble them into a softraid
(4) volume and let the installer do the rest, but it is probably easier to
also manually create your root and swap partitions before invoking the
installer.

This does mean you will have to carefully set up the disk before invoking the
installer, making sure you manually do a few steps that the installer normally
takes you through.

The install kernel only has the /dev entries for one wd(4) device and one sd
(4) device on boot, so you will need to create more disk devices to set up
your softraid device. This process is normally done automatically by the
installer, but you haven't yet run the installer, and you will be adding a
disk that didn't exist at boot. For example, if we needed to support a second
and third wd(4) device and a second sd(4) device (remember, the softraid
devices will be sd(4) devices), you could do the following from the shell
prompt:

    # cd /dev
    # sh MAKEDEV wd1 wd2 sd1

You now have full support for sd0, sd1, wd0, wd1 and wd2.

You will need to properly fdisk(1) the physical drives (if appropriate for
your platform -- make sure you set up the second disk so it is bootable!) and
then use disklabel to set up the partitions.

The fdisk(8) steps below will put an MBR on the disk and an OpenBSD partition
on the disk. IF you wish to use the entire disk for OpenBSD (i.e., have
NOTHING else on the disk), you can do this with a simple one-liner for each
drive:

    # fdisk -iy wd0
    # fdisk -iy wd1

(Do be sure you understand what those lines do to any data that was on your
disk before using it blindly!) Otherwise, you will need to create an OpenBSD
partition within the new disks.

Create the partitions for softraid

When creating the softraid(4) partition, give it the type of "RAID" rather
than the normal "4.2BSD" or "swap". In this case, we will create our desired
partitions on wd0:

  * wd0a 500M /
  * wd0b 500M swap
  * wd0m 10G RAID

    # disklabel -E wd0
    Label editor (enter '?' for help at any prompt)
    > a a
    offset: [64] ENTER
    size: [30282461] 500m
    Rounding to cylinder (16065 sectors): 1028096
    FS type: [4.2BSD] ENTER
    > a b
    offset: [1028160]  ENTER
    size: [29254365] 500m
    Rounding to cylinder (16065 sectors): 1028160
    FS type: [swap] ENTER
    > a m
    offset: [3148740]  ENTER
    size: [28226205] 10g
    Rounding to cylinder (16065 sectors): 20980890
    FS type: [4.2BSD] RAID
    > q
    Write new label?: [y] ENTER

Now, we need to prep out the second disk to match key parts of the first
disk's layout. Since we are using the /altroot system, we will want an 'a'
partition on the secondary disk the same size as the primary's 'a'. We want
the system to run off the second drive as it would the first, so we will want
to have a similar sized swap partition (though a little bigger or smaller will
not hurt). We will also want a RAID partition the same size as the primary. If
the RAID partitions are not the same size, the smaller of the two will dictate
the final RAID volume size.

In short...you really want to just repeat the above allocation process on the
second drive, wd1.

Assembling the RAID volume

We will assume that your two RAID partitions are on wd0m and wd1m. Note that
the RAID partition letter is arbitrary, it does not need to be the same letter
on the secondary drive, but it will make keeping track of things that much
easier for you if you keep them the same.

Note that since softraid(4) has to look around a bit to find evidence of
arrays it needs to assemble, if your disk has been used for softraid
previously, you may find it very helpful to use dd(1) to clear the first
megabyte or so from each partition before going any further:

    # dd if=/dev/zero of=/dev/rwd0m bs=1m count=1
       ...
    # dd if=/dev/zero of=/dev/rwd1m bs=1m count=1
       ...

We now create our new softraid(4) disk using bioctl(8):

    # bioctl -c 1 -l /dev/wd0m,/dev/wd1m softraid0

This creates a RAID1 volume ("-c 1"), using the listed partitions ("-l /dev/
wd0m,/dev/wd1m"), using the softraid0 driver. If there are no other sd(4)
devices on this system, this will become sd0. Note that if you are creating
multiple RAID devices, either on one disk or on multiple devices, you are
always going to be using the softraid0 virtual disk interface driver, you
won't be using "softraid1" or others. Remember, the "softraid0" there is a
virtual RAID controller, you can hang many virtual disks off this controller.

This will create a new disk, "sd0" (assuming there are no other sd(4) devices
on your system). This device will now show on the system console and dmesg as
a newly installed device:

    scsibus1 at softraid0: 1 targets
    sd0 at scsibus2 targ 0 lun 0: <OPENBSD, SR RAID 1, 005> SCSI2 0/direct fixed
    sd0: 10244MB, 512 bytes/sec, 20980362 sec total

showing that we now have a new SCSI bus, and a new disk. This volume will be
automatically detected and assembled from this point onwards when the system
boots.

Because the new device probably has a lot of garbage where you expect a MBR
and disklabel, zeroing the first chunk of the new disk is highly recommended,
if you didn't zero the component parts above:

    # dd if=/dev/zero of=/dev/rsd0c bs=1m count=1

You are now ready to install OpenBSD on your system. Perform the install as
normal by invoking "install" at the boot media command prompt. Be careful to
select "custom" layout for disklabel when prompted, otherwise your RAID
partition will be overwritten! Use the 'n' option of disklabel to define the
mount point for your root partition, and create all the partitions on your new
softraid disk (sd0 in our example here) that should be there, rather than on
your non-RAID disks.

Now you can reboot your system, and if you have done all properly, it will
automatically assemble your RAID set, and mount the appropriate partitions.

14.21.3 - Softraid notes

Complications when other sd(4) disks exist

Softraid disks are assembled after all other IDE, SATA, SAS and SCSI disks are
attached. As a result, if the number of sd(4) devices changes (either by
adding or removing devices -- or if a device fails), the identifier of the
softraid disk will change. For this reason, it is very important to use DUIDs
(Disklabel Unique Identifiers) rather than drive names in your fstab(5) file.

You may not want to specify the root device by DUID.

Three disk RAID1?

Softraid supports RAID1 with more than two "chunks", and the man page examples
show a three disk RAID1 configuration. RAID1 simply duplicates the data across
all the chunks of storage, two gives full redundancy, three gives additional
fault tolerance. The advantage of RAID1 with three (or more!) disks or chunks
is that in event of one disk failure, you STILL have complete redundancy.
Think of it as a hot spare that doesn't need time to rebuild! In theory, a
three disk RAID1 is slower on writes than a two disk, though should be much
faster on writes than a rebuilding two disk RAID1.

14.21.4 - Disaster recovery

This is the section you want to skip over, but don't. This is the reason for
RAID -- if disks never failed, you wouldn't add the complexity of RAID to your
system! Unfortunately, as failures are very difficult to list comprehensively,
there is a strong probability that the event you experience won't be described
exactly here, but if you take the time to understand the strategies here, and
the WHY, hopefully you can use them to recover from whatever situations come
your way.

Keep in mind, failures are often not simple. The author of this article had a
drive in a hardware RAID solution develop a short across the power feed, which
in addition to the drive itself, also required replacing the power supply, the
RAID enclosure and a power supply on a second computer he used to verify the
drive was actually dead, and the data from backup as he didn't properly
configure the replacement enclosure.

The steps needed for system recovery can be performed in single user mode, or
from the install kernel (bsd.rd).

If you plan on practicing softraid recovery (and we HIGHLY suggest you do
so!), you may find it helpful to zero a drive you remove from the array before
you attempt to return it to the array. Not only does this more accurately
simulate replacing the drive with a new one, it will avoid the confusion that
can result when the system detects the remains of a softraid array.

Recovery from a failure will often be a two-stage event -- the first stage is
bringing the system back up to a running state, the second stage is to rebuild
the failed array. The two stages may be separated by some time if you don't
have a replacement drive handy.

Recovery from drive failure: secondary

This is relatively easy. You may have to remove the failed disk to get the
system back up.

When you are ready to repair the system, you will replace the failed drive,
create the RAID and other disklabel partitions, then rebuild the mirror.
Assuming your RAID volume is sd0, and you are replacing the failed device with
wd1m, the following process should work:

  * Boot the system back up.
  * Create appropriate partitions on your new drive
  * Rebuild your RAID partition:

        # bioctl -R /dev/wd1m sd0

  * reboot

Recovery from drive failure: primary

Many PC-like computers can not boot from a second drive if the primary drive
has failed, but still attached unless it is so dead it isn't detected. Many
can not boot from a drive that isn't the "primary", even if there is no other
drive.

In general, if your primary drive fails, you will have to remove it, and in
many cases "promote" your secondary drive to primary configuration before the
system will boot. This may involve re-jumpering the disk, plugging the disk
into another port or some other variation. Of course, what is on the secondary
disk has to not only include your RAID partition, but also has to be
functionally bootable.

Once you have the system back up on the secondary disk and a new disk in
place, you rebuild as above.

Recovery from "shuffling" your disks

What if you have four disks in your system, say, sd0, sd1, sd2, and sd3, and
for reasons of hardware replacement or upgrade, you end up with the drives out
of the machine, and lose track of which was which?

Fortunately, softraid handles this very well, it considers the disks
"roaming", but will successfully rebuild your arrays. However, the boot disk
in the machine has to be bootable, and if you just made changes in the root
partition before doing this, you probably want to be sure you didn't boot from
your altroot partition by mistake.

14.21.5 - Softraid Crypto

Cryptographic softraid(4) volumes are set up rather simply:

  * Create the desired partition with disklabel(8) as type RAID
  * Zero the head of the partition as above.
  * # bioctl -c C -l /dev/sd0m softraid0
    New passphrase: My Crypto Pass Phrase
    Re-type passphrase: My Crypto Pass Phrase
    softraid0: CRYPTO volume attached as sd1
  * Zero the first megabyte of the newly created volume so fdisk(8) or
    disklabel(8) doesn't get confused
    # dd if=/dev/zero of=/dev/rsd1c bs=1m count=1
  * fdisk(8), disklabel(8) and newfs(8) this new volume, sd1 as desired.

Once this is set up, you can then "unlock" the crypto volume when desired
with:

    # bioctl -c C -l /dev/sd0m softraid0
    Passphrase: My Crypto Pass Phrase
    softraid0: CRYPTO volume attached as sd1

You can then mount the encrypted volume's partitions using mount as usual.

To disconnect a crypto volume (rendering it unusable again), dismount any file
systems and use the following (where the encrypted volume is sd1):

    # bioctl -d sd1

The man page for this looks a little scary, as the -d command is described as
"deleting" the volume, but in the case of crypto, it just deactivates
encrypted volume so it can't be accessed until it is activated again with the
passphrase.

Many other options are available with softraid, and new features are being
added and improvements made, so do consult the man pages for bioctl(8) and
softraid(4) on your system.

I forgot my passphrase!

Sorry. This is real encryption, there's not a back door or magic unlocking
tool. If you lose your passphrase, your data on your softraid crypto volume
will be unusable.

------------------------------------------------------------------------------

==============================================================================

15 - The OpenBSD packages and ports system

------------------------------------------------------------------------------

Table of Contents

  * 15.1 - Introduction
  * 15.2 - Package management
      + 15.2.1 - How does it work?
      + 15.2.2 - Making things easy
      + 15.2.3 - Finding packages
      + 15.2.4 - Installing new packages
      + 15.2.5 - Listing installed packages
      + 15.2.6 - Updating installed packages
      + 15.2.7 - Removing installed packages
      + 15.2.8 - Incomplete package installation or removal
  * 15.3 - Working with ports
      + 15.3.1 - How does it work?
      + 15.3.2 - Fetching the ports tree
      + 15.3.3 - Configuration of the ports system
      + 15.3.4 - Searching the ports tree
      + 15.3.5 - Straightforward installation: a simple example
      + 15.3.6 - Cleaning up after a build
      + 15.3.7 - Uninstalling a port's package
      + 15.3.8 - Using flavors and subpackages
      + 15.3.9 - Using dpb to build multiple ports
      + 15.3.10 - Security updates (-stable)
      + 15.3.11 - Package signatures
  * 15.4 - FAQ
      + 15.4.1 - I'm getting all kinds of crazy errors. I just can't seem to
        get this ports stuff working at all.
      + 15.4.2 - The latest version of my Top-Favorite-Software is not
        available!
      + 15.4.3 - Why is there no package for my Top-Favorite-Software?
      + 15.4.4 - Why is there no port of my Top-Favorite-Software?
      + 15.4.5 - Why is my Top-Favorite-Software not part of the base system?
      + 15.4.6 - What should I use: packages or ports?
      + 15.4.7 - How do I tweak these ports to have maximum performance?
      + 15.4.8 - I submitted a new port/an update weeks ago. Why isn't it
        committed?
  * 15.5 - Reporting problems
  * 15.6 - Helping us

------------------------------------------------------------------------------

15.1 - Introduction

There are a lot of third party applications available which one might want to
use on an OpenBSD system. To make this software easier to install and manage,
plus to help it comply with OpenBSD's policy and goals, the third party
software is ported to OpenBSD. This porting effort can involve many different
things. Examples are: making the software use the standard OpenBSD directory
layout (e.g. configuration files go into /etc), conforming to OpenBSD's shared
library specifications, making the software more secure whenever possible,
etc.

The end result of the porting effort are ready-to-install binary packages. The
aim of the package system is to keep track of which software gets installed,
so that it may at any time be updated or removed very easily. This way, no
unnecessary files are left behind, and users can keep their systems clean. The
package system also helps ensure nothing is deleted by accident, causing
software to stop functioning properly. Another advantage is that users rarely
need to compile software from source, as packages have already been compiled
and are available and ready to be used on an OpenBSD system. In minutes, a
large number of packages can be fetched and installed, with everything in the
right place.

The packages and ports collection does NOT go through the same thorough
security audit that is performed on the OpenBSD base system. Although we
strive to keep the quality of the packages collection high, we just do not
have enough human resources to ensure the same level of robustness and
security. Of course security updates for various applications are committed to
the ports tree as soon as possible, and corresponding package security updates
are made available as snapshots for -current.

15.2 - Package Management

15.2.1 - How does it work?

Packages are the pre-compiled binaries of some of the most used third party
software. Packages can be managed easily with the help of several utilities,
also referred to as the pkg* tools:

  * pkg_add(1) - a utility for installing and upgrading software packages.
  * pkg_delete(1) - a utility for deleting previously installed software
    packages.
  * pkg_info(1) - a utility for displaying information about software
    packages.
  * pkg_create(1) - a utility for creating software packages.

In order to run properly, application X may require that other applications Y
and Z be installed. Application X is said to be dependent on these other
applications, which is why Y and Z are called dependencies of X. In turn, Y
may require other applications P and Q, and Z may require application R to
function properly. This way, a whole dependency tree is formed.

Packages look like simple .tgz bundles. Basically they are just that, but
there is one crucial difference: they contain some extra packing information.
This information is used by pkg_add(1) for several purposes:

  * Different checks: has the package already been installed, or does it
    conflict with other installed packages or file names?
  * Dependencies which are not yet present on the system are automatically
    fetched and installed before proceeding with the installation of the
    package.
  * Information about the package(s) is recorded in a central repository, by
    default located in /var/db/pkg/. This will, among other things, prevent
    the dependencies of a package from being deleted before the package itself
    has been deleted. This helps ensure that an application cannot be
    accidentally broken by a careless user.

15.2.2 - Making things easy: PKG_PATH

You can make things really easy by using the PKG_PATH environment variable.
Just point it to your favorite location, and pkg_add(1) will automatically
look there for any package you specify, and also fetch and install the
necessary dependencies of this package automatically.

A list of possible locations to fetch packages from is given in the following
section.

Example 1: fetching from your CD-ROM, assuming you mounted it on /mnt/cdrom

    $ export PKG_PATH=/mnt/cdrom/5.8/packages/`machine -a`/

Example 2: fetching from a nearby mirror

    $ export PKG_PATH=http://your.local.mirror/pub/OpenBSD/5.8/packages/`machine -a`/

It's usually a good idea to add a line similar to the above examples to your ~
/.profile. As with the classic PATH variable, you can specify multiple
locations, separated by colons. That way, pkg_add(1) can split the path
correctly even if it holds URL schemes containing colons. If the first entry
in PKG_PATH fails, the next one will be tried, and so on, until the package is
found. If all entries fail, an error is produced.

Notice the use of machine(1) in the above command lines. This automatically
substitutes your installed OpenBSD "application architecture", which is
usually, but not always, your platform name. Of course, if you are using
snapshots, you will replace "5.8" with "snapshots".

15.2.3 - Finding packages

A large collection of pre-compiled packages is available for the most common
architectures. Just look for your package in one of these places:

  * On one of the three CD-ROMs, depending on your architecture. The CD-ROMs
    carry only the most commonly used, freely distributable packages for the
    most commonly used platforms.
  * On the mirror servers. Packages are located in the /pub/OpenBSD/5.8/
    packages directory. From there, packages are broken down depending on
    architecture.

If you have the ports tree on your system, you can quickly find the package
you are looking for as explained in Searching the ports tree.

If you're looking for a specific filename, install the pkglocatedb package,
then use the pkg_locate command to find which package(s) contain that file.

You will notice that certain packages are available in a few different
varieties, formally called flavors. Others are pieces of the same application
which may be installed separately. They are called subpackages. This will be
detailed further in Using flavors and subpackages, but flavor basically means
they are configured with different sets of options. Currently, many packages
have flavors, for example: database support, support for systems without X, or
network additions like SSL and IPv6. Every flavor of a package will have a
different suffix in its package name. For detailed information about package
names, please refer to packages-specs(7).

Note: Not all possible packages are necessarily available on the mirror
servers! Some applications simply don't work on all architectures. Some
applications can not be distributed via mirrors (or CD-ROM) for licensing
reasons. There may also be many possible combinations of flavors of a port,
and the OpenBSD project just does not have the resources to build them all. If
you need a combination which is not available, you will have to build the port
from source. For more information on how to do that, read Using flavors and
subpackages in the Ports section of this document.

15.2.4 - Installing new packages

To install packages, the utility pkg_add(1) is used. If you have made things
easy for yourself by setting the PKG_PATH environment variable, you can just
call pkg_add(1) with the package name, as in the following basic example.

    # pkg_add -v screen-4.0.3p3
    parsing screen-4.0.3p3
    installed /etc/screenrc from /usr/local/share/examples/screen/screenrc | 71%
    screen-4.0.3p3: complete

In this example the -v flag was used to give a more verbose output. This
option is not needed but it is helpful for debugging and was used here to give
a little more insight into what pkg_add(1) is actually doing. Notice the
message mentioning /etc/screenrc. Specifying multiple -v flags will produce
even more verbose output.

pkg_add(1) will ask you questions when it cannot decide which version of a
package you might want to install. For example, if you don't know the version
number of a package beforehand, you can try something like:

    # pkg_add -i screen
    Ambiguous: screen could be screen-4.0.3p3 screen-4.0.3p3-shm
    Choose one package
             0: <None>
             1: screen-4.0.3p3
             2: screen-4.0.3p3-shm
    Your choice: 1
    screen-4.0.3p3: complete

For some packages, some important additional information will be given about
the configuration or use of the application on an OpenBSD system. Since it is
important, it will be displayed whether or not you use the -v flag. Consider
the following example:

    # pkg_add ghostscript-fonts-8.11
    ghostscript-fonts-8.11: complete
    You may wish to update your font path for /usr/local/share/ghostscript/fonts
    --- ghostscript-fonts-8.11 -------------------
    To install these fonts for X11, just make sure that the fontpath
    lists the 75dpi or 100dpi bitmap fonts before the ghostscript fonts,
    and make sure you have the string ":unscaled" appended to the bitmap
    font's fontpath. This way, the bitmap fonts will be used if they
    match, and the Type 1 versions will be used if the font needs to be
    scaled. Below is the relevant section from a typical xorg.conf file.

       FontPath   "/usr/X11R6/lib/X11/fonts/misc/"
       FontPath   "/usr/X11R6/lib/X11/fonts/75dpi/:unscaled"
       FontPath   "/usr/X11R6/lib/X11/fonts/100dpi/:unscaled"
       FontPath   "/usr/local/lib/X11/fonts/ghostscript/"
       FontPath   "/usr/X11R6/lib/X11/fonts/Type1/"

Additionally, some packages provide configuration and other information in a
file located in /usr/local/share/doc/pkg-readmes.

Let us now continue with an example of a package which has dependencies:

    # pkg_add -v tin-1.8.2p0
    parsing tin-1.8.2p0
    Dependencies for tin-1.6.2 resolve to: gettext-0.14.6, libutf8-0.8, pcre-6.4p1,
    libiconv-1.9.2p3 (todo: libiconv-1.9.2p3,gettext-0.14.6,pcre-6.4p1,libutf8-0.8)
    tin-1.8.2p0:parsing libiconv-1.9.2p3
    tin-1.8.2p0:libiconv-1.9.2p3: complete
    tin-1.8.2p0:parsing gettext-0.14.6
    Dependencies for gettext-0.14.6 resolve to: expat-2.0.0, libiconv-1.9.2p3 (todo:
    expat-2.0.0)
    tin-1.8.2p0:parsing expat-2.0.0
    tin-1.8.2p0:expat-2.0.0: complete
    tin-1.8.2p0:gettext-0.14.6: complete
    tin-1.8.2p0:parsing pcre-6.4p1
    tin-1.8.2p0:pcre-6.4p1: complete
    tin-1.8.2p0:parsing libutf8-0.8
    tin-1.8.2p0:libutf8-0.8: complete
    tin-1.8.2p0: complete

Again we added the -v flag to see more of what is happening. Upon
investigating the packing information, dependencies are found and they are
installed first. Somewhere in the middle you can see the gettext package being
installed, which depends on libiconv. Before installing gettext, its packing
information is examined and it is verified whether libiconv has already been
installed.

It is possible to specify multiple package names on one line, which then all
get installed at once, along with possible dependencies.

If for some reason you decide not to use PKG_PATH, it is also possible to
specify the absolute location of a package on the command line. This absolute
location may be a local path, or a URL referring to HTTP, or SCP locations.
Let's consider installation via HTTP in the next example:

    # pkg_add http://your.favorite.mirror/pub/OpenBSD/5.8/packages/`machine -a`/screen-4.0.3p3.tgz
    screen-4.0.3p3: complete

In this example the -v flag wasn't used, so only needed messages are shown.
Notice that the complete filename was entered by adding a .tgz suffix. You can
also skip this suffix as in the previous examples since it is auto-completed
by pkg_add(1).

Note: Not all architectures have the same packages available. Some ports do
not work on certain architectures, and performance limits the number of
packages that can be built on others.

For safety, if you are installing a package which you had installed earlier
(or an older version of it) and removed, pkg_add(1) will not overwrite
configuration files which have been modified. Instead, it will inform you
about this as follows (only when using the -v flag, however!):

    # pkg_add -v screen-4.0.3p3
    parsing screen-4.0.3p3
    The existing file /etc/screenrc has NOT been changed
    It does NOT match the sample file /usr/local/share/examples/screen/screenrc
    You may wish to update it manually
    screen-4.0.3p3: complete

Sometimes you may encounter an error like the one in the following example:

    # pkg_add xv-3.10ap4
    xv-3.10ap4:jpeg-6bp3: complete
    xv-3.10ap4:png-1.2.14p0: complete
    xv-3.10ap4:tiff-3.8.2p0: complete
    Can't install xv-3.10ap4: lib not found X11.9.0
    Even by looking in the dependency tree:
            tiff-3.8.2p0, jpeg-6bp3, png-1.2.14p0
    Maybe it's in a dependent package, but not tagged with @@lib ?
    (check with pkg_info -K -L)
    If you are still running 3.6 packages, update them.

There is pkg_add(1) nicely installing dependencies, when all of a sudden it
aborts the installation of xv. This is another safety precaution. The packing
information bundled in the package includes information about shared libraries
that the package expects to be installed, system libraries as well as third
party libraries. If one of the required libraries cannot be found, the package
is not installed because it would not function anyway.

To solve this type of conflict, you must find out what to install in order to
get the required libraries on your system. There are several things to check:

  * You may have older packages installed: an older version of the required
    library is present. In this case, upgrade these packages.
  * Your system may be incomplete: you did not install one of the file sets,
    which contains the required library. Just add the required file set.
  * Your system may be out of date: you have an older version of the required
    library. Boot the installer (as detailed in FAQ 4), and choose to (U)
    pgrade your complete system.

15.2.5 - Listing installed packages

You can see a list of installed packages by using the pkg_info(1) utility.

    $ pkg_info
    aterm-0.4.2p1       color vt102 terminal emulator with transparency support
    bzip2-1.0.4         block-sorting file compressor, unencumbered
    expat-2.0.0         XML 1.0 parser written in C
    fluxbox-0.9.15.1p0  window manager based on the original Blackbox code
    gettext-0.14.6      GNU gettext
    imlib2-1.3.0        image manipulation library
    jpeg-6bp3           IJG's JPEG compression utilities
    libiconv-1.9.2p3    character set conversion library
    libltdl-1.5.22p1    GNU libtool system independent dlopen wrapper
    libungif-4.1.4p0    tools and library routines for working with GIF images
    libutf8-0.8         provides UTF-8 locale support
    mutt-1.4.2.2i       tty-based e-mail client
    pcre-6.4p1          perl-compatible regular expression library
    png-1.2.14p0        library for manipulating PNG images
    screen-4.0.3p3      multi-screen window manager
    tcsh-6.14.00p1      extended C-shell with many useful features
    tiff-3.8.2p0        tools and library routines for working with TIFF images
    tin-1.8.2p0         threaded NNTP and spool based UseNet newsreader

When given an installed package name (or a location of a package which is to
be installed), pkg_info(1) will show more detailed information about that
specific package.

15.2.6 - Updating installed packages

Let's say you had an older version of unzip installed before upgrading this
box from OpenBSD 5.7 to 5.8. Now you can easily upgrade to the newer 5.8
package as follows:

    # pkg_add -u unzip
    unzip-5.52p0 (extracting): complete
    unzip-5.52 (deleting): complete
    unzip-5.52p0 (installing): complete
    Clean shared items: complete

When a package has dependencies, they are also examined for updates. Invoking
pkg_add(1) with the -u flag and no package name will try to update all
installed packages.

Note: The -u switch relies on the PKG_PATH environment variable. If it is not
set, pkg_add(1) will not be able to find updates.

Having several entries in PKG_PATH does not mean all entries will be tried for
update operations. Instead, pkg_add(1) will stop at the first path with
matching candidates.

If you had a configuration file belonging to the old version, which you
modified, it will be left untouched by default. You can, however, replace it
with the default configuration file of the new version, by calling pkg_add(1)
with the -c flag.

15.2.7 - Removing installed packages

To delete a package, simply take the proper name of the package as shown by
pkg_info(1) (see Listing installed packages above) and use pkg_delete(1) to
remove the package. In the example below, the screen package is being removed.
Notice that on some occasions there are instructions of extra items that need
to be removed that pkg_delete(1) did not remove for you. As with the pkg_add
(1) utility, you can use the -v flag to get more verbose output.

    # pkg_delete screen
    screen-4.0.3p3: complete
    Clean shared items: complete

Note: Often, it is not necessary to specify the version numbers and flavors
with the package name, since pkg_delete(1) will usually be able to find the
full name by itself. You need to specify the complete package name (in the
example, that is screen-4.0.3p3) only if ambiguity is possible due to multiple
installed packages with the specified name. In that case pkg_delete(1) cannot
know which package to delete.

For safety, pkg_delete(1) will not remove configuration files if they have
been modified. Instead it will inform you about this as follows:

    # pkg_delete screen
    screen-4.0.3p3: complete
    Clean shared items: complete
    --- screen-4.0.3p3 -------------------
    You should also remove /etc/screenrc (which was modified)

If you prefer to have those configuration files removed automatically, you can
do so by using the -c flag.

15.2.8 - Incomplete package installation or removal

In some odd cases, you may find that a package was not added or deleted
completely, because of conflicts with other files. The incomplete installation
is usually marked with "partial-" prepended to the package name. This can, for
instance, happen when you coincidentally press CTRL+C during installation:

    # pkg_add screen-4.0.3p3
    screen-4.0.3p3: complete
    Adjusting md5 for /usr/local/info/screen.info-3 from 49fb3fe1cc3a3b0057518459811b6dac to 3b9c7811244fb9f8d83bb27d3a0f60d8
    /usr/sbin/pkg_add: Installation of screen-4.0.3p3 failed, partial installation recorded as partial-screen-4.0.3p3

It is always a good idea to remove partial packages from your system, and to
fix potential problems that lead to this failure. It is often an indication
that you do not have a clean system with everything installed from packages,
but possibly packages mixed up with other software installed straight from
source.

15.3 - Working with ports

As mentioned in the introduction, packages are compiled from the ports tree.
In this section we will explain how the ports tree works, when you should use
it and how you can use it.

IMPORTANT NOTE: The ports tree is meant for advanced users. Everyone is
encouraged to use the pre-compiled binary packages. Do NOT ask beginner
questions on the mailing lists like "How can I get the ports tree working?".
If you have questions about the ports tree, it is assumed that you have read
the manual pages and this FAQ, and that you are able to work with it.

15.3.1 - How does it work?

The ports tree, a concept originally borrowed from FreeBSD, is a set of
Makefiles, one for each third party application, for controlling

  * where and how to fetch the source of the software,
  * which other software it depends upon,
  * how to alter the sources (if necessary),
  * how to configure and build it,
  * how to test it (optional),
  * how to install it.

Apart from the Makefile, each port also contains at least the following:

  * a PLIST, or packing list, which contains instructions for package creation
    once the application has been built,
  * a DESCR, or description of the application,
  * a distfile, containing distribution file checksums and size.

All this information is kept in a directory hierarchy under /usr/ports. This
hierarchy contains three special subdirectories:

  * distfiles/ - where the ports system stores software distribution sets
    after downloading.
  * infrastructure/ - the main directory of the ports infrastructure,
    containing all necessary scripts and makefiles.
  * packages/ - contains all binary packages built by the ports system.

The other subdirectories all form different application categories, which
contain the subdirectories of the actual ports. Complex ports may be organized
to an even deeper level, for example if they have a core part and a set of
extensions, or a stable and a snapshot version of the application. Every port
directory must contain a pkg/ subdirectory containing packing list(s) and
description file(s). There may also be patches/ and files/ subdirectories, for
source patches and additional files, respectively.

When a user issues make(1) in the subdirectory of a specific port, the system
will recursively walk its dependency tree, check whether the required
dependencies are installed, build and install any missing dependencies, and
then continue the build of the desired port. All of the building happens
inside the working directory that the port creates. Normally it is under $
{WRKOBJDIR}, defaulting to /usr/ports/pobj, but you may override this (see
Configuration of the ports system). If WRKOBJDIR has been explicitly unset, a
subdirectory of the port's main directory (package name prefixed by "w-") will
be used instead.

Note: Ports are never directly installed on your system! They use a fake
installation directory. Everything that gets installed there, is bundled
together into a package (which is stored in the packages/ subdirectory of the
ports tree as mentioned earlier). Installing a port really means: creating a
package, and then installing that package!

More information about the ports system may be found in these manual pages:

  * ports(7) - describes the different stages (make targets) of port
    installation, the use of flavors and subpackages and some other options.
  * bsd.port.mk(5) - in depth information about all the make targets,
    variables, the fake (installation directory) framework, etc.

15.3.2 - Fetching the ports tree

Before continuing, you must read the section about NOT mixing up your OpenBSD
system and ports tree. Once you have decided which flavor of the ports tree
you want, you can get the ports tree from different sources. The table below
gives an overview of where you can find the different flavors, and in which
form. An 'x' marks availability and '-' means it is not available through that
specific source.

+-------------------------------------------------------------+
|Source      |    Form    |              Flavor               |
|-------------------------+-----------------------------------|
|                         |-release|-stable|snapshots|-current|
|-------------------------+--------+-------+---------+--------|
|CD-ROM      |  .tar.gz   |   x    |   -   |    -    |   -    |
|------------+------------+--------+-------+---------+--------|
|HTTP mirrors|  .tar.gz   |   x    |   -   |    x    |   -    |
|------------+------------+--------+-------+---------+--------|
|AnonCVS     |cvs checkout|   x    |   x   |    -    |   x    |
+-------------------------------------------------------------+

On the CD-ROM and HTTP mirrors, look for a file named ports.tar.gz. You want
to untar this file in the /usr directory, which will create /usr/ports, and
all the directories under it. For example:

    # cd /tmp
    # ftp http://ftp.openbsd.org/pub/OpenBSD/5.8/ports.tar.gz
    # ftp http://ftp.openbsd.org/pub/OpenBSD/5.8/SHA256.sig
    # signify -Cp /etc/signify/openbsd-58-base.pub -x SHA256.sig ports.tar.gz
    # cd /usr
    # tar xzf /tmp/ports.tar.gz

The snapshots available on the mirrors are generated daily from the -current
ports tree. You will find the snapshots in the pub/OpenBSD/snapshots/
directory. If you are using a snapshot of the ports tree, you should have
installed a matching snapshot of OpenBSD. Make sure you keep your ports tree
and your OpenBSD system in sync!

For more information about obtaining the ports tree via AnonCVS, please read
the AnonCVS page which contains a list of available servers and a number of
examples.

15.3.3 - Configuration of the ports system

NOTE: This section introduces some additional global settings for building
applications from ports. You can skip this section, but then you will be
required to perform many of the make(1) statements in the examples as root.

Because the OpenBSD project does not have the resources to fully review the
source code of all software in the ports tree, you can configure the ports
system to take a few safety precautions. The ports infrastructure is able to
perform all building as a regular user, and perform only those steps that
require superuser privileges as root. Examples are the fake and install make
targets. However, because root privileges are always required at some point,
the ports system will not save you when you decide to build a malicious
application.

  * You can set up doas(1) and have the ports system use it for tasks
    requiring superuser permissions. This requires granting three permissions:
      + The user who is going to build ports needs permission to run arbitrary
        commands as the superuser.
      + The user who is going to build ports needs permission to pass certain
        environment variables used by the ports system from the shell calling
        doas to the privileged shell, see the env_keep variable in doas.conf
        (5).
      + The ports system needs permission to invoke doas(1) This can be
        granted by setting the SUDO variable defined in bsd.port.mk(5) in the
        environment, which can be made permanent by adding the following line
        to to mk.conf(5):

              SUDO=/usr/bin/doas


  * You can modify the ownerships of the ports tree so that you can write
    there as a regular user. In this case, the regular user has been added to
    the wsrc group, and the underlying directories are made group writable.

        # chgrp -R wsrc /usr/ports
        # find /usr/ports -type d -exec chmod g+w {} \;

  * You can have the ports system use systrace(1) by adding the following to /
    etc/mk.conf

        USE_SYSTRACE=Yes

    This enforces the build procedure to stay inside allowed directories, and
    prohibits writing in illegal places, thereby considerably reducing the
    risk of a damaged system. Note that the use of systrace(1) adds about 20%
    overhead in build time.

It is possible to use a read-only ports tree by separating directories that
are written to during port building:

  * The working directory of ports. This is controlled by the WRKOBJDIR
    variable, which specifies the directory which will contain the working
    directories.
  * The directory containing distribution files. This is controlled by the
    DISTDIR variable.
  * The directory containing newly built binary packages. This is controlled
    by the PACKAGE_REPOSITORY variable.

For example, you could add the following lines to /etc/mk.conf

    WRKOBJDIR=/usr/obj/ports
    DISTDIR=/usr/distfiles
    PACKAGE_REPOSITORY=/usr/packages

If desired, you can also change the ownership of these directories to your
local username and group, so that the ports system can create underlying
working directories as a regular user.

15.3.4 - Searching the ports tree

Once you have the ports tree in place on your system, it becomes very easy to
search for software. Just use make search key="searchkey", as shown in the
following example.

    $ cd /usr/ports
    $ make search key=rsnapshot
    Port:   rsnapshot-1.3.1p0
    Path:   net/rsnapshot
    Info:   remote filesystem snapshot utility
    Maint:  Antoine Jacoutot <ajacoutot@@openbsd.org>
    Index:  net sysutils
    L-deps:
    B-deps: :net/rsync
    R-deps: :devel/p5-Lchown :net/rsync
    Archs:  any

The search result gives a nice overview of each application that is found: the
port name, the path to the port, a one-line description, the port's
maintainer, keywords related to the port, library/build/runtime dependencies,
and architectures on which the port is known to work.

This mechanism, however, is a very basic one, which just runs awk(1) on the
ports index file. Since OpenBSD 4.0, a new port called "sqlports" has been
created, allowing very fine-grained searching using SQL. It is a SQLite
database, but basically just about any database format can be created using
the ports infrastructure. The sqlports port includes the script used to
generate the database, which could be used as a basis to generate databases in
different formats.

Just pkg_add(1) the sqlports package to get started. A sample session could
look like:

    $ sqlite3 /usr/local/share/sqlports
    SQLite version 3.3.12
    Enter ".help" for instructions
    sqlite> SELECT FULLPKGNAME,COMMENT FROM Ports WHERE COMMENT LIKE '%statistics%';
    Guppi-0.40.3p1|GNOME-based plot program with statistics capabilities
    mailgraph-1.12|a RRDtool frontend for Postfix statistics
    R-2.4.1|clone of S, a powerful math/statistics/graphics language
    py-probstat-0.912p0|probability and statistics utilities for Python
    darkstat-3.0.540p1|network statistics gatherer with graphs
    pfstat-2.2p0|packet filter statistics visualization
    tcpstat-1.4|report network interface statistics
    wmwave-0.4p2|Window Maker dockapp to display wavelan statistics
    diffstat-1.43p0|accumulates and displays statistics from a diff file
    sqlite>

The above is still a very basic search. With SQL, just about anything can be
searched for, including dependencies, configure flags, shared libraries, etc.

15.3.5 - Straightforward installation: a simple example

For clarity's sake, let's consider a simple example: rsnapshot. This
application has one dependency: rsync.

    $ cd /usr/ports/net/rsnapshot
    $ make install
    ===>  Checking files for rsnapshot-1.2.9
    >> rsnapshot-1.2.9.tar.gz doesn't seem to exist on this system.
    >> Fetch http://www.rsnapshot.org/downloads/rsnapshot-1.2.9.tar.gz.
    100% |**************************************************|   173 KB    00:02
    >> Size matches for /usr/ports/distfiles/rsnapshot-1.2.9.tar.gz
    >> Checksum OK for rsnapshot-1.2.9.tar.gz. (sha1)
    ===>  rsnapshot-1.2.9 depends on: rsync-2.6.9 - not found
    ===>  Verifying install for rsync-2.6.9 in net/rsync
    ===>  Checking files for rsync-2.6.9
    >> rsync-2.6.9.tar.gz doesn't seem to exist on this system.
    >> Fetch ftp://ftp.samba.org/pub/rsync/old-versions/rsync-2.6.9.tar.gz.
    100% |**************************************************|   792 KB    00:31
    >> Size matches for /usr/ports/distfiles/rsync-2.6.9.tar.gz
    >> Checksum OK for rsync-2.6.9.tar.gz. (sha1)
    ===>  Verifying specs:  c
    ===>  found c.40.3
    ===>  Extracting for rsync-2.6.9
    ===>  Patching for rsync-2.6.9
    ===>  Configuring for rsync-2.6.9
      [...snip...]
    ===>  Building for rsync-2.6.9
      [...snip...]
    ===>  Faking installation for rsync-2.6.9
      [...snip...]
    ===>  Building package for rsync-2.6.9
    Link to /usr/ports/packages/i386/ftp/rsync-2.6.9.tgz
    Link to /usr/ports/packages/i386/cdrom/rsync-2.6.9.tgz
    ===>  Installing rsync-2.6.9 from /usr/ports/packages/i386/all/rsync-2.6.9.tgz
    rsync-2.6.9: complete
    ===> Returning to build of rsnapshot-1.2.9
    ===>  rsnapshot-1.2.9 depends on: rsync-2.6.9 - found
    ===>  Extracting for rsnapshot-1.2.9
    ===>  Patching for rsnapshot-1.2.9
    ===>  Configuring for rsnapshot-1.2.9
      [...snip...]
    ===>  Building for rsnapshot-1.2.9
      [...snip...]
    ===>  Faking installation for rsnapshot-1.2.9
      [...snip...]
    ===>  Building package for rsnapshot-1.2.9
    Link to /usr/ports/packages/i386/ftp/rsnapshot-1.2.9.tgz
    Link to /usr/ports/packages/i386/cdrom/rsnapshot-1.2.9.tgz
    ===>  rsnapshot-1.2.9 depends on: rsync-2.6.9 - found
    ===>  Installing rsnapshot-1.2.9 from /usr/ports/packages/i386/all/rsnapshot-1.2.9.tgz
    rsnapshot-1.2.9: complete

As you can see, the ports system is doing many things automatically. It will
fetch, extract, and patch the source code, configure and build (compile) the
source, install the files into a fake directory, create a package
(corresponding to the packing list) and install this package onto your system
(usually under /usr/local/). And it does this recursively for all dependencies
of the port. Just notice the "===> Verifying install for ..." and "===>
Returning to build of ..." lines in the above output, indicating the walk
through the dependency tree.

If a previous version of the application you want to install was already
installed on your system, you can use make update instead of make install.
This will call pkg_add(1) with the -r flag.

Note: Large applications will require a lot of system resources to build. Good
examples are compilers like GCC and the Java Software Development Kit. If you
get "out of memory" type of errors when building such a port, this usually has
one of two causes:

  * Your resource limits are too restrictive. Adjust them with ksh's ulimit or
    csh's limit command. If that doesn't help, just become root before
    starting the build.
  * You simply don't have enough RAM in your machine.

15.3.6 - Cleaning up after a build

You probably want to clean the port's default working directory after you have
built the package and installed it.

    $ make clean
    ===>  Cleaning for rsnapshot-1.2.9

In addition, you can also clean the working directories of all dependencies of
the port with this make target:

    $ make clean=depends
    ===>  Cleaning for rsync-2.6.9
    ===>  Cleaning for rsnapshot-1.2.9

If you wish to remove the source distribution set(s) of the port, you would
use

    $ make clean=dist
    ===>  Cleaning for rsnapshot-1.2.9
    ===>  Dist cleaning for rsnapshot-1.2.9

In case you have been compiling multiple flavors of the same port, you can
clear the working directories of all these flavors at once using

    $ make clean=flavors

You can also clean things up as they get built, by setting a special variable.
Work directories will automatically be cleaned after packages have been
created:

    $ make package BULK=Yes

15.3.7 - Uninstalling a port's package

It is very easy to uninstall a port:

    $ make uninstall
    ===> Deinstalling for rsnapshot-1.2.9
    rsnapshot-1.2.9: complete
    Clean shared items: complete

This will call pkg_delete(1) to have the corresponding package removed from
your system. If desired, you can also uninstall and re-install a port's
package by using

    $ make reinstall
    ===>  Cleaning for rsnapshot-1.2.9
    /usr/sbin/pkg_delete rsnapshot-1.2.9
    rsnapshot-1.2.9: complete
    Clean shared items: complete
    ===>  Installing rsnapshot-1.2.9 from /usr/ports/packages/i386/all/rsnapshot-1.2.9.tgz
    rsnapshot-1.2.9: complete

If you would like to get rid of the packages you just built, you can do so as
follows:

    $ make clean=packages
    ===>  Cleaning for rsnapshot-1.2.9
    rm -f /usr/ports/packages/i386/all/rsnapshot-1.2.9.tgz

15.3.8 - Using flavors and subpackages

Please do read the ports(7) manual page, which gives a good overview of this
topic. There are two mechanisms to control the packaging of software according
to different needs.

The first mechanism is called flavors. A flavor usually indicates a certain
set of compilation options. For instance, some applications have a "no_x11"
flavor which can be used on systems without X. Some shells have a "static"
flavor, which will build a statically linked version. There are ports which
have different flavors for building them with different graphical toolkits.
Other examples include: support for different database formats, different
networking options (SSL, IPv6, ...), different paper sizes, etc.

Summary: Most likely you will use flavors when a package has not been made
available for the flavor you are looking for. In this case you will specify
the desired flavor and build the port yourself.

Most port flavors have their own working directory during building and every
flavor will be packaged into a correspondingly named package to avoid any
confusion. To see the different flavors of a certain port, you would change to
its subdirectory and issue

    $ make show=FLAVORS

You should also look at the port's DESCR files, as they're supposed to explain
the available flavors.

The second mechanism is called subpackages. A porter may decide to create
subpackages for different pieces of the same application, if they can be
logically separated. You will often see subpackages for the client part and
the server part of a program. Sometimes extensive documentation is bundled in
a separate subpackage because it takes up quite some disk space. Extra
functionality that pulls in heavy dependencies will often be packaged
separately. The porter will also decide which subpackage is the main
subpackage, to be installed as a default. Other examples are: extensive test
suites which come with the software, separate modules with support for
different things, etc.

Summary: Some ports are split into several packages. make install will only
install the main subpackage.

To list the different packages built by a port, use

    $ make show=PKGNAMES

make install will only install the main subpackage. To install them all, use

    $ make install-all

To list the different subpackages available for a port, use

    $ make show=MULTI_PACKAGES

It is possible to select which subpackage(s) to install from within the ports
tree. After some tests, this procedure will just call pkg_add(1) to install
the desired subpackage(s).

    $ env SUBPACKAGE="-server" make install

Note: The subpackages mechanism only handles packages, it does not modify any
configuration options before building the port. For that purpose you must use
flavors.

15.3.9 - Using dpb to build multiple ports

When you need to build more than one or two ports at a time, you can use a
tool provided in /usr/ports/infrastructure/bin - dpb(1). dpb(1) takes a list
of ports to build and automatically builds them all in an optimal order,
making use of as much parallelism as possible. It can also use multiple
machines to perform the building. It produces detailed logs of the build
process for troubleshooting, in /usr/ports/log by default.

    /usr/ports/infrastructure/bin/dpb -P ~/localports

will read the list of pkgpaths (pkgpath(7)) in ~/localports and build all the
packages. It can also install the packages after they have been built. ~/
localports would look something like:

    net/cvsync
    www/mozilla-firefox
    net/rsync
    net/nfsen
    textproc/mupdf
    misc/magicpoint
    lang/sbcl
    editors/emacs

If you do not provide a list of ports to build on the command line or via -P
or -I, dpb(1) will build all the ports in the ports tree.

15.3.10 - Security updates

When serious bugs or security flaws are discovered in third party software,
they are fixed in the -stable branch of the ports tree. Unlike the base OS,
the lifecycle is 1 release: only -current and the last release are updated, as
explained in FAQ 5 - OpenBSD's Flavors.

This means all you need to do is make sure you check out the correct branch of
the ports tree, and build the desired software from it. You can keep your tree
up-to-date with CVS, and in addition subscribe to the ports-changes mailing
list to receive security announcements related to software in the ports tree.

Of course, security updates reach the -current ports tree before being taken
up in the -stable branch.

15.3.11 - Package signatures

Signatures are a good way to make sure packages are legitimate and not
corrupted.

OpenBSD 5.5 and newer feature official signed packages, using signify(1).

To start building signed packages, we need to create keys for signing.

    # signify -G -n -s /etc/signify/toto-pkg.sec -p /etc/signify/toto-pkg.pub

Note the names: keys for signing packages should end in pkg.

Then we may sign existing packages after building using pkg_sign(1) .

    # cd /usr/ports/packages/$(uname -p)
    # pkg_sign -s signify -s /etc/signify/toto-pkg.sec -o signed -S all

Alternately, we may add the following line to /etc/mk.conf to directly build
signed packages by default.

    SIGNING_PARAMETERS=-s signify -s /etc/signify/toto-pkg.sec

In order to install the package on another machine, the public key
toto-pkg.pub should be put into the /etc/signify directory on that machine.

By default, pkg_add will only allow signed packages, and it will always look
for keys matching /etc/signify/*pkg.pub.

15.4 - FAQ

15.4.1 - I'm getting all kinds of crazy errors. I just can't seem to get this
ports stuff working at all.

It is very likely that you are using a system and ports tree which are not in
sync.

Sorry?

  * Read EVERYTHING about OpenBSD's Flavors: -release, -stable, and -current.
    The short summary is as follows, but please do read the document mentioned
    above to get an idea about which one it is you want to use.
      + Release: What is on the CD.
      + Stable: Release, plus security and reliability enhancements.
      + Current: The development version of OpenBSD.
  * Do NOT check out a -current ports tree and expect it to work on a -release
    or -stable system. This is one of the most common errors and you will
    irritate people when you ask for help about why "nothing seems to work!"
    If you follow -current, you need both a -current system and a -current
    ports tree. Yes, this really does mean a wonderful new port will typically
    not work on your "older" system -- even if that system was -current just a
    few weeks ago. Keep in mind that if you use X11 as part of your system, it
    must also follow the corresponding branch!
  * Because no intrusive changes are made in -stable, it is possible to use a
    -stable ports tree on a -release system, and vice versa. There is no need
    to update all your installed packages after applying a few errata patches
    to your system.

Another common failure is a missing X11 installation. Even if the port you try
to build has no direct dependency on X11, a subpackage of it or its
dependencies may require X11 headers and libraries. Building ports on systems
without X11 is not supported, so if you insist on doing so, you are on your
own to figure it out. For many ports, there are, however, "no_x11" flavored
packages available, which you can install without needing X11 on your system.

15.4.2 - The latest version of my Top-Favorite-Software is not available!

If you are using a release or stable version of OpenBSD, you will not find any
package updates until the next release. For serious problems which are fixed
in ports, updates are also made to the most recent -stable branch. You can
build your own updates in this case, but the OpenBSD project does not provide
pre-built packages for these updates.

WARNING: DO NOT mix versions of Ports and OpenBSD!

Doing so will sooner or later (probably very soon, in fact) cause you
headaches trying to solve all kinds of errors!

But hey, I am all -current here!

The ports collection is a volunteer project. Sometimes the project simply
doesn't have the developer resources to keep everything up-to-date. Developers
pretty much pick up what they consider interesting and can test in their
environment. Some individual ports may lag behind the mainstream versions
because of this. Importantly, not updating to the latest version is often a
conscious decision. The newer version may have problems that the maintainer is
trying to solve, or that have simply made the application worse than the old
version. Also, OpenBSD may have different goals than the developers in other
projects, which sometimes results in features and design or implementation
choices that are undesirable from OpenBSD developers' point of view. The
update may also be postponed because the new version is not considered a
crucial update.

If you really need a newer version of a port, you should ask the maintainer to
update it (see below on how to find out who the port maintainer is). If you
can help, all the better.

15.4.3 - Why is there no package for my Top-Favorite-Software?

There are several possible reasons for this:

  * Some software must simply not be redistributed in binary package form at
    all, according to its license. Other software is encumbered by patents and
    can therefore not be redistributed. If your Top-Favorite-Software falls
    into this category, you will need to use the port and compile from source.
  * Obvious, but sometimes forgotten: there is no port of your
    Top-Favorite-Software. You can verify this by searching the ports tree. If
    there is indeed no port of your Top-Favorite-Software, then you are
    welcome to help.

15.4.4 - Why is there no port of my Top-Favorite-Software?

The ports collection is a volunteer project. Active port development is done
by a limited number of people, in their spare time. These people usually make
new ports only for software they use directly or are interested in.

You can help. Consider creating your own port. There is some documentation
available on this: the OpenBSD Porter's Handbook. Read it, and read it again.
Especially the part about maintaining your port. Then try making a new port,
and test it carefully and step by step. If finally it works OK for you, submit
it to the ports mailing list at ports@@openbsd.org. Chances are good you will
get some feedback and testing from other people. If the testing is successful,
your port will be considered to be taken up in the ports tree.

15.4.5 - Why is my Top-Favorite-Software not part of the base system?

Because OpenBSD is supposed to be a small stand-alone UNIX-like operating
system, we need to draw a line as to what to include. Generally, for an
application to be included in the base system:

  * It must meet the high quality standards, laid out in the goals of the
    OpenBSD project.
  * Its license must not be too restrictive and must be compatible with the
    BSD license.
  * It must not be too large, in order to keep the size of the base system
    acceptable.

Further answers to this question are also found in FAQ 1.

15.4.6 - What should I use: packages or ports?

In general, you are highly advised to use packages over building an
application from ports. The OpenBSD ports team considers packages to be the
goal of their porting work, not the ports themselves.

Building a complex application from source is not trivial. Not only must the
application be compiled, but the tools used to build it must be built as well.
Unfortunately, OpenBSD, the tools, and the application are all evolving, and
often, getting all the pieces working together is a challenge. Once everything
works, a revision in any of the pieces the next day could render it broken.
Every six months, as a new release of OpenBSD is made, an effort is made to
test the building of every port on every platform, but during the development
cycle it is likely that some ports will break.

In addition to having all the pieces work together, there is just the matter
of time and resources required to compile some applications from source.
Applications such as Mozilla products or KDE may take hours and huge amounts
of disk space and RAM/swap to build. Why go through this much time and effort,
when the programs are already compiled and sitting on your CD-ROM or mirror,
waiting to be used?

Of course, there are a few good reasons to use ports over packages in some
cases:

  * Distribution rules prohibit OpenBSD from distributing a package.
  * You wish to modify or debug the application or study its source code.
  * You need a flavor of a port that is not built by the OpenBSD ports team.
  * You wish to alter the directory layout (i.e. modifying PREFIX or
    SYSCONFDIR).

However, for most people and most applications, using packages is a much
easier, and definitely the recommended way of adding applications to an
OpenBSD system.

15.4.7 - How do I tweak these ports to have maximum performance?

OpenBSD is about stability and security. Just like the GENERIC kernel is the
default and the only supported kernel, the ports team makes sure the ports
work and are stable. If you want to switch on all kinds of compiler options,
you are on your own. Please do not ask questions on the mailing lists such as
why it does not work when you tried to switch on a few hidden knobs to make it
work faster. In general, all this tweaking is not necessary for more than 99%
of users, and it is very likely to be a complete waste of time, for you, the
user, as well as for the developers who read about your "problems" when in
reality there are none.

15.4.8 - I submitted a new port/an update weeks ago. Why isn't it committed?

The ports team has very limited resources and no committer was able to look at
your port/update in time. As frustrating as it may be, just ignore this fact.
Take care of your port, send updates and eventually someone might take care of
it. It has happened before that people suddenly have some free time to spend
on committing ports or their interests shift to new areas and suddenly your
old submission becomes interesting, if it is remembered.

15.5 - Reporting problems

If you have trouble with an existing port, please send e-mail to the port
maintainer. To see who is the maintainer of the port, type, for example:

    $ cd /usr/ports/archivers/unzip
    $ make show=MAINTAINER

Alternatively, if there is no maintainer, or you can't reach him/her, send
e-mail to the OpenBSD ports mailing list, ports@@openbsd.org. Please do NOT use
the misc@@openbsd.org mailing list for questions about ports.

In any case please provide:

  * Your OpenBSD version including any patches you may have applied. The
    kernel version is given by: sysctl -n kern.version
  * The version of your ports tree: if the file /usr/ports/CVS/Tag exists,
    provide its contents. If this file is absent, you are using the -current
    ports tree.
  * A complete description of the problem. Don't be afraid to provide details.
    Mention all the steps you followed before the problem occurred. Is the
    problem reproducible? The more information you provide, the more likely
    you will get help.

For ports which do not build correctly, a complete build transcript is almost
always required. You can use the portslogger script, found in /usr/ports/
infrastructure/bin, for this. A sample run of portslogger might be:

    $ mkdir ~/portslogs
    $ cd /usr/ports/archivers/unzip
    $ make clean install 2>&1 | /usr/ports/infrastructure/bin/portslogger \
               ~/portslogs

After this, you should have a logfile of the build in your ~/portslogs
directory that you can send to the port maintainer. Also, make sure you are
not using any special options in your build, for example in /etc/mk.conf.

Alternatively, you can

  * Use script(1) to create a complete build transcript. Do not remove the
    configure information.
  * Attach the output of pkg_info(1) if it seems even remotely relevant.
  * gcc(1) internal compiler errors ask you to report the bug to the gcc
    mailing list. It does save time if you follow their direction, and provide
    at least the various files produced by gcc -save-temps.

15.6 - Helping us

There are many ways you can help. They are listed below, by increasing order
of difficulty.

  * Report problems as you experience them.
  * You can systematically test ports and report breakages, or suggest
    improvements. Just have a look at the Port Testing Guide.
  * Test the updates to ports which are posted to the ports mailing list.
  * Send updates or patches to a port's maintainer, or to the ports mailing
    list if the port has no maintainer. Generally this is highly appreciated,
    unless your patches will cause developers to waste time rather than save
    time.
  * Create new ports. If you are really eager and want to know everything
    about porting applications to OpenBSD, a good starting point is the
    OpenBSD Porter's Handbook.

Hardware donations can assist testing ports on the various platforms OpenBSD
runs on.

Note: For all creation of new ports and subsequent testing, or for testing
port updates, you must run a -current system! In general, this is not a
desirable environment because of its continuously evolving nature, so proceed
only if you are sure about committing yourself to following -current.

------------------------------------------------------------------------------

@


1.42
log
@
sync
@
text
@d270 1
a270 1
$OpenBSD: index.html,v 1.386 2015/10/18 19:42:11 nick Exp $
@


1.41
log
@
sync
@
text
@d261 3
a263 3
The FAQ maintainers are Nick Holland and Stuart Henderson.
Past contributors include Steven Mestdagh, Joel Knight, Eric Jackson, Wim Vandeputte and Chris
Cappuccio.
d805 3
a807 3
In order to get color output, copy the file /etc/X11/app-defaults/XTerm-color
to your home directory, and rename it ".Xdefaults". Be careful not to
overwrite any current settings in ".Xdefaults". This file contains all the
d11075 4
a11078 4
device would be specified, for example in /etc/fstab or in command lines. Of
course, disks and partitions may also be identified in the traditional way, by
device, unit number and partition (i.e., /dev/sd1f), and this can be done
interchangeably.
d11436 1
d11512 1
a11512 1
The file must not reside on a filesystem which has SoftUpdates enabled (they
d11562 5
a11566 5
Soft Updates is based on an idea proposed by Greg Ganger and Yale Patt and
developed for FreeBSD by Kirk McKusick. SoftUpdates imposes a partial ordering
on the buffer cache operations which permits the requirement for synchronous
writing of directory entries to be removed from the FFS code. Thus, a large
performance increase is seen in disk writing performance.
d11718 1
d11854 1
a11854 1
Larger than 2TB disks
d11857 1
a11857 1
fdisk(8) will show larger than 2TB disks as 2TB. This does not in any way
d11859 1
a11859 1
bootstrap the OS, once the OS is running, the file systems are defined by the
d11862 1
a11862 1
To use a larger than 2TB disk, create an OpenBSD partition on the disk using
d11932 1
a11932 1
To backup your machine you will need to feed dump the name of each fixed disk
d11942 4
a11945 4
    # /sbin/dump -0au -f /dev/nrst0 /dev/rsd0a
    # /sbin/dump -0au -f /dev/nrst0 /dev/rsd0d
    # /sbin/dump -0au -f /dev/nrst0 /dev/rsd0e
    # /sbin/dump -0au -f /dev/nrst0 /dev/rsd0h
d11981 4
a11984 4
    /sbin/dump -0au -f /dev/nrst0 /dev/rsd0a
    /sbin/dump -0au -f /dev/nrst0 /dev/rsd0d
    /sbin/dump -0au -f /dev/nrst0 /dev/rsd0e
    /sbin/dump -0au -f /dev/nrst0 /dev/rsd0h
d12014 1
a12014 1
    # /sbin/restore -tvs 1 -f /dev/rst0
d12023 1
a12023 1
    # /sbin/restore -tvs 2 -f /dev/rst0 > /home/me/list.txt
d12103 1
a12103 1
    wrong you should end up at a prompt asking you for a shell path or press
d12109 2
a12110 2
  * Once you have re-mounted in r/w mode you can continue restoring your other
    file systems. Example:
d12123 3
a12125 3
    reboot into multiuser mode. If everything went as planned your system will
    be back to the state it was in as of your most recent back up tape and
    ready to use again.
d12141 1
a12141 1
To unmount the image use the following commands.
d12207 1
a12207 1
Fix enough of the disc so you can see it, or fix enough of the disc so that
d12209 1
a12209 1
may be preferable (with dying discs you want the data first, with sloppy
d12213 1
a12213 1
"scanffs"). scan_ffs(8) will look through a disc, and try and find partitions
d12250 1
a12250 1
    hw.disknames=cd0:,cd1:,wd0:,fd0:,cd2:
d12591 1
a12591 1
  * Collect dmesg outputs from your friend's computers! (As OpenBSD's dmesg is
d12626 1
a12626 1
  * Use DUIDs to identify your partitions.
d12646 2
a12647 2
An important tool that can be used to speed up your system is softupdates. One
of the slowest operations in the traditional BSD file system is updating
d12649 1
a12649 1
and directories). Softupdates attempts to update metainfo in RAM instead of
d12652 2
a12653 2
always up to date. You can read more about softupdates in the Softupdates FAQ
entry.
d13172 1
a13172 2
  * pkg_add(1) end in a slash (/). - a utility for installing and upgrading
    software packages.
d13179 2
a13180 2
In order to run properly, an application X may require that other applications
Y and Z be installed. Application X is said to be dependent on these other
d13189 1
a13189 1
  * Different checks: has the package already been installed or does it
d13191 2
a13192 2
  * Dependencies which are not yet present on the system, are automatically
    fetched and installed, before proceeding with the installation of the
d13210 1
a13210 1
Example 1: fetching from your CDROM, assuming you mounted it on /mnt/cdrom
d13214 1
a13214 1
Example 2: fetching from a nearby FTP mirror
d13216 1
a13216 1
    $ export PKG_PATH=ftp://your.ftp.mirror/pub/OpenBSD/5.8/packages/`machine -a`/
d13238 1
a13238 1
  * On the FTP mirror servers. Packages are located in the /pub/OpenBSD/5.8/
d13246 1
a13246 1
and use the pkg_locate command to find which package(s) contain that file.
d13251 1
a13251 1
detailed further in Using flavors and subpackages but flavor basically means
d13258 7
a13264 7
Note: Not all possible packages are necessarily available on the FTP servers!
Some applications simply don't work on all architectures. Some applications
can not be distributed via FTP (or CDROM) for licensing reasons. There may
also be many possible combinations of flavors of a port, and the OpenBSD
project just does not have the resources to build them all. If you need a
combination which is not available, you will have to build the port from
source. For more information on how to do that, read Using flavors and
d13284 3
a13286 6
Using pkg_add(1) in interactive mode

pkg_add(1) has an interactive mode, which is enabled by invoking it with the
-i flag, and which causes it to ask you questions when it cannot make
decisions by itself. For example, if you don't know the version number of a
package beforehand, you can try something like:
d13326 2
a13327 1
    Dependencies for tin-1.6.2 resolve to: gettext-0.14.6, libutf8-0.8, pcre-6.4p1, libiconv-1.9.2p3 (todo: libiconv-1.9.2p3,gettext-0.14.6,pcre-6.4p1,libutf8-0.8)
d13331 2
a13332 1
    Dependencies for gettext-0.14.6 resolve to: expat-2.0.0, libiconv-1.9.2p3 (todo: expat-2.0.0)
d13354 2
a13355 2
location may be a local path, or a URL referring to FTP, HTTP, or SCP
locations. Let's consider installation via FTP in the next example:
d13357 1
a13357 1
    # pkg_add ftp://ftp.openbsd.org/pub/OpenBSD/5.8/packages/`machine -a`/screen-4.0.3p3.tgz
d13376 1
a13376 1
    The existing file /etc/screenrc has NOT been changed**                 | 71%
d13395 5
a13399 6
aborts the installation of xv. This is another safety precaution which is
available since OpenBSD 3.7. The packing information bundled in the package
includes information about shared libraries that the package expects to be
installed, system libraries as well as third party libraries. If one of the
required libraries cannot be found, the package is not installed because it
would not function anyway.
d13508 1
a13508 1
    screen-4.0.3p3: complete                                                      7%
d13510 1
a13510 1
    /usr/sbin/pkg_add: Installation of screen-4.0.3p3 failed , partial installation recorded as partial-screen-4.0.3p3
d13544 1
a13544 1
  * a PLIST or packing list, which contains instructions for package creation
d13546 1
a13546 1
  * a DESCR or description of the application,
d13598 15
a13612 15
+------------------------------------------------------------+
|Source     |    Form    |              Flavor               |
|------------------------+-----------------------------------|
|                        |-release|-stable|snapshots|-current|
|------------------------+--------+-------+---------+--------|
|CD-ROM     |  .tar.gz   |   x    |   -   |    -    |   -    |
|-----------+------------+--------+-------+---------+--------|
|FTP mirrors|  .tar.gz   |   x    |   -   |    x    |   -    |
|-----------+------------+--------+-------+---------+--------|
|AnonCVS    |cvs checkout|   x    |   x   |    -    |   x    |
+------------------------------------------------------------+

On the CD-ROM and FTP mirrors, look for a file named ports.tar.gz. You want to
untar this file in the /usr directory, which will create /usr/ports, and all
the directories under it. For example:
d13615 3
a13617 1
    # ftp ftp://ftp.openbsd.org/pub/OpenBSD/5.8/ports.tar.gz
d13621 2
a13622 2
The snapshots available on the FTP mirrors are generated daily from the
-current ports tree. You will find the snapshots in the pub/OpenBSD/snapshots/
d13814 1
a13814 1
If a previous version of the application you want to install, was already
d13957 1
a13957 1
of ports to build and automatically builds them all in an optimal order and
d14000 1
a14000 1
OpenBSD 5.5 and newer feature official signed packages, using signify(1) .
a14095 6
  * On the OpenBSD CD-ROMs, there is no space to include every possible
    package for every possible platform. Therefore only the most used packages
    are included on the CDs. Additionally, some software can only be
    redistributed for free, this means it cannot be included on the CDs. If
    you cannot find a package on the CDs, try another source, such as an FTP
    mirror.
d14153 2
a14154 2
when the programs are already compiled and sitting on your CD-ROM or FTP
mirror, waiting to be used?
d14175 4
a14178 4
why it does not work, when you tried to switch on a few hidden knobs to make
it work faster. In general, all this tweaking is not necessary for more than
99% of users, and it is very likely to be a complete waste of time, for you,
the user, as well as for the developers who read about your "problems" when in
d14233 1
a14233 1
    mailinglist. It does save time if you follow their direction, and provide
@


1.40
log
@
update for 5.8
@
text
@d512 3
@


1.39
log
@
update for 5.7
@
text
@d8 1
a8 1
system and online. The FAQ covers the active release of OpenBSD, currently v5.7. There are
d14 1
a14 1
Upgrade Guide: 5.6 to 5.7  Following -current
a20 2
We're on a mission for Quality Software.

a25 5
    How much for the little OS?
    What?
    Your OS! I want to buy your OS! All platforms! Sell them to me! Sell me your OS!
    It's free!

d34 1
a34 1
  * 1.9 - What is new in OpenBSD 5.7?
a39 2
    You on the motorcycle... You two administrators... Tell your friends!

a46 2
    This is OpenBSD. Strong stuff.

d55 1
a55 3
4 - OpenBSD 5.7 Installation Guide

    I'm tired of being exploited all my life.
a75 2
    Our Lady of Blessed Compilation, don't fail me now!

a89 3
    We've got a lot of data to move, a gigabit link, a full duplex circuit, it's dark, and we
    are wearing sunglasses. Hit it

a104 2
    Excuse me, uh, I don't think there's anything wrong with the action on this keyboard.

a116 2
    May I help you boys?

a137 3
    Illinois GPLers.
    I hate Illinois GPLers

a145 2
    Use of unnecessary effort in the administration of OpenBSD is NOT approved

d149 1
a164 2
    YES! YES! JESUS H. TAP-DANCING CHRIST... I HAVE SEEN THE GUI!

a171 2
    You traded the laptop for an Ultrasparc 60? Ok, I can see that.

a188 3
    What kind of music do you usually have here?
    Oh, we got both kinds. We got country *and* western.

a205 3
    You lied to me.
    It wasn't a lie, it was just bullshit

a228 2
    This OS has got everything!

a237 2
    We got a packet filter powerful enough to turn goat piss into water.

d261 1
a261 2
The FAQ maintainers, following principles of honesty and idealism and where you can stuff them
both, are Nick Holland and Stuart Henderson.
d265 1
a265 1
Questions and comments regarding this FAQ may be directed to faq@@openbsd.org. General
d270 1
a270 1
$OpenBSD: index.html,v 1.383 2015/05/25 03:48:24 nick Exp $
a271 1
We're on a mission from Theo.
d289 1
a289 1
  * 1.9 - What is new in OpenBSD 5.7?
d302 1
a302 1
5.7.
d306 1
a306 1
OpenBSD 5.7 runs on the following platforms:
d440 1
a440 1
    faq@@openbsd.org). Form a local user group and get your friends hooked on
d469 2
a470 2
    Installed as part of the comp56.tgz file set.
  * Perl 5.20.1, with patches and improvements from the OpenBSD team.
d472 3
a474 4
  * SQLite 3.8.6, with patches and improvements from the OpenBSD team.
  * NSD 4.1.1 authoritative DNS server.
  * Unbound 1.5.2
  * Sudo v1.7.2p8, allowing users to run individual commands as root.
d476 1
a476 1
  * Binutils 2.15 with patches.
d480 1
a480 1
  * OpenSSH 6.8
d496 1
a496 1
1.9 - What is new in OpenBSD 5.7?
d498 2
a499 2
The complete list of changes made to OpenBSD 5.6 to create OpenBSD 5.7 can be
found on plus57.html, and highlights on the OpenBSD 5.7 Information page,
d501 1
a501 1
warrant some special note to people upgrading or installing OpenBSD 5.7 who
d504 8
a511 8
  * Sendmail removed in favor of OpenSMTPD. Sendmail available as a package if
    needed.
  * BIND removed in favor of NSD and Unbound. BIND is available as a package
    if it is required.
  * OpenBSD's own httpd replaces nginx in base. Both nginx and OpenBSD's
    modified version of Apache 1.3 are available as packages.
  * Improved hardware support: The usual improvements to support new and old
    hardware, including network interfaces and disk interfaces.
d650 1
a650 1
web interface at http://lists.openbsd.org
d689 1
a689 1
To access the manual pages, be sure that you installed the man56.tgz file set.
d709 1
a709 1
  * sudo(8) - don't log in as root, but run commands as root.
d727 1
a727 1
cgi-bin/man.cgi as well as on your computer if you install the man56.tgz file
a771 1
Example:
d1003 1
a1003 1
In this case, the panic string was "Kernel: page fault trap, code=0"
d1165 2
a1166 2
install57.iso) and "boot only" (for installing from a network file source,
named cd57.iso) ISOs are provided for these platforms.
d1183 2
a1184 2
Those that need or want a bootable USB drive can use the install57.fs
(bootable, plus install sets) or miniroot57.fs (just bootable, file sets are
d1211 1
a1211 1
    $ signify -C -p /etc/signify/openbsd-57-base.pub -x SHA256.sig install57.iso
d1213 1
a1213 1
    install57.iso: OK
d1215 2
a1216 2
which will verify the file install57.iso. Note that you will need the public
key files for OpenBSD 5.7 (and the signify program!) in order to do this.
d1287 3
a1289 3
  * Processor: 100MHz Pentium or better processor. Yes, OpenBSD will run on a
    25MHz 80486, but you won't want to do the experimenting and messing up and
    reloading you need to do to really get to know the system on a slow
d1291 2
a1292 5
    slower than this is the time it takes to SSH into the box. If you wish to
    run X, you probably want to move up to at least 200MHz. X actually runs
    pretty well on a slower machine once loaded, but it takes a while to load
    and start.
  * 64M RAM or better: If you wish to run X, 128M would be a better starting
d1296 5
a1300 5
    the system from source, you will probably want a 4G disk, and if you wish
    to rebuild X as well, you will want 6G or bigger. IDE is recommended to
    start with. If you have a much larger disk, don't feel the obligation to
    allocate all the disk initially -- there is nothing wrong with leaving 72G
    of an 80G hard disk unallocated if all you need is 8G.
d1328 1
a1328 1
4 - OpenBSD 5.7 Installation Guide
d1393 2
a1394 2
  * CD-ROM: On several platforms a CD-ROM image (cd57.iso for just booting, or
    install57.iso for the entire install) is provided allowing creation of a
d1430 1
a1430 1
    also use install57.iso or you can make your own.
d1482 1
a1482 1
The i386 platform has seven separate installation disk images to choose from:
d1484 1
a1484 1
  * cd57.iso is an ISO9660 image that can be used to create a bootable CD with
d1488 1
a1488 1
  * install57.iso is an ISO9660 image, containing all the standard install
d1491 3
a1493 9
  * floppy57.fs (Desktop PC) supports many PCI and ISA NICs, IDE, SATA and
    simple SCSI adapters and some PCMCIA support. Most users will use this
    image if booting from a floppy.
  * floppyB57.fs (Servers) supports many RAID controllers, and some of the
    less common SCSI adapters. However, support for many standard SCSI
    adapters and many EISA and ISA NICS has been removed.
  * floppyC57.fs (Laptops) supports the CardBus and PCMCIA devices found in
    many laptops.
  * miniroot57.fs is a disk image, can be written to a bootable device, such
d1495 1
a1495 1
    using the cd57.iso for install. File sets would then be pulled down via
d1497 2
a1498 2
  * install57.fs much like miniroot57.fs, but includes all the file sets for
    install. This is equivalent to using install57.iso.
d1502 2
a1503 2
  * floppy57.fs supports systems with a floppy disk.
  * cd57.iso is an ISO image usable to make your own CD for booting SPARC
d1505 2
a1506 2
  * miniroot57.fs can be written to a swap partition and booted.
  * install57.iso is an ISO9660 image, containing all the standard install
d1517 1
a1517 1
You can create a CD-ROM using the cd57.iso or install57.iso files. The exact
d1524 1
a1524 1
  # cdio tao cd57.iso
d1548 1
a1548 1
  # dd if=/location/install57.fs of=/dev/rsd6c bs=1m
d1638 1
a1638 1
  Welcome to the OpenBSD/i386 5.7 installation program.
d1656 1
a1656 1
        often work, it is not supported. For OpenBSD 5.7, upgrading 5.6 to 5.7
d1661 1
a1661 1
    Upgrade Guide 5.7.
a1753 12
  Start ntpd(8) by default? [no] y
  NTP server? (hostname or 'default') [default] Enter

You are here given an option of running OpenNTPD, OpenBSD's NTP
implementation. OpenNTPD is a low-impact way of keeping your computer's clock
accurately synchronized. The default configuration, using pool.ntp.org, uses a
large number of free-access time servers around the world.

One reason you may NOT want to run ntpd(8) is if you are running a dual-boot
system mostly using another OS which doesn't use a GMT-set hardware clock, and
you don't want OpenBSD altering the time for your other OS.

a1774 5
  Do you want to suspend on lid close? [yes] Enter

If your machine appears to be a laptop, you will be asked if you want the
system to respond to the closing of the lid by suspending.

d1788 2
a1789 1
  Since you set up a user, disable sshd(8) logins to root? [yes]
d1915 1
a1915 1
using the 'm' option in disklabel(8).
d1937 1
a1937 1
  Server directory? [pub/OpenBSD/5.7/i386] Enter
d1944 3
a1946 3
      [X] bsd           [X] base57.tgz    [X] game57.tgz    [X] xfont57.tgz
      [X] bsd.rd        [X] comp57.tgz    [X] xbase57.tgz   [X] xserv57.tgz
      [ ] bsd.mp        [X] man57.tgz     [X] xshare57.tgz
d1949 1
a1949 1
At a bare minimum, you need to have a kernel (bsd) and base57.tgz file set.
d1954 1
a1954 1
  * -comp57.tgz removes comp57.tgz
d1971 2
a1972 2
those cases are not true (i.e., installing from an install57.iso or
install57.fs, or your hard disk is too small to "pre-load" the files), you
d1987 1
a1987 1
  Get/Verify SHA256.sig   100% |**************************|  1888       00:01
d1989 10
a1998 10
  Get/Verify bsd          100% |**************************| 10384 KB    00:05
  Get/Verify bsd.rd       100% |**************************|  6803 KB    00:03
  Get/Verify base57.tgz   100% |**************************| 51618 KB    00:26
  Get/Verify comp57.tgz   100% |**************************| 44999 KB    00:28
  Get/Verify man57.tgz    100% |**************************|  8773 KB    00:06
  Get/Verify game57.tgz   100% |**************************|  2651 KB    00:02
  Get/Verify xbase57.tgz  100% |**************************| 14878 KB    00:06
  Get/Verify xshare57.tgz 100% |**************************|  4413 KB    00:04
  Get/Verify xfont57.tgz  100% |**************************| 38994 KB    00:17
  Get/Verify xserv57.tgz  100% |**************************| 18469 KB    00:15
d2001 10
a2010 8
  Installing base57.tgz   100% |**************************| 51618 KB    00:22
  Installing comp57.tgz   100% |**************************| 44999 KB    00:17
  Installing man57.tgz    100% |**************************|  8773 KB    00:06
  Installing game57.tgz   100% |**************************|  2651 KB    00:00
  Installing xbase57.tgz  100% |**************************| 14878 KB    00:03
  Installing xshare57.tgz 100% |**************************|  4413 KB    00:05
  Installing xfont57.tgz  100% |**************************| 38994 KB    00:10
  Installing xserv57.tgz  100% |**************************| 18469 KB    00:06
d2019 1
a2019 1
  Time appears wrong.  Set to 'Wed Nov  5 09:21:38 EST 2014'? [yes] Enter
d2021 1
a2021 1
If you configured the system to use NTP, you may get this message to set the
d2704 8
a2711 8
  * base57.tgz - Contains the base OpenBSD system Required
  * comp57.tgz - Contains the compiler and its tools, headers and libraries.
  * man57.tgz - Contains man pages
  * game57.tgz - Contains the games for OpenBSD
  * xbase57.tgz - Contains the base libraries and utilities for X11
  * xfont57.tgz - Contains X11's font server and fonts
  * xserv57.tgz - Contains X11's X servers
  * xshare57.tgz - Contains manpages, locale settings, includes, etc. for X
d2717 1
a2717 1
applications can sometimes be satisfied simply by installing just xbase57.tgz,
d2733 1
a2733 1
xbase57.tgz and pull out just the files they need to install their
d3174 1
a3174 1
Sometimes, you realize you really DID need comp57.tgz (or any other system
d3191 1
a3191 1
  # tar -C / -xzvphf comp57.tgz
d3280 1
a3280 1
If you use install57.iso or install57.fs, you will find the installer will
d3285 1
a3285 1
After all, if someone were to make a "rogue" install57.iso file, they would
d3354 1
a3354 1
called "siteXX.tgz", where XX is the release version (e.g. 57). The siteXX.tgz
d3363 1
a3363 1
siteXX-<hostname>.tgz, for example, "site57-puffy.tgz". This allows easy
d3522 1
a3522 1
      + 5.3.2 - Install or upgrade to closest available binary
d3563 1
a3563 1
           ,------o-----------o----X                    5.4 Stable
d3565 1
a3565 1
           |      .    ,------o---------o----X          5.5 Stable
d3567 1
a3567 1
           |      .    |      .    ,----o----------o--> 5.6 Stable
d3569 1
a3569 1
           |      .    |      .    |    .    ,-----o--> 5.7 Stable
d3572 1
a3572 1
     -->5.4Rel----->5.5Rel----->5.6Rel----->5.7Rel----> Current
d3587 2
a3588 2
also note that in the above example, the 5.4-stable branch came to an end with
5.6-release, and the 5.5-stable branch came to an end with 5.7-release -- old
d3593 1
a3593 1
(i.e., going from 5.7-release to 5.7-stable).
d3657 1
a3657 1
functionality. For example, going from v5.6 to v5.7, or going from the June
d3670 3
a3672 3
So, you may install a system (for example, 5.5-release) from CD, then update
it to 5.5-stable a few times, then upgrade it to 5.6-release from CD, and
update that a few times before upgrading it again to the 5.7-release.
d3688 2
a3689 2
5.7-current (or a snapshot), then decide you are living too dangerously, and
step back to 5.7-stable. You are on your own if you choose any path other than
d3736 1
a3736 1
  * Upgrading to the closest available binary.
d3747 1
a3747 1
5.3.2 - Install or Upgrade to closest available binary
d3750 2
a3751 2
available binary installed. Use this table to look at where you are, where you
wish to go, and what binary you should start with:
d3762 1
a3762 1
|-release    |-current   |Latest Snapshot  |(optional) Fetch & build -current|
d3764 1
a3764 1
|Old -current|-current   |Latest Snapshot  |(optional) Fetch & build -current|
d3767 4
a3770 4
It is recommended that you install the binary by using the "Upgrade" option of
the install media. If that is not possible, you can also unpack the binaries
as described here. Regardless, you must do the entire upgrade process,
including creating any users or other /etc directory changes needed.
d3817 1
a3817 1
        # cvs -d$CVSROOT checkout -rOPENBSD_5_7 -P src
d3819 1
a3819 1
    This will pull the src files from the OPENBSD_5_7 branch, which is also
d3825 1
a3825 1
        # cvs -d$CVSROOT up -rOPENBSD_5_7 -Pd
d3828 1
a3828 1
    system, so you don't have to remember the "-rOPENBSD_5_7" part of the
d3840 1
a3840 1
    # cvs -d$CVSROOT checkout -rOPENBSD_5_7 -P src ports xenocara
d3931 1
a3931 1
    can use CVS. For example, to see the changes between 5.6 and 5.7 do a:
d3934 1
a3934 1
        # cvs diff -u -rOPENBSD_5_6 -rOPENBSD_5_7
d3936 1
a3936 1
    To see the changes between 5.7 and -current ("HEAD"), use:
d3939 1
a3939 1
        # cvs diff -u -rOPENBSD_5_7 -rHEAD
d4153 1
d4399 1
a4399 1
    $ sudo config -e /bsd
d4401 1
a4401 1
    OpenBSD 5.7 (GENERIC) #738: Sun Mar  8 10:59:31 MDT 2015
d4459 2
a4460 2
    $ sudo config -e -u -o bsd.new /bsd
    OpenBSD 5.7 (GENERIC) #738: Sun Mar  8 10:59:31 MDT 2015
d4769 2
d5664 1
a5664 1
    OpenBSD 5.7 (RAMDISK_CD) #719: Sun Mar  8 11:09:19 MDT 2015
d5930 1
a5930 1
  * acx(4) TI ACX100/ACX111. ^(NFF) (AP)
d5933 1
a5933 1
  * athn(4) driver for Atheros 802.11/a/g/n devices.
d5938 4
a5941 3
  * ipw(4) Intel PRO/Wireless 2100 802.11b. ^(NFF)
  * iwi(4) Intel PRO/Wireless 2200BG/2225BG/2915ABG 802.11a/b/g. ^(NFF)
  * iwn(4) Intel WiFi Link 4965/5100/5300 802.11a/b/g/Draft-N wireless. ^(NFF)
d5955 1
a5955 1
  * wpi(4) Intel PRO/Wireless 3945ABG. ^(NFF)
a5958 2
^(NFF) indicates chip requires a non-free firmware which can not be included
with OpenBSD.
d6245 2
a6246 2
As one might expect, all these commands can also be entered at the command
prompt, as root, or (better) using sudo(8).
d6806 1
a6806 1
If this is a non-personal machine, you should probably use sudo(8) to give
d6874 1
a6874 1
|Awk      |base57.tgz,|                                                      |
d6879 1
a6879 1
|C, C++   |comp57.tgz,|The C/C++ compilers in the base system have been      |
d6926 1
a6926 1
|Perl     |base57.tgz,|Many Perl modules are available in the ports tree, so |
d6998 1
a6998 1
    OpenBSD 5.7 (GENERIC) #738: Sun Mar  8 10:59:31 MDT 2015
d7141 1
a7141 1
    230- OpenBSD 5.7 (GENERIC) #738: Sun Mar  8 10:59:31 MDT 2015
d7157 7
a7163 7
Note that I appended ":skey" to my username. This tells ftpd that I want to
authenticate using S/Key. Some of you might have noticed that my sequence
number has changed to otp-md5 96 oshi45820. This is because by now I have used
S/Key to login several times. But how do you get your one-time password? Well,
to compute the one-time password, you'll need to know what sequence number
you're using and your key. As you're probably thinking, how can you remember
which sequence number you're on?
d7179 2
a7180 2
For example here, I need to generate another one-time password for a login
that I might have to make in the future. (remember I'm doing this from a
d7201 5
a7205 5
I'm sure many of you won't always have a secure connection or a trusted local
computer to create these passwords, and creating them over an insecure
connection isn't feasible, so how can you create multiple passwords at one
time? You can supply skey(1) with a number of how many passwords you want
created. This can then be printed out and taken with you wherever you go.
d7228 1
a7228 1
    OpenBSD 5.7 (GENERIC) #738: Sun Mar  8 10:59:31 MDT 2015
d7478 3
a7480 3
In this case, I am assuming you have the DHCP range set to 192.168.1.100
through 192.168.1.199, plus the three static definitions as listed at the top
of the file.
d7542 1
a7542 1
    OpenBSD 5.7 (GENERIC) #738: Sun Mar  8 10:59:31 MDT 2015
d7782 1
a7782 1
    # export PKG_PATH=ftp://your.ftp.mirror/pub/OpenBSD/5.7/packages/i386/
d7808 1
d7843 1
a7843 1
wheel group, use sudo(8).
d7993 105
a8097 3
before the system shuts down should be added to this file. If you have apm,
you can also set "powerdown=YES", which will give you the equivalent of
"shutdown -p".
d10395 1
a10395 1
latter are handly for testing the hardware, bypassing most software layers. To
d10652 1
a10652 2
    mentioned below. You are welcome to let us know about your successes or
    failures.
d11528 1
a11528 1
    $ sudo dd if=/dev/zero of=/var/swap bs=1k count=32768
d11536 2
a11537 2
    $ sudo chmod 600 /var/swap
    $ sudo swapctl -a /var/swap
d11688 1
a11688 1
    OpenBSD 5.7 (GENERIC) #738: Sun Mar  8 10:59:31 MDT 2015
d11898 2
a11899 2
"Amanda" and "Bacula" are available through packages for backing up multiple
servers to disk and tape.
d13167 2
a13168 1
  * pkg_add(1) - a utility for installing and upgrading software packages.
d13208 1
a13208 1
    $ export PKG_PATH=/mnt/cdrom/5.7/packages/`machine -a`/
d13212 1
a13212 1
    $ export PKG_PATH=ftp://your.ftp.mirror/pub/OpenBSD/5.7/packages/`machine -a`/
d13216 4
a13219 5
locations, separated by colons. Prior to OpenBSD 4.4, every path in the
PKG_PATH variable MUST end in a slash (/). That way, pkg_add(1) can split the
path correctly even if it holds URL schemes containing colons. If the first
entry in PKG_PATH fails, the next one will be tried, and so on, until the
package is found. If all entries fail, an error is produced.
d13224 1
a13224 1
snapshots, you will replace "5.7" with "snapshots".
d13234 1
a13234 1
  * On the FTP mirror servers. Packages are located in the /pub/OpenBSD/5.7/
d13269 1
a13269 1
    $ sudo pkg_add -v screen-4.0.3p3
d13287 1
a13287 1
    $ sudo pkg_add -i screen
d13301 1
a13301 1
    $ sudo pkg_add ghostscript-fonts-8.11
d13319 1
a13319 1
file located in /usr/local/share/docs/pkg-readmes.
d13323 1
a13323 1
    $ sudo pkg_add -v tin-1.8.2p0
d13354 1
a13354 1
    $ sudo pkg_add ftp://ftp.openbsd.org/pub/OpenBSD/5.7/packages/`machine -a`/screen-4.0.3p3.tgz
d13371 1
a13371 1
    $ sudo pkg_add -v screen-4.0.3p3
d13380 1
a13380 1
    $ sudo pkg_add xv-3.10ap4
d13441 1
a13441 1
box from OpenBSD 5.6 to 5.7. Now you can easily upgrade to the newer 5.7
d13444 1
a13444 1
    $ sudo pkg_add -u unzip
d13475 1
a13475 1
    $ sudo pkg_delete screen
d13489 1
a13489 1
    $ sudo pkg_delete screen
d13505 1
a13505 1
    $ sudo pkg_add screen-4.0.3p3
d13612 4
a13615 4
    $ cd /tmp
    $ ftp ftp://ftp.openbsd.org/pub/OpenBSD/5.7/ports.tar.gz
    $ cd /usr
    $ sudo tar xzf /tmp/ports.tar.gz
d13642 1
a13642 1
  * You can set up sudo(8) and have the ports system use it for tasks
d13645 1
a13645 2
        commands as the superuser, see the "User Specification" subsection in
        the sudoers(5) manual.
d13648 4
a13651 6
        sudo to the privileged shell, see the env_keep variable in sudoers(5).
        The default file /etc/sudoers already provides an appropriate list of
        variables for members of the wsrc group, so it is usually sufficient
        to add the user who is going to build ports to that group(5).
      + The ports system needs permission to invoke sudo. This can be granted
        by setting the SUDO variable defined in bsd.port.mk(5) in the
d13655 1
a13655 1
              SUDO=/usr/bin/sudo
d13815 3
a13817 3
examples are compilers like GCC 4.0 or the Java 2 Software Development Kit. If
you get "out of memory" type of errors when building such a port, this usually
has one of two causes:
d13821 1
a13821 3
    starting the build, or use sudo(8) with the -c flag to run the build with
    the resources limited by the specified login class (refer to login.conf(5)
    for details about login classes).
@


1.38
log
@
update the often forgotten txt files.
@
text
@d8 1
a8 1
system and online. The FAQ covers the active release of OpenBSD, currently v5.6. There are
d14 4
a17 4
Upgrade Guide: 5.5 to 5.6       Following -current
Porter's Handbook               Port Testing Guide
Manual pages                    Bug Reporting
Mailing lists                   PF User's Guide
d21 1
a21 2
My mission is to make it up into /src/lib/libssl/. There's a library up there that's gone
insane. I'm supposed to fix it.
d28 4
a31 2
    Everyone gets everything he wants. I wanted secure transmissions, and for my sins, they
    gave me OpenSSL.
d41 1
a41 1
  * 1.9 - What is new in OpenBSD 5.6?
d47 1
a47 1
    It was a bug. And the more I saw them, the more I hated bugs.
d56 1
a56 2
    It's impossible for words to describe what is necessary to those who do not know what
    Heartbleed means.
d66 1
a66 1
4 - OpenBSD 5.6 Installation Guide
d68 1
a68 1
    I hardly said a word to the installer, until I said "yes" to ntpd(8).
d89 1
a89 2
    Are you a user?
    I'm a hacker
d105 2
a106 1
    I was going to the worst place in the Internet, and I didn't even know it yet.
d123 1
a123 1
    Terminal the kernel?
d137 1
a137 2
    They train administrators to run secure systems. But their managers won't allow them to
    demand SSH keys and secure applications because it is "difficult".
d160 2
a161 1
    We must kill them. We must incinerate them. Penguin after penguin.
d171 1
a171 1
    kill -9 with extreme prejudice.
d191 1
a191 5
    What do you think?
    It's beautiful!
    What's the matter with you? You're acting kinda weird!
    Hey, you know that last sysctl I was saving? I set it.
    Far out!
d200 1
a200 2
    Why are all you guys running on all this hardware?
    So we don't get our endians blown off!
a205 1
  * 12.5 - ARMv7-based systems (BeagleBoard, PandaBoard, SABRE Lite, Nitrogen6x)
d219 2
a220 1
    I love the smell of burning CDs in the morning.
d239 2
a240 1
    fdisk and disklabel are your friends. If they are not, then they are enemies to be feared.
d265 1
a265 1
    Java don't surf!
d276 1
a276 1
    If I say it's safe to surf this Internet, Captain, then it's safe to surf this Internet!
a300 28

Commonly Encountered Issues

    Someday this FAQ will end.

  * Common Installation Problems
  * How do I upgrade my system?
  * Packet Filter
  * Should I use Ports or Packages?
  * How do I set up a multi-boot system?
  * Wireless networking options
  * Setting up a "live" USB media

----------------------------------------------------------------------------------------------

Recent Updates

    You understand, Captain, that this FAQ does not exist, nor will it ever exist...

  * Adding and replacing NICs -- new
  * ARMv7-based system quirks -- new
  * Wireless networking -- updated
  * How do I use softraid(4)? -- new
  * Duplicating your root partition: altroot -- new
  * Large drive info -- updated for >2TB disks
  * FAQ updated for 5.6

----------------------------------------------------------------------------------------------
d310 4
a313 3
OpenBSD FAQ Copyright (C) 1998-2014 OpenBSD
$OpenBSD: index.html,v 1.379 2015/02/03 01:33:50 nick Exp $
The bugs piled up so fast in OpenSSL, you needed wings to stay above it.
d331 1
a331 1
  * 1.9 - What is new in OpenBSD 5.6?
d344 1
a344 1
5.6.
d348 1
a348 1
OpenBSD 5.6 runs on the following platforms:
d350 1
a350 1
  * alpha - Download only
a353 1
  * armv7 - Download only (replaced "beagle")
d365 1
a365 1
  * vax - Available on CD
d512 1
a512 2
  * Perl 5.18.2, with patches and improvements from the OpenBSD team.
  * Nginx 1.6.0 web server, with patches.
d514 3
a516 7
  * SQLite 3.8.4.3, with patches and improvements from the OpenBSD team.
  * Sendmail 8.14.8 mail server, with libmilter.
  * BIND 9.4.2-P2 (plus patches) DNS server. OpenBSD has implemented many
    improvements in chroot operation and other security-related issues. Note:
    this will be removed for 5.7 in favor of NSD and Unbound
  * NSD 4.0.3 authoritative DNS server.
  * Unbound 1.4.22
d523 2
a524 2
  * OpenSSH 6.7
  * OpenSMTPD v5.4.3 Secure, simple and reliable Mail Transport Agent (MTA).
d527 1
d539 1
a539 1
1.9 - What is new in OpenBSD 5.6?
d541 2
a542 2
The complete list of changes made to OpenBSD 5.5 to create OpenBSD 5.6 can be
found on plus56.html, and highlights on the OpenBSD 5.6 Information page,
d544 1
a544 1
warrant some special note to people upgrading or installing OpenBSD 5.6 who
d547 8
a554 22
  * OpenSSL forked: Welcome LibreSSL
    The OpenBSD project has forked the historically buggy OpenSSL project into
    LibreSSL. Great quantities of bad, unsupported, and irrelevant code has
    been stripped out, including amazing "exploit mitigation countermeasures"
    and the remaining code cleaned up creating a much leaner and more secure
    replacement product.
  * Improved hardware support:
    The usual improvements to support new and old hardware, including network
    interfaces and disk interfaces.
  * Removal of FTP and tape as install methods.
    It is unlikely anyone was actually using tape install, and HTTP is easier
    for everyone than FTP.
  * OpenSMTP replaces sendmail as default MTA.
    Sendmail will still be available for this release if your installation
    still needs it, but migrating to OpenSMTPD is recommended.
  * Unbound and NSD are available to replace BIND
    Note that BIND's named will remain in 5.6, but will be removed from 5.7.
    unbound(8) is a recursive resolver (asks other servers for resolution),
    nsd is an authoritative server (provides authoritative information;
    usually queried directly only by recursive resolvers).
  * Apache httpd, Kerberos, lynx, rmail, uucpd have been removed.
    If desired, they can be installed from packages.
d1018 4
a1021 5
If Smart User had a working OpenBSD system from which he wanted to submit a
bug report, he would have used the sendbug(1) utility to submit his bug report
to the GNATS problem tracking system. Obviously you can't use sendbug(1) when
your system won't boot, but you should use it whenever possible. You will
still need to include detailed information about what happened, the exact
d1161 1
a1161 1
  * 3.4 - Downloading via HTTP, FTP, RSYNC or AFS
d1209 2
a1210 2
install56.iso) and "boot only" (for installing from a network file source,
named cd56.iso) ISOs are provided for these platforms.
d1227 2
a1228 2
Those that need or want a bootable USB drive can use the install56.fs
(bootable, plus install sets) or miniroot56.fs (just bootable, file sets are
d1232 1
a1232 1
3.4 - Downloading via HTTP, FTP, RSYNC or AFS
d1234 4
a1237 4
There are numerous international mirror sites offering HTTP and FTP access to
OpenBSD releases and snapshots. RSYNC and AFS access are also available. You
should always use the site nearest to you. Before you begin fetching a release
or snapshot, you may wish to use ping(8) and traceroute(8) to determine which
d1255 1
a1255 1
    $ signify -C -p /etc/signify/openbsd-56-base.pub -x SHA256.sig install56.iso
d1257 1
a1257 1
    install56.iso: OK
d1259 2
a1260 2
which will verify the file install56.iso. Note that you will need the public
key files for OpenBSD 5.6 (and the signify program!) in order to do this.
d1348 1
a1348 1
  * Network adapter: Use a PCI adapter. If you are planning on putting
d1367 3
a1369 2
Obviously, "the more, the better" to a point. Some popular applications
seemingly use as much processor and memory as you can throw at the system.
d1375 1
a1375 1
4 - OpenBSD 5.6 Installation Guide
d1385 1
a1385 2
      + 4.3.2 - Creating floppies on Unix
      + 4.3.3 - Creating floppies on Windows
a1406 1
      + 4.13.1 - My Compaq only recognizes 16M RAM
d1423 1
a1423 1
installation process, which is consistent across all platforms.
d1437 5
a1441 14
  * Floppy disk: OpenBSD can be installed on many platforms by booting an
    installer from a single floppy disk. However, due to space constraints,
    some larger platforms (sparc64, amd64, alpha) do not have some utilities
    which may be important to you, such as a DHCP client to configure the
    network. For these platforms, you may do better with the CD install.
    However, for platforms like i386 and sparc, you will find the boot floppy
    very complete.

    Floppy disk images are provided which can be used to create an install
    floppy on another Unix-like system, or on a Windows system. Typical file
    names are floppy56.fs, though several platforms have multiple floppy
    images available.
  * CD-ROM: On several platforms a CD-ROM image (cd56.iso for just booting, or
    install56.iso for the entire install) is provided allowing creation of a
d1447 2
a1448 7
  * Writing a file system image to disk (miniroot): a filesystem image that
    can be written to an existing partition, and then can be booted. This can
    be used on some platforms to write an install file system to an existing
    disk (i.e., on a sparc, write a miniroot file system to a swap partition
    in Solaris, then boot from that to install OpenBSD) or to an external
    device, such as a USB thumbdrive to boot an install on some of the new
    laptops which lack any kind of removable media.
a1454 1
  * armv7: Writing image to SD card.
a1455 1
  * hp300: CD-ROM, network.
a1461 2
  * mvme68k: Network.
  * mvme88k: Network.
d1477 1
a1477 1
    also use install56.iso or you can make your own.
d1497 1
a1497 1
  * Install method to be used (CD-ROM, FTP, etc.).
d1531 1
a1531 1
  * cd56.iso is an ISO9660 image that can be used to create a bootable CD with
d1535 1
a1535 1
  * install56.iso is an ISO9660 image, containing all the standard install
d1538 1
a1538 1
  * floppy56.fs (Desktop PC) supports many PCI and ISA NICs, IDE, SATA and
d1541 1
a1541 1
  * floppyB56.fs (Servers) supports many RAID controllers, and some of the
d1544 1
a1544 1
  * floppyC56.fs (Laptops) supports the CardBus and PCMCIA devices found in
d1546 1
a1546 1
  * miniroot56.fs is a disk image, can be written to a bootable device, such
d1548 1
a1548 1
    using the cd56.iso for install. File sets would then be pulled down via
d1550 2
a1551 2
  * install56.fs much like miniroot56.fs, but includes all the file sets for
    install. This is equivalent to using install56.iso.
d1555 2
a1556 2
  * floppy56.fs supports systems with a floppy disk.
  * cd56.iso is an ISO image usable to make your own CD for booting SPARC
d1558 2
a1559 2
  * miniroot56.fs can be written to a swap partition and booted.
  * install56.iso is an ISO9660 image, containing all the standard install
d1570 1
a1570 1
You can create a CD-ROM using the cd56.iso or install56.iso files. The exact
d1577 1
a1577 1
  # cdio tao cd56.iso
d1579 1
a1579 3
Most CD recorders sold for Windows and Macintosh systems come with software
that can burn ISO images to blank media. If yours does not, there are various
no-cost applications that can do this for you.
d1583 1
a1583 34
4.3.2 - Creating floppies on Unix

Precise details and device names may vary from Unix variant to Unix variant;
use what is appropriate for your system.

To create a formatted floppy, use the fdformat(1) command to both format and
check for bad sectors.

  # fdformat /dev/rfd0c
  Format 1440K floppy `/dev/rfd0c'? (y/n): y
  Processing VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV done.

If your output is like the above example, then the disk is OK. However, if you
do not see ALL "V"'s then the disk is most likely bad, and you should try a
new one.

To write the image file to the disk, use dd(1). An example usage of dd(1) is
below:

  # dd if=floppy56.fs of=/dev/rfd0c bs=32k

Once the image is written, check to make sure that the copied image is the
same as the original with the cmp(1) command. If the diskette is identical to
the image, you will just see another prompt.

  # cmp /dev/rfd0c floppy56.fs

4.3.3 - Creating floppies on Windows

To prepare a floppy in Windows, first use the native formatting tools to
format the disk, verifying that the disk has no bad sectors.

To write the installation image to the prepared floppy you can use ntrw.exe,
which can be downloaded from the tools directory on any of the FTP mirrors.
d1585 3
a1587 1
Example usage of ntrw:
d1589 3
a1591 4
  C:\> ntrw floppy56.fs a:
  3.5", 1.44MB, 512 bytes/sector
  bufsize is 9216
  1474560 bytes written
d1593 1
a1593 1
4.3.4 - Creating a bootable install flash drive from Unix
d1601 1
a1601 1
  # dd if=/location/install56.fs of=/dev/rsd6c bs=1m
d1691 1
a1691 1
  Welcome to the OpenBSD/i386 5.6 installation program.
d1704 4
a1707 5
      + You will not be given the option of installing the etc56.tgz file.
        After the install, you will have to manually merge the changes of
        etc56.tgz into your system before you can expect it to be fully
        functional. This is an important step which must be done, as otherwise
        certain key services (such as pf(4)) may not start.
d1709 1
a1709 1
        often work, it is not supported. For OpenBSD 5.6, upgrading 5.5 to 5.6
d1714 1
a1714 1
    Upgrade Guide 5.6.
d1916 1
a1916 1
For now, we'll take the defaults on our 40G disk.
d1921 1
a1921 1
  Disk: wd0       geometry: 5168/240/63 [78140160 Sectors]
d1926 1
a1926 1
   0: 07      0   1   1 -   5167 239  63 [           0:    78140097 ] NTFS
d1963 10
a1972 10
    b:           767.4M          2097216    swap
    c:         38154.4M                0  unused
    d:          2598.9M          3668800  4.2BSD   2048 16384    1 # /tmp
    e:          4108.2M          8991328  4.2BSD   2048 16384    1 # /var
    f:          2048.0M         17404960  4.2BSD   2048 16384    1 # /usr
    g:          1024.0M         21599264  4.2BSD   2048 16384    1 # /usr/X11R6
    h:          5146.6M         23696416  4.2BSD   2048 16384    1 # /usr/local
    i:          1643.7M         34236704  4.2BSD   2048 16384    1 # /usr/src
    j:          2048.0M         37603040  4.2BSD   2048 16384    1 # /usr/obj
    k:         17745.5M         41797344  4.2BSD   2048 16384    1 # /home
d2006 1
a2006 1
  Server directory? [pub/OpenBSD/5.6/i386] Enter
d2013 3
a2015 4
      [X] bsd           [X] etc56.tgz     [X] xbase56.tgz   [X] xserv56.tgz
      [X] bsd.rd        [X] comp56.tgz    [X] xetc56.tgz
      [ ] bsd.mp        [X] man56.tgz     [X] xshare56.tgz
      [X] base56.tgz    [X] game56.tgz    [X] xfont56.tgz
d2018 4
a2021 4
At a bare minimum, you need to have a kernel (bsd), the base56.tgz and
etc56.tgz file sets. Unless you know what you are doing, stick with the
default sets. You can add and remove file sets using "+" and "-" characters in
front of the file set name, and also use wildcards:
d2023 1
a2023 1
  * -comp56.tgz removes comp56.tgz
d2040 2
a2041 2
those cases are not true (i.e., installing from an install56.iso or
install56.fs, or your hard disk is too small to "pre-load" the files), you
d2056 1
a2056 1
  Get/Verify SHA256.sig   100% |**************************|  2240       00:01
d2058 21
a2078 25
  Get/Verify bsd          100% |**************************| 10409 KB    00:05
  Get/Verify bsd.rd       100% |**************************|  6756 KB    00:03
  Get/Verify base56.tgz   100% |**************************| 57500 KB    00:26
  Get/Verify etc56.tgz    100% |**************************|   176 KB    00:00
  Get/Verify comp56.tgz   100% |**************************| 42191 KB    00:28
  Get/Verify man56.tgz    100% |**************************|  8974 KB    00:06
  Get/Verify game56.tgz   100% |**************************|  2650 KB    00:02
  Get/Verify xbase56.tgz  100% |**************************| 14812 KB    00:06
  Get/Verify xetc56.tgz   100% |**************************| 69058       00:00
  Get/Verify xshare56.tgz 100% |**************************|  4449 KB    00:04
  Get/Verify xfont56.tgz  100% |**************************| 38994 KB    00:17
  Get/Verify xserv56.tgz  100% |**************************| 18483 KB    00:15
  Installing bsd          100% |**************************| 10409 KB    00:00
  Installing bsd.rd       100% |**************************|  6756 KB    00:00
  Installing base56.tgz   100% |**************************| 57500 KB    00:22
  Installing etc56.tgz    100% |**************************|   176 KB    00:00
  Installing comp56.tgz   100% |**************************| 42191 KB    00:17
  Installing man56.tgz    100% |**************************|  8974 KB    00:06
  Installing game56.tgz   100% |**************************|  2650 KB    00:00
  Installing xbase56.tgz  100% |**************************| 14812 KB    00:03
  Installing xetc56.tgz   100% |**************************| 69058       00:00
  Installing xshare56.tgz 100% |**************************|  4449 KB    00:05
  Installing xfont56.tgz  100% |**************************| 38994 KB    00:10
  Installing xserv56.tgz  100% |**************************| 18483 KB    00:06
  Location of sets? (cd disk ftp http or 'done') [done] Enter
d2091 2
a2092 1
  Saving configuration files...Making all device nodes...done.
d2123 1
a2123 1
You may also find the following links useful:
d2771 8
a2778 14
  * base56.tgz - Contains the base OpenBSD system Required
  * etc56.tgz - Contains all the files in /etc Required
  * comp56.tgz - Contains the compiler and its tools, headers and libraries.
  * man56.tgz - Contains man pages
  * game56.tgz - Contains the games for OpenBSD
  * xbase56.tgz - Contains the base libraries and utilities for X11
  * xetc56.tgz - Contains the /etc/X11 and /etc/fonts configuration files
  * xfont56.tgz - Contains X11's font server and fonts
  * xserv56.tgz - Contains X11's X servers
  * xshare56.tgz - Contains manpages, locale settings, includes, etc. for X

The etc56.tgz and xetc56.tgz sets are not installed as part of an upgrade,
only as part of a complete install, so any customizations you make will not be
lost. You will have to update your /etc, /dev and /var directories manually.
d2784 1
a2784 1
applications can sometimes be satisfied simply by installing just xbase56.tgz,
d2800 1
a2800 1
xbase56.tgz and pull out just the files they need to install their
d3241 1
a3241 1
Sometimes, you realize you really DID need comp56.tgz (or any other system
d3258 1
a3258 1
  # tar -C / -xzvphf comp56.tgz
d3301 1
a3301 1
  >> OpenBSD/i386 BOOT 3.28
a3312 19
4.13.1 - My Compaq only recognizes 16M RAM

Some old Compaq systems have an issue where the full system RAM is not
detected by the OpenBSD second stage boot loader properly, and only 16M may be
detected and used by OpenBSD. This can be corrected either by creating/editing
/etc/boot.conf file, or by entering commands at the "boot>" prompt before
OpenBSD loads. If you had a machine with 64M RAM, but OpenBSD was only
detecting the first 16M, the command you would use would be:

     machine mem +0x3000000@@0x1000000

to add 48M (0x3000000) after the first 16M (0x1000000). Typically, if you had
a machine with this problem, you would enter the above command first at the
install floppy/CD-ROM's boot> prompt, load the system, reboot, and create an /
etc/boot.conf file with the above line in it so all future bootings will
recognize all available RAM.

It has also been reported that a ROM update will fix this on some systems.

d3347 1
a3347 1
If you use install56.iso or install56.fs, you will find the installer will
d3352 1
a3352 1
After all, if someone were to make a "rogue" install56.iso file, they would
d3421 1
a3421 1
called "siteXX.tgz", where XX is the release version (e.g. 56). The siteXX.tgz
d3430 1
a3430 1
siteXX-<hostname>.tgz, for example, "site56-puffy.tgz". This allows easy
d3487 1
a3487 1
for FTP or other installs.
d3630 1
a3630 1
           ,------o-----------o----X                    5.3 Stable
d3632 1
a3632 1
           |      .    ,------o---------o----X          5.4 Stable
d3634 1
a3634 1
           |      .    |      .    ,----o----------o--> 5.5 Stable
d3636 1
a3636 1
           |      .    |      .    |    .    ,-----o--> 5.6 Stable
d3639 1
a3639 1
     -->5.3Rel----->5.4Rel----->5.5Rel----->5.6Rel----> Current
d3654 2
a3655 2
also note that in the above example, the 5.3-stable branch came to an end with
5.5-release, and the 5.4-stable branch came to an end with 5.6-release -- old
d3660 1
a3660 1
(i.e., going from 5.6-release to 5.6-stable).
d3724 1
a3724 1
functionality. For example, going from v5.5 to v5.6, or going from the June
d3733 1
a3733 1
example, 5.6-release to 5.6-stable. You may then later update it to a newer
d3737 3
a3739 3
So, you may install a system (for example, 5.4-release) from CD, then update
it to 5.4-stable a few times, then upgrade it to 5.5-release from CD, and
update that a few times before upgrading it again to the 5.6-release.
d3755 2
a3756 2
5.6-current (or a snapshot), then decide you are living too dangerously, and
step back to 5.6-stable. You are on your own if you choose any path other than
d3854 1
a3854 1
The CVS(1) command has many options, some of them are required to checkout and
d3884 1
a3884 1
        # cvs -d$CVSROOT checkout -rOPENBSD_5_6 -P src
d3886 1
a3886 1
    This will pull the src files from the OPENBSD_5_6 branch, which is also
d3892 1
a3892 1
        # cvs -d$CVSROOT up -rOPENBSD_5_6 -Pd
d3895 1
a3895 1
    system, so you don't have to remember the "-rOPENBSD_5_6" part of the
d3907 1
a3907 1
    # cvs -d$CVSROOT checkout -rOPENBSD_5_6 -P src ports xenocara
d3998 1
a3998 1
    can use CVS. For example, to see the changes between 5.5 and 5.6 do a:
d4001 1
a4001 1
        # cvs diff -u -rOPENBSD_5_5 -rOPENBSD_5_6
d4003 1
a4003 1
    To see the changes between 5.6 and -current ("HEAD"), use:
d4006 1
a4006 1
        # cvs diff -u -rOPENBSD_5_6 -rHEAD
d4467 1
a4467 1
    OpenBSD 5.6 (GENERIC) #274: Fri Aug  8 00:05:13 MDT 2014
d4508 6
a4513 6
     95 ep* disabled
     96 ep* disabled
    281 ep0 disabled
    282 ep* disabled
    283 ep* disabled
    340 ep* disabled
d4526 1
a4526 1
    OpenBSD 5.6 (GENERIC) #274: Fri Aug  8 00:05:13 MDT 2014
d4529 3
a4531 3
    161 wi* disabled
    162 wi* disabled
    417 wi* disabled
d4663 1
a4663 3
there. To update files in these directories, use the sysmerge(8) utility,
which can use either the checked-out source tree or pre-made etc56.tgz and
xetc56.tgz files.
d5728 1
a5728 1
    OpenBSD 5.6 (RAMDISK_CD) #268: Fri Aug  8 00:15:04 MDT 2014
d6004 1
a6004 1
  * iwn(4) Intel WiFi Link 4965/5100/5300 802.11a/b/g/Draft-N wireless.
d6007 1
a6007 1
  * pgt(4) Conexant/Intersil Prism GT Full-MAC 802.11a/b/g
d6845 1
a6845 1
        >> OpenBSD/i386 BOOT 3.17
d6939 1
a6939 1
|Awk      |base56.tgz,|                                                      |
d6944 1
a6944 1
|C, C++   |comp56.tgz,|The C/C++ compilers in the base system have been      |
d6991 1
a6991 1
|Perl     |base56.tgz,|Many Perl modules are available in the ports tree, so |
d7063 1
a7063 1
    OpenBSD 5.6 (GENERIC) #274: Fri Aug  8 00:05:13 MDT 2014
d7206 1
a7206 1
    230- OpenBSD 5.6 (GENERIC) #274: Fri Aug  8 00:05:13 MDT 2014
d7293 1
a7293 1
    OpenBSD 5.6 (GENERIC) #274: Fri Aug  8 00:05:13 MDT 2014
d7607 1
a7607 1
    OpenBSD 5.6 (GENERIC) #274: Fri Aug  8 00:05:13 MDT 2014
d7847 1
a7847 1
    # export PKG_PATH=ftp://your.ftp.mirror/pub/OpenBSD/5.6/packages/i386/
d9276 1
a9276 4
of OpenBSD. The system-wide defaults are in /etc/X11 and were initially loaded
from xetcXX.tgz, which is not reloaded by the suggested upgrade process, so if
you make system-wide changes, they will persist, but you may need to merge
those changes into later versions of those files.
a9379 1
  * 12.5 - ARMv7-based systems
a9594 57
12.5 - ARMv7-based systems (BeagleBoard, PandaBoard, SABRE Lite, Nitrogen6x)

Building from source: At this moment, the kernel has to be in the FAT boot
partition, not the root of the file system like other OpenBSD platforms, and
this kernel must be in a format required by the U-Boot boot loader. So, after
building your kernel, you must go through some special steps:

    config GENERIC-OMAP # for Beagle; others may use GENERIC-IMX
    cd ../compile/GENERIC-OMAP
    make clean; make
    make bsd.umg            # Extra steps start here!
    mount /dev/sd0i /mnt    # assuming your FAT partition is 'i'
    cp bsd.umg /mnt

No real time clock: Many of the armv7 devices do not have a battery backed
real time clock. For this reason, using the "-s" option of OpenNTPD may be
desirable.

Distribution kernels must be converted before use: The distribution kernels
are standard kernels, which can be used for the -N option of ps(1), vmstat(8),
dmesg(8), iostat(8) and similar applications, but can not be booted directly
by the U-Boot bootloader used on this platform. This can be done using mkuboot
(8)

Typical operation is something along these lines for OMAP/beagle:

    mkuboot -a arm -o linux -e 0x80300000 -l 0x80300000 bsd bsd.umg

for i.MX6:

    mkuboot -a arm -o linux -e 0x10800000 -l 0x10800000 bsd bsd.umg

where bsd is the name of the kernel you are converting.

U-Boot tricks:

  * Booting single user (OMAP/beagle):

        U-Boot# mmc rescan
        U-Boot# setenv bootargs sd0 -s
        U-Boot# fatload mmc 0 0x82800000 bsd.umg
        U-Boot# bootm 0x82800000

  * Booting single user (i.MX6, mmc storage):

        U-Boot# mmc rescan
        U-Boot# setenv bootargs sd0 -s
        U-Boot# fatload mmc 0 0x12000000 bsd.umg
        U-Boot# bootm 0x12000000

  * Booting single user (i.MX6, SATA storage):

        U-Boot# sata init
        U-Boot# setenv bootargs sd0 -s
        U-Boot# fatload sata 0 0x12000000 bsd.umg
        U-Boot# bootm 0x12000000

d11513 1
a11513 1
also. If this line is not added, your won't have this swap device configured.
d11610 1
a11610 1
        >> OpenBSD/i386 BOOT 3.21
d11649 1
a11649 1
    Copyright (c) 1995-2013 OpenBSD.  All rights reserved.  http://www.OpenBSD.org
d11651 1
a11651 1
    OpenBSD 5.6 (GENERIC) #274: Fri Aug  8 00:05:13 MDT 2014
d13170 1
a13170 1
    $ export PKG_PATH=/mnt/cdrom/5.6/packages/`machine -a`/
d13174 1
a13174 1
    $ export PKG_PATH=ftp://your.ftp.mirror/pub/OpenBSD/5.6/packages/`machine -a`/
d13187 1
a13187 1
snapshots, you will replace "5.6" with "snapshots".
d13197 1
a13197 1
  * On the FTP mirror servers. Packages are located in the /pub/OpenBSD/5.6/
d13281 3
d13317 1
a13317 1
    $ sudo pkg_add ftp://ftp.openbsd.org/pub/OpenBSD/5.6/packages/`machine -a`/screen-4.0.3p3.tgz
d13404 1
a13404 1
box from OpenBSD 5.5 to 5.6. Now you can easily upgrade to the newer 5.6
d13576 1
a13576 1
    $ ftp ftp://ftp.openbsd.org/pub/OpenBSD/5.6/ports.tar.gz
@


1.37
log
@Bring info about jdk up to date for 5.6. okay sthen@@
@
text
@d1 1
d3 1
a3 1
                     OpenBSD Frequently Asked Questions
d5 1
a5 1
----------------------------------------------------------------------------
d7 4
a10 5
This FAQ is supplemental documentation to the man pages, available both in
the installed system and online. The FAQ covers the active release of
OpenBSD, currently v5.5. There are likely features and changes to features
in the development version (-current) of OpenBSD that are not covered in the
FAQ.
d12 1
a12 1
The FAQ is available in text form as well.
d14 11
a24 1
OpenBSD is ready for the future!
a25 1
----------------------------------------------------------------------------
a26 1

d29 2
a30 1
    It was the Enchantment Under the C code
d40 1
a40 1
  * 1.9 - What is new in OpenBSD 5.5?
d46 1
a46 2
    The way I see it, if you are going to build a quality operating system,
    why not do it with some style?
d55 2
a56 2
    I'm sure in 2014 source code is available at every anoncvs server, but
    in 1901, it's a little hard to come by!
d61 1
a61 1
  * 3.4 - Downloading via FTP, HTTP, RSYNC or AFS
d66 1
a66 1
4 - OpenBSD 5.5 Installation Guide
d68 1
a68 2
    1.21 gigabytes! 1.21 gigabytes! Great Scott!
    (Actually, can be done with a lot less than that)
d89 2
a90 1
    Why don't you make like a source tree and compile?
d106 1
a106 2
    If my calculations are correct, when this baby hits 88MBps, you're going
    to see some serious shit!
a111 1
  * 6.5 - Point to Point Protocol
d123 1
a123 1
    Since you're new here, I'm gonna cut you a break, today.
d129 1
a129 2
  * 7.5 - How can I use a console resolution of 80x50? (some amd64, i386,
    Alpha)
d137 2
a138 1
    Yeah, I'll keep that in mind
d143 1
a143 2
  * 8.8 - Is there any way to use my floppy drive if it's not attached
    during boot?
d147 1
a147 2
  * 8.13 - I sometimes get Input/output error when trying to use my tty
    devices
d161 1
a161 4
    Oh my God. They found me, I dont know how but they found me. Run for it
    Puffy!
    Who? Who!?
    Who do you think? The penguins!
d165 1
a165 2
  * 9.3 - Converting your Linux (or other Sixth Edition-style) password file
    to BSD-style.
d171 1
a171 1
    So you are my data. Better get used to that chroot, kid.
d176 2
a177 6
  * 10.4 - Why do users get relaying access denied when they are remotely
    sending mail through my OpenBSD system?
  * 10.6 - Why does Sendmail ignore /etc/hosts?
  * 10.7 - Setting up a Secure HTTP Server using SSL(8)
  * 10.8 - I made changes to /etc/passwd with vi(1), but the changes didn't
    seem to take place. Why?
a183 1
  * 10.16 - Tell me about chroot(2) web server?
d191 5
a195 2
    Things have certainly changed around here. I remember when this was all
    text as far as the eye can see! MIT had this crazy idea of a GUI
d204 2
a205 1
    Still waiting for a port to DeLorean
d211 1
a211 3
  * 12.5 - ARMv7-based systems (BeagleBoard, PandaBoard, SABRE Lite,
    Nitrogen6x)
  * 12.6 - HP 9000 series 300, 400
a216 2
  * 12.12 - MVME68k
  * 12.13 - MVME88k
d225 1
a225 1
    You can hook up to the amplifier. Works great
d244 1
a244 1
    In 1901, no one knew what a gigabyte was!
d269 1
a269 2
    What about all that talk about screwing up security?
    Well, I figured, what the hell.
d280 1
a280 2
    Wait a minute, are you trying to tell me you built a firewall out of a
    computer for free?
d304 1
a304 1
----------------------------------------------------------------------------
d308 1
a308 1
    Damn! Damn!
d318 1
a318 1
----------------------------------------------------------------------------
d322 1
a322 1
    Sorry, no Mr. Fusion yet
d330 1
a330 17
  * FAQ updated for 5.5

----------------------------------------------------------------------------
The FAQ maintainers, following principles of honesty and idealism and where
you can stuff them both, are Nick Holland and Stuart Henderson.
Past contributors include Steven Mestdagh, Joel Knight, Eric Jackson, Wim
Vandeputte and Chris Cappuccio.

Questions and comments regarding this FAQ may be directed to
faq@@openbsd.org. General questions about OpenBSD should be directed to the
appropriate mail list.


OpenBSD FAQ Copyright (C) 1998-2013 OpenBSD
$OpenBSD: obsd-faq.txt,v 1.36 2014/09/26 11:41:47 nick Exp $
I guess you guys aren't ready for that yet. But your kids are gonna love it.

d332 14
d362 1
a362 1
  * 1.9 - What is new in OpenBSD 5.5?
d375 1
a375 1
5.5.
d379 1
a379 1
OpenBSD 5.5 runs on the following platforms:
a385 1
  * hp300 - Download only (support ending after 5.5)
a391 2
  * mvme68k - Download only (support ending after 5.5)
  * mvme88k - Download only (support ending after 5.5)
d414 1
a414 1
different designs. And yes, supporting "unusual" platforms has helped produced
d543 5
a547 9
    Installed as part of the comp55.tgz file set.
  * Perl 5.16.3, with patches and improvements from the OpenBSD team.
  * Our improved and secured version of the Apache 1.3 web server. The OpenBSD
    team has added default chrooting, privilege revocation, and other
    security-related improvements. Also includes mod_ssl and DSO support.
    Note: Apache httpd will be removed for 5.6 in favor of nginx.
  * Nginx 1.4.4 web server, with patches.
  * OpenSSL 1.0.1c, with patches and improvements from the OpenBSD team.
  * SQLite 3.8.0.2, with patches and improvements from the OpenBSD team.
d551 3
a553 4
    this will be removed for 5.6 in farvor of NSD and Unbound
  * NSD 4.0.1 authoritative DNS server.
  * Lynx 2.8.7rel.2 text web browser. With HTTPS and IPv6 support added, plus
    patches from the OpenBSD team.
a555 1
  * Heimdal 1.5.2 with patches.
d558 1
a558 1
  * Less 444 with patches
d560 2
a561 2
  * OpenSSH 6.6
  * OpenSMTPD v5.4.2 Secure, simple and reliable Mail Transport Agent (MTA).
d575 1
a575 1
1.9 - What is new in OpenBSD 5.5?
d577 2
a578 2
The complete list of changes made to OpenBSD 5.4 to create OpenBSD 5.5 can be
found on plus55.html, and highlights on the OpenBSD 5.5 Information page,
d580 1
a580 1
warrant some special note to people upgrading or installing OpenBSD 5.5 who
d583 6
a588 2
  * Renamed platform:
    OpenBSD/beagle was renamed armv7 after 5.4.
d592 13
a604 16
  * Year 2038 ready!
    OpenBSD has switched its time_t to 64 bit. New installs will not be an
    issue, but upgrades will have a have to unload all packages before the
    upgrade and re-install afterwards.
  * Releases and packages are now cryptographically signed with the signify(1)
    utility.
      + The installer will verify all sets before installing.
      + Installing without verification works, but is discouraged.
      + Users are advised to verify the installer (bsd.rd, install55.iso,
        etc.) ahead of time using the signify(1) tool if available.
      + pkg_add(1) now trusts signed packages only by default.
  * Installer is now scriptable, using an auto-installation process.
  * New install images:
    miniroot55.fs is bootable with bsd.rd only, install55.fs also has all the
    install sets (unsigned). These files can be written to a USB (or other)
    media.
d619 1
a619 1
laptops.
a647 4
  * Why isn't a newer version of Apache included?
    The license on newer versions is unacceptable. Users interested in more
    modern web servers are encouraged to look at nginx(8) which will be
    replacing Apache in base in OpenBSD 5.6.
d650 1
a650 1
    platforms, such as hp300 or VAX would be unacceptable.
d782 1
a782 1
To access the manual pages, be sure that you installed the man55.tgz file set.
d820 1
a820 1
cgi-bin/man.cgi as well as on your computer if you install the man55.tgz file
a879 16
How do I generate compressed copies of the man pages?

For people who build their system from source, there are a number of options
relating to the way in which man pages are built. These options can be placed
in /etc/mk.conf (it may be necessary to create this file) and are included
during system builds. One especially useful option is to generate compressed
man pages in order to save disk space. These can be viewed in the normal way,
using the man command. In order to set this, add the following to /etc/
mk.conf:

    MANZ=yes

Another useful option is to have the system build generate man pages in
PostScript format, as well as ASCII text. This is done by setting the option
MANPS=yes in /etc/mk.conf. See mk.conf(5) for further details.

d1245 1
a1245 1
If you're installing a release version of OpenBSD, you should use a official
d1260 2
a1261 2
install55.iso) and "boot only" (for installing from a network file source,
named cd55.iso) ISOs are provided for these platforms.
d1278 2
a1279 2
Those that need or want a bootable USB drive can use the install55.fs
(bootable, plus install sets) or miniroot55.fs (just bootable, file sets are
d1306 1
a1306 1
    $ signify -C -p /etc/signify/openbsd-55-base.pub -x SHA256.sig install55.iso
d1308 1
a1308 1
    install55.iso: OK
d1310 2
a1311 2
which will verify the file install55.iso. Note that you will need the public
key files (and the signify program!) of OpenBSD 5.5 in order to do this.
d1418 2
a1419 2
Obviously, "more the better" to a point. Some popular applications seemingly
use as much processor and memory as you can throw at the system.
d1425 1
a1425 1
4 - OpenBSD 5.5 Installation Guide
d1437 1
d1499 1
a1499 1
    names are floppy55.fs, though several platforms have multiple floppy
d1501 2
a1502 2
  * CD-ROM: On several platforms a CD-ROM image (cd55.iso for just booting, or
    install55.iso for the entire install) is provided allowing creation of a
d1547 1
a1547 3
    also use install55.iso or you can make your own.
  * FTP: Either one of the OpenBSD FTP mirror sites or your own local FTP
    server holding the file sets.
d1601 1
a1601 1
  * cd55.iso is an ISO9660 image that can be used to create a bootable CD with
d1605 1
a1605 1
  * install55.iso is an ISO9660 image, containing all the standard install
d1608 1
a1608 1
  * floppy55.fs (Desktop PC) supports many PCI and ISA NICs, IDE, SATA and
d1611 1
a1611 1
  * floppyB55.fs (Servers) supports many RAID controllers, and some of the
d1614 1
a1614 1
  * floppyC55.fs (Laptops) supports the CardBus and PCMCIA devices found in
d1616 1
a1616 1
  * miniroot55.fs is a disk image, can be written to a bootable device, such
d1618 1
a1618 1
    using the cd55.iso for install. File sets would then be pulled down via
d1620 2
a1621 2
  * install55.fs much like miniroot55.fs, but includes all the file sets for
    install. This is equivalent to using install55.iso.
d1625 2
a1626 2
  * floppy55.fs supports systems with a floppy disk.
  * cd55.iso is an ISO image usable to make your own CD for booting SPARC
d1628 2
a1629 2
  * miniroot55.fs can be written to a swap partition and booted.
  * install55.iso is an ISO9660 image, containing all the standard install
d1640 1
a1640 1
You can create a CD-ROM using the cd55.iso or install55.iso files. The exact
d1647 1
a1647 1
  # cdio tao cd55.iso
d1674 1
a1674 1
  # dd if=floppy55.fs of=/dev/rfd0c bs=32k
d1680 1
a1680 1
  # cmp /dev/rfd0c floppy55.fs
d1692 1
a1692 1
  C:\> ntrw floppy55.fs a:
d1705 1
a1705 1
  # dd if=/location/install55.fs of=/dev/rsd6c bs=1m
d1795 1
a1795 1
  Welcome to the OpenBSD/i386 5.5 installation program.
d1808 1
a1808 1
      + You will not be given the option of installing the etc55.tgz file.
d1810 1
a1810 1
        etc55.tgz into your system before you can expect it to be fully
d1814 1
a1814 1
        often work, it is not supported. For OpenBSD 5.5, upgrading 5.4 to 5.5
d1819 1
a1819 1
    Upgrade Guide 5.5.
a1872 1
  Issuing hostname-associated DHCP request for fxp0.
d1895 2
a1896 2
  Password for root account? (will not echo) PaSsWoRd
  Password for root account? (again) PaSsWoRd
d1926 1
a1926 1
Not all platforms will ask if you expect to run X, those that do ask require a
d1929 1
a1929 1
on your platform.
d1945 5
d1959 5
a1963 1
  Setup a user? (enter a lower-case loginname, or 'no') [no] Enter
d1967 5
a1971 2
su(1) and mail addressed to root will be forwarded to them. You will be
prompted for a password.
d2031 1
a2031 1
   0: 00      0   1   1 -   5167 239  63 [           0:    78140097 ] NTFS
d2068 10
a2077 10
    b:           199.0M          2097216    swap
    c:         40960.0M                0  unused
    d:          2822.9M          2504768  4.2BSD   2048 16384    1 # /tmp
    e:          4295.0M          8286112  4.2BSD   2048 16384    1 # /var
    f:          2048.0M         17082240  4.2BSD   2048 16384    1 # /usr
    g:          1024.0M         21276544  4.2BSD   2048 16384    1 # /usr/X11R6
    h:          5426.7M         23373696  4.2BSD   2048 16384    1 # /usr/local
    i:          1699.7M         34487520  4.2BSD   2048 16384    1 # /usr/src
    j:          2048.0M         37968576  4.2BSD   2048 16384    1 # /usr/obj
    k:         20367.4M         42162880  4.2BSD   2048 16384    1 # /home
d2092 1
a2092 37
using newfs(8), and mounts them for installation:

  /dev/rwd0a: 1024.0MB in 2097152 sectors of 512 bytes
  6 cylinder groups of 202.47MB, 12958 blocks, 25984 inodes each
  /dev/rwd0k: 20367.4MB in 41712448 sectors of 512 bytes
  101 cylinder groups of 202.47MB, 12958 blocks, 25984 inodes each
  /dev/rwd0d: 2822.9MB in 5781344 sectors of 512 bytes
  14 cylinder groups of 202.47MB, 12958 blocks, 25984 inodes each
  /dev/rwd0f: 2048.0MB in 4194304 sectors of 512 bytes
  11 cylinder groups of 202.47MB, 12958 blocks, 25984 inodes each
  /dev/rwd0g: 1024.0MB in 2097152 sectors of 512 bytes
  6 cylinder groups of 202.47MB, 12958 blocks, 25984 inodes each
  /dev/rwd0h: 5426.7MB in 11113824 sectors of 512 bytes
  27 cylinder groups of 202.47MB, 12958 blocks, 25984 inodes each
  /dev/rwd0j: 2048.0MB in 4194304 sectors of 512 bytes
  11 cylinder groups of 202.47MB, 12958 blocks, 25984 inodes each
  /dev/rwd0i: 1699.7MB in 3481056 sectors of 512 bytes
  9 cylinder groups of 202.47MB, 12958 blocks, 25984 inodes each
  /dev/rwd0e: 4295.0MB in 8796128 sectors of 512 bytes
  22 cylinder groups of 202.47MB, 12958 blocks, 25984 inodes each
  /dev/wd0a (c109be3ad535b626.a) on /mnt type ffs (rw, asynchronous, local)
  /dev/wd0k (c109be3ad535b626.k) on /mnt/home type ffs (rw, asynchronous, local, n
  odev, nosuid)
  /dev/wd0d (c109be3ad535b626.d) on /mnt/tmp type ffs (rw, asynchronous, local, no
  dev, nosuid)
  /dev/wd0f (c109be3ad535b626.f) on /mnt/usr type ffs (rw, asynchronous, local, no
  dev)
  /dev/wd0g (c109be3ad535b626.g) on /mnt/usr/X11R6 type ffs (rw, asynchronous, loc
  al, nodev)
  /dev/wd0h (c109be3ad535b626.h) on /mnt/usr/local type ffs (rw, asynchronous, loc
  al, nodev)
  /dev/wd0j (c109be3ad535b626.j) on /mnt/usr/obj type ffs (rw, asynchronous, local
  , nodev, nosuid)
  /dev/wd0i (c109be3ad535b626.i) on /mnt/usr/src type ffs (rw, asynchronous, local
  , nodev, nosuid)
  /dev/wd0e (c109be3ad535b626.e) on /mnt/var type ffs (rw, asynchronous, local, no
  dev, nosuid)
d2102 2
a2103 2
  Location of sets? (cd disk ftp http or 'done') [cd] http
  HTTP/FTP proxy URL? (e.g. 'http://proxy:8080', or 'none') [none] Enter
d2111 1
a2111 4
  Server directory? [pub/OpenBSD/5.5/i386] Enter

The public FTP mirrors all support anonymous downloads, of course, but you may
have a local machine which requires a login and password.
d2118 4
a2121 4
      [X] bsd           [X] etc55.tgz     [X] xbase55.tgz   [X] xserv55.tgz
      [X] bsd.rd        [X] comp55.tgz    [X] xetc55.tgz
      [ ] bsd.mp        [X] man55.tgz     [X] xshare55.tgz
      [X] base55.tgz    [X] game55.tgz    [X] xfont55.tgz
d2124 3
a2126 3
At a bare minimum, you need to have a kernel (bsd), the base55.tgz and
etc55.tgz file sets. Unless you know what you are doing, stick with the
default sets. You can add and remove file sets using "+" and "-" chars in
d2129 1
a2129 1
  * -comp55.tgz removes comp55.tgz
d2146 2
a2147 2
those cases are not true (i.e., installing from an install55.iso or
install55.fs, or your hard disk is too small to "pre-load" the files), you
d2162 26
a2187 25
  Get/Verify SHA256.sig   100% |**************************|  2329       00:01
  Get/Verify bsd          100% |**************************| 10263 KB    00:05
  Get/Verify bsd.rd       100% |**************************|  6349 KB    00:03
  Get/Verify base55.tgz   100% |**************************| 58796 KB    00:26
  Get/Verify etc55.tgz    100% |**************************|   513 KB    00:00
  Get/Verify comp55.tgz   100% |**************************| 48489 KB    00:28
  Get/Verify man55.tgz    100% |**************************|  9836 KB    00:06
  Get/Verify game55.tgz   100% |**************************|  2643 KB    00:02
  Get/Verify xbase55.tgz  100% |**************************| 12565 KB    00:06
  Get/Verify xetc55.tgz   100% |**************************| 64910       00:00
  Get/Verify xshare55.tgz 100% |**************************|  4300 KB    00:04
  Get/Verify xfont55.tgz  100% |**************************| 38994 KB    00:17
  Get/Verify xserv55.tgz  100% |**************************| 23534 KB    00:15
  Installing bsd          100% |**************************| 10263 KB    00:00
  Installing bsd.rd       100% |**************************|  6349 KB    00:00
  Installing base55.tgz   100% |**************************| 58796 KB    00:22
  Installing etc55.tgz    100% |**************************|   513 KB    00:00
  Installing comp55.tgz   100% |**************************| 48489 KB    00:17
  Installing man55.tgz    100% |**************************|  9836 KB    00:06
  Installing game55.tgz   100% |**************************|  2643 KB    00:00
  Installing xbase55.tgz  100% |**************************| 12565 KB    00:03
  Installing xetc55.tgz   100% |**************************| 64910       00:00
  Installing xshare55.tgz 100% |**************************|  4300 KB    00:05
  Installing xfont55.tgz  100% |**************************| 38994 KB    00:10
  Installing xserv55.tgz  100% |**************************| 23534 KB    00:06
d2191 1
a2191 1
either missed, forgotten or failed file sets can be re-installed, and also so
d2196 6
a2201 3
  Saving configuration files...done.
  Generating initial host.random file...done.
  Making all device nodes...done.
d2483 1
a2483 1
cylinder,head and sector. If you answer "no" here (as we will), you will be
d2496 1
a2496 1
  Rounding to nearest cylinder: 10490382
d2512 1
a2512 1
   0: 07      0   1   1 -    652 254  63 [          63:    10490382 ] NTFS
d2538 2
a2539 2
uh-oh! What's our offset? Simple -- the offset of the previous partition plus
the size of the partition, in this case, 63+10490382 = 10490445.
d2557 1
a2557 1
   0: 07      0   1   1 -    652 254  63 [          63:    10490382 ] NTFS
d2590 1
a2590 1
   0: 07      0   1   1 -    652 254  63 [          63:    10490382 ] NTFS
d2627 2
a2628 2
More information on the why partitioning is good and strategy for a good
partitioning plan are below.
d2698 1
a2698 1
    i:         10490382               63    NTFS
d2810 1
a2810 1
    i:         10490382               63    NTFS
d2824 1
a2824 1
    i:          5122.3M               63    NTFS
d2880 10
a2889 10
  * base55.tgz - Contains the base OpenBSD system Required
  * etc55.tgz - Contains all the files in /etc Required
  * comp55.tgz - Contains the compiler and its tools, headers and libraries.
  * man55.tgz - Contains man pages
  * game55.tgz - Contains the games for OpenBSD
  * xbase55.tgz - Contains the base libraries and utilities for X11
  * xetc55.tgz - Contains the /etc/X11 and /etc/fonts configuration files
  * xfont55.tgz - Contains X11's font server and fonts
  * xserv55.tgz - Contains X11's X servers
  * xshare55.tgz - Contains manpages, locale settings, includes, etc. for X
d2891 1
a2891 1
The etc55.tgz and xetc55.tgz sets are not installed as part of an upgrade,
d2899 1
a2899 1
applications can sometimes be satisfied simply by installing just xbase55.tgz,
d2915 1
a2915 1
xbase55.tgz and pull out just the files they need to install their
d2997 2
a2998 2
    used to abuse your system. Note that this directory is cleared on reboot,
    and files left untouched over 24 hours are cleared nightly.
d3142 2
a3143 2
The boot(8) program is loaded from the floppy, looks for and reads /etc/
boot.conf. The "boot hd0a:/bsd" line instructs boot(8) where to load the
a3274 5
OpenBSD and Linux (i386)

Please refer to INSTALL.linux, which gives in depth instructions on getting
OpenBSD working with Linux.

d3356 1
a3356 1
Sometimes, you realize you really DID need comp55.tgz (or any other system
d3373 1
a3373 1
  # tar -C / -xzvphf comp55.tgz
d3416 1
a3416 1
  >> OpenBSD/i386 BOOT 3.18
d3430 6
a3435 6
Some Compaq systems have an issue where the full system RAM is not detected by
the OpenBSD second stage boot loader properly, and only 16M may be detected
and used by OpenBSD. This can be corrected either by creating/editing /etc/
boot.conf file, or by entering commands at the "boot>" prompt before OpenBSD
loads. If you had a machine with 64M RAM, but OpenBSD was only detecting the
first 16M, the command you would use would be:
d3481 1
a3481 1
If you use install55.iso or install55.fs, you will find the installer will
d3486 1
a3486 1
After all, if someone were to make a "rogue" install55.iso file, they would
d3555 1
a3555 1
called "siteXX.tgz", where XX is the release version (e.g. 55). The siteXX.tgz
d3564 1
a3564 1
siteXX-<hostname>.tgz, for example, "site55-puffy.tgz". This allows easy
d3579 1
a3579 2
    siteXX.tgz file -- /etc/skel files, /etc/pf.conf, /var/www/conf/
    httpd.conf, /etc/rc.conf.local, etc.
a3751 1

d3764 1
a3764 1
           ,------o-----------o----X                    5.2 Stable
d3766 1
a3766 1
           |      .    ,------o---------o----X          5.3 Stable
d3768 1
a3768 1
           |      .    |      .    ,----o----------o--> 5.4 Stable
d3770 1
a3770 1
           |      .    |      .    |    .    ,-----o--> 5.5 Stable
d3773 1
a3773 1
     -->5.2Rel----->5.3Rel----->5.4Rel----->5.5Rel----> Current
d3788 2
a3789 2
also note that in the above example, the 5.2-stable branch came to an end with
5.4-release, and the 5.3-stable branch came to an end with 5.5-release -- old
d3794 1
a3794 1
(i.e., going from 5.5-release to 5.5-stable).
d3858 1
a3858 1
functionality. For example, going from v5.4 to v5.5, or going from the June
d3867 1
a3867 1
example, 5.5-release to 5.5-stable. You may then later update it to a newer
d3871 3
a3873 3
So, you may install a system (for example, 5.3-release) from CD, then update
it to 5.3-stable a few times, then upgrade it to 5.4-release from CD, and
update that a few times before upgrading it again to the 5.5-release.
d3889 2
a3890 2
5.5-current (or a snapshot), then decide you are living too dangerously, and
step back to 5.5-stable. You are on your own if you choose any path other than
d4018 1
a4018 1
        # cvs -d$CVSROOT checkout -rOPENBSD_5_5 -P src
d4020 1
a4020 1
    This will pull the src files from the OPENBSD_5_5 branch, which is also
d4026 1
a4026 1
        # cvs -d$CVSROOT up -rOPENBSD_5_5 -Pd
d4029 1
a4029 1
    system, so you don't have to remember the "-rOPENBSD_5_5" part of the
d4041 1
a4041 1
    # cvs -d$CVSROOT checkout -rOPENBSD_5_5 -P src ports xenocara
d4132 1
a4132 1
    can use CVS. For example, to see the changes between 5.3 and 5.4 do a:
d4135 1
a4135 1
        # cvs diff -u -rOPENBSD_5_4 -rOPENBSD_5_5
d4137 1
a4137 1
    To see the changes between 5.5 and -current ("HEAD"), use:
d4140 1
a4140 1
        # cvs diff -u -rOPENBSD_5_5 -rHEAD
d4601 1
a4601 1
    OpenBSD 5.5 (GENERIC) #276: Wed Mar  5 09:57:06 MST 2014
d4660 1
a4660 1
    OpenBSD 5.5 (GENERIC) #276: Wed Mar  5 09:57:06 MST 2014
d4798 2
a4799 2
which can use either the checked-out source tree or pre-made etc55.tgz and
xetc55.tgz files.
a4857 1
  * 6.5 - Point to Point Protocol
d5224 2
a5225 2
  * Replacing the one of several similar cards with a different type: Let's
    assume you have a machine with fxp0, fxp1 and fxp2, and fxp0 fails.
d5262 7
a5268 6
    First thing to note is that ifconfig(8) will tell you both the MAC address
    and the link status of each port. So first trick might be to mark add-in
    cards with their MAC addresses. Second trick in a confused situation can
    be to simply attach ONE unknown NIC to a switch port at a time, and look
    for which NIC in ifconfig(8) is now showing a link. Once you have a few
    ports identified, you will often figure out the rest quickly.
a5396 178
6.5 - PPP

The Point to Point Protocol (PPP) is generally what is used to create a
connection to your ISP via a dial-up modem. OpenBSD has 2 ways of doing this:

  * pppd(8) - the kernel PPP daemon
  * ppp(8) - the userland PPP daemon

Both ppp and pppd perform similar functions, in different ways. pppd works
with the kernel ppp(4) driver, whereas ppp works in userland with tun(4). This
document will cover only the userland PPP daemon, since it is easier to debug
and to interact with. To start off you will need some simple information about
your ISP. Here is a list of helpful information that you will need.

  * Your ISP's dial-up number
  * Your nameserver
  * Your username and password
  * Your gateway

Some of these you can do without, but would be helpful in setting up ppp. The
userland PPP daemon uses the file /etc/ppp/ppp.conf as its configuration file.
There are many helpful files in /etc/ppp that can have different setups for
many different situations. You should take a browse through that directory.

Initial Setup - for PPP(8)

Initial Setup for the userland PPP daemon consists of editing your /etc/ppp/
ppp.conf file. This file doesn't exist by default, but there is a file /etc/
ppp/ppp.conf.sample which you can simply edit to create your own ppp.conf
file. Here I will start with the simplest and probably most used setup. Here
is a quick ppp.conf file that simply sets some defaults:

    default:
      set log Phase Chat LCP IPCP CCP tun command
      set device /dev/cua01
      set speed 115200
      set dial "ABORT BUSY ABORT NO\\sCARRIER TIMEOUT 5 \"\" AT OK-AT-OK ATE1Q0 OK \\dATDT\\T TIMEOUT 40 CONNECT"

The section under the default: tag gets executed each time. Here we set up all
our critical information. With "set log" we set our logging levels. This can
be changed: refer to ppp(8) for more info on setting up logging levels. Our
device gets set with "set device". This is the device that the modem is on. In
this example the modem is on com port 2. Therefore com port 1 would be /dev/
cua00. With "set speed" we set the speed of our dial-up connection and with
"set dial" we set our dial-up parameters. With this we can change our timeout
time, etc. This line should stay pretty much as it is though.

Now we can move on and set up information specific to our ISP. We do this by
adding another tag under our default: section. This tag can be called anything
you want - easiest to just use the name of your ISP. Here I will use myisp: as
our tag referring to our ISP. Here is a simple setup incorporating all we need
to get ourselves connected:

    myisp:
      set phone 1234567
      set login "ABORT NO\\sCARRIER TIMEOUT 5 ogin:--ogin: ppp word: ppp"
      set timeout 120
      set ifaddr 10.0.0.1/0 10.0.0.2/0 255.255.255.0 0.0.0.0
      add default HISADDR
      enable dns

Here we have set up essential info for that specific ISP. The first option
"set phone" sets your ISP's dial-up number. The "set login" sets our login
options. Here we have the timeout set to 5; this means that we will abort our
login attempt after 5 seconds if no carrier is found. Otherwise it will wait
for "login:" to be sent and send in your username and password.

In this example our Username = ppp and Password = ppp. These values will need
to be changed. The line "set timeout" sets the idle timeout for the entire
connection duration to 120 seconds. The "set ifaddr" line is a little tricky.
Here is a more extensive explanation.

    set ifaddr 10.0.0.1/0 10.0.0.2/0 255.255.255.0 0.0.0.0

In the above line, we have it set in the format of "set ifaddr [myaddr[/nn]
[hisaddr[/nn] [netmask [triggeraddr]]]]". So the first IP specified is what we
want as our IP. If you have a static IP address, you set it here. In our
example we use /0 which says that no bits of this IP address need to match and
the whole thing can be replaced. The second IP specified is what we expect as
their IP. If you know this you can specify it. Again in our line we don't know
what will be assigned, so we let them tell us. The third option is our
netmask, here set to 255.255.255.0. If triggeraddr is specified, it is used in
place of myaddr in the initial IPCP negotiation. However, only an address in
the myaddr range will be accepted. This is useful when negotiating with some
PPP implementations that will not assign an IP number unless their peer
requests ``0.0.0.0''.

The next option used "add default HISADDR" sets our default route to their IP.
This is 'sticky', meaning that if their IP should change, our route will
automatically be updated. With "enable dns" we are telling our ISP to
authenticate our nameserver addresses. Do NOT do this if you are running a
local DNS, as ppp will simply circumvent its use by entering some nameserver
lines in /etc/resolv.conf.

Instead of traditional login methods, many ISPs now use either CHAP or PAP
authentication. If this is the case, our configuration will look slightly
different:

    myisp:
      set phone 1234567
      set authname ppp
      set authkey ppp
      set login
      set timeout 120
      set ifaddr 10.0.0.1/0 10.0.0.2/0 255.255.255.0 0.0.0.0
      add default HISADDR
      enable dns

In the above example, we specify our username (ppp) and password (ppp) using
authname and authkey, respectively. There is no need to specify whether CHAP
or PAP authentication is used - it will be negotiated automatically. "set
login" merely specifies to attempt to log in, with the username and password
previously specified.

Using PPP(8)

Now that we have our ppp.conf file set up we can start trying to make a
connection to our ISP. I will detail some commonly used arguments with ppp:

  * ppp -auto myisp - This will run ppp, configure your interfaces and connect
    to your ISP and then go into the background.
  * ppp -ddial myisp - This is similar to -auto, but if your connection is
    dropped it will try and reconnect.

If the above fails, try running /usr/sbin/ppp with no options - it will run
ppp in interactive mode. The options can be specified one by one to check for
error or other problems. Using the setup specified above, ppp will log to /var
/log/ppp.log. That log, as well as the man page, all contain helpful
information.

ppp(8) extras

In some situations you might want commands executed as your connection is made
or dropped. There are two files you can create for just these situations: /etc
/ppp/ppp.linkup and /etc/ppp/ppp.linkdown. Sample configurations can be viewed
here:

  * ppp.linkup
  * ppp.linkdown

ppp(8) variations

Many ISPs now offer xDSL services, which are faster than traditional dial-up
methods. This includes variants such as ADSL and SDSL. Although no physical
dialing takes place, connection is still based on the Point to Point Protocol.
Examples include:

  * PPPoE
  * PPPoA
  * PPTP

PPPoE/PPPoA

The Point to Point Protocol over Ethernet (PPPoE) is a method for sending PPP
packets in Ethernet frames. The Point to Point Protocol over ATM (PPPoA) is
typically run on ATM networks, such as those found in the UK and Belgium.

Typically this means you can establish a connection with your ISP using just a
standard Ethernet card and Ethernet-based DSL modem (as opposed to a USB-only
modem).

If you have a modem which speaks PPPoE/PPPoA, it is possible to configure the
modem to do the connecting. Alternatively, if the modem has a `bridge' mode,
it is possible to enable this and have the modem "pass through" the packets to
a machine running PPPoE software (see below).

The software interface to act as a client to connect to PPPoE on OpenBSD is
pppoe(4). OpenBSD can also handle the server side of PPPoE with npppd(8).

PPTP

The Point to Point Tunneling Protocol (PPTP) is a proprietary Microsoft
protocol. A pptp client is available which interfaces with pppd(8) and is
capable of connecting to the PPTP-based Virtual Private Networks (VPN) used by
some cable and xDSL providers. pptp itself must be installed from packages or
ports. Further instructions on setting up and using pptp are available in the
man page which is installed with the pptp package.

d5864 1
a5864 1
    OpenBSD 5.5 (RAMDISK_CD) #229: Wed Mar  5 10:13:54 MST 2014
a6337 1

d6678 1
a6678 1
disconnection, in either case the programs survive and continue running as
d6771 2
a6772 2
page. In this case the "new-window" command is needed. Each command has a
shorthand alias which may be used instead of typing the full name, for
d6924 5
a6928 8
the Ctrl-b " key combination. A pane can be resized up or down with Ctrl-b
Alt-Up and Ctrl-b Alt-Down and the active pane changed with Ctrl-b o. In
addition, a window split in that way may be changed into one of a number of
fixed layouts, these are cycled through with Ctrl-b Space but panes in one of
these layouts may not be resized. In -current, splitting has been extended to
support horizontal splitting (Ctrl-b %) and the fixed layouts changed so they
are applied once (with the same Ctrl-b Space key strokes) but then may be
freely resized and modified both horizontally and vertically.
d7075 1
a7075 1
|Awk      |base55.tgz,|                                                      |
d7080 1
a7080 1
|C, C++   |comp55.tgz,|The C/C++ compilers in the base system have been      |
d7127 1
a7127 1
|Perl     |base55.tgz,|Many Perl modules are available in the ports tree, so |
d7199 1
a7199 1
    OpenBSD 5.5 (GENERIC) #276: Wed Mar  5 09:57:06 MST 2014
d7342 1
a7342 1
    230- OpenBSD 5.5 (GENERIC) #276: Wed Mar  5 09:57:06 MST 2014
d7429 1
a7429 1
    OpenBSD 5.5 (GENERIC) #276: Wed Mar  5 09:57:06 MST 2014
d7491 3
a7493 2
Lynx, a text-based browser, is in the base system, and has SSL support. Other
browsers available include (in no particular order):
d7521 1
d7577 5
a7581 5
The /etc/motd file is edited upon every boot of the system, replacing
everything up to, but not including, the first blank line with the system's
kernel version information. When editing this file, make sure that you start
after this blank line, to keep /etc/rc from deleting these lines when it edits
/etc/motd upon boot.
d7598 1
a7598 2
such as ftp-proxy, or when sending mail out from a workstation through
sendmail.
d7608 2
a7609 2
sendmail, or ftp-proxy. Unfortunately, in some cases, the machine that is
making the connection does not have a proper reverse DNS entry.
d7743 1
a7743 1
    OpenBSD 5.5 (GENERIC) #276: Wed Mar  5 09:57:06 MST 2014
a7786 1

d7857 1
a7857 2
    and stability. The EXT2 filesystem is supported, but journaled variants
    such as EXT3 or EXT4 are not.
d7901 1
a7901 1
9.2 - Dual booting Linux and OpenBSD
d7903 16
a7918 1
Yes! It is possible!
d7920 1
a7920 1
Read INSTALL.linux.
d7983 1
a7983 1
    # export PKG_PATH=ftp://your.ftp.mirror/pub/OpenBSD/5.5/packages/i386/
d7993 2
a7994 1
OpenBSD supports the EXT2FS file system. For further information, see FAQ 14.
a8008 4
  * 10.4 - Why do users get relaying access denied when they are remotely
    sending mail through my OpenBSD system?
  * 10.6 - Why does Sendmail ignore /etc/hosts?
  * 10.7 - Setting up a Secure HTTP Server using ssl(8)
a8016 1
  * 10.16 - Tell me about chroot(2) web server?
d8123 1
a8123 1
For example, here is the default line pertaining to httpd(8).
d8125 1
a8125 1
    httpd_flags=NO          # for normal use: "" (or "-DSSL" after reading ssl(8))
d8127 4
a8130 5
Here you can see that starting up httpd normally requires no flags, so a line
like httpd_flags="" added to /etc/rc.conf.local will do the job. But to start
httpd with SSL enabled (refer to the SSL FAQ or ssl(8)), you would start with
a line like httpd_flags="-DSSL", though you may need to add other parameters
for other reasons.
d8153 3
a8155 3
Starting with OpenBSD 5.0, system daemons ("services") are started, stopped
and controlled by /etc/rc.d. All system daemons are handled by these scripts,
and most add-in packages are as well.
d8165 6
a8170 7
rc.conf.local file. For example, /etc/rc.d/httpd does not start httpd(8)
unless /etc/rc.conf or /etc/rc.conf.local contains a line defining the
"httpd_flags" variable. To help make sure your system will come up as expected
on the next boot, the rc.d scripts will not run their daemon if the
appropriate variable is not defined. You can, of course, manually invoke /usr/
sbin/httpd directly with whatever options you wish, if you wish to run the
program manually.
d8177 2
a8178 2
For example, our above daemonx application could be started with a /etc/rc.d
file consisting of:
a8196 90
10.4 - Why do users get "relaying denied" when they are remotely sending mail
through my OpenBSD system?

Try this:

    # grep relay-domains /etc/mail/sendmail.cf

The output may look something like this:

    FR-o /etc/mail/relay-domains

If this file doesn't exist, create it. You will need to enter the hosts who
are sending mail remotely with the following syntax:

    .domain.com    #Allow relaying for/to any host in domain.com
    sub.domain.com #Allow relaying for/to sub.domain.com and any host in that domain
    10.2           #Allow relaying from all hosts in the IP net 10.2.*.*

Don't forget send a 'HangUP' signal to sendmail (a signal which causes most
daemons to re-read their configuration file):

    # kill -HUP `head -1 /var/run/sendmail.pid`

Further Reading

  * http://www.sendmail.org/~ca/email/relayingdenied.html
  * http://www.sendmail.org/tips/relaying.php
  * http://www.sendmail.org/antispam/

10.6 - Why does Sendmail ignore the /etc/hosts file?

By default, Sendmail uses DNS for name resolution, not the /etc/hosts file.
The behavior can be changed through the use of the /etc/mail/service.switch
file.

If you wish to query the hosts file before DNS servers, create a /etc/mail/
service.switch file which contains the following line:

    hosts       files dns

If you wish to query ONLY the hosts file, use the following:

    hosts       files

Send Sendmail a HUP signal:

    # kill -HUP `head -1 /var/run/sendmail.pid`

and the changes will take effect.

10.7 - Setting up a Secure HTTP server with SSL(8)

OpenBSD ships with an SSL-ready httpd and RSA libraries. For use with httpd
(8), you must first have a certificate created. This will be kept in /etc/ssl/
with the corresponding key in /etc/ssl/private/. The steps shown here are
taken in part from the ssl(8) man page. Refer to it for further information.
This FAQ entry only outlines how to create an RSA certificate for web servers,
not a DSA server certificate. To find out how to do so, please refer to the
ssl(8) man page.

To start off, you need to create your server key and certificate using
OpenSSL:

    # openssl genrsa -out /etc/ssl/private/server.key 2048

Or, if you wish the key to be encrypted with a passphrase that you will have
to type in when starting servers

    # openssl genrsa -aes256 -out /etc/ssl/private/server.key 2048

The next step is to generate a Certificate Signing Request which is used to
get a Certifying Authority (CA) to sign your certificate. To do this use the
command:

    # openssl req -new -key /etc/ssl/private/server.key -out /etc/ssl/private/server.csr

This server.csr file can then be given to Certifying Authority who will sign
the key. One such CA is Thawte Certification which you can reach at http://
www.thawte.com/.

If you cannot afford this, or just want to sign the certificate yourself, you
can use the following.

    # openssl x509 -sha256 -req -days 365 -in /etc/ssl/private/server.csr \
           -signkey /etc/ssl/private/server.key -out /etc/ssl/server.crt

With /etc/ssl/server.crt and /etc/ssl/private/server.key in place, you should
be able to start httpd(8) with the -DSSL flag (see the section about rc(8) in
this faq), enabling https transactions with your machine on port 443.

d8526 1
a8526 1
    Set the password so that user cannot logon? (y/n) [n]: y
d8693 19
a8711 19
Patches for the OpenBSD Operating System are distributed as "Unified diffs",
which are text files that hold differences to the original source code. They
are NOT distributed in binary form. This means that to apply a patch you must
have the source code from the RELEASE version of your system available. In
general, it is advisable to acquire the entire source tree before applying a
patch. If you are running a release from an official CDROM, the source trees
are available as files on disk 3, these can also be downloaded from the FTP
servers. We will assume you have the entire tree checked out.

For our example here, we will look at patch 001 for OpenBSD 3.6 dealing with
the st(4) driver, which handles tape drives. Without this patch, recovering
data from backups was quite difficult. People using a tape drive needed this
patch, however those without a tape drive may have had no particular need to
install it. Let's look at the patch:

    # more 001_st.patch
    Apply by doing:
            cd /usr/src
            patch -p0 < 001_st.patch
d8713 1
a8713 1
    Rebuild your kernel.
d8715 1
a8715 1
    Index: sys/scsi/st.c
d8717 19
a8735 14
    RCS file: /cvs/src/sys/scsi/st.c,v
    retrieving revision 1.41
    retrieving revision 1.41.2.1
    diff -u -p -r1.41 -r1.41.2.1
    --- sys/scsi/st.c       1 Aug 2004 23:01:06 -0000       1.41
    +++ sys/scsi/st.c       2 Nov 2004 01:05:50 -0000       1.41.2.1
    @@@@ -1815,7 +1815,7 @@@@ st_interpret_sense(xs)
            u_int8_t skey = sense->flags & SSD_KEY;
            int32_t info;

    -       if (((sense->flags & SDEV_OPEN) == 0) ||
    +       if (((sc_link->flags & SDEV_OPEN) == 0) ||
                (serr != 0x70 && serr != 0x71))
                    return (EJUSTRETURN); /* let the generic code handle it */
d8738 3
a8740 2
it. We will assume you have put this patch into the /usr/src directory, in
which case, the following steps are used:
d8742 2
a8743 2
    # cd /usr/src
    # patch -p0 < 001_st.patch
a8746 3
    |Apply by doing:
    |        cd /usr/src
    |        patch -p0 < 001_st.patch
d8748 6
a8753 1
    |Rebuild your kernel.
d8755 6
a8760 1
    |Index: sys/scsi/st.c
d8762 5
a8766 6
    |RCS file: /cvs/src/sys/scsi/st.c,v
    |retrieving revision 1.41
    |retrieving revision 1.41.2.1
    |diff -u -p -r1.41 -r1.41.2.1
    |--- sys/scsi/st.c      1 Aug 2004 23:01:06 -0000       1.41
    |+++ sys/scsi/st.c      2 Nov 2004 01:05:50 -0000       1.41.2.1
d8768 2
a8769 2
    Patching file sys/scsi/st.c using Plan A...
    Hunk #1 succeeded at 1815.              <-- Look for this message!
d8774 1
a8774 1
involve multiple hunks and multiple files, in which case, you should verify
d8788 1
a8788 1
the patch, and if uncertain, rebuild the entire system.
d8791 1
a8791 1
usually. For example, if you did not have a tape drive on your system, you
d8795 1
a8795 185
you apply, and if in doubt, apply them all, in order.

10.16 - Tell me about this chroot(2) web server?

In OpenBSD, the Apache httpd(8) and nginx(8) web servers have been chroot(2)ed
by default. While this is a tremendous boost to security, it can create
issues, if you are not prepared.

What is a chroot?

A chroot(2)ed application is locked into a particular directory and unable to
wander around the rest of the directory tree, and sees that directory as its "
/" (root) directory. In the case of the web servers, the program starts, opens
its log files, binds to its TCP ports (though, it doesn't accept data yet),
and reads its configuration. Next, it locks itself into /var/www and drops
privileges, then starts to accept requests. This means all files served and
used by web server must be in the /var/www directory. In the default
configuration of OpenBSD, all the files in the /var/www directory are
read-only by the user the web server runs as, www. This helps security
tremendously -- should there be a security issue with the web server, the
damage will be confined to a single directory with only "read only"
permissions and no resources to cause mischief with.

What does this mean to the administrator?

Put bluntly, chroot(2)ing web servers is something not done by default in most
other operating systems. Many applications and system configurations will not
work in a chroot(2) without some customization. Further, it must be remembered
that security and convenience are often not compatible goals.

  * Historic file system layouts: Layouts from other systems may have web
    files located in user's directories, which clearly won't work in a chroot
    (2)ed environment, as the web server can't reach the /home directory.
    Administrators may also discover their existing /var/www partition is too
    small to hold all web files. Your options are to restructure or do not use
    the chroot(2) feature. You can, of course, use symbolic links in the
    user's home directories pointing to subdirectories in /var/www, but you
    can NOT use links in /var/www pointing to other parts of the file system
    -- that is prevented from working by the chroot(2)ing. Note that if you
    want your users to have chroot(2)ed FTP access, this will not work, as the
    FTP chroot will (again) prevent you from accessing the targets of the
    symbolic links. A solution to this is to not use /home as your home
    directories for these users, rather use something similar to /var/www/
    users. Symbolic links can be used completely within the chroot(2), but
    they have to be relative, not absolute.
  * Log Rotation: Normally, logs are rotated by renaming the old files, then
    sending the server a SIGUSR1 signal to cause it to close its old log files
    and open new ones. This is no longer possible, as the server has no
    ability to open log files for writing once privileges are dropped. So, the
    server must be stopped and restarted. There are also other strategies
    available, including logging to a pipe(2), and using an external log
    rotator at the other end of the pipe(2).
  * Existing Apache modules: Virtually all will load, however some may not
    work properly in chroot(2), and many have issues on "apachectl restart",
    generating an error, which causes httpd(8) to exit.
  * Existing CGIs: Most will NOT work as is. They may need programs or
    libraries outside /var/www. Some can be fixed by compiling so they are
    statically linked (not needing libraries in other directories), most may
    be fixed by populating the /var/www directory with the files required by
    the application, though this is non-trivial and requires some knowledge of
    the program.
  * File system mount options: By default in OpenBSD, your /var partition will
    be mounted with the nosuid and nodev options. If you attempt to use an
    application within the chroot, you may need to change those options. You
    may need to do that even if you don't use the chroot option, of course.
  * Name Resolution: Web servers inside the chroot(2) will NOT be able to use
    the system /etc/hosts or /etc/resolv.conf. Therefore, if you have
    applications which require name resolution, you will need to populate /var
    /www/etc/hosts and/or /var/www/etc/resolv.conf in the chroot(2)
    environment. Note that some applications expect the resolution of
    "localhost" to work.
  * Timezone: Web servers inside the chroot(2) will NOT be able to use the
    system /etc/localtime. If you require localtime logging of events, you
    will need to copy (not link) the corresponding timezone from /usr/share/
    zoneinfo/ under /var/www/etc/localtime.

In some cases, the application or configuration can be altered to run within
the chroot(2). In other cases, you will simply have to disable this feature
using the -u option for httpd(8) or nginx(8) in /etc/rc.conf.local.

Example of chroot(2)ing an app: wwwcount with httpd(8)

As an example of a process that can be used to chroot an application, we will
look at wwwcount, a simple web page counter available through packages. While
a very effective program, it knows nothing about chroot(2)ed Apache, and will
not work chroot(2)ed in its default configuration.

First, we install the wwwcount package. We configure it and test it, and we
find it doesn't seem to work, we get an Apache message saying "Internal Server
Error". First step is to stop and restart Apache with the -u switch to verify
that the problem is the chroot(2)ing, and not the system configuration.

    # apachectl stop
    /usr/sbin/apachectl stop: httpd stopped
    # httpd -u

After doing this, we see the counter works properly, at least after we change
the ownership on a directory so that Apache (and the CGIs it runs) can write
to the files it keeps. So, we definitely have a chroot problem, so we stop and
restart Apache again, using the default chrooting:

    # apachectl stop
    /usr/sbin/apachectl stop: httpd stopped
    # httpd

A good starting point would be to assume wwwcount uses some libraries and
other files it can't get to in the chroot. We can use the ldd(1) command to
find out the dynamic object dependencies that the CGI needs:

    # cd /var/www/cgi-bin/
    # ldd Count.cgi
    Count.cgi:
            Start    End      Type Open Ref GrpRef Name
            1c000000 3c007000 exe  1    0   0      /var/www/cgi-bin/Count.cgi
            0c085000 2c0be000 rlib 0    1   0      /usr/lib/libc.so.57.0
            08713000 08713000 rtld 0    1   0      /usr/libexec/ld.so

Ok, here is a problem, two files that are not available in the chroot(2)
environment. So, we copy them over:

    # mkdir -p /var/www/usr/lib /var/www/usr/libexec
    # cp /usr/lib/libc.so.57.0 /var/www/usr/lib
    # cp /usr/libexec/ld.so /var/www/usr/libexec

and try the counter again.

Well, now the program is running at least, and giving us error messages
directly: "Unable to open config file for reading". Progress, but not done
yet. The configuration file is normally in /var/www/wwwcount/conf, but within
the chroot environment, that would seem to be /wwwcount/conf. Our options are
to either recompile the program to make it work where the files are now, or
move the data files. As we installed from a package, we'll just move the data
file. In order to use the same config either chroot(2)ed or not, we'll use a
symbolic link:

    # mkdir -p /var/www/var/www
    # cd /var/www/var/www
    # ln -s ../../wwwcount wwwcount

Note that the symbolic link is crafted to work within the chroot. Again, we
test... and we find we have yet another issue. Now wwwcount is complaining
that it can't find the "strip image" files it uses to display messages. After
a bit of searching, we find those are stored in /usr/local/lib/wwwcount, so we
have to copy those into the chroot, as well.

    # tar cf - /usr/local/lib/wwwcount | (cd /var/www; tar xpf - )

we test again... and it works!

Note that we have copied over only files that are absolutely required for
operation. In general, only the minimum files needed to run an application
should be copied into the chroot.

Should I use the chroot feature?

In the above example, the program is fairly simple, and yet we have seen
several different kinds of problems.

Not every application can or should be chroot(2)ed.

The goal is a secure web server, chroot(2)ing is just a tool to accomplish
this, it is not the goal itself. Remember, the starting configuration of the
OpenBSD chroot(2)ed Apache is where the user the httpd(8) program is running
as can not run any programs, can not alter any files, and can not assume
another user's identity. Loosen these restrictions, you have lessened your
security, chroot or no chroot.

Some applications are pretty simple, and chroot(2)ing them makes sense. Others
are very complex, and are either not worth the effort of forcing them into a
chroot(2), or by the time you copy enough of the system into the chroot, you
have lost the benefit of the chroot(2) environment. For example, the
OpenWebMail program requires the ability to read and write to the mail
directory, the user's home directory, and must be able to work as any user on
the system. Attempting to push it into a chroot would be completely pointless,
as you would end up disabling all the benefits of chroot(2)ing. Even with an
application as simple as the above counter, it must write to disk (to keep
track of its counters), so some benefit of the chroot(2) is lost.

Any application which has to assume root privileges to operate is pointless to
attempt to chroot(2), as root can generally escape a chroot(2).

Do not forget, if the chrooting process for your application is too difficult,
you may not upgrade or update the system as often as you should. This could
end up making your system LESS secure than a more maintainable system with the
chroot feature deactivated.
d8904 1
a8904 2
cases, passing YP traffic through SSL or IPSec tunnels might be an option, or
you might consider combining YP with kerberos(8) authentication.
d9197 5
a9201 5
example, one could have an application (the X client) running on an mvme88k,
displaying its output on an alpha's graphical display (the X server). Since X
is a well-defined, cross-platform protocol, it is even possible to have an X
application running on (for example) a Solaris machine use an OpenBSD machine
for its display.
d9258 2
a9259 1
Set machdep.allowaperture=2 in /etc/sysctl.conf.
d9276 2
a9277 1
Set machdep.allowaperture=2 in /etc/sysctl.conf.
a9333 8
11.2.11 - mvme68k

No X servers, only X clients.

11.2.12 - mvme88k

No X servers, only X clients.

a9519 1
  * 12.6 - HP 9000 series 300, 400
a9532 2
  * 12.12 - MVME68k
  * 12.13 - MVME88k
a9536 2
      + 12.16.2 - I'm getting "partition extends past end of unit" messages in
        disklabel
a9736 7
For 5.4, this was called the "beagle" platform, but for 5.5 and later
releases, this platform has been renamed "armv7". This platform is being
actively improved; running -current is highly recommended.

Being this platform is still very much in a state of flux, this article will
reflect the state of -current rather than the current release.

a9791 4
12.6 - HP300

[nothing yet]

d9809 13
a9821 12
This is an excellent performing ISA NIC, supported by the ep(4) driver. The
'B' version can be distinguished from the non-B version by labeling on the
card and by the larger "main" chip on the board (approximately 2.5cm on a side
for the 'B' version, vs. 2cm on a side on the older version), and will provide
better performance on a loaded or dual network card system. The 3C509B ships
configured in a PNP mode, which unfortunately does not comply with standards,
and causes problems in OpenBSD's isapnp(4) support. The adapter is picked up
first as a non-PNP device, then again after the PNP support comes on-line,
resulting in an extra NIC showing in the dmesg. This may work fine, or it may
cause other problems. It is highly recommended that the 3C509B cards have PNP
mode disabled and manually configured to non-conflicting settings using the
3Com DOS-based configuration utilities before configuration.
d9839 2
a9840 2
well, many of the currently-available ones perform poorly. NE2000-compatibles
are supported by the ne(4) driver in OpenBSD.
d9857 1
a9857 1
Configuration (UKC) or by building a customized kernel.
d9875 1
a9875 1
just too slow and rarely had enough RAM and a required FPU to run OpenBSD.
d9879 3
a9881 4
The 80486SX chip was a "low-cost" version of the 80486, which lacked the
hardware floating point support (like the 80386) OpenBSD requires.
Fortunately, full 80486DX chips are fairly available, and is an easy upgrade
in most systems.
a9964 8
12.12 - MVME68k

[nothing yet]

12.13 - MVME88k

[nothing yet]

a9979 27
12.16.2 - I'm getting "partition extends past end of unit" messages in
disklabel

On sparc and sparc64 systems, the BSD disklabel cannot describe a disk
geometry larger than 8GB, while individual disklabel entries can be larger.

Every time you run disklabel(8), it performs some sanity checks of the
disklabel entries against what it thinks is the correct drive geometry, and
since it sees a truncated geometry, it warns and will not let you edit entries
outside this 8GB area unless you tell it to use the real drive geometry. Do
this using the 'g' command of the command-driven editor of disklabel(8) and
tell it to use the "[d]isk geometry":

    # disklabel -E wd0
    # Inside MBR partition 3: type A6 start 63 size 17912412
       [...]
    Initial label editor (enter '?' for help at any prompt)
    > g
    [d]isk, [b]ios, or [u]ser geometry: [d] d
    > w
    > q

You will still get the warning messages, but you can configure and use your
disk as desired. A proper solution would have to be compatible with existing
systems already in use, plus be compatible with Solaris running on disks
larger than 8GB, but this has not been worked out yet.

d10548 1
a10548 1
It shows three MIDI ports, corresponding to:
d10550 2
a10551 2
  * /dev/rmidi0 - synthesizer connected by USB
  * /dev/rmidi1 - a MIDI master keyboard
d10553 4
a10556 3
These devices are known by sndio(7) as rmidi/0 and rmidi/1. To test your MIDI
keyboard, you can use the hexdump(1) utility to display MIDI data you're
playing on it:
d10558 1
a10558 1
    $ aucat -Mq rmidi/1 -o - | hexdump -e '1/1 "%02x\n"'
d10567 1
a10567 1
    $ aucat -M -q rmidi/0 -q rmidi/1
a10569 1
Refer to the aucat(1) manual page for further information.
d10576 7
d11109 3
d11115 1
a11115 1
  * 14.9 - Installing Bootblocks - i386/amd64 specific
d11128 2
d11133 4
d11848 1
a11848 1
    OpenBSD 5.5 (GENERIC) #276: Wed Mar  5 09:57:06 MST 2014
d12027 1
a12027 1
14.9 - Installing Bootblocks - i386/amd64 specific
d12034 5
a12038 5
just put a boot CDROM in your drive (or use a boot floppy) and at the boot
prompt, type "boot hd0a:/bsd" to force it to boot from the first hard disk
(and not the CD or floppy). Your machine should come up normally. You now need
to reinstall the first-stage boot loader (biosboot(8)) based on the position
of the /boot file, using the installboot(8) program.
d12043 1
a12043 1
    # cd /usr/mdec; ./installboot /boot biosboot sd0
d12045 2
a12046 7
Note that "/boot" is the physical location of the file "boot" you wish to use
when the system boots normally as the system is currently mounted. If your
situation were a little different and you had booted from the CD and mounted
your 'a' partition on /mnt, this would probably be "/mnt/boot" instead.
installboot(8) does two things here -- it installs the file "biosboot" to
where it needs to be in the Partition Boot Record, and modifies it with the
physical location of the "/boot" file.
d12192 4
a12195 4
tape can be a very quick process. The standard OpenBSD install/boot floppy
already contains the required restore utility as well as the binaries required
to partition and make your new drive bootable. In most cases, this floppy and
your most recent dump tape is all you'll need to get back up and running.
d12239 1
a12239 2
        # cp /usr/mdec/boot /mnt/boot
        # /usr/mdec/installboot -v /mnt/boot /usr/mdec/biosboot sd0
d12381 1
a12381 1
Yes. Other supported filesystems include: ext2 (Linux), ISO9660 and UDF
d12383 1
a12383 1
them have limited, for instance read-only, support.
d13367 1
a13367 1
    $ export PKG_PATH=/mnt/cdrom/5.5/packages/`machine -a`/
d13371 1
a13371 1
    $ export PKG_PATH=ftp://your.ftp.mirror/pub/OpenBSD/5.5/packages/`machine -a`/
d13384 1
a13384 1
snapshots, you will replace "5.5" with "snapshots".
d13394 1
a13394 1
  * On the FTP mirror servers. Packages are located in the /pub/OpenBSD/5.5/
d13511 1
a13511 1
    $ sudo pkg_add ftp://ftp.openbsd.org/pub/OpenBSD/5.5/packages/`machine -a`/screen-4.0.3p3.tgz
d13598 1
a13598 1
box from OpenBSD 5.4 to 5.5. Now you can easily upgrade to the newer 5.5
d13770 1
a13770 1
    $ ftp ftp://ftp.openbsd.org/pub/OpenBSD/5.5/ports.tar.gz
d13800 16
a13815 2
    requiring superuser permissions. Just add a line to /etc/mk.conf
    containing
a13816 1
        SUDO=/usr/bin/sudo
d14221 4
a14224 3
package updates until the next release, or until security issues occur which
justify an update of the port in the -stable branch, and of the corresponding
package.
@


1.36
log
@
update text versions
@
text
@d351 1
a351 1
$OpenBSD: index.html,v 1.373 2014/09/17 00:33:42 nick Exp $
d7362 1
a7362 1
|Java     |devel/jdk  |OpenJDK - 1.7 and 1.6 as a package on amd64           |
@


1.35
log
@
keeping txt files on the ftp servers is kinda strange these days, move to
web servers.  Translators: I would not recommend translating this.
@
text
@d8 1
a8 1
OpenBSD, currently v5.4. There are likely features and changes to features
d12 1
a12 2
The FAQ is available in text form in the pub/OpenBSD/doc directory from many
FTP mirrors, along with archival versions.
d14 1
a14 1
Welcome to some of our Favorite Hacks!
d21 1
a21 1
    The first rule of this OS is security
d31 1
a31 1
  * 1.9 - What is new in OpenBSD 5.4?
d37 2
a38 1
    The OpenBSD developers don't play. They hack!
d47 2
a48 1
    The least they could have done is to let us say hello.
d58 1
a58 1
4 - OpenBSD 5.4 Installation Guide
d60 2
a61 1
    I told you today I don't need install instructions. Well, maybe I do.
d82 1
a82 2
    And do you or do you not have trouble following these simple
    instructions?
d98 2
a99 2
    Is it to be at every router that you intend on leading us all through
    this rare and wonderful new world of security?
d117 1
a117 4
    High-res flat monitors that don't make my eyes funny
    Optical mice that don't gather dust bunnies
    Keyboards that go clickity-click and use springs,
    These are a few of my favorite things!
d132 1
a132 1
    I wonder what grass tastes like
d157 4
a160 1
    Joining us is quite thinkable!
d171 1
a171 1
    There's nothing wrong with the operating system. Only the administrator.
a177 2
  * 10.5 - I've set up POP, but I get errors when accessing my mail through
    POP. What can I do?
a184 1
  * 10.12 - Setting up KerberosV Clients and Servers
d188 1
a188 1
  * 10.16 - Tell me about chroot(2) Apache?
d196 2
a197 1
    Some people would call that GUI!
d206 1
a206 1
    When the administrator removes windows, he sometimes closes a hole!
d230 1
a230 1
    You brought music back into the computer. I had forgotten.
d249 1
a249 1
    The disks are alive with the sound of seeking.
d274 2
a275 1
    We more than pretend to work with these apps
d286 2
a287 1
    These firewalls were meant to keep out problems.
a299 1
      + Packet Queueing and Prioritization
d315 1
a315 1
    How do you solve a problem like ...
d329 3
d337 1
a337 2
  * FAQ updated for 5.4
  * Disklabel Unique Identifiers -- new
a344 3
For information about and assisting in the translation of the FAQ and the
rest of the OpenBSD website, see the translation page.

d351 2
a352 3
$OpenBSD: index.html,v 1.365 2014/02/14 15:31:15 nick Exp $
I have had people walk out on me before, but not... when I was being so
charming.
d371 1
a371 1
  * 1.9 - What is new in OpenBSD 5.4?
d384 1
a384 1
5.4.
d388 1
a388 1
OpenBSD 5.4 runs on the following platforms:
d392 1
d394 2
a395 2
  * armv7 - Download only (NEW for 5.4!) (renamed from "beagle" after 5.4-rel)
  * hp300 - Download only
d399 2
a400 1
  * loongson - Available on CD
d402 3
a404 3
  * mvme68k - Download only
  * mvme88k - Download only
  * octeon - Download only (NEW for 5.4!)
d554 2
a555 2
  * GCC versions 4.2.1, 3.3.6 or 2.95.3 (depending on your platform) GNU C
    Compiler. Installed as part of the comp54.tgz file set.
d560 2
a561 1
  * Nginx 1.4.1 web server, with patches.
d563 2
a564 2
  * SQLite 3.7.17, with patches and improvements from the OpenBSD team.
  * Sendmail 8.14.7 mail server, with libmilter.
d566 3
a568 2
    improvements in chroot operation and other security-related issues.
  * NSD 3.2.15 authoritative DNS server.
d578 2
a579 2
  * OpenSSH 6.3
  * OpenSMTPD Secure, simple and reliable Mail Transport Agent (MTA).
d593 1
a593 1
1.9 - What is new in OpenBSD 5.4?
d595 2
a596 2
The complete list of changes made to OpenBSD 5.3 to create OpenBSD 5.4 can be
found on plus54.html, and highlights on the OpenBSD 5.4 Information page,
d598 1
a598 1
warrant some special note to people upgrading or installing OpenBSD 5.4 who
d601 2
a602 8
  * New platforms: beagle (renamed "armv7" post 5.4) and octeon:
    These are both low-power small system platforms. As both platforms are new
    and are being actively developed and improved (and in the case of beagle,
    renamed!), running -current is advised.
  * inteldrm(4) overhaul:
    Improved device support is the big benefit, but many users will notice the
    their console output is now using the framebuffer instead of the
    traditional 80x25 text mode.
d606 16
a621 5
  * Official CD sets: More platforms, fewer packages:
    To improve the utility of the CD sets, more platforms are included on the
    three CDs, but only a few very commonly used utility packages (such as
    rsync, unzip, bzip2) are shipped on the disk now. Of course, the rest can
    be downloaded from your favorite mirror.
d663 1
a663 1
  * Why is Apache included? It isn't needed by many people!
d667 2
a668 2
    modern web servers are encouraged to look at nginx(8) which will hopefully
    be replacing Apache in base.
d694 1
a695 2
------------------------------------------------------------------------------
$OpenBSD: faq1.html,v 1.134 2014/03/02 18:05:43 nick Exp $
d803 1
a803 1
To access the manual pages, be sure that you installed the man54.tgz file set.
d841 1
a841 1
cgi-bin/man.cgi as well as on your computer if you install the man54.tgz file
d1236 1
a1237 2
------------------------------------------------------------------------------
$OpenBSD: faq2.html,v 1.117 2013/11/01 14:05:56 nick Exp $
d1297 2
a1298 2
install54.iso) and "boot only" (for installing from a network file source,
named cd54.iso) ISOs are provided for these platforms.
a1303 6
However, ISO file installation is NOT the optimum installation method for many
people. It is still usually faster and simpler to download the boot media and
then install just the portions needed. However, for those who wish to do a
number of installations, or can not figure out how to drop ten files on a
CD-ROM or set up a local HTTP/FTP server, ISOs are available.

d1315 4
a1318 5
For those that need a bootable CD for their system, bootdisk ISO images (named
cd54.iso) are available for a number of platforms which will then permit the
rest of the system to be installed via HTTP/FTP. These ISO images are only a
few megabytes in size, and contain just the installation tools, not the actual
file sets.
d1339 3
a1341 1
  $ sha256 -c SHA256
d1343 6
a1348 3
The OpenBSD project does not digitally sign releases. The above command only
detects accidental damage, not malicious tampering. If the men in black suits
are out to get you, they're going to get you.
d1458 1
a1459 2
------------------------------------------------------------------------------
$OpenBSD: faq3.html,v 1.83 2013/11/01 22:59:01 deraadt Exp $
d1462 1
a1462 1
4 - OpenBSD 5.4 Installation Guide
d1497 1
a1497 2
      + 4.13.4 - I got the message "Failed to change directory" when doing an
        install
d1500 2
a1501 1
      + 4.13.7 - I got an SHA256 mismatch during install!
d1535 1
a1535 1
    names are floppy54.fs, though several platforms have multiple floppy
d1537 2
a1538 2
  * CD-ROM: On several platforms a CD-ROM image (cd54.iso for just booting, or
    install54.iso for the entire install) is provided allowing creation of a
d1545 6
a1550 3
    can be written to an existing partition, and then can be booted.
  * Bootable Tape: Some platforms support booting from tape. These tapes can
    be made following the INSTALL.platform instructions.
d1555 1
a1555 1
  * amd64: Floppy, CD-ROM, network.
d1561 1
a1561 1
  * i386: Floppy, CD-ROM, network.
d1564 1
a1564 1
  * luna88k: Network, tape.
d1566 2
a1567 2
  * mvme68k: Network, bootable tape.
  * mvme88k: Network, bootable tape.
d1571 1
a1571 2
  * sparc: Floppy, CD-ROM, network, writing image to existing swap partition,
    bootable tape.
d1583 1
a1583 1
    also use install54.iso or you can make your own.
a1593 2
  * Tape: File sets can also be read from a supported tape. Details on
    creating the tape are in the INSTALL.platform document.
d1627 7
d1637 1
a1637 1
The i386 platform has six separate installation disk images to choose from:
d1639 1
a1639 1
  * cd54.iso is an ISO9660 image that can be used to create a bootable CD with
d1643 1
a1643 5
  * cdemu54.iso is an ISO9660 image, using "floppy emulation" booting, using a
    2.88M floppy image. It is hoped that few people will need this image --
    most people will use cd54.iso; only use cdemu54.iso if cd54.iso doesn't
    work for you.
  * install54.iso is an ISO9660 image, containing all the standard install
d1646 1
a1646 1
  * floppy54.fs (Desktop PC) supports many PCI and ISA NICs, IDE, SATA and
d1649 1
a1649 1
  * floppyB54.fs (Servers) supports many RAID controllers, and some of the
d1652 1
a1652 1
  * floppyC54.fs (Laptops) supports the CardBus and PCMCIA devices found in
d1654 6
d1663 2
a1664 2
  * floppy54.fs supports systems with a floppy disk.
  * cd54.iso is an ISO image usable to make your own CD for booting SPARC
d1666 2
a1667 2
  * miniroot54.fs can be written to a swap partition and booted.
  * install54.iso is an ISO9660 image, containing all the standard install
d1671 4
a1674 5
On modern platforms, you are best advised to use the CDROM boot images, as in
some of the "bigger" platforms (such as amd64, sparc64), the floppy images
have had to have a lot of drivers and utilities cut out, which can make
installation much more difficult. Older platforms, such as i386 and sparc, are
still quite installable from floppy.
d1678 1
a1678 1
You can create a CD-ROM using the cd54.iso or install54.iso files. The exact
d1680 2
a1681 1
their disposal.
d1685 1
a1685 1
  # cdio tao cd54.iso
d1712 1
a1712 1
  # dd if=floppy54.fs of=/dev/rfd0c bs=32k
d1718 1
a1718 1
  # cmp /dev/rfd0c floppy54.fs
d1730 1
a1730 1
  C:\> ntrw floppy54.fs a:
d1735 20
d1762 3
a1764 5
to boot from CD, your system BIOS must be able to and be set to boot from CD.
Some older systems do not have this option, and you must use a floppy for
booting your installation image. Don't worry though; even if you boot from
floppy you can still install from the CD if it is supported by OpenBSD (i.e.,
almost all IDE drives).
d1812 3
a1814 3
needed, everything runs from the RAM disk. You can actually remove the CD or
floppy you booted from at this point, assuming you don't need the CD for
installation files.
d1833 2
a1834 2
  Welcome to the OpenBSD/i386 5.4 installation program.
  (I)nstall, (U)pgrade or (S)hell? i
d1836 1
a1836 1
And with that, we reach our first question. You have the three options shown:
d1846 1
a1846 1
      + You will not be given the option of installing the etc54.tgz file.
d1848 1
a1848 1
        etc54.tgz into your system before you can expect it to be fully
d1852 1
a1852 1
        often work, it is not supported. For OpenBSD 5.4, upgrading 5.3 to 5.4
d1856 8
a1863 2
  * More information on upgrading between releases can be found in the OpenBSD
    Upgrade Guide 5.4.
d2003 1
a2003 1
What timezone are you in? ('?' for list) [Canada/Mountain] US/Michigan
d2053 1
a2053 1
  Disk: wd0       geometry: 5221/255/63 [40960 Megabytes]
d2058 1
a2058 1
   0: 06      0   1   1 -    521 254  63 [          63:     8385867 ] DOS > 32MB
d2079 1
a2079 1
  * You wish to build a multi-booting system.
d2139 17
a2155 9
  /dev/wd0a on /mnt type ffs (rw, asynchronous, local)
  /dev/wd0k on /mnt/home type ffs (rw, asynchronous, local, nodev, nosuid)
  /dev/wd0d on /mnt/tmp type ffs (rw, asynchronous, local, nodev, nosuid)
  /dev/wd0f on /mnt/usr type ffs (rw, asynchronous, local, nodev)
  /dev/wd0g on /mnt/usr/X11R6 type ffs (rw, asynchronous, local, nodev)
  /dev/wd0h on /mnt/usr/local type ffs (rw, asynchronous, local, nodev)
  /dev/wd0j on /mnt/usr/obj type ffs (rw, asynchronous, local, nodev, nosuid)
  /dev/wd0i on /mnt/usr/src type ffs (rw, asynchronous, local, nodev, nosuid)
  /dev/wd0e on /mnt/var type ffs (rw, asynchronous, local, nodev, nosuid)
d2163 1
a2163 1
we will install from an FTP server.
d2165 1
a2165 1
  Location of sets? (cd disk ftp http or 'done') [cd] ftp
d2174 1
a2174 2
  Server directory? [pub/OpenBSD/5.4/i386] Enter
  Login? [anonymous] Enter
d2184 4
a2187 4
      [X] bsd           [X] etc54.tgz     [X] xbase54.tgz   [X] xserv54.tgz
      [X] bsd.rd        [X] comp54.tgz    [X] xetc54.tgz
      [ ] bsd.mp        [X] man54.tgz     [X] xshare54.tgz
      [X] base54.tgz    [X] game54.tgz    [X] xfont54.tgz
d2190 2
a2191 2
At a bare minimum, you need to have a kernel (bsd), the base54.tgz and
etc54.tgz file sets. Unless you know what you are doing, stick with the
d2195 1
a2195 1
  * -comp54.tgz removes comp54.tgz
d2201 2
a2202 2
upgraded to a multi-processor system, you might want to install bsd.mp as
well.
d2209 44
a2252 12
  bsd          100% |*************************************|  9399 KB    00:05
  bsd.rd       100% |*************************************|  6350 KB    00:03
  base54.tgz   100% |*************************************| 55803 KB    00:26
  etc54.tgz    100% |*************************************|   511 KB    00:00
  comp54.tgz   100% |*************************************| 47533 KB    00:28
  man54.tgz    100% |*************************************|  9761 KB    00:06
  game54.tgz   100% |*************************************|  2568 KB    00:02
  xbase54.tgz  100% |*************************************| 10562 KB    00:06
  xetc54.tgz   100% |*************************************| 64774       00:00
  xshare54.tgz 100% |*************************************|  4373 KB    00:04
  xfont54.tgz  100% |*************************************| 38869 KB    00:17
  xserv54.tgz  100% |*************************************| 25954 KB    00:15
d2453 1
a2453 1
to create a multi-boot system, reserving 5G at the beginning of the disk for
d2942 10
a2951 10
  * base54.tgz - Contains the base OpenBSD system Required
  * etc54.tgz - Contains all the files in /etc Required
  * comp54.tgz - Contains the compiler and its tools, headers and libraries.
  * man54.tgz - Contains man pages
  * game54.tgz - Contains the games for OpenBSD
  * xbase54.tgz - Contains the base libraries and utilities for X11
  * xetc54.tgz - Contains the /etc/X11 and /etc/fonts configuration files
  * xfont54.tgz - Contains X11's font server and fonts
  * xserv54.tgz - Contains X11's X servers
  * xshare54.tgz - Contains manpages, locale settings, includes, etc. for X
d2953 1
a2953 1
The etc54.tgz and xetc54.tgz sets are not installed as part of an upgrade,
d2961 1
a2961 1
applications can sometimes be satisfied simply by installing just xbase54.tgz,
d2977 1
a2977 1
xbase54.tgz and pull out just the files they need to install their
d3214 1
a3214 1
loader that NT uses. To multi-boot with NT, you need a copy of your OpenBSD
d3423 1
a3423 1
Sometimes, you realize you really DID need comp54.tgz (or any other system
d3440 1
a3440 1
  # tar -C / -xzvphf comp54.tgz
d3542 14
a3555 28
ssh key generation process. A SPARCStation2 or a Macintosh Quadra may take
several hours to complete the ssh-keygen(1) steps. Just let it finish; it is
only done once per install.

Users of very slow machines may wish to generate their keys on another
computer, place them in a site54.tgz file, and install them with the rest of
the file sets.

4.13.4 - I got the message "Failed to change directory" when doing an install

When doing an FTP install of a snapshot during the -beta stage of the OpenBSD
development cycle, you may see this:


  Display the list of known ftp servers? [no] yes
  Getting the list from 192.128.5.191 (ftp.openbsd.org)... FAILED
  Failed to change directory.
  Server IP address or hostname?

This is normal and expected behavior during this pre-release part of the
cycle. The install program looks for the FTP list on the primary FTP server in
a directory that won't be available until the release date, so you get the
above message.

Simply use the FTP mirror list to find your favorite FTP mirror, and manually
enter its name when prompted.

Note: You should not see this if you are installing -release or from CD-ROM.
d3607 1
a3607 4
4.13.7 - I got an SHA256 mismatch during install!

Checksums are embedded in the install kernels for the file sets that are used
for the system install.
d3609 7
a3615 6
Actual -release file sets should all match their stored checksums.

At times, snapshots may not have proper checksums stored with the install
kernels. This will happen for various reasons on the building side, and is not
reason to panic for development snapshots. If you are concerned about this,
wait for the next snapshot.
d3622 1
a3622 1
called "siteXX.tgz", where XX is the release version (e.g. 54). The siteXX.tgz
d3631 1
a3631 1
siteXX-<hostname>.tgz, for example, "site54-puffy.tgz". This allows easy
d3678 1
a3678 1
    rc.firsttime(8) file (appending to this file is neccessary since the
d3777 1
a3778 2
------------------------------------------------------------------------------
$OpenBSD: faq4.html,v 1.331 2013/11/07 00:08:45 sobrado Exp $
d3833 1
a3833 1
           ,------o-----------o----X                    5.1 Stable
d3835 1
a3835 1
           |      .    ,------o---------o----X          5.2 Stable
d3837 1
a3837 1
           |      .    |      .    ,----o----------o--> 5.3 Stable
d3839 1
a3839 1
           |      .    |      .    |    .    ,-----o--> 5.4 Stable
d3842 1
a3842 1
     -->5.1Rel----->5.2Rel----->5.3Rel----->5.4Rel----> Current
d3857 2
a3858 2
also note that in the above example, the 5.1-stable branch came to an end with
5.3-release, and the 5.2-stable branch came to an end with 5.4-release -- old
d3863 1
a3863 1
(i.e., going from 5.4-release to 5.4-stable).
d3927 1
a3927 1
functionality. For example, going from v5.3 to v5.4, or going from the June
d3936 1
a3936 1
example, 5.2-release to 5.2-stable. You may then later update it to a newer
d3940 3
a3942 3
So, you may install a system (for example, 5.2-release) from CD, then update
it to 5.2-stable a few times, then upgrade it to 5.3-release from CD, and
update that a few times before upgrading it again to the 5.4-release.
d3958 2
a3959 2
5.4-current (or a snapshot), then decide you are living too dangerously, and
step back to 5.4-stable. You are on your own if you choose any path other than
d4087 1
a4087 1
        # cvs -d$CVSROOT checkout -rOPENBSD_5_4 -P src
d4089 1
a4089 1
    This will pull the src files from the OPENBSD_5_4 branch, which is also
d4095 1
a4095 1
        # cvs -d$CVSROOT up -rOPENBSD_5_4 -Pd
d4098 1
a4098 1
    system, so you don't have to remember the "-rOPENBSD_5_4" part of the
d4110 1
a4110 1
    # cvs -d$CVSROOT checkout -rOPENBSD_5_4 -P src ports xenocara
d4121 2
a4122 2
often save a lot of time and bandwidth by "pre-loading" your source tree with
the source files from either the OpenBSD CD or from an FTP server. This is
d4153 57
a4209 40
As indicated earlier, some options are mandatory to get a valid src tree in
OpenBSD. The "-P" option above is one of those: It "prunes" (removes)
directories that are empty. Over the years, directories have been created and
deleted in the OpenBSD source tree, and sometimes the names of old directories
are currently used as file names. Without the "-P" option, your newly
checked-out tree WILL NOT successfully compile.

Much the same with the -d option on the 'update' command -- it creates new
directories that may have been added to the tree since your initial checkout.
To get a successful update, you must use the -Pd options.

Experienced CVS users may wonder why the CVSROOT was specified and used in
this example, as cvs(1) will record the CVS server's location in the checked
out tree. This is correct, however there are enough times where one may need
to override the default anoncvs server, many people recommend always
specifying the repository explicitly. It is also worth noting that while the
CVSROOT environment variable can be used directly by cvs(1), it is used only
if nothing else overrides it (i.e., cvs(1) would have an error without it),
whereas specifying it in the cvs(1) command line overrides all other values.

It is often useful to use a .cvsrc in your home directory to specify defaults
for some of these options. An example .cvsrc file:

    $ more ~/.cvsrc
    cvs -q -danoncvs@@anoncvs.example.org:/cvs
    diff -up
    update -Pd
    checkout -P

This file would cause cvs(1) to use the anoncvs@@anoncvs.example.org:/cvs
server, suppress usually unneeded output ("-q" is "quiet") for all operations,
a "cvs up" command defaults to using the -Pd, a "cvs diff" defaults to
providing "unified diffs" due to the "-u", and a "cvs checkout" will use the
"-P" option. While this is convenient, if you forget this file exists, or try
to run commands you got used to on a machine without this file, you will have
problems.

As the source trees consist of large numbers of mostly small files, turning on
soft updates for the partition the source tree is on will often give
significantly better performance.
d4368 1
a4368 1
    # /bin/ls -1 >index.txt
d4670 1
a4670 1
    OpenBSD 5.4 (GENERIC) #37: Tue Jul 30 12:05:01 MDT 2013
d4729 1
a4729 1
    OpenBSD 5.4 (GENERIC) #37: Tue Jul 30 12:05:01 MDT 2013
d4864 5
a4868 36
As a policy, software in the OpenBSD tree does not modify files in /etc
automatically. This means it is always up to the administrator to make the
necessary modifications there. Upgrades are no exception. To update files in
these directories, first determine what changes have occurred to the base
(distribution) files, and then manually reapply these changes.

For example, to see the files in the tree that have changed most recently, do
a:

    # cd /usr/src/etc
    # ls -lt |more

To see all the changes in /etc between arbitrary versions of OpenBSD, you can
use CVS. For example, to see the changes between 5.3 and 5.4 do a:

    # cd /usr/src/etc
    # cvs diff -u -rOPENBSD_5_3 -rOPENBSD_5_4

To see the changes between 5.4 and -current ("HEAD"), use:

    # cd /usr/src/etc
    # cvs diff -u -rOPENBSD_5_4 -rHEAD

The /dev/MAKEDEV script is not updated automatically as part of the make build
process, however it is installed as part of a binary upgrade. As a general
rule, it is a good idea to copy (if needed) and run this script from your
source tree when performing an upgrade:

    # cd /dev
    # cp /usr/src/etc/etc.`machine`/MAKEDEV ./
    # ./MAKEDEV all

Once you have identified the changes, reapply them to your local tree,
preserving any local configuration you may have done.

Typical /etc changes to watch out for between releases include:
d4870 1
a4870 11
  * Additions to /etc/protocols and /etc/services
  * New sysctls (see /etc/sysctl.conf)
  * Changes to the default cron jobs. See /etc/daily, /etc/weekly, /etc/
    monthly, and /etc/security
  * All rc scripts, including netstart
  * Device changes, see above
  * File hierarchy changes in /etc/mtree, see below
  * New users (/etc/passwd) and groups (/etc/group)

These changes are summarized in upgrade54.html (for going to 5.4-release) or
current.html (for going to -current).
d4876 2
a4877 2
change. An easy way to ensure that your file hierarchy is up-to-date is to use
the mtree(8) utility.
d4886 2
a4887 1
Your file hierarchy should now be up to date.
d4902 1
a4903 2
------------------------------------------------------------------------------
$OpenBSD: faq5.html,v 1.197 2013/11/01 14:05:56 nick Exp $
d4922 1
d4970 3
a4972 4
process, or after the booting process using the dmesg(8) command. You also
have the chance of seeing your network interface using the ifconfig(8)
command. For example, here is the output of dmesg for a Intel Fast Ethernet
network card, which uses the device name fxp.
d4977 7
a4983 8
If you don't know what your device name is, please look at the supported
hardware list for your platform. You will find a list of many common card
names and their OpenBSD device names here. Combine the short alphabetical
device name (such as fxp) with a number assigned by the kernel and you have an
interface name (such as fxp0). The number is assigned based on various
criteria, depending upon the card and other details of the system. Some cards
are assigned by the order they are found during bus probing. Others may be by
hardware resource settings or MAC address.
d5262 85
d5632 2
a5633 4
The main software interface to PPPoE/PPPoA on OpenBSD is pppoe(8), which is a
userland implementation (in much the same way that we described ppp(8),
above). A kernel PPPoE implementation, pppoe(4), has been incorporated into
OpenBSD.
d6095 1
a6095 1
    >> OpenBSD/i386 PXEBOOT 3.19
d6101 1
a6101 1
    >> OpenBSD/i386 PXEBOOT 3.19
d6111 1
a6111 1
    OpenBSD 5.4 (RAMDISK_CD) #34: Tue Jul 30 12:20:01 MDT 2013
d6389 1
d6392 1
a6392 1
  * ray(4) Raytheon Raylink/WebGear Aviator 802.11FH
d6399 1
d6562 1
a6563 2
------------------------------------------------------------------------------
$OpenBSD: faq6.html,v 1.313 2013/12/01 23:42:04 nick Exp $
d7181 1
a7182 2
------------------------------------------------------------------------------
$OpenBSD: faq7.html,v 1.95 2014/02/13 20:08:19 nick Exp $
d7326 1
a7326 1
|Awk      |base54.tgz,|                                                      |
d7331 1
a7331 1
|C, C++   |comp54.tgz,|The C/C++ compilers in the base system have been      |
d7340 1
a7340 1
|         |lang/llvm  |audit and do not contain security enhancements like   |
d7362 1
a7362 3
|Java     |devel/jdk  |Sun JDK - only 1.7 as a package; 1.6 is not           |
|         |           |recommended due lack of updates and restrictive       |
|         |           |license.                                              |
d7364 1
a7364 1
|         |www/       |Browser plugin and web start for jdk/1.7 only.        |
d7367 1
a7367 1
|         |devel/     |Large IDE; works with Sun JDK.                        |
d7370 1
a7370 1
|         |devel/     |Another IDE; works with Sun JDK.                      |
d7378 1
a7378 1
|Perl     |base54.tgz,|Many Perl modules are available in the ports tree, so |
d7450 1
a7450 1
    OpenBSD 5.4 (GENERIC) #37: Tue Jul 30 12:05:01 MDT 2013
d7593 1
a7593 1
    230- OpenBSD 5.4 (GENERIC) #37: Tue Jul 30 12:05:01 MDT 2013
d7680 1
a7680 1
    OpenBSD 5.4 (GENERIC) #37: Tue Jul 30 12:05:01 MDT 2013
d7698 1
a7698 1
OpenBSD/sgi (Octane only), and OpenBSD/hppa platforms.
d7982 1
a7982 1
systems, which can cause problems when multi-booting.
d7993 1
a7993 1
    OpenBSD 5.4 (GENERIC) #37: Tue Jul 30 12:05:01 MDT 2013
d8016 1
a8017 2
------------------------------------------------------------------------------
$OpenBSD: faq8.html,v 1.246 2013/11/01 14:05:56 nick Exp $
d8089 1
a8089 1
    interface to CVS.
d8220 1
a8220 1
    # export PKG_PATH=ftp://your.ftp.mirror/pub/OpenBSD/5.4/packages/i386/
d8232 1
a8233 2
------------------------------------------------------------------------------
$OpenBSD: faq9.html,v 1.103 2013/11/01 14:05:56 nick Exp $
a8246 2
  * 10.5 - I've set up POP, but I get errors when accessing my mail through
    POP. What can I do?
a8253 1
  * 10.12 - Setting up KerberosV Clients and Servers
d8257 1
a8257 1
  * 10.16 - Tell me about chroot(2) Apache?
d8362 1
a8362 3
all the changes are in the one file that isn't touched during upgrade. In
fact, the standard upgrade process assumes you have not modified /etc/rc.conf,
and will overwrite it with the new version.
a8468 37
10.5 - I've set up POP, but users have trouble accessing mail through POP.
What can I do?

Most issues dealing with POP are problems with temporary files and lock files.
If your pop server sends an error message such as:

    -ERR Couldn't open temporary file, do you own it?

Try setting up your permissions as such:

    permission in  /var
    drwxrwxr-x   2 bin     mail     512 May 26 20:08 mail


    permissions in  /var/mail
    -rw-------   1 username   username        0 May 26 20:08 username

Another thing to check is that the user actually owns their own /var/mail
file. Of course this should be the case (as in, /var/mail/joe should be owned
by joe) but if it isn't set correctly it could be the problem!

Of course, making /var/mail writable by group mail opens up some vague and
obscure security problems. It is likely that you will never have problems with
it. But it could (especially if you are a high profile site, ISP, ...)! There
are several POP servers you can install right away from the ports collection.
If possible, use popa3d which is available in the OpenBSD base install. Or,
you could just have the wrong options selected for your pop daemon (like dot
locking). Or, you may just need to change the directory that it locks in
(although then the locking would only be valuable for the POP daemon.)

Note: OpenBSD does not have a group name of "mail". You need to create this in
your /etc/group file if you need it. An entry like:

    mail:*:6:

would be sufficient.

a8818 8
10.12 - Setting up KerberosV Clients and Servers

OpenBSD includes KerberosV as a pre-installed component of the default system.

For more information on KerberosV, from your OpenBSD system, use the command:

    # info heimdal

d9118 1
a9118 1
10.16 - Tell me about this chroot(2) Apache?
d9120 3
a9122 3
In OpenBSD, the Apache httpd(8) server has been chroot(2)ed by default. While
this is a tremendous boost to security, it can create issues, if you are not
prepared.
d9128 3
a9130 3
/" (root) directory. In the case of httpd(8), the program starts, opens its
log files, binds to its TCP ports (though, it doesn't accept data yet), and
reads its configuration. Next, it locks itself into /var/www and drops
d9132 6
a9137 5
used by Apache must be in the /var/www directory. In the default configuration
of OpenBSD, all the files in the /var/www directory are read-only by the user
Apache runs as, www. This helps security tremendously -- should there be a
security issue with Apache, the damage will be confined to a single directory
with only "read only" permissions and no resources to cause mischief with.
d9141 1
a9141 1
Put bluntly, chroot(2)ing Apache is something not done by default in most
d9144 1
a9144 2
that security and convenience are often not compatible goals. OpenBSD's
implementation of Apache does not compromise security for features or "ease".
d9146 15
a9160 15
  * Historic file system layouts: Servers upgraded from older versions of
    OpenBSD may have web files located in user's directories, which clearly
    won't work in a chroot(2)ed environment, as httpd(8) can't reach the /home
    directory. Administrators may also discover their existing /var/www
    partition is too small to hold all web files. Your options are to
    restructure or do not use the chroot(2) feature. You can, of course, use
    symbolic links in the user's home directories pointing to subdirectories
    in /var/www, but you can NOT use links in /var/www pointing to other parts
    of the file system -- that is prevented from working by the chroot(2)ing.
    Note that if you want your users to have chroot(2)ed FTP access, this will
    not work, as the FTP chroot will (again) prevent you from accessing the
    targets of the symbolic links. A solution to this is to not use /home as
    your home directories for these users, rather use something similar to /
    var/www/users. Symbolic links can be used completely within the chroot(2),
    but they have to be relative, not absolute.
d9162 6
a9167 20
    sending httpd(8) a SIGUSR1 signal to cause Apache to close its old log
    files and open new ones. This is no longer possible, as httpd(8) has no
    ability to open log files for writing once privileges are dropped. httpd
    (8) must be stopped and restarted. It sometimes takes a few seconds for
    all the child processes to terminate, which must happen before httpd(8)
    can be restarted, so one possible way to rotate the logs would be as
    follows:

        # apachectl stop
            rename your log files
        # apachectl start ; sleep 10 ; apachectl start

    Yes, the last line attempts to restart Apache immediately, and in case
    that fails it waits a few seconds and tries again. And yes, that does mean
    that for a few seconds every time you do your log rotation, your web
    server will be unavailable. While this could be annoying, any attempt to
    permit httpd(8) to reopen files after chroot(2)ing would defeat the very
    purpose of the chroot! There are also other strategies available,
    including logging to a pipe(2), and using an external log rotator at the
    other end of the pipe(2).
d9181 10
a9190 9
  * Name Resolution: httpd(8) inside the chroot(2) will NOT be able to use the
    system /etc/hosts or /etc/resolv.conf. Therefore, if you have applications
    which require name resolution, you will need to populate /var/www/etc/
    hosts and/or /var/www/etc/resolv.conf in the chroot(2) environment. Note
    that some applications expect the resolution of "localhost" to work.
  * Timezone: httpd(8) inside the chroot(2) will NOT be able to use the system
    /etc/localtime. If you require localtime logging of events, you will need
    to copy (not link) the corresponding timezone from /usr/share/zoneinfo/
    under /var/www/etc/localtime.
d9194 1
a9194 1
using the -u option for httpd(8) in /etc/rc.conf.local.
d9196 1
a9196 1
Example of chroot(2)ing an app: wwwcount
d9664 1
a9665 2
------------------------------------------------------------------------------
$OpenBSD: faq10.html,v 1.181 2014/02/24 16:18:25 nick Exp $
d9758 1
a9758 6
/usr/X11R6/README for alpha.

Set machdep.allowaperture=1 in /etc/sysctl.conf.

The TGA and some VGA cards are supported. No further configuration should be
needed.
a9772 4
11.2.4 - hp300

/usr/X11R6/README for hp300.

d9796 1
a9796 1
No X servers, only X clients.
d9869 1
a9869 4
/usr/X11R6/README for vax.

The X server currently only works on VAXstation 4000 models with either a lcg
(4) or lcspx(4) framebuffer.
d10005 1
a10006 2
------------------------------------------------------------------------------
$OpenBSD: faq11.html,v 1.98 2014/02/12 16:41:56 nick Exp $
d10254 1
a10254 1
For 5.4, this was called the "beagle" platform, but for -current and later
d10560 1
a10561 2
------------------------------------------------------------------------------
$OpenBSD: faq12.html,v 1.109 2013/10/06 18:17:18 nick Exp $
d10585 1
a10585 1
  * 13.13 - Can I have Java support in my web browser? (i386 & amd64 only)
d11629 1
a11629 1
13.13 - Can I have Java support in my web browser? (i386 & amd64 only)
d11631 7
a11637 21
The Java plugin is part of the Java Development Toolkit (JDK). For licensing
reasons, OpenBSD cannot ship binary packages for the JDK. This means you will
have to build it from ports. Further information on building the JDK can be
found in FAQ 8 - Programming Languages. Once you have finished building the
JDK, you can install either the full JDK package or just the Java Runtime
Environment (JRE) which is in a subpackage and contains the browser plugin.

Upon installation, instructions are displayed for using the Java plugin with
the Firefox or Seamonkey web browser. Create the symlink as explained, and
then you should see the Java plugin upon entering "about:plugins" in the URL
bar.

For KDE's Konqueror web browser, either the java binary must be in your PATH,
or its absolute path can be configured from the menu Settings -> Configure
Konqueror -> Java & JavaScript. By default, the java binary is located in /usr
/local/jre-version/bin/ or /usr/local/jdk-version/bin/, depending on whether
you installed the JRE or the JDK.

Note: Java support has only been tested with the Firefox, Seamonkey, and
Konqueror web browsers. If it works well for you using a different browser,
please let us know.
d11650 1
a11651 2
------------------------------------------------------------------------------
$OpenBSD: faq13.html,v 1.147 2013/05/01 15:17:36 bcallah Exp $
d12385 1
a12385 1
    >> OpenBSD/i386 BOOT 3.21
d12395 1
a12395 1
    OpenBSD 5.4 (GENERIC) #37: Tue Jul 30 12:05:01 MDT 2013
d13759 3
d13767 1
a13767 1
    # bioctl -c C -l /dev/sd1m softraid0
d13793 1
a13794 2
------------------------------------------------------------------------------
$OpenBSD: faq14.html,v 1.240 2013/11/01 14:05:57 nick Exp $
d13920 1
a13920 1
    $ export PKG_PATH=/mnt/cdrom/5.4/packages/`machine -a`/
d13924 1
a13924 1
    $ export PKG_PATH=ftp://your.ftp.mirror/pub/OpenBSD/5.4/packages/`machine -a`/
d13937 1
a13937 1
snapshots, you will replace "5.4" with "snapshots".
d13947 1
a13947 1
  * On the FTP mirror servers. Packages are located in the /pub/OpenBSD/5.4/
d14064 1
a14064 1
    $ sudo pkg_add ftp://ftp.openbsd.org/pub/OpenBSD/5.4/packages/`machine -a`/screen-4.0.3p3.tgz
d14151 1
a14151 1
box from OpenBSD 5.3 to 5.4. Now you can easily upgrade to the newer 5.4
d14323 1
a14323 1
    $ ftp ftp://ftp.openbsd.org/pub/OpenBSD/5.4/ports.tar.gz
d14698 1
a14698 5
To start building signed packages, first we need to create a root CA
(certificate authority) certificate and key. For the example, we'll use a
validity of 10 years.

    # openssl req -x509 -days 3650 -newkey rsa:2048 -keyout /etc/ssl/private/pkgca.key -out /etc/ssl/pkgca.pem
d14700 1
a14700 4
Now we are going to create a build certificate and key which will be used to
sign our packages. For the example, we'll use a validity of 1 year. We will
also create a corresponding Certificate Signing Request which will be used by
our CA to sign the certificate.
d14702 1
a14702 2
    # openssl genrsa -out /etc/ssl/private/pkg.key 2048
    # openssl req -new -key /etc/ssl/private/pkg.key -out /etc/ssl/private/pkg.csr
d14704 1
a14704 1
Now let's sign the certificate using the CA we created in the first step.
d14706 1
a14706 2
    # openssl x509 -req -days 365 -in /etc/ssl/private/pkg.csr -CA /etc/ssl/pkgca.pem -CAkey /etc/ssl/private/pkgca.key -CAcreateserial -out /etc/ssl/pkg.crt
    # rm /etc/ssl/private/pkg.csr
d14708 2
a14709 2
Finally, we add the following line to /etc/mk.conf to build signed packages by
default.
d14711 2
a14712 1
    PKG_CREATE=/usr/sbin/pkg_create -s x509 -s /etc/ssl/pkg.crt -s /etc/ssl/private/pkg.key
d14714 1
a14714 2
When installing signed packages, you will see an added line at the end of the
output informing you of the number of signed package(s) you just installed.
d14716 2
a14717 3
    $ sudo pkg_add vte-0.24.3.tgz
    vte-0.24.3: ok
    Packages with signatures: 1
d14719 2
a14720 7
If you run into trouble dealing with signed packages (e.g. expired
certificate...), you can force the (re-)installation and/or removal using one
of the following (according to what you want to achieve):

    $ sudo pkg_add -r -D installed PKGNAME
    $ sudo pkg_add -D nosig PKGNAME
    $ sudo pkg_delete -q PKGNAME
d14964 1
a14965 2
------------------------------------------------------------------------------
$OpenBSD: faq15.html,v 1.97 2013/11/11 16:43:33 jca Exp $
@


1.34
log
@
These files are now on the FTP servers, in the /pub/OpenBSD/doc directory.
@
text
@d1 2
a2 1
[OpenBSD]
d4 1
a4 1
1.0 - Introduction to OpenBSD
d6 356
a361 1
-------------------------------------------------------------------------------
d367 2
a368 2
  * 1.3 - Is OpenBSD really free?
  * 1.4 - Why might I want to use OpenBSD?
d371 5
a375 1
  * 1.7 - When will be the next release of OpenBSD?
d377 1
a377 1
-------------------------------------------------------------------------------
d383 4
a386 2
standardization, and portability. OpenBSD supports binary emulation of most
binaries from SVR4 (Solaris), FreeBSD, Linux, BSDI, SunOS, and HPUX.
d390 1
a390 1
OpenBSD 3.2 runs on the following platforms:
d392 24
a415 21
  * i386 - CD bootable
  * sparc - CD bootable
  * sparc64 - CD bootable
  * hp300 - CD bootable
  * amiga
  * mac68k
  * macppc - CD Bootable
  * mvme68k
  * alpha - CD bootable
  * vax

bootable means that OpenBSD will boot directly from the CD. The CD set will
boot on several hardware platforms. See chapter 3 of this FAQ for details of
obtaining OpenBSD on CD.

Previous releases of OpenBSD also had a port for:

  * sun3 - This port was removed after the 2.9 release
  * arc - This port was removed after the 2.3 release
  * mvme88k
  * pmax
d417 1
a417 2
If you are interested in multiprocessor support, see FAQ 8, Multiprocessor for
more info.
d419 9
a427 1
1.3 - Is OpenBSD really free?
d429 1
a429 21
OpenBSD is all free. The binaries are free. The source is free. All parts of
OpenBSD have reasonable copyright terms permitting free redistribution. This
includes the ability to REUSE most parts of the OpenBSD source tree, either for
personal or commercial purposes. OpenBSD includes NO further restrictions other
than those implied by the original BSD license. Software which is written under
stricter licenses cannot be included in the regular distribution of OpenBSD.
This is intended to safeguard the free use of OpenBSD. For example, OpenBSD can
be freely used for personal use, for academic use, by government institutions,
by non-profit making organizations and by commercial organizations.

For further reading on other popular licenses read: http://www.openbsd.org/
policy.html.

The maintainers of OpenBSD support the project largely from their own pockets.
This includes the time spent programming for the project, equipment used to
support the many ports, the network resources used to distribute OpenBSD to
you, and the time spent answering questions and investigating users' bug
reports. The OpenBSD developers are not independently wealthy and even small
contributions of time, equipment, and resources make a big difference.

1.4 - Why might I want to use OpenBSD?
d432 1
a432 1
free UNIX-like operating system. That question is largely un-answerable and is
d436 1
a436 2
Below are some reasons why we think OpenBSD is a useful operating system.
Whether OpenBSD is right for you is a question that only you can answer.
d439 3
a441 3
  * OpenBSD is thought of by many security professionals to be the most secure
    UNIX-like operating system as the result of a 10-member 1.5-year long
    comprehensive source code security audit.
d446 1
a446 1
  * OpenBSD benefits from strong on-going development in many areas, offering
d449 45
a493 2
  * OpenBSD offers opportunities for ordinary people to participate in the
    development and testing of the product.
d498 1
a498 3
to the OpenBSD project. They are acknowledged by name here:

http://www.openbsd.org/donations.html
d505 4
a508 4
  * Buy an OpenBSD CD set. It includes the current full release of OpenBSD, and
    is bootable on many platforms. It also generates revenue to support the
    OpenBSD project, and reduces the strain on network resources used to
    deliver the distribution via the Internet. This inexpensive three-CD set
d513 1
a513 1
    OpenBSD developers, without guaranteed return. Send e-mail to 
d516 5
a520 5
  * Donate equipment and parts. The project has a constant need for general and
    specific hardware. Items such as IDE and SCSI disks, and various types of
    RAM are always welcome. For other types of hardware such as computer
    systems and motherboards, you should inquire as to current need. Write to 
    donations@@openbsd.org to arrange for shipment.
d525 1
a525 1
  * Help maintain documentation by submitting new FAQ material (to 
d529 6
a534 5
    for Computer Science or Engineering courses. It's also worth mentioning one
    of the most important ways you should not try to "help" The OpenBSD
    project: do not waste your time engaging in operating system flame wars. It
    does not help the project to find new users and can cause substantial harm
    to important relationships that developers have with other developers.
d538 1
a538 1
OpenBSD is maintained by a development team spread across many different 
d541 1
a541 1
1.7 - When will be the next release of OpenBSD?
d544 4
a547 2
dates of May 1 and November 1. More information on the development cycle can be
found here
d549 2
a550 1
[To Section 2.0 - Other OpenBSD information resources]
d552 139
a690 4
-------------------------------------------------------------------------------
[back] www@@openbsd.org
$OpenBSD: obsd-faq.txt,v 1.33 2003/01/05 19:29:10 nick Exp $
[OpenBSD]
d692 1
a692 1
2.0 - Other OpenBSD information resources
d694 1
a694 1
-------------------------------------------------------------------------------
d703 1
a703 1
-------------------------------------------------------------------------------
d708 1
a708 1
www.OpenBSD.org
d713 10
a722 2
Additional information for laptop users can be found at:
http://www.monkey.org/openbsd-mobile/
d727 4
a730 4
subscribe to and follow. To subscribe to a mailing list, send an e-mail message
to majordomo@@openbsd.org. That address is an automated subscription service. In
the body of your message, on a single line, you should include a subscribe
command for the list you wish to join. For example:
d734 9
a742 7
The list processor will reply to you, asking for confirmation of your intent to
join the list. The confirmation you send back to the list processor will be
included in its reply to you. You get an option of a hypertext link or sending
a reply to the message to confirm your intent. An email reply should contain
something like this:

    accept A56D-70D4-52C3
d748 1
a748 1
To unsubscribe from a list, you will again send an e-mail message to 
d754 7
a760 3
the instructions. They can be obtained by sending an e-mail message to 
majordomo@@openbsd.org with a message body of "help". Some of the most popular
OpenBSD mailing lists are:
d763 2
a764 1
  * security-announce - Announcements of security issues.
a766 3
  * tech - Technical topics for OpenBSD developers and advanced users. Please
    direct 'new user' and installation-related questions to misc, not tech.
    Please do not cross-post to misc and tech.
d768 3
a770 1
  * source-changes - Automated mailing of CVS source tree changes.
d774 2
a775 1
  * advocacy - Discussion on advocating OpenBSD.
d777 1
a777 1
Before posting a question on misc or any other mail list, please check the
d780 3
a782 4
mail lists may have seen the same question several times in the last week, and
may not appreciate seeing it again. You can find several archives and other
mail list guidelines on the mailing lists web page: http://www.openbsd.org/
mail.html
d784 2
a785 2
Another mailing list that may be of interest is openbsd-mobile@@monkey.org. This
mailing list is a discussion of the use of OpenBSD in mobile computing.
d787 2
a788 1
To subscribe to this list use:
d790 1
a790 4
'echo subscribe | mail "openbsd-mobile-request@@monkey.org"'

The archives for that can be found at: http://www.monkey.org/openbsd-mobile/
archive/
d792 4
a795 1
2.3 - Manual Pages
d797 1
a797 4
OpenBSD comes with extensive documentation in the form of manual pages, as well
as longer documents relating to specific applications. To access the manual
pages and other documentation, be sure that you installed the man and misc
sets.
d801 3
d805 6
a810 3
  * afterboot(8) - things to check after the first complete boot.
  * boot(8) - system boot strapping procedures.
  * login.conf(5) - format of the login class configuration file.
d813 16
a828 1
  * man(1) - display the on-line manual pages.
d831 6
a836 7
  * disklabel(8) - Read and write disk pack label.
  * ifconfig(8) - configure network interface parameters.
  * route(8) - manually manipulate the routing tables.
  * netstat(1) - show network status.
  * reboot, halt(8) - Stopping and restarting the system.
  * shutdown(8) - close down the system at a given time.
  * boot_config(8) - how to change kernel configuration at boot.
d838 7
a844 10
Also, If you are one of the people who didn't install the man31.tgz package,
you can find all the OpenBSD man pages on the web at http://www.openbsd.org/
cgi-bin/man.cgi.

In general, if you know the name of a command or a manual page, you can read it
by executing `man command'. For example: `man vi' to read about the vi editor.
If you don't know the name of the command, or if `man command' doesn't find the
manual page, you can search the manual page database by executing `apropos
something' or `man -k something' where something is a likely word that might
appear in the title of the manual page you're looking for. For example:
d851 6
a856 6
The parenthetical numbers indicate the section of the manual in which that page
can be found. In some cases, you may find manual pages with identical names
living in separate sections of the manual. For example, assume that you want to
know the format of the configuration files for the cron daemon. Once you know
the section of the manual for the page you want, you would execute `man n
command' where n is the manual section number.
d859 2
a860 2
    cron (8) - daemon to execute scheduled commands (Vixie Cron)
    crontab (1) - maintain crontab files for individual users (V3)
a863 27
In addition to the UNIX manual pages, there is a typesettable document set
(included in the misc distribution). It lives in the /usr/share/doc directory.
If you also installed the text distribution, then you can format each document
set with a `make' in the appropriate subdirectory. The psd subdirectory is the
Programmer's Supplementary Documents distribution. The smm subdirectory is the
System Manager's Manual. The usd subdirectory is the UNIX User's Supplementary
Documents distribution. You can perform your `make' in the three distribution
subdirectories, or you can select a specific section of a distribution and do a
`make' in its subdirectory. Some of the subdirectories are empty. By default,
formatting the documents will result in Postscript output, suitable for
printing. The Postscript output can be quite large -- you should assume
250-300% increase in volume. If you do not have access to a Postscript printer
or display, you may also format the documents for reading on a terminal
display. In each Makefile you'll need to add the flag -Tascii to each instance
of the groff(1) commands (or execute it by hand). Some of the documents use the
ms formatting macros, and some use the me macros. The Makefile in each document
subdirectory (eg, /usr/share/doc/usd/04.csh/Makefile) will tell you which one
to use. For example:

    # cd /usr/share/doc/usd/04.csh
    # groff -Tascii -ms tabs csh.1 csh.2 csh.3 csh.4 csh.a csh.g > csh.txt
    # more csh.txt

The UNIX manual pages are generally more current and trustworthy than the
typesettable documents. The typesettable documents sometimes explain
complicated applications in more detail than the manual pages do.

d867 2
a868 2
How do I display a man page source file? (i.e. one whose filename ends in a
number, like tcpdump.8).
d870 3
a872 3
This is found throughout the src tree. The man pages are found in the tree
unformatted, and many times through the use of CVS, they will be updated. To
view these pages simply :
d874 1
a874 1
    # nroff -mdoc <file> | more
d878 2
a879 1
This is helpful to get the man page straight, with no non-printable characters.
d886 37
a922 13
Note that [man_src_file] must be the man page source file (probably a file that
ends in a number; e.g., tcpdump.8). The PostScript versions of the man pages
look very nice. They can be printed or viewed on-screen with a program like gv
(GhostView). GhostView can be found in our Ports Tree. Use the following groff
(1) command options for getting a PostScript version from an OpenBSD system man
page:

    # groff -mdoc -Tps [man_src_file] > outfile.ps

The above command line will only work for man pages formatted with the mdoc(7)
macro package, used to format the BSD man pages. For getting a PostScript
version from a third party software man page (either self-compiled or installed
from the ports(7) or the packages(7)), do instead:
d924 29
a952 1
    # groff -Tps -mandoc [man_src_file] > outfile.ps
d956 11
a966 2
Before submitting any bug report, please read http://www.openbsd.org/
report.html
d972 5
a976 6
    From: joeuser@@example.com
    To: bugs@@openbsd.org
    Subject: HELP!!!
    
    I have a PC and it won't boot!!!!! It's a 486!!!!!
    
d983 251
a1233 92
(Note: See report.html for more information on creating and submitting bug
reports. Basically, detailed information about your hardware is necessary if
you think the bug is in any way related to your hardware or hardware
configuration. Usually, dmesg(8) output is sufficient in this respect. Next, a
detailed description of your problem is necessary.)

    From: smartuser@@example.com
    To: bugs@@openbsd.org
    Subject: 2.7 panics on an i386
    
    After installing OpenBSD 2.7 from the CD which I purchased via your outstanding
    on-line ordering system, I find that the system halts when using any network utilities.
    After booting with a bootdisk and escaping to a shell. This is the
    dmesg output:
     
    OpenBSD 2.7 (GENERIC) #690: Fri Oct 29 16:32:17 MDT 1999
        deraadt@@i386.openbsd.org:/usr/src/sys/arch/i386/compile/GENERIC
    cpu0: F00F bug workaround installed
    cpu0: Intel Pentium (P54C) ("GenuineIntel" 586-class) 120 MHz
    cpu0: FPU,V86,DE,PSE,TSC,MSR,MCE,CX8
    BIOS mem  = 654336 conventional, 15728640 extended
    real mem  = 16384000
    avail mem = 11112448
    using 225 buffers containing 921600 bytes of memory
    mainbus0 (root)
    bios0 at mainbus0: AT/286+(63) BIOS, date 08/20/96
    bios0: diskinfo 0xe055800c cksumlen 1 memmap 0xe0558088 apminfo 0xe0558134
    apm0 at bios0: Power Management spec V1.1
    apm0: battery life expectancy 95%
    apm0: AC on, battery charge high, charging, estimated 1:27 minutes
    pci0 at mainbus0 bus 0: configuration mode 1 (no bios)
    pchb0 at pci0 dev 0 function 0 "Toshiba (2nd ID) Host-PCI" rev 0x11
    "Chips and Technologies 65550" rev 0x04 at pci0 dev 4 function 0 not configured
    isa0 at mainbus0
    isadma0 at isa0
    wdc0 at isa0 port 0x1f0/8 irq 14
    wd0 at wdc0 channel 0 drive 0: <TOSHIBA MK2720FC>
    wd0: can use 16-bit, PIO mode 4
    wd0: 16-sector PIO, LBA, 1296MB, 2633 cyl, 16 head, 63 sec, 2654280 sectors
    sb0 at isa0 port 0x220/24 irq 5 drq 1: dsp v3.02
    midi0 at sb0: <SB MIDI UART>
    audio0 at sb0
    opl0 at sb0: model OPL3
    midi1 at opl0: <SB Yamaha OPL3>
    wss0 at isa0 port 0x530/8 irq 10 drq 0: CS4232 (vers 63)
    audio1 at wss0
    pcppi0 at isa0 port 0x61
    midi2 at pcppi0: <PC speaker>
    sysbeep0 at pcppi0
    npx0 at isa0 port 0xf0/16: using exception 16
    pccom0 at isa0 port 0x3f8/8 irq 4: ns16550a, 16 byte fifo
    pccom1 at isa0 port 0x2f8/8 irq 3: ns16550a, 16 byte fifo
    pccom2: irq 5 already in use
    vt0 at isa0 port 0x60/16 irq 1: generic VGA, 80 col, color, 8 scr, mf2-kbd
    pms0 at vt0 irq 12
    fdc0 at isa0 port 0x3f0/6 irq 6 drq 2
    fd0 at fdc0 drive 0: 1.44MB 80 cyl, 2 head, 18 sec
    pcic0 at isa0 port 0x3e0/2 iomem 0xd0000/16384
    pcic0 controller 0: <Intel 82365SL rev 1> has sockets A and B
    pcmcia0 at pcic0 controller 0 socket 0
    pcmcia1 at pcic0 controller 0 socket 1
    ne3 at pcmcia1 function 0 "Linksys, EtherFast 10/100 PC Card (PCMPC100), " port 0x340/16 irq 9
    ne3: address 00:e0:98:04:95:ba
    pcic0: irq 11
    biomask 4040 netmask 4240 ttymask 5a42
    pctr: 586-class performance counters and user-level cycle counter enabled
    dkcsum: wd0 matched BIOS disk 80
    root on wd0a
    rootdev=0x0 rrootdev=0x300 rawdev=0x302
    
    Thank you!

If Joe User had a working OpenBSD system from which he wanted to submit a bug
report, he would have used the sendbug(1) utility to submit his bug report to
the GNATS problem tracking system. Obviously you can't use sendbug(1) when your
system won't boot, but you should use it whenever possible. You will still need
to include detailed information about what happened, the exact configuration of
your system, and how to reproduce the problem. The sendbug(1) command requires
that your system be able to send electronic mail successfully on the Internet.

After submitting a bug report, you will be notified by E-mail about the status
of the report. You may be contacted by developers for additional information or
with patches that need testing. You can also monitor the archives of the
bugs@@openbsd.org mail list, details on the mail list page.

[Back to Main Index] [To Section 1.0 - Introduction to OpenBSD] [To Section 3.0
- Obtaining OpenBSD]

-------------------------------------------------------------------------------
[back] www@@openbsd.org
$OpenBSD: obsd-faq.txt,v 1.33 2003/01/05 19:29:10 nick Exp $
[OpenBSD]
d1235 1
a1235 1
3.0 - Obtaining OpenBSD
d1237 1
a1237 1
-------------------------------------------------------------------------------
d1241 1
a1241 1
  * 3.1 - Buying an OpenBSD CD
d1244 4
a1247 2
  * 3.4 - Downloading via FTP or AFS
  * 3.5 - Obtaining Current Source Code
d1249 1
a1249 1
-------------------------------------------------------------------------------
d1251 1
a1251 1
3.1 - Buying an OpenBSD CD
d1253 2
a1254 2
Purchasing an OpenBSD CD is generally the best way to get started. Visit the
ordering page to purchase your copy: http://www.openbsd.org/orders.html.
d1256 1
a1256 1
There are many good reasons to own an OpenBSD CD:
d1258 1
a1258 1
  * CD sales support on-going development of OpenBSD.
d1261 1
a1261 1
  * Your support in the form of a CD purchase has a real impact on future
d1263 3
a1265 2
  * The CD contains binaries (and source) for all supported platforms.
  * The CD is bootable on several platforms, and can be used to bootstrap a
d1267 1
a1267 1
  * The CD is useful for bootstrapping even if you choose to install a
d1271 1
a1271 1
  * OpenBSD CDs always come with very nice stickers. You system isn't fully
d1274 2
d1277 2
a1278 2
If you're installing a release version of OpenBSD, you should use a CD.
Snapshot releases can only be installed over the network.
d1282 2
a1283 2
Yes, OpenBSD has t-shirts for your wearing enjoyment. You can view these at 
http://www.OpenBSD.org/tshirts.html. Enjoy :)
d1287 25
a1311 11
An OpenBSD ISO image is available for the amiga, hp300, mac68k and mvme68k
architectures. This is done to allow more package for the other architectures
fit on the CD sets available for purchase.

The ISO images used to master the official CD sets for the i386, alpha, sparc, 
sparc64, macppc and vax architectures are not available for download. The
reason is simply that we would like you to buy the CD sets, helping fund
ongoing OpenBSD development. The official OpenBSD CD-ROM layout is copyright
Theo de Raadt. Theo does not permit people to redistribute images of the
official OpenBSD CDs. As an incentive for people to buy the CD set, some extras
are included in the package as well (artwork, stickers etc).
d1314 17
a1330 19
precludes someone else from downloading OpenBSD and making their own CD. If for
some reason you want to download a CD image, try searching the mailing list
archives for possible sources. Of course, any OpenBSD ISO images available on
the Internet either violate Theo de Raadt's copyright or are not official
images. The source of an unofficial image may or may not be trustworthy, it is
up to you to determine this for yourself.

We suggest that people who want to download OpenBSD for free use the FTP
install option.

3.4 - Downloading via FTP or AFS

There are numerous international mirror sites offering FTP access to OpenBSD
releases and snapshots. AFS access is also available. You should always use the
site closest to you. Before you begin fetching a release or snapshot, you may
wish to use ping(8) and traceroute(8) to determine which mirror site is nearest
to you and whether that nearest mirror is performing adequately. Of course,
your OpenBSD release CD is always closer than any mirror. Access information is
here:
d1332 1
a1332 1
http://www.openbsd.org/ftp.html
d1334 1
a1334 1
3.5 - Obtaining Current Source Code
d1336 4
a1339 5
Source to OpenBSD is freely redistributable and available at no charge.
Generally the best way to get started with a current source tree is to install
the source from the most recent CD and then configure AnonCVS to update it
regularly. Information about AnonCVS, including how to set it up, is available
here:
d1341 1
a1341 1
http://www.openbsd.org/anoncvs.html.
d1343 3
a1345 1
or see FAQ 8, CVS
d1347 1
a1347 5
If you don't have sufficient network bandwidth to support AnonCVS, or if your
Internet access is via UUCP, you can still keep your source current by using
CTM instead of AnonCVS. If that's your situation, then starting with a recent
release CD is even more important. Information about CTM, including how to set
it up, is available here:
d1349 2
a1350 1
http://www.openbsd.org/ctm.html.
d1352 7
a1358 2
Yet another alternative is to get the source code from the web. You can do that
through cvsweb at: http://www.openbsd.org/cgi-bin/cvsweb/
d1360 2
a1361 2
[Back to Main Index] [To Section 2.0 - Other OpenBSD information resources] [To
Section 4.0 - Installation Guide]
d1363 96
a1458 4
-------------------------------------------------------------------------------
[back] www@@openbsd.org
$OpenBSD: obsd-faq.txt,v 1.33 2003/01/05 19:29:10 nick Exp $
[OpenBSD]
d1460 1
a1460 1
4 - OpenBSD 3.2 Installation Guide
d1462 1
a1462 1
-------------------------------------------------------------------------------
d1466 37
a1502 28
  * 4.1 - Overview of the OpenBSD Installation Procedure.
      + 4.1.1 - Supported OpenBSD Architectures
      + 4.1.2 - Supported Installation Media
      + 4.1.3 - Creating bootable OpenBSD install floppies
          o 4.1.3.1 - Creating Floppies on Unix
          o 4.1.3.2 - Creating Floppies on DOS/Windows
      + 4.1.4 - Booting OpenBSD Installation Images
  * 4.2 - Preinstallation Checklist
  * 4.3 - Doing an install
      + 4.3.1 - Setting up Disks
      + 4.3.2 - Setting the System Hostname
      + 4.3.3 - Configuring the Network
      + 4.3.4 - Choosing Installation Media
      + 4.3.5 - Choosing Filesets
      + 4.3.6 - Small RAM procedure
      + 4.3.7 - Finishing up
      + 4.3.8 - Other Information Resources
  * 4.4 - What files are needed for Installation?
  * 4.5 - How much space do I need for an OpenBSD installation?
  * 4.6 - Multibooting OpenBSD
  * 4.7 - Sending your dmesg to dmesg@@openbsd.org after the install
  * 4.8 - Adding a file set after install
  * 4.9 - What is 'bsd.rd'?
  * 4.10 - Common Installation Problems
      + 4.10.1 - Install hangs durring MAKEDEV
      + 4.10.2 - My Compaq only recognizes 16M RAM
      + 4.10.3 - My i386 won't boot after install!
      + 4.10.4 - My machine booted, but hung at the ssh-keygen process
d1504 1
a1504 1
-------------------------------------------------------------------------------
d1508 140
a1647 73
OpenBSD has a very robust and adaptable text-based install procedure. In
addition to its robustness, the install procedure can be done using 1 floppy
disk. Most architectures have a similar installation procedure, however there
are some differences in details. In all cases, you are urged to read the
platform-specific INSTALL document in the platform directory on the CDROM or
FTP sites (for example, INSTALL.i386, INSTALL.mac68k or INSTALL.sparc)

On most architectures, you have several installation options, including FTP,
CDROM, and local disk files. One option not supported is downloading an ISO
image to make your own official CDROM. CDROMs are available for purchase,
however.

4.1.1 - Supported OpenBSD Architectures

OpenBSD 3.2 supports a number of architectures listed below in alphabetical
order. Please refer to each architecture's page for specific information on
what each architecture supports.

  * alpha - DEC Alpha-based machines.
  * amiga - Amiga m68k-based models (MMU required).
  * hp300 - Hewlett-Packard HP300/HP400 machines.
  * i386 - Intel i386 compatibles.
  * mac68k - Most MC680x0-based Apple Macintosh models.
  * mvme68k - Motorola MVME147/16x/17x 68K VME cards.
  * macppc - Support for Apple based PowerPC systems.
  * sparc - SPARC Platform by Sun Microsystems.
  * sparc64 - Sun's UltraSPARC systems.
  * vax - DEC's VAX computers.

4.1.2 - Supported Installation Media

OpenBSD can be installed from multiple media types. The most common and
architecture independent options are laid out below. These options can be used
after booting from an OpenBSD CD-ROM, floppy disk or ramdisk kernel.

+-------------------------------------------------------------------------+
|          |To do a CD-ROM install, you must have either purchased an     |
|          |Official OpenBSD CD-ROM or created your own OpenBSD CD. This  |
|CD-ROM    |is usually the easiest way to install an OpenBSD system.      |
|          |NOTE: Official OpenBSD CDs are bootable if your BIOS supports |
|          |it.                                                           |
|----------+--------------------------------------------------------------|
|          |This installation option allows you to install OpenBSD by     |
|FTP       |downloading the installation packages in realtime over the    |
|          |network.                                                      |
|----------+--------------------------------------------------------------|
|Local     |This option allows you to install from files on a pre-existing|
|Filesystem|filesystem. Support for DOS, EXT2FS and FFS are included on   |
|          |the i386 install disk.                                        |
+-------------------------------------------------------------------------+

4.1.3 - Creating bootable OpenBSD install floppies.

To create an installation floppy image you must either download the correct
boot floppy image from one of the OpenBSD distribution sites or copy the image
from an Official OpenBSD CD-ROM. You can find a list of FTP servers at the 
OpenBSD FTP Distribution page. Most architectures have one or more boot floppy
images to choose from, different images are for different hardware variations.
The differences between the i386 platform installation floppies will be
outlined below. For the other architectures with multiple boot floppies, see
the INSTALL document in the respective FTP directory. For those with only one,
just download the respective floppy32.fs image.
NOTE: The cdrom32.fs image can be used to make a bootable OpenBSD installation
CD-ROM.

The i386 platform has four separate installation disk images to choose fromr:

  * floppy32.fs (Desktop PC) supports many PCI and ISA NICs, IDE and simple
    SCSI adapters and some PCMCIA support.
  * floppyB32.fs (Servers) supports many RAID controllers, and some of the less
    common SCSI adapters. However, support for many standard SCSI adapters and
    many EISA and ISA NICS has been removed.
  * floppyC32.fs (Laptops) supports the Cardbus and PCMCIA devices found in
a1648 12
  * cdrom32.fs it is, in effect a combination of all three boot disks. It can
    be used to make a bootable 2.88M floppy, or more commonly, as a boot image
    for a recordable CD.

Most i386 users will just use the floppy32.fs installation floppy. Yes, there
may be situations where one install disk is required to support your SCSI
adapter and another disk is required to support your network adapter.
Fortunately, this is a rare event, and can usually be worked around.

Once you have the correct floppy image, you need to get a clean floppy disk. If
there are ANY bad sectors on the floppy disk, the installation will most likely
fail.
d1650 1
a1650 1
4.1.3.1 - Creating floppies on Unix.
d1652 19
a1670 2
To create a formatted floppy, use the fdformat(1) command to both format and
check for bad sectors.
d1672 1
a1672 3
  # fdformat /dev/fd0a                                                           
  Format 1440K floppy `/dev/fd0a'? (y/n): y                                      
  processing VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV done.                      
d1674 1
a1674 3
If your output is like the above example, then your disk is OK. However, if you
do not see ALL "V"'s then your disk is most likely bad, and you should try a
new one.
d1676 3
a1678 3
Once you have a clean, formatted floppy it is time to write the installation
image to floppy. For this, you can use the dd(1) utility. An example usage of
dd(1) is below:
d1680 1
a1680 1
  # dd if=floppy32.fs of=/dev/rfd0c bs=32k                                       
d1682 1
a1682 3
Once the image is written, check to make sure that the copied image is the same
as the original with the cmp(1) command. If the diskette is identical to the
image, you will just see another prompt.
d1684 2
a1685 1
  # cmp /dev/rfd0c floppy32.fs                                                   
d1687 2
a1688 1
4.1.3.2 - Creating floppies on DOS/Windows.
d1690 3
a1692 4
If you are creating this image on the Windows/DOS platform you can get tools
mentioned below from the tools directory on any of the ftp mirrors, or in 3.2/
tools directory on CD1 of the OpenBSD CD set. For users of DOS/Windows 9x,
rawrite can be used to write your boot floppy.
d1694 3
a1696 2
To prepare a floppy in MS-DOS or Windows, simply use the native formatting
tools.
d1698 2
a1699 2
To write the installation image to the prepared floppy you can use rawrite,
fdimage, or ntrw. rawrite will not work on Windows NT, 2000 or XP.
d1701 1
a1701 5
Note that FDIMAGE.EXE and RAWRITE.EXE are both MS-DOS applications, and thus,
are limited to DOS's "8.3" file naming convention. As floppy32B.fs and
floppy32C.fs have longer file name, you will have to find out how your system
stored the file in "8.3 format" before using FDIMAGE.EXE or RAWRITE.EXE to make
your boot floppies.
d1703 3
a1705 1
Example usage of rawrite:
d1707 1
a1707 6
  C:\> rawrite                                                                   
  RaWrite 1.2 - Write disk file to raw floppy diskette                           
                                                                                 
  Enter source file name: floppy32.fs                                            
  Enter destination drive: a                                                     
  Please insert a formatted diskette into drive A: and press -ENTER- : Enter     
d1709 1
a1709 1
Example Usage of fdimage:
d1711 2
a1712 1
  C:\> fdimage -q floppy32.fs a:                                                 
d1714 2
a1715 1
Example Usage of ntrw:
d1717 1
a1717 4
  C:\> ntrw floppy32.fs a:                                                       
  3.5", 1.44MB, 512 bytes/sector                                                 
  bufsize is 9216                                                                
  1474560 bytes written                                                          
d1719 4
a1722 1
4.1.4 - Booting OpenBSD Installation Images.
d1724 1
a1724 3
This section is initially broken down into architecture dependent sections for
popular architectures that OpenBSD supports. This is so we can properly
instruct each user on what to do on their respective platform.
d1726 1
a1726 1
Booting i386
d1728 8
a1735 8
Booting an install image on the i386 architecture is nothing new to most
people. If you are using the floppy disk, simply stick the floppy into your
floppy drive and boot your system. Your install image will automatically load
(assuming floppy boot is enabled in your BIOS). If you are planning on booting
from CD, you must go into your systems BIOS and set the boot options to allow
booting from CD. Some older BIOSs do not have this option, and you must use a
floppy for booting your installation image. Don't worry though, even if you
boot from floppy you can still install from the CD.
d1737 2
a1738 1
Booting sparc
d1740 1
a1740 2
NOTE: On the sparc64, only the sbus machines (Ultra 1, Ultra 2) are bootable
from floppy.
d1742 2
a1743 3
To boot from floppy, place your floppy disk with the OpenBSD installation image
on it into your floppy drive. Then use the following command to boot from your
floppy:
d1745 4
a1748 1
  ok boot floppy                                                                 
d1750 1
a1750 3
To boot from CD-ROM, place your OpenBSD CD-ROM disk into your drive. If your
Sun only has one CD-ROM drive, then just go to the boot prompt, where you can
'boot cdrom':
d1752 1
a1752 1
  ok boot cdrom                                                                  
d1754 2
a1755 6
Of course, this will only work in new command mode. If you are at the old
command mode prompt (a right arrow), type 'n' for the new command mode. (If you
are using an old sparc that is pre-sun4c, you probably don't have a new command
mode. In this case, you need to experiment.) If you have multiple CD-ROM
devices, you need to boot from the correct one. Try probe-scsi from the new
command mode.
d1757 1
a1757 8
  ok probe-scsi                                                                  
                                                                                 
  Target 0                                                                       
    Unit 0   Disk     QUANTUM LIGHTNING 365S                                     
  Target 1                                                                       
    Unit 0   Removable Disk     QUANTUM EMPIRE_1080S                             
  Target 3                                                                       
    Unit 0   Removable Disk     Joe's CD ROMs                                    
d1759 1
a1759 2
Figure out which disk is the CD ROM you want to boot from. Note the target
number.
d1761 4
a1764 1
  ok boot /sbus/esp/sd@@X,0                                                       
d1766 4
a1769 1
4.2 - Preinstallation Checklist
d1771 3
a1773 2
Before you start your install, you should have some idea what you want to end
up with. You will want to know the following items, at least:
d1775 2
a1776 19
  * Machine Name
  * Hardware installed and available
      + Verify compatibility with your platform's hardware compatibility page
      + If ISA, you also need to know hardware settings, and confirm they are
        as OpenBSD requires.
  * Install method to be used (CDROM, FTP, etc.)
  * Desired disk layout
      + Does existing data need to be saved elsewhere?
      + Will OpenBSD co-exist on this system with another OS? If so, how both
        will be booted? Will you need to install a "boot manager"?
      + Will the entire disk be used for OpenBSD, or will an existing (or
        future) partition have to be worked around?
      + How do you wish to sub-partition the OpenBSD part of your disk?
  * Network settings, if not using DHCP:
      + Domain Name
      + Domain Name Server(s) (DNS servers)
      + IP addresses and subnet masks for each NIC
      + Gateway address
  * Will you be running X on this system?
d1778 1
a1778 1
4.3 - Starting the Install
d1782 10
a1791 3
into memory. The most common problem when booting is a bad floppy disk or a
drive alignment problem. The boot floppy is quite tightly packed -- any bad
spot will cause problems.
d1795 2
a1796 4
telling you what devices have been found, and where. Don't worry about
remembering this text, as a copy is saved as /var/run/dmesg.boot. On most
architectures, SHIFT+PGUP will let you examine text that has scrolled off the
screen.
d1800 3
a1802 3
  rootdev=0x1100 rrootdev=0x2f00 rawdev=0x2f02                                   
  erase ^?, werase ^W, kill ^U, intr ^C, status ^T                               
  (I)nstall, (U)pgrade or (S)hell? i                                             
d1804 2
a1805 2
And with that, we reach our first question. Most of the time, you have the
three options shown:
d1807 3
a1809 1
  * Install: load OpenBSD onto the system, overwriting whatever may have been
d1814 15
a1828 11
    overwrite any configuration information, user data, or additional programs.
    No disk formatting is done, nor are the /etc or /var directories
    overwritten. You will not be given the option of installing the etc32.tgz
    file. After the install, you will have to manually merge the changes of
    etc32.tgz into your system before you can expect it to be fully functional.
    This is an important step which must be done, as otherwise certain key
    services (such as pf(4)) may not start.
    NOTE: The Upgrade process is not designed to skip releases! While this will
    often work, it is not supported. For OpenBSD 3.2, upgrading 3.1 to 3.2 is
    the only supported upgrade. If you have to upgrade from an older version, a
    complete reinstall is recommended.
d1831 2
a1832 1
    allow you to do maintenance to the system.
d1834 1
a1834 44
On occasion, you will not see the "Upgrade" option listed. After a flag day
event, it is not possible to directly upgrade, one must rebuild the system from
scratch. An example of this in OpenBSD 3.2 is the Sparc platform, which
switched executable formats from a.out to ELF, and so a user upgrading to 3.2
on their Sparc must completely reload their system.

In this example, we will do an install, but the upgrade process is similar.

  Welcome to the OpenBSD/i386 3.2 install program.                               
                                                                                 
  This program will help you install OpenBSD in a simple and rational way. At    
  any prompt except password prompts you can run a shell command by typing       
  '!foo', or escape to a shell by typing '!'. Default answers are shown in []'s  
  and are selected by pressing RETURN. At any time you can exit this program by  
  pressing Control-C and then RETURN, but quitting during an install can leave   
  your system in an inconsistent state.                                          
                                                                                 
  Specify terminal type: [vt220]                                                 
  Do you wish to select a keyboard encoding table? [n] y                         

In most cases, the default terminal type is appropriate, however if you are
using a serial console for install, don't just take the default, respond
appropriately.

If you do not select a keyboard encoding table, a US keyboard layout will be
assumed.

  IS YOUR DATA BACKED UP? As with anything that modifies disk contents, this     
  program can cause SIGNIFICANT data loss.                                       
                                                                                 
  It is often helpful to have the installation notes handy. For complex disk     
  configurations, relevant disk hardware manuals and a calculator are useful.    
                                                                                 
  Proceed with install? [n] y                                                    

If you take the default here, the install process will terminate and drop you
to a shell prompt.

4.3.1 - Setting up disks during installation.

Setting up disks in OpenBSD varies a bit between platforms. For i386 and macppc
, disk setup is done in two stages. First, the OpenBSD slice of the hard disk
is defined using fdisk(8), then that slice is subdivided into OpenBSD
partitions using disklabel(8).
d1836 1
a1836 716
Some users may be a little confused by the terminology used here. It will
appear we are using the word "partition" in two different ways. This
observation is correct. There are two layers of partitioning in several OpenBSD
platforms, the first, one could consider the Operating System partitioning,
which is how multiple OSs on one computer mark out their own space on the disk,
and the second one is how the OpenBSD partition is sub-partitioned into
individual filesystems. The first layer is visible as a disk partition to DOS,
Windows, and any other OS that can coexist with other Operating Systems on the
IBM AT descended machines. The second layer of partitioning is visible only to
OpenBSD and those OSs which can directly read an OpenBSD filesystem.

  Cool!  Let's get to it...                                                      
                                                                                 
  You will now initialize the disk(s) that OpenBSD will use. To enable all       
  available security features you should configure the disk(s) to allow the      
  creation of separate filesystems for /, /tmp, /var, /usr, and /home.           
                                                                                 
  Available disks are: wd0.                                                      
  Which one is the root disk? (or done) [wd0] Enter                              

The root disk is the disk the system will boot from, and normally where swap
space resides. Usually, this will be the default -- if it isn't, you will need
to know how to force your computer to boot from a non-standard disk. IDE disks
will show up as wd0, wd1, etc., SCSI disks and RAID devices will show up as
sd0, sd1, and so on. All the disks OpenBSD can find are listed here -- if you
have drives which are not showing up, you have unsupported or improperly
configured hardware.

  Do you want to use *all* of wd0 for OpenBSD? [no] Enter                        

If you say "yes" to this question, the entire disk will be allocated to
OpenBSD. This will result in a simple Master Boot Record and partition table
being written out to disk -- one partition, the size of the entire hard disk,
set to the OpenBSD partition type, and flagged as the bootable partition. This
will be a common option for most production uses of OpenBSD, however, there are
some systems this should not be done on. Many Compaq systems, some Dell and
other systems use a "maintenance" partition, which should be kept intact. If
your system has any other partitions of any type you do not wish to erase, do
not select "yes" to the above question.

For the sake of this example, we will assume the disk is to be split between
OpenBSD and a pre-existing Windows 2000 partition, so we take the default of
"no", which will take us into the fdisk(8) program. You can also get more
information on fdisk(8) here.

Important Note: Users with a large hard disk (larger than 8G on a newer i386,
though on older machines and different platforms, often much smaller) will want
to see this section before going any further.

  Your will now create a single MBR partition to contain your OpenBSD data. This 
  partition must have an id of 'A6'; must *NOT* overlap other partitions; and    
  must be marked as the only active partition.                                   
                                                                                 
  The 'manual' command describes all the fdisk commands in detail.               
                                                                                 
  Disk: wd0       geometry: 2586/240/63 [39100320 Sectors]                       
  Offset: 0       Signature: 0xAA55                                              
           Starting       Ending       LBA Info:                                 
   #: id    C   H  S -    C   H  S [       start:      size   ]                  
  ------------------------------------------------------------------------       
  *0: 06    0   1  1 -  202 239 63 [          63:     3069297 ] DOS > 32MB       
   1: 00    0   0  0 -    0   0  0 [           0:           0 ] unused           
   2: 00    0   0  0 -    0   0  0 [           0:           0 ] unused           
   3: 00    0   0  0 -    0   0  0 [           0:           0 ] unused           
  Enter 'help' for information                                                   
  fdisk: 1> help                                                                 
          help            Command help list                                      
          manual          Show entire OpenBSD man page for fdisk                 
          reinit          Re-initialize loaded MBR (to defaults)                 
          setpid          Set the identifier of a given table entry              
          disk            Edit current drive stats                               
          edit            Edit given table entry                                 
          flag            Flag given table entry as bootable                     
          update          Update machine code in loaded MBR                      
          select          Select extended partition table entry MBR              
          print           Print loaded MBR partition table                       
          write           Write loaded MBR to disk                               
          exit            Exit edit of current MBR, without saving changes       
          quit            Quit edit of current MBR, saving current changes       
          abort           Abort program without saving current changes           
  fdisk: 1>                                                                      

A few commands are worthy of elaboration:

  * r or reinit: Clears existing partition table, makes one big OpenBSD
    partition, flags it active. Equivalent to saying "yes" to the "use *all* of
    ..." question.
  * p or print: Displays the current partition table in sectors. "p m" will
    show the partition table in megabytes, "p g" will show it in gigabytes.
  * e or edit: edit or alter a table entry.
  * f or flag: Marks a partition as the active partition, the one that will be
    booted from
  * exit and quit: Careful on these, as some users are used to "exit" and
    "quit" having opposite meanings.

It is worth pointing out once again, a screwup here will result in significant
data loss. If you are going to do this on a drive with important data, it might
be worth practicing on a "disposable" drive, in addition to having a good
backup.

Our drive here has a 1.5G partition for Windows 2000 (using the FAT
filesystem). Looking at the info from the above display, we can see that the
Windows partition occupies through cylinder 202 on the drive. So, we are going
to allocate the rest of the disk to OpenBSD, starting at cylinder 203. You
could also calculate OpenBSD's starting sector of 3069360 by adding the
existing partition's starting sector (63) and its size (3069297).

You can edit the drive layout in either by Cylinder/Heads/Sectors form or just
raw sectors. Which is easier depends upon what you are doing, in this case,
working around an existing partition, using CHS format will probably be easier.

  fdisk: 1> e 1                                                                  
           Starting       Ending       LBA Info:                                 
   #: id    C   H  S -    C   H  S [       start:      size   ]                  
  ------------------------------------------------------------------------       
   1: 00    0   0  0 -    0   0  0 [           0:           0 ] unused           
  Partition id ('0' to disable)  [0 - FF]: [0] (? for help) a6                   
  Do you wish to edit in CHS mode? [n] y                                         
  BIOS Starting cylinder [0 - 2585]: [0] 203                                     
  BIOS Starting head [0 - 239]: [0] Enter                                        
  BIOS Starting sector [1 - 63]: [0] 1                                           
  BIOS Ending cylinder [0 - 2585]: [0] 2585                                      
  BIOS Ending head [0 - 239]: [0] 239                                            
  BIOS Ending sector [1 - 63]: [0] 63                                            
  fdisk:*1> p                                                                    
  Disk: wd0       geometry: 2586/240/63 [39100320 Sectors]                       
  Offset: 0       Signature: 0xAA55                                              
           Starting       Ending       LBA Info:                                 
   #: id    C   H  S -    C   H  S [       start:      size   ]                  
  ------------------------------------------------------------------------       
  *0: 06    0   1  1 -  202 239 63 [          63:     3069297 ] DOS > 32MB       
   1: A6  203   0  1 - 2585 239 63 [     3069360:    36030960 ] OpenBSD          
   2: 00    0   0  0 -    0   0  0 [           0:           0 ] unused           
   3: 00    0   0  0 -    0   0  0 [           0:           0 ] unused           
  fdisk:*1> p m                                                                  
  Disk: wd0       geometry: 2586/240/63 [19092 Megabytes]                        
  Offset: 0       Signature: 0xAA55                                              
           Starting       Ending       LBA Info:                                 
   #: id    C   H  S -    C   H  S [       start:      size   ]                  
  ------------------------------------------------------------------------       
  *0: 06    0   1  1 -  202 239 63 [          63:        1499M] DOS > 32MB       
   1: A6  203   0  1 - 2585 239 63 [     3069360:       17593M] OpenBSD          
   2: 00    0   0  0 -    0   0  0 [           0:           0M] unused           
   3: 00    0   0  0 -    0   0  0 [           0:           0M] unused           
  fdisk:*1>                                                                      

Note that prompt changed to include an asterisk ('*') to indicate you have
unsaved changes. As we can see from the output of p m we have not altered our
Windows partition, we have successfully allocated the rest of the drive for
OpenBSD, and the partitions do not overlap. We are in business. Almost.

What we haven't done is flagged the partition as active so the machine will
boot OpenBSD on the next reboot:

  fdisk:*1> f 1                                                                  
  Partition 1 marked active.                                                     
  fdisk:*1> p                                                                    
  Disk: wd0       geometry: 2586/240/63 [39100320 Sectors]                       
  Offset: 0       Signature: 0xAA55                                              
           Starting       Ending       LBA Info:                                 
   #: id    C   H  S -    C   H  S [       start:      size   ]                  
  ------------------------------------------------------------------------       
   0: 06    0   1  1 -  202 239 63 [          63:     3069297 ] DOS > 32MB       
  *1: A6  203   0  1 - 2585 239 63 [     3069360:    36030960 ] OpenBSD          
   2: 00    0   0  0 -    0   0  0 [           0:           0 ] unused           
   3: 00    0   0  0 -    0   0  0 [           0:           0 ] unused           
  fdisk:*1>                                                                      

And now, we are ready to save our changes:

  fdisk:*1> w                                                                    
  Writing MBR at offset 0.                                                       
  wd0: no disk label                                                             
  fdisk: 1> q                                                                    

Creating a disklabel

The next step is to use disklabel(8) to slice up the OpenBSD partition. More
details on using disklabel(8) can be found in FAQ 14, disklabel.

  Here is the partition information you chose:                                      
                                                                                    
  Disk: wd0       geometry: 2586/240/63 [39100320 Sectors]                          
  Offset: 0       Signature: 0xAA55                                                 
           Starting       Ending       LBA Info:                                    
   #: id    C   H  S -    C   H  S [       start:      size   ]                     
  ------------------------------------------------------------------------          
  *0: 06    0   1  1 -  202 239 63 [          63:     3069297 ] DOS > 32MB          
   1: A6  203   0  1 - 2585 239 63 [     3069360:    36030960 ] OpenBSD             
   2: 00    0   0  0 -    0   0  0 [           0:           0 ] unused              
   3: 00    0   0  0 -    0   0  0 [           0:           0 ] unused              
                                                                                    
  You will now create an OpenBSD disklabel inside the OpenBSD MBR                   
  partition. The disklabel defines how OpenBSD splits up the MBR partition          
  into OpenBSD partitions in which filesystems and swap space are created.          
                                                                                    
  The offsets used in the disklabel are ABSOLUTE, i.e. relative to the              
  start of the disk, NOT the start of the OpenBSD MBR partition.                    
                                                                                    
  disklabel: no disk label                                                          
  WARNING: Disk wd0 has no label. You will be creating a new one.                   
                                                                                    
  # using MBR partition 1: type A6 off 3069360 (0x2ed5b0) size 36030960 (0x225c9f0) 
                                                                                    
  Treating sectors 3069360-39100320 as the OpenBSD portion of the disk.             
  You can use the 'b' command to change this.                                       
                                                                                    
  Initial label editor (enter '?' for help at any prompt)                           
  > ?                                                                               
  Available commands:                                                               
          p [unit]  - print label.                                                  
          M         - show entire OpenBSD man page for disklabel.                   
          e         - edit drive parameters.                                        
          a [part]  - add new partition.                                            
          b         - set OpenBSD disk boundaries.                                  
          c [part]  - change partition size.                                        
          d [part]  - delete partition.                                             
          D         - set label to default.                                         
          g [d|b]   - Use [d]isk or [b]ios geometry.                                
          m [part]  - modify existing partition.                                    
          n [part]  - set the mount point for a partition.                          
          r         - recalculate free space.                                       
          u         - undo last change.                                             
          s [path]  - save label to file.                                           
          w         - write label to disk.                                          
          q         - quit and save changes.                                        
          x         - exit without saving changes.                                  
          X         - toggle expert mode.                                           
          z         - zero out partition table.                                     
          ? [cmnd]  - this message or command specific help.                        
  Numeric parameters may use suffixes to indicate units:                            
          'b' for bytes, 'c' for cylinders, 'k' for kilobytes, 'm' for megabytes,   
          'g' for gigabytes or no suffix for sectors (usually 512 bytes).           
          Non-sector units will be rounded to the nearest cylinder.                 
  Entering '?' at most prompts will give you (simple) context sensitive help.       
  >                                                                                 

Again, a few of these commands could use a little elaboration:

  * p - displays (prints) the current disklabel to the screen, and you can use
    the modifiers k, m or g for kilobytes, megabytes or gigabytes.
  * D - Clears any existing disklabel, creates a new default disklabel which
    covers just the current OpenBSD partition. This can be useful if the disk
    previously had a disklabel on it, and the OpenBSD partition was recreated
    to a different size -- the old disk label may not get deleted, and may
    cause confusion.
  * m - Modifies an existing entry in a disklabel. Do not over estimate what
    this will do for you. While it may alter the size of a disklabel partition,
    it will NOT alter the filesystem on the drive. Using this option and
    expecting it to resize existing partitions is a good way of losing large
    amounts of data.

Slicing up your disk properly is important. The answer to the question, "How
should I partition my system?" is "Exactly how you need it". This will vary
from application to application. There is no universal answer. If you are
unsure of how you want to partition your system, see this discussion.

In this system, we have over 17G available for OpenBSD. That's a lot of space,
and it isn't likely we will need most of it. So, we will deliberately not use
absolute minimum sizes. We would rather have a few hundred megabytes of unused
space than a kilobyte too little.

On the root disk, the two partitions 'a' and 'b' must be created. The
installation process will not proceed until these two partitions are available.
'a' will be used for the root filesystem (/) and 'b' will be used as swap
space.

After a little thought, we decide to create just enough partitions to allow the
creation of the recommended separate filesystems (/, /tmp, /var, /usr, /home)
along with a swap partition:

  * wd0a: / (root) - 150M. Should be more than enough.
  * wd0b: (swap) - 300M.
  * wd0d: /tmp - 120M. /tmp is used for building some software, 120M will
    probably be enough for most things.
  * wd0e: /var - 80M. If this were to be a web or mail server, we'd have made
    this partition much larger, but, that's not what we are doing.
  * wd0g: /usr - 2G. We want this partition to be large enough to load quite a
    few user applications, plus be able to update and rebuild the system if
    desired or needed. The Ports tree will be here as well, which will take
    almost 100M of this space before ports are built.
  * wd0h: /home - 4G. This will allow plenty of user file space.

Now, if you add those up, you will see over 10G of space is unused! Unused
space won't hurt anything, and it gives us flexibility to enlarge things in the
future if need be. Need more /tmp? No problem, create a new one in the unused
space, change /etc/fstab and problem solved.

  > p m                                                                          
  device: /dev/rwd0c                                                             
  type: ESDI                                                                     
  disk: ESDI/IDE disk                                                            
  label: ST320011A                                                               
  bytes/sector: 512                                                              
  sectors/track: 63                                                              
  tracks/cylinder: 16                                                            
  sectors/cylinder: 1008                                                         
  cylinders: 16383                                                               
  total sectors: 39102336                                                        
  free sectors: 36030960                                                         
  rpm: 3600                                                                      
                                                                                 
  16 partitions:                                                                 
  #        size   offset    fstype   [fsize bsize   cpg]                         
    a: 17593.2M  1498.7M    unused        0     0                                
    c: 19092.9M     0.0M    unused        0     0                                
    i:  1498.7M     0.0M     MSDOS                                               
  > d a                                                                          
  > a a                                                                          
  offset: [3069360] Enter                                                        
  size: [36030960] 150M                                                          
  Rounding to nearest cylinder: 307440                                           
  FS type: [4.2BSD] Enter                                                        
  mount point: [none] /                                                          
  > a b                                                                          
  offset: [3376800] Enter                                                        
  size: [35723520] 300M                                                          
  Rounding to nearest cylinder: 614880                                           
  FS type: [swap] Enter                                                          
  > a d                                                                          
  offset: [3991680] Enter                                                        
  size: [35108640] 120m                                                          
  Rounding to nearest cylinder: 245952                                           
  FS type: [4.2BSD] Enter                                                        
  mount point: [none] /tmp                                                       
  > a e                                                                          
  offset: [4237632] Enter                                                        
  size: [34862688] 80m                                                           
  Rounding to nearest cylinder: 164304                                           
  FS type: [4.2BSD] Enter                                                        
  mount point: [none] /var                                                       
  > a g                                                                          
  offset: [4401936] Enter                                                        
  size: [34698384] 2g                                                            
  Rounding to nearest cylinder: 4194288                                          
  FS type: [4.2BSD] Enter                                                        
  mount point: [none] /usr                                                       
  > a h                                                                          
  offset: [8596224] Enter                                                        
  size: [30504096] 4g                                                            
  Rounding to nearest cylinder: 8388576                                          
  FS type: [4.2BSD] Enter                                                        
  mount point: [none] /home                                                      
  > p m                                                                          
  device: /dev/rwd0c                                                             
  type: ESDI                                                                     
  disk: ESDI/IDE disk                                                            
  label: ST320011A                                                               
  bytes/sector: 512                                                              
  sectors/track: 63                                                              
  tracks/cylinder: 16                                                            
  sectors/cylinder: 1008                                                         
  cylinders: 16383                                                               
  total sectors: 39102336                                                        
  free sectors: 22115520                                                         
  rpm: 3600                                                                      
                                                                                 
  16 partitions:                                                                 
  #        size   offset    fstype   [fsize bsize   cpg]                         
    a:   150.1M  1498.7M    4.2BSD     1024  8192    16  # /                     
    b:   300.2M  1648.8M      swap                                               
    c: 19092.9M     0.0M    unused        0     0                                
    d:   120.1M  1949.1M    4.2BSD     1024  8192    16  # /tmp                  
    e:    80.2M  2069.2M    4.2BSD     1024  8192    16  # /var                  
    g:  2048.0M  2149.4M    4.2BSD     1024  8192    16  # /usr                  
    h:  4096.0M  4197.4M    4.2BSD     1024  8192    16  # /home                 
    i:  1498.7M     0.0M     MSDOS                                               
  > q                                                                            
  Write new label?: [y] Enter                                                    

You will note there is a c partition we seem to have ignored. This partition is
your entire hard disk, don't attempt to alter it. You will also note the i
partition wasn't defined by us, this is the pre-existing Windows 2000
partition. partitions are not assigned any particular letters -- with the
exception of a (root), b (swap) and c (entire disk), the rest of the partitions
(through letter p) are available for use as you desire.

If you look closely at the output of the disklabel, you will note that your
drive RPM rating is probably wrong. This is historical, the drive speed is not
used in any way by the system, do not worry about it.

Configuring your mount points and formating your filesystems

Now comes the final setup of your mount points. If you configured the mount
points through disklabel(8), this step consists of just verifying your
selections, otherwise, you can specify them now.

  The root filesystem will be mounted on wd0a.                                   
  wd0b will be used for swap space.                                              
  Mount point for wd0d (size=122976k), none or done? [/tmp] Enter                
  Mount point for wd0e (size=82152k), none or done? [/var] Enter                 
  Mount point for wd0g (size=2097144k), none or done? [/usr] Enter               
  Mount point for wd0h (size=4194288k), none or done? [/home] Enter              
  Mount point for wd0d (size=122976k), none or done? [/tmp] done                 
  Done - no available disks found.                                               
                                                                                 
  You have configured the following partitions and mount points:                 
                                                                                 
  wd0a /                                                                         
  wd0d /tmp                                                                      
  wd0e /var                                                                      
  wd0g /usr                                                                      
  wd0h /home                                                                     
                                                                                 
  The next step creates a filesystem on each partition, ERASING existing data.   
  Are you really sure that you're ready to proceed? [n] y                        
  /dev/rwd0a:     307440 sectors in 305 cylinders of 16 tracks, 63 sectors       
          150.1MB in 20 cyl groups (16 c/g, 7.88MB/g, 1920 i/g)                  
  /dev/rwd0d:     245952 sectors in 244 cylinders of 16 tracks, 63 sectors       
          120.1MB in 16 cyl groups (16 c/g, 7.88MB/g, 1920 i/g)                  
  /dev/rwd0e:     164304 sectors in 163 cylinders of 16 tracks, 63 sectors       
          80.2MB in 11 cyl groups (16 c/g, 7.88MB/g, 1920 i/g)                   
  /dev/rwd0g:     4194288 sectors in 4161 cylinders of 16 tracks, 63 sectors     
          2048.0MB in 261 cyl groups (16 c/g, 7.88MB/g, 1920 i/g)                
  /dev/rwd0h:     8388576 sectors in 8322 cylinders of 16 tracks, 63 sectors     
          4096.0MB in 521 cyl groups (16 c/g, 7.88MB/g, 1920 i/g)                
  /dev/wd0a on /mnt type ffs (rw, asynchronous, local, ctime=Thu Oct 10 21:      
  50:36 2 002)                                                                   
  /dev/wd0h on /mnt/home type ffs (rw, asynchronous, local, nodev, nosuid,       
   ctime=Thu Oct 10 21:50:36 2002)                                               
  /dev/wd0d on /mnt/tmp type ffs (rw, asynchronous, local, nodev, nosuid,        
  ctime=Thu Oct 10 21:50:36 2002)                                                
  /dev/wd0g on /mnt/usr type ffs (rw, asynchronous, local, nodev, ctime=Th       
  u Oct 10 21:50:36 2002)                                                        
  /dev/wd0e on /mnt/var type ffs (rw, asynchronous, local, nodev, nosuid,        
  ctime=Th u Oct 10 21:50:36 2002)                                               

You may wonder why the installer again asks for mount points. This allows you
to recover from any errors or omissions in the mount points specified during
the creation of the disklabel. For instance, the installation process will
automatically delete any duplicate mount points you enter during the
configuration of the disklabel. The disklabel program will allow you to enter
such duplicates, and thus they must be checked for after the disklabel program
exits. The deleted duplicate mount points will result in partitions without
mount points, that you must assign new mount points for if you wish to use the
space.

Notice the "Are you really sure that you are ready to proceed?" question
defaults to no, so you will have to deliberately tell it to proceed and format
your partitions. If you chose no, you would simply be dropped into a shell and
could start the install again by typing install, or just by rebooting again
with your boot disk.

At this point all filesystems will formatted for you. This could take some time
depending on the size of the partitions and the speed of the disk.

4.3.2 - Setting the System Hostname

Now you must set the system hostname. This value will be saved in the file /etc
/myname, which is used during normal boots to set the hostname of the system.
As of OpenBSD 3.2 the name stored in /etc/myname includes the fully qualified
domain name of the system (FQDN). If you do not set the FQDN of the system, the
default value of 'my.domain' will be used.

It is important to set this name now, because it will be used when the
cryptographic keys for the system are generated during the first boot after
installation. This generation takes place whether the network is configured or
not.

  Enter system hostname (short form, e.g. 'foo'): puffy                          

4.3.3 - Configuring your Network

Now it is time to configur your network. The network must be configured if you
are planning on doing a ftp or nfs based install, considering it will be based
upon the information you are about to enter. Here is a walk through of the
network configuration section of the install process.

  Configure the network? [y] Enter                                               
                                                                                 
  If any interface will be configured by DHCP, you should not enter              
  information that will be supplied via DHCP, e.g. the DNS domain name.          
                                                                                 
  Enter DNS domain name (e.g. 'bar.com'): [my.domain] example.com                
  Available interfaces are: fxp0.                                                
  Which one do you wish to initialize? (or done) [fxp0] Enter                    
  IP address for fxp0 (or 'dhcp')? 199.185.137.55                                
  Symbolic (host) name? [puffy] Enter                                            
  Netmask? [255.255.255.0] Enter                                                 
  The default media for fxp0 is                                                  
          media: Ethernet autoselect (100baseTX full-duplex)                     
  Do you want to change the default media? [n] Enter                             
  Done - no available interfaces found.                                          
  Enter IP address of default route: [none] 199.185.137.128                      
  Enter IP address of primary nameserver: [none] 199.185.137.1                   
  Would you like to use the nameserver now? [y] Enter                            
  Do you want to do more, manual, network configuration? [n] Enter               

In the above example, we use a static IP address. You can choose to use dhcp as
well if you wish. In the case of DHCP, most of this information will be grabbed
from a remote dhcp server, though you will be given a chance to confirm it.

NOTE: Only one interface can easily be configured using DHCP during an install.
If you attempt to configure more than one interface using DHCP you will
encounter errors. You have to manually configure the additional interfaces
after the installation.

4.3.4 - Choosing Installation Media

After your network is setup, the install script will give you a chance to make
manual adjustments to the configuration. Then the filesystems you created will
be mounted and a root password set. This will get your local disks ready for
the OpenBSD packages to be installed upon them.

Next, you will get a chance to choose your installation media. The options are
listed below.

  You will now specify the location and names of the install sets you want to    
  load. You will be able to repeat this step until all of your sets have been    
  successfully loaded. If you are not sure what sets to install, refer to the    
  installation notes for details on the contents of each.                        
                                                                                 
  Sets can be located on a (m)ounted filesystem; a (c)drom, (d)isk or (t)ape     
  device; or a (f)tp, (n)fs or (h)ttp server.                                    
  Where are the install sets you want to use? (m, c, f, etc.) c                  
  Available CD-ROMs are: cd0.                                                    

In this example we are installing from CD-ROM. This will bring up a list of
devices on your computer identified as a CD-ROM. Most people will only have
one. If you you need to make sure you pick the device which you will use to
install OpenBSD from.

NOTE: All possible sources for install sets are listed, but not all may be
available on your system. e.g. (n)fs is shown but not all architectures allow
NFS installations. If you choose a source that is not available, you will get
an error message and be given the chance to choose another source for your
installation sets.

  Available CD-ROMs are: cd0.                                                    
  Which one contains the install media? (or done) [cd0] Enter                    
                                                                                 
  Enter the pathname where the sets are stored (or '?') [3.2/i386] Enter         

Here, you are prompted for which directory the installation files are, which is
3.2/i386/ on the official CDROM.

4.3.5 - Choosing Filesets.

Now it's time to choose which packages you will be installing. You can get a
description of these files in the next section. The files that the install
program finds will be shown to you on the screen. Your job is just to specify
which files you want. By default all the non-X packages are selected, however,
some people may wish to limit this to the bare minimum required to run OpenBSD,
which would be base32.tar.gz, etc32.tar.gz and bsd. Others will wish to install
all packages. The example below is that of a full install.

  The following sets are available. Enter a filename, 'all' to select            
  all the sets, or 'done'. You may de-select a set by prepending a '-'           
  to its name.                                                                   
                                                                                 
          [X] base32.tgz                                                         
          [X] etc32.tgz                                                          
          [X] misc32.tgz                                                         
          [X] comp32.tgz                                                         
          [X] man32.tgz                                                          
          [X] game32.tgz                                                         
          [ ] xbase32.tgz                                                        
          [ ] xshare32.tgz                                                       
          [ ] xfont32.tgz                                                        
          [ ] xserv32.tgz                                                        
          [X] bsd                                                                
                                                                                 
  File Name? (or 'done') [xbase32.tgz] all                                       
                                                                                 
  The following sets are available. Enter a filename, 'all' to select            
  all the sets, or 'done'. You may de-select a set by prepending a '-'           
  to its name.                                                                   
                                                                                 
          [X] base32.tgz                                                         
          [X] etc32.tgz                                                          
          [X] misc32.tgz                                                         
          [X] comp32.tgz                                                         
          [X] man32.tgz                                                          
          [X] game32.tgz                                                         
          [X] xbase32.tgz                                                        
          [X] xshare32.tgz                                                       
          [X] xfont32.tgz                                                        
          [X] xserv32.tgz                                                        
          [X] bsd                                                                

You can do all kinds of nifty things here -- -x* would remove all X components,
if you changed your mind. In this case, we are going to load all the sets.
While the system will run with fewer sets, the starting default is recommended.

Once you have successfully picked which packages you want, you will be prompted
to make sure you want to extract these packages and they will then be
installed. A progress bar will be shown that will keep you informed on how much
time it will take. The times range greatly depending on what system it is you
are installing OpenBSD on, the packages installed, and the speed of the source
media. This part may from a few minutes to several hours.

  File Name? (or 'done') [done] Enter                                            
  Ready to install sets? [y] Enter                                               
                                                                                 
  Getting base32.tgz ...                                                         
  100% |**************************************************| 23870 KB    00:15    
  Getting etc32.tgz ...                                                          
  100% |**************************************************|  1447 KB    00:01    
  Getting misc32.tgz ...                                                         
  100% |**************************************************|  1666 KB    00:00    
  Getting comp32.tgz ...                                                         
  100% |**************************************************| 16801 KB    00:12    
  Getting man32.tgz ...                                                          
  100% |**************************************************|  5428 KB    00:04    
  Getting game32.tgz ...                                                         
  100% |**************************************************|  2702 KB    00:01    
  Getting bsd ...                                                                
  100% |**************************************************|  4409 KB    00:01    
  Getting xbase32.tgz ...                                                        
  100% |**************************************************|  8837 KB    00:04    
  Getting xshare32.tgz ...                                                       
  100% |**************************************************|  1531 KB    00:02    
  Getting xfont32.tgz ...                                                        
  100% |**************************************************| 30664 KB    00:14    
  Getting xserv32.tgz ...                                                        
  100% |**************************************************| 14798 KB    00:05    
  Extract more sets? [n]                                                         

If your system has a small amount of RAM (less than 20M on i386), do not hit
return at that prompt quite yet!

4.3.6 - Special steps for machines with little RAM

As OpenBSD has grown, the minimum RAM requirement has grown, and is likely to
continue to increase. The next step in the install process will require more
than 16M RAM, and will fail on older machines with less than 20M RAM (again,
these are i386 numbers -- some other platforms will require far less RAM,
though this trick can be used with them as well, if they are running near the
lower-limits.

During the install process, there is normally no swap, the real RAM is all you
have. The 'MAKEDEV' step that follows will require more than the rest of the
install required. As a system with small amounts of RAM can still be very
usable for many applications, working around this limitation is a quite useful
trick.

The solution is to activate swap now. The swap partition has been created, the
files are installed to the hard disk, the only trick here is to manually invoke
it. So, do not just hit 'ENTER' at the above prompt, but rather, hit '!', which
will bring up a shell, and launch swapon(8) from the mounted hard drive:

  Extract more sets? [n] !                                                       
  Type 'exit' to return to install.                                              
  # /mnt/sbin/swapon /dev/wd0b                                                   
  total: 307440k bytes allocated = 0k used, 307440k available                    
  # exit                                                                         
  Extract more sets? [n] Enter                                                   

You can now resume the normal installation.

4.3.7 - Finishing up

You will now be asked if you plan to run X on this system. If you answer 'Y', /
etc/sysctl.conf will be modified to include the line machdep.allowaperture=1 or
machdep.allowaperture=2, depending on your platform.

Your last task is to enter the time zone. Depending on where your machine
lives, there are may be several equally valid answers for the question. In the
example that follows, we used US/Eastern, but could also have used EST5EDT or
US/Michigan and had the same result. Hitting ? at the prompts will guide you
through your choices.

  Extract more sets? [n] Enter                                                   
  Do you expect to run the X Window System? [y] y                                
  Saving configuration files......done.                                          
  Generating initial host.random file ......done.                                
  What timezone are you in? ('?' for list) [US/Pacific] ?                        
  Africa/      Chile/       GB-Eire      Israel       NZ-CHAT      Turkey        
  America/     Cuba         GMT          Jamaica      Navajo       UCT           
  Antarctica/  EET          GMT+0        Japan        PRC          US/           
  Arctic/      EST          GMT-0        Kwajalein    PST8PDT      UTC           
  Asia/        EST5EDT      GMT0         Libya        Pacific/     Universal     
  Atlantic/    Egypt        Greenwich    MET          Poland       W-SU          
  Australia/   Eire         HST          MST          Portugal     WET           
  Brazil/      Etc/         Hongkong     MST7MDT      ROC          Zulu          
  CET          Europe/      Iceland      Mexico/      ROK          posix/        
  CST6CDT      Factory      Indian/      Mideast/     Singapore    posixrules    
  Canada/      GB           Iran         NZ           SystemV/     right/        
  What timezone are you in? ('?' for list) [US/Pacific] US                       
  Select a sub-timezone of 'US' ('?' for list): ?                                
  Alaska          Central         Hawaii          Mountain        Samoa          
  Aleutian        East-Indiana    Indiana-Starke  Pacific                        
  Arizona         Eastern         Michigan        Pacific-New                    
  Select a sub-timezone of 'US' ('?' for list): Eastern                          
  You have selected timezone 'US/Eastern'.                                       

The last steps are for the system to create the /dev directory (which may take
a while on some systems, especially if you had to use the Small RAM trick
above), and install the boot blocks.

  Making all device nodes...done.                                                
  Installing boot block...                                                       
  boot: /mnt/boot                                                                
  proto: /usr/mdec/biosboot                                                      
  device: /dev/rwd0c                                                             
  /usr/mdec/biosboot: entry point 0                                              
  proto bootblock size 512                                                       
  room for 12 filesystem blocks at 0x16f                                         
  Will load 7 blocks of size 8192 each.                                          
  Using disk geometry of 63 sectors and 240 heads.                               
   0:  9 @@(203 150 55) (3078864-3078872)                                         
   1: 63 @@(203 151 1) (3078873-3078935)                                          
   2: 24 @@(203 152 1) (3078936-3078959)                                          
   3: 16 @@(203 8 47) (3069910-3069925)                                           
  /mnt/boot: 4 entries total                                                     
  using MBR partition 1: type 166 (0xa6) offset 3069360 (0x2ed5b0)               
  ...done.                                                                       
                                                                                 
  CONGRATULATIONS! Your OpenBSD install has been successfully completed!         
  To boot the new system, enter halt at the command prompt. Once the             
  system has halted, reset the machine and boot from the disk.                   
  # halt                                                                         
  syncing disks... done                                                          
                                                                                 
  The operating system has halted.                                               
  Please press any key to reboot.                                                
d1838 5
a1842 2
OpenBSD is now installed on your system and ready for its first boot, but
before you do...
d1844 4
a1847 1
Before you reboot
d1849 1
a1849 3
At this point, your system is installed and ready to be rebooted and configured
for service. Before doing this, however, it would be wise to check out the 
Errata page to see if there are any bugs that would immediately impact you.
d1851 3
a1853 1
After you reboot
d1855 1
a1855 1
One of your first things to read after you install your system is afterboot(8).
d1857 4
a1860 1
You may also find the following links useful:
d1862 2
a1863 6
  * Adding users in OpenBSD
  * Initial Network Setup
  * Man Pages of popular/useful commands
  * OpenBSD man pages on the Web
  * The OpenBSD Ports and Packages system for installing software, as well as 
    here and here
d1865 6
a1870 1
One last thing...
d1872 2
a1873 2
The OpenBSD developers ask you to Send in a copy of your dmesg. This is really
appreciated by the developers, and ultimately, all users.
d1875 7
a1881 1
4.3.8 - Other Information Resources
d1883 3
a1885 2
Additional documents already exist for those of you who might have special
needs or interests. You can retrieve these from any of the mirror ftp sites.
d1887 3
a1889 9
  * INSTALL.i386 - Comprehensive installation document. Similar documents exist
    for all platforms.
  * INSTALL.linux - Installing OpenBSD along with Linux.
  * INSTALL.mbr - Explaining the Master Boot Record.
  * INSTALL.pt - Explaining Partition Tables.
  * INSTALL.dbr - DOS Floppy Disk Boot Sector.
  * INSTALL.chs - Explaining CHS Translation.
  * INSTALL.ata - ATA/ATA-1/ATA-2/IDE/EIDE/etc FAQ
  * INSTALL.os2br - The os2 Boot Sector.
d1891 5
a1895 1
4.4 - What files are needed for Installation?
d1897 1
a1897 3
The complete OpenBSD installation is broken up into a number of separate file
sets. Not every application requires every file set. Here is an overview of
each:
d1899 2
a1900 11
  * base32.tgz - Contains the base OpenBSD system Required
  * etc32.tgz - Contains all the files in /etc Required
  * comp32.tgz - Contains the compiler and its tools, libs. Recommended
  * man32.tgz - Contains man pages Recommended
  * misc32.tgz - Contains misc info, setup documentation
  * game32.tgz - Contains the games for OpenBSD
  * xbase32.tgz - Contains the base install for X11
  * xfont32.tgz - Contains X11's font server and fonts
  * xserv32.tgz - Contains X11's X servers
  * xshare32.tgz - Contains manpages, locale settings, includes, etc for X
  * bsd - This is the Kernel. Required
d1902 3
a1904 1
4.5 - How much space do I need for an OpenBSD installation?
d1906 3
a1908 47
The following are minimum suggested filesystem sizes for a full system install.
The numbers include enough extra space to permit you to run a typical home
system that is connected to the Internet.

  * These are minimum values.
  * If you plan to install a significant amount of third party software, make
    your /usr partition large! At least triple these values!
  * For a system that handles lots of email or web pages (stored, respectively,
    in /var/mail and /var/www) you will want to make your /var partition
    significantly larger.
  * For a multiuser system which may generate lots of logs, you will still want
    to make your /var partition significantly larger (/var/log).
  * If you plan to rebuild the kernel or system from source, you will want to
    make the /usr partition significantly larger, at least 800M-1G larger than
    indicated below.

As you read this, keep in mind that /usr and /usr/X11R6 are usually both parts
of the same filesystem, that is, /usr, as there is no big advantage to making
them into separate filesystems.

    
    SYSTEM          /       /usr    /var    /usr/X11R6
    alpha           50M     250M    25M     100M
    amiga           40M     200M    25M     180M
    hp300           40M     200M    25M      80M
    i386            40M     200M    25M     140M
    mac68k          40M     200M    25M      80M
    macppc          50M     200M    25M     100M
    mvme68k         40M     200M    25M      80M
    sparc           40M     259M    25M      49M
    sparc64         50M     200M    25M     100M
    vax             75M     125M    25M     180M
    

In addition, it is recommended that a /tmp partition be used. The /tmp
partition is used in the compiling of ports, among other things, so how big you
make it depends on what you do with it. 50M may be plenty for most people, but
some large applications may require 100M or more of /tmp space.

When you are in the disklabel editor, you may choose to make your entire system
have just an 'a' (main filesystem) and 'b' (swap) . The 'a' filesystem which
you set up in disklabel will become your root partition, which should be the
sum of all the 3 main values above (/, /usr, and /var) plus some space for /
tmp. The 'b' partition you set up automatically becomes your system swap
partition -- we recommend a minimum of 32MB but if you have disk to spare make
it at least 64MB. If you have lots of disk space to spare, make this 256MB, or
even 512MB.
d1910 1
a1910 2
There are five main reasons for using separate filesystems, instead of shoving
everything into one or two filesystems:
d1912 3
a1914 19
  * Security: You can mark some filesystems as 'nosuid', 'nodev', 'noexec',
    'readonly', etc. This is now done by the install process, in fact, if you
    use the above described partitions.
  * Stability: A user, or a misbehaved program, can fill a filesystem with
    garbage if they have write permissions for it. Your critical programs,
    which of course run on a different filesystem, do not get interrupted.
  * Speed: A filesystem which gets written to frequently may get somewhat
    fragmented. (Luckily, the ffs filesystem, what OpenBSD uses, is not prone
    to heavy fragmentation.)
  * Integrity: If one filesystem is corrupted for some reason then your other
    filesystems are still OK.
  * Size: Many platforms have limits on the area of a disk where the boot ROM
    can load the kernel from. In some cases, this limit may be very small (504M
    for an older 486), in other cases, a much larger limit (8G on new i386
    systems). As the kernel can end up anywhere in the root partition, the
    entire root partition should be within this area. For more details, see 
    this section. A good guideline might be to keep your / partition completely
    below 2G, unless you know your platform (and particular machine!) can
    handle more (or less!) than that.
d1916 2
a1917 1
Some additional thoughts on partitioning:
d1919 4
a1922 33
  * For your first attempt at an experimentation system, one big / partition
    and swap may be easiest until you know how much space you need. By doing
    this you will be sacrificing some of the default security features of
    OpenBSD that require separate filesystems for /, /tmp, /var, /usr, and /
    home.
  * A system exposed to the Internet or other hostile forces should have a
    separate /var (and maybe even a separate /var/log) for logging.
  * A /home partition can be nice. New version of the OS? Wipe and reload
    everything else, leave your /home partition untouched.
  * A separate partition for anything which may accumulate a large quantity of
    files that may need to be deleted can be faster to reformat and recreate
    than to delete. See the upgrade-minifaq for an example (/usr/obj).
  * If you wish to rebuild your system from source for any reason, the source
    will be in /usr/src. If you don't make a separate partition for /usr/src,
    make sure /usr has sufficient space.
  * A commonly forgotten fact: you do not have to allocate all space on a drive
    when you set the system up! Since you will now find it a challenge to buy a
    new drive smaller than 20G, it can make sense to leave a chunk of your
    drive unallocated. If you outgrow a partition, you can allocate a new
    partition from your unused space, duplicate your existing partition to the
    new partition, change /etc/fstab to point to the new partition, remount,
    you now have more space.
  * If you make your partitions to close to the minimum size required, you will
    probably regret it later, when it is time to upgrade your system.

4.6 - Multibooting OpenBSD (i386, alpha)

OpenBSD and Windows NT/2000/XP

To multiboot OpenBSD and Windows NT/2000/XP), you can use NTloader, the
bootloader that NT uses. To multi-boot with NT, you need a copy of your OpenBSD
pbr. After running installboot, you can copy it something like this:
        # dd if=/dev/rsd0a of=openbsd.pbr bs=512 count=1
d1924 3
a1926 3
Now boot NT and put openbsd.pbr in C:. Add a line like this to the end of C:\
BOOT.INI:
        c:\openbsd.pbr="OpenBSD"
d1928 1
a1928 3
When you reboot, you should be able to select OpenBSD from the NT loader menu.
There is much more information available about NTloader at the NTLDR Hacking
Guide.
d1930 4
a1933 2
On Windows XP you can also edit the boot information using the GUI, see the XP
Boot.ini HOWTO.
d1935 7
a1941 1
OpenBSD and Windows or DOS (i386)
d1943 1
a1943 4
To boot OpenBSD along with Windows 3.1, Windows95, or DOS you must use a boot
loader on the system that can handle OpenBSD, Windows, and DOS! Some
bootloaders of choice are GAG, osbs20b8.zip or The Ranish Partition Manager.
Both of these are able to boot OpenBSD partitions.
d1945 3
a1947 1
OpenBSD and Linux (i386)
d1949 1
a1949 2
Please refer to INSTALL.linux, which gives in depth instructions on getting
OpenBSD working with Linux.
d1951 6
a1956 1
4.7 - Sending your dmesg to dmesg@@openbsd.org after the install
d1958 1
a1958 2
Just to remind people, it's important for the OpenBSD developers to keep track
of what hardware works, and what hardware doesn't work perfectly.
d1960 4
a1963 9
A quote from /usr/src/etc/root/root.mail
If you wish to ensure that OpenBSD runs better on your machines, please do us
a favor (after you have your mail system setup!) and type
        dmesg | mail dmesg@@openbsd.org
so that we can see what kinds of configurations people are running.  We will
use this information to improve device driver support in future releases.
(We would be much happier if this information was for the supplied GENERIC
kernel; not for a custom compiled kernel).  The device driver information
we get from this helps us fix existing drivers.
d1965 2
a1966 10
Make sure you send email from an account that is able to also receive email so
developers can contact you back if they have something they want you to test or
change in order to get your setup working. It's not important at all to send
the email from the same machine that is running OpenBSD, so if that machine is
unable to receive email, just
$ dmesg | mail your-account@@yourmail.dom
and then forward that message to
 dmesg@@openbsd.org
where your-account@@yourmail.dom is your regular email account. (or transfer the
dmesg output using ftp/scp/floppydisk/carrier-pigeon/...)
d1968 1
a1968 2
NOTE - Please send only GENERIC kernel dmesgs. Custom kernels that have device
drivers removed are not helpful.
d1970 4
a1973 1
4.8 - Adding a file set after install
d1975 2
a1976 1
"Oh no! I forgot to add a file set when I did the install!"
d1978 1
a1978 4
Sometimes, you realize you really DID need comp32.tgz (or any other system
component) after all, but you didn't realize this at the time you installed
your system. Good news: There are two easy ways to add file sets after the
initial install:
d1980 1
a1980 1
Using the Upgrade process
d1982 3
a1984 4
Simply boot your install media (CD-ROM or Floppy), and choose Upgrade (rather
than Install). When you get to the lists of file sets to install, choose the
sets you neglected to install first time around, select your source, and let it
install them for you.
d1986 3
a1988 1
Using tar(1)
d1990 4
a1993 2
The install file sets are simply compressed tar files, and you can expand them
manually from the root of the filesystem:
d1995 1372
a3366 2
  # cd /                                                                         
  # tar xzvpf comp32.tgz                                                         
d3371 4
a3374 3
One common mistake is to think you can use pkg_add(1) to add a missing file
sets. This does not work. pgk_add(1) is for package files, not generic tar
files like the install sets.
d3376 4
a3379 1
4.9 - What is 'bsd.rd'?
d3381 8
a3388 1
bsd.rd is a "RAM Disk" kernel. This file can be very useful, many developers
d3399 3
a3401 3
from it. On most platforms, if you have a running older version of OpenBSD, you
can FTP a new version of bsd.rd, reboot from it, and install a new version of
OpenBSD without using any removable media at all.
d3405 7
a3411 7
  Using Drive: 0 Partition: 3                                                    
  reading boot.....                                                              
  probing pc0 com0 com1 apm mem[639k 255M a20=on]                                
  disk fd0 hd0                                                                   
  >> OpenBSD/i386 BOOT 1.29                                                      
  boot> boot hd0a:/bsd.rd                                                        
. . . normal boot to install . . .                                               
d3413 2
a3414 2
As indicated, you will be brought to the install program, but you can also drop
to the shell to do maintenance on your system.
d3419 1
d3421 1
a3421 7
4.10 - Common Installation Problems

4.10.1 - Install hangs during MAKEDEV

Usually, this is caused by a lack of physical RAM in the system. See here.

4.10.2 - My Compaq only recognizes 16M RAM
d3424 2
a3425 2
the OpenBSD second stage boot loader properly, and only 16M may be detected and
used by OpenBSD. This can be corrected either by creating/editing /etc/
d3429 1
d3431 6
a3436 5
to add 48M (0x3000000) after the first 16M (0x1000000). Typically, if you had a
machine with this problem, you would enter the above command first at the
install floppy/CDROM's boot> prompt, load the system, reboot, and create a /etc
/boot.conf file with the above line in it so all future bootings will recognize
all available RAM.
d3440 1
a3440 1
4.10.3 - My i386 won't boot after install
d3447 14
a3460 8
    (bootable). See here and here
  * No valid boot loader was ever put on the disk. If you answer "Y" to the
    "Use entire disk for OpenBSD?" question during the install, or use the
    "reinit" option of fdisk(8), the OpenBSD boot record is installed on the
    Master Boot Record of the disk, otherwise, the existing master boot code is
    untouched. This will be a problem if no other boot record existed. The
    solution is to boot the install media again, drop to the shell and invoke 
    fdisk(8) and use the "update" option.
d3462 2
a3463 2
    loader install. Reinstalling the second stage boot loader is discussed here
    .
d3465 1
a3465 1
4.10.4 - My (older, slower) machine booted, but hung at the ssh-keygen steps
d3468 255
a3722 11
ssh key generation process. A SparcStation2 or a Macintosh Quadra may take 45
minutes or more to complete the three ssh-keygen(1) steps, some machines will
take even longer. Just let it finish, it is only done once per install.

[Back to Main Index] [To Section 3.0 - Obtaining OpenBSD] [To Section 5.0 -
Kernel configuration and Disk Setup]

-------------------------------------------------------------------------------
[back] www@@openbsd.org
$OpenBSD: obsd-faq.txt,v 1.33 2003/01/05 19:29:10 nick Exp $
[OpenBSD]
d3724 1
a3724 1
5 - Building the system from Source
d3726 1
a3726 1
-------------------------------------------------------------------------------
d3731 29
a3759 6
  * 5.2 - Why do I need a custom kernel?
  * 5.3 - Kernel configuration Options
  * 5.4 - Building your own kernel
  * 5.5 - Boot-time configuration
  * 5.6 - Getting more verbose output during boot
  * 5.7 - Using config(8) to change your kernel binary
d3761 1
a3761 1
-------------------------------------------------------------------------------
d3771 2
a3772 2
  * -current: The to-the-moment version of OpenBSD, which will turn into the
    next release.
d3776 1
a3776 1
           ,------o-----------o----X                    2.9 Stable
d3778 1
a3778 1
           |      .    ,------o---------o----X          3.0 Stable
d3780 1
a3780 1
           |      .    |      .    ,----o----------o--> 3.1 Stable
d3782 1
a3782 1
           |      .    |      .    |    .    ,-----o--> 3.2 Stable
d3785 2
a3786 2
     -->2.9Rel----->3.0Rel----->3.1Rel----->3.2Rel----> Current 
    
d3789 31
a3819 5
The code tree is branched between -current, -release and -stable every six
months -- -release becomes a frozen point (a "Tag") in the history of the
source tree - it is never changed, and is what is on the CDs and FTP servers.
-Current is where active work is done, and turns into the next -release of
OpenBSD.
d3821 3
a3823 27
The -stable (also known as the "Patch branch") is based on -release, and as one
can see, it is a "branch" from the development path of OpenBSD. As important
fixes are made to -current, they are "back ported" into the -stable branches.
In the above illustration, the vertical dotted lines are bug fixes being
incorporated into the -stable branches. You will also note that in the above
example, the 2.9-stable branch came to an end with 3.1-release, and the
3.0-stable branch came to an end with 3.2-release -- old releases are typically
supported up to two releases back. It takes resources and time to support older
versions, while we might like to provide ongoing support for old releases, we
would rather focus on new features. The -stable branch is, by design, very easy
to build from -release of the same version (i.e., going from 3.2-release to
3.2-stable).

The -stable branch is -release plus patches found on the errata page, and some
simple fixes that do not merit an errata entry. Usually, the operation of
-stable is the same as the -release it is based on. If the man pages have to
change, it probably won't go into -stable. In other words, new device support
will NOT be added to -stable, and new feature support will rarely be added
unless it is considered very important.

Warning: -current is a moving target. It changes almost minute by minute, and
may well change several times in the time it takes to retrieve the source code.
As indicated earlier, there is no promise that the system compiles or that it
works (of course, the hope is it does). It is entirely possible and not
uncommon to get the -current source and have it fail to compile, whereas five
minutes later, it may work just fine. If you are not prepared to deal with
this, stay away from -current.
d3826 3
a3828 3
people do run -current on production systems, and it is important that some
people do so to identify bugs and test new features. However, if you don't know
how to properly describe, diagnose and deal with a problem, don't tell yourself
d3830 1
a3830 1
didn't work!" is not a useful bug report.. "The recent changes to the pciide
d3834 6
a3839 6
There are times where "normal" users may wish to live on the cutting edge and
run -current. The most common reason is when the user has a device which is not
supported by -release (and thus, not -stable), or wishes to use a new feature
of the -current. In this case, the choice may be either -current or not using
the device, and -current may be the lesser evil. However, one should not expect
hand-holding from the developers.
d3843 1
a3843 1
Between formal releases of OpenBSD, snapshots are made available through the 
d3846 7
a3852 8
platform. Remember, on some platforms, this may be DAYS before the snapshot
build is completed and put out for distribution. There is no promise that the
snapshots are completely functional, or even install. Often, a change that
needs to be tested may trigger snapshot creation. Some platforms have snapshots
built on an almost daily basis, others will be much less frequent. If you
desire to run -current, a recent snapshot is often all you need, and upgrading
to a snapshot is usually a good starting point before attempting to build
-current.
d3857 29
a3885 4
and as resources become available. On fast platforms, one might be able to
build several snapshots in a day. On slower platforms, it may take a week or
more to build a snapshot. Providing tags or markers in the source tree for each
snapshot would be quite impractical.
d3891 1
a3891 1
make sure your kernel, "userland" (the supporting utilities and files) and 
d3893 314
a4206 36
(because people just keep making the error), you can not run brand new ports on
a month old system, or rebuild a kernel from -current source and expect it to
work with a -release userland. Yes, this does mean you need to update your
system if you want to run a new program which was added to the ports tree
today. Sorry, but again, OpenBSD has limited resources available.

One should also understand that when upgrading by source, the update process is
supported in only one direction: from older to newer, and from -stable to
-current. You can not run 3.2-current (or a snapshot), then decide you are
living too dangerously, and step back to 3.2-stable. You are on your own if you
choose any path other than the supported option of reloading your system from
scratch, do not expect assistance from the OpenBSD development team.

Yes, this does mean you should think long and hard before committing yourself
to using -current.

5.2 - Why would I want to create my own custom kernel?

Several reasons, although this practice is generally geared towards
knowledgeable users who have a good overall understanding of the system.

  * Your computer has a very small amount of RAM and you want to preserve as
    much as possible by removing device drivers you don't use
  * You wish to remove default options or add options which may not have been
    enabled by default
  * You wish to enable experimental options

Under most circumstances you will NOT need to compile your own kernel. The
GENERIC kernel will usually be all that you need. In fact, there are several
reasons why you do not want to create your own kernel. The main reason is that
it is very easy to make changes to the kernel configuration which look logical,
but do not work. This is your danger sign. If something does not appear to work
properly, please try the GENERIC kernel before sending in a bug report.
Developers will usually ignore bug reports dealing with custom kernels, unless
the problem can be reproduced in a GENERIC kernel as well. You have been
warned.
d4208 224
a4431 1
5.3 - Kernel Configuration Options
d4435 25
a4459 15
have exactly the support you want, without having support for unneeded devices.
There are a multitude of options that allow you to customize your kernel. Here
we will go over only some of them, those that are most commonly used. Check the
options(4) man page for a more complete list of options. You can also check the
example configuration files that are available for your architecture.

Not all kernel options have been tested for compatibility with all other
options. Don't put an option in your kernel unless you actually have a reason
to do so! The one kernel configuration which gets the most testing is the
GENERIC kernel. This is usually a combination of the options in /usr/src/sys/
arch/`arch -s`/conf/GENERIC and /usr/src/sys/conf/GENERIC.

  * Alpha Kernel Conf Files
  * i386 Kernel Configuration files
  * macppc Kernel Configuration files
d4463 1
d4466 4
a4469 6
Look closely at these files and you will notice a line like:
include "../../../conf/GENERIC"
This means that it is referencing yet another configuration file. This file
stores non arch-dependent options. So when creating your Kernel Config be sure
to look through /sys/conf/GENERIC and see what you want. There are options in
there that are necessary.
d4471 5
a4475 1
All of the options listed below should be placed in your kernel configuration
d4477 11
a4487 3
option OPTION
for example. To place option debug in the kernel, add a line like this:
option DEBUG
d4490 1
a4490 1
option -DDEBUG. Which is equivalent to doing a #define DEBUG throughout the
d4493 40
a4532 166
OpenBSD has many compatibility options which allow you to use binaries from
other OS's. Not all are availably on every architecture, so be sure to read the
man pages for each option to see if your arch is supported.

  * COMPAT_SVR4(8) - Compatibility with SVR4 binaries.
  * COMPAT_BSDOS(8) - Compatibility with BSD/OS binaries.
  * COMPAT_LINUX(8) - Compatibility with Linux binaries.
  * COMPAT_SUNOS(8) - Compatibility with SunOS binaries.
  * COMPAT_ULTRIX(8) - Compatibility with Ultrix binaries.
  * COMPAT_FREEBSD(8) - Compatibility with FreeBSD binaries.
  * COMPAT_HPUX(8) - Compatibility with HP-UX binaries. Only available on some
    m68k arch's.
  * COMPAT_IBCS2(8) - Compatibility to run ibcs2 binaries.
  * COMPAT_OSF1(8) - Run Digital Unix binaries. Available only on Alpha
    platform.
  * COMPAT_43 - Compatibility with 4.3BSD. Use of this is discouraged, but it
    is needed for some applications.
  * COMPAT_11 - Compatibility with NetBSD 1.1.
  * COMPAT_NOMID - Compatibility with a.out executables that lack a machine id.

It is always helpful to be able to debug problems with the kernel. But many
choose not to put these options in their kernel because these options add
considerable size to the kernel. They are however extremely helpful in a case
where a bug might be present. This will help the developers discover the source
of your problems much quicker. Here is a list of popular debugging options that
can be added to your kernel.

  * DDB(4) - This compiles in the in-kernel debugger. This isn't available on
    all platforms. So be sure to read before adding it.
  * KGDB(7) - Compiles a remote kernel debugger using gdb's `remote target`
    feature.
  * makeoptions DEBUG="-g" - Makes bsd.gdb along with bsd. This is useful for
    debugging crash dumps with gdb.
  * DEBUG - Used to put various debugging options in the kernel, where the
    source has defined them.
  * KTRACE - Adds hooks for the system call tracing facility. Which allows
    users to use ktrace(1).
  * DIAGNOSTIC - Adds code to the kernel that does internal consistency checks.
  * GPROF - adds code to the kernel for kernel profiling with kgmon(8).
  * makeoptions PROF="-pg" - The -pg flag causes the kernel to be compiled with
    support for profiling. Option GPROF is required to use this option.

Filesystem Options.

  * FFS - Berkeley Fast Filesystem NOTE: This option is required.
  * EXT2FS - Second Extended File System, This is needed for those of you who
    want to read Linux partitions.
  * MFS - Memory File System that stores files in swappable memory.
  * NFS - Network File System, This is needed if you will be using NFS.
  * CD9660 - This is iso9660 + rockridge filesystem. This is required to read
    from CDs.
  * MSDOSFS - Needed to read MS-DOS FAT filesystems. Also has support for
    Windows 95 long name + mixed case extensions.
  * FDESC - Includes code for a file system which can be mounted on /dev/fd.
  * KERNFS - Includes code that permits the mounting of a special file system
    (normally mounted on /kern) in which files representing various kernel
    variables and parameters may be found.
  * NULLFS - Code to have a loopback filesystem. mount_null(8) has more
    information.
  * PROCFS - Includes code for a special file system (conventionally mounted on
    /proc).
  * PORTAL - Includes the (experimental) portal filesystem. This permits
    interesting tricks like opening TCP sockets by opening files in the file
    system.
  * UMAPFS - Includes a loopback file system in which user and group ids may be
    remapped -- this can be useful when mounting alien file systems with
    different uids and gids than the local system (eg, remote NFS).
  * UNION - Includes code for the union file system, which permits directories
    to be mounted on top of each other in such a way that both file systems
    remain visible. This code isn't quite stable yet.
  * XFS - Add hooks for using a filesystem that is compatible with the AFS
    filesystem. Currently used by the Arla/AFS code.
  * FFS_SOFTUPDATES - Allows for the use of softupdates. To read more on
    softupdates read the Softupdates FAQ section.
  * NFSSERVER - Allow for the server-side NFS code to be included in the
    kernel.
  * NFSCLIENT - Allow for the client-side NFS code to be included in the
    kernel.
  * FIFO - Support for FIFOs. RECOMMENDED.
  * NVNODE=integer - Where integer is the size of the cache used by the
    name-to-inode translation routines, (a.k.a. the namei() cache, though
    called by many other names in the kernel source).
  * EXT2FS_SYSTEM_FLAG - This option changes the behavior of the APPEND and
    IMMUTABLE flags for a file on an EXT2FS filesystem. Read options(4) for
    more details.
  * QUOTA - Support for Filesystem Quota's. To read up on using quotas read FAQ
    10, Quotas.

Misc. Options

  * PCIVERBOSE - Make the boot process more verbose for PCI peripherals.
  * EISAVERBOSE - Make the boot process more verbose for EISA peripherals.
  * PCMCIAVERBOSE - Make the boot process more verbose for PCMCIA peripherals.
  * APERTURE - Provide in-kernel support for VGA framebuffer mapping by user
    processes. Needed to run X.
  * LKM - Support for Loadable Kernel Modules. Not available on all arch's.
    Read lkm(4) for more information.
  * INSECURE - Hardwires the kernel security level to -1. Read init(8) for more
    information on kernel security levels.
  * RAM_DISK_HOOKS - Allows for machine dependent functions to be called when
    the ramdisk driver is configured.
  * RAM_DISK_IS_ROOT - Forces the ramdisk to be root.
  * CCDNBUF=integer - Set number of component buffers used by CCD(4). Default
    is 8. For more on CCD, read the man page, or the Performance Tuning FAQ
    section.
  * KMEMSTATS - This makes malloc(9), the kernel memory allocator, keep
    statistics on its use. If option DEBUG is used, this option is
    automatically turned on by config.
  * BOOT_CONFIG - Adds support for the -c boot option.

Networking Options
Also check the Networking FAQ or the Networking Performance Tuning FAQ.

  * GATEWAY - Enables IPFORWARDING and (on most ports) increases the size of
    NMBCLUSTERS.
  * NMBCLUSTERS=integer - Controls the size mbuf cluster map.
  * IPFORWARDING - Enables IP routing behavior. With this option enabled, the
    machine will forward IP datagrams between its interfaces that are destined
    for other machines.
  * MROUTING - Includes support for IP multicast routers.
  * INET - Includes support for the TCP/IP protocol stack. This option is
    REQUIRED.
  * MCLSHIFT=value - This option is the base-2 logarithm of the size of mbuf
    clusters. Read options(4) for more information on this option.
  * NS - Include support for the Xerox XNS protocol stack. See ns(4).
  * ISO,TPIP - Include support for the ubiquitous OSI protocol stack. See iso
    (4) for more information.
  * EON - Include support for OSI tunneling over IP.
  * CCITT,LLC,HDLC - Include support for the X.25 protocol stack.
  * IPX, IPXIP - Include support for Internetwork Packet Exchange protocol
    commonly in use by Novell NetWare.
  * NETATALK - Include kernel support for the AppleTalk family of protocols.
  * TCP_COMPAT_42 - Use of this option is extremely discouraged, so it should
    not be enabled. TCP bug compatibility with 4.2BSD. In 4.2BSD, TCP sequence
    numbers were 32-bit signed values. Modern implementations of TCP use
    unsigned values.
  * TCP_NEWRENO - Turns on NewReno fast recovery phase, which allows one lost
    segment to be recovered per round trip time.
  * TCP_SACK - Turns on selective acknowledgements.
  * TCP_FACK - Turns on forward acknowledgements allowing a more precise
    estimate of outstanding data during the fast recovery phase by using SACK
    information. This option can be used together with TCP_SACK.
  * PPP_FILTER - This option turns on pcap(3) based filtering for ppp
    connections.
  * PPP_BSDCOMP - PPP BSD compression.
  * PPP_DEFLATE - Used in conjunction with PPP_BSDCOMP.
  * IPSEC - This option enables IP security protocol support. See ipsec(4) for
    more details. This now implies option KEY, which gives support for PFKEYv2.
  * ENCDEBUG - This option enables debugging information to be conditionally
    logged in case IPSEC encounters errors.

SCSI Subsystem Options

  * SCSITERSE - Terser SCSI error messages. This omits the table for decoding
    ASC/ASCQ info, saving about 8 bytes or so.
  * SCSIDEBUG - Prints extra debugging info for the SCSI subsystem to the
    console.

5.4 - Building your own kernel

Full instructions for creating your own custom kernel are in the afterboot(8)
man page.

To compile your kernel from the cdrom you need to first have the source code
available. The source is available on both the official CD (disk 3) and on the 
FTP sites. The following example assumes that CD3 is mounted on /mnt:
d4534 2
a4535 2
    # cd /usr/src
    # tar xvzf /mnt/src.tar.gz
d4537 2
a4538 57
Note: If you are downloading from the FTP servers, you will find TWO files,
src.tar.gz and srcsys.tar.gz. The first is the "userland" -- everything but the
kernel, the second is the kernel source. Download and extract both of them as
above, as for most uses, you will want both. On the CDROM, they are combined
into one file.

Now to create your custom kernel it is easiest to start with the GENERIC
kernel. This is located at /usr/src/sys/arch/$ARCH/conf/GENERIC, where $ARCH is
your architecture. There are other sample configurations available in that
directory as well. Here are two examples for compiling your kernel. The first
example is compiling your kernel on a read-only source tree. The second on a
writable source tree.

    # cd /somewhere
    # cp /usr/src/sys/arch/$ARCH/conf/SOMEFILE .
    # vi SOMEFILE   (to make the changes you want)
    # config -s /usr/src/sys -b . SOMEFILE
    followed by either:
        # make depend
             - OR -
        # make clean
    # make

You must run 'make depend' when you have made any changes (including updates
and patches) to your source tree (in other words, almost always, unless you
need to run 'make clean').

If you have made changes to your kernel configuration options, and/or made
major changes to your source tree, you should use 'make clean' instead of the
above 'made depend'. Note that it is always safe to do a 'make clean', though
it may result in longer compile times, as more will be rebuilt.

To compile a kernel inside a writable source tree do the following:

    # cd sys/arch/$ARCH/conf
    # vi SOMEFILE (to make any changes you want)
    # config SOMEFILE (read more about it here: config(8))
    # cd ../compile/SOMEFILE
    # make

Where $ARCH is the architecture you are using (e.g. i386). You can also do a 
make depend to make the dependencies for the next time you compile your kernel.

To move your kernel into place.

    # cp /bsd /bsd.old
    # cp /sys/arch/$ARCH/compile/SOMEFILE/bsd /bsd

To revert to your old kernel at boot you just need to

    boot> bsd.old

and your old kernel will be loaded instead of /bsd.

Sometimes when you build a new kernel you will be required to install new
bootblocks. To do so, read FAQ 14, Installing Bootblocks, which will give you
an overview on using OpenBSD's Bootloader.
d4540 1
a4540 1
5.5 - Boot Time Configuration
d4547 2
a4548 3
temporary fix, and you should correct the problem by fixing and recompiling
your kernel. Your kernel does however need option BOOT_CONFIG in the kernel,
which GENERIC does have.
d4552 1
a4552 1
To boot into the User Kernel Config, or UKC, at boot time us the -c option.
d4554 1
a4554 1
    boot> boot wd0a:/bsd -c
d4573 3
a4575 5
Once you get your device configured, use quit or exit and continue booting.
After doing so you should correct your Kernel configuration and Compile a new
kernel. Refer to Building your own kernel for help.

5.6 - Getting more verbose output during boot
d4577 1
a4577 12
Getting more verbose output can be very helpful when trying to debug problems
when booting. If you have a problem wherein your boot floppy won't boot and
need to get more information, simply reboot. When you get to the "boot>"
prompt, boot with boot -c. This will bring you into the UKC>, then do:

    UKC> verbose
    autoconf verbose enabled
    UKC> quit

Now you will be given extremely verbose output upon boot.

5.7 - Using config(8) to change your kernel
d4586 7
a4592 6
The following example shows the disabling of the ep* devices in the kernel. For
safety's sake you must use the -o option which writes the changes out to the
file specified. For example : config -e -o bsd.new /bsd will write the changes
to bsd.new. The example doesn't use the -o option, therefore changes are just
ignored, and not written back to the kernel binary. For more information
pertaining to error and warning messages read the config(8) man page.
d4595 2
a4596 1
    OpenBSD 3.2 (GENERIC) #25: Thu Oct  3 19:51:53 MDT 2002
a4597 1
    warning: no output file specified
d4600 15
a4614 18
            help                            Command help list
            add         dev                 Add a device
            base        8|10|16             Base on large numbers
            change      devno|dev           Change device
            disable     attr val|devno|dev  Disable device
            enable      attr val|devno|dev  Enable device
            find        devno|dev           Find device
            list                            List configuration
            lines       count               # of lines per page
            show        [attr [val]]        Show attribute
            exit                            Exit, without saving changes
            quit                            Quit, saving current changes
            timezone    [mins [dst]]        Show/change timezone
            nmbclust    [number]            Show/change NMBCLUSTERS
            cachepct    [number]            Show/change BUFCACHEPERCENT
            nkmempg     [number]            Show/change NKMEMPAGES
            shmseg      [number]            Show/change SHMSEG
            shmmaxpgs   [number]            Show/change SHMMAXPGS
d4616 19
a4634 24
      0 audio* at sb0|sb*|gus0|pas0|sp0|ess*|wss0|wss*|ym*|eap*|eso*|sv*|neo*|cmpci*
    |clcs*|clct*|auich*|autri*|auvia*|fms*|uaudio*|maestro*|esa*|yds*|emu* flags 0x0
      1 midi* at sb0|sb*|opl*|opl*|opl*|opl*|ym*|mpu*|autri* flags 0x0
      2 nsphy* at aue*|xe*|ef*|gx*|stge*|bge*|nge*|sk*|ste*|sis*|sf*|wb*|tx*|tl*|vr*
    |ne0|ne1|ne2|ne*|ne*|ne*|dc*|dc*|rl*|fxp*|fxp*|xl*|xl*|ep0|ep0|ep0|ep*|ep*|ep*|e
    p*|ep* phy -1 flags 0x0
      3 nsphyter* at aue*|xe*|ef*|gx*|stge*|bge*|nge*|sk*|ste*|sis*|sf*|wb*|tx*|tl*|
    vr*|ne0|ne1|ne2|ne*|ne*|ne*|dc*|dc*|rl*|fxp*|fxp*|xl*|xl*|ep0|ep0|ep0|ep*|ep*|ep
    *|ep*|ep* phy -1 flags 0x0
      4 qsphy* at aue*|xe*|ef*|gx*|stge*|bge*|nge*|sk*|ste*|sis*|sf*|wb*|tx*|tl*|vr*
    |ne0|ne1|ne2|ne*|ne*|ne*|dc*|dc*|rl*|fxp*|fxp*|xl*|xl*|ep0|ep0|ep0|ep*|ep*|ep*|e
    p*|ep* phy -1 flags 0x0
      5 inphy* at aue*|xe*|ef*|gx*|stge*|bge*|nge*|sk*|ste*|sis*|sf*|wb*|tx*|tl*|vr*
    |ne0|ne1|ne2|ne*|ne*|ne*|dc*|dc*|rl*|fxp*|fxp*|xl*|xl*|ep0|ep0|ep0|ep*|ep*|ep*|e
    p*|ep* phy -1 flags 0x0
      6 iophy* at aue*|xe*|ef*|gx*|stge*|bge*|nge*|sk*|ste*|sis*|sf*|wb*|tx*|tl*|vr*
    |ne0|ne1|ne2|ne*|ne*|ne*|dc*|dc*|rl*|fxp*|fxp*|xl*|xl*|ep0|ep0|ep0|ep*|ep*|ep*|e
    p*|ep* phy -1 flags 0x0
      7 eephy* at aue*|xe*|ef*|gx*|stge*|bge*|nge*|sk*|ste*|sis*|sf*|wb*|tx*|tl*|vr*
    |ne0|ne1|ne2|ne*|ne*|ne*|dc*|dc*|rl*|fxp*|fxp*|xl*|xl*|ep0|ep0|ep0|ep*|ep*|ep*|e
    p*|ep* phy -1 flags 0x0
      8 exphy* at aue*|xe*|ef*|gx*|stge*|bge*|nge*|sk*|ste*|sis*|sf*|wb*|tx*|tl*|vr*
    |ne0|ne1|ne2|ne*|ne*|ne*|dc*|dc*|rl*|fxp*|fxp*|xl*|xl*|ep0|ep0|ep0|ep*|ep*|ep*|e
    p*|ep* phy -1 flags 0x0
d4637 6
a4642 8
     65 ep0 disabled
     66 ep* disabled
     67 ep* disabled
    149 ep0 disabled
    150 ep0 disabled
    151 ep* disabled
    152 ep* disabled
    202 ep* disabled
d4647 6
a4652 6
be probed. In some situations where you have used the UKC during boot, via boot
-c, you will need these changes to be written out permanently. To do this you
need to use the -u option. In the following example, the computer was booted
into the UKC and the wi(4) device was disabled. Since changes made with boot -c
are NOT permanent, these changes must be written out. This example writes the
changes made from boot -c into a new kernel binary bsd.new.
d4655 1
a4655 1
    OpenBSD 3.2 (GENERIC) #25: Thu Oct  3 19:51:53 MDT 2002
d4658 3
a4660 2
    105 wi* disabled
    106 wi* disabled
d4664 1
a4664 6
[Back to Main Index] [To Section 4.0 - Installation Guide] [To Section 6.0 -
Networking]
-------------------------------------------------------------------------------
[back] www@@openbsd.org
$OpenBSD: obsd-faq.txt,v 1.33 2003/01/05 19:29:10 nick Exp $
[OpenBSD]
d4666 4
a4669 1
6.0 - Networking
d4671 205
a4875 1
-------------------------------------------------------------------------------
d4879 14
a4892 5
  * 6.0.1 - Before we go any further
  * 6.1 - Initial network setup
  * 6.2 - Packet Filter (PF)
  * 6.3 - Network Address Translation
  * 6.4 - Dynamic Host Configuration Protocol
d4896 14
a4909 11
  * 6.8 - Domain Name Service - DNS, BIND, and named
  * 6.9 - Setting up a PPTP connection in OpenBSD
  * 6.10 - Setting up a bridge with OpenBSD

-------------------------------------------------------------------------------

6.0.1 - Before we go any further

For the bulk of this document, it helps if you have read and at least partially
understood the Kernel Configuration and Setup section of the FAQ, and the 
ifconfig(8) and netstat(1) man pages.
d4913 27
a4939 23
IP networking, you really need to read Understanding IP Addressing (or here).
This is an excellent document. Understanding IP addressing contains fundamental
knowledge to build upon when working with IP networks, especially when you deal
with or are responsible for more than one network.

If you are working with applications such as web servers, ftp servers, and mail
servers, you may benefit greatly by reading the RFCs. Most likely, you can't
read all of them. Pick some topics that you are interested in, or that you use
in your network environment. Look them up, find out how they are intended to
work. The RFCs define many (thousands of) standards for protocols on the
Internet and how they are supposed to work.

6.1 - Initial Network Setup

6.1.1 - Identifying and Setting Up Your Network Interfaces

To start off, you must first identify your network interface. In OpenBSD,
interfaces are named for the type of card, not for the type of connection. You
can see your network card get initialized during the booting process, or after
the booting process using the dmesg(8) command. You also have the chance of
seeing your network interface using the ifconfig(8) command. For example, here
is the output of dmesg for a Intel Fast Ethernet network card, which uses the
device name fxp.
d4945 7
a4951 4
hardware list for your platform. You will find a list of many common card names
and their OpenBSD device name here. Combine the short alphabetical device name
(such as fxp) with a number assigned by the kernel and you have an interface
name (such as fxp0).
d4953 1
a4953 1
You can find out what network interfaces have been identified by using the 
d4955 1
a4955 1
a system. This sample output shows us only one physical ethernet interface, an 
d4958 4
a4961 3
    $ ifconfig -a
    lo0: flags=8049<UP,LOOPBACK,RUNNING,MULTICAST> mtu 33224
            inet6 fe80::1%lo0 prefixlen 64 scopeid 0x4
d4963 2
a4964 2
            inet 127.0.0.1 netmask 0xff000000 
    lo1: flags=8008<LOOPBACK,MULTICAST> mtu 33224
d4966 2
d4971 8
a4978 18
            inet6 fe80::202:b3ff:fe2b:10f7%fxp0 prefixlen 64 scopeid 0x1
    pflog0: flags=0<> mtu 33224
    sl0: flags=c010<POINTOPOINT,LINK2,MULTICAST> mtu 296
    sl1: flags=c010<POINTOPOINT,LINK2,MULTICAST> mtu 296
    ppp0: flags=8010<POINTOPOINT,MULTICAST> mtu 1500
    ppp1: flags=8010<POINTOPOINT,MULTICAST> mtu 1500
    tun0: flags=10<POINTOPOINT> mtu 3000
    tun1: flags=10<POINTOPOINT> mtu 3000
    enc0: flags=0<> mtu 1536
    bridge0: flags=0<> mtu 1500
    bridge1: flags=0<> mtu 1500
    vlan0: flags=0<> mtu 1500
    vlan1: flags=0<> mtu 1500
    gre0: flags=8010<POINTOPOINT,MULTICAST> mtu 1450
    gif0: flags=8010<POINTOPOINT,MULTICAST> mtu 1280
    gif1: flags=8010<POINTOPOINT,MULTICAST> mtu 1280
    gif2: flags=8010<POINTOPOINT,MULTICAST> mtu 1280
    gif3: flags=8010<POINTOPOINT,MULTICAST> mtu 1280
d4988 2
a4989 2
These are virtual interfaces that serve various functions. The following manual
pages describe them:
d4993 4
a4999 1
  * enc - Encapsulating Interface
d5002 1
d5005 8
d5014 1
a5014 4
If you don't have your interface configured, the first step is to create the /
etc/hostname.xxx file. Where the name of your interface will take the place of
xxx. From the information in the examples above, the name would be /etc/
hostname.fxp0. The layout of this file is simple:
d5018 2
a5019 2
(Much more detail about the format of this file can be found in the hostname.if
(5) man page.)
d5027 4
d5038 2
a5039 1
should be excluded.)
d5045 9
a5053 1
    inet 172.21.0.0 255.255.255.0 NONE vlan 2 vlandev fxp1
d5055 4
a5058 8
The next step from here is to setup your gateway. To do this, simply put the IP
of your gateway in the file /etc/mygate. This will allow for your gateway to be
set upon boot. From here you should setup your nameservers, and your /etc/hosts
file (see the hosts(5) man page). To setup your nameservers, you will create a
file called /etc/resolv.conf. You can read more about the format of this file
in the resolv.conf(5) man page. But for a standard usage, here is an example.
In this example your domain servers are 125.2.3.4 and 125.2.3.5. You also
belong in the domain "yourdomain.com".
d5060 6
a5065 2
    $ cat /etc/resolv.conf
    search yourdomain.com
d5070 22
d5102 20
a5121 5
reconfiguring things which are already configured. As such, some routes already
exist in the kernel routing table. From here your system should be up and
running. Again, you can check to make sure that your interface was setup
correctly with ifconfig(8). You can also check your routes via netstat(1) or 
route(8). Here is an example of viewing your routing tables using both.
d5125 1
a5125 1
    
d5135 1
a5135 1
    
d5138 1
a5138 1
    
d5141 1
a5141 1
    
d5152 1
a5152 1
6.1.2 - Setting up your OpenBSD box as a Gateway
d5158 1
a5158 1
adresses from network service providers and regional registries, you may want
d5162 3
a5164 3
The GENERIC kernel already has the ability to allow IP Forwarding, but needs to
be turned on. You should do this using the sysctl(8) utility. To change this
permanently you should edit the file /etc/sysctl.conf(5) to allow for IP
d5170 2
a5171 2
directly. Remember though that this change will no longer exist after a reboot,
and needs to be run as root.
d5173 1
a5173 1
    # sysctl -w net.inet.ip.forwarding=1
d5176 15
a5190 13
Now modify the routes on the other hosts on both sides. There are many possible
uses of OpenBSD as a router, using software such as routed(8), gated, mrtd, and
zebra. OpenBSD has support in the ports collection for zebra, gated and mrtd.
OpenBSD supports several T1, HSSI, ATM, FDDI, Ethernet, and serial (PPP/SLIP)
interfaces.

6.1.3 - Setting up aliases on an interface.

OpenBSD has a simple mechanism for setting up ip aliases on an interface. To do
this simply edit the file /etc/hostname.<if>. This file is read upon boot by
the /etc/rc(8) script, which is part of the rc startup hierarchy. For the
example, we assume that the user has an interface dc0 and is on the network
192.168.0.0. Other important information:
d5197 4
a5200 4
some other operating systems, OpenBSD doesn't refer to them as dc0:0, dc0:1. If
you are referring to a specific aliased IP address with ifconfig, or adding an
alias, be sure to say "ifconfig int alias" instead of just "ifconfig int" at
the command line. You can delete aliases with "ifconfig int delete".
d5203 3
a5205 3
with aliases, your netmask setting for each alias becomes 255.255.255.255. They
do not need to follow the netmask of the first IP bound to the interface. In
this example, /etc/hostname.dc0, two aliases are added to the device dc0,
d5209 1
a5209 1
    inet 192.168.0.2 255.255.255.0 media 100baseTX
d5219 3
d5227 1
a5227 1
            inet 192.168.0.2  netmask 0xffffff00 broadcast 192.168.0.255
d5230 1
a5230 1
6.2 - Packet Filter (PF)
d5232 5
a5236 2
Note: For OpenBSD 3.2, the functions of the /etc/nat.conf have been merged into
/etc/pf.conf.
d5238 1
a5238 1
The new /etc/pf.conf file has four parts:
d5240 3
a5242 7
  * Options: Various options to control how PF works.
  * Scrub: Reprocessing packets to normalize and defragment them.
  * NAT and Redirection Rules: NAT allows many machines to access the Internet
    through one IP address. Redirection allows incoming requests to be
    forwarded to a particular machine behind the NAT.
  * Filter Rules: Allows the selective filtering or blocking of packets as they
    pass through any of the interfaces.
d5244 1
a5244 2
None of these sections are required to exist, but those that do must be in the
above order.
d5246 4
a5249 3
The Packet Filter subsystem was created to handle two tasks, dealing with
packet level forwarding permissions and mapping hosts/subnets to a range of
external addresses. The configuration file for this service is /etc/pf.conf(5).
d5251 1
a5251 2
To start these services with your system, you need to edit /etc/rc.conf(8) and
set the line to:
d5253 3
a5255 1
    pf=YES
d5257 2
a5258 3
If you are using NAT, you will most likely also need to set the sysctl(8) value
net.inet.ip.forwarding to 1. You can do this by uncommenting the relevant lines
in /etc/sysctl.conf(5) and rebooting your computer.
d5260 1
a5260 3
If you have Packet Filter compiled into your kernel, but you don't have it
turned on in your /etc/rc.conf(8) file, you can still activate it with the 
pfctl(8) command.
d5262 1
a5262 2
    # pfctl -f /etc/pf.conf
    # pfctl -e
d5264 4
a5267 2
The first line sets up filtering and NAT, using /etc/pf.conf and the second
line activates PF.
d5269 2
a5270 1
This can also be combined into one command line:
d5272 2
a5273 1
    # pfctl -f /etc/pf.conf -e
d5275 5
a5279 2
If you make changes to /etc/pf.conf after PF is started, you can reload your
rules by reloading the file:
d5281 1
a5281 1
    # pfctl -f /etc/pf.conf
d5283 4
a5286 4
This document will cover some basic pf.conf(5) configurations below. You can
also look at the resulting ruleset that includes all the tweaks explained below
in more detail. You can find other Packet Filter information at the Packet
Filter web site and in the Packet Filter HOWTO.
d5288 3
a5290 1
Packet Filter
d5292 1
a5292 7
In order to enable Packet Filter at boot, you will need to modify /etc/rc.conf
so that it reads pf=YES. Packet Filter (pf) is controlled by /etc/pf.conf,
which is read at boot. For a more detailed explanation, see pf.conf(5). In the
examples that follow, fxp0 will represent the external interface to the
internet. It will be different for you, based on the ethernet adapter present
in your computer. These rules will assume full-time internet connectivity, such
as you would see on a webserver.
d5294 1
a5294 3
Packet Filter rules are processed sequentially from top to bottom; it helps to
visualize each packet having to traverse every rule before it reaches its
destination.
d5296 3
a5298 2
For example, the default ruleset provided allows all packets to travel in, and
all packets to travel out:
d5300 1
a5300 2
    pass out all 
    pass in all
d5302 2
a5303 1
This is shorthand, for:
d5305 1
a5305 2
    pass in from any to any
    pass out from any to any
d5307 4
a5310 4
which can be read as "pass incoming packets from any source to any
destination", with an implied "on any interface (which is always implied if a
specific interface isn't specified) of any address family, inet (v4) or inet6
(v6)".
d5312 1
a5312 140
Obviously, this isn't much of a filter. More useful filtering will be based on
the address family (IPv4 or IPv6), protocol(s) and port(s) used by the services
you wish to filter. Any of the protocols listed in /etc/protocols(5) can be
specified, by either name or number, but we will concern ourselves with tcp(4),
udp(4) and icmp(4).

Now let's say we don't want to allow any incoming IPv4 connections to TCP port
3306 (MySQL) because the database should only be connected to from localhost.
Our ruleset would look like this:

    pass out all
    pass in all
    block in on fxp0 inet proto tcp from any to any port 3306

This says "block in all IPv4 (inet) incoming packets, from any source to any
destination bound for tcp port 3306." Note that it is required that you specify
a protocol with any port-based filter, and recommended that you specify the
address family. For services defined in the /etc/services(5) file, you can also
use the service names, such as www or mysql. A packet destined for tcp port
3306 on interface fxp0 will pass the first "pass in" rule and then be dropped
by the "block in port 3306" rule. If you reversed the order of our incoming
rules (remember, order is important):

    pass out all
    block in on fxp0 inet proto tcp from any to any port 3306
    pass in all

Packets destined for tcp port 3306 would pass because the last rule in the set
allows all packets to pass. It is important to keep this in mind when writing
packet filter rules: The last matching rule wins.

Of course, there are exceptions to every rule. The quick option drops the
packet at the first rule that matches. Let's look at our above flawed example,
if we add quick to the "block in" rule:

    pass out all
    block in quick on fxp0 inet proto tcp from any to any port 3306
    pass in all

A packet destined for our host on tcp port 3306 will hit the "block in quick"
rule and be dropped immediately. All packets destined for other ports or
protocols won't find a rule match until they reach our "pass in" rule that
allows all packets to pass.

Default Deny

The safest packet filtering policy is a default deny policy. All traffic not
explicitly allowed is denied. This policy is far safer than explicitly denying
each protected service, allows for smaller rulesets, and can protect from an
accidentally misconfigured service that has been left exposed.

Let's now look at another example ruleset and explain things line by line.
Here's an example for a webserver with a default deny policy that only allows
ssh connections (for administration) and connections to http (port 80) and
https (port 443).

    block in on fxp0 all
    pass  in on fxp0 inet proto tcp from any to any port 22
    pass  in on fxp0 inet proto tcp from any to any port 80
    pass  in on fxp0 inet proto tcp from any to any port 443
    pass out on fxp0 all

This will allow incoming connections from anywhere to tcp ports 22(ssh), 80
(http), and 443(https). It will drop all other connection attempts, and allow
all outgoing connections. This is a pretty tight ruleset. But what if you only
wanted to allow internal hosts on your 1.1.1.0 address block to connect to ssh,
but allow outside connections to http and https?

    block in on fxp0 all
    pass  in on fxp0 inet proto tcp from 1.1.1.0/24 to any port 22
    pass  in on fxp0 inet proto tcp from any to any port 80
    pass  in on fxp0 inet proto tcp from any to any port 443
    pass out on fxp0 all

Pretty good, but what if we only want to allow one machine (1.1.1.1) to
administer the web server remotely? In that case, we can change this:

    pass  in on fxp0 inet proto tcp from 1.1.1.0/24 to any port 22

to this:

    pass  in on fxp0 inet proto tcp from 1.1.1.1/32 to any port 22

Sample Rules

Here are some good rules for everyone to use (assuming that fxp0 is the
external internet-connected interface). First we will set up a simple address
spoofing protection. These addresses shouldn't (normally) be floating around
the Internet, and if they are, it is rarely good, so we block them:

    block in quick on fxp0 inet from { 127.0.0.0/8, 192.168.0.0/16, \
    172.16.0.0/12, 10.0.0.0/8 } to any
    block out quick on fxp0 inet from any to { 127.0.0.0/8, 192.168.0.0/16, \
    172.16.0.0/12, 10.0.0.0/8 }

Our ruleset is starting to look pretty good; when we put it together, here is
what it looks like:

    # don't allow anyone to spoof non-routeable addresses
    block in quick on fxp0 inet from { 127.0.0.0/8, 192.168.0.0/16, \
    172.16.0.0/12, 10.0.0.0/8 } to any
    block out quick on fxp0 inet from any to { 127.0.0.0/8, 192.168.0.0/16, \
    172.16.0.0/12, 10.0.0.0/8 }
    
    # only allow our administration machine to connect via ssh
    pass in quick on fxp0 inet proto tcp from 1.1.1.1/32 to any port 22
    
    # allow others to use http and https
    pass in quick on fxp0 inet proto tcp from any to any port 80
    pass in quick on fxp0 inet proto tcp from any to any port 443
    
    # finally lock the rest down with a default deny
    block in quick on fxp0 from any to any
    
    # and let out-going traffic out
    pass out on fxp0 from any to any

Packet Logging

Now that's pretty good, but it could be better. What if we want to log any
connection attempts to port 22(ssh) that get blocked by our firewall? Easy,
Packet Filter can handle this with the log keyword:

    pass in quick on fxp0 inet proto tcp from 1.1.1.1/32 to any port 22
    block in log quick on fxp0 inet proto tcp from any to any port 22

This rule will allow our remote administration machine to connect to port 22,
but deny and log all other attempts to connect to port 22.

Logged packets are sent to the pflog0 interface, which is monitored by pflogd
(8), which typically dumps the packets to /var/log/pflog in tcpdump(8) binary
format. pflogd(8) is started by default by /etc/rc(8) if pf is enabled in /etc/
rc.conf(8). You can read these log files using the following command:

    # tcpdump -n -e -ttt -r /var/log/pflog

One should be aware that using tcpdump to watch the pflog file does NOT give a
real-time display. If you wish a real-time display, you can use this command:

    # tcpdump -i pflog0
d5314 1
a5314 828
One could also use tcpdump to narrow down the focus to facilitate debugging:

    # tcpdump -e -i pflog0 port 80

Doing this does NOT impact the data that is put to the file /var/log/pflog.

When examining one's logs, especial care should be taken with tcpdump's verbose
protocol decoding (activated via the -v command line option). Tcpdump's
protocol decoders do not have a perfect security history. At least in theory, a
delayed attack could be possible via the partial packet payloads recorded by
the logging device.

Additional care should be taken about access to the logs. Pflogd will capture
96 bytes of the packet and log it. Access to the logs could provide partial
access to sensitive packet payloads (like telnet(1) or ftp(1) logins).

Packet Logging through syslog

In many situations it is desirable to have the firewall logs available in ASCII
format and/or to send them to a remote logging server. All this can be
accomplished with 2 small shell scripts and with minor changes of the OpenBSD
configuration files.

Syslogd(8) is the standard daemon for logging, it logs in ASCII and is also
able to log to a remote logging server.

First we have to create a user pflogger with a .nologin. shell. The easiest way
to create this user is with adduser(8).

After creating the user pflogger create the following two scripts:

/etc/pflogrotate

    FILE=/home/pflogger/pflog5min.$(date "+%Y%m%d%H%M")
    kill -ALRM $(cat /var/run/pflogd.pid)
    if [ $(ls -l /var/log/pflog | cut -d " " -f 8) -gt 24 ]; then
            mv /var/log/pflog $FILE
            chown pflogger $FILE
            kill -HUP $(cat /var/run/pflogd.pid)
    fi

/home/pflogger/pfl2sysl

    #!/bin/sh
    # feed rotated pflog file(s) to syslog
    for logfile in /home/pflogger/pflog5min* ; do
            tcpdump -n -e -ttt -r $logfile | logger -t pf -p local0.info
            rm $logfile
    done

Edit the cron job for user root

    # crontab -u root -e

and add the following two lines:

    # rotate pf log file every 5 minutes
    0-59/5 *       *       *       *       /bin/sh /etc/pflogrotate

Create a cron job for user pflogger

    # crontab -u pflogger -e

and add the following two lines:

    # feed rotated pflog file(s) to syslog
    0-59/5 *       *       *       *       /bin/sh /home/pflogger/pfl2sysl

Add the following line to /etc/syslog.conf:

    local0.info    /var/log/pflog.txt

If you want to log to a remote log server also add the line:

    local0.info    @@syslogger

and make sure host syslogger has been defined in the /etc/hosts(5) file.

All logged packets are sent to /var/log/pflog.txt. If the second line is added
too they are sent to the remote logging host syslogger as well.

/etc/pflogrotate now processes and then deletes /var/log/pflog so rotation of
pflog by newsyslogd(8) is no longer necessary and it should be disabled.
However /var/log/pflog.txt replaces /var/log/pflog and rotation of it should be
activated. Change /etc/newsyslog.conf as follows:

    #/var/log/pflog        600     3       250     *       ZB      /var/run/pflogd.pid
    /var/log/pflog.txt     600     7       *       24

Pf will now log in ASCII to /var/log/pflog.txt. If so configured in /etc/
syslog.conf it will also log to a remote server. The logging is not immediate
but it can take up to about 5-6 minutes (the cron job interval) before the
logged packets appear in the file.

Multiple Protocols

What if we need to allow connections to a service running over multiple
protocols, such as bind, which uses TCP and UDP? Packet filter lets you lump
options together into sets (more on this later):

    # Pass DNS traffic for BIND
    pass in quick on fxp0 inet proto { tcp, udp } from any to any port 53

Notice the spaces on both sides of the '{ }' characters. This is neater than
the alternative you might otherwise have to use:

    pass in quick on fxp0 inet proto tcp from any to any port 53
    pass in quick on fxp0 inet proto udp from any to any port 53

Packet Normalization

Packet Normalization means reassembling fragmented packets and clearing IP
options. Some OSs and applications have trouble with abnormal or fragmented
packets, and it's in general good to have normalized packets for the filter
rules to look at and for the destination hosts to look at. Thus, it is nearly
always beneficial to normalize the packets before they are passed on to their
ultimate destination. This is done with the scrub directive, used as here:

    scrub in all

This does put a very minor additional load on the system, and requires a bit
memory to cache the packet fragments. The advantages of packet normalization
almost always outweigh this cost.

IP Options

By default, PF blocks packets with IP options set. This can make the job more
difficult for "OS fingerprinting" utilities like nmap. If you have an
application that requires the passing of these packets, such as multicast or
IGMP, you can use the allow-opts directive:

    pass in quick on fxp0 all allow-opts

TCP Flags, established connections and keeping state

Packet Filter can also filter packets based on TCP flags and maintain
established connections and connection state. It is recommend that all users
who wish to filter packets based on TCP flags understand what role each flag
plays. For instance, if you wanted to deny all packets with the FIN, URG, and
PSH flags set (like for instance an nmap OS fingerprinting attempt) you could
use a rule like this:

    block in quick on fxp0 inet proto tcp from any to any flags FUP/FUP

(Thanks to Kyle Hargraves for that tip)

Packet Filter's next cool trick is its ability to maintain state. Maintaining
state has been described as "not speaking until spoken to"; in other words,
once a connection is established, packets no longer have to traverse rulesets.
This is a very powerful feature allowing much simpler and more secure rule
writing.

For example, let's see how we can apply state to our previous example ruleset
(confused yet?). To review, we are allowing management access from our Class C
to port 22(ssh) and allowing all incoming web traffic on ports 80(http) and 443
(https). We are blocking all other traffic. But, what if I want to ssh(1) out
of the webserver? What if I need to use lynx(1) to look up something in the
FAQ? Well, I can't because I have blocked all incoming connections other than
those on the specified ports. While this is the safest route, it can be quite
inconvenient. By adding the keep state keywords to our "pass out" rule, we can
automatically allow incoming packets in response to connections we initiate,
such as when web browsing. Remember, we do need to specify what protocol we are
keeping state for.

    block in  on fxp0 inet proto tcp all
    pass  in  on fxp0 inet proto tcp from 1.1.1.0/24 to any port 22 keep state
    pass  in  on fxp0 inet proto tcp from any to any port 80 keep state
    pass  in  on fxp0 inet proto tcp from any to any port 443 keep state
    pass  out on fxp0 inet proto tcp all keep state

This little change will dramatically increase the flexibility and security of
our ruleset: for instance, in the above ruleset, we are allowing all tcp
traffic into ports 80 & 443. We can tighten this up even more. In order for a
tcp connection to be established, we only need to allow the initial handshake
to occur; once that occurs, we can block traffic to that port and allow our
"keep state" rule to manage the connection. To allow the initial handshake to
complete, we need only allow packets with the SYN flag set and ACK flag not
set. By passing only packets with SYN set, we can prevent many forms of
portscanning such as FIN scanning. flags S/SA means: out of flags S (SYN) and A
(ACK), only SYN may be set. Other flags aren't investigated. The rules now look
like this:

    block in  on fxp0 inet proto tcp all
    pass  in  on fxp0 inet proto tcp from 1.1.1.0/24 to any port 22 \
        flags S/SA keep state
    pass  in  on fxp0 inet proto tcp from any to any port 80 \
        flags S/SA keep state
    pass  in  on fxp0 inet proto tcp from any to any port 443 \
        flags S/SA keep state
    block out on fxp0 inet proto tcp all
    pass  out on fxp0 inet proto tcp all flags S/SA keep state

Let's start to tie things together by putting all of the rules we have so far
into a ruleset. This ruleset will support IPv4, have a default deny policy,
allow management connections from an internal network only (via ssh) and allow
incoming traffic on ports 80(http) and 443(https). It will also protect against
spoofed non-routeable ip addresses, and drop all packets that are too
fragmented to inspect. A pretty comprehensive setup for a public webserver.
Here's what /etc/pf.conf could look like:

    # Clean up fragmented and abnormal packets
    scrub in all
    
    # don't allow anyone to spoof non-routeable addresses
    block in quick on fxp0 inet from { 127.0.0.0/8, 192.168.0.0/16, \
    172.16.0.0/12, 10.0.0.0/8 } to any
    block out quick on fxp0 inet from any to { 127.0.0.0/8, 192.168.0.0/16, \
    172.16.0.0/12, 10.0.0.0/8 }
    
    # by default, block all incoming packets, except those explicitly
    # allowed by further rules
    block in on fxp0 all
    
    # allow others to use http and https
    pass in on fxp0 inet proto tcp from any to any port 80 \
        flags S/SA keep state
    pass in on fxp0 inet proto tcp from any to any port 443 \
        flags S/SA keep state
    
    # and let out-going traffic out and maintain state on established connections
    # pass out all protocols, including TCP, UDP and ICMP, and create state,
    # so that external DNS servers can reply to our own DNS requests (UDP).
    block out on fxp0                 all
    pass  out on fxp0 inet proto tcp  all flags S/SA keep state
    pass  out on fxp0 inet proto udp  all            keep state
    pass  out on fxp0 inet proto icmp all            keep state

While this may look good, there are some things Packet Filter will let you do
to make your pf.conf file look neater and easier to maintain.

Sets

Sets are useful "shortcuts" for writing simple and clear rules in PF. For
example, what if we need to allow connections to a service running over
multiple protocols, such as BIND, which uses TCP and UDP?

    pass in quick on fxp0 inet proto { tcp, udp } from any to any port 53

Note the spaces on both sides of the '{ }' characters.

Groups of related IPs can be clustered together into sets, which can be used
anywhere a single IP could be used. For example, looking at our anti-spoofing
rules above:

    # don't allow anyone to spoof non-routeable addresses
    block in quick on fxp0 inet from { 127.0.0.0/8, 192.168.0.0/16, \
    172.16.0.0/12, 10.0.0.0/8 } to any
    block out quick on fxp0 inet from any to { 127.0.0.0/8, 192.168.0.0/16, \
    172.16.0.0/12, 10.0.0.0/8 }

Variable Expansion

One problem with the above sample pf.conf file is that should you need to
change your NIC, or change an IP address, you would need to change a number of
lines. This can be lessened by using variable expansion:

    NoRouteIPs="{ 127.0.0.0/8, 192.168.0.0/16, 172.16.0.0/12, 10.0.0.0/8 }"
    ExtIF="fxp0"
    block in quick on $ExtIF from $NoRouteIPs to any
    block out quick on $ExtIF from any to $NoRouteIPs

Putting it all together

Now, let's put it all together, and look at the elegance of the file:

    # Define useful variables
    ExtIF="fxp0"              # External Interface
    IntNet="1.1.1.0/24"       # Our internal network
    NoRouteIPs="{ 127.0.0.0/8, 192.168.0.0/16, 172.16.0.0/12, 10.0.0.0/8 }"
    Services="{ www, https }"
    
    # Clean up fragmented and abnormal packets
    scrub in all
    
    # don't allow anyone to spoof non-routeable addresses
    block in  quick on $ExtIF from $NoRouteIPs to any
    block out quick on $ExtIF from any to $NoRouteIPs
    
    # by default, block all incoming packets, except those explicitly
    # allowed by further rules
    block in on $ExtIF all
    
    # allow others to use http and https
    pass  in on $ExtIF inet proto tcp from any to any port $Services \
        flags S/SA keep state
    
    # and let out-going traffic out and maintain state on established connections
    # pass out all protocols, including TCP, UDP and ICMP, and create state,
    # so that external DNS servers can reply to our own DNS requests (UDP).
    block out on $ExtIF                 all
    pass  out on $ExtIF inet proto tcp  all flags S/SA keep state
    pass  out on $ExtIF inet proto udp  all            keep state
    pass  out on $ExtIF inet proto icmp all            keep state

If you experience problems, you may want to enable logging on individual rules
to effectively troubleshoot. ie:

    pass in log quick on fxp0 proto tcp from 1.1.1.0/24 to any port 22

pflogd(8) will write the ip log entries to /var/log/pflog. Remember that /var/
log/pflog is a binary file, intended to be read by tcpdump(8), NOT directly by
humans.

When you modify the configuration file to log packets, don't forget to pfctl -R
/etc/pf.conf for the changes to take effect!

6.3 - NAT

Note: For OpenBSD 3.2 and later, the NAT functions are incorporated in the /etc
/pf.conf file, not the separate /etc/nat.conf file used in OpenBSD 3.0 and 3.1

6.3.1 NAT Introduction

Based on RFC 1631, NAT provides an easy way to map internal networks to a
single routeable ("real") internet address. This is very useful if you don't
have officially assigned addresses for every host on your internal network.
When you set up private/internal networks, you can take advantage of reserved
address blocks (assigned in RFC 1918), such as:

10.0.0.0/8 (10.0.0.0 - 10.255.255.255)
172.16.0.0/12 (172.16.0.0 - 172.31.255.255)
192.168.0.0/16 (192.168.0.0 - 192.168.255.255)

The user is assumed to have already set up and configured an OpenBSD machine
with two network cards (one connected to the Internet and the other to the
local network).

Configuration

For the purpose of example, we will use the system described below. Your setup
will almost certainly vary from this, so be very careful in typing anything you
see here literally into your system and expecting it to work as you desire.

    NICs:
    Intel EtherExpress Pro/100 fxp0
    Connected to the EXTERNAL LAN (or WAN)
    IP Address: 24.5.0.5
    Netmask: 255.255.255.0
    
    Compaq Netelligent 10/100Mb tl0
    Connected to the INTERNAL LAN
    IP Address: 192.168.1.1
    Netmask: 255.255.255.0

    External, Internet-routeable IP (provided by ISP, in this example, a cable
    modem provider)
    IP Address: 24.5.0.5
    Netmask: 255.255.255.0
    Gateway: 24.5.0.1

    Local Area Network
    In this example environment, machines on the internal network use the IP
    addressing scheme 192.168.1.xxx (where xxx is a unique number). There could
    be a variety of different operating systems on the internal network, such
    as Windows 98, Windows NT, OpenBSD and Linux, but the client OS is not an
    issue for NAT. For the examples, the client we will look at on the internal
    network will be assumed to have an IP address of 192.168.1.40.

    Diagram of Configuration
    +-----+              +---------+          +----------+
    | Hub |--------- tl0 |   NAT   | fxp0 ----| Internet |
    +-----+              +---------+          +----------+
    | |
    | +-- Client A
    +---- More clients 
    
                      +--------------------------+
                      |          LEGEND          |
                      +--------------------------+
                      |  NIC fxp0 - 24.5.0.5     |
                      |  NIC tl0  - 192.168.1.1  |
                      | Client A  - 192.168.1.35 |
                      +--------------------------+
    

6.3.2 Network Address Translation

Introduction to NAT

Each node on the Internet requires a unique IP address. At least with IPv4,
there is a very finite number of distinct IP addresses available, and as a
result, they are not free. Most "low-cost" ISPs will limit a site to anywhere
from 1 to 30 addresses, and while larger budget organizations may be able to
afford a larger block, in most cases, there are relatively few benefits and
considerable risks to having each computer individually addressable on the
Internet.

Network Address Translation, or NAT, (also known as "IP Masquerading" if you
are coming from a Linux background) allows multiple computers to be located
"behind" one (or a small number of) IP address. Each "internal" computer has a
locally assigned, unregistered IP address (per RFC 1918), and all utilize the
same external IP address, simultaneously.

The way NAT works is rather simple. When a client on the LAN wants to connect
to a machine on the Internet, it sends out a TCP packet with a request to
connect. Inside the TCP packet header is the client's IP address (e.g.
192.168.1.40) and the requested host's IP address (e.g. 123.45.67.89). The
machine running NAT intercepts this TCP packet and changes the client's IP
address from 192.168.1.40 to the IP address of the Internet-connected machine
(e.g. 24.5.0.5). This effectively tricks the host machine into thinking the
actual connection is from the NAT machine, not the actual client's machine. The
host then sends back responses to the NAT machine like it was the one
connecting. When the NAT machine receives the responses it quickly translates
the destination IP address back from itself to the client's machine and sends
the packet to the client. The client normally does not have any idea what
happened and the apparent Internet connectivity is transparent to the user and
user's applications.

The example below shows NAT a little more clearly:

    Client ----------------- tl0 [ NAT ] fxp0 ---------- Internet Host
    192.168.1.35 --- 192.168.1.1 [ NAT ] 24.5.0.5 --- 123.45.67.89
    
    OUTGOING TCP Packet                     OUTGOING TCP Packet
    From: 192.168.1.35  >>=== NAT ===>>     From: 24.5.0.5
    To: 123.45.67.89                        To: 123.45.67.89
    
    INCOMING TCP Packet                     INCOMING TCP Packet
    From: 123.45.67.89                  From: 123.45.67.89
    To:   192.168.1.40  <<=== NAT ===<<     To: 24.5.0.5

Why use NAT?

When presented with a cable modem in my new apartment I was also presented with
another minor problem. How to get Internet access for my roommates, when the
cable modem resides in my room? There were a few options I could implement,
ranging from obtaining extra IP addresses, to setting up a proxy server, to
setting up NAT. (Don't let the home cable modem example fool you. NAT is
powerful enough to masquerade a large network with hundreds or even thousands
of computers!)

There are many reasons why I wanted to set up NAT. The number one reason is to
save money. There are two roommates in my house, splitting the cost is
certainly attractive. Further, as each roommate has their own PC and I have
three, we had five computers to connect, but my ISP only allows for three IP
addresses per household. This means that there weren't enough IP addresses to
allow every machine simultaneous direct Internet access.

By using NAT each machine will have a unique internal IP address but share the
one IP address given to me by my ISP. The cost goes down.

Setup

In order to enable NAT on your OpenBSD machine you will need to turn on PF.
This is easily accomplished by editing the files listed below (make the changes
to the file so it looks like the options below):

/etc/rc.conf (this file used to start services at boot time)

    pf=YES
    

/etc/sysctl.conf

    net.inet.ip.forwarding=1

After these changes are made, the machine is now ready for the configuration of
NAT.

Configuration

The first step is to configure the PF configuration file (/etc/pf.conf). For
the purposes of this document we will allow traffic to pass through this
firewall without any interference. The file should look like this:

    pass in all
    pass out all

Again, for more information you can read FAQ 6, Packet Filter

The NAT portion of the PF configuration file (/etc/pf.conf) has a very simple
syntax. For the configuration set forth above, the file should contain the
following entry:

    nat on fxp0 from 192.168.1.0/24 to any -> 24.5.0.5

Here is an explanation for the above lines.

"nat"
    This indicates the command you are giving is a NAT rule.

"fxp0"
    This is the network interface that is connected to the Internet.

"192.168.1.0/24"
    the IP address and netmask (the netmask is in CIDR format). Combined they
    state "any IP address of value 192.168.1.1 through 192.168.1.254" should be
    mapped.

"24.5.0.5"
    This is the external IP address the internal IP addresses will be mapped
    to.

Running

Once the configuration is complete, there are two ways to enable NAT. The first
(and best way if possible) is to reboot your OpenBSD machine. This is
accomplished with the command "reboot".

If you would like to configure NAT from the command line, use the following
commands:

    # pfctl -f /etc/pf.conf
    # pfctl -e

The first line is to load a set of NAT rules into PF (and flushing any old
rules), the second line enables PF. Again, though, rebooting is the best way to
ensure that everything will startup from a reboot as you expect.

Note: in order to reload the NAT settings (in case you edit the file but don't
want to reboot) just execute the first command over again. The settings will be
flushed and reloaded.

6.3.3 Nat Knowledge Base

Checking NAT Status

To find out how NAT is doing or make sure the settings have taken effect, you
use the "-ss" option. This option will list all the current sessions that NAT
is running:

    # pfctl -ss
    TCP  192.168.1.35:2132 -> 24.5.0.5:53136 -> 65.42.33.245:22       TIME_WAIT:TIME_WAIT
    TCP  192.168.1.35:2492 -> 24.5.0.5:55011 -> 65.42.33.245:22       ESTABLISHED:ESTABLISHED
    UDP  192.168.1.35:2491 -> 24.5.0.5:60527 -> 24.2.68.33:53       2:1

Explanations (first line, others are similar):

"192.168.1.35:2132"
    This tells you the IP address of the machine on the LAN that is using NAT
    (192.168.1.35). The port number used to make the connection (2132) is
    displayed afterwards.

"24.5.0.5:53136"
    This denotes that the connection is going to the Internet via IP address
    24.5.0.5 and using port 53136.

"65.42.33.245:22"
    The IP address and the port being connected to.

"TIME_WAIT:TIME_WAIT"
    This indicates what state PF believes the TCP connection to be in.

Issues with FTP and NAT

There are a few limitations of NAT, the most commonly encountered is with FTP.
You can use FTP in two ways: passive and active. Of these, passive FTP is
generally considered more secure.

With active FTP, when a user connects to a remote FTP server and requests
information or file, the FTP client sends the server a random port number that
the FTP server will make a connection to on the client and transfer the info.
This is a problem for users attempting to gain access to FTP servers from
within the LAN. When the FTP server sends its information it sends it to the
external NIC at a random port. The NAT machine will receive this, but because
it has no mappings for the unknown packet and doesn't have any mappings for
that port, it will drop the packet and won't deliver it.

With passive mode FTP (the default with OpenBSD ftp(1) client), the client
requests that the server picks up a random port that it will listen on for the
data connection. The server informs the client of the port it has chosen, and
the client connects to this port to transfer the data. Unfortunately, this is
not always possible or desirable. ftp(1) uses this mode by default; to force
active mode FTP, use the -A flag to ftp, or set the passive mode to off by
issuing the command

    passive off

at the ftp> prompt.

Packet Filter provides another solution for this situation, redirecting FTP
traffic through an FTP proxy server, a process which acts to "guide" your FTP
traffic through the filters. The FTP proxy used by OpenBSD and PF is ftp-proxy
(8). To activate it, put something like this in your /etc/pf.conf file:

    rdr on tl0 proto tcp from any to any port 21 -> 127.0.0.1 port 8021

Short explanation of this line is, "TCP port 21 traffic on the internal
interface is redirected to the proxy server running on this machine which is
listening at port 8021".

Hopefully, it is apparent the proxy server has to be started and running on the
OpenBSD box, this is done by inserting the following line in /etc/inetd.conf:

    127.0.0.1:8021 stream tcp nowait root /usr/libexec/ftp-proxy ftp-proxy

and either rebooting the system or sending a 'HUP' signal to inetd(8). One way
to send the 'HUP' signal is with the command:

    kill -HUP `cat /var/run/inetd.pid`

You will note that ftp-proxy is listening on port 8021, the same port the above
rdr statement was sending FTP traffic to. The choice of port 8021 is arbitrary,
though 8021 is a good choice, as it is not defined for any other application.

Redirecting Traffic

For some applications, you may need to redirect incoming or outgoing traffic
for a certain protocol and/or port to a particular machine behind the filtering
system. An example of this would be a computer residing inside the local
network running a web server which was to be accessed by the outside world, (or
of course, the already discussed ftp-proxy(8)). Incoming connections to your
valid Internet IP will find that unless your NAT box is also running a web
server, no connection can be made. For this purpose we use the NAT 'rdr'
directive in the rules file to instruct where to redirect a particular
connection to.

For our example, lets say a web server resides on the LAN with IP address of
192.168.1.80. The NAT rules file needs a new directive to handle this. Add a
line similar to the following one to your /etc/pf.conf:

    rdr on fxp0 proto tcp from any to any port 80 -> 192.168.1.80 port 80

The explanation for each part of this line:

"rdr"
    This is the command you are giving NAT. It is telling NAT that this entry
    is an entry to redirect a connection.

"on fxp0"
    This is the network interface that is connected to the Internet.

"from any to any"
    This indicates which IP addresses to redirect (from any coming in on fxp0,
    as indicated above, to any destination IP)

"port 80"
    This is the incoming port (80) that should be redirected. The number "80"
    didn't have to be used. You can use "port www" also to specify a
    redirection of port 80. If you would like to use a name instead of a
    number, the service name and corresponding port, must exist in the file /
    etc/services.

"192.168.1.80 port 80"
    The IP address of the LAN machine which the packets are redirected to. Note
    that the destination port does NOT need to match the incoming port. For
    example, the following is valid, and even potentially useful:
    rdr on fxp0 proto tcp from any to any port 8080 -> 192.168.1.35 port 80
    This line would redirect incoming traffic on port 8080 to a webserver
    running on a machine in the internal network, at the "standard" port 80.

When the addition is complete reload the NAT rules, and the redirection will
start immediately.

Negation

Sometimes, you need to make exceptions to a NAT or redirection rule. Here's an
example. AOL Instant Messenger is noted for sneaking out firewalls through any
available port. You may find that the ftp-proxy is interfering with AIM when it
chooses to go out to remote port 21. In the event you consider this bad (many
people spend considerable time trying to block AIM!), you might wish to exclude
the IP addresses used by the AIM servers from the traffic redirected by our
above ftp-proxy line. You can do this with the following line:

    rdr on tl0 proto tcp from any to ! 64.12.163.199 port 21 -> 127.0.0.1 port 8021

Interpretation: Redirect traffic coming in on tl0 going to port 21 but NOT to
64.12.163.199 (the AIM server users were having trouble with) to localhost port
8021 (where hopefully ftp-proxy is waiting). Now, be advised that there are
many AIM servers, if this application interests you, you will probably have to
play with these IP addresses (64.12.0.0/16 might be more productive, though
probably also interferes with some non-AOL sites)

NAT versus Proxy

The difference between NAT and an application-based proxy is that the proxy
software acts as a middle-man between the Internet and the machines connected
on the LAN. This is fine, however each application you want to run on your
machine and connect to the Internet through the proxy server MUST be
proxy-aware (be able to use a proxy server). Not all applications are able to
do this (especially games). Furthermore, there simply are not proxy server
applications for all of the Internet services out there. NAT transparently maps
your internal network so that it may connect to the Internet. The only security
advantage to using a proxy software over NAT is that the proxy software may
have been made security aware, and can filter based on content, to keep your
Windows machine from getting a macro virus, it can protect against buffer
overflows to your client software, and more. To maintain these filters is often
a high-maintenance job.

Redirection and reflection

Often, redirection rules are used to forward incoming connections from the
Internet to a local server with a private address in the LAN, as in:
rdr on $ext_if proto tcp from any to $ext_if port 80 -> $server port 80

But when the redirection rule is tested from a client on the LAN, it's found to
not work. The reason is that redirection rules apply only to packets that pass
through the specified interface ($ext_if, the external interface, in the
example). Connecting to the external address of the firewall from a host on the
LAN, however, does not mean the packets will actually pass through its external
interface. The TCP/IP stack on the firewall compares the destination address of
incoming packets with its own addresses and aliases, and detects connections to
itself as soon as they have passed the internal interface. Such packets do not
physically pass through the external interface, and the stack does not simulate
such a passage in any way. pf never sees these packets on the external
interface, and the redirection rule, specifying the external interface, does
not apply.

Adding a second redirection rule for the internal interface does not have the
desired effect. When the local client connects to the external address of the
firewall, the initial packet of the TCP handshake reaches the firewall through
the internal interface. The redirection rule does apply and the destination
address gets replaced with that of the internal server. The packet gets
forwarded back through the internal interface and reaches the internal server.
But the source address has not been translated, and still contains the local
client's address, so the server sends its replies directly to the client. The
firewall never sees the reply and has no chance to properly reverse the
translation. The client receives a reply from a source it never expected, and
drops it, the TCP handshake fails, and no connection can be established.

Still, it's often desirable for clients on the LAN to connect to the same
internal server as external clients, transparently. There are several solutions
for this problem:

Split horizon DNS

It's possible to configure DNS servers to answer queries from local hosts
differently than external queries, so that local clients will receive the
internal server's address during name resolution. They will then connect
directly to the local server, and the firewall isn't involved at all. This
reduces local traffic, since packets don't have to be sent through the
firewall.

Moving the server into a separate local network

Adding an additional network interface to the firewall and moving the local
server from the client's network into a dedicated network (DMZ) allows to
redirect connections from local clients in the same way as the redirection of
external connections. Use of separate networks has several advantages,
including improving security by isolating the server from the remaining local
hosts. Should the server (which in our case is reachable from the Internet)
ever become compromised, it can't access other local hosts directly, as all
connections have to pass through the firewall.

TCP proxying

A generic TCP proxy can be setup on the firewall, either listening on the port
to be forwarded or getting connections on the internal interface redirected to
the port it's listening on. When a local client connects to the firewall, the
proxy accepts the connection, establishes a second connection to the internal
server, and forwards data between those two connections.

Simple proxies can be created using inetd(8) and nc(1). The following /etc/
inetd.conf entry creates a listening socket bound to the loopback address and
port 5000. Connections are forwarded to port 80 on server 192.168.1.10.
127.0.0.1:5000 stream tcp wait nobody /usr/bin/nc nc -w 20 192.168.1.10 80

The following redirection rule forwards port 80 on the internal interface to
the proxy:
rdr on $int_if proto tcp from $int_net to $ext_if port 80 -> 127.0.0.1 port 5000

RDR and NAT combination

With an additional NAT rule on the internal interface, the lacking source
address translation described above can be achieved.
rdr on $int_if proto tcp from $int_net to $ext_if port 80 -> $server
no nat on $int_if proto tcp from $int_if to $int_net
nat on $int_if proto tcp from $int_net to $server port 80 -> $int_if

This will cause the initial packet from the client to be translated again when
it's forwarded back through the internal interface, replacing the client's
source address with the firewall's internal address. The internal server will
reply back to the firewall, which can reverse both NAT and RDR translations
when forwarding to the local client. This construct is rather complex, as it
creates two separate states for each reflected connection. Care must taken to
prevent the NAT rule from applying to other traffic, for instance connections
originating from external hosts (through other redirections) or the firewall
itself. Note that the rdr rule above will cause the TCP/IP stack to see packets
arriving on the internal interface with a destination address inside the
internal network. To prevent the stack from issuing ICMP redirect messages
(telling the client that its destination is reachable directly, breaking the
reflection), disable redirects on the gateway, using
# sysctl -w net.inet.ip.redirect=0
In general, the previously mentioned solutions should be used instead.

6.3.4 Links and Cross-References

OpenBSD files:

  * /etc/pf.conf - PF/NAT rules file
  * /etc/rc.conf - need to edit to start up NAT and PF at boot time
  * /etc/sysctl.conf - need to edit to enable IP forwarding

NAT Internet Links:

  * pf.conf man page
  * pfctl man page
  * http://www.geektools.com/rfc/rfc1631.txt

6.4 - DHCP

6.4.1 DHCP Client

To use the DHCP client dhclient(8) included with OpenBSD, edit /etc/
hostname.xl0 (this is assuming your main ethernet interface is xl0. Yours might
be ep0 or fxp0 or something else!) All you need to put in this hostname file is
'dhcp'
# echo dhcp >/etc/hostname.xl0

This will cause OpenBSD to automatically start the DHCP client on boot. OpenBSD
will gather its IP address, default gateway, and DNS servers from the DHCP
server.

If you want to start a dhcp client from the command line, make sure /etc/
dhclient.conf exists, then try:
# dhclient fxp0

Where fxp0 is the interface that you want to receive dhcp on.

No matter how you start the dhclient, you can edit the /etc/dhclient.conf file
to not update your DNS according to the dhcp server's idea of DNS by first
uncommenting the 'request' lines in it (they are examples of the default
settings, but you need to uncomment them to override dhclient's defaults.)
request subnet-mask, broadcast-address, time-offset, routers,
      domain-name, domain-name-servers, host-name, lpr-servers, ntp-servers;

and then remove domain-name-servers. Of course, you may want to remove
hostname, or other settings too.

6.4.2 DHCP Server

If you want to use OpenBSD as a DHCP server dhcpd(8), edit /etc/rc.conf. Set it
up so that dhcpd_flags="-q" instead of dhcpd_flags=NO. Put the interfaces that
you want dhcpd to listen on in /etc/dhcpd.interfaces.
     # echo xl1 xl2 xl3 >/etc/dhcpd.interfaces

Then, edit /etc/dhcpd.conf. The options are pretty self-explanatory.
        option  domain-name "xyz.mil";
d5324 6
a5329 6
xyz.mil (so, if the user types in 'telnet joe' then it will send them to
joe.xyz.mil). It will point them to DNS servers 192.168.1.3 and 192.168.1.5.
For hosts that are on the same network as an ethernet interface on the OpenBSD
machine, which is in the 192.168.1.0/24 range, it will assign them an IP
address between 192.168.1.32 and 192.168.1.127. It will set their default
gateway as 192.168.1.1.
a5332 1
     # dhcpd -q fxp0
d5334 5
a5338 2
Where fxp0 is an interface that you want to start serving DHCP on. The -q flag
makes dhcpd(8) quiet; otherwise it is very noisy.
d5341 3
a5343 2
client a 'WINS' server address. To make this happen, just the following line to
your /etc/dhcpd.conf:
d5346 1
a5346 1
(where 192.168.92.55 is the IP of your Windows or Samba server.) See 
d5351 2
a5352 2
Point-to-Protocol is generally what is used to create a connection to your ISP
via your modem. OpenBSD has 2 ways of doing this.
d5354 2
a5355 2
  * pppd(8) - Which is the kernel ppp daemon.
  * ppp(8) - Which is the userland ppp daemon.
d5357 5
a5361 3
The first one we will cover will be the userland PPP daemon. To start off you
will need some simple information about your ISP. Here is a list of helpful
information that you will need.
d5363 1
a5363 1
  * Your ISP's dialup number
d5365 1
a5365 1
  * Your username and password.
d5368 4
a5371 9
Some of these you can do without, but would be helpful in setting up your ppp.
The userland PPP daemon uses the file /etc/ppp/ppp.conf as its configuration
file. There are many helpful files in /etc/ppp that can have different setups
for many different situations. You should take a browse though that directory.

Also, make sure, that if you're not using a GENERIC kernel, that you have this
line in your configuration file:

    pseudo-device   tun             2
d5376 4
a5379 6
ppp.conf file. This file doesn't exist by default, but there is a file /etc/ppp
/ppp.conf.sample in which you can simply edit to create your own ppp.conf file.
Here I will start with the simplist setup and probably most used setup. Here is
a quick ppp.conf file that will simply connect to your ISP and set your default
routes and nameserver. With this file all the information you need is your
ISP's phone number and your username and password.
d5382 13
a5394 13
    set log Phase Chat LCP IPCP CCP tun command     
    set device /dev/cua01                           
    set speed 115200     
    set dial "ABORT BUSY ABORT NO\\sCARRIER TIMEOUT 5 \"\" AT OK-AT-OK ATE1Q0 OK\\dATDT\\T TIMEOUT 40 CONNECT"

The section under the default: tag will get executed each time. Here we setup
all our critical information. Here with "set log" we set our logging levels.
This can be changed, refer to ppp(8) for more info on setting up logging
levels. Our device gets set with "set device". This is the device that the
modem is on. In this example the modem is on com port 2. Therefore com port 1
would be /dev/cua00. With "set speed" we set the speed of our dialup connection
and with "set dial" we set our dialup parameters. With this we can change our
timeout time, etc. This line should stay pretty much as it is though.
d5396 1
a5396 1
Now we can move on and setup our information specific to our ISP. We do this by
d5398 1
a5398 1
you want, easiest to just use the name of your ISP. Here I will use myisp: as
d5400 1
a5400 1
to get ourselves connected.
d5403 17
a5419 16
    set phone 1234567   
    set login "ABORT NO\\sCARRIER TIMEOUT 5 ogin:--ogin: ppp word: ppp"
    set timeout 120   
    set ifaddr 10.0.0.1/0 10.0.0.2/0 255.255.255.0 0.0.0.0
    add default HISADDR 
    enable dns

Here we have setup essential info for that specific ISP. The first option "set
phone" sets your ISP's dialup number. The "set login" sets our login options.
Here we have the timeout set to 5, this means that we will abort our login
attempt after 5 seconds if no carrier. Otherwise it will wait for "login:" to
be sent and send in your username and password. In this example our Username =
ppp and Password = ppp. These values will need to be changed. The line "set
timeout" sets the idle timeout for the entire connection duration to 120
seconds. The "set ifaddr" line is a little tricky. Here is a more extensive
explanation.
d5426 1
a5426 1
example we use /0 which says that no bits of this ip address need to match and
d5429 6
a5434 6
what will be assigned, so we let them tell us. The third option is our netmask,
here set to 255.255.255.0. If triggeraddr is specified, it is used in place of
myaddr in the initial IPCP negotiation. However, only an address in the myaddr
range will be accepted. This is useful when negotiating with some PPP
implementations that will not assign an IP number unless their peer requests
``0.0.0.0''.
d5439 1
a5439 1
authenticate our nameserver addresses. Do NOT do this if you are running an
d5443 20
d5465 2
a5466 2
Now that we have our ppp.conf file setup we can start trying to make a
connection to our ISP. I will detail some commonly used arguments with ppp.
d5473 5
a5477 3
By using /usr/sbin/ppp with no options will put you into interactive mode. From
here you can interact directly with the modem, it is great for debugging
problems in your ppp.conf file.
d5482 2
a5483 2
or dropped. There are two files you can create for just these situations. /etc/
ppp/ppp.linkup and /etc/ppp/ppp.linkdown. Sample configurations can be viewed
d5489 1
a5489 1
Extended information can be found at FreeBSD Handbook entry on User PPP.
d5491 28
a5518 1
6.6 - Tuning networking parameters
d5520 1
a5520 2
6.6.1 - How can I tweak the kernel so that there are a higher number of retries
and longer timeouts for TCP sessions?
d5522 6
a5527 3
You would normally use this to allow for routing or connection problems. Of
course, for it to be most effective, both sides of the connection need to use
similar values.
d5529 1
a5529 4
To tweak this, use sysctl and increase the values of:
net.inet.tcp.keepinittime
net.inet.tcp.keepidle
net.inet.tcp.keepintvl
d5531 4
a5534 3
Using sysctl -a, you can see the current values of these (and many other)
parameters. To change one, use sysctl -w, as in sysctl -w net.inet.tcp.keepidle
=28800.
d5536 1
a5536 1
6.6.2 - How can I turn on directed broadcasts?
d5538 1
a5538 3
Normally, you don't want to do this. This allows someone to send traffic to the
broadcast address(es) of your connected network(s) if you are using your
OpenBSD box as a router.
d5540 1
a5540 4
There are some instances, in closed networks, where this may be useful,
particularly when using older implementations of the NetBIOS protocol. This is
another sysctl. sysctl -w net.inet.ip.directed-broadcast=1 turns this on. Read
about smurf attacks if you want to know why it is off by default.
d5542 2
a5543 1
6.6.3 - I don't want the kernel to dynamically allocate a certain port
d5545 1
a5545 5
There is a sysctl for this also. From sysctl(8):
Set the list of reserved TCP ports that should not be allocated by the
kernel dynamically.  This can be used to keep daemons from stealing a
specific port that another program needs to function.  List elements may
be separated by commas and/or whitespace.
d5547 3
a5549 1
 #  sysctl -w  net.inet.tcp.baddynamic=749,750,751,760,761,871
d5551 1
a5551 1
It is also possible to add or remove ports from the current list.
d5553 2
a5554 2
 #  sysctl -w net.inet.tcp.baddynamic=+748
 #  sysctl -w net.inet.tcp.baddynamic=-871
d5576 21
a5596 16
Another important security note. Don't just add a filesystem to /etc/exports
without some kind of list of allowed host(s). Without a list of hosts which can
mount a particular directory, anyone on who can reach your host will be able to
mount your NFS exports.

NFS depends upon portmap(8) to be running before it will operate. Portmap(8) is
now off by default on OpenBSD 3.2 and later, so you must enable it in rc.conf
(8) by changing the portmap line to read:

    portmap=YES

and reboot to make it take effect.

The setup consists of a server with the ip 10.0.0.1. This server will be
serving NFS only to clients within that network. The first step to setting up
NFS is to setup your /etc/exports file. This file lists which filesystems you
d5598 2
a5599 2
are many options that you can use in your /etc/exports file, and it is best
that you read the exports(5) man page. For this example we have an /etc/exports
d5606 54
a5659 1
    /work -alldirs -ro -network 10.0.0 -mask 255.255.255.0
d5661 6
a5666 24
This means that the local filesystem /work will be made available via NFS.
-alldirs specifies that clients will be able to mount at any point under the /
work mount point. -ro specifies that it will only be allowed to be mounted
read-only. The last two arguments specify that only clients within the 10.0.0.0
network using a netmask of 255.255.255.0 will be authorized to mount this
filesystem. This is important for some servers that are accessible by different
networks.

Once your /etc/exports file is setup, you can go ahead and setup your NFS
server. You should first make sure that options NFSSERVER & NFSCLIENT are in
your kernel configuration. (GENERIC kernel has these options included.) Next,
you should set nfs_server=YES in /etc/rc.conf. This will bring up both nfsd(8)
and mountd(8) when you reboot. Now, you can go ahead and start the daemons
yourself. These daemons need to be started as root, and you need to make sure
that portmap(8) is running on your system. Here is an example of starting nfsd
(8) which serves on both TCP and UDP using 4 daemons. You should set an
appropriate number of NFS server daemons to handle the maximum number of
concurrent client requests that you want to service.

    # /sbin/nfsd -tun 4

Not only do you have to start the nfsd(8) server, but you need to start mountd
(8). This is the daemon that actually services the mount requests on NFS. To
start mountd(8), make sure an empty mountdtab file exists, and run the daemon:
d5668 3
a5670 2
    # echo -n >/var/db/mountdtab
    # /sbin/mountd
d5672 11
a5682 2
If you make changes to /etc/exports while NFS is already running, you need to
make mountd aware of this! Just HUP it:
d5684 2
a5685 1
    # kill -HUP `cat /var/run/mountd.pid`
d5689 2
a5690 2
From here, you can check to make sure that all these daemons are up and
registered with RPC. To do this, use rpcinfo(8).
d5705 5
a5709 5
During normal usage, there are a few other utilities that allow you to see what
is happening with NFS. One is showmount(8), which allows you to view what is
currently mounted and who is mounting it. There is also nfsstat(8) which shows
much more verbose statistics. To use showmount(8), try /usr/bin/showmount -a
host. For example:
d5715 2
a5716 1
Mounting NFS Filesystems
d5718 1
a5718 4
NFS filesystems should be mounted via mount(8), or more specifically, mount_nfs
(8). To mount a filesystem /work on host 10.0.0.1 to local filesystem /mnt, do
this (note that you don't need to use an IP address, mount will resolve host
names):
d5720 6
a5725 1
    # mount -t nfs 10.0.0.1:/work /mnt
d5727 1
a5727 515
To have your system mount upon boot, add something like this to your /etc/
fstab:

    10.0.0.1:/work /mnt nfs rw 0 0

It is important that you use 0 0 at the end of this line so that your computer
does not try to fsck the NFS filesystem on boot!!!! The other standard security
options, such as noexec, nodev, and nosuid, should also be used where
applicable. Such as:

    10.0.0.1:/work /mnt nfs rw,nodev,nosuid 0 0

This way, no devices or setuid programs on the NFS server can subvert security
measures on the NFS client. If you are not mounting programs which you expect
to run on the NFS client, add noexec to this list.

6.8 - Domain Name Service - DNS, BIND, and named

6.8.1 What is DNS?

Domain Name Service is a network facility allowing IP network domains to
provide name-to-IP address resolution and IP address-to-name resolution in
response to a query. Your OpenBSD installation is configured by default as a
DNS client but not as a DNS server. That is, your OpenBSD installation can
perform a DNS query against a domain name server for the address of a machine,
but it cannot answer such DNS queries itself unless you specifically configure
it to do so.

My OpenBSD machine is currently connected to the Internet via my ISP, so I can
use the nslookup(8) utility to execute the DNS query:

    $ nslookup www.openbsd.org
    Server:  ns4.us.prserv.net
    Address:  165.87.201.244
    
    Non-authoritative answer:
    Name:    www.openbsd.org
    Address:  129.128.5.191

165.87.201.244 is the name server which answered, because it is the nameserver
that my ISP told me to use with my account and whose number is entered in /etc/
resolv.conf. But the answer was not authoritative. For an authoritative answer,
let's find which is the authoritative DNS server for the openbsd.org domain and
ask it for the address of www.openbsd.org:

    # Identify the name servers for openbsd.org
    # with the help of my ISP's name server.
    $ nslookup -type=NS openbsd.org
    Server:  ns4.us.prserv.net
    Address:  165.87.201.244
    
    Non-authoritative answer:
    openbsd.org     nameserver = cvs.openbsd.org
    openbsd.org     nameserver = gandalf.sigmasoft.com
    openbsd.org     nameserver = cs.colorado.edu
    openbsd.org     nameserver = ns.appli.se
    openbsd.org     nameserver = zeus.theos.com
    
    Authoritative answers can be found from:
    cvs.openbsd.org internet address = 199.185.137.3
    gandalf.sigmasoft.com   internet address = 198.144.202.98
    cs.colorado.edu internet address = 128.138.243.151
    ns.appli.se     internet address = 194.198.196.230
    zeus.theos.com  internet address = 199.185.137.1
    
    # Use the info gained to query for an authoritative
    # resolution: query the authoritative zeus.theos.com.
    $ nslookup www.openbsd.org zeus.theos.com
    Server:  zeus.theos.com
    Address:  199.185.137.1
    
    Name:    www.openbsd.org
    Address:  129.128.5.191

zeus.theos.com is, one would suppose, running OpenBSD and is properly
configured to be a DNS server for the openbsd.org domain.

6.8.1.1 Where can I learn all about DNS and its implementation under OpenBSD?

  * See RFCs 1033, 1034, and 1035 for more information on the Internet
    name-domain system.
  * Read the O'Reilly Associates book DNS and BIND .
  * Read the OpenBSD Manual especially the pages for
      + dig(1)
      + nslookup(8)
      + gethostbyname(3)
      + named(8)
      + resolver(3)
      + resolver(5)

The dig(1) command is especially useful, because it can query a domain and
return information in much the same record format as required in BIND
configuration files. You can use dig(1) to examine name servers you know to be
operating properly as a way of comparing your setup to theirs.

6.8.2 Does my machine need to be a domain name server?

If you aren't sure that you need your machine to perform the role of DNS
server, don't configure it as one. The OpenBSD installation does not, by
default, activate your machine as a domain name server, though all necessary
files are installed. For most workstations, just the /etc/hosts file naming
local machines' IP addresses and the /etc/resolv.conf file for indicating which
DNS servers serve you out on the intranet or internet is sufficient.

On the other hand, you might need to set up a machine as a domain name server:

  * If you have an IP LAN on which you do not wish to replicate "hosts" files
    of local addresses machine by machine. In such a case, you may configure
    your OpenBSD machine as a DNS server and serve queries from the other
    machines on your LAN.
      + Note: There is no practical restriction on the number of DNS servers on
        a LAN. Any or all machines on the LAN may offer DNS service if they are
        so configured. Whether any such server is considered authoritative from
        outside your LAN (or is even known from outside your LAN) is a
        configuration factor that typically is controlled at the next level up
        from your LAN in the domain hierarchy.
  * If you have an IP LAN on which reside machines you will wish to be findable
    via DNS query by machines on another IP LAN or WAN.
  * If you experience difficulties resolving the local hostname to an IP
    address, or resolving other local names to IP addresses even though you
    have correct /etc/hosts and /etc/resolv.conf (E.g., Netscape on OpenBSD
    sometimes exhibits this behavior because it implements its own resolver
    instead of just using gethostbyname(3) to look up addresses.)

One more consideration is speed of execution. Since name resolution is an
iterative process, in which the name server makes repeated queries to other
nameservers for addresses in remote domains, name resolution may take slightly
longer if you have a modem connection to the Internet and are querying your own
DNS server for remote addresses (which will then iteratively query remote name
servers via the modem) than if you are querying your ISP's name server (which
probably has a faster connection to remote name servers).

6.8.3 What are the software components of the DNS server?

  * named ("name daemon")
  * Configuration files in the directory hierarchy under /var/named/

6.8.3.1 What level of BIND is supported?

BIND is the name of the behavioral specification of a domain name server.
Domain name server components exist to collectively implement BIND.

There are three distinct BIND specifications:

 1. BIND 4
 2. BIND 8
 3. BIND 9

As installed, OpenBSD named supports BIND 4.x.

6.8.3.2 What are some of the alternatives to providing DNS via the default BIND
4.x implementation?

  * The BIND 9.x implementation in /usr/ports/net/bind9.(See ports)

6.8.3.2.1 Security note

If you use these alternative implementations of domain name service, you are
providing a critical network service using software which may not have been
subject to quite the same level of scrutiny as the security-audited named name
daemon in the base installation. This is a significant consideration, since if
a domain name server is compromised, resolvers using that name server can be
re-directed to impostor sites.

6.8.4 How much do I have to install?

If the default networking setup was installed properly at OpenBSD installation
time, everything is already installed. You just have to configure the name
daemon ("named").

6.8.5 How do I configure DNS?

You configure OpenBSD DNS by editing and/or creating files that control the
name daemon named. These files reside by default in the directory /var/named
and its subdirectories, especially the file /var/named/named.boot which is the
initialization file for named. There are also a couple of other configuration
steps to be taken in /etc.

In this document, we will configure the name daemon on nemo.yewtopia.com be the
primary nameserver for the (very small!) domain yewtopia.com. The address of
nemo.yewtopia.com is 192.168.1.9. Two other machines are on that subnet,
crater.yewtopia.com at 192.168.1.1 and earhart.yewtopia.com at 192.168.1.2.

6.8.5.1 Configuration in /var/named

6.8.5.1.1 /var/named/named.boot

    ; tell what subdir has the lookup database files
    directory       /namedb
    
    ; type    domain   source host/file backup file
    cache     .    root.cache
    primary   0.0.127.IN-ADDR.ARPA  localhost.rev
    
    ; example primary server config:
    primary  yewtopia.com yewtopia
    primary  1.168.192.IN-ADDR.ARPA yewtopia.rev

This tells the initialization process in what subdirectory and under which
filenames to find the configuration files for yewtopia.com.

6.8.5.1.2 /var/named/namedb/localhost.rev

    ; Reverse lookup for localhost interface
    @@       IN      SOA     nemo.yewtopia.com.  your_id.nemo.yewtopia.com.  (
                                    14      ; Serial
                                    3600    ; Refresh
                                    900     ; Retry
                                    3600000 ; Expire
                                    3600 )  ; Minimum
            IN      NS      nemo.yewtopia.com.
    1       IN      PTR     localhost.yewtopia.com.

6.8.5.1.3 /var/named/namedb/yewtopia

    ; yewtopia.com domain database
    @@      IN      SOA     nemo.yewtopia.com.  your_id.nemo.yewtopia.com.  (
                                    14      ; Serial
                                    3600    ; Refresh
                                    900     ; Retry
                                    3600000 ; Expire
                                    3600 )  ; Minimum
                         IN      NS      nemo.yewtopia.com.
    
    ; Addresses
    localhost.yewtopia.com.      IN A    127.0.0.1
    crater.yewtopia.com.         IN A    192.168.1.1
    earhart.yewtopia.com.        IN A    192.168.1.2
    nemo.yewtopia.com.           IN A    192.168.1.9

6.8.5.1.4 /var/named/namedb/yewtopia.rev

    ; yewtopia domain reverse lookup database
    @@      IN      SOA     nemo.yewtopia.com.  your_id.nemo.yewtopia.com.  (
                                    14      ; Serial
                                    3600    ; Refresh
                                    900     ; Retry
                                    3600000 ; Expire
                                    3600 )  ; Minimum
    1.168.192.in-addr.arpa. IN      NS      nemo.yewtopia.com.
    
    ; Addresses
    1.1.168.192.in-addr.arpa. IN PTR crater.yewtopia.com.
    2.1.168.192.in-addr.arpa. IN PTR earhart.yewtopia.com.
    9.1.168.192.in-addr.arpa. IN PTR nemo.yewtopia.com.

6.8.5.2 Configuration in /etc

6.8.5.2.1 /etc/resolv.conf

Make sure /etc/resolv.conf now points to the domain of local machine (instead
of, for example, your ISP's name server) so that name resolution requests
actually get sent to the named you have configured!

    domain yewtopia.com
    lookup file bind

6.8.5.2.2 /etc/hosts

If you previously had added the addresses of various machines to the /etc/hosts
file, you might consider shortening your /etc/hosts file back to the default:

    # Host addresses
    127.0.0.1       localhost       localhost.localdomain
    192.168.1.9     nemo            nemo.yewtopia.com

So that named isn't bypassed in favor of (possibly outdated) addresses in the /
etc/hosts file. Make sure you have at least the default localhost entry or your
network won't start properly! Note also nemo must appear in its own hosts file
or you will see a (mostly harmless) error message at bootup when /etc/netstart
invokes route(8) in order to add nemo (whose name appears in /etc/myname).

6.8.5.3 Using dig(1) to examine the results.

    $ dig @@nemo.yewtopia.com yewtopia.com any any
    
    ; <<>> DiG 2.2 <<>> @@nemo.yewtopia yewtopia any any
    ; (1 server found)
    ;; res options: init recurs defnam dnsrch
    ;; got answer:
    ;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 59904
    ;; flags: qr rd ra; Ques: 1, Ans: 2, Auth: 0, Addit: 1
    ;; QUESTIONS:
    ;;      yewtopia.com, type = ANY, class = ANY
    
    ;; ANSWERS:
    yewtopia.com.   3600    SOA    nemo.yewtopia.com.  your_id.nemo.yewtopia.com. (
                            14      ; serial
                            3600    ; refresh (1 hour)
                            900     ; retry (15 mins)
                            3600000 ; expire (41 days 16 hours)
                            3600 )  ; minimum (1 hour)
    yewtopia.com.   3600    NS      nemo.yewtopia.com.
    
    ;; ADDITIONAL RECORDS:
    nemo.yewtopia.com.  3600    A       192.168.1.9
    
    ;; Total query time: 4 msec
    ;; FROM: nemo to SERVER: nemo.yewtopia.com  192.168.1.9
    ;; WHEN: Tue May  2 23:47:19 2000
    ;; MSG SIZE  sent: 25  rcvd: 102

6.8.6 How and when do I start and stop DNS?

6.8.6.1 Starting DNS

The name daemon named is launched during system startup from /etc/rc if the
line installed by default in /etc/rc.conf.

    named_flags=NO          # for normal use: ""

is changed to

    named_flags=""          # for normal use: ""

Also, examine these lines in /etc/rc.conf:

    named_user=named                # Named should not run as root unless necessary
    named_chroot=/var/named         # Where to chroot named if not empty

These defaults will be correct for nearly all setups.

To start named by hand, use the ndc(8) command. For example:

    # ndc start
              or
    # ndc restart

6.8.6.2 Stopping DNS

The best way to stop the name daemon is to use the ndc(8) command. For example:

    # ndc stop

If this fails to work, find the process id of named and use the kill(1) command
to end that process. The PID for named while it is running is found as the
first line in the file /var/named/named.pid

    # cat /var/named/named.pid
    4608
    named -t /var/named -u named
    # kill -KILL 4608

6.8.6.3 Restarting DNS with an altered configuration

To cause a running instance of the name daemon to restart itself reloading its
configuration after you have made changes, send it a "hangup" signal:

    # kill -HUP 4608 

or by using the ndc(8) command. For example:

    # ndc reload

6.8.7 How do I block AXFR queries?

example:

    garden:/home/jeremy$  host -l openssh.com
    openssh.com.            NS      zeus.theos.com.
    openssh.com.            NS      cvs.openbsd.org.
    openssh.com.            NS      gandalf.sigmasoft.com.
    openssh.com.            NS      cs.colorado.edu.
    openssh.com.            NS      ns.appli.se.
    openssh.com.            A       199.185.137.4
    cvs.openssh.com.        A       199.185.137.4
    localhost.openssh.com.  A       127.0.0.1

This information is useful for debugging DNS, but in some instances you may not
want this output publicly offered. If you are using classless in-addr(rfc2317)
for reverse, host -l may report every domain that your system hosts! This can
easily be remedied by the 'allow-transfer' clause in your zone file.

If you're using Bind8 you need to specify the hosts you want to allow to
transfer zones in your individual zone file(s):

    zone "foo.com" in {
            type master;
            file "directory/zonefile";
            allow-transfer {
              127.0.0.1;
              10.0.0.6;
              10.0.255.12;
            };
    };

You can also block transfers for all domains by editing /var/named.conf and add
the 'allow-transfer' parameter to the 'options' section of the configuration
file:

       options {
            allow-transfer { 127.0.0.1; };
        };

The Bind8 method also works with Bind9.
If you are using Bind 4 (default in OpenBSD) you can edit /var/named/named.boot
and use the 'xfrnets' option.

    xfrnets 209.142.221.5 12.7.96.7
    ; type    domain                source host/file                backup file
    cache     .                                                     root.cache
    primary   0.0.127.IN-ADDR.ARPA  localhost.rev

Bind 4 allows transfers from entire classes so it is not as exact. Typically,
the only hosts that need to perform transfers are your DNS slaves and hosts you
may want to debug from (127.0.0.1 is usually a good host to allow transfers
from!) Blocking AXFR queries adds an extra level of privacy, but can hinder
useful DNS debugging. (Thanks to Nicholas Tang for that tip)

6.8.8 What didn't you tell me about setting up DNS?

There's a lot we didn't tell you, for example, how to set up DNS so that
queries for intranet domains that aren't visible from the root of the domain
hierarchy get relayed to servers within your enterprise. Read the documents we
recommended for more information on DNS.

6.9 - Setting up a PPTP connection in OpenBSD

NOTE: This does not apply to ALL ADSL providers, but much information can be
gleaned from the setup here. This is known to work for Inode, an ADSL provider
in Austria.

To start off, you need to install pptp. The port is located at /usr/ports/net/
pptp. Read FAQ 8, Ports for more information on the OpenBSD ports tree.

Because of a conflict between the In-Kernel gre(4) support and pptp, you will
need to re-compile your kernel, removing support for gre(4).

    Patch to remove GRE(4) support.
    Index: GENERIC
    ===================================================================
    RCS file: /cvs/src/sys/conf/GENERIC,v
    retrieving revision 1.86
    diff -u -r1.86 GENERIC
    --- GENERIC     14 Mar 2002 00:42:25 -0000      1.86
    +++ GENERIC     17 May 2002 01:52:17 -0000
    @@@@ -87,7 +87,7 @@@@
     pseudo-device  enc     1       # option IPSEC needs the encapsulation interface
     pseudo-device  bridge  2       # network bridging support
     pseudo-device  vlan    2       # IEEE 802.1Q VLAN
    -pseudo-device  gre     1       # GRE encapsulation interface
    +#pseudo-device gre     1       # GRE encapsulation interface
     #pseudo-device strip   1       # Starmode Radio IP interface
    
     pseudo-device  pty     64      # pseudo-terminals

To recompile your kernel, check out OpenBSD source via cvs (refer to AnonCVS
web page for more information), apply the following patch, and rebuild your
kernel as per FAQ 5, Building a kernel.

After you have the pptp package installed and a new kernel, you need to edit a
few files to setup for your connection. This packages uses the in-house OpenBSD
ppp(8), so if you are familiar with ppp(8), much of the setup is the same.
Also, refer to FAQ 6, PPP.

  * 1 - /etc/ppp/options
  * 2 - /etc/ppp/pap-secrets

For the /etc/ppp/options file, a setup like below will most likely do all that
you need:

    # cat /etc/ppp/options
    name "LOGINNAME"
    noauth
    noipdefault
    defaultroute
    debug

LOGINNAME should be replaced with your User-ID.

The /etc/ppp/pap-secrets a line like:

    # cat /etc/ppp/pap-secrets
    LOGINNAME 10.0.0.138 PASSWORD

Where LOGINNAME is your User-ID and PASSWORD is your password. 10.0.0.138 is
the IP assigned to your MODEM in the case that you are using ADSL, etc. Make
sure this file stays readonly by root (mode 600).

6.9.1 - Assigning an address to your Network Interface

In the above example, our modem came with a preconfigured interface of
10.0.0.138. We now need to assign an address to OUR interface, It's best to
pick an IP close to the one given by your MODEM, or use the static IP assigned
to you. Read more about setting up interfaces in FAQ 6, Setup.

Once your interface is setup, you should be able to create a pptp connection
with the command:

    # /usr/local/sbin/pptp 10.0.0.138 &

Since this uses the in-house OpenBSD ppp(8), two processes are started. You can
kill pptp by killing both these processes:

    # kill -9 [pid of pppd]
    $ kill -9 [pid of pptp]

It is recommended to open /var/log/messages in a extra terminal window, to
recognize possible problems.

    # tail -f /var/log/messages

We also suggest that you put the startup command in /etc/rc.local so that you
automatically connect on reboot.

6.10 - Setting up a network bridge in OpenBSD

A bridge is a link between two or more separate networks. Unlike a router,
packets transfer through the bridge "invisibly" -- logically, the two network
segments appear to be one segment to nodes on either side of the bridge. The
bridge will only forward packets that have to pass from one segment to the
other, so among other things, they provide an easy way to reduce traffic in a
complex network and yet allow any node to access any other node when needed.

Note that because of this "invisible" nature, an interface in a bridge may or
d5731 2
a5732 2
will pass network data, but will not be externally maintainable (which can be a
feature).
d5734 1
a5734 1
An example of a bridge application
d5737 5
a5741 5
built-in 10BASE-TX NIC. While they all have an AUI or AAUI connector, my supply
of transceivers is limited to coax. One of the machines on this rack is an
OpenBSD-based terminal server which always on and connected to the high-speed
network. Adding a second NIC with a coax port will allow me to use this machine
as a bridge to the coax network.
d5745 1
a5745 1
network and will thus has an IP address, ep0 is going to be for bridging only
d5754 1
a5754 1
    dhcp NONE NONE NONE NONE
d5769 1
a5769 1
a file named something like bridgename.bridge0. Here is an example for my
d5772 1
a5772 1
    $ cat /etc/bridgename.bridge0
d5783 57
d5856 2
a5857 2
Now, let's say I wish to filter traffic hitting these old machines, I want only
Web and SSH traffic to reach them. In this case, we are going to let all
d5864 1
a5864 1
    
d5868 1
a5868 1
    
d5872 3
a5874 3
Note that this rule set will prevent anything but incoming HTTP and SSH traffic
from reaching either the bridge machine or any of the other nodes "behind" it.
Other results could be had by filtering the other interface.
d5876 1
a5876 1
To monitor and control the bridge you have created, use the brconfig(8)
d5881 4
a5884 4
  * It is HIGHLY recommended that you filter on only one interface. While it is
    possible to filter on both, you really need to understand this very well to
    do it right.
  * By using the blocknonip option of brconfig(8) or in bridgename.bridge0, you
d5890 503
a6392 3
    put a higher load on the processor and bus than one might expect. Some NICs
    don't work properly in this mode, the TI ThunderLAN chip (tl(4)) is an
    example of a chip that won't work as part of a bridge.
d6394 3
a6396 2
[Back to Main Index] [To Section 5.0 - Kernel configuration and Disk Setup] [To
Section 7.0 - Keyboard controls]
d6398 3
a6400 4
-------------------------------------------------------------------------------
[back] www@@openbsd.org
$OpenBSD: obsd-faq.txt,v 1.33 2003/01/05 19:29:10 nick Exp $
[OpenBSD]
d6402 3
a6404 1
7.0 - Keyboard and Display Controls
d6406 4
a6409 1
-------------------------------------------------------------------------------
d6411 10
a6420 1
Table of Contents
d6422 6
a6427 8
  * 7.1 - How do I remap the keyboard? (wscons)
  * 7.2 - Is there gpm or the like in OpenBSD?
  * 7.3 - How do I clear the console each time a user logs out?
  * 7.4 - Accessing the console scrollback buffer. (alpha/macppc/i386)
  * 7.5 - How do I switch consoles? (i386)
  * 7.6 - How can I use a console resolution of 80x50? (i386)
  * 7.7 - How do I use a serial console?
  * 7.8 - How do I blank my console? (wscons)
d6429 6
a6434 1
-------------------------------------------------------------------------------
d6436 2
d6439 5
a6443 1
7.1 - How do I remap the keyboard? (wscons)
a6444 2
The ports that use the wscons(4) console driver: alpha, i386, and macppc. For
OpenBSD 3.0 and after:
d6446 3
a6448 3
With wscons(4) consoles, most options can be controlled using the wsconsctl(8)
utility. For example, to change keymappings with wsconsctl(8) one would execute
the following:
d6450 1
a6450 1
    # wsconsctl -w keyboard.encoding=uk
d6452 1
a6452 1
In the next example, we will remap "Caps Lock" to be "Control L":
d6454 1
a6454 1
    # wsconsctl -w keyboard.map+="keysym Caps_Lock = Control_L"
d6456 10
a6465 1
For OpenBSD 2.9:
d6467 1
a6467 4
OpenBSD 2.9 expected slightly different arguments for the wsconsctl command; in
specific, you didn't need to prepend the ``keyboard'' keyword, but to specify
that the command applied to the keyboard portion of the device with the ``-k''
flag.
a6468 1
    # wsconsctl -k -w encoding=uk
d6470 1
a6470 1
and
d6472 1
a6472 1
    # wsconsctl -k -w map+="keysym Caps_Lock = Control_L"
d6474 3
a6476 1
This will load the keycap file for Great Britain.
d6478 1
a6478 1
7.2 - Is there gpm or the like in OpenBSD?
d6480 2
a6481 3
For the alpha and i386 platforms, OpenBSD provides wsmoused(8), a port of
FreeBSD's moused(8). It can be enabled automatically at startup by editing the
appropriate line in rc.conf(8).
d6483 1
a6483 1
7.3 - Clearing the console each time a user logs out.
d6485 1
a6485 1
To do this you must add a line in /etc/gettytab(5). Change the current section:
d6487 3
a6489 2
    P|Pc|Pc console:\
            :np:sp#9600:
d6491 1
a6491 2
adding the line ":cl=\E[H\E[2J:" at the end, so that it ends up looking like
this:
d6493 4
a6496 9
    P|Pc|Pc console:\
            :np:sp#9600:\
        :cl=\E[H\E[2J:

7.4 - Accessing the Console Scrollback Buffer (alpha/macppc/i386)

OpenBSD provides a console scrollback buffer. This allows you to see
information that has already scrolled past your screen. To move up and down in
the buffer, simply use the key combinations [SHIFT]+[PGUP] and [SHIFT]+[PGDN]
d6499 17
a6515 1
view, is 8.
d6517 7
a6523 1
7.5 - How do I switch consoles? (i386)
d6525 1
a6525 3
The user on an i386 system can switch between five virtual terminals from the
console by hitting [CTRL]+[ALT]+[F1], [CTRL]+[ALT]+[F2], [CTRL]+[ALT]+[F3],
[CTRL]+[ALT]+[F4] and [CTRL]+[ALT]+[F6].
d6527 22
a6548 13
This can also be done from within the X environment, which will take you out of
the graphical environment back to a text-mode environment. To return to the
graphical environment, hit [CTRL]+[ALT]+[F5].

7.6 - How do I use a console resolution of 80x50? (i386)

i386 users normally get a console screen of 25 lines of 80 characters. However,
the many VGA video cards are capable of displaying a higher text resolution of
50 lines of 80 characters.

First, a font that supports the desired resolution must be loaded using the 
wsfontload(8) command. The standard 80x25 text screen uses 8x16 pixel fonts, to
double the vertical resolution, we will have to use 8x8 pixel fonts.
d6553 2
a6554 2
This can be done automatically at boot by adding the following lines to the end
of your rc.local(8) file:
d6564 13
a6576 14
(which would be accessed by [CTRL]-[ALT]-[F6]). The third line creates a new
screen 5 with the resolution of 50 lines of 80 characters each. If you do this,
you will see your primary screen, and the other three default virtual consoles,
come up in the standard 80x25 mode, but a new screen 5 accessible through
[CTRL]-[ALT]-[F6]

Note that [CTRL]-[ALT]-[F1] is screen 0 here. If you wish to alter the other
screens, simply repeat the delete and add screen steps for whichever screens
you want running at the 80x50 resolution.

You should avoid changing screen 4 (ttyC4, [CTRL]-[ALT]-[F5]), which is used by
X as a graphical screen. You can also add more virtual terminals to your
OpenBSD system by altering /etc/ttys(5), which can then be made whichever
resolution you prefer.
d6579 1
a6579 1
prompt, as root.
d6581 5
a6585 3
Note: this will not work on all video cards. Unfortunately, not all video cards
support the uploaded fonts that wscons(4) requires to achieve the 80x50 text
mode. In these cases, you might wish to consider running X.
d6587 1
a6587 1
7.7 - How do I use a serial console?
d6600 2
a6601 2
OpenBSD supports serial console on most platforms, however details vary greatly
between platforms.
d6604 6
a6609 6
unusual cables, and ports are not standardized between machines, in some cases,
not even consistent on one machine. It is assumed you know how to select the
appropriate cable to go between your computer and the device acting as your
serial terminal. A full tutorial on serial interfacing is beyond the scope of
this article, however, we offer one hint: just because the ends plug in doesn't
mean it will work.
d6614 1
a6614 1
system. First, you must have OpenBSD to use your serial port as a console for
d6622 5
a6626 4
after all, there are other uses for a serial port other than for a terminal. In
platforms which typically have an attached keyboard and screen as a console,
the serial terminal is typically disabled by default. We'll use the i386
platform as an example. In this case, you must edit the line that reads:
d6628 18
a6645 8
to read:
     tty00   "/usr/libexec/getty std.9600"   vt100   on secure
Here, tty00 is the serial port we are using as a console. The "on" activates
the getty for that serial port so it can a "login:" prompt will be presented,
the "secure" permits a root (uid 0) login at this console (which may or may not
be what you desire), and the "9600" is the terminal baud rate. Note that you
can use a serial console for install without doing this step, as the system is
running in single user mode, and not using getty for login.
d6651 1
a6651 1
i386
d6655 1
a6656 6
assuming you want the first serial port to be used as your console. The default
baud rate is 9600bps, this can be changed with a /etc/boot.conf line using the
stty option. This file is put on your boot drive, which could also be your
install floppy, or the command can be entered at the boot> prompt from the 
OpenBSD second-stage boot loader for a one-time (or first time) serial console
usage.
d6658 7
a6664 1
i386 notes:
d6666 2
a6667 2
  * OpenBSD numbers the serial ports starting at tty00, DOS/Windows labels them
    starting at COM1. So, keep in mind tty02 is COM3, not COM2
d6671 9
a6679 3
  * Some i386 systems are capable of using a serial port as the console device.
    Your results may vary -- this port may not be available to the operating
    system once booted, thus requiring monitoring using TWO serial ports.
d6684 3
a6686 2
    for a standard monitor and keyboard again. You generally must have some way
    to get a monitor and keyboard to your i386 systems in an emergency.
d6697 1
a6697 1
  * The two serial ports on a SPARC are labeled ttya and ttyb.
d6707 4
a6710 3
  * If you have a keyboard and monitor attached, you can still force the serial
    console to be used instead by using the following commands at the ok
    prompt:
d6714 2
a6715 1
     
d6717 1
a6717 3
    may be able to use the keyboard and monitor, as well, though some
    combinations of SPARC hardware have trouble with the keyboard when doing
    this.
d6723 1
d6727 2
a6728 1
 
d6739 3
a6741 19
  * You will have to change tty00 in /etc/ttys to on and set the speed to 57600
    instead of the default of 9600 as detailed above in single user mode before
    booting multi-user and having the serial console functional.

Mac68k

Serial console is selected in the Booter program, under the "Options" pull-down
menu, then "Serial Ports". Check the "Serial Console" button, then choose the
Modem or Printer port. You will need a Macintosh modem or printer cable to
attach to the Mac's serial ports. If you wish to have this as default, tell the
Booter program to save your options.

Mac68k Notes

  * The modem port is tty00, the printer port is tty01.
  * The Mac68k doesn't turn on its serial port until called upon, so your
    breakout box may not show any signals on the Mac's serial port until the
    OpenBSD boot process has started.
  * You will have to enable the port (tty00 or tty01) as indicated above.
d6743 1
a6743 1
7.8 - How do I blank my console? (wscons)
d6745 2
a6746 2
If you wish to blank your console after a period of inactivity without using X,
you can alter the following wscons(4) variables:
d6754 2
a6755 2
  * display.screen_off determines the blanking time in thousandths of a second,
    i.e., 60000 would set the timeout to one minute.
d6758 5
a6762 1
  * display.outact determines if screen output will restore the blanked screen.
d6764 1
a6764 2
You can set these variables at the command line using the wsconsctl(8) command:
     # wsconsctl -w display.screen_off=60000
d6766 1
d6769 1
a6773 2
The blanker is activated when either display.kbdact or display.outact is set to
"on".
d6775 6
a6780 2
[Back to Main Index] [To Section 6.0 - Networking] [To Section 8.0 - General
Questions]
d6782 287
a7068 4
-------------------------------------------------------------------------------
[back] www@@openbsd.org
$OpenBSD: obsd-faq.txt,v 1.33 2003/01/05 19:29:10 nick Exp $
[OpenBSD]
d7070 1
a7070 1
8.0 - General Questions
d7072 1
a7072 1
-------------------------------------------------------------------------------
d7076 6
a7081 6
  * 8.2 - How do I change virtual terminals? (I386 ONLY)
  * 8.3 - I forgot my root password..... What do I do!
  * 8.4 - X won't start, I get lots of error messages
  * 8.5 - What is CVS, and how do I use it?
  * 8.6 - What is the ports tree?
  * 8.7 - What are packages?
d7084 1
a7084 1
  * 8.9 - OpenBSD Bootloader (i386 specific)
d7086 3
a7088 3
  * 8.11 - Why is my Macintosh losing so much time?
  * 8.12 - Does OpenBSD support SMP?
  * 8.13 - I sometimes get Input/output error when trying to use my tty devices
d7091 1
a7091 1
  * 8.16 - Ksh does not appear to read my .profile!
d7093 2
a7094 4
  * 8.18 - Why does www.openbsd.org run on Solaris?
  * 8.19 - I'm having problems with PCI devices being detected
  * 8.20 - Antialiased and TrueType fonts in XFree86
  * 8.21 - Does OpenBSD support any journaling fileystems ?
d7098 1
d7100 1
a7100 1
-------------------------------------------------------------------------------
d7102 1
a7102 1
8.2 - How do I change virtual terminals?
d7104 231
a7334 1
See this article.
d7336 14
a7349 411
8.3 - I forgot my root password, what do I do now?

A few steps to recovery

 1. Boot into single user mode. For i386 arch type boot -s at the boot prompt.
 2. mount the drives.
    # fsck -p / && mount -u /
 3. If /usr is not the same partition that / is (and it shouldn't be) then you
    will need to mount it, also
    # fsck -p /usr && mount /usr
 4. run passwd(1)
 5. boot into multiuser mode.. and remember your password!

8.4 - X won't start, I get lots of error messages

If you have X completely set up and you are using an XF86Config that you know
works then the problem most likely lies in the machdep.allowaperture. You also
need to make sure that:

    option APERTURE

is in your kernel configuration. [It is already in the GENERIC kernel]

Then you need to edit /etc/sysctl.conf and set machdep.allowaperture=2. This
will allow X to access the aperture driver. This would be set up if the
question during install about whether or not you would be running X was
answered correctly. OpenBSD requires for all X servers that the aperture driver
be set, because it controls access to the I/O ports on video boards.

For other X problems on the i386, consult the XFree86 Online Documentation at 
http://www.xfree86.org/support.html.

8.5 - What is CVS? and How do I use it?

CVS is what the OpenBSD project uses to control changes to the source code. CVS
stands for Concurrent Versions System. You can read more about CVS at http://
www.cvshome.org/. CVS can be used by the end user to keep up to date with
source changes, and changes in the ports tree. CVS makes it extremely simple to
download the source via one of the many CVS mirrors for the project.

How to initially setup your CVS environment

You can retrieve the sources from one of the OpenBSD AnonCVS servers. These
servers are listed on http://www.openbsd.org/anoncvs.html. Once you have chosen
a server you need to choose which module you are going to retrieve. There are
three main modules available for checkout from the CVS tree. These are:

  * src - The src module has the complete source code for OpenBSD. This
    includes userland and kernel sources.
  * ports - The ports module holds all you need to have the complete OpenBSD
    ports tree. To read more on the OpenBSD ports tree, read FAQ 8, Ports of
    the OpenBSD FAQ.
  * xf4 - The xf4 module contains the source to compile XFree 4.

Now that you have decided which module that you wish to retrieve, there is one
more step left before you can retrieve it. You must decide which method to use.
CVS by default retrieves files using ssh(1), but some AnonCVS servers allow for
the use of rsh. For those of you behind a firewall there are also the options
of pserver and some AnonCVS servers run ssh on port 2022. Be sure to check 
http://www.openbsd.org/anoncvs.html for which servers support what protocols.
Next I will show how to do a simple source checkout. Here I will be using an
AnonCVS server located in the U.S., but remember that if you are outside of the
U.S you need to use a server that is located nearby. There are many AnonCVS
servers located throughout the world, so choose one nearest you. I will also be
using ssh to retrieve the files.

    $ export CVSROOT=anoncvs@@anoncvs.usa.openbsd.org:/cvs
    $ cvs get src
    Warning: Remote host denied X11 forwarding, perhaps xauth program could not be run on the server side.
    cvs checkout: in directory src:
    cvs checkout: cannot open CVS/Entries for reading: No such file or directory
    cvs server: Updating src
    U src/Makefile
    [snip]

Notice here also that I set the CVSROOT environmental variable. This is the
variable that tells cvs(1) which AnonCVS server to use. This can also be
specified using the -d option. For example:

    $ cvs -d anoncvs@@anoncvs.usa.openbsd.org:/cvs get src

These commands should be run in /usr, which will then create the directories of
/usr/src, /usr/ports, and /usr/www. Depending, of course, on which module you
checkout. You can download these modules to anywhere, but if you wanted to do
work with them (ie make build ), it is expected that they be at the place
above.

Keeping your CVS tree up-to-date

Once you have your initial tree setup, keeping it up-to-date is the easy part.
You can update your tree at any time you choose, some AnonCVS servers update
more often then others, so again check http://www.openbsd.org/anoncvs.html. In
this example I will be updating my www module from anoncvs.usa.openbsd.org.
Notice the -q option that I use, this makes the output not so verbose coming
from the server.

    $ echo $CVSROOT
    anoncvs@@anoncvs.usa.openbsd.org:/cvs
    $ cvs -q up -Pd www
    Warning: Remote host denied X11 forwarding, perhaps xauth program could not be run on the server side.
    U www/want.html
    M www/faq/faq8.html
    ericj@@oshibana:~>

Other cvs options

For some, bandwidth and time are serious problems when updating repositories
such as these. So CVS has a -z[1-9] option which uses gzip to compress the
data. To use it, do -z[compression-level], for instance, -z3 for a compression
level of 3.

8.6 - What is the ports tree?

The ports tree is a set of Makefiles that download, patch, configure and
install userland programs so you can run them in OpenBSD environment without
having to do all that by hand. You can get the ports tree from any of the
OpenBSD FTP servers in /pub/OpenBSD/3.2/ports.tar.gz. The most recent ports are
available via the 'ports' cvs tree, or /pub/OpenBSD/snapshots/ports.tar.gz. For
most of you however, packages will be a much better option. Packages are
created from ports and are already compiled and ready to use. To read more on
packages read FAQ 8, Packages.

Important note about keeping your system and ports in sync

OpenBSD has three "active" versions at any point in time:

  * Release: What is on the CD.
  * Stable: Release, plus security and reliability enhancements
  * Current: The development version of OpenBSD.

DO NOT mix versions of Ports and OpenBSD!

If your system is Release, use the Release version of the ports tree. Don't try
to use a -Current version of the Ports tree on a -Release or -Stable system.
Not only is it not likely to work, you will irritate people when you ask for
help about why "nothing seems to work!" Note that there is a -Stable branch of
the Ports tree as well, where critical fixes to -Release ports will be made.

Yes, this really does mean a wonderful new port will not typically work on your
"older" system -- even if that system was -current just a few weeks ago.

If you do not have the ports tree installed, you can download it via any of
OpenBSD's FTP servers, or of course, from the CDROM. The file is ports.tar.gz,
and you want to untar this in the /usr directory, which will create /usr/ports,
and all the directories under it. For example:
     $ ftp ftp://ftp.openbsd.org/pub/OpenBSD/3.2/ports.tar.gz
     $ sudo cp ports.tar.gz /usr
     $ cd /usr; sudo tar xzf ports.tar.gz

A snapshot of the ports tree is also created daily and can be downloaded from
any of the OpenBSD FTP servers as /pub/OpenBSD/snapshots/ports.tar.gz. If you
are installing a snapshot of OpenBSD, you should use a matching snapshot of
ports. Again, make sure you keep your ports tree and your OpenBSD system in
sync.

What ports are available? and how do i find them?

Use the ports tree to search for keywords. To do this use make search key=
"searchkey". Here is an example of a search for 'samba':

    $ make search key="samba"
    Port:   samba-2.2.5
    Path:   net/samba
    Info:   SMB and CIFS client and server for UNIX
    Maint:  Daniel Hartmeier <daniel@@benzedrine.cx>
    Index:  net
    L-deps: 
    B-deps: devel/autoconf
    R-deps:
    Archs:  any
    
    Port:   ADMsmb-0.2
    Path:   /usr/ports/security/ADMsmb
    Info:   Samba security scanner
    Maint:  Jason Peel <jsyn@@openbsd.org>
    Index:  security
    L-deps:
    B-deps:
    R-deps:
    Archs:  any

Installing Ports

Ports are set up to be EXTREMELY easy to make and install. Here is an example
install for someone wanting to install the X11 program xfig. You'll notice the
dependencies are automatically detected and completed:

First you need to cd to the dir of the program you want. If you are searching
for a program, you can either update your locate database, or use the search
function talked about below. Once you are in the dir of the program you want,
you can just type make install. For example.

    $ sudo make install
    ===>  Extracting for xfig-3.2.2
    ===>  xfig-3.2.2 depends on shared library: jpeg.62. - /usr/local/lib/libjpeg.so.62.0 found
    ===>  xfig-3.2.2 depends on shared library: Xaw3d.6. - not found
    ===>  Verifying install for Xaw3d.6. in /usr/ports/x11/Xaw3d
    >> Xaw3d-1.3.tar.gz doesn't seem to exist on this system.
    >> Attempting to fetch from ftp://crl.dec.com/pub/X11/contrib/widgets/Xaw3d/R6.1/.
    Connected to crl.dec.com.
    220 crl.dec.com FTP server (Digital UNIX Version 5.60) ready.
    331 Guest login ok, send ident as password.
    230 Guest login ok, access restrictions apply.
    Remote system type is UNIX.
    Using binary mode to transfer files.
    200 Type set to I.
    250 CWD command successful.
    250 CWD command successful.
    Retrieving pub/X11/contrib/widgets/Xaw3d/R6.1/Xaw3d-1.3.tar.gz
    local: Xaw3d-1.3.tar.gz remote: Xaw3d-1.3.tar.gz
    227 Entering Passive Mode (192,58,206,2,5,14)
    150 Opening BINARY mode data connection for Xaw3d-1.3.tar.gz (0.0.0.0,0) (290277 bytes).
    100% |**************************************************|   283 KB    00:00 ETA
    226 Transfer complete.
    290277 bytes received in 101.09 seconds (2.80 KB/s)
    221 Goodbye.
    ===>  Extracting for Xaw3d-1.3
    /bin/mkdir -p /usr/ports/x11/Xaw3d/work/xc/lib/Xaw3d/X11/Xaw3d
    cd /usr/ports/x11/Xaw3d/work/xc/lib/Xaw3d/X11/Xaw3d; ln -sf ../../*.h .
    ===>  Patching for Xaw3d-1.3
    ===>  Configuring for Xaw3d-1.3
    mv -f Makefile Makefile.bak
    imake -DUseInstalled -I/usr/X11R6/lib/X11/config
    make Makefiles
    [snip]

Using Flavors

Many of the applications in the ports tree support different install options,
called flavors. If a port comes in multiple flavors, you can use these options
simply by setting an environment variable before you compile the port. If
multiple features are needed, the FLAVOR variable can be set to a
space-delimited list of the supported and desired flavors. Currently, many
ports have flavors that include database support, support for systems without
X, or network additions like SSL and IPv6.

    $ pwd
    /usr/ports/net/mtr
    $ make show=FLAVORS
    no_x11
    $ env FLAVOR="no_x11" make
    ===>  mtr-0.42-curses depends on: gmake-3.79.1 - found
    ===>  Checking files for mtr-0.42-no_x11
    >> mtr-0.42.tar.gz doesn't seem to exist on this system.
    >> Attempting to fetch /usr/ports/distfiles/mtr-0.42.tar.gz from ftp://ftp.bitwizard.nl/mtr/.
    [snip]
    $ sudo env FLAVOR="no_x11" make install
    ===>  Faking installation for mtr-0.42-no_x11
    ===>  Building package for mtr-0.42-no_x11
    Creating package /usr/ports/packages/i386/All/mtr-0.42-no_x11.tgz
    Using SrcDir value of /usr/ports/net/mtr/w-mtr-0.42-no_x11/fake-i386-curses/usr/local
    Creating gzip'd tar ball in '/usr/ports/packages/i386/All/mtr-0.42-no_x11.tgz'
    ===>  Installing mtr-0.42-no_x11 from /usr/ports/packages/i386/All/mtr-0.42-no_x11.tgz

Listing Installed ports/packages

You can see a list of both ports and packages by using the pkg_info command.

    $ /usr/sbin/pkg_info
    zsh-4.0.6           The Z shell.
    screen-3.9.13       A multi-screen window manager.
    emacs-21.2          GNU editing macros.
    tcsh-6.12.00        An extended C-shell with many useful features.
    bash-2.05b          The GNU Borne Again Shell.
    zip-2.3             Create/update ZIP files compatible with pkzip.
    ircII-20020403      An enhanced version of ircII, the Internet Relay Chat client
    ispell-3.2.06       An interactive spelling checker.
    tin-1.4.5           TIN newsreader (termcap based)
    procmail-3.22       A local mail delivery agent.
    strobe-1.06         Fast scatter/gather TCP port scanner
    lsof-4.63           Lists information about open files.
    ntp-4.1.72          Network Time Protocol Implementation.
    ncftp-3.1.4         ftp replacement with advanced user interface
    nmh-1.0.4           The New MH mail handling program
    bzip2-1.0.2         A block-sorting file compressor

Other Information

More information about the ports can be found in the ports(7) man page and on
the Ports page

Our ports tree is constantly being expanded, and if you would like to help
please see: http://www.openbsd.org/porting.html

8.7 - What are packages?

Packages are the precompiled binaries of some of the most used programs. They
are ready for use on an OpenBSD system. Again, like the ports, packages are
very easy to maintain and update. Packages are constantly being added so be
sure to check each release for additional packages.

Here is a list of tools used in managing packages.

  * pkg_add(1) - a utility for installing software package distributions
  * pkg_create(1) - a utility for creating software package distributions
  * pkg_delete(1) - a utility for deleting previously installed software
    package distributions
  * pkg_info(1) - a utility for displaying information on software packages

Where to find packages

If you are a smart user and bought one of the OpenBSD CD, then packages can be
found on both CDs depending on your architecture. If you don't have an OpenBSD
CD in your possession you can download packages from any of the ftp mirrors.
You can get a list of mirrors http://www.openbsd.org/ftp.html. Packages are
located at /pub/OpenBSD/3.2/packages from there packages are broken down
depending on architecture.

Installing Packages

To install packages, the utility pkg_add(1) is used. pkg_add(1) is an extremely
easy utility to use, in the following two examples pkg_add(1) will be used to
install a package. The first example will show pkg_add(1) installing a package
that resides on a local disk, the second example will show an installation of a
package via ftp. In both examples screen-3.9.13 will be installed.

Installing via local disk

    $ sudo pkg_add -v screen-3.9.13.tgz
    Requested space: 749864 bytes, free space: 2239117312 bytes in /var/tmp/instmp.cpsHA27596
    Running install with PRE-INSTALL for `screen-3.9.13'
    extract: Package name is screen-3.9.13
    extract: CWD to /usr/local
    extract: /usr/local/bin/screen-3.9.13
    extract: execute 'ln -sf screen-3.9.13 /usr/local/bin/screen'
    extract: /usr/local/man/man1/screen.1
    extract: /usr/local/info/screen.info
    extract: execute '[ -f /usr/local/info/dir ] || sed -ne '1,/Menu:/p' /usr/share/info/dir > /usr/local/info/dir'
    extract: execute 'install-info /usr/local/info/screen.info /usr/local/info/dir'
    extract: /usr/local/lib/screen/screencap
    extract: /usr/local/lib/screen/screenrc
    extract: CWD to .
    Running mtree for `screen-3.9.13'
    mtree -q -U -f +MTREE_DIRS -d -e -p /usr/local
    Running install with POST-INSTALL for `screen-3.9.13'
    
    +---------------
    | The file /etc/screenrc has been created on your system.
    | You may want to verify/edit its contents
    |
    | The file /usr/local/lib/screen/screencap contains a
    | termcap like description of the screen virtual terminal.
    | You may use it to update your terminal database.
    | See termcap(5).
    +---------------
    
    Attempting to record package into `/var/db/pkg/screen
    Package `screen-3.9.13' registered in `/var/db/pkg/screen-3.9.13'

In this example the -v flag was used to give a more verbose output, this option
is not needed, but is helpful for debugging and was used here to give a little
more insight into what pkg_add(1) is actually doing. Notice however, that there
are some valid messages given out mentioning /etc/screenrc. Messages like this
will be given to you whether or not you use the -v flag.

Installing via ftp

    $ sudo pkg_add ftp://ftp.openbsd.org/pub/OpenBSD/3.2/packages/i386/screen-3.9.13.tgz
    >>> ftp -o - ftp://ftp.openbsd.org/pub/OpenBSD/3.2/packages/i386/screen-3.9.13.tgz
    
    +---------------
    | The file /etc/screenrc has been created on your system.
    | You may want to verify/edit its contents
    |
    | The file /usr/local/lib/screen/screencap contains a
    | termcap like description of the screen virtual terminal.
    | You may use it to update your terminal database.
    | See termcap(5).
    +---------------

In this example you can see that I installed the i386 package, you should
substitute this with your architecture. Notice: Not all architectures have the
same packages. Some ports don't work on certain architectures. In this example
the -v flag wasn't used, so only NEEDED messages are shown.

Viewing and Deleting Installed Packages

The utility pkg_info(1) is used to view a list of packages that are already
installed on your system. This is usually needed to find out the correct name
of a package before you remove that package. To see what packages are installed
on your system simple use:

    $ pkg_info
    mpg123-0.59r       mpeg audio 1/2 layer 1, 2 and 3 player
    nmap-3.00          port scanning large networks
    ircII-20020403     enhanced version of ircII (internet relay chat)
    screen-3.9.13      multi-screen window manager
    unzip-5.50         extract, list & test files in a ZIP archive
    ntp-4.1.72     Network Time Protocol implementation
    icb-5.0.9          Internet CB - mostly-defunct chat client

To delete a package, simple take the proper name of the package as shown by
pkg_info(1) and use pkg_delete(1) to remove the package. In the below example,
the screen package is being removed. Notice that on some occasions there are
instructions of extra objects that need to be removed that pkg_delete(1) did
not remove for you. As with the pkg_add(1) utility, you can use the -v flag to
get more verbose output.

    $ sudo pkg_delete screen-3.9.13
    
    +---------------
    | To completely deinstall the screen-3.9.13 package you need to perform
    | this step as root:
    |
    |           rm -f /etc/screenrc
    |
    | Do not do this if you plan on re-installing screen-3.9.13
    | at some future time.
    +---------------

8.8 - Is there any way to use my floppy drive if it's not attached during boot?
d7351 1
a7351 9
Sure. You need to add "flags 0x20" at the end of the fd* entry and recompile
your kernel. The line should be read:

    fd*     at fdc? drive ? flags 0x20

After that you would be able to use the floppy drive all the times. It doesn't
matter if you plugged it in after boot.

8.9 - Boot time Options - Using the OpenBSD bootloader
d7357 5
a7361 5
For most people, you won't have to do anything here. It will automatically boot
if no commands are given. But sometimes problems arise, or special functions
are needed. That's where these options will come in handy. To start off, you
should read through the boot(8) man page. Here we will go over the most common
used commands for the bootloader.
d7364 2
a7365 2
to boot /bsd. If that fails it will try /obsd, and if that fails, it will try /
bsd.old. You can specify this by hand by typing:
d7367 1
a7367 1
    boot> boot wd0a:/bsd
d7373 2
a7374 1
This will work if device wd0a is configured as your root device.
d7381 1
a7381 1
    Time Config section of the faq.
d7383 2
a7384 2
  * -d : This option is used to dump the kernel into ddb. Keep in mind that you
    must have DDB built into the kernel.
d7388 1
a7388 1
For further reading you can read boot_i386(8) man page
d7392 21
a7412 5
S/Key is a ``one-time password'' scheme. This allows for one-time passwords for
use on un-secured channels. This can come in handy for those who don't have the
ability to use ssh or any other encrypted channels. OpenBSD's S/Key
implementation can use a variety of algorithms as the one-way hash. The
following algorithms are available:
d7421 1
a7421 1
To start off the file /etc/skeykeys must exist. If this file is not in
d7424 1
a7424 1
    # touch /etc/skeykeys
d7426 10
a7435 10
Once that file is in existence, you can initialize your S/Key. To do this you
will have to use skeyinit(1). With skeyinit(1), you will first be prompted for
your password to the system. This is the same password that you used to log
into the system. Running skeyinit(1) over an insecure channel is completely not
recommended, so this should be done over a secure channel (such as ssh) or the
console. Once you have authorized yourself with your system password you will
be asked for yet another password. This password is the S/Key secret password,
and is NOT your system password. Your secret password must be at least 10
characters. We suggest using a memorable phrase containing several words as the
secret password. Here is an example user being added.
d7437 1
a7437 2
    $ skeyinit ericj
    [Adding ericj]
d7439 8
a7446 6
       or have an encrypted channel.  If you are using telnet
       or rlogin, exit with no password and use skeyinit -s.
    Enter secret password:
    Again secret password:
    
    ID ericj skey is otp-md5 99 oshi45820             
d7449 1
a7449 1
One line of particular importance in here is ID ericj skey is otp-md5 99
d7453 1
a7453 1
  * otp-md5 - This shows which one-way was used to create your One-Time
d7455 12
a7466 6
  * 99 - This is your sequence number. This is a number from 100 down to 1.
    Once it reaches one, another secret password must be created.
  * oshi45820 - This is your key.

But of more immediate importance is your password. Your password consists of 6
small words, combined together this is your password, spaces and all.
d7470 3
a7472 8
By now your skey has been initialized, and you have your password. You're ready
to login. Here is an example session using S/Key to login. Starting with
OpenBSD 3.0, S/Key logins work differently. For OpenBSD 3.0 and above you
append :skey to your login name. For versions of OpenBSD previous to 3.0 you
use s/key for the password at which time you are prompted for your S/Key
password (the exception to this is ftpd(8) which will always present an S/Key
challenge for S/Key-enabled user prior to OpenBSD < 3.0). The examples below
assume OpenBSD 3.0 or higher.
d7479 2
a7480 2
    331 S/Key Password: 
    230- OpenBSD 3.2 (GENERIC) #25: Thu Oct  3 19:51:53 MDT 2002
d7499 2
a7500 2
S/Key to login several times. But how do you get your password after you've
logged in once? Well to do this, you'll need to know what sequence number
d7502 19
a7520 4
which sequence number you're on? Well this is simple, use skeyinfo(1), and it
will tell you what to use. For example here, I need to generate another
password for a login that I might have to make in the future. (remember I'm
doing this from a secure channel).
d7531 1
a7531 3
Not only is otp-md5 a description of the hash used, it is also an alternate
name for the skey(1) command. So, the simplest way to generate the next S/Key
password is simply:
d7534 2
a7535 2
    Reminder - Do not use this program while logged in via telnet or rlogin.
    Enter secret password:
d7540 5
a7544 5
I'm sure many of you won't always have a secure connection to create these
passwords, and creating them over an insecure connection isn't feasible, so how
can you create multiple passwords at one time? Well you can supply skey(1) with
a number of how many passwords you want created. This can then be printed out
and taken with you wherever you go.
d7547 2
a7548 2
    Reminder - Do not use this program while logged in via telnet or rlogin.
    Enter secret password:
d7558 1
a7558 1
Using S/Key with telnet(1), ssh(1), and rlogin(1)
d7560 2
a7561 3
Using S/Key with telnet(1), ssh(1), or rlogin(1) is done in pretty much the
same fashion as with ftp--you simply tack ":skey" to the end of your username.
Example:
d7563 1
a7563 8
    $ telnet localhost
    Trying 127.0.0.1...
    Connected to localhost.
    Escape character is '^]'.
    
    OpenBSD/i386 (oshibana) (ttyp2)
    
    login: ericj:skey
d7566 3
a7568 4
    Last login: Thu Oct  7 12:21:48 on ttyp1 from 156.63.248.77
    Warning: no Kerberos tickets issued.
    OpenBSD 3.2 (GENERIC) #25: Thu Oct  3 19:51:53 MDT 2002
    
d7570 1
a7570 1
    
d7576 1
a7576 1
    
d7580 1
a7580 27
8.11 - Why is my Macintosh losing so much time?

This is caused by a hardware bug. OpenBSD uses clock interrupts to keep track
of the current time, but these interrupts have the lowest priority in Apple's
architecture. So, under heavy load, (such as disk or network activity) clock
interrupts will be lost and the Unix clock will not advance as it should.

MacOS gets around the time problem by always reading the hardware clock.
OpenBSD only reads the hardware clock at boot time and thereafter ignores it.
You may notice that, at shutdown, the kernel is not confident enough to write
the Unix time back into the hardware clock because this time loss problem is
well known.

The best solution is to run ntpd (found in the ports collection) and just deal
with the occasional lossage. Sometimes the lossage is so bad that even ntpd is
afraid to skip the time. In this case, add the -g option to ntpd in /etc/
rc.securelevel to force tracking.

Another simpler but less precise solution is to run rdate(8) on a regular
basis, for example by having a crontab entry for it, preferably with the -a
option so there is no "jump" in time. Another good place to launch rdate(8) is
in your /etc/ppp/ppp.linkup file if you are not permanently connected and are a
PPP user.

See also: http://www.macbsd.com/macbsd/macbsd-docs/faq/faq-3.html#ss3.17

8.12 - Does OpenBSD support SMP?
d7583 18
a7600 23
Not at this time. Work is on-going, there is an OpenBSD SMP project, though
there is nothing usable yet, nor is there any time schedule for OpenBSD SMP
support.

On most platforms, OpenBSD will run on an SMP system, but only utilizing one
processor. The exception to this is the SPARC platform -- OpenBSD/sparc will
not run on some multi-processor SPARC systems at all (General rule: one MBus
module always works. Multiple MBus modules will work as long as they are single
processor modules and supported, of course). Multi-processor SPARC64 systems
run as long as the base machine is supported.

How can I help?

  * Write code. There is lots of work to do.
  * Donate hardware. The goal of the OpenBSD SMP project is to support as many
    platforms as possible, including SPARC, SPARC64, Alpha, MacPPC and of
    course, the i386. Donations of desired hardware are welcome!
  * Don't offer to "test". The SMP project is not part of the core OpenBSD
    project right now for a reason -- it isn't ready for production use yet, or
    even general "testing". Informing the developers that it didn't work on
    your hardware without code to make it work isn't useful at this point. Send
    in your dmesg, if a developer sees something interesting in your hardware,
    they can contact you for testing.
d7614 2
a7615 2
differentiated by creating the calling unit device node with a minor number 128
greater than the dial-in device node. Whereas the dial-in device (the tty)
d7619 7
a7625 7
(8) will wait on a dial-in device until a connection is established. Meanwhile,
a dial-out connection can be established on the dial-out device (for the very
same hardware terminal port) without disturbing anything else on the system.
The getty(8) process does not even notice that anything is happening on the
terminal port. If a connecting call comes in after the dial-out connection has
finished, the getty(8) process will deal with it properly, without having
noticed the intervening dial-out action.
d7630 1
a7630 1
browsers in the ports tree, include (in no particular order):
a7633 2
  * Dillo Minimal feature set, very fast and small, runs well on slower
    hardware.
a7634 5
  * Konqueror-embedded (konq-e) Konqueror, using only the KDE libraries rather
    than all of KDE.
  * Netscape 4 For sparc and i386 only, not Open Source, no package available.
  * Opera Commercial browser.
  * Amaya The W3C's browser and editor.
d7637 18
d7658 5
a7662 2
  * w3m Has table and frame support (also has a graphical mode).
  * links Has table support.
d7664 3
a7666 2
Mozilla does not currently work on OpenBSD, either natively or in emulation.
See the mail list archives for details.
d7668 3
a7670 6
You will find all these in the ports collection. All the above mentioned
browsers are located in /usr/ports/www/ after the installation of the ports
tree. Most are also available as pre-compiled packages, available on the FTP
servers and on the CDROM. As most of the graphical browsers are very large and
require quite some time to download and compile, one should seriously consider
the use of packages where available.
d7672 1
a7672 1
8.15 - How do I use the mg editor which is now part of OpenBSD?
d7674 5
a7678 4
Mg is a micro Emacs-style text editor. Micro means that it's small (Emacs is
very large!) For the basics, read the mg(1) manual page and the tutorial, as
included with the source code. For more interesting questions (such as, "I
don't have a Meta key!") check out the Emacs FAQ.
d7680 2
a7681 4
Note that since mg is a small Emacs implementation, which is mostly similar to
the text editor features of Emacs 17, it does not implement many of Emacs'
other functionality. (Including mail and news functionality, as well as modes
for Lisp, C++, Lex, Awk, Java, etc...)
d7683 1
a7683 1
8.16 - Ksh does not appear to read my .profile!
d7685 4
a7688 1
There are two possible reasons for this.
a7689 2
  * .profile is not owned by the user This is easy to fix. For username,
   
d7691 12
a7702 12
   
  * You are using ksh from within X Window System
   
    Under xterm, argv[0] for ksh is not prepended with a dash. Prepending - to
    argv[0] will cause csh and ksh to know they should interpret their login
    files. (For csh that's .login, with a separate .cshrc that is always run
    when csh starts up. With ksh, this is more noticeable because there is only
    one startup script, .profile. This file is ignored unless the shell is a
    login shell.)
   
    To fix this, add the line XTerm*loginShell: true to the file .Xdefaults in
    your home directory. Note, this file does not exist by default, you may
d7704 1
a7704 1
   
d7706 1
a7706 1
   
d7709 1
a7709 1
    follow the XFree86 behavior.
d7711 1
a7711 1
8.17 - Why does my /etc/motd file get written over when I modified it?
d7719 1
a7719 43
8.18 - Why does www.openbsd.org run on Solaris?

Although none of the developers think it is particularly relevant, this
question comes up frequently enough in the mailing lists that it is answered
here. www.openbsd.org and the main OpenBSD ftp site are hosted at a SunSITE at
the University of Alberta, Canada. These sites are hosted on a large Sun
system, which has access to lots of storage space and Internet bandwidth. The
presence of the SunSITE gives the OpenBSD group access to this bandwidth. This
is why the main site runs here. Many of the OpenBSD mirror sites run OpenBSD,
but since they do not have guaranteed access to this large amount of bandwidth,
the group has chosen to run the main site at the University of Alberta SunSITE.

8.19 - I'm having problems with my PCI devices being detected

There exists a condition where some machines might not detect some PCI devices
properly, or might freeze while detecting multiple NIC's in one machine. This
is the fault of PCIBIOS, and involves a simple workaround to make it work
properly. Simply enter the boot time configuration and disable PCIBIOS. An
example is below:

boot> boot -c                                                                    
Copyright (c) 1982, 1986, 1989, 1991, 1993                                       
        The Regents of the University of California.  All rights reserved.       
Copyright (c) 1995-2002 OpenBSD. All rights reserved.  http://www.OpenBSD.org    
                                                                                 
OpenBSD 3.2 (GENERIC) #25: Thu Oct  3 19:51:53 MDT 2002                          
    deraadt@@i386.openbsd.org:/usr/src/sys/arch/i386/compile/RAMDISK_CD           
cpu0: Intel Pentium III (Coppermine) ("GenuineIntel" 686-class, 128KB L2 cache)  
1 GHz                                                                            
cpu0: FPU,V86,DE,PSE,TSC,MSR,PAE,MCE,CX8,SYS,MTRR,PGE,MCA,CMOV,PAT,PSE36,MMX,FXS 
R,SIMD                                                                           
real mem  = 267956224 (261676K)                                                  
avail mem = 243347456 (237644K)                                                  
using 3296 buffers containing 13500416 bytes (13184K) of memory                  
User Kernel Config                                                               
UKC> disable pcibios                                                             
UKC> quit                                                                        
[... snip ...]                                                                   

Once this is done, you can follow the directions in FAQ 5, Building a Kernel to
create a new kernel so that you don't have to worry about this in the future.

8.20 - Antialiased and TrueType fonts in XFree86
d7723 1
a7723 1
8.21 - Does OpenBSD support any journaling filesystems ?
d7725 2
a7726 2
No it doesn't. We use a different mechanism to achieve similar results that is
called Soft Updates. Please read in FAQ 14 to get more details.
d7733 2
a7734 2
services such as ssh, ftp, or telnet. This can also be experienced when using a
proxy, such as ftp-proxy, or when sending mail out from a workstation through 
d7739 3
a7741 3
"www.openbsd.org" into a numeric IP address. Another task of DNS is the ability
to take a numeric address and convert it back to a "name", this is "Reverse
DNS".
d7744 3
a7746 3
any machine that that attaches to it in many different ways, including ssh, 
ftp, telnet, sendmail or ftp-proxy. Unfortunately, in some cases, the machine
that is making the connection does not have a proper reverse DNS entry.
d7760 1
a7760 1
address of 192.168.1.35, the user uses ssh to access the gateway system. The 
d7762 11
a7772 11
box. The gateway then tries to figure out who is trying to log in by performing
a reverse DNS lookup of 192.168.1.35. The problem is 192.168.0.0 addresses are
for private use, so a properly configured DNS server outside your network knows
it should have no information about those addresses. Some will quickly return
an error message, in these cases, OpenBSD will assume there is no more
information to be gained, and and it will quickly give up and just admit the
user. Other DNS servers will not return ANY response. In this case you will
find yourself waiting for the OpenBSD name resolver to time out, which takes
about two minutes before the login will be permitted to continue. In the case
of ftp-proxy, some ftp clients will timeout before the reverse DNS query times
out, leading to the impression that ftp-proxy isn't working.
d7786 5
a7790 5
::1 localhost.in.example.org localhost                                           
127.0.0.1 localhost.in.example.org localhost                                     
192.168.1.1 gw.in.example.org gw                                                 
192.168.1.20 scrappy.in.example.org scrappy                                      
192.168.1.35 shadow.in.example.org shadow                                        
d7794 21
a7814 20
search in.example.org                                                            
nameserver 24.2.68.33                                                            
nameserver 24.2.68.34                                                            
lookup file bind                                                                 

A common objection to this is "But, I use DHCP for my internal network! How can
I configure my /etc/hosts?" Rather easily, actually. Just enter lines for all
the addresses your DHCP server is going to give out, plus any static devices:

::1 localhost.in.example.org localhost                                           
127.0.0.1 localhost.in.example.org localhost                                     
192.168.1.1 gw.in.example.org gw                                                 
192.168.1.20 scrappy.in.example.org scrappy                                      
192.168.1.35 shadow.in.example.org shadow                                        
192.168.1.100 d100.in.example.org d100                                           
192.168.1.101 d101.in.example.org d101                                           
192.168.1.102 d102.in.example.org d102                                           
         [... snip ...]                                                          
192.168.1.198 d198.in.example.org d198                                           
192.168.1.199 d199.in.example.org d199                                           
d7829 3
a7831 4
authoritative for both forward and reverse DNS resolution for all nodes in your
network, and make sure your computers (including your gateway) know to use it
as a DNS server. Some details on the BIND v4.9.8 name server included with
OpenBSD can be found here.
d7836 2
a7837 2
actual browsers going back to browser versions 4.0 and later. We do not want to
make these older pages conform to HTML4 or XHTML until we're sure that they
d7857 3
a7859 2
of the directory /usr/share/zoneinfo/right/. For example, if you are located in
Germany, you could use these commands:
d7862 1
d7865 13
a7877 2
[Back to Main Index] [To Section 7.0 - Keyboard controls] [To Section 9.0 -
Tips for linux users]
d7879 23
a7901 4
-------------------------------------------------------------------------------
[back] www@@openbsd.org
$OpenBSD: obsd-faq.txt,v 1.33 2003/01/05 19:29:10 nick Exp $
[OpenBSD]
a7902 1
9.0 - Migrating from Linux
d7904 7
a7910 1
-------------------------------------------------------------------------------
d7914 1
a7914 1
  * 9.1 - Tips for Linux (and other free Unix-like OS) users
d7916 71
a7986 33
  * 9.3 - Converting your Linux (or other System-7 style) password file to
    BSD-style.
  * 9.4 - Getting OpenBSD and Linux to interact

For more information for Linux users, please refer to http://sites.inka.de/mips
/unix/bsdlinux.html.
-------------------------------------------------------------------------------


9.1 - Simple tips for Linux (and other free Unix-like OS) users

There are several differences between OpenBSD and Linux. These differences
include but are not limited to, bootup procedure, network interface usage and
disk management. Most differences are well documented, but involve searching
manpages. This document tries to be an index of those differences.

  * OpenBSD has a ports tree. This is to accommodate the fact that at this
    point not many applications are native to the OpenBSD environment. This is
    both an attempt to get applications to work on OpenBSD for end-users and to
    get more applications made with OpenBSD in mind. Eventually this ports tree
    is used to make a nice set of binary packages.
  * OpenBSD uses CVS for source changes. With Linux, source code is
    disseminated through separate distributions. OpenBSD pioneered anonymous
    CVS, which allows anyone to extract the full source tree for any version of
    OpenBSD (from 2.0 to current, and all revisions of all files in between) at
    any time! There is also a very convenient and easy to use web interface to
    CVS.
  * OpenBSD periodically releases snapshots for various architectures and makes
    a stable, official CD release every 6 months.
  * OpenBSD contains STRONG CRYPTO, which USA based OS's can't contain. (See 
    http://www.openbsd.org/crypto.html) OpenBSD has also gone through heavy
    security auditing and many security features have already been implemented
    into the source tree. (IPSEC, KERBEROS).
d7988 2
a7989 3
  * The names of hard disks are usually /dev/wd and /dev/sd (ATA/SCSI)
  * /sbin/ifconfig with no arguments in Linux gives the state of all the
    interfaces. Under OpenBSD you need the -a flag.
d7991 7
a7997 4
    routes. Under OpenBSD you need the "show" parameter, or do a netstat -r
    (nice).
  * OpenBSD does NOT support Journaling Filesystems like ReiserFS, IBMs JFS or
    SGIs XFS. Instead we use Soft Updates.
d7999 18
a8016 14
    iptables, or ipf. This means that:
      + Network Address Tranlation (known as IP-Masquerading in Linux) is done
        through pfctl (using -N). (pfctl(8))
      + ipfwadm is done through pfctl. (pfctl(8), pf(4), pf.conf(5))
      + You should look at section 6 for detailed configuration assistance and
        information.
  * Interface address is stored in /etc/hostname.<interfacename>. It can be a
    hostname instead of an IP address.
  * The machine name is in /etc/myname
  * The default gateway is in /etc/mygate
  * OpenBSD's default shell is /bin/sh, which is the Korn shell. Shells such as
    bash and tcsh can be added as packages or installed from the ports tree.
  * Password management changes a lot. The main files are different. (passwd(1)
    , passwd(5))
d8018 22
a8039 5
    devices. It would be ne0 for an ne2000 ethernet card, and xl0 for a 3Com
    Etherlink XL and Fast Etherlink XL ethernet device, etc.
  * OpenBSD developers have made serious efforts to keep the manual pages
    up-to-date and accurate. Use the man(1) command to find information.

d8045 1
a8045 1
Read INSTALL.linux
d8047 1
a8047 1
9.3 - Converting your Linux (or other System 7-style) password file to
d8051 3
a8053 2
grab John the Ripper and use the unshadow utility that comes with it to merge
your passwd and shadow files into one System 7-style file.
d8058 2
a8059 1
    # cat linux_passwd | awk -F : '{printf("%s:%s:%s:%s::0:0:%s:%s:%s\n",$1,$2,$3,$4,$5,$6,$7); }' > new_passwd
d8064 2
a8065 2
duplicate usernames or user IDs between new_passwd and your OpenBSD box's /etc/
passwd. The easiest way to do this is to start with a fresh /etc/passwd.
d8071 48
a8118 19
pwd.db files. It also creates a System 7-style password file (minus encrypted
passwords) at /etc/passwd for programs which use it. OpenBSD uses a stronger
encryption for passwords, blowfish, which is very unlikely to be found on any
system which uses full System 7-style password files. To switch over to this
stronger encryption, simply have the users run 'passwd' and change their
password. The new password they enter will be encrypted with your default
setting (usually blowfish unless you've edited /etc/passwd.conf). Or, as root,
you can run passwd username.

9.4 - Getting OpenBSD and Linux to interact

If you are migrating from Linux to OpenBSD, note that OpenBSD has COMPAT_LINUX
enabled by default in the GENERIC kernel. To run any Linux binaries that are
not statically linked (most of them), you need to follow the instructions on
the compat_linux(8) manual page. A simple way to get most of the useful Linux
libraries is to install the redhat/base port from your ports collection. To
find out more about the Ports collection read FAQ 8 - Ports. If you already
have the ports tree installed, use these commands to get Linux libraries
installed.
a8119 2
    # cd /usr/ports/emulators/redhat/base
    # make install
d8121 3
a8123 12
OpenBSD supports the EXT2FS file system. Use disklabel (8) disk (where disk is
the device name for your disk.) to see what OpenBSD thinks your Linux partition
is (but don't use disklabel or fdisk to make any changes to it). For further
information on using disklabel read FAQ 14 - Disklabel.

[Back to Main Index] [To Section 8.0 - General Questions] [To Section 10.0 -
System Administration]

-------------------------------------------------------------------------------
[back] www@@openbsd.org
$OpenBSD: obsd-faq.txt,v 1.33 2003/01/05 19:29:10 nick Exp $
[OpenBSD]
d8125 1
a8125 1
10.0 - System Management
d8127 1
a8127 1
-------------------------------------------------------------------------------
d8140 2
a8141 2
  * 10.8 - I made changes to /etc/passwd with an editor, but the changes didn't
    seem to take place. Why?
d8145 1
a8145 1
  * 10.12 - Setting up KerberosIV Client/Server
d8149 11
a8159 1
  * 10.16 - Tell me about chroot() Apache?
d8161 1
a8161 1
-------------------------------------------------------------------------------
d8165 7
a8171 10
Existing users must be added to the "wheel" group by hand. This is done for
security reasons, and you should be cautious with whom you give access to. On
OpenBSD, users who are in the wheel group are allowed to use the su(1) userland
program to become root. Users who are not in "wheel" cannot use su(1). Here is
an example of a /etc/group entry to place the user ericj into the "wheel"
group.

If you are adding a new user with adduser(8), you can put them in the wheel
group by answering wheel at Invite user into other groups: This will add them
to /etc/group, which will look something like this:
d8175 2
a8176 2
If you are looking for a way to allow users limited access to superuser
privileges without putting them in the "wheel" group, use sudo(8).
d8194 2
a8195 1
OpenBSD uses an rc(8) style startup. This uses a few key files for startup.
d8198 7
a8204 6
  * /etc/rc.conf - Configuration file used by /etc/rc to know what daemons
    should start with the system.
  * /etc/rc.conf.local - Configuration file you can use to override settings in
    /etc/rc.conf so you don't have to touch /etc/rc.conf itself, which is
    convenient for people who upgrade often.
  * /etc/netstart - Script used to initialize the network. Shouldn't be edited.
d8206 1
a8206 1
    daemons or host specific information should be stored.
d8215 2
a8216 2
(or /etc/rc.conf.local), /etc/rc.local and /etc/rc.shutdown. To get a look of
how the rc(8) procedure works, here is the flow:
d8218 1
a8218 1
After the kernel is booted. /etc/rc is started:
d8220 4
a8223 4
  * Filesystems checked. This will always be bypassed if the file /etc/fastboot
    exists. This is certainly not a good idea though.
  * Configuration Variables are read in from /etc/rc.conf and, afterwards, /etc
    /rc.conf.local. Settings in rc.conf.local will override those in rc.conf.
d8230 4
a8233 2
  * Does various checks. (quota's, savecore, etc)
  * Local daemons are run, ala /etc/rc.local
d8237 22
a8258 13
Most daemons and services that come with OpenBSD by default can be started on
boot by simply editing the /etc/rc.conf configuration file. To start out take a
look at the default /etc/rc.conf file. You'll see lines similar to this:

    ftpd_flags=NO           # for non-inetd use: ftpd_flags="-D"

A line like this shows that ftpd is not to start up with the system (at least
not via rc(8), read the Anonymous FTP FAQ to read more about this). In any
case, each line also has a comment showing you the flags for NORMAL usage of
that daemon or service. This doesn't mean that you must run that daemon or
service with those flags. You can always use man(1) to see how you can have
that daemon or service start up in any way you like. For example, Here is the
default line pertaining to httpd(8).
d8262 5
a8266 9
Here you can obviously see that starting up httpd normally no flags are
necessary. So a line like: " httpd_flags=""" would be necessary. But to start
httpd with ssl enabled. (Refer to the SSL FAQ or ssl(8)) You should start with
a line like: "httpd_flags="-DSSL"".

Another approach would be to never touch /etc/rc.conf itself. Instead, create
the file /etc/rc.conf.local and copy just the lines you are about to change
from /etc/rc.conf and adjust them as you like. This may make future upgrading
easier -- all the changes are in the one file.
d8270 4
a8273 4
For other daemons that you might install with the system via ports or other
ways, you will use the /etc/rc.local file. For example, I've installed a daemon
which lies at /usr/local/sbin/daemonx. I want this to start at boot time. I
would put an entry into /etc/rc.local like this:
d8276 1
a8276 1
                 echo -n ' daemonx';       /usr/local/sbin/daemonx
d8279 4
a8282 1
From now on, this daemon will be run at boot. You will be able to see any
d8285 1
a8285 1
    Starting local daemons: daemonx.
d8287 1
a8287 1
rc.shutdown
d8289 24
a8312 4
/etc/rc.shutdown is a script that is run a shutdown. Anything you want done
before the system shuts down should be added to this file. If you have apm, you
can also set "powerdown=YES". Which will give you the equivalent of "shutdown
-p".
d8314 22
a8335 2
10.4 - Why do users get relaying access denied when they are remotely sending
mail through my OpenBSD system?
d8339 1
a8339 1
    # cat /etc/mail/sendmail.cf | grep relay-domains
d8345 2
a8346 2
If this file doesn't exist, create it. You will need to enter the hosts who are
sending mail remotely with the following syntax:
d8352 1
a8352 1
Don't forget send a 'HangUP' signal to sendmail, (a signal which causes most
d8360 2
a8361 2
  * http://www.sendmail.org/tips/relaying.html
  * http://www.sendmail.org/antispam.html
d8363 2
a8364 2
10.5 - I've set up POP, but users have trouble accessing mail through POP. What
can I do?
d8375 2
a8376 2
    
    
d8380 3
a8382 3
Another thing to check is that the user actually owns their own /var/mail file.
Of course this should be the case (as in, /var/mail/joe should be owned by joe)
but if it isn't set correctly it could be the problem!
d8386 1
a8386 1
it. But it could (especially if you are a high profile site, ISP,...)! There
d8388 2
a8389 2
If possible, use popa3d which is available in the OpenBSD base install. Or, you
could just have the wrong options selected for your pop daemon (like dot
d8393 2
a8394 2
PS: Notice, OpenBSD does not have a group name of "mail". You need to create
this in your /etc/group file if you need it. An entry like:
d8400 1
a8400 1
10.6 - Why does Sendmail ignore /etc/hosts file?
d8402 3
a8404 2
By default, Sendmail uses DNS for name resolution, not the /etc/hosts file. The
behavior can be changed through the use of the /etc/mail/service.switch file.
d8408 2
a8409 1
     hosts       files dns
d8412 2
a8413 1
     hosts       files
d8416 2
a8417 1
     # kill -HUP `head -1 /var/run/sendmail.pid`
d8423 12
a8434 7
OpenBSD ships with an SSL-ready httpd and RSA libraries. For use with httpd(8),
you must first have a certificate created. This will be kept in /etc/ssl/ with
the corresponding key in /etc/ssl/private/. The steps shown here are taken in
part from the ssl(8) man page. Refer to it for further information. This FAQ
entry only outlines how to create an RSA certificate for web servers, not a DSA
server certificate. To find out how to do so, please refer to the ssl(8) man
page.
d8436 2
a8437 2
To start off, you need to create your server key and certificate using OpenSSL:
# openssl genrsa -out /etc/ssl/private/server.key 1024
d8439 1
a8439 3
Or, if you wish the key to be encrypted with a passphrase that you will have to
type in when starting servers
# openssl genrsa -des3 -out /etc/ssl/private/server.key 1024
d8441 2
a8442 2
The next step is to generate a Certificate Signing Request which is used to get
a Certifying Authority (CA) to sign your certificate. To do this use the
d8444 2
a8445 1
# openssl req -new -key /etc/ssl/private/server.key -out /etc/ssl/private/server.csr
d8449 1
a8449 2
www.thawte.com/. Thawte can currently sign RSA keys for you. A procedure is
being worked out to allow for DSA keys.
d8453 3
a8455 2
# openssl x509 -req -days 365 -in /etc/ssl/private/server.csr \
       -signkey /etc/ssl/private/server.key -out /etc/ssl/server.crt
d8469 1
a8469 1
         /etc/passwd         a Version 7 format password file
d8477 2
a8478 2
prime target for programs such as Crack.) 4.4BSD introduces the master.passwd
file, which has an extended format (with additional options beyond what was
d8483 2
a8484 2
OpenBSD does come with a tool with which you should edit your password file. It
is called vipw(8). Vipw will use vi (or your favourite editor defined per
d8497 3
d8501 6
a8506 8
can configure this to work however you like by editing /etc/adduser.conf. You
can add users by hand via vipw(8), but this is the recommended way to add
users. adduser(8) allows for consistency checks on /etc/passwd, /etc/group, and
shell databases. It will create the entries and $HOME directories for you. It
can even send a message to the user welcoming them. This can be changed to meet
your needs. Here is an example user, testuser being added to a system. His/Her
$HOME directory will be placed in /home/testuser, and given the group guest,
and the shell /bin/ksh.
d8510 1
a8510 1
    
d8514 1
a8514 1
    
d8516 2
a8517 2
    Don't worry about mistakes. I will give you the chance later to correct any input.
    Enter username [a-z0-9_]: testuser
d8520 1
a8520 1
    Uid [1002]: <Enter>
d8524 13
a8536 11
    Enter password []: 
    Enter password again []:
    
    Name:     testuser
    Password: ****
    Fullname: Test FAQ User
    Uid:      1002
    Gid:      31 (guest)
    Groups:   guest
    HOME:     /home/testuser
    Shell:    /bin/ksh
d8539 1
a8539 1
    Copy files from /usr/share/skel to /home/testuser
d8544 5
a8548 5
existence of a user. It will remove any crontab(1) entries, their $HOME dir (if
it is owned by the user), and their mail. Of course it will also remove their /
etc/passwd and /etc/group entries. Next is an example of removing the user that
was added above. Notice you are prompted for the name, and whether or not to
remove the users home directory.
d8553 4
a8556 3
    
    testuser:$2a$07$ZWnBOsbqMJ.ducQBfsTKUe3PL97Ve1AHWJ0A4uLamniLNXLeYrEie:1002:31::0:0:Test FAQ User:/home/testuser:/bin/ksh
    
d8565 2
a8566 2
These tools are less interactive than the adduser(8) command, which helps
facilitate using these in a script.
d8568 1
a8568 1
A list of the added commands are:
d8583 9
a8591 10
Being that user(8) is not interactive, the easiest way to add users efficiently
is to use the adduser(8) command. The actual command /usr/sbin/user is just a
frontend to the rest of the /usr/sbin/user* commands. Therefore, the following
commands can be added by using user add or useradd, its your choice as to what
you want, and doesn't change the use of the commands at all.

In this example, we are adding the same user with the same specifications as
the user that was added above. useradd(8) is much easier to use if you know the
default setting before adding a user. These settings are located in /etc/
usermgmt.conf and can be viewed by doing so:
d8602 7
a8608 8
The above settings are what will be set unless you specify different with
command line options. For example, in our case, we want the user to go to the
group guest, not users. One more little hurdle with adding users, is that
passwords must be specified on the commandline. This is, the encrypted
passwords, so you must first use the encrypt(1) utility to create the password.
For example: OpenBSD's passwords by default use the Blowfish algorithm for 6
rounds. Here is an example line to create an encrypted password to specify to
useradd(8).
d8614 3
a8616 1
Now that we have our encrypted password, we are ready to add the user.
d8621 4
a8624 4
Note: Make sure to use '' around the password string, not "" as the shell will
interpret these before sending it to user(8). In addition to that, make sure
you specify the -m option if you want the user's home directory created and the
files from /etc/skel copied over.
d8674 5
a8678 8
There are a few ways to do this, but a very common way to do such is to add /
usr/bin/false into /etc/shells. Then when you set a users shell to /usr/bin/
false, they will not be able log in interactively, but will be able to use ftp
capabilities. adduser(8) will give them a home dir by default of /home/<user>.
If this is what you desire it doesn't need to be changed, however you can set
this to whatever directory you wish. You can force this user to only be able to
see files in their home directory by adding their username to /etc/ftpchroot.
Using the -A option to ftpd(8), you can allow only ftpchroot logins!
d8682 14
a8695 16
Quotas are used to limit users space that they have available to them on your
drives. It can be very helpful in situations where you have limited resources.
Quotas can be set in two different ways.

  * User Quotas
  * Group Quotas

The first step to setting up quotas is to make sure that option QUOTA is in
your Kernel Configuration. This option is in the GENERIC kernel. After this you
need to mark in /etc/fstab the filesystems which will have quotas enabled. The
keywords userquota and groupquota should be used to mark each fs that you will
be using quotas on. By default the files quota.user and quota.group will be
created at the root of that filesystem to hold the quota information. This
default can be overwritten by doing, userquota=/var/quotas/quota.user. Or
whatever file you want to use for holding quota information. Here is an example
/etc/fstab that has one filesystem with userquotas enabled.
d8699 4
a8702 4
Now it's time to set the user's quotas. To do so you use the utility edquota(8)
. A simple use is just edquota <user>. edquota(8) will use vi(1) to edit the
quotas unless the environmental variable EDITOR is set to a different editor.
For example:
d8709 2
a8710 2
    /: blocks in use: 62, limits (soft = 0, hard = 0)
        inodes in use: 25, limits (soft = 0, hard = 0)
d8715 2
a8716 2
    /: blocks in use: 62, limits (soft = 1000, hard = 1050)
        inodes in use: 25, limits (soft = 0, hard = 0)
d8718 7
a8724 6
In this the softlimit is set to 1000 blocks and the hardlimit is set to 1050
blocks. A softlimit is a limit where the user is just warned when they cross it
and have until their grace period is up to get their disk usage below their
limit. Grace periods can be set by using the -t option on edquota(8). After the
grace period is over the softlimit is handled as a hardlimit. This usually
results in an allocation failure.
d8726 1
a8726 1
Now that the quotas are set, you need to turn the quotas on. To do this use 
d8732 4
a8735 3
Now that quotas are up and running, you can view them by the quota(1). Using a
command of quota <user> will give that users information. When called with no
arguments the quota command will give your quota statistics. For example:
d8741 1
a8741 1
    Disk quotas for user ericj (uid 1001): 
d8743 1
a8743 1
                  /      62    1000    1050              27       0       0        
d8750 1
a8750 1
10.12 - How to Setup KerberosIV Clients and Servers under OpenBSD
d8752 1
a8752 238
As a user/administrator of OpenBSD systems, you are fortunate that KerberosIV
is a pre-installed component of the default system. Here is a guide to setting
up both the Kerberos realm server, as well as a client.

An *EXTREMELY* important point to remember is that Kerberos clients and servers
must have their system clocks synchronized. If there is more than a 5 minute
time skew, you will receive weird errors that do not immediately reveal
themselves to be caused by time skew, such as:

    kinit: Can't send request (send_to_kdc) 

Another more accurate error is:

    kauth: Time is out of bounds (krb_rd_req) 

An easy way to synchronize system clocks is with ntpd, available in the ports
tree at /usr/ports/net/ntp/.

This FAQ entry assumes you have prior knowledge of the Kerberos concepts. For a
great, easy to understand, reference, see:

  * The FreeBSD handbook
  * Use the command info kth-krb
  * Designing an Authentication System: a Dialogue in Four Scenes
  * Papers and Documentation Describing KerberosIV

Or the book

  * Network Security Private Communication in a Public World [Kaufman, Perlman,
    Speciner, 1995]

How to setup the Kerberos IV REALM and SERVER

We will be setting up the CIARASYSTEMS.COM realm, with
avalanche.ciarasystems.com as the main server.

To start off, we will need to edit our configuration files. These files are
located at /etc/kerberosIV/. The two files we are concerned about are
krb.realms and krb.conf. Let's start off with krb.conf.

    # cat krb.conf
    CIARASYSTEMS.COM
    CIARASYSTEMS.COM avalanche.ciarasystems.com admin server

As you can see, this tells kerberos that the domain is CIARASYSTEMS.COM (or
logical realm) and that within that domain, avalanche is the administration
server. Next we will look at krb.realms. For more information on this refer to 
krb.conf(5).

    # cat krb.realms
    avalanche.ciarasystems.com      CIARASYSTEMS.COM
    .ciarasystems.com               CIARASYSTEMS.COM

krb.realms provides a translation from a hostname to the Kerberos realm name
for the services provided by that host. Each line of the translation file is in
one of the following forms (domain_name should be of the form .XXX.YYY). So in
this example, avalanche is the hostname of a computer on the CIARASYSTEMS.COM
realm. And .ciarasystems.com is the domain name on the realm CIARASYSTEMS.COM.
Again, for further information read the krb.realms(5). man page.

Next we will run kdb_init(8) to create the initial Kerberos database.

    # kdb_init
    Realm name [default  NO.DEFAULT.REALM ]: CIARASYSTEMS.COM
    You will be prompted for the database Master Password.
    It is important that you NOT FORGET this password.
    
    Enter Kerberos master password: not shown
    Verifying password -
    Enter Kerberos master password:

Next we need to use kstash(8) which is used to save the Kerberos key
distribution center (KDC) database master key in the master key cache file.

    # kstash
    Enter Kerberos master password:
    
    Current Kerberos master key version is 1.
    
    Master key entered.  BEWARE!
    Wrote master key to /etc/kerberosIV/master_key
    This saves the encrypted master password in /etc/kerberosIV/master_key.
   
    Next, we need two principals to be added to the database for each system
    that will be secured with Kerberos. Their names are kpasswd and rcmd. These
    two principals are made for each system, with the instance being the name
    of the individual system. These daemons, kpasswd and rcmd allow other
    systems to change Kerberospasswords and run commands like rcp, rlogin and
    rsh.
    # kdb_edit
    Opening database...
        
    Enter Kerberos master key:
        
    Current Kerberos master key version is 1.
        
    Master key entered.  BEWARE!
    
    Previous or default values are in [brackets] ,
    enter return to leave the same, or new value.
    
    Principal name: passwd
    Instance: avalanche
    
    <Not found>, Create [y] ? y
    
    Principal: passwd, Instance: avalanche, kdc_key_ver: 1
    New Password:                <----- Use 'RANDOM' as password
    Verifying password -
    New Password:
    
    Random password [y] ? y
    
    Principal's new key version = 1
    Expiration date (enter yyyy-mm-dd) [ 1999-12-31 ] ? 2003-12-31
    Max ticket lifetime (*5 minutes) [ 255 ] ?
    Attributes [ 0 ] ?
    Edit O.K.
    
    
    Principal name: rcmd
    Instance: avalanche
    
    <Not found>, Create [y] ? y
    Principal: rcmd, Instance: avalanche, kdc_key_ver: 1
    New Password:                 <----- Use 'RANDOM' as password
    Verifying password -
    New Password:
    
    Random password [y] ? y
    
    Principal's new key version = 1
    Expiration date (enter yyyy-mm-dd) [ 1999-12-31 ] ? 2003-12-31
    Max ticket lifetime (*5 minutes) [ 255 ] ?
    Attributes [ 0 ] ?
    Edit O.K.
    Principal name:               <----- Hit <ENTER> to end
    

A srvtab file is the service key file. These must be extracted from the
Kerberos key distribution center database in order for services to authenticate
using Kerberos. For each hostname specified on the command line, ext_srvtab(8)
creates the service key file hostname-new-srvtab, containing all the entries in
the database with an instance field of hostname.

    # ext_srvtab avalanche
    
    Enter Kerberos master password:
    
    Current Kerberos master key version is 1.
    
    Master key entered.  BEWARE!
    Generating 'avalanche-new-srvtab'....
    
    # mv avalanche-new-srvtab srvtab
    # chmod 600 srvtab

Now we can add users to our database.

    # kdb_edit
    Opening database...
        
    Enter Kerberos master key:
        
    Current Kerberos master key version is 1.
        
    Master key entered.  BEWARE!
    Previous or default values are in [brackets] ,
    enter return to leave the same, or new value.
        
    Principal name: jeremie
    Instance:
        
    <Not found>, Create [y] ? y
        
    Principal: jeremie, Instance: , kdc_key_ver: 1
    New Password:                <---- enter a secure password here
    Verifying password
        
    New Password:                <---- re-enter the password here
    Principal's new key version = 1
    Expiration date (enter yyyy-mm-dd) [ 2000-01-01 ] ?
    Max ticket lifetime (*5 minutes) [ 255 ] ?
    Attributes [ 0 ] ?
    Edit O.K.
    Principal name:          <---- null entry here will cause an exit
                               or you can add more entries.

So now all the Kerberos particulars are setup. All that is left is to enable
boot-time loading of the Kerberos server and to enable Kerberized-daemons.

In /etc/rc.conf, set:

    kerberos_server=YES

In /etc/inetd.conf, uncomment:

    telnet       stream  tcp     nowait  root    /usr/libexec/telnetd    telnetd -k
    klogin       stream  tcp     nowait  root    /usr/libexec/rlogind    rlogind -k
    kshell       stream  tcp     nowait  root    /usr/libexec/rshd       rshd -k
    kauth        stream  tcp     nowait  root    /usr/libexec/kauthd     kauthd

Then, either reboot, or:

    # kill -HUP `cat /var/run/inetd.pid`
    # /usr/libexec/kerberos >> /var/log/kerberos.log &
    # /usr/libexec/kadmind -n >> /var/log/kadmind.log &

Note: this is a rather simple server setup. Usually, redundant servers are
setup (as slave servers) so that if one server goes down, all the services that
depend on Kerberos don't go down. We can also add 'su' privileges to a specific
principal, see the FreeBSD Handbook.

How to kerberize your client workstation

We will be setting the workstation named gatekeeper to be in the
CIARASYSTEMS.COM realm, with avalanche.ciarasystems.com as the main server.

To start off, we need to setup our krb.conf and krb.realms like the above
machine. This is so gatekeeper will know what server is the KDC and what domain
it is on. Again here are the file contents.

    # cat krb.conf
    CIARASYSTEMS.COM
    CIARASYSTEMS.COM avalanche.ciarasystems.com admin server
    
    # cat krb.realms
    avalanche.ciarasystems.com      CIARASYSTEMS.COM
    .ciarasystems.com               CIARASYSTEMS.COM

Now that is set up, we need to initialize kerberos. To obtain a ticket you use 
kinit(1).

    $ kinit
    The OpenBSD Project (gatekeeper)
    Kerberos Initialization
    Kerberos name: jeremie
    Password:
d8754 1
a8754 33
Now we have identified we can list our tickets with klist(1).

    $ klist
    Ticket file:    /tmp/tkt1000
    Principal:      jeremie@@CIARASYSTEMS.COM
    
      Issued           Expires          Principal
    Jun 28 01:03:25  Jun 28 11:03:25  krbtgt.CIARASYSTEMS.COM@@CIARASYSTEMS.COM

Looks like we are set now. All that's left to do is test it. Here we will test
it with rlogin(1) and telnet(1).

    $ telnet avalanche
    Trying 192.168.0.38...
    Connected to avalanche.
    Escape character is '^]'.
    [ Trying mutual KERBEROS4 ... ]
    [ Kerberos V4 accepts you ]
    [ Kerberos V4 challenge successful ]
    Last login: Sun Jun 27 22:52:25 on ttyp1 from gatekeeper
    Warning: no Kerberos tickets issued.
    OpenBSD 3.2 (GENERIC) #25: Thu Oct  3 19:51:53 MDT 2002

and

    $ rlogin avalanche
    Last login: Sun Jun 27 22:53:39 on ttyp1 from gatekeeper
    Warning: no Kerberos tickets issued.
    OpenBSD 3.2 (GENERIC) #25: Thu Oct  3 19:51:53 MDT 2002

We can tell that it is indeed using Kerberos to authenticate the rlogin
session. To get rid of any tickets issued, you would use kdestroy(1). For
example:
d8756 1
a8756 12
    $ kdestroy
    Tickets destroyed.
    $ rlogin avalanche
    krcmd: No ticket file (tf_util)
    rlogin: warning, using standard rlogin: can't provide Kerberos auth data.
    avalanche: Connection refused

Do not worry about 'Warning: no Kerberos tickets issued.' This is because we're
only doing kerberos authentication, not ticket passing. If you want ticket
passing, use OpenSSH which has support. Stock KerberosIV doesn't have support
for tgt passing, either - only the AFS kaserver's implementation of krb4, since
the regular KerberosIV kdc checks client IP address listed in the ticket.
d8766 13
a8778 11
To start off, you need to have an account on your system of "ftp". This account
shouldn't have a usable password. Here we will set the login directory to /home
/ftp, but you can put it wherever you want. When using anonymous ftp, the ftp
daemon will chroot itself to the home directory of the 'ftp' user. To read up
more on that, read the ftp(8) and chroot(2) man pages. Here is an example of
adding the ftp user. I will do this using adduser(8). We also need to add /usr/
bin/false to our /etc/shells, this is the "shell" that we will be giving to the
ftp user. This won't allow them to login, even though we will give them an
empty password. To do this you can simply echo /usr/bin/false >> /etc/shells.
Also if you wish for that shell to show up during the adduser questions, you
need to modify /etc/adduser.conf.
d8781 2
a8782 2
    Use option ``-silent'' if you don't want see all warnings and questions.
    
d8786 1
a8786 1
    
d8788 2
a8789 2
    Don't worry about mistakes. I will give you the chance later to correct any input.
    Enter username [a-z0-9_]: ftp
d8791 3
a8793 3
    Enter shell csh false ksh nologin sh tcsh zsh [sh]: false
    Uid [1002]:
    Login group ftp [ftp]:
d8795 3
a8797 2
    [no]: no
    Enter password []:
d8799 11
a8809 10
    
    Name:     ftp
    Password: ****
    Fullname: anonymous ftp
    Uid:      1002
    Gid:      1002 (ftp)
    Groups:   ftp
    HOME:     /home/ftp
    Shell:    /usr/bin/false
    OK? (y/n) [y]: y
d8811 1
a8811 1
    Copy files from /usr/share/skel to /home/ftp
d8817 4
a8820 3
Along with the user, this created the directory /home/ftp. This is what we
want, but there are some changes that we will have to make to get it ready for
anonymous ftp. Again these changes are explained in the ftp(8) man page.
d8824 3
a8826 2
  * /home/ftp - This is the main directory. It should be owned by root and have
    permissions of 555.
d8829 2527
a11355 8
    want your anonymous ftp directory to appear to have real users attached to
    your files, you should copy /etc/pwd.db and /etc/group to this directory.
    This directory should be mode 511, and the two files should be mode 444.
    These are used to give owner names as opposed to numbers. There are no
    passwords stored in pwd.db, they are all in spwd.db, so don't copy that
    over.
  * /home/ftp/pub - This is a standard directory to place files in which you
    wish to share. This directory should also be mode 555.
d11357 12
a11368 2
Note that all these directories should be owned by ''root''. Here is a listing
of what the directories should look like after their creation.
d11370 8
a11377 20
    # pwd
    /home
    # ls -laR ftp
    total 5
    dr-xr-xr-x  5 root  ftp    512 Jul  6 11:33 .
    drwxr-xr-x  7 root  wheel  512 Jul  6 10:58 ..
    dr-x--x--x  2 root  ftp    512 Jul  6 11:34 etc
    dr-xr-xr-x  2 root  ftp    512 Jul  6 11:33 pub
    
    ftp/etc:
    total 43
    dr-x--x--x  2 root  ftp    512 Jul  6 11:34 .
    dr-xr-xr-x  5 root  ftp    512 Jul  6 11:33 ..
    -r--r--r--  1 root  ftp    316 Jul  6 11:34 group
    -r--r--r--  1 root  ftp  40960 Jul  6 11:34 pwd.db
    
    ftp/pub:
    total 2
    dr-xr-xr-x  2 root  ftp  512 Jul  6 11:33 .
    dr-xr-xr-x  5 root  ftp  512 Jul  6 11:33 ..
d11379 1
a11379 1
Starting up the server and logging
d11381 4
a11384 22
With ftpd you can choose to either run it from inetd or the rc scripts can kick
it off. These examples will show our daemon being started from inetd.conf.
First we must become familiar with some of the options to ftpd. The default
line from /etc/inetd.conf is:

    ftp             stream  tcp     nowait  root    /usr/libexec/ftpd       ftpd -US

Here ftpd is invoked with -US. This will log anonymous connections to /var/log/
ftpd and concurrent sessions to /var/run/utmp. That will allow for these
sessions to be seen via who(1). For some, you might want to run only an
anonymous server, and disallow ftp for users. To do so you should invoke ftpd
with the -A option. Here is a line that starts ftpd up for anonymous
connections only. It also uses -ll which logs each connection to syslog, along
with the get, retrieve, etc, ftp commands.

    ftp             stream  tcp     nowait  root    /usr/libexec/tcpd       ftpd -llUSA

Note - For people using HIGH traffic ftp servers, you might want to not invoke
ftpd from inetd.conf. The best option is to comment the ftpd line from
inetd.conf and start ftpd from rc.conf along with the -D option. This will
start ftpd as a daemon, and has much less overhead as starting it from inetd.
Here is an example line to start it from rc.conf.
d11386 4
a11389 1
    ftpd_flags="-DllUSA"           # for non-inetd use: ftpd_flags="-D"
d11391 3
a11393 2
This of course only works if you have ftpd taken out of /etc/inetd.conf and
made inetd re-read its configuration file.
d11395 4
a11398 1
Other relevant files
d11400 1
a11400 6
  * /etc/ftpwelcome - This holds the Welcome message for people once they have
    connected to your ftp server.
  * /etc/motd - This holds the message for people once they have successfully
    logged into your ftp server.
  * .message - This file can be placed in any directory. It will be shown once
    a user enters that directory.
d11402 2
a11403 1
10.14 - Confining users to their home dir's in ftpd(8)
d11405 14
a11418 5
OpenBSD's ftpd(8) is setup by default to be able to handle this very easily.
This is accomplished via the file /etc/ftpchroot. Since users cannot always be
trusted, it might be necessary to restrain them to their home directories. This
behavior is NOT on by default. Here is an example of what the default behavior
is like.
d11420 5
a11424 42
    $ ftp localhost
    Connected to localhost.
    220 oshibana FTP server (Version 6.4/OpenBSD) ready.
    Name (localhost:ericj): ericj
    331 Password required for ericj.
    Password: *********
    230- OpenBSD 3.2 (GENERIC) #25: Thu Oct  3 19:51:53 MDT 2002
    230- 
    230- Welcome to OpenBSD: The proactively secure Unix-like operating system.
    230- 
    230- Please use the sendbug(1) utility to report bugs in the system.
    230- Before reporting a bug, please try to reproduce it with the latest
    230- version of the code.  With bug reports, please try to ensure that
    230- enough information to reproduce the problem is enclosed, and if a
    230- known fix for it exists, include that as well.
    230- 
    230 User ericj logged in.
    Remote system type is UNIX.
    Using binary mode to transfer files.
    ftp> cd /
    250 CWD command successful.
    ftp> ls
    227 Entering Passive Mode (127,0,0,1,60,7)
    150 Opening ASCII mode data connection for 'file list'.
    altroot
    bin
    dev
    etc
    home
    mnt
    root
    sbin
    stand
    tmp
    usr
    var
    bsd
    sys
    boot
    226 Transfer complete.
    ftp> quit
    221 Goodbye.
d11426 3
a11428 4
As you can see here, access is granted to the whole server. In a perfect world
this is ok, where all users can be trusted, but this isn't so. To limit a user,
simply add their name to the file /etc/ftpchroot. Here is an example showing
user "ericj" being restricted.
d11430 3
a11432 10
    $ cat /etc/ftpchroot
    #       $ OpenBSD: ftpchroot,v 1.3 1996/07/18 12:12:47 deraadt Exp $
    #
    # list of users (one per line) given ftp access to a chrooted area.
    # read by ftpd(8).
    ericj

This is enough to keep the user "ericj" from escaping from his own directory.
As you can see in the next example. The / directory has suddenly changed to his
home dir!
d11434 1
a11434 26
    $ ftp localhost
    Connected to localhost.
    220 oshibana FTP server (Version 6.4/OpenBSD) ready.
    Name (localhost:ericj): ericj
    331 Password required for ericj.
    Password: *********
    230 User ericj logged in.
    Remote system type is UNIX.
    Using binary mode to transfer files.
    ftp> cd /
    250 CWD command successful.
    ftp> ls
    227 Entering Passive Mode (127,0,0,1,92,171)
    150 Opening ASCII mode data connection for 'file list'.
    .login
    .mailrc
    .profile
    .rhosts
    .ssh
    .cshrc
    work
    mail
    src
    226 Transfer complete.
    ftp> quit
    221 Goodbye.
d11436 2
a11437 1
10.15 - Applying patches in OpenBSD
d11439 1
a11439 58
The OpenBSD source tree is constantly changing and improving, along with this
fixes to common problems are often made and patches released to the public.
These patches appear on the errata web page located at http://www.openbsd.org/
errata.html, and are separated into categories. These categories correspond to
patches that should be applied to different architectures or architecture
independent patches.

Note, however, that patches aren't made for new additions to OpenBSD, and are
only done for important reliability fixes or security problems that should be
addressed right away, although the choice to do so is, as always, up to the
administrator.

For the examples I will be patching talkd(8) with a security fix from the patch
obtained from errata.html.

How are these patches different from what I would find in the CVS tree?

All patches posted at http://www.openbsd.org/errata.html are patches directly
against the latest release's source tree. Patches against the latest CVS tree
might also include other changes that wouldn't be wanted on a release system.

Getting your system ready to be patched.

Patches for the OpenBSD Operating System are distributed as diffs, which are
text files that hold differences to the original source code. They are NOT
distributed in binary form. This means that to patch your system you must have
the source code from the RELEASE version of OpenBSD readily available. This
does not mean that you must have ALL source code to the OpenBSD operating
system to patch your system, but must have all code for the program which you
are patching. For instance, if you are patching the kernel you must have all
source for the kernel on hand.

cvs(1) is a very handy tool that can be used to grab only the source that you
need via any of the anonymous cvs servers located around the world. You can get
a listing of these servers at http://www.openbsd.org/anoncvs.html.

To retrieve the current release's source code using cvs(1), you would use the
following line:
$ cvs -d anoncvs@@anoncvs5.usa.openbsd.org:/cvs co -rOPENBSD_3_0_BASE src/libexec/talkd/
cvs server: Updating src/libexec/talkd
U src/libexec/talkd/announce.c
U src/libexec/talkd/talkd.c
U src/libexec/talkd/talkd.h

To find the CVS path to the code that you need, you can find this in the patch
on the Index: line. In this case, the CVS path was src/libexec/talkd/. Always
check out the revision of OPENBSD_version_number_BASE. Without "_BASE" you will
be checking out the stable branch, which might contain other changes that will
interfere. If you are already tracking the patch branch, the patches should
already be in that source, however you should always check and make sure. You
can always look at http://www.openbsd.org/plus.html to see which patches have
been applied to the patch branch. If the patches haven't been applied yet, you
will need to grab the latest release source using the commands above.

Also, for those users that bought official OpenBSD CDs, you can get the source
code directly off of the CD. Refer to the CD insert on how to extract the
source from the CD. In which case you won't need to obtain the source via
anoncvs.
d11441 2
a11442 77
    Apply by doing:
            cd /usr/src
            patch -p0 < 026_talkd.patch
            cd libexec/talkd
            make obj && make depend && make && make install
    
    Index: libexec/talkd/announce.c <------ Path to sources 
    ===================================================================
    RCS file: /cvs/src/libexec/talkd/announce.c,v
    retrieving revision 1.8
    retrieving revision 1.9
    diff -u -r1.8 -r1.9
    --- libexec/talkd/announce.c    1998/08/18 03:42:10     1.8
    +++ libexec/talkd/announce.c    2000/07/06 00:01:45     1.9
    @@@@ -160,6 +160,6 @@@@
                    *(bptr++) = '\n';
            }
            *bptr = '\0';
    -       fprintf(tf, big_buf);
    +       fprintf(tf, "%s", big_buf);
            fflush(tf);
     }

Once you've obtained the proper sources, you can obtain the patch and place it
in src/

Applying Patches

$ cd /usr/src
$ patch -p0</path/to/026_talkd.patch
Hmm...  Looks like a unified diff to me...
The text leading up to this was:
--------------------------
|Apply by doing:
|       cd /usr/src
|       patch -p0 < 026_talkd.patch
|       cd libexec/talkd
|       make obj && make depend && make && make install
|
|Index: libexec/talkd/announce.c
|===================================================================
|RCS file: /cvs/src/libexec/talkd/announce.c,v
|retrieving revision 1.8
|retrieving revision 1.9
|diff -u -r1.8 -r1.9
|--- libexec/talkd/announce.c   1998/08/18 03:42:10     1.8
|+++ libexec/talkd/announce.c   2000/07/06 00:01:45     1.9
--------------------------
Patching file libexec/talkd/announce.c using Plan A...
Hunk #1 succeeded at 160. <------------ Patch Succeeded
done
$ cd /usr/src/libexec/talkd/
$ ls
CVS             announce.c      print.c         table.c         talkd.c
Makefile        announce.c.orig process.c       talkd.8         talkd.h
$ make obj && make depend && make
making /home/ericj/lsrc/src/libexec/talkd/obj
mkdep -a /home/ericj/lsrc/src/libexec/talkd/talkd.c /home/ericj/lsrc/src/libexec/talkd/announce.c /home/ericj/lsrc/src/libexec/talkd/process.c /home/ericj/lsrc/src/libexec/talkd/table.c /home/ericj/lsrc/src/libexec/talkd/print.c
cc -O2     -c /home/ericj/lsrc/src/libexec/talkd/talkd.c
cc -O2     -c /home/ericj/lsrc/src/libexec/talkd/announce.c
cc -O2     -c /home/ericj/lsrc/src/libexec/talkd/process.c
cc -O2     -c /home/ericj/lsrc/src/libexec/talkd/table.c
cc -O2     -c /home/ericj/lsrc/src/libexec/talkd/print.c
cc   -o ntalkd talkd.o announce.o process.o table.o print.o
nroff -Tascii -mandoc /home/ericj/lsrc/src/libexec/talkd/talkd.8 > talkd.cat8
$ sudo make install
install -c -s -o root -g bin  -m 555 ntalkd /usr/libexec
install -c -o root -g bin -m 444 talkd.cat8 /usr/share/man/cat8/talkd.0
/usr/share/man/cat8/ntalkd.0 -> /usr/share/man/cat8/talkd.0

Once you have done that, you should restart that service.

10.16 - Tell me about this chroot() Apache?

Starting with OpenBSD 3.2, the Apache httpd(8) server is chroot(2)ed by
default. While this is a tremendous boost to security, it can create issues, if
you are not prepared.
d11444 1
a11444 1
What is a chroot?
d11446 1
a11446 10
A chroot(2)ed application is locked into a particular directory and unable to
wander around the rest of the directory tree, and sees that directory as its "/
" (root) directory. In the case of httpd(8), the program starts, opens its log
files, binds to its TCP ports (though, it doesn't accept data yet), and reads
its configuration. Next, it locks itself into /var/www and drops privileges,
then starts to accept requests. This means all files served and used by Apache
must be in the /var/www directory. This helps security tremendously -- should
there be a security issue with Apache, the damage will be confined to a single
directory with only "read only" permissions and no resources to cause mischief
with.
d11448 2
a11449 1
What does this mean to the user?
d11451 1
a11451 2
Put bluntly, chroot(2)ing Apache is something new, and many older applications
and system configurations will not work as before.
d11453 1
a11453 31
  * Historic file system layouts: Servers upgraded from older versions of
    OpenBSD may have web files located in user's directories, which clearly
    won't work in a chroot(2)ed environment, as httpd(8) can't reach the /home
    directory. Administrators may also discover their existing /var/www
    partition is too small to hold all web files. Your options are to
    restructure or do not use the chroot(2) feature. You can, of course, use
    symbolic links in the user's home directories pointing to subdirectories in
    /var/www, but you can NOT use links in /var/www pointing to other part of
    the file system -- that is prevented from working by the chroot(2)ing. Note
    that if you want your users to have chroot(2)ed FTP access, this will not
    work, as the FTP chroot will (again) prevent you from accessing the targets
    of the symbolic links. A solution to this is to not use /home as your home
    directories for these users, rather use something similar to /var/www/home.
  * Log Rotation: Normally, logs are rotated by renaming the old files, then
    sending httpd(8) a SIGUSR1 signal to cause Apache to close its old log
    files and open new ones. This is no longer possible, as httpd(8) has no
    ability to open its own log files once privileges are dropped. httpd(8)
    must be stopped and restarted:
         # apachectl stop && apachectl start
    There are also other strategies available, including logging to a pipe(2) ,
    and using an external log rotator at the other end of the pipe(2).
  * Existing Apache modules: Virtually all will load, however some may not work
    properly in chroot(2), and many have issues on "apachectl restart",
    generating an error, which causes httpd(8) to exit.
  * Existing CGIs: Most will NOT work as is. They may need programs or
    libraries outside /var/www. Some can be fixed by compiling so they are
    statically linked (not needing libraries in other directories), most may be
    fixed by populating the /var/www directory with the files required by the
    application, though this is non-trivial and requires considerable
    programming knowledge -- most users will find it easier to just disable the
    chroot(2) feature until they are updated.
d11455 4
a11458 3
In some cases, the application or configuration can be altered to run within
the chroot. In other cases, you will simply have to disable this feature using
the -u option for httpd(8) in /etc/rc.conf
d11460 9
a11468 2
[Back to Main Index] [To Section 9.0 - Migrating from Linux] [To Section 11.0 -
Performance Tuning]
d11470 1
a11470 4
-------------------------------------------------------------------------------
[back] www@@openbsd.org
$OpenBSD: obsd-faq.txt,v 1.33 2003/01/05 19:29:10 nick Exp $
[OpenBSD]
d11472 1
a11472 1
11.0 - Performance Tuning
d11474 4
a11477 1
-------------------------------------------------------------------------------
d11479 4
a11482 1
Table of Contents
d11484 1
a11484 47
  * 11.1 - Networking
  * 11.2 - Disk I/O
  * 11.4 - Hardware Choices
  * 11.5 - Why aren't we using async mounts?
  * 11.6 - Tuning your monitor resolution under XFree86

-------------------------------------------------------------------------------

If you run a busy server, gateway or firewall, you may wish or need to adjust
some of the default parameters to get optimal performance. The options(4) man
page talks about the kernel options presented. These options are placed in the
kernel configuration file before you compile a custom kernel. For more details,
see FAQ 5.

11.1 - Networking

A parameter you may need to change for a busy server, gateway or firewall is
NMBCLUSTERS. This controls the size of the kernel mbuf cluster map. On your
computer, if you get messages like "mb_map full", you need to increase the
value of this parameter. If traffic on a network interface stops for no
apparent reason, this may also be a sign that you need to increase the value of
NMBCLUSTERS. A reasonable value on the i386 port with most 100Mbps ethernet
interfaces (no matter how many the machine has) is 8192.

    option NMBCLUSTERS=8192

The default number of NMBCLUSTERS varies from platform to platform, ranging
from 256 to 2048. It is set in a platform-dependent header file unless
overridden by an an option line in a kernel config file.

11.2 - Disk I/O

Disk I/O speed is a significant factor in the overall speed of your computer.
It becomes increasingly important when your computer is hosting a multi-user
environment (users of all kinds, from those who log-in interactively to those
who see you as a file-server or a web-server.) Data storage constantly needs
attention, especially when your partitions run out of space or when your disks
fail. OpenBSD has several options to increase the speed of your disk operations
and provide fault tolerance.

Table Of Contents

  * CCD - Concatenated Disk Driver.
  * RAID
  * Filesystem Buffer
  * Soft Updates
  * Size of the namei() cache
d11486 3
a11488 1
11.2.1 - CCD
d11490 4
a11493 118
    The first option is the use of ccd(4), the Concatenated Disk Driver. This
    allows you to join several partitions into one virtual disk (and thus, you
    can make several disks look like one disk). This concept is similar to that
    of LVM (logical volume management), which is found in many commercial Unix
    flavors.
   
    If you are running GENERIC, ccd is already enabled (in /usr/src/sys/conf/
    GENERIC). If you have customized your kernel, you may need to return it to
    your kernel configuration. Either way, a line such as this should be in
    your configuration file:
         pseudo-device   ccd     4       # concatenated disk devices
   
    The above example gives you up to 4 ccd devices (virtual disks). Now you
    need to figure out which partitions on your real disks you want to dedicate
    to ccd. Use disklabel to mark these partitions as type 'ccd'. On some
    architectures, disklabel may not allow you to do this. In this case, mark
    them as 'ffs'.
   
    If you are using ccd to gain performance by striping, note that you will
    not get optimum performance unless you use the same model of disks with the
    same disklabel settings.
   
    Edit /etc/ccd.conf to look something like this: (for more information on
    configuring ccd, look at ccdconfig(8))
   
        # Configuration file for concatenated disk devices
        #
        # ccd   ileave  flags   component devices
        ccd0   16      none    /dev/sd2e /dev/sd3e
   
    To make your changes take effect, run
   
        # ccdconfig -C
   
    As long as /etc/ccd.conf exists, ccd will automatically configure itself
    upon boot. Now, you have a new disk, ccd0, a combination of /dev/sd2e and /
    dev/sd3e. Just use disklabel on it like you normally would to make the
    partition or partitions you want to use. Again, don't use the 'c' partition
    as an actual partition that you put stuff on. Make sure your usable
    partitions are at least one cylinder off from the beginning of the disk.

11.2.2 - RAID

    Another solution is raid(4), which will have you use raidctl(8) to control
    your raid devices. OpenBSD's RAID is based upon Greg Oster's NetBSD port of
    the CMU RAIDframe software. OpenBSD has support for RAID levels of 0, 1, 4,
    and 5.
   
    With raid, as with ccd, support must be in the KERNEL. Unlike ccd, support
    for RAID is not found in GENERIC, so it must be compiled into your kernel
    (RAID support adds some 500K to the size of an i386 kernel!)
   
        pseudo-device   raid   4       # RAIDframe disk device
   
    Setting up RAID on some operating systems is confusing and painful to say
    the least. Not so with RAIDframe. Read the raid(4) and raidctl(8) man pages
    to get full details. There are many options and possible configurations
    available, and a detailed explanation is beyond the scope of this document.

11.2.3 - Filesystem Buffer

    For fileservers with memory to spare, you can increase BUFCACHEPERCENT.
    That is, what percentage of your RAM should you use as a file system
    buffer. This option may change when the Unified Buffer Cache is completed
    and is part of OpenBSD. In the mean time, to increase BUFCACHEPERCENT, you
    should add a line to your kernel configuration like this:

    option BUFCACHEPERCENT=30

    Of course you can make it as low as 5 percent (the default) or as high as
    50 percent (or more.)

11.2.4 - Soft updates

    Another tool that can be used to speed up your system is softupdates. One
    of the slowest operations in the traditional BSD file system is updating
    metainfo (which happens, among other times, when you create or delete files
    and directories.) Softupdates attempts to update metainfo in RAM instead of
    writing to the hard disk each and every single metainfo update. Another
    effect of this is that the metainfo on disk should always be complete,
    although not always up to date. So, a system crash should not require fsck
    (8) upon boot up, but simply a background version of fsck that makes
    changes to the metainfo in RAM (a la softupdates). This means rebooting a
    server is much faster, as you don't have to wait for fsck! (OpenBSD does
    not have this feature yet.) You can read more about softupdates in the 
    Softupdates FAQ entry.

11.2.5 - Size of the namei() cache

    Note: previously, the options(4) manual page recommended to set the NVNODE=
    integer kernel option. This is no longer recommended; you should now use
    the sysctl(8) command instead.
   
    The name-to-inode translation (a.k.a., namei()) cache controls the speed of
    pathname to inode(5) translation. By default, this cache has NPROC * (80 +
    NPROC / 8) entries. NPROC is set to 20 + 16 * MAXUSERS; see the config(8)
    manual page for an explanation on the maxusers kernel configuration
    parameter. A reasonable way to derive a value for the cache, should a large
    number of namei() cache misses be noticed with a tool such as systat(1), is
    to examine the system's current computed value with sysctl(8), (which calls
    this parameter "kern.maxvnodes") and to increase this value until either
    the namei() cache hit rate improves or it is determined that the system
    does not benefit substantially from an increase in the size of the namei()
    cache. After the value has been determined, you can set it at system
    startup time with sysctl.conf(5).

11.4 - Hardware choices

(Note- this section is heavily centered around the i386, or PC, architecture.
That is to say... other architectures don't give you quite as many choices!)

The performance of your applications depends heavily on your OS and the
facilities it provides. This may be part of the reason that you are using
OpenBSD. The performance of your applications also depends heavily on your
hardware. For many folks, the Price/Performance ratio of a brand new PC with a
Intel Pentium IV or AMD Athlon processor is much better than the Price/
Performance ratio of a Sun UltraSparc 60! Of course, the price of OpenBSD can't
be beaten.
d11495 1
a11495 7
If you are shopping for a new PC, whether you are buying it piece by piece or
completely pre-built, you want to make sure first that you are buying reliable
parts. In the PC world, this is not easy. Bad or otherwise unreliable or
mismatched parts can make OpenBSD run poorly and crash often. The best advice
we can give is to be careful, and buy brands and parts that have been reviewed
by an authority you trust. Sometimes, when you skimp on the price of a PC, you
lose in quality!
d11497 1
a11497 2
There are certain things that will help bring out the maximum performance of
your hardware:
d11499 5
a11503 56
  * Use multiple disks. Instead of buying one 20GB disk, buy multiple 9GB
    disks. While this may cost more, distributing the load over multiple
    spindles will decrease the amount of time necessary to access data on the
    disks. And, with more spindles, you will get more reliability and faster
    data access with RAID.
   
  * Use SCSI if you need very high disk IO speeds. IDE disks normally run at
    5400 RPM to 7200 RPM. Using high end IDE disks, it may be unreasonable to
    expect more than 15 to 20 megabytes per second of throughput from a single
    disk. Using high end SCSI disks (higher cost 10k RPM to 15k RPM disks), you
    can achieve performance higher than this. Conversely, if you are using
    medium or low end SCSI disks, this is a waste of money, and IDE will serve
    you just as well, if not better.
   
    If you are building a server, and you need more than 20GB of disk space,
    you may want to consider SCSI. IDE limits you to two disks per controller.
    Concurrent access to these two disks may have a negative impact on the I/O
    performance of these disks. Wide SCSI limits you to 15 per controller, and
    has better support for concurrent access than IDE. While SCSI costs more,
    the flexibility and performance can justify these costs in some
    environments.
   
  * Use SDRAM instead of DRAM. This option applies mainly to PCs. Most other
    architectures don't give you a choice of what kind of RAM you can use.
    Several PCs still do. You will get better performance with SDRAM versus
    DRAM (SIMMs). If your system supports RDRAM, DDR or some other new type of
    RAM, then you are even further ahead...
   
  * Use ECC or parity RAM. Parity adds some functionality to see if the data in
    RAM has been corrupted. ECC extends this functionality and attempts to
    correct some bit corruption errors on the fly. This option applies mainly
    to PCs. Most other architectures simply require parity or ECC capable RAM.
    Several non-PC computers won't even boot with non-parity RAM. If you aren't
    using ECC/parity RAM, you may get data corruption and other abnormalities.
    Several manufacturers of "cheap PC RAM" don't even make an ECC variety!
    This will help you avoid them! PC manufacturers often sell several product
    lines, divided around "servers" and "workstations." The servers will
    incorporate ECC RAM into their architecture. Unix workstation manufacturers
    have been using parity (and now ECC) for several years in all of their
    product lines.
   
  * Avoid ISA devices. While most folks avoid ISA devices because they are
    generally hard to configure and out of date, there are still plenty in
    existence. If you are using the ISA bus for your disk or network
    controllers, (or even worse, for both) remember that the ISA bus itself can
    be a performance bottleneck. If you need speed, look into PCI. Of course,
    there are still several ISA bus cards that work just fine. Unfortunately,
    most of these are sound cards and serial port cards.
   
  * Avoid cheap PCI network adapters. OpenBSD supports a plethora of cheap PCI
    network adapters. These adapters work great in home systems, and also low
    or moderate throughput business and research environments. But, if you need
    high throughput and low impact on your server, you are better off buying a
    quality PCI network adapter. Unfortunately, some expensive brand adapters
    (such as the 3com XL series) are not much better than the cheap adapters.
    One favourite 10/100Mbps adapter is the Intel EtherExpress PRO/100.
d11505 1
a11505 1
11.5 - Why aren't we using async mounts?
d11507 5
a11511 5
Question: "I simply do "mount -u -o async /" which makes one package I use
(which insists on touching a few hundred things from time to time) usable. Why
is async mounting frowned upon and not on by default (as it is in some other
unixen)? Isn't it a much simpler, and therefore, a safer way of improving
performance in some applications?"
d11513 3
a11515 12
Answer: "Async mounts is indeed faster than sync mounts, but they are also less
safe. What happens in case of a power failure? Or a hardware problem? The quest
for speed should not sacrifice the reliability and the stability of the system.
Check the man page for mount(8)."
             async   All I/O to the file system should be done asynchronously.
                     This is a dangerous flag to set since it does not guaran-
                     tee to keep a consistent file system structure on the
                     disk.  You should not use this flag unless you are pre-
                     pared to recreate the file system should your system
                     crash.  The most common use of this flag is to speed up
                     restore(8) where it can give a factor of two speed in-
                     crease.
d11517 1
a11517 6
On the other hand, when you are dealing with temp data that you can recreate
from scratch after a crash, you can gain speed by using a separate partition
for that data only, mounted async. Again, do this only if you don't mind the
loss of all the data in the partition when something goes wrong. For this
reason, mfs(8) partitions are mounted asynchronously, as they will get wiped
and recreated on a reboot anyway.
d11519 2
a11520 1
11.6 - Tuning your monitor resolution under XFree86
d11522 5
a11526 31
Getting an X server working at an acceptable resolution with many multi-sync
monitors is possible. If anyone has tried to do this with the standard
xf86config or XF86Setup utilties, they probably didn't get the best possible
results. One of the more painful aspects is simply getting your monitor running
with your preferred resolution, and then getting the vertical scan rate set to
at least 72-75 Hz, a rate where the screen flicker is much less visible to
humans. Conversely, what if you are trying to set the vertical scan rate so it
is very low? You can set it at 50 Hz so that it can be captured on to video
without flicker, but the methods to do this are non-obvious with the standard
XFree86 tools and documentation.

Finally, at the resolutions many people normally use with inexpensive VGA
monitors (800x600, 1024x768, 1152x900, 1280x1024), it is possible (at least on
newer monitors) to use vertical scan rates of 85Hz and above, to achieve an
extremely clean, palatable picture. The XFree86 X server has a mechanism which
allows you to describe in detail the video mode you want to use, this is the
ModeLine. A ModeLine has four sections, a single number for the pixel clock,
four numbers for horizontal timings, four numbers for vertical timings, and an
optional section with a list of flags specifying other characteristics of the
mode (such as Interlace, DoubleScan, and more...See the XF86Config(5) manual
page for more ModeLine details.)

Generating a ModeLine is a black art... Luckily, there are several scripts
which can do this for you. One is Colas XFree86 ModeLine Generator. Another is 
The XFree86 Modeline Generator hosted at SourceForge, and there are several
others available on Freshmeat. Before you can use these ModeLine generators,
you need to figure out the vertical and horizontal sync limits for your
monitor. This is often documented in the manual, or on the manufacturer's web
site. If you can't find either of those, simply search the web for the monitor
make and model, several people have been kind enough to compile lists with this
information.
d11528 12
a11539 111
For example, say you have a Dell D1226H monitor. You searched in agony at
Dell's web site to find that it has a 30-95 kHz horizontal scan range, and a
50-160 Hz vertical scan range. Visit the ModeLine generator page, enter this
information. Next, you need to enter the minimum vertical scan rate you want.
Any rate at or above 72 Hz should generally have low visible flicker. As you go
higher, the clearer and crisper your screen image becomes.

With all of these bits of information, the script will generate a ModeLine for
every possible 4x3 resolution which your monitor can support, above the minimum
vertical scan rate which you enter. If someone enters the Dell specs above and
a 75 Hz vertical scan minimum, the script gives out something like the
following:
ModeLine "320x240" 20.07 320 336 416 448 240 242 254 280 #160Hz
ModeLine "328x246" 20.86 328 344 424 456 246 248 260 286 #160Hz
...
ModeLine "816x612" 107.39 816 856 1056 1136 612 614 626 652 #145Hz
ModeLine "824x618" 108.39 824 864 1064 1144 618 620 632 658 #144Hz
ModeLine "832x624" 109.38 832 872 1072 1152 624 626 638 664 #143Hz
...
ModeLine "840x630" 109.58 840 880 1080 1160 630 632 644 670 #141Hz
ModeLine "848x636" 110.54 848 888 1088 1168 636 638 650 676 #140Hz
...
ModeLine "1048x786" 136.02 1048 1096 1336 1432 786 788 800 826 #115Hz
ModeLine "1056x792" 136.58 1056 1104 1344 1440 792 794 806 832 #114Hz
ModeLine "1064x798" 137.11 1064 1112 1352 1448 798 800 812 838 #113Hz
...
ModeLine "1432x1074" 184.07 1432 1496 1816 1944 1074 1076 1088 1114 #85Hz
ModeLine "1576x1182" 199.86 1576 1648 2008 2152 1182 1184 1196 1222 #76Hz
ModeLine "1584x1188" 198.93 1584 1656 2016 2160 1188 1190 1202 1228 #75Hz

Now, this monitor claims to do 1600x1200 @@ 75 Hz, but the script does not say
this is within 75 Hz. So, if you really want exactly 1600x1200, go down a notch
with your minimum vertical rate... (Here, we go down to 70 Hz)
ModeLine "1592x1194" 197.97 1592 1664 2024 2168 1194 1196 1208 1234 #74Hz
ModeLine "1600x1200" 199.67 1600 1672 2032 2176 1200 1202 1214 1240 #74Hz
ModeLine "1608x1206" 198.65 1608 1680 2040 2184 1206 1208 1220 1246 #73Hz
ModeLine "1616x1212" 197.59 1616 1688 2048 2192 1212 1214 1226 1252 #72Hz
ModeLine "1624x1218" 199.26 1624 1696 2056 2200 1218 1220 1232 1258 #72Hz
ModeLine "1632x1224" 198.15 1632 1704 2064 2208 1224 1226 1238 1264 #71Hz
ModeLine "1640x1230" 199.81 1640 1712 2072 2216 1230 1232 1244 1270 #71Hz
ModeLine "1648x1236" 198.64 1648 1720 2080 2224 1236 1238 1250 1276 #70Hz

Here, we see the monitor really does 1600x1200 @@ 74 Hz when the dot clock
(bandwidth) is limited to 200MHz. Set the bandwidth according to the limits
defined by the monitor.

Once you have your ModeLines, put them into your /etc/XF86Config file. Comment
out the old ModeLines, so that you can use them again if the new ones don't
work. Next, choose what resolution you actually want to run at. First, figure
out if X is running in accelerated mode (which it does with most video cards),
so you know which "Screen" section of the XF86Config to modify. Or, just modify
all of the Screen sections.
Section "Screen"
   Driver          "Accel"
   Device          "Primary Card"
   Monitor         "Primary Monitor"
   DefaultColorDepth 32
   SubSection "Display"
      Depth        32
      Modes        "1280x1024" "1024x768"
   EndSubSection

The first resolution you see after the "Modes" keyword is the resolution that X
is going to start in. By pressing CTRL-ALT-KEYPAD MINUS, or CTRL-ALT-KEYPAD
PLUS, you can switch between any resolutions that you list here. According to
the section above, X will try to start in 32-bit color mode (via the
DefaultColorDepth directive, without it X will start in 8-bit color mode.) The
first resolution it will try to use is 1280x1024 (it follows the order of the
Modes line.) Note that "1280x1024" is just a label for the values in the
ModeLine.

Note that the ModeLine generator script has options to relax its timings for
older or smaller monitors, and also has the ability to provide ModeLines for
specific resolutions. Depending on the type of hardware you have, it may not be
very easy to use with the default options. If the picture is too tall, too
wide, or too small, or is shifted horizontally or vertically, and the controls
of the monitor aren't enough to correct its appearance, once can use xvidtune
(1) to adjust the ModeLine to better fit with the monitor's timings.

On most modern monitors, there is no fixed limit on the bandwidth, thus they
are often not listed anymore in the specs. What happens is that the more you go
up in bandwidth, the fuzzier the screen image becomes. So you may want to put
in the bandwidth of your card (also named "dotclock") to test (you cannot
damage your monitor this way), and go progressively down in BW down to have a
nice crisp image.

If this seems needlessly complex, that's because it is. XFree86 4.0 addresses
this, and makes this process much easier since it has several built-in modes
and is capable of reading back capabilities from "plug and play" monitors
through DDC and DDC2.

You can download the Colas XFree86 ModeLine Generator script at: http://
koala.ilog.fr/ftp/pub/Klone/. You need to grab the Klone interpreter, and
compile it. It is in the ports as lang/klone. The scripts exist under the
scripts directory in the Klone distribution. (The port installs them to /usr/
local/lib/klone/scripts.)

There are two versions of the script included, the first is a CGI version
identical to the web page above. The second is a non-CGI version which will
take your complete XF86Config file, decode the monitor specs that you entered
into xf86config/XF86Setup (Now, think, did you actually enter the specs for
your monitor or just choose generic ones?), and fix the existing ModeLines
accordingly.

[Back to Main Index] [To Section 10.0 - System Administration] [To Section 12.0
- For Advanced Users]

-------------------------------------------------------------------------------
[back] www@@openbsd.org
$OpenBSD: obsd-faq.txt,v 1.33 2003/01/05 19:29:10 nick Exp $
[OpenBSD]
d11541 5
a11545 1
12.0 - For Advanced Users
d11547 3
a11549 1
-------------------------------------------------------------------------------
d11551 12
a11562 1
Table of Contents
d11564 5
a11568 2
  * 12.1 - Forcing DMA access for IDE disks
  * 12.2 - Upgrading from various versions of OpenBSD via CVS.
d11570 11
a11580 1
-------------------------------------------------------------------------------
d11582 1
a11582 4
By advanced users, we mean to imply people who have a working knowledge of how
to use and administrate a Unix-like operating system. If you follow
instructions in this section without understanding what you are doing, you may
cause problems in the operation of your system.
d11584 2
a11585 1
12.1 - Forcing DMA access for IDE disks
d11587 1
a11587 2
With the PCI IDE code, your chipset may not be known. If so, you will get a
message like:
d11589 6
a11594 1
    pciide0: DMA, (unused)
d11596 1
a11596 3
If you get this message, you can try and force DMA mode by using 'flags 0x0001'
on your pciide entry in your kernel config file. That would look something like
this:
d11598 6
a11603 1
    pciide* at pci ? dev ? function ? flags 0x0001
d11605 4
a11608 26
After doing this, the pciide code will try to use DMA mode regardless of
whether or not it actually knows how to do so with your chipset. If this works,
and your system makes it through fsck and startup, it is likely that this will
work for good. If this does not work, and the system hangs or panics after
booting, then you can't use DMA mode (yet, until support is added for your
chipset). Note that if you find the documentation for your PCI-IDE controller's
chipset, this is a good start to fully supporting your chipset within the
PCI-IDE code. You can look on the manufacturer's website or call them. If your
PCI-IDE controller is part of your motherboard, figure out who manufactures the
chipset and pursue their resources!

Note that you will know that DMA support has been enabled if you see this
message:

    cd0(pciide0:1:0): using PIO mode 3, DMA mode 1

This means that pciide0, channel 1, drive 0 (which appears to be an ATAPI
CD-ROM) is using DMA data transfers.

[Back to Main Index] [To Section 11.0 - Performance Tuning] [To Section 13.0 -
IPsec]

-------------------------------------------------------------------------------
[back] www@@openbsd.org
$OpenBSD: obsd-faq.txt,v 1.33 2003/01/05 19:29:10 nick Exp $
[OpenBSD]
d11610 5
a11614 1
13.0 - Using IPsec (IP Security Protocol)
d11616 3
a11618 1
-------------------------------------------------------------------------------
d11620 1
a11620 1
Table of Contents
d11622 3
a11624 801
  * 13.1 - What is IPsec?
  * 13.2 - That's nice, but why do I want to use IPsec?
  * 13.3 - What are the protocols behind IPsec?
  * 13.4 - On the wire format
  * 13.5 - Configuring IPsec
  * 13.6 - How do I setup IPsec with manual keying?
  * 13.7 - How do I setup isakmpd?
  * 13.8 - How do I use isakmpd with X.509 certificates?
  * 13.9 - What IKE clients are compatible with isakmpd?
  * 13.10 - Troubleshooting IPsec/VPN
  * 13.11 - Related Documentation

Portions of this document were taken from:

  * ipsec(4)
  * vpn(8)
  * IPsec for Dummies by Julian Elischer
  * ISAKMP Howto by Patrick Ethier
  * X.509v3 certificates with isakmpd by Jrgen Granstam

-------------------------------------------------------------------------------

13.1 - What is IPsec?

IPsec is a set of extensions to the IP protocol family. It provides
cryptographic security services. These services allow for authentication,
integrity, access control, and confidentiality. IPsec provides similar services
as SSL, but at the network layer, in a way that is completely transparent to
your applications, and much more powerful. We say this because your
applications do not have to have any knowledge of IPsec to be able to use it.
You can use any IP protocol over IPsec. You can create encrypted tunnels
(VPNs), or just do encryption between computers. Since you have so many
options, IPsec is rather complex (much more so then SSL!)

Before you start using IPsec, we strongly recommend that you check out the
"recommended reading" of part 6 of the FAQ. In particular, if you don't already
understand it, the Understanding IP Addressing (or here) document is highly
recommended.

In a logical sense, IPsec works in any of these three ways:

  * Host-to-Host
  * Host-to-Network
  * Network-to-Network

In every scenario that involves a network, we mean to imply router. As in,
Host-to-Router (and this router controls and encrypts traffic for a particular
Network.)

As you can see, IPsec can be used to tunnel traffic for VPN connections.
However, its utility reaches beyond VPNs. With a central Internet Key Exchange
registry, every machine on the internet could talk to another one and employ
powerful encryption and authentication!

13.2 - That's nice, but why do I want to use IPsec?

The internet protocol, IP, aka IPv4, does not inherently provide any protection
to your transferred data. It does not even guarantee that the sender is who he
says he is. IPsec tries to remedy this. These services are considered distinct,
but the IPsec supports them in a uniform manner.

Confidentiality

Make sure it is hard for anyone but the receiver to understand what data has
been communicated. You do not want anyone to see your passwords when logging
into a remote machine over the Internet.

Integrity

Guarantee that the data does not get changed on the way. If you are on a line
carrying invoicing data you probably want to know that the amounts and account
numbers are correct and not altered while in-transit.

Authenticity

Sign your data so that others can see that it is really you that sent it. It is
clearly nice to know that documents are not forged.

Replay protection

We need ways to ensure a transaction can only be carried out once unless we are
authorized to repeat it. I.e. it should not be possible for someone to record a
transaction, and then replaying it verbatim, in order to get an effect of
multiple transactions being received by the peer. Consider the attacker has got
to know what the traffic is all about by other means than cracking the
encryption, and that the traffic causes events favorable for him, like
depositing money into his account. We need to make sure he cannot just replay
that traffic later. WARNING: as per the standards specification, replay
protection is not performed when using manual-keyed IPsec (e.g., when using 
ipsecadm(8)).

13.3 - What are the protocols behind IPsec?

IPsec provides confidentiality, integrity, authenticity, and replay protection
through two new protocols. These protocols are called AH, Authentication
header, and ESP, Encapsulated security payload.

AH provides authentication, integrity, and replay protection (but not
confidentiality). Its main difference with ESP is that AH also secures parts of
the IP header of the packet (like the source/destination addresses).

ESP can provide authentication, integrity, replay protection, and
confidentiality of the data (it secures everything in the packet that follows
the header). Replay protection requires authentication and integrity (these two
go always together). Confidentiality (encryption) can be used with or without
authentication/integrity. Similarly, one could use authentication/integrity
with or without confidentiality.

13.4 - On the wire format

The Authentication Header (AH) comes after the basic IP header and contains
cryptographic hashes of the data and identification information. The hashes can
also cover the invariant parts of the IP header itself. There are several
different RFCs giving a choice of actual algorithms to use in the AH, however
they all must follow the guidelines specified in RFC2402.

The Encapsulating Security Payload (ESP) header, allows for rewriting of the
payload in encrypted form. The ESP header does not consider the fields of the
IP header before it and therefore makes no guarantees about anything except the
payload. The various types of ESP applicable must follow RFC2406. An ESP header
can also provide authentication for the payload, (but not the outer header).

An orthogonal (mostly) division of IPsec functionality is applied depending on
whether the endpoint doing the IPsec encapsulation is the original source of
the data or a gateway:

  * Transport mode is used by a host that is generating the packets. In
    transport mode, the security headers are added before the transport layer
    (e.g . TCP, UDP) headers, before the IP header is prepended to the packet.
    In other words an AH added to the packet will cover the hashing of the TCP
    header and some fields of the end-to-end IP header, and an ESP header will
    cover the encryption of the TCP header and the data, but not the end-to-end
    IP header.
  * Tunnel mode is used when the end-to-end IP header is already attached to
    the packet, and one of the ends of the secure connection is only a gateway.
    In this mode, the AH and ESP headers are used to cover the entire packet
    including the end-to-end header, and a new IP header is prepended to the
    packet that covers just the hop to the other end of the secure connection
    (though that may of course be several IP hops away).

IPsec secured links are defined in terms of Security Associations (SAs). Each
SA is defined for a single unidirectional flow of data, and usually (ignoring
multicast) from one single point to another, covering traffic distinguishable
by some unique selector. All traffic flowing over a single SA is treated the
same. Some traffic may be subject to several SAs, each of which applies some
transform. Groups of SAs are called an SA Bundle. Incoming packets can be
assigned to a particular SA by the three defining fields, (Destination IP
address, Security Parameter Index, security protocol). SPI can be considered a
cookie that is handed out by the receiver of the SA when the parameters of the
connection are negotiated. The security protocol must be either AH or ESP.
Since the IP address of the receiver is part of the triple, this is a
guaranteed unique value. They can be found from the outer IP header and the
first security header (which contains the SPI and the security protocol).

An example of a tunnel mode AH packet is:

+---------------------------+
|IPhdr|AH|IPhdr2|TCPhdr|data|
+---------------------------+

An example of a transport mode AH packet is:

+---------------------+
|IPhdr|AH|TCPhdr |data|
+---------------------+

Because an ESP header cannot authenticate the outer IP header, it is useful to
combine an AH and an ESP header to get the following:

+-------------------------+
|IPhdr|AH|ESP|TCPhdr |data|
+-------------------------+

This is called Transport Adjacency. The tunneling version would look like:

+-------------------------------+
|IPhdr|AH|ESP|IPhdr2|TCPhdr|data|
+-------------------------------+

However it is not specifically mentioned in the RFC. As with Transport
adjacency, this would authenticate the entire packet except a few headers in
the IP header and also encrypt the payload (seen in italics). When an AH and an
ESP header are directly applied together like this, the order of the headers
should be as shown. It is possible in tunnel mode, to do arbitrary recursive
encapsulation so that order is not specified.

13.5 - Configuring IPsec

How the IPsec systems and gateways are configured is to some extent left to the
designer, however the RFC has some strong recommendations as to how this should
be implemented, so as to minimize confusion.

There are two administrative entities that control what happens to a packet.
One is the Security Association Database (SAD, referred to as TDB or TDB table
throughout OpenBSD's IPsec source code) and the other is the Security Policy
Database (SPD).

They are similar in that given a number of selectors that describe some
traffic, they will deliver an entry that describes the processing needed.
However, the SPD is two steps removed from the actual processing: the SPD is
used for outgoing packets, to decide what SAD entries should be used, and the
SAD entries in turn describe the actual process and the parameters for it. The
SPD entries specify the existing SAD entries to use (if it's a bundle there can
be more than 1), but if there is not already a suitable one, it is used to
create new ones. The fields of the SA being created can be taken either from
the SPD entry or from the packet that initiated the creation.

Outgoing packets go from the SPD entry to the specific SA, to get encoding
parameters. Incoming packets get to the correct SA directly using the SPI/
DestIP/Proto triple, and from there get to the SPD entry.

The SPD can also specify what traffic should bypass IPsec and what should be
dropped, so it must also be consulted for incoming non-IPsec traffic. SPD
entries must be explicitly ordered as several might match a particular packet,
and the processing must be reproducible.

The SPD can be thought of as similar to a packet filter where the actions
decided upon are the activation of SA processes. Selectors can include src and
dest address, port numbers if relevant, application and user IDs if available
(only on host based transport SAs), hostnames, security sensitivity levels,
protocols, etc.

A SAD entry would include:

  * Dest IP address
  * IPsec proto (AH or ESP)
  * SPI (cookie)
  * Sequence counter
  * Seq O/F flag
  * Anti-replay window info
  * AH type and info
  * ESP type and info
  * Lifetime info
  * Tunnel/transport mode flags
  * Path MTU info

A SPD entry would contain:

  * Pointer to active SAs
  * Selector fields

Each SA can define one ESP header and one AH header. An IPsec session must have
one or the other or both, but cannot be defined with neither - otherwise there
would be no headers to specify the SPI to look up the SA. The RFC doesn't say
what would happen if the AH and ESP headers disagree about the SPI value. One
would presume this would imply multiple SAs in a bundle.

The SPD in OpenBSD is managed through the ipsecadm flow command. (You would
only make changes to it if you were using manual keying.) SAD entries can be
set manually with ipsecadm(8), however the IETF has also defined automatic
mechanisms for initialization of sessions and such things as key exchange.
OpenBSD implements ISAKMP automatic key exchange (RFC2407, RFC2408, and RFC2409
) in the isakmpd(8) daemons.

13.6 - How do I setup IPsec with manual keying?

Manual keying is the easiest way to get started with IPsec. You can setup
encryption between networks, to create VPNs using this method. After you have
read this section, you may want to investigate using /usr/share/ipsec/rc.vpn to
set this up for you automatically.

First, you need to turn on IP AH and IP ESP options in the OpenBSD kernel (if
you are only using ESP, such as with the rc.vpn script, or as with the example
below, then you do not need to enable AH. In fact, there may even be security
concerns related to enabling AH if you are not using it).

There is a nice sysctl to enable these protocols.

    # sysctl -w net.inet.esp.enable=1
    net.inet.esp.enable: 0 -> 1
    # sysctl -w net.inet.ah.enable=1
    net.inet.ah.enable: 0 -> 1

You can edit /etc/sysctl.conf to turn these on at boot time. You need to remove
the # mark from in front of net.inet.esp.enable and/or net.inet.ah.enable
(depending on which you plan to use) and make sure they are set to 1.

You also need to generate your manual keys. Since the security of the VPN is
based on these keys being unguessable, it is very important that the keys be
chosen using a strong random source. One practical method of generating them is
by using the random(4) device. To produce 160 bits of randomness, for example,
do:

    # dd if=/dev/urandom bs=1024 count=1 | sha1

The number of bits produced is important. Different cipher types may require
different sized keys.
Cipher    Key Length
DES       56 bits
3DES      168 bits
BLF       Variable (160 bits recommended)
CAST      Variable (40-128 bits recommended)
SKIPJACK  80 bits

Now, you need to setup SAs, or Security Associations. A Security Association is
a combination of your IP addresses, an SPI, and your security protocol (AH and/
or ESP). The IP addresses are both your own and that of your destination. The
SPI, or Security Parameter Index, is a number that OpenBSD uses to classify
different SAs.

These examples only use ESP to encrypt your traffic. ESP includes
authentication of the contained encrypted data, but does not authenticate the
surrounding IP header, as AH would. This "limited authentication" is
nevertheless quite sufficient in most cases, especially for ESP in a tunnel
environment.

    # ipsecadm new esp -spi SPI_OUT -src MY_EXTERNAL_IP -dst PEER_EXTERNAL_IP
    -forcetunnel -enc blf -auth sha1 -key ENC_KEY -authkey AUTH_KEY

Let's put this into practice with two routers, 192.168.5.1 and 192.168.25.9.

On Host 192.168.5.1:

    # ipsecadm new esp -spi 1000 -src 192.168.5.1 -dst 192.168.25.9
    -forcetunnel -enc blf -auth sha1 -key
    7762d8707255d974168cbb1d274f8bed4cbd3364 -authkey
    6a20367e21c66e5a40739db293cf2ef2a4e6659f
    # ipsecadm new esp -spi 1001 -dst 192.168.5.1 -src 192.168.25.9
    -forcetunnel -enc blf -auth sha1 -key
    7762d8707255d974168cbb1d274f8bed4cbd3364 -authkey
    6a20367e21c66e5a40739db293cf2ef2a4e6659f

On Host 192.168.25.9:

    # ipsecadm new esp -spi 1001 -src 192.168.25.9 -dst 192.168.5.1
    -forcetunnel -enc blf -auth sha1 -key
    7762d8707255d974168cbb1d274f8bed4cbd3364 -authkey
    6a20367e21c66e5a40739db293cf2ef2a4e6659f
    # ipsecadm new esp -spi 1000 -dst 192.168.25.9 -src 192.168.5.1
    -forcetunnel -enc blf -auth sha1 -key
    7762d8707255d974168cbb1d274f8bed4cbd3364 -authkey
    6a20367e21c66e5a40739db293cf2ef2a4e6659f

Notice that the SPIs are different. See On the wire format for a complete
description of what the SPI is and where it is used.

Now that you have your Security Associations in place, set up your flows.

On 192.168.5.1:

So, right here, two flows will be created, one the local source address, which
covers all packets originating from the local host to the destination, as well
as a flow from the destination back to the local host.

    # ipsecadm flow -proto esp -dst 192.168.25.9 -spi 1000 -addr 192.168.5.1
    255.255.255.255 192.168.25.9 255.255.255.255

On 192.168.25.9:

    # ipsecadm flow -proto esp -dst 192.168.5.1 -spi 1001 -addr 192.168.25.9
    255.255.255.255 192.168.5.1 255.255.255.255

If you want less overhead on your Host-to-Host VPNs, creating the SPI without
-forcetunnel will let you use transport mode (whereas, -forcetunnel makes sure
all of the IP packet, including the IP header, are encapsulated by SPI). If
either the source or destination is a network, you will have to use tunnel
mode. Creating an SA to and/or from a network will automatically ensure tunnel
mode SPIs are being created.

This is a simple way to start using IPsec.

You can use IPsec to tunnel private IP address spaces over the Internet. Here
is a good example... We want to tunnel 192.168.99.0/24, which is behind
208.1.1.1, to 208.1.2.0/24 and 208.1.5.0/24 which are behind 208.2.2.2. These
examples were generated using the rc.vpn script.

As you can see, when you are using manual keying with IPsec, you have to
specify exactly what you want done. It won't guess for you. Look at these
examples...

On 208.1.1.1:

First, set up the security associations (SAs):
(This sets up the SPIs, encryption methods, and keys.)

    # ipsecadm new esp -src 208.1.1.1 -dst 208.2.2.2 -forcetunnel -spi 1001
    -enc blf -auth sha1 -key 7762d8707255d974168cbb1d274f8bed4cbd3364 -authkey
    67e21c66e5a40739db293cf2ef2a4e6659f
    # ipsecadm new esp -src 208.2.2.2 -dst 208.1.1.1 -forcetunnel -spi 1000
    -enc blf -auth sha1 -key 7762d8707255d974168cbb1d274f8bed4cbd3364 -authkey
    67e21c66e5a40739db293cf2ef2a4e6659f

Next, setup a flow from 208.1.1.1 to 208.2.2.2

    # ipsecadm flow -proto esp -dst 208.2.2.2 -spi 1001 -addr 208.1.1.1
    255.255.255.255 208.2.2.2 255.255.255.255

Next, setup a flow from 208.1.2.0/24, which is behind 208.2.2.2, to
192.168.99.0/24

    # ipsecadm flow -proto esp -dst 208.2.2.2 -spi 1001 -addr 192.168.99.0
    255.255.255.0 208.1.2.0 255.255.255.0

Next, setup a flow from 208.1.5.0/24, which is behind 208.2.2.2, to
192.168.99.0/24

    # ipsecadm flow -proto esp -dst 208.2.2.2 -spi 1001 -addr 192.168.99.0
    255.255.255.0 208.1.5.0 255.255.255.0

Now, setup a flow from 208.1.2.0/24, which is behind 208.2.2.2 to the router
208.1.1.1.

    # ipsecadm flow -proto esp -dst 208.2.2.2 -spi 1001 -addr 208.1.1.1
    255.255.255.255 208.1.2.0 255.255.255.0

OK, setup a flow from 208.1.5.0/24, which is behind 208.2.2.2, to the router
208.1.1.1

    # ipsecadm flow -proto esp -dst 208.2.2.2 -spi 1001 -addr 208.1.1.1
    255.255.255.255 208.1.5.0 255.255.255.0

Finally, setup a flow from the router 208.2.2.2 to 192.168.99.0/24

    # ipsecadm flow -proto esp -dst 208.2.2.2 -spi 1001 -addr 192.168.99.0
    255.255.255.0 208.2.2.2 255.255.255.255

On 208.2.2.2:

Same as before, we setup the SAs...

    # ipsecadm new esp -src 208.2.2.2 -dst 208.1.1.1 -forcetunnel -spi 1000
    -enc blf -auth sha1 -key 7762d8707255d974168cbb1d274f8bed4cbd3364 -authkey
    67e21c66e5a40739db293cf2ef2a4e6659f
    # ipsecadm new esp -src 208.1.1.1 -dst 208.2.2.2 -forcetunnel -spi 1001
    -enc blf -auth sha1 -key 7762d8707255d974168cbb1d274f8bed4cbd3364 -authkey
    67e21c66e5a40739db293cf2ef2a4e6659f

Now, this is the reverse side... Setup a flow from the router 208.2.2.2 to
208.1.1.1

    # ipsecadm flow -proto esp -dst 208.1.1.1 -spi 1000 -addr 208.2.2.2
    255.255.255.255 208.1.1.1 255.255.255.255

Setup a flow from the network 192.168.99.0/24, which is behind 208.1.1.1, to
208.1.2.0/24

    # ipsecadm flow -proto esp -dst 208.1.1.1 -spi 1000 -addr 208.1.2.0
    255.255.255.0 192.168.99.0 255.255.255.0

Setup a flow from the network 192.168.99.0/24, which is behind 208.1.1.1, to
208.1.5.0/24

    # ipsecadm flow -proto esp -dst 208.1.1.1 -spi 1000 -addr 208.1.5.0
    255.255.255.0 192.168.99.0 255.255.255.0

Now, setup a flow from 192.169.99.0/24, which is behind 208.1.1.1, to the
router 208.2.2.2

    # ipsecadm flow -proto esp -dst 208.1.1.1 -spi 1000 -addr 208.2.2.2
    255.255.255.255 192.168.99.0 255.255.255.0

We're almost done... Two flows left to get 208.1.2.0/24 and 208.1.5.0/24 from
the router 208.2.2.2 to the router 208.1.1.1.

    # ipsecadm flow -proto esp -dst 208.1.1.1 -spi 1000 -addr 208.1.2.0
    255.255.255.0 208.2.2.2 255.255.255.255 -ingress
    # ipsecadm flow -proto esp -dst 208.1.1.1 -spi 1000 -addr 208.1.5.0
    255.255.255.0 208.2.2.2 255.255.255.255 -ingress

If you have been using ipsecadm, and you want to get rid of any work that
you've done, and start from scratch, do

    # ipsecadm flush

This will flush all IPsec info (SPIs, flows, routing entries) from your system.

13.7 - How do I setup isakmpd?

If you are thinking about VPNs or other traditional applications of IPsec, you
probably are going to use ISAKMP. Some commercial implementations of IPsec do
not provide any manual keying ability, instead they require you to use some
form of ISAKMP.

13.7.1 - What is isakmpd?

ISAKMP (sometimes referred to as IKE, or Internet Key Exchange) is the key
exchange mechanism for the VPN. It meets security concerns using the methods
mentioned in RFC 2407, RFC 2408 and RFC 2409. ISAKMP manages the exchange of
cryptographic keys that you would normally have to manage with ipsecadm(8). It
employs a two-phase process for establishing the IPsec parameters between two
IPsec nodes.

Phase 1 - The two ISAKMP peers establish a secure, authenticated channel upon
which to communicate between two daemons. This establishes a Security
Association (SA) between both hosts. Main Mode and Aggressive Mode are the
methods used to establish this channel. Main Mode sends the various
authentication information in a certain sequence, providing identity
protection. Aggressive Mode does not provide identity protection because all of
the authentication information is sent at the same time. Aggressive mode should
only be used in such cases where network bandwidth is of concern.

Phase 2 - Security Associations are negotiated on behalf of IPsec. Phase 2
establishes tunnels or endpoint SAs between IPsec hosts. Quick Mode is used in
Phase 2 because there is no need to repeat a full authentication; Phase 1 has
already established the SAs.

In brief, Phase 1 is used to get a secure channel in which to do the (quicker)
phase 2 setups. There can be multiple phase 2 setups within the same phase 1
channel. Phase 2 is used to setup the actual tunnels. In Phase 1, your IPsec
nodes establish a connection where they exchange authentication (Either a X.509
certificate or a pre-shared secret). This allows each end to make sure the
other end is authenticated. Phase 2 is an exchange of keys to determine how the
data between the two will be encrypted.

13.7.2 - How do I get started with isakmpd?

By default, OpenBSD comes with the proper binaries for ISAKMP and the IPsec
stack. Unfortunately, the same cannot be said for the sample files. To retrieve
them, you need to grab: /usr/src/sbin/isakmpd/samples/VPN-east.conf and /usr/
src/sbin/isakmpd/samples/policy from the source tree. You can either use your
CD (if you have one), cvsweb, or the command line CVS client. (Cvsweb has 
VPN-east.conf and policy readily available). For the purposes of this example,
copy policy to /etc/isakmpd/isakmpd.policy. Copy VPN-east.conf to /etc/isakmpd/
isakmpd.conf. Here we attempt to show you how to setup a VPN (tunnel). If you
want to use isakmpd between single hosts, there are other configuration files
in the samples directory. The manual pages have detailed information.. Don't
forget isakmpd.conf(5) and isakmpd.policy(5).

Your first step is to turn on esp. The top of the FAQ section on Manual Keying
tells you how to do this both for run-time and boot. Next, you need to edit /
etc/isakmpd/isakmpd.policy. This file tells ISAKMP who can access IPsec. In
this scenario, the policy file states that anybody who sends data using
Encapsulate Security Payload(ESP), and has authenticated with the passphrase
mekmitasdigoat (or whatever passphrase you determine), is allowed to
communicate with isakmpd. You can modify this file to let ISAKMP know that we
only want to allow data signed with certain digital certificates or using a
certain encryption transform. You could also allow anybody to access IPsec.
This is only recommended for testing. To do this, edit your policy file to
contain only the following lines:

    KeyNote-Version: 2
    Authorizer: "POLICY"

The same policy file contains two lines that start with the $ character. You
need to remove these lines before using it, they are only for cvs.

A more useful policy file for this example looks like this:

    KeyNote-Version: 2
    Comment: This policy accepts ESP SAs from a remote that uses the right password
    Authorizer: "POLICY"
    Licensees: "passphrase:mekmitasdigoat"
    Conditions: app_domain == "IPsec policy" &&
                esp_present == "yes" -> "true"; 

Implementing this will give you a basic VPN (tunnel) using ESP only. On host A,
edit /etc/isakmpd/isakmpd.conf. The 249.2.2.2 sample IP address should be
replaced with the external IP address of host A.

    [General] 
    Retransmits=                5
    Exchange-max-time=  120
    Listen-on=          249.2.2.2

Do similar for isakmpd.conf on host B. 249.3.3.3 represents the external IP
address for host B.

    [General]
    Retransmits=                5
    Exchange-max-time=  120
    Listen-on=          249.3.3.3

This is where you can setup the variables that will affect the main behavior of
isakmpd. It is okay to use the defaults here. The Listen-on= value specifies
the IP that isakmpd should listen on. Only the Internet IP of your gateway is
necessary. If you have multiple external interfaces on your gateway, you could
list which interfaces you want to listening on by entering them using a comma
separated list.

Next, on host A, edit isakmpd.conf again.

    [Phase 1]
    249.3.3.3=          HostB

On host B:

    [Phase 1]
    249.2.2.2=          HostA

This section describes the IP addresses to accept in order to negotiate the
phase 1 connection. Its value points to the section below (Remember that phase
1 simply authenticates the remote peer to make sure they are who they say they
are). You can list multiple peers with additional lines in the format of
IP_Address= <PEER-NAME>.

Next, on host A:

    [Phase 2]
    Connections=                HostA-HostB

On host B:

    [Phase 2]
    Connections=                HostB-HostA

This describes Phase 2 of the connection. This is the phase that determines
what protocols the two peers will use to communicate.

The Connections= tag refers to the section below. It initiates the requirements
or the accepted methods to set up Phase 2. This also tells ISAKMPD which
connections to initiate once started. Note that you can have multiple sections
as illustrated below if you are to connect with multiple peer hosts.

If you do not have the IP address of the remote host, you can specify a Default
= that points to a section describing a generic entry that will be referenced
by any incoming IP that is not listed in the Connections= tag.

On host A:

    [HostB]
    Phase=                      1
    Transport=          udp
    Local-address=              249.2.2.2
    Address=            249.3.3.3
    Configuration=              Default-main-mode
    Authentication=             mekmitasdigoat
    #Flags=

On host B:

    [HostA]
    Phase=                      1
    Transport=          udp
    Local-address=              249.3.3.3
    Address=            249.2.2.2
    Configuration=              Default-main-mode
    Authentication=             mekmitasdigoat
    #Flags=

These represent the sections referred to by the Phase 1 section above. They
each describe the requirements that the peer gateway must fulfill in order to
proceed to Phase 2. There are many other options here but the ones mentioned
above are the minimum requirements.

  * Phase=1 is required because the ISAKMPD code uses the same procedures to
    process Phase 1 and Phase 2. It must be 1 or nothing will work.
  * Transport= gives you different possibilities for different peers. It's
    suggested that udp be used here so we'll leave it at that. Please note that
    some peers may be behind a firewall that doesn't let UDP traffic through.
    Obviously, this needs to be determined before setup.
  * Local-address is the destination address that the incoming packets point
    to. In some cases, you can be listening on different Interfaces for Phase 1
    connections. In this example, there is only 1 interface listening,
    therefore this is the IP of the listening interface on this peer.
  * Address= is the address that points to the source IP of the incoming
    packets. This usually points to the peer gateway. This needs further
    explanation, because the source IP address of the peer may be unknown!
  * Configuration= points to the section below. You can specify multiple
    sections like this. We use the default one specified by the sample file.
  * Authentication= is the pre-shared secret to be used for this particular
    peer. It is more or less a passphrase that each peer uses. This passphrase
    gets passed to policy to verify whether this peer is allowed to use IPSEC
    with this host. If you change this phrase, you must also change it in the
    policy file because the sample file provides for this passphrase. If you
    decided to go with a minimum policy file then you can specify whatever you
    want here.
  * Flags= is not currently being used. The RFCs leave room for extra options
    to be specified for phase 1.
   
    There are other tags here that will allow for other options to be set.
    Refer to isakmpd.conf(5) for descriptions.

On Host A:

    [HostA-HostB]
    Phase=                      2
    ISAKMP-peer=                HostB
    Configuration=              Default-quick-mode
    Local-ID=           Net-A
    Remote-ID=          Net-B

On Host B:

    [HostB-HostA]
    Phase=                      2
    ISAKMP-peer=                HostA
    Configuration=              Default-quick-mode
    Local-ID=           Net-B
    Remote-ID=          Net-A

These represent the sections referred to by the Phase 2 section above. They are
the individual settings that ISAKMPD must use to talk between the two gateways
for the particular connection.

  * Phase=2 is required because ISAKMPD code uses the same functions to
    authenticate Phase 1 and Phase 2. This is required for the VPN to work.
  * ISAKMPD-Peer= is the name of Host section above. This means that we are
    talking to that particular peer to establish a Phase 2 connection. This is
    provided because you can have multiple sections to describe isakmp peers
    and connections.
  * Configuration= refers to the section below that describes the standards by
    which this host and the particular peer for this connection must abide.
  * Local-ID= refers to an IPsec-ID section below that describes our Private
    Network to the peer gateway. This is the portion that is passed so that the
    other gateway can set up the proper routing table that will transfer data
    over the VPN to our network.
  * Remote-ID= refers to an IPsec-ID section below that describes what is
    supposed to be the remote Private Network to our host. This portion is
    interpreted to set up the proper routing tables that will transfer data
    from our Private Network over the VPN to the remote Private Network.
   
    There is another tag that is supported here called Flags=. If you require
    this tag, read isakmpd.conf(5).

This is the IPsec-ID section. These entries need to exist in the isakmpd.conf
files for both Host A and Host B. This example will setup 192.168.1.0/
255.255.255.0 for Host A (which was connected to Net-A above) and 192.168.20.0/
255.255.255.0 for Host B (Net-B above).

    [Net-A]
    ID-type=            IPV4_ADDR_SUBNET
    Network=            192.168.1.0
    Netmask=            255.255.255.0
    
    [Net-B]
    ID-type=            IPV4_ADDR_SUBNET
    Network=            192.168.20.0
    Netmask=            255.255.255.0

These two sections are in the conf file of each host. They are the sections
referenced by the Local-ID and Remote-ID identifiers. They describe the routes
that should be set up to allow traffic from one private network to another. 
ID-type= can be IPV4_ADDR_SUBNET or IPV4_ADDR (RFC2708 mentions more possible
values. Currently only IPv4 is supported in the OpenBSD implementation. IPv6
may be supported in OpenBSD-current. )

Now, on both hosts, the sample file should read:

    [Default-main-mode]
    DOI=                        IPSEC
    EXCHANGE_TYPE=              ID_PROT
    Transforms=         3DES-SHA

This section describes the requirements for the encryption methods of Phase 1
connections. The name reflects the value of Configuration= variable. As we can
see here, we are stating our Domain of Interest which is IPSEC. The 
EXCHANGE_TYPE variable is set to ID_PROT for Phase 1, which identifies the
protocols to be covered by this Authentication. Transforms= is the transform
required (or assigned) for this exchange. In this case, this points to the
section below in the configuration file that says we are receiving a packet
encrypted with 3DES and a checksum verifiable with SHA. There are a bunch of
different transforms defined inside the sample VPN-east.conf. These are
provided because 3DES and SHA are not always supported across different
platforms. For OpenBSD there should be no reason to change this for a basic
setup. Feel free to create multiples of this section and change the transform.
The only requirement is that you change the Configuration= variable.

    [Default-quick-mode]
    DOI=                        IPSEC
    EXCHANGE_TYPE=              QUICK_MODE
    Suites=                     QM-ESP-3DES-SHA-PFS-SUITE,QM-ESP-DES-MD5-PFS-SUITE

This section describes the requirements for the encryption of the data to be
sent through the VPN and is referred to by Configuration above. Note the
difference between this section and the Phase 1 equivalent just above is that
the EXCHANGE_TYPE is QUICK_MODE. This is always the case for Phase 2. Suites=
points to a IPsec Suite section describing the different encryption schemes
available between the two hosts. There is much more to be said about ISAKMP and
IPsec. By using the above basic descriptions you should be able to create a
simple but solid VPN that cares and feeds itself. This is the bare minimum 
isakmpd.conf for both hosts here.

13.7.3 - Starting isakmpd

You may wish to use

    # isakmpd -d -DA=99

the first time you decide to run this daemon. The daemon will not be running in
daemon mode but as a regular process. It will log everything to your terminal.
To stop isakmpd and flush the routes, you need to kill the isakmpd process on
each node, and run ipsecadm flush.

13.8 - How do I use isakmpd with X.509 certificates?

Setting up isakmpd to use certificates instead of pre-shared keys is not really
that much harder in a big network with many untrusted peers than it would be
with a small network. It may actually simplify configuration, and more
importantly, key management.

Generating certificates.

There is a good description of how to generate keys and certificates in the 
README.PKI file in the isakmpd source directory. You need to have a CA key, a
corresponding CA X.509 certificate, one private key for each computer on the
network that will use isakmpd and one X.509 certificate for each such key.

The X.509 certificates need to have a Subject Alternative Name (SubjectAltName)
extension describing the certificate holder. How to set a SubjectAltName
extension using certpatch for a certificate is also described in README.PKI for
the case of setting an IP address as the SubjectAltName. Using an IP address
here is also the default behaviour for isakmpd.

Certpatch also support using either a FQDN (Fully Qualified Domain Name) or a
UFQDN (User FQDN). An example of an FQDN might be www.openbsd.org, an example
of an UFQDN would be an email address. Something like Jorgen.Granstam@@abc.se
for example.

In this howto document I am going to use FQDNs as SubjectAltNames. Using IP
addresses would be a bit easier since that is the default behaviour of isakmpd
but it is not much of a difference as we soon will see.
d11626 4
a11629 2
To insert an FQDN SubjectAltName into a certificate one would do something like
this:
a11630 2
    $ /usr/sbin/certpatch -t fqdn -i home.mysite.se -k ca.key originalcert.crt
    newcert.crt
d11632 3
a11634 849
Here the ca.key is the private key of the CA, thus this can only be done by
whoever has access to the CA private key. The (fictional) home.mysite.se is the
FQDN to be inserted into the certificate. The originalcert.crt and newcert.crt
filenames may be the same name in which case the original file will be
overwritten by the new modified certificate.

Put the keys and certificates in the directories as described at the end of
README.PKI. The CA key (ca.key) should be kept in some safe place if the keys
are really to be seriously used.

Configuration of isakmpd

Lets now look at the /etc/isakmpd/isakmpd.conf configuration file. It was
originally taken from the example file in isakmpd.conf(5) but has been heavily
modified. I will also use a much shorter file here than the example file in the
man-page to make it easier to understand. I have also added some commenting
(some comments are left as in the isakmpd.conf(5)) and changed some names. None
of the domain names used here exist as far as I know.

Actually since everyone who reads this already has a working configuration for
the preshared keys case (see previous section) there won't be many surprises in
this file. I won't explain this in every detail, check isakmpd.conf(5) for
descriptions of the parts I don't comment on.

Let's assume our setup looks something like this

     one.mysite.se                                        one.worksite.se      
       192.168.1.2--+    10.0.0.1====/======10.0.0.2     +--192.168.2.2        
                           |  gw.mysite.se       gw.worksite.se |              
                           +--192.168.1.1         192.168.2.1---+              
     two.mysite.se |                                    | two.worksite.se      
        192.168.1.3--+                                    +--192.168.2.3       

That is, two networks that should be connected using an IPsec tunnel over an
otherwise insecure network. Ignore the fact that I am using IP addresses
reserved for private Internets here (RFC1918), I have to use something. I won't
explain how to use isakmpd in combination with NAT or similar (because I
haven't tried that myself).

Now, let's look at the configuration file. This is the file for the security
gateway gw.mysite.se:

    
    # *****************************************************************
    # ************* Start of the gw.mysite.se isakmpd.conf ************
    # *****************************************************************
    
    # A configuration sample for the isakmpd ISAKMP/Oakley (aka IKE) daemon.
    [General]
    Policy-File=            /etc/isakmpd/policy
    Retransmits=            5
    Exchange-max-time=      120
    Listen-on=              10.0.0.1
    
    
    # The name work-gw here is used just as a section name and a tag for
    # use in this configuration file below and need not actually be the 
    # real hostname or domain name of the peer (but it could be). The IP 
    # address however needs to be correct. Phase 1, as you might already
    # know, is to negotiate an ISAKMP security association (SA). There 
    # should of course be one IP and name for each peer we want to
    # communicate with.
    [Phase 1]
    10.0.0.2=               work-gw
    
    
    # Now phase 2 is negotiating IPsec SAs. As in phase 1, the name here
    # is a section name to be used later. Actually, it can be a comma
    # separated list of section names here. Thus if traffic from many
    # networks (or individual hosts) should be forwarded through this
    # tunnel, more section names would be added (and of course corresponding 
    # new sections further down). 
    [Phase 2]
    Connections=            work-gw-my-gw
    
    
    # Now, here are some parameters for the ISAKMP SA negotiations. Almost 
    # self documenting. The section name is from [Phase 1] above. The most 
    # interesting tag might be the ID tag. The ID tag is set to the name
    # of the section where the identity information about this host that 
    # will be presented to connecting peers, can be found. If the ID tag 
    # is not available, isakmpd will assume that it will identify itself 
    # using the IP address. You might also notice that there is no longer 
    # any authentication tag here in this configuration. The authentication
    # data is currently used only in the preshared key case. 
    [work-gw]
    Phase=                  1
    Transport=              udp
    Local-address=          10.0.0.1                # Local address
    Address=                10.0.0.2                # Peer address
    ID=                     my-ID
    Configuration=          Default-main-mode
    
    
    # This is the identity data. ID-type may also be IPV4_ADDR (the
    # default), IPV4_ADDR_SUBNET or UFQDN. The Name tag is used for 
    # FQDN and UFQDN, for IPV4_ADDR an Address tag would be used instead.
    # For IPV4_ADDR_SUBNET a Network and a Netmask tag would be used.  
    [my-ID]
    ID-type=                FQDN
    Name=                   gw.mysite.se
    
    
    # This is the section for the IPsec connection. The section name is
    # from the list in the [Phase 2] section above. The ISAKMP-peer is,
    # of course, the tag of our peer from section [Phase 1] above. The 
    # Local-ID and Remote-ID tags should be section names describing which
    # packages should be forwarded over the IPsec tunnel to the remote 
    # network.
    [work-gw-my-gw]
    Phase=                  2
    ISAKMP-peer=            work-gw
    Configuration=          Default-quick-mode
    Local-ID=               Net-west
    Remote-ID=              Net-east
    
    # Any packet originating from a computer on the network described
    # here... 
    [Net-west]
    ID-type=                IPV4_ADDR_SUBNET
    Network=                192.168.1.0
    Netmask=                255.255.255.0
    
    # ... and with a destination matching the network described here, 
    # will be encrypted and forwarded over the IPsec tunnel to the remote 
    # system. 
    [Net-east]
    ID-type=                IPV4_ADDR_SUBNET
    Network=                192.168.2.0
    Netmask=                255.255.255.0
    
    # Main mode descriptions
    
    
    # Here are the data for main mode. Using DES here for real purposes
    # is not very smart since DES is no longer considered a secure
    # encryption algorithm. 3DES is generally considered to have much better
    # security since it has enough bits in the key to be considered secure. 
    # Transforms is a list of tags describing main mode transforms. In 
    # this example we have only one.
    [Default-main-mode]
    DOI=                    IPSEC
    EXCHANGE_TYPE=          ID_PROT
    Transforms=             3DES-MD5
    
    
    # Certificates stored in PEM format
    # This is important when using certificates. The CA certificates should 
    # be in the CA-directory (but not the CA private key of course).
    # The Cert-directory should have at least the certificate for the
    # local host but other certificates are also allowed. The private key 
    # should be the private key of the local host. 
    [X509-certificates]
    CA-directory=           /etc/isakmpd/ca/
    Cert-directory=         /etc/isakmpd/certs/
    Private-key=            /etc/isakmpd/private/local.key
    
    # Main mode transforms
    ######################
    
    # Here is our main mode transform. The important thing here is to use
    # RSA_SIG as authentication method when using certificates. It is the
    # only method supported when using certificates so far. Commercial
    # entities in the US will thus have to wait until September 2000 to
    # use this due to the RSA patent. Luckily, I am not living in the US. 
    # Also important is the GROUP_DESCRIPTION tag. It must match the
    # GROUP_DESCRIPTION tag in the Quick mode transforms further down. 
    # The Life tag here could possibly be modified. The LIFE_60_SECS might 
    # be shorter than necessary for normal use. 
    
    [3DES-MD5]
    ENCRYPTION_ALGORITHM=   3DES_CBC
    HASH_ALGORITHM=         MD5
    AUTHENTICATION_METHOD=  RSA_SIG
    GROUP_DESCRIPTION=      MODP_1024
    Life=                   LIFE_60_SECS,LIFE_1000_KB
    
    # Quick mode description
    ########################
    
    [Default-quick-mode]
    DOI=                    IPSEC
    EXCHANGE_TYPE=          QUICK_MODE
    Suites=                 QM-ESP-3DES-MD5-PFS-SUITE
    
    # Quick mode protection suites
    ##############################
    # 3DES
    
    [QM-ESP-3DES-MD5-PFS-SUITE]
    Protocols=              QM-ESP-3DES-MD5-PFS
    
    # 3DES
    
    [QM-ESP-3DES-MD5-PFS]
    PROTOCOL_ID=            IPSEC_ESP
    Transforms=             QM-ESP-3DES-MD5-PFS-XF
    
    # Quick mode transforms
    
    # Don't forget. The GROUP_DESCRIPTION must match the GROUP_DESCRIPTION 
    # in main mode above. For forwarding packets between two networks (or
    # from a host to a network) we use TUNNEL mode. Between two hosts we
    # may also use TRANSPORT mode instead. 
    [QM-ESP-3DES-MD5-PFS-XF]
    TRANSFORM_ID=           3DES
    ENCAPSULATION_MODE=     TUNNEL
    AUTHENTICATION_ALGORITHM=       HMAC_MD5
    GROUP_DESCRIPTION=      MODP_1024
    Life=                   LIFE_60_SECS
    
    
    # As we know from the isakmpd.config manpage the LIFE_DURATION here is 
    # an offer value (60), a minimum acceptable value (45) and a maximum
    # acceptable value. The isakmpd.conf example has this set to 
    # 600,450/720 instead. That might be a better value for normal use.
    [LIFE_60_SECS]
    LIFE_TYPE=              SECONDS
    LIFE_DURATION=          60,45:72
    
    [LIFE_1000_KB]
    LIFE_TYPE=              KILOBYTES
    LIFE_DURATION=          1000,768:1536
    
    # *****************************************************************
    # ************* End of the gw.mysite.se isakmpd.conf **************
    # *****************************************************************

So far the configuration for the local system. The remote system is configured
just the same way only opposite. Thus only the first part of the isakmpd.conf
file differs. Let's just look at that first part of the isakmpd.conf file for
the security gateway gw.worksite.se:

    # *****************************************************************
    # ************* Start of the gw.worksite.se isakmpd.conf **********
    # *****************************************************************
    
    [General]
    Policy-File=            /etc/isakmpd/policy
    Retransmits=            5
    Exchange-max-time=      120
    Listen-on=              10.0.0.2
    
    [Phase 1]
    10.0.0.1=               my-gw
    
    [Phase 2]
    Connections=            work-gw-my-gw
    
    [my-gw]
    Phase=                  1
    Transport=              udp
    Local-address=          10.0.0.2                # Local address
    Address=                10.0.0.1                # Peer address
    ID=                     work-ID
    Configuration=          Default-main-mode
    
    [work-ID]
    ID-type=                FQDN
    Name=                   gw.worksite.se
    
    [work-gw-my-gw]
    Phase=                  2
    ISAKMP-peer=            my-gw
    Configuration=          Default-quick-mode
    Local-ID=               Net-east
    Remote-ID=              Net-west
    
    # *****************************************************************
    # ********************** ... to be continued **********************
    # *****************************************************************

Now that wasn't so hard, just a bit boring to read perhaps. A slightly more
interesting part next.

The policy file.

Actually, the policy file might be slightly confusing for anyone who has not
used it before, especially if things do not work as expected. The man-page 
isakmpd.policy(5) is not really that bad. It might perhaps be a little bit
unclear in some parts but generally it's good.

The simplest possible working policy file would contain just a single line:

    authorizer: "POLICY"

This basically means that that there are no policy limitations on who would be
allowed to connect. Thus not a very secure setup. The authorizer tag here means
the one who has the authorization to decide the policy. The special authorizer
"POLICY" has the ultimate and unlimited authority on policy. Any other
authorizer must first be authorized by "POLICY" to have any authority here.

There can also be a set of conditions for what is allowed. The following policy
thus would mean that only someone using the ESP protocol with some real
encryption would be authorized (oh well, someone using DES would also be
authorized here although DES could almost be considered snakeoil today, it is
left as an exercise for the reader to change this policy into not allowing DES
either). Note that anyone who does encrypts with ESP would still be allowed.

    authorizer: "POLICY"
    conditions: app_domain == "IPsec policy" &&
                esp_present == "yes" &&
                esp_enc_alg != "null" -> "true";
    

It is also possible to "sublicense" authority to someone else (might be one or
more entities). The simple case would be the preshared key case. In that case,
anyone who knows the preshared passphrase is authorized. Thus:

    authorizer: "POLICY"
    licensees:  "passphrase:something really secret"
    conditions: app_domain == "IPsec policy" &&
                esp_present == "yes" &&
                esp_enc_alg != "null" -> "true";

This would authorize anyone who knows this passphrase to connect and comply
with the conditions (but remember that the passphrase must also be set in the
Authentication tag in isakmpd.conf).

Nothing difficult so far. Now to the interesting stuff. First there can be many
licensees, although all must be authorized by "POLICY". Further, authorized
licensees can sublicense to other licensees. A licensee can be just a string in
case it is further described in the policy file:

    authorizer: "POLICY"
    licensees:  "subpolicyAH" ||  "subpolicyESP"
    conditions: app_domain == "IPsec policy" -> "true";
    
    authorizer: "subpolicyESP" 
    licensees:  "passphrase:something more secret"
    conditions: esp_present == "yes" -> "true";
    
    authorizer: "subpolicyAH" 
    licensees:  "passphrase:something really secret"
    conditions: ah_present == "yes" -> "true";

And now to what everyone has been waiting for. Policy can also be sublicensed
or delegated to a key. In this case it is usually a X.509 certificate. The
simple use of certificates would be to use them like the passphrases. Just
insert individual users certificates in the policy file:

    keynote-version: 2
    comment: This is an example of a policy delegating to a key.
    authorizer: "POLICY"
    licensees: "x509-base64:\
            MIIBsTCCARoCAQAwDQYJKoZIhvcNAQEEBQAwITELMAkGA1UEBhMCc2UxEjAQBgNV\
            BAMTCUlLRUxBQiBDQTAeFw0wMDAxMjgxNzQyMTZaFw0wMTAxMjcxNzQyMTZaMCEx\
            CzA           This is would be a user certificate           AQEB\
            BQA                                                         IUuz\
            eOW8P5UGJUH2JVkiA2CTDryFf0CHYwd2P003dtVYw5RvET7XLMpRZiCcWtBdxneW\
            ct+016zUBP/cQMMl+KownxAUq9ezA8GvTyUWC97SOMOgoVj/QR3FHmEjpUi3AgMB\
            AAEwDQYJKoZIhvcNAQEEBQADgYEALGShaAxHvGncev0iFnKrJI4x5T4vlaMP1ad+\
            iWLV5q9H3wickVGN0NPerq0YLwx/VA9WaecYN8V+ALtNKYPuDiT11zwvE8GQeaai\
            NuzgmQ9hh3GifEgN9VEiC3j4kTytonKr0Q+vTLM7xYzheOxvrtUErRwZ9Xs1KzHe\
            yiXHSU8="
    conditions: app_domain == "IPsec policy" &&
                esp_present == "yes" &&
                esp_enc_alg != "null" -> "true";

Now, this is obviously a stupid idea if there are a lot of users. The
certificates that isakmpd reads from the CA- and Certificate directories, and
the certificates received from the peer is converted into pseudo credentials.
Such certificates converted into pseudo credentials essentially would look
something like:

    
    authorizer: "x509-base64:\
            MIIBsTCCARoCAQAwDQYJKoZIhvcNAQEEBQAwITELMAkGA1UEBhMCc2UxEjAQBgI2\
        CzA  This is would be the public key/certificate of the     AQEB\
            BQA signer of the user certificate (i.e. the CA certificate)IUuz\
            eOW8P5UGJUH2JVkiA2CTDryFf0CHYwd2P003dtVYw5RvET7XLMpRZiCcWtBdxneW\
            ct+016zUBP/cQMMl+KownxAUq9ezA8GvTyUWC97SOMOgoVj/QR3FHmEjpUi3AgMB\
            AAEwDQYJKoZIhvcNAQEEBQADgYEALGShaAxHvGncev0iFnKrJI4x5T4vlaMP1ad+\
            iWLV5q9H3wickVGN0NPerq0YLwx/VA9WaecYN8V+ALtNKYPuDiT11zwvE8GQeaai\
            NuzgmQ9hh3GifEgN9VEiC3j4kTytonKr0Q+vTLM7xYzheOxvrtUErRwZ9Xs1KzHe\
            yiXHSU8="
    licensees:  "x509-base64:\
            MIIBsTCCARoCAQAwDQYJKoZIhvcNAQEEBQAwITELMAkGA1UEBhMCc2UxEjAQBgNV\
            BAMTCUlLRUxBQiBDQTAeFw0wMDAxMjgxNzQyMTZaFw0wMTAxMjcxNzQyMTZaMCEx\
            CzA      This is would be the key of the subject of the     AQEB\
            BQA                        certificate                      IUuz\
            eOW8P5UGJUH2JVkiA2CTDryFf0CHYwd2P003dtVYw5RvET7XLMpRZiCcWtBdxneW\
            ct+016zUBP/cQMMl+KownxAUq9ezA8GvTyUWC97SOMOgoVj/QR3FHmEjpUi3AgMB\
            AAEwDQYJKoZIhvcNAQEEBQADgYEALGShaAxHvGncev0iFnKrJI4x5T4vlaMP1ad+\
            iWLV5q9H3wickVGN0NPerq0YLwx/VA9WaecYN8V+ALtNKYPuDiT11zwvE8GQeaai\
            NuzgmQ9hh3GifEgN9VEiC3j4kTytonKr0Q+vTLM7xYzheOxvrtUErRwZ9Xs1KzHe\
            yiXHSU8="
    conditions: app_domain == "IPsec policy" -> "true";

Now note that these are not authorized by "POLICY" and thus won't have any
effect without a policy authorizing them somehow. Further, this showed what
happens to certificates internally. The above credential is thus not seen in
the policy file. However, it is possible to sublicense to such credentials.
Remember sublicensing above. It is thus possible to license all certificates
that are signed by a certain CA by putting the CA certificate as a licensee to
"POLICY":

    keynote-version: 2
    comment: This is an example of a policy delegating to a key.
    authorizer: "POLICY"
    licensees: "x509-base64:\
            MIIBsTCCARoCAQAwDQYJKoZIhvcNAQEEBQAwITELMAkGA1UEBhMCc2UxEjAQBgNV\
            BAMTCUlLRUxBQiBDQTAeFw0wMDAxMjgxNzQyMTZaFw0wMTAxMjcxNzQyMTZaMCEx\
            CzA               This would be the CA certificate          AQEB\
            BQA                                                         IUuz\
            eOW8P5UGJUH2JVkiA2CTDryFf0CHYwd2P003dtVYw5RvET7XLMpRZiCcWtBdxneW\
            ct+016zUBP/cQMMl+KownxAUq9ezA8GvTyUWC97SOMOgoVj/QR3FHmEjpUi3AgMB\
            AAEwDQYJKoZIhvcNAQEEBQADgYEALGShaAxHvGncev0iFnKrJI4x5T4vlaMP1ad+\
            iWLV5q9H3wickVGN0NPerq0YLwx/VA9WaecYN8V+ALtNKYPuDiT11zwvE8GQeaai\
            NuzgmQ9hh3GifEgN9VEiC3j4kTytonKr0Q+vTLM7xYzheOxvrtUErRwZ9Xs1KzHe\
            yiXHSU8="
    conditions: app_domain == "IPsec policy" &&
                esp_present == "yes" &&
                esp_enc_alg != "null" -> "true";

Thus the above policy is a simple example of a policy that delegates to a CA.
Thus any user that has a certificate that is signed by the CA that has this
certificate and otherwise comply to other conditions set by the policy and the
configuration file would be authorized.

Almost secure...is not secure!

Now, to be really safe, this is not enough unfortunately. There are ways to
attack a security gateway that is configured in this way. If you really don't
want the details, skip a to the next section now. To everyone else, let's try
to understand why this is not secure. It's not hard.

Consider what information one of the isakmpds has access to at this stage. From
the configuration file, isakmpd knows which IP-address its peer will send from
(in the [Phase 1] section). From the information it gets at the phase 1
negotiation it knows the ID that the peer presents itself with and the
certificate it gets from the peer proves that the peer really have this ID.
Looks fine so far?

Well, if the ID information were the IP (the default situation if we do not
provide a phase 1 ID section) everything would be fine. The CA would have tied
the IP to the cert and the IP in the configuration would be all information we
need. It would be possible for an imposter to use the same IP from another
computer in some cases (e.g. if both computers were on the same local network
and the computer that usually have this IP is down for some reason). It should
however not be possible for an imposter to be able to have a certificate and a
corresponding private key that (falsely) proves that this IP belongs to the
imposter.

If that ever happened, the imposter would have managed to either steal the
private key from the real owner of the IP, or the imposter would have managed
to fool the CA into issuing a certificate containing false information somehow.
If any of these things happened, then either the private key had not been
protected well enough, the CA had failed to check the identity of the imposter
well enough (or the ID info for the cert) or the CA private key had not been
well enough protected. Since all these are prerequisites for security to work
at all, none of these situations can be allowed to ever occur.

Now, in our example the situation is different. Here we actually have an FQDN
in the certificate instead of an IP address. Since we still have an IP address
in the [Phase 1] section this will result in a possible security problem. What
now would happen during an ISAKMP phase 1 negotiation would be that we could
check that the peer was sending from the expected IP (but as explained earlier
that could possibly be forged in some situations). We could check that the ID
our peer presents actually belongs to our peer. But what we can not check now
is if that ID really is the ID we expect our peer to have, because isakmpd have
never been told what ID that should be.

Someone now might say that the DNS system ties the IP to the FQDN for the host.
That is true, however today's DNS system is not secure and can, under some
circumstances, be fooled to give out false information (or, it could be subject
to a denial of service (DoS) attack by an attacker, and the attacker's computer
might be able to fake the DNS server's answer). Secure DNS will come in the
future, but it is not here yet (at least most DNS servers are not secure yet),
thus today, using DNS to check if the FQDN in the cert corresponds to the
expected IP is no guarantee. In fact isakmpd does not check this with DNS. Even
if DNS was secure, checking this would not help in the case of using an UFQDN.

Thus in the case of having an FQDN as ID, it could be possible for an attacker
to get an own private key and having this key signed by the same CA that we use
(but with the attacker's own FQDN, of course). Then launch a DoS attack on our
peer so that it goes down (in fact, there are some flaws in the ISAKMP protocol
itself that possibly could be used to launch a remote DoS against the peer an
make it go down, although I don't know how sensitive isakmpd is to those
attacks). Then the attacker could configure its own computer in the same way as
our peer, connect it to our peers network and try to connect using its own ID,
private key and certificate.

Since our own isakmpd has not been informed about what ID to our peer (and it
is because the attacker is identically configured as our peer besides the
certificate, ID and private key). Further our isakmpd can check that the
certificate was signed by the same CA (but most CAs sign lots of certs, a cert
might not be hard to get), and that the presented ID is the same as the ID in
the cert. However it would not, with the configuration presented so far, check
that this ID is the expected ID. Thus the attacker would be allowed to connect.

Preventing the attack.

The question now thus is, how can we inform isakmpd about what ID to expect?
This is fortunately easy, and documented in the isakmpd.policy(5). We must do
the check in the policy. Like this:

    keynote-version: 2
    comment: This is an example of a policy delegating to a key.
    authorizer: "POLICY"
    licensees: "x509-base64:\
            MIIBsTCCARoCAQAwDQYJKoZIhvcNAQEEBQAwITELMAkGA1UEBhMCc2UxEjAQBgNV\
            BAMTCUlLRUxBQiBDQTAeFw0wMDAxMjgxNzQyMTZaFw0wMTAxMjcxNzQyMTZaMCEx\
            CzA               This would be the CA certificate          AQEB\
            BQA                                                         IUuz\
            eOW8P5UGJUH2JVkiA2CTDryFf0CHYwd2P003dtVYw5RvET7XLMpRZiCcWtBdxneW\
            ct+016zUBP/cQMMl+KownxAUq9ezA8GvTyUWC97SOMOgoVj/QR3FHmEjpUi3AgMB\
            AAEwDQYJKoZIhvcNAQEEBQADgYEALGShaAxHvGncev0iFnKrJI4x5T4vlaMP1ad+\
            iWLV5q9H3wickVGN0NPerq0YLwx/VA9WaecYN8V+ALtNKYPuDiT11zwvE8GQeaai\
            NuzgmQ9hh3GifEgN9VEiC3j4kTytonKr0Q+vTLM7xYzheOxvrtUErRwZ9Xs1KzHe\
            yiXHSU8="
    conditions: app_domain == "IPsec policy" &&
                esp_present == "yes" &&
                esp_enc_alg != "null" &&
                remote_id == "gw.worksite.se" -> "true";

Now only gw.worksite.se should be able to get an IPsec connection. More allowed
IDs could easily be added by adding more alternative remote_id checks, e.g. by
having conditions like these in the policy:

    conditions: app_domain == "IPsec policy" &&
                esp_present == "yes" &&
                esp_enc_alg != "null" &&
                (remote_id == "gw.worksite.se"  ||
                   remote_id == "gw.whatsite.se") -> "true";

With this policy either of gw.worksite.se, gw.somesite.se or gw.whatsite.se
could connect.

Some might say that is unfortunate that there has to be entire certificates
inserted in the policy. It requires some work to reformat the certificates into
the format in the policy and it makes the policy rather unreadable. If someone
by mistake replaced a user certificate with the corresponding CA certificate
somewhere in a complex policy it might cause unauthorized users to be allowed
to connect in some cases and worse, it would not be easily detectable by
reading through the policy file (since X.509 certificates are not in a human
readable format).

Now, for the really bleeding edge people out there a solution to this problem
is available. It is now possible to use the certificate Distinguished Name (DN)
instead of a certificate in the policy (the corresponding certificate must of
course be available from the certs or ca directories on disk so that isakmpd
can find it). With this format the policy above might look like something like
this instead:

      
    keynote-version: 2
    comment: This is an example of a policy delegating to a key.
    authorizer: "POLICY"
    licensees: "DN:\C=se\CN=IKELAB CA"
    conditions: app_domain == "IPsec policy" &&
                esp_present == "yes" &&
                esp_enc_alg != "null" &&
                (remote_id == "gw.worksite.se"  ||
                 remote_id == "gw.somesite.se"  ||
                 remote_id == "gw.whatsite.se") -> "true";

Much more readable, isn't it? The information about what the exact DN for a
certificate is can be found by looking at the certificate using the openssl
utility. Something like:

    $ openssl x509 -text < ca.crt

More complicated policy configurations are of course possible but this is a
start anyway, and there is another example in the next section.

This should provide the necessary information about the certificate in ca.crt.
Now this is good as long as we have a small or at least reasonably small
policy. It is however still not too great if we have a gigantic site with lots
of users that should be allowed to connect.

Multiuser configurations and/or centrally managed authorization.

Now, lets look at some really cool features of isakmpd. Previously we assumed
that the expected peer was well known and had a static IP address. This is not
always the case. Lots of people use dynamically assigned IPs or use many
different computers. In other cases (like for a server) we might not know for
sure who wants to connect.

Therefore one very nice feature of isakmpd is the ability to use a default tag
instead of an IP in the [Phase 1] section, thus allowing isakmpd negotiations
from any IP. This might thus look something like this:

    [phase 1]
    Default=        work-gw

First, it should be said that this configuration might not be secure from DoS
attacks. As said before, there are some flaws in the ISAKMP/IKE protocols.
Anyway, using a default [phase 1] section also enable us to use a kind of
"authorization certificates" instead.

Consider the case where we have a lot of authorized users but when we would not
accept just any user. Like at a company. We would like company employees to be
allowed to connect but nobody else. Now, imagine a big company where there
might be thousands of employees. We might like them to all be able to connect
from any computer (not only from within the company network) but everyone
should not be allowed to do anything. It should now be possible to write a
policy like this:

    keynote-version: 2
    authorizer: "POLICY"
    licensees: "telnet@@work" || "telnet@@lab" || "pop3@@work" 
    conditions: app_domain == "IPsec policy" &&
                esp_present == "yes" &&
                esp_enc_alg != "null" &&
                remote_id_type == "UFQDN" &&
                (remote_id == "telnet@@worksite.se"  ||
                 remote_id == "pop3@@worksite.se"  ||
                 remote_id == "telnet@@lab.worksite.se") -> "true";
    
    authorizer: "telnet@@work"
    licensees: "DN:\C=se\CN=IKELAB CA"
    conditions: remote_id == "telnet@@worksite.se" &&
                local_filter_type == "IPv4 address" &&
                local_filter_port == "23" &&
                local_filter == "192.168.002.003"
    
    authorizer: "telnet@@lab"
    licensees: "DN:\C=se\CN=IKELAB CA"
    conditions: remote_id == "telnet@@lab.worksite.se" &&
                local_filter_type == "IPv4 address" &&
                local_filter_port == "23" &&
                local_filter == "192.168.002.002" -> "true";
    
    authorizer: "pop3@@work"
    licensees: "DN:\C=se\CN=IKELAB CA"
    conditions: local_filter_type == "IPv4 address" &&
                local_filter_port == "110" &&
                local_filter == "192.168.002.003" &&
                remote_id == "telnet@@worksite.se" -> "true";
    

This might not be exactly how it should be. This is as far as I know completely
untested (in fact, these filter conditions might not work at all as I expect).
Also, a policy such as this one (in fact any with default as peer IP), would
require rewrites of the isakmpd.conf file too. This would have some security
implications too. Further, for this kind of connections where anyone should be
allowed to connect, it would probably be desirable to log the DN of anyone who
connected. Isakmpd does not yet support that to my knowledge. Also this
probably could have other security implications. You are on your own, you have
been warned. The basic idea should be clear anyway.

Just in case someone missed the really interesting possibilities this would
have. If all computers using ISAKMP/IKE this way had a standard set of
conditions for all services the users might like to use from remote, the CA
could actually authorize users by just putting the right SubjectAltName
extensions in their certificates. Further, the expiration time for such
certificates could be set to expire relatively often although the users would
be able to download new reissued certificates when their current certificate is
getting old. If the users misuse their authorizations, just stop reissuing the
certificates and they won't get in more after it has expired. No need to change
policy files on all computers just because an employee e.g. quits their job.
The same scheme should work for other purposes than ISAKMP/IPsec too (including
authorization for off-line systems!) although that would require special
software. In any case, any organization doing this would probably want to be
their own CA.

Multiuser configurations (mobile users) like these are possible with pre-shared
keys too, but then it is required that AGGRESSIVE mode is used instead of
ID_PROT mode since we then must be able to choose the right password phrase
based on ID since we do not know that from what the IP is in this case (in
AGGRESSIVE mode the ID is sent over at an earlier stage of the negotiation, but
it is sent unencrypted, thus AGGRESSIVE mode is faster because it needs fewer
message exchanges, but it also is a bit less secure since the ID is sent in
clear).

13.9 - What IKE clients are compatible with isakmpd?

isakmpd is the ISAKMP/Oakley key management daemon that comes with OpenBSD. We
suspect that it interoperates, at least partially, with most ISAKMP
implementations, but the following have actually been tested. Note that some
isakmp software out there is actually based on the OpenBSD isakmp daemon.

The following MS-Windows clients have been reported to be compatible:

  * Ashley Laurent VPCom VPN software
  * PGP VPN software
  * Cisco IRE client
  * Microsoft Windows 2000, XP

The following gateways/routers have been reported to be compatible:

  * Cisco IOS
  * Cisco PIX
  * Intel LanRover
  * Cendio Fuego
  * KAME for FreeBSD
  * FreeS/WAN for Linux
  * Symantec Raptor
  * Ericsson eBox
  * F-Secure VPN+
  * Teamware TWISS
  * 3com Pathbuilder
  * Nortel Contivity
  * CheckPoint FW-1
  * Watchguard Firebox III
  * Lucent Access Point

13.10 - Troubleshooting IPsec/VPN

Your first tool for troubleshooting IPsec is tcpdump(8). Use tcpdump to look
for several things.

First, if you are using tcpdump from OpenBSD, you have an enhanced version of
tcpdump which can show some information about ESP and AH packets. If you are
using tcpdump from OpenBSD 2.5 or on another operating system, chances are you
have an older version that will simply show the protocol number for AH or ESP.
(ESP is IP protocol 50, AH is 51)

  * With tcpdump, look and see if traffic is using AH/ESP or cleartext. If your
    traffic is in cleartext, then your flows are setup incorrectly or your
    isakmp is not negotiating properly. Use ping(8) to generate simple traffic.
   
    For instance, I have two hosts, 208.1.1.1 and 208.2.2.2. Logged in to
    208.2.2.2, I am doing this:
    # ping -c 3 208.1.1.1
    PING esp.mil (208.1.1.1): 56 data bytes
    64 bytes from 208.1.1.1: icmp_seq=0 ttl=255 time=190.155 ms
    64 bytes from 208.1.1.1: icmp_seq=1 ttl=255 time=201.040 ms
    64 bytes from 208.1.1.1: icmp_seq=2 ttl=255 time=165.481 ms
    --- esp.mil ping statistics ---
    3 packets transmitted, 3 packets received, 0% packet loss
    round-trip min/avg/max = 165.481/185.558/201.040 ms
   
    And in another session, I can see my encapsulated pings:
    # tcpdump -ni fxp7 host 208.1.1.1
    tcpdump: listening on fxp7
    14:12:19.630274 esp 208.2.2.2 > 208.1.1.1 spi 0x00001000 seq 4535 len 116
    14:12:19.813519 esp 208.1.1.1 > 208.2.2.2 spi 0x00001001 seq 49313 len 116
    14:12:20.630277 esp 208.2.2.2 > 208.1.1.1 spi 0x00001000 seq 4536 len 116
    14:12:20.832458 esp 208.1.1.1 > 208.2.2.2 spi 0x00001001 seq 49314 len 116
    14:12:21.630273 esp 208.2.2.2 > 208.1.1.1 spi 0x00001000 seq 4537 len 116
    ^C
    1831 packets received by filter
    0 packets dropped by kernel
   
  * ISAKMP runs on UDP port 500. If this is locked out through a firewall or
    packet filter, then you need to change it!
   
        # Passing in ISAKMP traffic from the security gateways
        pass in on ne0 proto udp from gatewB/32 port = 500 to gatewA/32 port = 500
        pass out on ne0 proto udp from gatewA/32 port = 500 to gatewB/32 port = 500
        
        # Passing in encrypted traffic from security gateways
        pass in proto esp from gatewB/32 to gatewA/32
        pass out proto esp from gatewA/32 to gatewB/32
   
  * To turn on all debugging in isakmpd, start it as
   
        # /sbin/isakmpd -d -DA=99
   
    or (to skip the most detailed timer debug info)
   
        # /sbin/isakmpd -d -DA=99 -D1=70
   
  * You need to allow traffic which has been processed by IPsec from netB into
    your local firewalled netA.
   
        # Passing in traffic from the designated subnets.
        pass in on enc0 from netB/netBmask to netA/netAmask
   
  * With tcpdump on OpenBSD, you can decode most cleartext parts of Internet
    Key Exchange sessions. Tcpdump will also show AH payload data.
   
  * Mount a /kern filesystem (if you don't use one by default already.)
   
        # mkdir /kern; mount -t kernfs /kern /kern
   
    In /kern, there is a table of current SA/SPIs, including which have flows
    (outgoing SAs) or not (incoming SAs). There are also traffic counters which
    you can use to see what traffic is going where.
   
  * Finally, you can use netstat(1) to see your SAs.
   
        $ netstat -rn -f encap
        Routing tables
        
        Encap:
        Source             Port  Destination        Port  Proto SA(Address/SPI/Proto) 
        0.0.0.0/32         0     192.168.99/24      0     0     208.1.1.1/00001000/50
        0.0.0.0/32         0     208.1.1.1/32       0     0     208.1.1.1/00001000/50
        208.1.2.0/24       0     192.168.99/24      0     0     208.1.1.1/00001000/50
        208.1.2.0/24       0     208.1.1.1/32       0     0     208.1.1.1/00001000/50
        208.1.5.0/24       0     192.168.99/24      0     0     208.1.1.1/00001000/50
        208.1.5.0/24       0     208.1.1.1/32       0     0     208.1.1.1/00001000/50
        208.2.2.2/32       0     192.168.99/24      0     0     208.1.1.1/00001000/50
        208.2.2.2/32       0     208.1.1.1/32       0     0     208.1.1.1/00001000/50
   
  * If all else fails, recompile your kernel with option ENCDEBUG. Then, set
    the sysctl net.inet.ip.encdebug to 1. Look in your dmesg for warnings or
    errors, and report them using sendbug(1) to the OpenBSD developers.
    Alternately, if you are not sure you have actually run into a bug, you may
    want to send a message to one of the mailing lists.

13.11 - Related Documentation

IPsec is partially documented in the vpn(8) man page. There are various
configuration templates in /usr/share/ipsec/ directory which can also assist
you. The manual pages for enc(4), ipsec(4), ipsecadm(8), isakmpd(8), 
isakmpd.conf(5) and isakmpd.policy(5) are detailed and can assist in setup and
operation of IPsec.

Other links...

  * IETF IPsec Working Group
  * SSH IPsec interoperability Test Node
  * NIST IPsec Web Based Interoperability Tester
  * A port of OpenBSD's IPsec to FreeBSD
  * FreeS/WAN - IPsec for Linux
  * OpenBSD 2.4 VPN Configuration Mini-FAQ

And on to the RFCs...

  * RFC 1320 - The MD4 Message-Digest Algorithm
  * RFC 1321 - The MD5 Message-Digest Algorithm
  * RFC 1828 - IP Authentication using Keyed MD5
  * RFC 1829 - The ESP DES-CBC Transform
  * RFC 2040 - The RC5, RC5-CBC, RC5-CBC-Pad, and RC5-CTS Algorithms
  * RFC 2085 - HMAC-MD5 IP Authentication with Replay Prevention
  * RFC 2104 - HMAC: Keyed-Hashing for Message Authentication
  * RFC 2144 - The CAST-128 Encryption Algorithm
  * RFC 2202 - Test Cases for HMAC-MD5 and HMAC-SHA-1
  * RFC 2207 - RSVP Extensions for IPsec Data Flows
  * RFC 2268 - A Description of the RC2 Encryption Algorithm
  * RFC 2367 - PF_KEY Key Management API, Version 2
  * RFC 2401 - Security Architecture for the Internet Protocol (IPsec)
  * RFC 2402 - IP Authentication Header (AH)
  * RFC 2403 - The Use of HMAC-MD5-96 within ESP and AH
  * RFC 2404 - The Use of HMAC-SHA-1-96 within ESP and AH
  * RFC 2405 - The ESP DES-CBC Cipher Algorithm With Explicit IV
  * RFC 2406 - IP Encapsulating Security Payload (ESP)
  * RFC 2407 - The Internet IP Security Domain of Interpretation for ISAKMP
  * RFC 2408 - Internet Security Association and Key Management Protocol (
    ISAKMP)
  * RFC 2409 - The Internet Key Exchange (IKE)
  * RFC 2410 - The NULL Encryption Algorithm and Its Use With IPsec (ha ha...)
  * RFC 2411 - IP Security Document Roadmap
  * RFC 2412 - The OAKLEY Key Determination Protocol
  * RFC 2451 - The ESP CBC-Mode Cipher Algorithms
  * RFC 2631 - Diffie-Hellman Key Agreement Method
  * RFC 2709 - Security Model with Tunnel-mode IPsec for NAT Domains

[Back to Main Index] [To Section 12.0 - For Advanced Users] [To Section 14.0 -
Using disks in OpenBSD]

-------------------------------------------------------------------------------
[back] www@@openbsd.org
$OpenBSD: obsd-faq.txt,v 1.33 2003/01/05 19:29:10 nick Exp $
[OpenBSD]
d11636 1
a11636 1
14.0 - Disk setup
d11638 1
a11638 1
-------------------------------------------------------------------------------
d11642 57
a11698 14
  * 14.1 - Using OpenBSD's disklabel
  * 14.2 - Using OpenBSD's fdisk
  * 14.3 - Adding extra disks in OpenBSD
  * 14.4 - How to swap to a file
  * 14.5 - Soft Updates
  * 14.6 - When I boot after installation of OpenBSD/i386, it stops at "Using
    Drive: 0 Partition 3".
  * 14.7 - What are the issues regarding large drives with OpenBSD?
  * 14.8 - Installing Bootblocks - i386 specific
  * 14.9 - Preparing for disaster: Backing up and Restoring from tape.
  * 14.10 - Mounting disk images in OpenBSD
  * 14.11 - Help! I'm getting errors with PCIIDE!
  * 14.12 - Forcing DMA access for IDE disks
  * 14.13 - RAID options with OpenBSD
d11700 1
a11700 1
-------------------------------------------------------------------------------
d11702 2
a11703 1
Using OpenBSD's disklabel
d11705 1
a11705 1
Table of Contents
d11707 76
a11782 186
  * What is disklabel?
  * disklabel during the OpenBSD install
  * Common disklabel uses.

What is disklabel?

First be sure to read the disklabel(8) man page.

Disklabels are created to allow an efficient interface between your disk and
the disk drivers contained within the kernel. Labels hold certain information
about your disk, like your drive geometry and information about your
filesystems. This is then used by the bootstrap program to load the drive and
to know where filesystems are contained on the drive. Labels are also used in
conjunction with the filesystems to create a more efficient environment. You
can read more in-depth information about disklabel by reading the disklabel(5)
man page.

As an additional gain, using disklabel helps overcome architecture limitations
on disk partitioning. For example, on i386, you can only have 4 primary
partitions. (Partitions that other operating systems, such as Windows NT or DOS
can see.) With disklabel(8), you use one of these 'primary' partitions to store
*all* of your OpenBSD partitions (eg. 'swap', '/', '/usr' and '/var'). And you
still have 3 more partitions available for other OSs!

disklabel during OpenBSD's install

One of the major parts of OpenBSD's install is your initial creation of labels.
This comes (for i386 users) directly after using fdisk(1). During the install
you use disklabel to create your separate labels which will contain your
separate mountpoints. During the install, you can set your mountpoints from
within disklabel(8), but this isn't completely necessary considering you will
be prompted later to confirm you choices. But it does make your install go just
a little smoother.

Since this is during the install you won't have any existing labels, and they
will need to be created. The first label you will create is the label 'a'. This
label SHOULD be your where / will be mounted. You can see recommended
partitions that should be created and their sizes by reading FAQ 4, Space
Needed. For servers it is recommended that you create at least these label's
separately. For desktop users creating one mountpoint at / will probably
suffice. When initially creating your root partition ( 'a' label ), keep in
mind that you will need SOME space left for your swap label. Now that the
basics have been explained, here is an example of using disklabel during an
install. In this first example it is assumed that OpenBSD will be the only
operating system on this computer, and that a full install will be done.

If this disk is shared with other operating systems, those operating systems
should have a BIOS partition entry that spans the space they occupy completely.
For safety, also make sure all OpenBSD file systems are within the offset and
size specified in the 'A6' BIOS partition table.  (By default, the disklabel
editor will try to enforce this).  If you are unsure of how to use multiple
partitions properly (ie. separating /,  /usr, /tmp, /var, /usr/local, and other
things) just split the space into a root and swap partition for now.

# using MBR partition 3: type A6 off 63 (0x3f) size 4991553 (0x4c2a41) 

Treating sectors 63-16386300 as the OpenBSD portion of the disk.
You can use the 'b' command to change this.

Initial label editor (enter '?' for help at any prompt)
> d a
> a a
offset: [63] <Enter>
size: [16386237] 64M
Rounding to nearest cylinder: 131040
FS type: [4.2BSD] <Enter>
mount point: [none] /
fragment size: [1024] <Enter>
block size: [8192] <Enter>
cpg: [16] <Enter>
> a b
offset: [131103] <Enter>
size: [16255197] 64M
Rounding to nearest cylinder: 131040
FS type: [swap] <Enter>

At this point we have created a 64M root partition mounted at /, and a 64Meg
swap partition. Notice that the offset starts at sector 63. This is what you
want. When it comes to the size, disklabel will show your size in sectors,
however, you don't need to enter sizes in the same format. Like the example
above you can enter sizes in the manner of 64 Megabytes = 64M and 2 Gigabytes =
2G. Disklabel will then round to the nearest cylinder. In the example above you
will also notice that disklabel assumes that label 'b' will be a swap. This is
a correct assumption as the GENERIC kernel is set to look for swap on label
'b', and you should just follow this guideline and use 'b' as your swap area.

The next example will take you through the creation of two more labels. This
means that it's not a complete install, as the size of these won't be enough to
install OpenBSD to its fullest. Showing the creation of all the partitions
would just be repetitive.
> a d
offset: [262143] <Enter>
size: [16124157] 64M
Rounding to nearest cylinder: 131040
FS type: [4.2BSD] <Enter>
mount point: [none] /tmp
fragment size: [1024] <Enter>
block size: [8192] <Enter>
cpg: [16] <Enter>
> a e
offset: [393183] <Enter>
size: [15993117] 64M
Rounding to nearest cylinder: 131040
FS type: [4.2BSD] <Enter>
mount point: [none] /var
fragment size: [1024] <Enter>
block size: [8192] <Enter>
cpg: [16] <Enter>

In the above example, there are two things you might notice. One being that the
offset is automatically figured out for you to be the next in order. When doing
an install of this sort, you won't need to mess with changing the offsets at
all. Another difference you might notice will be that label 'c' has been
skipped. This is done for a reason, which is that label 'c' is a label that
represents the whole disk. For this reason you shouldn't deal with label 'c' in
any way.

Once all your labels have been created all that's left to do is write the
labels to disk, and move on in the installation process. To write everything
and quit disklabel (and continue with the install) do:
> w
> q

*NOTE* - For users with large drives. If your bios isn't able to support a
drive of that size OpenBSD cannot support it either. Otherwise OpenBSD should
be able to handle your drive just fine. If you are in a situation where your
bios doesn't support your drive, you can try Maxtor EZ-Drive or other similar
overlay product.

Common uses for disklabel(8)

Once your system is installed, you shouldn't need to use disklabel too often.
But some times you will need to use disklabel when adding, removing or
restructuring your disks. One of the first things you will need to do is view
your current disklabel. To do this, simply type:
# disklabel wd0 >----- Or whatever disk device you'd like to view

# using MBR partition 3: type A6 off 64 (0x40) size 16777152 (0xffffc0)
# /dev/rwd0c:
type: ESDI
disk:
label: TOSHIBA MK2720FC
flags:
bytes/sector: 512
sectors/track: 63
tracks/cylinder: 16
sectors/cylinder: 1008
cylinders: 2633
total sectors: 2654064
rpm: 3600
interleave: 1
trackskew: 0
cylinderskew: 0
headswitch: 0           # milliseconds
track-to-track seek: 0  # milliseconds
drivedata: 0 

16 partitions:
#        size   offset    fstype   [fsize bsize   cpg]
  a:  2071440    65583    4.2BSD     1024  8192    16   # (Cyl.   65*- 2120)
  b:    65520       63      swap                        # (Cyl.    0*- 65)
  c:  2654064        0    unused        0     0         # (Cyl.    0 - 2632)
  j:   512001  2137023    4.2BSD     1024  8192    16   # (Cyl. 2120*- 2627*)

The above command simply allows you to view the existing disklabel, and
assuring that you dont mess anything up. ( Which we all need sometimes. ) But
to be able to make changes you must use the -E option with disklabel like so:
# disklabel -E wd0

This will bring you to a prompt, the same as the one that you used during the
OpenBSD install. Probably the single most important command at this prompt is
'?'. This will give you a list of possible options pertaining to disklabel. You
can even view the entire disklabel(8) man page with the 'M' command. From this
prompt, you will do all of your adding, deleting and changing of partitions.
For additional information read the disklabel(8) man page.

14.2 - Using fdisk

First be sure to check the fdisk man page. fdisk(8)

Fdisk is a program to help with the maintenance of your partitions. This
program is used at install time to set up your OpenBSD partition (this
partition can contain several labels, each with filesystems/swap/etc.). It can
divide space on your drives and set one active. This program will usually be
used in Single User Mode ( boot -s ). Fdisk also sets the MBR on your various
hard disks.
d11784 2
a11785 2
For installation purposes, most times you'll only need ONE OpenBSD partition,
and then using disklabel to put a swap and a filesystem on it.
d11788 2
a11789 1
# fdisk fd0
a11792 35
         Disk: fd0       geometry: 80/2/18 [2880 sectors]
         Offset: 0       Signatures: 0xAA55,0x0
                  Starting        Ending
          #: id  cyl  hd sec -  cyl  hd sec [     start -       size]
----------------------------------------------------------------------
         *0: A6    0   0   1 -   79   1  18 [         0 -       2880] OpenBSD
          1: 00    0   0   0 -    0   0   0 [         0 -          0] unused
          2: A7    0   0   2 -   79   1  18 [         1 -       2879] NEXTSTEP
          3: 00    0   0   0 -    0   0   0 [         0 -          0] unused

In this example we are viewing the fdisk output of floppy drive. We can see the
OpenBSD partition (A6) and its size. The * tells us that the OpenBSD partition
is a bootable partition.

In the previous example we just viewed our information. What if we want to edit
our partition table? Well, to do so we must use the -e flag. This will bring up
a command line prompt to interact with fdisk.
# fdisk -e wd0
Enter 'help' for information
fdisk: 1> help
        help            Command help list
        manual          Show entire OpenBSD man page for fdisk
        reinit          Re-initialize loaded MBR (to defaults)
        setpid          Set the identifier of a given table entry
        disk            Edit current drive stats
        edit            Edit given table entry
        flag            Flag given table entry as bootable
        update          Update machine code in loaded MBR
        select          Select extended partition table entry MBR
        print           Print loaded MBR partition table
        write           Write loaded MBR to disk
        exit            Exit edit of current MBR, without saving changes
        quit            Quit edit of current MBR, saving current changes
        abort           Abort program without saving current changes
fdisk: 1> 
d11794 37
a11830 2
It is perfectly safe in fdisk to go in and explore, just make sure to answer N
to saving the changes and *DON'T* use the write command.
d11836 6
a11841 3
  * reinit Initialize the currently selected, in-memory copy of the boot block.
  * disk Display the current drive geometry that fdisk has probed. You are
    given a chance to edit it if you wish.
d11845 3
a11847 2
  * edit Edit a given table entry in the memory copy of the current boot block.
    You may edit either in BIOS geometry mode, or in sector offsets and sizes.
d11852 2
a11853 2
  * update Update the machine code in the memory copy of the currently selected
    boot block.
d11856 5
a11860 4
  * print Print the currently selected in-memory copy of the boot block and its
    MBR table to the terminal.
  * write Write the in-memory copy of the boot block to disk. You will be asked
    to confirm this operation.
d11862 2
a11863 2
    selected in-memory copy of a boot block, or exiting the program if there is
    none.
d11865 2
a11866 2
    selected in-memory copy of a boot block, or exiting the program if there is
    none. Unlike exit it does write the modified block out.
d11869 192
a12060 1
14.3 - Adding extra disks in OpenBSD
d12065 5
a12069 2
For i386 folks, start with fdisk. Other architectures can ignore this.
# fdisk -i sd2
a12071 1
# disklabel -e sd2
d12073 14
a12086 11
(screen goes blank, your $EDITOR comes up)
type: SCSI
...bla...
sectors/track: 63
total sectors: 6185088
...bla...
16 partitions:
#        size   offset    fstype   [fsize bsize   cpg]
  c:  6185088        0    unused        0     0         # (Cyl.    0 - 6135)
  d:  1405080       63    4.2BSD     1024  8192    16   # (Cyl.    0*- 1393*)
  e:  4779945  1405143    4.2BSD     1024  8192    16   # (Cyl. 1393*- 6135)
d12088 10
a12097 11
disklabel to function! For normal operations, fsize should always be 1024,
bsize should always be 8192, and cpg should always be 16. Fstype is 4.2BSD.
Total sectors is the total size of the disk. Say this is a 3 gigabyte disk.
Three gigabytes in disk manufacturer terms is 3000 megabytes. So divide 6185088
/3000 (use bc(1)). You get 2061. So, to make up partition sizes for a, d, e, f,
g, ... just multiply X*2061 to get X megabytes of space on that partition. The
offset for your first new partition should be the same as the "sectors/track"
reported earlier in disklabel's output. For us it is 63. The offset for each
partition afterwards should be a combination of the size of each partition and
the offset of each partition (Except the 'c' partition, since it has no play
into this equation.)
d12103 3
a12105 1
    d:  6185025       63    4.2BSD     1024  8192    16 
d12108 1
a12108 6
use "96M" to specify "96 megabytes". (Or, if you have a disk big enough, 96G
for 96 gigs!) Unfortunately, the -E mode uses the BIOS disk geometry, not the
real disk geometry, and often times the two are not the same. To get around
this limitation, type 'g d' for 'geometry disk'. (Other options are 'g b' for
'geometry bios' and 'g u' for geometry user, or simply, what the label said
before disklabel made any changes.)
d12112 2
a12113 1
# newfs wd1a 
a12120 1
# mount /dev/wd1a /u
d12122 5
a12126 2
Finally, add it to /etc/fstab(5)
/dev/wd1a /u ffs rw 1 1
d12129 21
a12149 8
mount the new drive in /mnt and use cpio -pdum to copy /usr/local to the /mnt
directory. Edit the /etc/fstab(5) file to show that the /usr/local partition is
now /dev/wd1a (your freshly formatted partition.) Example:
/dev/wd1a /usr/local ffs rw 1 1

Reboot into single user mode..boot -s Move the existing /usr/local to /usr/
local-backup (or delete it if you feel lucky) and create an empty directory /
usr/local. Then reboot the system, and viola, the files are there!
d12151 35
a12185 1
14.4 - How to swap to a file
d12189 1
a12189 4
with csh's unlimit(1), or sh's ulimit(1).)

Swapping to a file doesn't require a custom built kernel, although that can
still be done, this faq will show you how to add swap space both ways.
d12191 5
a12195 1
Swapping to a file.
a12196 1
Swapping to a file is easiest and quickest way to get extra swap space setup.
d12198 7
a12204 6
are disabled by default). To start out, you can see how much swap you currently
have and how much you are using with the swapctl(8) utility. You can do this by
using the command:
$ swapctl -l
Device      512-blocks     Used    Avail Capacity  Priority
swap_device      65520        8    65512     0%    0
d12210 1
a12210 1
that device isn't getting much use at the moment. But for the purposes of this
d12214 7
a12220 6
It's best to do this with the dd(1) utility. Here is an example of creating the
file /var/swap that is 32M large.
$ sudo dd if=/dev/zero of=/var/swap bs=1k count=32768
32768+0 records in
32768+0 records out
33554432 bytes transferred in 20 secs (1677721 bytes/sec)
d12224 3
a12226 2
$ sudo chmod 600 /var/swap
$ sudo swapctl -a /var/swap
d12230 6
a12235 5
$ swapctl -l
Device      512-blocks     Used    Avail Capacity  Priority
swap_device      65520        8    65512     0%    0
/var/swap        65536        0    65536     0%    0
Total           131056        8   131048     0%
d12240 19
a12258 67
$ cat /etc/fstab
/dev/wd0a / ffs rw 1 1
/var/swap /var/swap swap sw 0 0

Swapping via a vnode device

This is a more permanent solution to adding more swap space. To swap to a file
permanently, first make a kernel with vnd0c as swap. If you have wd0a as root
filesystem, wd0b is the previous swap, use this line in the kernel
configuration file (refer to compiling a new kernel if in doubt):
config          bsd     root on wd0a swap on wd0b and vnd0c dumps on wd0b

After this is done, the file which will be used for swapping needs to be
created. You should do this by using the same command as in the above examples.
$ sudo dd if=/dev/zero of=/var/swap bs=1k count=32768
32768+0 records in
32768+0 records out
33554432 bytes transferred in 20 secs (1677721 bytes/sec)

Now your file is in place, you need to add the file to you /etc/fstab. Here is
a sample line to boot with this device as swap on boot.
$ cat /etc/fstab
/dev/wd0a / ffs rw 1 1
/dev/vnd0c none swap sw 0 0 

At this point your computer needs to be rebooted so that the kernel changes can
take place. Once this has been done it's time to configure the device as swap.
To do this you will use vnconfig(8).
$ sudo vnconfig -c -v vnd0 /var/swap
vnd0: 33554432 bytes on /var/swap

Now for the last step, turning on swapping to that device. We will do this just
like in the above examples, using swapctl(8). Then we will check to see if it
was correctly added to our list of swap devices.
$ sudo swapctl -a /dev/vnd0c
$ swapctl -l
Device      512-blocks     Used    Avail Capacity  Priority
swap_device      65520        8    65512     0%    0
/dev/vnd0c       65536        0    65536     0%    0
Total           131056        8   131048     0%

14.5 - Soft Updates

Over the last few years Kirk McKusick has been working on something called
"Soft Updates". This is based on an idea proposed by Greg Ganger and Yale Patt
that imposing a partial ordering on the buffer cache operations would permit
the requirement for synchronous writing of directory entries to be removed from
the FFS code. Thus, a large performance increase of disk writing performance.

As Soft Updates are still in development as a whole, an fsck(8) is still needed
after the computer is abruptly turned off without a clean shutdown sequence,
but this will be remedied in future versions.

More internals and details about Soft Updates can be found in the papers of 
Ganger and Patt and from McKusick.

To use Soft Updates, your kernel must have

option FFS_SOFTUPDATES

compiled in, this is already in place on GENERIC.

Enabling soft updates must be done with a mount time option, When mounting a
partition with the mount(8) utility, you can specify that you wish to have soft
updates enabled on that partition. Below is a sample /etc/fstab(5) entry that
has one partition sd0a that we wish to have mounted with soft updates.
/dev/sd0a / ffs rw,softdep 1 1
d12264 112
a12375 2
14.6 - When I boot after installation of OpenBSD/i386, it stops at "Using
Drive: 0 Partition: 3" - i386 specific.
d12377 74
a12450 39
This isn't actually an error message by itself, it is the boot loader in the
MBR telling you which drive and partition it is about to boot from. The problem
is, the boot process stopped here.

There are two common reasons why this may happen: an incompatibility between
the BIOS and the OpenBSD MBR, or a drive geometry problem. An example of a
drive geometry problem would be if you were to move a drive from one computer
to another, update a BIOS or change a BIOS setting on a computer, though it is
also reported that it can happen for unknown reasons during install.

Note: As of OpenBSD 3.1, the BIOS compatibility problem should be resolved on
virtually all computer systems. However, it is still possible to have a drive
geometry problem, so it is still possible to have the system hang after this
this message.

To fix the BIOS compatibility issue, you must replace the boot loader with one
that is compatible with your system. Fortunately, boot loaders are easy to come
by.

Installing the BootEasy boot loader:

This requires booting your system. As you can't boot off the hard disk
directly, we have to use a boot floppy or CD-ROM to start the boot process.
When the system gets to the 'boot>' prompt, redirect it to boot from the hard
disk:
reading boot.......
probing pc0 com0 com1 pci mem [639k 79m a20=on]
disk hd0 fd0
>> OpenBSD BOOT 1.28
boot> boot hd0a:/bsd

This command redirects the boot process to the file /bsd on the 'a' partition
of the first hard drive, allowing your system to boot.

Once the system is booted, you need to install the BootEasy boot loader. The
file itself can be found on both the CD-ROM and the FTP sites, in the directory
3.0/tools/booteasy/Boot.bin, and can be installed using the following fdisk(8)
command:
# fdisk -i -f /mnt/3.0/tools/booteasy/Boot.bin wd0
d12452 1
a12452 84
This assumes you have the 3.0 CD mounted on /mnt and that you are using an IDE
drive. You may need to change this depending upon where Boot.bin is and what
kind of hard disk you have (a SCSI drive would typically be 'sd0'). Note: do
NOT do this if your OpenBSD partition is not the entire disk! Initializing the
MBR this way creates one OpenBSD partition spanning the entire disk and deletes
all other partitions, which is rarely good.

BootEasy has another feature that might interest you even if you have no
problem with the default loader: It is capable of selecting a boot partition at
startup -- it will prompt you for which partition to boot from, and will boot
the active partition if no other choice is made. This might be very useful
should you have multiple OS's on one disk. Installing BootEasy this way is done
from MS-DOS with the BOOTINST.EXE program found in the BootEasy directory on
the CD-ROM and FTP servers.

Installing the MS-DOS boot loader:

Boot from a Windows 9x or DOS v6 boot disk with FDISK.EXE on it. Once the
system is booted to an MS-DOS prompt, enter the following:
A:\>fdisk /mbr

You should see a brief disk access, and then a command prompt should return,
with NO message of any kind. "Bad command or file name" means the disk you used
did not have FDISK.EXE on it. If you do this properly, the "Using ..." message
will be removed, as it replaces the very code that produces that message. If
you had a BIOS compatibility issue, it will now be gone, reboot, your OpenBSD
install should come right up.

It has been reported that this also works with FreeDOS.

The OS-BS Boot Loader:

Another boot loader, OS-BS, is included with the OpenBSD CD-ROMs and available
on the FTP sites in 2.9/tools/osbs135.exe. The OS-BS web page is at http://
www.prz.tu-berlin.de/~wolf/os-bs.html

LILO:

The Linux LILO program can also be used. For details, see INSTALL.linux

Avoiding the problem:

Relatively few machines have the BIOS compatibility problem, but if you are
setting up a machine that you know has this problem, it is fairly easy to avoid
it. The only time the OpenBSD loader is installed on your system during a
normal install is when you say 'Y' to the 'Use entire disk for OpenBSD'
question. If you answer 'N' and manually create the OpenBSD disk partition, it
will not replace the boot loader unless you use the 'reinit' or 'update'
commands of fdisk. This, of course, assumes that your drive STARTED with some
kind of boot loader -- if it doesn't (new, blank drive, drive pulled from
another platform), you will have to install one before the system will boot.

Fixing a drive geometry problem:

Ideally, you would want to avoid this problem by maintaining the same drive
geometry, not by fixing it, however sometimes you can't avoid it. An example
would be moving a large drive from an old computer which didn't support LBA
geometry to a new machine which insists upon using LBA.

Start your machine using a boot disk or CD-ROM, as indicated above. Log in as
root, and execute the following commands:
# cp /usr/mdec/boot /boot
# /usr/mdec/installboot -v /boot /usr/mdec/biosboot wd0

Reboot, your system should come right up.

installboot(8) installs and configures the partition boot loader, biosboot(8),
which loads boot(8). boot(8) is the module which loads the kernel into RAM. 
biosboot(8) has a table within it that points to the physical location
(according to the system's BIOS) of boot(8). If you do anything which changes
the BIOS's perception of the location of boot(8), you must re-run installboot
(8) as above to reinitialize the table pointing to boot(8).

See Install Boot for more info.

14.7 - What are the issues regarding large drives with OpenBSD?

OpenBSD has support for file systems of sizes much larger than any currently or
soon to be available hard disks, however there are limitations on some
interfaces which are smaller than the theoretical maximum of OpenBSD. In the
case of IDE drives, the limit is 128GB, the limit of the currently popular ATA
interface. Note the next generation of ATA drives, those with capacities
greater than 128G (1G=2^30 here, not 1,000,000,000, so drive manufacturers will
often call this 137G), are not be supported by OpenBSD 3.1 and earlier.
d12455 2
a12456 4
has been loaded into memory, and the booting process introduces limits of its
own. The boot process has to utilize (and is thus limited by) the system's boot
ROM. The OpenBSD i386 boot loaders (biosboot(8) and boot(8)) also have their
own internal 8G limitation, from an older BIOS limit.
d12459 7
a12465 4
within the boot ROM addressable area, or within the first 8G of the disk,
whichever is smaller. This means that on some older i386 systems, the root
partition must be completely within the first 504M, but for most newer
computers, the root partition may be anywhere within the first 8G.
d12468 2
a12469 2
on it as one huge partition, and think you have successfully violated the above
rule. However, it might come back to haunt you in a most unpleasant way:
d12474 1
a12474 2
  * You upgrade, build your own kernel, whatever, and copy your new /bsd over
    the old one.
d12476 1
a12476 1
  * You get a message such as "bad magic"
d12483 10
a12492 5
To get OpenBSD to boot, /bsd must be within the boot ROM's supported range. To
play it safe, the rule is simple:

The entire root partition must be within the computer's BIOS (or boot ROM)
addressable space or within the first 8G, whichever is smaller.
d12497 71
a12567 1
14.8 - Installing Bootblocks - i386 specific
a12568 19
Older versions of MS-DOS can only deal with disk geometries of 1024 cylinders
or less. Since virtually all modern disks have more than 1024 cylinders, most
SCSI BIOS chips (which come on the SCSI controller card) and IDE BIOS (which is
part of the rest of the PC BIOS) have an option (sometimes the default) to
"translate" the real disk geometry into something that fits within MS-DOS'
ability. However, not all BIOS chips "translate" the geometry in the same way.
If you change your BIOS (either with a new motherboard or a new SCSI
controller), and the new one uses a different "translated" geometry, you will
be unable to load the second stage boot loader (and thus unable to load the
kernel). (This is because the first stage boot loader contains a list of the
blocks that comprise /boot in terms of the original "translated" geometry). If
you are using IDE disks, and you make changes to your BIOS settings, you can
(unknowingly) change its translation also (most IDE BIOS offer 3 different
translations). To fix your boot block so that you can boot normally, just put a
boot floppy in your drive (or use a bootable CDROM) and at the boot prompt,
type "b hd0a:/bsd" to force it to boot from the first hard disk (and not the
floppy). Your machine should come up normally. You now need to update the first
stage boot loader to see the new geometry (and re-write the boot block
accordingly).
d12570 1
a12570 2
etc..):
# cd /usr/mdec; ./installboot /boot biosboot sd0
d12572 1
a12572 13
If installboot complains that it is unable to read the BIOS geometry, at the
boot> prompt you may issue the "machine diskinfo" (or "ma di" for short)
command to print the information you need. Feed the "heads" and "secs" values
to installboot's -h and -s flags, respectively, so that the modified
installboot command is the following:
# cd /usr/mdec; ./installboot -h <heads> -s <secs> /boot biosboot sd0

If a newer version of bootblocks are required, you will need to compile these
yourself. To do so simply:
# cd /sys/arch/i386/stand/
# make && make install 
# cd /usr/mdec; cp ./boot /boot
# ./installboot /boot biosboot sd0 (or whatever device your hard disk is)
d12574 9
a12582 1
14.9 - Preparing for disaster: Backing up and Restoring from tape
d12588 1
a12588 1
drives fails.
d12591 3
a12593 12
utilities provided with OpenBSD. A more advanced backup utility called "Amanda"
is also available for backing up multiple servers to one tape drive. In most
environments dump(8)/restore(8) is enough. However, if you have a need to
backup multiple machines to one tape, Amanda might be worth investigating in
the future.

The device examples in this document are for a configuration that uses both
SCSI disks and tape. In a production environment, SCSI disks are recommended
over IDE due to the way in which they handle bad blocks. That is not to say
this information is useless if you are using an IDE disk or other type of tape
drive, your device names will simply differ slightly. For example sd0a would be
wd0a in an IDE based system.
d12600 4
a12603 3
# mount
/dev/sd0a on / type ffs (local)
/dev/sd0h on /usr type ffs (local)
d12606 2
a12607 2
indicates SCSI fixed disk 0, partition a. The /usr filesystem resides on sd0h,
which indicates SCSI fixed disk 0, partition h.
d12610 6
a12615 5
# mount
/dev/sd0a on / type ffs (local)
/dev/sd0d on /var type ffs (local)
/dev/sd0e on /home type ffs (local)
/dev/sd0h on /usr type ffs (local)
d12624 4
a12627 3
# /sbin/dump -0au -f /dev/nrst0 /dev/rsd0a
# /sbin/dump -0au -f /dev/nrst0 /dev/rsd0h
# mt -f /dev/rst0 rewind  
d12630 6
a12635 5
# /sbin/dump -0au -f /dev/nrst0 /dev/rsd0a
# /sbin/dump -0au -f /dev/nrst0 /dev/rsd0d
# /sbin/dump -0au -f /dev/nrst0 /dev/rsd0e
# /sbin/dump -0au -f /dev/nrst0 /dev/rsd0h  
# mt -f /dev/rst0 rewind  
d12646 1
a12646 1
Finally which partition to backup (/dev/rsd0a, etc)
a12652 1
st0 at scsibus0 targ 5 lun 0: <ARCHIVE, Python 28388-XXX, 5.28>
d12654 11
a12664 9
You may have noticed that when backing up, the tape drive is accessed as device
name "nrst0" instead of the "st0" name that is seen in dmesg. When you access
st0 as nrst0 you are accessing the same physical tape drive but telling the
drive to not rewind at the end of the job and access the device in raw mode. To
back up multiple file systems to a single tape, be sure you use the non-rewind
device, if you use a rewind device (rst0) to back up multiple file systems,
you'll end up overwriting the prior filesystem with the next one dump tries to
write to tape. You can find a more elaborate description of various tape drive
devices in the dump man page.
d12668 11
a12678 10
echo "  Starting Full Backup..."
/sbin/dump -0au -f /dev/nrst0 /dev/rsd0a
/sbin/dump -0au -f /dev/nrst0 /dev/rsd0d
/sbin/dump -0au -f /dev/nrst0 /dev/rsd0e
/sbin/dump -0au -f /dev/nrst0 /dev/rsd0h
echo
echo -n "  Rewinding Drive, Please wait..."
mt -f /dev/rst0 rewind
echo "Done."
echo
d12684 1
a12684 1
system needs to be. You can use df -h to determine how much space each
d12689 5
a12693 5
files, the best way of backing up is rebooting your system in single user mode.
File systems do not need to be mounted to be backed up. Don't forget to mount
root (/) r/w after rebooting in single user mode or your dump will fail when
trying to write out dumpdates. Enter bsd -s at the boot> prompt for single user
mode.
d12697 3
a12699 3
After you've backed up your file systems for the first time, it would be a good
idea to briefly test your tape and be sure the data on it is as you expect it
should be.
d12702 2
a12703 1
# /sbin/restore -tvs 1 -f /dev/rst0
d12711 2
a12712 1
# /sbin/restore -tvs 2 -f /dev/rst0 > /home/me/list.txt
d12737 1
a12737 1
  * Using ther fdisk(8)r command, create a primary OpenBSD partition on this
d12739 3
a12741 2
    # fdisk -e sd0
   
d12745 3
a12747 2
    # disklabel -E sd0
   
d12751 4
a12754 2
    # newfs /dev/rsd0a
    # newfs /dev/rsd0h
d12756 3
a12758 1
    # mount /dev/sd0a /mnt
d12761 4
a12764 2
    # cd /mnt
    # restore -rs 1 -f /dev/rst0
d12767 3
a12769 1
    # fdisk -i sd0
d12772 4
a12775 2
    # cp /usr/mdec/boot /mnt/boot
    # /usr/mdec/installboot -v /mnt/boot /usr/mdec/biosboot sd0
d12781 4
a12784 2
    # umount /mnt
    # halt
d12787 3
a12789 2
    boot> bsd -s
   
d12792 8
a12799 6
  * Assuming you performed the above steps correctly and nothing has gone wrong
    you should end up at a prompt asking you for a shell path or press return.
    Press return to use sh. Next, you'll want to remount root in r/w mode as
    opposed to read only. Issue the following command:
    # mount -u -w /
  * Once you have remounted in r/w mode you can continue restoring your other
d12801 9
a12809 8
    (simple mount table)
    # mount /dev/sd0h /usr; cd /usr; restore -rs 2 -f /dev/rst0
    
    (more advanced mount table)
    # mount /dev/sd0d /var; cd /var; restore -rs 2 -f /dev/rst0
    # mount /dev/sd0e /home; cd /home; restore -rs 3 -f /dev/rst0
    # mount /dev/sd0h /usr; cd /usr; restore -rs 4 -f /dev/rst0
   
d12817 1
a12817 1
14.10 - Mounting disk images in OpenBSD
d12819 11
a12829 11
To mount a disk image (ISO images, Disk images created with dd, etc) in OpenBSD
you must configure a vnd(4) device. For example, If you have an ISO image
located at /tmp/ISO.image, you would take the following steps to mount the
image.

# vnconfig svnd0 /tmp/ISO.image                                                  
# mount -t cd9660 /dev/svnd0c /mnt                                               

Notice that, since this image is a CD image you must specify type of cd9660
when mounting it. This is true, no matter what type, e.g. you must use type ffs
when mounting disk images.
d12833 2
a12834 2
# umount /mnt                                                                    
# vnconfig -u svnd0                                                              
d12838 1
a12838 1
14.11 - Help! I'm getting errors with PCIIDE!
d12840 2
a12841 3
PCI IDE DMA is unreliable with many combinations of hardware. Until recently,
most "mainstream" operating systems that claimed to support DMA transfers with
IDE drives did not ship with that feature active by default.
d12849 3
a12851 1
wd2a:  aborted command, interface CRC error reading fsbn 64 of 64-79 (wd2 bn 127; cn 0 tn 2 sn 1), retrying
d12857 919
a13775 2
If OpenBSD does not successfully downgrade, or the process causes your machine
to lock hard, please send in a bug report.
d13777 1
a13777 1
14.12 - Forcing DMA access for IDE disks
d13779 1
a13779 2
With the PCI IDE code, your chipset may not be known. If so, you will get a
message like:
d13781 742
a14522 1
    pciide0: DMA, (unused)
d14524 106
a14629 3
If you get this message, you can try and force DMA mode by using 'flags 0x0001'
on your pciide entry in your kernel config file. That would look something like
this:
d14631 1
a14631 1
    pciide* at pci ? dev ? function ? flags 0x0001
d14633 6
a14638 10
After doing this, the pciide code will try to use DMA mode regardless of
whether or not it actually knows how to do so with your chipset. If this works,
and your system makes it through fsck and startup, it is likely that this will
work for good. If this does not work, and the system hangs or panics after
booting, then you can't use DMA mode (yet, until support is added for your
chipset). Note that if you find the documentation for your PCI-IDE controller's
chipset, this is a good start to fully supporting your chipset within the
PCI-IDE code. You can look on the manufacturer's website or call them. If your
PCI-IDE controller is part of your motherboard, figure out who manufactures the
chipset and pursue their resources!
d14640 1
a14640 2
Note that you will know that DMA support has been enabled if you see this
message:
d14642 3
a14644 1
    cd0(pciide0:1:0): using PIO mode 3, DMA mode 1
d14646 8
a14653 2
This means that pciide0, channel 1, drive 0 (which appears to be an ATAPI
CD-ROM) is using DMA data transfers.
d14655 2
a14656 1
14.13 - RAID options for OpenBSD
d14658 1
a14658 5
RAID (Redundant Array of Inexpensive Disks) gives an opportunity to use
multiple drives to give better performance, capacity and/or redundancy than one
can get out of a single drive alone. While a full discussion of the benefits
and risks of RAID are outside the scope of this article, there are a couple
points that are important to make here:
d14660 4
a14663 2
  * RAID has nothing to do with backup.
  * By itself, RAID will not eliminate down-time.
d14665 4
a14668 2
If this is new information to you, this is not a good starting point for your
exploration of RAID.
d14670 2
a14671 1
Software Options
d14673 1
a14673 2
OpenBSD includes RAIDframe, a software RAID solution. Documentation for it can
be found in the following places:
d14675 2
a14676 4
  * FAQ 11, RAID
  * RAIDframe Homepage
  * man page for raidctl(8)
  * man page for raid(4)
d14678 3
a14680 3
Starting with OpenBSD 3.1, the root partition can now be directly mirrored by
OpenBSD using the "Autoconfiguration" option of RAIDframe. Previous releases of
OpenBSD could not have the root partition mirrored this way.
d14682 1
a14682 1
Hardware Options
d14684 4
a14687 3
Many OpenBSD platforms include support for various hardware RAID products. The
options vary by platform, see the appropriate hardware support page (listed 
here).
d14689 2
a14690 4
Another option available for many platforms is one of the many products which
make multiple drives act as a single IDE or SCSI drive, and are then plugged
into a standard IDE or SCSI adapter. These devices can work on virtually any
hardware platform that supports either SCSI or IDE.
d14692 1
a14692 1
Some manufacturers of these products:
d14694 2
a14695 3
  * Arco
  * Maxtronic
  * Infortrend
d14697 2
a14698 2
(Note: these are just products that OpenBSD users have reported using -- this
is not any kind of endorsement, nor is it an exhaustive list.)
d14700 1
a14700 1
Non-Options
d14702 2
a14703 6
An often asked question on the mail lists is "Is the Promise or HighPoint IDE
RAID controller supported?". The answer is "No". These cards and chips are not
true hardware RAID controllers, but rather BIOS-assisted boot of a software
RAID. As OpenBSD already supports software RAID in a hardware-independent way,
there isn't much desire among the OpenBSD developers to implement special
support for these cards.
d14705 3
a14707 2
[Back to Main Index] [To Section 13.0 - IPsec]
-------------------------------------------------------------------------------
d14709 3
a14711 3
[back] www@@openbsd.org
$OpenBSD: obsd-faq.txt,v 1.33 2003/01/05 19:29:10 nick Exp $
5.2 - Why would I want to build my own system from source?
d14713 3
a14715 5
In general, you probably do NOT want to. This is an activity for advanced users
only, rarely do ordinary users need to do this. Users who experience problems
may wish to run the -stable branch, and some users may wish to run -current if
they wish to experiment with new features or run hardware not supported by the
most recent -release.
d14717 1
a14717 3
If your goal is to run -current, those needs can usually be satisfied by simply
running the latest snapshot for your platform. It has been said above, but it
needs repeating:
d14719 2
a14720 1
    Building or upgrading a system from source is not an easy task!
d14722 2
a14723 1
However, there are reasons why you may wish to build your system from scratch:
d14725 1
a14725 3
  * You wish to install or develop new drivers or new features
  * You wish to compile the system with non-standard options
  * You wish to run -stable
d14727 231
a14957 1
There are reasons NOT to build your own kernel:
a14958 7
  * "Because I'm supposed to on every other OS" OpenBSD isn't every other OS.
  * "Because I'll get better performance if I remove unused drivers" --
    Unlikely to EVER make up for any problem caused by doing it incorrectly, if
    it is noticed at all.
  * "It will consume less memory" -- At current prices of hardware this is
    rarely a real issue...and rarely will you wish to build a system on a
    machine where it is an issue.
d14960 2
@


1.33
log
@
long-over due update to the FAQ in text file form.
@
text
@d158 1
a158 1
$OpenBSD: faq1.html,v 1.41 2003/01/01 13:01:59 nick Exp $
d479 1
a479 1
$OpenBSD: faq2.html,v 1.53 2003/01/01 13:02:00 nick Exp $
d592 1
a592 1
$OpenBSD: faq3.html,v 1.31 2003/01/01 13:02:00 nick Exp $
d2011 1
a2011 1
$OpenBSD: faq4.html,v 1.119 2003/01/01 13:02:00 nick Exp $
d2590 1
a2590 1
$OpenBSD: faq5.html,v 1.75 2003/01/01 13:02:00 nick Exp $
d4873 1
a4873 1
$OpenBSD: faq6.html,v 1.159 2003/01/01 13:02:00 nick Exp $
d5194 1
a5194 1
$OpenBSD: faq7.html,v 1.44 2003/01/01 13:02:00 nick Exp $
d6209 1
a6209 1
$OpenBSD: faq8.html,v 1.113 2003/01/04 12:38:59 nick Exp $
d6345 1
a6345 1
$OpenBSD: faq9.html,v 1.44 2003/01/01 13:02:00 nick Exp $
d7622 1
a7622 1
$OpenBSD: faq10.html,v 1.78 2003/01/01 13:01:59 nick Exp $
d8039 1
a8039 1
$OpenBSD: faq11.html,v 1.31 2003/01/01 13:01:59 nick Exp $
d8095 1
a8095 1
$OpenBSD: faq12.html,v 1.32 2003/01/01 13:01:59 nick Exp $
d9759 1
a9759 1
$OpenBSD: faq13.html,v 1.62 2003/01/01 13:01:59 nick Exp $
d10810 1
a10810 1
$OpenBSD: faq14.html,v 1.74 2003/01/01 13:02:00 nick Exp $
@


1.32
log
@effect/affect spelling confusion, Hannah Schroeter.
@
text
@d8 1
a8 1
   
d15 1
a18 1

a25 1

d28 1
a28 1
OpenBSD 3.0 runs on the following platforms:
d33 1
a33 1
  * hp300
d36 1
a36 2
  * macppc - CD bootable
  * sun3
d38 1
a38 1
  * alpha
d42 1
a42 1
boot on several hardware platforms. See section 3.0 of this FAQ for details of
d47 2
a48 2
  * arc - This port was removed from the 2.4 release. Code can be found in
    OpenBSD 2.3.
d52 2
a53 1
Multiprocessor support? See 8.12 for more info.
a76 1

a100 1

d113 2
a114 2
  * Buy an OpenBSD CD. It includes the current full release of OpenBSD, and is
    bootable on many platforms. It also generates revenue to support the
d116 1
a116 1
    deliver the distribution via the Internet. This inexpensive two-CD set
d139 3
a141 5
    project: do not waste your time engaging in operating system flame wars on
    Usenet newsgroups. It does not help the project to find new users and can
    cause substantial harm to important relationships that developers have with
    other developers.

d148 6
d158 1
a158 2
$OpenBSD: obsd-faq.txt,v 1.31 2002/03/11 00:05:13 millert Exp $

d166 1
a166 1
   
a184 1

d197 3
a199 1
included in its reply to you. It will look something like this:
d201 1
a201 1
    auth 90855167 subscribe announce you@@example.com
d214 2
a215 2
majordomo@@openbsd.org with a message body of "help". These are the
currently-available OpenBSD mailing lists:
d219 5
a223 2
  * tech - General technical discussions.
  * misc - User questions and answers.
d231 7
a237 5
Archives of the OpenBSD mailing lists can be found by visiting the mailing
lists web page: http://www.openbsd.org/mail.html
You can also get mail archives from http://www.monkey.org/cgi-bin/wilma or 
http://www.geocrawler.com/lists/4/OpenBSD. These websites contain searchable
archives of the OpenBSD mailing lists.
a248 1

d258 7
a264 7
  * help(1) - help for new users and administrators
  * afterboot(8) - things to check after the first complete boot
  * boot(8) - system boot strapping procedures
  * passwd.conf(5) - format of the password configuration file
  * adduser(8) - command for adding new users
  * vipw(8) - edit the pass word file
  * man(1) - display the on-line manual pages
d273 1
a273 1
  * boot_config(8) - how to change kernel configuration at boot
d275 1
a275 1
Also, If you are one of the people who didn't install the man30.tgz package,
d286 1
a286 1
    bsd# apropos "time zone"
d298 1
a298 1
    bsd# man -k cron
d302 1
a302 1
    bsd# man 5 crontab
d323 3
a325 3
    bsd# cd /usr/share/doc/usd/04.csh
    bsd# groff -Tascii -ms tabs csh.1 csh.2 csh.3 csh.4 csh.a csh.g > csh.txt 
    bsd# more csh.txt
a367 1

a460 3
For more information on getting the dmesg(8) output from a floppy, read FAQ
14.7 and FAQ 4.5.

d467 1
a467 5
that your system be able to deliver electronic mail successfully on the
Internet.

If you have submitted a bug report and you want to check its current status
without annoying anyone, the best ways are:
d469 4
a472 4
  * Visit the GNATS tracking system: http://cvs.openbsd.org/cgi-bin/wwwgnats.pl
    .
  * Look in the bugs@@openbsd.org list archives: http://www.openbsd.org/
    mail.html.
d479 1
a479 2
$OpenBSD: obsd-faq.txt,v 1.31 2002/03/11 00:05:13 millert Exp $

d487 1
a487 1
   
d489 4
a492 4
  * 3.1.1 - Buying OpenBSD T-Shirts
  * 3.1.2 - Where can I get an OpenBSD iso image?
  * 3.2 - Downloading via FTP or AFS
  * 3.3 - Obtaining Current Source Code
a495 1

d522 1
a522 1
3.1.1 - Buying OpenBSD T-Shirts
d524 1
a524 1
Yes, OpenBSD now has t-shirts for your wearing enjoyment. You can view these at
d527 1
a527 1
3.1.2 - Does OpenBSD provide an ISO image available for download?
d529 11
a539 7
In a word, no. The OpenBSD project does not make the ISO images used to master
the official CDs available for download. The reason is simply that we would
like you to buy the CD sets, helping fund the ongoing OpenBSD development. The
official OpenBSD CD-ROM layout is copyright Theo de Raadt. Theo does not permit
people to redistribute images of the official OpenBSD CDs. As an incentive for
people to buy the CD set, some extras are included in the package as well
(artwork, stickers etc).
d542 9
a550 7
precludes someone else to just grab OpenBSD and make their own CD. If for some
reason you want to download a CD image, try searching the mailing list archives
for possible sources. Of course, any OpenBSD ISO images available on the
Internet either violate Theo de Raadt's copyright or are not official images.
The source of an unofficial image may or may not be trustworthy, it is up to
you to determine this for yourself. We suggest that people who want to download
OpenBSD for free use the FTP install option.
d552 1
a552 1
3.2 - Downloading via FTP or AFS
d564 1
a564 1
3.3 - Obtaining Current Source Code
d574 1
a574 1
or check The OpenBSD FAQ
d585 1
a585 3
through cvsweb at:

http://www.openbsd.org/cgi-bin/cvsweb/
d592 2
a593 1
$OpenBSD: obsd-faq.txt,v 1.31 2002/03/11 00:05:13 millert Exp $
d595 1
a595 1
[OpenBSD]
a596 1
4.0 - Installation Guide
d600 1
a600 1
   
d602 27
a628 5
  * 4.2 - What files are needed for Installation?
  * 4.3 - How much space do I need for an OpenBSD installation?
  * 4.4 - Multibooting OpenBSD
  * 4.5 - Sending your dmesg to dmesg@@openbsd.org after the install
  * My install halts at MAKEDEV all on my i386 system with 8meg of RAM.
d634 11
a644 15
This FAQ now contains installation instructions for OpenBSD 2.8. There may be
differences between the 2.8 installation and installation of earlier versions
of OpenBSD.

OpenBSD has a very robust text-based install procedure. The OpenBSD install
procedure was designed to be adaptable in almost any situation that a user
could face. In addition to its robustness, the install procedure can be done
using 1 floppy disk. Each architecture's installation procedure is very
similar, however a different set of tools will often be required. Below we will
outline the different options that an OpenBSD user has when installing the
system.

The following information is architecture independent. Please refer to each
architecture's installation page or the OpenBSD CD cover for architecture
dependent installation information.
d648 1
a648 1
OpenBSD 2.9 supports a number of architectures listed below in alphabetical
d655 1
a655 1
  * i386 - Intel based PC's.
d657 1
a657 1
  * mvme68k -Motorola MVME147/16x/17x 68K VME cards.
d660 1
a660 1
  * sun3 - Sun's 68020 based Sun3 models.
d665 19
a683 18
OpenBSD has the ability to install from multiple media types. The most common
and architecture independent options are laid out below. These options can be
used after booting from either an OpenBSD CD-ROM or floppy disk. More
information on creating OpenBSD installdisks is located later in this FAQ.

+--------------------------------------------------------------------------------------------------+
|          |To do a CD-ROM install, you must have either purchased an Official OpenBSD             |
|CD-ROM    |CD-ROM or created your own OpenBSD CD. This is certainly the easiest way to            |
|          |install an OpenBSD system.                                                             |
|          |NOTE: Official OpenBSD CDs are bootable if your bios supports it.                      |
|----------+---------------------------------------------------------------------------------------|
|          |This installation option allows you to install OpenBSD by downloading the              |
|FTP       |installation packages in realtime over the network. With this option you can           |
|          |choose either a static IP for use or grab an IP via DHCP.                              |
|----------+---------------------------------------------------------------------------------------|
|Local     |This option allows you to install from files on a pre-existing filesystem.             |
|Filesystem|Support for DOS, EXT2FS and FFS are included on the install disk.                      |
+--------------------------------------------------------------------------------------------------+
d687 10
a696 8
To create an installation floppy image you must first download the correct boot
floppy image from one of the OpenBSD distribution sites. You can find a list of
FTP servers at the OpenBSD FTP Distribution page. Each architecture has one
floppy image for download except the i386 platform, which has 3 images to
choose from. The differences between the i386 platform installation floppies
will be outlined below. For the other architectures you will just need to
download the respective floppy28.fs image.
NOTE: The cdrom28.fs image can be used to make a bootable OpenBSD installation
d699 1
a699 2
The i386 platform has 3 separate installation disks that you must choose from.
The differences between each are outlined below.
d701 15
a715 33
  * floppy28.fs supports the following devices XXX -
   
    Ethernet:
      + NE2000 PCMCIA
      + 3com 3c5xx PCMCIA
      + Xircom PCMCIA
    Disk:
      + ISAPNP/PCMCIA IDE (all floppy images support ISA and PCI IDE)
      + BusLogic [57]4X SCSI
      + Adaptec 154[02] SCSI
      + Adaptec 174[024] SCSI
      + Adaptec 274X/284X/2940 SCSI
      + NCR 538XX SCSI
      + AdvanSys 1200A/B/Ultra/Ultrawide SCSI
      + Seagate ST0[12] SCSI
   
  * floppyB28.fs supports the following devices not supported by floppy28.fs:
   
    Disk:
      + Qlogic ISP [12]0x0 SCSI/FibreChannel
      + UltraStor [123]4f SCSI
      + WD7000/TMC-7000 SCSI
   
  * floppyC28.fs supports Cardbus and PCIBIOS.
   
    Ethernet:
      + 3Com 3C575TX, 3C[CX]FE575BT, and 3C[CX3]FE575CT CardBus
      + 3Com 3C[CX]FEM656, 3C[CX]FEM656B, and 3C[CX3]FEM656C CardBus
      + ADMtek AN985 Centaur-C CardBus
      + IBM EtherJet 10/100 CardBus
      + Intel PRO/100 CardBus II
   
Most i386 users will just use the floppy28.fs installation floppy.
d719 10
a728 2
fail. If you don't know, use the fdformat(1) command to both format and check
for bad sectors.
a729 4
    # fdformat /dev/fd0a                                                                                
    Format 1440K floppy `/dev/fd0a'? (y/n): y                                                           
    Processing VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV done.                                           
   
d732 1
a732 1
new one. If you are formatting in MS-DOS, simply use the DOS format command.
d735 4
a738 3
image to floppy. If you are creating this on an OpenBSD machine or another
UNIX-like OS, you can use the dd(1) utility. an example usage of dd(1) is
below:
a739 2
    # dd if=floppy28.fs of=/dev/rfd0c bs=126b                                                           
   
d741 17
a757 2
as the original with the following command. If the test passes, you will just
see another prompt.
d759 5
a763 6
    # cmp /dev/rfd0c floppy28.fs                                                                        
   
Again, if you are creating this image on the Windows/DOS platform you can get
tools from the tools directory on any of the ftp mirrors, or in 2.8/tools
directory on CD1 of the OpenBSD CD set. For users of Windows, rawrite will be
all you need to write your boot floppy.
d766 7
a772 11
   
    C:\> rawrite                                                                                        
    RaWrite 1.2 - Write disk file to raw floppy diskette                                                
                                                                                                        
    Enter source file name: floppy28.fs                                                                 
    Enter destination drive: a                                                                          
    Please insert a formatted diskette into drive A: and press -ENTER- : >Enter<                        
   
If you use NT, rawrite will not work for you. You can, however, use fdimage or
ntrw to write the boot floppy. Both of which are available on the ftp sites
(linked above), or the OpenBSD CD. Here are example usages for each program.
d775 10
a784 10
   
    C:\> fdimage -q floppy28.fs a:                                                                      
   
    Example Usage of ntrw:
   
    C:\> ntrw floppy28.fs a:                                                                            
    3.5", 1.44MB, 512 bytes/sector                                                                      
    bufsize is 9216                                                                                     
    1474560 bytes written                                                                               
   
d789 1
a789 1
instruct each user on the what to do on their respective platform.
d794 8
a801 8
    people. If you are using the floppy disk, simply stick the floppy into your
    floppy drive and boot your system. Your install image will automatically
    load. If you are planning on booting from CD, you must go into your systems
    BIOS and set the boot options to allow booting from CD. Some older BIOSs do
    not have this option, and you must use a floppy for booting your
    installation image. Don't worry though, even if you boot from floppy you
    can still install from the CD.
   
d804 3
d808 2
a809 233
    on it into your floppy drive. Then use the following command to boot from
    your floppy:
   
        ok boot floppy                                                                                      
       
    To boot from CD-ROM, place your OpenBSD CD-ROM disk into your drive. If
    your Sun only has one CD-ROM drive, then just go to the boot prompt, where
    you can 'boot cdrom':
   
        ok boot cdrom                                                                                       
       
    Of course, this will only work in new command mode. If you are at the old
    command mode prompt (a right arrow), type 'n' for the new command mode. (If
    you are using an old sparc that is pre-sun4c, you probably don't have a new
    command mode. In this case, you need to experiment.) If you have multiple
    CD-ROM devices, you need to boot from the correct one. Try probe-scsi from
    the new command mode.
   
        ok probe-scsi                                                                                       
        Target 0                                                                                            
        Unit 0 Disk QUANTUM LIGHTNING 365S                                                                  
        Target 1                                                                                            
        Unit 0 Removable Disk QUANTUM EMPIRE_1080S                                                          
        Target 3                                                                                            
        Unit 0 Removable Disk Joe's CD ROMs                                                                 
       
    Figure out which disk is the CD ROM you want to boot from. Note the target
    number.
   
        ok boot /sbus/esp/sd@@X,0                                                                            
       
    Now that your bootdisk has been created, it's time to boot it. When you
    boot this floppy, the kernel and all of the programs that OpenBSD uses to
    install itself are loaded into memory. If problems arise, and your bootdisk
    doesn't boot, the problem is probably due to a bad floppy disk. This is an
    extremely common problem! If your bootdisk fails to boot, try it a second
    time, and if it fails again, throw away the floppy and get a new one. When
    your floppy fails to boot, even if the floppy worked fine for you before,
    keep in mind that OpenBSD uses nearly every single bit available from the
    floppy! Any error in the disk will prevent OpenBSD from loading.
   
    When your boot is successful, you will see a lot of white on blue text,
    that text is the kernel telling you what devices have been found, and
    where. Then, you will see the following:
   
        rootdev=0x1100 rrootdev=0x2f00 rawdev=0x2f02                                                        
        Enter pathname of shell or RETURN for sh:                                                           
        erase ^?, werase ^W, kill ^U, intr ^C                                                               
        (I)nstall, (U)pgrade or (S)hell? i                                                                  
        ==================================================                                                  
        Welcome to the OpenBSD/i386 2.8 installation program.                                               
                                                                                                            
        This program is designed to help you put OpenBSD on your disk in a simple and                       
        rational way.                                                                                       
                                                                                                            
        As with anything which modifies your disk's contents, this program can cause                        
        SIGNIFICANT data loss, and you are advised to make sure your data is backed                         
        up before beginning the installation process.                                                       
                                                                                                            
        Default answers are displayed in brackets after the questions. You can hit                          
        Control-C at any time to quit, but if you do so at a prompt, you may have                           
        to hit return. Also, quitting in the middle of installation may leave your                          
        system in an inconsistent state. If you hit Control-C and restart the                               
        install, the install program will remember many of your old answers.                                
                                                                                                            
        You can run a shell command at any prompt via '!foo'                                                
        or escape to a shell by simply typing '!'.                                                          
                                                                                                            
        Specify terminal type [pcvt25]: <Enter>                                                             
       
    Depending on the architecture you are using, the terminal type you use
    might be different. For example, OpenBSD/sparc uses the "sun" terminal
    type.
   
4.1.5 - Setting up disks during installation.

Setting up disks in OpenBSD is fairly similar for each platform. For i386, disk
setup is done in two stages. One is with fdisk(8) and the other with disklabel
(8).

    The installation program needs to know which disk to consider the root disk.                        
    Note the unit number may be different than the unit number you used in the                          
    boot program (especially on a PC with multiple disk controllers).                                   
    Available disks are:                                                                                
                                                                                                        
    wd0                                                                                                 
                                                                                                        
    Which disk is the root disk? [wd0] <Enter>                                                          
    Do you want to use the *entire* disk for OpenBSD? [no] yes                                          
                                                                                                        
    [...]                                                                                               
   
This is the section in the install where you choose which disk you want as your
"root" disk. Your root disk will be where the / filesystem and swap will be. 
wd0 specifies an IDE disk; if your disks are SCSI you will most likely see sd0.
There should be an entry for each disk that OpenBSD finds. If you choose to
allot the whole disk to OpenBSD, the installation program will automatically
setup the diskspace for you; however, if you choose not to give the whole disk
to OpenBSD, you will be placed in a disk editor, ie fdisk(8). For more
information on using fdisk(8), refer to section 14.2.

NOTE: OpenBSD does NOT support any sort of journaling filesystems like
ReiserFS, IBM's JFS or SGI's XFS. Instead we use Soft Updates. The filesystem
for OpenBSD is FFS.

    Inside the BIOS 'A6' ('OpenBSD') partition you just created, there resides an                       
    OpenBSD partition table which defines how this BIOS partition is to be split                        
    up. This table declares the offsets and sizes of your / partition, your swap                        
    space, and any other partitions you might create. (NOTE: The OpenBSD disk                           
    label offsets are absolute, ie. relative to the start of the disk... NOT                            
    relative to the start of the BIOS 'A6' partition).                                                  
                                                                                                        
    disklabel: no disk label                                                                            
    WARNING: Disk wd0 has no label. You will be creating a new one.                                     
                                                                                                        
    If this disk is shared with other operating systems, those operating systems                        
    should have a BIOS partition entry that spans the space they occupy completely.                     
    For safety, also make sure all OpenBSD file systems are within the offset and                       
    size specified in the 'A6' BIOS partition table. (By default, the disklabel                         
    editor will try to enforce this). If you are unsure of how to use multiple                          
    partitions properly (ie. separating /, /usr, /tmp, /var, /usr/local, and other                      
    things) just split the space into a root and swap partition for now.                                
                                                                                                        
    # using MBR partition 3: type A6 off 63 (0x3f) size 16450497 (0xfb03c1)                             
                                                                                                        
    Treating sectors 63-80041248 as the OpenBSD portion of the disk.                                    
    You can use the 'b' command to change this.                                                         
    Initial label editor (enter '?' for help at any prompt)                                             
    > ?                                                                                                 
    Available commands:                                                                                 
            p [unit]  - print label.                                                                    
            M         - show entire OpenBSD man page for disklabel.                                     
            e         - edit drive parameters.                                                          
            a [part]  - add new partition.                                                              
            b         - set OpenBSD disk boundaries.                                                    
            c [part]  - change partition size.                                                          
            d [part]  - delete partition.                                                               
            g [d|b]   - Use [d]isk or [b]ios geometry.                                                  
            m [part]  - modify existing partition.                                                      
            n [part]  - set the mount point for a partition.                                            
            r         - recalculate free space.                                                         
            u         - undo last change.                                                               
            s [path]  - save label to file.                                                             
            w         - write label to disk.                                                            
            q         - quit and save changes.                                                          
            x         - exit without saving changes.                                                    
            X         - toggle expert mode.                                                             
            ? [cmnd]  - this message or command specific help.                                          
    Numeric parameters may use suffixes to indicate units:                                              
            'b' for bytes, 'c' for cylinders, 'k' for kilobytes, 'm' for megabytes,                     
            'g' for gigabytes or no suffix for sectors (usually 512 bytes).                             
            Non-sector units will be rounded to the nearest cylinder.                                   
    Entering '?' at most prompts will give you (simple) context sensitive help.                         
    > p                                                                                                 
    device: /dev/rwd0c                                                                                  
    type: ESDI                                                                                          
    disk: ESDI/IDE disk                                                                                 
    label: Maxtor 54098U8                                                                               
    bytes/sector: 512                                                                                   
    sectors/track: 63                                                                                   
    tracks/cylinder: 16                                                                                 
    sectors/cylinder: 1008                                                                              
    cylinders: 16383                                                                                    
    total sectors: 80041248                                                                             
    free sectors: 80041185                                                                              
    rpm: 3600                                                                                           
                                                                                                        
    16 partitions:                                                                                      
    # size offset fstype [fsize bsize cpg]                                                              
    a: 16450497 63 unused 0 0                                                                           
    c: 80041248 0 unused 0 0                                                                            
    > d a                                                                                               
    > a a                                                                                               
    offset: [63] <Enter>                                                                                
    size: [80041185] 80m                                                                                
    Rounding to nearest cylinder: 164241                                                                
    FS type: [4.2BSD] <Enter>                                                                           
    mount point: [none] /                                                                               
    > a b offset: [164304] <Enter>                                                                      
    size: [79876944] 300m                                                                               
    Rounding to nearest cylinder: 614880 FS type: [swap] <Enter>                                        
    > a d                                                                                               
    offset: [779184] <Enter>                                                                            
    size: [79262064] 80m                                                                                
    Rounding to nearest cylinder: 164304 FS type: [4.2BSD] <Enter>                                      
    mount point: [none] /tmp                                                                            
    > a e                                                                                               
    offset: [943488] <Enter>                                                                            
    size: [79097760] 80m                                                                                
    Rounding to nearest cylinder: 164304 FS type: [4.2BSD] <Enter>                                      
    mount point: [none] /var                                                                            
    > a g                                                                                               
    offset: [1107792] <Enter>                                                                           
    size: [78933456] 350m                                                                               
    Rounding to nearest cylinder: 716688 FS type: [4.2BSD] <Enter>                                      
    mount point: [none] /usr                                                                            
    > a h                                                                                               
    offset: [1824480] <Enter>                                                                           
    size: [78216768] <Enter>                                                                            
    FS type: [4.2BSD] <Enter>                                                                           
    mount point: [none] /home                                                                           
    > p                                                                                                 
    device: /dev/rwd0c                                                                                  
    type: ESDI                                                                                          
    disk: ESDI/IDE disk                                                                                 
    label: Maxtor 54098U8                                                                               
    bytes/sector: 512                                                                                   
    sectors/track: 63                                                                                   
    tracks/cylinder: 16                                                                                 
    sectors/cylinder: 1008                                                                              
    cylinders: 16383                                                                                    
    total sectors: 80041248                                                                             
    free sectors: 0                                                                                     
    rpm: 3600                                                                                           
                                                                                                        
    16 partitions:                                                                                      
    #        size   offset    fstype   [fsize bsize   cpg]                                              
      a:   164241       63    4.2BSD     1024  8192    16  # /                                          
      b:   614880   164304      swap                                                                    
      c: 80041248        0    unused        0     0                                                     
      d:   164304   779184    4.2BSD     1024  8192    16  # /tmp                                       
      e:   164304   943488    4.2BSD     1024  8192    16  # /var                                       
      g:   716688  1107792    4.2BSD     1024  8192    16  # /usr                                       
      h: 78216768  1824480    4.2BSD     1024  8192    16  # /home                                      
    > w                                                                                                 
    > q                                                                                                 
    No label changes.                                                                                   
   
Notice how each mount point is split onto its own partition. For a multiuser
machine, it is best to make at least five separate filesystems, one for your /
filesystem, one for swap, one for /var, one for /tmp, and one for /usr. If your
users are going to store files of any significant size, you want a separate /
home filesystem too.
d811 1
a811 1
4.1.6 - Configuring your mount points and formating your filesystems
d813 608
a1420 13
There are four main reasons for using separate filesystems, instead of shoving
everything into one or two filesystems:

  * Security: You can mark some filesystems as 'nosuid', 'nodev', 'noexec',
    'readonly', etc..
  * Stability: A user, or a misbehaved program, can fill a filesystem with
    garbage, if they have write permissions for it. Your critical programs,
    which of course run on a different filesystem, do not get interrupted.
  * Speed: A filesystem which gets written to frequently may get somewhat
    fragmented. (Luckily, the ffs filesystem, what OpenBSD uses, is not prone
    to heavy fragmentation.)
  * Integrity: If one filesystem is corrupted for some reason then your other
    filesystems are still OK.
d1422 19
a1440 65
Setting up your mount points is much more simple than it looks. After you setup
your filesystems with disklabel, you will see text like the one below. This
should be done for you automatically if you configured your mount points via
disklabel(8). If you did not, you can do so here.

    You will now have the opportunity to enter filesystem information for wd0.                          
    You will be prompted for the mount point (full path, including the prepending                       
    '/' character) for each BSD partition on wd0.  Enter "none" to skip a                               
    partition or "done" when you are finished.                                                          
                                                                                                        
    The following partitions will be used for the root filesystem and swap:                             
            wd0a    /                                                                                   
            wd0b    swap                                                                                
                                                                                                        
    Mount point for wd0d (size=82152k) [/tmp, RET, none, or done]? <Enter>                              
    Mount point for wd0e (size=82152k) [/var, RET, none, or done]? <Enter>                              
    Mount point for wd0g (size=358344k) [/usr, RET, none, or done]? <Enter>                             
    Mount point for wd0h (size=39108384k) [/home, RET, none, or done]? <Enter>                          
    Mount point for wd0d (size=82002k) [/tmp, RET, none, or done]? done <Enter>                         
                                                                                                        
    Now you can select another disk to initialize.  (Do not re-select a disk                            
    you have already entered information for).  Available disks are:                                    
                                                                                                        
    wd0                                                                                                 
                                                                                                        
    Which one? [done] <Enter>                                                                           
                                                                                                        
    You have configured the following devices and mount points:                                         
                                                                                                        
    wd0a /                                                                                              
    wd0d /tmp                                                                                           
    wd0e /var                                                                                           
    wd0g /usr                                                                                           
    wd0h /home                                                                                          
                                                                                                        
    ============================================================                                        
    The next step will overwrite any existing data on:                                                  
            wd0a wd0d wd0e wd0g wd0h                                                                    
                                                                                                        
    Are you really sure that you're ready to proceed? [n] y                                             
    Creating filesystems...                                                                             
    Warning: 64 sector(s) in last cylinder unallocated                                                  
    /dev/rwd0a:     164240 sectors in 163 cylinders of 16 tracks, 63 sectors                            
            80.2MB in 11 cyl groups (16 c/g, 7.88MB/g, 1920 i/g)                                        
    /dev/rwd0d:     164304 sectors in 163 cylinders of 16 tracks, 63 sectors                            
            80.2MB in 11 cyl groups (16 c/g, 7.88MB/g, 1920 i/g)                                        
    /dev/rwd0e:     164304 sectors in 163 cylinders of 16 tracks, 63 sectors                            
            80.2MB in 11 cyl groups (16 c/g, 7.88MB/g, 1920 i/g)                                        
    /dev/rwd0g:     716688 sectors in 711 cylinders of 16 tracks, 63 sectors                            
            349.9MB in 45 cyl groups (16 c/g, 7.88MB/g, 1920 i/g)                                       
    /dev/rwd0h:     78216768 sectors in 77596 cylinders of 16 tracks, 63 sectors                        
            38191.8MB in 4850 cyl groups (16 c/g, 7.88MB/g, 1920 i/g)                                   
   
Notice this answer defaults to no, so you will have to directly tell it to
format your labels. If you chose no, you would simply be dropped into a shell
and could start the install again by typing install, or just by rebooting again
with your bootdisk. At this point it will format all filesystems for you. This
could take some time depending on the size of your disk.

4.1.7 - Configuring your Network

Now it's time to setup your network configuration. This is extremely important
if you are planning on doing any network based install, considering it will be
based upon the information you are about to enter. Here is a walkthrough of the
network configuration section of the install process.
a1441 41
    You will now be given the opportunity to configure the network.  This will be                       
    useful if you need to transfer the installation sets via FTP, HTTP, or NFS.                         
    Even if you choose not to transfer installation sets that way, this information                     
    will be preserved and copied into the new root filesystem.                                          
                                                                                                        
    Configure the network [y] <Enter>                                                                   
    Enter system hostname (short form): [] mybox                                                        
    Enter DNS domain name: [] someisp.com                                                               
                                                                                                        
    If you have any devices being configured by a DHCP server                                           
    it is recommended that you do not enter a default route or                                          
    any name servers.                                                                                   
                                                                                                        
    You may configure the following network interfaces (the interfaces                                  
    marked with [X] have been successfully configured):                                                 
                                                                                                        
            [ ] fxp0                                                                                    
                                                                                                        
    Configure which interface? (or, enter 'done') [fxp0] <Enter>                                        
    IP address (or 'dhcp') ? [] 199.185.137.55                                                          
    Symbolic (host) name? [test2] <Enter>                                                               
    Netmask ? [255.255.255.0] <Enter>                                                                   
    Your use of the network interface may require non-default                                           
    media directives.  The default media is:                                                            
            media: Ethernet autoselect (100baseTX full-duplex)                                          
    This is a list of supported media:                                                                  
            media autoselect                                                                            
            media 100baseTX mediaopt full-duplex                                                        
            media 100baseTX                                                                             
            media 10baseT mediaopt full-duplex                                                          
            media 10baseT                                                                               
    If the default is not satisfactory, and you wish to use another                                     
    media, copy that line from above (e.g. "media 100baseTX")                                           
    Media directives? [] <Enter>                                                                        
                                                                                                        
    You may configure the following network interfaces (the interfaces                                  
    marked with [X] have been successfully configured):                                                 
                                                                                                        
            [X] fxp0                                                                                    
    Configure which interface? (or, enter 'done') [done] <Enter>                                        
   
d1444 6
a1449 1
from a remote dhcp server.
d1451 1
a1451 5
    Enter IP address of default route: [none] 199.185.137.128                                           
    Enter IP address of primary nameserver: [none] 199.185.137.1                                        
    Would you like to use the nameserver now? [y] <Enter>                                               
   
4.1.8 - Choosing Installation Media
d1454 18
a1471 33
any changes to your network setup. (Mainly if errors were produced.) Then the
filesystems you created will be mounted and a root password set. This will get
your local disks ready for the OpenBSD packages to be installed upon them.
After your local disks are ready you will get a chance to choose your
installation media. The options are listed below.

    You will now be given the opportunity to escape to the command shell to do                          
    any additional network configuration you may need.  This may include adding                         
    additional routes, if needed.  In addition, you might take this opportunity                         
    to redo the default route in the event that it failed above.                                        
    Escape to shell? [n] <Enter>                                                                        
                                                                                                        
    /dev/wd0a on /mnt type ffs (rw, asynchronous, local)                                                
    /dev/wd0d on /mnt/tmp type ffs (rw, asynchronous, local)                                            
    /dev/wd0e on /mnt/var type ffs (rw, asynchronous, local)                                            
    /dev/wd0g on /mnt/usr type ffs (rw, asynchronous, local)                                            
    /dev/wd0h on /mnt/home type ffs (rw, asynchronous, local)                                           
                                                                                                        
    Please enter the initial password that the root account will have.                                  
    Password (will not echo): <Your Password Here!>                                                     
    Password (again): <Your Password Here!>                                                             
                                                                                                        
    Do you expect to run the X Window System? [y] <Enter>                                               
                                                                                                        
    It is now time to extract the installation sets onto the hard disk.  Make sure                      
    the sets are either on a local device (i.e. tape, CD-ROM) or on a network                           
    server.  You will have the chance to repeat this step or to extract sets from                       
    several places, so you don't have to try to load all the sets in one try and                        
    can recover from some errors.                                                                       
                                                                                                        
    Install from (f)tp, (h)ttp, (t)ape, (C)D-ROM, (N)FS or local (d)isk? c                              
   
In this example we are installing via CD-ROM. This will bring up a list of
d1473 2
a1474 21
one; if you don't, you need to make sure you pick the device which you will use
to install OpenBSD from. After choosing the correct device, you will be
prompted for which filesystem the installation files will reside on. If you are
using the OpenBSD CD-ROM you will choose 'c' here, for 'c' represents the whole
disk. Here is an example:

    The following CD-ROM devices are installed on your system; please make                              
    sure the CD is in the CD-ROM drive and select the device containing                                 
    the CD with the installation sets:                                                                  
                                                                                                        
    cd0                                                                                                 
                                                                                                        
    Which CD-ROM contains the installation media? [cd0] <Enter>                                         
   
Now you will be prompted for which filesystem to use when reading the CD-ROM,
and in which directory the installation files are. If you are using the
official OpenBSD CD-ROM, you will use 'cd9660' as your filesystem. (Which is
the default.) You will then be using '/2.8/i386/' as the directory in which the
files reside. (Again, this is the default option.) After this you will get a
list of packages to install. You can get a description of these files in 
section 4.2. Here is what you will be seeing:
d1476 15
a1490 1
4.1.9 - Choosing installation packages and finishing the install.
d1493 45
a1537 71
description of these files in faq4.2. The files that the installdisk finds will
be shown to you on the screen. Your job is just to specify which files you
want. By default only 4 packages are selected. These are 'base28.tar.gz',
'etc28.tar.gz', 'man28.tar.gz' and 'bsd'. This is because these first 3 files
MUST be present for you to have any sort of a functional system, the 'bsd' file
is the kernel of the system. The rest are left up to your discretion. The
example below is that of a full install, minus the games package.

    Enter the directory relative to the mount point that                                                
    contains the file. [/2.8/i386] <Enter>                                                              
                                                                                                        
    You will now be asked for files to extract.  In addition to the                                     
    files listed in the selector you may enter any file located in                                      
    /mnt2//2.8/i386.  You can also enter 'all' to install all the standard                              
    sets, or 'list' to list the files available in /mnt2//2.8/i386.                                     
    When you are done selecting files, enter 'done'.                                                    
    Some of these sets are required for your install and some are optional --                           
    You will want at least the base and bsd sets.                                                       
    Consult the installation notes if you are not sure which sets are required!                         
                                                                                                        
    The following sets are available for extraction.                                                    
    Enter filename, `list', `all', or `done'.                                                           
    You may de-select a set by prepending a '-' to its name.                                            
                                                                                                        
            [X] base28.tgz                                                                              
            [X] etc28.tgz                                                                               
            [ ] misc28.tgz                                                                              
            [ ] comp28.tgz                                                                              
            [X] man28.tgz                                                                               
            [ ] game28.tgz                                                                              
            [ ] xbase28.tgz                                                                             
            [ ] xshare28.tgz                                                                            
            [ ] xfont28.tgz                                                                             
            [ ] xserv28.tgz                                                                             
            [X] bsd                                                                                     
    File name? [] *                                                                                     
                                                                                                        
    The following sets are available for extraction.                                                    
    Enter filename, `list', `all', or `done'.                                                           
    You may de-select a set by prepending a '-' to its name.                                            
                                                                                                        
            [X] base28.tgz                                                                              
            [X] etc28.tgz                                                                               
            [X] misc28.tgz                                                                              
            [X] comp28.tgz                                                                              
            [X] man28.tgz                                                                               
            [X] game28.tgz                                                                              
            [X] xbase28.tgz                                                                             
            [X] xshare28.tgz                                                                            
            [X] xfont28.tgz                                                                             
            [X] xserv28.tgz                                                                             
            [X] bsd                                                                                     
    File name? [] -game*                                                                                
                                                                                                        
    The following sets are available for extraction.                                                    
    Enter filename, `list', `all', or `done'.                                                           
    You may de-select a set by prepending a '-' to its name.                                            
                                                                                                        
            [X] base28.tgz                                                                              
            [X] etc28.tgz                                                                               
            [X] misc28.tgz                                                                              
            [X] comp28.tgz                                                                              
            [X] man28.tgz                                                                               
            [ ] game28.tgz                                                                              
            [X] xbase28.tgz                                                                             
            [X] xshare28.tgz                                                                            
            [X] xfont28.tgz                                                                             
            [X] xserv28.tgz                                                                             
            [X] bsd                                                                                     
    File name? [] done                                                                                  
   
d1542 137
a1678 2
are installing OpenBSD on. After this your configuration files ( networking and
filesystem ) will be moved onto your disks also from the installdisk.
d1680 5
a1684 101
    /mnt2//2.8/i386/base28.tgz:                                                                         
    100% |**************************************************| 21192 KB    00:00 ETA                     
    /mnt2//2.8/i386/etc28.tgz:                                                                          
    100% |**************************************************|   987 KB    00:00 ETA                     
    /mnt2//2.8/i386/man28.tgz:                                                                          
    100% |**************************************************|  4957 KB    00:00 ETA                     
    /mnt2//2.8/i386/bsd:                                                                                
    100% |**************************************************|  3053 KB    00:00 ETA                     
    /mnt2//2.8/i386/misc28.tgz:                                                                         
    100% |**************************************************|  1644 KB    00:00 ETA                     
    /mnt2//2.8/i386/comp28.tgz:                                                                         
    100% |**************************************************| 14406 KB    00:00 ETA                     
    /mnt2//2.8/i386/xbase28.tgz:                                                                        
    100% |**************************************************|  5504 KB    00:00 ETA                     
    /mnt2//2.8/i386/xshare28.tgz:                                                                       
    100% |**************************************************|  1538 KB    00:00 ETA                     
    /mnt2//2.8/i386/xfont28.tgz:                                                                        
    100% |**************************************************|  6019 KB    00:00 ETA                     
    /mnt2//2.8/i386/xserv28.tgz:                                                                        
    100% |**************************************************| 15035 KB    00:00 ETA                     
                                                                                                        
    Extract more sets? [n] <Enter>                                                                      
   
Once this is done, all that's left is to set your timezone and install the
bootblocks. Setting your timezone is extremely easy. Just pick the area you
live in and enter the name. That's it!. Only one more question, which is
whether or not you will be running X on this server. If you plan to ever run X
on this server you should choose yes, otherwise you might have to change
machdep.allowaperture=0 into machdep.allowaperture=1 in your etc/sysctl.conf(5)
. After this is all done, just type 'reboot' at the shell prompt and your
machine will be booted with OpenBSD!

    Copying fstab, hostname.fxp0, hosts, myname, mygate, resolv.conf,  ...done.                         
                                                                                                        
    Select a time zone for your location. Timezones are represented on the system                       
    by a directory structure rooted in "/usr/share/timezone". Most timezones can                        
    be selected by entering a token like "MET" or "GMT-6".  Other zones are                             
    grouped by continent or country, with detailed zone information separated by                        
    a slash ("/"), e.g. "US/Pacific" or "Canada/Mountain".                                              
                                                                                                        
    To get a listing of what's available in /usr/share/zoneinfo, enter "?"                              
    at the prompts below.                                                                               
                                                                                                        
    What timezone are you in? [`?' for list] [GMT] ?                                                    
    Africa/      Chile/       GB-Eire      Israel       NZ-CHAT      Turkey                             
    America/     Cuba         GMT          Jamaica      Navajo       UCT                                
    Antarctica/  EET          GMT+0        Japan        PRC          US/                                
    Arctic/      EST          GMT-0        Kwajalein    PST8PDT      UTC                                
    Asia/        EST5EDT      GMT0         Libya        Pacific/     Universal                          
    Atlantic/    Egypt        Greenwich    MET          Poland       W-SU                               
    Australia/   Eire         HST          MST          Portugal     WET                                
    Brazil/      Etc/         Hongkong     MST7MDT      ROC          Zulu                               
    CET          Europe/      Iceland      Mexico/      ROK          posixrules                         
    CST6CDT      Factory      Indian/      Mideast/     Singapore                                       
    Canada/      GB           Iran         NZ           SystemV/                                        
    What timezone are you in? [`?' for list] [GMT] Canada                                               
    There are several timezones available within zone 'Canada'                                          
    Select a sub-timezone [`?' for list]: ?                                                             
    Atlantic            Eastern             Pacific                                                     
    Central             Mountain            Saskatchewan                                                
    East-Saskatchewan   Newfoundland        Yukon                                                       
    There are several timezones available within zone 'Canada'                                          
    Select a sub-timezone [`?' for list]: Mountain                                                      
    You have selected timezone "Canada/Mountain".                                                       
    Installing timezone link.                                                                           
    Making all device nodes (by running /dev/MAKEDEV all) ...... done.                                  
    Installing boot block...                                                                            
    boot: /mnt/boot                                                                                     
    proto: /usr/mdec/biosboot                                                                           
    device: /dev/rwd0c                                                                                  
    /usr/mdec/biosboot: entry point 0                                                                   
    proto bootblock size 512                                                                            
    room for 12 filesystem blocks at 0x16f                                                              
    Will load 7 blocks of size 8192 each.                                                               
    Using disk geometry of 63 sectors and 255 heads.                                                    
     0: 20 @@(0 108 44) (6847-6866)                                                                      
     1: 63 @@(0 109 1) (6867-6929)                                                                       
     2: 13 @@(0 110 1) (6930-6942)                                                                       
     3:  5 @@(0 9 59) (625-629)                                                                          
     4: 11 @@(0 10 1) (630-640)                                                                          
    /mnt/boot: 5 entries total                                                                          
    using MBR partition 3: type 166 (0xa6) offset 63 (0x3f)                                             
                                                                                                        
    Enabling machdep.allowaperture. Read xf86(4) for more information.                                  
                                                                                                        
    Unmounting filesystems... /mnt/home /mnt/usr /mnt/var /mnt/tmp /mnt ... Done.                       
    Done.                                                                                               
                                                                                                        
    CONGRATULATIONS!  You have successfully installed OpenBSD!  To boot the                             
    installed system, enter halt at the command prompt. Once the system has                             
    halted, reset the machine and boot from the disk.                                                   
                                                                                                        
    # reboot                                                                                            
   
After your reboot

This section will hopefully point you in the right direction for clues on what
to do initially after you have installed your OpenBSD system. This is basically
modeled after the afterboot(8) man page. Which should definitely be one of your
first steps after installing OpenBSD. Here is a table which will point you to
relevant FAQ sections.
d1690 2
a1691 1
  * OpenBSD Packages - Precompiled Binary Packages.
d1693 1
a1693 2
Just to remind people, it's important for the OpenBSD developers to keep track
of what hardware works, and what hardware doesn't work perfectly..
d1695 2
a1696 10
A quote from /usr/src/etc/root/root.mail
If you wish to ensure that OpenBSD runs better on your machines, please do us
a favor (after you have your mail system setup!) and type
        dmesg | mail dmesg@@openbsd.org
so that we can see what kinds of configurations people are running.  We will
use this information to improve device driver support in future releases.
(We would be much happier if this information was for the supplied GENERIC
kernel; not for a custom compiled kernel).  The device driver information
we get from this helps us fix existing drivers.
Also check with section 14.7
d1698 1
a1698 10
Make sure you send the email from an account that is able to also receive
email, so that developers can contact you back if they have something they want
you to test or change in order to get your setup working. It's not important at
all to send the email from the same machine that is running OpenBSD, so if that
machine is unable to receive email, just
 dmesg | mail your-account@@yourmail.dom
and then forward that message to
 dmesg@@openbsd.org
where your-account@@yourmail.dom is your regular email account. (or transfer the
dmesg output using ftp/scp/floppydisk/carrier-pigeon/...)
d1700 2
a1701 4
NOTE - Please send only GENERIC kernel dmesgs. Custom kernels that have device
drivers removed are not helpful.

Other Information Resources and Popular Questions
d1703 2
a1704 3
Comprehensive documents already exist for those of you who might have different
    machines. You can retrieve these from any of the mirror ftp sites.
  * INSTALL.i386 - Comprehensive installation document.
d1713 1
a1713 1
Question: - Does OpenBSD provide an ISO image available for download?
d1715 14
a1728 46
Answer: - No. The official OpenBSD CD-ROM layout is a copyright of Theo de
Raadt, as an incentive for people to buy the CD set. Note that only the layout
is copyrighted, OpenBSD itself is free. Nothing precludes someone else to just
grab OpenBSD and make their own CD.

Question: - I'm having problems installing with 8meg of RAM. What can i do
here?

Answer: - Many people are having a problem at the end of the install where the
system stalls on MAKEDEV all .... There is a workaround for this. Basically you
need to turn on swap during the install. To do this do as described below:

  * Start the Install as normal
  * Setup your disks via fdisk(8) and disklabel(8) as described above.
  * After your disks are setup, and AFTER they've been formatted, type <CNTRL>
    -C to break into a shell.
  * type reboot to reboot the machine.
  * This time, skip through the fdisk(8) and disklabel(8) sections. You can do
    this by typing just exit in fdisk(8) and by typing q in disklabel(8).
  * Proceed through the install until you have completed the Networking Section
    of the install. NOTE: This is after all packages have been installed. When
    you get here type <CNTRL>-z, which will put you into a shell.
  * Here is where swap needs turned on. To do so type /mnt/sbin/swapctl -a /dev
    /wd0b or /dev/sd0b, or whatever your swap device is.
      + If this isn't found, mount your root disk at /mnt.
  * Now you can type fg to proceed through the rest of the install.

If you followed these instructions and still have problems mail Eric Jackson
<ericj@@openbsd.org>.

4.2 - What files are needed for Installation?

There are many packages containing the OpenBSD binaries, but which ones do you
need to get your system up and running? Here is an overview of each package.

  * base28.tgz - Has the base OpenBSD system Required
  * etc28.tgz - Has all the files in /etc Required
  * comp28.tz - Has the compiler and its tools, libs. Recommended
  * man28.tgz - Holds man pages Recommended
  * misc28.tgz - Holds misc info, setup docs
  * game28.tgz - Has the games for OpenBSD
  * xbase28.tgz - Has the base install for X11
  * xfont28.tgz - Holds X11's font server and fonts
  * xlink28.tgz - Has the X servers link kit
  * xserv28.tgz - Has X11's X servers
  * xshare28.tgz - Has manpages, locale settings, includes, etc for X
d1731 1
a1731 1
4.3 - How much space do I need for an OpenBSD installation?
d1733 3
a1735 3
The following are suggested sub-tree sizes for a full system install. The
numbers include enough extra space to permit you to run a typical home system
that is connected to the internet.
d1737 1
a1737 1
  * For a multiuser system, you probably want to triple these values.
d1745 3
d1753 1
d1755 16
a1770 8
    alpha           56M     540M    27M     161M
    amiga           45M     399M    24M      36M
    hp300           31M     234M    24M      47M
    i386            35M     229M    24M      72M
    mac68k          29M     232M    24M      36M
    mvme68k         29M     232M    24M       -  (no Xserver)
    pmax            50M     355M    24M      60M
    sparc           40M     259M    24M      49M
d1781 1
a1781 1
There are four main reasons for using separate filesystems, instead of shoving
d1785 2
a1786 1
    'readonly', etc..
d1788 1
a1788 1
    garbage, if they have write permissions for it. Your critical programs,
d1795 44
d1840 2
a1841 13
4.4 - Multibooting OpenBSD (i386, alpha)

OpenBSD & NT (or XP)

To multiboot OpenBSD and NT (or XP), you can use NTloader, the bootloader
that NT uses.  To multi-boot with NT, you need a copy of your OpenBSD pbr.
After running installboot, you can copy it something like this:

        # dd if=/dev/rsd0c of=openbsd.pbr bs=512 count=1

Now boot NT and put openbsd.pbr in c:. Add a line like this to the end of c:\
boot.ini:

d1848 2
a1849 2
On Windows XP you can also edit the boot information using the GUI, see the
XP Boot.ini HOWTO at http://support.microsoft.com/default.aspx?scid=kb;EN-US;q289022
d1851 1
a1851 1
OpenBSD & Windows or DOS (i386)
d1855 2
a1856 2
bootloaders of choice are osbs20b8.zip or The Ranish Partition Manager. Both of
these are able to boot OpenBSD partitions.
d1858 1
a1858 1
OpenBSD & Linux (i386)
d1860 1
a1860 1
Please refer to INSTALL.linux, which gives indepth instructions on getting
d1863 1
a1863 1
4.5 - Sending your dmesg to dmesg@@openbsd.org after the install
d1866 1
a1866 1
of what hardware works, and what hardware doesn't work perfectly..
a1876 1
Also check with section 14.7
d1883 1
a1883 1
 dmesg | mail your-account@@yourmail.dom
d1892 114
d2011 2
a2012 1
$OpenBSD: obsd-faq.txt,v 1.31 2002/03/11 00:05:13 millert Exp $
d2014 1
a2014 1
[OpenBSD]
a2015 1
5.0 - Kernel configuration
a2018 7
   
  * 5.1 - Why do I need a custom kernel?
  * 5.2 - Kernel configuration Options
  * 5.3 - Building your own kernel
  * 5.4 - Boot-time configuration
  * 5.5 - Getting more verbose output during boot
  * 5.6 - Using config(8) to change your kernel binary
d2020 126
a2145 1
-------------------------------------------------------------------------------
d2147 2
d2150 1
a2150 1
5.1 - Why would I want to create my own custom kernel?
d2157 3
a2159 3
  * Remove default options or add options which may not have been enabled by
    default
  * Enable experimental options
d2167 3
d2171 1
a2171 1
5.2 - Kernel Configuration Options
d2176 1
a2176 1
There are multitudes of options that allow you to customize your kernel. Here
d2185 1
a2185 1
arch/<your arch>/conf/GENERIC and /usr/src/sys/conf/GENERIC.
d2189 1
a2189 2
  * mac68k Kernel Configuration files
  * pmax Kernel Configuration Files
d2191 2
d2199 2
a2200 2
to look through /sys/conf/GENERIC and see what you want. There ARE options in
there that are NEEDED.
d2212 3
a2214 3
OpenBSD has a great many compatibility options which allow you to use binaries
from other OS's. Not all are availably on every architecture, so be sure to
read the man pages for each option to see if your arch is supported.
d2222 1
a2222 1
  * COMPAT_HPUX - Compatibility with HP-UX binaries. Only available on some
d2225 5
a2229 4
  * COMPAT_OSF1 - Run Digital Unix binaries. Available only on Alpha platform.
  * COMPAT_43 - Compatibility with 4.3BSD. Use of this is certainly
    discouraged, But it is needed for our Navigator port
  * COMPAT_11 - Compatibility with NetBSD 1.1
d2235 1
a2235 1
where a bug might be present. This well help the developers discover the source
d2239 3
a2241 3
  * DDB - This compiles in the in-kernel debugger. This isn't available on all
    platforms. So be sure to read before adding it.
  * KGDB - Compiles a remote kernel debugger using gdb's `remote target`
d2256 1
a2256 1
  * FFS - Berkeley Fast Filesystem NOTE: This option is required
d2259 1
a2259 1
  * MFS - Memory File System that stores files in swapable memory.
d2262 1
a2262 1
    from CDs
d2265 2
a2266 2
  * FDESC - Includes code for a file system which can be mounted on /dev/fd
  * KERNFS - Includes code which permits the mounting of a special file system
d2270 1
a2270 1
    information
d2272 1
a2272 1
    /proc)
d2284 2
a2285 3
  * LFS - Log Structured Filesystem.
  * FFS_SOFTUPDATES - Allows for the use of softupdates. To read up on
    softupdates more read the Softupdates FAQ section.
d2290 1
a2290 1
  * FIFO - Support for FIFOs.. RECOMMENDED.
d2298 1
a2298 1
    10
a2306 1
  * XSERVER - Support for the X server console driver. Needed for X.
d2315 3
a2317 3
    is 8. For more on CCD read the CCD(4) man page, or the Performance Tuning
    FAQ section.
  * KMEMSTATS - This makes malloc(9), the kernel memory allocator keep
d2320 1
a2320 1
  * BOOT_CONFIG - Adds support of the -c boot option.
d2333 1
a2333 1
    REQUIRED
d2336 1
a2336 1
  * NS - Include support for the Xerox XNS protocol stack. See ns(4)
a2353 6
  * IPFILTER - This option enables the IP filtering on the packet level using
    the ipfilter package.
  * IPFILTER_LOG - This option, in conjunction with IPFILTER, enables logging
    of IP packets using ip-filter.
  * IPFILTER_DEFAULT_BLOCK - This option sets the default policy of ip-filter.
    If it is set, ip-filter will block packets by default.
d2370 1
a2370 1
5.3 - Building your own kernel
d2376 11
a2386 7
available. You just need the kernel source to be able to compile the kernel,
and this source code is available on the cd. Here is how to copy the sources
from the cd. This example assumes that CD1 is mounted on /mnt.

    # mkdir -p /usr/src/sys
    # cd /mnt/sys
    # tar cf - . | ( cd /usr/src/sys; tar xvf - )
d2389 5
a2393 5
kernel. This is located at /usr/src/sys/arch/${arch}/conf/GENERIC, where $
{arch} is your architecture. There are other sample configurations available in
that directory as well. Here are two examples for compiling your kernel. The
first example is compiling your kernel on a read-only source tree. The second
on a writable source tree.
d2397 1
a2397 1
    # vi SOMEFILE (to make the changes you want)
d2399 3
a2401 10
    
        # make depend 
        
            (The above step is necessary when you have made any changes [including updates
            and patches] to your kernel source tree.  This step can be ignored
            if you follow the next step.)
        
        
        OR
        
a2402 6
        
            (The above step is necessary if you make changes to your kernel configuration
            options, and is also recommended if you make major updates to your source tree.
            You can ignore this step otherwise, and just use 'make depend'.)
        
    
d2405 9
d2416 1
a2416 1
    # cd /sys/arch/$ARCH/conf
d2418 1
a2418 1
    # config SOMEFILE (read more about it here : config(8))
d2420 1
a2420 1
    # make 
d2430 1
a2430 1
To revert to your old kernel at boot you need to just
d2437 2
a2438 2
bootblocks. To do so, read faq14.8 on OpenBSD's Bootloader. Which will give you
an overview on using OpenBSD's Bootloader
d2440 1
a2440 1
5.4 - Boot Time Configuration
d2451 1
a2451 1
Most of this document can be found in the man page boot_config(8)
d2463 10
a2472 18
add device - Add a device through copying another

change devno | device - Modify one or more devices

disable devno | device - Disable one or more devices

enable devno | device - Enable one or more devices

find devno | device - Find one or more devices

help - Short summary of these commands

list - List ALL known devices

exit/quit - Continue Booting

show [attr [val]] - Show devices with an attribute and optional with a
specified value
d2478 1
a2478 1
5.5 - Getting more verbose output during boot
d2491 1
a2491 1
5.6 - Using config(8) to change your kernel
d2493 13
a2505 14
With 2.6 came the introduction of the -e and -u options with config(8). These
options can be extremely helpful and save wasted time compiling your kernel.
The -e flag allows you to enter the UKC or User Kernel Config on a running
system. These changes will then take place on your next reboot. The -u flag
tests to see if any changes were made to the running kernel during boot.
Meaning you used boot -c to enter the UKC while booting your system.

The following example shows the disabling of the ep* devices from the kernel.
For safety's sake you must use the -o option which writes the changes out to
the file specified. For example : config -e -o bsd.new /bsd will write the
changes to bsd.new. The example doesn't use the -o option, therefore changes
are just ignored, and not written back to the kernel binary. For more
information pertaining to error and warning messages read the config(8) man
page.
d2508 2
a2509 2
    OpenBSD 2.6 (GENERIC) #1: Tue Nov 16 21:25:10 EST 1999
        ericj@@oshibana:/usr/src/sys/arch/i386/compile/GENERIC
d2514 6
a2519 6
            add     dev                     Add a device
            base    8|10|16                 Base on large numbers
            change  devno|dev               Change device
            disable attr val|devno|dev      Disable device
            enable  attr val|devno|dev      Enable device
            find    devno|dev               Find device
d2521 2
a2522 2
            lines   count                   # of lines per page
            show    [attr [val]]            Show attribute
d2525 6
d2532 25
a2556 20
      0 audio* at sb0|sb*|gus0|pas0|sp0|ess*|wss0|wss*|ym*|eap*|eso*|sv*
      1 midi* at sb0|sb*|opl*|opl*|opl*|ym*|mpu*
      2 nsphy* at xe*|ef*|sf*|xl*|tl*|rl*|fxp* phy -1
      3 inphy* at xe*|ef*|sf*|xl*|tl*|rl*|fxp* phy -1
      4 iophy* at xe*|ef*|sf*|xl*|tl*|rl*|fxp* phy -1
      5 exphy* at xe*|ef*|sf*|xl*|tl*|rl*|fxp* phy -1
      6 rlphy* at xe*|ef*|sf*|xl*|tl*|rl*|fxp* phy -1
      7 icsphy* at xe*|ef*|sf*|xl*|tl*|rl*|fxp* phy -1
      8 sqphy* at xe*|ef*|sf*|xl*|tl*|rl*|fxp* phy -1
      9 ukphy* at xe*|ef*|sf*|xl*|tl*|rl*|fxp* phy -1
     10 scsibus* at bt0|bt1|bt2|aha0|aha1|aha*|ahb*|ahc0|ahc*|ahc*|isp*|aic0|aic*|ncr*|adv*|adw*|sea0|uha0|uha1|uha*|wds0|atapiscsi*
     11 cd* at scsibus* target -1 lun -1
     12 ch* at scsibus* target -1 lun -1
     13 sd* at scsibus* target -1 lun -1
     14 st* at scsibus* target -1 lun -1
     15 ss* at scsibus* target -1 lun -1
     16 uk* at scsibus* target -1 lun -1
     17 atapiscsi* at wdc0|wdc1|wdc*|wdc*|pciide* channel -1
    --- more ---   
    [snip]
d2558 8
a2565 8
     31 ep0 disabled
     32 ep* disabled
     33 ep* disabled
     87 ep0 disabled
     88 ep0 disabled
     89 ep* disabled
     90 ep* disabled
    136 ep* disabled
d2569 1
a2569 1
In the above example, all ep* devices are removed from the kernel and will not
d2578 2
a2579 2
    OpenBSD 2.6 (GENERIC) #1: Tue Nov 16 21:25:10 EST 1999
        ericj@@oshibana:/usr/src/sys/arch/i386/compile/GENERIC
d2581 2
a2582 1
    151 wi* disabled
a2587 1

d2590 1
a2590 1
$OpenBSD: obsd-faq.txt,v 1.31 2002/03/11 00:05:13 millert Exp $
d2594 1
d2598 1
a2598 1
   
d2609 1
a2612 1

d2621 4
a2624 4
IP networking, you really need to read Understanding IP addressing. This is an
excellent document. Understanding IP addressing contains fundamental knowledge
to build upon when working with IP networks, especially when you deal with or
are responsible for more than one network.
d2641 17
a2657 43
seeing your network interface using the ifconfig(8) command. For example, Here
is the output of dmesg for a ne2k network card, which uses the device name ne
(4).

    ne3 at pcmcia1 function 0 "Linksys, EtherFast 10/100 PC Card (PCMPC100), " port 0x340/16 irq 9
    ne3: address 00:e0:98:04:95:ba

If you don't know what your device name is, here is a list of common cards and
their device names.

  * ne2000 Network Cards - ne
  * 3Com EtherLink III and Fast EtherLink III Ethernet - ep
  * 3Com EtherLink XL and Fast EtherLink XL Ethernet (3C9xx) - xl
  * Intel 82586 chip Ethernet device driver - ie
    Which Includes Cards Such As:
      + 3Com 3C507
      + AT&T StarLAN 10
      + AT&T EN100
      + AT&T StarLan Fiber
      + Intel EtherExpress 16
  * DEC/Intel 21142/3 and clone 10/100 Ethernet driver - dc
    Note: Some drivers which were in OpenBSD 2.6, such as mx, ax, al and pn
        have been replaced by this driver.
        Which Includes Cards Such As:
      + Intel 21142/21143 (formerly manufactured by DEC)
      + Macronix 98713, 98713A, 98715, 98715A and 98725
      + Davicom DM9100 and DM9102
      + ASIX Electronics AX88140A and AX88141
      + ADMtek AL981 Comet and AN985 Centaur
      + Lite-On 82c168 and 82c169 PNIC
      + Lite-On/Macronix 82c115 PNIC II
       
        If you are upgrading to OpenBSD 3.0 from 2.6 or an older release of
        OpenBSD, you need to pay attention here. Any references in /etc/
        ifaliases, /etc/pf.conf(5), /etc/nat.conf(5) to the old interface names
        mx, al, ax, or pn must be replaced with dc. Also, any hostname.xxx
        files with the old interface names must be renamed to hostname.dcX to
        be recognized. Replace the X with the interface number.
  * Lucent Technologies WaveLAN/IEEE 802.11DS - wi
  * Aironet Communications 4500/4800 IEEE 802.11DS - an

Again, you can check to see what interfaces have been identified by using the 
ifconfig(8) utility. Here is output which will show an ne2k device.
d2660 8
a2667 5
    lo0: flags=8009<UP,LOOPBACK,MULTICAST>
            inet 127.0.0.1 netmask 0xff000000
    lo1: flags=8008<LOOPBACK,MULTICAST>
    ne3: flags=8863<UP,BROADCAST,NOTRAILERS,RUNNING,SIMPLEX,MULTICAST>
            media: Ethernet manual
d2669 29
a2697 17
    sl0: flags=c010<POINTOPOINT,LINK2,MULTICAST>
    sl1: flags=c010<POINTOPOINT,LINK2,MULTICAST>
    ppp0: flags=8010<POINTOPOINT,MULTICAST>
    ppp1: flags=8010<POINTOPOINT,MULTICAST>
    tun0: flags=10<POINTOPOINT>
    tun1: flags=10<POINTOPOINT>
    enc0: flags=0<>
    bridge0: flags=0<>
    bridge1: flags=0<>

As you can see here, ifconfig(8) gives us a lot more information than we are
needing at this point. But it still allows us to see our interface. In the
above example, the interface card is already configured. You can tell this by
seeing that values are already set in "inet 10.0.0.38 netmask 0xffffff00
broadcast 10.0.0.255", and that the UP and RUNNING flags are turned on. Also,
you will notice many other interfaces. Here is a list of interfaces that will
be expected to be there.
d2700 1
d2705 4
a2708 1
  * bridge - Ethernet bridge interface
d2711 5
a2715 5
etc/hostname.${IF} file. Where the name of your interface will take the place
of ${IF}. From the information in the examples above, the name would be /etc/
hostname.ne3. The layout of this file is like so:
(To read more about the format of this file, reference the hostname.if(5) man
page.)
d2717 2
a2718 1
    [address_family] [your_ip] [your_netmask] [media options]
d2720 2
a2721 1
So, for the above example, a proper file would look like this:
d2723 1
a2723 1
    $ cat /etc/hostname.ne3
d2726 17
a2742 2
Next step from here is to setup your gateway. To do this, simply put the IP of
your gateway in the file /etc/mygate. This will allow for your gateway to be
d2765 4
a2768 3
Notice that a few errors were produced, but they are concerned with the
loopback interface, so they can be ignored. From here your system should be up
and running. Again, you can check to make sure that your interface was setup
d2777 1
a2777 1
    default            10.0.0.1           UGS         0       86      -  ne3
d2780 2
a2781 2
    10.0.0/24          link#1             UC          0        0      -  ne3
    10.0.0.1           aa:0:4:0:81:d      UHL         1        0      -  ne3
d2807 1
a2807 1
addresses from network service providers and regional registries, you may want
d2827 1
a2827 1
zebra. OpenBSD has support in the ports collection for both gated and mrtd.
a2832 2
Starting with OpenBSD 2.8, /etc/ifaliases is no longer used!

d2857 2
a2858 2
    inet alias 192.168.0.3 255.255.255.255 NONE
    inet alias 192.168.0.4 255.255.255.255 NONE
d2876 15
a2890 2
Note: Packet Filter is the filtering system in OpenBSD 3.0 and later. If you
are looking for the IPF/IPNAT FAQ for OpenBSD 2.9 and before, click here.
d2894 1
a2894 2
external addresses. The configuration files for these two services are /etc/
pf.conf(5) and /etc/nat.conf(5).
d2909 1
a2909 2
    # pfctl -R /etc/pf.conf
    # pfctl -N /etc/nat.conf
d2912 2
a2913 3
The first line sets up filtering, using /etc/pf.conf and the second sets up
NAT, using /etc/nat.conf (more on NAT later in Section 6.3, NAT), and finally,
the last line activates PF.
d2917 1
a2917 1
    # pfctl -R /etc/pf.conf -N /etc/nat.conf -e
d2920 1
a2920 1
rules by reloading the appropriate file:
d2922 1
a2922 1
    # pfctl -R /etc/pf.conf
d2924 4
a2927 4
This document will cover some basic pf.conf(5) and nat.conf(5) configurations
below. You can also look at the resulting ruleset that includes all the tweaks
explained below in more detail. You can find other Packet Filter information at
the Packet Filter web site and in the Packet Filter HOWTO.
d2971 1
a2971 1
    block in on fxp0 inet proto tcp from any to any port = 3306
d2979 1
a2979 1
by the "block in port = 3306" rule. If you reversed the order of our incoming
d2983 1
a2983 1
    block in on fxp0 inet proto tcp from any to any port = 3306
d2995 1
a2995 1
    block in quick on fxp0 inet proto tcp from any to any port = 3306
d3015 5
a3019 5
    pass in quick on fxp0 inet proto tcp from any to any port = 22
    pass in quick on fxp0 inet proto tcp from any to any port = 80
    pass in quick on fxp0 inet proto tcp from any to any port = 443
    block in quick on fxp0 from any to any
    pass out on fxp0 from any to any
d3027 5
a3031 5
    pass in quick on fxp0 inet proto tcp from 1.1.1.0/24 to any port = 22
    pass in quick on fxp0 inet proto tcp from any to any port = 80
    pass in quick on fxp0 inet proto tcp from any to any port = 443
    block in quick on fxp0 from any to any
    pass out on fxp0 from any to any
d3036 1
a3036 1
    pass in quick on fxp0 inet proto tcp from 1.1.1.0/24 to any port = 22
d3040 1
a3040 1
    pass in quick on fxp0 inet proto tcp from 1.1.1.1/32 to any port = 22
d3049 4
a3052 8
    block in quick on fxp0 inet from 127.0.0.0/8 to any
    block in quick on fxp0 inet from 192.168.0.0/16 to any
    block in quick on fxp0 inet from 172.16.0.0/12 to any
    block in quick on fxp0 inet from 10.0.0.0/8 to any
    block out quick on fxp0 inet from any to 127.0.0.1/8
    block out quick on fxp0 inet from any to 192.168.0.0/16
    block out quick on fxp0 inet from any to 172.16.0.0/12
    block out quick on fxp0 inet from any to 10.0.0.0/8
d3058 4
a3061 8
    block in quick on fxp0 inet from 127.0.0.0/8 to any
    block in quick on fxp0 inet from 192.168.0.0/16 to any
    block in quick on fxp0 inet from 172.16.0.0/12 to any
    block in quick on fxp0 inet from 10.0.0.0/8 to any
    block out quick on fxp0 inet from any to 127.0.0.1/8
    block out quick on fxp0 inet from any to 192.168.0.0/16
    block out quick on fxp0 inet from any to 172.16.0.0/12
    block out quick on fxp0 inet from any to 10.0.0.0/8
d3064 1
a3064 1
    pass in quick on fxp0 inet proto tcp from 1.1.1.1/32 to any port = 22
d3067 2
a3068 2
    pass in quick on fxp0 inet proto tcp from any to any port = 80
    pass in quick on fxp0 inet proto tcp from any to any port = 443
d3082 2
a3083 2
    pass in quick on fxp0 inet proto tcp from 1.1.1.1/32 to any port = 22
    block in log quick on fxp0 inet proto tcp from any to any port = 22
d3116 78
d3201 1
a3201 1
    pass in quick on fxp0 inet proto { tcp, udp } from any to any port = 53
d3206 2
a3207 2
    pass in quick on fxp0 inet proto tcp from any to any port = 53
    pass in quick on fxp0 inet proto udp from any to any port = 53
d3211 6
a3216 4
As some OSs and applications have trouble with abnormal or fragmented packets,
it is sometimes beneficial to normalize the packets before they are passed on
to their ultimate destination. This is done with the scrub directive, used as
here:
d3220 3
a3222 3
As this does put additional load on the system, there is no reason to use this
command unless this system is protecting a computer with a poor TCP/IP
implementation
d3231 1
a3231 1
    pass in quick on fxp0 allow-opts
d3260 9
a3268 9
automagically allow incoming connections in response to connections we
initiate, such as when web browsing. Remember, we do need to specify what
protocol we are keeping state for.

    pass in quick on fxp0 inet proto tcp from 1.1.1.0/24 to any port = 22
    pass in quick on fxp0 from any to any port = 80
    pass in quick on fxp0 from any to any port = 443
    block in quick on fxp0 from any to any
    pass out on fxp0 inet proto tcp from any to any keep state
d3276 15
a3290 9
complete, we need only allow packets with the SYN and SYNACK flags set. By
passing only packets with SYN and SYNACK set, we can prevent many forms of
portscanning such as FIN scanning. The rules now look like this:

    pass in quick on fxp0 inet proto tcp from 1.1.1.0/24 to any port = 22
    pass in quick on fxp0 inet proto tcp from any to any port = 80 flags S/SA
    pass in quick on fxp0 inet proto tcp from any to any port = 443 flags S/SA
    block in quick on fxp0 from any to any
    pass out on fxp0 proto tcp from any to any keep state
d3304 4
a3307 8
    block in quick on fxp0 inet from 127.0.0.0/8 to any
    block in quick on fxp0 inet from 192.168.0.0/16 to any
    block in quick on fxp0 inet from 172.16.0.0/12 to any
    block in quick on fxp0 inet from 10.0.0.0/8 to any
    block out quick on fxp0 inet from any to 127.0.0.1/8
    block out quick on fxp0 inet from any to 192.168.0.0/16
    block out quick on fxp0 inet from any to 172.16.0.0/12
    block out quick on fxp0 inet from any to 10.0.0.0/8
d3309 3
a3311 2
    # only allow our machines to connect via ssh
    pass in quick on fxp0 inet proto tcp from 1.1.1.0/24 to any port = 22
d3314 4
a3317 5
    pass in quick on fxp0 inet proto tcp from any to any port = 80 flags S/SA
    pass in quick on fxp0 inet proto tcp from any to any port = 443 flags S/SA
    
    # finally lock the rest down with a default deny
    block in quick on fxp0 from any to any
d3320 6
a3325 1
    pass out on fxp0 from any to any keep state
d3334 1
a3334 2
multiple protocols, such as BIND, which uses TCP and UDP? Normally, you would
have to do something like this:
d3336 1
a3336 6
    pass in quick on fxp0 inet proto tcp from any to any port = 53
    pass in quick on fxp0 inet proto udp from any to any port = 53

but instead, you could use PF's set notation to simplify this:

    pass in quick on fxp0 inet proto { tcp, udp } from any to any port = 53
d3345 1
a3345 12
    block in quick on fxp0 inet from 127.0.0.0/8 to any
    block in quick on fxp0 inet from 192.168.0.0/16 to any
    block in quick on fxp0 inet from 172.16.0.0/12 to any
    block in quick on fxp0 inet from 10.0.0.0/8 to any
    block out quick on fxp0 inet from any to 127.0.0.1/8
    block out quick on fxp0 inet from any to 192.168.0.0/16
    block out quick on fxp0 inet from any to 172.16.0.0/12
    block out quick on fxp0 inet from any to 10.0.0.0/8

they could be consolidated into two lines:

    block in quick on fxp0 inet from { 127.0.0.1/8, 192.168.0.0/16, \
d3347 1
a3347 1
    block out quick on fxp0 inet from any to { 127.0.0.1/8, 192.168.0.0/16, \
d3356 1
a3356 1
    NoRouteIPs="{ 127.0.0.1/8, 192.168.0.0/16, 172.16.0.0/12, 10.0.0.0/8 }"
d3368 1
a3368 1
    NoRouteIPs="{ 127.0.0.1/8, 192.168.0.0/16, 172.16.0.0/12, 10.0.0.0/8 }"
d3375 1
a3375 1
    block in quick on $ExtIF from $NoRouteIPs to any
d3378 3
a3380 2
    # only allow our machines to connect via ssh
    pass in quick on $ExtIF inet proto tcp from $IntNet to any port = 22
d3383 2
a3384 4
    pass in quick on $ExtIF inet proto tcp from any to any port $Services flags S/SA
    
    # finally lock the rest down with a default deny
    block in quick on $ExtIF from any to any
d3387 6
a3392 1
    pass out on $ExtIF from any to any keep state
d3397 1
a3397 1
    pass in log quick on fxp0 from 1.1.1.0/24 to any port = 22
d3399 1
a3399 1
pflogd(8) will write to ip log entries to /var/log/pflog. Remember that /var/
a3405 20
Differences between PF and IPF

Packet Filter (PF) was designed to be very compatible with IPF's ipf.rules
file. However, PF is not, nor was it intended to be, a drop-in replacement for
IPF. This section details some of the differences between these systems.

  * group and head: These options are no longer used, as the filter rules are
    optimized on the fly. If you are migrating your old rulesets from IPF, you
    should delete any group or head definitions and manually reorder your
    rules, making sure their semantics haven't changed.
  * level: When logging, PF does not accept a level option to the log keyword,
    as logging is not performed by syslogd(8), but by a separate logging
    daemon. To examine a particular kind of traffic, as might have been done
    with level option, use any of the available options of tcpdump(8).
  * keep frags: This has been replaced by the normalization the scrub option
    performs.
  * @@n Rules: PF does not support prepending rules with @@n to insert them into
    particular points in the rule list as IPF does. To view the rule numbers PF
    has assigned, use the command pfctl -sr

d3408 2
a3409 2
Note: Packet Filter is the filtering system in OpenBSD 3.0 and later. If you
are looking for the IPF/IPNAT FAQ for OpenBSD 2.9 and before, click here.
a3426 1

a3432 2
Computer Operating System: OpenBSD v3.0 i386
   
d3435 9
a3443 9
        Connected to the EXTERNAL LAN (or WAN)
        IP Address: 24.5.0.5
        Netmask: 255.255.255.0
       
        Compaq Netelligent 10/100Mb tl0
        Connected to the INTERNAL LAN
        IP Address: 192.168.1.1
        Netmask: 255.255.255.0
   
d3447 3
a3449 3
        Netmask: 255.255.255.0
        Gateway: 24.5.0.1
   
d3452 6
a3457 7
        addressing scheme 192.168.1.xxx (where xxx is a unique number). There
        could be a variety of different operating systems on the internal
        network, such as Windows 98, Windows NT, OpenBSD and Linux, but the
        client OS is not an issue for NAT. For the examples, the client we will
        look at on the internal network will be assumed to have an IP address
        of 192.168.1.40.
   
d3459 15
a3473 16
        +-----+              +---------+          +----------+
        | Hub |--------- tl0 |   NAT   | fxp0 ----| Internet |
        +-----+              +---------+          +----------+
        | |
        | +-- Client A
        +---- More clients 
        
                              +--------------------------+
                              |          LEGEND          |
                              +--------------------------+
                              |  NIC fxp0 - 24.5.0.5     |
                              |  NIC tl0  - 192.168.1.1  |
                              | Client A  - 192.168.1.35 |
                              +--------------------------+
        

a3476 1

a3520 1

a3540 1

a3558 1

d3568 1
a3568 1
Again, for more information you can read FAQ 6.2
d3570 3
a3572 2
The NAT configuration file (/etc/nat.conf). has a very simple syntax. For the
configuration set forth above, the file should contain the following entry:
a3578 1
   
d3580 1
a3580 1
   
a3581 1
   
d3583 1
a3583 1
   
a3584 1
   
d3588 1
a3588 1
   
a3589 1
   
d3592 1
a3592 1
   
d3602 1
a3602 1
    # pfctl -N /etc/nat.conf
a3612 1

a3614 1

a3628 1
   
d3632 1
a3632 1
   
a3633 1
   
d3636 1
a3636 1
   
a3637 1
   
d3639 1
a3639 1
   
a3640 1
   
d3642 1
a3642 1
   
d3651 2
a3652 2
the the FTP server will make a connection to on the client and transfer the
info. This is a problem for users attempting to gain access to FTP servers from
d3673 1
a3673 1
(8). To activate it, put something like this in your /etc/nat.conf file:
d3675 1
a3675 1
    rdr on tl0 from any to any port 21 -> 127.0.0.1 port 8081
d3677 3
a3679 3
Short explanation of this line is, "Traffic on the internal interface is
redirected to the proxy server running on this machine which is listening at
port 8081".
d3684 1
a3684 1
    8081 stream tcp nowait root /usr/libexec/ftp-proxy ftp-proxy
d3691 3
a3693 4
You will note that ftp-proxy is listening on port 8081, the same port the above
rdr statement was sending FTP traffic to. The choice of port 8081 is arbitrary,
though 8081 is a good choice, as it is not defined for any other application.

d3709 1
a3709 1
line similar to the following one to your /etc/nat.conf:
d3711 1
a3711 1
    rdr on fxp0 from any to any port 80 -> 192.168.1.80 port 80
a3715 1
   
d3718 1
a3718 1
   
a3719 1
   
d3721 1
a3721 1
   
a3722 1
   
d3725 1
a3725 1
   
a3726 1
   
d3732 1
a3732 1
   
a3733 1
   
d3737 1
a3737 1
    rdr on fxp0 from any to any port 8080 -> 192.168.1.35 port 80
d3740 1
a3740 1
   
d3754 1
a3754 1
    rdr on tl0 from any to ! 64.12.163.199 port 21 -> 127.0.0.1 port 8081
d3758 1
a3758 1
8081 (where hopefully ftp-proxy is waiting). Now, be advised that there are
a3762 1

d3779 96
d3879 1
a3879 1
  * /etc/nat.conf - NAT rules file
d3885 1
a3885 1
  * nat.conf man page
a3888 1

d3898 1
d3906 1
d3911 1
a3911 1
uncommenting the 'require' lines in it (they are examples of the default
d3915 1
d3924 3
a3926 2
# echo xl1 xl2 xl3 >/etc/dhcpd.interfaces
Then, edit /etc/dhcpd.conf. The options are pretty self explanatory.
d3936 1
a3936 1
This will tell your dhcp clients that the domain to append to DNS requests is
d3944 1
a3944 1
If you want to start dhcpd from the command line, after editing /etc/
d3946 1
a3946 3
# dhcpd -q fxp0
Where fxp0 is an interface that you want to start serving dhcp on. The -q flag
makes dhcpd quiet, otherwise it is very noisy.
d3948 4
a3951 1
If you are serving DHCP to a Windows box, you may want to dhcpd to give the
d3954 2
a3955 1
option  netbios-name-servers    192.168.92.55;
d3968 1
a3968 1
will need some simple information about your isp. Here is a list of helpful
d3981 1
a3981 1
Also, make sure, that if your not using a GENERIC kernel, that you have this
a4001 5
NOTICE - On OpenBSD 2.6, the system shipped with a /etc/ppp/ppp.conf.example
that had an incorrect setting for device. The device was "set device /dev/
cuaa0". This should be /dev/cua00 which would correspond to serial device 1.
(COM1). Your device might not be on COM1, however the naming scheme was wrong.

d4044 1
a4044 1
here set to 255.255.255.0.If triggeraddr is specified, it is used in place of
d4063 1
a4063 1
    to your isp and then go into the background.
d4081 1
a4081 2
Extended information can be found at http://www.freebsd.org/handbook/
userppp.html or http://www.freebsd.org/faq/userppp.html.
d4096 1
d4120 1
a4120 1
   sysctl -w net.inet.tcp.baddynamic=749,750,751,760,761,871
d4124 2
a4125 2
   sysctl -w net.inet.tcp.baddynamic=+748
   sysctl -w net.inet.tcp.baddynamic=-871
d4152 8
d4174 1
a4174 1
This means that the local filesystem /work will be made available via NFS. 
d4197 1
a4197 1
start mountd(8), simply type:
d4199 1
d4226 1
a4226 1
is happening with NFS. One is showmount(8) , which allows you to view what is
d4358 1
a4358 1
        configuration factor which typically is controlled at the next level up
d4448 1
a4448 2
    @@       IN      SOA     nemo.yewtopia.com.
    your_id.nemo.yewtopia.com.  (
d4460 1
a4460 2
    yewtopia.com.        IN      SOA     nemo.yewtopia.com.
    your_id.nemo.yewtopia.com.  (
d4477 1
a4477 2
    1.168.192.in-addr.arpa. IN      SOA     nemo.yewtopia.com.
    your_id.nemo.yewtopia.com.  (
d4518 1
a4518 1
    $ dig @@nemo.yewtopia yewtopia any any
d4527 1
a4527 1
    ;;      yewtopia, type = ANY, class = ANY
d4530 1
a4530 2
    yewtopia.        3600   SOA     nemo.yewtopia.
    your_id.nemo.yewtopia. (
d4536 1
a4536 1
    yewtopia.        3600   NS      nemo.yewtopia.
d4539 1
a4539 1
    nemo.yewtopia.   3600   A       192.168.1.9
d4542 1
a4542 1
    ;; FROM: nemo to SERVER: nemo.yewtopia.  192.168.1.9
a4646 1

d4666 2
a4667 4
To start off, you need to install pptp. A port was added to the OpenBSD ports
tree AFTER the release of OpenBSD 2.8 and works fine with with the OpenBSD 2.8
ports tree. The port is located at /usr/ports/net/pptp. Read FAQ 8.6 for more
information on the OpenBSD ports tree.
d4672 2
a4673 2
Patch to remove GRE(4) support.
    Index: sys/conf/GENERIC
d4676 17
a4692 16
    retrieving revision 1.66
    diff -u -r1.66 GENERIC
    --- sys/conf/GENERIC    2000/10/13 04:21:14     1.66
    +++ sys/conf/GENERIC    2000/12/26 19:55:31
    @@@@ -97,6 +97,6 @@@@
     pseudo-device  ksyms   1   # kernel symbols device
     pseudo-device  bridge  2   # network bridging support
     #pseudo-device vlan    2   # IEEE 802.1Q VLAN
    -pseudo-device  gre     1   # GRE encapsulation interface
    +#pseudo-device gre     1   # GRE encapsulation interface
    
     option             BOOT_CONFIG     # add support for boot -c

To recompile your kernel, check out OpenBSD 2.8-stable via cvs (refer to 
OpenBSD Stable web page for more information), apply the following patch, and
rebuild your kernel as per FAQ 5.3.
d4697 1
a4697 1
Also, refer to FAQ 6.5.
d4728 1
a4728 1
to you. Read more about setting up interfaces in FAQ 6.1.
d4731 1
a4731 1
with the command.
d4739 1
a4739 1
    % kill -9 [pid of pptp]
d4749 119
d4873 2
a4874 1
$OpenBSD: obsd-faq.txt,v 1.31 2002/03/11 00:05:13 millert Exp $
d4876 1
a4876 1
[OpenBSD]
a4877 1
7.0 - Keyboard Controls
d4881 2
a4882 2
   
  * 7.1 - How do I remap the keyboard?
d4885 5
a4889 2
  * 7.4 - Accessing the console scrollback buffer.
  * 7.5 - Why doesn't F9 through F12 switch consoles on i386 anymore?
d4894 1
a4894 3
7.1 - How do I remap the keyboard? (wscons specific)

The ports that use the wscons(4) console driver: alpha, i386, and macppc.
d4896 2
a4897 4
For OpenBSD 3.0 and after:

Since OpenBSD 2.9, OpenBSD changed to using the wscons(4) console driver. In
OpenBSD 2.8 and earlier, the pcvt(4) console driver was used.
d4922 1
a4922 16
For OpenBSD 2.8 and earlier:

By using kcon(1), "kcon - keyboard control and remapping for the pcvt driver".
Before you can use this, you need to turn on character mapping with scon(1).

Example:

    # scon -o
    # kcon -m gb

This will load the keycap file for Great Britain. Note that if you run scon -o
again, this will turn character mapping back off, which you probably don't want
to do if you are using kcon for remapping. Keep this in mind if you use scon in
any automated fashion, such as in scripts.

These commands can only be executed from a pcvt virtual terminal.
d4926 3
a4928 6
For platforms using the wscons(4) console driver, there is a port of FreeBSD's
moused(8). The original port of moused(8) was done for OpenBSD 2.7 using the 
pcvt(4) console driver, it was then later changed to use wscons. The daemon was
renamed to wsmoused(8), and is packaged with OpenBSD 2.9 and later by default.

The architectures that wsmoused(8) should work on are: alpha, i386, and macppc.
d4944 1
a4944 12
7.4 - Accessing the Console Scrollback Buffer (alpha/macppc/i386 specific)

Ever since OpenBSD 2.6, there has been the ability to access the console
scrollback buffer. This allows you to see information that has already scrolled
past your screen. To be able to move up and down in the buffer, simply use the
key combination:

To move up:

    "[shift]+[pgup]"

To move back down:
d4946 3
a4948 1
    "[shift]+[pgdn]"
d4950 1
a4950 1
The default scrollback buffer, or the amount of pages that you can move up and
d4953 1
a4953 1
7.5 - Why doesn't F9 through F12 switch consoles anymore? (i386 specific)
d4955 233
a5187 4
In OpenBSD 2.6 and below, the pcvt console driver on the i386 port allowed you
to press F9, F10, F11, F12 and get corresponding virtual terminals 1, 2, 3, and
4. In 2.7 and above, this behavior is removed, because several applications use
these keys for input.
d5194 1
a5194 2
$OpenBSD: obsd-faq.txt,v 1.31 2002/03/11 00:05:13 millert Exp $

d5198 1
d5202 1
a5202 2
   
  * 8.1 - What are these kerberos warnings when I first login?
d5214 1
a5214 1
  * 8.12 - Will OpenBSD run on multiprocessor machines?
d5216 1
a5216 1
  * 8.14 - Where can I find a Netscape binary for OpenBSD?
d5221 2
a5222 2
  * 8.19 - I'm having problems with PCI devices being detected in OpenBSD 2.8.
  * 8.20 - Antialiased and TrueType fonts in OpenBSD 2.9/XFree86
d5224 3
a5229 26

8.1 - What are these Kerberos warning when I first login?

NB: This section 8.1 becomes obsolete if you have upgraded to 2.8-stable or
later. (patch: ftp://ftp.openbsd.org/pub/OpenBSD/patches/2.8/common/
008_kerberos.patch).

When you first install your system you will most likely notice a warning
message that is something like this:

Warning: no Kerberos tickets issued.

THIS WARNING IS COMPLETELY IRRELEVANT AND SHOULD ONLY BE REMOVED IF COMPLETELY
NECESSARY

Well since you probably haven't set up Kerberos on your system, you wouldn't be
getting a ticket. If you do have Kerberos running, you need to check into that.
See faq10 Kerberos Setup FAQ. If you can't STAND that warning and never plan on
using Kerberos here is how to get rid of it for good.

  * Make sure you have the source code.
  * Edit /usr/share/mk/bsd.own.mk and set KERBEROS to 'no', or create an /etc/
    mk.conf file that does this.
  * cd /usr/src/usr.bin/login ; make clean ; make ; make install


d5232 1
a5232 8
Simply type [ctrl] - [alt] - [One of the function keys] (i386)

Only the i386 arch has virtual terminal capabilities. You can also use virtual
terminals when using X. For example, If you start X on term 1, and switch with
[ctrl]-[alt]-[F2] to term 2, X will seem to disappear and will not come back by
simply switching back to term 1. You must [ctrl]-[alt]-[F5] to get your X
display back.

d5240 1
a5240 1
    bsd# fsck -p / && mount -u /
d5243 1
a5243 1
    bsd# fsck -p /usr && mount /usr
d5251 1
a5251 1
need to make sure that both:
a5252 1
    option XSERVER
d5255 1
a5255 1
are in your kernel configuration. [BOTH of these are in the GENERIC kernel]
d5257 1
a5257 1
Then you need to edit /etc/sysctl.conf and set machdep.allowaperture=1. This
d5276 4
a5279 26
There are a few ways to initially set up your CVS environment. To start off,
you will need an initial CVS checkout of the sources. If you bought the CD,
you're in luck, because it holds the CVS checkout for that release. You can
extract it from your CD by doing one of the following:

1) copy the tree off it, (assuming the CD is mounted on /mnt):

    # mkdir /usr/src
    # cd /mnt; cp -Rp CVS Makefile bin distrib etc games gnu \
    include kerberosIV lib libexec lkm regress sbin share \
    sys usr.bin usr.sbin /usr/src

2) Or, alternatively, use a union mount with the CD below a writable directory.
However, be aware that the union filesystem code is not flawless.

    # mkdir /usr/src
    # mount -t union -o -b /mnt /usr/src

after this, /usr/src will be a nice checkout area where all cvs(1) commands
will work OK.

If you don't have an OpenBSD CD, you will have to retrieve the sources from on
of the OpenBSD AnonCVS servers. These servers are listed on http://
www.openbsd.org/anoncvs.html. Once you have chosen a server you need to choose
which module you are going to retrieve. There are three main modules available
for checkout from the CVS tree. These are:
d5284 3
a5286 3
    ports tree. To read more on the OpenBSD ports tree, read Section 8.6 of the
    OpenBSD FAQ.
  * www - The www module contains all OpenBSD web pages, including this FAQ.
d5290 12
a5301 15
CVS by default retrieves files using rsh(1), but some AnonCVS servers don't
allow for this so in most cases it's best to use ssh. For those of you behind a
firewall there are also the options of pserver and some AnonCVS servers run ssh
on port 2022. Be sure to check http://www.openbsd.org/anoncvs.html for which
servers support what protocols. Next I will show how to do a simple source
checkout. Here I will be using an AnonCVS server located in the U.S., but
remember that if you are outside of the U.S you need to use a server that is
located nearby. There are many AnonCVS servers located throughout the world, so
choose one nearest you. I will also be using ssh to retrieve the files.

    ericj@@oshibana:~> export CVS_RSH=/usr/bin/ssh
    ericj@@oshibana:~> echo $CVS_RSH
    /usr/bin/ssh
    ericj@@oshibana:~> export CVSROOT=anoncvs@@anoncvs.usa.openbsd.org:/cvs
    ericj@@oshibana:~> cvs get src
d5313 1
a5313 1
    ericj@@oshibana:~>cvs -d anoncvs@@anoncvs.usa.openbsd.org:/cvs get src
d5330 1
a5330 1
    ericj@@oshibana:~> echo $CVSROOT                                 
d5332 1
a5332 1
    ericj@@oshibana:~> cvs -q up -Pd www
d5350 1
a5350 1
OpenBSD ftp servers in /pub/OpenBSD/3.0/ports.tar.gz. The most recent ports are
d5354 1
a5354 1
packages read FAQ8.7.
d5356 1
a5356 1
Obtaining the Latest Version of the Ports Tree
d5358 1
a5358 15
If you are planning on running the latest version of the Ports Tree, you should
have the latest release of OpenBSD. This is because of constant changing and
fixing of the ports tree to help with its interaction with the rest of your
OpenBSD system. If you don't follow this guideline, you can expect some minor
problems while upgrading.

The best way to stay current with your OpenBSD Ports Tree is to use via cvs(1).
OpenBSD has a whole group of Anonymous CVS servers that are available to
anyone. To read more about cvs look over www.openbsd.org/anoncvs.html and 
Faq8.5.

Though, if you do not have the ports tree at all, you can download it via any
of OpenBSD's ftp servers. You can get a list at www.openbsd.org/ftp.html. From
here download /pub/OpenBSD/3.0/ports.tar.gz and untar this in /usr/ports. For
example:
d5360 22
a5381 33
    ericj@@oshibana> ftp ftp://ftp.openbsd.org/pub/OpenBSD/3.0/ports.tar.gz
    ericj@@oshibana> sudo cp ports.tar.gz /usr
    ericj@@oshibana> cd /usr; sudo tar xfz ports.tar.gz

Once this is done, you can use cvs(1) to update your Ports Tree. If you started
with a base Ports Tree of 3.0 there will be a few changes that you will need to
make. Most notably /usr/share/mk, which holds files used by make(1) , will need
to be updated. If you have the src tree on your system, you can update /usr/
share/mk via cvs(1) and simply:

    ericj@@oshibana> cd /usr/src/share/mk; sudo make install

This will put the proper files into place. After this is done, you might also
need the latest version of the make(1) binary. You will have to create this, if
you don't have the src tree on your system you can grab it via cvs(1) and
compile it. Example:

    ericj@@oshibana> export CVS_RSH=/usr/bin/ssh
    ericj@@oshibana> cvs -danoncvs@@any.anoncvs.server:/cvs get src/usr.bin/make
    cvs server: Updating src/usr.bin/make
    U src/usr.bin/make/Makefile
    U src/usr.bin/make/Makefile.boot
    U src/usr.bin/make/arch.c
    U src/usr.bin/make/bit.h
    U src/usr.bin/make/buf.c
    U src/usr.bin/make/buf.h
    U src/usr.bin/make/compat.c
    [SNIP] 
    ericj@@oshibana> cd src/usr.bin/make; sudo make install

If you already have the src on your machine, simply update make and install it.
For now, this should be all you need to do to have the ports tree working
properly.
d5384 4
a5387 1
any of the OpenBSD ftp servers as /pub/OpenBSD/snapshots/ports.tar.gz.
d5394 2
a5395 2
    ericj@@oshibana> make search key="samba"
    Port:   samba-2.2.2
d5398 1
a5398 1
    Maint:  Daniel Hartmeier 
d5400 1
d5408 1
a5408 1
    Maint:  dugsong@@monkey.org
d5410 1
d5426 1
a5426 1
    fenetyllin:/usr/ports/graphics/xfig# make install
d5460 28
d5492 6
a5497 6
    bsd# /usr/sbin/pkg_info
    zsh-4.0.4           The Z shell.
    screen-3.9.1        A multi-screen window manager.
    emacs-20.7          GNU editing macros.
    tcsh-6.10.00        An extended C-shell with many useful features.
    bash-1.14.7         The GNU Borne Again Shell.
d5499 2
a5500 2
    ircii-20011210      An enhanced version of ircII, the Internet Relay Chat client
    ispell-3.1.20       An interactive spelling checker.
d5502 1
a5502 1
    procmail-3.21       A local mail delivery agent.
d5504 1
a5504 1
    lsof-4.57B          Lists information about open files.
d5506 1
a5506 1
    ncftp-3.0.4         ftp replacement with advanced user interface
d5508 1
a5508 1
    bzip2-1.0.1         A block-sorting file compressor
d5512 2
a5513 1
More information about the ports can be found in the ports(7) man page.
d5516 1
a5516 2
please see: http://www.openbsd.org/ports.html

d5539 1
a5539 1
located at /pub/OpenBSD/3.0/packages from there packages are broken down
d5548 1
a5548 1
package via ftp. In both examples screen-3.9.1 will be installed.
d5551 2
a5552 1
    $ sudo pkg_add -v screen-3.9.1.tgz
d5554 2
a5555 2
    Running install with PRE-INSTALL for `screen-3.9.1'
    extract: Package name is screen-3.9.1
d5557 2
a5558 2
    extract: /usr/local/bin/screen-3.9.1
    extract: execute 'ln -sf screen-3.9.1 /usr/local/bin/screen'
d5566 1
a5566 1
    Running mtree for `screen-3.9.1'
d5568 1
a5568 1
    Running install with POST-INSTALL for `screen-3.9.1'
d5581 1
a5581 1
    Package `screen-3.9.1' registered in `/var/db/pkg/screen-3.9.1'
d5590 3
a5592 2
    $ sudo pkg_add ftp://ftp.openbsd.org/pub/OpenBSD/3.0/packages/i386/screen-3.9.1.tgz
    >>> ftp -o - ftp://ftp.openbsd.org/pub/OpenBSD/3.0/packages/i386/screen-3.9.1.tgz
d5618 4
a5621 4
    nmap-2.54BETA25    port scanning large networks
    ircii-20011210     enhanced version of ircII (internet relay chat)
    screen-3.9.1       multi-screen window manager
    unzip-5.42         extract, list & test files in a ZIP archive
d5632 1
a5632 1
    $ sudo pkg_delete screen-3.9.1
d5635 1
a5635 1
    | To completely deinstall the screen-3.9.1 package you need to perform
d5640 1
a5640 1
    | Do not do this if you plan on re-installing screen-3.9.1
d5649 1
a5649 1
      fd*     at fdc? drive ? flags 0x20
d5658 1
a5658 1
boot>
d5667 2
a5668 2
to boot /bsd. If that fails it will try /obsd, and so on till it finds a
bootable kernel. You can specify this by hand by typing:
d5670 1
a5670 1
boot> boot wd0a:/bsd
d5674 1
a5674 1
boot> b /bsd
d5695 4
a5698 4
use on un-secured channels. This can come in handy for those who don't have
the ability to use ssh or any other encrypted channels. OpenBSD's S/Key
implementation can use a variety of algorithms as the one-way hash.  The
follow algorithms are available:
d5718 4
a5721 4
be asked for yet another password. This password is the secret password, and is
NOT your system password. Your must be at least 10 characters. We suggest using
a memorable phrase containing several words as the secret password.  Here is
an example user being added.
d5723 1
a5723 1
    oshibana:ericj> skeyinit ericj
d5750 1
a5750 1
to login. Here is an example session using S/Key to login.  Starting with
d5752 5
a5756 5
append "skey" to your login name.  For versions of OpenBSD previous to 3.0
you use "s/key" for the password at which time you are prompted for your S/Key
password (the exception to this is ftpd(8) which will always present
an S/Key challenge for S/Key-enabled user prior to OpenBSD < 3.0).
The examples below assume OpenBSD 3.0 or higher.
d5758 1
a5758 1
    oshibana:ericj> ftp localhost
d5764 1
a5764 2
    Password:
    230- OpenBSD 3.0 (OSHIBANA) #8: Tue Dec 22 19:20:16 EDT 2001
d5780 10
a5789 9
Some of you might have noticed that my sequence number has changed to
"otp-md5 96 oshi45820". This is because by now I have used S/Key to login
several times. But how do you get your password after you've logged in once?
Well to do this, you'll need to know what sequence number you're using and your
key. As you're probably thinking, how can you remember which sequence number
you're on? Well this is simple, use skeyinfo(1), and it will tell you what to
use. For example here, I need to generate another password for a login that I
might have to make in the future. (remember I'm doing this from a secure
channel).
d5791 1
a5791 1
    oshibana:ericj> skeyinfo
d5794 2
a5795 2
An even better way is to use skeyinfo -v, which outputs a command suitable
to be run in the shell.  For instance:
d5797 1
a5797 1
    oshibana:ericj> skeyinfo -v
d5801 2
a5802 2
name for the skey(1) command.  So, the simplest way to generate the next
S/Key password is simply:
d5804 4
a5807 1
    oshibana:ericj> `skeyinfo -v`
d5817 1
a5817 1
    oshibana:ericj> otp-md5 -n 5 95 oshi45820
d5835 1
a5835 1
    ericj@@oshibana> telnet localhost
d5847 1
a5847 1
    OpenBSD 3.0 (OSHIBANA) #4: Thu Dec  2 23:36:16 EDT 2001
d5858 1
a5858 1
    ericj@@oshibana>
d5886 2
a5887 1
8.12 - Will OpenBSD run on multiprocessor machines?
d5889 23
a5911 11
No. OpenBSD/i386 will not make use of multiple processors, but will run using
one processor on a multi-processor system board. OpenBSD/sparc will not run on
a multi-processor sparc system at all. No other platforms currently support
multi-processor capabilities.

The reason is quite simple: there are not enough developers who have access to
MP machines. If you want to donate MP hardware, please refer to http://
www.openbsd.org/donations.html. Our developers are currently asking for i386,
sparc, hppa, and other multi-processor hardware donations to begin SMP support.
A project to bring multi-processor support to OpenBSD is underway, and progress
can be check at http://www.openbsd.org/smp.html.
d5915 4
a5918 4
As of OpenBSD 2.6, you need to use /dev/cuaXX for connections initiated from
the OpenBSD system, the /dev/ttyXX devices are intended only for terminal or
dial-in usage. While it was possible to use the tty devices in the past, the
OpenBSD kernel is no longer compatible with this usage.
d5938 1
a5938 1
8.14 - Where can I find a Netscape binary for OpenBSD?
d5940 2
a5941 2
There is no OpenBSD Netscape binary. However since OpenBSD supports binary
emulation of many other operating systems we are able to use other binaries.
d5943 1
a5943 2
  * For I386 systems, it is best to use the BSDI binary.
  * For SPARC systems, it is best to use the SUN-OS binary.
d5945 25
a5969 3
Using the Ports System you can install these with no hassle. The Navigator Port
and Communicator Ports are located at /usr/ports/www/netscape once you have the
ports tree installed.
d5971 1
a5971 1
8.15 - How do I use the mg editor which is now part of OpenBSD (post-2.6!!)?
d5989 1
a5989 1
    # chown username ~username/.profile
d6000 3
a6002 2
    To fix this, create a file in your home directory called .Xdefaults with
    the phrase XTerm*loginShell: true
d6004 1
a6004 1
    $ echo "XTerm*loginShell: true" < ~/.Xdefaults
d6006 2
a6007 2
    You may not have had to do this before, because some installations of X
    Window System come with this setting as default. OpenBSD has chosen to
d6012 5
a6016 4
The /etc/motd file is edited upon every boot of the system, replacing the first
line with the systems kernel version information. When editing this file, make
sure that you start 2 lines from the top, to keep /etc/rc from deleting these
lines when it edits /etc/motd upon boot.
d6030 1
a6030 1
8.19 - I'm having problems with my PCI devices being detected in OpenBSD 2.8.
d6032 27
a6058 21
There exists a condition in OpenBSD 2.8 where some machines might not detect
some PCI devices properly, or might freeze while detecting multiple NIC's in
one machine. This is the fault of PCIBIOS, and involves a simple workaround to
make work properly. Simply enter the boot time configuration and disable
PCIBIOS. An example is below:

    boot> boot -c                                                                                       
    OpenBSD 2.8 (GENERIC) #377: Tue Oct 24 03:04:08 MDT 2000                                            
        deraadt@@i386.openbsd.org:/usr/src/sys/arch/i386/compile/GENERIC                                 
    cpu0: Intel Pentium III (Coppermine) ("GenuineIntel" 686-class) 390 MHz                             
    cpu0: FPU,V86,DE,PSE,TSC,MSR,PAE,MCE,CX8,SYS,MTRR,PGE,MCA,CMOV,PAT,PSE36,MMX,FXS                    
    R,SIMD                                                                                              
    real mem  = 66629632 (65068K)                                                                       
    avail mem = 56770560 (55440K)                                                                       
    using 838 buffers containing 3432448 bytes (3352K) of memory                                        
    UKC> disable pcibios                                                                                
    UKC> quit                                                                                           
    [... snip ...]                                                                                      
   
Once this is done, you can follow the directions in FAQ 5.6 to create a new
kernel so that you don't have to worry about this in the future.
d6060 1
a6060 1
8.20 - Antialiased and TrueType fonts in OpenBSD 2.9/XFree86
d6069 135
d6209 1
a6209 2
$OpenBSD: obsd-faq.txt,v 1.31 2002/03/11 00:05:13 millert Exp $

d6213 1
d6217 1
a6217 1
   
d6220 1
a6220 1
  * 9.3 - Converting your linux (or other System-7 style) password file to
a6225 1

d6240 1
a6240 1
    will be used to make a nice set of binary packages.
d6242 5
a6246 5
    disseminated through separate distributions. OpenBSD has pioneered
    anonymous CVS, which allows anyone to extract the full source tree for any
    version of OpenBSD (from 2.0 to current, and all revisions of all files in
    between) at any time! There is also a very convenient and easy to use web
    interface to CVS.
d6262 4
a6265 3
  * OpenBSD comes with the Packet Filter package, not ipfw, ipchains,
    netfilter, iptables, or IP Filter. This means that:
      + IP-Masquerading is done through pfctl (using -N). (pfctl(8))
d6270 1
a6270 1
    name instead of an IP address.
a6272 3
  * The network interface aliases are in /etc/ifaliases. NOTE: This has been
    phased out after 2.6. Starting in OpenBSD 2.7, this will be setup in /etc/
    hostname.if.
d6277 1
a6277 1
  * Devices are named by driver, not by type. So for example, there are no eth*
d6286 1
a6286 1
Yes! it is possible!
d6298 1
a6298 1
::0:0 between fields four and seven. Awk does this for you.
d6327 4
a6330 3
libraries is to install linux_lib from your ports collection. To find out more
about the Ports collection read FAQ 8.6. If you already have the ports tree
installed use these commands to get linux libraries installed.
d6332 1
a6332 1
    # cd /usr/ports/emulators/linux_lib
d6338 1
a6338 1
information on using disklabel read FAQ 14.1.
d6345 1
a6345 2
$OpenBSD: obsd-faq.txt,v 1.31 2002/03/11 00:05:13 millert Exp $

d6349 1
d6353 2
a6354 2
   
  * 10.1 - When I try to su to root it says that I'm in the wrong group
d6356 1
a6356 1
  * 10.3 - How do I start daemons with the system? ( Overview of rc(8) )
d6360 4
a6363 3
    POP. What can i do?
  * 10.6 - Setting up a Secure HTTP Server using SSL(8)
  * 10.7 - I made changes to /etc/passwd with vi(1), but the changes didn't
d6365 8
a6372 7
  * 10.8 - How do I add a user? or delete a user?
  * 10.9 - How do I create a ftp-only account?
  * 10.10 - Setting up user disk quotas
  * 10.11 - Setting up Kerberos Client/Server
  * 10.12 - Setting up an Anonymous FTP Server
  * 10.13 - Confining users to their home dir's in ftpd(8).
  * 10.14 - Applying patches in OpenBSD.
a6375 1

d6392 1
a6392 1
privileges, without putting them in the "wheel" group, use sudo(8).
d6396 1
a6396 1
To duplicate your filesystem use dump(8) and restore(8). For example. To
d6408 1
a6408 2

10.3 - How do I start daemons with the system? ( Overview of rc(8) )
d6415 3
d6428 5
a6432 3
The main files a system administrator should concentrate on are /etc/rc.conf, /
etc/rc.local and /etc/rc.shutdown. To get a look of how the rc(8) procedure
works, here is a the flow:
a6433 1
After the kernel is booted. /etc/rc is started.
d6436 2
a6437 1
  * Configuration Variables are read in from /etc/rc.conf
d6455 2
a6456 2
A line like this shows that ftpd is not starting up with the system. ( At least
not via rc(8), read the Anonymous FTP FAQ to read more about this. ) In any
d6470 5
d6550 4
a6553 3
it. But it could (especially if you are a high profile site, ISP,...)! Try
running cucipop or another POP daemon from the OpenBSD ports collection. Or,
you could just have the wrong options selected for your pop daemon (like dot
d6558 1
a6558 1
this in your /etc/group file. An entry like:
d6564 14
a6577 1
10.6 - Setting up a Secure HTTP server with SSL(8)
d6579 1
a6579 13
Starting with OpenBSD 2.8, OpenBSD ships with an SSL-ready httpd and RSA
libraries. However, if you are using OpenBSD 2.6 or 2.7 you must use provided
SSL packages to use SSL. For more information, man 8 ssl.

For use with httpd(8), you must first have a certificate created. This will be
kept in /etc/ssl/private/. The steps shown here are taken in part from the ssl
(8) man page. Refer to it for further information. This FAQ entry only outlines
how to create an RSA certificate for web servers, not a DSA server certificate.
To find out how to do so, please refer to the ssl(8) man page.

To start off, you need to create your server key and certificate. To use the
RSA features, you must have upgraded your libssl. Now you can create your key.
Using OpenSSL:
d6581 11
a6595 1

a6600 1

a6609 1

d6614 2
a6615 2
be able to start httpd(8) with the -DSSL flag, enabling https transactions with
your machine on port 443.
d6617 1
a6617 1
10.7 - I edited /etc/passwd, but the changes didn't seem to take place. Why?
d6619 3
a6621 3
If you edit /etc/passwd, your changes will be lost. OpenBSD generates /etc/
passwd dynamically with pwd_mkdb(8). The main password file in OpenBSD is /etc/
master.passwd. According to pwd_mkdb(8),
d6646 1
a6646 1
10.8 - What is the best way to add and delete users?
d6648 1
a6648 3
For OpenBSD 2.6 users, the adduser(8) command is available for adding users. In
OpenBSD 2.7, the user(8) command was added to deal with adding and removing
both users and groups.
d6653 7
a6659 8
The best way to add a user in OpenBSD is to use the adduser(8) script. You can
configure this to work however you like by editing /etc/adduser.conf. You can
add users by hand via vipw(8), but this is the recommended way to add users.
adduser(8) allows for consistency checks on /etc/passwd, /etc/group, and shell
databases. It will create the entries and $HOME directories for you. It can
even send a message to the user welcoming them. This can be changed to meet
your needs. For further instructions on adding users read the adduser_proc(8)
man page. Here is an example user, testuser being added to a system. His/Her
d6715 1
a6715 1
10.8.2 - Adding users via user(8)
d6717 2
a6718 3
Starting in the 2.7 release of OpenBSD, many commands were added for dealing
with users and groups. These tools are less interactive than the adduser(8)
command, which helps facilitate using these in a script.
d6721 1
d6733 1
a6733 1
10.8.2.1 - Actually adding users
d6812 1
a6812 1
10.8.2.2 - Removing users
d6824 1
a6824 1
10.9 - How do I create an ftp-only account (not anonymous FTP!)?
d6827 7
a6833 7
usr/bin/false into /etc/shells. Then when you create the user set his shell to
/usr/bin/false, they will not be able log in interactively, but will be able to
use ftp capabilities. adduser(8) will give them a home dir by default of /home/
<user>. If this is what you desire it doesn't need to be changed, however you
can set this to whatever directory you wish. You can force this user to only be
able to see files in their home directory by adding their username to /etc/
ftpchroot. Using the -A option to ftpd(8), you can allow only ftpchroot logins!
d6835 1
a6835 1
10.10 - Setting up Quotas
d6905 1
a6905 1
10.11 - How to Setup Kerberos Clients and Servers under OpenBSD
d6908 1
a6908 1
is an pre-installed component of the default system. Here is a guide to setting
d6947 1
a6947 1
    [root@@avalanche kerberosIV] cat krb.conf
d6954 1
a6954 1
krb.conf.
d6956 1
a6956 1
    [root@@avalanche kerberosIV] cat krb.realms
d6965 1
a6965 1
Again, for further information read the krb.realms. man page.
d6969 1
a6969 1
    [root@@avalanche kerberosIV] kdb_init
d6981 1
a6981 1
    [root@@avalanche kerberosIV] kstash
d7021 1
a7021 1
    Expiration date (enter yyyy-mm-dd) [ 1999-12-31 ] ? 2001-12-31
d7039 1
a7039 1
    Expiration date (enter yyyy-mm-dd) [ 1999-12-31 ] ? 2001-12-31
d7052 1
a7052 1
    [root@@avalanche kerberosIV] ext_srvtab avalanche
d7061 2
a7062 2
    [root@@avalanche kerberosIV] mv avalanche-new-srvtab srvtab
    [root@@avalanche kerberosIV] chmod 600 srvtab
d7066 1
a7066 1
    [root@@avalanche kerberosIV] kdb_edit
d7100 1
a7100 1
kerberos_server=YES
d7111 3
a7113 3
    [root@@avalanche /] kill -HUP `cat /var/run/inetd.pid`
    [root@@avalanche /] /usr/libexec/kerberos >> /var/log/kerberos.log &
    [root@@avalanche /] /usr/libexec/kadmind -n >> /var/log/kadmind.log &
d7129 1
a7129 1
    [root@@gatekeeper kerberosIV] cat krb.conf
d7133 1
a7133 1
    [root@@gatekeeper kerberosIV] cat krb.realms
d7140 1
a7140 1
    xyz:jeremie% kinit
d7148 1
a7148 1
    xyz:jeremie$ klist
d7158 1
a7158 1
    xyz:jeremie% telnet avalanche
d7167 1
a7167 1
    OpenBSD 2.5 (AVALANCHE) #5: Tue Apr  6 01:18:16 EDT 1999
d7171 1
a7171 1
    xyz:jeremie% rlogin avalanche
d7174 1
a7174 1
    OpenBSD 2.5 (AVALANCHE) #5: Tue Apr  6 01:18:16 EDT 1999
d7180 1
a7180 1
    xyz:jeremie% kdestroy
d7182 1
a7182 1
    xyz:jeremie% rlogin avalanche
d7193 1
a7193 1
10.12 - Setting up Anonymous FTP Services.
d7213 2
a7214 2
    oshibana# adduser
    Use option ``-silent'' if you don't want see all warnings & questions.
d7230 1
a7230 1
    Use an empty password? (y/n) [y]: y
d7253 1
d7270 1
a7270 1
    oshibana# pwd 
d7272 1
a7272 1
    oshibana# ls -laR ftp
d7318 2
a7319 1
This of course only works if you have ftpd taken out of /etc/inetd.conf.
d7330 1
a7330 1
10.13 - Confining users to their home dir's in ftpd(8).
d7344 1
a7344 1
    230- OpenBSD 2.6 (GENERIC) #690: Fri Oct 29 16:32:17 MDT 1999
d7387 1
a7387 1
    #       $OpenBSD: obsd-faq.txt,v 1.31 2002/03/11 00:05:13 millert Exp $
d7424 1
a7424 1
10.14 - Applying patches in OpenBSD
d7464 1
a7464 2

$ cvs -danoncvs@@anoncvs5.usa.openbsd.org:/cvs co -rOPENBSD_3_0_BASE src/libexec/talkd/
d7557 60
d7622 1
a7622 2
$OpenBSD: obsd-faq.txt,v 1.31 2002/03/11 00:05:13 millert Exp $

d7626 1
d7630 1
a7630 1
   
a7632 1
  * 11.3 - Tuning kmem
d7639 6
d7647 1
a7647 6
If you run a busy server, gateway or firewall, you should make sure to prevent
memory starvation to various parts of the kernel described below.

The options(4) man page talks about the options presented.

An option you may need to change for a busy server, gateway or firewall is
d7649 11
a7659 8
computer, if you get messages like "mb_map full", you need to increase this
value. If traffic on a networking interface stops for no apparent reason, this
may also be a sign that you need to increase this value. A reasonable value on
the i386 port with most 100Mbps ethernet interfaces (no matter how many the
machine has) is 8192.

option NMBCLUSTERS=8192

d7667 1
a7667 1
attention, especially when your partitions run out of space and when your disks
d7672 1
d7681 1
a7681 1
The first option is the use of ccd(4), the Concatenated Disk Driver. This
d7687 5
a7691 5
    If you are running GENERIC, ccd is already enabled. If not, you may need to
    add it to your kernel configuration. To start the setup of ccd, you need to
    add support for it in your kernel. A line such as:
   
        pseudo-device   ccd     4       # concatenated disk devices
d7694 4
a7697 4
    need to figure out what partitions on your real disks that you want to
    dedicate to ccd. Use disklabel to mark these partitions as type 'ccd'. On
    some architectures, disklabel may not allow you to do this. In this case,
    mark them as 'ffs'.
d7705 1
d7710 1
d7712 1
d7714 1
a7720 1
   
d7724 4
a7727 4
Another solution is raid(4) which will have you use raidctl(8) to control your
    raid devices. OpenBSD's RAID is based upon Greg Oster's NetBSD port of the
    CMU RAIDframe software. OpenBSD has support for RAID levels of 0, 1, 4, and
    5.
d7730 1
a7730 1
    for RAID is not found in GENERIC, it must be compiled into your kernel
d7737 2
a7738 3
    to get full details. There are many options and possible configurations, a
    detailed explanation is beyond the scope of this document.

d7742 5
a7746 5
For fileservers with memory to spare, you can increase BUFCACHEPERCENT. That
    is, what percentage of your RAM should you use as a file system buffer.
    This option may change when the Unified Buffer Cache is completed and is
    part of OpenBSD. In the mean time, to increase BUFCACHEPERCENT, you should
    add a line to your kernel configuration like this:
d7748 1
a7748 1
option BUFCACHEPERCENT=30
d7750 2
a7751 3
Of course you can make it as low as 5 percent (the default) or as high as 50
    percent (or more.)
   
d7755 2
a7756 2
Another tool that can be used to speed up your system is softupdates. One of
    the slowest operations in the traditional BSD file system is updating
d7762 5
a7766 6
    upon boot up, but simply a background version of fsck that makes changes to
    the metainfo in RAM (a la softupdates). This means rebooting a server is
    much faster, because you don't have to wait for fsck! (OpenBSD does not
    have this feature yet.) You can read more about softupdates in the 
    softupdates FAQ entry.

d7768 1
a7768 1
11.2.5 - Size of the namei cache
d7774 1
a7774 1
    The name-to-inode translation (a.ka., namei()) cache controls the speed of
d7777 9
a7785 14
    manual page for explanation on the maxusers kernel configuration value. A
    reasonable way to derive a value for the cache, should a large number of
    namei cache misses be noticed with a tool such as systat(1), is to examine
    the system's current computed value with sysctl(8), (which calls this
    parameter "kern.maxvnodes") and to increase this value until either the
    namei cache hit rate improves or it is determined that the system does not
    benefit substantially from an increase in the size of the namei cache.
    After the value has been determined, you can determine it to be set at
    system startup time with sysctl.conf(5).


11.3 - Tuning kmem

This was moved to the OpenBSD 2.5 information section.
d7796 1
a7796 1
Intel Pentium III or AMD Athlon processor is much better than the Price/
d7798 1
a7798 1
be beat.
d7804 2
a7805 2
we can give is to be careful, buy brands and parts that have been reviewed by
an authority you trust. Sometimes, when you skimp on the price of a PC, you
d7811 13
a7823 16
  * Use multiple disks.
   
    Instead of buying one 20GB disk, buy multiple 9GB disks. While this may
    cost more, distributing the load over multiple spindles will decrease the
    amount of time necessary to access data on the disks. And, with more
    spindles, you will get more reliability and faster data access with RAID.
   
  * Use SCSI if you need very high disk IO speeds.
   
    IDE disks normally run at 5400 RPM, with new disks emerging from
    manufacturers that run at 7200 RPM. Using high end IDE disks, it may be
    unreasonable to expect more then 15 to 20 megabytes per second of
    throughput from a single disk. Using high end SCSI disks (higher cost 10000
    RPM disks), you can achieve performance higher then this. Conversely, if
    you are using medium or low end SCSI disks, this is a waste of money, and
    IDE will serve you just as well, if not better.
d7825 1
a7825 1
    If you are building a server, and you need more then 20GB of disk space,
d7828 39
a7866 46
    performance of these disks. Wide SCSI limits you to 15 per controller!
    While SCSI costs more, the flexibility and performance can justify these
    costs in some environments.
   
  * Use SDRAM instead of DRAM.
   
    This option applies mainly to PCs. Most other architectures don't give you
    a choice of what kind of RAM you can use. Several PCs still do. You will
    get better performance with SDRAM versus DRAM (SIMMs). If your system
    supports RDRAM or some other new type of RAM, then you are already one step
    ahead...
   
  * Use ECC or parity RAM.
   
    Parity adds some functionality to see if the data in RAM has been
    corrupted. ECC extends this functionality and attempts to correct some bit
    corruption errors on the fly. This option applies mainly to PCs. Most other
    architectures simply require parity or ECC capable RAM. Several non-PC
    computers won't even boot with non-parity RAM. If you aren't using ECC/
    parity RAM, you may get data corruption and other abnormalities. Several
    manufacturers of "cheap PC RAM" don't even make an ECC variety! This will
    help you avoid them! PC manufacturers often sell several product lines,
    divided around "servers" and "workstations." The servers will incorporate
    ECC RAM into their architecture. Unix workstation manufacturers have been
    using parity (and now ECC) for several years in all of their product lines.
   
  * Avoid ISA devices.
   
    While most folks avoid ISA devices, because they are generally hard to
    configure and out of date, there are still plenty in existence. If you are
    using the ISA bus for your disk or network controllers, (or even worse, for
    both) remember that the ISA bus itself can be a performance bottleneck. If
    you need speed, look to PCI. Of course, there are still several ISA bus
    cards that work just fine. Unfortunately, most of these are sound cards and
    serial port cards.
   
  * Avoid cheap PCI network adapters.
   
    OpenBSD supports a plethora of cheap PCI network adapters. These adapters
    work great in home systems, and also low or moderate throughput business
    and research environments. But, if you need high throughput and low impact
    on your server, you are better off buying a quality PCI network adapter.
    Unfortunately, some expensive brand adapters (such as the 3com XL series)
    are not much better than the cheap adapters. One favourite 10/100Mbps
    adapter is the Intel EtherExpress PRO/100.
   
d7873 2
a7874 2
unixen) ? Surely it is much simpler and therefore a safer way of improving
performance in some applications ?"
d7876 1
a7876 1
Answer: "Async mounts is indeed faster then sync mounts, but they are also less
d7879 1
a7879 2
Check the manpage for mount(8)."

d7890 5
a7894 4
from scratch after a crash, you could gain speed by using a separate partition,
used for that data only, mounted async. If you don't mind risking the loss of
all the data in the partition when something goes wrong...

d7911 1
a7911 1
newer monitors) to use vertical scan rates of 85MHz and above, to achieve an
d7920 9
a7928 7
Generating a ModeLine is a black art... Luckily, there is a script which can do
this for you. It is the Colas XFree86 ModeLine Generator. Before you can use
the Colas generator, you need to figure out the vertical and horizontal sync
limits for your monitor. This is often documented in the manual, or on the
manufacturer's web site. If you can't find either of those, simply search the
web for the monitor make and model, several people have been kind enough to
compile lists with this information.
a7941 1

d7991 5
a7995 4
The first frequency you see after the "Modes" line is the frequency that X is
going to start in. By pressing CTRL-ALT-KEYPAD MINUS, or CTRL-ALT-KEYPAD PLUS,
you can switch between any frequencies that you list here. According to the
section above, X will try to start in 32-bit color mode (via the
d8001 1
a8001 1
Note that the ModeLine generator script has options to relax its' timings for
d8011 4
a8014 4
up in BW, the fuzzier the screen image becomes. So you may want to put in the
bandwith of your card (also named "dotclock") to test (you cannot damage your
monitor this way), and go progressively down in BW down to have a nice crisp
image.
d8017 9
a8025 10
this, and makes this process much easier since it has several builtin modes and
is capable of reading back capabilities from "plug and play" monitors through
DDC and DDC2. Unfortunately, it is not quite ready for prime time because it
does not support many video cards which are supported in XFree86 3.3.

You can download the Colas XFree86 ModeLine Generator script at: ftp://
koala.inria.fr/pub/Klone/. You need to grab the Klone interpreter, and compile
it. It is in the ports as lang/klone. The scripts exist under the scripts
directory in the Klone distribution. (The port installs them to /usr/local/lib/
klone/scripts.)
d8039 1
a8039 2
$OpenBSD: obsd-faq.txt,v 1.31 2002/03/11 00:05:13 millert Exp $

d8043 1
d8047 1
a8047 1
   
d8085 1
a8085 1
    cd0(pciide0:1:0): using PIO mode 3, DMA mode 1 (using DMA data transfers)
a8089 8
Some notes:

DMA is not supported on wdc* unless a DMA channel (drq) is specified. I'm not
sure what the "standard" drqs are for hard disk controllers. To enable
wdc0    at isa? port 0x1f0 irq 14 flags 0x00
Non-ultra DMA does not necessarily lead to higher bandwidth vs PIO. However, it
decreases the CPU load significantly.

d8095 1
a8095 2
$OpenBSD: obsd-faq.txt,v 1.31 2002/03/11 00:05:13 millert Exp $

d8110 5
a8114 6
  * 13.7 - How do I setup photurisd?
  * 13.8 - How do I setup isakmpd?
  * 13.9 - How do I use isakmpd with X.509 certificates?
  * 13.10 - What IKE clients are compatible with isakmpd?
  * 13.11 - Troubleshooting IPsec/VPN
  * 13.12 - Related Documentation
d8140 2
a8141 1
understand it, the Understanding IP Addressing document is highly recommended.
d8189 1
a8189 1
encryption, and that the traffic causes events favourable for him, like
d8355 2
a8356 3
OpenBSD implements both Photuris (RFC2522, and RFC2523) and ISAKMP automatic
key exchange (RFC2407, RFC2408, and RFC2409) in the photurisd(8) and isakmpd(8)
daemons.
d8372 1
a8372 1
# sysctl -w net.inet.esp.enable=1
d8387 1
a8387 1
# dd if=/dev/urandom bs=1024 count=1 | sha1
d8394 2
a8395 2
BLF       Variable (40-160, 160 bits recommended)
CAST      Variable (40-128, 128 bits recommended)
d8410 1
a8410 1
# ipsecadm new esp -spi SPI_OUT -src MY_EXTERNAL_IP -dst PEER_EXTERNAL_IP
d8417 3
a8419 2
# ipsecadm new esp -spi 1000 -src 192.168.5.1 -dst 192.168.25.9 -forcetunnel
    -enc blf -auth sha1 -key 7762d8707255d974168cbb1d274f8bed4cbd3364 -authkey
d8428 3
a8430 2
# ipsecadm new esp -spi 1001 -src 192.168.25.9 -dst 192.168.5.1 -forcetunnel
    -enc blf -auth sha1 -key 7762d8707255d974168cbb1d274f8bed4cbd3364 -authkey
d8448 1
a8448 1
# ipsecadm flow -proto esp -dst 192.168.25.9 -spi 1000 -addr 192.168.5.1
d8453 1
a8453 1
# ipsecadm flow -proto esp -dst 192.168.5.1 -spi 1001 -addr 192.168.25.9
d8479 2
a8480 2
# ipsecadm new esp -src 208.1.1.1 -dst 208.2.2.2 -forcetunnel -spi 1001 -enc
    blf -auth sha1 -key 7762d8707255d974168cbb1d274f8bed4cbd3364 -authkey
d8488 1
a8488 1
# ipsecadm flow -proto esp -dst 208.2.2.2 -spi 1001 -addr 208.1.1.1
d8494 1
a8494 1
# ipsecadm flow -proto esp -dst 208.2.2.2 -spi 1001 -addr 192.168.99.0
d8500 1
a8500 1
# ipsecadm flow -proto esp -dst 208.2.2.2 -spi 1001 -addr 192.168.99.0
d8506 1
a8506 1
# ipsecadm flow -proto esp -dst 208.2.2.2 -spi 1001 -addr 208.1.1.1
d8512 1
a8512 1
# ipsecadm flow -proto esp -dst 208.2.2.2 -spi 1001 -addr 208.1.1.1
d8517 1
a8517 1
# ipsecadm flow -proto esp -dst 208.2.2.2 -spi 1001 -addr 192.168.99.0
d8524 2
a8525 2
# ipsecadm new esp -src 208.2.2.2 -dst 208.1.1.1 -forcetunnel -spi 1000 -enc
    blf -auth sha1 -key 7762d8707255d974168cbb1d274f8bed4cbd3364 -authkey
d8534 1
a8534 1
# ipsecadm flow -proto esp -dst 208.1.1.1 -spi 1000 -addr 208.2.2.2
d8540 1
a8540 1
# ipsecadm flow -proto esp -dst 208.1.1.1 -spi 1000 -addr 208.1.2.0
d8546 1
a8546 1
# ipsecadm flow -proto esp -dst 208.1.1.1 -spi 1000 -addr 208.1.5.0
d8552 1
a8552 1
# ipsecadm flow -proto esp -dst 208.1.1.1 -spi 1000 -addr 208.2.2.2
d8558 1
a8558 1
# ipsecadm flow -proto esp -dst 208.1.1.1 -spi 1000 -addr 208.1.2.0
d8566 1
a8566 1
# ipsecadm flush
d8570 1
a8570 47
13.7 - How do I setup photurisd?

Photuris is not widely used and is still considered experimental as far as the
RFC status is concerned. However, many people have used it with OpenBSD.

To setup your photurisd, first edit /etc/photuris/secrets.conf on each host
with photurisd.

    bsd# cat /etc/photuris/secrets.conf
    # Accepted keywords are:
    # identity local "id" "secret"
    # identity pair local "receivedid" "myid" "secret"
    # identity remote "id" "secret"
    # identity lookup "tag" username
    # Simple 
    identity local "Default" "This should be changed."
    identity remote "Default" "This should be changed."

Change "This should be changed." to a key of your choice on the local config,
and another key of your choice on the remote config. (Use the same config on
your remote box but swap "local" and "remote" so that it sees itself as the
local key.) Note that these keys will be replaced in a future version of
photurisd that will carry out its initial key exchange with public keys.

Make sure net.inet.ah.enable is set to 1.

    bsd# sysctl -w net.inet.ah.enable=1
    net.inet.ah.enable: 0 -> 1

And run startkey.

    bsd# startkey dst=remote.host

Now, run tcpdump to verify that your packets are being encrypted with AH. (Run
a ping in another window or session to generate traffic.)

    bsd# tcpdump proto ah

You can also try using tcpdump by the host address if you aren't getting
anything.

    bsd# tcpdump host remote.host

You can make photurisd automatically set the source and destination host or
networks in /etc/photuris/photuris.startup

13.8 - How do I setup isakmpd?
d8577 1
a8577 1
13.8.1 - What is isakmpd?
d8595 1
a8595 1
Phase 2 - Security Associations are negotiated on behalf of IPsec. Phase 2 is
d8597 2
a8598 2
Phase 2 because there is not need to repeat a full authentication because Phase
1 has already established the SAs.
d8603 1
a8603 1
nodes establish a connection where they exchange authentication (Either a X509
d8608 1
a8608 1
13.8.2 - How do I get started with isakmpd?
d8622 11
a8632 10
Your first step is to turn on esp. The top of section 13.6 tells you how to do
this both for run-time and boot. Next, you need to edit /etc/isakmpd.policy.
This file tells ISAKMP who can access IPsec. In this scenario, the policy file
states that anybody who sends data using Encapsulate Security Payload(ESP), and
has authenticated with the passphrase mekmitasdigoat (or whatever passphrase
you determine), is allowed to communicate with isakmpd. You can modify this
file to let ISAKMP know that we only want to allow data signed with certain
digital certificates or using a certain encryption transform. You could also
allow anybody to access IPsec. This is only recommended for testing. To do
this, edit your policy file to contain only the following lines:
d8866 1
a8866 1
13.8.3 - Starting isakmpd
d8870 1
a8870 1
# isakmpd -d -DA=99
d8877 1
a8877 1
13.9 - How do I use isakmpd with X.509 certificates?
d8909 1
a8909 1
$ /usr/sbin/certpatch -t fqdn -i home.mysite.se -k ca.key originalcert.crt
d8925 1
a8925 1
originally taken from the example file in isakmpd.conf(5) but have been heavily
d8927 3
a8929 4
man-page, I have removed from that file most parts that are not needed in this
setup. In part to simplify the understanding of this setup. I have also added
some commenting (some comments are left as in the isakmpd.conf(5)) and changed
some names. None of the domain names used here exists as far as I know.
d8931 1
a8931 1
Actually since everyone who reads this already have a working configuration for
d9190 1
a9190 1
used it before, especially if things doesn't work as expected. The man-page 
d9198 1
a9198 1
This basically means that that there is no policy limitations on who would be
d9346 1
a9346 1
Well, if the ID information was the IP (the default situation if we do not
d9473 1
a9473 1
$ openssl x509 -text < ca.crt
d9476 1
a9476 1
start anyway, and there are another example in the next section.
d9491 1
a9491 1
Therefor one very nice feature of isakmpd is the ability to use a default tag
d9578 1
a9578 1
13.10 - What IKE clients are compatible with isakmpd?
d9583 1
a9583 1
isakmp software out there are actually based on the OpenBSD isakmp daemon.
a9586 1
  * TimeStep PERMIT/Client
a9588 1
  * Radguard cIPro client
d9590 1
a9590 1
  * Microsoft Windows 2000 (Transport mode only)
a9596 1
  * TimeStep PERMIT/Gate
d9600 1
a9600 1
  * Axent Raptor
a9601 1
  * Radguard cIPro-VPN
d9607 2
d9610 1
a9610 1
13.11 - Troubleshooting IPsec/VPN
a9620 1

d9626 21
a9646 20
        208.2.2.2, I am doing this:
        vpn# ping -c 3 208.1.1.1
        PING esp.mil (208.1.1.1): 56 data bytes
        64 bytes from 208.1.1.1: icmp_seq=0 ttl=255 time=190.155 ms
        64 bytes from 208.1.1.1: icmp_seq=1 ttl=255 time=201.040 ms
        64 bytes from 208.1.1.1: icmp_seq=2 ttl=255 time=165.481 ms
        --- esp.mil ping statistics ---
        3 packets transmitted, 3 packets received, 0% packet loss
        round-trip min/avg/max = 165.481/185.558/201.040 ms
        And in another session, I can see my encapsulated pings:
        vpn# tcpdump -ni fxp7 host 208.1.1.1
        tcpdump: listening on fxp7
        14:12:19.630274 esp 208.2.2.2 > 208.1.1.1 spi 0x00001000 seq 4535 len 116
        14:12:19.813519 esp 208.1.1.1 > 208.2.2.2 spi 0x00001001 seq 49313 len 116
        14:12:20.630277 esp 208.2.2.2 > 208.1.1.1 spi 0x00001000 seq 4536 len 116
        14:12:20.832458 esp 208.1.1.1 > 208.2.2.2 spi 0x00001001 seq 49314 len 116
        14:12:21.630273 esp 208.2.2.2 > 208.1.1.1 spi 0x00001000 seq 4537 len 116
        ^C
        1831 packets received by filter
        0 packets dropped by kernel
d9650 1
a9658 9
  * Photuris runs on UDP port 468. Same considerations, but the protocol is ah.
        # Passing in Photuris traffic from the security gateways
        pass in on ne0 proto udp from gatewB/32 port = 468 to gatewA/32 port = 468
        pass out on ne0 proto udp from gatewA/32 port = 468 to gatewB/32 port = 468
        
        # Passing in encrypted traffic from security gateways
        pass in proto ah from gatewB/32 to gatewA/32
        pass out proto ah from gatewA/32 to gatewB/32
   
d9661 1
a9661 1
    # /sbin/isakmpd -d -DA=99
d9665 1
a9665 1
    # /sbin/isakmpd -d -DA=99 -D1=70
d9669 1
d9678 1
a9678 1
    # mkdir /kern; mount -t kernfs /kern /kern
d9685 2
a9686 1
        vpn% netstat -rn -f encap
d9706 1
a9706 1
13.12 - Related Documentation
d9710 3
a9712 3
you. The manual pages for enc(4), ipsec(4), ipsecadm(8), photurisd(8), startkey
(1), isakmpd(8), isakmpd.conf(5) and isakmpd.policy(5) are detailed and can
assist in setup and operation of IPsec.
a9750 2
  * RFC 2522 - Photuris: Session-Key Management Protocol
  * RFC 2523 - Photuris: Extended Schemes and Attributes
d9759 1
a9759 2
$OpenBSD: obsd-faq.txt,v 1.31 2002/03/11 00:05:13 millert Exp $

d9763 1
d9767 1
a9767 1
   
d9775 1
a9775 2
  * 14.7 - What are the issues regarding large drives with OpenBSD? -i386
    specific
d9780 2
d9826 38
a9863 39
partitions that should be created and their sizes by reading faq4.3. For
servers it is recommended that you create at least these label's separately.
For desktop users creating one mountpoint at / will probably suffice. When
initially creating your root partition ( 'a' label ), keep in mind that you
will need SOME space left for your swap label. Now that the basics have been
explained, here is an example of using disklabel during an install. In this
first example it is assumed that OpenBSD will be the only operating system on
this computer, and that a full install will be done.

    
    If this disk is shared with other operating systems, those operating systems
    should have a BIOS partition entry that spans the space they occupy completely.
    For safety, also make sure all OpenBSD file systems are within the offset and
    size specified in the 'A6' BIOS partition table.  (By default, the disklabel
    editor will try to enforce this).  If you are unsure of how to use multiple
    partitions properly (ie. separating /,  /usr, /tmp, /var, /usr/local, and other
    things) just split the space into a root and swap partition for now.
    
    # using MBR partition 3: type A6 off 63 (0x3f) size 4991553 (0x4c2a41) 
    
    Treating sectors 63-16386300 as the OpenBSD portion of the disk.
    You can use the 'b' command to change this.
    
    Initial label editor (enter '?' for help at any prompt)
    > d a
    > a a
    offset: [63] <Enter>
    size: [16386237] 64M
    Rounding to nearest cylinder: 131040
    FS type: [4.2BSD] <Enter>
    mount point: [none] /
    fragment size: [1024] <Enter>
    block size: [8192] <Enter>
    cpg: [16] <Enter>
    > a b
    offset: [131103] <Enter>
    size: [16255197] 64M
    Rounding to nearest cylinder: 131040
    FS type: [swap] <Enter>
d9879 18
a9896 19

    > a d
    offset: [262143] <Enter>
    size: [16124157] 64M
    Rounding to nearest cylinder: 131040
    FS type: [4.2BSD] <Enter>
    mount point: [none] /tmp
    fragment size: [1024] <Enter>
    block size: [8192] <Enter>
    cpg: [16] <Enter>
    > a e
    offset: [393183] <Enter>
    size: [15993117] 64M
    Rounding to nearest cylinder: 131040
    FS type: [4.2BSD] <Enter>
    mount point: [none] /var
    fragment size: [1024] <Enter>
    block size: [8192] <Enter>
    cpg: [16] <Enter>
d9909 2
a9910 3

    > w
    > q
d9924 1
d9926 26
a9951 28
    # disklabel wd0 >----- Or whatever disk device you'd like to view
    
    # using MBR partition 3: type A6 off 64 (0x40) size 16777152 (0xffffc0)
    # /dev/rwd0c:
    type: ESDI
    disk:
    label: TOSHIBA MK2720FC
    flags:
    bytes/sector: 512
    sectors/track: 63
    tracks/cylinder: 16
    sectors/cylinder: 1008
    cylinders: 2633
    total sectors: 2654064
    rpm: 3600
    interleave: 1
    trackskew: 0
    cylinderskew: 0
    headswitch: 0           # milliseconds
    track-to-track seek: 0  # milliseconds
    drivedata: 0 
    
    16 partitions:
    #        size   offset    fstype   [fsize bsize   cpg]
      a:  2071440    65583    4.2BSD     1024  8192    16   # (Cyl.   65*- 2120)
      b:    65520       63      swap                        # (Cyl.    0*- 65)
      c:  2654064        0    unused        0     0         # (Cyl.    0 - 2632)
      j:   512001  2137023    4.2BSD     1024  8192    16   # (Cyl. 2120*- 2627*)
d9956 1
a9956 2

    # disklabel -E wd0
d9980 1
a9981 2
    # fdisk fd0
    
d9984 9
a9992 10

             Disk: fd0       geometry: 80/2/18 [2880 sectors]
             Offset: 0       Signatures: 0xAA55,0x0
                      Starting        Ending
              #: id  cyl  hd sec -  cyl  hd sec [     start -       size]
    ----------------------------------------------------------------------
             *0: A6    0   0   1 -   79   1  18 [         0 -       2880] OpenBSD
              1: 00    0   0   0 -    0   0   0 [         0 -          0] unused
              2: A7    0   0   2 -   79   1  18 [         1 -       2879] NEXTSTEP
              3: 00    0   0   0 -    0   0   0 [         0 -          0] unused
d10001 18
a10018 18

    # fdisk -e wd0
    Enter 'help' for information
    fdisk: 1> help
            help            Command help list
            manual          Show entire OpenBSD man page for fdisk
            reinit          Re-initialize loaded MBR (to defaults)
            disk            Edit current drive stats
            edit            Edit given table entry
            flag            Flag given table entry as bootable
            update          Update machine code in loaded MBR
            select          Select extended partition table entry MBR
            print           Print loaded MBR partition table
            write           Write loaded MBR to disk
            exit            Exit edit of current MBR, without saving changes
            quit            Quit edit of current MBR, saving current changes
            abort           Abort program without saving current changes
    fdisk: 1> 
d10030 3
a10054 1

d10061 1
a10061 3

    # fdisk -i sd2

d10064 1
d10066 11
a10076 14
    # disklabel -e sd2
    
    (screen goes blank, your $EDITOR comes up)
    type: SCSI
    ...bla...
    sectors/track: 63
    total sectors: 6185088
    ...bla...
    16 partitions:
    #        size   offset    fstype   [fsize bsize   cpg]
      c:  6185088        0    unused        0     0         # (Cyl.    0 - 6135)
      d:  1405080       63    4.2BSD     1024  8192    16   # (Cyl.    0*- 1393*)
      e:  4779945  1405143    4.2BSD     1024  8192    16   # (Cyl. 1393*- 6135)

d10094 1
a10094 3

        d:  6185025       63    4.2BSD     1024  8192    16 

d10106 1
a10106 2

    bsd# newfs wd1a 
d10114 1
a10114 2

    mount /dev/wd1a /u
d10117 1
a10117 2

    /dev/wd1a /u ffs rw 1 1
a10122 1

a10128 1

d10135 2
a10136 5
After the release of OpenBSD 2.5 came swapctl(8), which made dealing with swap
devices much easier. If you are on an OpenBSD 2.5 system, exchange swapctl with
swapon, and use pstat -s to list swap devices. Swapping to a file doesn't
require a custom built kernel, although that can still be done, this faq will
show you how to add swap space both ways.
d10140 4
a10143 4
Swapping to a file is easiest and quickest way to get extra swap area's setup.
This is not for users who are currently using Soft Updates. (Which isn't
enabled by default). To start out, you can see how much swap you currently have
and how much you are using with the swapctl(8) utility. You can do this by
d10145 3
a10147 4

    ericj@@oshibana> swapctl -l
    Device      512-blocks     Used    Avail Capacity  Priority
    swap_device      65520        8    65512     0%    0
d10159 4
a10162 5

    ericj@@oshibana> sudo dd if=/dev/zero of=/var/swap bs=1k count=32768
    32768+0 records in
    32768+0 records out
    33554432 bytes transferred in 20 secs (1677721 bytes/sec)
d10166 2
a10167 3

    ericj@@oshibana> sudo chmod 600 /var/swap
    ericj@@oshibana> sudo swapctl -a /var/swap
d10171 5
a10175 6

    ericj@@oshibana> swapctl -l
    Device      512-blocks     Used    Avail Capacity  Priority
    swap_device      65520        8    65512     0%    0
    /var/swap        65536        0    65536     0%    0
    Total           131056        8   131048     0%
d10180 3
a10182 4

    ericj@@oshibana> cat /etc/fstab
    /dev/wd0a / ffs rw 1 1
    /var/swap /var/swap swap sw 0 0
d10190 1
a10190 2

    config          bsd     root on wd0a swap on wd0b and vnd0c dumps on wd0b
d10194 4
a10197 5

    ericj@@oshibana> sudo dd if=/dev/zero of=/var/swap bs=1k count=32768
    32768+0 records in
    32768+0 records out
    33554432 bytes transferred in 20 secs (1677721 bytes/sec)
d10201 3
a10203 4

    ericj@@oshibana> cat /etc/fstab
    /dev/wd0a / ffs rw 1 1
    /dev/vnd0c none swap sw 0 0 
d10208 2
a10209 3

    ericj@@oshibana> sudo vnconfig -c -v vnd0 /var/swap
    vnd0: 33554432 bytes on /var/swap
d10214 6
a10219 7

    ericj@@oshibana> sudo swapctl -a /dev/vnd0c
    ericj@@oshibana> swapctl -l
    Device      512-blocks     Used    Avail Capacity  Priority
    swap_device      65520        8    65512     0%    0
    /dev/vnd0c       65536        0    65536     0%    0
    Total           131056        8   131048     0%
d10228 1
d10236 1
a10236 1
To enable Softupdates your kernel must have
d10240 1
a10240 4
compiled in.

This option is included in GENERIC kernels starting with OpenBSD 2.9. However,
you still must enable it on a per mount point basis.
d10242 5
a10246 15
Starting with 2.9, enabling soft updates must be done with a mount time option,
instead of using tunefs(8). Now, when mounting a partition with the mount(8)
utility, you can specify that you wish to have soft updates enabled on that
partition. Below is a sample /etc/fstab(5) entry that has one partition sd0a
that we wish to have mounted with soft updates.

    /dev/sd0a / ffs rw,softdep 1 1

If you are using an OpenBSD release earlier than 2.9 you need to boot into
single-user mode:

            boot> boot -s
            [snip]
            bsd# tunefs -s enable <raw device>
            bsd# reboot -n
d10265 5
d10280 5
a10284 6

    reading boot.......
    probing pc0 com0 com1 pci mem [639k 79m a20=on]
    disk hd0 fd0
    >> OpenBSD BOOT 1.28
    boot> boot hd0a:/bsd
d10293 1
d10295 6
a10300 8
    # fdisk -i -f /mnt/3.0/tools/booteasy/Boot.bin wd0

This assumes you have a the 3.0 CD mounted on /mnt and that you are using an
IDE drive. You may need to change this depending upon where Boot.bin is and
what kind of hard disk you have (a SCSI drive would typically be 'sd0'). Note:
do NOT do this if your OpenBSD partition is not the entire disk! Initializing
the MBR this way creates one OpenBSD partition spanning the entire disk and
deletes all other partitions, which is rarely good.
d10314 1
a10314 2

    A:\>fdisk /mbr
d10338 2
a10339 2
setting up a machine which you know has this problem, it is fairly easy to
avoid it. The only time the OpenBSD loader is installed on your system during a
d10356 2
a10357 3

    # cp /usr/mdec/boot /boot
    # /usr/mdec/installboot -v /boot /usr/mdec/biosboot wd0
d10361 3
a10363 3
installboot(8) installs and configures the the partition boot loader, biosboot
(8), which loads boot(8). boot(8) is the module which loads the kernel into
RAM. biosboot(8) has a table within it that points to the physical location
d10368 1
a10368 1
See section 14.8 for more info.
d10370 1
a10370 1
14.7 - What are the issues regarding large drives with OpenBSD? - i386 specific
d10378 1
a10378 3
often call this 137G), will not be supported until new interface standard(s)
are implemented in OpenBSD. (Donations of hardware for development purposes
welcome.)
d10382 3
a10384 3
own. The boot process has to utilize (and is thus limited by) the system's
BIOS. The OpenBSD boot loaders (biosboot(8) and boot(8)) also have their own
internal 8G limitation, from an older BIOS limit.
d10387 4
a10390 4
within the BIOS addressable area, or within the first 8G of the disk, whichever
is smaller. This means that on some older computers, the root partition must be
completely within the first 504M, but for most newer computers, the root
partition may be anywhere within the first 8G.
d10406 2
a10407 2
504M range the BIOS supported. The BIOS-based boot loader was unable to fetch
the file /bsd, and the system hung.
d10409 2
a10410 2
To get OpenBSD to boot, /bsd must be within the BIOS's supported range. To play
it safe, the rule is simple:
d10412 2
a10413 2
The entire root partition must be within the computer's BIOS addressable space
or within the first 8G, whichever is smaller.
d10415 2
a10416 3
OpenBSD is capable of accessing entire IDE drives (up to 128G), not just the
space recognized by the system BIOS, but root had best be within the BIOS's
range.
d10430 1
a10430 1
blocks that comprise /boot in terms of the original "translated" geometry.) If
d10433 6
a10438 5
translations.) To fix your boot block so that you can boot normally, just put a
boot floppy in your hard drive, and at the boot prompt, type "b hd0a:/bsd" to
force it to boot from the first hard disk (and not the floppy). Your machine
should come up normally. You now need to update the first stage boot loader to
see the new geometry (and re-write the boot block accordingly).
d10441 1
a10441 2

    # cd /usr/mdec; ./installboot /boot biosboot sd0
d10448 1
a10448 2

    # cd /usr/mdec; ./installboot -h <heads> -s <secs> /boot biosboot sd0
d10452 4
a10455 5

    # cd /sys/arch/i386/stand/
    # make && make install 
    # cd /usr/mdec; cp ./boot /boot
    # ./installboot /boot biosboot sd0 (or whatever device your hard disk is)
d10484 3
a10486 4

    shell# mount
    /dev/sd0a on / type ffs (local)
    /dev/sd0h on /usr type ffs (local)
d10493 5
a10497 6

    shell# mount
    /dev/sd0a on / type ffs (local)
    /dev/sd0d on /var type ffs (local)
    /dev/sd0e on /home type ffs (local)
    /dev/sd0h on /usr type ffs (local)
d10506 3
a10508 4

    # /sbin/dump -0au -f /dev/nrst0 /dev/rsd0a
    # /sbin/dump -0au -f /dev/nrst0 /dev/rsd0h
    # mt -f /dev/rst0 rewind  
d10511 5
a10515 6

    # /sbin/dump -0au -f /dev/nrst0 /dev/rsd0a
    # /sbin/dump -0au -f /dev/nrst0 /dev/rsd0d
    # /sbin/dump -0au -f /dev/nrst0 /dev/rsd0e
    # /sbin/dump -0au -f /dev/nrst0 /dev/rsd0h  
    # mt -f /dev/rst0 rewind  
d10533 1
a10533 2

    st0 at scsibus0 targ 5 lun 0: <ARCHIVE, Python 28388-XXX, 5.28>
d10547 10
a10556 11

    echo "  Starting Full Backup..."
    /sbin/dump -0au -f /dev/nrst0 /dev/rsd0a
    /sbin/dump -0au -f /dev/nrst0 /dev/rsd0d
    /sbin/dump -0au -f /dev/nrst0 /dev/rsd0e
    /sbin/dump -0au -f /dev/nrst0 /dev/rsd0h
    echo
    echo -n "  Rewinding Drive, Please wait..."
    mt -f /dev/rst0 rewind
    echo "Done."
    echo
d10580 1
a10580 2

    # /sbin/restore -tvs 1 -f /dev/rst0
d10588 1
a10588 2

    # /sbin/restore -tvs 2 -f /dev/rst0 > /home/me/list.txt
d10613 1
a10613 2
   
  * Using the fdisk(8) command, create a primary OpenBSD partition on this
d10615 1
a10615 2
   
        shell# fdisk -e sd0
a10617 1
   
d10620 1
a10620 2
   
        shell# disklabel -E sd0
a10622 1
   
d10625 2
a10626 3
   
        shell# newfs /dev/rsd0a
        shell# newfs /dev/rsd0h
d10628 1
a10628 2
   
        shell# mount /dev/sd0a /mnt
d10631 2
a10632 3
   
        shell# cd /mnt
        shell# restore -rs 1 -f /dev/rst0
d10635 1
a10635 2
   
        shell# fdisk -i sd0
d10638 2
a10639 3
   
        shell# cp /usr/mdec/boot /mnt/boot
        shell# /usr/mdec/installboot -v /mnt/boot /usr/mdec/biosboot sd0
d10645 2
a10646 3
   
        shell# umount /mnt
        shell# halt
d10649 1
a10649 2
   
        boot> bsd -s
a10652 1
   
d10657 1
a10657 2
   
        shell# mount -u -w /
d10660 7
a10666 8
   
        (simple mount table)
        shell# mount /dev/sd0h /usr; cd /usr; restore -rs 2 -f /dev/rst0
        
        (more advanced mount table)
        shell#  mount /dev/sd0d /var; cd /var; restore -rs 2 -f /dev/rst0
        shell#  mount /dev/sd0e /home; cd /home; restore -rs 3 -f /dev/rst0
        shell#  mount /dev/sd0h /usr; cd /usr; restore -rs 4 -f /dev/rst0
a10669 1
   
d10674 1
a10674 1
   
d10682 3
a10684 3
    # vnconfig svnd0 /tmp/ISO.image                                                                     
    # mount -t cd9660 /dev/svnd0c /mnt                                                                  
   
d10691 3
a10693 3
    # umount /mnt                                                                                       
    # vnconfig -u svnd0                                                                                 
   
d10698 3
a10700 2
PCI IDE DMA is unreliable. This is why Microsoft disables it by default on the
operating systems it ships.
d10708 1
a10708 2

    wd2a:  aborted command, interface CRC error reading fsbn 64 of 64-79 (wd2 bn 127; cn 0 tn 2 sn 1), retrying
d10717 89
d10807 1
a10808 1
-------------------------------------------------------------------------------
d10810 30
a10839 1
$OpenBSD: obsd-faq.txt,v 1.31 2002/03/11 00:05:13 millert Exp $
@


1.31
log
@Mention that XP uses the same loader tricks as NT and include a link
to MS's XP Howto on the subject.
@
text
@d157 1
a157 1
$OpenBSD: obsd-faq.txt,v 1.30 2002/03/05 02:49:06 millert Exp $
d482 1
a482 1
$OpenBSD: obsd-faq.txt,v 1.30 2002/03/05 02:49:06 millert Exp $
d593 1
a593 1
$OpenBSD: obsd-faq.txt,v 1.30 2002/03/05 02:49:06 millert Exp $
d1616 1
a1616 1
$OpenBSD: obsd-faq.txt,v 1.30 2002/03/05 02:49:06 millert Exp $
d2076 1
a2076 1
$OpenBSD: obsd-faq.txt,v 1.30 2002/03/05 02:49:06 millert Exp $
d2804 1
a2804 1
/etc/pf.conf for the changes to take affect!
d4100 1
a4100 1
$OpenBSD: obsd-faq.txt,v 1.30 2002/03/05 02:49:06 millert Exp $
d4220 1
a4220 1
$OpenBSD: obsd-faq.txt,v 1.30 2002/03/05 02:49:06 millert Exp $
d5102 1
a5102 1
$OpenBSD: obsd-faq.txt,v 1.30 2002/03/05 02:49:06 millert Exp $
d5240 1
a5240 1
$OpenBSD: obsd-faq.txt,v 1.30 2002/03/05 02:49:06 millert Exp $
d6263 1
a6263 1
    #       $OpenBSD: obsd-faq.txt,v 1.30 2002/03/05 02:49:06 millert Exp $
d6439 1
a6439 1
$OpenBSD: obsd-faq.txt,v 1.30 2002/03/05 02:49:06 millert Exp $
d6866 1
a6866 1
$OpenBSD: obsd-faq.txt,v 1.30 2002/03/05 02:49:06 millert Exp $
d6930 1
a6930 1
$OpenBSD: obsd-faq.txt,v 1.30 2002/03/05 02:49:06 millert Exp $
d8650 1
a8650 1
$OpenBSD: obsd-faq.txt,v 1.30 2002/03/05 02:49:06 millert Exp $
d9680 1
a9680 1
$OpenBSD: obsd-faq.txt,v 1.30 2002/03/05 02:49:06 millert Exp $
@


1.30
log
@Update S/Key section to match OpenBSD 3.0 and mention how to do
things with 2.9 and below.  This section could still use some work,
specifically it should mention how to use S/Key with ssh.
@
text
@d157 1
a157 1
$OpenBSD: obsd-faq.txt,v 1.29 2002/02/02 05:17:17 chris Exp $
d482 1
a482 1
$OpenBSD: obsd-faq.txt,v 1.29 2002/02/02 05:17:17 chris Exp $
d593 1
a593 1
$OpenBSD: obsd-faq.txt,v 1.29 2002/02/02 05:17:17 chris Exp $
d1549 1
a1549 1
OpenBSD & NT
d1551 3
a1553 3
To multiboot OpenBSD and NT, you can use NTloader, the bootloader that NT uses.
To multi-boot with NT, you need a copy of your OpenBSD pbr. After running
installboot, you can copy it something like this:
d1566 3
d1616 1
a1616 1
$OpenBSD: obsd-faq.txt,v 1.29 2002/02/02 05:17:17 chris Exp $
d2076 1
a2076 1
$OpenBSD: obsd-faq.txt,v 1.29 2002/02/02 05:17:17 chris Exp $
d4100 1
a4100 1
$OpenBSD: obsd-faq.txt,v 1.29 2002/02/02 05:17:17 chris Exp $
d4220 1
a4220 1
$OpenBSD: obsd-faq.txt,v 1.29 2002/02/02 05:17:17 chris Exp $
d5102 1
a5102 1
$OpenBSD: obsd-faq.txt,v 1.29 2002/02/02 05:17:17 chris Exp $
d5240 1
a5240 1
$OpenBSD: obsd-faq.txt,v 1.29 2002/02/02 05:17:17 chris Exp $
d6263 1
a6263 1
    #       $OpenBSD: obsd-faq.txt,v 1.29 2002/02/02 05:17:17 chris Exp $
d6439 1
a6439 1
$OpenBSD: obsd-faq.txt,v 1.29 2002/02/02 05:17:17 chris Exp $
d6866 1
a6866 1
$OpenBSD: obsd-faq.txt,v 1.29 2002/02/02 05:17:17 chris Exp $
d6930 1
a6930 1
$OpenBSD: obsd-faq.txt,v 1.29 2002/02/02 05:17:17 chris Exp $
d8650 1
a8650 1
$OpenBSD: obsd-faq.txt,v 1.29 2002/02/02 05:17:17 chris Exp $
d9680 1
a9680 1
$OpenBSD: obsd-faq.txt,v 1.29 2002/02/02 05:17:17 chris Exp $
@


1.29
log
@Remove more -A from cvs examples.
@
text
@d157 1
a157 1
$OpenBSD: obsd-faq.txt,v 1.28 2002/01/12 01:41:19 ericj Exp $
d482 1
a482 1
$OpenBSD: obsd-faq.txt,v 1.28 2002/01/12 01:41:19 ericj Exp $
d593 1
a593 1
$OpenBSD: obsd-faq.txt,v 1.28 2002/01/12 01:41:19 ericj Exp $
d1613 1
a1613 1
$OpenBSD: obsd-faq.txt,v 1.28 2002/01/12 01:41:19 ericj Exp $
d2073 1
a2073 1
$OpenBSD: obsd-faq.txt,v 1.28 2002/01/12 01:41:19 ericj Exp $
d4097 1
a4097 1
$OpenBSD: obsd-faq.txt,v 1.28 2002/01/12 01:41:19 ericj Exp $
d4217 1
a4217 1
$OpenBSD: obsd-faq.txt,v 1.28 2002/01/12 01:41:19 ericj Exp $
d4765 1
a4765 1
use on un-secured channels. This can come very handy for those who don't have
d4767 2
a4768 2
implementation can use a variety of algorithms as the one-way hash. Here is the
list of algorithms available:
d4789 3
a4791 3
NOT your system password. The secret password is not limited to 8 characters
like system passwords, actually it must be at least 10 characters. A few word
phrases are suggested. Here is an example user being added.
d4820 7
a4826 1
to login. Here is an example session using s/key to login.
d4830 4
a4833 3
    220 oshibana.shin.ms FTP server (Version 6.4/OpenBSD) ready.
    Name (localhost:ericj): ericj
    331 Password [ otp-md5 96 oshi45820 ] for ericj required.
d4835 1
a4835 1
    230- OpenBSD 2.5-current (OSHIBANA) #8: Tue Jun 22 19:20:16 EDT 1999
d4851 9
a4859 8
Some of you might have noticed that my sequence number has changed. otp-md5 96
oshi45820. This is because by now I have used s/key to login several times. But
how do you get your password after you've logged in once? Well to do this,
you'll need to know what sequence number you're using and your key. As you're
probably thinking, how can you remember which sequence number you're on? Well
this is simple, use skeyinfo(1), and it will tell you what to use. For example
here, I need to generate another password for a login that I might have to make
in the future. (remember I'm doing this from a secure channel).
d4864 11
a4874 2
From this I can create the password for my next login. To do so, I'll use skey
(1). I can use exactly that output from above to create my password.
d4876 1
a4876 4
    oshibana:ericj> skey 95 oshi45820
    Reminder - Do not use this program while logged in via telnet or rlogin.
    Enter secret password:
    NOOK CHUB HOYT SAC DOLE FUME
d4878 1
a4878 1
I'm sure many of you won't always have a secure connect to create these
d4884 1
a4884 1
    oshibana:ericj> skey -n 5 95 oshi45820
d4899 2
a4900 1
same fashion as with ftp, only your first password must be "s/key". Example:
d4909 1
a4909 2
    login: ericj
    Password:              <------------ "s/key" entered.
d4911 1
a4911 1
    Response: SCAN OLGA BING PUB REEL COCA
d4914 1
a4914 1
    OpenBSD 2.5-current (OSHIBANA) #4: Thu Sep  2 23:36:16 EDT 1999
d5099 1
a5099 1
$OpenBSD: obsd-faq.txt,v 1.28 2002/01/12 01:41:19 ericj Exp $
d5237 1
a5237 1
$OpenBSD: obsd-faq.txt,v 1.28 2002/01/12 01:41:19 ericj Exp $
d6260 1
a6260 1
    #       $OpenBSD: obsd-faq.txt,v 1.28 2002/01/12 01:41:19 ericj Exp $
d6436 1
a6436 1
$OpenBSD: obsd-faq.txt,v 1.28 2002/01/12 01:41:19 ericj Exp $
d6863 1
a6863 1
$OpenBSD: obsd-faq.txt,v 1.28 2002/01/12 01:41:19 ericj Exp $
d6927 1
a6927 1
$OpenBSD: obsd-faq.txt,v 1.28 2002/01/12 01:41:19 ericj Exp $
d8647 1
a8647 1
$OpenBSD: obsd-faq.txt,v 1.28 2002/01/12 01:41:19 ericj Exp $
d9677 1
a9677 1
$OpenBSD: obsd-faq.txt,v 1.28 2002/01/12 01:41:19 ericj Exp $
@


1.28
log
@
update the text version of the faq

from Nick Holland <nick@@holland-consulting.net>
@
text
@d157 1
a157 1
$OpenBSD: faq1.html,v 1.28 2001/12/30 11:37:25 jufi Exp $
d482 1
a482 1
$OpenBSD: faq2.html,v 1.39 2001/12/30 11:37:25 jufi Exp $
d593 1
a593 1
$OpenBSD: faq3.html,v 1.21 2001/08/25 09:31:33 jufi Exp $
d1613 1
a1613 1
$OpenBSD: faq4.html,v 1.90 2001/12/07 17:08:39 millert Exp $
d2073 1
a2073 1
$OpenBSD: faq5.html,v 1.51 2001/09/03 15:37:01 mickey Exp $
d4097 1
a4097 1
$OpenBSD: faq6.html,v 1.117 2001/12/30 11:37:25 jufi Exp $
d4217 1
a4217 1
$OpenBSD: faq7.html,v 1.30 2001/12/30 11:37:25 jufi Exp $
d4412 1
a4412 1
    ericj@@oshibana:~> cvs -q up -PAd www
d5085 1
a5085 1
$OpenBSD: faq8.html,v 1.76 2001/12/30 11:37:25 jufi Exp $
d5223 1
a5223 1
$OpenBSD: faq9.html,v 1.31 2001/12/18 02:16:20 ericj Exp $
d6246 1
a6246 1
    #       $OpenBSD: faq10.html,v 1.59 2001/12/30 11:37:25 jufi Exp $
d6422 1
a6422 1
$OpenBSD: faq10.html,v 1.59 2001/12/30 11:37:25 jufi Exp $
d6849 1
a6849 1
$OpenBSD: faq11.html,v 1.18 2001/08/25 09:31:33 jufi Exp $
d6913 1
a6913 1
$OpenBSD: faq12.html,v 1.26 2001/08/25 09:31:33 jufi Exp $
d8633 1
a8633 1
$OpenBSD: faq13.html,v 1.46 2001/12/23 03:09:52 miod Exp $
d9663 1
a9663 1
$OpenBSD: faq14.html,v 1.52 2001/12/30 11:37:25 jufi Exp $
@


1.27
log
@
powerpc.html -> macppc.html
copyright notices cleaned up.
All work by David Krause <openbsd@@davidkrause.com>
@
text
@d1 1
d3 1
a3 1
   [1][Back to the main OpenBSD website]
d5 1
a5 2
                         Frequently Asked Questions
     _________________________________________________________________
d7 8
a14 1
   OpenBSD FAQ
d16 1
a16 77
    [2]1.0 Intro to OpenBSD
    [3]2.0 Other resources
    [4]3.0 Obtaining OpenBSD
    [5]4.0 Installation Guide
    [6]5.0 Kernel Configuration
    [7]6.0 Networking Setup
    [8]7.0 Keyboard Controls
    [9]8.0 General Questions
    [10]9.0 Migrating from Linux
    [11]10.0 System Management
    [12]11.0 Performance Tuning
    [13]12.0 For Advanced Users
    [14]13.0 Using IPSec
    [15]14.0 Disk setup

   Previous releases
    [16]2.4, [17]2.5

   Back to OpenBSD
    [18] [Back to the main OpenBSD website]


   This FAQ is maintained with information pertaining to the 2.6 release
   of OpenBSD. Not all information presented here may be accurate for
   older releases of OpenBSD. Information for previous releases is
   available. You should check [19]http://www.openbsd.org/errata.html for
   important updates. The FAQ follows release versions of OpenBSD. It
   will not have information pertaining to any -current options, it only
   attempts to track what has been released on CD. This is so there is no
   confusion as to which versions are being documented here.

   This FAQ will take you through most critical steps to setting up your
   own OpenBSD system. The addressed questions range from new to advanced
   users. Hopefully you will find this FAQ useful. Downloadable versions
   of the FAQ are available in text and PDF. These versions may not be as
   up-to-date as the HTML versions available from this page.
     * [20]Text Version
     * [21]PDF Version

   Any questions can be directed to: [22]faq@@openbsd.org

   The Current FAQ maintainers are:
   [23]Eric Jackson
   [24]Wim Vandeputte
   [25]Chris Cappuccio
        _________________________________________________________________

   OpenBSD FAQ Copyright  1998-1999 OpenBSD
   $OpenBSD: obsd-faq.txt,v 1.26 2001/08/08 21:06:33 jsyn Exp $

References

   1. http://openbsd.org/index.html
   2. http://openbsd.org/faq/faq1.html
   3. http://openbsd.org/faq/faq2.html
   4. http://openbsd.org/faq/faq3.html
   5. http://openbsd.org/faq/faq4.html
   6. http://openbsd.org/faq/faq5.html
   7. http://openbsd.org/faq/faq6.html
   8. http://openbsd.org/faq/faq7.html
   9. http://openbsd.org/faq/faq8.html
  10. http://openbsd.org/faq/faq9.html
  11. http://openbsd.org/faq/faq10.html
  12. http://openbsd.org/faq/faq11.html
  13. http://openbsd.org/faq/faq12.html
  14. http://openbsd.org/faq/faq13.html
  15. http://openbsd.org/faq/faq14.html
  16. http://openbsd.org/faq/faq11-2.4.html
  17. http://openbsd.org/faq/faq11-2.5.html
  18. http://openbsd.org/index.html
  19. http://openbsd.org/errata.html
  20. http://openbsd.org/faq/obsd-faq.txt
  21. http://openbsd.org/faq/obsd-faq.pdf
  22. mailto:faq@@openbsd.org
  23. mailto:ericj@@openbsd.org
  24. mailto:wvdputte@@openbsd.org
  25. mailto:chris@@openbsd.org
d19 1
a19 1
   [OpenBSD]
d21 4
a24 2
1.0 - Introduction to OpenBSD
     _________________________________________________________________
a25 8
   Table of Contents
     * [1]1.1 - What is OpenBSD?
     * [2]1.2 - On what systems does OpenBSD run?
     * [3]1.3 - Is OpenBSD really free?
     * [4]1.4 - Why might I want to use OpenBSD?
     * [5]1.5 - How can I help support OpenBSD?
     * [6]1.6 - Who maintains OpenBSD?
     _________________________________________________________________
d27 1
a27 1
1.1 - What is OpenBSD?
d29 1
a29 5
   The [7]OpenBSD project produces a freely available, multi-platform
   4.4BSD-based UNIX-like operating system. Our efforts place emphasis on
   portability, standardization, correctness, and security. [8]OpenBSD
   supports binary emulation of most binaries from SVR4 (Solaris),
   FreeBSD, Linux, BSDI, SunOS, and HPUX.
d31 22
a52 1
1.2 - On what systems does OpenBSD run?
d54 1
a54 30
   OpenBSD 2.6 runs on the following platforms:
     * [9]i386 - CD bootable
     * [10]sparc - CD bootable
     * [11]alpha - CD bootable
     * [12]hp300
     * [13]amiga
     * [14]mac68k
     * [15]powerpc
     * [16]pmax
     * [17]mvme68k
     * [18]mvme88k

   The ports for pmax, mvme68k, and mvme88k are not included on the 2.6
   CDs. They can be downloaded from any of the OpenBSD ftp sites

   bootable means that OpenBSD will boot directly from the CD. The CD set
   will boot on several hardware platforms. See [19]section 3.0 of this
   FAQ for details of obtaining OpenBSD on CD.

   Previous releases of OpenBSD also had a port for:
     * [20]arc

   This port was removed from the 2.4 release, but was included in 2.3 if
   you are interested. If you have the proper equipment, bring them up to
   date! You can see updated information about specific platforms at
   [21]http://www.openbsd.org/plat.html

   Yes, OpenBSD will run on your multiprocessor machine, but it will only
   use one processor. There currently is no support for SMP. Check
   [22]8.12
d58 20
a77 22
   OpenBSD is all free. The binaries are free. The source is free. All
   parts of OpenBSD have reasonable copyright terms permitting free
   redistribution. This includes the ability to REUSE most parts of the
   OpenBSD source tree, either for personal or commercial purposes.
   OpenBSD includes NO further restrictions other than those implied by
   the original BSD license. Software which is written under stricter
   licenses cannot be included in the regular distribution of OpenBSD.
   This is intended to safeguard the free use of OpenBSD. For example,
   OpenBSD can be freely used for personal use, for academic use, by
   government institutions, by non-profit making organizations and by
   commercial organizations.

   For further reading on other popular licenses read:
   [23]http://www.openbsd.org/policy.html.

   The maintainers of OpenBSD support the project largely from their own
   pockets. This includes the time spent programming for the project,
   equipment used to support the many ports, the network resources used
   to distribute OpenBSD to you, and the time spent answering questions
   and investigating users' bug reports. The OpenBSD developers are not
   independently wealthy and even small contributions of time, equipment,
   and resources make a big difference.
d81 22
a102 24
   New users frequently want to know whether OpenBSD is superior to some
   other free UNIX-like operating system. That question is largely
   un-answerable and is the subject of countless (and useless) religious
   debates. Do not, under any circumstances, ask such a question on an
   OpenBSD mailing list.

   Below are some reasons why we think OpenBSD is a useful operating
   system. Whether OpenBSD is right for you is a question that only you
   can answer.

     * OpenBSD runs on many different hardware platforms.
     * OpenBSD is thought of by many security professionals to be the
       most secure UNIX-like operating system as the result of a
       10-member 1.5-year long comprehensive source code security audit.
     * OpenBSD is a full-featured UNIX-like operating system available in
       source form at no charge.
     * OpenBSD integrates cutting-edge security technology suitable for
       building firewalls and private network services in a distributed
       environment.
     * OpenBSD benefits from strong on-going development in many areas,
       offering opportunities to work with emerging technologies with an
       international community of programmers and end-users.
     * OpenBSD offers opportunities for ordinary people to participate in
       the development and testing of the product.
d106 41
a146 45
   We are greatly indebted to the people and organizations that have
   contributed to the OpenBSD project. They are acknowledged by name
   here:

   [24]http://www.openbsd.org/donations.html

   OpenBSD has a constant need for several types of support from the user
   community. If you find OpenBSD useful, you are strongly encouraged to
   find a way to contribute. If none of the suggestions below are right
   for you, feel free to propose an alternative by sending e-mail to
   [25]donations@@openbsd.org.

     * Buy an OpenBSD CD. It includes the current full release of
       OpenBSD, and is bootable on many platforms. It also generates
       revenue to support the OpenBSD project, and reduces the strain on
       network resources used to deliver the distribution via the
       Internet. This inexpensive two-CD set includes full source.
       Remember, your friends need their own copy!
     * Donate money. The project has a constant need for cash to pay for
       equipment, network connectivity, and expenses relating to CD
       publishing. Manufacturing CDs requires an up-front out-of-pocket
       investment for the OpenBSD developers, without guaranteed return.
       Send e-mail to [26]donations@@openbsd.org to find out how to
       contribute. Even small donations make a profound difference.
     * Donate equipment and parts. The project has a constant need for
       general and specific hardware. Items such as IDE and SCSI disks,
       and various types of RAM are always welcome. For other types of
       hardware such as computer systems and motherboards, you should
       inquire as to current need. Write to [27]donations@@openbsd.org to
       arrange for shipment.
     * Donate your time and skills. Programmers who enjoy writing
       operating systems are naturally always welcome, but there are
       literally dozens of other ways that people can be useful. Follow
       mailing lists and help answer new-user questions.
     * Help maintain documentation by submitting new FAQ material (to
       [28]faq@@openbsd.org). Form a local user group and get your friends
       hooked on OpenBSD. Make a case to your employer for using OpenBSD
       at work. If you're a student, talk to your professors about using
       OpenBSD as a learning tool for Computer Science or Engineering
       courses. It's also worth mentioning one of the most important ways
       you should not try to "help" The OpenBSD project: do not waste
       your time engaging in operating system flame wars on Usenet
       newsgroups. It does not help the project to find new users and can
       cause substantial harm to important relationships that developers
       have with other developers.
d150 4
a153 43
   OpenBSD is maintained by a development team spread across many
   different countries. The project is coordinated by Theo de Raadt,
   located in Canada.

   [29][To Section 2.0 - Other OpenBSD information resources]
     _________________________________________________________________

   [30][back] [31]www@@openbsd.org
   $OpenBSD: obsd-faq.txt,v 1.26 2001/08/08 21:06:33 jsyn Exp $

References

   1. http://openbsd.org/faq/faq1.html#1.1
   2. http://openbsd.org/faq/faq1.html#1.2
   3. http://openbsd.org/faq/faq1.html#1.3
   4. http://openbsd.org/faq/faq1.html#1.4
   5. http://openbsd.org/faq/faq1.html#1.5
   6. http://openbsd.org/faq/faq1.html#1.6
   7. http://openbsd.org/index.html
   8. http://openbsd.org/index.html
   9. http://openbsd.org/i386.html
  10. http://openbsd.org/sparc.html
  11. http://openbsd.org/alpha.html
  12. http://openbsd.org/hp300.html
  13. http://openbsd.org/amiga.html
  14. http://openbsd.org/mac68k.html
  15. http://openbsd.org/macppc.html
  16. http://openbsd.org/pmax.html
  17. http://openbsd.org/mvme68k.html
  18. http://openbsd.org/mvme88k.html
  19. http://openbsd.org/faq/faq3.html
  20. http://openbsd.org/arc.html
  21. http://openbsd.org/plat.html
  22. http://openbsd.org/faq/faq8.html#8.12
  23. http://openbsd.org/policy.html
  24. http://openbsd.org/donations.html
  25. mailto:donations@@openbsd.org
  26. mailto:donations@@openbsd.org
  27. mailto:donations@@openbsd.org
  28. mailto:faq@@openbsd.org
  29. http://openbsd.org/faq/faq2.html
  30. http://openbsd.org/faq/index.html
  31. mailto:www@@openbsd.org
d155 3
d159 1
a159 1
   [OpenBSD]
a161 1
     _________________________________________________________________
d163 10
a172 6
   Table of Contents
     * [1]2.1 - Web Pages
     * [2]2.2 - Mailing Lists
     * [3]2.3 - Manual Pages
     * [4]2.4 - Reporting Bugs
     _________________________________________________________________
d176 2
a177 2
   The official website for the OpenBSD project is located at:
   [5]http://www.OpenBSD.org
d179 5
a183 2
   A lot of valuable information can be found here regarding all aspects
   of the OpenBSD project.
a184 2
   Additional information for laptop users can be found at:
   [6]http://www.monkey.org/openbsd-mobile/
d188 49
a236 45
   The OpenBSD project maintains several popular mailing lists which
   users should subscribe to and follow. To subscribe to a mailing list,
   send an e-mail message to [7]majordomo@@openbsd.org. That address is an
   automated subscription service. In the body of your message, on a
   single line, you should include a subscribe command for the list you
   wish to join. For example:
subscribe announce

   The list processor will reply to you, asking for confirmation of your
   intent to join the list. The confirmation you send back to the list
   processor will be included in its reply to you. It will look something
   like this:
auth 90855167 subscribe announce you@@example.com

   Once you have confirmed your intent to join, you will be immediately
   added to the list, and the list processor will notify you that you
   were successfully added.

   To unsubscribe from a list, you will again send an e-mail message to
   [8]majordomo@@openbsd.org. It might look like this:
unsubscribe announce

   If you have any difficulties with the mailing list system, please
   first read the instructions. They can be obtained by sending an e-mail
   message to [9]majordomo@@openbsd.org with a message body of "help".
   These are the currently-available OpenBSD mailing lists:

     * announce - Important announcements. This is a low-volume list.
     * tech - General technical discussions
     * misc - User questions and answers
     * bugs - Bugs received via sendbug(1) and discussions about them.
     * source-changes - Automated mailing of CVS source tree changes.
     * ports - Discussion of the OpenBSD Ports Tree
     * advocacy - Discussion of advocating OpenBSD.

   Archives of the OpenBSD mailing lists can be found by visiting the
   mailing lists web page: [10]http://www.openbsd.org/mail.html
   You can also get mail archives from
   [11]http://www.monkey.org/cgi-bin/wilma or
   [12]http://www.geocrawler.com/lists/4/OpenBSD. These website contains
   searchable archives of the OpenBSD mailing lists.

   Another mailing list that may be of interest is
   [13]openbsd-mobile@@monkey.org. This mailing list is a discussion of
   the use of OpenBSD in mobile computing.
d238 1
a238 1
   To subscribe to this list use:
d240 2
a241 1
   'echo subscribe | mail "openbsd-mobile-request@@monkey.org"'
a242 2
   The archives for that can be found at:
   [14]http://www.monkey.org/openbsd-mobile/archive/
d246 117
a362 108
   OpenBSD comes with extensive documentation in the form of manual
   pages, as well as longer documents relating to specific applications.
   To access the manual pages and other documentation, be sure that you
   installed the man, misc, and text distributions.

   Here is a list of some of the most useful manual pages for new users:

     * [15]afterboot(8) - things to check after the first complete boot
     * [16]boot(8) - system boot strapping procedures
     * [17]passwd.conf(5) - format of the password configuration file
     * [18]adduser_proc(8) - procedure for adding new users
     * [19]adduser(8) - command for adding new users
     * [20]vipw(8) - edit the pass word file
     * [21]man(1) - display the on-line manual pages
     * [22]sendbug(1) - send a problem report (PR) about OpenBSD to a
       central support site.
     * [23]disklabel(8) - Read and write disk pack label.
     * [24]ifconfig(8) - configure network interface parameters.
     * [25]route(8) - manually manipulate the routing tables.
     * [26]netstat(1) - show network status.
     * [27]reboot, halt(8) - Stopping and restarting the system.
     * [28]shutdown(8) - close down the system at a given time.
     * [29]boot_config(8) - how to change kernel configuration at boot

   Also, If you are one of the people who didn't install the man*.tar.gz
   package, you can find all the OpenBSD man pages on the web at
   [30]http://www.openbsd.org/cgi-bin/man.cgi.

   In general, if you know the name of a command or a manual page, you
   can read it by executing `man command'. For example: `man vi' to read
   about the vi editor. If you don't know the name of the command, or if
   `man command' doesn't find the manual page, you can search the manual
   page database by executing `apropos something' or `man -k something'
   where something is a likely word that might appear in the title of the
   manual page you're looking for. For example:
bsd# apropos "time zone"
tzfile (5) - time zone information
zdump (8) - time zone dumper
zic (8) - time zone compiler

   The parenthetical numbers indicate the section of the manual in which
   that page can be found. In some cases, you may find manual pages with
   identical names living in separate sections of the manual. For
   example, assume that you want to know the format of the configuration
   files for the cron daemon. Once you know the section of the manual for
   the page you want, you would execute `man n command' where n is the
   manual section number.
bsd# man -k cron
cron (8) - daemon to execute scheduled commands (Vixie Cron)
crontab (1) - maintain crontab files for individual users (V3)
crontab (5) - tables for driving cron
bsd# man 5 crontab

   In addition to the UNIX manual pages, there is a typesettable document
   set (included in the misc distribution). It lives in the
   /usr/share/doc directory. If you also installed the text distribution,
   then you can format each document set with a `make' in the appropriate
   subdirectory. The psd subdirectory is the Programmer's Supplementary
   Documents distribution. The smm subdirectory is the System Manager's
   Manual. The usd subdirectory is the UNIX User's Supplementary
   Documents distribution. You can perform your `make' in the three
   distribution subdirectories, or you can select a specific section of a
   distribution and do a `make' in its subdirectory. Some of the
   subdirectories are empty. By default, formatting the documents will
   result in Postscript output, suitable for printing. The Postscript
   output can be quite large -- you should assume 250-300% increase in
   volume. If you do not have access to a Postscript printer or display,
   you may also format the documents for reading on a terminal display.
   In each Makefile you'll need to add the flag -Tascii to each instance
   of the groff commands (or execute it by hand). Some of the documents
   use the ms formatting macros, and some use the me macros. The Makefile
   in each document subdirectory (eg, /usr/share/doc/usd/04.csh/Makefile)
   will tell you which one to use. For example:
bsd# cd /usr/share/doc/usd/04.csh
bsd# groff -Tascii -ms tabs csh.1 csh.2 csh.3 csh.4 csh.a csh.g > csh.txt
bsd# more csh.txt

   The UNIX manual pages are generally more current and trustworthy than
   the typesettable documents. The typesettable documents sometimes
   explain complicated applications in more detail than the manual pages
   do.

   For many, having a hardcopy of the man page can be useful. Here are
   the guidelines to making a printable copy of a man page.

  How do I display a man page source file? (i.e., one whose filename ends in a
  number, like tcpdump.8).

   This is found throughout the src tree. The man pages are found in the
   tree unformatted, and many times through the use of [31]CVS, they will be
   updated. To view these pages simply :
# nroff -mdoc <file> | more

  How do I get a plain man page with no formatting or control characters?

   This is helpful to get the man page straight, with no non-printable
   characters.
   Example:
# man <command> | col -b

  How can I get a PostScript copy of a man page that's print-ready?

   Note that must be the man page source file (probably a file that ends
   in a number; i.e., tcpdump.8). The PostScript versions of the man
   pages look very nice. They can be printed or viewed on-screen with a
   program like gv (GhostView). GhostView can be found in our [32]Ports
   Tree.
# groff -mdoc -Tps <man_src_file> > outfile.ps
d366 119
a484 2
   Before submitting any bug report, please read
   [33]http://www.openbsd.org/report.html
d486 1
a486 150
   Proper bug reporting is one of the most important responsibilities of
   end users. Very detailed information is required to diagnose most
   serious bugs. Developers frequently get bugs reports via e-mail such
   as these:
From: joeuser@@example.com
To: bugs@@openbsd.org
Subject: HELP!!!

I have a PC and it won't boot!!!!! It's a 486!!!!!


   Hopefully most people understand why such reports get summarily
   deleted. All bug reports should contain detailed information. If Joe
   User had really wanted his bug investigated, his bug report would have
   looked something like this:
From: smartuser@@example.com
To: bugs@@openbsd.org
Subject: 2.6 panics on an i386

After installing OpenBSD 2.6 from the CD which I purchased via your outstanding
on-line ordering system, I find that the system halts before the kernel even
gets loaded. After booting with a bootdisk and escaping to a shell. This is the
dmesg output:

OpenBSD 2.6 (GENERIC) #690: Fri Oct 29 16:32:17 MDT 1999
    deraadt@@i386.openbsd.org:/usr/src/sys/arch/i386/compile/GENERIC
cpu0: F00F bug workaround installed
cpu0: Intel Pentium (P54C) ("GenuineIntel" 586-class) 120 MHz
cpu0: FPU,V86,DE,PSE,TSC,MSR,MCE,CX8
BIOS mem  = 654336 conventional, 15728640 extended
real mem  = 16384000
avail mem = 11112448
using 225 buffers containing 921600 bytes of memory
mainbus0 (root)
bios0 at mainbus0: AT/286+(63) BIOS, date 08/20/96
bios0: diskinfo 0xe055800c cksumlen 1 memmap 0xe0558088 apminfo 0xe0558134
apm0 at bios0: Power Management spec V1.1
apm0: battery life expectancy 95%
apm0: AC on, battery charge high, charging, estimated 1:27 minutes
pci0 at mainbus0 bus 0: configuration mode 1 (no bios)
pchb0 at pci0 dev 0 function 0 "Toshiba (2nd ID) Host-PCI" rev 0x11
"Chips and Technologies 65550" rev 0x04 at pci0 dev 4 function 0 not configured
isa0 at mainbus0
isadma0 at isa0
wdc0 at isa0 port 0x1f0/8 irq 14
wd0 at wdc0 channel 0 drive 0: <TOSHIBA MK2720FC>
wd0: can use 16-bit, PIO mode 4
wd0: 16-sector PIO, LBA, 1296MB, 2633 cyl, 16 head, 63 sec, 2654280 sectors
sb0 at isa0 port 0x220/24 irq 5 drq 1: dsp v3.02
midi0 at sb0: <SB MIDI UART>
audio0 at sb0
opl0 at sb0: model OPL3
midi1 at opl0: <SB Yamaha OPL3>
wss0 at isa0 port 0x530/8 irq 10 drq 0: CS4232 (vers 63)
audio1 at wss0
pcppi0 at isa0 port 0x61
midi2 at pcppi0: >PC speaker<
sysbeep0 at pcppi0
npx0 at isa0 port 0xf0/16: using exception 16
pccom0 at isa0 port 0x3f8/8 irq 4: ns16550a, 16 byte fifo
pccom1 at isa0 port 0x2f8/8 irq 3: ns16550a, 16 byte fifo
pccom2: irq 5 already in use
vt0 at isa0 port 0x60/16 irq 1: generic VGA, 80 col, color, 8 scr, mf2-kbd
pms0 at vt0 irq 12
fdc0 at isa0 port 0x3f0/6 irq 6 drq 2
fd0 at fdc0 drive 0: 1.44MB 80 cyl, 2 head, 18 sec
pcic0 at isa0 port 0x3e0/2 iomem 0xd0000/16384
pcic0 controller 0:  has sockets A and B
pcmcia0 at pcic0 controller 0 socket 0
pcmcia1 at pcic0 controller 0 socket 1
ne3 at pcmcia1 function 0 "Linksys, EtherFast 10/100 PC Card (PCMPC100), " port
 0x340/16 irq 9
ne3: address 00:e0:98:04:95:ba
pcic0: irq 11
biomask 4040 netmask 4240 ttymask 5a42
pctr: 586-class performance counters and user-level cycle counter enabled
dkcsum: wd0 matched BIOS disk 80
root on wd0a
rootdev=0x0 rrootdev=0x300 rawdev=0x302

Thank you!

   If Joe User had a working OpenBSD system from which he wanted to
   submit a bug report, he would have used the sendbug(1) utility to
   submit his bug report to the GNATS problem tracking system. Obviously
   you can't use sendbug(1) when your system won't boot, but you should
   use it whenever possible. You will still need to include detailed
   information about what happened, the exact configuration of your
   system, and how to reproduce the problem. The sendbug(1) command
   requires that your system be able to deliver electronic mail
   successfully on the Internet.

   If you have submitted a bug report and you want to check its current
   status without annoying anyone, the best ways are:

     * Visit the GNATS tracking system:
       [34]http://cvs.openbsd.org/cgi-bin/wwwgnats.pl.
     * Look in the [35]bugs@@openbsd.org list archives:
       [36]http://www.openbsd.org/mail.html.

   [37][Back to Main Index] [38][To Section 1.0 - Introduction to
   OpenBSD] [39][To Section 3.0 - Obtaining OpenBSD]
     _________________________________________________________________

   [40][back] [41]www@@openbsd.org
   $OpenBSD: obsd-faq.txt,v 1.26 2001/08/08 21:06:33 jsyn Exp $

References

   1. http://openbsd.org/faq/faq2.html#2.1
   2. http://openbsd.org/faq/faq2.html#2.2
   3. http://openbsd.org/faq/faq2.html#2.3
   4. http://openbsd.org/faq/faq2.html#2.4
   5. http://www.openbsd.org/
   6. http://www.monkey.org/openbsd-mobile/
   7. mailto:majordomo@@openbsd.org
   8. mailto:majordomo@@openbsd.org
   9. mailto:majordomo@@openbsd.org
  10. http://openbsd.org/mail.html
  11. http://www.monkey.org/cgi-bin/wilma
  12. http://www.geocrawler.com/lists/4/OpenBSD
  13. mailto:openbsd-mobile@@monkey.org
  14. http://www.monkey.org/openbsd-mobile/archive/
  15. http://www.openbsd.org/cgi-bin/man.cgi?query=afterboot&apropos=0&sektion=8&format=html
  16. http://www.openbsd.org/cgi-bin/man.cgi?query=boot&apropos=0&sektion=8&format=html
  17. http://www.openbsd.org/cgi-bin/man.cgi?query=passwd.conf&apropos=0&sektion=5&format=html
  18. http://www.openbsd.org/cgi-bin/man.cgi?query=adduser_proc&apropos=0&sektion=8&format=html
  19. http://www.openbsd.org/cgi-bin/man.cgi?query=adduser&apropos=0&sektion=8&format=html
  20. http://www.openbsd.org/cgi-bin/man.cgi?query=vipw&apropos=0&sektion=8&format=html
  21. http://www.openbsd.org/cgi-bin/man.cgi?query=man&apropos=0&sektion=1&format=html
  22. http://www.openbsd.org/cgi-bin/man.cgi?query=sendbug&apropos=0&sektion=1&format=html
  23. http://www.openbsd.org/cgi-bin/man.cgi?query=disklabel&apropos=0&sektion=8&format=html
  24. http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&apropos=0&sektion=8&format=html
  25. http://www.openbsd.org/cgi-bin/man.cgi?query=route&apropos=0&sektion=8&format=html
  26. http://www.openbsd.org/cgi-bin/man.cgi?query=netstat&apropos=0&sektion1&format=html
  27. http://www.openbsd.org/cgi-bin/man.cgi?query=reboot&apropos=0&sektion=8&format=html
  28. http://www.openbsd.org/cgi-bin/man.cgi?query=shutdown&apropos=0&sektion=8&format=html
  29. http://www.openbsd.org/cgi-bin/man.cgi?query=boot_config&apropos=0&sektion=8&format=html
  30. http://www.openbsd.org/cgi-bin/man.cgi
  31. http://openbsd.org/faq/faq8.html#8.5
  32. http://openbsd.org/ports.html
  33. http://openbsd.org/report.html
  34. http://cvs.openbsd.org/cgi-bin/wwwgnats.pl
  35. mailto:bugs@@openbsd.org
  36. http://www.openbsd.org/mail.html
  37. http://openbsd.org/faq/index.html
  38. http://openbsd.org/faq/faq1.html
  39. http://openbsd.org/faq/faq3.html
  40. http://openbsd.org/faq/index.html
  41. mailto:www@@openbsd.org
d488 1
d490 7
a496 1
   [OpenBSD]
d498 1
a498 2
3.0 - Obtaining OpenBSD
     _________________________________________________________________
a499 7
   Table of Contents
     * [1]3.1 - Buying an OpenBSD CD
     * [2]3.1.1 - Buying OpenBSD T-Shirts
     * [3]3.1.2 - Where can I get an OpenBSD iso image?
     * [4]3.2 - Downloading via FTP or AFS
     * [5]3.3 - Obtaining Current Source Code
     _________________________________________________________________
d503 20
a522 21
   Purchasing an OpenBSD CD is generally the best way to get started.
   Visit the ordering page to purchase your copy:
   [6]http://www.openbsd.org/orders.html.

   There are many good reasons to own an OpenBSD CD:
     * CD sales support on-going development of OpenBSD.
     * Development of a multi-platform operating system requires constant
       investment in equipment.
     * Your support in the form of a CD purchase has a real impact on
       future development.
     * The CD contains binaries (and source) for all supported platforms.
     * The CD is bootable on several platforms, and can be used to
       bootstrap a machine without a pre-existing installed operating
       system.
     * The CD is useful for bootstrapping even if you choose to install a
       snapshot.
     * Installing from CD is faster! Installing from CD preserves network
       connectivity resources.
     * OpenBSD CDs always come with very nice stickers. You system isn't
       fully complete without these. You can only get these stickers by
       buying a CD set or donating hardware.
d524 2
a525 2
   If you're installing a release version of OpenBSD, you should use a
   CD. Snapshot releases can only be installed over the network.
d529 2
a530 2
   Yes, OpenBSD now has t-shirts for your wearing enjoyment. You can view
   these at [7]http://www.OpenBSD.org/tshirts.html. Enjoy :)
d534 16
a549 4
   You can't. The official OpenBSD CD-ROM layout is copyright Theo de
   Raadt, as an incentive for people to buy the CD set. Note that only
   the layout is copyrighted, OpenBSD itself is free. Nothing precludes
   someone else to just grab OpenBSD and make their own CD.
d553 7
a559 7
   There are numerous international mirror sites offering FTP access to
   OpenBSD releases and snapshots. AFS access is also available. You
   should always use the site closest to you. Before you begin fetching a
   release or snapshot, you may wish to use ping and traceroute to
   determine which mirror site is nearest to you and whether that nearest
   mirror is performing adequately. Of course, your OpenBSD release CD is
   always closer than any mirror. Access information is here:
d561 1
a561 1
   [8]http://www.openbsd.org/ftp.html
d565 5
a569 48
   Source to OpenBSD is freely redistributable and available at no
   charge. Generally the best way to get started with a current source
   tree is to install the source from the most recent CD and then
   configure AnonCVS to update it regularly. Information about AnonCVS,
   including how to set it up, is available here:

   [9]http://www.openbsd.org/anoncvs.html.

   or check [10]The OpenBSD FAQ

   If you don't have sufficient network bandwidth to support AnonCVS, or
   if your Internet access is via UUCP, you can still keep your source
   current by using CTM instead of AnonCVS. If that's your situation,
   then starting with a recent release CD is even more important.
   Information about CTM, including how to set it up, is available here:

   [11]http://www.openbsd.org/ctm.html.

   Yet another alternative is to get the source code from the web. You
   can do that through cvsweb at:
   [12]Http://www.openbsd.org/cgi-bin/cvsweb/

   [13][Back to Main Index] [14][To Section 2.0 - Other OpenBSD
   information resources] [15][To Section 4.0 - Installation Guide]
     _________________________________________________________________

   [16][back] [17]www@@openbsd.org
   $OpenBSD: obsd-faq.txt,v 1.26 2001/08/08 21:06:33 jsyn Exp $

References

   1. http://openbsd.org/faq/faq3.html#3.1
   2. http://openbsd.org/faq/faq3.html#3.1.1
   3. http://openbsd.org/faq/faq3.html#3.1.2
   4. http://openbsd.org/faq/faq3.html#3.2
   5. http://openbsd.org/faq/faq3.html#3.3
   6. http://openbsd.org/orders.html
   7. http://openbsd.org/tshirts.html
   8. http://openbsd.org/ftp.html
   9. http://openbsd.org/anoncvs.html
  10. http://openbsd.org/faq/faq8.html#8.5
  11. http://openbsd.org/ctm.html
  12. http://www.openbsd.org/cgi-bin/cvsweb/
  13. http://openbsd.org/faq/index.html
  14. http://openbsd.org/faq/faq2.html
  15. http://openbsd.org/faq/faq4.html
  16. http://openbsd.org/faq/index.html
  17. mailto:www@@openbsd.org
d571 1
d573 23
a595 1
   [OpenBSD]
d598 10
a607 1
     _________________________________________________________________
d609 1
a609 9
   Table of Contents
     * [1]4.1 - Overview of the OpenBSD Installation Procedure.
     * [2]4.2 - What files are needed for Installation?
     * [3]4.3 - How much space do I need for an OpenBSD installation?
     * [4]4.4 - Multibooting OpenBSD
     * [5]4.5 - Sending your dmesg to dmesg@@openbsd.org after the install
     * [6]My install halts at MAKEDEV all on my i386 system with 8meg of
       RAM.
     _________________________________________________________________
d613 863
a1475 49
   OpenBSD provides multiple ways of installing a fresh OpenBSD system
   for multiple architectures. This will give most everyone in almost any
   situation to be able to install an OpenBSD system. The separate ways
   of installing an OpenBSD system are as follows:
     * CD-ROM - For this you will need to have purchased and OpenBSD CD.
       You can do so by going to [7]http://www.openbsd.org/orders.html.
       This is probably the easiest way of installing OpenBSD.
     * FTP - This option requires you know your IP, Netmask, Gateway,
       etc. If this is so, there is an enormous list of ftp mirrors
       around the world which make this a speedy way of getting OpenBSD
       on your system.
     * DHCP - This options is the same as FTP except that your IP,
       Netmask, Gateway and Nameservers are retrieved from the DHCP
       server.
     * Local Filesystem - This option allows you to install from files on
       a pre-existing filesystem. Support for DOS, EXT2FS and FFS are
       included on the install disk.
     * NFS - This allows you to install from files located on an nfs
       server. Read [8]mount_nfs(8) for more information.

   All these methods of installation are available on ONE floppy disk.
   These disks can be downloaded directly from any of the ftp mirrors. (
   You can get a list of mirrors on [9]http://www.openbsd.org/ftp.html. )
   Each architecture has their own disk, so make sure you get the correct
   disk for your architecture. A list of supported architectures can be
   found in [10]FAQ 1.

   Here are detailed, complete walk-through guides of the installation
   process for i386 and sparc architectures. Don't forget to look at the
   [11]INSTALL.i386 and [12]INSTALL.sparc documents also.
     * [13]install-i386.html for i386 architecture.
     * [14]install-sparc.html for sparc architecture.

   People using other architectures are urged to look at the INSTALL.arch
   document that comes with the OpenBSD distribution for their
   architecture, as well as this [15]generic installation walkthrough.

  Alpha architecture notes

   Your alpha must use SRM firmware, as opposed to ARC. With the alpha
   architechture you can install by booting from the CD using CD2. You
   can do this by using a command such as
   boot -fi 2.6/alpha/bsd.rd dkaX

   Use show device to find your CDROM drive identifier. If you are unable
   to boot from the CD, you can still use the bootdisk provided at
   CD2:2.6/alpha/floppy26.fs, and write it using the ways detailed above
   for the i386 architecture. And again follow the [16]install
   walkthrough guide.
d1479 15
a1493 17
   There are many packages containing the OpenBSD binaries, but which
   ones do you need to get your system up and running? Here is an
   overview of each package.

     * base26.tar.gz - Has the base OpenBSD system Required
     * etc26.tar.gz - Has all the files in /etc Required
     * comp26.tar.gz - Has the compiler and its tools, libs. Recommended
     * man26.tar.gz - Holds man pages Recommended
     * misc26.tar.gz - Holds misc info, setup docs
     * game26.tar.gz - Has the games for OpenBSD
     * xbase26.tar.gz - Has the base install for X11
     * xfont26.tar.gz - Holds X11's font server and fonts
     * xlink26.tar.gz - Has the X servers link kit
     * xserv26.tar.gz - Has X11's X servers
     * xshare26.tar.gz - Has manpages, locale settings, includes, etc for
       X
     * bsd - This is the Kernel. Required
d1497 49
a1545 50
   The following are suggested sub-tree sizes for a full system install.
   The numbers include enough extra space to permit you to run a typical
   home system that is connected to the internet.
     * For a multiuser system, you probably want to triple these values.
     * If you plan to install a significant amount of third party
       software, make your /usr partition large! At least triple these
       values!
     * For a system that handles lots of email or web pages (stored,
       respectively, in /var/mail and /var/www) you will want to make
       your /var partition significantly larger.
     * For a multiuser system which may generate lots of logs, you will
       still want to make your /var partition significantly larger
       (/var/log).

   As you read this, keep in mind that /usr and /usr/X11R6 are usually
   both parts of the same filesystem, that is, /usr, as there is no big
   advantage to making them into separate filesystems.
SYSTEM          /       /usr    /var    /usr/X11R6
alpha           56M     540M    27M     161M
amiga           45M     399M    24M      36M
hp300           31M     234M    24M      47M
i386            35M     229M    24M      72M
mac68k          29M     232M    24M      36M
mvme68k         29M     232M    24M       -  (no Xserver)
pmax            50M     355M    24M      60M
sparc           40M     259M    24M      49M

   When you are in the disklabel editor, you may choose to make your
   entire system have just an 'a' (main filesystem) and 'b' (swap) . The
   'a' filesystem which you set up in disklabel will become your root
   partition, which should be the sum of all the 3 main values above (/,
   /usr, and /var) plus some space for /tmp. The 'b' partition you set up
   automatically becomes your system swap partition -- we recommend a
   minimum of 32MB but if you have disk to spare make it at least 64MB.
   If you have lots of disk space to spare, make this 256MB, or even
   512MB.

   There are four main reasons for using separate filesystems, instead of
   shoving everything into one or two filesystems:
     * Security: You can mark some filesystems as 'nosuid', 'nodev',
       'noexec', 'readonly', etc..
     * Stability: A user, or a misbehaved program, can fill a filesystem
       with garbage, if they have write permissions for it. Your critical
       programs, which of course run on a different filesystem, do not
       get interrupted.
     * Speed: A filesystem which gets written to frequently may get
       somewhat fragmented. (Luckily, the ffs filesystem, what OpenBSD
       uses, is not prone to heavy fragmentation.)
     * Integrity: If one filesystem is corrupted for some reason then
       your other filesystems are still OK.
d1549 5
a1553 1
   OpenBSD & NT
a1554 3
   To multiboot OpenBSD and NT, you can use NTloader, the bootloader that
   NT uses. To multi-boot with NT, you need a copy of your OpenBSD pbr.
   After running installboot, you can copy it something like this:
d1557 3
a1559 2
   Now boot NT and put openbsd.pbr in c:. Add a line like this to the end
   of c:\boot.ini:
d1562 3
a1564 3
   When you reboot, you should be able to select OpenBSD from the NT
   loader menu. There is much more information available about NTloader
   at the [17]NTLDR Hacking Guide.
d1566 1
a1566 1
   OpenBSD & Windows or DOS (i386)
d1568 4
a1571 4
   To boot OpenBSD along with Windows 3.1, Windows95, or DOS you must use
   a boot loader on the system that can handle OpenBSD, Windows, and DOS!
   Some bootloaders of choice are [18]osbs20b8.zip or [19]The Ranish
   Partition Manager. Both of these are able to boot OpenBSD partitions.
d1573 1
a1573 1
   OpenBSD & Linux (i386)
d1575 2
a1576 2
   Please refer to [20]INSTALL.linux, which gives indepth instructions on
   getting OpenBSD working with Linux.
d1580 2
a1581 3
   Just to remind people, it's important for the OpenBSD developers to
   keep track of what hardware works, and what hardware doesn't work
   perfectly..
d1583 1
a1583 1
   A quote from /usr/src/etc/root/root.mail
d1592 1
d1594 5
a1598 7
   Also check with [21]section 14.7

   Make sure you send email from an account that is able to also receive
   email so developers can contact you back if they have something they
   want you to test or change in order to get your setup working. It's
   not important at all to send the email from the same machine that is
   running OpenBSD, so if that machine is unable to receive email, just
d1600 4
d1605 2
a1606 2
   and then forward that message to
 dmesg@@openbsd.org
d1608 2
a1609 2
   where your-account@@yourmail.dom is your regular email account. (or
   transfer the dmesg output using ftp/scp/floppydisk/carrier-pigeon/...)
d1611 3
a1613 2
   NOTE - Please send only GENERIC kernel dmesgs. Custom kernels that
   have device drivers removed are not helpful.
d1615 1
a1615 35
   [22][Back to Main Index] [23][To Section 3.0 - Obtaining OpenBSD]
   [24][To Section 5.0 - Kernel configuration and Disk Setup]
     _________________________________________________________________

   [25][back] [26]www@@openbsd.org
   $OpenBSD: obsd-faq.txt,v 1.26 2001/08/08 21:06:33 jsyn Exp $

References

   1. http://openbsd.org/faq/faq4.html#4.1
   2. http://openbsd.org/faq/faq4.html#4.2
   3. http://openbsd.org/faq/faq4.html#4.3
   4. http://openbsd.org/faq/faq4.html#4.4
   5. http://openbsd.org/faq/faq4.html#4.5
   6. http://openbsd.org/faq/install-i386.html#8meg
   7. http://openbsd.org/orders.html
   8. http://www.openbsd.org/cgi-bin/man.cgi?query=mount_nfs&sektion=8&format=html
   9. http://openbsd.org/ftp.html
  10. http://openbsd.org/faq/faq1.html#1.2
  11. ftp://ftp.openbsd.org/pub/OpenBSD/2.6/i386/INSTALL.i386
  12. ftp://ftp.openbsd.org/pub/OpenBSD/2.6/sparc/INSTALL.sparc
  13. http://openbsd.org/faq/install-i386.html
  14. http://openbsd.org/faq/install-sparc.html
  15. http://openbsd.org/faq/log26.txt
  16. http://openbsd.org/faq/log26.txt
  17. http://www.dorsai.org/~dcl/publications/NTLDR_Hacking/
  18. http://www.freebird.org/sw-map/bootmanager.html
  19. http://www.users.intercom.com/~ranish/part/
  20. http://openbsd.org/faq/INSTALL.linux
  21. http://openbsd.org/faq/faq14.html#14.7
  22. http://openbsd.org/faq/index.html
  23. http://openbsd.org/faq/faq3.html
  24. http://openbsd.org/faq/faq5.html
  25. http://openbsd.org/faq/index.html
  26. mailto:www@@openbsd.org
d1617 2
d1620 8
a1627 1
   [OpenBSD]
d1629 1
a1629 2
5.0 - Kernel configuration
     _________________________________________________________________
a1630 8
   Table of Contents
     * [1]5.1 - Why do I need a custom kernel?
     * [2]5.2 - Kernel configuration Options
     * [3]5.3 - Building your own kernel
     * [4]5.4 - Boot-time configuration
     * [5]5.5 - Getting more verbose output during boot
     * [6]5.6 - Using config(8) to change your kernel binary
     _________________________________________________________________
d1634 15
a1648 18
   Several reasons, although this practice is generally geared towards
   knowledgeable users who have a good overall understanding of the
   system.
     * Your computer has a very small amount of RAM and you want to
       preserve as much as possible by removing device drivers you don't
       use
     * Remove default options or add options which may not have been
       enabled by default
     * Enable experimental options (such as TCP_SACK, TCP_FACK,
       FFS_SOFTUPDATES)

   Under most circumstances you will NOT need to compile your own kernel.
   The GENERIC kernel will usually be all that you need. In fact, there
   are several reasons why you do not want to create your own kernel. The
   main reason is that it is very easy to make changes to the kernel
   configuration which look logical, but do not work. This is your danger
   sign. If something does not appear to work properly, please try the
   GENERIC kernel before sending in a bug report.
d1652 202
a1853 247
   Kernel Configuration Options are options that you add to your kernel
   configuration that place certain features into your kernel. This
   allows you to have exactly the support you want, without having
   support for unneeded devices. There are multitudes of options that
   allow you to customize your kernel. Here we will go over only some of
   them, those that are most commonly used. Check the [7]options(4) man
   page for a more complete list of options. You can also check the
   example configuration files that are available for your architecture.

   Not all kernel options have been tested for compatibility with all
   other options. Don't put an option in your kernel unless you actually
   have a reason to do so! The one kernel configuration which gets the
   most testing is the GENERIC kernel. This is usually a combination of
   the options in /usr/src/sys/arch/<your arch>/conf/GENERIC and
   /usr/src/sys/conf/GENERIC.

     * [8]Alpha Kernel Conf Files
     * [9]i386 Kernel Configuration files
     * [10]mac68k Kernel Configuration files
     * [11]pmax Kernel Configuration Files
     * [12]sparc Kernel Configuration Files
     * [13]Other Arch's

   Look closely at these files and you will notice a line like:
   include "../../../conf/GENERIC"
   This means that it is referencing yet another configuration file. This
   file stores non arch-dependent options. So when creating your Kernel
   Config be sure to look through [14]/sys/conf/GENERIC and see what you
   want. There ARE options in there that are NEEDED.

   All of the options listed below should be placed in your kernel
   configuration file in the format of:
   option OPTION
   for example. To place option debug in the kernel, add a line like
   this:
   option DEBUG
   Options in the OpenBSD kernel are translated into compiler
   preprocessor options, therefore an option like DEBUG would have the
   source compiled with option -DDEBUG. Which is equivalent to doing a
   #define DEBUG throughout the kernel.

   OpenBSD has a great many compatibility options which allow you to use
   binaries from other OS's. Not all are available on every
   architecture, so be sure to read the man pages for each option to see
   if your arch is supported.

     * [15]COMPAT_SVR4(8) - Compatibility with SVR4 binaries.
     * [16]COMPAT_BSDOS(8) - Compatibility with BSD/OS binaries.
     * [17]COMPAT_LINUX(8) - Compatibility with Linux binaries.
     * [18]COMPAT_SUNOS(8) - Compatibility with SunOS binaries.
     * [19]COMPAT_ULTRIX(8) - Compatibility with Ultrix binaries.
     * [20]COMPAT_FREEBSD(8) - Compatibility with FreeBSD binaries.
     * COMPAT_HPUX - Compatibility with HP-UX binaries. Only available on
       some m68k arch's.
     * [21]COMPAT_IBCS2(8) - Compatibility to run ibcs2 binaries.
     * COMPAT_OSF1 - Run Digital Unix binaries. Available only on Alpha
       platform.
     * COMPAT_43 - Compatibility with 4.3BSD. Use of this is certainly
       discouraged, But it is needed for our Navigator port
     * COMPAT_11 - Compatibility with NetBSD 1.1
     * COMPAT_NOMID - Compatibility with a.out executables that lack a
       machine id.

   It is always helpful to be able to debug problems with the kernel. But
   many choose not to put these options in their kernel because these
   options add considerable size to the kernel. They are however
   extremely helpful in a case where a bug might be present. This well
   help the developers discover the source of your problems much quicker.
   Here is a list of popular debugging options that can be added to your
   kernel.

     * [22]DDB - This compiles in the in-kernel debugger. This isn't
       available on all platforms. So be sure to read before adding it.
     * [23]KGDB - Compiles a remote kernel debugger using gdb's `remote
       target` feature.
     * makeoptions DEBUG="-g" - Makes bsd.gdb along with bsd. This is
       useful for debugging crash dumps with gdb. NOTE: This option also
       turns on option DEBUG
     * DEBUG - Used to put various debugging options in the kernel, where
       the source has defined them.
     * KTRACE - Adds hooks for the system call tracing facility. Which
       allows users to use [24]ktrace(1).
     * DIAGNOSTIC - Adds code to the kernel that does internal
       consistency checks.
     * GPROF - adds code to the kernel for kernel profiling with
       [25]kgmon(8).
     * makeoptions PROF="-pg" - The -pg flag causes the kernel to be
       compiled with support for profiling. Option GPROF is required to
       use this option.

   Filesystem Options.
     * FFS - Berkeley Fast Filesystem NOTE: This option is required
     * EXT2FS - Second Extended File System, This is needed for those of
       you who want to read Linux partitions.
     * MFS - Memory File System that stores files in swapable memory.
     * NFS - Network File System, This is needed if you will be using
       NFS.
     * CD9660 - This is iso9660 + rockridge filesystem. This is required
       to read from CDs
     * MSDOSFS - Needed to read MS-DOS FAT filesystems. Also has support
       for Windows 95 long name + mixed case extensions.
     * FDESC - Includes code for a file system which can be mounted on
       /dev/fd
     * KERNFS - Includes code which permits the mounting of a special
       file system (normally mounted on /kern) in which files
       representing various kernel variables and parameters may be found.
     * NULLFS - Code to have a loopback filesystem. [26]mount_null(8) has
       more information
     * PROCFS - Includes code for a special file system (conventionally
       mounted on /proc)
     * PORTAL - Includes the (experimental) portal filesystem. This
       permits interesting tricks like opening TCP sockets by opening
       files in the file system.
     * UMAPFS - Includes a loopback file system in which user and group
       ids may be remapped -- this can be useful when mounting alien file
       systems with different uids and gids than the local system (eg,
       remote NFS).
     * UNION - Includes code for the union file system, which permits
       directories to be mounted on top of each other in such a way that
       both file systems remain visible. This code isn't quite stable
       yet.
     * XFS - Add hooks for using a filesystem that is compatible with the
       AFS filesystem. Currently used by the Arla/AFS code.
     * LFS - Log Structured Filesystem.
     * FFS_SOFTUPDATES - Allows for the use of softupdates. To read up on
       softupdates more read the [27]Softupdates FAQ section.
     * NFSSERVER - Allow for the server-side NFS code to be included in
       the kernel.
     * NFSCLIENT - Allow for the client-side NFS code to be included in
       the kernel.
     * FIFO - Support for FIFOs.. RECOMMENDED.
     * NVNODE=integer - Where integer is the size of the cache used by
       the name-to-inode translation routines, (a.k.a. the namei() cache,
       though called by many other names in the kernel source).
     * EXT2FS_SYSTEM_FLAG - This option changes the behavior of the
       APPEND and IMMUTABLE flags for a file on an EXT2FS filesystem.
       Read [28]options(4) for more details.
     * QUOTA - Support for Filesystem Quota's. To read up on using quotas
       read [29]FAQ 10

   Misc. Options
     * PCIVERBOSE - Make the boot process more verbose for PCI
       peripherals.
     * EISAVERBOSE - Make the boot process more verbose for EISA
       peripherals.
     * PCMCIAVERBOSE - Make the boot process more verbose for PCMCIA
       peripherals.
     * APERTURE - Provide in-kernel support for VGA framebuffer mapping
       by user processes. Needed to run X.
     * XSERVER - Support for the X server console driver. Needed for X.
     * LKM - Support for Loadable Kernel Modules. Not available on all
       arch's. Read [30]lkm(4) for more information.
     * INSECURE - Hardwires the kernel security level to -1. Read
       [31]init(8) for more information on kernel security levels.
     * MACHINE_NONCONTIG - Changes part of the VM/pmap interface, to
       allow for non-contiguous memory.
     * RAM_DISK_HOOKS - Allows for machine dependent functions to be
       called when the ramdisk driver is configured.
     * RAM_DISK_IS_ROOT - Forces the ramdisk to be root.
     * CCDNBUF=integer - Set number of component buffers used by CCD(4).
       Default is 8. For more on CCD read the [32]CCD(4) man page, or the
       [33]Performance Tuning FAQ section.
     * KMEMSTATS - This makes malloc(9), the kernel memory allocator keep
       statistics on its use. If option DEBUG is used, this option is
       automatically turned off by config.
     * BOOT_CONFIG - Adds support of the -c boot option.

   Networking Options
   Also check the [34]Networking FAQ or the [35]Networking Performance
   Tuning FAQ.
     * GATEWAY - Enables IPFORWARDING and (on most ports) increases the
       size of NMBCLUSTERS.
     * NMBCLUSTERS=integer - Controls the size mbuf cluster map.
     * IPFORWARDING - Enables IP routing behavior. With this option
       enabled, the machine will forward IP datagrams between its
       interfaces that are destined for other machines.
     * MROUTING - Includes support for IP multicast routers.
     * INET - Includes support for the TCP/IP protocol stack. This option
       is REQUIRED
     * MCLSHIFT=value - This option is the base-2 logarithm of the size
       of mbuf clusters. Read [36]options(4) for more information on this
       option.
     * NS - Include support for the Xerox XNS protocol stack. See
       [37]ns(4)
     * ISO,TPIP - Include support for the ubiquitous OSI protocol stack.
       See [38]iso(4) for more information.
     * EON - Include support for OSI tunneling over IP.
     * CCITT,LLC,HDLC - Include support for the X.25 protocol stack.
     * IPX, IPXIP - Include support for Internetwork Packet Exchange
       protocol commonly in use by Novell NetWare.
     * NETATALK - Include kernel support for the AppleTalk family of
       protocols.
     * TCP_COMPAT_42 - Use of this option is extremely discouraged, so it
       should not be enabled. TCP bug compatibility with 4.2BSD. In
       4.2BSD, TCP sequence numbers were 32-bit signed values. Modern
       implementations of TCP use unsigned values.
     * TCP_NEWRENO - Turns on NewReno fast recovery phase, which allows
       one lost segment to be recovered per round trip time.
     * TCP_SACK - Turns on selective acknowledgements.
     * TCP_FACK - Turns on forward acknowledgements allowing a more
       precise estimate of outstanding data during the fast recovery
       phase by using SACK information. This option can be used together
       with TCP_SACK.
     * IPFILTER - This option enables the IP filtering on the packet
       level using the ipfilter package.
     * IPFILTER_LOG - This option, in conjunction with IPFILTER, enables
       logging of IP packets using ip-filter.
     * IPFILTER_DEFAULT_BLOCK - This option sets the default policy of
       ip-filter. If it is set, ip-filter will block packets by default.
     * PPP_FILTER - This option turns on [39]pcap(3) based filtering for
       ppp connections.
     * PPP_BSDCOMP - PPP BSD compression.
     * PPP_DEFLATE - Used in conjunction with PPP_BSDCOMP.
     * IPSEC - This option enables IP security protocol support. See
       [40]ipsec(4) for more details. This now implies option KEY, which
       gives support for PFKEYv2.
     * ENCDEBUG - This option enables debugging information to be
       conditionally logged in case IPSEC encounters errors.
     * TCP_SIGNATURE - TCP MD5 Signatures, for BGP routing sessions

   PCVT Options (only valid on i386 architecture)
     * PCVT_NSCREENS=integer - Number of pcvt screens. Defaults to 8.
     * PCVT_VT220KEYB - If activated, a keyboard layout resembling a DEC
       VT200 (TM) is generated.
     * PCVT_SCREENSAVER - Enables the builtin screensaver feature.
       Defaults to on.
     * PCVT_PRETTYSCRNS - If enabled, a blinking-star screensaver is
       used. Default is off.
     * PCVT_CTRL_ALT_DEL - If enabled, the key combination <Ctrl> <Alt>
       <Del> invokes a CPU reset. Default is off.
     * PCVT_USEKBDSEC - Do NOT override a security lock for the keyboard.
       Default is on.
     * PCVT_24LINESDEF - If enabled, the 25-line modi (VT emulation with
       25 lines, and HP emulation with 28 lines) default to 24 lines only
       to provide a better compatibility to the original DEV VT220 (TM).
     * PCVT_EMU_MOUSE - Emulate a three-button mouse via the keypad.
       Useful for notebooks when running XFree86. Defaults to off
     * PCVT_META_ESC - If enabled, a sequence composed of <esc>, followed
       by the normal key code is emitted if a key is pressed with the
       <Alt> key modifier. If disabled, then normal key code with the
       value 0x80 added is sent. Defaults to off.

   SCSI Subsystem Options
     * SCSITERSE - Terser SCSI error messages. This omits the table for
       decoding ASC/ASCQ info, saving about 8 bytes or so.
     * SCSIDEBUG - Prints extra debugging info for the SCSI subsystem to
       the console.
d1857 2
a1858 2
   Full instructions for creating your own custom kernel are in the
   [41]afterboot(8) man page.
d1860 64
a1923 56
   To compile your kernel from the cdrom you need to first have the
   source code available. You just need the kernel source to be able to
   compile the kernel, and this source code is available on the cd. Here
   is how to copy the sources from the cd. This example assumes that CD1
   is mounted on /mnt.
# mkdir -p /usr/src/sys
# cd /mnt/sys
# tar cf - . | ( cd /usr/src/sys; tar xvf - )

   Now to create your custom kernel it is easiest to start with the
   GENERIC kernel. This is located at
   /usr/src/sys/arch/${arch}/conf/GENERIC, where ${arch} is your
   architecture. There are other sample configurations available in that
   directory as well. Here are two examples for compiling your kernel.
   The first example is compiling your kernel on a read-only source tree.
   The second on a writeable source tree.
# cd /somewhere
# cp /usr/src/sys/arch/$ARCH/conf/SOMEFILE .
# vi SOMEFILE (to make the changes you want)
# config -s /usr/src/sys -b . SOMEFILE
        # make depend
        (The above step is necessary when you have made any changes
            [including updates and patches] to your kernel source tree.
            This step can be ignored if you follow the next step.)
       OR # make clean

   (The above step is necessary if you make changes to your kernel
       configuration options, and is also recommended if you make major
       updates to your source tree. You can ignore this step otherwise,
       and just use 'make depend'.)

   # make

   To compile a kernel inside a writeable source tree do the following:
# cd /sys/arch/$ARCH/conf
# vi SOMEFILE (to make any changes you want)
# config SOMEFILE (read more about it here : [42]config(8))
# cd ../compile/SOMEFILE
# make

   Where $ARCH is the architecture you are using (e.g. i386). You can
   also do a make depend to make the dependencies for the next time you
   compile your kernel.

   To move your kernel into place.
# cp /bsd /bsd.old
# cp /sys/arch/$ARCH/compile/SOMEFILE/bsd /bsd

   To revert to your old kernel at boot you need to just
boot> bsd.old

   and your old kernel will be loaded instead of /bsd.

   Sometimes when you build a new kernel you will be required to install
   new bootblocks. To do so, read [43]faq15.8 on OpenBSD's Bootloader.
   Which will give you an overview on using OpenBSD's Bootloader
d1927 10
a1936 9
   Sometimes when booting your system you might notice that the kernel
   finds your device but maybe at the wrong IRQ. And maybe you need to
   use this device right away. Well, without rebuilding the kernel you
   can use OpenBSD's boot time kernel configuration. This will only
   correct your problem for one time. If you reboot, you will have to
   repeat this procedure. So, this is only meant as a temporary fix, and
   you should correct the problem by fixing and recompiling your kernel.
   Your kernel does however need option BOOT_CONFIG in the kernel, which
   GENERIC does have.
d1938 1
a1938 4
   Most of this document can be found in the man page [44]boot_config(8)
   To boot into the User Kernel Config, or UKC, at boot time us the -c
   option.
boot> boot wd0a:/bsd -c
d1940 1
a1940 3
   Or whichever kernel it is you want to boot. Doing this will bring up a
   UKC prompt. From here you can issue commands directly to the kernel
   specifying devices you want to change or disable or even enable.
d1942 3
a1944 1
   Here is a list of common commands in the UKC.
d1946 1
a1946 1
   add device - Add a device through copying another
d1948 1
a1948 1
   change devno | device - Modify one or more devices
d1950 1
a1950 1
   disable devno | device - Disable one or more devices
d1952 1
a1952 1
   enable devno | device - Enable one or more devices
d1954 1
a1954 1
   find devno | device - Find one or more devices
d1956 1
a1956 1
   help - Short summary of these commands
d1958 1
a1958 1
   list - List ALL known devices
d1960 1
a1960 1
   exit/quit - Continue Booting
d1962 1
a1962 2
   show [attr [val]] - Show devices with an attribute and optional with a
   specified value
d1964 6
a1969 4
   Once you get your device configured, use quit or exit and continue
   booting. After doing so you should correct your Kernel configuration
   and Compile a new kernel. Refer to [45]Building your own kernel for
   help.
d1973 8
a1980 8
   Getting more verbose output can be very helpful when trying to debug
   problems when booting. If you have a problem wherein your boot floppy
   won't boot and need to get more information, simply reboot. When you
   get to the "boot>" prompt, boot with boot -c. This will bring you into
   the UKC>, then do:
UKC> verbose
autoconf verbose enabled
UKC> quit
d1982 1
a1982 1
   Now you will be given extremely verbose output upon boot.
d1986 89
a2074 144
   With 2.6 came the introduction of the -e and -u options with
   [46]config(8). These options can be extremely helpful and save wasted
   time compiling your kernel. The -e flag allows you to enter the UKC or
   User Kernel Config on a running system. These changes will then take
   place on your next reboot. The -u flag tests to see if any changes
   were made to the running kernel during boot. Meaning you used boot -c
   to enter the UKC while booting your system.

   The following example shows the disabling of the ep* devices from the
   kernel. For safety's sake you must use the -o option which writes the
   changes out to the file specified. For example : config -e -o bsd.new
   /bsd will write the changes to bsd.new. The example doesn't use the -o
   option, therefore changes are just ignored, and not written back to
   the kernel binary. For more information pertaining to error and
   warning messages read the [47]config(8) man page.
$ sudo config -e /bsd
OpenBSD 2.6 (GENERIC) #1: Tue Nov 16 21:25:10 EST 1999
    ericj@@oshibana:/usr/src/sys/arch/i386/compile/GENERIC
warning: no output file specified
Enter 'help' for information
ukc> ?
        help                            Command help list
        add     dev                     Add a device
        base    8|10|16                 Base on large numbers
        change  devno|dev               Change device
        disable attr val|devno|dev      Disable device
        enable  attr val|devno|dev      Enable device
        find    devno|dev               Find device
        list                            List configuration
        lines   count                   # of lines per page
        show    [attr [val]]            Show attribute
        exit                            Exit, without saving changes
        quit                            Quit, saving current changes
ukc> list
  0 audio* at sb0|sb*|gus0|pas0|sp0|ess*|wss0|wss*|ym*|eap*|eso*|sv*
  1 midi* at sb0|sb*|opl*|opl*|opl*|ym*|mpu*
  2 nsphy* at xe*|ef*|sf*|xl*|tl*|rl*|fxp* phy -1
  3 inphy* at xe*|ef*|sf*|xl*|tl*|rl*|fxp* phy -1
  4 iophy* at xe*|ef*|sf*|xl*|tl*|rl*|fxp* phy -1
  5 exphy* at xe*|ef*|sf*|xl*|tl*|rl*|fxp* phy -1
  6 rlphy* at xe*|ef*|sf*|xl*|tl*|rl*|fxp* phy -1
  7 icsphy* at xe*|ef*|sf*|xl*|tl*|rl*|fxp* phy -1
  8 sqphy* at xe*|ef*|sf*|xl*|tl*|rl*|fxp* phy -1
  9 ukphy* at xe*|ef*|sf*|xl*|tl*|rl*|fxp* phy -1
 10 scsibus* at bt0|bt1|bt2|aha0|aha1|aha*|ahb*|ahc0|ahc*|ahc*|isp*|aic0|aic*|n
cr*|adv*|adw*|sea0|uha0|uha1|uha*|wds0|atapiscsi*
 11 cd* at scsibus* target -1 lun -1
 12 ch* at scsibus* target -1 lun -1
 13 sd* at scsibus* target -1 lun -1
 14 st* at scsibus* target -1 lun -1
 15 ss* at scsibus* target -1 lun -1
 16 uk* at scsibus* target -1 lun -1
 17 atapiscsi* at wdc0|wdc1|wdc*|wdc*|pciide* channel -1
--- more ---
[snip]
ukc> disable ep
 31 ep0 disabled
 32 ep* disabled
 33 ep* disabled
 87 ep0 disabled
 88 ep0 disabled
 89 ep* disabled
 90 ep* disabled
136 ep* disabled
ukc> quit
not forced

   In the above example, all ep* devices are removed from the kernel and
   will not be probed. In some situations where you have used the UKC
   during boot, via boot -c, you will need these changes to be written
   out permanently. To do this you need to use the -u option. In the
   following example, the computer was booted into the UKC and the wi(4)
   device was disabled. Since changes made with boot -c are NOT
   permanent, these changes must be written out. This example writes the
   changes made from boot -c into a new kernel binary bsd.new.
$ sudo config -e -u -o bsd.new /bsd
OpenBSD 2.6 (GENERIC) #1: Tue Nov 16 21:25:10 EST 1999
    ericj@@oshibana:/usr/src/sys/arch/i386/compile/GENERIC
Processing history...
151 wi* disabled
Enter 'help' for information
ukc> quit

   [48][Back to Main Index] [49][To Section 4.0 - Installation Guide]
   [50][To Section 6.0 - Networking]
     _________________________________________________________________

   [51][back] [52]www@@openbsd.org
   $OpenBSD: obsd-faq.txt,v 1.26 2001/08/08 21:06:33 jsyn Exp $

References

   1. http://openbsd.org/faq/faq5.html#5.1
   2. http://openbsd.org/faq/faq5.html#5.2
   3. http://openbsd.org/faq/faq5.html#5.3
   4. http://openbsd.org/faq/faq5.html#5.4
   5. http://openbsd.org/faq/faq5.html#5.5
   6. http://openbsd.org/faq/faq5.html#5.6
   7. http://www.openbsd.org/cgi-bin/man.cgi?query=options&apropos=0&sektion=4&format=html
   8. http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/alpha/conf/
   9. http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/i386/conf/
  10. http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/mac68k/conf/
  11. http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/pmax/conf/
  12. http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/sparc/conf/
  13. http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/
  14. http://www.openbsd.org/cgi-bin/cvsweb/src/sys/conf/GENERIC
  15. http://www.openbsd.org/cgi-bin/man.cgi?query=compat_svr4&sektion=8&apropos=0&manpath=OpenBSD+Current
  16. http://www.openbsd.org/cgi-bin/man.cgi?query=compat_bsdos&sektion=8&apropos=0&manpath=OpenBSD+Current
  17. http://www.openbsd.org/cgi-bin/man.cgi?query=compat_linux&sektion=8&apropos=0&manpath=OpenBSD+Current
  18. http://www.openbsd.org/cgi-bin/man.cgi?query=compat_sunos&sektion=8&apropos=0&manpath=OpenBSD+Current
  19. http://www.openbsd.org/cgi-bin/man.cgi?query=compat_ultrix&sektion=8&apropos=0&manpath=OpenBSD+Current
  20. http://www.openbsd.org/cgi-bin/man.cgi?query=compat_freebsd&sektion=8&apropos=0&manpath=OpenBSD+Current
  21. http://www.openbsd.org/cgi-bin/man.cgi?query=compat_ibcs2&sektion=8&apropos=0&manpath=OpenBSD+Current
  22. http://www.openbsd.org/cgi-bin/man.cgi?query=ddb&sektion=4&format=html
  23. http://www.openbsd.org/cgi-bin/man.cgi?query=gdb&sektion=1&format=html
  24. http://www.openbsd.org/cgi-bin/man.cgi?query=ktrace&sektion=1&format=html
  25. http://www.openbsd.org/cgi-bin/man.cgi?query=kgmon&sektion=8&format=html
  26. http://www.openbsd.org/cgi-bin/man.cgi?query=mount_null&sektion=8&format=html
  27. http://openbsd.org/faq/faq14.html#14.5
  28. http://www.openbsd.org/cgi-bin/man.cgi?query=options&sektion=4&format=html
  29. http://openbsd.org/faq/faq10.html#10.10
  30. http://www.openbsd.org/cgi-bin/man.cgi?query=lkm&sektion=4&format=html
  31. http://www.openbsd.org/cgi-bin/man.cgi?query=init&sektion=8&format=html
  32. http://www.openbsd.org/cgi-bin/man.cgi?query=ccd&sektion=4&format=html
  33. http://openbsd.org/faq/faq11.html#11.2
  34. http://openbsd.org/faq/faq6.html
  35. http://openbsd.org/faq/faq11.html#11.1
  36. http://www.openbsd.org/cgi-bin/man.cgi?query=options&sektion=4&format=html
  37. http://www.openbsd.org/cgi-bin/man.cgi?query=ns&sektion=4&apropos=0&manpath=OpenBSD+Current
  38. http://www.openbsd.org/cgi-bin/man.cgi?query=iso&sektion=4&format=html
  39. http://www.openbsd.org/cgi-bin/man.cgi?query=pcap&sektion=3&format=html
  40. http://www.openbsd.org/cgi-bin/man.cgi?query=ipsec&sektion=4&format=html
  41. http://www.openbsd.org/cgi-bin/man.cgi?query=afterboot&apropos=0&sektion=8&format=html
  42. http://www.openbsd.org/cgi-bin/man.cgi?query=config&apropos=0&sektion=8&format=html
  43. http://openbsd.org/faq/faq14.html#14.8
  44. http://www.openbsd.org/cgi-bin/man.cgi?query=boot_config&apropos=0&sektion=8&format=html
  45. http://openbsd.org/faq/faq5.html#5.3
  46. http://www.openbsd.org/cgi-bin/man.cgi?query=config&sektion=8&format=html
  47. http://www.openbsd.org/cgi-bin/man.cgi?query=config&sektion=8&format=html
  48. http://openbsd.org/faq/index.html
  49. http://openbsd.org/faq/faq4.html
  50. http://openbsd.org/faq/faq6.html
  51. http://openbsd.org/faq/index.html
  52. mailto:www@@openbsd.org
d2076 2
d2079 12
a2090 1
   [OpenBSD]
d2092 1
a2092 2
6.0 - Networking
     _________________________________________________________________
a2093 10
   Table of Contents
     * [1]6.0.1 - Before we go any further
     * [2]6.1 - Initial network setup
     * [3]6.2 - IP Filter
     * [4]6.3 - Network Address Translation
     * [5]6.4 - Dynamic Host Configuration Protocol
     * [6]6.5 - Point to Point Protocol
     * [7]6.6 - Tuning networking parameters
     * [8]6.7 - Using NFS
     _________________________________________________________________
d2097 17
a2113 18
   For the bulk of this document, it helps if you have read and at least
   partially understand the [9]Kernel Configuration and Setup section of
   the FAQ, and the [10]ifconfig(8) and [11]netstat(1) man pages.

   If you are a network administrator, and you are setting up routing
   protocols, if you are using your OpenBSD box as a router, if you need
   to go in depth into IP networking, you really need to read
   [12]Understanding IP addressing. This is an excellent document.
   Understanding IP addressing contains fundamental knowledge to build
   upon when working with IP networks!

   If you are working with applications such as web servers, ftp servers,
   and mail servers, you may benefit greatly by [13]reading the RFCs. Of
   course, you can't read all of them. Rather, pick some topics that you
   are interested in, or that you use in your work environment. Look them
   up, find out how they are intended to work. The RFCs define many
   (thousands) of standards for protocols on the internet and how they
   are supposed to work.
d2117 29
a2145 23
   Table Of Contents
     * [14]6.1.1 - Identifying and Setting Up Your Network Interfaces
     * [15]6.1.2 - Setting up your OpenBSD box as a Gateway

  6.1.1 - Identifying and Setting Up Your Network Interfaces

   To start off, you must first identify your network interface. In
   OpenBSD, interfaces are named for the type of card, not for the type
   of connection. You can see your network card get initialized during
   boot, or after boot using the dmesg(8) command. You also have the
   ability of seeing your network interface using the ifconfig(8)
   command. For example, Here is the output in dmesg for a ne2k network
   card, which uses the device name ne*.
ne3 at pcmcia1 function 0 "Linksys, EtherFast 10/100 PC Card (PCMPC100), " port
 0x340/16 irq 9
ne3: address 00:e0:98:04:95:ba

   If you don't know what your device name is, here is a list of common
   cards and their device names.
     * ne2000 Network Cards - [16]ne*
     * 3Com EtherLink III and Fast EtherLink III Ethernet - [17]ep*
     * 3Com EtherLink XL and Fast EtherLink XL Ethernet (3C9xx) - [18]xl*
     * Intel 82586 chip Ethernet device driver - [19]ie*
d2147 1088
a3234 925
          + 3Com 3C507
          + AT&T StarLAN 10
          + AT&T EN100
          + AT&T StarLan Fiber
          + Intel EtherExpress 16

   Again, you can check to see what interfaces have been identified by
   using the ifconfig(8) utility. Here is output which will show an ne2k
   device.
$ ifconfig -a
lo0: flags=8009<UP,LOOPBACK,MULTICAST>
        inet 127.0.0.1 netmask 0xff000000
lo1: flags=8008<LOOPBACK,MULTICAST>
ne3: flags=8863<UP,BROADCAST,NOTRAILERS,RUNNING,SIMPLEX,MULTICAST>
        media: Ethernet manual
        inet 10.0.0.38 netmask 0xffffff00 broadcast 10.0.0.255
sl0: flags=c010<POINTOPOINT,LINK2,MULTICAST>
sl1: flags=c010<POINTOPOINT,LINK2,MULTICAST>
ppp0: flags=8010<POINTOPOINT,MULTICAST>
ppp1: flags=8010<POINTOPOINT,MULTICAST>
tun0: flags=10<POINTOPOINT>
tun1: flags=10<POINTOPOINT>
enc0: flags=0<>
bridge0: flags=0<>
bridge1: flags=0<>

   As you can see here, ifconfig(8) gives us a lot more information than
   we are needing at this point. But it still allows us to see our
   interface. In the above example, the interface card is already
   configured. You can tell this by seeing that values are already set
   in "inet 10.0.0.38 netmask 0xffffff00 broadcast 10.0.0.255", and that
   the UP and RUNNING flags are turned on. Also, you will notice many
   other interfaces. Here is a list of interfaces that will be expected
   to be there.
     * [20]lo* - Loopback Interface
     * [21]sl* - Slip Network Interface
     * ppp* - Point to Point Protocol
     * [22]tun* - Tunnel Network Interface
     * [23]enc* - Encapsulating Interface
     * [24]bridge* - Ethernet bridge interface

   If you don't have your interface configured the first step is to
   create the /etc/hostname.${IF} file. Where the name of your interface
   will take the place of ${IF}. From the information in the examples
   above, the name would be /etc/hostname.ne3. The layout of this file is
   like so: To read more about the format of this file, reference the
   [25]hostname.if(5) man page.
[address_family] [your_ip] [your_netmask] [media options]

   So for the above example, a proper file would look like this:
$ cat /etc/hostname.ne3
inet 10.0.0.38 255.255.255.0 NONE

   Next step from here is to setup your gateway. To do this, simply put
   the IP of your gateway in the file /etc/mygate. This will allow for
   your gateway to be set upon boot. From here you should setup your
   nameservers, and your /etc/hosts file. To setup your nameservers, you
   will create a file called /etc/resolv.conf. You can read more about
   the format of this file in the [26]resolv.conf(5) man page. But for a
   standard usage, here is an example. In this example your domain
   servers are 125.2.3.4 and 125.2.3.5. You also belong in the domain
   "yourdomain.com".
$ cat /etc/resolv.conf
search yourdomain.com
nameserver 125.2.3.4
nameserver 125.2.3.5
lookup file bind

   From here, you can either reboot or run the /etc/netstart script. You
   can do this by simply Typing (as root):
$ sh /etc/netstart
$ sudo sh /etc/netstart
writing to routing socket: File exists
add net 127: gateway 127.0.0.1: File exists
writing to routing socket: File exists
add net 224.0.0.0: gateway 127.0.0.1: File exists

   Notice that a few errors were produced, but this is in regards to the
   loopback interface. So this can be ignored. From here your system
   should be up and running. Again you can check to make sure that your
   interface was setup correctly with ifconfig(8). You can also check
   your routes via netstat(1) or route(8). Here is an example of viewing
   your routing tables using both.
$ netstat -rn
Routing tables

Internet:
Destination        Gateway            Flags     Refs     Use    Mtu  Interface
default            10.0.0.1           UGS         0       86      -  ne3
127/8              127.0.0.1          UGRS        0        0      -  lo0
127.0.0.1          127.0.0.1          UH          0        0      -  lo0
10.0.0/24          link#1             UC          0        0      -  ne3
10.0.0.1           aa:0:4:0:81:d      UHL         1        0      -  ne3
10.0.0.38          127.0.0.1          UGHS        0        0      -  lo0
224/4              127.0.0.1          URS         0        0      -  lo0

Encap:
Source             Port  Destination        Port  Proto SA(Address/SPI/Proto)
$ route show
Routing tables

Internet:
Destination      Gateway            Flags
default          10.0.0.1           UG
127.0.0.0        LOCALHOST          UG
localhost        LOCALHOST          UH
10.0.0.0         link#1             U
10.0.0.1         aa:0:4:0:81:d      UH
10.0.0.38        LOCALHOST          UGH
BASE-ADDRESS.MCA LOCALHOST          U

  6.1.2 - Setting up your OpenBSD box as a Gateway

   This is the basic information you need to set up your OpenBSD box as a
   gateway (also called a router). If you are using OpenBSD as a router
   on the Internet, we suggest that you also read the IP Filter setup
   instructions below to block potentially malicious traffic. Also, due
   to the low availability of IPv4 addresses from network service
   providers and regional registries, you may want to look at Network
   Address Translation for information on conserving your IP address
   space.

   The GENERIC kernel is already has the ability to allow IP Forwarding,
   but needs to be turned on. You should do this using the sysctl(8)
   utility. To change this permanently you should edit the file
   /etc/sysctl.conf to allow for IP Forwarding. To do so add this line in
   that configuration file.
net.inet.ip.forwarding=1

   To make this change without rebooting you would use the sysctl(8)
   utility directly. Remember though that this change will not still
   exist after a reboot, and needs to be run as root.
# sysctl -w net.inet.ip.forwarding=1
net.inet.ip.forwarding: 0 -> 1

   Now modify the routes on the other hosts on both sides. There are many
   possible uses of OpenBSD as a router, using software such as
   [27]routed(8), [28]gated, [29]mrtd, and [30]zebra. OpenBSD has support
   in the ports collection for both gated and mrtd. OpenBSD supports
   several T1, HSSI, ATM, FDDI, Ethernet, and serial (PPP/SLIP)
   interfaces.

6.2 - IP Filter

   The IP Filter package was created to handle two tasks, dealing with
   packet level forwarding permissions [31]ipf(8) and mapping
   hosts/subnets to a range of external addresses [32]ipnat(8). The
   configuration files for these two services are /etc/ipf.rules and
   /etc/ipnat.rules.

   You need to edit /etc/rc.conf to activate them at boot time. You also
   need to have net.inet.ip.forwarding=1 in your /etc/sysctl.conf (or
   your kernel needs to have IPFORWARDING or GATEWAY options turned on.)
   You also need a kernel compiled with option IPFILTER and IPFILTER_LOG
   (the GENERIC kernels do have these options).

   If you have IP Filter compiled into your kernel, but you don't have it
   turned on in your /etc/rc.conf file, you can still activate it easily.
# ipf -Fa -f /etc/ipf.rules -E
# ipnat -CF -f /etc/ipnat.rules

   The -E flag on ipf 'enables' IP Filter. -Fa clears out any rules that
   you may have in there. -f /etc/ipf.rules loads the rules from
   /etc/ipf.rules.

   If you make changes to /etc/ipf.rules after ipf is loaded, you can
   reload your rules pretty easily!
# ipf -Fa -f /etc/ipf.rules

   Same for ipnat...
# ipnat -CF -f /etc/ipnat.rules

   This document will cover some basic ipf and ipnat configurations
   below. There are a lot of nice examples in /usr/share/ipf/ for ipnat
   and ipf. We recommend you choose the one closest to what you want, and
   modify it to fit your needs. You can find other IP Filter information
   at the IP Filter [33]mailing list archive, the [34]IP Filter web site,
   and finally the [35]IP Filter HOWTO.

  IPF

   In order to enable ipf at boot, you will need to modify /etc/rc.conf
   so it reads IPFILTER=YES. IP Filter (ipf) is controlled by
   /etc/ipf.rules, which is read at boot. For a more detailed
   explanation, see [36]ipf(5). In the examples that follow, fxp0 will
   represent the external interface to the internet. It will be different
   for you, based on the ethernet adaptor present in your computer. These
   rules will assume full-time internet connectivity, such as you would
   see on a webserver.

   IP Filter rules are processed sequentially from top to bottom, it
   helps to visualize each packet having to traverse every rule before it
   reaches it's destination.

   For example, the default ruleset provided allows all packets to travel
   in, and all packets to travel out:
pass out from any to any
pass in from any to any

   Now lets say we don't want to allow any incoming connections to port
   3306 (mysql) because the database should only be connected to from
   localhost. Our ruleset would look like this:
pass out from any to any
pass in from any to any
block in on fxp0 from any to any port = 3306

   This says "block in all incoming packets, from anywhere to anywhere
   whose destination is 3306." Essentially a packet destined for port
   3306 on interface fxp0 will pass the first "pass in" rule and then be
   dropped by the "block in port = 3306" rule. If you reversed the order
   of our incoming rules (remember, order is important):
pass out from any to any
block in on fxp0 from any to any port = 3306
pass in from any to any

   Packets destined for port 3306 would pass because the last rule in the
   set allows all packets to pass. It is important to keep this in mind
   when writing packet filter rules: The last matching rule wins.

   Of course, there are exceptions to every rule. the quick option drops
   the packet at the first rule that matches. Let's look at our above
   flawed example, if we add quick to the "block in" rule:
pass out from any to any
block in quick on fxp0 from any to any port = 3306
pass in from any to any

   A packet destined for our host on port 3306 will hit the "block in
   quick" rule and be dropped immediately. All packets destined for other
   ports wont find a rule match until they reach our "pass in" rule that
   allows all packets to pass.
   Default Deny

   The safest packet filtering policy is a default deny policy. All
   traffic not explicitly allowed is denied. This policy is far safer
   than explicitly denying each protected service, allows for smaller
   rulesets, and can protect from an accidentally misconfigured service
   that has been left exposed.

   Let's now look at another real world example ruleset and explain
   things line by line. Here's an example for a webserver with a default
   deny policy that only allows ssh connections (for administration) and
   connections to http (port 80) and https (port 443).
#############################
# begin ruleset
#############################
pass in quick on fxp0 from any to any port = 22
pass in quick on fxp0 from any to any port = 80
pass in quick on fxp0 from any to any port = 443
block in quick on fxp0 from any to any
pass out on fxp0 from any to any
##############################
# end ruleset
##############################

   This will allow incoming connections from anywhere to ports 22(ssh),
   80(http), and 443(https). It will drop all other connection attempts,
   and allow all outgoing connections. This is a pretty tight ruleset.
   But what if you only wanted to allow internal hosts on your 1.1.1.0
   address block to connect to ssh, but allow outside connections to http
   and https?
#############################
# begin ruleset
#############################
pass in quick on fxp0 from 1.1.1.0/24 to any port = 22
pass in quick on fxp0 from any to any port = 80
pass in quick on fxp0 from any to any port = 443
block in quick on fxp0 from any to any
pass out on fxp0 from any to any
##############################
# end ruleset
##############################

   Pretty good, but what if we only want to allow one machine (1.1.1.1)
   to administer the web server remotely? In that case, we can change
   this:
pass in quick on fxp0 from 1.1.1.0/24 to any port = 22

   to this:
pass in quick on fxp0 from 1.1.1.1/32 to any port = 22

   IP Filter supports both CIDR and dotted decimal forms of netmask
   address. You could also write the above as:
pass in quick on fxp0 from 1.1.1.1/255.255.255.255 to any port = 22

   but why would you? Sample Rules

   Here are some good rules for everyone to use (assuming that fxp0 is
   the external internet-connected interface). First we will set up
   simple address spoofing protection.
block in quick on fxp0 from 127.0.0.0/8 to any
block in quick on fxp0 from 192.168.0.0/16 to any
block in quick on fxp0 from 172.16.0.0/12 to any
block in quick on fxp0 from 10.0.0.0/8 to any
block out quick on fxp0 from any to 127.0.0.1/8
block out quick on fxp0 from any to 192.168.0.0/16
block out quick on fxp0 from any to 172.16.0.0/12
block out quick on fxp0 from any to 10.0.0.0/8

   It's also a good idea to separate your loopback interface from your
   other rules.
pass out quick on lo0
pass in quick on lo0

   Our ruleset is starting to look pretty good, when we put it together,
   here's what it looks like:
###########################
# begin ruleset
###########################
# loopback rules

pass out quick on lo0
pass in quick on lo0

# don't allow anyone to spoof non-routeable addresses

block in quick on fxp0 from 127.0.0.0/8 to any
block in quick on fxp0 from 192.168.0.0/16 to any
block in quick on fxp0 from 172.16.0.0/12 to any
block in quick on fxp0 from 10.0.0.0/8 to any
block out quick on fxp0 from any to 127.0.0.1/8
block out quick on fxp0 from any to 192.168.0.0/16
block out quick on fxp0 from any to 172.16.0.0/12
block out quick on fxp0 from any to 10.0.0.0/8

# only allow our administration machine to connect via ssh

pass in quick on fxp0 from 1.1.1.1/32 to any port = 22

# allow others to use http and https

pass in quick on fxp0 from any to any port = 80
pass in quick on fxp0 from any to any port = 443

# finally lock the rest down with a default deny

block in quick on fxp0 from any to any

# and let out-going traffic out

pass out on fxp0 from any to any

#############################
# end ruleset
#############################

   Packet logging

   Now that's pretty good, but it could be better. What if we want to log
   any connection attempts to port 22(ssh) that get blocked by our
   firewall? Easy, IP Filter can handle this with the log keyword:
pass in quick on fxp0 from 1.1.1.1/32 to any port = 22
block in log quick on fxp0 from any to any port = 22

   This rule will allow our remote administration machine to connect to
   port 22, but deny and log all other attempts to connect to port 22.
   Protocol based packet filtering

   IP Filter can also filter based on the protocol it is filtering, in
   fact, IP Filter can filter any protocol listed in [37]/etc/protocols.
   For the sake of clarity, we will only concern ourselves with tcp, udp,
   and icmp.

   In order for ipf to filter based on protocol, the keyword proto must
   be used. To examine our earlier ssh example rule, since ssh runs over
   tcp, we should only allow tcp packets to connect. by using the proto
   keyword to allow only tcp, we get a rule that looks like this:
pass in quick on fxp0 proto tcp from 1.1.1.1/32 to any port = 22

   But what if we need to allow connections to a service running over
   both tcp and udp like bind? Well, in the case of tcp/udp, IP Filter
   allows you to group both protocols together. Note: this only applies
   to tcp/udp. Using the bind example, a rule allowing tcp and udp
   connections in a default deny environment would look like:
pass in quick on fxp0 proto tcp/udp from any to any port = 53

   Packet Filtering Voodoo

   In addition to filtering based on protocol, IP Filter is also capable
   of managing fragmented IP packets (a common method of defeating packet
   filters). There are two possible keywords that can be used when
   dealing with fragmented ip packets, frag for commonly fragmented IP
   packets, or short for IP packets with headers too small for
   comparison. Since fragmented packets can occur normally, depending on
   link conditions, it is best to only filter packets with headers too
   small for valid comparison. This can be accomplished with the
   following rule:
block in quick proto tcp all with short

   What about IP Options? IP Filter can handle those packets too. Packets
   can either be dropped if they have IP options set, or they can be
   dropped based on the specific IP options that are set. For example,
   the following rule will drop and log all packets with ip options set.
block in log quick on fxp0 all with ipopts

   This may however break some things such as [38]traceroute(8). You can
   also specify which options not to allow. For instance a good rule is
   to block all packets with source routing options. This is accomplished
   with this rule:
block in quick on fxp0 all with opt lsrr
block in quick on fxp0 all with opt ssrr

   TCP Flags, established connections and keeping state

   Now the IP Filter voodoo begins in earnest. IP Filter's greatest
   strengths are it's ability to filter packets based on TCP flags and to
   maintain established connections and connection state. It is recommend
   that all users who wish to filter packets based on TCP flags
   understand what role each flag plays. For instance, if you wanted to
   deny all packets with the FIN, URG, and PSH flags set (like for
   instance an nmap OS fingerprinting attempt) you could use a rule like
   this:
block in quick proto tcp on fxp0 from any to any flags FUP

   (Thanks to [39]Kyle Hargraves for that tip)

   IP Filter's next cool trick is it's ability to maintain state.
   Maintaining state has been described as "not speaking until spoken
   to", in other words, once a connection is established, packets no
   longer have to traverse rulesets. This is a very powerful feature
   allowing much simpler and more secure rule writing.

   For example, let's see how we can apply state to our previous example
   ruleset (confused yet?). To review, we are allowing management access
   from our Class C to port 22(ssh) and allowing all incoming web traffic
   on ports 80(http) and 443(https). We are blocking all other traffic.
   But what if I want to ssh out of the webserver? What if I need to use
   lynx to look up something in the FAQ? Well, I can't because I have
   blocked all incoming connections other than on the specified ports.
   While this is the safest route, it can be quite inconvenient. By
   adding the keep state keywords to our "pass out" rule, we can
   automagically allow incoming connections in response to connections we
   initiate, such as when web browsing.
#############################
# begin ruleset
#############################
pass in quick on fxp0 from 1.1.1.0/24 to any port = 22
pass in quick on fxp0 from any to any port = 80
pass in quick on fxp0 from any to any port = 443
block in quick on fxp0 from any to any
pass out on fxp0 from any to any keep state
##############################
# end ruleset
##############################

   This little change will dramatically increase the flexibility and
   security of our ruleset because it allows us to do some funky voodoo.
   For instance, in the above ruleset, we are allowing all tcp traffic
   into ports 80 & 443. We can tighten this up even more. In order for a
   tcp connection to be established, we only need to allow the initial
   handshake to occur, once that occurs, we can block traffic to that
   port and allow our "keep state" rule to manage the connection. To
   allow the initial handshake to complete, we need only allow packets
   with the SIN and SIN/ACK flags set. By passing only packets with SIN
   and SIN/ACK set, we can prevent many forms of portscanning such as FIN
   scanning. The rules now look like this:
#############################
# begin ruleset
#############################
pass in quick on fxp0 from 1.1.1.0/24 to any port = 22
pass in quick on fxp0 from any to any port = 80 flags S/SA
pass in quick on fxp0 from any to any port = 443 flags S/SA
block in quick on fxp0 from any to any
pass out on fxp0 from any to any keep state
##############################
# end ruleset
##############################

   Let's wrap this up by putting all of the rules we have so far into a
   ruleset. This ruleset will have a default deny policy, allow
   management connections from an internal network only (via ssh) and
   allow incoming traffic on ports 80(http) and 443(https). It will also
   protect against spoofed non-routeable ip addresses, and drop all
   packets that are too fragmented to inspect. A pretty comprehensive
   setup for a public webserver. Here's what /etc/ipf.rules should look
   like:
###########################
# begin ruleset
###########################
# loopback rules
pass out quick on lo0
pass in quick on lo0

# drop itsy bitsy frags
block in quick proto tcp all with short

# drop source routed packets
block in quick on fxp0 all with opt lsrr
block in quick on fxp0 all with opt ssrr

# don't allow anyone to spoof non-routeable addresses
block in quick on fxp0 from 127.0.0.0/8 to any
block in quick on fxp0 from 192.168.0.0/16 to any
block in quick on fxp0 from 172.16.0.0/12 to any
block in quick on fxp0 from 10.0.0.0/8 to any
block out quick on fxp0 from any to 127.0.0.1/8
block out quick on fxp0 from any to 192.168.0.0/16
block out quick on fxp0 from any to 172.16.0.0/12
block out quick on fxp0 from any to 10.0.0.0/8

# only allow our machines to connect via ssh
pass in quick on fxp0 from 1.1.1.0/24 to any port = 22

# allow others to use http and https
pass in quick on fxp0 from any to any port = 80 flags S/SA
pass in quick on fxp0 from any to any port = 443 flags S/SA

# finally lock the rest down with a default deny
block in quick on fxp0 from any to any

# and let out-going traffic out and maintain state on established connections
pass out on fxp0 from any to any keep state

#############################
# end ruleset
#############################

   For further information on ipf, the [40]IPF how-to is an excellent
   source, as are the resources available at the [41]IP Filter homepage.

6.3 - IPNAT

   Initial work done by Wayne Fergerstrom <wayne@@methadonia.net>
     * [42]6.3.1 Introduction
          + [43]6.3.1.1 Purpose
          + [44]6.3.1.2 Terminology
          + [45]6.3.1.3 Configuration
     * [46]6.3.2 Network Address Translation
          + [47]6.3.2.1 Introduction to Network Address Translation
          + [48]6.3.2.2 Why to use Network Address Translation
          + [49]6.3.2.3 Setup
          + [50]6.3.2.4 Configuration
          + [51]6.3.2.5 Running
     * [52]6.3.3 Network Address Translation Knowledge Base
          + [53]6.3.3.1 Checking NAT status
          + [54]6.3.3.2 Limitations of NAT (in FTP)
          + [55]6.3.3.3 Redirecting Traffic
          + [56]6.3.3.4 Network Address Translation versus Proxy
     * [57]6.3.4 Links and X-References
     _________________________________________________________________

  6.3.1 Introduction

   Purpose

   The purpose of this document is to explain and give and overview of
   installing and configuring Network Address Translation ("NAT") on an
   OpenBSD machine. This document is meant for users with a beginning to
   intermediate level of knowledge in UNIX, TCP/IP, and networking
   technologies. The user is assumed to have already set up and
   configured an OpenBSD machine with two network cards (one connected to
   the Internet and the other to the local network).

   Based on [58]RFC 1631, ipnat provides an easy way to map internal
   networks to a single routeable ("real") internet address. This is very
   useful if you don't have officially assigned addresses for every host
   on your internal network. When you set up private/internal networks,
   you can take advantage of reserved address blocks (assigned in [59]RFC
   1918), such as:

   10.0.0.0/8 (10.0.0.0 - 10.255.255.255)
   172.16.0.0/12 (172.16.0.0 - 172.31.255.255)
   192.168.0.0/16 (192.168.0.0 - 192.168.255.255)
   Terminology

   The conventions used in this document are fairly straightforward. For
   documentation purposes I will review some of the terms and format for
   which this document adheres to.
   "NAT"
       This describes the function of "Network Address Translation." The
       process of NAT is described later in this document.

   "ipnat"
       This is short for "IP Network Address Translation." In-and-of
       itself, it can be used interchangeably with NAT. However, in this
       document the term "ipnat" will be used solely for command-line
       only use.

   "IPF"
       This is short for "IP Filter." IP Filter is a portable packet
       filtering software that is included as part of OpenBSD. IP Filter
       must be enabled before you can turn on ipnat. This is easy, just
       edit /etc/rc.conf and change ipf=NO to ipf=YES. That only changes
       it for the boot up sequence, you also need to do 'ipf -E' to turn
       on ipf while you are booted. Of course, this is described further,
       below.

   Configuration

   This is how the computers are setup concerning this document. Your
   setup will vary from this, but the purpose of the document is to give
   you an overview so you can conform this information to your setup.
   Computer Operating System: OpenBSD v2.5 i386
       NICs:

   NetGear 10/100MB pn0
       Connected to the EXTERNAL LAN (or WAN)
       IP Address: 24.5.0.5
       Netmask: 255.255.255.0
       NetGear 10/100MB pn1
       Connected to the INTERNAL LAN
       IP Address: 192.168.1.1
       Netmask: 255.255.255.0

   External, Internet-routeable IP (provided by ISP, in this example, a
   cable modem provider)
   IP Address: 24.5.0.5
       Netmask: 255.255.255.0
       Gateway: 24.5.0.1

   Local Area Network
   In this example, machines on the LAN use the IP addressing scheme
       192.168.1.xxx (where xxx is a unique number). There are a variety
       of different operating systems on the internal LAN including
       Windows 98, Windows NT, OpenBSD and Linux. Each machine is
       connected to a hub that is designated for internal use. For this
       document and its examples the client on the LAN will assume IP
       address 192.168.1.40

   Diagram of Configuration
+-----+              +---------+         +----------+
| Hub |--------- pn1 |   NAT   | pn0 ----| Internet |
+-----+              +---------+         +----------+
  | |
  | +-- Client A
  +---- More clients

                              +-------------------------+
                              |          LEGEND         |
                              +-------------------------+
                              |  NIC pn0 - 24.5.0.5     |
                              |  NIC pn1 - 192.168.1.1  |
                              | Client A - 192.168.1.40 |
                              +-------------------------+

  6.3.2 Network Address Translation

   Introduction to NAT

   As more and more businesses and users get on the Internet, each one
   must have an IP address. Public IP addresses are becoming harder and
   harder to get. The solution for a lot of people has been Network
   Address Translation (or "NAT"). NAT is a very simple, yet powerful way
   to get your LAN connected to the Internet without having to purchase
   or lease IP addresses for each machine. NAT is also known as "IP
   Masquerading" if you're a Linux user.

   When NAT is up and running correctly, it allows users on the internal
   LAN to access the Internet through a different IP address (the one you
   set up with your provider). Each machine on the LAN uses the one IP
   address (transparently) of the one machine that is set up to use the
   ISP assigned IP address.

   The way NAT works is amazingly simple. When a client on the LAN wants
   to connect to a machine on the Internet, it sends out a TCP packet
   with a request to connect. Inside the TCP packet header is the
   client's IP address (i.e. 192.168.1.40) and the requested host's IP
   address (i.e. 123.45.67.89). The machine running NAT intercepts this
   TCP packet and changes the client's IP address from 192.168.1.40 to
   the IP address of the Internet-connected machine (i.e. 24.5.0.5). This
   effectively tricks the host machine into thinking the actual
   connection is from the NAT machine, not the actual client's machine.
   The host then sends back responses to the NAT machine like it was the
   one connecting. When the NAT machine receives the responses it quickly
   translates the destination IP address back from itself to the client's
   machine and sends the packet to the client. The client didn't have any
   idea of what happened and spoofed Internet connectivity is totally
   transparent.

   The example below shows NAT a little more clearly:
Client ----------------- pn1 [ NAT ] pn0 ---------- Internet Host
192.168.1.40 --- 192.168.1.1 [ NAT ] 24.5.0.5 --- 123.45.67.89

OUTGOING TCP Packet                     OUTGOING TCP Packet
From: 192.168.1.40  >>=== NAT ===>>     From: 24.5.0.5
To: 123.45.67.89                        To: 123.45.67.89

INCOMING TCP Packet                     INCOMING TCP Packet
From: 123.45.67.89                      From: 123.45.67.89
To:   192.168.1.40  <<=== NAT ===<<     To: 24.5.0.5

   Why to use NAT

   When presented with a cable modem in my new apartment I was also
   presented with another minor problem. How to get Internet access to my
   roommates, when the cable modem resides in my room? There were a few
   options I could implement ranging from obtaining extra IP addresses,
   to setting up a proxy server, to setting up NAT. (Don't let the cable
   modem example fool you. NAT is powerful enough to masquerade a large
   network with hundreds or even thousands of computers!)

   There are many reasons why I wanted to set up NAT. The number one
   reason is for saving money. There are two roommates in my house (each
   with their own PC) and myself with 3 computers. My ISP only allows for
   three IP addresses per household. This means that there weren't enough
   IPs to allow every machine internet access.

   By using NAT each machine will have a unique (internal) IP address but
   share the one IP address given to me by my ISP. The cost goes down.
   Setup

   In order to enable NAT on your OpenBSD machine you will need to turn
   on IPF and NAT. This is easily accomplished by editing the files
   listed below (make the changes to the file so it looks like the
   options below):

   /etc/rc.conf (this file used to start services at boot time)
   ipfilter=YES
       ipnat=YES

   /etc/sysctl.conf
   net.inet.ip.forwarding=1

   After these changes are made, the machine is now ready to for the
   configuration of NAT.
   Configuration

   The first step is to configure the IPF rules file (/etc/ipf.rules).
   For the purposes of this document we will allow traffic to pass
   through this firewall option without any interference. The file should
   look like this:
pass in from any to any
pass out from any to any

   Again for more information you can read [60]FAQ 6.2

   The NAT configuration file (/etc/ipnat.rules) has a very simple
   syntax. For the configuration set forth above, the file should contain
   the following entry:
map pn0 192.168.1.0/24 -> 24.5.0.5/32 portmap tcp/udp 10000:60000
map pn0 192.168.1.0/24 -> 24.5.0.5/32

   Here is an explanation for the above lines.
   "map"
       This is the command you are giving ipnat. It is telling ipnat that
       this entry is an entry to change IP addresses between the LAN and
       the Internet.

   "pn0"
       This is the network interface that is connected to the Internet.

   "192.168.1.0/24"
       the IP address and netmask (the netmask is in CIDR format).
       Combined they state "any IP address of value 192.168.1.1 through
       192.168.1.254" should be mapped. If you would prefer not to use
       CIDR notation you can substitute "/24" for "/255.255.255.0".

   "24.5.0.5/32"
       This IP address and netmask state the IP address that the LAN IP
       addresses will be mapped to. /32 means one single IP address. You
       can also map to a /24, or 256 IP addresses (or a /27, or whatever
       number of bits you'd like)!! This is useful if you have several
       thousand client machines behind your NAT.... (Of course, this is
       only useful if that /24 is being routed to your OpenBSD box!)

   "portmap tcp/udp 10000:60000"
       This maps all tcp/udp packets to ports in the range of 10000 to
       60000.

   The second line has almost the same entry except for the last portion.
   This tells ipnat to map anything else (not tcp/udp, those packets are
   already matched by the first line) to whatever port it requests (used
   for ICMP, and other protocols). Once this is in the file, all that's
   needed is to run the IPF daemon.
   Running

   Executing NAT is a very simple process also. Once the configuration is
   complete, there are two ways to enable NAT. The first (and best way if
   possible-to test the setup stage) is to reboot your OpenBSD machine.
   This is accomplished with the command "reboot"

   If you would like to run ipnat from the command line, use the
   following commands:
# ipf -Fa -f /etc/ipf.rules -E
# ipnat -CF -f /etc/ipnat.rules

   The first line is to enable IPF (remember that NAT piggy-backs on IPF
   therefore IPF must be initialized and running before NAT can be
   loaded). The options on the command line "-Fa" clear out any existing
   entries already in effect. "-f /etc/ipf.rules" tells ipf where the
   rules file can be found. "-E" is the switch to enable the IPF daemon.

   The second command line is to enable NAT. "-CF" clears and flushes all
   existing entries in the NAT table. "-f /etc/ipnat.rules" tells NAT
   where the NAT rules file is at. NAT is now running. It's as simple as
   that.

   Note: in order to reload the NAT settings (in case you edit the file
   but don't want to reboot) just execute the 2nd command over again. The
   settings will be flushed and reloaded.

  6.3.3 Nat Knowledge Base

   Checking NAT Status

   To find out how NAT is doing or make sure the settings have taken
   effect, you use the "-l" option. This option will list all the
   settings and current sessions that ipnat is running:
# ipnat -l
map pn0 192.168.1.0/24 -> 24.5.0.5/32 portmap tcp/udp 10000:60000
map pn0 192.168.1.0/24 -> 24.5.0.5/32

List of active sessions:
MAP 192.168.1.40  2473  <- -> 24.5.0.5  13463 [129.128.5.191 80]

   The purpose of the first two lines is to confirm the settings that
   were entered in /etc/ipnat.rules earlier. The line(s) below will show
   you a list of the current NAT controlled connections.
   "MAP 192.168.1.40 2473"
       This tells you the IP address of the machine on the LAN that is
       using NAT. The port number used to make the connection is
       displayed afterwards.

   "<- ->"
       This shows that NAT is handling the flow of traffic in both
       directions.

   "24.5.0.5 13463"
       This denotes that the connection is going to the Internet via IP
       address 24.5.0.5 and using port 13463.

   "129.128.5.191 80"
       The IP address and the port being connected to are listed last.

   Limitations of NAT (in FTP)

   There are a few limitations of NAT. One is with FTP. When a user
   connects to a remote FTP server and requests information or file, the
   FTP server will make a connection to the client and transfer the info.
   This is done on a random free port. This is a problem for users
   attempting to gain access to FTP servers from within the LAN. When the
   FTP server sends its information it sends it to the external NIC at a
   random port. The NAT machine will receive this, but because it has no
   mappings for the unknown packet and doesn't have any mappings for that
   port, it will drop the packet and won't deliver it.

   The solution to this is to place yourself in "passive mode" in your
   FTP client. This will tell the server that you want to connect to the
   server, and not what you just read. Then when you make that connection
   out NAT will correctly handle your connection.

   IP Filter provides another solution for this situation, that is, an
   ftp proxy which is built-in to the NAT code. To activate it, put
   something like this before your other NAT mappings.
map pn0 192.168.1.0/24 -> 24.5.0.5/32 proxy port ftp ftp/tcp

   With this in place, the kernel will watch your FTP connections for the
   "PORT" command coming from the ftp client, and it will replace the IP
   address and port with it's own outside IP address, and a port of its
   own choosing. Then it will open up that port and tunnel the data to
   the port your ftp client asked for. Obviously, this is slightly more
   resource intensive. But, unless your NAT/IP Filter box is reaching
   critical mass, you should be fine.

   Redirecting Traffic

   At times you may need to redirect incoming or outgoing traffic for a
   certain protocol or port. A good example of this is if there were a
   server residing inside the LAN running a web server. Incoming
   connections to your valid Internet IP will find that unless your NAT
   box is running a web server, no connection can be made. For this
   purpose we use the NAT 'rdr' directive in the rules file to instruct
   where to redirect (or route) a particular connection to.

   For our example, lets say a web server resides on the LAN with IP
   address of 192.168.1.80. The NAT rules file needs a new directive to
   handle this. Add a line similar to the following one to your
   ipnat.rules:
rdr pn0 24.5.0.5/32 port 80 -> 192.168.1.80 port 80

   The reason for each line is this:
   "rdr"
       This is the command you are giving ipnat. It is telling ipnat that
       this entry is an entry to redirect a connection.

   "pn0"
       This is the network interface that is connected to the Internet.

   "24.5.0.5/32"
       This means an incoming connection to this IP address (only on pn0,
       as above)

   "port 80"
       This is the port (80) that should be redirected. The number "80"
       didn't have to be used. You can use "port www" also to specify a
       redirection of port 80. If you would like to use a name instead of
       a number, the service name and corresponding port, must exist in
       the file /etc/services.

   "192.168.1.80"
       The IP address and netmask of the LAN machine which the packets
       are redirected to. The netmask is always "/32" (and therefore not
       needed to be specified) so the packets can be redirected to a
       particular machine.

   When the addition is complete reload the NAT rules, and the
   redirection will start immediately.
   NAT versus Proxy

   The difference between NAT and an application-based proxy is that the
   proxy software acts as a middle-man between the Internet and the
   machines connected on the LAN. This is fine, however each application
   you want to run on your machine and connect to the Internet through
   the proxy server MUST be proxy-aware (be able to use a proxy server).
   Not all applications are able to do this (especially games).
   Furthermore, there simply are not proxy server applications for all of
   the Internet services out there. NAT transparently maps your internal
   network so that it may connect to the Internet. The only security
   advantage to using a proxy software over NAT is that the proxy
   software may have been made security aware, and can filter based on
   content, to keep your Windows machine from getting a macro virus, it
   can protect against buffer overflows to your client software, and
   more. To maintain these filters is often a high-maintenance job.
   6.3.4 Links and X-References

   OpenBSD files:
     * /etc/ipnat.rules - NAT rules file
     * /etc/rc.conf - need to edit to start up ipnat and ipf at boot time
     * /etc/sysctl.conf - need to edit to enable IP forwarding
     * /usr/share/ipf/nat.1 - samples of ipnat.rules

   NAT Internet Links:
     * [61]http://www.openbsd.org/cgi-bin/man.cgi?query=ipnat&sektion=8
     * [62]Man page showing correct ipnat.rules syntax
     * [63]http://coombs.anu.edu.au/~avalon/
     * [64]http://www.geektools.com/rfc/rfc1631.txt
d3238 1
a3238 1
  6.4.1 DHCP Client
d3240 4
a3243 4
   To use the DHCP client [65]dhclient(8) included with OpenBSD, edit
   /etc/hostname.xl0 (this is assuming your main ethernet interface is
   xl0. Yours might be ep0 or fxp0 or something else!) All you need to
   put in this hostname file is 'dhcp'
d3245 3
d3249 2
a3250 6
   This will cause OpenBSD to automatically start the DHCP client on
   boot. OpenBSD will gather its IP address, default gateway, and DNS
   servers from the DHCP server.

   If you want to start a dhcp client from the command line, make sure
   /etc/dhclient.conf exists, then try:
d3252 1
d3254 4
a3257 7
   Where fxp0 is the interface that you want to receive dhcp on.

   No matter how you start the dhclient, you can edit the
   /etc/dhclient.conf file to not update your DNS according to the dhcp
   server's idea of DNS by first uncommenting the 'requre' lines in it
   (they are examples of the default settings, but you need to uncomment
   them to override dhclient's defaults.)
d3260 2
d3263 1
a3263 4
   and then remove domain-name-servers. Of course, you may want to remove
   hostname, or other settings too.

  6.4.2 DHCP Server
d3265 3
a3267 4
   If you want to use OpenBSD as a DHCP server [66]dhcpd(8), edit
   /etc/rc.conf. Set it up so that dhcpd_flags="-q" instead of
   dhcpd_flags=NO. Put the interfaces that you want dhcpd to *listen* on
   in /etc/dhcpd.interfaces.
d3269 1
a3269 2

   Then, edit /etc/dhcpd.conf. The options are pretty self explanatory.
d3279 7
a3285 8
   This will tell your dhcp clients that the domain to append to DNS
   requests is xyz.mil (so, if the user types in 'telnet joe' then it
   will send them to joe.xyz.mil). It will point them to DNS servers
   192.168.1.3 and 192.168.1.5. For hosts that are on the same network as
   an ethernet interface on the OpenBSD machine, which is in the
   192.168.1.0/24 range, it will assign them an IP address between
   192.168.1.32 and 192.168.1.127. It will set their default gateway as
   192.168.1.1.
d3287 2
a3288 2
   If you want to start dhcpd from the command line, after editing
   /etc/dhcpd.conf, try:
d3290 11
d3302 2
a3303 2
   Where fxp0 is an interface that you want to start serving dhcp on. The
   -q flag makes dhcpd quiet, otherwise it is very noisy.
d3305 2
a3306 4
   If you are serving DHCP to a Windows box, you may want to dhcpd to
   give the client a 'WINS' server address. To make this happen, just the
   following line to your /etc/dhcpd.conf:
option  netbios-name-servers    192.168.92.55;
d3308 115
a3422 2
   (where 192.168.92.55 is the IP of your Windows or Samba server.) See
   [67]dhcp-options(5) for more options that your DHCP clients may want.
d3424 2
a3425 1
6.5 - PPP
d3427 2
a3428 129
   Point-to-Protocol is generally what is used to create a connection to
   your ISP via your modem. OpenBSD has 2 ways of doing this.
     * [68]pppd(8) - Which is the kernel ppp daemon.
     * [69]ppp(8) - Which is the userland ppp daemon.

   The first one we will cover will be the userland PPP daemon. To start
   off you will need some simple information about your isp. Here is a
   list of helpful information that you will need.
     * Your ISP's dialup number
     * Your nameserver
     * Your username and password.
     * Your gateway

   Some of these you can do without, but would be helpful in setting up
   your ppp. The userland PPP daemon uses the file [70]/etc/ppp/ppp.conf
   as its configuration file. There are many helpful files in /etc/ppp
   that can have different setups for many different situations. You
   should take a browse though that directory.

   Also, make sure, that if your not using a GENERIC kernel, that you
   have this line in your configuration file:
pseudo-device   tun             2

  Initial Setup - for PPP(8)

   Initial Setup for the userland PPP daemon consists of editing your
   /etc/ppp/ppp.conf file. This file doesn't exist by default, but there
   is a file /etc/ppp/ppp.conf.sample in which you can simply edit to
   create your own ppp.conf file. Here I will start with the simplist
   setup and probably most used setup. Here is a quick ppp.conf file that
   will simply connect to your ISP and set your default routes and
   nameserver. With this file all the information you need is your ISP's
   phone number and your username and password.
default:
set log Phase Chat LCP IPCP CCP tun command
set device /dev/cua01
set speed 115200
set dial "ABORT BUSY ABORT NO\\sCARRIER TIMEOUT 5 \"\" AT OK-AT-OK ATE1Q0 OK\\d
ATDT\\T TIMEOUT 40 CONNECT"

   NOTICE - On OpenBSD 2.6, the system shipped with a
   /etc/ppp/ppp.conf.example that had an incorrect setting for device.
   The device was "set device /dev/cuaa0". This should be /dev/cua00
   which would correspond to serial device 1. (COM1). Your device might
   not be on COM1, however the naming scheme was wrong.

   The section under the default: tag will get executed each time. Here
   we setup all our critical information. Here with "set log" we set our
   logging levels. This can be changed, refer to [71]ppp(8) for more info
   on setting up logging levels. Our device gets set with "set device".
   This is the device that the modem is on. In this example the modem is
   on com port 2. Therefore com port 1 would be /dev/cua00. With "set
   speed" we set the speed of our dialup connection and with "set dial"
   we set our dialup parameters. With this we can change our timeout
   time, etc. This line should stay pretty much as it is though.

   Now we can move on and setup our information specific to our ISP. We
   do this by adding another tag under our default: section. This tag can
   be called anything you want, easiest to just use the name of your ISP.
   Here I will use myisp: as our tag referring to our ISP. Here is a
   simple setup incorporating all we need to get ourselves connected.

myisp:
set phone 1234567
set login "ABORT NO\\sCARRIER TIMEOUT 5 ogin:--ogin: ppp word: ppp"
set timeout 120
set ifaddr 10.0.0.1/0 10.0.0.2/0 255.255.255.0 0.0.0.0
add default HISADDR
enable dns

   Here we have setup essential info for that specific ISP. The first
   option "set phone" sets your ISP's dialup number. The "set login" sets
   our login options. Here we have the timeout set to 5, this means that
   we will abort our login attempt after 5 seconds if no carrier.
   Otherwise it will wait for "login:" to be sent and send in your
   username and password. In this example our Username = ppp and Password
   = ppp. These values will need to be changed. The line "set timeout"
   sets the timeout for the entire login process to 120 seconds. The "set
   ifaddr" line is a little tricky. Here is a more extensive
   explanation.
set ifaddr 10.0.0.1/0 10.0.0.2/0 255.255.255.0 0.0.0.0

   In the above line, we have it set in the format of "set ifaddr
   [myaddr[/nn] [hisaddr[/nn] [netmask [triggeraddr]]]]". So the first IP
   specified is what we want as our IP. If you have a static IP address,
   you set it here. In our example we use /0 which says that no bits of
   this ip address need to match and the whole thing can be replaced. The
   second IP specified is what we expect as their IP. If you know this
   you can specify it. Again in our line we don't know what will be
   assigned, so we let them tell us. The third option is our netmask,
   here set to 255.255.255.0.If triggeraddr is specified, it is used in
   place of myaddr in the initial IPCP negotiation. However, only an
   address in the myaddr range will be accepted. This is useful when
   negotiating with some PPP implementations that will not assign an IP
   number unless their peer requests ``0.0.0.0''.

   The next option used "add default HISADDR" sets our default route to
   their IP. This is 'sticky', meaning that if their IP should change,
   our route will automatically be updated. With "enable dns" we are
   telling our ISP to authenticate our nameserver addresses. Do NOT do
   this if you are running an local DNS, as ppp will simply circumvent
   its use by entering some nameserver lines in /etc/resolv.conf.

  Using PPP(8)

   Now that we have our ppp.conf file setup we can start trying to make a
   connection to our ISP. I will detail some commonly used arguments with
   ppp.
     * ppp -auto myisp - This will run ppp, configure your interfaces and
       connect to your isp and then go into the background.
     * ppp -ddial myisp - This is similar to -auto, but if your
       connection is dropped it will try and reconnect.

   By using /usr/sbin/ppp with no options will put you into interactive
   mode. From here you can interact directly with the modem, it is great
   for debugging problems in your ppp.conf file.

  ppp(8) extras

   In some situations you might want commands executed as your connection
   is made or dropped. There are two files you can create for just these
   situations. /etc/ppp/ppp.linkup and /etc/ppp/ppp.linkdown. Sample
   configurations can be viewed here:
     * [72]ppp.linkup
     * [73]ppp.linkdown

   Extended information can be found at
   [74]http://www.freebsd.org/handbook/userppp.html or
   [75]http://www.freebsd.org/faq/userppp.html.
d3432 2
a3433 2
  6.6.1 - How can I tweak the kernel so that there are a higher number of
  retries and longer timeouts for TCP sessions?
d3435 3
a3437 3
   You would normally use this to allow for routing or connection
   problems. Of course, for it to be most effective, both sides of the
   connection need to use similar values.
d3439 1
a3439 1
   To tweak this, use sysctl and increase the values of:
d3443 3
d3447 1
a3447 5
   Using sysctl -a, you can see the current values of these (and many
   other) parameters. To change one, use sysctl -w, as in sysctl -w
   net.inet.tcp.keepidle=28800.

  6.6.2 - How can I turn on directed broadcasts?
d3449 3
a3451 3
   Normally, you don't want to do this. This allows someone to send
   traffic to the broadcast address(es) of your connected network(s) if
   you are using your OpenBSD box as a router.
d3453 4
a3456 5
   There are some instances, in closed networks, where this may be
   useful, particularly when using older implementations of the NetBIOS
   protocol. This is another sysctl. sysctl -w
   net.inet.ip.directed-broadcast=1 turns this on. Read about [76]smurf
   attacks if you want to know why it is off by default.
d3458 1
a3458 1
  6.6.3 - I don't want to the kernel to dynamically allocate a certain port
d3460 1
a3460 1
   There is a sysctl for this also. From [77]sysctl(8):
d3475 2
a3476 222
   NFS, or Network File System, is used to share a filesystem over the
   network. A few choice man pages to read before trying to setup a NFS
   server are:

     * [78]nfsd(8)
     * [79]mountd(8)
     * [80]exports(5)

   This section will go thru the steps for a simple setup of NFS. This
   example details a server on a LAN, with clients accessing NFS on the
   LAN. It does not talk about securing NFS. We presume you have already
   setup packet filtering or other firewalling protection, to prevent
   outside access. If you are allowing outside access to your NFS server,
   and you have any kind of sensitive data stored on it, we strongly
   recommend that you employ [81]IPSec. Otherwise, people can potentially
   see your NFS traffic. Someone could also pretend to be the IP address
   which you are allowing into your NFS server. There are several attacks
   that can result. When properly configured, IPSec protects against
   these types of attacks.

   Another important security note. Don't just add a filesystem to
   /etc/exports without some kind of list of allowed host(s). Without a
   list of hosts which can mount a particular directory, anyone on who
   can reach your host will be able to mount your NFS exports.

   The setup consists of a server with the ip 10.0.0.1. This server will
   be serving NFS only to clients within that network. The first step to
   setting up NFS is to setup your /etc/exports file. This file lists
   which filesystems you wish to have accessible via NFS and defines who
   is able to access them. There are many options that you can use in
   your /etc/exports file, and it is best that you read the
   [82]exports(5) man page. For this example we have an /etc/exports that
   looks like this:
#
# NFS exports Database
# See exports(5) for more information.  Be very careful, misconfiguration
# of this file can result in your filesystems being readable by the world.
/work -alldirs -ro -network 10.0.0 -mask 255.255.255.0

   This means that the local filesystem /work will be made available via
   NFS. -alldirs specifies that clients will be able to mount at any
   point under the /work mount point. -ro specifies that it will only be
   allowed to be mounted read-only. The last two arguments specify that
   only clients within the 10.0.0.0 network using a netmask of
   255.255.255.0 will be authorized to mount this filesystem. This is
   important for some servers that are accessible by different networks.

   Once your /etc/exports file is setup, you can go ahead and setup your
   NFS server. You should first make sure that options NFSSERVER &
   NFSCLIENT are in your kernel configuration. (GENERIC kernel has these
   options included.) Next, you should set nfs_server=YES in
   /etc/rc.conf. This will bring up both nfsd(8) and mountd(8) when you
   reboot. Now, you can go ahead and start the daemons yourself. These
   daemons need to be started as root, and you need to make sure that
   portmap(8) is running on your system. Here is an example of starting
   nfsd(8) which serves on both TCP and UDP using 4 daemons. You should
   set an appropriate number of NFS server daemons to handle the maximum
   number of concurrent client requests that you want to service.

# /sbin/nfsd -tun 4

   Not only do you have to start the nfsd(8) server, but you need to
   start mountd(8). This is the daemon that actually services the mount
   requests on NFS. To start mountd(8), simply type:

# /sbin/mountd

   If you make changes to /etc/exports while NFS is already running, you
   need to make mountd aware of this! Just HUP it:
# kill -HUP `cat /var/run/mountd.pid`

  Checking Stats on NFS

   From here, you can check to make sure that all these daemons are up
   and registered with RPC. To do this, use rpcinfo(8).

$ rpcinfo -p 10.0.0.1
   program vers proto   port
    100000    2   tcp    111  portmapper
    100000    2   udp    111  portmapper
    100005    1   udp    633  mountd
    100005    3   udp    633  mountd
    100005    1   tcp    916  mountd
    100005    3   tcp    916  mountd
    100003    2   udp   2049  nfs
    100003    3   udp   2049  nfs
    100003    2   tcp   2049  nfs
    100003    3   tcp   2049  nfs

   During normal usage, there are a few other utilities that allow you to
   see what is happening with NFS. One is [83]showmount(8) , which allows
   you to view what is currently mounted and who is mounting it. There is
   also nfsstat(8) which shows much more verbose statistics. To use
   showmount(8), try /usr/bin/showmount -a host. For example:

$ /usr/bin/showmount -a 10.0.0.1
All mount points on 10.0.0.1:
10.0.0.37:/work

  Mounting NFS Filesystems

   NFS filesystems should be mounted via mount(8), or more specifically,
   [84]mount_nfs(8). To mount a filesystem /work on host 10.0.0.1 to
   local filesystem /mnt, do this (note that you don't need to use an IP
   address, mount will resolve host names):

# mount -t nfs 10.0.0.1:/work /mnt

   To have your system mount upon boot, add something like this to your
   /etc/fstab:

10.0.0.1:/work /mnt nfs rw 0 0

   It is important that you use 0 0 at the end of this line so that your
   computer does not try to fsck the NFS filesystem on boot!!!! The other
   standard security options, such as noexec, nodev, and nosuid, should
   also be used where applicable. Such as:

10.0.0.1:/work /mnt nfs rw,nodev,nosuid 0 0

   This way, no devices or setuid programs on the NFS server can subvert
   security measures on the NFS client. If you are not mounting programs
   which you expect to run on the NFS client, add noexec to this list.

   [85][Back to Main Index] [86][To Section 5.0 - Kernel configuration
   and Disk Setup] [87][To Section 7.0 - Keyboard controls]
     _________________________________________________________________

   [88][back] [89]www@@openbsd.org
   $OpenBSD: obsd-faq.txt,v 1.26 2001/08/08 21:06:33 jsyn Exp $

References

   1. http://openbsd.org/faq/faq6.html#6.0.1
   2. http://openbsd.org/faq/faq6.html#6.1
   3. http://openbsd.org/faq/faq6.html#6.2
   4. http://openbsd.org/faq/faq6.html#6.3
   5. http://openbsd.org/faq/faq6.html#6.4
   6. http://openbsd.org/faq/faq6.html#6.5
   7. http://openbsd.org/faq/faq6.html#6.6
   8. http://openbsd.org/faq/faq6.html#6.7
   9. http://openbsd.org/faq/faq5.html
  10. http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&apropos=0&sektion=8&format=html
  11. http://www.openbsd.org/cgi-bin/man.cgi?query=netstat&apropos=0&sektion=1&format=html
  12. http://www.3com.com/nsc/501302s.html
  13. http://www.nexor.com/info/rfc/index/rfc.htm?index/rfc.html
  14. http://openbsd.org/faq/faq6.html#6.1.1
  15. http://openbsd.org/faq/faq6.html#6.1.2
  16. http://www.openbsd.org/cgi-bin/man.cgi?query=ne&sektion=4&format=html
  17. http://www.openbsd.org/cgi-bin/man.cgi?query=ep&sektion=4&format=html
  18. http://www.openbsd.org/cgi-bin/man.cgi?query=xl&sektion=4&format=html
  19. http://www.openbsd.org/cgi-bin/man.cgi?query=ie&sektion=4&format=html
  20. http://www.openbsd.org/cgi-bin/man.cgi?query=lo&sektion-4&format=html
  21. http://www.openbsd.org/cgi-bin/man.cgi?query=sl&sektion=4&format=html
  22. http://www.openbsd.org/cgi-bin/man.cgi?query=tun&sektion=4&format=html
  23. http://www.openbsd.org/cgi-bin/man.cgi?query=enc&sektion=4&format=html
  24. http://www.openbsd.org/cgi-bin/man.cgi?query=bridge&sektion=4&format=html
  25. http://www.openbsd.org/cgi-bin/man.cgi?query=hostname.if&sektion=5&format=html
  26. http://www.openbsd.org/cgi-bin/man.cgi?query=resolv.conf&sektion=5&format=html
  27. http://www.openbsd.org/cgi-bin/man.cgi?query=routed&apropos=0&sektion=8&format=html
  28. http://www.gated.org/
  29. http://www.mrtd.net/
  30. http://www.zebra.org/
  31. http://www.openbsd.org/cgi-bin/man.cgi?query=ipf&apropos=0&sektion=8&format=html
  32. http://www.openbsd.org/cgi-bin/man.cgi?query=ipnat&apropos=0&sektion=8&format=html
  33. http://false.net/ipfilter/
  34. http://coombs.anu.edu.au/~avalon/
  35. http://www.obfuscation.org/ipf/
  36. http://www.openbsd.org/cgi-bin/man.cgi?query=ipf&apropos=0&sektion=5&format=html
  37. file://localhost/etc/protocols
  38. http://www.openbsd.org/cgi-bin/man.cgi?query=traceroute&sektion=8&format=html
  39. mailto:halogen@@nol.net
  40. http://www.obfuscation.org/ipf/ipf-howto.txt
  41. http://coombs.anu.edu.au/~avalon/ip-filter.html
  42. http://openbsd.org/faq/faq6.html#nat1.0
  43. http://openbsd.org/faq/faq6.html#nat1.1
  44. http://openbsd.org/faq/faq6.html#nat1.2
  45. http://openbsd.org/faq/faq6.html#nat1.3
  46. http://openbsd.org/faq/faq6.html#nat2.0
  47. http://openbsd.org/faq/faq6.html#nat2.1
  48. http://openbsd.org/faq/faq6.html#nat2.2
  49. http://openbsd.org/faq/faq6.html#nat2.3
  50. http://openbsd.org/faq/faq6.html#nat2.4
  51. http://openbsd.org/faq/faq6.html#nat2.5
  52. http://openbsd.org/faq/faq6.html#nat3.0
  53. http://openbsd.org/faq/faq6.html#nat3.1
  54. http://openbsd.org/faq/faq6.html#nat3.2
  55. http://openbsd.org/faq/faq6.html#nat3.3
  56. http://openbsd.org/faq/faq6.html#nat3.4
  57. http://openbsd.org/faq/faq6.html#nat4.0
  58. http://www.geektools.com/rfc/rfc1631.txt
  59. http://www.geektools.com/rfc/rfc1918.txt
  60. http://openbsd.org/faq/faq6.html#6.2
  61. http://www.openbsd.org/cgi-bin/man.cgi?query=ipnat&sektion=8
  62. http://www.openbsd.org/cgi-bin/man.cgi?query=ipnat&sektion=5&format=html
  63. http://coombs.anu.edu.au/~avalon/
  64. http://www.geektools.com/rfc/rfc1631.txt
  65. http://www.openbsd.org/cgi-bin/man.cgi?query=dhclient&apropos=0&sektion=8&format=html
  66. http://www.openbsd.org/cgi-bin/man.cgi?query=dhcpd&apropos=0&sektion=8&format=html
  67. http://www.openbsd.org/cgi-bin/man.cgi?query=dhcp-options&apropos=0&sektion=5&format=html
  68. http://www.openbsd.org/cgi-bin/man.cgi?query=pppd&sektion=8&format=html
  69. http://www.openbsd.org/cgi-bin/man.cgi?query=ppp&sektion=8&format=html
  70. http://www.openbsd.org/cgi-bin/cvsweb/src/etc/ppp/ppp.conf.sample
  71. http://www.openbsd.org/cgi-bin/man.cgi?query=ppp&sektion=8&format=html
  72. http://www.openbsd.org/cgi-bin/cvsweb/src/etc/ppp/ppp.linkup.sample
  73. http://www.openbsd.org/cgi-bin/cvsweb/src/etc/ppp/ppp.linkdown.sample
  74. http://www.freebsd.org/handbook/userppp.html
  75. http://www.freebsd.org/faq/userppp.html
  76. http://www.netscan.org/
  77. http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&apropos=0&sektion=8&format=html
  78. http://www.openbsd.org/cgi-bin/man.cgi?query=nfsd&sektion=8&format=html
  79. http://www.openbsd.org/cgi-bin/man.cgi?query=mountd&sektion=8&format=html
  80. http://www.openbsd.org/cgi-bin/man.cgi?query=exports&sektion=5&format=html
  81. http://openbsd.org/faq/faq13.html
  82. http://www.openbsd.org/cgi-bin/man.cgi?query=exports&sektion=5&format=html
  83. http://www.openbsd.org/cgi-bin/man.cgi?query=showmount&sektion=8&format=html
  84. http://www.openbsd.org/cgi-bin/man.cgi?query=mount_nfs&sektion=8&format=html
  85. http://openbsd.org/faq/index.html
  86. http://openbsd.org/faq/faq5.html
  87. http://openbsd.org/faq/faq7.html
  88. http://openbsd.org/faq/index.html
  89. mailto:www@@openbsd.org
d3478 620
d4099 1
a4099 1
   [OpenBSD]
d4102 49
a4150 1
     _________________________________________________________________
d4152 1
a4152 22
   Table of Contents
     * [1]7.1 - How do I remap the keyboard?
     * [2]7.2 - Is there gpm or the like in OpenBSD?
     * [3]7.3 - How do I clear the console each time a user logs out?
     * [4]7.4 - Accessing the console scrollback buffer.
     _________________________________________________________________

7.1 - How do I remap the keyboard? (pcvt/i386 specific)

   By using kcon(1), "kcon - keyboard control and remapping for the pcvt
   driver" Before you can use this, you need to turn on character mapping
   with scon.

   Example:
bsd# scon -o
bsd# kcon -m gb

   This will load the keycap file for Great Britain. Note that if you run
   scon -o again, this will turn character mapping back off, which you
   probably don't want to do if you are using kcon for remapping. Keep
   this in mind if you use scon in any automated fashion, such as in
   scripts.
d4154 9
a4162 1
   These commands can only be executed from a pcvt virtual terminal.
d4166 6
a4171 2
   Not yet. If you are willing to do a port, contact the [5]ports mailing
   list.
d4175 10
a4184 9
   To do this you must add a line in /etc/gettytab. Change the section
   currently:
P|Pc|Pc console:\
        :np:sp#9600:

   Add the line ":cl=\E[H\E[2J:" at the end, so it ends up looking like
   this:
P|Pc|Pc console:\
        :np:sp#9600:\
d4187 8
a4194 1
7.4 - Accessing the Console Scrollback Buffer (pcvt/i386 specific)
d4196 1
a4196 32
   For OpenBSD 2.6 the ability to scrollback on the console was added for
   i386 machines. This allows you to see information that has already
   scolled past your screen. To be able to move up and down in the buffer
   simply use the key combination "[shift]+[pgup]" to move up, and
   "[shift]+[pgdn]". The default scollback buffer (the amount of pages
   that you can move up and view) is 8, but this can be changed via the
   [6]scon(1) utility. For example, to change the number of pages you can
   scrollback to 10, do this:
bsd$ scon -b 10

   This command can only be executed from a pcvt virtual terminal.

   [7][Back to Main Index] [8][To Section 6.0 - Networking] [9][To
   Section 8.0 - General Questions]
     _________________________________________________________________

   [10][back] [11]www@@openbsd.org
   $OpenBSD: obsd-faq.txt,v 1.26 2001/08/08 21:06:33 jsyn Exp $

References

   1. http://openbsd.org/faq/faq7.html#7.1
   2. http://openbsd.org/faq/faq7.html#7.2
   3. http://openbsd.org/faq/faq7.html#7.3
   4. http://openbsd.org/faq/faq7.html#7.4
   5. http://openbsd.org/mail.html
   6. http://www.openbsd.org/cgi-bin/man.cgi?query=scon&sektion=1&format=html
   7. http://openbsd.org/faq/index.html
   8. http://openbsd.org/faq/faq6.html
   9. http://openbsd.org/faq/faq8.html
  10. http://openbsd.org/faq/index.html
  11. mailto:www@@openbsd.org
d4198 1
d4200 20
a4219 1
   [OpenBSD]
d4222 28
a4249 1
     _________________________________________________________________
a4250 18
   Table of Contents
     * [1]8.1 - What are these kerberos warnings when I first login?
     * [2]8.2 - How do I change virtual terminals?
     * [3]8.3 - I forgot my root password..... What do I do!
     * [4]8.4 - X won't start, I get lots of error messages
     * [5]8.5 - What is CVS, and how do I use it?
     * [6]8.6 - What is the ports tree?
     * [7]8.7 - What are packages?
     * [8]8.8 - Is there any way to use my floppy drive if it's not
       attached during boot?
     * [9]8.9 - OpenBSD Bootloader (i386 specific)
     * [10]8.10 - Using S/Key on your OpenBSD system
     * [11]8.11 - Why is my Macintosh losing so much time?
     * [12]8.12 - Will OpenBSD run on multiprocessor machines?
     * [13]8.13 - I sometimes get Input/output error when trying to use
       my tty devices
     * [14]8.14 - Where can I find a Netscape binary for OpenBSD?
     _________________________________________________________________
d4254 22
a4275 17
   When you first install your system you will most likely notice a
   warning message that is something like this:
   Warning: no Kerberos tickets issued.

   THIS WARNING IS COMPLETELY IRRELEVANT AND SHOULD ONLY BE REMOVED IF
   COMPLETELY NECESSARY

   Well since you probably haven't set up Kerberos on your system, you
   wouldn't be getting a ticket. If you do have Kerberos running, you
   need to check into that. See [15]faq10 Kerberos Setup FAQ. If you
   can't STAND that warning and never plan on using Kerberos here is how
   to get rid of it for good.

     * Make sure you have the source code.
     * Edit /usr/share/mk/bsd.own.mk and set KERBEROS to 'no', or create
       an /etc/mk.conf file that does this.
     * cd /usr/src/usr.bin/login ; make clean ; make ; make install
d4279 8
a4286 9
   Simply type [ctrl] - [alt] - [One of the function keys] or just hit
   [f9]-[f12] which are just mapped to [ctrl] - [alt]
   functions. (i386)

   Only the i386 arch has virtual terminal capabilities. You can also use
   virtual terminals when using X. For example, If you start X on term 1,
   and switch with [ctrl]-[alt]-[F2] to term 2, X will seem to disappear
   and will not come back by simply switching back to term 1. You must
   [ctrl]-[alt]-[F5] to get your X display back.
d4290 10
a4299 10
   A few steps to recovery
    1. Boot into single user mode. For i386 arch type boot -s at the boot
       prompt.
    2. mount the drives.
        bsd# fsck -p / && mount -u /
    3. If /usr is not the same partition that / is (and it shouldn't be)
       then you will need to mount it, also
        bsd# fsck -p /usr && mount /usr
    4. run [16]passwd(1)
    5. boot into multiuser mode.. and remember your password!
d4303 14
a4316 15
   If you have X completely set up and you are using an XF86Config that
   you know works then the problem most likely lies in the
   machdep.allowaperture. You also need to make sure that both:
option XSERVER
option APERTURE

   are in your kernel configuration. [BOTH of these are in the GENERIC
   kernel]

   Then you need to edit /etc/sysctl.conf
   and set machdep.allowaperture=1. This will allow X to access the
   aperture driver. This would be set up if the question during install
   about whether or not you would be running X was answered correctly.
   OpenBSD requires for all X servers that the aperture driver be set,
   because it controls access to the I/O ports on video boards.
d4318 2
a4319 2
   For other X problems on the i386, consult the XFree86 FAQ at
   [17]http://www.xfree86.org/FAQ/.
d4323 101
a4423 105
   CVS is what the OpenBSD project uses to control changes to the source
   code. CVS stands for Concurrent Versions System. You can read more
   about CVS at [18]http://www.cyclic.com/. CVS can be used by the end
   user to keep up to date with source changes, and changes in the ports
   tree. CVS makes it extremely simple to download the source via one of
   the many CVS mirrors for the project.

  How to initially setup your CVS environment

   There are a few ways to initially set up your CVS environment. To
   start off, you will need an initial CVS checkout of the sources. If
   you bought the CD, you're in luck, because it holds the CVS checkout
   for that release. You can extract it from your CD by doing one of the
   following:

   1) copy the tree off it, (assuming the CD is mounted on /mnt):
# mkdir /usr/src
# cd /mnt; cp -Rp CVS Makefile bin distrib etc games gnu \
include kerberosIV lib libexec lkm regress sbin share \
sys usr.bin usr.sbin /usr/src

   2) Or, alternatively, use a union mount with the CD below a writable
   directory. However, be aware that the union filesystem code is not
   flawless.
# mkdir /usr/src
# mount -t union -o -b /mnt /usr/src

   after this, /usr/src will be a nice checkout area where all cvs(1)
   commands will work OK.

   If you don't have an OpenBSD CD, you will have to retrieve the sources
   from on of the OpenBSD AnonCVS servers. These servers are listed on
   [19]http://www.openbsd.org/anoncvs.html Once you have chosen a server
   you need to choose which module you are going to retrieve. There are
   three main modules available for checkout from the CVS tree. These
   are:
     * src - The src module has the complete source code for OpenBSD.
       This includes userland and kernel sources.
     * ports - The ports module holds all you need to have the complete
       OpenBSD ports tree. To read more on the OpenBSD ports tree, read
       [20]Section 8.6 of the OpenBSD FAQ.
     * www - The www module contains all OpenBSD web pages, including
       this FAQ.

   Now that you have decided which module that you wish to retrieve,
   there is one more step left before you can retrieve it. You must
   decide which method to use. CVS by default retrieves files using
   rsh(1), but some AnonCVS servers don't allow for this so in most cases
   it's best to use ssh. For those of you behind a firewall there are
   also the options of pserver and some AnonCVS servers run ssh on port
   2022. Be sure to check [21]http://www.openbsd.org/anoncvs.html for
   which servers support what protocols. Next I will show how to do a
   simple source checkout. Here I will be using an AnonCVS server located
   in the U.S., but remember that if you are outside of the U.S you need
   to use a server that is located nearby. There are many AnonCVS servers
   located throughout the world, so choose one nearest you. I will also
   be using ssh to retrieve the files.
ericj@@oshibana:~> export CVS_RSH=/usr/bin/ssh
ericj@@oshibana:~> echo $CVS_RSH
/usr/bin/ssh
ericj@@oshibana:~> export CVSROOT=anoncvs@@anoncvs.usa.openbsd.org:/cvs
ericj@@oshibana:~> cvs get src
Warning: Remote host denied X11 forwarding, perhaps xauth program could not be
run on the server side.
cvs checkout: in directory src:
cvs checkout: cannot open CVS/Entries for reading: No such file or directory
cvs server: Updating src
U src/Makefile
[snip]

   Notice here also that I set the CVSROOT environmental variable. This
   is the variable that tells cvs(1) which AnonCVS server to use. This
   can also be specified using the -d option. For example:
ericj@@oshibana:~>cvs -d anoncvs@@anoncvs.usa.openbsd.org:/cvs get src

   These commands should be run in /usr, which will then create the
   directories of /usr/src, /usr/ports, and /usr/www. Depending, of
   course, on which module you checkout. You can download these modules
   to anywhere, but if you wanted to do work with them (ie make build ),
   it is expected that they be at the place above.

  Keeping your CVS tree up-to-date

   Once you have your initial tree setup, keeping it up-to-date is the
   easy part. You can update your tree at any time you choose, some
   AnonCVS servers update more often then others, so again check
   [22]http://www.openbsd.org/anoncvs.html. In this example I will be
   updating my www module from anoncvs.usa.openbsd.org. Notice the -q
   option that I use, this makes the output not so verbose coming from
   the server.
ericj@@oshibana:~> echo $CVSROOT
anoncvs@@anoncvs.usa.openbsd.org:/cvs
ericj@@oshibana:~> cvs -q up -PAd www
Warning: Remote host denied X11 forwarding, perhaps xauth program could not be
run on the server side.
U www/want.html
M www/faq/faq8.html
ericj@@oshibana:~>

  Other cvs options

   For some, bandwidth and time are serious problems when updating
   repositories such as these. So CVS has a -z[1-9] option which uses
   gzip to compress the data. To use it, do -z[compression-level], for
   instance, -z3 for a compression level of 3.
d4427 156
a4582 165
   The ports tree is a set of Makefiles that download, patch, configure
   and install userland programs so you can run them in OpenBSD
   environment without having to do all that by hand. You can get the
   ports tree from any of the OpenBSD ftp servers in
   /pub/OpenBSD/2.6/ports.tar.gz. The most recent ports are available via
   the 'ports' cvs tree, or /pub/OpenBSD/snapshots/ports.tar.gz. For most
   of you however, packages will be a much better option. Packages are
   created from ports and are already compiled and ready to use. To read
   more on packages read [23]FAQ8.7.

  Obtaining the Latest Version of the Ports Tree

   If you are planning on running the latest version of the Ports Tree,
   you should have the latest release of OpenBSD. This is because of
   constant changing and fixing of the ports tree to help with its
   interaction with the rest of your OpenBSD system. If you don't follow
   this guideline, you can expect some minor problems while upgrading.

   The best way to stay current with your OpenBSD Ports Tree is to use
   via cvs(1). OpenBSD has a whole group of Anonymous CVS servers that
   are available to anyone. To read more about cvs look over
   [24]www.openbsd.org/anoncvs.html and [25]Faq8.5.

   Though, if you do not have the ports tree at all, you can download it
   via any of OpenBSD's ftp servers. You can get a list at
   [26]www.openbsd.org/ftp.html. From here download
   /pub/OpenBSD/2.5/ports.tar.gz and untar this in /usr/ports. For
   example:
ericj@@oshibana> ftp ftp://ftp.openbsd.org/pub/OpenBSD/2.5/ports.tar.gz
ericj@@oshibana> sudo cp ports.tar.gz /usr
ericj@@oshibana> cd /usr; sudo tar xfz ports.tar.gz

   Once this is done, you can use cvs(1) to update your Ports Tree. If
   you started with a base Ports Tree of 2.5 there will be a few changes
   that you will need to make. Most notably /usr/share/mk, which holds
   files used by make(1), will need to be updated. If you have the src
   tree on your system, you can update /usr/share/mk via cvs(1) and
   simply:
ericj@@oshibana> cd /usr/src/share/mk; sudo make install

   This will put the proper files into place. After this is done, you
   might also need the latest version of the make(1) binary. You will
   have to create this, if you don't have the src tree on your system you
   can grab it via cvs(1) and compile it. Example:
ericj@@oshibana> export CVS_RSH=/usr/bin/ssh
ericj@@oshibana> cvs -danoncvs@@any.anoncvs.server:/cvs get src/usr.bin/make
cvs server: Updating src/usr.bin/make
U src/usr.bin/make/Makefile
U src/usr.bin/make/Makefile.boot
U src/usr.bin/make/arch.c
U src/usr.bin/make/bit.h
U src/usr.bin/make/buf.c
U src/usr.bin/make/buf.h
U src/usr.bin/make/compat.c
[SNIP]
ericj@@oshibana> cd src/usr.bin/make; sudo make install

   If you already have the src on your machine, simply update make and
   install it. For now, this should be all you need to do to have the
   ports tree working properly.

   A snapshot of the ports tree is also created daily and can be
   downloaded from any of the [27]OpenBSD ftp servers as
   /pub/OpenBSD/snapshots/ports.tar.gz.

  What ports are available? and how do i find them?

   There are two ways of searching for ports. The first way is to check
   [28]www.openbsd.org/portstat.html. There you will find a list of what
   ports are currently available. The other way is to actually use the
   ports tree to search for keywords. To do this use make search
   key="searchkey". Here is an example of a search for 'samba':
ericj@@oshibana> make search key="samba"
Port:   samba-2.0.5a
Path:   /usr/ports/net/samba
Info:   free SMB and CIFS client and server for UNIX
Maint:  ports@@openbsd.org
Index:  net
B-deps:
R-deps:
Archs:  any

Port:   ADMsmb-0.2
Path:   /usr/ports/security/ADMsmb
Info:   Samba security scanner
Maint:  dugsong@@monkey.org
Index:  security
B-deps:
R-deps:
Archs:  any

  Installing Ports

   Ports are set up to be EXTREMELY easy to make and install. Here is an
   example install for someone wanting to install the X11 program xfig.
   You'll notice the dependencies are automatically detected and
   completed:

   First you need to cd to the dir of the program you want. If you are
   searching for a program, you can either update your locate database,
   or use the search function talked about below. Once you are in the dir
   of the program you want, you can just type make install. For example.
fenetyllin:/usr/ports/graphics/xfig# make install
===>  Extracting for xfig-3.2.2
===>  xfig-3.2.2 depends on shared library: jpeg.62. - /usr/local/lib/libjpeg.s
o.62.0 found
===>  xfig-3.2.2 depends on shared library: Xaw3d.6. - not found
===>  Verifying install for Xaw3d.6. in /usr/ports/x11/Xaw3d
>> Xaw3d-1.3.tar.gz doesn't seem to exist on this system.
>> Attempting to fetch from ftp://crl.dec.com/pub/X11/contrib/widgets/Xaw3d/R6.
1/.
Connected to crl.dec.com.
220 crl.dec.com FTP server (Digital UNIX Version 5.60) ready.
331 Guest login ok, send ident as password.
230 Guest login ok, access restrictions apply.
Remote system type is UNIX.
Using binary mode to transfer files.
200 Type set to I.
250 CWD command successful.
250 CWD command successful.
Retrieving pub/X11/contrib/widgets/Xaw3d/R6.1/Xaw3d-1.3.tar.gz
local: Xaw3d-1.3.tar.gz remote: Xaw3d-1.3.tar.gz
227 Entering Passive Mode (192,58,206,2,5,14)
150 Opening BINARY mode data connection for Xaw3d-1.3.tar.gz (0.0.0.0,0) (29027
7 bytes).
100% |**************************************************|   283 KB    00:00 ETA
226 Transfer complete.
290277 bytes received in 101.09 seconds (2.80 KB/s)
221 Goodbye.
===>  Extracting for Xaw3d-1.3
/bin/mkdir -p /usr/ports/x11/Xaw3d/work/xc/lib/Xaw3d/X11/Xaw3d
cd /usr/ports/x11/Xaw3d/work/xc/lib/Xaw3d/X11/Xaw3d; ln -sf ../../*.h .
===>  Patching for Xaw3d-1.3
===>  Configuring for Xaw3d-1.3
mv -f Makefile Makefile.bak
imake -DUseInstalled -I/usr/X11R6/lib/X11/config
make Makefiles
[snip]

  Listing Installed ports/packages

   You can see a list of both ports and packages by using the pkg_info
   command.
bsd# /usr/sbin/pkg_info
zsh-3.0.5           The Z shell.
screen-3.7.4        A multi-screen window manager.
ssh-1.2.21          Secure shell client and server (remote login program).
emacs-20.2          GNU editing macros.
lynx-2.7.1ac-0.107  An alphanumeric display oriented World-Wide Web Client.
tcsh-6.07.02        An extended C-shell with many useful features.
bash-2.01           The GNU Borne Again Shell.
zip-2.2             Create/update ZIP files compatible with pkzip.
mm-2.7              Implementation of MIME, the Multipurpose Internet Mail Exte
n
ircii-2.8.2-epic3.004 An enhanced version of ircII, the Internet Relay Chat cli
ent
ispell-3.1.20       An interactive spelling checker.
tin-1.3.970930      TIN newsreader (termcap based)
procmail-3.11p7     A local mail delivery agent.
strobe-1.03         Fast scatter/gather TCP port scanner
lsof-4.15           Lists information about open files.
xntp3-5.92          Network Time Protocol Implementation.
ncftp-2.4.3
nmh-0.27            The New MH mail handling program
bzip2-0.1p12        A block-sorting file compressor
d4584 1
a4584 1
  Other Information
d4586 2
a4587 2
   More information about the ports can be found in the [29]ports(7) man
   page.
a4588 2
   Our ports tree is constantly being expanded, and if you would like to
   help please see: [30]http://www.openbsd.org/ports.html
d4592 121
a4712 130
   Packages are the precompiled binaries of some of the most used
   programs. They are ready for use on an OpenBSD system. Again, like the
   ports, packages are very easy to maintain and update. Packages are
   constantly being added so be sure to check each release for additional
   packages.

   Here is a list of tools used in managing packages.
     * [31]pkg_add(1) - a utility for installing software package
       distributions
     * [32]pkg_create(1) - a utility for creating software package
       distributions
     * [33]pkg_delete(1) - a utility for deleting previously installed
       software package distributions
     * [34]pkg_info(1) - a utility for displaying information on software
       packages

  Where to find packages

   If you are a smart user and bought one of the [35]OpenBSD CD, then
   packages can be found on both CD's depending on your architecture. If
   you don't have an OpenBSD CD in your posession you can download
   packages from any of the ftp mirrors. You can get a list of mirrors
   [36]http://www.openbsd.org/ftp.html. Packages are located at
   /pub/OpenBSD/2.6/packages from there packages are broken down
   depending on architecture.

  Installing Packages

   To install packages, the utility [37]pkg_add(1) is used. pkg_add(1) is
   an extremely easy utility to use, in the following two examples
   pkg_add(1) will be used to install a package. The first example will
   show pkg_add(1) installing a package that resides on a local disk, the
   second example will show an installation of a package via ftp. In both
   examples screen-3.7.6 will be installed.
   Installing via local disk
$ sudo pkg_add -v screen-3.7.6.tgz
Requested space: 749864 bytes, free space: 2239117312 bytes in /var/tmp/instmp.
cpsHA27596
Running install with PRE-INSTALL for `screen-3.7.6'
extract: Package name is screen-3.7.6
extract: CWD to /usr/local
extract: /usr/local/bin/screen-3.7.6
extract: execute 'ln -sf screen-3.7.6 /usr/local/bin/screen'
extract: /usr/local/man/man1/screen.1
extract: /usr/local/info/screen.info
extract: execute '[ -f /usr/local/info/dir ] || sed -ne '1,/Menu:/p' /usr/share
/info/dir > /usr/local/info/dir'
extract: execute 'install-info /usr/local/info/screen.info /usr/local/info/dir'
extract: /usr/local/lib/screen/screencap
extract: /usr/local/lib/screen/screenrc
extract: CWD to .
Running mtree for `screen-3.7.6'
mtree -q -U -f +MTREE_DIRS -d -e -p /usr/local
Running install with POST-INSTALL for `screen-3.7.6'

+---------------
| The file /etc/screenrc has been created on your system.
| You may want to verify/edit its contents
|
| The file /usr/local/lib/screen/screencap contains a
| termcap like description of the screen virtual terminal.
| You may use it to update your terminal database.
| See termcap(5).
+---------------

Attempting to record package into `/var/db/pkg/screen
Package `screen-3.7.6' registered in `/var/db/pkg/screen-3.7.6'

   In this example the -v flag was used to give a more verbose output,
   this option is not needed, but is helpful for debugging and was used
   here to give a little more insight into what pkg_add(1) is actually
   doing. Notice however, that there are some valid messages given out
   mentioning /etc/screenrc. Messages like this will be given to you
   whether or not you use the -v flag.
   Installing via ftp
$ sudo pkg_add ftp://ftp.openbsd.org/pub/OpenBSD/2.6/packages/i386/screen-3.7.6
.tgz
>>> ftp -o - ftp://ftp.openbsd.org/pub/OpenBSD/2.6/packages/i386/screen-3.7.6.t
gz

+---------------
| The file /etc/screenrc has been created on your system.
| You may want to verify/edit its contents
|
| The file /usr/local/lib/screen/screencap contains a
| termcap like description of the screen virtual terminal.
| You may use it to update your terminal database.
| See termcap(5).
+---------------

   In this example you can see that I installed the i386 package, you
   should substitute this with your architecture. Notice: Not all
   architectures have the same packages. Some ports don't work on certain
   architectures. In this example the -v flag wasn't used, so only NEEDED
   messages are shown.

  Viewing and Deleting Installed Packages

   The utility [38]pkg_info(1) is used to view a list of packages that
   are already installed on your system. This is usually needed to find
   out the correct name of a package before you remove that package. To
   see what packages are installed on your system simple use:
$ pkg_info
sslUSA26           ssl26.1 USA-only non-commercial crypto libs incl. SSL & RSA
mpg123-0.59q       mpeg audio 1/2 layer 1, 2 and 3 player
nmap-2.3b6         port scanning large networks
ircii-2.8.2-epic3.004enhanced version of ircII (internet relay chat)
screen-3.7.6       multi-screen window manager
unzip-5.40         extract, list & test files in a ZIP archive
xntp3-5.93e-export Network Time Protocol implementation
icb-5.0.9          Internet CB - mostly-defunct chat client

   To delete a package, simple take the proper name of the package as
   shown by pkg_info(1) and use [39]pkg_delete(1) to remove the package.
   In the below example, the screen package is being removed. Notice that
   on some occasions there are instructions of extra objects that need to
   be removed that pkg_delete(1) did not remove for you. As with the
   pkg_add(1) utility, you can use the -v flag to get more verbose
   output.
$ sudo pkg_delete screen-3.7.6

+---------------
| To completely deinstall the screen-3.7.6 package you need to perform
| this step as root:
|
|           rm -f /etc/screenrc
|
| Do not do this if you plan on re-installing screen-3.7.6
| at some future time.
+---------------
d4716 2
a4717 3
   Sure. You need to add "flags 0x20" at the end of the fd* entry and
   recompile your kernel. The line should be read:
  fd*     at fdc? drive ? flags 0x20
d4719 4
a4722 2
   After that you would be able to use the floppy drive all the times. It
   doesn't matter if you plugged it in after boot.
d4726 3
a4728 2
   When booting your OpenBSD system, you have probably noticed the boot
   prompt.
d4730 5
a4734 1
   boot>
d4736 3
a4738 27
   For most people, you won't have to do anything here. It will
   automatically boot if no commands are given. But sometimes problems
   arise, or special functions are needed. That's where these options
   will come in handy. To start off, you should read through the
   [40]boot(8) man page. Here we will go over the most common used
   commands for the bootloader.

   To start off, if no commands are issued, the bootloader will
   automatically try to boot /bsd. If that fails it will try /obsd, and
   so on till it finds a bootable kernel. You can specify this by hand by
   typing:
   boot> boot wd0a:/bsd

   or
   boot> b /bsd

   This will work if device wd0a is configured as your root device.

   Here is a brief list of options you can use with the OpenBSD kernel.
     * -a : This will allow you to specify an alternate root device after
       booting the kernel.
     * -c : This allows you to enter the boot time configuration. Check
       the [41]Boot Time Config section of the faq.
     * -s : This is the option to boot into single user mode.
     * -d : This option is used to dump the kernel into ddb. Keep in mind
       that you must have DDB built into the kernel.
     * -b : Shortcut for RB_HALT.
d4740 1
a4740 1
   These are entered in the format of: boot [ image [-abcds]]
d4742 1
a4742 1
   For further reading you can read [42]boot_i386(8) man page
d4744 15
a4758 1
8.10 - S/Key
d4760 1
a4760 139
   S/Key is a ``one-time password'' scheme. This allows for one-time
   passwords for use on un-secured channels. This can come very handy for
   those who don't have the ability to use ssh or any other encrypted
   channels. OpenBSD's S/Key implementation can use a variety of
   algorithms as the one-way hash. Here is the list of algorithms
   available:
     * [43]md4
     * [44]md5
     * [45]sha1
     * [46]rmd160.

  Setting up S/Key - The first steps

   To start off the file /etc/skeykeys must exist. If this file is not in
   existence, have the super-user create it. This can be done simply by
   doing:
# touch /etc/skeykeys

   Once that file is in existence, you can initialize your S/Key. To do
   this you will have to use [47]skeyinit(1). With skeyinit(1), you will
   first be prompted for your password to the system. This is the same
   password that you used to log into the system. Running skeyinit(1)
   over an insecure channel is completely not recommended, so this should
   be done over a secure channel (such as ssh) or the console. Once you
   have authorized yourself with your system password you will be asked
   for yet another password. This password is the secret password, and is
   NOT your system password. The secret password is not limited to 8
   characters like system passwords, actually it must be at least 10
   characters. A few word phrases are suggested. Here is an example user
   being added.
oshibana:ericj> skeyinit ericj
[Adding ericj]
Reminder - Only use this method if you are directly connected
           or have an encrypted channel.  If you are using telnet
           or rlogin, exit with no password and use skeyinit -s.
Enter secret password:
Again secret password:

ID ericj skey is otp-md5 99 oshi45820
Next login password: HAUL BUS JAKE DING HOT HOG

   One line of particular importance in here is ID ericj skey is otp-md5
   99 oshi45820. This gives a lot of information to the user. Here is a
   breakdown of the sections and their importance.
     * otp-md5 - This shows which one-way was used to create your
       One-Time Password (otp).
     * 99 - This is your sequence number. This is a number from 100 down
       to 1. Once it reaches one, another secret password must be
       created.
     * oshi45820 - This is your key.

   But of more immediate importance is your password. Your password
   consists of 6 small words, combined together this is your password,
   spaces and all.

  Actually using S/Key to login.

   By now your skey has been initialized, and you have your password.
   You're ready to login. Here is an example session using s/key to
   login.
oshibana:ericj> ftp localhost
Connected to localhost.
220 oshibana.shin.ms FTP server (Version 6.4/OpenBSD) ready.
Name (localhost:ericj): ericj
331 Password [ otp-md5 96 oshi45820 ] for ericj required.
Password:
230- OpenBSD 2.5-current (OSHIBANA) #8: Tue Jun 22 19:20:16 EDT 1999
230-
230- Welcome to OpenBSD: The proactively secure Unix-like operating system.
230-
230- Please use the sendbug(1) utility to report bugs in the system.
230- Before reporting a bug, please try to reproduce it with the latest
230- version of the code.  With bug reports, please try to ensure that
230- enough information to reproduce the problem is enclosed, and if a
230- known fix for it exists, include that as well.
230-
230 User ericj logged in.
Remote system type is UNIX.
Using binary mode to transfer files.
ftp> quit
221 Goodbye.

   Some of you might have noticed that my sequence number has changed.
   otp-md5 96 oshi45820. This is because by now I have used s/key to
   login several times. But how do you get your password after you've
   logged in once? Well to do this, you'll need to know what sequence
   number you're using and your key. As you're probably thinking, how can
   you remember which sequence number you're on? Well this is simple, use
   [48]skeyinfo(1), and it will tell you what to use. For example here, I
   need to generate another password for a login that I might have to
   make in the future. (remember I'm doing this from a secure channel).
oshibana:ericj> skeyinfo
95 oshi45820

   From this I can create the password for my next login. To do so, I'll
   use [49]skey(1). I can use exactly that output from above to create my
   password.
oshibana:ericj> skey 95 oshi45820
Reminder - Do not use this program while logged in via telnet or rlogin.
Enter secret password:
NOOK CHUB HOYT SAC DOLE FUME

   I'm sure many of you won't always have a secure connect to create
   these passwords, and creating them over an insecure connection isn't
   feasible, so how can you create multiple passwords at one time? Well
   you can supply skey(1) with a number of how many passwords you want
   created. This can then be printed out and taken with you wherever you
   go.
oshibana:ericj> skey -n 5 95 oshi45820
Reminder - Do not use this program while logged in via telnet or rlogin.
Enter secret password:
91: SHIM SET LEST HANS SMUG BOOT
92: SUE ARTY YAW SEED KURD BAND
93: JOEY SOOT PHI KYLE CURT REEK
94: WIRE BOGY MESS JUDE RUNT ADD
95: NOOK CHUB HOYT SAC DOLE FUME

   Notice here though, that the bottom password should be the first used,
   because we are counting down from 100.

    Using S/Key with telnet(1), ssh(1), and rlogin(1)

   Using S/Key with telnet(1), ssh(1), or rlogin(1) is done in pretty
   much the same fashion as with ftp, only your first password must be
   "s/key". Example:
ericj@@oshibana> telnet localhost
Trying 127.0.0.1...
Connected to localhost.
Escape character is '^]'.

OpenBSD/i386 (oshibana) (ttyp2)

login: ericj
Password:              <------------ "s/key" entered.
otp-md5 98 oshi45821
Response: SCAN OLGA BING PUB REEL COCA
Last login: Thu Oct  7 12:21:48 on ttyp1 from 156.63.248.77
Warning: no Kerberos tickets issued.
OpenBSD 2.5-current (OSHIBANA) #4: Thu Sep  2 23:36:16 EDT 1999
d4762 1
a4762 1
Welcome to OpenBSD: The proactively secure Unix-like operating system.
d4764 148
a4911 26
Please use the sendbug(1) utility to report bugs in the system.
Before reporting a bug, please try to reproduce it with the latest
version of the code.  With bug reports, please try to ensure that
enough information to reproduce the problem is enclosed, and if a
known fix for it exists, include that as well.

You have mail.
ericj@@oshibana>

  Controlling S/Key

   For more control over S/Key there is the /etc/skey.access file. (This
   does not exist by default, so it must be created.) This file can
   restrict S/Key in three primary ways.
     * permit internet - Which will allow certain IPs to connect and use
       s/key.
     * permit user - Which will allow users by login name access to s/key
       use.
     * permit port - Which is really only useful for assigned ports, (ie
       dial-up)

   If I wanted to allow one single user ( ericj ), from a certain IP (
   10.1.1.5 ), I would create a file like so.
# cat /etc/skey.access
permit internet 10.1.1.5
permit user ericj
d4915 21
a4935 22
   This is caused by a hardware bug. OpenBSD uses clock interrupts to
   keep track of the current time, but these interrupts have the lowest
   priority in Apple's architecture. So, under heavy load, (such as disk
   or network activity) clock interrupts will be lost and the Unix clock
   will not advance as it should.

   MacOS gets around the time problem by always reading the hardware
   clock. OpenBSD only reads the hardware clock at boot time and
   thereafter ignores it. You may notice that, at shutdown, the kernel is
   not confident enough to write the Unix time back into the hardware
   clock because this time loss problem is well known.

   The best solution is to run xntpd (found in the ports collection) and
   just deal with the occasional lossage. Sometimes the lossage is so bad
   that even xntpd is afraid to skip the time. In this case, add the -g
   option to ntpd in /etc/rc.securelevel to force tracking.

   Another simpler but less precise solution is to run rdate(8) on a
   regular basis, for example by having a crontab entry for it,
   preferably with the -a option so there is no "jump" in time. Another
   good place to launch rdate(8) is in your /etc/ppp/ppp.linkup file if
   you are not permanently connected and are a PPP user.
d4937 1
a4937 2
   See also:
   [50]http://www.macbsd.com/macbsd/macbsd-docs/faq/faq-3.html#ss3.17
d4941 11
a4951 10
   No. OpenBSD/i386 will not make use of multiple processors, but will
   run using one processor on a multi-processor system board.
   OpenBSD/sparc will not run on a multi-processor sparc system at all.
   No other platforms currently support multi-processor capabilities.

   The reason is quite simple: there are not enough developers who have
   access to MP machines. If you want to donate MP hardware, please refer
   to [51]http://www.openbsd.org/donations.html. Our developers are
   currently asking for i386, sparc, hppa, and other multi-processor
   hardware donations to begin SMP support.
d4955 22
a4976 25
   As of OpenBSD 2.6, you need to use /dev/cuaXX for connections
   initiated from the OpenBSD system, the /dev/ttyXX devices are intended
   only for terminal or dial-in usage. While it was possible to use the
   tty devices in the past, the OpenBSD kernel is no longer compatible
   with this usage.

   From cua(4):

   For hardware terminal ports, dial-out is supported through matching
   device nodes called calling units. For instance, the terminal called
   /dev/tty03 would have a matching calling unit called /dev/cua03. These
   two devices are normally differentiated by creating the calling unit
   device node with a minor number 128 greater than the dial-in device
   node. Whereas the dial-in device (the tty) normally requires a
   hardware signal to indicate to the system that it is active, the
   dial-out device (the cua) does not, and hence can communicate
   unimpeded with a device such as a modem. This means that a process
   like [52]getty(8) will wait on a dial-in device until a connection is
   established. Meanwhile, a dial-out connection can be established on
   the dial-out device (for the very same hardware terminal port) without
   disturbing anything else on the system. The [53]getty(8) process does
   not even notice that anything is happening on the terminal port. If a
   connecting call comes in after the dial-out connection has finished,
   the [54]getty(8) process will deal with it properly, without having
   noticed the intervening dial-out action.
d4980 5
a4984 80
   There is no OpenBSD Netscape binary. However since OpenBSD supports
   binary emulation of many other operating systems we are able to use
   other binaries.
     * For I386 systems, it is best to use the BSDI binary.
     * For SPARC systems, it is best to use the SUN-OS binary.

   Using the [55]Ports System you can install these with no hassle. The
   Navigator Port is located at /usr/ports/www/navigator and the
   Communicator port is located at /usr/ports/www/communicator. Once you
   have the ports tree installed.

   [56][Back to Main Index] [57][To Section 7.0 - Keyboard controls]
   [58][To Section 9.0 - Tips for linux users]
     _________________________________________________________________

   [59][back] [60]www@@openbsd.org
   $OpenBSD: obsd-faq.txt,v 1.26 2001/08/08 21:06:33 jsyn Exp $

References

   1. http://openbsd.org/faq/faq8.html#8.1
   2. http://openbsd.org/faq/faq8.html#8.2
   3. http://openbsd.org/faq/faq8.html#8.3
   4. http://openbsd.org/faq/faq8.html#8.4
   5. http://openbsd.org/faq/faq8.html#8.5
   6. http://openbsd.org/faq/faq8.html#8.6
   7. http://openbsd.org/faq/faq8.html#8.7
   8. http://openbsd.org/faq/faq8.html#8.8
   9. http://openbsd.org/faq/faq8.html#8.9
  10. http://openbsd.org/faq/faq8.html#8.10
  11. http://openbsd.org/faq/faq8.html#8.11
  12. http://openbsd.org/faq/faq8.html#8.12
  13. http://openbsd.org/faq/faq8.html#8.13
  14. http://openbsd.org/faq/faq8.html#8.14
  15. http://openbsd.org/faq/faq10.html#10.11
  16. http://www.openbsd.org/cgi-bin/man.cgi?query=passwd&sektion=1&format=html
  17. http://www.xfree86.org/FAQ/
  18. http://www.cyclic.com/
  19. http://openbsd.org/anoncvs.html
  20. http://openbsd.org/faq/faq8.html#8.6
  21. http://openbsd.org/anoncvs.html
  22. http://openbsd.org/anoncvs.html
  23. http://openbsd.org/faq/faq8.html#8.7
  24. http://openbsd.org/anoncvs.html
  25. http://openbsd.org/faq/faq8.html#8.5
  26. http://openbsd.org/ftp.html
  27. http://openbsd.org/ftp.html
  28. http://openbsd.org/portstat.html
  29. http://www.openbsd.org/cgi-bin/man.cgi?query=ports&sektion=7&format=html
  30. http://openbsd.org/ports.html
  31. http://www.openbsd.org/cgi-bin/man.cgi?query=pkg_add
  32. http://www.openbsd.org/cgi-bin/man.cgi?query=pkg_create
  33. http://www.openbsd.org/cgi-bin/man.cgi?query=pkg_delete
  34. http://www.openbsd.org/cgi-bin/man.cgi?query=pkg_info
  35. http://openbsd.org/orders.html
  36. http://openbsd.org/ftp.html
  37. http://www.openbsd.org/cgi-bin/man.cgi?query=pkg_add
  38. http://www.openbsd.org/cgi-bin/man.cgi?query=pkg_info
  39. http://www.openbsd.org/cgi-bin/man.cgi?query=pkg_delete
  40. http://www.openbsd.org/cgi-bin/man.cgi?query=boot&sektion=8&format=html
  41. http://openbsd.org/faq/faq5.html#5.4
  42. http://www.OpenBSD.org/cgi-bin/man.cgi?query=boot_i386&sektion=8&format=html
  43. http://www.openbsd.org/cgi-bin/man.cgi?query=md4&sektion=3&format=html
  44. http://www.openbsd.org/cgi-bin/man.cgi?query=md5&sektion=3&format=html
  45. http://www.openbsd.org/cgi-bin/man.cgi?query=sha1&sektion=3&format=html
  46. http://www.openbsd.org/cgi-bin/man.cgi?query=rmd160&sektion=3&format=html
  47. http://www.openbsd.org/cgi-bin/man.cgi?query=skeyinit&sektion=1&format=html
  48. http://www.openbsd.org/cgi-bin/man.cgi?query=skeyinfo&sektion=1&format=html
  49. http://www.openbsd.org/cgi-bin/man.cgi?query=skey&sektion=1&format=html
  50. http://www.macbsd.com/macbsd/macbsd-docs/faq/faq-3.html#ss3.17
  51. http://openbsd.org/donations.html
  52. http://www.openbsd.org/cgi-bin/man.cgi?query=getty&sektion=8&format=html
  53. http://www.openbsd.org/cgi-bin/man.cgi?query=getty&sektion=8&format=html
  54. http://www.openbsd.org/cgi-bin/man.cgi?query=getty&sektion=8&format=html
  55. http://openbsd.org/ports.html
  56. http://openbsd.org/faq/index.html
  57. http://openbsd.org/faq/faq7.html
  58. http://openbsd.org/faq/faq9.html
  59. http://openbsd.org/faq/index.html
  60. mailto:www@@openbsd.org
d4986 100
d5087 1
a5087 1
   [OpenBSD]
d5090 14
a5103 1
     _________________________________________________________________
a5104 7
   Table of Contents
     * [1]9.1 - Tips for Linux (and other free Unix-like OS) users
     * [2]9.2 - Dual boot of Linux and OpenBSD
     * [3]9.3 - Converting your linux (or other System-7 style) password
       file to BSD-style.
     * [4]9.4 - Getting OpenBSD and Linux to interact
     _________________________________________________________________
d5108 54
a5161 55
   There are several differences between OpenBSD and Linux. These
   differences include but are not limited to, bootup procedure, network
   interface usage and disk management. Most differences are well
   documented, but involve searching manpages. This document tries to be
   an index of those differences.

     * OpenBSD has a ports tree. This is to accommodate the fact that at
       this point not many applications are native to the OpenBSD
       environment. This is both an attempt to get applications to work
       on OpenBSD for end-users and to get more applications made with
       OpenBSD in mind. Eventually this ports tree will be used to make a
       nice set of binary packages.
     * OpenBSD uses CVS for source changes. With Linux, source code is
       disseminated through separate distributions. OpenBSD has pioneered
       anonymous CVS, which allows anyone to extract the full source tree
       for any version of OpenBSD (from 2.0 to current, and all revisions
       of all files in between) at any time! There is also a very
       convenient and easy to use [5]web interface to CVS.
     * OpenBSD periodically releases snapshots for various architectures
       and makes a stable, official CD release every 6 months.
     * OpenBSD contains STRONG CRYPTO, which USA based OS's can't
       contain. (See [6]http://www.openbsd.org/crypto.html) OpenBSD has
       also gone through heavy security auditing and many security
       features have already been implemented into the source tree.
       (IPSEC, KERBEROS).
     * OpenBSD's kernel is /bsd.
     * The names of hard disks are usually /dev/wd and /dev/sd (ATA/SCSI)
     * /sbin/ifconfig with no arguments in Linux gives the state of all
       the interfaces. Under OpenBSD you need the -a flag.
     * /sbin/route with no arguments in Linux gives the state of all the
       active routes. Under OpenBSD you need the "show" parameter, or do
       a netstat -r (nice).
     * OpenBSD comes with Darren Reed's IP Filter package, not ipfw. This
       means that:
          + IP-Masquerading is done through ipnat. ([7]ipnat(1))
          + ipfwadm is done through ipf ([8]ipf(1), [9]ipf(5))
          + You should look at [10]section 6 for detailed configuration
            assistance and information.
     * Interface address is stored in /etc/hostname.<interfacename>. It
       can be a name instead of an IP address.
     * The machine name is in /etc/myname
     * The default gateway is in /etc/mygate
     * The network interface aliases are in /etc/ifaliases
     * OpenBSD's default shell is /bin/sh, which is the Korn shell.
       Shells such as bash and tcsh can be added as packages or installed
       from the ports tree.
     * Password management changes a lot. The main files are different.
       ([11]passwd(1), [12]passwd(5))
     * Devices are named by driver, not by type. So for example, there
       are no eth* devices. It would be ne0 for an ne2000 ethernet card,
       and xl0 for a 3Com Etherlink XL and Fast Etherlink XL ethernet
       device, etc.
     * OpenBSD developers have made serious efforts to keep the manual
       pages up-to-date and accurate. Use the [13]man(1) command to find
       information.
d5165 1
a5165 1
   Yes! it is possible!
d5167 1
a5167 1
   Read [14]INSTALL.linux
d5172 27
a5198 29
   First, figure out if your Linux password file is shadowed or not. If
   it is, grab [15]John the Ripper and use the unshadow utility that
   comes with it to merge your passwd and shadow files into one System
   7-style file.

   Using your Linux password file, we'll call it linux_passwd, you need
   to add in ::0:0 between fields four and seven. Awk does this for you.
# cat linux_passwd | awk -F : '{printf("%s:%s:%s:%s::0:0:%s:%s:%s\n",$1,$2,$3,$
4,$5,$6,$7); }' > new_passwd

   At this point, you want to edit the new_passwd file and remove the
   root and other system entries that are already present in your OpenBSD
   password file or aren't applicable with OpenBSD (all of them). Also,
   make sure there are no duplicate usernames or user IDs between
   new_passwd and your OpenBSD box's /etc/passwd. The easiest way to do
   this is to start with a fresh /etc/passwd.
# cat new_passwd >> /etc/master.passwd
# pwd_mkdb -p /etc/master.passwd

   The last step, pwd_mkdb is necessary to rebuild the /etc/spwd.db and
   /etc/pwd.db files. It also creates a System 7-style password file
   (minus encrypted passwords) at /etc/passwd for programs which use it.
   OpenBSD uses a stronger encryption for passwords, blowfish, which is
   very unlikely to be found on any system which uses full System 7-style
   password files. To switch over to this stronger encryption, simply
   have the users run 'passwd' and change their password. The new
   password they enter will be encrypted with your default setting
   (usually blowfish unless you've edited /etc/passwd.conf). Or, as root,
   you can run passwd username.
d5202 22
a5223 49
   If you are migrating from Linux to OpenBSD, note that OpenBSD has
   COMPAT_LINUX enabled by default in the GENERIC kernel. To run any
   Linux binaries that are not statically linked (most of them), you need
   to follow the instructions on the [16]compat_linux(8) manual page. A
   simple way to get most of the useful Linux libraries is to install
   linux_lib from your ports collection. To find out more about the Ports
   collection read [17]FAQ 8.6. If you already have the ports tree
   installed use these commands to get linux libraries installed.
# cd /usr/ports/emulators/linux_lib
# make install

   OpenBSD supports the EXT2FS file system. Use disklabel disk (where
   disk is the device name for your disk. ) to see what OpenBSD thinks
   your Linux partition is (but don't use disklabel or fdisk to make any
   changes to it). For further information on using disklabel read
   [18]FAQ 14.1.

   [19][Back to Main Index] [20][To Section 8.0 - General Questions]
   [21][To Section 10.0 - System Administration]
     _________________________________________________________________

   [22][back] [23]www@@openbsd.org
   $OpenBSD: obsd-faq.txt,v 1.26 2001/08/08 21:06:33 jsyn Exp $

References

   1. http://openbsd.org/faq/faq9.html#9.1
   2. http://openbsd.org/faq/faq9.html#9.2
   3. http://openbsd.org/faq/faq9.html#9.3
   4. http://openbsd.org/faq/faq9.html#9.4
   5. http://www.openbsd.org/cgi-bin/cvsweb/
   6. http://openbsd.org/crypto.html
   7. http://www.openbsd.org/cgi-bin/man.cgi?query=ipnat&apropos=0&sektion=1&format=html
   8. http://www.openbsd.org/cgi-bin/man.cgi?query=ipf&apropos=0&sektion=1&format=html
   9. http://www.openbsd.org/cgi-bin/man.cgi?query=ipnat&apropos=0&sektion=5&format=html
  10. http://openbsd.org/faq/faq6.html
  11. http://www.openbsd.org/cgi-bin/man.cgi?query=passwd&apropos=0&sektion=1&format=html
  12. http://www.openbsd.org/cgi-bin/man.cgi?query=passwd&apropos=0&sektion=5&format=html
  13. http://www.openbsd.org/cgi-bin/man.cgi?query=man
  14. http://openbsd.org/faq/INSTALL.linux
  15. http://www.openwall.com/john/
  16. http://www.openbsd.org/cgi-bin/man.cgi?query=compat_linux&sektion=8&format=html
  17. http://openbsd.org/faq/faq8.html#8.6
  18. http://openbsd.org/faq/faq14.html#14.1
  19. http://openbsd.org/faq/index.html
  20. http://openbsd.org/faq/faq8.html
  21. http://openbsd.org/faq/faq10.html
  22. http://openbsd.org/faq/index.html
  23. mailto:www@@openbsd.org
d5225 1
a5225 2

   [OpenBSD]
d5228 1
a5228 1
     _________________________________________________________________
d5230 19
a5248 20
   Table of Contents
     * [1]10.1 - When I try to su to root it says that I'm in the wrong
       group
     * [2]10.2 - How do I duplicate a filesystem?
     * [3]10.3 - How do I start daemons with the system? ( Overview of
       rc(8) )
     * [4]10.4 - Why do users get relaying access denied when they are
       remotely sending mail through my OpenBSD system?
     * [5]10.5 - I've set up POP, but I get errors when accessing my mail
       through POP. What can i do?
     * [6]10.6 - Setting up a Secure HTTP Server using SSL(8)
     * [7]10.7 - I made changes to /etc/passwd with vi(1), but the
       changes didn't seem to take place. Why?
     * [8]10.8 - How do I add a user? or delete a user?
     * [9]10.9 - How do I create a ftp-only account?
     * [10]10.10 - Setting up user disk quotas
     * [11]10.11 - Setting up Kerberos Client/Server
     * [12]10.12 - Setting up an Anonymous FTP Server
     * [13]10.13 - Confining users to their home dir's in ftpd(8).
     _________________________________________________________________
d5250 1
a5250 1
10.1 - Why does it say that I'm in the wrong group when I try to su root?
a5251 15
   Existing users must be added to the "wheel" group by hand. This is
   done for security reasons, and you should be cautious with whom you
   give access to. On OpenBSD, users who are in the wheel group are
   allowed to use the [14]su(1) userland program to become root. Users
   who are not in "wheel" cannot use su(1). Here is an example of a
   /etc/group entry to place the user ericj into the "wheel" group.

   If you are adding a new user with [15]adduser(8), you can put them in
   the wheel group by answering wheel at Invite user into other groups:
   This will add them to /etc/group, which will look something like this:
wheel:*:0:root,ericj

   If you are looking for a way to allow users limited access to
   superuser privileges, without putting them in the "wheel" group, use
   [16]sudo(8).
d5253 1
a5253 1
10.2 - How do I duplicate a filesystem?
d5255 10
a5264 10
   To duplicate your filesystem use [17]dump(8) and [18]restore(8). For
   example. To duplicate everything under directory SRC to directory DST,
   do a:
# cd /SRC; dump 0f - . | (cd /DST; restore -rf - )

   dump is designed to give you plenty of backup capabilities, and it may
   be an overkill if you just want to duplicate a part of a (or an
   entire) filesystem. The command [19]tar(1) may be faster for this
   operation. The format looks very similar:
# cd /SRC; tar cf -  . | (cd /DST; tar xpf - )
d5266 1
a5266 1
10.3 - How do I start daemons with the system? ( Overview of rc(8) )
d5268 2
a5269 77
   OpenBSD uses an [20]rc(8) style startup. This uses a few key files for
   startup.
     * /etc/rc - Main script. Should not be edited.
     * /etc/rc.conf - Configuration file used by /etc/rc to know what
       daemons should start with the system.
     * /etc/netstart - Script used to initialize the network. Shouldn't
       be edited.
     * /etc/rc.local - Script used for local administration. This is
       where new daemons or host specific information should be stored.
     * /etc/rc.securelevel - Script which runs commands that must be run
       before the security level changes. See [21]init(8)
     * /etc/rc.shutdown - Script run on shutdown. Put anything you want
       done before shutdown in this file. See [22]rc.shutdown(8)

  How does rc(8) work?

   The main files a system administrator should concentrate on are
   /etc/rc.conf, /etc/rc.local and /etc/rc.shutdown. To get a look of how
   the rc(8) procedure works, here is a the flow:
   After the kernel is booted. /etc/rc is started.
     * Filesystems checked. This will always be bypassed if the file
       /etc/fastboot exists. This is certainly not a good idea though.
     * Configuration Variables are read in from /etc/rc.conf
     * Filesystems are mounted
     * Clears out /tmp and preserves any editor files
     * Configures the network via /etc/netstart
          + Configures your interfaces up.
          + Sets your hostname, domainname, etc.
     * Starts system daemons
     * Does various checks. (quota's, savecore, etc)
     * Local daemons are run, ala /etc/rc.local

  Starting Daemons and Services that come with OpenBSD

   Most daemons and services that come with OpenBSD by default can be
   started on boot by simply editing the /etc/rc.conf configuration file.
   To start out take a look at the default [23]/etc/rc.conf file. You'll
   see lines similar to this:
ftpd_flags=NO           # for non-inetd use: ftpd_flags="-D"

   A line like this shows that ftpd is not starting up with the system. (
   At least not via rc(8), read the [24]Anonymous FTP FAQ to read more
   about this. ) In any case, each line also has a comment showing you
   the flags for NORMAL usage of that daemon or service. This doesn't
   mean that you must run that daemon or service with those flags. You
   can always use man(1) to see how you can have that daemon or service
   start up in any way you like. For example, Here is the default line
   pertaining to httpd(8).
httpd_flags=NO          # for normal use: "" (or "-DSSL" after reading ssl(8))

   Here you can obviously see that starting up httpd normally no flags
   are necessary. So a line like: " httpd_flags=""" would be necessary.
   But to start httpd with ssl enabled. (Refer to the [25]SSL FAQ or
   [26]ssl(8)) You should start with a line like: "httpd_flags="-DSSL"".

  Starting up local daemons and configuration

   For other daemons that you might install with the system via ports or
   other ways, you will use the /etc/rc.local file. For example, I've
   installed a daemon which lies at /usr/local/sbin/daemonx. I want
   this to start at boot time. I would put an entry into /etc/rc.local
   like this:
if [ -x /usr/local/sbin/daemonx ]; then
             echo -n ' daemonx';       /usr/local/sbin/daemonx
fi

   From now on, this daemon will be run at boot. You will be able to see
   any errors on boot, a normal boot with no errors would show a line
   like this:
Starting local daemons: daemonx.

  rc.shutdown

   /etc/rc.shutdown is a script that is run a shutdown. Anything you want
   done before the system shuts down should be added to this file. If you
   have apm, you can also set "powerdown=YES". Which will give you the
   equivalent of "shutdown -p".
d5271 1
a5271 2
10.4 - Why do users get relaying access denied when they are remotely sending
mail through my OpenBSD system?
d5273 2
a5274 2
   Try this:
# cat /etc/sendmail.cf | grep relay-domains
d5276 1
a5276 2
   The output may look something like this:
FR-o /etc/mail/relay-domains
d5278 4
a5281 16
   If this file doesn't exist, create it. You will need to enter the
   hosts who are sending mail remotely with the following syntax:
.domain.com    #Allow relaying for/to any host in domain.com
sub.domain.com #Allow relaying for/to sub.domain.com and any host in that domai
n
10.2           #Allow relaying from all hosts in the IP net 10.2.*.*

   Don't forget send a 'HangUP' signal to sendmail, (a signal which
   causes most daemons to re-read their configuration file):
# kill -HUP `cat /var/run/sendmail.pid`

  Further Reading

     * [27]http://www.sendmail.org/~ca/email/relayingdenied.html
     * [28]http://www.sendmail.org/tips/relaying.html
     * [29]http://www.sendmail.org/antispam.html
d5283 1
a5283 2
10.5 - I've set up POP, but users have trouble accessing mail through POP. What
can I do?
a5284 25
   Most issues dealing with POP are problems with temporary files and
   lock files. If your pop server sends an error message such as:
-ERR Couldn't open temporary file, do you own it?

   Try setting up your permissions as such:
permission in  /var
drwxrwxr-x   2 bin     mail     512 May 26 20:08 mail


permissions in  /var/mail
-rw-------   1 username   username        0 May 26 20:08 username

   Another thing to check is that the user actually owns their own
   /var/mail file. Of course this should be the case (as in,
   /var/mail/joe should be owned by joe) but if it isn't set correctly it
   could be the problem!

   Of course, making /var/mail writeable by group mail opens up some
   vague and obscure security problems. It is likely that you will never
   have problems with it. But it could (especially if you are a high
   profile site, ISP,...)! Try running cucipop or another POP daemon from
   the OpenBSD ports collection. Or, you could just have the wrong
   options selected for your pop daemon (like dot locking). Or, you may
   just need to change the directory that it locks in (although then the
   locking would only be valuable for the POP daemon.)
d5286 1
a5286 1
10.6 - Setting up a Secure HTTP server with SSL(8)
d5288 1
a5288 26
   Starting with OpenBSD 2.6, OpenBSD ships with an SSL-ready httpd.
   However, because of various patents, some libraries cannot be shipped.
   So, to be able to use RSA certificates you must install extra
   libraries onto your system. There are two sets of these libraries,
   depending on your location in the world. (NOTE: Those who did an FTP
   install, or any network install most likely have already installed
   this onto your system). For people living outside of the United
   States, you should use a package called "ssl26.tgz", Those living in
   the United States must use "sslUSA26.tgz". These are packages,
   therefore installed using the [30]pkg_add(1) utility. For example, To
   install the NON-U.S. Resident version of the libraries use the
   following line where ${arch} is your architecture. (NOTE:: This is not
   available for the Alpha architecture due to its lack of shared libs.)

# pkg_add ftp://ftp.openbsd.org/pub/OpenBSD/2.6/packages/${arch}/ssl26.tgz

   For use with [31]httpd(8), you must first have a certificate created.
   This will be kept in /etc/ssl/private/. The steps shown here are taken
   in part from the [32]ssl(8) man page. Refer to it for further
   information. This FAQ entry only outlines how to create an RSA
   certificate for web servers, not a DSA server certificate. To find out
   how to do so, please refer to the [33]ssl(8) man page.

   To start off, you need to create your server key and certificate. To
   use the RSA features, you must have upgraded your libssl. Now you can
   create your key. Using OpenSSL:
d5290 75
a5364 1
# openssl genrsa -out /etc/ssl/private/server.key 1024
d5366 2
a5367 2
   Or, if you wish the key to be encrypted with a passphrase that you
   will have to type in when starting servers
d5369 1
a5369 1
# openssl genrsa -des3 -out /etc/ssl/private/server.key 1024
d5371 1
a5371 11
   The next step is to generate a Certificate Signing Request which is
   used to get a Certifying Authority (CA) to sign your certificate. To
   do this use the command:

# openssl req -new -key /etc/ssl/private/server.key -out /etc/ssl/private/serve
r.csr

   This server.csr file can then be given to Certifying Authority who
   will sign the key. One such CA is Thawte Certification which you can
   reach at [34]http://www.thawte.com/. Thawte can currently sign RSA
   keys for you. A procedure is being worked out to allow for DSA keys.
d5373 1
a5373 2
   If you cannot afford this, or just want to sign the certificate
   yourself, you can use the following.
d5375 1
a5375 2
# openssl x509 -req -days 365 -in /etc/ssl/private/server.csr \
       -signkey /etc/ssl/private/server.key -out /etc/ssl/server.crt
d5377 2
a5378 2
   With /etc/ssl/server.crt and /etc/ssl/private/server.key in place, you
   should be able to start [35]httpd(8) with the -DSSL
d5380 3
a5382 1
10.7 - I edited /etc/passwd, but the changes didn't seem to take place. Why?
d5384 2
a5385 26
   If you edit /etc/passwd, your changes will be lost. OpenBSD generates
   /etc/passwd dynamically with [36]pwd_mkdb(8). The main password file
   in OpenBSD is /etc/master.passwd. According to pwd_mkdb(8),
FILES
     /etc/master.passwd  current password file
     /etc/passwd         a Version 7 format password file
     /etc/pwd.db         insecure password database file
     /etc/pwd.db.tmp     temporary file
     /etc/spwd.db        secure password database file
     /etc/spwd.db.tmp    temporary file

   In a traditional Unix password file, such as /etc/passwd, everything
   including the user's encrypted password is available to anyone on the
   system (and is a prime target for programs such as Crack.) 4.4BSD
   introduces the master.passwd file, which has an extended format (with
   additional options beyond what was provided by /etc/passwd) and is
   only readable by root. For faster access to data, the library calls
   which access this data normally read /etc/pwd.db and /etc/spwd.db.

   OpenBSD does come with a tool with which you should edit your password
   file. It is called vipw(8). Vipw will use vi (or your favourite editor
   defined per $EDITOR) to edit /etc/master.passwd. After you are done
   editing, it will re-create /etc/passwd, /etc/pwd.db, and /etc/spwd.db
   as per your changes. Vipw also takes care of locking these files, so
   that if anyone else attempts to change them at the same time, they
   will be denied access.
d5387 1
a5387 1
10.8 - What is the best way to add and delete users?
d5389 1
a5389 14
   The best way to add a user in OpenBSD is to use the [37]adduser(8)
   script. You can configure this to work however you like by editing
   /etc/adduser.conf. You can add users by hand, but this is the
   recommended way to add users. adduser(8) allows for consistency checks
   on /etc/passwd, /etc/group, and shell databases. It will create the
   entries and HOME directories for you. It can even send a message to
   the user welcoming them. This can be changed to meet your needs. For
   further instructions on adding users read the [38]adduser_proc(8) man
   page.

   To delete users you should use the [39]rmuser(8) utility. This will
   remove all existence of a user. It will remove any crontab(1) entries,
   their HOME dir (if it is owned by the user), and their mail. Of course
   it will also remove their /etc/passwd and /etc/group entries.
d5391 3
a5393 1
10.9 - How do I create an ftp-only account (not anonymous FTP!)?
d5395 2
a5396 9
   There are a few ways to do this, but a very common way to do such is
   to add /bin/false into /etc/shells. Then when you create the user set
   his shell to /bin/false, they will not be able log in interactively,
   but will be able to use ftp capabilities. adduser(8) will give them a
   home dir by default of /home/. If this is what you desire it doesn't
   need to be changed, however you can set this to whatever directory you
   wish. You can force this user to only be able to see files in their
   home directory by adding their username to /etc/ftpchroot. Using the
   -A option to ftpd, you can allow only ftpchroot logins!
d5398 2
a5399 1
10.10 - Setting up Quotas
d5401 1
a5401 29
   Quotas are used to limit users space that they have available to them
   on your drives. It can be very helpful in situations where you have
   limited resources. Quotas can be set in two different ways.

     * User Quotas
     * Group Quotas

   The first step to setting up quotas is to make sure that option QUOTA
   is in your Kernel Configuration. This option is in the GENERIC kernel.
   After this you need to mark in /etc/fstab the filesystems which will
   have quotas enabled. The keywords userquota and groupquota should be
   used to mark each fs that you will be using quotas on. By default the
   files quota.user and quota.group will be created at the root of that
   filesystem to hold the quota information. This default can be
   overwritten by doing, userquota=/var/quotas/quota.user. Or whatever
   file you want to use for holding quota information. Here is an example
   /etc/fstab that has one filesystem with userquotas enabled.
/dev/wd0a / ffs rw,userquota=/var/quotas/quota.user 1 1

   Now it's time to set the user's quotas. To do so you use the utility
   [40]edquota(8). A simple use is just edquota <user>. edquota(8) will
   use vi(1) to edit the quotas unless the environmental variable EDITOR
   is set to a different editor. For example:
   # edquota ericj

   This will give you output similar to this:
Quotas for user ericj:
/: blocks in use: 62, limits (soft = 0, hard = 0)
        inodes in use: 25, limits (soft = 0, hard = 0)
d5403 1
a5403 4
   To add limits, edit it to give results like this:
Quotas for user ericj:
/: blocks in use: 62, limits (soft = 1000, hard = 1050)
        inodes in use: 25, limits (soft = 0, hard = 0)
d5405 18
a5422 27
   In this the softlimit is set to 1000 blocks and the hardlimit is set
   to 1050 blocks. A softlimit is a limit where the user is just warned
   when they cross it and have until their grace period is up to get
   their disk usage below their limit. Grace periods can be set by using
   the -t option on edquota(8). After the grace period is over the
   softlimit is handled as a hardlimit. This usually results in an
   allocation failure.

   Now that the quotas are set, you need to turn the quotas on. To do
   this use [41]quotaon(8). For example:
# quotaon -a

   This will go through /etc/fstab to turn on the filesystems with quota
   options. Now that quotas are up and running, you can view them by the
   [42]quota(1). Using a command of quota <user> will give that users
   information. When called with no arguments the quota command will give
   your quota statistics. For example:
# quota ericj

   Will result in output similar to this:
Disk quotas for user ericj (uid 1001):
     Filesystem  blocks   quota   limit   grace   files   quota   limit   grace
              /      62    1000    1050              27       0       0

   By default quotas set in /etc/fstab will be started on boot. To turn
   them off use
# quotaoff -a
d5424 2
a5425 1
10.11 - How to Setup Kerberos Clients and Servers under OpenBSD
d5427 1
a5427 180
   As a user/administrator of OpenBSD systems, you are fortunate that
   KerberosIV is an pre-installed component of the default system. Here
   is a guide to setting up both the Kerberos realm server, as well as a
   client.

   An *EXTREMELY* important point to remember is that Kerberos clients
   and servers must have their system clocks synchronized. If there is
   more than a 5 minute time skew, you will receive weird errors that do
   not immediately reveal themselves to be caused by time skew, such as:
kinit: Can't send request (send_to_kdc)

   Another more accurate error is:
kauth: Time is out of bounds (krb_rd_req)

   An easy way to synchronize system clocks is with xntpd, available in
   the ports tree at /usr/ports/sysutils/xntpd/.
   This FAQ entry assumes you have prior knowledge of the Kerberos
   concepts. For a great, easy to understand, reference, see:
     * [43]The FreeBSD handbook
     * Use the command info kth-krb
     * [44]Designing an Authentication System: a Dialogue in Four Scenes
     * [45]Papers and Documentation Describing KerberosIV

   Or the book
     * [46]Network Security Private Communication in a Public World
       [Kaufman, Perlman, Speciner, 1995]

  How to setup the Kerberos IV REALM and SERVER

   We will be setting up the CIARASYSTEMS.COM realm, with
   avalanche.ciarasystems.com as the main server.

   To start off, we will need to edit our configuration files. These
   files are located at /etc/kerberosIV/. The two files we are concerned
   about are krb.realms and krb.conf. Let's start off with krb.conf.
[root@@avalanche kerberosIV] cat krb.conf
CIARASYSTEMS.COM
CIARASYSTEMS.COM avalanche.ciarasystems.com admin server

   As you can see, this tells kerberos that the domain is
   CIARASYSTEMS.COM (or logical realm) and that within that domain,
   avalanche is the administration server. Next we will look at
   krb.realms. For more information on this refer to [47]krb.conf.
[root@@avalanche kerberosIV] cat krb.realms
avalanche.ciarasystems.com      CIARASYSTEMS.COM
.ciarasystems.com               CIARASYSTEMS.COM

   krb.realms provides a translation from a hostname to the Kerberos
   realm name for the services provided by that host. Each line of the
   translation file is in one of the following forms (domain_name should
   be of the form .XXX.YYY). So in this example, avalanche is the
   hostname of a computer on the CIARASYSTEMS.COM realm. And
   .ciarasystems.com is the domain name on the realm CIARASYSTEMS.COM.
   Again, for further information read the [48]krb.realms. man page.

   Next we will run [49]kdb_init(8) to create the initial Kerberos
   database.
[root@@avalanche kerberosIV] kdb_init
Realm name [default  NO.DEFAULT.REALM ]: CIARASYSTEMS.COM
You will be prompted for the database Master Password.
It is important that you NOT FORGET this password.

Enter Kerberos master password: not shown
Verifying password -
Enter Kerberos master password:

   Next we need to use [50]kstash(8) which is used to save the Kerberos
   key distribution center (KDC) database master key in the master key
   cache file.
[root@@avalanche kerberosIV] kstash
Enter Kerberos master password:

Current Kerberos master key version is 1.

Master key entered.  BEWARE!
Wrote master key to /etc/kerberosIV/master_key
       This saves the encrypted master password in
       /etc/kerberosIV/master_key.
       Next, we need two principals to be added to the database for each
       system that will be secured with Kerberos. Their names are kpasswd
       and rcmd. These two principals are made for each system, with the
       instance being the name of the individual system. These daemons,
       kpasswd and rcmd allow other systems to change Kerberospasswords
       and run commands like rcp, rlogin and rsh.
# kdb_edit
Opening database...

Enter Kerberos master key:

Current Kerberos master key version is 1.

Master key entered.  BEWARE!

Previous or default values are in [brackets] ,
enter return to leave the same, or new value.

Principal name: passwd
Instance: avalanche

<Not found>, Create [y] ? y

Principal: passwd, Instance: avalanche, kdc_key_ver: 1
New Password:                <----- Use 'RANDOM' as password
Verifying password -
New Password:

Random password [y] ? y

Principal's new key version = 1
Expiration date (enter yyyy-mm-dd) [ 1999-12-31 ] ? 2001-12-31
Max ticket lifetime (*5 minutes) [ 255 ] ?
Attributes [ 0 ] ?
Edit O.K.


Principal name: rcmd
Instance: avalanche

, Create [y] ? y
Principal: rcmd, Instance: avalanche, kdc_key_ver: 1
New Password:                 <----- Use 'RANDOM' as password
Verifying password -
New Password:

Random password [y] ? y

Principal's new key version = 1
Expiration date (enter yyyy-mm-dd) [ 1999-12-31 ] ? 2001-12-31
Max ticket lifetime (*5 minutes) [ 255 ] ?
Attributes [ 0 ] ?
Edit O.K.
Principal name:               <----- Hit <ENTER> to end

   A srvtab file is the service key file. These must be extracted from
   the Kerberos key distribution center database in order for services to
   authenticate using Kerberos. For each hostname specified on the
   command line, [51]ext_srvtab(8) creates the service key file
   hostname-new-srvtab, containing all the entries in the database with
   an instance field of hostname.
[root@@avalanche kerberosIV] ext_srvtab avalanche

Enter Kerberos master password:

Current Kerberos master key version is 1.

Master key entered.  BEWARE!
Generating 'avalanche-new-srvtab'....

[root@@avalanche kerberosIV] mv avalanche-new-srvtab srvtab
[root@@avalanche kerberosIV] chmod 600 srvtab

   Now we can add users to our database.
[root@@avalanche kerberosIV] kdb_edit
Opening database...

Enter Kerberos master key:

Current Kerberos master key version is 1.

Master key entered.  BEWARE!
Previous or default values are in [brackets] ,
enter return to leave the same, or new value.

Principal name: jeremie
Instance:

, Create [y] ? y

Principal: jeremie, Instance: , kdc_key_ver: 1
New Password:                <---- enter a secure password here
Verifying password

New Password:                <---- re-enter the password here
Principal's new key version = 1
Expiration date (enter yyyy-mm-dd) [ 2000-01-01 ] ?
Max ticket lifetime (*5 minutes) [ 255 ] ?
Attributes [ 0 ] ?
Edit O.K.
Principal name:          <---- null entry here will cause an exit
                               or you can add more entries.
d5429 1
a5429 68
   So now all the Kerberos particulars are setup. All that is left is to
   enable boot-time loading of the Kerberos server and to enable
   Kerberized-daemons.

   In /etc/rc.conf, set:
   kerberos_server=YES

   In /etc/inetd.conf, uncomment:
telnet       stream  tcp     nowait  root    /usr/libexec/telnetd    telnetd -k
klogin       stream  tcp     nowait  root    /usr/libexec/rlogind    rlogind -k
kshell       stream  tcp     nowait  root    /usr/libexec/rshd       rshd -k
kauth        stream  tcp     nowait  root    /usr/libexec/kauthd     kauthd

   Then, either reboot, or:
[root@@avalanche /] kill -HUP `cat /var/run/inetd.pid`
[root@@avalanche /] /usr/libexec/kerberos >> /var/log/kerberos.log &
[root@@avalanche /] /usr/libexec/kadmind -n >> /var/log/kadmind.log &

   Note: this is a rather simple server setup. Usually, redundant servers
   are setup (as slave servers) so that if one server goes down, all the
   services that depend on Kerberos don't go down. We can also add 'su'
   privileges to a specific principal, see [52]the FreeBSD Handbook.

  How to kerberize your client workstation

   We will be setting the workstation named gatekeeper to be in the
   CIARASYSTEMS.COM realm, with avalanche.ciarasystems.com as the main
   server.

   To start off, we need to setup our krb.conf and krb.realms like the
   above machine. This is so gatekeeper will know what server is the KDC
   and what domain it is on. Again here are the file contents.
[root@@gatekeeper kerberosIV] cat krb.conf
CIARASYSTEMS.COM
CIARASYSTEMS.COM avalanche.ciarasystems.com admin server

[root@@gatekeeper kerberosIV] cat krb.realms
avalanche.ciarasystems.com      CIARASYSTEMS.COM
.ciarasystems.com               CIARASYSTEMS.COM

   Now that is set up, we need to initialize kerberos. To obtain a ticket
   you use [53]kinit(1).
xyz:jeremie% kinit
The OpenBSD Project (gatekeeper)
Kerberos Initialization
Kerberos name: jeremie
Password:

   Now we have identified we can list our tickets with [54]klist(1).
xyz:jeremie$ klist
Ticket file:    /tmp/tkt1000
Principal:      jeremie@@CIARASYSTEMS.COM

  Issued           Expires          Principal
Jun 28 01:03:25  Jun 28 11:03:25  krbtgt.CIARASYSTEMS.COM@@CIARASYSTEMS.COM

   Looks like we are set now. All that's left to do is test it. Here we
   will test it with rlogin(1) and telnet(1).
xyz:jeremie% telnet avalanche
Trying 192.168.0.38...
Connected to avalanche.
Escape character is '^]'.
[ Trying mutual KERBEROS4 ... ]
[ Kerberos V4 accepts you ]
[ Kerberos V4 challenge successful ]
Last login: Sun Jun 27 22:52:25 on ttyp1 from gatekeeper
Warning: no Kerberos tickets issued.
OpenBSD 2.5 (AVALANCHE) #5: Tue Apr  6 01:18:16 EDT 1999
d5431 1
a5431 5
   and
xyz:jeremie% rlogin avalanche
Last login: Sun Jun 27 22:53:39 on ttyp1 from gatekeeper
Warning: no Kerberos tickets issued.
OpenBSD 2.5 (AVALANCHE) #5: Tue Apr  6 01:18:16 EDT 1999
d5433 13
a5445 16
   We can tell that it is indeed using Kerberos to authenticate the
   rlogin session. To get rid of any tickets issued, you would use
   [55]kdestroy(1). For example:
xyz:jeremie% kdestroy
Tickets destroyed.
xyz:jeremie% rlogin avalanche
krcmd: No ticket file (tf_util)
rlogin: warning, using standard rlogin: can't provide Kerberos auth data.
avalanche: Connection refused

   Do not worry about 'Warning: no Kerberos tickets issued.' This is
   because we're only doing kerberos authentication, not ticket passing.
   If you want ticket passing, use [56]OpenSSH which has support. Stock
   KerberosIV doesn't have support for tgt passing, either - only the AFS
   kaserver's implementation of krb4, since the regular KerberosIV kdc
   checks client IP address listed in the ticket.
d5447 1
a5447 1
10.12 - Setting up Anonymous FTP Services.
d5449 2
a5450 135
   Anonymous FTP allows users without accounts to access files on your
   computer via the File Transfer Protocol. This will give an overview of
   setting up the anonymous FTP server, and its logging, etc.

  Adding the FTP account

   To start off, you need to have an account on your system of "ftp".
   This account shouldn't have a useable password. Here we will set the
   login directory to /home/ftp, but you can put it wherever you want.
   When using anonymous ftp, the ftp daemon will chroot itself to the
   home directory of the 'ftp' user. To read up more on that, read the
   [57]ftp(8) and [58]chroot(2) man pages. Here is an example of adding
   the ftp user. I will do this using [59]adduser(8). We also need to add
   /bin/false to our /etc/shells, this is the "shell" that we will be
   giving to the ftp user. This won't allow them to login, even though we
   will give them an empty password. To do this you can simply echo
   /bin/false >> /etc/shells. Also if you wish for that shell to show up
   during the adduser questions, you need to modify /etc/adduser.conf.
oshibana# adduser
Use option ``-silent'' if you don't want see all warnings & questions.

Reading /etc/shells
Check /etc/master.passwd
Check /etc/group

Ok, let's go.
Don't worry about mistakes. I will give you the chance later to correct any inp
ut.
Enter username [a-z0-9_]: ftp
Enter full name []: anonymous ftp
Enter shell csh false ksh nologin sh tcsh zsh [sh]: false
Uid [1002]:
Login group ftp [ftp]:
Login group is ``ftp''. Invite ftp into other groups: guest no
[no]: no
Enter password []:
Use an empty password? (y/n) [y]: y

Name:     ftp
Password: ****
Fullname: anonymous ftp
Uid:      1002
Gid:      1002 (ftp)
Groups:   ftp
HOME:     /home/ftp
Shell:    /usr/bin/false
OK? (y/n) [y]: y
Added user ``ftp''
Copy files from /usr/share/skel to /home/ftp
Add another user? (y/n) [y]: n
Goodbye!

  Directory Setup

   Along with the user, this created the directory /home/ftp. This is
   what we want, but there are some changes that we will have to make to
   get it ready for anonymous ftp. Again these changes are explained in
   the [60]ftp(8) man page.
   You do not need to make a /home/ftp/usr or /home/ftp/bin directory.
     * /home/ftp - This is the main directory. It should be owned by root
       and have permissions of 555.
     * /home/ftp/etc - This is entirely optional and not recommended, as
       it only serves to give out information on users which exist on
       your box. If you want your anonymous ftp directory to appear to
       have real users attached to your files, you should copy
       /etc/pwd.db and /etc/group to this directory. This directory
       should be mode 511, and the two files should be mode 444. These
       are used to give owner names as opposed to numbers. There are no
       passwords stored in pwd.db, they are all in spwd.db, so don't copy
       that over.
     * /home/ftp/pub - This is a standard directory to place files in
       which you wish to share. This directory should also be mode 555.

   Note that all these directories should be owned by ''root''. Here is a
   listing of what the directories should look like after their creation.
oshibana# pwd
/home
oshibana# ls -laR ftp
total 5
dr-xr-xr-x  5 root  ftp    512 Jul  6 11:33 .
drwxr-xr-x  7 root  wheel  512 Jul  6 10:58 ..
dr-x--x--x  2 root  ftp    512 Jul  6 11:34 etc
dr-xr-xr-x  2 root  ftp    512 Jul  6 11:33 pub

ftp/etc:
total 43
dr-x--x--x  2 root  ftp    512 Jul  6 11:34 .
dr-xr-xr-x  5 root  ftp    512 Jul  6 11:33 ..
-r--r--r--  1 root  ftp    316 Jul  6 11:34 group
-r--r--r--  1 root  ftp  40960 Jul  6 11:34 pwd.db

ftp/pub:
total 2
dr-xr-xr-x  2 root  ftp  512 Jul  6 11:33 .
dr-xr-xr-x  5 root  ftp  512 Jul  6 11:33 ..

  Starting up the server and logging

   With ftpd you can choose to either run it from inetd or the rc scripts
   can kick it off. These examples will show our daemon being started
   from [61]inetd.conf. First we must become familiar with some of the
   options to ftpd. The default line from /etc/inetd.conf is:
ftp             stream  tcp     nowait  root    /usr/libexec/ftpd       ftpd -U
S

   Here ftpd is invoked with -US. This will log anonymous connections to
   /var/log/ftpd and concurrent sessions to /var/run/utmp. That will
   allow for these sessions to be seen via who(1). For some, you might
   want to run only an anonymous server, and disallow ftp for users. To
   do so you should invoke ftpd with the -A option. Here is a line that
   starts ftpd up for anonymous connections only. It also uses -ll which
   logs each connection to syslog, along with the get, retrieve, etc, ftp
   commands.
ftp             stream  tcp     nowait  root    /usr/libexec/tcpd       ftpd -l
lUSA

   Note - For people using HIGH traffic ftp servers, you might want to
   not invoke ftpd from inetd.conf. The best option is to comment the
   ftpd line from inetd.conf and start ftpd from rc.conf along with the
   -D option. This will start ftpd as a daemon, and has much less
   overhead as starting it from inetd. Here is an example line to start
   it from rc.conf.
ftpd_flags="-DllUSA"           # for non-inetd use: ftpd_flags="-D"

   This of course only works if you have ftpd taken out of
   /etc/inetd.conf.

  Other relevant files

     * /etc/ftpwelcome - This holds the Welcome message for people once
       they have connected to your ftp server.
     * /etc/motd - This holds the message for people once they have
       successfully logged into your ftp server.
     * .message - This file can be placed in any directory. It will be
       shown once a user enters that directory.
d5452 1
a5452 1
10.13 - Confining users to their home dir's in ftpd(8).
d5454 10
a5463 398
   OpenBSD's [62]ftpd(8) is setup by default to be able to handle this
   very easily. This is accomplished via the file /etc/ftpchroot. Since
   users cannot always be trusted, it might be necessary to restrain them
   to their home directories. This behavior is NOT on by default. Here is
   an example of what the default behavior is like.
$ ftp localhost
Connected to localhost.
220 oshibana FTP server (Version 6.4/OpenBSD) ready.
Name (localhost:ericj): ericj
331 Password required for ericj.
Password: *********
230- OpenBSD 2.6 (GENERIC) #690: Fri Oct 29 16:32:17 MDT 1999
230-
230- Welcome to OpenBSD: The proactively secure Unix-like operating system.
230-
230- Please use the sendbug(1) utility to report bugs in the system.
230- Before reporting a bug, please try to reproduce it with the latest
230- version of the code.  With bug reports, please try to ensure that
230- enough information to reproduce the problem is enclosed, and if a
230- known fix for it exists, include that as well.
230-
230 User ericj logged in.
Remote system type is UNIX.
Using binary mode to transfer files.
ftp> cd /
250 CWD command successful.
ftp> ls
227 Entering Passive Mode (127,0,0,1,60,7)
150 Opening ASCII mode data connection for 'file list'.
altroot
bin
dev
etc
home
mnt
root
sbin
stand
tmp
usr
var
bsd
sys
boot
226 Transfer complete.
ftp> quit
221 Goodbye.

   As you can see here, access is granted to the whole server. In a
   perfect world this is ok, where all users can be trusted, but this
   isn't so. To limit a user, simply add their name to the file
   /etc/ftpchroot. Here is an example showing user "ericj" being
   restricted.
$ cat /etc/ftpchroot
#       $OpenBSD: obsd-faq.txt,v 1.26 2001/08/08 21:06:33 jsyn Exp $
#
# list of users (one per line) given ftp access to a chrooted area.
# read by ftpd(8).
ericj

   This is enough to keep the user "ericj" from escaping from his own
   directory. As you can see in the next example. The / directory has
   suddenly changed to his home dir!
$ ftp localhost
Connected to localhost.
220 oshibana FTP server (Version 6.4/OpenBSD) ready.
Name (localhost:ericj): ericj
331 Password required for ericj.
Password: *********
230 User ericj logged in.
Remote system type is UNIX.
Using binary mode to transfer files.
ftp> cd /
250 CWD command successful.
ftp> ls
227 Entering Passive Mode (127,0,0,1,92,171)
150 Opening ASCII mode data connection for 'file list'.
.login
.mailrc
.profile
.rhosts
.ssh
.cshrc
work
mail
src
226 Transfer complete.
ftp> quit
221 Goodbye.

   [63][Back to Main Index] [64][To Section 9.0 - Migrating from Linux]
   [65][To Section 11.0 - Performance Tuning]
     _________________________________________________________________

   [66][back] [67]www@@openbsd.org
   $OpenBSD: obsd-faq.txt,v 1.26 2001/08/08 21:06:33 jsyn Exp $

References

   1. http://openbsd.org/faq/faq10.html#10.1
   2. http://openbsd.org/faq/faq10.html#10.2
   3. http://openbsd.org/faq/faq10.html#10.3
   4. http://openbsd.org/faq/faq10.html#10.4
   5. http://openbsd.org/faq/faq10.html#10.5
   6. http://openbsd.org/faq/faq10.html#10.6
   7. http://openbsd.org/faq/faq10.html#10.7
   8. http://openbsd.org/faq/faq10.html#10.8
   9. http://openbsd.org/faq/faq10.html#10.9
  10. http://openbsd.org/faq/faq10.html#10.10
  11. http://openbsd.org/faq/faq10.html#10.11
  12. http://openbsd.org/faq/faq10.html#10.12
  13. http://openbsd.org/faq/faq10.html#10.13
  14. http://www.openbsd.org/cgi-bin/man.cgi?query=su&apropos=0&sektion=1&format=html
  15. http://www.openbsd.org/cgi-bin/man.cgi?query=adduser&apropos=0&sektion=8&format=html
  16. http://www.openbsd.org/cgi-bin/man.cgi?query=sudo&sektion=8&format=html
  17. http://www.openbsd.org/cgi-bin/man.cgi?query=dump&sektion=8&format=html
  18. http://www.openbsd.org/cgi-bin/man.cgi?query=restore&sektion=8&format=html
  19. http://www.openbsd.org/cgi-bin/man.cgi?query=tar&sektion=1&format=html
  20. http://www.openbsd.org/cgi-bin/man.cgi?query=rc&sektion=8&format=html
  21. http://www.openbsd.org/cgi-bin/man.cgi?query=init&sektion=8&format=html
  22. http://www.openbsd.org/cgi-bin/man.cgi?query=rc.shutdown&sektion=8&format=html
  23. http://www.openbsd.org/cgi-bin/cvsweb/src/etc/rc.conf
  24. http://openbsd.org/faq/faq10.html#10.12
  25. http://openbsd.org/faq/faq10.html#10.6
  26. http://www.openbsd.org/cgi-bin/man.cgi?query=ssl&sektion=8&format=html
  27. http://www.sendmail.org/~ca/email/relayingdenied.html
  28. http://www.sendmail.org/tips/relaying.html
  29. http://www.sendmail.org/antispam.html
  30. http://www.openbsd.org/cgi-bin/man.cgi?query=pkg_add&sektion=1&format=html
  31. http://www.openbsd.org/cgi-bin/man.cgi?query=httpd&sektion=8&format=html
  32. http://www.openbsd.org/cgi-bin/man.cgi?query=ssl&sektion=8&format=html
  33. http://www.openbsd.org/cgi-bin/man.cgi?query=ssl&sektion=8&format=html
  34. http://www.thawte.com/
  35. http://www.openbsd.org/cgi-bin/man.cgi?query=httpd&sektion=8&format=html
  36. http://www.openbsd.org/cgi-bin/man.cgi?query=pwd_mkdb&sektion=8&apropos=0
  37. http://www.openbsd.org/cgi-bin/man.cgi?query=adduser&sektion=8&format=html
  38. http://www.openbsd.org/cgi-bin/man.cgi?query=adduser_proc&sektion=8&format=html
  39. http://www.openbsd.org/cgi-bin/man.cgi?query=rmuser&sektion=8&format=html
  40. http://www.openbsd.org/cgi-bin/man.cgi?query=edquota&sektion=8&format=html
  41. http://www.openbsd.org/cgi-bin/man.cgi?query=quotaon&sektion=8&format=html
  42. http://www.openbsd.org/cgi-bin/man.cgi?query=quota&sektion=1&format=html
  43. http://www.freebsd.org/handbook/kerberos.html
  44. http://web.mit.edu/kerberos/www/dialogue.html
  45. http://web.mit.edu/kerberos/www/papers.html#krb4
  46. http://www.amazon.com/exec/obidos/ASIN/0130614661/qid%3D930594963/
  47. http://www.openbsd.org/cgi-bin/man.cgi?query=krb.conf&sektion=5&format=html
  48. http://www.openbsd.org/cgi-bin/man.cgi?query=krb.realms&sektion=5&format=html
  49. http://www.openbsd.org/cgi-bin/man.cgi?query=kbd_init&sektion=8&format=html
  50. http://www.openbsd.org/cgi-bin/man.cgi?query=kstash&sektion=8&format=html
  51. http://www.openbsd.org/cgi-bin/man.cgi?query=ext_srvtab&sektion=8&format=html
  52. http://www.freebsd.org/handbook/kerberos.html#AEN4957
  53. http://www.openbsd.org/cgi-bin/man.cgi?query=kinit&sektion=1&format=html
  54. http://www.openbsd.org/cgi-bin/man.cgi?query=klist&sektion=1&format=html
  55. http://www.openbsd.org/cgi-bin/man.cgi?query=kdestroy&sektion=1&format=html
  56. http://www.openbsd.org/cgi-bin/man.cgi?query=ssh&sektion=1&format=html
  57. http://www.openbsd.org/cgi-bin/man.cgi?query=ftpd&sektion=8&format=html
  58. http://www.openbsd.org/cgi-bin/man.cgi?query=chroot&sektion=2&format=html
  59. http://www.openbsd.org/cgi-bin/man.cgi?query=adduser&sektion=8&format=html
  60. http://www.openbsd.org/cgi-bin/man.cgi?query=ftpd&sektion=8&format=html
  61. http://www.openbsd.org/cgi-bin/cvsweb/src/etc/inetd.conf
  62. http://www.openbsd.org/cgi-bin/man.cgi?query=ftpd&sektion=8&format=html
  63. http://openbsd.org/faq/index.html
  64. http://openbsd.org/faq/faq9.html
  65. http://openbsd.org/faq/faq11.html
  66. http://openbsd.org/faq/index.html
  67. mailto:www@@openbsd.org


   [OpenBSD]

11-2.4 - OpenBSD 2.4 Specific Information
     _________________________________________________________________

   Table of Contents
     * [1]11.1 - Why do I get UserDir error when running httpd?
     * [2]11.2 - Installing at a partition 4GB or higher
     * [3]11.3 - OpenBSD 2.4 installation walkthrough
     _________________________________________________________________

11.1 - In 2.4 why do I get UserDir error when running httpd?

   It seems as though userdir support was left out of 2.4. Make sure to
   pick up the patch at:

   [4]http://www.openbsd.org/errata24.html

11.2 - Installing at a partition 4GB or higher

   The 2.4 CDs shipped with a problem in installboot. A patch can be
   obtained here [5]http://www.openbsd.org/errata.html. This is fixed in
   -current.

   To place the partition boot record, installboot used a 32 bit
   multiplication for the sectors times the sectorsize which is larger
   than 2^32 -1 (i.e. multiplication overflow) when the partition starts
   at 4 GB or higher. This means the pbr is installed in the real
   partition address modulo 4GB. It's still possible to install at >= 4GB
   with some effort:

   You have 2 Options for doing so with OpenBSD 2.4. If you have Linux or
   any other unix like OS, you should back up the sectors first before
   trying anything.

     * Suppose the partition starts at cylinder 611, and the drive has
       255 heads, 63 sectors: offset for the obsd partition is
       611*255*63= 9815715 sectors. multiply this by 512 and you get:
       5025646080. 5025646080 mod 2^32 = 730678784
       (You can just subtract 2^32 on a hand calculator...) dividing by
       512 gives sector 1427107.
       Ok, suppose were now in linux (where cylinder numbers are 1 higher
       btw..) and that the obsd partition is DOS partition 4:
       dd if=/dev/hda of=backup.txt skip=1427107 bs=512 count=1
       will backup the data that installboot will nuke ..
       Now install OpenBSD. Return to Linux.
       Now we're going to copy the partition boot record to the right
       place.
       dd if=/dev/hda of=pbr.txt skip=1427107 bs=512 count=1
       dd if=/pbr.txt of=/dev/hda4 bs=512 count=1
       (adding obsd to lilo should now work)
       Now write back the nuked sector:
       dd if=/backup.txt of=/dev/hda seek=1427107 bs=512 count=1
       Caveat: make sure that whatever gets nuked by installboot isn't
       essential to running dd (and starting the other OS). Backing up
       the affected partition is recommended.
     * Use a correct version of installboot (compiled for you by another
       OBSD'er ..):
       put it on another partition, e.g. a DOS partition. Suppose wd0j is
       the DOS partition (see disklabel wd0, this is in case of IDE
       disks), and installboot is named installb there.
       After booting from floppy/CD, press ^C to get into the shell:
          + mkdir dos
          + mount /dev/wd0j dos
          + cp dos/tmp/installb /usr/mdec/installboot

   Now enter 'install' and the installation procedure should use the new
   installboot.
     _________________________________________________________________

   [6][back] [7]www@@openbsd.org
   $OpenBSD: obsd-faq.txt,v 1.26 2001/08/08 21:06:33 jsyn Exp $

References

   1. http://openbsd.org/faq/faq11-2.4.html#11.1
   2. http://openbsd.org/faq/faq11-2.4.html#11.2
   3. http://openbsd.org/faq/log24.txt
   4. http://openbsd.org/errata24.html#userdir
   5. http://openbsd.org/errata.html#installboot
   6. http://openbsd.org/faq/index.html
   7. mailto:www@@openbsd.org


   [OpenBSD]

11-2.5 - OpenBSD 2.5 Specific Information
     _________________________________________________________________

   Table of Contents
     * [1]Swapping in OpenBSD 2.5
     * [2]Tuning kmem
     * [3]OpenBSD 2.5 installation walkthrough
     _________________________________________________________________

11.1 - Swapping in OpenBSD 2.5

   (Note: if you are looking to swap to a file because you are getting
   "virtual memory exhausted" errors, you should try raising the
   per-process limits first with csh's [4]unlimit(1), or sh's
   [5]ulimit(1).)

   OpenBSD 2.5 uses [6]swapon to deal with swapping. Swapping to a file
   doesn't require a custom built kernel, although that can still be
   done, this faq will show you how to add swap space both ways.

  Swapping to a file.

   Swapping to a file is easiest and quickest way to get extra swap
   area's setup. This is not for users who are currently using
   Softupdates. (Which isn't enabled by default). To start out, you can
   see how much swap you are currently have and how much you are using
   with the [7]pstat(8) utility. You can do this by using the command:
ericj@@oshibana> pstat -s
Device      512-blocks     Used    Avail Capacity  Priority
swap_device      65520        8    65512     0%    0

   This shows the devices currently being used for swapping and their
   current statistics. In the above example there is only one device
   named "swap_device". This is the predefined area on disk that is used
   for swapping. (Shows up as partition b when viewing disklabels) As you
   can also see in the above example, that device isn't getting much use
   at the moment. But for the purposes of this document, we will act as
   if an extra 32M is needed.

   The first step to setting up a file as a swap device is to create the
   file. It's best to do this with the [8]dd(1) utility. Here is an
   example of creating the file /var/swap that is 32M large.
ericj@@oshibana> sudo dd if=/dev/zero of=/var/swap bs=1k count=32768
32768+0 records in
32768+0 records out
33554432 bytes transferred in 20 secs (1677721 bytes/sec)

   Once this has been done, we can turn on swapping to that device. Use
   the following command to turn on swapping to this device
ericj@@oshibana> sudo swapon -a /var/swap

   Now we need to check to see if it has been correctly added to the list
   of our swap devices.
ericj@@oshibana> pstat -s
Device      512-blocks     Used    Avail Capacity  Priority
swap_device      65520        8    65512     0%    0
/var/swap        65536        0    65536     0%    0
Total           131056        8   131048     0%

   Now that the file is setup and swapping is being done, you need to add
   a line to your /etc/fstab file so that this file is configured on the
   next boot time also. If this line is not added, your won't have this
   swap device configured.
ericj@@oshibana> cat /etc/fstab
/dev/wd0a / ffs rw 1 1
/var/swap /var/swap sw 0 0

  Swapping via a vnode device

   This is a more permanent solution to adding more swap space. To swap
   to a file permanently, first make a kernel with vnd0c as swap. If you
   have wd0a as root filesystem, wd0b is the previous swap, use this line
   in the kernel configuration file (refer to compiling a new kernel if
   in doubt):
config          bsd     root on wd0a swap on wd0b and vnd0c dumps on wd0b

   After this is done, the file which will be used for swapping needs to
   be created. You should do this by using the same command as in the
   above examples.
ericj@@oshibana> sudo dd if=/dev/zero of=/var/swap bs=1k count=32768
32768+0 records in
32768+0 records out
33554432 bytes transferred in 20 secs (1677721 bytes/sec)

   Now your file is in place, you need to add the file to you /etc/fstab.
   Here is a sample line to boot with this device as swap on boot.
ericj@@oshibana> cat /etc/fstab
/dev/wd0a / ffs rw 1 1
/dev/vnd0c none swap sw 0 0

   At this point your computer needs to be rebooted so that the kernel
   changes can take place. Once this has been done it's time to configure
   the device as swap. To do this you will use [9]vnconfig(1).
ericj@@oshibana> sudo vnconfig -c -v vnd0 /var/swap
vnd0: 33554432 bytes on /var/swap

   Now for the last step, turning on swapping to that device. We will do
   this just like in the above examples, using swapon(8). Then we will
   check to see if it was correctly added to our list of swap devices.
ericj@@oshibana> sudo swapon -a /dev/vnd0c
ericj@@oshibana> pstat -s
Device      512-blocks     Used    Avail Capacity  Priority
swap_device      65520        8    65512     0%    0
/dev/vnd0c       65536        0    65536     0%    0
Total           131056        8   131048     0%

11.2 - Tuning kmem

   If you are running 2.5 (these steps are not necessary for OpenBSD
   2.6), and if you start using the [10]performance tuning measures, you
   may start running out of kernel memory. If you start getting panics
   like "out of space in kmem_map" then you need to try
   option NKMEMCLUSTERS=8192

   Note that 8192 is valid for the i386 architecture, but may be too
   little or too much for others. Look at /usr/include/machine/param.h to
   see more information.

   If you ever get a panic "vm_map_entry_create: out of map entries", you
   may also want to increase the number of static kernel maps and
   entries. The default value for these options is architecture dependent
   and is specified in /sys/vm/vm_map.h. If you are using soft updates,
   the following values should keep you going!
   option MAX_KMAP=120
       option MAX_KMAPENT=6000
     _________________________________________________________________

   [11][back] [12]www@@openbsd.org
   $OpenBSD: obsd-faq.txt,v 1.26 2001/08/08 21:06:33 jsyn Exp $

References

   1. http://openbsd.org/faq/faq11-2.5.html#11.1
   2. http://openbsd.org/faq/faq11-2.5.html#11.2
   3. http://openbsd.org/faq/log25.txt
   4. http://www.openbsd.org/cgi-bin/man.cgi?query=unlimit&sektion=1&format=html
   5. http://www.openbsd.org/cgi-bin/man.cgi?query=ulimit&sektion=1&format=html
   6. http://www.openbsd.org/cgi-bin/man.cgi?query=swapon&sektion=8&format=html
   7. http://www.openbsd.org/cgi-bin/man.cgi?query=pstat&sektion=8&format=html
   8. http://www.openbsd.org/cgi-bin/man.cgi?query=dd&sektion=1&format=html
   9. http://www.openbsd.org/cgi-bin/man.cgi?query=vnconfig&sektion=1&format=html
  10. http://openbsd.org/faq/faq11.html
  11. http://openbsd.org/faq/index.html
  12. mailto:www@@openbsd.org
d5465 2
d5468 2
a5469 1
   [OpenBSD]
d5471 3
a5473 2
11.0 - Performance Tuning
     _________________________________________________________________
d5475 1
a5475 7
   Table of Contents
     * [1]11.1 - Networking
     * [2]11.2 - Disk I/O
     * [3]11.3 - Tuning kmem
     * [4]11.4 - Hardware Choices
     * [5]11.5 - Why aren't we using async mounts?
     _________________________________________________________________
d5477 26
a5502 1
11.1 - Networking
d5504 1
a5504 15
   If you run a busy server, gateway or firewall, you should make sure to
   prevent memory starvation to various parts of the kernel described
   below.

   The [6]options(4) man page talks about the options presented.

   An option you may need to change for a busy server, gateway or
   firewall is NMBCLUSTERS. This controls the size of the kernel mbuf
   cluster map. On your computer, if you get messages like "mb_map full",
   you need to increase this value. If traffic on a networking interface
   stops for no apparent reason, this may also be a sign that you need to
   increase this value. A reasonable value on the i386 port with most
   100Mbps ethernet interfaces (no matter how many the machine has) is
   8192.
   option NMBCLUSTERS=8192
d5506 178
a5683 1
11.2 - Disk I/O
d5685 1
a5685 99
   Disk I/O speed is a significant factor in the overall speed of your
   computer. It becomes increasingly important when your computer is
   hosting a multi-user environment (users of all kinds, from those who
   log-in interactively to those who see you as a file-server or a
   web-server.) Data storage constantly needs attention, especially when
   your partitions run out of space and when your disks fail. OpenBSD has
   several options to increase the speed of your disk operations and
   provide fault tolerance.

  CCD

       The first option is the use of [7]ccd(4), the Concatenated Disk
       Driver. This allows you to join several partitions into one
       virtual disk (and thus, you can make several disks look like one
       disk). This concept is similar to that of LVM (logical volume
       management), which is found in many commercial Unix flavors.
       If you are running GENERIC, ccd is already enabled. If not, you
       may need to add it to your kernel configuration. To start the
       setup of ccd, you need to add support for it in your kernel. A
       line such as:

pseudo-device   ccd     4       # concatenated disk devices

   The above example gives you up to 4 ccd devices (virtual disks). Now
   you need to figure out what partitions on your real disks that you
   want to dedicate to ccd. Use disklabel to mark these partitions as
   type 'ccd'. On some architectures, disklabel may not allow you to do
   this. In this case, mark them as 'ffs'.

   If you are using ccd to gain performance by striping, note that you
   will not get optimum performance unless you use the same model of
   disks with the same disklabel settings.

   Edit /etc/ccd.conf to look something like this: (for more information
   on configuring ccd, look at [8]ccdconfig(8))
# Configuration file for concatenated disk devices
#
# ccd   ileave  flags   component devices
ccd0   16      none    /dev/sd2e /dev/sd3e

   To make your changes take effect, run
# ccdconfig -C

   As long as /etc/ccd.conf exists, ccd will automatically configure
   itself upon boot. Now, you have a new disk, ccd0, a combination of
   /dev/sd2e and /dev/sd3e. Just use disklabel on it like you normally
   would to make the partition or partitions you want to use. Again,
   don't use the 'c' partition as an actual partition that you put stuff
   on. Make sure your useable partitions are at least one cylinder off
   from the beginning of the disk.

  RAID

       Another solution is [9]raid(4) which will have you use
       [10]raidctl(8) to control your raid devices. OpenBSD's RAID is
       based upon Greg Oster's [11]NetBSD port of the CMU [12]RAIDframe
       software. OpenBSD has support for RAID levels of 0, 1, 4, and 5.
       With raid, as with ccd, support must be in the KERNEL. Unlike ccd,
       support for RAID is not found in GENERIC, it must be compiled into
       your kernel (RAID support adds some 500K to the size of an i386
       kernel!)

pseudo-device   raid   4       # RAIDframe disk device

   Setting up RAID on some operating systems is confusing and painful to
   say the least. Not so with RAIDframe. Read the [13]raid(4) and
   [14]raidctl(8) man pages to get full details. There are many options
   and possible configurations, a detailed explanation is beyond the
   scope of this document.

  Filesystem Buffer

   For fileservers with memory to spare, you can increase
       BUFCACHEPERCENT. That is, what percentage of your RAM should you
       use as a file system buffer. This option may change when the
       Unified Buffer Cache is completed and is part of OpenBSD. In the
       mean time, to increase BUFCACHEPERCENT, you should add a line to
       your kernel configuration like this:

   option BUFCACHEPERCENT=30

   Of course you can make it as low as 5 percent (the default) or as high
   as 50 percent (or more.)

  Soft updates

   Another tool that can be used to speed up your system is softupdates.
       One of the slowest operations in the traditional BSD file system
       is updating metainfo (which happens, among other times, when you
       create or delete files and directories.) Softupdates attempts to
       update metainfo in RAM instead of writing to the hard disk each
       and every single metainfo update. Another effect of this is that
       the metainfo on disk should always be complete, although not
       always up to date. So, a system crash should not require fsck upon
       boot up, but simply a background version of fsck that makes
       changes to the metainfo in RAM (a la softupdates). This means
       rebooting a server is much faster, because you don't have to wait
       for fsck! (OpenBSD does not have this feature yet.) You can read
       more about softupdates in the [15]softupdates FAQ entry.
d5687 8
a5694 1
11.3 - Tuning kmem
d5696 1
a5696 1
   This was moved to the [16]OpenBSD 2.5 information section.
d5698 23
a5720 1
11.4 - Hardware choices
d5722 1
a5722 82
   (Note- this section is heavily centered around the i386, or PC,
   architecture. That is to say... other architectures don't give you
   quite as many choices!)

   The performance of your applications depends heavily on your OS and
   the facilities it provides. This may be part of the reason that you
   are using OpenBSD. The performance of your applications also depends
   heavily on your hardware. For many folks, the Price/Performance ratio
   of a brand new PC with a Intel Pentium III or AMD Athlon processor is
   much better then the Price/Performance ratio of a Sun UltraSparc 60!
   Of course, the price of OpenBSD can't be beat.

   If you are shopping for a new PC, whether you are buying it piece by
   piece or completely pre-built, you want to make sure first that you
   are buying reliable parts. In the PC world, this is not easy. Bad or
   otherwise unreliable or mismatched parts can make OpenBSD run poorly
   and crash often. The best advice we can give is to be careful, buy
   brands and parts that have been reviewed by an authority you trust.
   Sometimes, when you skimp on the price of a PC, you lose in quality!

   There are certain things that will help bring out the maximum
   performance of your hardware:
     * Use multiple disks.
       Instead of buying one 20GB disk, buy multiple 9GB disks. While
       this may cost more, distributing the load over multiple spindles
       will decrease the amount of time necessary to access data on the
       disks. And, with more spindles, you will get more reliability and
       faster data access with RAID.
     * Use SCSI if you need very high disk IO speeds.
       IDE disks normally run at 5400 RPM, with new disks emerging from
       manufacturers that run at 7200 RPM. Using high end IDE disks, it
       may be unreasonable to expect more then 15 to 20 megabytes per
       second of throughput from a single disk. Using high end SCSI disks
       (higher cost 10000 RPM disks), you can achieve performance higher
       then this. Conversely, if you are using medium or low end SCSI
       disks, this is a waste of money, and IDE will serve you just as
       well, if not better.
       If you are building a server, and you need more then 20GB of disk
       space, you may want to consider SCSI. IDE limits you to two disks
       per controller. Concurrent access to these two disks may have a
       negative impact on the I/O performance of these disks. Wide SCSI
       limits you to 15 per controller! While SCSI costs more, the
       flexibility and performance can justify these costs in some
       environments.
     * Use SDRAM instead of DRAM.
       This option applies mainly to PCs. Most other architectures don't
       give you a choice of what kind of RAM you can use. Several PCs
       still do. You will get better performance with SDRAM versus DRAM
       (SIMMs). If your system supports RDRAM or some other new type of
       RAM, then you are already one step ahead...
     * Use ECC or parity RAM.
       Parity adds some functionality to see if the data in RAM has been
       corrupted. ECC extends this functionality and attempts to correct
       some bit corruption errors on the fly. This option applies mainly
       to PCs. Most other architectures simply require parity or ECC
       capable RAM. Several non-PC computers won't even boot with
       non-parity RAM. If you aren't using ECC/parity RAM, you may get
       data corruption and other abnormalities. Several manufacturers of
       "cheap PC RAM" don't even make an ECC variety! This will help you
       avoid them! PC manufacturers often sell several product lines,
       divided around "servers" and "workstations." The servers will
       incorporate ECC RAM into their architecture. Unix workstation
       manufacturers have been using parity (and now ECC) for several
       years in all of their product lines.
     * Avoid ISA devices.
       While most folks avoid ISA devices, because they are generally
       hard to configure and out of date, there are still plenty in
       existence. If you are using the ISA bus for your disk or network
       controllers, (or even worse, for both) remember that the ISA bus
       itself can be a performance bottleneck. If you need speed, look to
       PCI. Of course, there are still several ISA bus cards that work
       just fine. Unfortunately, most of these are sound cards and serial
       port cards.
     * Avoid cheap PCI network adapters.
       OpenBSD supports a plethora of cheap PCI network adapters. These
       adapters work great in home systems, and also low or moderate
       throughput business and research environments. But, if you need
       high throughput and low impact on your server, you are better off
       buying a quality PCI network adapter. Unfortunately, some
       expensive brand adapters (such as the 3com XL series) are not much
       better then the cheap adapters. One favorite 10/100Mbps adapter is
       the Intel EtherExpress PRO/100.
d5724 1
a5724 1
11.5 - Why aren't we using async mounts?
d5726 3
a5728 18
   Question: "I simply do "mount -u -o async /" which makes one package I
   use (which insists on touching a few hundred things from time to time)
   useable. Why is async mounting frowned upon and not on by default (as
   it is in some other unixen) ? Surely it is much simpler and therefore
   a safer way of improving performance in some applications ?"

   Answer: "Async mounts is indeed faster then sync mounts, but they are
   also less safe. What happens in case of a power failure? Or a hardware
   problem? The quest for speed should not sacrifice the reliability and
   the stability of the system. Check the manpage for [17]mount(8)."
             async   All I/O to the file system should be done asynchronously.
                     This is a dangerous flag to set since it does not guaran-
                     tee to keep a consistent file system structure on the
                     disk.  You should not use this flag unless you are pre-
                     pared to recreate the file system should your system
                     crash.  The most common use of this flag is to speed up
                     restore(8) where it can give a factor of two speed in-
                     crease.
d5730 1
a5730 36
   On the other hand, when you are dealing with temp data that you can
   recreate from scratch after a crash, you could gain speed by using a
   separate partition, used for that data only, mounted async. If you
   don't mind risking the loss of all the data in the partition when
   something goes wrong...

   [18][to Section 12.0 - For Advanced Users] [19][To Section 10.0 -
   System Administration]
     _________________________________________________________________

   [20][back] [21]www@@openbsd.org
   $OpenBSD: obsd-faq.txt,v 1.26 2001/08/08 21:06:33 jsyn Exp $

References

   1. http://openbsd.org/faq/faq11.html#11.1
   2. http://openbsd.org/faq/faq11.html#11.2
   3. http://openbsd.org/faq/faq11.html#11.3
   4. http://openbsd.org/faq/faq11.html#11.4
   5. http://openbsd.org/faq/faq11.html#11.5
   6. http://www.openbsd.org/cgi-bin/man.cgi?query=options&apropos=0&sektion=4&format=html
   7. http://www.openbsd.org/cgi-bin/man.cgi?query=ccd&apropos=0&sektion=4&format=html
   8. http://www.openbsd.org/cgi-bin/man.cgi?query=ccdconfig&apropos=0&sektion=8&format=html
   9. http://www.openbsd.org/cgi-bin/man.cgi?query=raid&apropos=0&sektion=4&format=html
  10. http://www.openbsd.org/cgi-bin/man.cgi?query=raidctl&apropos=0&sektion=8&format=html
  11. http://www.cs.usask.ca/staff/oster/raid.html
  12. http://www.pdl.cs.cmu.edu/RAIDframe/
  13. http://www.openbsd.org/cgi-bin/man.cgi?query=raid&apropos=0&sektion=4&format=html
  14. http://www.openbsd.org/cgi-bin/man.cgi?query=raidctl&apropos=0&sektion=8&format=html
  15. http://openbsd.org/faq/faq14.html#14.5
  16. http://openbsd.org/faq/faq11-2.5.html#11.2
  17. http://www.openbsd.org/cgi-bin/man.cgi?query=mount&apropos=0&sektion=8&format=html
  18. http://openbsd.org/faq/faq12.html
  19. http://openbsd.org/faq/faq10.html
  20. http://openbsd.org/faq/index.html
  21. mailto:www@@openbsd.org
d5732 3
d5736 6
a5741 1
   [OpenBSD]
d5743 2
a5744 2
12.0 - For Advanced Users
     _________________________________________________________________
d5746 1
a5746 9
   Table of Contents
     * [1]12.1 - Forcing DMA access for IDE disks
     * [2]12.2 - Upgrading from various versions of OpenBSD via CVS.
     _________________________________________________________________

   By advanced users, we mean to imply people who have a working
   knowledge of how to use and administrate a Unix-like operating system.
   If you follow instructions in this section without understanding what
   you are doing, you may cause problems in the operation of your system.
d5748 4
a5751 1
12.1 - Forcing DMA access for IDE disks
d5753 1
a5753 34
   With the PCI IDE code, your chipset may not be known. If so, you will
   get a message like:
pciide0: DMA, (unused)

   If you get this message, you can try and force DMA mode by using
   'flags 0x0001' on your pciide entry in your kernel config file. That
   would look something like this:
pciide* at pci ? dev ? function ? flags 0x0001

   After doing this, the pciide code will try to use DMA mode regardless
   of whether or not it actually knows how to do so with your chipset. If
   this works, and your system makes it through fsck and startup, it is
   likely that this will work for good. If this does not work, and the
   system hangs or panics after booting, then you can't use DMA mode
   (yet, until support is added for your chipset). Note that if you find
   the documentation for your PCI-IDE controller's chipset, this is a
   good start to fully supporting your chipset within the PCI-IDE code.
   You can look on the manufacturer's website or call them. If your
   PCI-IDE controller is part of your motherboard, figure out who
   manufactures the chipset and pursue their resources!

   Note that you will know that DMA support has been enabled if you see
   this message:
cd0(pciide0:1:0): using PIO mode 3, DMA mode 1 (using DMA data transfers)

   This means that pciide0, channel 1, drive 0 (which appears to be an
   ATAPI CD-ROM) is using DMA data transfers.

   Some notes:

   DMA is not supported on wdc* unless a DMA channel (drq) is specified.
   I'm not sure what the "standard" drqs are for hard disk controllers.
   To enable
wdc0    at isa? port 0x1f0 irq 14 flags 0x00
d5755 1
a5755 2
   Non-ultra DMA does not necessarily lead to higher bandwidth vs PIO.
   However, it decreases the CPU load significantly.
d5757 3
a5759 387
   [3][Back to Main Index] [4][To Section 11.0 - Performance Tuning]
   [5][To Section 13.0 - IPsec]
     _________________________________________________________________

   [6][back] [7]www@@openbsd.org
   $OpenBSD: obsd-faq.txt,v 1.26 2001/08/08 21:06:33 jsyn Exp $

References

   1. http://openbsd.org/faq/faq12.html#12.1
   2. http://openbsd.org/faq/upgrade-minifaq.html
   3. http://openbsd.org/faq/index.html
   4. http://openbsd.org/faq/faq11.html
   5. http://openbsd.org/faq/faq13.html
   6. http://openbsd.org/faq/index.html
   7. mailto:www@@openbsd.org


   [OpenBSD]

   [1][Back to Main Index] [2][To Section 12.0 - For Advanced Users]
   [3][To Section 14.0 - Using disks in OpenBSD]

   This document borrows large pieces from:
     * [4]IPSec for Dummies by Julian Elischer
     * [5]ipsec(4) by Niels Provos, and several other people from the
       OpenBSD team
     * [6]Secureops VPN

   Thanks, folks!

                   13.0 - Using IPSec (IP Security Protocol)

     * [7]13.1 - What is IPSec?
     * [8]13.2 - That's nice, but why do I want to use IPSec?
     * [9]13.3 - What are the protocols behind IPSec?
     * [10]13.4 - On the wire format
     * [11]13.5 - Configuring IPSec
     * [12]13.6 - How do I setup IPSec with manual keying?
     * [13]13.7 - How do I setup IPSec with photurisd?
     * [14]13.8 - How do I setup IPSec with isakmpd?
     * [15]13.9 - What IKE clients are compatible with isakmpd?
     * [16]13.10 - Troubleshooting IPSec/VPN
     * [17]13.11 - Related Documentation

                             13.1 - What is IPSec?

   IPSec is a set of extensions to the IP protocol family. It provides
   cryptographic security services. These services allow for
   authentication, integrity, access control, and confidentiality. IPSec
   provides similar services as SSL, but at the network layer, in a way
   that is completely transparent to your applications, and much more
   powerful. We say this because your applications do not have to have
   any knowledge of IPSec to be able to use it. You can use [18]any IP
   protocol over IPSec. You can create encrypted tunnels (VPNs), or just
   do encryption between computers. Since you have so many options, IPSec
   is rather complex (much more so then SSL!)

   Before you start using IPSec, we strongly recommend that you check out
   the "recommended reading" of [19]part 6 of the FAQ. In particular, if
   you don't already understand it, the [20]Understanding IP Addressing
   document is highly recommended.

   In a logical sense, IPSec works in any of these three ways:
     * Host-to-Host
     * Host-to-Network
     * Network-to-Network

   In every scenario that involves a network, we mean to imply router. As
   in, Host-to-Router (and this router controls and encrypts traffic for
   a particular Network.)

   As you can see, IPSec can be used to tunnel traffic for VPN
   connections. However, its utility reaches beyond VPNs. With a central
   Internet Key Exchange registry, every machine on the internet could
   talk to another one and employ powerful encryption and authentication!

              13.2 - That's nice, but why do I want to use IPSec?

   The internet protocol, IP, aka IPv4, does not inherently provide any
   protection to your transferred data. It does not even guarantee that
   the sender is who he says he is. IPSec tries to remedy this. These
   services are considered distinct, but the IPSec supports them in a
   uniform manner.

    Confidentiality

   Make sure it is hard for anyone but the receiver to understand what
   data has been communicated. You do not want anyone to see your
   passwords when logging into a remote machine over the Internet.

    Integrity

   Guarantee that the data does not get changed on the way. If you are on
   a line carrying invoicing data you probably want to know that the
   amounts and account numbers are correct and not altered while
   in-transit.

    Authenticity

   Sign your data so that others can see that it is really you that sent
   it. It is clearly nice to know that documents are not forged.

    Replay protection

   We need ways to ensure a transaction can only be carried out once
   unless we are authorized to repeat it. I.e. it should not be possible
   for someone to record a transaction, and then replaying it verbatim,
   in order to get an effect of multiple transactions being received by
   the peer. Consider the attacker has got to know what the traffic is
   all about by other means than cracking the encryption, and that the
   traffic causes events favourable for him, like depositing money into
   his account. We need to make sure he cannot just replay that traffic
   later. WARNING: as per the standards specification, replay protection
   is not performed when using manual-keyed IPsec (e.g., when using
   [21]ipsecadm(8)).

                  13.3 - What are the protocols behind IPSec?

   IPSec provides confidentiality, integrity, authenticity, and replay
   protection through two new protocols. These protocols are called AH,
   Authentication header, and ESP, Encapsulated security payload.

   AH provides authentication, integrity, and replay protection (but not
   confidentiality). Its main difference with ESP is that AH also secures
   parts of the IP header of the packet (like the source/destination
   addresses).

   ESP can provide authentication, integrity, replay protection, and
   confidentiality of the data (it secures everything in the packet that
   follows the header). Replay protection requires authentication and
   integrity (these two go always together). Confidentiality (encryption)
   can be used with or without authentication/integrity. Similarly, one
   could use authentication/integrity with or without confidentiality.

                           13.4 - On the wire format

   The Authentication Header (AH) comes after the basic IP header and
   contains cryptographic hashes of the data and identification
   information. The hashes can also cover the invariant parts of the IP
   header itself. There are several different RFCs giving a choice of
   actual algorithms to use in the AH, however they all must follow the
   guidelines specified in [22]RFC2402.

   The Encapsulating Security Payload (ESP) header, allows for rewriting
   of the payload in encrypted form. The ESP header does not consider the
   fields of the IP header before it and therefore makes no guarantees
   about anything except the payload. The various types of ESP applicable
   must follow [23]RFC2406. An ESP header can also provide authentication
   for the payload, (but not the outer header).

   An orthogonal (mostly) division of IPSec functionality is applied
   depending on whether the endpoint doing the IPSec encapsulation is the
   original source of the data or a gateway:
     * Transport mode is used by a host that is generating the packets.
       In transport mode, the security headers are added before the
       transport layer (e.g . TCP, UDP) headers, before the IP header is
       prepended to the packet. In other words an AH added to the packet
       will cover the hashing of the TCP header and some fields of the
       end-to-end IP header, and an ESP header will cover the encryption
       of the TCP header and the data, but not the end-to-end IP header.
     * Tunnel mode is used when the end-to-end IP header is already
       attached to the packet, and one of the ends of the secure
       connection is only a gateway. In this mode, the AH and ESP headers
       are used to cover the entire packet including the end-to-end
       header, and a new IP header is prepended to the packet that covers
       just the hop to the other end of the secure connection (though
       that may of course be several IP hops away).

   IPSec secured links are defined in terms of Security Associations
   (SAs). Each SA is defined for a single unidirectional flow of data,
   and usually (ignoring multicast) from one single point to another,
   covering traffic distinguishable by some unique selector. All traffic
   flowing over a single SA is treated the same. Some traffic may be
   subject to several SAs, each of which applies some transform. Groups
   of SAs are called an SA Bundle. Incoming packets can be assigned to a
   particular SA by the three defining fields, (Destination IP address,
   Security Parameter Index, security protocol). SPI can be considered a
   cookie that is handed out by the receiver of the SA when the
   parameters of the connection are negotiated. The security protocol
   must be either AH or ESP. Since the IP address of the receiver is part
   of the triple, this is a guaranteed unique value. They can be found
   from the outer IP header and the first security header (which contains
   the SPI and the security protocol).

   An example of a tunnel mode AH packet is:

   IPhdr AH IPhdr2 TCPhdr data

   An example of a transport mode AH packet is:

   IPhdr AH TCPhdr data

   Because an ESP header cannot authenticate the outer IP header, it is
   useful to combine an AH and an ESP header to get the following:

   IPhdr AH ESP TCPhdr data

   This is called Transport Adjacency. The tunneling version would look
   like:

   IPhdr AH ESP IPhdr2 TCPhdr data

   However it is not specifically mentioned in the RFC. As with Transport
   adjacency, this would authenticate the entire packet except a few
   headers in the IP header and also encrypt the payload, (seen in
   italics). When an AH and an ESP header are directly applied together
   like this, the order of the headers should be as shown. It is possible
   in tunnel mode, to do arbitrary recursive encapsulation so that order
   is not specified.

                           13.5 - Configuring IPSec

   How the IPSec systems and gateways are configured is to some extent
   left to the designer, however the RFC has some strong recommendations
   as to how this should be implemented, so as to minimize confusion.

   There are two administrative entities that control what happens to a
   packet. One is the Security Association Database (SAD, referred to as
   TDB or TDB table throughout OpenBSD's IPSec source code) and the other
   is the Security Policy Database (SPD).

   They are similar in that given a number of selectors that describe
   some traffic, they will deliver an entry that describes the processing
   needed. However, the SPD is two steps removed from the actual
   processing: the SPD is used for outgoing packets, to decide what SAD
   entries should be used, and the SAD entries in turn describe the
   actual process and the parameters for it. The SPD entries specify the
   existing SAD entries to use (if it's a bundle there can be more than
   1), but if there is not already a suitable one, it is used to create
   new ones. The fields of the SA being created can be taken either from
   the SPD entry or from the packet that initiated the creation.

   Outgoing packets go from the SPD entry to the specific SA, to get
   encoding parameters. Incoming packets get to the correct SA directly
   using the SPI/DestIP/Proto triple, and from there get to the SPD
   entry.

   The SPD can also specify what traffic should bypass IPSec and what
   should be dropped, so it must also be consulted for incoming non-IPSec
   traffic. SPD entries must be explicitly ordered as several might match
   a particular packet, and the processing must be reproducible.

   The SPD can be though of as similar to a packet filter where the
   actions decided upon are the activation of SA processes. Selectors can
   include src and dest address, port numbers if relevant, application
   and user IDs if available (only on host based transport SAs),
   hostnames, security sensitivity levels, protocols, etc.

   A SAD entry would include:
     * Dest IP address
     * IPSec proto (SA or ESP)
     * SPI (cookie)
     * Sequence counter
     * Seq O/F flag
     * Anti-replay window info
     * AH type and info
     * ESP type and info
     * Lifetime info
     * Tunnel/transport mode flags
     * Path MTU info

   A SPD entry would contain:
     * Pointer to active SAs
     * Selector fields

   Each SA can define one ESP header and one AH header. An IPSec session
   must have one or the other or both, but cannot be defined with neither
   - otherwise there would be no headers to specify the SPI to look up
   the SA. The RFC doesn't say what would happen if the AH and ESP
   headers disagree about the SPI value. One would presume this would
   imply multiple SAs in a bundle.

   The SPD in OpenBSD is managed through the ipsecadm flow command. (You
   would only make changes to it if you are using manual keying.) SAD
   entries can be set manually with [24]ipsecadm(8), however the IETF has
   also defined automatic mechanisms for initialization of sessions and
   such things as key exchange. OpenBSD implements both Photuris
   ([25]RFC2522, and [26]RFC2523) and ISAKMP automatic key exchange
   ([27]RFC2407, [28]RFC2408, and [29]RFC2409) in the [30]photurisd(8)
   and [31]isakmpd(8) daemons.

                13.6 - How do I setup IPSec with manual keying?

   Manual keying is the easiest way to get started with IPSec. You can
   setup encryption between networks, to create VPNs using this method.
   After you have read this section, you may want to investigate using
   [32]/usr/share/ipsec/rc.vpn to set this up for you automatically.

   First, you need to turn on IP AH and IP ESP options in the OpenBSD
   kernel (if you are only using ESP, such as with the rc.vpn script, or
   as with the example below, then you do not need to enable AH. In fact,
   there may even be security concerns related to enabling AH if you are
   not using it).

   There is a nice sysctl to enable these protocols.
   # sysctl -w net.inet.esp.enable=1
       net.inet.esp.enable: 0 -> 1
       # sysctl -w net.inet.ah.enable=1
       net.inet.ah.enable: 0 -> 1

   You can edit /etc/sysctl.conf to turn these on at boot time. You need
   to remove the # mark from in front of net.inet.esp.enable and/or
   net.inet.ah.enable (depending on which you plan to use) and make sure
   they are set to 1.

   Now, you need to setup SAs, or Security Associations. A Security
   Association is a combination of your IP addresses, an SPI, and your
   security protocol (AH and/or ESP). The IP addresses are both your own
   and that of your destination. The SPI, or Security Parameter Index, is
   a number that OpenBSD uses to classify different SAs.

   These examples only use ESP to encrypt your traffic. ESP includes
   authentication of the contained encrypted data, but does not
   authenticate the surrounding IP header, as AH would. This "limited
   authentication" is nevertheless quite sufficient in most cases,
   especially for ESP in a tunnel environment.

   # ipsecadm new esp -spi SPI_OUT -src MY_EXTERNAL_IP -dst
       PEER_EXTERNAL_IP -forcetunnel -enc blf -auth sha1 -key ENC_KEY
       -authkey AUTH_KEY

   Let's put this into practice with two routers, 192.168.5.1 and
   192.168.25.9.

   On Host 192.168.5.1:
   # ipsecadm new esp -spi 1000 -src 192.168.5.1 -dst 192.168.25.9
       -forcetunnel -enc blf -auth sha1 -key
       7762d8707255d974168cbb1d274f8bed4cbd3364 -authkey
       6a20367e21c66e5a40739db293cf2ef2a4e6659f
       # ipsecadm new esp -spi 1001 -dst 192.168.5.1 -src 192.168.25.9
       -forcetunnel -enc blf -auth sha1 -key
       7762d8707255d974168cbb1d274f8bed4cbd3364 -authkey
       6a20367e21c66e5a40739db293cf2ef2a4e6659f

   On Host 192.168.25.9:
   # ipsecadm new esp -spi 1001 -src 192.168.25.9 -dst 192.168.5.1
       -forcetunnel -enc blf -auth sha1 -key
       7762d8707255d974168cbb1d274f8bed4cbd3364 -authkey
       6a20367e21c66e5a40739db293cf2ef2a4e6659f
       # ipsecadm new esp -spi 1000 -dst 192.168.25.9 -src 192.168.5.1
       -forcetunnel -enc blf -auth sha1 -key
       7762d8707255d974168cbb1d274f8bed4cbd3364 -authkey
       6a20367e21c66e5a40739db293cf2ef2a4e6659f

   Notice that the SPIs are different. See [33]On the wire format for a
   complete description of what the SPI is and where it is used.

   Now that you have your Security Associations in place, set up your
   flows.

   Note that, with the -local option, ipsecadm will actually create two
   flows, one with the source address set to 0.0.0.0/32, which handles
   packets originating from the gateway.

   On 192.168.5.1:

   So, right here, two flows will be created, one with 0.0.0.0/32 as the
   source address, which covers all packets originating from the local
   host to the destination, as well as a flow from the destination back
   to the local host.
   # ipsecadm flow -proto esp -dst 192.168.25.9 -spi 1000 -addr
       192.168.5.1 255.255.255.255 192.168.25.9 255.255.255.255 -local

   On 192.168.25.9:
   # ipsecadm flow -proto esp -dst 192.168.5.1 -spi 1001 -addr
       192.168.25.9 255.255.255.255 192.168.5.1 255.255.255.255 -local

   If you want less overhead on your Host-to-Host VPNs, creating the SPI
   without -forcetunnel will let you use transport mode (whereas,
   -forcetunnel makes sure all of the IP packet, including the IP header,
   are encapsulated by SPI). If either the source or destination is a
   network, you will have to use tunnel mode. Creating an SA to and/or
   from a network will automatically ensure tunnel mode SPIs are being
   created.

   This is a simple way to start using IPSec.

   You can use IPSec to tunnel private IP address spaces over the
   Internet. Here is a good example... We want to tunnel 192.168.99.0/24,
   which is behind 208.1.1.1, to 208.1.2.0/24 and 208.1.5.0/24 which are
   behind 208.2.2.2. These examples were generated using the [34]rc.vpn
   script.

   As you can see, when you are using manual keying with IPSec, you have
   to specify exactly what you want done. It won't guess for you. Look at
   these examples...
d5761 2
a5762 1
On 208.1.1.1:
d5764 1
a5764 38
   First, set up the security associations (SAs):
   (This sets up the SPIs, encryption methods, and keys.)
   # ipsecadm new esp -src 208.1.1.1 -dst 208.2.2.2 -forcetunnel -spi
       1001 -enc blf -auth sha1 -key
       7762d8707255d974168cbb1d274f8bed4cbd3364 -authkey
       67e21c66e5a40739db293cf2ef2a4e6659f
       # ipsecadm new esp -src 208.2.2.2 -dst 208.1.1.1 -forcetunnel -spi
       1000 -enc blf -auth sha1 -key
       7762d8707255d974168cbb1d274f8bed4cbd3364 -authkey
       67e21c66e5a40739db293cf2ef2a4e6659f

   Next, setup a flow from 208.1.1.1 to 208.2.2.2
   # ipsecadm flow -proto esp -dst 208.2.2.2 -spi 1001 -addr 208.1.1.1
       255.255.255.255 208.2.2.2 255.255.255.255 -local

   Next, setup a flow from 208.1.2.0/24, which is behind 208.2.2.2, to
   192.168.99.0/24
   # ipsecadm flow -proto esp -dst 208.2.2.2 -spi 1001 -addr 192.168.99.0
       255.255.255.0 208.1.2.0 255.255.255.0

   Next, setup a flow from 208.1.5.0/24, which is behind 208.2.2.2, to
   192.168.99.0/24
   # ipsecadm flow -proto esp -dst 208.2.2.2 -spi 1001 -addr 192.168.99.0
       255.255.255.0 208.1.5.0 255.255.255.0

   Now, setup a flow from 208.1.2.0/24, which is behind 208.2.2.2 to the
   router 208.1.1.1.
   # ipsecadm flow -proto esp -dst 208.2.2.2 -spi 1001 -addr 208.1.1.1
       255.255.255.255 208.1.2.0 255.255.255.0 -local

   OK, setup a flow from 208.1.5.0/24, which is behind 208.2.2.2, to the
   router 208.1.1.1
   # ipsecadm flow -proto esp -dst 208.2.2.2 -spi 1001 -addr 208.1.1.1
       255.255.255.255 208.1.5.0 255.255.255.0 -local

   Finally, setup a flow from the router 208.2.2.2 to 192.168.99.0/24
   # ipsecadm flow -proto esp -dst 208.2.2.2 -spi 1001 -addr 192.168.99.0
       255.255.255.0 208.2.2.2 255.255.255.255
d5766 1
a5766 1
On 208.2.2.2:
d5768 187
a5954 654
   Same as before, we setup the SAs...
   # ipsecadm new esp -src 208.2.2.2 -dst 208.1.1.1 -forcetunnel -spi
       1000 -enc blf -auth sha1 -key
       7762d8707255d974168cbb1d274f8bed4cbd3364 -authkey
       67e21c66e5a40739db293cf2ef2a4e6659f
       # ipsecadm new esp -src 208.1.1.1 -dst 208.2.2.2 -forcetunnel -spi
       1001 -enc blf -auth sha1 -key
       7762d8707255d974168cbb1d274f8bed4cbd3364 -authkey
       67e21c66e5a40739db293cf2ef2a4e6659f

   Now, this is the reverse side... Setup a flow from the router
   208.2.2.2 to 208.1.1.1
   # ipsecadm flow -proto esp -dst 208.1.1.1 -spi 1000 -addr 208.2.2.2
       255.255.255.255 208.1.1.1 255.255.255.255 -local

   Setup a flow from the network 192.168.99.0/24, which is behind
   208.1.1.1, to 208.1.2.0/24
   # ipsecadm flow -proto esp -dst 208.1.1.1 -spi 1000 -addr 208.1.2.0
       255.255.255.0 192.168.99.0 255.255.255.0

   Setup a flow from the network 192.168.99.0/24, which is behind
   208.1.1.1, to 208.1.5.0/24
   # ipsecadm flow -proto esp -dst 208.1.1.1 -spi 1000 -addr 208.1.5.0
       255.255.255.0 192.168.99.0 255.255.255.0

   Now, setup a flow from 192.169.99.0/24, which is behind 208.1.1.1, to
   the router 208.2.2.2
   # ipsecadm flow -proto esp -dst 208.1.1.1 -spi 1000 -addr 208.2.2.2
       255.255.255.255 192.168.99.0 255.255.255.0 -local

   We're almost done... Two flows left to get 208.1.2.0/24 and
   208.1.5.0/24 from the router 208.2.2.2 to the router 208.1.1.1.
   # ipsecadm flow -proto esp -dst 208.1.1.1 -spi 1000 -addr 208.1.2.0
       255.255.255.0 208.2.2.2 255.255.255.255
       # ipsecadm flow -proto esp -dst 208.1.1.1 -spi 1000 -addr
       208.1.5.0 255.255.255.0 208.2.2.2 255.255.255.255

   If you have been using ipsecadm, and you want to get rid of any work
   that you've done, and start from scratch, do
   # ipsecadm flush

   This will flush all IPSec info (SPIs, flows, routing entries) from
   your system.

                  13.7 - How do I setup IPSec with photurisd?

   Photuris is not widely used and is still considered experimental as
   far as the RFC status is concerned. However, many people have used it
   with OpenBSD.

   To setup your photurisd, first edit /etc/photuris/secrets.conf on each
   host with photurisd.
bsd# cat /etc/photuris/secrets.conf
# Accepted keywords are:
# identity local "id" "secret"
# identity pair local "receivedid" "myid" "secret"
# identity remote "id" "secret"
# identity lookup "tag" username
# Simple
identity local "Default" "This should be changed."
identity remote "Default" "This should be changed."

   Change "This should be changed." to a key of your choice on the local
   config, and another key of your choice on the remote config. (Use the
   same config on your remote box but swap "local" and "remote" so that
   it sees itself as the local key.) Note that these keys will be
   replaced in a future version of photurisd that will carry out its
   initial key exchange with public keys.

   Make sure net.inet.ah.enable is set to 1.
bsd# sysctl -w net.inet.ah.enable=1
net.inet.ah.enable: 0 -> 1

   And run startkey.
bsd# startkey dst=remote.host

   Now, run tcpdump to verify that your packets are being encrypted with
   AH. (Run a ping in another window or session to generate traffic.)
   bsd# tcpdump proto ah

   You can also try using tcpdump by the host address if you aren't
   getting anything.
   bsd# tcpdump host remote.host

   You can make photurisd automatically set the source and destination
   host or networks in /etc/photuris/photuris.startup

                   13.8 - How do I setup IPSec with isakmpd?

   If you are thinking about VPNs or other traditional applications of
   IPSec, you probably are going to use ISAKMP. Some commercial
   implementations of IPSec do not provide any manual keying ability,
   instead they require you to use some form of ISAKMP.

  13.8.1 - What is isakmpd?

   ISAKMP (sometimes referred to as IKE, or Internet Key Exchange) is the
   key exchange mechanism for the VPN. It meets security concerns using
   the methods mentioned in RFC 2407, RFC 2408 and RFC 2409. ISAKMP
   manages the exchange of cryptographic keys that you would normally
   have to manage with [35]ipsecadm(8). It employs a two-phase process
   for establishing the IPSec parameters between two IPSec nodes.

   Phase 1 - The two ISAKMP peers establish a secure, authenticated
   channel upon which to communicate between two daemons. This
   establishes a Security Association (SA) between both hosts. Main Mode
   and Aggressive Mode are the methods used to establish this channel.
   Main Mode sends the various authentication information in a certain
   sequence, providing identity protection. Aggressive Mode does not
   provide identity protection because all of the authentication
   information is sent at the same time. Aggressive mode should only be
   used in such cases where network bandwidth is of concern.

   Phase 2 - Security Associations are negotiated on behalf of IPSec.
   Phase 2 is establishes tunnels or endpoint SA's between IPSec hosts.
   Quick Mode is used in Phase 2 because there is not need to repeat a
   full authentication because Phase 1 has already established the SAs.

   In brief, Phase 1 is used to get a secure channel in which to do the
   (quicker) phase 2 setups, there can be several. Phase 2 is used to
   setup the actual tunnels. In Phase 1, your IPSec nodes establish a
   connection where they exchange authentication (Either a X509
   certificate or a pre-shared secret). This allows each end to make sure
   the other end is authenticated. Phase 2 is an exchange of keys to
   determine how the data between the two will be encrypted.

  13.8.2 - How do I get started with isakmpd?

   By default, OpenBSD 2.6 comes with the proper binaries for ISAKMP and
   the IPSec stack. Unfortunately, the same cannot be said for the sample
   files. To retrieve them, you need to grab:
   /usr/src/sbin/isakmpd/samples/VPN-east.conf and
   /usr/src/sbin/isakmpd/samples/policy from the source tree. You can
   either use your CD (if you have one), [36]cvsweb, or the [37]command
   line CVS client. (Cvsweb has [38]VPN-east.conf and [39]policy readily
   available). For the purposes of this example, copy policy to
   /etc/isakmpd/policy. Copy VPN-east.conf to /etc/isakmpd/conf. Here we
   attempt to show you how to setup a VPN (tunnel). If you want to use
   isakmpd between single hosts, there are other configuration files in
   the samples directory.

   Your first step is to turn on esp. The [40]top of section 13.6 tells
   you how to do this both for run-time and boot. Next, you need to edit
   /etc/isakmpd/policy. This file tells ISAKMP who can access IPSec. In
   this scenario, the policy file states that anybody who sends data
   using Encapsulate Security Payload(ESP), and has authenticated with
   the passphrase mekmitasdigoat (or whatever passphrase you determine),
   is allowed to communicate with isakmpd. You can modify this file to
   let ISAKMP know that we only want to allow data signed with certain
   digital certificates or using a certain encryption transform. You
   could also allow anybody to access IPSec. This is only recommended for
   testing. To do this, edit your policy file to contain only the
   following lines:
KeyNote-Version: 2
Authoriser: "POLICY"

   The same policy file contains two lines that start with the $
   character. You need to remove these lines before using it, they are
   only for cvs.

   A more useful policy file for this example looks like this:
KeyNote-Version: 2
Comment: This policy accepts ESP SAs from a remote that uses the right password
Authoriser: "POLICY"
Licensees: "mekmitasdigoat"
Conditions: app_domain == "IPSec policy" &&
            esp_present == "yes" -> "true";

   This should be identical to the policy file included with OpenBSD 2.6.

   Implementing this will give you a basic VPN (tunnel) using ESP only.
   On host A, edit /etc/isakmpd/isakmpd.conf. The 249.2.2.2 sample IP
   address should be replaced with the external IP address of host A.
[General]
Retransmits=            5
Exchange-max-time=      120
Listen-on=              249.2.2.2

   Do similar for isakmpd.conf on host B. 249.3.3.3 represents the
   external IP address for host B.
[General]
Retransmits=            5
Exchange-max-time=      120
Listen-on=              249.3.3.3

   This is where you can setup the variables that will affect the main
   behaviour of isakmpd. It is okay to use the defaults here.
   The Listen-on= value specifies the IP that isakmpd should listen on.
   Only the Internet IP of your gateway is necessary. If you have
   multiple external interfaces on your gateway, you could list which
   interfaces you want to listening on by entering them using a comma
   separated list.

   Next, on host A, edit isakmpd.conf again.
[Phase 1]
249.3.3.3=              HostB

   On host B:
[Phase 1]
249.2.2.2=              HostA

   This section describes the IP addresses to accept in order to
   negotiate the phase 1 connection. Its value points to the section
   below (Remember that phase 1 simply authenticates the remote peer to
   make sure they are who they say they are). You can list multiple peers
   with additional lines in the format of IP_Address= <PEER-NAME>.

   Next, on host A:
[Phase 2]
Connections=            HostA-HostB

   On host B:
[Phase 2]
Connections=            HostB-HostA

   This describes Phase 2 of the connection. This is the phase that
   determines what protocols the two peers will use to communicate.

   The Connections= tag refers to the section below. It initiates the
   requirements or the accepted methods to set up Phase 2. This also
   tells ISAKMPD which connections to initiate once started. Note that
   you can have multiple sections as illustrated below if you are to
   connect with multiple peer hosts.

   If you do not have the IP address of the remote host, you can specify
   a Default= that points to a section describing a generic entry that
   will be referenced by any incoming IP that is not listed in the
   Connections= tag.

   On host A:
[HostB]
Phase=                  1
Transport=              udp
Local-address=          249.2.2.2
Address=                249.3.3.3
Configuration=          Default-main-mode
Authentication=         mekmitasdigoat
#Flags=

   On host B:
[HostA]
Phase=                  1
Transport=              udp
Local-address=          249.3.3.3
Address=                249.2.2.2
Configuration=          Default-main-mode
Authentication=         mekmitasdigoat
#Flags=

   These represent the sections referred to by the Phase 1 section above.
   They each describe the requirements that the peer gateway must fulfill
   in order to proceed to Phase 2. There are many other options here but
   the ones mentioned above are the minimum requirements.
   Phase=1 is required because the ISAKMPD code uses the same procedures
   to process Phase 1 and Phase 2. It must be 1 or nothing will work.
   Transport= is gives you different possibilities for different peers.
   It's suggested that udp be used here so we'll leave it at that.
   Please note that some peers may be behind a firewall that doesn't let
   UDP traffic through. Obviously, this needs to be determined before
   setup. Local-address is the destination address that the incoming
   packets point to. In some cases, you can be listening on different
   Interfaces for Phase 1 connections. In this example, there is only 1
   interface listening, therefore this is the IP of the listening
   interface on this peer.
   Address= is the address that points to the source IP of the incoming
   packets. This usually points to the peer gateway. This needs further
   explanation, because the source IP address of the peer may be unknown!
   Configuration= points to the section below. You can specify multiple
   sections like this. We use the default one specified by the sample
   file.
   Authentication= is the pre-shared secret to be used for this
   particular peer. It is more or less a passphrase that each peer uses.
   This passphrase gets passed to policy to verify whether this peer is
   allowed to use IPSEC with this host. If you change this phrase, you
   must also change it in the policy file because the sample file
   provides for this passphrase. If you decided to go with a minimum
   policy file then you can specify whatever you want here.
   Flags= is not currently being used. The RFCs leave room for extra
   options to be specified for phase 1.
   There are other tags here that will allow for other options to be set.
   Refer to [41]isakmpd.conf(5) for descriptions.

   On Host A:
[HostA-HostB]
Phase=                  2
ISAKMP-peer=            HostB
Configuration=          Default-quick-mode
Local-ID=               Net-A
Remote-ID=              Net-B

   On Host B:
[HostB-HostA]
Phase=                  2
ISAKMP-peer=            HostA
Configuration=          Default-quick-mode
Local-ID=               Net-B
Remote-ID=              Net-A

   These represent the sections referred to by the Phase 2 section above.
   They are the individual settings that ISAKMPD must use to talk between
   the two gateways for the particular connection. Phase=2 is required
   because ISAKMPD code uses the same functions to authenticate Phase 1
   and Phase 2. This is required for the VPN to work.
   ISAKMPD-Peer= is the name of Host section above. This means that we
   are talking to that particular peer to establish a Phase 2 connection.
   This is provided because you can have multiple sections to describe
   isakmp peers and connections. Configuration= refers to the section
   below that describes the standards by which this host and the
   particular peer for this connection must abide.
   Local-ID= refers to an IPSec-ID section below that describes our
   Private Network to the peer gateway. This is the portion that is
   passed so that the other gateway can set up the proper routing table
   that will transfer data over the VPN to our network.
   Remote-ID= refers to an IPSec-ID section below that describes what is
   supposed to be the remote Private Network to our host. This portion is
   interpreted to set up the proper routing tables that will transfer
   data from our Private Network over the VPN to the remote Private
   Network.
   There is another tag that is supported here called Flags=. If you
   require this tag, read [42]isakmpd.conf(5).

   This is the IPSec-ID section. These entries need to exist in the
   isakmpd.conf files for both Host A and Host B. This example will setup
   192.168.1.0/255.255.255.0 for Host A (which was connected to Net-A
   above) and 192.168.20.0/255.255.255.0 for Host B (Net-B above).
[Net-A]
ID-type=                IPV4_ADDR_SUBNET
Network=                192.168.1.0
Netmask=                255.255.255.0

[Net-B]
ID-type=                IPV4_ADDR_SUBNET
Network=                192.168.20.0
Netmask=                255.255.255.0

   These two sections are in the conf file of each host. They are the
   sections referenced by the Local-ID and Remote-ID identifiers. They
   describe the routes that should be set up to allow traffic from one
   private network to another.
   ID-type= can be IPV4_ADDR_SUBNET or IPV4_ADDR (RFC2708 mentions more
   possible values. Currently only IPv4 is supported in the OpenBSD 2.6
   implementation. IPv6 may be supported in OpenBSD-current. )

   Now, on both hosts, the sample file should read:
[Default-main-mode]
DOI=                    IPSEC
EXCHANGE_TYPE=          ID_PROT
Transforms=             3DES-SHA

   This section describes the requirements for the encryption methods of
   Phase 1 connections. The name reflects the value of Configuration=
   variable. As we can see here, we are stating our Domain of Interest
   which is IPSEC. The EXCHANGE_TYPE variable is set to ID_PROT for Phase
   1, which identifies the protocols to be covered by this
   Authentication.
   Transforms= is the transform required (or assigned) for this exchange.
   In this case, this points to the section below in the configuration
   file that says we are receiving a packet encrypted with 3DES and a
   checksum verifiable with SHA. There are a bunch of different
   transforms defined inside the sample VPN-east.conf. These are provided
   because 3DES and SHA are not always supported across different
   platforms. For OpenBSD there should be no reason to change this for a
   basic setup. Feel free to create multiples of this section and change
   the transform. The only requirement is that you change the
   Configuration= variable.
[Default-quick-mode]
DOI=                    IPSEC
EXCHANGE_TYPE=          QUICK_MODE
Suites=                 QM-ESP-3DES-SHA-PFS-SUITE,QM-ESP-DES-MD5-PFS-SUITE

   This section describes the requirements for the encryption of the data
   to be sent through the VPN and is referred to by Configuration above.
   Note the difference between this section and the Phase 1 equivalent
   just above is that the EXCHANGE_TYPE is QUICK_MODE. This is always the
   case for Phase 2.
   Suites= points to a IPSec Suite section describing the different
   encryption schemes available between the two hosts.
   There is much more to be said about ISAKMP and IPSec. By using the
   above basic descriptions you should be able to create a simple but
   solid VPN that cares and feeds itself. This is the bare minimum
   isakmpd.conf for both hosts here.

  13.8.3 - Starting isakmpd

   You may wish to use $ isakmpd -d -DA=99
   the first time you decide to run this daemon. The daemon will not be
   running in daemon mode but as a regular process. It will log
   everything to your terminal. To stop isakmpd and flush the routes, you
   need to kill the isakmpd process on each node, and run ipsecadm flush.

             13.9 - What IKE clients are compatible with isakmpd?

   isakmpd is the ISAKMP/Oakley key management daemon that comes with
   OpenBSD. We suspect that it interoperates, at least partially, with
   most any ISAKMP implementation, but the following have actually been
   tested. Note that some isakmp software out there is actually based on
   the OpenBSD isakmp daemon.

   The following MS-Windows clients have been reported to be compatible:
     * [43]TimeStep PERMIT/Client
     * [44]Ashley Laurent VPCom VPN software
     * [45]PGP VPN software
     * [46]Radguard cIPro client
     * [47]Cisco Win32 client (unreleased?)

   The following gateways/routers have been reported to be compatible:
     * [48]Cisco IOS
     * [49]Cisco PIX
     * [50]Intel LanRover
     * [51]TimeStep PERMIT/Gate
     * [52]Cendio Fuego
     * [53]KAME for FreeBSD
     * [54]FreeS/WAN for Linux
     * [55]Axent Raptor
     * [56]Ericsson eBox
     * [57]Radguard cIPro-VPN
     * [58]F-Secure VPN+
     * [59]Teamware TWISS
     * [60]3com Pathbuilder
     * [61]Nortel Contivity
     * [62]CheckPoint FW-1

                       13.10 - Troubleshooting IPSec/VPN

   Your first tool for troubleshooting IPSec is [63]tcpdump(8). Use
   tcpdump to look for several things.

   First, if you are running OpenBSD 2.6, you have an enhanced version of
   tcpdump which can show some information about ESP and AH packets. If
   you are using tcpdump from OpenBSD 2.5 or on another operating system,
   chances are you have an older version that will simply show the
   protocol number for AH or ESP if it sees either kind of packets on
   your network. (ESP is IP protocol 50, AH is 51)
     * With tcpdump, look and see if traffic is using AH/ESP or
       cleartext. If your traffic is in cleartext, then your flows are
       setup incorrectly or your isakmp is not negotiating properly. Use
       [64]ping(8) to generate simple traffic.
        For instance, I have two hosts, 208.1.1.1 and 208.2.2.2. Logged
            in to 208.2.2.2, I am doing this:
vpn# ping -c 3 208.1.1.1
PING esp.mil (208.1.1.1): 56 data bytes
64 bytes from 208.1.1.1: icmp_seq=0 ttl=255 time=190.155 ms
64 bytes from 208.1.1.1: icmp_seq=1 ttl=255 time=201.040 ms
64 bytes from 208.1.1.1: icmp_seq=2 ttl=255 time=165.481 ms
--- esp.mil ping statistics ---
3 packets transmitted, 3 packets received, 0% packet loss
round-trip min/avg/max = 165.481/185.558/201.040 ms
            And in another session, I can see my encapsulated pings:
vpn# tcpdump -ni fxp7 host 208.1.1.1
tcpdump: listening on fxp7
14:12:19.630274 esp 208.2.2.2 > 208.1.1.1 spi 0x00001000 seq 4535 len 116
14:12:19.813519 esp 208.1.1.1 > 208.2.2.2 spi 0x00001001 seq 49313 len 116
14:12:20.630277 esp 208.2.2.2 > 208.1.1.1 spi 0x00001000 seq 4536 len 116
14:12:20.832458 esp 208.1.1.1 > 208.2.2.2 spi 0x00001001 seq 49314 len 116
14:12:21.630273 esp 208.2.2.2 > 208.1.1.1 spi 0x00001000 seq 4537 len 116
^C
1831 packets received by filter
0 packets dropped by kernel
     * IKE runs on UDP port 500. If this is locked out through a firewall
       or packet filter, then you need to change it!
     * With tcpdump on OpenBSD, you can decode most cleartext parts of
       Internet Key Exchange sessions. If you are using tcpdump from a
       version of OpenBSD that is newer then 2.6-RELEASE, tcpdump will
       also show AH payload data. If you are interested in a patch to do
       this for an older version of tcpdump, contact [65]ho@@openbsd.org.
     * Mount a /kern filesystem (if you don't use one by default
       already.)
        # mkdir /kern; mount -t kernfs /kern /kern
       In /kern, there is a table of current SA/SPIs, including which
       have flows (outgoing SAs) or not (incoming SAs). There are also
       traffic counters which you can use to see what traffic going
       where.
     * Finally, you can use [66]netstat(1) to see your SAs.
vpn% netstat -rn -f encap
Routing tables

Encap:
Source             Port  Destination        Port  Proto SA(Address/SPI/Proto)
0.0.0.0/32         0     192.168.99/24      0     0     208.1.1.1/00001000/50
0.0.0.0/32         0     208.1.1.1/32       0     0     208.1.1.1/00001000/50
208.1.2.0/24       0     192.168.99/24      0     0     208.1.1.1/00001000/50
208.1.2.0/24       0     208.1.1.1/32       0     0     208.1.1.1/00001000/50
208.1.5.0/24       0     192.168.99/24      0     0     208.1.1.1/00001000/50
208.1.5.0/24       0     208.1.1.1/32       0     0     208.1.1.1/00001000/50
208.2.2.2/32       0     192.168.99/24      0     0     208.1.1.1/00001000/50
208.2.2.2/32       0     208.1.1.1/32       0     0     208.1.1.1/00001000/50
     * If all else fails, recompile your kernel with option ENCDEBUG.
       Then, set the sysctl net.inet.ip.encdebug to 1. Look in your dmesg
       for warnings or errors, and report them using [67]sendbug(1) to
       the OpenBSD developers. Alternately, if you are not sure you have
       actually run into a bug, you may want to send a message to one of
       the [68]mailing lists.

                         13.11 - Related Documentation

   IPSec is partially documented in the [69]vpn(8) man page. There are
   various configuration templates in [70]/usr/share/ipsec/ directory
   which can also assist you. The manual pages for [71]enc(4),
   [72]ipsec(4), [73]ipsecadm(8), [74]photurisd(8), [75]startkey(1),
   [76]isakmpd(8) and [77]isakmpd.conf(5) are detailed and can assist in
   setup and operation of IPSec.

   Other links...
     * [78]IETF IPSec Working Group
     * [79]SSH IPSec interoperability Test Node
     * [80]NIST IPSec Web Based Interoperability Tester
     * [81]A port of OpenBSD's IPSec to FreeBSD
     * [82]FreeS/WAN - IPSec for Linux
     * [83]Lots of IPSec related links
     * [84]OpenBSD 2.4 VPN Configuration Mini-FAQ

   And on to the RFCs...
     * [85]RFC 2085 - HMAC-MD5 IP Authentication with Replay Prevention
     * [86]RFC 2104 - HMAC: Keyed-Hashing for Message Authentication
     * [87]RFC 2207 - RSVP Extensions for IPSec Data Flows
     * [88]RFC 2401 - Security Architecture for the Internet Protocol
       (IPSec)
     * [89]RFC 2402 - IP Authentication Header (AH)
     * [90]RFC 2403 - The Use of HMAC-MD5-96 within ESP and AH
     * [91]RFC 2404 - The Use of HMAC-SHA-1-96 within ESP and AH
     * [92]RFC 2405 - The ESP DES-CBC Cipher Algorithm With Explicit IV
     * [93]RFC 2406 - IP Encapsulating Security Payload (ESP)
     * [94]RFC 2407 - The Internet IP Security Domain of Interpretation
       for ISAKMP
     * [95]RFC 2408 - Internet Security Association and Key Management
       Protocol (ISAKMP)
     * [96]RFC 2409 - The Internet Key Exchange (IKE)
     * [97]RFC 2410 - The NULL Encryption Algorithm and Its Use With
       IPsec (ha ha...)
     * [98]RFC 2411 - IP Security Document Roadmap
     * [99]RFC 2412 - The OAKLEY Key Determination Protocol
     * [100]RFC 2451 - The ESP CBC-Mode Cipher Algorithms
     * [101]RFC 2522 - Photuris: Session-Key Management Protocol
     * [102]RFC 2523 - Photuris: Extended Schemes and Attributes
     * [103]RFC 2709 - Security Model with Tunnel-mode IPsec for NAT
       Domains

   [104][Back to Main Index] [105][To Section 12.0 - For Advanced Users]
   [106][To Section 14.0 - Using disks in OpenBSD]
     _________________________________________________________________

   [107][back] [108]www@@openbsd.org
   $OpenBSD: obsd-faq.txt,v 1.26 2001/08/08 21:06:33 jsyn Exp $

References

   1. http://openbsd.org/faq/index.html
   2. http://openbsd.org/faq/faq12.html
   3. http://openbsd.org/faq/faq14.html
   4. http://www.freebsd.org/~julian/IPSEC_4_Dummies.html
   5. http://www.openbsd.org/cgi-bin/man.cgi?query=ipsec&sektion=4&format=html
   6. http://www.secureops.com/resources/vpn/
   7. http://openbsd.org/faq/faq13.html#13.1
   8. http://openbsd.org/faq/faq13.html#13.2
   9. http://openbsd.org/faq/faq13.html#13.3
  10. http://openbsd.org/faq/faq13.html#13.4
  11. http://openbsd.org/faq/faq13.html#13.5
  12. http://openbsd.org/faq/faq13.html#13.6
  13. http://openbsd.org/faq/faq13.html#13.7
  14. http://openbsd.org/faq/faq13.html#13.8
  15. http://openbsd.org/faq/faq13.html#13.9
  16. http://openbsd.org/faq/faq13.html#13.10
  17. http://openbsd.org/faq/faq13.html#13.11
  18. http://www.openbsd.org/cgi-bin/cvsweb/src/etc/protocols?rev=1.8
  19. http://openbsd.org/faq/faq6.html
  20. http://www.3com.com/nsc/501302s.html
  21. http://www.openbsd.org/cgi-bin/man.cgi?query=ipsecadm&apropos=0&sektion=8&format=html
  22. http://www.cis.ohio-state.edu/htbin/rfc/rfc2402.html
  23. http://www.cis.ohio-state.edu/htbin/rfc/rfc2406.html
  24. http://www.openbsd.org/cgi-bin/man.cgi?query=ipsecadm&apropos=0&sektion=8&format=html
  25. http://www.cis.ohio-state.edu/htbin/rfc/rfc2522.html
  26. http://www.cis.ohio-state.edu/htbin/rfc/rfc2523.html
  27. http://www.cis.ohio-state.edu/htbin/rfc/rfc2407.html
  28. http://www.cis.ohio-state.edu/htbin/rfc/rfc2408.html
  29. http://www.cis.ohio-state.edu/htbin/rfc/rfc2409.html
  30. http://www.openbsd.org/cgi-bin/man.cgi?query=photurisd&apropos=0&sektion=8&format=html
  31. http://www.openbsd.org/cgi-bin/man.cgi?query=isakmpd&apropos=0&sektion=8&format=html
  32. http://www.openbsd.org/cgi-bin/cvsweb/src/share/ipsec/rc.vpn?rev=1.3
  33. http://openbsd.org/faq/faq13.html#13.4
  34. http://www.openbsd.org/cgi-bin/cvsweb/src/share/ipsec/rc.vpn?rev=1.3
  35. http://www.openbsd.org/cgi-bin/man.cgi?query=ipsecadm&apropos=0&sektion=8
  36. http://www.openbsd.org/cgi-bin/cvsweb/
  37. http://www.usa.openbsd.org/anoncvs.html
  38. http://www.openbsd.org/cgi-bin/cvsweb/src/sbin/isakmpd/samples/VPN-east.conf
  39. http://www.openbsd.org/cgi-bin/cvsweb/src/sbin/isakmpd/samples/policy
  40. http://openbsd.org/faq/faq13.html#13.6
  41. http://www.openbsd.org/cgi-bin/man.cgi?query=isakmpd.conf&apropos=0&sektion=5&format=html
  42. http://www.openbsd.org/cgi-bin/man.cgi?query=isakmpd.conf&apropos=0&sektion=5&format=html
  43. http://www.timestep.com/
  44. http://www.vpcom.com/
  45. http://www.nai.com/asp_set/products/tns/pgp_vpn.asp
  46. http://www.radguard.com/
  47. http://www.cisco.com/
  48. http://www.cisco.com/
  49. http://www.cisco.com/
  50. http://www.intel.com/
  51. http://www.timestep.com/
  52. http://www.cendio.com/
  53. http://www.kame.net/
  54. http://www.xs4all.nl/~freeswan/
  55. http://www.axent.com/
  56. http://www.ericsson.com/
  57. http://www.radguard.com/
  58. http://www.f-secure.com/
  59. http://www.teamware.com/
  60. http://www.3com.com/
  61. http://www.nortelnetworks.com/
  62. http://www.checkpoint.com/
  63. http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&apropos=0&sektion=8&format=html
  64. http://www.openbsd.org/cgi-bin/man.cgi?query=ping&apropos=0&sektion=8&format=html
  65. mailto:ho@@openbsd.org
  66. http://www.openbsd.org/cgi-bin/man.cgi?query=netstat&apropos=0&sektion=1&format=html
  67. http://www.openbsd.org/cgi-bin/man.cgi?query=sendbug&apropos=0&sektion=1&format=html
  68. http://openbsd.org/mail.html
  69. http://www.openbsd.org/cgi-bin/man.cgi?query=vpn&apropos=0&sektion=0&format=html
  70. http://www.openbsd.org/cgi-bin/cvsweb/src/share/ipsec/
  71. http://www.openbsd.org/cgi-bin/man.cgi?query=enc&apropos=0&sektion=4&format=html
  72. http://www.openbsd.org/cgi-bin/man.cgi?query=ipsec&apropos=0&sektion=4&format=html
  73. http://www.openbsd.org/cgi-bin/man.cgi?query=ipsecadm&apropos=0&sektion=8&format=html
  74. http://www.openbsd.org/cgi-bin/man.cgi?query=photurisd&apropos=0&sektion=8&format=html
  75. http://www.openbsd.org/cgi-bin/man.cgi?query=startkey&apropos=0&sektion=1&format=html
  76. http://www.openbsd.org/cgi-bin/man.cgi?query=isakmpd&apropos=0&sektion=8&format=html
  77. http://www.openbsd.org/cgi-bin/man.cgi?query=isakmpd.conf&apropos=0&sektion=5&format=html
  78. http://www.ietf.org/html.charters/ipsec-charter.html
  79. http://isakmp-test.ssh.fi/
  80. http://ipsec-wit.antd.nist.gov/
  81. http://www.r4k.net/ipsec/
  82. http://www.xs4all.nl/~freeswan/
  83. http://www.cs.umass.edu/~lmccarth/ipsec.html
  84. http://www.codetalker.com/greenbox/docs/vpn-24-minifaq.html
  85. http://www.cis.ohio-state.edu/htbin/rfc/rfc2085.html
  86. http://www.cis.ohio-state.edu/htbin/rfc/rfc2104.html
  87. http://www.cis.ohio-state.edu/htbin/rfc/rfc2207.html
  88. http://www.cis.ohio-state.edu/htbin/rfc/rfc2401.html
  89. http://www.cis.ohio-state.edu/htbin/rfc/rfc2402.html
  90. http://www.cis.ohio-state.edu/htbin/rfc/rfc2403.html
  91. http://www.cis.ohio-state.edu/htbin/rfc/rfc2404.html
  92. http://www.cis.ohio-state.edu/htbin/rfc/rfc2405.html
  93. http://www.cis.ohio-state.edu/htbin/rfc/rfc2406.html
  94. http://www.cis.ohio-state.edu/htbin/rfc/rfc2407.html
  95. http://www.cis.ohio-state.edu/htbin/rfc/rfc2408.html
  96. http://www.cis.ohio-state.edu/htbin/rfc/rfc2409.html
  97. http://www.cis.ohio-state.edu/htbin/rfc/rfc2410.html
  98. http://www.cis.ohio-state.edu/htbin/rfc/rfc2411.html
  99. http://www.cis.ohio-state.edu/htbin/rfc/rfc2412.html
 100. http://www.cis.ohio-state.edu/htbin/rfc/rfc2451.html
 101. http://www.cis.ohio-state.edu/htbin/rfc/rfc2522.html
 102. http://www.cis.ohio-state.edu/htbin/rfc/rfc2523.html
 103. http://www.cis.ohio-state.edu/htbin/rfc/rfc2709.html
 104. http://openbsd.org/faq/index.html
 105. http://openbsd.org/faq/faq12.html
 106. http://openbsd.org/faq/faq14.html
 107. http://openbsd.org/faq/index.html
 108. mailto:www@@openbsd.org
d5956 2
d5959 1
a5959 1
   [OpenBSD]
d5961 1
a5961 2
14.0 - Disk setup
     _________________________________________________________________
d5963 1
a5963 197
   Table of Contents
     * [1]14.1 - Using OpenBSD's Disklabel
     * [2]14.2 - Using OpenBSD's fdisk
     * [3]14.3 - Adding extra disks in OpenBSD
     * [4]14.4 - How to swap to a file
     * [5]14.5 - Soft-updates
     * [6]14.6 - When I boot after installation of OpenBSD/i386, it stops
       at "Using partition 3 id 0".
     * [7]14.7 - How do I get a dmesg from a boot floppy?
     * [8]14.8 - Installing Bootblocks - i386 specific
     _________________________________________________________________

Using OpenBSD's Disklabel

  Table of Contents

     * [9]What is disklabel(8)?
     * [10]Disklabel during the OpenBSD install
     * [11]Common disklabel(8) uses.

  What is disklabel(8)?

   Disklabel's are created to allow an efficient interface between your
   disk and the disk drivers contained within the kernel. Labels hold
   certain information about your disk, like your drive geometry and
   information about your filesystems. This is then used by the bootstrap
   program to load the drive and to know where filesystems are contained
   on the drive. Labels are also used in conjunction with the filesystems
   to create a more efficient environment. You can read more in-depth
   information about disklabel by reading the [12]disklabel(5) man page.

   As an additional gain, using disklabel helps overcome architecture
   limitations on disk partitioning. For example, on i386, you can only
   have 4 primary partitions. (Partitions that other operating systems,
   such as Windows NT or DOS can see.) With disklabel(8), you use one of
   these 'primary' partitions to store *all* of your OpenBSD partitions
   (eg. 'swap', '/', '/usr' and '/var'). And you still have 3 more
   partitions available for other OSs!

  disklabel(8) during OpenBSD's install

   One of the major parts of OpenBSD's install is your initial creation
   of labels. This comes (for i386 users) directly after using
   [13]fdisk(1). During the install you use disklabel to create your
   separate labels which will contain your separate mountpoints. During
   the install, you can set your mountpoints from within disklabel(8),
   but this isn't completely necessary considering you will be prompted
   later to confirm you choices. But it does make your install go just a
   little smoother.

   Since this is during the install you won't have any existing labels,
   and they will need to be created. The first label you will create is
   the label 'a'. This label SHOULD be your where / will be mounted. You
   can see recommended partitions that should be created and their sizes
   by reading [14]faq4.3. For servers it is recommended that you create
   at least these label's separately. For desktop users creating one
   mountpoint at / will probably suffice. When initially creating your
   root partition ( 'a' label ), keep in mind that you will need SOME
   space left for your swap label. Now that the basics have been
   explained, here is an example of using disklabel during an install. In
   this first example it is assumed that OpenBSD will be the only
   operating system on this computer, and that a full install will be
   done.

If this disk is shared with other operating systems, those operating systems
should have a BIOS partition entry that spans the space they occupy completely.
For safety, also make sure all OpenBSD file systems are within the offset and
size specified in the 'A6' BIOS partition table.  (By default, the disklabel
editor will try to enforce this).  If you are unsure of how to use multiple
partitions properly (ie. separating /,  /usr, /tmp, /var, /usr/local, and other
things) just split the space into a root and swap partition for now.

# using MBR partition 3: type A6 off 63 (0x3f) size 4991553 (0x4c2a41)

Treating sectors 63-16386300 as the OpenBSD portion of the disk.
You can use the 'b' command to change this.

Initial label editor (enter '?' for help at any prompt)
> d a
> a a
offset: [63] <Enter>
size: [16386237] 64M
Rounding to nearest cylinder: 131040
FS type: [4.2BSD] <Enter>
mount point: [none] /
fragment size: [1024] <Enter>
block size: [8192] <Enter>
cpg: [16] <Enter>
> a b
offset: [131103] <Enter>
size: [16255197] 64M
Rounding to nearest cylinder: 131040
FS type: [swap] <Enter>

   At this point we have created a 64M root partition mounted at /, and a
   64Meg swap partition. Notice that the offset starts at sector 63. This
   is what you want. When it comes to the size, disklabel will show your
   size in sectors, however, you don't need to enter sizes in the same
   format. Like the example above you can enter sizes in the manner of 64
   Megabytes = 64M and 2 Gigabytes = 2G. Disklabel will then round to the
   nearest cylinder. In the example above you will also notice that
   disklabel assumes that label 'b' will be a swap. This is a correct
   assumption as the GENERIC kernel is set to look for swap on label 'b',
   and you should just follow this guideline and use 'b' as your swap
   area.

   The next example will take you through the creation of two more
   labels. This means that it's not a complete install, as the size of
   these won't be enough to install OpenBSD to its fullest. Showing the
   creation of all the partitions would just be repetitive.
> a d
offset: [262143] <Enter>
size: [16124157] 64M
Rounding to nearest cylinder: 131040
FS type: [4.2BSD] <Enter>
mount point: [none] /tmp
fragment size: [1024] <Enter>
block size: [8192] <Enter>
cpg: [16] <Enter>
> a e
offset: [393183] <Enter>
size: [15993117] 64M
Rounding to nearest cylinder: 131040
FS type: [4.2BSD] <Enter>
mount point: [none] /var
fragment size: [1024] <Enter>
block size: [8192] <Enter>
cpg: [16] <Enter>

   In the above example, there are two things you might notice. One being
   that the offset is automatically figured out for you to be the next in
   order. When doing an install of this sort, you won't need to mess with
   changing the offsets at all. Another difference you might notice will
   be that label 'c' has been skipped. This is done for a reason, which
   is that label 'c' is a label that represents the whole disk. For this
   reason you shouldn't deal with label 'c' in any way.

   Once all your labels have been created all thats left to do is write
   the labels to disk, and move on in the installation process. To write
   everything and quit disklabel (and continue with the install) do:
> w
> q

   *NOTE* - For user's with large drives. If your bios isn't able to
   support a drive of that size OpenBSD cannot support it either.
   Otherwise OpenBSD should be able to handle your drive just fine. If
   you are in a situation where your bios doesn't support your drive, you
   can try Maxtor EZ-Drive or other similar overlay product.

  Common uses for disklabel(8)

   Once your system is installed, you shouldn't need to use disklabel too
   often. But some times you will need to use disklabel are when adding,
   removing or restructuring your disks. One of the first things you will
   need to do is view your current disklabel. To do this simply type:
# disklabel wd0 <----- Or whatever disk device you'd like to view

# using MBR partition 3: type A6 off 64 (0x40) size 16777152 (0xffffc0)
# /dev/rwd0c:
type: ESDI
disk:
label: TOSHIBA MK2720FC
flags:
bytes/sector: 512
sectors/track: 63
tracks/cylinder: 16
sectors/cylinder: 1008
cylinders: 2633
total sectors: 2654064
rpm: 3600
interleave: 1
trackskew: 0
cylinderskew: 0
headswitch: 0           # milliseconds
track-to-track seek: 0  # milliseconds
drivedata: 0

16 partitions:
#        size   offset    fstype   [fsize bsize   cpg]
  a:  2071440    65583    4.2BSD     1024  8192    16   # (Cyl.   65*- 2120)
  b:    65520       63      swap                        # (Cyl.    0*- 65)
  c:  2654064        0    unused        0     0         # (Cyl.    0 - 2632)
  j:   512001  2137023    4.2BSD     1024  8192    16   # (Cyl. 2120*- 2627*)

   The above command simply allows you to view the existing disklabel,
   and assuring that you dont mess anything up. ( Which we all need
   sometimes. ) But to be able to make changes you must use the -E option
   with disklabel like so:
# disklabel -E wd0

   This will bring you to a prompt, the same as the one that you used
   during the OpenBSD install. Probably the single most important command
   at this prompt is '?'. This will give you a list of possible options
   pertaining to disklabel. You can even view the entire disklabel(8) man
   page with the 'M' command. From this prompt, you will do all of your
   adding, deleting and changing of partitions. For additional
   information read the [15]disklabel(8) man page.
d5965 88
a6052 1
14.2 - Using fdisk
d6054 1
a6054 1
   First be sure to check the fdisk main page. [16]fdisk(8)
d6056 132
a6187 84
   Fdisk is a program to help with the maintenance of your partitions.
   This program is used at install time to set up your OpenBSD partition
   (this partition can contain several labels, each with
   filesystems/swap/etc.). It can divide space on your drives and set one
   active. This program will usually be used in Single User Mode ( boot
   -s ). Fdisk also sets the MBR on your various hard disks.

   For installation purposes, most times you'll only need ONE OpenBSD
   partition, and then using disklabel to put a swap and a filesystem on
   it.

   To just view your partition table using fdisk just use:
# fdisk fd0

   Which will give an output similar to this:
         Disk: fd0       geometry: 80/2/18 [2880 sectors]
         Offset: 0       Signatures: 0xAA55,0x0
                  Starting        Ending
          #: id  cyl  hd sec -  cyl  hd sec [     start -       size]
----------------------------------------------------------------------
         *0: A6    0   0   1 -   79   1  18 [         0 -       2880] OpenBSD
          1: 00    0   0   0 -    0   0   0 [         0 -          0] unused
          2: A7    0   0   2 -   79   1  18 [         1 -       2879] NEXTSTEP
          3: 00    0   0   0 -    0   0   0 [         0 -          0] unused

   In this example we are viewing the fdisk output of floppy drive. We
   can see the OpenBSD partition (A6) and its size. The * tells us that
   the OpenBSD partition is a bootable partition.

   In the previous example we just viewed our information. What if we
   want to edit our partition table? Well, to do so we must use the -e
   flag. This will bring up a command line prompt to interact with fdisk.
# fdisk -e wd0
Enter 'help' for information
fdisk: 1> help
        help            Command help list
        manual          Show entire OpenBSD man page for fdisk
        reinit          Re-initialize loaded MBR (to defaults)
        disk            Edit current drive stats
        edit            Edit given table entry
        flag            Flag given table entry as bootable
        update          Update machine code in loaded MBR
        select          Select extended partition table entry MBR
        print           Print loaded MBR partition table
        write           Write loaded MBR to disk
        exit            Exit edit of current MBR, without saving changes
        quit            Quit edit of current MBR, saving current changes
        abort           Abort program without saving current changes
fdisk: 1>

   It is perfectly safe in fdisk to go in and explore, just make sure to
   answer N to saving the changes and *DON'T* use the write command.

   Here is an overview of the commands you can use when you choose the -e
   flag.
     * help Display a list of commands that fdisk understands in the
       interactive edit mode.
     * reinit Initialize the currently selected, in-memory copy of the
       boot block.
     * disk Display the current drive geometry that fdisk has probed. You
       are given a chance to edit it if you wish.
     * edit Edit a given table entry in the memory copy of the current
       boot block. You may edit either in BIOS geometry mode, or in
       sector offsets and sizes.
     * flag Make the given partition table entry bootable. Only one entry
       can be marked bootable. If you wish to boot from an extended
       partition, you will need to mark the partition table entry for the
       extended partition as bootable.
     * update Update the machine code in the memory copy of the currently
       selected boot block.
     * select Select and load into memory the boot block pointed to by
       the extended partition table entry in the current boot block.
     * print Print the currently selected in-memory copy of the boot
       block and its MBR table to the terminal.
     * write Write the in-memory copy of the boot block to disk. You will
       be asked to confirm this operation.
     * exit Exit the current level of fdisk, either returning to the
       previously selected in-memory copy of a boot block, or exiting the
       program if there is none.
     * quit Exit the current level of fdisk, either returning to the
       previously selected in-memory copy of a boot block, or exiting the
       program if there is none. Unlike exit it does write the modified
       block out.
     * abort Quit program without saving current changes.
d6189 1
a6189 1
14.3 - Adding extra disks in OpenBSD
d6191 232
a6422 82
   Well once you get your disk installed PROPERLY you need to use
   [17]fdisk(8) (i386 only) and [18]disklabel(8) to set up your disk in
   OpenBSD.

   For i386 folks, start with fdisk. Other architectures can ignore this.
# fdisk -i sd2

   This will initialize the disk's "real" partition table for exclusive
   use by OpenBSD. Next you need to create a disklabel for it. This will
   seem confusing.
# disklabel -e sd2

(screen goes blank, your $EDITOR comes up)
type: SCSI
...bla...
sectors/track: 63
total sectors: 6185088
...bla...
16 partitions:
#        size   offset    fstype   [fsize bsize   cpg]
  c:  6185088        0    unused        0     0         # (Cyl.    0 - 6135)
  d:  1405080       63    4.2BSD     1024  8192    16   # (Cyl.    0*- 1393*)
  e:  4779945  1405143    4.2BSD     1024  8192    16   # (Cyl. 1393*- 6135)

   First, ignore the 'c' partition, it's always there and is for programs
   like disklabel to function! For normal operations, fsize should always
   be 1024, bsize should always be 8192, and cpg should always be 16.
   Fstype is 4.2BSD. Total sectors is the total size of the disk. Say
   this is a 3 gigabyte disk. Three gigabytes in disk manufacturer terms
   is 3000 megabytes. So divide 6185088/3000 (use bc(1)). You get 2061.
   So to make up partition sizes for a, d, e, f, g, ... just multiply
   X*2061 to get X megabytes of space on that partition. The offset for
   your first new partition should be the same as the "sectors/track"
   reported earlier in disklabel's output. For us it is 63. The offset
   for each partition afterwards should be a combination of the size of
   each partition and the offset of each partition (Except the C
   partition, since it has no play into this equation.)

   Or, if you just want one partition on the disk, say you will use the
   whole thing for web storage or a home directory or something, just
   take the total size of the disk and subtract the sectors per track
   from it. 6185088-63 = 6185025. Your partition is
    d:  6185025       63    4.2BSD     1024  8192    16

   If all this seems needlessly complex, you can just use disklabel -E to
   get the same partitioning mode that you got on your install disk!
   There, you can just use "96M" to specify "96 megabytes". (Or, if you
   have a disk big enough, 96G for 96 gigs!) Unfortunately, the -E mode
   uses the BIOS disk geometry, not the real disk geometry, and often
   times the two are not the same. To get around this limitation, type 'g
   d' for 'geometry disk'. (Other options are 'g b' for 'geometry bios'
   and 'g u' for geometry user, or simply, what the label said before
   disklabel made any changes.)

   That was a lot. But you are not finished. Finally, you need to create
   the filesystem on that disk using [19]newfs(8).

bsd# newfs wd1a

   Or whatever your disk was named as per OpenBSD's disk numbering
   scheme. (Look at the output from dmesg(1) to see what your disk was
   named by OpenBSD.)

   Now figure out where you are going to mount this new partition you
   just created. Say you want to put it on /u. First, make the directory
   /u. Then, mount it.
mount /dev/wd1a /u

   Finally, add it to /etc/fstab
/dev/wd1a /u ffs rw 1 1

   What if you need to migrate an existing directory like /usr/local? You
   should mount the new drive in /mnt and use cpio -pdum to copy
   /usr/local to the /mnt directory. Edit the /etc/fstab file to show
   that the /usr/local partition is now /dev/wd1a (your freshly formatted
   partition.) Example:
   /dev/wd1a /usr/local ffs rw 1 1

   Reboot into single user mode..boot -s Move the existing /usr/local to
   /usr/local-backup (or delete it if you feel lucky) and create an empty
   directory /usr/local. Then reboot the system, and viola, the files
   are there!
d6424 1
a6424 1
14.4 - How to swap to a file
d6426 2
a6427 122
   (Note: if you are looking to swap to a file because you are getting
   "virtual memory exhausted" errors, you should try raising the
   per-process limits first with csh's [20]unlimit(1), or sh's
   [21]ulimit(1).)

   After the release of OpenBSD 2.5 came [22]swapctl(8), which made
   dealing with swap devices much easier. If you are on an OpenBSD 2.5
   system, exchange swapctl with swapon, and use pstat -s to list swap
   devices. Swapping to a file doesn't require a custom built kernel,
   although that can still be done, this faq will show you how to add
   swap space both ways.

  Swapping to a file.

   Swapping to a file is easiest and quickest way to get extra swap
   area's setup. This is not for users who are currently using
   Softupdates. (Which isn't enabled by default). To start out, you can
   see how much swap you are currently have and how much you are using
   with the [23]swapctl(8) utility. You can do this by using the command:
ericj@@oshibana> swapctl -l
Device      512-blocks     Used    Avail Capacity  Priority
swap_device      65520        8    65512     0%    0

   This shows the devices currently being used for swapping and their
   current statistics. In the above example there is only one device
   named "swap_device". This is the predefined area on disk that is used
   for swapping. (Shows up as partition b when viewing disklabels) As you
   can also see in the above example, that device isn't getting much use
   at the moment. But for the purposes of this document, we will act as
   if an extra 32M is needed.

   The first step to setting up a file as a swap device is to create the
   file. It's best to do this with the [24]dd(1) utility. Here is an
   example of creating the file /var/swap that is 32M large.
ericj@@oshibana> sudo dd if=/dev/zero of=/var/swap bs=1k count=32768
32768+0 records in
32768+0 records out
33554432 bytes transferred in 20 secs (1677721 bytes/sec)

   Once this has been done, we can turn on swapping to that device. Use
   the following command to turn on swapping to this device
ericj@@oshibana> sudo swapctl -a /var/swap

   Now we need to check to see if it has been correctly added to the list
   of our swap devices.
ericj@@oshibana> swapctl -l
Device      512-blocks     Used    Avail Capacity  Priority
swap_device      65520        8    65512     0%    0
/var/swap        65536        0    65536     0%    0
Total           131056        8   131048     0%

   Now that the file is setup and swapping is being done, you need to add
   a line to your /etc/fstab file so that this file is configured on the
   next boot time also. If this line is not added, your won't have this
   swap device configured.
ericj@@oshibana> cat /etc/fstab
/dev/wd0a / ffs rw 1 1
/var/swap /var/swap sw 0 0

  Swapping via a vnode device

   This is a more permanent solution to adding more swap space. To swap
   to a file permanently, first make a kernel with vnd0c as swap. If you
   have wd0a as root filesystem, wd0b is the previous swap, use this line
   in the kernel configuration file (refer to compiling a new kernel if
   in doubt):
config          bsd     root on wd0a swap on wd0b and vnd0c dumps on wd0b

   After this is done, the file which will be used for swapping needs to
   be created. You should do this by using the same command as in the
   above examples.
ericj@@oshibana> sudo dd if=/dev/zero of=/var/swap bs=1k count=32768
32768+0 records in
32768+0 records out
33554432 bytes transferred in 20 secs (1677721 bytes/sec)

   Now your file is in place, you need to add the file to you /etc/fstab.
   Here is a sample line to boot with this device as swap on boot.
ericj@@oshibana> cat /etc/fstab
/dev/wd0a / ffs rw 1 1
/dev/vnd0c none swap sw 0 0

   At this point your computer needs to be rebooted so that the kernel
   changes can take place. Once this has been done it's time to configure
   the device as swap. To do this you will use [25]vnconfig(1).
ericj@@oshibana> sudo vnconfig -c -v vnd0 /var/swap
vnd0: 33554432 bytes on /var/swap

   Now for the last step, turning on swapping to that device. We will do
   this just like in the above examples, using swapctl(8). Then we will
   check to see if it was correctly added to our list of swap devices.
ericj@@oshibana> sudo swapctl -a /dev/vnd0c
ericj@@oshibana> swapctl -l
Device      512-blocks     Used    Avail Capacity  Priority
swap_device      65520        8    65512     0%    0
/dev/vnd0c       65536        0    65536     0%    0
Total           131056        8   131048     0%

14.5 - Soft-updates

   Softupdates are experimental and are NOT recommended for regular users.

   Over the last few years Kirk McKusick has been working on something
   called "soft updates". This is based on an idea proposed by Greg
   Ganger and Yale Patt that imposing a partial ordering on the buffer
   cache operations would permit the requirement for synchronous writing
   of directory entries to be removed from the FFS code. Thus, a large
   performance increase of disk writing performance.

   To enable Softupdates your kernel must have option

   option FFS_SOFTUPDATES

   then you need to boot into single-user mode:
        boot>boot -s
        [snip]
        bsd# tunefs -s enable <raw device>
        bsd# reboot -n

   GOOD LUCK. Please direct all problem reports with as MUCH information
   as possible (kernel coredumps, tracebacks, etc) to [26]Costa. Do not
   waste his time with any other questions or incomplete problem reports.
d6429 8
a6436 2
14.6 - When I boot after installation of OpenBSD/i386, it stops at "Using
partition 3 id 0".
d6438 1
a6438 56
   This means that your MBR (Master Boot Record) was not installed
   properly or that your BIOS' idea of the hard disk geometry is not
   compatible with your current MBR. To solve this, first try to
   reinstall the OpenBSD boot blocks. To do so use [27]fdisk(8) and
   [28]installboot(8).

   First, to get up and running, you will need to use your boot disk as a
   bootstrap. After you put the install disk in, and before it loads the
   kernel and ramdisk, you get a boot> prompt from the floppy disk. Use
   it to boot OpenBSD off of your hard disk.
booting...
OpenBSD boot 1.2.3
probing hd0 fd0...
boot> boot hd0a:/bsd

   Now that you are booted, and assuming you have dedicated your entire
   hard disk to OpenBSD, re-initialize the Master Boot Record with
   fdisk(8). (If you have partitions on your hard disk for operating
   systems other then OpenBSD, you cannot use installboot anyways, you
   must look at another option such as OS-BS, described below.)
# fdisk -i wd0

   Now, you need to write the boot blocks again.
# cp /usr/mdec/boot /boot
# /usr/mdec/installboot -v /boot /usr/mdec/biosboot wd0

   Finally, reboot and test it out.

   If this doesn't work you still have a few more options. So, luck
   hasn't run out yet. The first is to use a bootloader such as OS-BS.
   The OpenBSD cd has the os-bs bootloader included in the tools
   directory. If you didn't purchase a CD-ROM, you can download os-bs
   from any of the OpenBSD ftp sites. The file to grab is
   pub/OpenBSD/2.6/tools/osbs135.exe

   Also, take some time to look through the OS-BS web pages at
   [29]http://www.prz.tu-berlin.de/~wolf/os-bs.html

   There are also other commercial bootloaders or lilo that you can use
   for multi-booting.

   Here is a simple outline of how to get lilo onto your system.

     * Boot a DOS floppy and do a fdisk /MBR. Make sure you do that on
       the drive you'll be booting from.
     * Boot from a linux disk and install LILO & chain it to your OpenBSD
       boot block.

   For further instructions read [30]INSTALL.linux

14.7 - How do I get a dmesg from a boot floppy?

   RAMDISK images (boot floppies) do not ship with the dmesg utility.
   They do, however, have the /kern filesystem mounted. To copy the dmesg
   information to a file, do a:
   # cat /kern/msgbuf >mydmesg
d6440 1
a6440 2
   Boot disks also have 'more' to page through the output:
   # more /kern/msgbuf
d6442 2
a6443 1
   Also check with [31]section 4.5
d6445 1
a6445 1
14.8 - Installing Bootblocks - i386 specific
d6447 7
a6453 1520
   Older versions of MS-DOS can only deal with disk geometries of 1024
   cylinders or less. Since virtually all modern disks have more than
   1024 cylinders, most SCSI BIOS chips (which come on the SCSI
   controller card) and IDE BIOS (which is part of the rest of the PC
   BIOS) have an option (sometimes the default) to "translate" the real
   disk geometry into something that fits within MS-DOS' ability.
   However, not all BIOS chips "translate" the geometry in the same way.
   If you change your BIOS (either with a new motherboard or a new SCSI
   controller), and the new one uses a different "translated" geometry,
   you will be unable to load the second stage boot loader (and thus
   unable to load the kernel). (This is because the first stage boot
   loader contains a list of the blocks that comprise /boot in terms of
   the original "translated" geometry.) If you are using IDE disks, and
   you make changes to your BIOS settings, you can (unknowingly) change
   its translation also (most IDE BIOS offer 3 different translations.)
   To fix your boot block so that you can boot normally, just put a boot
   floppy in your hard drive, and at the boot prompt, type "b hd0a:/bsd"
   to force it to boot from the first hard disk (and not the floppy).
   Your machine should come up normally. You now need to update the first
   stage boot loader to see the new geometry (and re-write the boot block
   accordingly).
   Our example will assume your boot disk is sd0 (but for IDE it would be
   wd0, etc..):
# cd /usr/mdec; ./installboot /boot biosboot sd0

   If installboot complains that it is unable to read the BIOS geometry,
   at the boot> prompt you may issue the "machine diskinfo" (or "ma di"
   for short) command to print the information you need. Feed the "heads"
   and "secs" values to installboot's -h and -s flags, respectively, so
   that the modified installboot command is the following:
# cd /usr/mdec; ./installboot -h <heads> -s <secs> /boot biosboot sd0

   If a newer version of bootblocks are required, you will need to
   compile these yourself. To do so simply.
# cd /sys/arch/i386/stand/
# make && make install
# cd /usr/mdec; cp ./boot /boot
# ./installboot /boot biosboot sd0 (or whatever device your hard disk is)

   [32][Back to Main Index] [33][To Section 13.0 - IPsec]
     _________________________________________________________________

   [34][back] [35]www@@openbsd.org
   $OpenBSD: obsd-faq.txt,v 1.26 2001/08/08 21:06:33 jsyn Exp $

References

   1. http://openbsd.org/faq/faq14.html#14.1
   2. http://openbsd.org/faq/faq14.html#14.2
   3. http://openbsd.org/faq/faq14.html#14.3
   4. http://openbsd.org/faq/faq14.html#14.4
   5. http://openbsd.org/faq/faq14.html#14.5
   6. http://openbsd.org/faq/faq14.html#14.6
   7. http://openbsd.org/faq/faq14.html#14.7
   8. http://openbsd.org/faq/faq14.html#14.8
   9. http://openbsd.org/faq/faq14.html#14.1.1
  10. http://openbsd.org/faq/faq14.html#14.1.2
  11. http://openbsd.org/faq/faq14.html#14.1.3
  12. http://www.openbsd.org/cgi-bin/man.cgi?query=disklabel&sektion=5&format=html
  13. http://openbsd.org/faq/faq14.html#14.2
  14. http://openbsd.org/faq/faq4.html#4.3
  15. http://www.openbsd.org/cgi-bin/man.cgi?query=disklabel&sektion=8&format=html
  16. http://www.openbsd.org/cgi-bin/man.cgi?query=fdisk&apropos=0&sektion=8&format=html
  17. http://www.openbsd.org/cgi-bin/man.cgi?query=fdisk&apropos=0&sektion=8&format=html
  18. http://www.openbsd.org/cgi-bin/man.cgi?query=disklabel&apropos=0&sektion=8&format=html
  19. http://www.openbsd.org/cgi-bin/man.cgi?query=newfs&apropos=0&sektion=8&format=html
  20. http://www.openbsd.org/cgi-bin/man.cgi?query=unlimit&sektion=1&format=html
  21. http://www.openbsd.org/cgi-bin/man.cgi?query=ulimit&sektion=1&format=html
  22. http://www.openbsd.org/cgi-bin/man.cgi?query=swapctl&sektion=8&format=html
  23. http://www.openbsd.org/cgi-bin/man.cgi?query=swapctl&sektion=8&format=html
  24. http://www.openbsd.org/cgi-bin/man.cgi?query=dd&sektion=1&format=html
  25. http://www.openbsd.org/cgi-bin/man.cgi?query=vnconfig&sektion=1&format=html
  26. mailto:csapuntz@@openbsd.org
  27. http://www.openbsd.org/cgi-bin/man.cgi?query=fdisk&sektion=8&format=html
  28. http://www.openbsd.org/cgi-bin/man.cgi?query=installboot&sektion=8&format=html
  29. http://www.prz.tu-berlin.de/~wolf/os-bs.html
  30. http://openbsd.org/faq/INSTALL.linux
  31. http://openbsd.org/faq/faq4.html#4.5
  32. http://openbsd.org/faq/index.html
  33. http://openbsd.org/faq/faq13.html
  34. http://openbsd.org/faq/index.html
  35. mailto:www@@openbsd.org


MINI-FAQ: Upgrading OpenBSD

  Latest OpenBSD Version - 2.6

    Kjell Wooding <[1]kwooding@@codetalker.com>

   Last Update - $OpenBSD: obsd-faq.txt,v 1.26 2001/08/08 21:06:33 jsyn Exp $

     If you've ever tried compiling the -current sources from an older
     OpenBSD release, you're aware that the process isn't always
     straightforward. This Mini-FAQ is an attempt to address the most
     common issues encountered when upgrading between OpenBSD releases,
     or from the releases to -current

  1.0: General Upgrade Questions

   [2]1.1: Terminology. What is -current? What are Snapshots?
   [3]1.2: What is the easiest way to upgrade to -current?
   [4]1.3: I looked, but didn't see any snapshots on the FTP site. Where
   did they go?
   [5]1.4: How do I get the latest source?
   [6]1.5: Okay, I have the tree. How do I build it.
   [7]1.6: My make build stopped halfway. Do I have to redo the whole
   thing?

  2.0: Upgrading from 2.3

   [8]2.1: What are the major problems upgrading from 2.3 to 2.4?
   [9]2.2: I tried the build, but it failed when trying to compile
   ssleay.
   [10]2.3: I tried the build, but it failed when trying to make
   something for the PowerPC.

  3.0: Upgrading from 2.4

   [11]3.1: What are the major problems upgrading from 2.4 to 2.5?
   [12]3.2: I tried the build, but it failed on cap_mkdb.

  4.0: Upgrading from 2.5

   [13]4.1: What are the major problems upgrading from 2.5 to 2.6?
   [14]4.2: How do I upgrade gcc to egcs

     [15]4.2.1 - i386 and sparc are no longer #define'ed
     [16]4.2.2 - Build fails in xlint
     [17]4.2.3 - Core Dump on uthread_autoinit.c
     [18]4.2.4 - egcs seems much slower than gcc
     [19]4.2.5 - egcs generates larger code than gcc
     [20]4.2.6 - After installing egcs I have very little disk space
     left
     [21]4.2.7 - My build fails to build libcurses
     [22]4.2.8 - make obj fails

   [23]4.3: My make build dies with unimplemented syscall errors.
   [24]4.4: Link to the new 2.6 directory.
   [25]4.5: After an (U)pgrade, extraction of base26.tar.gz fails with a
   message.

  5.0 - Upgrading from 2.6 to -current

   [26]5.1: Termcap entries are too long.
   [27]5.2: My pn (or mx, al, ax) device is no longer recognized by the
   kernel.
   [28]5.3: Upgrading gcc 2.95.1 to 2.95.2

                           _____________________

  1.0: General Upgrade Questions

    1.1: Terminology. What is -current? What are Snapshots?

   Unlike Operating System projects like Linux and FreeBSD, OpenBSD
   development happens from a single, unbranched source tree. On
   approximately six-month intervals, OpenBSD releases are produced.
   These are numbered in the conventional (2.x) manner. The current
   OpenBSD release is 2.6.

   -current, short for openbsd-current, refers to the up-to-the-minute
   version of the source tree contained in the CVS repository. This is
   the tree most commonly used by OpenBSD developers. The -current tree
   contains all the code that is planned for the next release. From time
   to time, brave souls will abandon the formal releases and run
   openbsd-current, usually to take advantage of features that have not
   yet made it into the formal releases. Because of its uncertain nature,
   however, upgrading to -current is not recommended for non-technical
   users.

   Between formal releases, a series of snapshot releases are [29]made
   available. Snapshots are test releases of the -current source tree.
   Because they reflect the current state of development, there is no
   guarantee that snapshot releases will work correctly (or even at all).
   Snapshots are quite useful when moving from a formal release (or older
   version of -current) to the current tree.

    1.2: What is the best way to upgrade to -current?

   Due to changes in the underlying libraries, moving directly from a
   release to -current is not always easy. The most painless way to move
   up to -current is to first upgrade to the latest snapshot (usually,
   via an FTP install). Once the snapshot is installed, the latest source
   can be [30]fetched and [31]built. This procedure should eliminate most
   toolchain and library problems.

    1.3: I looked, but didn't see any snapshots on the FTP site. Where did they
    go?

   The snapshots used to be taken temporarily offline right around the
   release time of a new version. This is no longer the OpenBSD policy.

   Snapshots may be removed as they become old (or no longer relevant).
   If no snapshot is available, you should upgrade to the most recent
   release and build the remainder of the way from source.

    1.4: How do I get the latest source?

   Short answer: [32]http://www.openbsd.org/anoncvs.html

   For example. To retrieve the entire tree via CVS: (using the bash
   shell. Others substitute setenv for export)
# export CVSROOT=anoncvs@@anoncvs.ca.openbsd.org:/cvs
# export CVS_RSH=/usr/bin/ssh
# cd /usr
# cvs -q get -PA src

    1.5: Okay, I have the tree. How do I build it.

   Basic instructions are in /usr/src/Makefile. This is a slightly
   expanded version.

1. Clean out the old object files.

If you created a separate /usr/obj directory, clean that, and
rebuild the symbolic links:

# rm -rf /usr/obj
# mkdir /usr/obj
# cd /usr/src
# make obj

If you're worried there are object files in your source tree,
do this:

# cd /usr/src
# find . -type l -name obj | xargs rm
# make cleandir
# rm -rf /usr/obj
# mkdir /usr/obj
# make obj

2. Perform any verion-specific configuration changes. For example,
2.3 users must add the named user and group before
moving to 2.4 or later. See the specific Mini-FAQ section for
your version.

3. Make sure all the appropriate directories are created. This
is especially important when upgrading from older versions, but is
sometimes necessary in other cases. The easiest way to do this is:

# cd /usr/src/etc && make DESTDIR=/ distrib-dirs

4. Compile a new kernel.

# cd /usr/src/sys/arch/`machine`/conf
# cp GENERIC MYKERNEL
# vi MYKERNEL
(edit MYKERNEL to your liking)
# config MYKERNEL
# cd ../compile/MYKERNEL
# make clean && make depend && make
(arc architecture only) copy bsd.ecoff to your FAT partition
# cp /bsd /bsd.old && cp bsd /bsd
# chown root.wheel /bsd (if you compiled as someone else)
(reboot)

5. Compile the system.

# cd /usr/src
# make build

6. Update /etc and /dev by hand. These are not updated
automatically. Choose a directory with enough space to
hold /, /dev, /var, and /etc. Here I'll use /home/newroot
(Note: make sure the directory hierarchy you choose
does not have group write (g+w) or other write (o+w)
permissions or sendmail will complain during this step.
This makes /tmp a bad choice):

# mkdir /home/newroot
# export DESTDIR=/home/newroot
# cd /usr/src/etc && make distribution-etc-root-var

Now compare the files in /home/newroot with their
installed counterparts. Replace or update the files as
necessary.

# rm -rf /home/newroot   (when done)

7. Reboot to make sure the new /etc files are correct

    1.6: My make build stopped halfway. Do I have to redo the whole thing?

   I would, but if you really want to pick up where you left off, do a:
# cd /usr/src
# make -n build

   This will show you what make build is doing. For example, mine tells
   me:
(cd /usr/src/share/mk &&  make install)
(cd /usr/src/include;  make includes)
make cleandir
(cd /usr/src/lib && make depend && make &&   make install)
(cd /usr/src/gnu/lib && make depend && make &&   make install)
(cd /usr/src/kerberosIV && make build)
make depend && make &&  make install

   To pick up where you left off, just reissue the commands from the
   point where the compile died.

   If you do this procedure a lot, you may want to create a new target in
   your makefile. Simply copy the entry for build (to build-noclean, for
   example), and remove the make cleandir reference.

  2.0: Upgrading from 2.3

    2.1: What are the major problems upgrading from 2.3 to 2.4?

    New User: named

   After 2.3, the named DNS daemon was moved to a chroot jail. To make
   this change possible, the named user was created. If you do not have
   it already, you will need to create this user to ensure that all
   directories get created properly during the build process.

   Add the following entry to /etc/passwd using vipw
named:*:70:70::0:0:BIND Daemon:/var/named:/sbin/nologin

   Add the following to /etc/group:
named:*:70:

    2.2: I tried the build, but it failed when trying to compile ssleay.

   You are likely missing an entry for the named user in your password
   file.

   Short Answer:

   Create this user prior to the build.

   Long Answer:

   The named user is required in order to set permissions correctly. If
   this user is missing, part of the build process fails. If you capture
   your build to a file (say, with a make build &>/tmp/build.log) you
   will notice the following message:
(cd /usr/src/etc && make DESTDIR=/ distrib-dirs)
install -d -o root -g wheel -m 755 /
mtree -def mtree/4.4BSD.dist -p // -u

mtree: unknown user named
mtree: failed at line 1632 of the specification
*** Error code 1 (ignored)

   Unfortunately for us, the build continued happily on its way, totally
   ignoring the fact that an error occurred.

   If the named user exists, mtree works properly:
missing: ./var/named (created)
missing: ./var/named/dev (created)
missing: ./var/named/etc (created)
missing: ./etc/afs (created)
missing: ./etc/ssl (created)
missing: ./etc/ssl/private (created)
missing: ./usr/obj (not created: File exists)
missing: ./usr/share/doc/html (created)
missing: ./usr/share/doc/html/lynx_help (created)
missing: ./usr/share/doc/html/lynx_help/keystrokes (created)
missing: ./usr/share/doc/usd/13.viref (created)
missing: ./usr/share/man/cat4/powerpc (created)
missing: ./usr/share/man/man4/alpha (created)
missing: ./usr/share/man/man4/pmax (created)
missing: ./usr/share/man/man4/powerpc (created)
missing: ./usr/share/tmac/mdoc (created)
missing: ./var/www/htdocs/manual/vhosts (created)
missing: ./usr/include/ssl (created)

   The reason for the fail, then, is that the /usr/include/ssl directory
   was never created. Without the header files, the ssleay build fails.

   Fix:

   Create the named user and group. Remove /usr/include/ssl, /var/named,
   and any other directory from the list above that was mistakenly
   created as a normal file by the make build.

    2.3: I tried the build, but it failed when trying to make something for the
    PowerPC.

   Your directory tree is incomplete. Specifically, the
   /usr/share/man/cat4/powerpc directory is missing.

   Quick Fix:

   Create this directory and proceed with the compilation

   Complete Fix:

   Create the entire directory tree. Do a:
# cd /usr/src/etc && make DESTDIR=/ distrib-dirs

   You will likely see an output like the following:
install -d -o root -g wheel -m 755 /
mtree -def mtree/4.4BSD.dist -p // -u

missing: ./var/named (created)
missing: ./var/named/dev (created)
missing: ./var/named/etc (created)
missing: ./etc/afs (created)
missing: ./etc/ssl (created)
missing: ./etc/ssl/private (created)
missing: ./usr/obj (not created: File exists)
missing: ./usr/share/doc/html (created)
missing: ./usr/share/doc/html/lynx_help (created)
missing: ./usr/share/doc/html/lynx_help/keystrokes (created)
missing: ./usr/share/doc/usd/13.viref (created)
missing: ./usr/share/man/cat4/powerpc (created)
missing: ./usr/share/man/man4/alpha (created)
missing: ./usr/share/man/man4/pmax (created)
missing: ./usr/share/man/man4/powerpc (created)
missing: ./usr/share/tmac/mdoc (created)
missing: ./var/www/htdocs/manual/vhosts (created)
missing: ./usr/include/ssl (created)

   Note that /usr/share/man/cat4/powerpc was one of the directories
   created by this process.

  3.0: Upgrading from 2.4

    3.1: What are the major problems upgrading from 2.4 to 2.5?

    cap_mkdb

   The syntax for invoking cap_mkdb has changed slightly. Before doing a
   make build, rebuild cap_mkdb from the latest source:
# cd /usr/src/usr.bin/cap_mkdb
# make clean && make && make install

   The make build should then run to completion

    Man Page Changes

   Several man pages were moved from section 1 to later sections
   Unfortunately, if the old man pages are left in section 1, unwary
   users will not see the latest version of the page.

   The following pages should be removed:
/usr/share/man/cat1/ipf.0
/usr/share/man/cat1/ipnat.0
/usr/share/man/cat1/ipsecadm.0

    Snake

   You will need to remove the contents of the obj directory before
   upgrading /usr/src/games/snake.

    3.2: I tried the build, but it failed on cap_mkdb.

   Symptom:

   A make build resulted in an error like this:
cap_mkdb -i -f terminfo terminfo.src
cap_mkdb: illegal option -- i
usage: cap_mkdb [-v] [-f outfile] file1 [file2 ...]
*** Error code 1

   Quick Fix:

   You need to build a new cap_mkdb. See [33]3.1.

  4.0: Upgrading from 2.5

    4.1: What are the major problems upgrading from 2.5 to 2.6?

      perl and make

   The latest version of Perl (5.005_03) requires a new version of make
   to compile properly. You must rebuild make before building the new
   Perl. Do a:
# cd /usr/src/usr.bin/make
# make clean && make && make install

   Then go ahead and rebuild the new Perl. You will need to clean out the
   Perl obj directory by hand before building.

   Perl developers should take note of the latest changes. From
   millert@@openbsd.org:
The version of perl in the OpenBSD source tree (post 2.5) has been
upgraded to 5.005_03.  The build method has changed somewhat but
most of that should be invisible.  The important changes that affect
people are as follows:

1) Perl lib files have moved from /usr/lib/perl5 to the more correct
/usr/libdata/perl5
2) The default site_perl directories now live in /usr/local.  Ie:
if you install a perl module, it will place itself in
/usr/local/libdata/perl5/site_lib.  This makes it easy to
see what non-stock modules you have.  It also means that we
can have perl modules in the ports system easily.
3) The perl library man pages are now install in /usr/share/man/cat3p
You'll need to update your man.conf based on the src/etc/man.conf
to take advantage of them.  This means you can now do
"man 3p less" and get info on the less pragma but "man less"
will still get you the less pager manpage.

If you have modules or other non-stock perl files the simplest thing
to do is to move /usr/lib/perl5 to /usr/libdata/perl5 and add a link
from /usr/lib/perl5 to /usr/libdata/perl5.  Alternately, you could
just edit the installed Config.pm file and fix up the paths there.

      Compiler Change: egcs replaces gcc

   This change is likely the most significant change you will encounter.
   For detailed instructions, see section [34]4.2.

      Kernel Structure - statfs - changed

   The statfs structure has changed as of May 31. You must rebuild your
   kernel before attempting a make build. See [35]4.3 for details.

    4.2: How do I upgrade gcc to egcs

   The safest way will be to upgrade to a recent snapshot, once one is
   available. Look for a snapshot first!. Bootstrapping the new compiler
   from the old should be a last resort.

   First, note that some platforms have not been bootstrapped
   successfully yet. To date, the following should work, if you are
   careful:
     * i386
     * sparc
     * m68k
     * alpha

   mips and rs6000 have problems.

   To test whether your platform can be bootstrapped, grab and install
   the egcs-snapshot, available from the [36]ports collection. If this
   works, the in-tree version likely will, too. This is the safest method
   of proceeding.

   Now, before going any further, ensure that your copies of binutils,
   gas, and ld are up to date. Note that there are two copies of gas and
   ld in the tree. On i386 and sparc, the binutils versions are not used.
   Check /usr/src/gnu/usr.bin/gas and /usr/src/gnu/usr.bin/ld instead.

   The following instructions referred to the original egcs snapshot
   (egcs-990517). Since that time, a second snapshot (egcs-990608) has
   gone into the tree. If you are coming from vanilla 2.5, it is unlikely
   that you will be able to build the latest version directly. In this
   event, you will have to bootstrap an intermediate version using these
   instructions.

   From espie@@openbsd.org:

Today, the compiler changes.

Exit gcc 2.8.1, enter egcs... or more precisely, gcc 2.95 prerelease.

This is probably going to be a rough ride, but I can't work out all
the kinks on every architecture by myself.

I'm going to start importing stuff *now*. There will be a second message
to tech@@ once things are settled...

Thanks to everyone who helped me sorting stuff out, most especially
niklas, turan, and millert.

Why the switch
--------------
as most of you already know, egcs is now the *official* compiler supported
by the FSF.  The upcoming july release as been re-christened gcc 2.95.

Just looking at the log messages will show you many improvements:
support for newer processors is better, C++ is more accurately matching
the ANSI/ISO standards, Fortran 77 is more closely integrated.
There are also countless bug-fixes and code generation improvements.

Also the development is more open. There is a cvs tree, there are several
mailing-lists available, and we are cooperating closely with the egcs
team. More precisely, I've been feeding patches back to the egcs team
so that OpenBSD configurations are officially supported.
Also, the development team is highly responsive to bug-reports, and problems
get fixed.

There also is a band-wagon phenomenon: everyone is switching to egcs,
which means lots of code to test the compiler on, and that we can benefit
from related projects.

Why now
-------
egcs-1.1 was unfit for some purposes. Specifically, code size on i386
was larger than gcc 2.8.1, which yielded floppy-disks problems.
At 2.5 freeze, the only code fit to include was a somewhat unstable
snapshot.  In the interest of stability, after much pondering, egcs was
not put into 2.5.

Right now, the egcs project is going through a release cycle which will
yield egcs 1.2.  Judging from their time schedule, there is ample margin
between egcs 1.2 and the next release of OpenBSD.  Also, we want to get
in now, so that we get a chance to report problems on less frequently
used architectures, and get everything fixed for 1.2.

egcs `feature freeze' is supposed to occur on may 7th, and the current
snapshot 19990502 looks solid.

What works and what doesn't
---------------------------
egcs runs an i386 OpenBSD system without problems.  m68k works as well,
with a few work-arounds linked to obscure bugs that will get fixed.
sparc seems to be running as well.  There is some linker trouble on some
other arches that needs to be fixed before our next release.

Right now, constructors across dynamic libraries are not quite ready.

egcs now features a stand-alone cpp which is going to be better than
the current hackish solution we use. This means a few interface changes
and possibly weird warnings.

Keeping gcc 2.8.1 ?
-------------------
due to size constraints, as soon as egcs is imported, gcc is going
to move to cvs Attic.  If you don't want to deal with egcs now, you'll
have to be careful through your cvs updates.
Some Makefiles are bound to change: includes, gnu/usr.bin, and gnu/lib.
xlint and cpp.sh are going to change as well.

How to bootstrap the compiler
-----------------------------
the simplest way is probably to trust the various arch maintainers
and download a snapshot.

If you want to do stuff the hard way, you must first remake proper
obj dirs:
cd /usr/src
make obj

If you run i386, gas must be up-to-date.
If you run sparc, ld must be up-to-date.

then build libiberty:
cd /usr/src/gnu/egcs/libiberty
make -f Makefile.bsd-wrapper clean
make -f Makefile.bsd-wrapper depend
make -f Makefile.bsd-wrapper
make -f Makefile.bsd-wrapper install

then the C compiler:
cd /usr/src/gnu/egcs/gcc
make -f Makefile.bsd-wrapper clean
make -f Makefile.bsd-wrapper depend
make -f Makefile.bsd-wrapper
make -f Makefile.bsd-wrapper install

rebuild the C compiler with the new version:
cd /usr/src/gnu/egcs/gcc
make -f Makefile.bsd-wrapper clean
make -f Makefile.bsd-wrapper depend
make -f Makefile.bsd-wrapper
make -f Makefile.bsd-wrapper install

rebuild the includes
cd /usr/src/include
make includes

build all egcs libraries and install them
cd /usr/src/gnu/egcs
make -f Makefile.bsd-wrapper clean
make -f Makefile.bsd-wrapper depend
make -f Makefile.bsd-wrapper
make -f Makefile.bsd-wrapper install

install the new cpp driver
cd /usr/src/usr.bin/cpp
make install

then you're all set, and a standard make build should work...

     [author note: Actually, it doesn't quite work. xlint will fail to
     build. The fix is simple though. Simply do a make && make install
     in the /usr/src/usr.bin/xlint/xlint directory before you attempt a
     make build and proceed. See [37]4.2.2.]
If it doesn't, you're using an arch that didn't go through make build yet.
The most probably occurrence is an Internal Compiler Error, as known as an
ICE.

First try to see if the ICE will go away with -O1 or -O0. In that case, you
can put a work-around in the Makefile until it's fixed
(see /usr/src/lib/libm/Makefile for an example of how to put in such
work-arounds for m68k).

Then the error needs to be reported to the egcs-bugs mailing list.

At a minimum, you must run the source through the same compiler invocation,
with an addition of -v -save-temps to the options.

-v yields the precise sequence of commands invoked by gcc. -save-temps
will give you a pre-processed C file (.i) or C++ (.ii) that the egcs people
can make sense of... you can't ask them to run OpenBSD on their boxes.

If you have more time, you can try to trim down the pre-processed C file to
the bare minimum that triggers the bug. Dichotomy works nicely.

   If you made it through this procedure, and everything is still
   working, congratulations. If not, check the following sections for
   advice. Problems not listed here should be posted to tech@@openbsd.org.

      4.2.1 - i386 and sparc are no longer #define'ed

   This is true. egcs uses the cleaner __i386__ and __sparc__. If you
   need to compile code that relies on the old defines, add a -Dsparc or
   -Di386 to the appropriate location of your Makefile.

      4.2.2 - Build fails in xlint

   This is due to semantic differences in cpp. The workaround is simple,
   and similar to the cap_mkdb issue described in [38]3.1.

   Do a:
# cd /usr/src/usr.bin/xlint/xlint
# make && make install

   now re-run make, and the build should continue.

      4.2.3 - Core Dump on uthread_autoinit.c

   You have fallen victim to a linker bug. Here's a relevant message:
From: Marc Espie
Subject: egcs core-dumping on uthread_autoinit.c

If this happens to you, this is a known linker problem... the cc1 you have
was linked in a weird way.

Initially, I made cc1 link against static /usr/lib/libiberty.a to avoid this
problem, but this was cutting things too close, and the bug reappeared,
probably thanks to unrelated changes in libc or elsewhere...

The tree has been patched with a work-around in

src/gnu/egcs/f/lang-options.h

make sure you have the kludged version of that file (at least rev 1.2),
recompile and reinstall cc1, the problem should go away.

What's going on is that the 386 linker gets something wrong because of
the huge strings array in toplev.c, and something gets mislinked, so
that
void f(void) __attribute((constructor)) {}
kills cc1.

As a work-around, I've killed Fortran options help texts, until someone finds
where the linker errs.

      4.2.4 - egcs seems much slower than gcc

   It is, but there is a reason. egcs performs more optimizing passes.
   Data alignment and other such functionality will be better with
   egcs-generated code.

      4.2.5 - egcs generates larger code than gcc

   Yes it does. This is especially noticeable with the old -O2 gcc switch.
   egcs introduces a new option, -Os which optimizes for space. This is
   roughly comparable to the old -O2 behavior.

      4.2.6 - After installing egcs I have very little disk space left

   egcs installs into a different subdirectory than gcc 2.8.1. You may
   remove gcc once egcs is bootstrapped and working. (on a related note,
   the perl changes mentioned in [39]4.1 mean that you can remove the
   /usr/lib/perl5 directory. The new location for this data is
   /usr/libdata/perl5.)

      4.2.7 - My build dies while making libcurses

   libcurses now relies on the latest version of cpp. Fetch the latest
   version, rebuild cpp, and continue. Eg:
# cd /usr/src/usr.bin/cpp && make install

   And try the make build again.

      4.2.8 - make obj fails

   If your make obj fails, citing errors in a Makefile, your makefile
   includes are likely out of date. For example:
===> lib/libkvm
"Makefile", line 30: Malformed conditional ((${UVM} == "yes"))
"Makefile", line 30: Missing dependency operator
"Makefile", line 32: if-less endif
"Makefile", line 32: Need an operator
Fatal errors encountered -- cannot continue

   This can be solved by rebuilding the makefile includes. Do a:
cd /usr/src/share/mk && make install

   and try the build again.

    4.3: My make build dies with unimplemented syscall errors.

   Short Answer:

   The kernel structure statfs has changed. You will need to recompile
   the kernel before attempting a make build.

   Long Answer:

   The kernel structure statfs has changed. The new struct statfs has the
   following features:
     * Has a u_int32_t flags field--now softdep can have a real flag.
     * Uses u_int32_t instead of longs (nicer on the alpha). Note: the
       man page used to lie about setting invalid/unused fields to -1.
       SunOS does that but our code never has.
     * Gets rid of f_type completely. It hasn't been used since NetBSD
       0.9 and having it there but always 0 is confusing. It is
       conceivable that this may cause some old code to not compile but
       that is better than silently breaking.
     * Adds a mount_info union that contains the FSTYPE_args struct. This
       means that mount can now tell you all the options a filesystem was
       mounted with. This is especially nice for NFS.

   Other changes:
     * The linux statfs emulation didn't convert between BSD fs names and
       linux f_type numbers. Now it does, since the BSD f_type number is
       useless to linux apps (and has been removed anyway)
     * FreeBSD's struct statfs is different from our (both old and new)
       and thus needs conversion. Previously, the OpenBSD syscalls were
       used without any real translation.
     * mount(8) will now show extra info when invoked with no arguments.
       However, to see everything you need to use the -v (verbose) flag.

    4.4: Link to the new 2.6 directory.

   When upgrading to 2.6 you'll need to create one simple link for gcc.
cd /usr/lib/gcc-lib
ln -s ${ARCH}-unknown-openbsd2.5 ${ARCH}-unknown-openbsd2.6

    4.5: After an (U)pgrade, extraction of base26.tar.gz fails with a message:

   tar: Unable to remove directory ./usr/include/machine

   In 2.5, /usr/include/machine was a directory, and /usr/include/i386
   was a link to it. In 2.6, this situation is reversed.

   To correct the problem, escape to the shell, remove the
   /usr/include/machine directory, and retry the upgrade.

  5.0 - Upgrading from 2.6 to -current

    5.1: Termcap entries are too long.

   There is a new termcaps.master file. You will need to regenerate the
   terminfo and termcaps files with the current version of tic(1). If you
   are upgrading via make build, the correct version of tic(1) will be
   used and this will be done for you. If not, you will get the following
   error:
    terminfo.src is corrupt! You need to update /usr/bin/tic

   In this case, you must either rebuild and install tic(1) (being sure
   to use the current version of libcurses) or simply build the version
   of tic(1) in your source tree.

    5.2: My pn (or mx, al, ax) device is no longer recognized by the kernel.

   (Note: pn is used below for simplicity. This should be taken to read
   pn, mx, al, or ax as appropriate)

   These four drivers were replaced with the a unified dc driver. You
   must change all occurrences of pn*, mx, al, or ax in your configuration
   files. This includes:
     * Updating your kernel configuration file(s). (Hint: start with a
       fresh GENERIC kernel, and modify from there)
     * mv'ing /etc/hostname.pn* to /etc/hostname.dc*
     * Updating your /etc/ifaliases file.
     * Changing your /etc/ipnat.rules and /etc/ipf.rules to reflect the
       new interface name.

   If you are modifying a custom kernel, make sure you have included the
   dcphy device, in your kernel config, as follows:
dcphy*  at mii? phy ?                           # Digital Clone PHYs

   While you are at it, you may also want to add:
ukphy*  at mii? phy ?                           # "unknown" PHYs

    5.3: Upgrading gcc 2.95.1 to 2.95.2

   gcc 2.95.2 was merged into the OpenBSD source tree around January 19,
   2000. In order for gcc to build properly, the most recent (post 2.6)
   libiberty is required. To build this library, do the following:
        cd /usr/src/gnu/egcs/libiberty
        make -f Makefile.bsd-wrapper clean
        make -f Makefile.bsd-wrapper obj
        make -f Makefile.bsd-wrapper
        make -f Makefile.bsd-wrapper install

   Once libiberty is build, you may proceed with a standard gcc
   bootstrap:
   cd /usr/src/gnu/egcs/gcc
   make -f Makefile.bsd-wrapper clean
   make -f Makefile.bsd-wrapper obj
   make -f Makefile.bsd-wrapper -DBOOTSTRAP
   make -f Makefile.bsd-wrapper -DBOOTSTRAP install
   make -f Makefile.bsd-wrapper clean
   make -f Makefile.bsd-wrapper
   make -f Makefile.bsd-wrapper install

   --
   $OpenBSD: upgrade-minifaq.html,v 1.17 2000/02/17 20:27:10 millert Exp
   $
   Copyright  1998-2000, Kjell Wooding.
   Please send any comments, questions, or suggestions to
   [40]kwooding@@codetalker.com

References

   1. mailto:kwooding@@codetalker.com
   2. http://openbsd.org/faq/upgrade-minifaq.html#1.1
   3. http://openbsd.org/faq/upgrade-minifaq.html#1.2
   4. http://openbsd.org/faq/upgrade-minifaq.html#1.3
   5. http://openbsd.org/faq/upgrade-minifaq.html#1.4
   6. http://openbsd.org/faq/upgrade-minifaq.html#1.5
   7. http://openbsd.org/faq/upgrade-minifaq.html#1.6
   8. http://openbsd.org/faq/upgrade-minifaq.html#2.1
   9. http://openbsd.org/faq/upgrade-minifaq.html#2.2
  10. http://openbsd.org/faq/upgrade-minifaq.html#2.3
  11. http://openbsd.org/faq/upgrade-minifaq.html#3.1
  12. http://openbsd.org/faq/upgrade-minifaq.html#3.2
  13. http://openbsd.org/faq/upgrade-minifaq.html#4.1
  14. http://openbsd.org/faq/upgrade-minifaq.html#4.2
  15. http://openbsd.org/faq/upgrade-minifaq.html#4.2.1
  16. http://openbsd.org/faq/upgrade-minifaq.html#4.2.2
  17. http://openbsd.org/faq/upgrade-minifaq.html#4.2.3
  18. http://openbsd.org/faq/upgrade-minifaq.html#4.2.4
  19. http://openbsd.org/faq/upgrade-minifaq.html#4.2.5
  20. http://openbsd.org/faq/upgrade-minifaq.html#4.2.6
  21. http://openbsd.org/faq/upgrade-minifaq.html#4.2.7
  22. http://openbsd.org/faq/upgrade-minifaq.html#4.2.8
  23. http://openbsd.org/faq/upgrade-minifaq.html#4.3
  24. http://openbsd.org/faq/upgrade-minifaq.html#4.4
  25. http://openbsd.org/faq/upgrade-minifaq.html#4.5
  26. http://openbsd.org/faq/upgrade-minifaq.html#5.1
  27. http://openbsd.org/faq/upgrade-minifaq.html#5.2
  28. http://openbsd.org/faq/upgrade-minifaq.html#5.3
  29. ftp://ftp.openbsd.org/pub/OpenBSD/snapshots/
  30. http://openbsd.org/faq/upgrade-minifaq.html#1.4
  31. http://openbsd.org/faq/upgrade-minifaq.html#1.5
  32. http://openbsd.org/anoncvs.html
  33. http://openbsd.org/faq/upgrade-minifaq.html#3.1
  34. http://openbsd.org/faq/upgrade-minifaq.html#4.2
  35. http://openbsd.org/faq/upgrade-minifaq.html#4.3
  36. http://openbsd.org/ports.html
  37. http://openbsd.org/faq/upgrade-minifaq.html#4.2.2
  38. http://openbsd.org/faq/upgrade-minifaq.html#3.1
  39. http://openbsd.org/faq/upgrade-minifaq.html#4.1
  40. mailto:kwooding@@codetalker.com

reading boot.......
probing: pc0 com0 com1 apm mem[640K 62M a20=on]
disk: fd0 hd0
>> OpenBSD/i386 BOOT 1.23
boot> _
booting fd0a:/bsd: 1310720+1908736...

OpenBSD 2.6 (GENERIC) #679: Thu Oct 21 21:19:27 MDT 1999
    deraadt@@i386.openbsd.org:/usr/src/sys/arch/i386/compile/RAMDISK_CD
cpu0: AMD K6-3 ("AuthenticAMD" 586-class) 451 MHz
cpu0: FPU,V86,DE,PSE,TSC,MSR,MCE,CX8,PGE,MMX
BIOS mem  = 655360 conventional, 133152768 extended
real mem  = 133808128
avail mem = 120033280
using 1659 buffers containing 6795264 bytes of memory
mainbus0 (root)
bios0 at mainbus0: AT/286+(81) BIOS, date 04/16/99
bios0: diskinfo 0xe05f000c cksumlen 1 memmap 0xe05f00c8 apminfo 0xe05f0160
apm at bios0 function 0x15 not configured
pci0 at mainbus0 bus 0: configuration mode 1 (no bios)
pchb0 at pci0 dev 0 function 0 "Acer Labs M1543 Host-PCI" rev 0x04
ppb0 at pci0 dev 1 function 0 "Acer Labs M5243 AGP/PCI-PCI" rev 0x04
pci1 at ppb0 bus 1
"ATI Technologies Mach64 GZ" rev 0x3a at pci1 dev 0 function 0 not configured
"Acer Labs M7101 Power Management" rev 0x00 at pci0 dev 3 function 0 not config
ured
"Acer Labs M1543 PCI-ISA" rev 0xc3 at pci0 dev 7 function 0 not configured
"ESS SOLO-1 AudioDrive" rev 0x01 at pci0 dev 9 function 0 not configured
fxp0 at pci0 dev 10 function 0 "Intel 82557" rev 0x08: irq 12, address 00:90:27
:4e:96:30
inphy0 at fxp0 phy 1: i82555 10/100 media interface, rev. 4
pciide0 at pci0 dev 11 function 0 "Promise Ultra33/ATA IDE" rev 0x01: DMA, chan
nel 0 configured to native-PCI, channel 1 configured to native-PCI
pciide0: using irq 10 for native-PCI interrupt
pciide1 at pci0 dev 15 function 0 "Acer Labs M5229 UDMA IDE" rev 0xc1: DMA (uns
upported), channel 0 configured to compatibility, channel 1 configured to compa
tibility
pciide1: channel 0 interrupting at irq 14
wd0 at pciide1 channel 0 drive 0: <Maxtor 91000D8>
wd0: can use 16-bit, PIO mode 4
wd0: 16-sector PIO, LBA, 9543MB, 16383 cyl, 16 head, 63 sec, 19545120 sectors
wd1 at pciide1 channel 0 drive 1: <WDC AC2420H>
wd1: can use 16-bit, PIO mode 3
wd1: 16-sector PIO, CHS, 405MB, 989 cyl, 15 head, 56 sec, 830760 sectors
pciide1: channel 1 interrupting at irq 15
atapiscsi0 at pciide1 channel 1
scsibus0 at atapiscsi0: 2 targets
cd0 at scsibus0 targ 0 lun 0: <MITSUMI, CR-4802TE, 1.9D> SCSI0 5/cdrom removabl
e
sd0 at scsibus0 targ 1 lun 0: <IOMEGA, ZIP 250, 51.G> SCSI0 0/direct removable
sd0: 239MB, 239 cyl, 64 head, 32 sec, 512 bytes/sec, 489532 sec total
cd0: can use 16-bit, PIO mode 3
sd0: can use 16-bit, PIO mode 3
isa0 at mainbus0
isadma0 at isa0
npx0 at isa0 port 0xf0/16: using exception 16
pccom0 at isa0 port 0x3f8/8 irq 4: ns16550a, 16 byte fifo
pccom1 at isa0 port 0x2f8/8 irq 3: ns16550a, 16 byte fifo
vt0 at isa0 port 0x60/16 irq 1: generic VGA, 80 col, color, 8 scr, mf2-kbd
fdc0 at isa0 port 0x3f0/6 irq 6 drq 2
fd0 at fdc0 drive 0: 1.44MB 80 cyl, 2 head, 18 sec
biomask c440 netmask d440 ttymask d442
rd0: fixed, 3560 blocks
wd0: no disk label
wd1: no disk label
rootdev=0x1100 rrootdev=0x2f00 rawdev=0x2f02
wd0: no disk label
rootdev=0x1100 rrootdev=0x2f00 rawdev=0x2f02
sh: /etc/rc: No such file or directory
Enter pathname of shell or RETURN for sh: _
erase ^?, werase ^W, kill ^U, intr ^C
(I)nstall, (U)pgrade or (S)hell? _i
====
Welcome to the OpenBSD/i386 2.6 installation program.

This program is designed to help you put OpenBSD on your disk in a simple and
rational way.

As with anything which modifies your disk's contents, this program can cause
SIGNIFICANT data loss, and you are advised to make sure your data is backed
up before beginning the installation process.

Default answers are displayed in brackets after the questions.  You can hit
Control-C at any time to quit, but if you do so at a prompt, you may have
to hit return.  Also, quitting in the middle of installation may leave your
system in an inconsistent state.  If you hit Control-C and restart the
install, the install program will remember many of your old answers.

You can run a shell command at any prompt via '!foo'
or escape to a shell by simply typing '!'.

Specify terminal type [pcvt25]: _

The installation program needs to know which disk to consider the root disk.
Note the unit number may be different than the unit number you used in the
boot program (especially on a PC with multiple disk controllers).
Available disks are:

sd0
wd0
wd1

Which disk is the root disk? [] _wd0
Do you want to use the *entire* disk for OpenBSD? [no] _yes

Updating MBR based on BIOS geometry.
Enter 'help' for information
fdisk: 1> In memory copy is initialized to:
Offset: 0       Signatures: 0xAA55,0x0
         Starting        Ending
 #: id  cyl  hd sec -   cyl  hd sec [     start -       size]
-------------------------------------------------------------------------
 0: 00    0   0   0 -     0   0   0 [         0 -          0] unused
 1: 00    0   0   0 -     0   0   0 [         0 -          0] unused
 2: 00    0   0   0 -     0   0   0 [         0 -          0] unused
*3: A6    0   1   1 -  1022 254  63 [        63 -   16434432] OpenBSD
Use 'write' to update disk.
fdisk:*1> Machine code updated.
fdisk:*1> Writing MBR at offset 0.
fdisk: 1> Here is the partition information you chose:

Disk: wd0       geometry: 1024/15/63 [96780 sectors]
Offset: 0       Signatures: 0xAA55,0x0
         Starting        Ending
 #: id  cyl  hd sec -   cyl  hd sec [     start -       size]
-------------------------------------------------------------------------
 0: 00    0   0   0 -     0   0   0 [         0 -          0] unused
 1: 00    0   0   0 -     0   0   0 [         0 -          0] unused
 2: 00    0   0   0 -     0   0   0 [         0 -          0] unused
*3: A6    0   1   1 -  1022 254  63 [        63 -   16434432] OpenBSD

Inside the BIOS 'A6' ('OpenBSD') partition you just created, there resides an
OpenBSD partition table which defines how this BIOS partition is to be split
up. This table declares the offsets and sizes of your / partition, your swap
space, and any other partitions you might create.  (NOTE: The OpenBSD disk
label offsets are absolute, ie. relative to the start of the disk... NOT
relative to the start of the BIOS 'A6' partition).

disklabel: no disk label
WARNING: Disk wd0 has no label. You will be creating a new one.

If this disk is shared with other operating systems, those operating systems
should have a BIOS partition entry that spans the space they occupy completely.
For safety, also make sure all OpenBSD file systems are within the offset and
size specified in the 'A6' BIOS partition table.  (By default, the disklabel
editor will try to enforce this).  If you are unsure of how to use multiple
partitions properly (ie. separating /,  /usr, /tmp, /var, /usr/local, and other
things) just split the space into a root and swap partition for now.

# using MBR partition 3: type A6 off 63 (0x3f) size 4991553 (0x4c2a41)

Treating sectors 63-16386300 as the OpenBSD portion of the disk.
You can use the 'b command to change this.

Initial label editor (enter '?' for help at any prompt)
> _?
Available commands:
        p [unit]  - print label.
        M         - show entire OpenBSD man page for disklabel.
        e         - edit drive parameters.
        a [part]  - add new partition.
        b         - set OpenBSD disk boundaries.
        c [part]  - change partition size.
        d [part]  - delete partition.
        g [d|b]   - Use [d]isk or [b]ios geometry.
        m [part]  - modify existing partition.
        n [part]  - set the mount point for a partition.
        r         - recalculate free space.
        u         - undo last change.
        s [path]  - save label to file.
        w         - write label to disk.
        q         - quit and save changes.
        x         - exit without saving changes.
        ? [cmnd]  - this message or command specific help.
Numeric parameters may use suffixes to indicate units:
        'b' for bytes, 'c' for cylinders, 'k' for kilobytes, 'm' for megabytes,
        'g' for gigabytes or no suffix for sectors (usually 512 bytes).
        Non-sector units will be rounded to the nearest cylinder.
Entering '?' at most prompts will give you (simple) context sensitive help.
> _p
device: /dev/rwd0c
type: ESDI
disk: ESDI/IDE disk
label: Maxtor 91000D8
bytes/sector: 512
tracks/cylinder: 16
sectors/cylinder: 1008
cylinders: 16383
total sectors: 19545120
total sectors: 19545057
rpm: 3600

16 partitions:
#        size   offset    fstype   [fsize bsize   cpg]
  a: 16450497       63    unused        0     0
  c: 16455120        0    unused        0     0
> _d a
> _a a
offset: [63] _
size: [16386237] _64M
Rounding to nearest cylinder: 131040
FS type: [4.2BSD] _
mount point: [none] _/
fragment size: [1024] _
block size: [8192] _
cpg: [16] _
> _a b
offset: [131103] _
size: [16255197] _64M
Rounding to nearest cylinder: 131040
FS type: [swap] _
> _a d
offset: [262143] _
size: [16124157] _64M
Rounding to nearest cylinder: 131040
FS type: [4.2BSD] _
mount point: [none] _/tmp
fragment size: [1024] _
block size: [8192] _
cpg: [16] _
> _a e
offset: [393183] _
size: [15993117] _64M
Rounding to nearest cylinder: 131040
FS type: [4.2BSD] _
mount point: [none] _/var
fragment size: [1024] _
block size: [8192] _
cpg: [16] _
> _a g
offset: [524223] _
size: [15862077] _300M
Rounding to nearest cylinder: 614880
FS type: [4.2BSD] _
mount point: [none] _/usr
fragment size: [1024] _
block size: [8192] _
cpg: [16] _
> _a h
offset: [1139103] _
size: [15247197] _*
FS type: [4.2BSD] _
mount point: [none] _/home
fragment size: [1024] _
block size: [8192] _
cpg: [16] _
> _p
device: /dev/rwd0c
type: ESDI
disk: ESDI/IDE disk
label: Maxtor 91000D8
bytes/sector: 512
tracks/cylinder: 16
sectors/cylinder: 1008
cylinders: 16383
total sectors: 19545120
total sectors: 19545057
rpm: 3600

16 partitions:
#        size   offset    fstype   [fsize bsize   cpg]
  a:   131040       63    unused        0     0        # /
  b:   131040   131103      swap
  c: 19545120        0    unused        0     0
  d:   131040   262143    unused        0     0        # /tmp
  e:   131040   393183    unused        0     0        # /var
  g:   614880   524223    unused        0     0        # /usr
  h: 15247197  1139103    unused        0     0        # /home
> _w
> _q
No label changes.

You will now have the opportunity to enter filesystem information for wd0.
You will be prompted for the mount point (full path, including the prepending
'/' character) for each BSD partition on wd0.  Enter "none" to skip a
partition or "done" when you are finished.

The following partitions will be used for the root filesystem and swap:
        wd0a    /
        wd0b    swap

Mount point for wd0d (size=65520k) [/tmp, RET, none, or done]? _
Mount point for wd0e (size=65520k) [/var, RET, none, or done]? _
Mount point for wd0g (size=307440k) [/usr, RET, none, or done]? _
Mount point for wd0h (size=1926256k) [/home, RET, none, or done]? _done

Nowq you can select another disk to initialize.  (Do not re-select a
disk you have already entered information for).  Available disks are:

sd0
wd0
wd1

Which one? [done] _

You have configured the following devices and mount points:

wd0a /
wd0d /tmp
wd0e /var
wd0g /usr
wd0h /home

Filesystems will now be created on these devices.
If you made any mistakes, you may edit this now.
Edit using ed? [n] _

============================================================
The next step will overwrite any existing data on:
        wd0a wd0d wd0e wd0g wd0h

Are you really sure that you're ready to proceed? [n] _y
/dev/rwd0a:    #### sectors ni ### cylinders of 16 tracks, 63 sectors
        64MB in 9 cyl groups (16 c/g, 7.88MB/g, 1920 i/g)
/dev/rwd0d:    #### sectors ni ### cylinders of 16 tracks, 63 sectors
        64MB in 9 cyl groups (16 c/g, 7.88MB/g, 1920 i/g)
/dev/rwd0e:    #### sectors ni ### cylinders of 16 tracks, 63 sectors
        64MB in 9 cyl groups (16 c/g, 7.88MB/g, 1920 i/g)
/dev/rwd0g:    #### sectors ni ### cylinders of 16 tracks, 63 sectors
        64MB in 9 cyl groups (16 c/g, 7.88MB/g, 1920 i/g)
/dev/rwd0h:    #### sectors ni ### cylinders of 16 tracks, 63 sectors
        64MB in 9 cyl groups (16 c/g, 7.88MB/g, 1920 i/g)

You will now be given the opportunity to configure the network.  This will be
useful if you need to transfer the installation sets via FTP, HTTP, or NFS.
Even if you choose not to transfer installation sets that way, this information
will be preserved and copied into the new root filesystem.

Configure the network [y] _n
/dev/wd0a on /mnt type ffs (rw, asynchronous, local)
/dev/wd0d on /mnt/tmp type ffs (rw, asynchronous, local)
/dev/wd0e on /mnt/var type ffs (rw, asynchronous, local)
/dev/wd0g on /mnt/usr type ffs (rw, asynchronous, local)
/dev/wd0h on /mnt/home type ffs (rw, asynchronous, local)

Please enter the initial password that the root account will have.
Password (will not echo): _
Password (again): _

Do you expect to run the X Window System? [y] _

It is now time to extract the installation sets onto the hard disk.  Make sure
the sets are either on a local device (i.e. tape, CD-ROM) or on a network
server.  You will have the chance to repeat this step or to extract sets from
several places, so you don't have to try to load all the sets in one try and
can recover from some errors.

Install from (f)tp, (h)ttp, (t)ape, (C)D-ROM, (N)FS or local (d)isk? _c

The following CD-ROM devices are installed on your system; please select
the CD-ROM device containing the partition with the installation sets:

cd0

Which is the CD-ROM with the installation media? [abort] _cd0
CD-ROM partition to mount (normally "c")? [c] _

There are two CD-ROM filesystem types currently supported by this program:
cd9660          ISO-9660
ffs             Berkeley Fast Filesystem

Which filesystem type? [cd9660] _
Enter the directory relative to the mount point that
contains the file. [/2.6/i386] _

You will now be asked for files to extract.  In addition to the
files listed in the selector you may enter any file located in
/mnt2//2.6/i386.  You can also enter 'all' to install all the standard
sets, or 'list' to list the files available in /mnt2//2.6/i386.
When you are done selecting files, enter 'done'.
Some of these sets are required for your install and some are optional --
You will want at least the base and bsd sets.
Consult the installation notes if you are not sure which sets are required!

The following sets are available for extraction.
Enter filename, `list', `all', or `done'.
You may de-select a set by prepending a '-' to it's name.

        [X] base26.tar.gz
        [X] etc26.tar.gz
        [ ] misc26.tar.gz
        [ ] comp26.tar.gz
        [X] man26.tar.gz
        [ ] game26.tar.gz
        [ ] xbase26.tar.gz
        [ ] xshare26.tar.gz
        [ ] xfont26.tar.gz
        [ ] xserv26.tar.gz
        [X] bsd

File name []? _*

The following sets are available for extraction.
Enter filename, `list', `all', or `done'.
You may de-select a set by prepending a '-' to it's name.

        [X] base26.tar.gz
        [X] etc26.tar.gz
        [X] misc26.tar.gz
        [X] comp26.tar.gz
        [X] text26.tar.gz
        [X] man26.tar.gz
        [X] game26.tar.gz
        [X] xbase26.tar.gz
        [X] xshare26.tar.gz
        [X] xfont26.tar.gz
        [X] xserv26.tar.gz
        [X] bsd
File name []? _-game*

The following sets are available for extraction.
Enter filename, `list', `all', or `done'.
You may de-select a set by prepending a '-' to it's name.

        [X] base26.tar.gz
        [X] etc26.tar.gz
        [X] misc26.tar.gz
        [X] comp26.tar.gz
        [X] text26.tar.gz
        [X] man26.tar.gz
        [ ] game26.tar.gz
        [X] xbase26.tar.gz
        [X] xshare26.tar.gz
        [X] xfont26.tar.gz
        [X] xserv26.tar.gz
        [X] bsd
File name []? _done

Ready to extract selected file sets? [y] _


Getting base26.tar.gz ...
100% |***************************************************| 19807 KB   00:00 ETA
Getting etc26.tar.gz ...
100% |***************************************************|   164 KB   00:00 ETA
Getting man26.tar.gz ...
100% |***************************************************|  4473 KB   00:00 ETA
Getting bsd ...
100% |***************************************************|  2770 KB   00:00 ETA
Getting misc26.tar.gz ...
100% |***************************************************|  1637 KB   00:00 ETA
Getting comp26.tar.gz ...
100% |***************************************************| 12616 KB   00:00 ETA
Getting xbase26.tar.gz ...
100% |***************************************************|  5429 KB   00:00 ETA
Getting xshare26.tar.gz ...
100% |***************************************************|  1495 KB   00:00 ETA
Getting xfont26.tar.gz ...
100% |***************************************************|  6018 KB   00:00 ETA
Getting xserv26.tar.gz ...
100% |***************************************************| 14981 KB   00:00 ETA

Extract more sets? [n] _

Two OpenBSD libraries (libssl and libcrypto, based on OpenSSL) implement many
cryptographic functions which are used by OpenBSD programs like ssh, httpd, and
isakmpd.  Due to patent licensing reasons, those libraries may not be included
on the CD -- instead the base distribution contains libraries which have had
the troublesome code removed -- the programs listed above will not be fully
functional as a result.  Libraries which _include_ the troublesome routines
are available and can be FTP installed, as long as you meet the follow (legal)
criteria:
  (1) Outside the USA, no restrictions apply. Use ssl26.tar.gz.
  (2) Inside the USA, non-commercial entities may install sslUSA26.tar.gz.
  (3) Commercial entities in the USA are left in the cold, due to how the
      licenses work.  (This is how the USA crypto export policy feels to the
      rest of the world.)

If you do not install the ssl package now, it is easily installed at
a later time (see the afterboot(8) and ssl(8) manual pages)."
Install (U)SA, (I)nternational, or (N)one? [none] _i
Install SSL+RSA libraries via (f)tp, (h)ttp, or (c)ancel? [ftp] _f
Enter system hostname (short form): [] _mybox
Enter DNS domain name: [] _someisp.com

If you have any devices being configured by a DHCP server
it is recommended that you do not enter a default route or
any name servers.

You may configure the following network interfaces (the interfaces marked
with [X] have been successfully configured):

        [ ] xl0
        [ ] fxp0

Configure which interface? (or, enter 'done') [xl0] _
IP address (or 'dhcp')? [] _199.185.137.55
Symbolic (host) name? [mybox] _
Netmask ? [255.255.255.0] _
Your network interface might require non-default
media directives.  The default media is:
        media: Ethernet 100baseTX half-duplex
This is a list of supported media:
        media autoselect
        media 100baseTX mediaopt full-duplex
        media 100baseTX mediaopt half-duplex
        media 100baseTX
        media 10baseT mediaopt full-duplex
        media 10baseT
        media 10baseT mediaopt half-duplex
If the default is not satisfactory, and you wish to use another
media, copy that line from above (ie. "media 100baseTX")
Media directives? [] _

You may configure the following network interfaces (the interfaces marked
with [X] have been successfully configured):

        [X] xl0
        [ ] fxp0
Configure which interface? (or, enter 'done') [done] _
Enter IP address of default route: [none] _199.185.137.128
Enter IP address of primary nameserver: [none] _199.185.137.1
Would you like to use the nameserver now? [y] _

You will now be given the opportunity to escape to the command shell to do
any additional network configuration you may need.  This may include adding
additional routes, if needed.  In addition, you might take this opportunity
to redo the default route in the event that it failed above.
Escape to shell? [n] _

HTTP/FTP proxy URL? (ie. "http://proxy:8080", or "none") [none] _

By default, ftp will attempt a passive connection and fall back to a normal
(active) connection if that doesn't work.  However, there are some very
old ftp servers that claim to support passive mode, but really do not.
In this case, you should explicitly request an active session.
Do you want to use active ftp? [n] _n
Do you want a list of potential ftp servers? [y] _y

     1
ftp://ftp.openbsd.org/pub/OpenBSD


Alberta, Canada
     2
ftp://ftp1.usa.openbsd.org/pub/OpenBSD


Michigan, USA
     3
ftp://ftp.op.net/pub/OpenBSD



Pennsylvania, USA
     4
ftp://ftp.de.openbsd.org/pub/unix/OpenBSD

Germany
     5
ftp://ftp.jp.openbsd.org/OpenBSD


Japan
     6
ftp://ftp.dti.ad.jp/pub/OpenBSD



Japan
     7
ftp://ftp.lip6.fr/pub/OpenBSD



France
     8
ftp://ftp.univ-evry.fr/pub/OpenBSD


France
     9
ftp://ftp.eu.openbsd.org/pub/OpenBSD
d6455 1
a6456 3
Switzerland
    10
ftp://lager.ucs.ualberta.ca/pub/OpenBSD
d6458 1
d6460 122
a6581 3
Edmonton, Canada
    11
ftp://ftp.eecs.umich.edu/pub/OpenBSD
d6584 1
a6584 3
Michigan, USA
    12
ftp://obsd.compmore.net/pub/OpenBSD
d6586 1
d6588 1
a6588 3
Kanata, Canada
    13
ftp://ftp.geek-girl.com/pub/OpenBSD
d6590 2
d6593 85
a6677 3
Illinois, USA
    14
ftp://ftp.stacken.kth.se/pub/OpenBSD
d6679 1
d6681 10
a6690 3
Stockholm, Sweden
    15
ftp://ftp.demon.co.uk/pub/OpenBSD
d6692 8
d6701 149
a6849 3
London, UK
    16
ftp://ftp.th.openbsd.org/pub/OpenBSD
d6851 1
d6853 2
a6854 3
Thailand
    17
ftp://ftp.au.openbsd.org/pub/OpenBSD
d6856 11
d6868 1
a6868 3
Australia
    18
ftp://sunsite.kren.ne.kr/pub/OS/OpenBSD
d6870 2
d6873 1
a6873 3
South Korea
    19
ftp://ftp.calyx.nl/pub/OpenBSD
d6875 3
d6879 1
d6881 10
a6890 3
The Netherlands
    20
ftp://openbsd.rug.ac.be/pub/OpenBSD
d6892 2
d6895 1
a6895 3
Belgium
    21
ftp://ftp.it.net.au/mirrors/OpenBSD
d6897 2
d6900 1
a6900 3
Australia
    22
ftp://ftp.radio-msu.net/pub/OpenBSD
d6902 5
d6908 2
a6909 3
Moscow, Russia
    23
ftp://ftp.sunet.se:/pub/OpenBSD
d6911 380
d7292 1
d7294 2
a7295 3
Uppsala, Sweden
    24
ftp://ftp3.usa.openbsd.org/pub/OpenBSD
d7297 6
d7304 1
a7304 6
Colorado, USA
    25
ftp://ftp.netlab.is.tsukuba.ac.jp/pub/os/OpenBSD
Ibaraki, Japan
    26
ftp://ftp.tut.ac.jp/pub/OpenBSD
d7306 2
d7309 2
d7312 2
a7313 3
Japan
    27
ftp://ftp.plig.org/pub/OpenBSD
d7315 2
d7318 2
d7321 2
a7322 3
London, UK
    28
ftp://ftp.it.net.au/pub/OpenBSD
d7324 2
d7327 2
d7330 2
a7331 3
Australia
    29
ftp://vs.itam.nsc.ru/pub/OpenBSD
d7333 1
d7335 2
a7336 3
Novosibirsk, Russia
    30
ftp://ftp.task.gda.pl/pub/OpenBSD
d7338 1
d7340 1
a7340 3
Poland
    31
ftp://openbsd.csie.nctu.edu.tw/pub/OpenBSD
d7342 1292
a8633 3
Taiwan
    32
ftp://ftp.netasset.com/pub/OpenBSD
d8635 1
d8637 2
a8638 3
Fresno, CA, USA
    33
ftp://ftp.chg.ru/pub/OpenBSD
d8640 202
d8843 1
d8845 1
a8845 3
Chernogolovka, Russia
    34
ftp://mirror.nucba.ac.jp/mirror/OpenBSD
d8847 84
a8931 3
Aichi, Japan
    35
ftp://uiarchive.uiuc.edu/pub/systems/OpenBSD
d8933 1
a8933 3
Urbana, IL, USA
    36
ftp://quasar.uvt.ro/pub/OpenBSD
d8935 2
d8938 1
d8940 1
a8940 3
Timisoara, Romania
    37
ftp://ftp.nz.openbsd.org
d8942 74
d9018 1
a9018 3
New Zealand
    38
ftp://ftp.club-internet.fr/pub/OpenBSD
d9020 145
d9166 2
a9167 3
France
    39
ftp://gd.tuwien.ac.at/opsys/OpenBSD
d9169 20
d9190 143
a9332 4
Austria
Server IP address, hostname, or list#? [] _1
Using
ftp://ftp.openbsd.org/pub/OpenBSD
d9334 1
d9336 328
a9663 87
Alberta, Canada
Server IP address, hostname, or list#? [ftp.openbsd.org] _
Server directory? [pub/OpenBSD/2.6/i386] _
Login? [anonymous] _

You will now be asked for files to extract. In addition to the files listed,
you may select any file located at
 ftp.openbsd.org:pub/OpenBSD/2.6/i386
You can also enter 'all' to install all the standard sets, or 'list' to list
the files available. When you are done selecting files, enter 'done'. Some of
these sets are required for your install and some are optional -- you will want
at least the base and bsd sets. Consult the installation notes if you are not
sure which sets are required!

The following sets are available for extraction.
Enter filename, `list', `all', or `done'.
You may de-select a set by prepending a '-' to its name.


[X] ssl26.tar.gz
File name? [] _done

Fetching files via ftp may take a long time, especially over a slow network
connection.  Ready to download files? [y] _y

Getting ssl26.tar.gz ...
100% |**************************************************|  1522 KB    00:00 ETA

Copying hostname.xl0, hosts, myname, mygate, resolv.conf,  ...done.

Select a time zone for your location. Timezones are represented on the
system by a directory structure rooted in "/usr/share/timezone". Most
timezones can be selected by entering a token like "MET" or "GMT-6".
Other zones are grouped by continent, with detailed zone information
separated by a slash ("/"), e.g. "US/Pacific" or "Canada/Mountain".

To get a listing of what's available in /usr/share/zoneinfo, enter "?"
at the prompts below.

What timezone are you in [`?' for list] [GMT]? _?
Africa/      Chile/       GMT          Jamaica      Navajo       UCT
America/     Cuba         GMT+0        Japan        PRC          US/
Antarctica/  EET          GMT-0        Kwajalein    PST8PDT      UTC
Arctic/      EST          GMT0         Libya        Pacific/     Universal
Asia/        EST5EDT      Greenwich    MET          Poland       W-SU
Atlantic/    Egypt        HST          MST          Portugal     WET
Australia/   Eire         Hongkong     MST7MDT      ROC          Zulu
Brazil/      Etc/         Iceland      Mexico/      ROK          posixrules
CET          Europe/      Indian/      Mideast/     Singapore
CST6CDT      Factory      Iran         NZ           SystemV/
Canada/      GB           Israel       NZ-CHAT      Turkey
What timezone are you in [`?' for list] [GMT]? _Canada
There are several timezones available within zone 'Canada'
Select a sub-timezone [`?' for list]: _?
Atlantic            Eastern             Pacific
Central             Mountain            Saskatchewan
East-Saskatchewan   Newfoundland        Yukon
Select a sub-timezone [`?' for list]: _Mountain
You have selected timezone "Canada/Mountain".
Installing timezone link...done.
Installing boot block...
boot: /mnt/boot
proto: /usr/mdec/biosboot
device: /dev/rwd0c
/usr/mdec/biosboot: entry point 0
proto bootblock size 512
room for 12 filesystem blocks at 0x16f
Will load 6 blocks of size 8192 each.
Using disk geometry of 63 sectors and 128 heads.
 0: 19 @@(0 93 45) (5903-5921)
 1: 63 @@(0 94 1) (5922-5984)
 2: 14 @@(0 95 1) (5985-5998)
/mnt/boot: 3 entries total
using MBR partition 3: type 166 (0xa6) offset 63 (0x3f)

Enabling machdep.allowaperture. Read xf86(4) for more information.

Making all device nodes (by running /dev/MAKEDEV) ...... done.
Unmounting filesystems... /mnt/home/ /mnt/usr /mnt/var /mnt/tmp /mnt ... Done.
Done.

CONGRATULATIONS!  You have successfully installed OpenBSD!  To boot the
installed system, enter halt at the command prompt. Once the system has
halted, reset the machine and boot from the disk.

# _reboot

@


1.26
log
@giant spelling/grammar clean-up; ok millert@@
@
text
@d57 1
a57 1
   $OpenBSD: obsd-faq.txt,v 1.25 2001/07/02 20:48:36 jufi Exp $
d253 1
a253 1
   $OpenBSD: obsd-faq.txt,v 1.25 2001/07/02 20:48:36 jufi Exp $
d271 1
a271 1
  15. http://openbsd.org/powerpc.html
d589 1
a589 1
   $OpenBSD: obsd-faq.txt,v 1.25 2001/07/02 20:48:36 jufi Exp $
d729 1
a729 1
   $OpenBSD: obsd-faq.txt,v 1.25 2001/07/02 20:48:36 jufi Exp $
d960 1
a960 1
   $OpenBSD: obsd-faq.txt,v 1.25 2001/07/02 20:48:36 jufi Exp $
d1489 1
a1489 1
   $OpenBSD: obsd-faq.txt,v 1.25 2001/07/02 20:48:36 jufi Exp $
d2917 1
a2917 1
   $OpenBSD: obsd-faq.txt,v 1.25 2001/07/02 20:48:36 jufi Exp $
d3079 1
a3079 1
   $OpenBSD: obsd-faq.txt,v 1.25 2001/07/02 20:48:36 jufi Exp $
d3909 1
a3909 1
   $OpenBSD: obsd-faq.txt,v 1.25 2001/07/02 20:48:36 jufi Exp $
d4109 1
a4109 1
   $OpenBSD: obsd-faq.txt,v 1.25 2001/07/02 20:48:36 jufi Exp $
d4979 1
a4979 1
#       $OpenBSD: obsd-faq.txt,v 1.25 2001/07/02 20:48:36 jufi Exp $
d5020 1
a5020 1
   $OpenBSD: obsd-faq.txt,v 1.25 2001/07/02 20:48:36 jufi Exp $
d5164 1
a5164 1
   $OpenBSD: obsd-faq.txt,v 1.25 2001/07/02 20:48:36 jufi Exp $
d5307 1
a5307 1
   $OpenBSD: obsd-faq.txt,v 1.25 2001/07/02 20:48:36 jufi Exp $
d5579 1
a5579 1
   $OpenBSD: obsd-faq.txt,v 1.25 2001/07/02 20:48:36 jufi Exp $
d5666 1
a5666 1
   $OpenBSD: obsd-faq.txt,v 1.25 2001/07/02 20:48:36 jufi Exp $
d6634 1
a6634 1
   $OpenBSD: obsd-faq.txt,v 1.25 2001/07/02 20:48:36 jufi Exp $
d7360 1
a7360 1
   $OpenBSD: obsd-faq.txt,v 1.25 2001/07/02 20:48:36 jufi Exp $
d7407 1
a7407 1
   Last Update - $OpenBSD: obsd-faq.txt,v 1.25 2001/07/02 20:48:36 jufi Exp $
@


1.25
log
@
all patches by David Krause <openbsd@@davidkrause.com>
@
text
@d57 1
a57 1
   $OpenBSD: obsd-faq.txt,v 1.24 2001/06/14 22:57:02 fgsch Exp $
d253 1
a253 1
   $OpenBSD: obsd-faq.txt,v 1.24 2001/06/14 22:57:02 fgsch Exp $
d459 1
a459 1
   tree unformatted, and many times thru the use of [31]CVS, they will be
d589 1
a589 1
   $OpenBSD: obsd-faq.txt,v 1.24 2001/06/14 22:57:02 fgsch Exp $
d669 1
a669 1
     * OpenBSD CD's always come with very nice stickers. You system isn't
d721 1
a721 1
   can do that thru cvsweb at:
d729 1
a729 1
   $OpenBSD: obsd-faq.txt,v 1.24 2001/06/14 22:57:02 fgsch Exp $
d771 1
a771 1
   situation to be able to install an OpenBSD system. The seperate ways
d846 1
a846 1
       software, make your /usr parition large! At least triple these
d952 1
a952 1
   NOTE - Please send only GENERIC kernel dmesg's. Custom kernels that
d960 1
a960 1
   $OpenBSD: obsd-faq.txt,v 1.24 2001/06/14 22:57:02 fgsch Exp $
d1071 2
a1072 2
   binaries from other OS's. Not all are availibly on every
   architechture, so be sure to read the man pages for each option to see
d1127 1
a1127 1
       to read from cd's
d1159 1
a1159 1
     * FIFO - Support for FIFO's.. RECOMMENDED.
d1489 1
a1489 1
   $OpenBSD: obsd-faq.txt,v 1.24 2001/06/14 22:57:02 fgsch Exp $
d1636 1
a1636 1
   As you can see here, ifconfig(8) gives us alot more information than
d1639 1
a1639 1
   configured. You can tell this by seeing that vaulues are already set
d2214 1
a2214 1
   cable modem prodiver)
d2341 1
a2341 1
   Here is an explaination for the above lines.
d2371 1
a2371 1
   for ICMP, and other protcols). Once this is in the file, all that's
d2640 1
a2640 1
   setup and probobly most used setup. Here is a quick ppp.conf file that
d2655 1
a2655 1
   not be on COM1, however the nameing scheme was wrong.
d2670 1
a2670 1
   Here I will use myisp: as our tag refering to our ISP. Here is a
d2690 1
a2690 1
   explaination.
d2728 1
a2728 1
  ppp(8) extra's
d2816 1
a2816 1
   which filesystems you wish to have accessable via NFS and defines who
d2917 1
a2917 1
   $OpenBSD: obsd-faq.txt,v 1.24 2001/06/14 22:57:02 fgsch Exp $
d3079 1
a3079 1
   $OpenBSD: obsd-faq.txt,v 1.24 2001/06/14 22:57:02 fgsch Exp $
d3148 1
a3148 1
   and switch with [ctrl]-[alt]-[F2] to term 2, X will seem to disapear
d3163 1
a3163 1
    5. boot into mulituser mode.. and remember your password!
d3447 1
a3447 1
zip-2.2             Create/update ZIP files compatabile with pkzip.
d3587 1
a3587 1
   on some occations there are instructions of extra objects that need to
d3671 1
a3671 1
   Once that file is in existence, you can initalize your S/Key. To do
d3909 1
a3909 1
   $OpenBSD: obsd-faq.txt,v 1.24 2001/06/14 22:57:02 fgsch Exp $
d3996 1
a3996 1
     * OpenBSD has a ports tree. This is to accomodate the fact that at
d4109 1
a4109 1
   $OpenBSD: obsd-faq.txt,v 1.24 2001/06/14 22:57:02 fgsch Exp $
d4152 1
a4152 1
       thru POP. What can i do?
d4256 1
a4256 1
   installed a daemon in which lie's at /usr/local/sbin/daemonx. I want
d4273 1
a4273 1
   equivlent of "shutdown -p".
d4292 1
a4292 1
   causes most daemons to re-read their configration file):
d4301 1
a4301 1
10.5 - I've set up POP, but users have trouble accessing mail thru POP. What
d4328 1
a4328 1
   locking would only be valueable for the POP daemon.)
d4333 1
a4333 1
   However, because of various patents, some libaries cannot be shipped.
d4494 1
a4494 1
   This will go thru /etc/fstab to turn on the filesystems with quota
d4519 1
a4519 1
   more than a 5 minute time skew, you will receive wierd errors that do
d4979 1
a4979 1
#       $OpenBSD: obsd-faq.txt,v 1.24 2001/06/14 22:57:02 fgsch Exp $
d5020 1
a5020 1
   $OpenBSD: obsd-faq.txt,v 1.24 2001/06/14 22:57:02 fgsch Exp $
d5113 1
a5113 1
   The 2.4 cd's shipped with a problem in installboot. A patch can be
d5164 1
a5164 1
   $OpenBSD: obsd-faq.txt,v 1.24 2001/06/14 22:57:02 fgsch Exp $
d5307 1
a5307 1
   $OpenBSD: obsd-faq.txt,v 1.24 2001/06/14 22:57:02 fgsch Exp $
d5540 1
a5540 1
       throughput business and research enviroments. But, if you need
d5557 1
a5557 1
   problem? The quest for speed should not sacrifice the reliabilty and
d5579 1
a5579 1
   $OpenBSD: obsd-faq.txt,v 1.24 2001/06/14 22:57:02 fgsch Exp $
d5666 1
a5666 1
   $OpenBSD: obsd-faq.txt,v 1.24 2001/06/14 22:57:02 fgsch Exp $
d5826 1
a5826 1
       header, and a new IP header is repended to the packet that covers
d5859 1
a5859 1
   This is called Transport Adjacency. The tunnelling version would look
d5867 1
a5867 1
   italics). When an AH and an ESP header are diectly applied together
d5875 1
a5875 1
   left to the designer, however the RFC has some strong recomendations
d6221 1
a6221 1
   the IPSec stack. Unfotunately, the same cannot be said for the sample
d6342 1
a6342 1
   They each describe the requirements that the peer gateway must fulfil
d6634 1
a6634 1
   $OpenBSD: obsd-faq.txt,v 1.24 2001/06/14 22:57:02 fgsch Exp $
d6809 1
a6809 1
   mountpoint at / will probobly suffice. When initially creating your
d6822 1
a6822 1
partitions properly (ie. seperating /,  /usr, /tmp, /var, /usr/local, and other
d6944 1
a6944 1
   during the OpenBSD install. Probobly the single most important command
d7122 1
a7122 1
   directory /usr/local. Then reboot the system, and whala!! the files
d7227 1
a7227 1
   Softupdates are experimental and are NOT recomended for regular users.
d7232 1
a7232 1
   cache opertions would permit the requirement for synchronous writing
d7360 1
a7360 1
   $OpenBSD: obsd-faq.txt,v 1.24 2001/06/14 22:57:02 fgsch Exp $
d7407 1
a7407 1
   Last Update - $OpenBSD: obsd-faq.txt,v 1.24 2001/06/14 22:57:02 fgsch Exp $
d8070 1
a8070 1
   Yes it does. This is especially noticable with the old -O2 gcc switch.
d8176 1
a8176 1
   must change all occurences of pn*, mx, al, or ax in your configuration
d8618 1
a8618 1
Which is the CD-ROM with the nistallation media? [abort] _cd0
d8632 1
a8632 1
sets, or 'list' to list the files avilable in /mnt2//2.6/i386.
d8636 1
a8636 1
Consult the intallation notes if you are not sure which sets are required!
d8729 1
a8729 1
      licences work.  (This is how the USA crypto export policy feels to the
@


1.24
log
@ipnat.conf -> ipnat.rules; spotted by bignose at irc.
@
text
@d57 1
a57 1
   $OpenBSD: obsd-faq.txt,v 1.23 2000/05/15 02:36:51 wvdputte Exp $
d253 1
a253 1
   $OpenBSD: obsd-faq.txt,v 1.23 2000/05/15 02:36:51 wvdputte Exp $
d589 1
a589 1
   $OpenBSD: obsd-faq.txt,v 1.23 2000/05/15 02:36:51 wvdputte Exp $
d729 1
a729 1
   $OpenBSD: obsd-faq.txt,v 1.23 2000/05/15 02:36:51 wvdputte Exp $
d960 1
a960 1
   $OpenBSD: obsd-faq.txt,v 1.23 2000/05/15 02:36:51 wvdputte Exp $
d1489 1
a1489 1
   $OpenBSD: obsd-faq.txt,v 1.23 2000/05/15 02:36:51 wvdputte Exp $
d2917 1
a2917 1
   $OpenBSD: obsd-faq.txt,v 1.23 2000/05/15 02:36:51 wvdputte Exp $
d3079 1
a3079 1
   $OpenBSD: obsd-faq.txt,v 1.23 2000/05/15 02:36:51 wvdputte Exp $
d3245 1
a3245 1
ericj@@oshibana:~> export CVS_RSH=/usr/local/bin/ssh
d3247 1
a3247 1
/usr/local/bin/ssh
d3909 1
a3909 1
   $OpenBSD: obsd-faq.txt,v 1.23 2000/05/15 02:36:51 wvdputte Exp $
d4109 1
a4109 1
   $OpenBSD: obsd-faq.txt,v 1.23 2000/05/15 02:36:51 wvdputte Exp $
d4979 1
a4979 1
#       $OpenBSD: obsd-faq.txt,v 1.23 2000/05/15 02:36:51 wvdputte Exp $
d5020 1
a5020 1
   $OpenBSD: obsd-faq.txt,v 1.23 2000/05/15 02:36:51 wvdputte Exp $
d5164 1
a5164 1
   $OpenBSD: obsd-faq.txt,v 1.23 2000/05/15 02:36:51 wvdputte Exp $
d5307 1
a5307 1
   $OpenBSD: obsd-faq.txt,v 1.23 2000/05/15 02:36:51 wvdputte Exp $
d5579 1
a5579 1
   $OpenBSD: obsd-faq.txt,v 1.23 2000/05/15 02:36:51 wvdputte Exp $
d5666 1
a5666 1
   $OpenBSD: obsd-faq.txt,v 1.23 2000/05/15 02:36:51 wvdputte Exp $
d6634 1
a6634 1
   $OpenBSD: obsd-faq.txt,v 1.23 2000/05/15 02:36:51 wvdputte Exp $
d7360 1
a7360 1
   $OpenBSD: obsd-faq.txt,v 1.23 2000/05/15 02:36:51 wvdputte Exp $
d7407 1
a7407 1
   Last Update - $OpenBSD: obsd-faq.txt,v 1.23 2000/05/15 02:36:51 wvdputte Exp $
d7521 1
a7521 1
# export CVS_RSH=/usr/local/bin/ssh
@


1.23
log
@I hate these $Date$ tags.
@
text
@d57 1
a57 1
   $OpenBSD: obsd-faq.txt,v 1.22 2000/02/28 01:25:14 ericj Exp $
d253 1
a253 1
   $OpenBSD: obsd-faq.txt,v 1.22 2000/02/28 01:25:14 ericj Exp $
d589 1
a589 1
   $OpenBSD: obsd-faq.txt,v 1.22 2000/02/28 01:25:14 ericj Exp $
d729 1
a729 1
   $OpenBSD: obsd-faq.txt,v 1.22 2000/02/28 01:25:14 ericj Exp $
d960 1
a960 1
   $OpenBSD: obsd-faq.txt,v 1.22 2000/02/28 01:25:14 ericj Exp $
d1489 1
a1489 1
   $OpenBSD: obsd-faq.txt,v 1.22 2000/02/28 01:25:14 ericj Exp $
d2476 1
a2476 1
   ipnat.conf:
d2917 1
a2917 1
   $OpenBSD: obsd-faq.txt,v 1.22 2000/02/28 01:25:14 ericj Exp $
d3079 1
a3079 1
   $OpenBSD: obsd-faq.txt,v 1.22 2000/02/28 01:25:14 ericj Exp $
d3909 1
a3909 1
   $OpenBSD: obsd-faq.txt,v 1.22 2000/02/28 01:25:14 ericj Exp $
d4109 1
a4109 1
   $OpenBSD: obsd-faq.txt,v 1.22 2000/02/28 01:25:14 ericj Exp $
d4979 1
a4979 1
#       $OpenBSD: obsd-faq.txt,v 1.22 2000/02/28 01:25:14 ericj Exp $
d5020 1
a5020 1
   $OpenBSD: obsd-faq.txt,v 1.22 2000/02/28 01:25:14 ericj Exp $
d5164 1
a5164 1
   $OpenBSD: obsd-faq.txt,v 1.22 2000/02/28 01:25:14 ericj Exp $
d5307 1
a5307 1
   $OpenBSD: obsd-faq.txt,v 1.22 2000/02/28 01:25:14 ericj Exp $
d5579 1
a5579 1
   $OpenBSD: obsd-faq.txt,v 1.22 2000/02/28 01:25:14 ericj Exp $
d5666 1
a5666 1
   $OpenBSD: obsd-faq.txt,v 1.22 2000/02/28 01:25:14 ericj Exp $
d6634 1
a6634 1
   $OpenBSD: obsd-faq.txt,v 1.22 2000/02/28 01:25:14 ericj Exp $
d7360 1
a7360 1
   $OpenBSD: obsd-faq.txt,v 1.22 2000/02/28 01:25:14 ericj Exp $
d7407 1
a7407 1
   Last Update - $OpenBSD$
@


1.22
log
@update
@
text
@d57 1
a57 1
   $OpenBSD: index.html,v 1.90 2000/01/20 21:04:32 chris Exp $
d253 1
a253 1
   $OpenBSD: faq1.html,v 1.17 1999/12/05 21:35:49 chris Exp $
d589 1
a589 1
   $OpenBSD: faq2.html,v 1.24 1999/12/04 23:13:07 ericj Exp $
d729 1
a729 1
   $OpenBSD: faq3.html,v 1.13 1999/11/29 07:30:16 ericj Exp $
d960 1
a960 1
   $OpenBSD: faq4.html,v 1.69 2000/02/09 22:11:37 ericj Exp $
d1489 1
a1489 1
   $OpenBSD: faq5.html,v 1.42 2000/02/24 16:08:12 chris Exp $
d2917 1
a2917 1
   $OpenBSD: faq6.html,v 1.55 2000/02/20 12:44:43 wvdputte Exp $
d3079 1
a3079 1
   $OpenBSD: faq7.html,v 1.13 2000/01/22 17:40:31 ericj Exp $
d3909 1
a3909 1
   $OpenBSD: faq8.html,v 1.44 2000/02/09 22:11:37 ericj Exp $
d4109 1
a4109 1
   $OpenBSD: faq9.html,v 1.19 1999/12/20 21:51:54 chris Exp $
d4979 1
a4979 1
#       $OpenBSD: faq10.html,v 1.39 2000/02/09 23:31:03 chris Exp $
d5020 1
a5020 1
   $OpenBSD: faq10.html,v 1.39 2000/02/09 23:31:03 chris Exp $
d5164 1
a5164 1
   $OpenBSD: faq11-2.4.html,v 1.7 1999/12/06 21:42:08 chris Exp $
d5307 1
a5307 1
   $OpenBSD: faq11-2.5.html,v 1.6 2000/02/12 21:35:42 aaron Exp $
d5579 1
a5579 1
   $OpenBSD: faq11.html,v 1.7 2000/02/26 01:19:59 rohee Exp $
d5666 1
a5666 1
   $OpenBSD: faq12.html,v 1.24 1999/12/06 21:45:57 chris Exp $
d6634 1
a6634 1
   $OpenBSD: faq13.html,v 1.23 2000/02/08 19:04:28 chris Exp $
d7360 1
a7360 1
   $OpenBSD: faq14.html,v 1.16 2000/02/12 21:35:42 aaron Exp $
d7407 1
a7407 1
   Last Update - $Date: 2000/02/17 20:27:10 $
@


1.21
log
@permenant -> permanent
@
text
@d9 14
a22 14
    [2]1.0 - Intro to OpenBSD
    [3]2.0 - Other resources
    [4]3.0 - Obtaining OpenBSD
    [5]4.0 - Installation Guide
    [6]5.0 - Kernel Configuration
    [7]6.0 - Networking Setup
    [8]7.0 - Keyboard Controls
    [9]8.0 - General Questions
    [10]9.0 - Migrating from Linux
    [11]10.0 - System Management
    [12]11.0 - Performance Tuning
    [13]12.0 - For Advanced Users
    [14]13.0 - Using IPSec
    [15]14.0 - Disk setup
d57 1
a57 1
   $OpenBSD: obsd-faq.txt,v 1.20 2000/01/20 22:35:12 ericj Exp $
d253 1
a253 1
   $OpenBSD: obsd-faq.txt,v 1.20 2000/01/20 22:35:12 ericj Exp $
d589 1
a589 1
   $OpenBSD: obsd-faq.txt,v 1.20 2000/01/20 22:35:12 ericj Exp $
d729 1
a729 1
   $OpenBSD: obsd-faq.txt,v 1.20 2000/01/20 22:35:12 ericj Exp $
d763 2
d774 1
a774 1
       You can do so by going to [6]http://www.openbsd.org/orders.html.
d787 1
a787 1
       server. Read [7]mount_nfs(8) for more information.
d791 1
a791 1
   You can get a list of mirrors on [8]http://www.openbsd.org/ftp.html. )
d794 1
a794 1
   found in [9]FAQ 1.
d798 3
a800 3
   [10]INSTALL.i386 and [11]INSTALL.sparc documents also.
     * [12]install-i386.html for i386 architecture.
     * [13]install-sparc.html for sparc architecture.
d804 1
a804 1
   architecture, as well as this [14]generic installation walkthrough.
d816 1
a816 1
   for the i386 architecture. And again follow the [15]install
d899 1
a899 1
        # dd if=/dev/rsd0a of=openbsd.pbr bs=512 count=1
d907 1
a907 1
   at the [16]NTLDR Hacking Guide.
d913 1
a913 1
   Some bootloaders of choice are [17]osbs20b8.zip or [18]The Ranish
d918 1
a918 1
   Please refer to [19]INSTALL.linux, which gives indepth instructions on
d937 1
a937 1
   Also check with [20]section 14.7
d955 2
a956 2
   [21][Back to Main Index] [22][To Section 3.0 - Obtaining OpenBSD]
   [23][To Section 5.0 - Kernel configuration and Disk Setup]
d959 2
a960 2
   [24][back] [25]www@@openbsd.org
   $OpenBSD: obsd-faq.txt,v 1.20 2000/01/20 22:35:12 ericj Exp $
d969 9
a977 9
   6. http://openbsd.org/orders.html
   7. http://www.openbsd.org/cgi-bin/man.cgi?query=mount_nfs&sektion=8&format=html
   8. http://openbsd.org/ftp.html
   9. http://openbsd.org/faq/faq1.html#1.2
  10. ftp://ftp.openbsd.org/pub/OpenBSD/2.6/i386/INSTALL.i386
  11. ftp://ftp.openbsd.org/pub/OpenBSD/2.6/sparc/INSTALL.sparc
  12. http://openbsd.org/faq/install-i386.html
  13. http://openbsd.org/faq/install-sparc.html
  14. http://openbsd.org/faq/log26.txt
d979 11
a989 10
  16. http://www.dorsai.org/~dcl/publications/NTLDR_Hacking/
  17. http://www.freebird.org/sw-map/bootmanager.html
  18. http://www.users.intercom.com/~ranish/part/
  19. http://openbsd.org/faq/INSTALL.linux
  20. http://openbsd.org/faq/faq14.html#14.7
  21. http://openbsd.org/faq/index.html
  22. http://openbsd.org/faq/faq3.html
  23. http://openbsd.org/faq/faq5.html
  24. http://openbsd.org/faq/index.html
  25. mailto:www@@openbsd.org
a1123 1
       This is not quite stable as of now.
d1489 1
a1489 1
   $OpenBSD: obsd-faq.txt,v 1.20 2000/01/20 22:35:12 ericj Exp $
d1768 2
a1769 1
   # ipf -Fa -f /etc/ipf.rules -E # ipnat -CF -f /etc/ipnat.rules
d1777 1
a1777 1
   # ipf -Fa -f /etc/ipf.rules
d1780 1
a1780 1
   # ipnat -CF -f /etc/ipnat.rules
d1806 2
a1807 1
   pass out from any to any pass in from any to any
d1812 3
a1814 2
   pass out from any to any pass in from any to any block in on fxp0 from
       any to any port = 3306
d1821 3
a1823 2
   pass out from any to any block in on fxp0 from any to any port = 3306
       pass in from any to any
d1832 3
a1834 2
   pass out from any to any block in quick on fxp0 from any to any port =
       3306 pass in from any to any
d1852 11
a1862 7
   ############################# # begin ruleset
       ############################# pass in quick on fxp0 from any to
       any port = 22 pass in quick on fxp0 from any to any port = 80 pass
       in quick on fxp0 from any to any port = 443 block in quick on fxp0
       from any to any pass out on fxp0 from any to any
       ############################## # end ruleset
       ##############################
d1870 11
a1880 7
   ############################# # begin ruleset
       ############################# pass in quick on fxp0 from
       1.1.1.0/24 to any port = 22 pass in quick on fxp0 from any to any
       port = 80 pass in quick on fxp0 from any to any port = 443 block
       in quick on fxp0 from any to any pass out on fxp0 from any to any
       ############################## # end ruleset
       ##############################
d1885 1
a1885 1
   pass in quick on fxp0 from 1.1.1.0/24 to any port = 22
d1888 1
a1888 1
   pass in quick on fxp0 from 1.1.1.1/32 to any port = 22
d1892 1
a1892 1
   pass in quick on fxp0 from 1.1.1.1/255.255.255.255 to any port = 22
d1899 8
a1906 6
   block in quick on fxp0 from 127.0.0.0/8 to any block in quick on fxp0
       from 192.168.0.0/16 to any block in quick on fxp0 from
       172.16.0.0/12 to any block in quick on fxp0 from 10.0.0.0/8 to any
       block out quick on fxp0 from any to 127.0.0.1/8 block out quick on
       fxp0 from any to 192.168.0.0/16 block out quick on fxp0 from any
       to 172.16.0.0/12 block out quick on fxp0 from any to 10.0.0.0/8
d1910 2
a1911 1
   pass out quick on lo0 pass in quick on lo0
d1915 39
a1953 17
   ########################### # begin ruleset
       ########################### # loopback rules pass out quick on lo0
       pass in quick on lo0 # don't allow anyone to spoof non-routeable
       addresses block in quick on fxp0 from 127.0.0.0/8 to any block in
       quick on fxp0 from 192.168.0.0/16 to any block in quick on fxp0
       from 172.16.0.0/12 to any block in quick on fxp0 from 10.0.0.0/8
       to any block out quick on fxp0 from any to 127.0.0.1/8 block out
       quick on fxp0 from any to 192.168.0.0/16 block out quick on fxp0
       from any to 172.16.0.0/12 block out quick on fxp0 from any to
       10.0.0.0/8 # only allow our administration machine to connect via
       ssh pass in quick on fxp0 from 1.1.1.1/32 to any port = 22 # allow
       others to use http and https pass in quick on fxp0 from any to any
       port = 80 pass in quick on fxp0 from any to any port = 443 #
       finally lock the rest down with a default deny block in quick on
       fxp0 from any to any # and let out-going traffic out pass out on
       fxp0 from any to any ############################# # end ruleset
       #############################
d1960 2
a1961 2
   pass in quick on fxp0 from 1.1.1.1/32 to any port = 22 block in log
       quick on fxp0 from any to any port = 22
d1976 1
a1976 1
   pass in quick on fxp0 proto tcp from 1.1.1.1/32 to any port = 22
d1983 1
a1983 1
   pass in quick on fxp0 proto tcp/udp from any to any port = 53
d1996 1
a1996 1
   block in quick proto tcp all with short
d2002 1
a2002 1
   block in log quick on fxp0 all with ipopts
d2008 2
a2009 2
   block in quick on fxp0 all with opt lsrr block in quick on fxp0 all
       with opt ssrr
d2021 1
a2021 1
   block in quick proto tcp on fxp0 from any to any flags FUP
d2042 11
a2052 7
   ############################# # begin ruleset
       ############################# pass in quick on fxp0 from
       1.1.1.0/24 to any port = 22 pass in quick on fxp0 from any to any
       port = 80 pass in quick on fxp0 from any to any port = 443 block
       in quick on fxp0 from any to any pass out on fxp0 from any to any
       keep state ############################## # end ruleset
       ##############################
d2065 11
a2075 7
   ############################# # begin ruleset
       ############################# pass in quick on fxp0 from
       1.1.1.0/24 to any port = 22 pass in quick on fxp0 from any to any
       port = 80 flags S/SA pass in quick on fxp0 from any to any port =
       443 flags S/SA block in quick on fxp0 from any to any pass out on
       fxp0 from any to any keep state ############################## #
       end ruleset ##############################
d2085 40
a2124 21
   ########################### # begin ruleset
       ########################### # loopback rules pass out quick on lo0
       pass in quick on lo0 # drop itsy bitsy frags block in quick proto
       tcp all with short # drop source routed packets block in quick on
       fxp0 all with opt lsrr block in quick on fxp0 all with opt ssrr #
       don't allow anyone to spoof non-routeable addresses block in quick
       on fxp0 from 127.0.0.0/8 to any block in quick on fxp0 from
       192.168.0.0/16 to any block in quick on fxp0 from 172.16.0.0/12 to
       any block in quick on fxp0 from 10.0.0.0/8 to any block out quick
       on fxp0 from any to 127.0.0.1/8 block out quick on fxp0 from any
       to 192.168.0.0/16 block out quick on fxp0 from any to
       172.16.0.0/12 block out quick on fxp0 from any to 10.0.0.0/8 #
       only allow our machines to connect via ssh pass in quick on fxp0
       from 1.1.1.0/24 to any port = 22 # allow others to use http and
       https pass in quick on fxp0 from any to any port = 80 flags S/SA
       pass in quick on fxp0 from any to any port = 443 flags S/SA #
       finally lock the rest down with a default deny block in quick on
       fxp0 from any to any # and let out-going traffic out and maintain
       state on established connections pass out on fxp0 from any to any
       keep state ############################# # end ruleset
       #############################
d2651 6
d2737 4
d2768 1
a2768 1
   net.inet.ip.directed-broadcast=1 turns this on. Read about [74]smurf
d2773 1
a2773 1
   There is a sysctl for this also. From [75]sysctl(8):
d2792 3
a2794 3
     * [76]nfsd(8)
     * [77]mountd(8)
     * [78]exports(5)
d2802 1
a2802 1
   recommend that you employ [79]IPSec. Otherwise, people can potentially
d2819 1
a2819 1
   [80]exports(5) man page. For this example we have an /etc/exports that
d2878 1
a2878 1
   see what is happening with NFS. One is [81]showmount(8) , which allows
d2890 1
a2890 1
   [82]mount_nfs(8). To mount a filesystem /work on host 10.0.0.1 to
d2912 2
a2913 2
   [83][Back to Main Index] [84][To Section 5.0 - Kernel configuration
   and Disk Setup] [85][To Section 7.0 - Keyboard controls]
d2916 2
a2917 2
   [86][back] [87]www@@openbsd.org
   $OpenBSD: obsd-faq.txt,v 1.20 2000/01/20 22:35:12 ericj Exp $
d2994 6
a2999 6
  74. http://www.netscan.org/
  75. http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&apropos=0&sektion=8&format=html
  76. http://www.openbsd.org/cgi-bin/man.cgi?query=nfsd&sektion=8&format=html
  77. http://www.openbsd.org/cgi-bin/man.cgi?query=mountd&sektion=8&format=html
  78. http://www.openbsd.org/cgi-bin/man.cgi?query=exports&sektion=5&format=html
  79. http://openbsd.org/faq/faq13.html
d3001 9
a3009 7
  81. http://www.openbsd.org/cgi-bin/man.cgi?query=showmount&sektion=8&format=html
  82. http://www.openbsd.org/cgi-bin/man.cgi?query=mount_nfs&sektion=8&format=html
  83. http://openbsd.org/faq/index.html
  84. http://openbsd.org/faq/faq5.html
  85. http://openbsd.org/faq/faq7.html
  86. http://openbsd.org/faq/index.html
  87. mailto:www@@openbsd.org
d3057 1
a3057 1
        :np:sp#9600:
d3079 1
a3079 1
   $OpenBSD: obsd-faq.txt,v 1.20 2000/01/20 22:35:12 ericj Exp $
d3115 3
d3131 1
a3131 1
   need to check into that. See [13]faq10 Kerberos Setup FAQ. If you
d3162 1
a3162 1
    4. run [14]passwd(1)
d3184 1
a3184 1
   [15]http://www.xfree86.org/FAQ/.
d3190 1
a3190 1
   about CVS at [16]http://www.cyclic.com/. CVS can be used by the end
d3220 1
a3220 1
   [17]http://www.openbsd.org/anoncvs.html Once you have chosen a server
d3228 1
a3228 1
       [18]Section 8.6 of the OpenBSD FAQ.
d3238 1
a3238 1
   2022. Be sure to check [19]http://www.openbsd.org/anoncvs.html for
d3274 1
a3274 1
   [20]http://www.openbsd.org/anoncvs.html. In this example I will be
d3304 1
a3304 1
   more on packages read [21]FAQ8.7.
d3317 1
a3317 1
   [22]www.openbsd.org/anoncvs.html and [23]Faq8.5.
d3321 1
a3321 1
   [24]www.openbsd.org/ftp.html. From here download
d3358 1
a3358 1
   downloaded from any of the [25]OpenBSD ftp servers as
d3364 1
a3364 1
   [26]www.openbsd.org/portstat.html. There you will find a list of what
d3464 1
a3464 1
   More information about the ports can be found in the [27]ports(7) man
d3468 1
a3468 1
   help please see: [28]http://www.openbsd.org/ports.html
d3479 1
a3479 1
     * [29]pkg_add(1) - a utility for installing software package
d3481 1
a3481 1
     * [30]pkg_create(1) - a utility for creating software package
d3483 1
a3483 1
     * [31]pkg_delete(1) - a utility for deleting previously installed
d3485 1
a3485 1
     * [32]pkg_info(1) - a utility for displaying information on software
d3490 1
a3490 1
   If you are a smart user and bought one of the [33]OpenBSD CD, then
d3494 1
a3494 1
   [34]http://www.openbsd.org/ftp.html. Packages are located at
d3500 1
a3500 1
   To install packages, the utility [35]pkg_add(1) is used. pkg_add(1) is
d3570 1
a3570 1
   The utility [36]pkg_info(1) is used to view a list of packages that
d3585 1
a3585 1
   shown by pkg_info(1) and use [37]pkg_delete(1) to remove the package.
d3623 1
a3623 1
   [38]boot(8) man page. Here we will go over the most common used
d3641 1
a3641 1
       the [39]Boot Time Config section of the faq.
d3649 1
a3649 1
   For further reading you can read [40]boot_i386(8) man page
d3659 4
a3662 4
     * [41]md4
     * [42]md5
     * [43]sha1
     * [44]rmd160.
d3672 1
a3672 1
   this you will have to use [45]skeyinit(1). With skeyinit(1), you will
d3741 1
a3741 1
   [46]skeyinfo(1), and it will tell you what to use. For example here, I
d3748 1
a3748 1
   use [47]skey(1). I can use exactly that output from above to create my
d3848 1
a3848 1
   [48]http://www.macbsd.com/macbsd/macbsd-docs/faq/faq-3.html#ss3.17
d3852 51
a3902 3
   The answer is in [49]http://www.openbsd.org/i386.html:
OpenBSD does not currently support multiple processors, but will run using
one processor on a multi-processor system board.
d3904 2
a3905 7
   The reason is quite simple: there are just not enough developers who
   have access to SMP machines. If you want to donate SMP hardware,
   please refer to [50]http://www.openbsd.org/donations.html to have
   support in the future.

   [51][Back to Main Index] [52][To Section 7.0 - Keyboard controls]
   [53][To Section 9.0 - Tips for linux users]
d3908 2
a3909 2
   [54][back] [55]www@@openbsd.org
   $OpenBSD: obsd-faq.txt,v 1.20 2000/01/20 22:35:12 ericj Exp $
d3925 6
a3930 6
  13. http://openbsd.org/faq/faq10.html#10.11
  14. http://www.openbsd.org/cgi-bin/man.cgi?query=passwd&sektion=1&format=html
  15. http://www.xfree86.org/FAQ/
  16. http://www.cyclic.com/
  17. http://openbsd.org/anoncvs.html
  18. http://openbsd.org/faq/faq8.html#8.6
d3932 2
a3933 2
  20. http://openbsd.org/anoncvs.html
  21. http://openbsd.org/faq/faq8.html#8.7
d3935 38
a3972 33
  23. http://openbsd.org/faq/faq8.html#8.5
  24. http://openbsd.org/ftp.html
  25. http://openbsd.org/ftp.html
  26. http://openbsd.org/portstat.html
  27. http://www.openbsd.org/cgi-bin/man.cgi?query=ports&sektion=7&format=html
  28. http://openbsd.org/ports.html
  29. http://www.openbsd.org/cgi-bin/man.cgi?query=pkg_add
  30. http://www.openbsd.org/cgi-bin/man.cgi?query=pkg_create
  31. http://www.openbsd.org/cgi-bin/man.cgi?query=pkg_delete
  32. http://www.openbsd.org/cgi-bin/man.cgi?query=pkg_info
  33. http://openbsd.org/orders.html
  34. http://openbsd.org/ftp.html
  35. http://www.openbsd.org/cgi-bin/man.cgi?query=pkg_add
  36. http://www.openbsd.org/cgi-bin/man.cgi?query=pkg_info
  37. http://www.openbsd.org/cgi-bin/man.cgi?query=pkg_delete
  38. http://www.openbsd.org/cgi-bin/man.cgi?query=boot&sektion=8&format=html
  39. http://openbsd.org/faq/faq5.html#5.4
  40. http://www.OpenBSD.org/cgi-bin/man.cgi?query=boot_i386&sektion=8&format=html
  41. http://www.openbsd.org/cgi-bin/man.cgi?query=md4&sektion=3&format=html
  42. http://www.openbsd.org/cgi-bin/man.cgi?query=md5&sektion=3&format=html
  43. http://www.openbsd.org/cgi-bin/man.cgi?query=sha1&sektion=3&format=html
  44. http://www.openbsd.org/cgi-bin/man.cgi?query=rmd160&sektion=3&format=html
  45. http://www.openbsd.org/cgi-bin/man.cgi?query=skeyinit&sektion=1&format=html
  46. http://www.openbsd.org/cgi-bin/man.cgi?query=skeyinfo&sektion=1&format=html
  47. http://www.openbsd.org/cgi-bin/man.cgi?query=skey&sektion=1&format=html
  48. http://www.macbsd.com/macbsd/macbsd-docs/faq/faq-3.html#ss3.17
  49. http://openbsd.org/i386.html
  50. http://openbsd.org/donations.html
  51. http://openbsd.org/faq/index.html
  52. http://openbsd.org/faq/faq7.html
  53. http://openbsd.org/faq/faq9.html
  54. http://openbsd.org/faq/index.html
  55. mailto:www@@openbsd.org
d4109 1
a4109 1
   $OpenBSD: obsd-faq.txt,v 1.20 2000/01/20 22:35:12 ericj Exp $
d4235 1
a4235 1
        ftpd_flags=NO           # for non-inetd use: ftpd_flags="-D"
d4332 48
a4379 21
   This will take you through all the steps it takes to set up your own
   Secure HTTP server. Since the OpenBSD 2.5 release, OpenBSD has shipped
   with SSLeay. Because of patented RSA algorigthms, these cannot be
   shipped with OpenBSD. libssl includes support for SSL version 2, SSL
   version 3, and TLS version 1. So for now, because of patent
   restrictions, OpenBSD must ship without a fully-functional libssl. But
   it is still completely useable. If you are able to use the RSA
   patented libraries, you can easily upgrade your libssl with a command
   like this.
   # pkg_add
       ftp://ftp.openbsd.org/pub/OpenBSD/${ver}/packages/${arch}/libssl-1
       .1.tgz

   Where ${ver} is the OpenBSD version number, and ${arch} is your
   architecture.

   The steps shown here are taken in part from the [30]ssl(8) man page.
   Refer to it for further information. This FAQ entry only outlines how
   to create an RSA certificate for web servers, not a DSA server
   certificate. To find out how to do so, please refer to the ssl(8) man
   page.
d4381 2
a4382 22
   Here is how you create your server key and certificate. These will go
   into /etc/ssl/private/. To use the RSA features, you must have
   upgraded your libssl. Now you can create your key. Using ssleay,
# ssleay genrsa -out /etc/ssl/private/server.key 1024

   This will create a key of 1024 bits. Next you need to create a
   Certificate Signing Request which is used to get a CA or Certificate
   Authority to sign your key. Here is the command to do so.
   # ssleay req -new -key /etc/ssl/private/server.key -out
       /etc/ssl/private/server.csr

   You would now give /etc/ssl/private/server.csr to the CA to get it
   signed. Or you could also sign the certificate for yourself. Here is
   how you would do this.
   # ssleay x509 -req -days 365 -in /etc/ssl/private/server.csr -signkey
       /etc/ssl/private/server.key -out /etc/ssl/server.crt

   This will sign your key, and it will be valid for up to 365 days. With
   this done you can now start the httpd server. To start httpd(8) with
   ssl you must start the daemon with the -DSSL flag. You can start this
   on boot in /etc/rc.conf by changing the httpd line to look like so:
httpd_flags="-DSSL"
d4384 2
a4385 1
   This server will run on port 443.
d4390 1
a4390 1
   /etc/passwd dynamically with [31]pwd_mkdb(8). The main password file
d4418 1
a4418 1
   The best way to add a user in OpenBSD is to use the [32]adduser(8)
d4425 1
a4425 1
   further instructions on adding users read the [33]adduser_proc(8) man
d4428 1
a4428 1
   To delete users you should use the [34]rmuser(8) utility. This will
d4467 1
a4467 1
   [35]edquota(8). A simple use is just edquota <user>. edquota(8) will
d4491 1
a4491 1
   this use [36]quotaon(8). For example:
d4496 1
a4496 1
   [37]quota(1). Using a command of quota <user> will give that users
d4530 1
a4530 1
     * [38]The FreeBSD handbook
d4532 2
a4533 2
     * [39]Designing an Authentication System: a Dialogue in Four Scenes
     * [40]Papers and Documentation Describing KerberosIV
d4536 1
a4536 1
     * [41]Network Security Private Communication in a Public World
d4554 1
a4554 1
   krb.realms. For more information on this refer to [42]krb.conf.
d4565 1
a4565 1
   Again, for further information read the [43]krb.realms. man page.
d4567 1
a4567 1
   Next we will run [44]kdb_init(8) to create the initial Kerberos
d4578 1
a4578 1
   Next we need to use [45]kstash(8) which is used to save the Kerberos
d4648 1
a4648 1
   command line, [46]ext_srvtab(8) creates the service key file
d4714 1
a4714 1
   privileges to a specific principal, see [47]the FreeBSD Handbook.
d4734 1
a4734 1
   you use [48]kinit(1).
d4741 1
a4741 1
   Now we have identified we can list our tickets with [49]klist(1).
d4770 1
a4770 1
   [50]kdestroy(1). For example:
d4780 1
a4780 1
   If you want ticket passing, use [51]OpenSSH which has support. Stock
d4798 2
a4799 2
   [52]ftp(8) and [53]chroot(2) man pages. Here is an example of adding
   the ftp user. I will do this using [54]adduser(8). We also need to add
d4844 1
a4844 1
   the [55]ftp(8) man page.
d4887 1
a4887 1
   from [56]inetd.conf. First we must become familiar with some of the
d4925 1
a4925 1
   OpenBSD's [57]ftpd(8) is setup by default to be able to handle this
d4979 1
a4979 1
#       $OpenBSD: obsd-faq.txt,v 1.20 2000/01/20 22:35:12 ericj Exp $
d5015 2
a5016 2
   [58][Back to Main Index] [59][To Section 9.0 - Migrating from Linux]
   [60][To Section 11.0 - Performance Tuning]
d5019 2
a5020 2
   [61][back] [62]www@@openbsd.org
   $OpenBSD: obsd-faq.txt,v 1.20 2000/01/20 22:35:12 ericj Exp $
d5053 27
a5079 27
  30. http://www.openbsd.org/cgi-bin/man.cgi?query=ssl&apropos=0&sektion=8&format=html
  31. http://www.openbsd.org/cgi-bin/man.cgi?query=pwd_mkdb&sektion=8&apropos=0
  32. http://www.openbsd.org/cgi-bin/man.cgi?query=adduser&sektion=8&format=html
  33. http://www.openbsd.org/cgi-bin/man.cgi?query=adduser_proc&sektion=8&format=html
  34. http://www.openbsd.org/cgi-bin/man.cgi?query=rmuser&sektion=8&format=html
  35. http://www.openbsd.org/cgi-bin/man.cgi?query=edquota&sektion=8&format=html
  36. http://www.openbsd.org/cgi-bin/man.cgi?query=quotaon&sektion=8&format=html
  37. http://www.openbsd.org/cgi-bin/man.cgi?query=quota&sektion=1&format=html
  38. http://www.freebsd.org/handbook/kerberos.html
  39. http://web.mit.edu/kerberos/www/dialogue.html
  40. http://web.mit.edu/kerberos/www/papers.html#krb4
  41. http://www.amazon.com/exec/obidos/ASIN/0130614661/qid%3D930594963/
  42. http://www.openbsd.org/cgi-bin/man.cgi?query=krb.conf&sektion=5&format=html
  43. http://www.openbsd.org/cgi-bin/man.cgi?query=krb.realms&sektion=5&format=html
  44. http://www.openbsd.org/cgi-bin/man.cgi?query=kbd_init&sektion=8&format=html
  45. http://www.openbsd.org/cgi-bin/man.cgi?query=kstash&sektion=8&format=html
  46. http://www.openbsd.org/cgi-bin/man.cgi?query=ext_srvtab&sektion=8&format=html
  47. http://www.freebsd.org/handbook/kerberos.html#AEN4957
  48. http://www.openbsd.org/cgi-bin/man.cgi?query=kinit&sektion=1&format=html
  49. http://www.openbsd.org/cgi-bin/man.cgi?query=klist&sektion=1&format=html
  50. http://www.openbsd.org/cgi-bin/man.cgi?query=kdestroy&sektion=1&format=html
  51. http://www.openbsd.org/cgi-bin/man.cgi?query=ssh&sektion=1&format=html
  52. http://www.openbsd.org/cgi-bin/man.cgi?query=ftpd&sektion=8&format=html
  53. http://www.openbsd.org/cgi-bin/man.cgi?query=chroot&sektion=2&format=html
  54. http://www.openbsd.org/cgi-bin/man.cgi?query=adduser&sektion=8&format=html
  55. http://www.openbsd.org/cgi-bin/man.cgi?query=ftpd&sektion=8&format=html
  56. http://www.openbsd.org/cgi-bin/cvsweb/src/etc/inetd.conf
d5081 10
a5090 5
  58. http://openbsd.org/faq/index.html
  59. http://openbsd.org/faq/faq9.html
  60. http://openbsd.org/faq/faq11.html
  61. http://openbsd.org/faq/index.html
  62. mailto:www@@openbsd.org
d5164 1
a5164 1
   $OpenBSD: obsd-faq.txt,v 1.20 2000/01/20 22:35:12 ericj Exp $
d5307 1
a5307 1
   $OpenBSD: obsd-faq.txt,v 1.20 2000/01/20 22:35:12 ericj Exp $
d5460 1
a5460 1
   This was moved to the [16]OpenBSD 2.5 informaton section.
d5579 1
a5579 1
   $OpenBSD: obsd-faq.txt,v 1.20 2000/01/20 22:35:12 ericj Exp $
d5666 1
a5666 1
   $OpenBSD: obsd-faq.txt,v 1.20 2000/01/20 22:35:12 ericj Exp $
d5991 4
d6001 4
d6634 1
a6634 1
   $OpenBSD: obsd-faq.txt,v 1.20 2000/01/20 22:35:12 ericj Exp $
d7360 1
a7360 1
   $OpenBSD: obsd-faq.txt,v 1.20 2000/01/20 22:35:12 ericj Exp $
d7407 1
a7407 1
   Last Update - $Date: 2000/01/20 22:35:12 $
d7464 1
d7488 1
a7488 1
   Between formal releases, a series of snapshot releases are [28]made
d7501 1
a7501 1
   can be [29]fetched and [30]built. This procedure should eliminate most
d7516 1
a7516 1
   Short answer: [31]http://www.openbsd.org/anoncvs.html
d7777 1
a7777 1
   You need to build a new cap_mkdb. See [32]3.1.
d7822 1
a7822 1
   For detailed instructions, see section [33]4.2.
d7827 1
a7827 1
   kernel before attempting a make build. See [34]4.3 for details.
d7846 1
a7846 1
   the egcs-snapshot, available from the [35]ports collection. If this
d7990 1
a7990 1
     make build and proceed. See [36]4.2.2.]
d8025 1
a8025 1
   and similar to the cap_mkdb issue described in [37]3.1.
d8078 1
a8078 1
   the perl changes mentioned in [38]4.1 mean that you can remove the
d8160 9
a8168 7
   terminfo and termcaps files with the current version of tic(1). After
   a make build to a:
    cd /usr/src/share/termtypes
    make clean
    make depend
    make
    make install
d8192 22
d8215 2
a8216 1
   $OpenBSD: obsd-faq.txt,v 1.20 2000/01/20 22:35:12 ericj Exp $
d8219 1
a8219 1
   [39]kwooding@@codetalker.com
d8250 13
a8262 12
  28. ftp://ftp.openbsd.org/pub/OpenBSD/snapshots/
  29. http://openbsd.org/faq/upgrade-minifaq.html#1.4
  30. http://openbsd.org/faq/upgrade-minifaq.html#1.5
  31. http://openbsd.org/anoncvs.html
  32. http://openbsd.org/faq/upgrade-minifaq.html#3.1
  33. http://openbsd.org/faq/upgrade-minifaq.html#4.2
  34. http://openbsd.org/faq/upgrade-minifaq.html#4.3
  35. http://openbsd.org/ports.html
  36. http://openbsd.org/faq/upgrade-minifaq.html#4.2.2
  37. http://openbsd.org/faq/upgrade-minifaq.html#3.1
  38. http://openbsd.org/faq/upgrade-minifaq.html#4.1
  39. mailto:kwooding@@codetalker.com
@


1.20
log
@update
@
text
@d57 1
a57 1
   $OpenBSD: index.html,v 1.89 1999/12/20 22:33:12 chris Exp $
d253 1
a253 1
   $OpenBSD: faq1.html,v 1.17 1999/12/05 21:35:49 chris Exp $
d589 1
a589 1
   $OpenBSD: faq2.html,v 1.24 1999/12/04 23:13:07 ericj Exp $
d729 1
a729 1
   $OpenBSD: faq3.html,v 1.13 1999/11/29 07:30:16 ericj Exp $
d958 1
a958 1
   $OpenBSD: faq4.html,v 1.67 1999/12/10 21:20:38 ericj Exp $
d1469 1
a1469 1
   out permenantly. To do this you need to use the -u option. In the
d1487 1
a1487 1
   $OpenBSD: faq5.html,v 1.40 2000/01/05 07:36:00 chris Exp $
d1732 1
a1732 1
   utility. To change this permenantly you should edit the file
d2840 1
a2840 1
   $OpenBSD: faq6.html,v 1.51 2000/01/11 21:12:06 ericj Exp $
d3000 1
a3000 1
   $OpenBSD: faq7.html,v 1.12 2000/01/18 22:16:52 chris Exp $
d3784 1
a3784 1
   $OpenBSD: faq8.html,v 1.42 1999/12/21 03:12:51 ericj Exp $
d3979 1
a3979 1
   $OpenBSD: faq9.html,v 1.19 1999/12/20 21:51:54 chris Exp $
d4841 1
a4841 1
#       $OpenBSD: faq10.html,v 1.37 1999/12/20 22:33:13 chris Exp $
d4882 1
a4882 1
   $OpenBSD: faq10.html,v 1.37 1999/12/20 22:33:13 chris Exp $
d5021 1
a5021 1
   $OpenBSD: faq11-2.4.html,v 1.7 1999/12/06 21:42:08 chris Exp $
d5105 1
a5105 1
   This is a more permenant solution to adding more swap space. To swap
d5164 1
a5164 1
   $OpenBSD: faq11-2.5.html,v 1.5 1999/12/20 22:34:36 chris Exp $
d5436 1
a5436 1
   $OpenBSD: faq11.html,v 1.6 1999/12/06 21:42:08 chris Exp $
d5523 1
a5523 1
   $OpenBSD: faq12.html,v 1.24 1999/12/06 21:45:57 chris Exp $
d6483 1
a6483 1
   $OpenBSD: faq13.html,v 1.22 2000/01/06 17:50:12 chris Exp $
d7037 1
a7037 1
   This is a more permenant solution to adding more swap space. To swap
d7209 1
a7209 1
   $OpenBSD: faq14.html,v 1.15 1999/12/20 22:34:36 chris Exp $
d7256 1
a7256 1
   Last Update - $Date: 2000/01/17 20:09:25 $
d8039 1
a8039 1
   $OpenBSD: upgrade-minifaq.html,v 1.15 2000/01/17 20:09:25 kjell Exp $
@


1.19
log
@update
@
text
@d9 1
a9 1
    [2]1.0 - Introduction to OpenBSD
d18 1
a18 1
    [11]10.0 - System Administration
d57 1
a57 1
   $OpenBSD: index.html,v 1.88 1999/12/05 21:15:54 chris Exp $
a858 1
arc             47M     268M    20M      60M
d862 1
a862 1
mvme68k         48M     448M    24M       -  (no Xserver)
a864 1
powerpc         39M     423M    26M     124M
d958 1
a958 1
   $OpenBSD: faq4.html,v 1.66 1999/12/05 21:35:49 chris Exp $
d1000 1
d1031 1
a1031 1
   them, those that are most commonly used. Check the [6]options(4) man
d1042 6
a1047 6
     * [7]Alpha Kernel Conf Files
     * [8]i386 Kernel Configuration files
     * [9]mac68k Kernel Configuration files
     * [10]pmax Kernel Configuration Files
     * [11]sparc Kernel Configuration Files
     * [12]Other Arch's
d1053 1
a1053 1
   Config be sure to look through [13]/sys/conf/GENERIC and see what you
d1072 6
a1077 6
     * [14]COMPAT_SVR4(8) - Compatibility with SVR4 binaries.
     * [15]COMPAT_BSDOS(8) - Compatibility with BSD/OS binaries.
     * [16]COMPAT_LINUX(8) - Compatibility with Linux binaries.
     * [17]COMPAT_SUNOS(8) - Compatibility with SunOS binaries.
     * [18]COMPAT_ULTRIX(8) - Compatibility with Ultrix binaries.
     * [19]COMPAT_FREEBSD(8) - Compatibility with FreeBSD binaries.
d1080 1
a1080 1
     * [20]COMPAT_IBCS2(8) - Compatibility to run ibcs2 binaries.
d1097 1
a1097 1
     * [21]DDB - This compiles in the in-kernel debugger. This isn't
d1099 1
a1099 1
     * [22]KGDB - Compiles a remote kernel debugger using gdb's `remote
d1107 1
a1107 1
       allows users to use [23]ktrace(1).
d1111 1
a1111 1
       [24]kgmon(8).
d1133 1
a1133 1
     * NULLFS - Code to have a loopback filesystem. [25]mount_null(8) has
d1152 1
a1152 1
       softupdates more read the [26]Softupdates FAQ section.
d1163 1
a1163 1
       Read [27]options(4) for more details.
d1165 1
a1165 1
       read [28]FAQ 10
d1178 1
a1178 1
       arch's. Read [29]lkm(4) for more information.
d1180 1
a1180 1
       [30]init(8) for more information on kernel security levels.
d1187 2
a1188 2
       Default is 8. For more on CCD read the [31]CCD(4) man page, or the
       [32]Performance Tuning FAQ section.
d1195 1
a1195 1
   Also check the [33]Networking FAQ or the [34]Networking Performance
d1207 1
a1207 1
       of mbuf clusters. Read [35]options(4) for more information on this
d1210 1
a1210 1
       [36]ns(4)
d1212 1
a1212 1
       See [37]iso(4) for more information.
d1236 1
a1236 1
     * PPP_FILTER - This option turns on [38]pcap(3) based filtering for
d1241 1
a1241 1
       [39]ipsec(4) for more details. This now implies option KEY, which
d1278 1
a1278 1
   [40]afterboot(8) man page.
d1300 12
a1311 1
# make
d1316 1
a1316 1
# config SOMEFILE (read more about it here : [41]config(8))
d1334 1
a1334 1
   new bootblocks. To do so, read [42]faq15.8 on OpenBSD's Bootloader.
d1349 1
a1349 1
   Most of this document can be found in the man page [43]boot_config(8)
d1381 1
a1381 1
   and Compile a new kernel. Refer to [44]Building your own kernel for
d1397 87
a1483 2
   [45][Back to Main Index] [46][To Section 4.0 - Installation Guide]
   [47][To Section 6.0 - Networking]
d1486 2
a1487 2
   [48][back] [49]www@@openbsd.org
   $OpenBSD: faq5.html,v 1.36 1999/12/05 21:54:32 chris Exp $
d1496 42
a1537 42
   6. http://www.openbsd.org/cgi-bin/man.cgi?query=options&apropos=0&sektion=4&format=html
   7. http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/alpha/conf/
   8. http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/i386/conf/
   9. http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/mac68k/conf/
  10. http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/pmax/conf/
  11. http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/sparc/conf/
  12. http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/
  13. http://www.openbsd.org/cgi-bin/cvsweb/src/sys/conf/GENERIC
  14. http://www.openbsd.org/cgi-bin/man.cgi?query=compat_svr4&sektion=8&apropos=0&manpath=OpenBSD+Current
  15. http://www.openbsd.org/cgi-bin/man.cgi?query=compat_bsdos&sektion=8&apropos=0&manpath=OpenBSD+Current
  16. http://www.openbsd.org/cgi-bin/man.cgi?query=compat_linux&sektion=8&apropos=0&manpath=OpenBSD+Current
  17. http://www.openbsd.org/cgi-bin/man.cgi?query=compat_sunos&sektion=8&apropos=0&manpath=OpenBSD+Current
  18. http://www.openbsd.org/cgi-bin/man.cgi?query=compat_ultrix&sektion=8&apropos=0&manpath=OpenBSD+Current
  19. http://www.openbsd.org/cgi-bin/man.cgi?query=compat_freebsd&sektion=8&apropos=0&manpath=OpenBSD+Current
  20. http://www.openbsd.org/cgi-bin/man.cgi?query=compat_ibcs2&sektion=8&apropos=0&manpath=OpenBSD+Current
  21. http://www.openbsd.org/cgi-bin/man.cgi?query=ddb&sektion=4&format=html
  22. http://www.openbsd.org/cgi-bin/man.cgi?query=gdb&sektion=1&format=html
  23. http://www.openbsd.org/cgi-bin/man.cgi?query=ktrace&sektion=1&format=html
  24. http://www.openbsd.org/cgi-bin/man.cgi?query=kgmon&sektion=8&format=html
  25. http://www.openbsd.org/cgi-bin/man.cgi?query=mount_null&sektion=8&format=html
  26. http://openbsd.org/faq/faq14.html#14.5
  27. http://www.openbsd.org/cgi-bin/man.cgi?query=options&sektion=4&format=html
  28. http://openbsd.org/faq/faq10.html#10.10
  29. http://www.openbsd.org/cgi-bin/man.cgi?query=lkm&sektion=4&format=html
  30. http://www.openbsd.org/cgi-bin/man.cgi?query=init&sektion=8&format=html
  31. http://www.openbsd.org/cgi-bin/man.cgi?query=ccd&sektion=4&format=html
  32. http://openbsd.org/faq/faq11.html#11.2
  33. http://openbsd.org/faq/faq6.html
  34. http://openbsd.org/faq/faq11.html#11.1
  35. http://www.openbsd.org/cgi-bin/man.cgi?query=options&sektion=4&format=html
  36. http://www.openbsd.org/cgi-bin/man.cgi?query=ns&sektion=4&apropos=0&manpath=OpenBSD+Current
  37. http://www.openbsd.org/cgi-bin/man.cgi?query=iso&sektion=4&format=html
  38. http://www.openbsd.org/cgi-bin/man.cgi?query=pcap&sektion=3&format=html
  39. http://www.openbsd.org/cgi-bin/man.cgi?query=ipsec&sektion=4&format=html
  40. http://www.openbsd.org/cgi-bin/man.cgi?query=afterboot&apropos=0&sektion=8&format=html
  41. http://www.openbsd.org/cgi-bin/man.cgi?query=config&apropos=0&sektion=8&format=html
  42. http://openbsd.org/faq/faq14.html#14.8
  43. http://www.openbsd.org/cgi-bin/man.cgi?query=boot_config&apropos=0&sektion=8&format=html
  44. http://openbsd.org/faq/faq5.html#5.3
  45. http://openbsd.org/faq/index.html
  46. http://openbsd.org/faq/faq4.html
  47. http://openbsd.org/faq/faq6.html
d1539 4
a1542 1
  49. mailto:www@@openbsd.org
d1558 1
d1564 2
a1565 2
   partially understand the [8]Kernel Configuration and Setup section of
   the FAQ, and the [9]ifconfig(8) and [10]netstat(1) man pages.
d1570 1
a1570 1
   [11]Understanding IP addressing. This is an excellent document.
d1575 1
a1575 1
   and mail servers, you may benefit greatly by [12]reading the RFCs. Of
d1585 2
a1586 2
     * [13]6.1.1 - Identifying and Setting Up Your Network Interfaces
     * [14]6.1.2 - Setting up your OpenBSD box as a Gateway
d1603 4
a1606 4
     * ne2000 Network Cards - [15]ne*
     * 3Com EtherLink III and Fast EtherLink III Ethernet - [16]ep*
     * 3Com EtherLink XL and Fast EtherLink XL Ethernet (3C9xx) - [17]xl*
     * Intel 82586 chip Ethernet device driver - [18]ie*
d1642 2
a1643 2
     * [19]lo* - Loopback Interface
     * [20]sl* - Slip Network Interface
d1645 3
a1647 3
     * [21]tun* - Tunnel Network Interface
     * [22]enc* - Encapsulating Interface
     * [23]bridge* - Ethernet bridge interface
d1654 1
a1654 1
   [24]hostname.if(5) man page.
d1666 1
a1666 1
   the format of this file in the [25]resolv.conf(5) man page. But for a
d1745 1
a1745 1
   [26]routed(8), [27]gated, [28]mrtd, and [29]zebra. OpenBSD has support
d1753 2
a1754 2
   packet level forwarding permissions [30]ipf(8) and mapping
   hosts/subnets to a range of external addresses [31]ipnat(8). The
d1766 1
a1766 2
# ipf -Fa -f /etc/ipf.rules -E
# ipnat -CF -f /etc/ipnat.rules
d1774 1
a1774 1
# ipf -Fa -f /etc/ipf.rules
d1777 1
a1777 1
# ipnat -CF -f /etc/ipnat.rules
d1783 2
a1784 2
   at the IP Filter [32]mailing list archive, the [33]IP Filter web site,
   and finally the [34]IP Filter HOWTO.
d1788 78
a1865 9
   Modify rc.conf so it has IPFILTER=YES. The file /etc/ipf.rules has a
   simple yet powerful syntax. Here we deal with the most common ways of
   usage, for a more strict definition see [35]ipf(5). Here is assumed
   xl0 as the external interface to internet, on this one uses to have
   more rules than internal interfaces.

   Configurations usually start letting everything come and go, and then
   apply the necessary rules to block offending packets. So this is
   first:
d1867 4
a1870 2
pass out from any to any
pass in from any to any
d1872 2
a1873 2
   Now let's block any incoming connection to port 82 tcp (eg. there's an
   internal network report agent using http running on several hosts):
d1875 107
a1981 1
block in on xl0 proto tcp from any to any port = 82
d1983 1
a1983 1
   This rule means:
d1985 73
a2057 2
   "Block all incoming packets on xl0 interface whose protocol is TCP no
   matter destination/origin using port 82"
d2059 2
a2060 7
   If you want to log all rejected packets add "log" after "block in", or
   "log quick" if you don't want it to send a message to every console
   root is logged in.

   Also, a typical rule is to block rpc portmap:

block in log on xl0 proto udp from any to any port = sunrpc
d2065 16
a2080 16
     * [36]6.3.1 Introduction
          + [37]6.3.1.1 Purpose
          + [38]6.3.1.2 Terminology
          + [39]6.3.1.3 Configuration
     * [40]6.3.2 Network Address Translation
          + [41]6.3.2.1 Introduction to Network Address Translation
          + [42]6.3.2.2 Why to use Network Address Translation
          + [43]6.3.2.3 Setup
          + [44]6.3.2.4 Configuration
          + [45]6.3.2.5 Running
     * [46]6.3.3 Network Address Translation Knowledge Base
          + [47]6.3.3.1 Checking NAT status
          + [48]6.3.3.2 Limitations of NAT (in FTP)
          + [49]6.3.3.3 Redirecting Traffic
          + [50]6.3.3.4 Network Address Translation versus Proxy
     * [51]6.3.4 Links and X-References
d2095 1
a2095 1
   Based on [52]RFC 1631, ipnat provides an easy way to map internal
d2099 1
a2099 1
   you can take advantage of reserved address blocks (assigned in [53]RFC
d2213 1
a2213 1
192.168.1.40 --- 192.168.1.1 [ NAT ] 24.12.34.56 --- 123.45.67.89
d2216 1
a2216 1
From: 192.168.1.40  >>=== NAT ===>>     From: 24.12.34.56
d2220 2
a2221 2
From: 123.45.67.89  <<=== NAT ===<<     From: 123.45.67.89
To:   192.168.1.40                      To: 24.12.34.56
d2266 1
a2266 1
   Again for more information you can read [54]FAQ 6.2
d2464 4
a2467 4
     * [55]http://www.openbsd.org/cgi-bin/man.cgi?query=ipnat&sektion=8
     * [56]Man page showing correct ipnat.rules syntax
     * [57]http://coombs.anu.edu.au/~avalon/
     * [58]http://www.geektools.com/rfc/rfc1631.txt
d2473 1
a2473 1
   To use the DHCP client [59]dhclient(8) included with OpenBSD, edit
d2502 1
a2502 1
   If you want to use OpenBSD as a DHCP server [60]dhcpd(8), edit
d2540 1
a2540 1
   [61]dhcp-options(5) for more options that your DHCP clients may want.
d2546 2
a2547 2
     * [62]pppd(8) - Which is the kernel ppp daemon.
     * [63]ppp(8) - Which is the userland ppp daemon.
d2558 1
a2558 1
   your ppp. The userland PPP daemon uses the file [64]/etc/ppp/ppp.conf
d2586 1
a2586 1
   logging levels. This can be changed, refer to [65]ppp(8) for more info
d2661 2
a2662 2
     * [66]ppp.linkup
     * [67]ppp.linkdown
d2691 1
a2691 1
   net.inet.ip.directed-broadcast=1 turns this on. Read about [68]smurf
d2696 1
a2696 1
   There is a sysctl for this also. From [69]sysctl(8):
d2709 128
a2836 2
   [70][Back to Main Index] [71][To Section 5.0 - Kernel configuration
   and Disk Setup] [72][To Section 7.0 - Keyboard controls]
d2839 2
a2840 2
   [73][back] [74]www@@openbsd.org
   $OpenBSD: faq6.html,v 1.43 1999/12/06 01:27:18 ericj Exp $
d2851 50
a2900 50
   8. http://openbsd.org/faq/faq5.html
   9. http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&apropos=0&sektion=8&format=html
  10. http://www.openbsd.org/cgi-bin/man.cgi?query=netstat&apropos=0&sektion=1&format=html
  11. http://www.3com.com/nsc/501302s.html
  12. http://www.nexor.com/info/rfc/index/rfc.htm?index/rfc.html
  13. http://openbsd.org/faq/faq6.html#6.1.1
  14. http://openbsd.org/faq/faq6.html#6.1.2
  15. http://www.openbsd.org/cgi-bin/man.cgi?query=ne&sektion=4&format=html
  16. http://www.openbsd.org/cgi-bin/man.cgi?query=ep&sektion=4&format=html
  17. http://www.openbsd.org/cgi-bin/man.cgi?query=xl&sektion=4&format=html
  18. http://www.openbsd.org/cgi-bin/man.cgi?query=ie&sektion=4&format=html
  19. http://www.openbsd.org/cgi-bin/man.cgi?query=lo&sektion-4&format=html
  20. http://www.openbsd.org/cgi-bin/man.cgi?query=sl&sektion=4&format=html
  21. http://www.openbsd.org/cgi-bin/man.cgi?query=tun&sektion=4&format=html
  22. http://www.openbsd.org/cgi-bin/man.cgi?query=enc&sektion=4&format=html
  23. http://www.openbsd.org/cgi-bin/man.cgi?query=bridge&sektion=4&format=html
  24. http://www.openbsd.org/cgi-bin/man.cgi?query=hostname.if&sektion=5&format=html
  25. http://www.openbsd.org/cgi-bin/man.cgi?query=resolv.conf&sektion=5&format=html
  26. http://www.openbsd.org/cgi-bin/man.cgi?query=routed&apropos=0&sektion=8&format=html
  27. http://www.gated.org/
  28. http://www.mrtd.net/
  29. http://www.zebra.org/
  30. http://www.openbsd.org/cgi-bin/man.cgi?query=ipf&apropos=0&sektion=8&format=html
  31. http://www.openbsd.org/cgi-bin/man.cgi?query=ipnat&apropos=0&sektion=8&format=html
  32. http://false.net/ipfilter/
  33. http://coombs.anu.edu.au/~avalon/
  34. http://www.obfuscation.org/ipf/
  35. http://www.openbsd.org/cgi-bin/man.cgi?query=ipf&apropos=0&sektion=5&format=html
  36. http://openbsd.org/faq/faq6.html#nat1.0
  37. http://openbsd.org/faq/faq6.html#nat1.1
  38. http://openbsd.org/faq/faq6.html#nat1.2
  39. http://openbsd.org/faq/faq6.html#nat1.3
  40. http://openbsd.org/faq/faq6.html#nat2.0
  41. http://openbsd.org/faq/faq6.html#nat2.1
  42. http://openbsd.org/faq/faq6.html#nat2.2
  43. http://openbsd.org/faq/faq6.html#nat2.3
  44. http://openbsd.org/faq/faq6.html#nat2.4
  45. http://openbsd.org/faq/faq6.html#nat2.5
  46. http://openbsd.org/faq/faq6.html#nat3.0
  47. http://openbsd.org/faq/faq6.html#nat3.1
  48. http://openbsd.org/faq/faq6.html#nat3.2
  49. http://openbsd.org/faq/faq6.html#nat3.3
  50. http://openbsd.org/faq/faq6.html#nat3.4
  51. http://openbsd.org/faq/faq6.html#nat4.0
  52. http://www.geektools.com/rfc/rfc1631.txt
  53. http://www.geektools.com/rfc/rfc1918.txt
  54. http://openbsd.org/faq/faq6.html#6.2
  55. http://www.openbsd.org/cgi-bin/man.cgi?query=ipnat&sektion=8
  56. http://www.openbsd.org/cgi-bin/man.cgi?query=ipnat&sektion=5&format=html
  57. http://coombs.anu.edu.au/~avalon/
d2902 29
a2930 16
  59. http://www.openbsd.org/cgi-bin/man.cgi?query=dhclient&apropos=0&sektion=8&format=html
  60. http://www.openbsd.org/cgi-bin/man.cgi?query=dhcpd&apropos=0&sektion=8&format=html
  61. http://www.openbsd.org/cgi-bin/man.cgi?query=dhcp-options&apropos=0&sektion=5&format=html
  62. http://www.openbsd.org/cgi-bin/man.cgi?query=pppd&sektion=8&format=html
  63. http://www.openbsd.org/cgi-bin/man.cgi?query=ppp&sektion=8&format=html
  64. http://www.openbsd.org/cgi-bin/cvsweb/src/etc/ppp/ppp.conf.sample
  65. http://www.openbsd.org/cgi-bin/man.cgi?query=ppp&sektion=8&format=html
  66. http://www.openbsd.org/cgi-bin/cvsweb/src/etc/ppp/ppp.linkup.sample
  67. http://www.openbsd.org/cgi-bin/cvsweb/src/etc/ppp/ppp.linkdown.sample
  68. http://www.netscan.org/
  69. http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&apropos=0&sektion=8&format=html
  70. http://openbsd.org/faq/index.html
  71. http://openbsd.org/faq/faq5.html
  72. http://openbsd.org/faq/faq7.html
  73. http://openbsd.org/faq/index.html
  74. mailto:www@@openbsd.org
d2945 1
a2945 1
7.1 - How do I remap the keyboard?
d2948 2
a2949 1
   driver"
d2952 1
d2955 7
a2961 1
   This will load the keycap file for Great Britain.
d2965 2
a2966 1
   No. But if you are willing to make a port. Please share. :)
d2981 1
a2981 1
7.4 - Accessing the Console Scrollback Buffer
d2989 2
a2990 2
   [5]scon(1) utility. For example, to change the number of pages you can
   scrollback to 10, simple do:
d2993 1
a2993 2
   The smallest amount of pages is 2 and the largest amount is 100.
   Remember though, that this effects how much kernel memory is used.
d2995 1
a2995 1
   [6][Back to Main Index] [7][To Section 6.0 - Networking] [8][To
d2999 2
a3000 2
   [9][back] [10]www@@openbsd.org
   $OpenBSD: faq7.html,v 1.11 1999/12/04 20:47:45 chris Exp $
d3008 7
a3014 6
   5. http://www.openbsd.org/cgi-bin/man.cgi?query=scon&sektion=1&format=html
   6. http://openbsd.org/faq/index.html
   7. http://openbsd.org/faq/faq6.html
   8. http://openbsd.org/faq/faq8.html
   9. http://openbsd.org/faq/index.html
  10. mailto:www@@openbsd.org
d3397 1
a3397 1
     * pkg_add (1) - a utility for installing software package
d3399 1
a3399 1
     * pkg_create (1) - a utility for creating software package
d3401 1
a3401 1
     * pkg_delete (1) - a utility for deleting previously installed
d3403 1
a3403 1
     * pkg_info (1) - a utility for displaying information on software
d3406 1
a3406 5
   Here is a sample user installing ispell via a package:
# pkg_add ftp://ftp.openbsd.org/pub/OpenBSD/2.5/packages/${arch}/ispell-3.1.20.
tgz

   where ${arch} is your architecture
d3408 112
a3519 11
   Again, like with ports you can use the [29]pkg_info(1) program to view
   what is already installed on your system.

   To delete packages you will want to use the [30]pkg_delete(1) command.
   It is used the same way as [31]pkg_add(1).
# /usr/sbin/pkg_delete ispell-3.1.20

   and it is gone.

   Packages can be found on any of the [32]OpenBSD ftp mirror sites, or
   they can be found on your OpenBSD CDs.
d3541 1
a3541 1
   [33]boot(8) man page. Here we will go over the most common used
d3559 1
a3559 1
       the [34]Boot Time Config section of the faq.
d3567 1
a3567 1
   For further reading you can read [35]boot_i386(8) man page
d3577 4
a3580 4
     * [36]md4
     * [37]md5
     * [38]sha1
     * [39]rmd160.
d3590 1
a3590 1
   this you will have to use [40]skeyinit(1). With skeyinit(1), you will
d3659 1
a3659 1
   [41]skeyinfo(1), and it will tell you what to use. For example here, I
d3666 1
a3666 1
   use [42]skey(1). I can use exactly that output from above to create my
d3691 1
a3691 1
    Using S/Key with telnet(1) and rlogin(1)
d3693 3
a3695 3
   Using S/Key with telnet(1) and rlogin(1) is done in pretty much the
   same fashion as with ftp, only your first password must be "s/key".
   Example:
d3759 6
d3766 1
a3766 1
   [43]http://www.macbsd.com/macbsd/macbsd-docs/faq/faq-3.html#ss3.17
d3770 1
a3770 1
   The answer is in [44]http://www.openbsd.org/i386.html:
d3776 1
a3776 1
   please refer to [45]http://www.openbsd.org/donations.html to have
d3779 2
a3780 2
   [46][Back to Main Index] [47][To Section 7.0 - Keyboard controls]
   [48][To Section 9.0 - Tips for linux users]
d3783 2
a3784 2
   [49][back] [50]www@@openbsd.org
   $OpenBSD: faq8.html,v 1.39 1999/12/05 21:35:49 chris Exp $
d3816 27
a3842 22
  29. http://www.openbsd.org/cgi-bin/man.cgi?query=pkg_info&sektion=1&format=html
  30. http://www.openbsd.org/cgi-bin/man.cgi?query=pkg_delete&sektion=1&format=html
  31. http://www.openbsd.org/cgi-bin/man.cgi?query=pkg_add&sektion=1&format=html
  32. http://openbsd.org/ftp.html
  33. http://www.openbsd.org/cgi-bin/man.cgi?query=boot&sektion=8&format=html
  34. http://openbsd.org/faq/faq5.html#5.4
  35. http://www.OpenBSD.org/cgi-bin/man.cgi?query=boot_i386&sektion=8&format=html
  36. http://www.openbsd.org/cgi-bin/man.cgi?query=md4&sektion=3&format=html
  37. http://www.openbsd.org/cgi-bin/man.cgi?query=md5&sektion=3&format=html
  38. http://www.openbsd.org/cgi-bin/man.cgi?query=sha1&sektion=3&format=html
  39. http://www.openbsd.org/cgi-bin/man.cgi?query=rmd160&sektion=3&format=html
  40. http://www.openbsd.org/cgi-bin/man.cgi?query=skeyinit&sektion=1&format=html
  41. http://www.openbsd.org/cgi-bin/man.cgi?query=skeyinfo&sektion=1&format=html
  42. http://www.openbsd.org/cgi-bin/man.cgi?query=skey&sektion=1&format=html
  43. http://www.macbsd.com/macbsd/macbsd-docs/faq/faq-3.html#ss3.17
  44. http://openbsd.org/i386.html
  45. http://openbsd.org/donations.html
  46. http://openbsd.org/faq/index.html
  47. http://openbsd.org/faq/faq7.html
  48. http://openbsd.org/faq/faq9.html
  49. http://openbsd.org/faq/index.html
  50. mailto:www@@openbsd.org
d3932 2
a3933 2
# cat linux_passwd | awk -F : '{printf("%s:%s:%s:%s::0:0:%s:%s:%s\n", $1, $2,$3
,$4,$5,$6,$7); }' > new_passwd
d3979 1
a3979 1
   $OpenBSD: faq9.html,v 1.18 1999/12/04 20:47:45 chris Exp $
d3997 1
a3997 1
  15. http://www.false.com/security/john/
d4010 1
a4010 1
10.0 - System Administration
d4017 1
a4017 1
     * [3]10.3 - How do i start daemons with the system? ( Overview of
d4065 1
a4065 1
10.3 - How do i start daemons with the system? ( Overview of rc(8) )
d4841 1
a4841 1
#       $OpenBSD: faq10.html,v 1.35 1999/11/11 07:04:56 ericj Exp $
d4882 1
a4882 1
   $OpenBSD: faq10.html,v 1.35 1999/11/11 07:04:56 ericj Exp $
d5021 1
a5021 1
   $OpenBSD: faq11-2.4.html,v 1.6 1999/10/25 17:52:11 ericj Exp $
d5164 1
a5164 1
   $OpenBSD: faq11-2.5.html,v 1.3 1999/12/05 21:35:49 chris Exp $
d5175 1
a5175 1
   8. http://openbsd.org/faq/href=
d5436 1
a5436 1
   $OpenBSD: faq11.html,v 1.5 1999/11/03 20:21:48 chris Exp $
d5523 1
a5523 1
   $OpenBSD: faq12.html,v 1.22 1999/12/04 21:01:13 chris Exp $
d5545 1
d5551 11
a5561 11
     * [6]13.1 - What is IPSec?
     * [7]13.2 - That's nice, but why do I want to use IPSec?
     * [8]13.3 - What are the protocols behind IPSec?
     * [9]13.4 - On the wire format
     * [10]13.5 - Configuring IPSec
     * [11]13.6 - How do I setup IPSec with manual keying?
     * [12]13.7 - How do I setup IPSec with photurisd?
     * [13]13.8 - How do I setup IPSec with isakmpd?
     * [14]13.9 - What IKE clients are compatible with isakmpd?
     * [15]13.10 - Troubleshooting IPSec/VPN
     * [16]13.11 - Related Documentation
d5571 1
a5571 1
   any knowledge of IPSec to be able to use it. You can use [17]any IP
d5577 2
a5578 2
   the "recommended reading" of [18]part 6 of the FAQ. In particular, if
   you don't already understand it, the [19]Understanding IP Addressing
d5631 3
a5633 3
   later. IPWARNING: as per the standards specification, replay
   protection is not performed when using manual-keyed IPsec (e.g., when
   using [20]ipsecadm(8)).
d5660 1
a5660 1
   guidelines specified in [21]RFC2402.
d5666 1
a5666 1
   must follow [22]RFC2406. An ESP header can also provide authentication
d5793 1
a5793 1
   entries can be set manually with [23]ipsecadm(8), however the IETF has
d5796 3
a5798 3
   ([24]RFC2522, and [25]RFC2523) and ISAKMP automatic key exchange
   ([26]RFC2407, [27]RFC2408, and [28]RFC2409) in the [29]photurisd(8)
   and [30]isakmpd(8) daemons.
d5805 1
a5805 1
   [31]/usr/share/ipsec/rc.vpn to set this up for you automatically.
d5819 4
a5822 1
   You can edit /etc/sysctl.conf to turn these on at boot time.
d5855 1
a5855 1
   Notice that the SPIs are different. See [32]On the wire format for a
d5891 1
a5891 1
   behind 208.2.2.2. These examples were generated using the [33]rc.vpn
d6031 1
a6031 1
   IPSec, you probably are going to use ISAKMP. Most commercial
d6035 295
a6329 1
   This section is incomplete! [34]contribute?
d6340 22
a6361 22
     * [35]TimeStep PERMIT/Client
     * [36]Ashley Laurent VPCom VPN software
     * [37]PGP VPN software
     * [38]Radguard cIPro client
     * [39]Cisco Win32 client (unreleased?)

   The following other gateways/routers have been reported to be
   compatible:
     * [40]Cisco IOS
     * [41]Cisco PIX
     * [42]Intel LanRover
     * [43]TimeStep PERMIT/Gate
     * [44]Cendio Fuego
     * [45]KAME for FreeBSD
     * [46]FreeS/WAN for Linux
     * [47]Axent Raptor
     * [48]Ericsson eBox
     * [49]Radguard cIPro-VPN
     * [50]F-Secure VPN+
     * [51]Teamware TWISS
     * [52]3com Pathbuilder
     * [53]Nortel Contivity
d6365 1
a6365 1
   Your first tool for troubleshooting IPSec is [54]tcpdump(8). Use
d6377 1
a6377 1
       [55]ping(8) to generate simple traffic.
d6405 1
a6405 1
       this for an older version of tcpdump, contact [56]ho@@openbsd.org.
d6413 1
a6413 1
     * Finally, you can use [57]netstat(1) to see your SAs.
d6429 1
a6429 1
       for warnings or errors, and report them using [58]sendbug(1) to
d6432 1
a6432 1
       the [59]mailing lists.
d6436 5
a6440 5
   IPSec is partially documented in the [60]vpn(8) man page. There are
   various configuration templates in [61]/usr/share/ipsec/ directory
   which can also assist you. The manual pages for [62]enc(4),
   [63]ipsec(4), [64]ipsecadm(8), [65]photurisd(8), [66]startkey(1),
   [67]isakmpd(8) and [68]isakmpd.conf(5) are detailed and can assist in
d6444 7
a6450 7
     * [69]IETF IPSec Working Group
     * [70]SSH IPSec interoperability Test Node
     * [71]NIST IPSec Web Based Interoperability Tester
     * [72]A port of OpenBSD's IPSec to FreeBSD
     * [73]FreeS/WAN - IPSec for Linux
     * [74]Lots of IPSec related links
     * [75]OpenBSD 2.4 VPN Configuration Mini-FAQ
d6453 4
a6456 4
     * [76]RFC 2085 - HMAC-MD5 IP Authentication with Replay Prevention
     * [77]RFC 2104 - HMAC: Keyed-Hashing for Message Authentication
     * [78]RFC 2207 - RSVP Extensions for IPSec Data Flows
     * [79]RFC 2401 - Security Architecture for the Internet Protocol
d6458 6
a6463 6
     * [80]RFC 2402 - IP Authentication Header (AH)
     * [81]RFC 2403 - The Use of HMAC-MD5-96 within ESP and AH
     * [82]RFC 2404 - The Use of HMAC-SHA-1-96 within ESP and AH
     * [83]RFC 2405 - The ESP DES-CBC Cipher Algorithm With Explicit IV
     * [84]RFC 2406 - IP Encapsulating Security Payload (ESP)
     * [85]RFC 2407 - The Internet IP Security Domain of Interpretation
d6465 1
a6465 1
     * [86]RFC 2408 - Internet Security Association and Key Management
d6467 2
a6468 2
     * [87]RFC 2409 - The Internet Key Exchange (IKE)
     * [88]RFC 2410 - The NULL Encryption Algorithm and Its Use With
d6470 6
a6475 6
     * [89]RFC 2411 - IP Security Document Roadmap
     * [90]RFC 2412 - The OAKLEY Key Determination Protocol
     * [91]RFC 2451 - The ESP CBC-Mode Cipher Algorithms
     * [92]RFC 2522 - Photuris: Session-Key Management Protocol
     * [93]RFC 2523 - Photuris: Extended Schemes and Attributes
     * [94]RFC 2709 - Security Model with Tunnel-mode IPsec for NAT
d6478 2
a6479 2
   [95][Back to Main Index] [96][To Section 12.0 - For Advanced Users]
   [97][To Section 14.0 - Using disks in OpenBSD]
d6482 2
a6483 2
   [98][back] [99]www@@openbsd.org
   $OpenBSD: faq13.html,v 1.18 1999/10/29 04:13:22 chris Exp $
d6492 37
a6528 37
   6. http://openbsd.org/faq/faq13.html#13.1
   7. http://openbsd.org/faq/faq13.html#13.2
   8. http://openbsd.org/faq/faq13.html#13.3
   9. http://openbsd.org/faq/faq13.html#13.4
  10. http://openbsd.org/faq/faq13.html#13.5
  11. http://openbsd.org/faq/faq13.html#13.6
  12. http://openbsd.org/faq/faq13.html#13.7
  13. http://openbsd.org/faq/faq13.html#13.8
  14. http://openbsd.org/faq/faq13.html#13.9
  15. http://openbsd.org/faq/faq13.html#13.10
  16. http://openbsd.org/faq/faq13.html#13.11
  17. http://www.openbsd.org/cgi-bin/cvsweb/src/etc/protocols?rev=1.8
  18. http://openbsd.org/faq/faq6.html
  19. http://www.3com.com/nsc/501302s.html
  20. http://www.openbsd.org/cgi-bin/man.cgi?query=ipsecadm&apropos=0&sektion=8&format=html
  21. http://www.cis.ohio-state.edu/htbin/rfc/rfc2402.html
  22. http://www.cis.ohio-state.edu/htbin/rfc/rfc2406.html
  23. http://www.openbsd.org/cgi-bin/man.cgi?query=ipsecadm&apropos=0&sektion=8&format=html
  24. http://www.cis.ohio-state.edu/htbin/rfc/rfc2522.html
  25. http://www.cis.ohio-state.edu/htbin/rfc/rfc2523.html
  26. http://www.cis.ohio-state.edu/htbin/rfc/rfc2407.html
  27. http://www.cis.ohio-state.edu/htbin/rfc/rfc2408.html
  28. http://www.cis.ohio-state.edu/htbin/rfc/rfc2409.html
  29. http://www.openbsd.org/cgi-bin/man.cgi?query=photurisd&apropos=0&sektion=8&format=html
  30. http://www.openbsd.org/cgi-bin/man.cgi?query=isakmpd&apropos=0&sektion=8&format=html
  31. http://www.openbsd.org/cgi-bin/cvsweb/src/share/ipsec/rc.vpn?rev=1.3
  32. http://openbsd.org/faq/faq13.html#13.4
  33. http://www.openbsd.org/cgi-bin/cvsweb/src/share/ipsec/rc.vpn?rev=1.3
  34. mailto:faq@@openbsd.org
  35. http://www.timestep.com/
  36. http://www.vpcom.com/
  37. http://www.nai.com/asp_set/products/tns/pgp_vpn.asp
  38. http://www.radguard.com/
  39. http://www.cisco.com/
  40. http://www.cisco.com/
  41. http://www.cisco.com/
  42. http://www.intel.com/
d6530 65
a6594 56
  44. http://www.cendio.com/
  45. http://www.kame.net/
  46. http://www.xs4all.nl/~freeswan/
  47. http://www.axent.com/
  48. http://www.ericsson.com/
  49. http://www.radguard.com/
  50. http://www.f-secure.com/
  51. http://www.teamware.com/
  52. http://www.3com.com/
  53. http://www.nortelnetworks.com/
  54. http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&apropos=0&sektion=8&format=html
  55. http://www.openbsd.org/cgi-bin/man.cgi?query=ping&apropos=0&sektion=8&format=html
  56. mailto:ho@@openbsd.org
  57. http://www.openbsd.org/cgi-bin/man.cgi?query=netstat&apropos=0&sektion=1&format=html
  58. http://www.openbsd.org/cgi-bin/man.cgi?query=sendbug&apropos=0&sektion=1&format=html
  59. http://openbsd.org/mail.html
  60. http://www.openbsd.org/cgi-bin/man.cgi?query=vpn&apropos=0&sektion=0&format=html
  61. http://www.openbsd.org/cgi-bin/cvsweb/src/share/ipsec/
  62. http://www.openbsd.org/cgi-bin/man.cgi?query=enc&apropos=0&sektion=4&format=html
  63. http://www.openbsd.org/cgi-bin/man.cgi?query=ipsec&apropos=0&sektion=4&format=html
  64. http://www.openbsd.org/cgi-bin/man.cgi?query=ipsecadm&apropos=0&sektion=8&format=html
  65. http://www.openbsd.org/cgi-bin/man.cgi?query=photurisd&apropos=0&sektion=8&format=html
  66. http://www.openbsd.org/cgi-bin/man.cgi?query=startkey&apropos=0&sektion=1&format=html
  67. http://www.openbsd.org/cgi-bin/man.cgi?query=isakmpd&apropos=0&sektion=8&format=html
  68. http://www.openbsd.org/cgi-bin/man.cgi?query=isakmpd.conf&apropos=0&sektion=5&format=html
  69. http://www.ietf.org/html.charters/ipsec-charter.html
  70. http://isakmp-test.ssh.fi/
  71. http://ipsec-wit.antd.nist.gov/
  72. http://www.r4k.net/ipsec/
  73. http://www.xs4all.nl/~freeswan/
  74. http://www.cs.umass.edu/~lmccarth/ipsec.html
  75. http://www.codetalker.com/greenbox/docs/vpn-24-minifaq.html
  76. http://www.cis.ohio-state.edu/htbin/rfc/rfc2085.html
  77. http://www.cis.ohio-state.edu/htbin/rfc/rfc2104.html
  78. http://www.cis.ohio-state.edu/htbin/rfc/rfc2207.html
  79. http://www.cis.ohio-state.edu/htbin/rfc/rfc2401.html
  80. http://www.cis.ohio-state.edu/htbin/rfc/rfc2402.html
  81. http://www.cis.ohio-state.edu/htbin/rfc/rfc2403.html
  82. http://www.cis.ohio-state.edu/htbin/rfc/rfc2404.html
  83. http://www.cis.ohio-state.edu/htbin/rfc/rfc2405.html
  84. http://www.cis.ohio-state.edu/htbin/rfc/rfc2406.html
  85. http://www.cis.ohio-state.edu/htbin/rfc/rfc2407.html
  86. http://www.cis.ohio-state.edu/htbin/rfc/rfc2408.html
  87. http://www.cis.ohio-state.edu/htbin/rfc/rfc2409.html
  88. http://www.cis.ohio-state.edu/htbin/rfc/rfc2410.html
  89. http://www.cis.ohio-state.edu/htbin/rfc/rfc2411.html
  90. http://www.cis.ohio-state.edu/htbin/rfc/rfc2412.html
  91. http://www.cis.ohio-state.edu/htbin/rfc/rfc2451.html
  92. http://www.cis.ohio-state.edu/htbin/rfc/rfc2522.html
  93. http://www.cis.ohio-state.edu/htbin/rfc/rfc2523.html
  94. http://www.cis.ohio-state.edu/htbin/rfc/rfc2709.html
  95. http://openbsd.org/faq/index.html
  96. http://openbsd.org/faq/faq12.html
  97. http://openbsd.org/faq/faq14.html
  98. http://openbsd.org/faq/index.html
  99. mailto:www@@openbsd.org
d7209 1
a7209 1
   $OpenBSD: faq14.html,v 1.13 1999/12/05 21:35:49 chris Exp $
d7236 1
a7236 1
  24. http://openbsd.org/faq/href=
d7252 1
a7252 1
  Latest OpenBSD Version - 2.5
d7256 1
a7256 1
   Last Update - 27 Jul 1999
d7290 1
a7290 1
   [13]4.1: What are the major problems upgrading from 2.5 to -current?
d7304 3
d7308 1
a7308 1
  5.0 - Upgrading to 2.6
d7310 3
a7312 1
   [24]Link to the new 2.6 directory
d7321 4
a7324 3
   development happens from a single source tree. On approximately
   six-month intervals, OpenBSD releases are produced. These are numbered
   in the conventional (2.x) manner. The current OpenBSD release is 2.5.
d7336 1
a7336 1
   Between formal releases, a series of snapshot releases are [25]made
d7349 1
a7349 1
   can be [26]fetched and [27]built. This procedure should eliminate most
d7364 1
a7364 1
   Short answer: [28]http://www.openbsd.org/anoncvs.html
d7368 4
a7371 4
 # export CVSROOT=anoncvs@@anoncvs.ca.openbsd.org:/cvs
 # export CVS_RSH=/usr/local/bin/ssh
 # cd /usr
 # cvs -q get -PA src
d7380 2
a7381 2
   If you created a separate /usr/obj directory, clean that, and
   rebuild the symbolic links:
d7383 14
a7396 14
   # rm -rf /usr/obj
   # mkdir /usr/obj
   # cd /usr/src
   # make obj

   If you're worried there are object files in your source tree,
   do this:

   # cd /usr/src
   # find . -type l -name obj | xargs rm
   # make cleandir
   # rm -rf /usr/obj
   # mkdir /usr/obj
   # make obj
d7399 3
a7401 3
   2.3 users must add the named user and group before
   moving to 2.4 or later. See the specific Mini-FAQ section for
   your version.
d7404 2
a7405 2
   is especially important when upgrading from older versions, but is
   sometimes necessary in other cases. The easiest way to do this is:
d7407 1
a7407 1
   # cd /usr/src/etc && make DESTDIR=/ distrib-dirs
d7411 11
a7421 11
   # cd /usr/src/sys/arch/`machine`/conf
   # cp GENERIC MYKERNEL
   # vi MYKERNEL
   (edit MYKERNEL to your liking)
   # config MYKERNEL
   # cd ../compile/MYKERNEL
   # make clean && make depend && make
   (arc architecture only) copy bsd.ecoff to your FAT partition
   # cp /bsd /bsd.old && cp bsd /bsd
   # chown root.wheel /bsd (if you compiled as someone else)
   (reboot)
d7425 2
a7426 2
   # cd /usr/src
   # make build
d7429 14
a7442 14
   automatically. Choose a directory with enough space to
   hold /, /dev, /var, and /etc. Here I'll use /home/newroot
   (Note: make sure the directory hierarchy you choose
   does not have group write (g+w) or other write (o+w)
   permissions or sendmail will complain during this step.
   This makes /tmp a bad choice):

   # mkdir /home/newroot
   # export DESTDIR=/home/newroot
   # cd /usr/src/etc && make distribution-etc-root-var

   Now compare the files in /home/newroot with their
   installed counterparts. Replace or update the files as
   necessary.
d7444 1
a7444 1
   # rm -rf /home/newroot   (when done)
d7451 2
a7452 2
 # cd /usr/src
 # make -n build
d7456 7
a7462 7
 (cd /usr/src/share/mk &&  make install)
 (cd /usr/src/include;  make includes)
 make cleandir
 (cd /usr/src/lib && make depend && make &&   make install)
 (cd /usr/src/gnu/lib && make depend && make &&   make install)
 (cd /usr/src/kerberosIV && make build)
 make depend && make &&  make install
d7483 1
a7483 1
   named:*:70:70::0:0:BIND Daemon:/var/named:/sbin/nologin
d7486 1
a7486 1
   named:*:70:
d7503 7
a7509 7
  (cd /usr/src/etc && make DESTDIR=/ distrib-dirs)
  install -d -o root -g wheel -m 755 /
  mtree -def mtree/4.4BSD.dist -p // -u

  mtree: unknown user named
  mtree: failed at line 1632 of the specification
  *** Error code 1 (ignored)
d7515 18
a7532 18
  missing: ./var/named (created)
  missing: ./var/named/dev (created)
  missing: ./var/named/etc (created)
  missing: ./etc/afs (created)
  missing: ./etc/ssl (created)
  missing: ./etc/ssl/private (created)
  missing: ./usr/obj (not created: File exists)
  missing: ./usr/share/doc/html (created)
  missing: ./usr/share/doc/html/lynx_help (created)
  missing: ./usr/share/doc/html/lynx_help/keystrokes (created)
  missing: ./usr/share/doc/usd/13.viref (created)
  missing: ./usr/share/man/cat4/powerpc (created)
  missing: ./usr/share/man/man4/alpha (created)
  missing: ./usr/share/man/man4/pmax (created)
  missing: ./usr/share/man/man4/powerpc (created)
  missing: ./usr/share/tmac/mdoc (created)
  missing: ./var/www/htdocs/manual/vhosts (created)
  missing: ./usr/include/ssl (created)
d7556 1
a7556 1
  # cd /usr/src/etc && make DESTDIR=/ distrib-dirs
d7559 2
a7560 2
  install -d -o root -g wheel -m 755 /
  mtree -def mtree/4.4BSD.dist -p // -u
d7562 18
a7579 18
  missing: ./var/named (created)
  missing: ./var/named/dev (created)
  missing: ./var/named/etc (created)
  missing: ./etc/afs (created)
  missing: ./etc/ssl (created)
  missing: ./etc/ssl/private (created)
  missing: ./usr/obj (not created: File exists)
  missing: ./usr/share/doc/html (created)
  missing: ./usr/share/doc/html/lynx_help (created)
  missing: ./usr/share/doc/html/lynx_help/keystrokes (created)
  missing: ./usr/share/doc/usd/13.viref (created)
  missing: ./usr/share/man/cat4/powerpc (created)
  missing: ./usr/share/man/man4/alpha (created)
  missing: ./usr/share/man/man4/pmax (created)
  missing: ./usr/share/man/man4/powerpc (created)
  missing: ./usr/share/tmac/mdoc (created)
  missing: ./var/www/htdocs/manual/vhosts (created)
  missing: ./usr/include/ssl (created)
d7618 4
a7621 4
  cap_mkdb -i -f terminfo terminfo.src
  cap_mkdb: illegal option -- i
  usage: cap_mkdb [-v] [-f outfile] file1 [file2 ...]
  *** Error code 1
d7625 1
a7625 1
   You need to build a new cap_mkdb. See [29]3.1.
d7629 1
a7629 1
    4.1: What are the major problems upgrading from 2.5 to -current?
d7649 12
a7660 12
    1) Perl lib files have moved from /usr/lib/perl5 to the more correct
       /usr/libdata/perl5
    2) The default site_perl directories now live in /usr/local.  Ie:
       if you install a perl module, it will place itself in
       /usr/local/libdata/perl5/site_lib.  This makes it easy to
       see what non-stock modules you have.  It also means that we
       can have perl modules in the ports system easily.
    3) The perl library man pages are now install in /usr/share/man/cat3p
       You'll need to update your man.conf based on the src/etc/man.conf
       to take advantage of them.  This means you can now do
       "man 3p less" and get info on the less pragma but "man less"
       will still get you the less pager manpage.
d7670 1
a7670 1
   For detailed instructions, see section [30]4.2.
d7675 1
a7675 1
   kernel before attempting a make build. See [31]4.3 for details.
d7694 1
a7694 1
   the egcs-snapshot, available from the [32]ports collection. If this
d7838 1
a7838 1
     make build and proceed. See [33]4.2.2.]
d7873 1
a7873 1
   and similar to the cap_mkdb issue described in [34]3.1.
d7884 2
a7885 2
   From: Marc Espie
   Subject: egcs core-dumping on uthread_autoinit.c
d7887 2
a7888 2
   If this happens to you, this is a known linker problem... the cc1 you have
   was linked in a weird way.
d7890 3
a7892 3
   Initially, I made cc1 link against static /usr/lib/libiberty.a to avoid this
   problem, but this was cutting things too close, and the bug reappeared,
   probably thanks to unrelated changes in libc or elsewhere...
d7894 1
a7894 1
   The tree has been patched with a work-around in
d7896 1
a7896 1
   src/gnu/egcs/f/lang-options.h
d7898 2
a7899 2
   make sure you have the kludged version of that file (at least rev 1.2),
   recompile and reinstall cc1, the problem should go away.
d7901 5
a7905 5
   What's going on is that the 386 linker gets something wrong because of
   the huge strings array in toplev.c, and something gets mislinked, so
   that
   void f(void) __attribute((constructor)) {}
   kills cc1.
d7907 2
a7908 3
   As a work-around, I've killed Fortran options help texts, until someone find
s
   where the linker errs.
d7926 1
a7926 1
   the perl changes mentioned in [35]4.1 mean that you can remove the
d7987 1
a7987 3
  5.0 - Upgrading to 2.6

      5.1 - Link to the new 2.6 directory
d7993 45
d8039 2
a8040 2
   $OpenBSD: upgrade-minifaq.html,v 1.9 1999/11/24 20:42:29 ericj Exp $
   Copyright  1998-1999, Kjell Wooding.
d8042 1
a8042 1
   [36]kwooding@@codetalker.com
d8069 16
a8084 13
  24. http://openbsd.org/faq/upgrade-minifaq.html#5.1
  25. ftp://ftp.openbsd.org/pub/OpenBSD/snapshots/
  26. http://openbsd.org/faq/upgrade-minifaq.html#1.4
  27. http://openbsd.org/faq/upgrade-minifaq.html#1.5
  28. http://openbsd.org/anoncvs.html
  29. http://openbsd.org/faq/upgrade-minifaq.html#3.1
  30. http://openbsd.org/faq/upgrade-minifaq.html#4.2
  31. http://openbsd.org/faq/upgrade-minifaq.html#4.3
  32. http://openbsd.org/ports.html
  33. http://openbsd.org/faq/upgrade-minifaq.html#4.2.2
  34. http://openbsd.org/faq/upgrade-minifaq.html#3.1
  35. http://openbsd.org/faq/upgrade-minifaq.html#4.1
  36. mailto:kwooding@@codetalker.com
@


1.18
log
@sync
@
text
@d10 1
a10 1
    [3]2.0 - Other information resources
d12 2
a13 2
    [5]4.0 - OpenBSD Installation Guide
    [6]5.0 - Kernel Configuration and Setup
d15 1
a15 1
    [8]7.0 - Keyboard and Console Controls
d22 1
a22 1
    [15]14.0 - Using disks in OpenBSD
d24 2
a25 2
   Older Versions of OpenBSD
    [16]OpenBSD 2.4
d27 2
a28 2
   Browse the OpenBSD website
    [17] [Back to the main OpenBSD website]
d31 8
a38 10
   This FAQ is specifically designed for the 2.5 release of OpenBSD, but
   in some cases will work on earlier versions. Information on previous
   versions is still available and you should always check
   [18]http://www.openbsd.org/errata.html for important updates. The FAQ
   only follows release versions of OpenBSD and will not have information
   pertaining to any -current options until it has been released on CD.
   This is so we do not have any confusion on to which versions are being
   used or documented.
   Information for previous versions of OpenBSD.
     * [19]OpenBSD 2.4
d41 4
a44 3
   own OpenBSD system. The addressed questions will range from newbie to
   advanced users. Hopefully you will find this FAQ useful. Downloadable
   version of the FAQ is available in a Text version.
d57 1
a57 1
   $OpenBSD: index.html,v 1.86 1999/11/06 18:25:07 ericj Exp $
d77 3
a79 3
  17. http://openbsd.org/index.html
  18. http://openbsd.org/errata.html
  19. http://openbsd.org/faq/faq11-2.4.html
d112 1
a112 1
   OpenBSD 2.5 will install and run on the following platforms:
d121 2
a122 1
     * [17]mvme88k
d124 2
a125 2
     * The ports for pmax and mvme88k are not included on the 2.5 CD.
       They can be downloaded from any of the OpenBSD ftp sites
d128 1
a128 1
   will boot on several hardware platforms. See [18]section 3.0 of this
d131 2
a132 3
   Previous releases of OpenBSD also had ports for:
     * [19]arc
     * [20]mvme68k
d134 1
a134 1
   These were removed from the 2.4 release, but were included in 2.3 if
d253 1
a253 1
   $OpenBSD: faq1.html,v 1.16 1999/09/24 01:46:13 ericj Exp $
d273 4
a276 4
  17. http://openbsd.org/mvme88k.html
  18. http://openbsd.org/faq/faq3.html
  19. http://openbsd.org/arc.html
  20. http://openbsd.org/mvme68k.html
d347 1
a347 1
     * ports - Automated mailing of CVS source tree changes.
d354 1
a354 1
   [12]http://www.geocrawler.com/lists/4/OpenBSD. This website contains
d589 1
a589 1
   $OpenBSD: faq2.html,v 1.22 1999/11/01 23:00:53 ericj Exp $
d644 3
a646 2
     * [3]3.2 - Downloading via FTP or AFS
     * [4]3.3 - Obtaining Current Source Code
d653 1
a653 1
   [5]http://www.openbsd.org/orders.html.
d679 1
a679 1
   these at [6]http://www.OpenBSD.org/tshirts.html. Enjoy :)
d681 1
a681 1
Does OpenBSD provide an ISO image available for download?
d698 1
a698 1
   [7]http://www.openbsd.org/ftp.html
d708 1
a708 1
   [8]http://www.openbsd.org/anoncvs.html.
d710 1
a710 1
   or check [9]The OpenBSD FAQ
d718 1
a718 1
   [10]http://www.openbsd.org/ctm.html.
d722 1
a722 1
   [11]Http://www.openbsd.org/cgi-bin/cvsweb/
d724 2
a725 2
   [12][Back to Main Index] [13][To Section 2.0 - Other OpenBSD
   information resources] [14][To Section 4.0 - Installation Guide]
d728 2
a729 2
   [15][back] [16]www@@openbsd.org
   $OpenBSD: faq3.html,v 1.12 1999/10/31 22:59:59 ericj Exp $
d735 15
a749 14
   3. http://openbsd.org/faq/faq3.html#3.2
   4. http://openbsd.org/faq/faq3.html#3.3
   5. http://openbsd.org/orders.html
   6. http://openbsd.org/tshirts.html
   7. http://openbsd.org/ftp.html
   8. http://openbsd.org/anoncvs.html
   9. http://openbsd.org/faq/faq8.html#8.5
  10. http://openbsd.org/ctm.html
  11. http://www.openbsd.org/cgi-bin/cvsweb/
  12. http://openbsd.org/faq/index.html
  13. http://openbsd.org/faq/faq2.html
  14. http://openbsd.org/faq/faq4.html
  15. http://openbsd.org/faq/index.html
  16. mailto:www@@openbsd.org
d758 45
a802 56
     * [1]4.1 - Installing from CD
     * [2]4.2 - Installing from FTP
     * [3]4.3 - Installing via DHCP
     * [4]4.4 - What files are needed for Installation?
     * [5]4.5 - How much space do I need for an OpenBSD installation?
     * [6]4.6 - Multibooting OpenBSD
     * [7]4.7 - Sending your dmesg to dmesg@@openbsd.org after the install
     _________________________________________________________________

4.1 - Installing from the OpenBSD CD

   Installing from a CD is definitely the BEST choice, but first you must
   have purchased a CD. You can obtain a CD from
   [8]http://www.openbsd.org/orders.html. If you are using either the
   i386, sparc or alpha platforms, you can boot directly off the CD. Here
   we will go into more elaborate instructions for substantial
   architectures.

  i386

   To startup an install for the i386 architecture, it's best to try
   booting off of the CD. Most newer BIOS's allow this, and you might
   have to play with it for a minute. If that isn't an option the
   bootdisk is available on the CD also. The bootdisk is placed in
   CD1:2.5/i386/floppy25.fs. Ways to write this to a floppy vary on what
   platform you are currently on.
   Unix Flavor
     * dd if=floppy25.fs of=/dev/rfd0c bs=126b

   Windows/MS-DOS
     * rawrite - Which is available in the tools directory on the CD.

   WindowsNT
     * fdimage or ntrw.exe - Both are available in the tools directory on
       the CD.

   NOTE - Make sure you use a floppy with NO BAD BLOCKS or you will have
   problems.

   Once you disk is made, simply boot off of the disk. To guide you
   through the rest of the install process use [9]log25.txt, which is an
   install walkthrough guide.

  SPARC

   With the SPARC architecture you have the ability to boot from the CD.
   To do this, use CD1 and type either,
     * boot cdrom 25/sparc/bsd.rd
     * b sd(0,6,0)2.5/sparc/bsd.rd

   depending on your ROM version. Then simply follow the [10]install
   walkthrough guide. Alternatively you can boot using a bootdisk. Write
   the disk using the ways detailed above for the i386 architecture, and
   boot it using either,
     * boot fd()
     * boot floppy
d804 1
a804 3
   again depending on your ROM version.

  ALPHA
d809 1
a809 1
   boot -fi 2.5/alpha/bsd.rd dkaX
d812 3
a814 3
   to boot from the CD, you can still use the bootdisk proviced at
   CD2:2.5/alpha/floppy25.fs, and write it using the ways detailed above
   for the i386 architecture. And again follow the [11]install
d817 1
a817 34
4.2 - Installation via FTP

   The ftp installation is almost the same as the normal installation.
   The same bootdisk will be used.

   floppy25.fs

   Just like the CD install you will set up your disk, then when you
   specify install media you choose (f)tp. You must take care to give the
   proper settings when you are asked to configure your network. Have
   available your IP address, netmask, nameserver addresses, and default
   route. If you are using DHCP, don't worry, the boot disk knows how to
   talk to your DHCP server to get all of this (see next section below).
   Once your network is configured correctly, you must choose the (f)tp
   installation option. You will be asked a few simple questions about
   proxies and passive or active transfers, and the you will be presented
   with a list of ftp servers. Select the one closest to you, and you are
   on your way.

   Consult the [12]install text for help.

4.3 - Installation via DHCP

   Installation via DHCP is the same as ftp, except your system will use
   DHCP to configure your network. When you arrive at the network config
   option, it will ask for your IP address. Type "dhcp" (Without the
   quotes of course) and your IP address, netmask, gateway, and name
   servers will be setup from the values given by the DHCP server. Then
   all you have to do is follow the remainder of the directions from ftp
   install above and you will be set.

   Consult the [13]install text for help.

4.4 - What files are needed for Installation?
d823 11
a833 11
     * base25.tar.gz - Has the base OpenBSD system Required
     * etc25.tar.gz - Has all the files in /etc Required
     * comp25.tar.gz - Has the compiler and its tools, libs. Recommended
     * man25.tar.gz - Holds man pages Recommended
     * misc25.tar.gz - Holds misc info, setup docs
     * game25.tar.gz - Has the games for OpenBSD
     * xbase25.tar.gz - Has the base install for X11
     * xfont25.tar.gz - Holds X11's font server and fonts
     * xlink25.tar.gz - Has the X servers link kit
     * xserv25.tar.gz - Has X11's X servers
     * xshare25.tar.gz - Has manpages, locale settings, includes, etc for
d837 1
a837 1
4.5 - How much space do I need for an OpenBSD installation?
d892 1
a892 1
4.6 - Multibooting OpenBSD
d907 1
a907 1
   at the [14]NTLDR Hacking Guide.
d909 1
a909 1
   OpenBSD & Windows or DOS
d913 1
a913 1
   Some bootloaders of choice are [15]osbs20b8.zip or [16]The Ranish
d916 1
a916 1
   OpenBSD & Linux
d918 1
a918 1
   Please refer to [17]INSTALL.linux, which gives indepth instructions on
d921 1
a921 1
4.7 - Sending your dmesg to dmesg@@openbsd.org after the install
d937 1
a937 1
   Also check with [18]section 14.7
d955 2
a956 2
   [19][Back to Main Index] [20][To Section 3.0 - Obtaining OpenBSD]
   [21][To Section 5.0 - Kernel configuration and Disk Setup]
d959 2
a960 2
   [22][back] [23]www@@openbsd.org
   $OpenBSD: faq4.html,v 1.61 1999/10/29 14:37:50 ericj Exp $
d969 20
a988 18
   6. http://openbsd.org/faq/faq4.html#4.6
   7. http://openbsd.org/faq/faq4.html#4.7
   8. http://openbsd.org/orders.html
   9. http://openbsd.org/faq/log25.txt
  10. http://openbsd.org/faq/log25.txt
  11. http://openbsd.org/faq/log25.txt
  12. http://openbsd.org/faq/log25.txt
  13. http://openbsd.org/faq/log25.txt
  14. http://www.dorsai.org/~dcl/publications/NTLDR_Hacking/
  15. http://www.freebird.org/sw-map/bootmanager.html
  16. http://www.users.intercom.com/~ranish/part/
  17. http://openbsd.org/faq/INSTALL.linux
  18. http://openbsd.org/faq/faq14.html#14.7
  19. http://openbsd.org/faq/index.html
  20. http://openbsd.org/faq/faq3.html
  21. http://openbsd.org/faq/faq5.html
  22. http://openbsd.org/faq/index.html
  23. mailto:www@@openbsd.org
d993 1
a993 1
5.0 - Kernel configuration and Disk Setup
d1006 6
a1011 6
   It is a joyous occasion when you as a user get to configure and build
   your own custom kernel. Why would you want to do this though?

     * You can define which drivers your computer has support for.
     * You can get rid of unneeded drivers in the GENERIC kernel
     * Speed up boot times
d1014 2
d1018 6
a1023 1
   The GENERIC kernel will usually be all that you need.
d1052 4
a1055 4
   This means that it *IS* referencing yet another configuration file.
   This file stores non arch-dependent options. So when creating your
   Kernel Config be sure to look through [13]/sys/conf/GENERIC and see
   what you want. There ARE options in there that are NEEDED.
d1286 3
a1288 3
#mkdir -p /usr/src/sys
#cd /mnt/sys
#tar cf - . | ( cd /usr/src/sys; tar xvf - )
d1297 5
a1301 5
#cd /somewhere
#cp /usr/src/sys/arch/$ARCH/conf/SOMEFILE .
#vi SOMEFILE (to make the changes you want)
#config -s /usr/src/sys -b . SOMEFILE
#make
d1304 5
a1308 5
#cd /sys/arch/$ARCH/conf
#vi SOMEFILE (to make any changes you want)
#config SOMEFILE (read more about it here : [41]config(8))
#cd ../compile/SOMEFILE
#make
d1315 2
a1316 2
#cp /bsd /bsd.old
#cp /sys/arch/$ARCH/compile/SOMEFILE/bsd /bsd
d1342 1
a1342 1
Boot> boot wd0a:/bsd -c
d1392 1
a1392 1
   $OpenBSD: faq5.html,v 1.34 1999/11/08 19:23:04 ericj Exp $
d1477 5
a1481 6
   course, you can't all of them. That's not easy to do (although the
   IETF did it to evaluate the RFCs for year 2000 issues!) Rather, pick
   some topics that you are interested in, or that you use in your work.
   Look them up, find out how they are intended to work. The RFCs define
   many (thousands) of standards for protocols on the internet and how
   they are supposed to work.
d2373 1
a2373 1
   $OpenBSD: faq6.html,v 1.42 1999/11/11 07:23:16 ericj Exp $
d2455 1
a2455 1
7.0 - Keyboard and Console Controls
d2512 1
a2512 1
   $OpenBSD: faq7.html,v 1.10 1999/11/11 05:11:44 ericj Exp $
d2591 1
a2591 1
    4. run passwd
d2613 1
a2613 1
   [14]http://www.xfree86.org/FAQ/.
d2619 1
a2619 1
   about CVS at [15]http://www.cyclic.com/. CVS can be used by the end
d2649 1
a2649 1
   [16]http://www.openbsd.org/anoncvs.html Once you have chosen a server
d2657 1
a2657 1
       [17]Section 8.6 of the OpenBSD FAQ.
d2667 1
a2667 1
   2022. Be sure to check [18]http://www.openbsd.org/anoncvs.html for
d2703 1
a2703 1
   [19]http://www.openbsd.org/anoncvs.html. In this example I will be
d2729 5
a2733 4
   /pub/OpenBSD/2.5/ports.tar.gz. For most of you however, packages will
   be a much better option. Packages are created from ports and are
   already compiled and ready to use. To read more on packages read
   [20]FAQ8.7.
d2746 1
a2746 1
   [21]www.openbsd.org/anoncvs.html and [22]Faq8.5.
d2750 1
a2750 1
   [23]www.openbsd.org/ftp.html. From here download
d2787 1
a2787 1
   downloaded from any of the [24]OpenBSD ftp servers as
d2793 1
a2793 1
   [25]www.openbsd.org/portstat.html. There you will find a list of what
d2893 1
a2893 1
   More information about the ports can be found in the [26]ports(7) man
d2897 1
a2897 1
   help please see: [27]http://www.openbsd.org/ports.html
d2923 1
a2923 1
   Again, like with ports you can use the [28]pkg_info(1) program to view
d2926 2
a2927 2
   To delete packages you will want to use the [29]pkg_delete(1) command.
   It is used the same way as [30]pkg_add(1).
d2932 1
a2932 1
   Packages can be found on any of the [31]OpenBSD ftp mirror sites, or
d2955 1
a2955 1
   [32]boot(8) man page. Here we will go over the most common used
d2973 1
a2973 1
       the [33]Boot Time Config section of the faq.
d2981 1
a2981 1
   For further reading you can read [34]boot_i386(8) man page
d2991 4
a2994 4
     * [35]md4
     * [36]md5
     * [37]sha1
     * [38]rmd160.
d3004 1
a3004 1
   this you will have to use [39]skeyinit(1). With skeyinit(1), you will
d3073 1
a3073 1
   [40]skeyinfo(1), and it will tell you what to use. For example here, I
d3080 1
a3080 1
   use [41]skey(1). I can use exactly that output from above to create my
d3174 1
a3174 1
   [42]http://www.macbsd.com/macbsd/macbsd-docs/faq/faq-3.html#ss3.17
d3178 1
a3178 1
   The answer is in [43]../i386.html:
d3184 2
a3185 1
   please refer to [44]../donations.html to have support in the future.
d3187 2
a3188 2
   [45][Back to Main Index] [46][To Section 7.0 - Keyboard controls]
   [47][To Section 9.0 - Tips for linux users]
d3191 2
a3192 2
   [48][back] [49]www@@openbsd.org
   $OpenBSD: faq8.html,v 1.37 1999/11/11 05:31:58 ericj Exp $
d3209 5
a3213 5
  14. http://www.xfree86.org/FAQ/
  15. http://www.cyclic.com/
  16. http://openbsd.org/anoncvs.html
  17. http://openbsd.org/faq/faq8.html#8.6
  18. http://openbsd.org/anoncvs.html
d3215 4
a3218 4
  20. http://openbsd.org/faq/faq8.html#8.7
  21. http://openbsd.org/anoncvs.html
  22. http://openbsd.org/faq/faq8.html#8.5
  23. http://openbsd.org/ftp.html
d3220 26
a3245 25
  25. http://openbsd.org/portstat.html
  26. http://www.openbsd.org/cgi-bin/man.cgi?query=ports&sektion=7&format=html
  27. http://openbsd.org/ports.html
  28. http://www.openbsd.org/cgi-bin/man.cgi?query=pkg_info&sektion=1&format=html
  29. http://www.openbsd.org/cgi-bin/man.cgi?query=pkg_delete&sektion=1&format=html
  30. http://www.openbsd.org/cgi-bin/man.cgi?query=pkg_add&sektion=1&format=html
  31. http://openbsd.org/ftp.html
  32. http://www.openbsd.org/cgi-bin/man.cgi?query=boot&sektion=8&format=html
  33. http://openbsd.org/faq/faq5.html#5.4
  34. http://www.OpenBSD.org/cgi-bin/man.cgi?query=boot_i386&sektion=8&format=html
  35. http://www.openbsd.org/cgi-bin/man.cgi?query=md4&sektion=3&format=html
  36. http://www.openbsd.org/cgi-bin/man.cgi?query=md5&sektion=3&format=html
  37. http://www.openbsd.org/cgi-bin/man.cgi?query=sha1&sektion=3&format=html
  38. http://www.openbsd.org/cgi-bin/man.cgi?query=rmd160&sektion=3&format=html
  39. http://www.openbsd.org/cgi-bin/man.cgi?query=skeyinit&sektion=1&format=html
  40. http://www.openbsd.org/cgi-bin/man.cgi?query=skeyinfo&sektion=1&format=html
  41. http://www.openbsd.org/cgi-bin/man.cgi?query=skey&sektion=1&format=html
  42. http://www.macbsd.com/macbsd/macbsd-docs/faq/faq-3.html#ss3.17
  43. http://openbsd.org/i386.html
  44. http://openbsd.org/donations.html
  45. http://openbsd.org/faq/index.html
  46. http://openbsd.org/faq/faq7.html
  47. http://openbsd.org/faq/faq9.html
  48. http://openbsd.org/faq/index.html
  49. mailto:www@@openbsd.org
d3315 3
a3317 2
     * OpenBSD has made great strides to try and make the manpages
       actually helpful.
d3323 1
a3323 1
   Read [13]INSTALL.linux
d3329 1
a3329 1
   it is, grab [14]John the Ripper and use the unshadow utility that
d3345 1
a3345 1
# pwd_mkdb
d3363 1
a3363 1
   to follow the instructions on the [15]compat_linux(8) manual page. A
d3366 1
a3366 1
   collection read [16]FAQ 8.6. If you already have the ports tree
d3375 1
a3375 1
   [17]FAQ 14.1.
d3377 2
a3378 2
   [18][Back to Main Index] [19][To Section 8.0 - General Questions]
   [20][To Section 10.0 - System Administration]
d3381 2
a3382 2
   [21][back] [22]www@@openbsd.org
   $OpenBSD: faq9.html,v 1.16 1999/10/25 18:48:50 ericj Exp $
d3398 11
a3408 10
  13. http://openbsd.org/faq/INSTALL.linux
  14. http://www.false.com/security/john/
  15. http://www.openbsd.org/cgi-bin/man.cgi?query=compat_linux&sektion=8&format=html
  16. http://openbsd.org/faq/faq8.html#8.6
  17. http://openbsd.org/faq/faq14.html#14.1
  18. http://openbsd.org/faq/index.html
  19. http://openbsd.org/faq/faq8.html
  20. http://openbsd.org/faq/faq10.html
  21. http://openbsd.org/faq/index.html
  22. mailto:www@@openbsd.org
d4439 148
d4872 1
a4872 1
     * [1]12.1 - Using OpenBSD's new PCI-IDE code
d4876 4
a4879 1
12.1 - Using OpenBSD's new PCI-IDE code
d4881 1
a4881 63
   If you have a current source tree that was last updated after July
   25th, you will notice that OpenBSD has PCI-IDE code enabled by
   default, a big win on performance for anyone using an IDE controller!
   The PCI-IDE code introduces new PCI and ISA IDE code, and both PCI and
   ISA versions have DMA (or Direct Memory Access) capability. DMA allows
   the IDE controller to transfer data right from disk to your memory
   instead of running it through the CPU. This lowers the overall
   utilization of your CPU, keeping disk access fast and clean. (Note
   that OpenBSD has implemented the pciide code from NetBSD.)

   Date: Mon, 19 Jul 1999 18:07:40 -0700 (PDT)
       From: Constantine Sapuntzakis <[3]csapuntz@@stanford.edu>
       To: tech@@openbsd.org
       Subject: New ATA/IDE stuff in OpenBSD
       This weekend, I started integrating the IDE code from
       NetBSD-current to OpenBSD-current. It should be considered a
       work-in-progress.
       I'm sending out this e-mail for three reasons: to tell you about
       the new stuff, to ask for help in porting this across all the
       platforms with IDE, and to ask for help in testing this new
       feature.
       The code from NetBSD supports DMA, UltraDMA, PCI IDE, better error
       recovery, etc. It's also faster too. The code has been extensively
       tested in NetBSD but not in OpenBSD. The usual warnings apply: the
       new drivers might cause data loss.
       The new code also has a different way of handling ATAPI devices
       (like IDE CD ROMs, IDE tape drives, etc.). ATAPI devices talk the
       SCSI packet protocol and the new ATAPI layer acts like a SCSI
       adapter. As such, your ATAPI CD will now appear as SCSI CD (cd*),
       your ATAPI tape drive as a SCSI tape drive (st*), your ATAPI zip
       drive like a SCSI drive (sd*), etc. (note: some older ZIP drives
       are not ATAPI devices)
       Many ATAPI devices are NOT entirely SCSI-I and SCSI-II compliant.
       As such, our SCSI device drivers may not work with your CD/tape
       drive/ZIP drive. Integrating ATAPI device support into our SCSI
       devices is a high priority so this shouldn't stay broken for long.
       However, in the interim, you might get SCSI errors to the console
       if you try to use the devices. Under no condition should your
       machine hang or panic. If your machine does hang/panic, please
       send me mail, describing the steps leading up to the hang and
       providing a dmesg dump.
       For the best hard disk performance, you should not have an ATAPI
       device on the same chain as a hard disk.
       Currently, the ATA stuff is only integrated into the i386 port. I
       am willing to do the integration work on other platforms, but I
       need an account on such a machine to do compiles and your help in
       testing the resulting kernel.
       To enable this feature on i386, you are going to have to edit some
       files. Comments directing what edits to do appear in the following
       files:
       1) arch/i386/conf/files.i386 (don't forget to uncomment
       pciide_machdep.c)
       2) conf/files
       3) dev/isa/files.isa
       4) dev/pci/files.pci
       In addition, look at
       5) arch/i386/conf/NEWATA for how to configure the new stuff
       If you boot the new stuff, I'd appreciate it if you sent me a
       dmesg dump. Once you've got a new kernel, if anything goes wrong,
       please send me mail.
       Feel free to provide positive feedback too. ;)
       Thanks,
       -Costa
d4885 1
a4885 1
pciide0: bus-master DMA support present, used without full driver support
d4906 1
a4906 1
pciide0:0:0: using DMA data transfers
d4908 2
a4909 2
   This means that pciide0, channel 0, drive 0 is using DMA data
   transfers.
d4921 2
a4922 2
   [4][Back to Main Index] [5][To Section 11.0 - Performance Tuning]
   [6][To Section 13.0 - IPsec]
d4925 2
a4926 2
   [7][back] [8]www@@openbsd.org
   $OpenBSD: faq12.html,v 1.21 1999/10/01 19:38:09 ericj Exp $
d4932 5
a4936 6
   3. mailto:csapuntz@@stanford.edu
   4. http://openbsd.org/faq/index.html
   5. http://openbsd.org/faq/faq11.html
   6. http://openbsd.org/faq/faq13.html
   7. http://openbsd.org/faq/index.html
   8. mailto:www@@openbsd.org
d5695 1
a5695 1
14.0 - Working with disks in OpenBSD
d5752 1
a5752 1
   by reading [14]faq4.5. For servers it is recommended that you create
d6231 1
a6231 1
   pub/OpenBSD/2.5/tools/osbs135.exe
d6258 1
a6258 1
   Also check with [31]section 4.7
d6305 1
a6305 1
   $OpenBSD: faq14.html,v 1.10 1999/11/15 20:03:31 ericj Exp $
d6322 1
a6322 1
  14. http://openbsd.org/faq/faq4.html#4.5
d6339 1
a6339 1
  31. http://openbsd.org/faq/faq4.html#4.7
d7131 69
d7203 2
a7204 2
=================================================
Welcome to the OpenBSD/i386 2.5 installation program.
d7219 2
a7220 1
Proceed with installation? [n] _y
a7221 1
Cool! Let's get to it...
d7229 1
a7231 1
sd0
d7233 1
a7233 1
Which disk is the root disk [wd0]? _
d7236 25
a7260 1
[...]
d7269 3
d7277 1
a7277 1
partitions properly (ie. seperating /,  /usr, /tmp, /var, /usr/local, and other
d7283 1
a7283 1
You can use the 'b' command to change this.
d7286 41
d7377 22
d7401 1
d7409 2
a7410 6

wd0a
/

wd0b
swap
d7420 1
d7440 1
a7440 2

wd0a wd0d wd0e wd0g wd0h
d7443 10
a7452 1
[...]
d7459 144
a7602 1
Configure the network [y] _
d7613 2
a7614 4

[ ] xl0

[ ] fxp0
d7622 1
a7622 2

media: Ethernet 100baseTX half-duplex
d7638 2
a7639 5

[X] xl0

[ ] fxp0

a7649 5
/dev/wd0a on /mnt type ffs (local)
/dev/wd0d on /mnt/tmp type ffs (local)
/dev/wd0e on /mnt/var type ffs (local)
/dev/wd0g on /mnt/usr type ffs (local)
/dev/wd0h on /mnt/home type ffs (local)
d7651 103
a7753 3
Please enter the initial password that the root account will have.
Password (will not echo): _
Password (again): _
a7754 5
It is now time to extract the installation sets onto the hard disk.  Make sure
the sets are either on a local device (i.e. tape, CD-ROM) or on a network
server.  You will have the chance to repeat this step or to extract sets from
several places, so you don't have to try to load all the sets in one try and
can recover from some errors.
a7755 1
Install from (f)tp, (h)ttp, (t)ape, (C)D-ROM, (N)FS or local (d)isk? _c
d7757 3
a7759 2
The following CD-ROM devices are installed on your system; please select
the CD-ROM device containing the partition with the installation sets:
a7760 2
acd0
cd0
d7762 3
a7764 2
Which is the CD-ROM with the installation media? [abort] _acd0
Partition? [c] _
a7765 2
There are two CD-ROM filesystem types currently supported by this program:
cd9660
d7767 3
a7769 2
ISO-9660
ffs
a7770 1
Berkeley Fast Filesystem
d7772 3
a7774 3
Which filesystem type? [cd9660] _
Enter the directory relative to the mount point that
contains the file. [/2.5/i386] _
a7775 8
You will now be asked for files to extract.  In addition to the
files listed in the selector you may enter any file located in
/mnt2//2.5/i386.  You can also enter 'all' to install all the standard
sets, or 'list' to list the files avilable in /mnt2//2.5/i386.
When you are done selecting files, enter 'done'.
Some of these sets are required for your install and some are optional --
You will want at least the base and bsd sets.
Consult the intallation notes if you are not sure which sets are required!
a7776 3
The following sets are available for extraction.
Enter filename, `list', `all', or `done'.
You may de-select a set by prepending a '-' to it's name.
d7778 3
a7781 1
[X] base25.tar.gz
d7783 6
a7788 1
[X] etc25.tar.gz
a7789 1
[ ] misc25.tar.gz
a7790 1
[ ] comp25.tar.gz
d7792 3
a7794 1
[ ] man25.tar.gz
a7795 1
[ ] game25.tar.gz
a7796 1
[ ] xbase25.tar.gz
d7798 3
a7800 1
[ ] xshare25.tar.gz
a7801 1
[ ] xfont25.tar.gz
a7802 1
[ ] xserv25.tar.gz
d7804 3
a7806 1
[X] bsd
a7807 1
File name []? _*
d7809 3
a7811 3
The following sets are available for extraction.
Enter filename, `list', `all', or `done'.
You may de-select a set by prepending a '-' to it's name.
d7814 3
a7816 1
[X] base25.tar.gz
d7818 3
a7820 1
[X] etc25.tar.gz
a7821 1
[X] misc25.tar.gz
d7823 3
a7825 1
[X] comp25.tar.gz
a7826 1
[X] text25.tar.gz
a7827 1
[X] man25.tar.gz
d7829 3
a7831 1
[X] game25.tar.gz
a7832 1
[X] xbase25.tar.gz
d7834 3
a7836 1
[X] xshare25.tar.gz
d7838 3
a7840 1
[X] xfont25.tar.gz
a7841 1
[X] xserv25.tar.gz
a7842 2
[X] bsd
File name []? _-game*
d7844 3
a7846 3
The following sets are available for extraction.
Enter filename, `list', `all', or `done'.
You may de-select a set by prepending a '-' to it's name.
a7848 1
[X] base25.tar.gz
d7850 3
a7852 1
[X] etc25.tar.gz
a7853 1
[X] misc25.tar.gz
d7855 3
a7857 1
[X] comp25.tar.gz
a7858 1
[X] text25.tar.gz
d7860 4
a7863 1
[X] man25.tar.gz
a7864 1
[ ] game25.tar.gz
d7866 4
a7869 1
[X] xbase25.tar.gz
d7871 8
a7878 1
[X] xshare25.tar.gz
d7880 3
a7882 1
[X] xfont25.tar.gz
a7883 1
[X] xserv25.tar.gz
d7885 2
a7886 2
[X] bsd
File name []? _done
d7888 2
a7889 1
Ready to extract selected file sets? [y] _
d7891 2
a7892 20
/mnt2//2.5/i386/base25.tar.gz:
100% |***************************************************| 17774 KB   00:00 ETA
/mnt2//2.5/i386/etc25.tar.gz:
100% |***************************************************|   161 KB   00:00 ETA
/mnt2//2.5/i386/bsd:
100% |***************************************************|  2281 KB   00:00 ETA
/mnt2//2.5/i386/misc25.tar.gz:
100% |***************************************************|  1637 KB   00:00 ETA
/mnt2//2.5/i386/comp25.tar.gz:
100% |***************************************************| 11481 KB   00:00 ETA
/mnt2//2.5/i386/man25.tar.gz:
100% |***************************************************|  3543 KB   00:00 ETA
/mnt2//2.5/i386/xbase25.tar.gz:
100% |***************************************************|  5376 KB   00:00 ETA
/mnt2//2.5/i386/xshare25.tar.gz:
100% |***************************************************|  1482 KB   00:00 ETA
/mnt2//2.5/i386/xfont25.tar.gz:
100% |***************************************************|  6017 KB   00:00 ETA
/mnt2//2.5/i386/xserv25.tar.gz:
100% |***************************************************| 15188 KB   00:00 ETA
d7894 1
a7894 7
Extract more sets? [n] _
Copying fstab...done.
Copying hostname.xl0...done.
Copying hosts...done.
Copying myname...done.
Copying mygate...done.
Copying resolv.conf...done.
a7940 1
Do you expect to run X windows on this machine? [y or n] _y
d7944 1
a7944 1
Unmounting filesystems... /mnt/usr /mnt/var /mnt/tmp /mnt ... Done.
@


1.17
log
@sync
@
text
@d15 1
a15 1
    [8]7.0 - Keyboard Controls
d21 1
a21 1
    [14]13.0 - IPsec
d57 2
a58 1
   $OpenBSD: index.html,v 1.81 1999/10/11 19:33:09 ericj Exp $
d502 1
a502 1
Subject: 2.5 panics on an i386
d504 1
a504 1
After installing OpenBSD 2.5 from the CD which I purchased via your outstanding
d509 2
a510 2
OpenBSD 2.5-current (OSHIBANA) #2: Fri Jun  4 11:11:41 EDT 1999
    shinobi@@oshibana:/sys/arch/i386/compile/OSHIBANA
d516 1
a516 1
avail mem = 13725696
d520 1
a520 1
bios0: apminfo 0xf02dc00c diskinfo 0xf02dc034 cksumlen 1 memmap 0xf02dc0b0
d522 2
a523 2
apm0: battery life expectancy 96%
apm0: AC on, battery charge high, charging, estimated 1:28 minutes
d525 1
a525 1
"Toshiba (2nd ID) Host-PCI" rev 0x11 at pci0 dev 0 function 0 not configured
d529 5
a533 5
wdc0 at isa0 port 0x1f0-0x1f7 irq 14
wd0 at wdc0 drive 0: <TOSHIBA MK2720FC>
wd0: 1296MB, 2633 cyl, 16 head, 63 sec, 512 bytes/sec, 2654280 sec total
wd0: using 16-sector 16-bit pio transfers, lba addressing (128KB cache)
sb0 at isa0 port 0x220-0x237 irq 7 drq 1: dsp v3.02
d537 11
a547 5
midi at opl0 not configured
pccom0 at isa0 port 0x3f8-0x3ff irq 4: ns16550a, 16 byte fifo
pccom1 at isa0 port 0x2f8-0x2ff irq 3: ns16550a, 16 byte fifo
pccom2 at isa0 port 0x3e8-0x3ef irq 5: ns16550a, 16 byte fifo
vt0 at isa0 port 0x60-0x6f irq 1: generic VGA, 80 col, color, 8 scr, mf2-kbd
d549 1
a549 1
fdc0 at isa0 port 0x3f0-0x3f5 irq 6 drq 2
d551 2
a552 2
pcic0 at isa0 port 0x3e0-0x3e1 iomem 0xd0000-0xd3fff
pcic0: controller 0 (Intel 82365SL Revision 1) has sockets A and B
d555 7
a561 1
biomask 40c0 netmask 42c0 ttymask 56c2
a562 1
pctr: 586-class performance counters and user-level cycle counter enabled
d590 1
a590 1
   $OpenBSD: faq2.html,v 1.21 1999/10/13 05:03:38 ericj Exp $
d681 7
d729 1
a729 1
   $OpenBSD: faq3.html,v 1.10 1999/09/24 01:46:14 ericj Exp $
d784 1
a784 1
     * dd if=floppy25.fs of=/dev/fd0c bs=126b
d868 4
a871 5
     * base25.tar.gz - Has the BASE OpenBSD system *NEEDED*
     * etc25.tar.gz - Has all the files in /etc *NEEDED*
     * comp25.tar.gz - Has the compiler and its tools, libs. *STRONGLY
       SUGGESTED*
     * man25.tar.gz - Holds man pages *STRONGLY SUGGESTED*
d873 1
a873 1
     * game25.tar.gz - Has the Games for OpenBSD *FUN*
d880 1
a880 1
     * bsd - This is the Kernel. *NEEDED*
d886 15
a900 1
   home system that is connected to the internet:
d914 22
a935 12
   entire system have just an 'a' and 'b' partition. The 'a' partition
   you set up in disklabel will become your root partition, which should
   be the sum of all the 3 main values above (/, /usr, and /var) plus
   some space for /tmp. The 'b' partition you set up automatically
   becomes your system swap partition -- we recommend a minimum of 32MB
   but if you have disk to spare make it at least 64MB.

   However, we recommend you use many separate partitions so that users
   cannot fill up your important partitions as easily, thus causing nasty
   denial of service problems. If you want to be extra cautious, you
   should make the following separate partitions: / swap /usr /var /tmp
   /var/tmp /home.
d1005 1
a1005 1
   $OpenBSD: faq4.html,v 1.59 1999/10/01 19:38:09 ericj Exp $
d1044 1
d1068 1
a1068 1
   them, those that are most commonly used. Check the [5]options(4) man
d1079 6
a1084 6
     * [6]Alpha Kernel Conf Files
     * [7]i386 Kernel Configuration files
     * [8]mac68k Kernel Configuration files
     * [9]pmax Kernel Configuration Files
     * [10]sparc Kernel Configuration Files
     * [11]Other Arch's
d1090 1
a1090 1
   Kernel Config be sure to look through [12]/sys/conf/GENERIC and see
d1109 6
a1114 6
     * [13]COMPAT_SVR4(8) - Compatibility with SVR4 binaries.
     * [14]COMPAT_BSDOS(8) - Compatibility with BSD/OS binaries.
     * [15]COMPAT_LINUX(8) - Compatibility with Linux binaries.
     * [16]COMPAT_SUNOS(8) - Compatibility with SunOS binaries.
     * [17]COMPAT_ULTRIX(8) - Compatibility with Ultrix binaries.
     * [18]COMPAT_FREEBSD(8) - Compatibility with FreeBSD binaries.
d1117 1
a1117 1
     * [19]COMPAT_IBCS2(8) - Compatibility to run ibcs2 binaries.
d1134 1
a1134 1
     * [20]DDB - This compiles in the in-kernel debugger. This isn't
d1136 1
a1136 1
     * [21]KGDB - Compiles a remote kernel debugger using gdb's `remote
d1144 1
a1144 1
       allows users to use [22]ktrace(1).
d1148 1
a1148 1
       [23]kgmon(8).
d1170 1
a1170 1
     * NULLFS - Code to have a loopback filesystem. [24]mount_null(8) has
d1189 1
a1189 1
       softupdates more read the [25]Softupdates FAQ section.
d1200 1
a1200 1
       Read [26]options(4) for more details.
d1202 1
a1202 1
       read [27]FAQ 10
d1215 1
a1215 1
       arch's. Read [28]lkm(4) for more information.
d1217 1
a1217 1
       [29]init(8) for more information on kernel security levels.
d1224 2
a1225 2
       Default is 8. For more on CCD read the [30]CCD(4) man page, or the
       [31]Performance Tuning FAQ section.
d1232 1
a1232 1
   Also check the [32]Networking FAQ or the [33]Networking Performance
d1244 1
a1244 1
       of mbuf clusters. Read [34]options(4) for more information on this
d1247 1
a1247 1
       [35]ns(4)
d1249 1
a1249 1
       See [36]iso(4) for more information.
d1273 1
a1273 1
     * PPP_FILTER - This option turns on [37]pcap(3) based filtering for
d1278 1
a1278 1
       [38]ipsec(4) for more details. This now implies option KEY, which
d1315 1
a1315 1
   [39]afterboot(8) man page.
d1342 1
a1342 1
#config SOMEFILE (read more about it here : [40]config(8))
d1360 1
a1360 1
   new bootblocks. To do so, read [41]faq15.8 on OpenBSD's Bootloader.
d1375 1
a1375 1
   Most of this document can be found in the man page [42]boot_config(8)
d1407 1
a1407 1
   and Compile a new kernel. Refer to [43]Building your own kernel for
d1410 15
a1424 2
   [44][Back to Main Index] [45][To Section 4.0 - Installation Guide]
   [46][To Section 6.0 - Networking]
d1427 2
a1428 2
   [47][back] [48]www@@openbsd.org
   $OpenBSD: faq5.html,v 1.32 1999/09/24 01:46:14 ericj Exp $
d1436 45
a1480 44
   5. http://www.openbsd.org/cgi-bin/man.cgi?query=options&apropos=0&sektion=4&format=html
   6. http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/alpha/conf/
   7. http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/i386/conf/
   8. http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/mac68k/conf/
   9. http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/pmax/conf/
  10. http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/sparc/conf/
  11. http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/
  12. http://www.openbsd.org/cgi-bin/cvsweb/src/sys/conf/GENERIC
  13. http://www.openbsd.org/cgi-bin/man.cgi?query=compat_svr4&sektion=8&apropos=0&manpath=OpenBSD+Current
  14. http://www.openbsd.org/cgi-bin/man.cgi?query=compat_bsdos&sektion=8&apropos=0&manpath=OpenBSD+Current
  15. http://www.openbsd.org/cgi-bin/man.cgi?query=compat_linux&sektion=8&apropos=0&manpath=OpenBSD+Current
  16. http://www.openbsd.org/cgi-bin/man.cgi?query=compat_sunos&sektion=8&apropos=0&manpath=OpenBSD+Current
  17. http://www.openbsd.org/cgi-bin/man.cgi?query=compat_ultrix&sektion=8&apropos=0&manpath=OpenBSD+Current
  18. http://www.openbsd.org/cgi-bin/man.cgi?query=compat_freebsd&sektion=8&apropos=0&manpath=OpenBSD+Current
  19. http://www.openbsd.org/cgi-bin/man.cgi?query=compat_ibcs2&sektion=8&apropos=0&manpath=OpenBSD+Current
  20. http://www.openbsd.org/cgi-bin/man.cgi?query=ddb&sektion=4&format=html
  21. http://www.openbsd.org/cgi-bin/man.cgi?query=gdb&sektion=1&format=html
  22. http://www.openbsd.org/cgi-bin/man.cgi?query=ktrace&sektion=1&format=html
  23. http://www.openbsd.org/cgi-bin/man.cgi?query=kgmon&sektion=8&format=html
  24. http://www.openbsd.org/cgi-bin/man.cgi?query=mount_null&sektion=8&format=html
  25. http://openbsd.org/faq/faq14.html#14.5
  26. http://www.openbsd.org/cgi-bin/man.cgi?query=options&sektion=4&format=html
  27. http://openbsd.org/faq/faq10.html#10.10
  28. http://www.openbsd.org/cgi-bin/man.cgi?query=lkm&sektion=4&format=html
  29. http://www.openbsd.org/cgi-bin/man.cgi?query=init&sektion=8&format=html
  30. http://www.openbsd.org/cgi-bin/man.cgi?query=ccd&sektion=4&format=html
  31. http://openbsd.org/faq/faq11.html#11.2
  32. http://openbsd.org/faq/faq6.html
  33. http://openbsd.org/faq/faq11.html#11.1
  34. http://www.openbsd.org/cgi-bin/man.cgi?query=options&sektion=4&format=html
  35. http://www.openbsd.org/cgi-bin/man.cgi?query=ns&sektion=4&apropos=0&manpath=OpenBSD+Current
  36. http://www.openbsd.org/cgi-bin/man.cgi?query=iso&sektion=4&format=html
  37. http://www.openbsd.org/cgi-bin/man.cgi?query=pcap&sektion=3&format=html
  38. http://www.openbsd.org/cgi-bin/man.cgi?query=ipsec&sektion=4&format=html
  39. http://www.openbsd.org/cgi-bin/man.cgi?query=afterboot&apropos=0&sektion=8&format=html
  40. http://www.openbsd.org/cgi-bin/man.cgi?query=config&apropos=0&sektion=8&format=html
  41. http://openbsd.org/faq/faq14.html#14.8
  42. http://www.openbsd.org/cgi-bin/man.cgi?query=boot_config&apropos=0&sektion=8&format=html
  43. http://openbsd.org/faq/faq5.html#5.3
  44. http://openbsd.org/faq/index.html
  45. http://openbsd.org/faq/faq4.html
  46. http://openbsd.org/faq/faq6.html
  47. http://openbsd.org/faq/index.html
  48. mailto:www@@openbsd.org
d1522 34
a1555 8
  Interfaces

   Here we assume you have all your network interfaces working, and a
   basic TCP/IP knowledge.

   All your interfaces should be listed with:
# ifconfig -a

d1559 3
a1561 5
xl0: flags=8843<UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST>
        media: Ethernet 100baseTX half-duplex
        inet 10.1.1.1 netmask 0xffffff00 broadcast 10.1.1.255
sl0: flags=c010<POINTOPOINT,LINK2,MULTICAST>
        inet 10.1.1.1 netmask 0xffffff00 broadcast 10.1.1.255
d1568 45
a1612 1
enc0: flags=8<LOOPBACK>
d1614 16
a1629 47
   First there is lo0 the loopback interface. It normally should be
   assigned address of 127.0.0.1 no matter what the rest of your network
   looks like. The next important one is xl0 in this example (could be
   neX, epX, or one of many other names, depending on the chipset that
   your network card uses), which is a board itself.

   In this example, xl0 it has UP and RUNNING flags on, along with le0.
   That means that they are working (for the most part, anyways.) Your
   interface could be down if you never configured it, and then it would
   look like the other interfaces. Or, your interface could be up but
   incorrectly configured (wrong IP address or wrong netmask) and thus
   won't work properly. The other interfaces in this example are not part
   of this section, as sl and ppp are for serial line comunication, tun
   is a pseudo-device for tunneling and enc a pseudo-device for
   encryption. They are covered later in this document.

   If xl0 was uninitialized, you can assign it an address by creating an
   ascii file, /etc/hostname.xl0, containing a string like this:
inet 10.1.1.1 255.255.255.0 NONE

   In the above example we show inet 10.1.1.1, where the second argument
   is our IP address. 255.255.255.0 is our netmask and NONE shows no
   media tags. (full-duplex, etc).

   In /etc/hosts we then put a hostname for ip address 10.1.1.1:
10.1.1.1        mona    mona.openbsd.org.ar

   Now check that you have a file /etc/myname and a file /etc/mygate. If
   you don't have them, you need to create them. If your gateway is a
   machine named "wintermute" which is also in the /etc/hosts, use these
   commands:
# echo "mona" > /etc/myname
# echo "wintermute" > /etc/mygate

   Ok, you are done for a standalone system, but to activate your
   configuration now (without rebooting) do:
# sh /etc/netstart

   This will give you a few errors, but don't worry as all them are
   concerning 127.0.0.x (loopback)

   Note: if you want to use the system as a gateway, later there's a
   "Firewall Setup" section, but you need to read all this first.

   Now check your routes are ok (here we use -n to make it simpler to
   look at):
# netstat -rn
d1633 2
a1634 6
Destination        Gateway            Flags     Refs     Use    Mtu
Interface
default            10.1.1.254         UGS         0        0      -  xl0
10.1.1/24          link#1             UC          0        0      -  xl0
10.1.1.1           127.0.0.1          UGHS        0        0      -  lo0
10.1.1.254         link#1             UHL         1        0      -  xl0
d1636 5
a1640 2
127.0.0.1          127.0.0.1          UH          3       24      -  lo0
224/8              link#1             UCS         0        0      -  xl0
d1643 3
a1645 2
Source address/netmask          Port  Destination address/netmask     Port Prot
o SA(Address/SPI/Proto)
d1647 9
a1655 10
   (The default gateway here is 10.1.1.254)

  IP Aliasing

   If you want to map more than one IP address on a single network
   interface, you need to assign an "alias" to it. The way to do it on
   OpenBSD is simply assigning the interface another IP with the "alias"
   option like this:

# ifconfig xl0 alias 10.1.1.2 netmask 255.255.255.255
d1657 1
a1657 27
   Here xl0 is assigned another IP number (remember it already has
   10.1.1.1). Note the netmask used! Don't use 255.255.255.0 in this kind
   of case (both numbers are on the same subnet), only ONE address should
   handle the subnet. If you do such kind of misconfiguration, the
   following error appears:

ifconfig:SIOCAIFADDR: File exists

   Now let's change the configuration file for this, /etc/ifaliases. Add
   to it this line:

xl0   10.1.1.2 255.255.255.255

   This means, simply, interface xl0 should have an alias 10.1.1.2 with
   the netmask 255.255.255.255.

  DNS Client Setup

   Let's assume your DNS servers are 125.2.3.4 and 125.2.3.5, and your
   machine name belongs to the domain yourdomain.com. You should have the
   following lines to your /etc/resolv.conf file:
domain yourdomain.com
nameserver 125.2.3.4
nameserver 125.2.3.5
lookup file bind

  Gateway Setup
d1660 1
a1660 1
   gateway (also called a router.) If you are using OpenBSD as a router
d1665 2
a1666 2
   Address Translation (next section of this document) for information on
   conserving your IP address space.
d1668 5
a1672 8
   If you want your OpenBSD machine to act as a dedicated router, and you
   are building a custom kernel configuration for it, you can either
   compile your kernel with options IPFORWARDING or GATEWAY. (See
   [13]section 11 for further information on tuning NMBCLUSTERS if you
   are doing this.) For the rest of us, OpenBSD now has a sysctl
   mechanism to turn on and off IP Forwarding at boot. If you want it to
   "forward" any packets between your interfaces, modify the
   /etc/sysctl.conf line that toggles the forwarding variable on bootup:
d1675 3
a1677 1
   To make the changes without booting:
d1683 1
a1683 1
   [14]routed(8), [15]gated, [16]mrtd, and [17]zebra. OpenBSD has support
d1691 2
a1692 2
   packet level forwarding permissions [18]ipf(8) and mapping
   hosts/subnets to a range of external addresses [19]ipnat(8). The
d1722 2
a1723 2
   at the IP Filter [20]mailing list archive, the [21]IP Filter web site,
   and finally the [22]IP Filter HOWTO.
d1729 1
a1729 1
   usage, for a more strict definition see [23]ipf(5). Here is assumed
d1761 16
a1776 16
     * [24]6.3.1 Introduction
          + [25]6.3.1.1 Purpose
          + [26]6.3.1.2 Terminology
          + [27]6.3.1.3 Configuration
     * [28]6.3.2 Network Address Translation
          + [29]6.3.2.1 Introduction to Network Address Translation
          + [30]6.3.2.2 Why to use Network Address Translation
          + [31]6.3.2.3 Setup
          + [32]6.3.2.4 Configuration
          + [33]6.3.2.5 Running
     * [34]6.3.3 Network Address Translation Knowledge Base
          + [35]6.3.3.1 Checking NAT status
          + [36]6.3.3.2 Limitations of NAT (in FTP)
          + [37]6.3.3.3 Redirecting Traffic
          + [38]6.3.3.4 Network Address Translation versus Proxy
     * [39]6.3.4 Links and X-References
d1791 1
a1791 1
   Based on [40]RFC 1631, ipnat provides an easy way to map internal
d1795 1
a1795 1
   you can take advantage of reserved address blocks (assigned in [41]RFC
d1962 1
a1962 1
   Again for more information you can read [42]FAQ 6.2
d2160 4
a2163 3
     * [43]http://www.openbsd.org/cgi-bin/man.cgi?query=ipnat&sektion=8
     * [44]http://coombs.anu.edu.au/~avalon/
     * [45]http://www.geektools.com/rfc/rfc1631.txt
d2169 1
a2169 1
   To use the DHCP client [46]dhclient(8) included with OpenBSD, edit
d2198 1
a2198 1
   If you want to use OpenBSD as a DHCP server [47]dhcpd(8), edit
d2236 1
a2236 1
   [48]dhcp-options(5) for more options that your DHCP clients may want.
d2242 2
a2243 2
     * [49]pppd(8) - Which is the kernel ppp daemon.
     * [50]ppp(8) - Which is the userland ppp daemon.
d2254 1
a2254 1
   your ppp. The userland PPP daemon uses the file [51]/etc/ppp/ppp.conf
d2282 1
a2282 1
   logging levels. This can be changed, refer to [52]ppp(8) for more info
d2357 2
a2358 2
     * [53]ppp.linkup
     * [54]ppp.linkdown
d2387 1
a2387 1
   net.inet.ip.directed-broadcast=1 turns this on. Read about [55]smurf
d2392 1
a2392 1
   There is a sysctl for this also. From [56]sysctl(8):
d2405 2
a2406 2
   [57][Back to Main Index] [58][To Section 5.0 - Kernel configuration
   and Disk Setup] [59][To Section 7.0 - Keyboard controls]
d2409 2
a2410 2
   [60][back] [61]www@@openbsd.org
   $OpenBSD: faq6.html,v 1.39 1999/10/15 16:04:22 ericj Exp $
d2426 62
a2487 49
  13. http://openbsd.org/faq/faq11.html
  14. http://www.openbsd.org/cgi-bin/man.cgi?query=routed&apropos=0&sektion=8&format=html
  15. http://www.gated.org/
  16. http://www.mrtd.net/
  17. http://www.zebra.org/
  18. http://www.openbsd.org/cgi-bin/man.cgi?query=ipf&apropos=0&sektion=8&format=html
  19. http://www.openbsd.org/cgi-bin/man.cgi?query=ipnat&apropos=0&sektion=8&format=html
  20. http://false.net/ipfilter/
  21. http://coombs.anu.edu.au/~avalon/
  22. http://www.obfuscation.org/ipf/
  23. http://www.openbsd.org/cgi-bin/man.cgi?query=ipf&apropos=0&sektion=5&format=html
  24. http://openbsd.org/faq/faq6.html#nat1.0
  25. http://openbsd.org/faq/faq6.html#nat1.1
  26. http://openbsd.org/faq/faq6.html#nat1.2
  27. http://openbsd.org/faq/faq6.html#nat1.3
  28. http://openbsd.org/faq/faq6.html#nat2.0
  29. http://openbsd.org/faq/faq6.html#nat2.1
  30. http://openbsd.org/faq/faq6.html#nat2.2
  31. http://openbsd.org/faq/faq6.html#nat2.3
  32. http://openbsd.org/faq/faq6.html#nat2.4
  33. http://openbsd.org/faq/faq6.html#nat2.5
  34. http://openbsd.org/faq/faq6.html#nat3.0
  35. http://openbsd.org/faq/faq6.html#nat3.1
  36. http://openbsd.org/faq/faq6.html#nat3.2
  37. http://openbsd.org/faq/faq6.html#nat3.3
  38. http://openbsd.org/faq/faq6.html#nat3.4
  39. http://openbsd.org/faq/faq6.html#nat4.0
  40. http://www.geektools.com/rfc/rfc1631.txt
  41. http://www.geektools.com/rfc/rfc1918.txt
  42. http://openbsd.org/faq/faq6.html#6.2
  43. http://www.openbsd.org/cgi-bin/man.cgi?query=ipnat&sektion=8
  44. http://coombs.anu.edu.au/~avalon/
  45. http://www.geektools.com/rfc/rfc1631.txt
  46. http://www.openbsd.org/cgi-bin/man.cgi?query=dhclient&apropos=0&sektion=8&format=html
  47. http://www.openbsd.org/cgi-bin/man.cgi?query=dhcpd&apropos=0&sektion=8&format=html
  48. http://www.openbsd.org/cgi-bin/man.cgi?query=dhcp-options&apropos=0&sektion=5&format=html
  49. http://www.openbsd.org/cgi-bin/man.cgi?query=pppd&sektion=8&format=html
  50. http://www.openbsd.org/cgi-bin/man.cgi?query=ppp&sektion=8&format=html
  51. http://www.openbsd.org/cgi-bin/cvsweb/src/etc/ppp/ppp.conf.sample
  52. http://www.openbsd.org/cgi-bin/man.cgi?query=ppp&sektion=8&format=html
  53. http://www.openbsd.org/cgi-bin/cvsweb/src/etc/ppp/ppp.linkup.sample
  54. http://www.openbsd.org/cgi-bin/cvsweb/src/etc/ppp/ppp.linkdown.sample
  55. http://www.netscan.org/
  56. http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&apropos=0&sektion=8&format=html
  57. http://openbsd.org/faq/index.html
  58. http://openbsd.org/faq/faq5.html
  59. http://openbsd.org/faq/faq7.html
  60. http://openbsd.org/faq/index.html
  61. mailto:www@@openbsd.org
d2492 1
a2492 1
7.0 - Keyboard Controls
d2498 2
d2516 29
a2544 1
   [3][Back to Main Index] [4][To Section 6.0 - Networking] [5][To
d2548 2
a2549 2
   [6][back] [7]www@@openbsd.org
   $OpenBSD: faq7.html,v 1.7 1999/09/24 01:46:14 ericj Exp $
d2555 3
a2557 3
   3. http://openbsd.org/faq/index.html
   4. http://openbsd.org/faq/faq6.html
   5. http://openbsd.org/faq/faq8.html
d2559 4
a2562 1
   7. mailto:www@@openbsd.org
a2635 1

d2639 1
a2639 1
   are in your kernel configuration. [BOTH these are in the GENERIC
a2748 2
? www/faq/Makefile
? www/faq/txtdump.sh
d2766 58
a2823 1
   /pub/OpenBSD/2.5/ports.tar.gz or try the latest updates in
d2826 1
a2826 5
   If you want to run one of the latest ports collections, you'll need to
   update your /usr/share/mk/ directory. CVS up your /usr/src/ directory
   and do a:
# cd /usr/src/share/mk/
# make install
d2828 14
a2841 1
   first.
d2843 8
a2850 3
   A snapshot of the ports tree is also created daily and can be
   downloaded from any of the [20]OpenBSD ftp servers as
   /pub/OpenBSD/snapshots/ports.tar.gz.
d2852 1
a2852 4
   In 2.5-current this information is now stored in the ports tree. In
   ports/infrastructure/. So, once you are running the latest snapshot,
   with the infrastructure dir, you no longer need to update bsd.port.mk
   per instructions above.
d2900 2
d2924 1
a2924 1
 nmh-0.27            The New MH mail handling program
d2927 1
a2927 11
   If you are looking for a specific program in the ports tree, you can
   try
fenetyllin:/usr/ports/# make search key="xfig"
Port:   xfig-3.2.2
Path:   /home/ports/graphics/xfig
Info:   A drawing program for X11
Maint:  angelos@@openbsd.org
Index:  graphics x11
B-deps: Xaw3d-1.3 jpeg-6b
R-deps: Xaw3d-1.3 ghostscript-5.10 gv-3.5.8 jpeg-6b png-1.0.2 transfig-3.2.1
Archs:  any
d2929 2
a2930 11
Port:   transfig-3.2.1
Path:   /home/ports/print/transfig
Info:   Tools to convert Xfigs .fig files.
Maint:  angelos@@openbsd.org
Index:  print
B-deps: jpeg-6b
R-deps: ghostscript-5.10 jpeg-6b png-1.0.2
Archs:  any
[snip]

   More information about the ports can be found in the ports man page
d2933 1
a2933 1
   help please see: [21]http://www.openbsd.org/ports.html
d2954 2
a2955 3
   bsd# pkg_add
       ftp://ftp.openbsd.org/pub/OpenBSD/2.5/packages/${arch}/ispell-3.1.
       20.tgz
d2959 1
a2959 1
   Again, like with ports you can use the [22]pkg_info(1) program to view
d2962 3
a2964 3
   To delete packages you will want to use the [23]pkg_delete(1) command.
   It is used the same way as [24]pkg_add(1).
   bsd# /usr/sbin/pkg_delete ispell-3.1.20
d2968 1
a2968 1
   Packages can be found on any of the [25]OpenBSD ftp mirror sites, or
d2977 2
a2978 2
   After that you would be able to use the floppy drive all the time. It
   doesn't matter if you plugged it later after boot.
d2991 1
a2991 1
   [26]boot(8) man page. Here we will go over the most common used
d3009 1
a3009 1
       the [27]Boot Time Config section of the faq.
d3017 1
a3017 1
   For further reading you can read [28]boot_i386(8) man page
d3027 4
a3030 4
     * [29]md4
     * [30]md5
     * [31]sha1
     * [32]rmd160.
d3040 1
a3040 1
   this you will have to use [33]skeyinit(1). With skeyinit(1), you will
d3109 1
a3109 1
   [34]skeyinfo(1), and it will tell you what to use. For example here, I
d3116 1
a3116 1
   use [35]skey(1). I can use exactly that output from above to create my
d3210 1
a3210 1
   [36]http://www.macbsd.com/macbsd/macbsd-docs/faq/faq-3.html#ss3.17
d3214 1
a3214 1
   The answer is in [37]../i386.html:
d3220 1
a3220 1
   please refer to [38]../donations.html to have support in the future.
d3222 2
a3223 2
   [39][Back to Main Index] [40][To Section 7.0 - Keyboard controls]
   [41][To Section 9.0 - Tips for linux users]
d3226 2
a3227 2
   [42][back] [43]www@@openbsd.org
   $OpenBSD: faq8.html,v 1.34 1999/10/07 21:11:34 ericj Exp $
d3250 30
a3279 24
  20. http://openbsd.org/ftp.html
  21. http://openbsd.org/ports.html
  22. http://www.openbsd.org/cgi-bin/man.cgi?query=pkg_info&sektion=1&format=html
  23. http://www.openbsd.org/cgi-bin/man.cgi?query=pkg_delete&sektion=1&format=html
  24. http://www.openbsd.org/cgi-bin/man.cgi?query=pkg_add&sektion=1&format=html
  25. http://openbsd.org/ftp.html
  26. http://www.openbsd.org/cgi-bin/man.cgi?query=boot&sektion=8&format=html
  27. http://openbsd.org/faq/faq5.html#5.4
  28. http://www.OpenBSD.org/cgi-bin/man.cgi?query=boot_i386&sektion=8&format=html
  29. http://www.openbsd.org/cgi-bin/man.cgi?query=md4&sektion=3&format=html
  30. http://www.openbsd.org/cgi-bin/man.cgi?query=md5&sektion=3&format=html
  31. http://www.openbsd.org/cgi-bin/man.cgi?query=sha1&sektion=3&format=html
  32. http://www.openbsd.org/cgi-bin/man.cgi?query=rmd160&sektion=3&format=html
  33. http://www.openbsd.org/cgi-bin/man.cgi?query=skeyinit&sektion=1&format=html
  34. http://www.openbsd.org/cgi-bin/man.cgi?query=skeyinfo&sektion=1&format=html
  35. http://www.openbsd.org/cgi-bin/man.cgi?query=skey&sektion=1&format=html
  36. http://www.macbsd.com/macbsd/macbsd-docs/faq/faq-3.html#ss3.17
  37. http://openbsd.org/i386.html
  38. http://openbsd.org/donations.html
  39. http://openbsd.org/faq/index.html
  40. http://openbsd.org/faq/faq7.html
  41. http://openbsd.org/faq/faq9.html
  42. http://openbsd.org/faq/index.html
  43. mailto:www@@openbsd.org
d3349 2
d3415 1
a3415 1
   $OpenBSD: faq9.html,v 1.15 1999/10/07 06:20:39 chris Exp $
d3466 1
d3474 1
a3474 1
   allowed to use the [13]su(1) userland program to become root. Users
d3478 1
a3478 1
   If you are adding a new user with [14]adduser(8), you can put them in
d3485 1
a3485 1
   [15]sudo(8).
d3489 1
a3489 1
   To duplicate your filesystem use [16]dump(8) and [17]restore(8). For
d3496 1
a3496 1
   entire) filesystem. The command [18]tar(1) may be faster for this
d3502 1
a3502 1
   OpenBSD uses an [19]rc(8) style startup. This uses a few key files for
d3512 1
a3512 1
       before the security level changes. See [20]init(8)
d3514 1
a3514 1
       done before shutdown in this file. See [21]rc.shutdown(8)
d3538 1
a3538 1
   To start out take a look at the default [22]/etc/rc.conf file. You'll
d3543 1
a3543 1
   At least not via rc(8), read the [23]Anonymous FTP FAQ to read more
d3554 2
a3555 2
   But to start httpd with ssl enabled. (Refer to the [24]SSL FAQ or
   [25]ssl(8)) You should start with a line like: "httpd_flags="-DSSL"".
d3590 5
a3594 3
   users who are sending mail remotely with the following syntax:
.domain.com    #Allow any .domain.com user to send mail through us
sub.domain.com #Allow sub.domain.com to send mail through us
d3600 6
d3653 1
a3653 1
   The steps shown here are taken in part from the [26]ssl(8) man page.
d3687 1
a3687 1
   /etc/passwd dynamically with [27]pwd_mkdb(8). The main password file
d3715 1
a3715 1
   The best way to add a user in OpenBSD is to use the [28]adduser(8)
d3722 1
a3722 1
   further instructions on adding users read the [29]adduser_proc(8) man
d3725 1
a3725 1
   To delete users you should use the [30]rmuser(8) utility. This will
d3730 1
a3730 1
10.9 - How do I create an ftp-only account?
d3738 3
a3740 1
   wish.
d3764 1
a3764 1
   [31]edquota(8). A simple use is just edquota <user>. edquota(8) will
d3788 1
a3788 1
   this use [32]quotaon(8). For example:
d3793 1
a3793 1
   [33]quota(1). Using a command of quota <user> will give that users
d3827 1
a3827 1
     * [34]The FreeBSD handbook
d3829 2
a3830 2
     * [35]Designing an Authentication System: a Dialogue in Four Scenes
     * [36]Papers and Documentation Describing KerberosIV
d3833 1
a3833 1
     * [37]Network Security Private Communication in a Public World
d3851 1
a3851 1
   krb.realms. For more information on this refer to [38]krb.conf.
d3862 1
a3862 1
   Again, for further information read the [39]krb.realms. man page.
d3864 1
a3864 1
   Next we will run [40]kdb_init(8) to create the initial Kerberos
d3875 1
a3875 1
   Next we need to use [41]kstash(8) which is used to save the Kerberos
d3945 1
a3945 1
   command line, [42]ext_srvtab(8) creates the service key file
d4011 1
a4011 1
   privileges to a specific principal, see [43]the FreeBSD Handbook.
d4031 1
a4031 1
   you use [44]kinit(1).
d4038 1
a4038 1
   Now we have identified we can list our tickets with [45]klist(1).
d4067 1
a4067 1
   [46]kdestroy(1). For example:
d4077 1
a4077 1
   If you want ticket passing, use Dug Song's [47]krb4 SSH patches. Stock
d4090 10
a4099 9
   To start off, you need to have an account on your system of ''ftp''.
   This account shouldn't have a useable password, and here we will set
   the login directory to /home/ftp. When using anonymous ftp, the ftp
   daemon will chroot itself to /home/ftp. To read up more on that, read
   the [48]ftp(8) and [49]chroot(2) man pages. Here is an example of
   adding the ftp user. I will do this using [50]adduser(8). We also need
   to add /bin/false to our /etc/shells, this is the "shell" that we will
   be giving to the ftp user. This won't allow them to login, even though
   we will give them an empty password. To do this you can simply echo
d4141 2
a4142 1
   the [51]ftp(8) man page.
d4145 5
a4149 7
     * /home/ftp/bin - This directory will hold binaries that can be
       executed from within the chrooted ftpd environment. This directory
       should be mode 511. Anonymous FTP only needs ls(1) to operate
       correctly. So you need to copy /bin/ls to /home/ftp/bin.
       ~ftp/bin/ls needs to be mode 111, which is executable only.
     * /home/ftp/etc - Directory to hold user information. You should
       copy /etc/pwd.db and /etc/group to this directory. This directory
d4151 5
a4155 4
       are used to give owner names as opposed to numbers. The password
       fields in pwd.db will not be used.
     * /home/ftp/pub - This is the directory to place files in which you
       wish to share. This directory should also be mode 555.
a4164 1
dr-x--x--x  2 root  ftp    512 Jul  6 11:33 bin
a4167 6
ftp/bin:
total 178
dr-x--x--x  2 root  ftp     512 Jul  6 11:33 .
dr-xr-xr-x  5 root  ftp     512 Jul  6 11:33 ..
---x--x--x  1 root  ftp  167936 Jul  6 11:33 ls

d4184 1
a4184 1
   from [52]inetd.conf. First we must become familiar with some of the
d4220 94
a4313 2
   [53][Back to Main Index] [54][To Section 9.0 - Migrating from Linux]
   [55][To Section 11.0 - Performance Tuning]
d4316 2
a4317 2
   [56][back] [57]www@@openbsd.org
   $OpenBSD: faq10.html,v 1.31 1999/10/07 20:53:58 ericj Exp $
d4333 50
a4382 45
  13. http://www.openbsd.org/cgi-bin/man.cgi?query=su&apropos=0&sektion=1&format=html
  14. http://www.openbsd.org/cgi-bin/man.cgi?query=adduser&apropos=0&sektion=8&format=html
  15. http://www.openbsd.org/cgi-bin/man.cgi?query=sudo&sektion=8&format=html
  16. http://www.openbsd.org/cgi-bin/man.cgi?query=dump&sektion=8&format=html
  17. http://www.openbsd.org/cgi-bin/man.cgi?query=restore&sektion=8&format=html
  18. http://www.openbsd.org/cgi-bin/man.cgi?query=tar&sektion=1&format=html
  19. http://www.openbsd.org/cgi-bin/man.cgi?query=rc&sektion=8&format=html
  20. http://www.openbsd.org/cgi-bin/man.cgi?query=init&sektion=8&format=html
  21. http://www.openbsd.org/cgi-bin/man.cgi?query=rc.shutdown&sektion=8&format=html
  22. http://www.openbsd.org/cgi-bin/cvsweb/src/etc/rc.conf
  23. http://openbsd.org/faq/faq10.html#10.12
  24. http://openbsd.org/faq/faq10.html#10.6
  25. http://www.openbsd.org/cgi-bin/man.cgi?query=ssl&sektion=8&format=html
  26. http://www.openbsd.org/cgi-bin/man.cgi?query=ssl&apropos=0&sektion=8&format=html
  27. http://www.openbsd.org/cgi-bin/man.cgi?query=pwd_mkdb&sektion=8&apropos=0
  28. http://www.openbsd.org/cgi-bin/man.cgi?query=adduser&sektion=8&format=html
  29. http://www.openbsd.org/cgi-bin/man.cgi?query=adduser_proc&sektion=8&format=html
  30. http://www.openbsd.org/cgi-bin/man.cgi?query=rmuser&sektion=8&format=html
  31. http://www.openbsd.org/cgi-bin/man.cgi?query=edquota&sektion=8&format=html
  32. http://www.openbsd.org/cgi-bin/man.cgi?query=quotaon&sektion=8&format=html
  33. http://www.openbsd.org/cgi-bin/man.cgi?query=quota&sektion=1&format=html
  34. http://www.freebsd.org/handbook/kerberos.html
  35. http://web.mit.edu/kerberos/www/dialogue.html
  36. http://web.mit.edu/kerberos/www/papers.html#krb4
  37. http://www.amazon.com/exec/obidos/ASIN/0130614661/qid%3D930594963/
  38. http://www.openbsd.org/cgi-bin/man.cgi?query=krb.conf&sektion=5&format=html
  39. http://www.openbsd.org/cgi-bin/man.cgi?query=krb.realms&sektion=5&format=html
  40. http://www.openbsd.org/cgi-bin/man.cgi?query=kbd_init&sektion=8&format=html
  41. http://www.openbsd.org/cgi-bin/man.cgi?query=kstash&sektion=8&format=html
  42. http://www.openbsd.org/cgi-bin/man.cgi?query=ext_srvtab&sektion=8&format=html
  43. http://www.freebsd.org/handbook/kerberos.html#AEN4957
  44. http://www.openbsd.org/cgi-bin/man.cgi?query=kinit&sektion=1&format=html
  45. http://www.openbsd.org/cgi-bin/man.cgi?query=klist&sektion=1&format=html
  46. http://www.openbsd.org/cgi-bin/man.cgi?query=kdestroy&sektion=1&format=html
  47. http://www.monkey.org/~dugsong/ssh-afs-kerberos.html
  48. http://www.openbsd.org/cgi-bin/man.cgi?query=ftpd&sektion=8&format=html
  49. http://www.openbsd.org/cgi-bin/man.cgi?query=chroot&sektion=2&format=html
  50. http://www.openbsd.org/cgi-bin/man.cgi?query=adduser&sektion=8&format=html
  51. http://www.openbsd.org/cgi-bin/man.cgi?query=ftpd&sektion=8&format=html
  52. http://www.openbsd.org/cgi-bin/cvsweb/src/etc/inetd.conf
  53. http://openbsd.org/faq/index.html
  54. http://openbsd.org/faq/faq9.html
  55. http://openbsd.org/faq/faq11.html
  56. http://openbsd.org/faq/index.html
  57. mailto:www@@openbsd.org
d4391 1
a4391 1
     * [1]Why do I get UserDir error when running httpd?
d4393 1
d4401 1
a4401 1
   [3]http://www.openbsd.org/errata.html
d4406 1
a4406 1
   obtained here [4]http://www.openbsd.org/errata.html. This is fixed in
d4455 2
a4456 2
   [5][back] [6]www@@openbsd.org
   $OpenBSD: faq11-2.4.html,v 1.4 1999/09/24 17:50:41 ericj Exp $
d4462 5
a4466 4
   3. http://openbsd.org/errata.html#userdir
   4. http://openbsd.org/errata.html#installboot
   5. http://openbsd.org/faq/index.html
   6. mailto:www@@openbsd.org
d4600 1
a4600 3
       more about softupdates in the [15]softupdates FAQ entry. If you
       use softupdates, you will most certainly want to take advantage of
       the Tuning kmem section below.
d4604 1
a4604 22
   If you are running 2.5 (not applicable for -current or 2.6), and if
   you start using the performance tuning measures above, you may start
   running out of kernel memory. If you start getting panics like "out of
   space in kmem_map" then you need to try
   option NKMEMCLUSTERS=8192

   Note that 8192 is valid for the i386 architecture, but may be too
   little or too much for others. Look at /usr/include/machine/param.h to
   see more information.

   This change is not necessary for anyone running -current on i386 as
   this has already been cranked up from a commit on September 20th.

   If you ever get a panic "vm_map_entry_create: out of map entries", you
   may also want to increase the number of static kernel maps and
   entries. The default value for these options is architecture dependent
   and is specified in /sys/vm/vm_map.h. If you are using soft updates,
   the following values should keep you going!
   option MAX_KMAP=120
       option MAX_KMAPENT=6000

   These changes may be unnecessary for anyone running current..
d4618 1
a4618 1
   And, the price of OpenBSD can't be beat.
d4631 22
a4652 13
       Instead of buying one 20GB disk, buy multiple 4GB or 9GB disks.
       While this may cost more, distributing the load over multiple
       spindles will decrease the amount of time necessary to access data
       on the disks. And, with more spindles, you will get more
       reliability and faster data access with RAID.
     * Use SCSI where you can.
       If you are building a server, and you need more then 10GB of disk
       space, the SCSI architecture is the best choice. IDE limits you to
       two disks per controller. Wide SCSI limits you to 15 per
       controller! While SCSI costs more, the flexibility and performance
       can justify these costs. IDE was not designed for use in a
       multi-user, multi-tasking environment.
     * Use SDRAM.
d4655 3
a4657 3
       still do. Avoid SIMMs, as there are not many companies
       manufacturing them anymore, and in some cases they cost more then
       equivalent SDRAM!
d4681 9
d4702 1
a4702 1
   the stability of the system. Check the manpage for [16]mount(8)."
d4718 1
a4718 1
   [17][to Section 12.0 - For Advanced Users] [18][To Section 10.0 -
d4722 2
a4723 2
   [19][back] [20]www@@openbsd.org
   $OpenBSD: faq11.html,v 1.4 1999/10/10 18:21:19 chris Exp $
d4742 6
a4747 5
  16. http://www.openbsd.org/cgi-bin/man.cgi?query=mount&apropos=0&sektion=8&format=html
  17. http://openbsd.org/faq/faq12.html
  18. http://openbsd.org/faq/faq10.html
  19. http://openbsd.org/faq/index.html
  20. mailto:www@@openbsd.org
a4887 2
                          13.0 - IP Security Protocol

d4894 14
a4907 9
     * [6]What is IPSec?
     * [7]That's nice, but why do I want to use IPSec?
     * [8]What are the protocols behind IPSec?
     * [9]On the wire format
     * [10]How do I setup IPSec with manual keying?
     * [11]How do I setup IPSec with isakmpd/IKE?
     * [12]What IKE clients are compatible with isakmpd?
     * [13]Troubleshooting IPSec/VPN
     * [14]Related Documentation
d4916 5
a4920 2
   powerful (they don't have to have any knowledge of IPSec.) Also see
   [15]RFC 2401.
d4923 2
a4924 2
   the "recommended reading" of [16]part 6 of the FAQ. In particular, if
   you don't already understand it, the [17]Understanding IP Addressing
d4932 3
a4934 3
   Of course, in every scenario that involves a network, we mean to imply
   router. As in, Host-to-Router (and this router controls and encrypts
   traffic for a particular Network.)
d4977 3
a4979 3
   later. WARNING: as per the standards specification, replay protection
   is not performed when using manual-keyed IPsec (e.g., when using
   [18]ipsecadm(8)).
d4994 1
a4994 1
   follows the IP header). Replay protection requires authentication and
d5002 5
a5006 5
   contains cryptographically secured Hashes of the data and
   Identification information. The hashes can also cover the invariant
   parts of the IP header itself. There are several differnt RFCs giving
   a choice of actual algorythms to use in the AH, however they all must
   follow the guidlines specified in [19]RFC2402.
d5010 1
a5010 1
   fields of the IP header before it and therefore amkes no guarantees
d5012 1
a5012 1
   must follow [20]RFC2406. An ESP header can also provide Authentication
d5036 1
a5036 1
   covering trafic distiguishable by some unique selector. All traffic
d5040 8
a5047 8
   particular SA by the three defining fields, (Destination IPaddess,
   Security Paramiter Index, Security protocol) SPI can be considered a
   cookie that is handed out by the reciever of the SA when the
   parameters of the connection are negotiated. and the protocol must be
   either AH or ESP. Since the IP address of the reciever is part of the
   tripple, this is a guaranteed unique value. They can be found from the
   outer IP header and the first security header (which contains the SPI
   and the protocol).
d5051 1
a5051 1
   [IPHDR][IPoptions][AH][IPHDR2][IPoptions][TCP][data]
d5055 1
a5055 1
   [IPHDR][IPoptions][AH][TCP][data]
d5060 1
a5060 1
   [IPHDR][IPoptions][AH][ESP][TCP][data]
d5065 1
a5065 1
   [IPHDR][IPoptions][AH][ESP][IPHDR2][IPoptions][TCP][data]
d5067 3
a5069 3
   However it is not specifically mentionned in the RFC. As with
   Transport adjacency, this would authenticate the entire packet except
   a few headers in the IP header and also encrypt the payload, (seen in
d5075 1
a5075 1
   Administrative Interface. (Sample implementation)
d5079 1
a5079 1
   as to how this should be implemented, so as to minimise confusion.
d5082 3
a5084 3
   packet. One is the Security Association Batabase (SAD) and the other
   is the Security Policy Database (SPD). Each interface supporting IPSec
   should have a logically separate SAD and SPD.
d5088 2
a5089 2
   needed. however the SPD is two steps removed from the actual
   processing. The SPD is used for outgoing packets, to decide what SAD
d5092 9
a5100 9
   already created SAD entries to use (if it's a bundle there can be more
   than 1), but if there is not already a suitable one, it is used to
   create new ones. The fields of the SA being created can be taken
   either from the SPD entry or from the packet that initialted the
   creation.

   Outgoing packets go from the SPD entry tothe specific SA, to get
   encoding parameters. Incoming packates get to the correct SA directly
   using the SPI/DEST/Proto tripple, and from there get to the SPD entry.
d5111 1
a5111 1
   hostnames, security sensitivity levels, protocols etc.
d5113 1
a5113 1
   An SAD entry would include:
d5115 1
a5115 1
     * Ipsec proto (SA or ESP)
d5117 1
a5117 1
     * Sequnce counter
d5119 1
a5119 1
     * anti-replay window info
d5123 1
a5123 1
     * tunnel/transport mode flags
d5126 2
a5127 2
   An SPD entry would contain:
     * pointer to active SAs
d5130 15
a5144 12
   Each SA can define one ESP header and one AH header. so an IPSec
   session must have one or the other or both, but cannot be defined with
   neither, otherwise there would be no headers to specify the SPI to
   look up the SA. The RFC doesn't say what would happen if the AH and
   ESP headers dissagree about the SPI value. One would presume this
   would imply multiple SA's in a bundle.

   These values and SAD entries should be addable by hand by some
   (implementation dependent) interface, however the IETF has also
   defined automatic mechanisms for initialisation of sessions and such
   things as key exchange. These are defined in [21]RFC2407, [22]RFC2408,
   and [23]RFC2409
d5146 1
a5146 1
                13.5 - How do I setup IPSec with manual keying?
d5151 1
a5151 1
   [24]/usr/share/ipsec/rc.vpn to set this up for you automatically.
d5154 6
a5159 2
   kernel. (If you are only using ESP, such as the rc.vpn script, then
   you do not need to enable AH.) There is a nice sysctl to do this.
d5169 9
a5177 7
   security protocol (AH and/or ESP.) The IP addresses are that of both
   your own and your destination. The SPI, or Security Parameter Index,
   is a number that OpenBSD uses to classify different SAs.

   These examples only use ESP to encrypt your traffic. They do not
   provide authentication through AH, but that's OK, because ESP
   authenticates its own data.
d5198 1
a5198 1
   Notice that the SPIs are different. See [25]On the wire format for a
d5209 5
a5213 4
   So, right here, *two* flows will be created, one with 0.0.0.0/32 as
   the source address, which covers all packets originating from the
   local host to the destination, as well as a flow from the destination
   back to the local host.
d5223 5
a5227 4
   -forcetunnel tunnels all traffic in a separate ESP/IP packet). If
   either the source or destination is a network, you will have to use
   tunnel mode. Creating an SA to and/or from a network will
   automatically ensure tunnel mode SPIs are being created.
d5234 1
a5234 1
   behind 208.2.2.2. These examples were generated using the [26]rc.vpn
d5237 3
a5239 2
   As you can see, with IPSec, you have to specify exactly what you want
   done. It won't guess for you. Look at these examples...
d5325 1
a5325 1
   This will flush all "IPSec info" (SPIs, flows, routing entries) from
d5328 44
a5371 1
                 13.6 - How do I setup IPSec with isakmpd/IKE?
d5376 3
a5378 2
   they require you to use some form of ISAKMP. Unfortunately, this FAQ
   isn't complete yet, certainly not section 13.6.
d5380 1
a5380 1
             13.7 - What IKE clients are compatible with isakmpd?
d5382 5
a5386 5
   Isakmpd is the ISAKMP/Oakley key management daemon that comes with
   OpenBSD. We suspect that it interoperates with most any ISAKMP
   implementation, but the following have actually been tested. Note that
   some isakmp software out there is actually based on the OpenBSD isakmp
   daemon.
d5389 5
a5393 5
     * [27]TimeStep PERMIT/Client
     * [28]Ashley Laurent VPCom VPN software
     * [29]PGP VPN software
     * [30]Radguard cIPro client
     * [31]Cisco Win32 client
d5397 14
a5410 14
     * [32]Cisco IOS IPSec
     * [33]Cisco PIX
     * [34]Intel LanRover
     * [35]TimeStep PERMIT/Gate
     * [36]Cendio Fuego
     * [37]KAME for FreeBSD
     * [38]FreeS/WAN for Linux
     * [39]Axent Raptor
     * [40]Ericsson eBox
     * [41]Radguard cIPro-VPN
     * [42]F-Secure (previously Datafellows) VPN+
     * [43]Teamware TWISS
     * [44]3com Pathbuilder
     * [45]Nortel Contivity
d5412 1
a5412 1
                       13.8 - Troubleshooting IPSec/VPN
d5414 1
a5414 1
   Your first tool for troubleshooting IPSec is [46]tcpdump(8). Use
d5426 1
a5426 1
       [47]ping(8) to generate simple traffic.
d5454 1
a5454 1
       this for an older version of tcpdump, contact [48]ho@@openbsd.org.
d5462 1
a5462 1
     * Finally, you can use [49]netstat(1) to see your SAs.
d5478 1
a5478 1
       for warnings or errors, and report them using [50]sendbug(1) to
d5480 2
a5481 2
       actually ran into a bug, you may want to send a message to one of
       the [51]mailing lists.
d5483 1
a5483 1
                         13.9 - Related Documentation
d5485 15
a5499 5
   IPSec is partially documented in the [52]vpn(8) man page. There are
   various configuration templates in [53]/usr/share/ipsec/ directory
   which can also assist you. The manual pages for [54]ipsec(4),
   [55]ipsecadm(8), [56]photurisd(8), [57]startkey(1), [58]isakmpd(8) and
   [59]isakmpd.conf(5) can help if you are using any of these components!
d5502 11
a5512 8
     * [60]RFC 2207 - RSVP Extensions for IPSec Data Flows
     * [61]RFC 2401 - Security Architecture for the Internet Protocol
     * [62]RFC 2402 - IP Authentication Header (AH)
     * [63]RFC 2403 - The Use of HMAC-MD5-96 within ESP and AH
     * [64]RFC 2404 - The Use of HMAC-SHA-1-96 within ESP and AH
     * [65]RFC 2405 - The ESP DES-CBC Cipher Algorithm With Explicit IV
     * [66]RFC 2406 - IP Encapsulating Security Payload (ESP)
     * [67]RFC 2407 - The Internet IP Security Domain of Interpretation
d5514 1
a5514 1
     * [68]RFC 2408 - Internet Security Association and Key Management
d5516 2
a5517 2
     * [69]RFC 2409 - The Internet Key Exchange (IKE)
     * [70]RFC 2410 - The NULL Encryption Algorithm and Its Use With
d5519 6
a5524 3
     * [71]RFC 2411 - IP Security Document Roadmap
     * [72]RFC 2412 - The OAKLEY Key Determination Protocol
     * [73]RFC 2709 - Security Model with Tunnel-mode IPsec for NAT
d5527 2
a5528 2
   [74][Back to Main Index] [75][To Section 12.0 - For Advanced Users]
   [76][To Section 14.0 - Using disks in OpenBSD]
d5531 2
a5532 2
   [77][back] [78]www@@openbsd.org
   $OpenBSD: faq13.html,v 1.9 1999/10/18 22:08:33 chris Exp $
d5550 20
a5569 20
  15. http://www.cis.ohio-state.edu/htbin/rfc/rfc2401.html
  16. http://openbsd.org/faq/faq6.html
  17. http://www.3com.com/nsc/501302s.html
  18. http://www.openbsd.org/cgi-bin/man.cgi?query=ipsecadm&apropos=0&sektion=8&format=html
  19. http://www.cis.ohio-state.edu/htbin/rfc/rfc2402.html
  20. http://www.cis.ohio-state.edu/htbin/rfc/rfc2406.html
  21. http://www.cis.ohio-state.edu/htbin/rfc/rfc2407.html
  22. http://www.cis.ohio-state.edu/htbin/rfc/rfc2408.html
  23. http://www.cis.ohio-state.edu/htbin/rfc/rfc2409.html
  24. http://www.openbsd.org/cgi-bin/cvsweb/src/share/ipsec/rc.vpn?rev=1.3
  25. http://openbsd.org/faq/faq13.html#13.4
  26. http://www.openbsd.org/cgi-bin/cvsweb/src/share/ipsec/rc.vpn?rev=1.3
  27. http://www.timestep.com/
  28. http://www.vpcom.com/
  29. http://www.nai.com/asp_set/products/tns/pgp_vpn.asp
  30. http://www.radguard.com/
  31. http://www.cisco.com/
  32. http://www.cisco.com/
  33. http://www.cisco.com/
  34. http://www.intel.com/
d5571 64
a5634 43
  36. http://www.cendio.com/
  37. http://www.kame.net/
  38. http://www.xs4all.nl/~freeswan/
  39. http://www.axent.com/
  40. http://www.ericsson.com/
  41. http://www.radguard.com/
  42. http://www.f-secure.com/
  43. http://www.teamware.com/
  44. http://www.3com.com/
  45. http://www.nortelnetworks.com/
  46. http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&apropos=0&sektion=8&format=html
  47. http://www.openbsd.org/cgi-bin/man.cgi?query=ping&apropos=0&sektion=8&format=html
  48. mailto:ho@@openbsd.org
  49. http://www.openbsd.org/cgi-bin/man.cgi?query=netstat&apropos=0&sektion=1&format=html
  50. http://www.openbsd.org/cgi-bin/man.cgi?query=sendbug&apropos=0&sektion=1&format=html
  51. http://openbsd.org/mail.html
  52. http://www.openbsd.org/cgi-bin/man.cgi?query=vpn&apropos=0&sektion=0&format=html
  53. http://www.openbsd.org/cgi-bin/cvsweb/src/share/ipsec/
  54. http://www.openbsd.org/cgi-bin/man.cgi?query=ipsec&apropos=0&sektion=4&format=html
  55. http://www.openbsd.org/cgi-bin/man.cgi?query=ipsecadm&apropos=0&sektion=8&format=html
  56. http://www.openbsd.org/cgi-bin/man.cgi?query=photurisd&apropos=0&sektion=8&format=html
  57. http://www.openbsd.org/cgi-bin/man.cgi?query=startkey&apropos=0&sektion=1&format=html
  58. http://www.openbsd.org/cgi-bin/man.cgi?query=isakmpd&apropos=0&sektion=8&format=html
  59. http://www.openbsd.org/cgi-bin/man.cgi?query=isakmpd.conf&apropos=0&sektion=5&format=html
  60. http://www.cis.ohio-state.edu/htbin/rfc/rfc2207.html
  61. http://www.cis.ohio-state.edu/htbin/rfc/rfc2401.html
  62. http://www.cis.ohio-state.edu/htbin/rfc/rfc2402.html
  63. http://www.cis.ohio-state.edu/htbin/rfc/rfc2403.html
  64. http://www.cis.ohio-state.edu/htbin/rfc/rfc2404.html
  65. http://www.cis.ohio-state.edu/htbin/rfc/rfc2405.html
  66. http://www.cis.ohio-state.edu/htbin/rfc/rfc2406.html
  67. http://www.cis.ohio-state.edu/htbin/rfc/rfc2407.html
  68. http://www.cis.ohio-state.edu/htbin/rfc/rfc2408.html
  69. http://www.cis.ohio-state.edu/htbin/rfc/rfc2409.html
  70. http://www.cis.ohio-state.edu/htbin/rfc/rfc2410.html
  71. http://www.cis.ohio-state.edu/htbin/rfc/rfc2411.html
  72. http://www.cis.ohio-state.edu/htbin/rfc/rfc2412.html
  73. http://www.cis.ohio-state.edu/htbin/rfc/rfc2709.html
  74. http://openbsd.org/faq/index.html
  75. http://openbsd.org/faq/faq12.html
  76. http://openbsd.org/faq/faq14.html
  77. http://openbsd.org/faq/index.html
  78. mailto:www@@openbsd.org
d5648 2
a5649 2
     * [6]14.6 - When I boot after installation of OpenBSD/i386, it says
       "partition 3 id 0".
d5679 1
a5679 2
   partitions available for other OSs! (eg. 'swap', '/', '/usr' and
   '/var'). And you still have 3 more partitions available for other OSs!
d6021 6
a6026 4
   With OpenBSD 2.5 came the introduction of [22]swapctl(8), which made
   dealing with swap devices much easier. Swapping to a file doesn't
   require a custom built kernel, although that can still be done, this
   faq will show you how to add swap space both ways.
d6139 2
a6140 2
14.6 - When I boot after installation of OpenBSD/i386, it says "partition 3 id
0".
d6143 24
a6166 5
   properly or that your BIOS is not compatible with your current MBR. To
   solve this first try to reinstall the OpenBSD boot blocks. To do so
   use [27]installboot(8). For example, the most common usage is:

     * Boot from the OpenBSD bootdisk
d6168 1
a6168 8
     * # fsck /dev/rwd0a && mount /dev/wd0a /mnt
     * # cp /usr/mdec/boot /mnt/boot
     * # /usr/mdec/installboot -v /mnt/boot /usr/mdec/biosboot wd0

     Here substitute your disk devices for rwd0a & wd0a. This will
   install the boot blocks again.

     Then Reboot.
d6174 1
a6174 2
   from any of the OpenBSD ftp sites.

d6177 2
a6178 2
   and take some time to look through the web pages at
   [28]http://www.prz.tu-berlin.de/~wolf/os-bs.html
d6190 1
a6190 1
   For further instructions read [29]INSTALL.linux
d6202 1
a6202 1
   Also check with [30]section 4.7
d6245 1
a6245 1
   [31][Back to Main Index] [32][To Section 13.0 - IPsec]
d6248 2
a6249 2
   [33][back] [34]www@@openbsd.org
   $OpenBSD: faq14.html,v 1.7 1999/10/15 16:18:23 ericj Exp $
d6279 9
a6287 8
  27. http://www.openbsd.org/cgi-bin/man.cgi?query=installboot&sektion=8&format=html
  28. http://www.prz.tu-berlin.de/~wolf/os-bs.html
  29. http://openbsd.org/faq/INSTALL.linux
  30. http://openbsd.org/faq/faq4.html#4.7
  31. http://openbsd.org/faq/index.html
  32. http://openbsd.org/faq/faq13.html
  33. http://openbsd.org/faq/index.html
  34. mailto:www@@openbsd.org
d7031 1
a7031 1
   $OpenBSD: upgrade-minifaq.html,v 1.8 1999/10/02 03:08:12 ericj Exp $
@


1.16
log
@update
@
text
@d47 1
d49 1
a49 1
   Any questions can be directed to: [21]faq@@openbsd.org
d52 3
a54 3
   [22]Eric Jackson
   [23]Wim Vandeputte
   [24]Chris Cappuccio
d57 1
a57 1
   $OpenBSD: index.html,v 1.80 1999/10/07 03:47:10 ericj Exp $
d81 5
a85 4
  21. mailto:faq@@openbsd.org
  22. mailto:ericj@@openbsd.org
  23. mailto:wvdputte@@openbsd.org
  24. mailto:chris@@openbsd.org
d353 2
a354 1
   [11]http://www.monkey.org/cgi-bin/wilma . This website contains
d358 1
a358 1
   [12]openbsd-mobile@@monkey.org. This mailing list is a discussion of
d366 1
a366 1
   [13]http://www.monkey.org/openbsd-mobile/archive/
d377 8
a384 8
     * [14]afterboot(8) - things to check after the first complete boot
     * [15]boot(8) - system boot strapping procedures
     * [16]passwd.conf(5) - format of the password configuration file
     * [17]adduser_proc(8) - procedure for adding new users
     * [18]adduser(8) - command for adding new users
     * [19]vipw(8) - edit the pass word file
     * [20]man(1) - display the on-line manual pages
     * [21]sendbug(1) - send a problem report (PR) about OpenBSD to a
d386 7
a392 7
     * [22]disklabel(8) - Read and write disk pack label.
     * [23]ifconfig(8) - configure network interface parameters.
     * [24]route(8) - manually manipulate the routing tables.
     * [25]netstat(1) - show network status.
     * [26]reboot, halt(8) - Stopping and restarting the system.
     * [27]shutdown(8) - close down the system at a given time.
     * [28]boot_config(8) - how to change kernel configuration at boot
d396 1
a396 1
   [29]http://www.openbsd.org/cgi-bin/man.cgi.
d459 1
a459 1
   tree unformatted, and many times thru the use of [30]CVS, they will be
d475 1
a475 1
   program like gv (GhostView). GhostView can be found in our [31]Ports
d482 1
a482 1
   [32]http://www.openbsd.org/report.html
d569 3
a571 3
       [33]http://cvs.openbsd.org/cgi-bin/wwwgnats.pl.
     * Look in the [34]bugs@@openbsd.org list archives:
       [35]http://www.openbsd.org/mail.html.
d573 2
a574 2
   [36][Back to Main Index] [37][To Section 1.0 - Introduction to
   OpenBSD] [38][To Section 3.0 - Obtaining OpenBSD]
d577 2
a578 2
   [39][back] [40]www@@openbsd.org
   $OpenBSD: faq2.html,v 1.20 1999/10/07 03:47:10 ericj Exp $
d593 30
a622 29
  12. mailto:openbsd-mobile@@monkey.org
  13. http://www.monkey.org/openbsd-mobile/archive/
  14. http://www.openbsd.org/cgi-bin/man.cgi?query=afterboot&apropos=0&sektion=8&format=html
  15. http://www.openbsd.org/cgi-bin/man.cgi?query=boot&apropos=0&sektion=8&format=html
  16. http://www.openbsd.org/cgi-bin/man.cgi?query=passwd.conf&apropos=0&sektion=5&format=html
  17. http://www.openbsd.org/cgi-bin/man.cgi?query=adduser_proc&apropos=0&sektion=8&format=html
  18. http://www.openbsd.org/cgi-bin/man.cgi?query=adduser&apropos=0&sektion=8&format=html
  19. http://www.openbsd.org/cgi-bin/man.cgi?query=vipw&apropos=0&sektion=8&format=html
  20. http://www.openbsd.org/cgi-bin/man.cgi?query=man&apropos=0&sektion=1&format=html
  21. http://www.openbsd.org/cgi-bin/man.cgi?query=sendbug&apropos=0&sektion=1&format=html
  22. http://www.openbsd.org/cgi-bin/man.cgi?query=disklabel&apropos=0&sektion=8&format=html
  23. http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&apropos=0&sektion=8&format=html
  24. http://www.openbsd.org/cgi-bin/man.cgi?query=route&apropos=0&sektion=8&format=html
  25. http://www.openbsd.org/cgi-bin/man.cgi?query=netstat&apropos=0&sektion1&format=html
  26. http://www.openbsd.org/cgi-bin/man.cgi?query=reboot&apropos=0&sektion=8&format=html
  27. http://www.openbsd.org/cgi-bin/man.cgi?query=shutdown&apropos=0&sektion=8&format=html
  28. http://www.openbsd.org/cgi-bin/man.cgi?query=boot_config&apropos=0&sektion=8&format=html
  29. http://www.openbsd.org/cgi-bin/man.cgi
  30. http://openbsd.org/faq/faq8.html#8.5
  31. http://openbsd.org/ports.html
  32. http://openbsd.org/report.html
  33. http://cvs.openbsd.org/cgi-bin/wwwgnats.pl
  34. mailto:bugs@@openbsd.org
  35. http://www.openbsd.org/mail.html
  36. http://openbsd.org/faq/index.html
  37. http://openbsd.org/faq/faq1.html
  38. http://openbsd.org/faq/faq3.html
  39. http://openbsd.org/faq/index.html
  40. mailto:www@@openbsd.org
d1443 4
d1450 1
a1450 1
   [8]Understanding IP addressing. This is an excellent document.
a1453 4
   For the bulk of this document, it helps if you have read and at least
   partially understand the [9]Kernel Configuration and Setup section of
   the FAQ, and the [10]ifconfig(8) and [11]netstat(1) man pages.

d1564 1
a1564 1
   Here ne2 is assigned another IP number (remember it already has
d1695 16
a1710 16
     * [24]1.0 Introduction
          + [25]1.1 Purpose
          + [26]1.2 Terminology
          + [27]1.3 Configuration
     * [28]2.0 Network Address Translation
          + [29]2.1 Introduction to Network Address Translation
          + [30]2.2 Why to use Network Address Translation
          + [31]2.3 Setup
          + [32]2.4 Configuration
          + [33]2.5 Running
     * [34]3.0 Network Address Translation Knowledge Base
          + [35]3.1 Checking NAT status
          + [36]3.2 Limitations of NAT (in FTP)
          + [37]3.3 Redirecting Traffic
          + [38]3.4 Network Address Translation versus Proxy
     * [39]4.0 Links and X-References
d1713 1
a1713 1
  1.0 Introduction
d1751 7
a1757 5
       This is short for "IP Filter." IP Filter is the daemon which ipnat
       piggy-backs on. You can set up IP Filtering on your machine to
       also act as a network firewall, however that is beyond the scope
       of this document. However, you can see more information on IPF at
       [42]FAQ 6.2.
d1767 1
a1767 1
   NetGear 10/100MB ("/dev/pn0")
d1771 1
a1771 1
       NetGear 10/100MB ("/dev/pn1")
d1776 2
a1777 1
   Cable Modem IP (provided by ISP)
d1783 7
a1789 6
   Machines on the LAN use the IP addressing scheme 192.168.1.xxx (where
       xxx is a unique number). There are a variety of different
       operating systems on the internal LAN including Windows 98,
       Windows NT, OpenBSD and Linux. Each machine is connected to a hub
       that is designated for internal use. For this document and its
       examples the client on the LAN will assume IP address 192.168.1.40
d1807 1
a1807 1
  2.0 Network Address Translation
d1859 3
a1861 1
   to setting up a proxy server, to setting up NAT.
d1864 4
a1867 6
   reason is for saving money. My ISP charges (at the date above) $7 per
   month more per IP address you want bound to your cable modem. There
   are two roommates in my house (each with their own PC) and myself with
   3 computers. My ISP only allows for three IP addresses per household.
   This means that there weren't enough IPs to allow every machine
   internet access.
d1896 1
a1896 1
   Again for more information you can read [43]FAQ 6.2
d1901 1
a1901 1
map pn0 192.168.1.0/24 -> 24.5.0.5/32 portmap tcp/udp 10000:20000
d1921 5
a1925 1
       addresses will be mapped to.
d1927 1
a1927 1
   "portmap tcp/udp 10000:20000"
d1929 1
a1929 1
       20000.
d1932 4
a1935 3
   This tells ipnat to map anything else (not tcp/udp) to whatever port
   it requests (used for unknown protocols and bypassing ipnat). Once
   this is in the file, all that's needed is to run the IPF daemon.
d1963 1
a1963 1
  Nat Knowledge Base
d1971 1
a1971 1
map pn0 192.168.1.0/24 -> 24.5.0.5/32 portmap tcp/udp 10000:20000
d2038 3
a2040 2
   handle this. Add the following line to the file:
rdr pn0 0.0.0.0/0 port 80 -> 192.168.1.80 port 80
d2050 3
a2052 3
   "0.0.0.0/0"
       This IP address and netmask state 'any packet crossing the device
       pn0'
d2071 15
a2085 11
   The difference between NAT and proxy is that proxy acts and declares
   itself as a "middle-man" between the Internet and the machines
   connected on the LAN. This is fine, however each application you want
   to run on your machine and connect to the Internet through the proxy
   server MUST be proxy-aware (be able to use a proxy server). Not all
   applications are able to do this (especially games). NAT does the
   middle-man tasks transparently to the end-user and the user's
   applications. In most cases this is preferred, but in some cases this
   can be a problem. The main problem is within FTP (see [44]"NAT
   Limitations" in the Knowledge Base).
   Links and X-References
d2094 3
a2096 3
     * [45]http://www.openbsd.org/cgi-bin/man.cgi?query=ipnat&sektion=8
     * [46]http://coombs.anu.edu.au/ipfilter/
     * [47]http://www.geektools.com/rfc/rfc1631.txt
d2100 3
a2102 1
   To use the DHCP client [48]dhclient(8) included with OpenBSD, edit
d2112 20
a2131 1
   If you want to use OpenBSD as a DHCP server [49]dhcpd(8), edit
d2156 15
d2175 2
a2176 2
     * [50]pppd(8) - Which is the kernel ppp daemon.
     * [51]ppp(8) - Which is the userland ppp daemon.
d2187 1
a2187 1
   your ppp. The userland PPP daemon uses the file [52]/etc/ppp/ppp.conf
d2215 1
a2215 1
   logging levels. This can be changed, refer to [53]ppp(8) for more info
d2290 2
a2291 2
     * [54]ppp.linkup
     * [55]ppp.linkdown
d2320 1
a2320 1
   net.inet.ip.directed-broadcast=1 turns this on. Read about [56]smurf
d2325 1
a2325 1
   There is a sysctl for this also. From [57]sysctl(8):
d2338 2
a2339 2
   [58][Back to Main Index] [59][To Section 5.0 - Kernel configuration
   and Disk Setup] [60][To Section 7.0 - Keyboard controls]
d2342 2
a2343 2
   [61][back] [62]www@@openbsd.org
   $OpenBSD: faq6.html,v 1.34 1999/10/07 05:56:04 chris Exp $
d2354 4
a2357 4
   8. http://www.3com.com/nsc/501302s.html
   9. http://openbsd.org/faq/faq5.html
  10. http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&apropos=0&sektion=8&format=html
  11. http://www.openbsd.org/cgi-bin/man.cgi?query=netstat&apropos=0&sektion=1&format=html
d2367 1
a2367 1
  21. http://cheops.anu.edu.au/~avalon/ip-filter.html
d2389 19
a2407 20
  43. http://openbsd.org/faq/faq6.html#6.2
  44. http://openbsd.org/faq/faq6.html#3.2
  45. http://www.openbsd.org/cgi-bin/man.cgi?query=ipnat&sektion=8
  46. http://coombs.anu.edu.au/ipfilter/
  47. http://www.geektools.com/rfc/rfc1631.txt
  48. http://www.openbsd.org/cgi-bin/man.cgi?query=dhclient&apropos=0&sektion=8&format=html
  49. http://www.openbsd.org/cgi-bin/man.cgi?query=dhcpd&apropos=0&sektion=8&format=html
  50. http://www.openbsd.org/cgi-bin/man.cgi?query=pppd&sektion=8&format=html
  51. http://www.openbsd.org/cgi-bin/man.cgi?query=ppp&sektion=8&format=html
  52. http://www.openbsd.org/cgi-bin/cvsweb/src/etc/ppp/ppp.conf.sample
  53. http://www.openbsd.org/cgi-bin/man.cgi?query=ppp&sektion=8&format=html
  54. http://www.openbsd.org/cgi-bin/cvsweb/src/etc/ppp/ppp.linkup.sample
  55. http://www.openbsd.org/cgi-bin/cvsweb/src/etc/ppp/ppp.linkdown.sample
  56. http://www.netscan.org/
  57. http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&apropos=0&sektion=8&format=html
  58. http://openbsd.org/faq/index.html
  59. http://openbsd.org/faq/faq5.html
  60. http://openbsd.org/faq/faq7.html
  61. http://openbsd.org/faq/index.html
  62. mailto:www@@openbsd.org
d2981 31
d3067 1
a3067 1
   $OpenBSD: faq8.html,v 1.32 1999/09/24 01:46:14 ericj Exp $
d3284 2
a3285 2
     * [3]10.3 - How do I get daemons like httpd and sendmail to start up
       with the system?
d3331 1
a3331 1
10.3 - How do I get httpd, sendmail, etc to startup with the system?
d3333 64
a3396 15
   OpenBSD uses rc-style startup to control starting applications with
   the system. For common daemons you can simply edit [19]/etc/rc.conf.
   For example: To have ftpd started at boot time, change the ftpd entry
   from:
   ftpd_flags=NO

   to:
   ftpd_flags="-D"

   You can add any flags that you wish ftpd to start with.

   If you have your own daemons that you want to be started, here is a
   simple entry that you can put into /etc/rc.local.
if [ -x /usr/local/sbin/mydaemon ]; then
        echo -n ' mydaemon';       /usr/local/sbin/mydaemon
d3399 11
a3409 1
   Once in there, it will come up with the system each time.
d3476 1
a3476 1
   The steps shown here are taken in part from the [20]ssl(8) man page.
d3510 1
a3510 1
   /etc/passwd dynamically with [21]pwd_mkdb(8). The main password file
d3538 1
a3538 1
   The best way to add a user in OpenBSD is to use the [22]adduser(8)
d3545 1
a3545 1
   further instructions on adding users read the [23]adduser_proc(8) man
d3548 1
a3548 1
   To delete users you should use the [24]rmuser(8) utility. This will
d3585 1
a3585 1
   [25]edquota(8). A simple use is just edquota <user>. edquota(8) will
d3609 1
a3609 1
   this use [26]quotaon(8). For example:
d3614 1
a3614 1
   [27]quota(1). Using a command of quota <user> will give that users
d3648 1
a3648 1
     * [28]The FreeBSD handbook
d3650 2
a3651 2
     * [29]Designing an Authentication System: a Dialogue in Four Scenes
     * [30]Papers and Documentation Describing KerberosIV
d3654 1
a3654 1
     * [31]Network Security Private Communication in a Public World
d3672 1
a3672 1
   krb.realms. For more information on this refer to [32]krb.conf.
d3683 1
a3683 1
   Again, for further information read the [33]krb.realms. man page.
d3685 1
a3685 1
   Next we will run [34]kdb_init(8) to create the initial Kerberos
d3696 1
a3696 1
   Next we need to use [35]kstash(8) which is used to save the Kerberos
d3766 1
a3766 1
   command line, [36]ext_srvtab(8) creates the service key file
d3832 1
a3832 1
   privileges to a specific principal, see [37]the FreeBSD Handbook.
d3852 1
a3852 1
   you use [38]kinit(1).
d3859 1
a3859 1
   Now we have identified we can list our tickets with [39]klist(1).
d3888 1
a3888 1
   [40]kdestroy(1). For example:
d3898 1
a3898 1
   If you want ticket passing, use Dug Song's [41]krb4 SSH patches. Stock
d3915 2
a3916 2
   the [42]ftp(8) and [43]chroot(2) man pages. Here is an example of
   adding the ftp user. I will do this using [44]adduser(8). We also need
d3961 1
a3961 1
   the [45]ftp(8) man page.
d4011 1
a4011 1
   from [46]inetd.conf. First we must become familiar with some of the
d4047 2
a4048 2
   [47][Back to Main Index] [48][To Section 9.0 - Migrating from Linux]
   [49][To Section 11.0 - Performance Tuning]
d4051 2
a4052 2
   [50][back] [51]www@@openbsd.org
   $OpenBSD: faq10.html,v 1.30 1999/09/24 01:46:13 ericj Exp $
d4074 39
a4112 33
  19. http://www.openbsd.org/cgi-bin/cvsweb/src/etc/rc.conf?rev=1.35
  20. http://www.openbsd.org/cgi-bin/man.cgi?query=ssl&apropos=0&sektion=8&format=html
  21. http://www.openbsd.org/cgi-bin/man.cgi?query=pwd_mkdb&sektion=8&apropos=0
  22. http://www.openbsd.org/cgi-bin/man.cgi?query=adduser&sektion=8&format=html
  23. http://www.openbsd.org/cgi-bin/man.cgi?query=adduser_proc&sektion=8&format=html
  24. http://www.openbsd.org/cgi-bin/man.cgi?query=rmuser&sektion=8&format=html
  25. http://www.openbsd.org/cgi-bin/man.cgi?query=edquota&sektion=8&format=html
  26. http://www.openbsd.org/cgi-bin/man.cgi?query=quotaon&sektion=8&format=html
  27. http://www.openbsd.org/cgi-bin/man.cgi?query=quota&sektion=1&format=html
  28. http://www.freebsd.org/handbook/kerberos.html
  29. http://web.mit.edu/kerberos/www/dialogue.html
  30. http://web.mit.edu/kerberos/www/papers.html#krb4
  31. http://www.amazon.com/exec/obidos/ASIN/0130614661/qid%3D930594963/
  32. http://www.openbsd.org/cgi-bin/man.cgi?query=krb.conf&sektion=5&format=html
  33. http://www.openbsd.org/cgi-bin/man.cgi?query=krb.realms&sektion=5&format=html
  34. http://www.openbsd.org/cgi-bin/man.cgi?query=kbd_init&sektion=8&format=html
  35. http://www.openbsd.org/cgi-bin/man.cgi?query=kstash&sektion=8&format=html
  36. http://www.openbsd.org/cgi-bin/man.cgi?query=ext_srvtab&sektion=8&format=html
  37. http://www.freebsd.org/handbook/kerberos.html#AEN4957
  38. http://www.openbsd.org/cgi-bin/man.cgi?query=kinit&sektion=1&format=html
  39. http://www.openbsd.org/cgi-bin/man.cgi?query=klist&sektion=1&format=html
  40. http://www.openbsd.org/cgi-bin/man.cgi?query=kdestroy&sektion=1&format=html
  41. http://www.monkey.org/~dugsong/ssh-afs-kerberos.html
  42. http://www.openbsd.org/cgi-bin/man.cgi?query=ftpd&sektion=8&format=html
  43. http://www.openbsd.org/cgi-bin/man.cgi?query=chroot&sektion=2&format=html
  44. http://www.openbsd.org/cgi-bin/man.cgi?query=adduser&sektion=8&format=html
  45. http://www.openbsd.org/cgi-bin/man.cgi?query=ftpd&sektion=8&format=html
  46. http://www.openbsd.org/cgi-bin/cvsweb/src/etc/inetd.conf
  47. http://openbsd.org/faq/index.html
  48. http://openbsd.org/faq/faq9.html
  49. http://openbsd.org/faq/faq11.html
  50. http://openbsd.org/faq/index.html
  51. mailto:www@@openbsd.org
d4347 2
a4348 1
   You may also want to increase the number of static kernel maps and
d4456 1
a4456 1
   $OpenBSD: faq11.html,v 1.3 1999/09/29 22:57:42 ericj Exp $
d4617 2
a4618 2
13.0 - Using IPsec in OpenBSD
     _________________________________________________________________
d4620 1
a4620 3
   Table of Contents
     * [1]IPsec
     _________________________________________________________________
d4622 513
a5134 5
   IPSec is partially documented in the [2]vpn(8) man page. There are
   various files in [3]/usr/share/ipsec/ directory which can also assist
   you. The manual pages for [4]ipsec(4), [5]ipsecadm(8),
   [6]photurisd(8), [7]startkey(1), [8]isakmpd(8) and [9]isakmpd.conf(5)
   are also available!
d5136 44
a5179 4
   You should also check [10]Codetalker which has an FAQ for setting up
   an IPSec VPN with OpenBSD. It explains some basic IPSec concepts and
   how to apply them to a VPN setup.
   Section Under Work
d5181 2
a5182 2
   [11][Back to Main Index] [12][To Section 12.0 - For Advanced Users]
   [13][To Section 14.0 - Using Disks in OpenBSD]
d5185 2
a5186 2
   [14][back] [15]www@@openbsd.org
   $OpenBSD: faq13.html,v 1.5 1999/09/24 01:46:14 ericj Exp $
d5190 78
a5267 15
   1. http://openbsd.org/faq/faq13.html#13.1
   2. http://www.openbsd.org/cgi-bin/man.cgi?query=vpn&apropos=0&sektion=0&format=html
   3. http://www.openbsd.org/cgi-bin/cvsweb/src/share/ipsec/
   4. http://www.openbsd.org/cgi-bin/man.cgi?query=ipsec&apropos=0&sektion=4&format=html
   5. http://www.openbsd.org/cgi-bin/man.cgi?query=ipsecadm&apropos=0&sektion=8&format=html
   6. http://www.openbsd.org/cgi-bin/man.cgi?query=photurisd&apropos=0&sektion=8&format=html
   7. http://www.openbsd.org/cgi-bin/man.cgi?query=startkey&apropos=0&sektion=1&format=html
   8. http://www.openbsd.org/cgi-bin/man.cgi?query=isakmpd&apropos=0&sektion=8&format=html
   9. http://www.openbsd.org/cgi-bin/man.cgi?query=isakmpd.conf&apropos=0&sektion=5&format=html
  10. http://www.codetalker.com/greenbox/docs/vpn-24-minifaq.html
  11. http://openbsd.org/faq/index.html
  12. http://openbsd.org/faq/faq12.html
  13. http://openbsd.org/faq/faq14.html
  14. http://openbsd.org/faq/index.html
  15. mailto:www@@openbsd.org
d5287 1
a5287 1
14.1 - Using the OpenBSD disklabel
d5289 1
a5289 1
   Be sure to check the [9]disklabel(8) man page!
d5291 14
a5304 10
   Disklabel is used to identify disks and/or partitions. The main idea
   behind them is abstraction of disk hardware, since there exists
   several partitioning tables. A disklabel is a universal partitioning
   table. These labels tell the system everything about the disk, but
   most of it is irrelevant. The important parts of the label are both
   the part that tells the disk geometry and also the part that actually
   defines what partitions exist on your disk. This label resides on the
   beginning of the disk, this is to help bootstrap code use them (since
   most ROM based booting reads the first sectors of the first disk).
   Disklabel can, on some systems, be used to install bootstrap code.
d5309 1
a5309 1
   such as Windows NT or DOS can see.) With disklabel, you use one of
d5312 37
a5348 1
   partitions available for other OSs!
d5350 2
a5351 7
   You can think of them as 'subpartitions' for installation purposes.
   But they are a necessity for kernel disk access based on geometry. And
   remember to use 'b' for the swap label, and 'a' for root filesystem
   (default names in kernel). (Note also that in other FAQ documents we
   usually refer to these OpenBSD 'subpartitions' as partitions. Most
   architectures do not have two layers of partitions like the i386
   does.)
d5353 79
a5431 2
   To just view the current disklabel for your disk just do:
# disklabel <disk-device name>
a5432 1
   This will give output similar to this:
d5460 4
a5463 9
   In this example, there are 4 labels - A, B, C, J. A is one main
   partition, B is swap, and J is another partition. C in all cases
   represents the full disk. This is helpful in showing what values in
   size, cyl, etc you have to work with. But with this command you cannot
   change any values, you can just view.

   To be able to edit your label's interactively you would use the -E
   flag.
   Example:
a5464 58
# using MBR partition 3: type A6 off 64 (0x40) size 16777152 (0xffffc0)

Treating sectors 64-16777216 as the OpenBSD portion of the disk.
You can use the 'b' command to change this.

Initial label editor (enter '?' for help at any prompt)
> ?
Available commands:
        p [unit]  - print label.
        M         - show entire OpenBSD man page for disklabel.
        e         - edit drive parameters.
        a [part]  - add new partition.
        b         - set OpenBSD disk boundaries.
        c [part]  - change partition size.
        d [part]  - delete partition.
        m [part]  - modify existing partition.
        r         - recalculate free space.
        u         - undo last change.
        s [path]  - save label to file.
        w         - write label to disk.
        q         - quit and save changes.
        x         - exit without saving changes.
        ? [cmnd]  - this message or command specific help.
Numeric parameters may use suffixes to indicate units:
        'b' for bytes, 'c' for cylinders, 'k' for kilobytes, 'm' for megabytes,
        'g' for gigabytes or no suffix for sectors (usually 512 bytes).
        Non-sector units will be rounded to the nearest cylinder.
Entering '?' at most prompts will give you (simple) context sensitive help.
> p
device: /dev/rwd0c
type: ESDI
disk:
label: TOSHIBA MK2720FC
bytes/sector: 512
sectors/track: 63
tracks/cylinder: 16
sectors/cylinder: 1008
cylinders: 2633
total sectors: 2654064
free sectors: 14193711
rpm: 3600

16 partitions:
#        size   offset    fstype   [fsize bsize   cpg]
  a:  2071440    65583    4.2BSD     1024  8192    16   # (Cyl.   65*- 2120)
  b:    65520       63      swap                        # (Cyl.    0*- 65)
  c:  2654064        0    unused        0     0         # (Cyl.    0 - 2632)
  j:   512001  2137023    4.2BSD     1024  8192    16   # (Cyl. 2120*- 2627*)
> q
No changes.

   In this example we get into disklabel's interactive mode. From here we
   can issue the command "?" asking for help. This gives us many commands
   we can use to add, delete, edit existing labels.

   There is a new feature on disklabel, to help installation. The '-f'
   flag writes a 'fstab' like file, if given a mount point for a label.
   This is only used at installation.
d5466 7
a5472 1
   To see an example install involving disklabel check [10]log25.txt
d5476 1
a5476 1
   First be sure to check the fdisk main page. [11]fdisk(8)
d5485 1
a5485 1
   For installation purposes, most times you'll only need ONE Openbsd
d5566 1
a5566 1
   [12]fdisk(8) (i386 only) and [13]disklabel(8) to set up your disk in
d5620 1
a5620 1
   the filesystem on that disk using [14]newfs(8).
d5652 2
a5653 2
   per-process limits first with csh's [15]unlimit(1), or sh's
   [16]ulimit(1).)
d5655 1
a5655 1
   With OpenBSD 2.5 came the introduction of [17]swapctl(8), which made
d5660 54
a5713 4
   To swap to a file permanently, first make a kernel with vnd0c as swap.
   If you have wd0a as root filesystem, wd0b is the previous swap, use
   this line in the kernel configuration file (refer to compiling a new
   kernel if in doubt):
d5716 29
a5744 17
   Second make the file for swap. If you want a 32MB swapfile named
   /newswap do:
   # dd if=/dev/zero of=/newswap bs=1k count=32768

   Add a line to your /etc/fstab file to indicate where the new swap will
   be.
   /dev/vnd0c none swap sw 0 0

   Now boot with the new kernel. Then create the vnd0 device to use that
   file as a device:
   # vnconfig -c -v vnd0 /newswap

   And add it now to swap:
   # swapon /dev/vnd0c

   You can now see if it is working with:
   # pstat -s
d5768 1
a5768 1
   as possible (kernel coredumps, tracebacks, etc) to [18]Costa. Do not
d5777 1
a5777 1
   use [19]installboot(8). For example, the most common usage is:
d5799 1
a5799 1
   [20]http://www.prz.tu-berlin.de/~wolf/os-bs.html
d5811 1
a5811 1
   For further instructions read [21]INSTALL.linux
d5823 1
a5823 1
   Also check with [22]section 4.7
d5866 1
a5866 1
   [23][Back to Main Index] [24][To Section 13.0 - IPsec]
d5869 2
a5870 2
   [25][back] [26]www@@openbsd.org
   $OpenBSD: faq14.html,v 1.3 1999/09/24 01:46:14 ericj Exp $
d5882 26
a5907 18
   9. http://www.openbsd.org/cgi-bin/man.cgi?query=disklabel&sektion=8&format=html
  10. http://openbsd.org/faq/log25.txt
  11. http://www.openbsd.org/cgi-bin/man.cgi?query=fdisk&apropos=0&sektion=8&format=html
  12. http://www.openbsd.org/cgi-bin/man.cgi?query=fdisk&apropos=0&sektion=8&format=html
  13. http://www.openbsd.org/cgi-bin/man.cgi?query=disklabel&apropos=0&sektion=8&format=html
  14. http://www.openbsd.org/cgi-bin/man.cgi?query=newfs&apropos=0&sektion=8&format=html
  15. http://www.openbsd.org/cgi-bin/man.cgi?query=unlimit&sektion=1&format=html
  16. http://www.openbsd.org/cgi-bin/man.cgi?query=ulimit&sektion=1&format=html
  17. http://www.openbsd.org/cgi-bin/man.cgi?query=swapctl&sektion=8&format=html
  18. mailto:csapuntz@@openbsd.org
  19. http://www.openbsd.org/cgi-bin/man.cgi?query=installboot&sektion=8&format=html
  20. http://www.prz.tu-berlin.de/~wolf/os-bs.html
  21. http://openbsd.org/faq/INSTALL.linux
  22. http://openbsd.org/faq/faq4.html#4.7
  23. http://openbsd.org/faq/index.html
  24. http://openbsd.org/faq/faq13.html
  25. http://openbsd.org/faq/index.html
  26. mailto:www@@openbsd.org
@


1.15
log
@change ipf howto url
@
text
@d9 1
a9 1
    [2]1.0 - Introduction of OpenBSD
d45 2
a46 4
   versions of the FAQ are also available in both PostScript and Text
   versions (currently out of date).
     * [20]PostScript Version
     * [21]Text Version
d48 1
a48 1
   Any questions can be directed to: [22]faq@@openbsd.org
d51 3
a53 3
   [23]Eric Jackson
   [24]Wim Vandeputte
   [25]Chris Cappuccio
d56 1
a56 1
   $OpenBSD: obsd-faq.txt,v 1.14 1999/09/24 22:14:48 ericj Exp $
d79 5
a83 6
  20. http://openbsd.org/faq/obsd-faq.ps
  21. http://openbsd.org/faq/obsd-faq.txt
  22. mailto:faq@@openbsd.org
  23. mailto:ericj@@openbsd.org
  24. mailto:wvdputte@@openbsd.org
  25. mailto:chris@@openbsd.org
d251 1
a251 1
   $OpenBSD: obsd-faq.txt,v 1.14 1999/09/24 22:14:48 ericj Exp $
d309 1
a309 2
   [6]http://www.monkey.org/openbsd-mobile/ and
   [7]http://www.cpio.net/openbsd/laptops/
d315 1
a315 1
   send an e-mail message to [8]majordomo@@openbsd.org. That address is an
d332 1
a332 1
   [9]majordomo@@openbsd.org. It might look like this:
d337 1
a337 1
   message to [10]majordomo@@openbsd.org with a message body of "help".
d349 1
a349 1
   mailing lists web page: [11]http://www.openbsd.org/mail.html
d351 1
a351 1
   [12]http://www.monkey.org/cgi-bin/wilma . This website contains
d355 1
a355 1
   [13]openbsd-mobile@@monkey.org. This mailing list is a discussion of
d363 1
a363 1
   [14]http://www.monkey.org/openbsd-mobile/archive/
d374 8
a381 8
     * [15]afterboot(8) - things to check after the first complete boot
     * [16]boot(8) - system boot strapping procedures
     * [17]passwd.conf(5) - format of the password configuration file
     * [18]adduser_proc(8) - procedure for adding new users
     * [19]adduser(8) - command for adding new users
     * [20]vipw(8) - edit the pass word file
     * [21]man(1) - display the on-line manual pages
     * [22]sendbug(1) - send a problem report (PR) about OpenBSD to a
d383 7
a389 7
     * [23]disklabel(8) - Read and write disk pack label.
     * [24]ifconfig(8) - configure network interface parameters.
     * [25]route(8) - manually manipulate the routing tables.
     * [26]netstat(1) - show network status.
     * [27]reboot, halt(8) - Stopping and restarting the system.
     * [28]shutdown(8) - close down the system at a given time.
     * [29]boot_config(8) - how to change kernel configuration at boot
d393 1
a393 1
   [30]http://www.openbsd.org/cgi-bin/man.cgi.
d456 1
a456 1
   tree unformatted, and many times thru the use of [31]CVS, they will be
d472 1
a472 1
   program like gv (GhostView). GhostView can be found in our [32]Ports
d479 1
a479 1
   [33]http://www.openbsd.org/report.html
d566 3
a568 3
       [34]http://cvs.openbsd.org/cgi-bin/wwwgnats.pl.
     * Look in the [35]bugs@@openbsd.org list archives:
       [36]http://www.openbsd.org/mail.html.
d570 2
a571 2
   [37][Back to Main Index] [38][To Section 1.0 - Introduction to
   OpenBSD] [39][To Section 3.0 - Obtaining OpenBSD]
d574 2
a575 2
   [40][back] [41]www@@openbsd.org
   $OpenBSD: obsd-faq.txt,v 1.14 1999/09/24 22:14:48 ericj Exp $
d585 1
a585 1
   7. http://www.cpio.net/openbsd/laptops/
d588 31
a618 32
  10. mailto:majordomo@@openbsd.org
  11. http://openbsd.org/mail.html
  12. http://www.monkey.org/cgi-bin/wilma
  13. mailto:openbsd-mobile@@monkey.org
  14. http://www.monkey.org/openbsd-mobile/archive/
  15. http://www.openbsd.org/cgi-bin/man.cgi?query=afterboot&apropos=0&sektion=8&format=html
  16. http://www.openbsd.org/cgi-bin/man.cgi?query=boot&apropos=0&sektion=8&format=html
  17. http://www.openbsd.org/cgi-bin/man.cgi?query=passwd.conf&apropos=0&sektion=5&format=html
  18. http://www.openbsd.org/cgi-bin/man.cgi?query=adduser_proc&apropos=0&sektion=8&format=html
  19. http://www.openbsd.org/cgi-bin/man.cgi?query=adduser&apropos=0&sektion=8&format=html
  20. http://www.openbsd.org/cgi-bin/man.cgi?query=vipw&apropos=0&sektion=8&format=html
  21. http://www.openbsd.org/cgi-bin/man.cgi?query=man&apropos=0&sektion=1&format=html
  22. http://www.openbsd.org/cgi-bin/man.cgi?query=sendbug&apropos=0&sektion=1&format=html
  23. http://www.openbsd.org/cgi-bin/man.cgi?query=disklabel&apropos=0&sektion=8&format=html
  24. http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&apropos=0&sektion=8&format=html
  25. http://www.openbsd.org/cgi-bin/man.cgi?query=route&apropos=0&sektion=8&format=html
  26. http://www.openbsd.org/cgi-bin/man.cgi?query=netstat&apropos=0&sektion1&format=html
  27. http://www.openbsd.org/cgi-bin/man.cgi?query=reboot&apropos=0&sektion=8&format=html
  28. http://www.openbsd.org/cgi-bin/man.cgi?query=shutdown&apropos=0&sektion=8&format=html
  29. http://www.openbsd.org/cgi-bin/man.cgi?query=boot_config&apropos=0&sektion=8&format=html
  30. http://www.openbsd.org/cgi-bin/man.cgi
  31. http://openbsd.org/faq/faq8.html#8.5
  32. http://openbsd.org/ports.html
  33. http://openbsd.org/report.html
  34. http://cvs.openbsd.org/cgi-bin/wwwgnats.pl
  35. mailto:bugs@@openbsd.org
  36. http://www.openbsd.org/mail.html
  37. http://openbsd.org/faq/index.html
  38. http://openbsd.org/faq/faq1.html
  39. http://openbsd.org/faq/faq3.html
  40. http://openbsd.org/faq/index.html
  41. mailto:www@@openbsd.org
d706 1
a706 1
   $OpenBSD: obsd-faq.txt,v 1.14 1999/09/24 22:14:48 ericj Exp $
d737 4
a740 5
     * [4]4.3.1 - Upgrading from various versions of Openbsd
     * [5]4.4 - What files are needed for Installation?
     * [6]4.5 - How much space do I need for an OpenBSD installation?
     * [7]4.6 - Multibooting OpenBSD
     * [8]4.7 - Sending your dmesg to dmesg@@openbsd.org after the install
d747 1
a747 1
   [9]http://www.openbsd.org/orders.html. If you are using either the
d774 1
a774 1
   through the rest of the install process use [10]log25.txt, which is an
d784 1
a784 1
   depending on your ROM version. Then simply follow the [11]install
d803 1
a803 1
   for the i386 architecture. And again follow the [12]install
d825 1
a825 1
   Consult the [13]install text for help.
d837 1
a837 1
   Consult the [14]install text for help.
d906 1
a906 1
   at the [15]NTLDR Hacking Guide.
d912 1
a912 1
   Some bootloaders of choice are [16]osbs20b8.zip or [17]The Ranish
d917 1
a917 1
   Please refer to [18]INSTALL.linux, which gives indepth instructions on
d936 1
a936 1
   Also check with [19]section 14.7
d954 2
a955 2
   [20][Back to Main Index] [21][To Section 3.0 - Obtaining OpenBSD]
   [22][To Section 5.0 - Kernel configuration and Disk Setup]
d958 2
a959 2
   [23][back] [24]www@@openbsd.org
   $OpenBSD: obsd-faq.txt,v 1.14 1999/09/24 22:14:48 ericj Exp $
d966 6
a971 6
   4. http://openbsd.org/faq/upgrade-minifaq.html
   5. http://openbsd.org/faq/faq4.html#4.4
   6. http://openbsd.org/faq/faq4.html#4.5
   7. http://openbsd.org/faq/faq4.html#4.6
   8. http://openbsd.org/faq/faq4.html#4.7
   9. http://openbsd.org/orders.html
d976 10
a985 11
  14. http://openbsd.org/faq/log25.txt
  15. http://www.dorsai.org/~dcl/publications/NTLDR_Hacking/
  16. http://www.freebird.org/sw-map/bootmanager.html
  17. http://www.users.intercom.com/~ranish/part/
  18. http://openbsd.org/faq/INSTALL.linux
  19. http://openbsd.org/faq/faq14.html#14.7
  20. http://openbsd.org/faq/index.html
  21. http://openbsd.org/faq/faq3.html
  22. http://openbsd.org/faq/faq5.html
  23. http://openbsd.org/faq/index.html
  24. mailto:www@@openbsd.org
d1368 1
a1368 1
   $OpenBSD: obsd-faq.txt,v 1.14 1999/09/24 22:14:48 ericj Exp $
d1428 30
a1457 6
     * [1]6.1 - Initial network setup
     * [2]6.2 - IP Filter
     * [3]6.3 - Network Address Translation
     * [4]6.4 - Dynamic Host Configuration Protocol
     * [5]6.5 - Point to Point Protocol
     _________________________________________________________________
d1464 1
a1464 3
   basic TCP/IP knowledge. If not, go to the [6]Kernel Configuration and
   Setup section, and/or read a good introduction to TCP/IP. Other
   recommended reading is the [7]ifconfig(8) and [8]netstat(1) man pages.
d1485 15
a1499 9
   First there is lo0 the loopback interface. It MUST have the assigned
   address of 127.0.0.1 no matter what network setup you use. The next
   important one is xl0 in this example (could be neX or epX depending on
   the brand), which is a board itself. Look it has UP and RUNNING flags
   on, as lo0 but no other interface has them. That means obviously they
   are working. Your interface could be down if you never configured it,
   and look like the other interfaces. The others are not part of this
   section, as sl and ppp are for serial line comunication, tun is a
   pseudo-device for tunneling and enc a pseudo-device for encryption.
d1507 3
a1509 2
   media tags. (full-duplex, etc). This hostname 'mona' needs to have
   record in /etc/hosts:
a1511 6
   What actually happens when you boot is that it looks up 'mona' in
   /etc/hosts, and then configures the interface to 10.1.1.1. If you have
   multiple ethernet interfaces, this is probably a painful way to do
   things, and so you can also put the number right in /etc/hostname.xl0:
inet 10.1.1.1 255.255.255.0 NONE

d1600 5
a1604 5
   [9]section 11 for further information on tuning NMBCLUSTERS if you are
   doing this.) For the rest of us, OpenBSD now has a sysctl mechanism to
   turn on and off IP Forwarding at boot. If you want it to "forward" any
   packets between your interfaces, modify the /etc/sysctl.conf line that
   toggles the forwarding variable on bootup:
d1613 1
a1613 1
   [10]routed(8), [11]gated, [12]mrtd, and [13]zebra. OpenBSD has support
d1621 2
a1622 2
   packet level forwarding permissions [14]ipf(8) and mapping
   hosts/subnets to a range of external addresses [15]ipnat(8). The
d1652 2
a1653 2
   at the IP Filter [16]mailing list archive, the [17]IP Filter web site,
   and finally the [18]IP Filter HOWTO.
d1659 1
a1659 1
   usage, for a more strict definition see [19]ipf(5). Here is assumed
d1691 16
a1706 16
     * [20]1.0 Introduction
          + [21]1.1 Purpose
          + [22]1.2 Terminology
          + [23]1.3 Configuration
     * [24]2.0 Network Address Translation
          + [25]2.1 Introduction to Network Address Translation
          + [26]2.2 Why to use Network Address Translation
          + [27]2.3 Setup
          + [28]2.4 Configuration
          + [29]2.5 Running
     * [30]3.0 Network Address Translation Knowledge Base
          + [31]3.1 Checking NAT status
          + [32]3.2 Limitations of NAT (in FTP)
          + [33]3.3 Redirecting Traffic
          + [34]3.4 Network Address Translation versus Proxy
     * [35]4.0 Links and X-References
d1721 1
a1721 1
   Based on [36]RFC 1631, ipnat provides an easy way to map internal
d1725 1
a1725 1
   you can take advantage of reserved address blocks (assigned in [37]RFC
d1751 1
a1751 1
       [38]FAQ 6.2.
d1799 1
a1799 1
  2.0 NETWORK ADDRESS TRANSLATION
d1888 1
a1888 1
   Again for more information you can read [39]FAQ 6.2
d1950 1
a1950 1
  NAT KNOWLEDGE BASE
d1999 14
d2026 1
a2026 1
rdr pn0 0.0.0.0/0 port 80 -> 192.168.1.80/32 port 80
d2047 1
a2047 1
   "192.168.1.80/32"
d2049 3
a2051 2
       are redirected to. The netmask is always "/32" so the packets can
       be redirected to a particular machine.
d2065 1
a2065 1
   can be a problem. The main problem is within FTP (see "NAT
d2076 3
a2078 3
     * [40]http://www.openbsd.org/cgi-bin/man.cgi?query=ipnat&sektion=8
     * [41]http://coombs.anu.edu.au/ipfilter/
     * [42]http://www.geektools.com/rfc/rfc1631.txt
d2082 1
a2082 1
   To use the DHCP client [43]dhclient(8) included with OpenBSD, edit
d2092 1
a2092 1
   If you want to use OpenBSD as a DHCP server [44]dhcpd(8), edit
d2121 2
a2122 2
     * [45]pppd(8) - Which is the kernel ppp daemon.
     * [46]ppp(8) - Which is the userland ppp daemon.
d2133 1
a2133 1
   your ppp. The userland PPP daemon uses the file [47]/etc/ppp/ppp.conf
d2161 1
a2161 1
   logging levels. This can be changed, refer to [48]ppp(8) for more info
d2236 26
a2261 2
     * [49]ppp.linkup
     * [50]ppp.linkdown
d2263 23
a2285 2
   [51][Back to Main Index] [52][To Section 5.0 - Kernel configuration
   and Disk Setup] [53][To Section 7.0 - Keyboard controls]
d2288 2
a2289 2
   [54][back] [55]www@@openbsd.org
   $OpenBSD: obsd-faq.txt,v 1.14 1999/09/24 22:14:48 ericj Exp $
d2293 62
a2354 55
   1. http://openbsd.org/faq/faq6.html#6.1
   2. http://openbsd.org/faq/faq6.html#6.2
   3. http://openbsd.org/faq/faq6.html#6.3
   4. http://openbsd.org/faq/faq6.html#6.4
   5. http://openbsd.org/faq/faq6.html#6.5
   6. http://openbsd.org/faq/faq5.html
   7. http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&apropos=0&sektion=8&format=html
   8. http://www.openbsd.org/cgi-bin/man.cgi?query=netstat&apropos=0&sektion=1&format=html
   9. http://openbsd.org/faq/faq11.html
  10. http://www.openbsd.org/cgi-bin/man.cgi?query=routed&apropos=0&sektion=8&format=html
  11. http://www.gated.org/
  12. http://www.mrtd.net/
  13. http://www.zebra.org/
  14. http://www.openbsd.org/cgi-bin/man.cgi?query=ipf&apropos=0&sektion=8&format=html
  15. http://www.openbsd.org/cgi-bin/man.cgi?query=ipnat&apropos=0&sektion=8&format=html
  16. http://false.net/ipfilter/
  17. http://cheops.anu.edu.au/~avalon/ip-filter.html
  18. http://www.obfuscation.org/ipf/
  19. http://www.openbsd.org/cgi-bin/man.cgi?query=ipf&apropos=0&sektion=5&format=html
  20. http://openbsd.org/faq/faq6.html#nat1.0
  21. http://openbsd.org/faq/faq6.html#nat1.1
  22. http://openbsd.org/faq/faq6.html#nat1.2
  23. http://openbsd.org/faq/faq6.html#nat1.3
  24. http://openbsd.org/faq/faq6.html#nat2.0
  25. http://openbsd.org/faq/faq6.html#nat2.1
  26. http://openbsd.org/faq/faq6.html#nat2.2
  27. http://openbsd.org/faq/faq6.html#nat2.3
  28. http://openbsd.org/faq/faq6.html#nat2.4
  29. http://openbsd.org/faq/faq6.html#nat2.5
  30. http://openbsd.org/faq/faq6.html#nat3.0
  31. http://openbsd.org/faq/faq6.html#nat3.1
  32. http://openbsd.org/faq/faq6.html#nat3.2
  33. http://openbsd.org/faq/faq6.html#nat3.3
  34. http://openbsd.org/faq/faq6.html#nat3.4
  35. http://openbsd.org/faq/faq6.html#nat4.0
  36. http://www.geektools.com/rfc/rfc1631.txt
  37. http://www.geektools.com/rfc/rfc1918.txt
  38. http://openbsd.org/faq/faq6.html#6.2
  39. http://openbsd.org/faq/faq6.html#6.2
  40. http://www.openbsd.org/cgi-bin/man.cgi?query=ipnat&sektion=8
  41. http://coombs.anu.edu.au/ipfilter/
  42. http://www.geektools.com/rfc/rfc1631.txt
  43. http://www.openbsd.org/cgi-bin/man.cgi?query=dhclient&apropos=0&sektion=8&format=html
  44. http://www.openbsd.org/cgi-bin/man.cgi?query=dhcpd&apropos=0&sektion=8&format=html
  45. http://www.openbsd.org/cgi-bin/man.cgi?query=pppd&sektion=8&format=html
  46. http://www.openbsd.org/cgi-bin/man.cgi?query=ppp&sektion=8&format=html
  47. http://www.openbsd.org/cgi-bin/cvsweb/src/etc/ppp/ppp.conf.sample
  48. http://www.openbsd.org/cgi-bin/man.cgi?query=ppp&sektion=8&format=html
  49. http://www.openbsd.org/cgi-bin/cvsweb/src/etc/ppp/ppp.linkup.sample
  50. http://www.openbsd.org/cgi-bin/cvsweb/src/etc/ppp/ppp.linkdown.sample
  51. http://openbsd.org/faq/index.html
  52. http://openbsd.org/faq/faq5.html
  53. http://openbsd.org/faq/faq7.html
  54. http://openbsd.org/faq/index.html
  55. mailto:www@@openbsd.org
d2386 1
a2386 1
   $OpenBSD: obsd-faq.txt,v 1.14 1999/09/24 22:14:48 ericj Exp $
d2983 1
a2983 1
   $OpenBSD: obsd-faq.txt,v 1.14 1999/09/24 22:14:48 ericj Exp $
d3117 1
a3117 1
,$4,$5,$6,$7); }' > bsd_passwd
d3119 1
a3119 1
   At this point, you want to edit the bsd_passwd file and remove the
d3123 3
a3125 3
   linux_passwd and bsd_passwd. The easiest way to do this is to start
   with a fresh bsd_passwd.
# cat bsd_passwd >> /etc/master.passwd
d3163 1
a3163 1
   $OpenBSD: obsd-faq.txt,v 1.14 1999/09/24 22:14:48 ericj Exp $
d3909 1
a3909 1
   $OpenBSD: obsd-faq.txt,v 1.14 1999/09/24 22:14:48 ericj Exp $
d4036 1
a4036 1
   $OpenBSD: obsd-faq.txt,v 1.14 1999/09/24 22:14:48 ericj Exp $
d4185 4
a4188 3
   If you start using the performance tuning measures above, you may
   start running out of kernel memory. If you start getting panics like
   "out of space in kmem_map" then you need to try
d4195 3
d4205 2
d4301 2
a4302 1
   [17][Back to Main Index] [18][To Section 10.0 - System Administration]
d4306 1
a4306 1
   $OpenBSD: obsd-faq.txt,v 1.14 1999/09/24 22:14:48 ericj Exp $
d4326 2
a4327 2
  17. http://openbsd.org/faq/index.html
  18. http://openbsd.org/faq/faq10
d4339 1
d4355 1
a4355 1
       From: Constantine Sapuntzakis <[2]csapuntz@@stanford.edu>
d4446 2
a4447 2
   [3][Back to Main Index] [4][To Section 11.0 - Performance Tuning]
   [5][To Section 13.0 - IPsec]
d4450 2
a4451 2
   [6][back] [7]www@@openbsd.org
   $OpenBSD: obsd-faq.txt,v 1.14 1999/09/24 22:14:48 ericj Exp $
d4456 7
a4462 6
   2. mailto:csapuntz@@stanford.edu
   3. http://openbsd.org/faq/index.html
   4. http://openbsd.org/faq/faq11.html
   5. http://openbsd.org/faq/faq13.html
   6. http://openbsd.org/faq/index.html
   7. mailto:www@@openbsd.org
d4490 1
a4490 1
   $OpenBSD: obsd-faq.txt,v 1.14 1999/09/24 22:14:48 ericj Exp $
d4995 1
a4995 1
   $OpenBSD: obsd-faq.txt,v 1.14 1999/09/24 22:14:48 ericj Exp $
d5082 4
d5107 1
a5107 1
   Between formal releases, a series of snapshot releases are [24]made
d5120 1
a5120 1
   can be [25]fetched and [26]built. This procedure should eliminate most
d5135 1
a5135 1
   Short answer: [27]http://www.openbsd.org/anoncvs.html
d5396 1
a5396 1
   You need to build a new cap_mkdb. See [28]3.1.
d5441 1
a5441 1
   For detailed instructions, see section [29]4.2.
d5446 1
a5446 1
   kernel before attempting a make build. See [30]4.3 for details.
d5465 1
a5465 1
   the egcs-snapshot, available from the [31]ports collection. If this
d5609 1
a5609 1
     make build and proceed. See [32]4.2.2.]
d5644 1
a5644 1
   and similar to the cap_mkdb issue described in [33]3.1.
d5698 1
a5698 1
   the perl changes mentioned in [34]4.1 mean that you can remove the
d5759 8
d5768 1
a5768 1
   $OpenBSD: obsd-faq.txt,v 1.14 1999/09/24 22:14:48 ericj Exp $
d5771 1
a5771 1
   [35]kwooding@@codetalker.com
d5798 13
a5810 12
  24. ftp://ftp.openbsd.org/pub/OpenBSD/snapshots/
  25. http://openbsd.org/faq/upgrade-minifaq.html#1.4
  26. http://openbsd.org/faq/upgrade-minifaq.html#1.5
  27. http://openbsd.org/anoncvs.html
  28. http://openbsd.org/faq/upgrade-minifaq.html#3.1
  29. http://openbsd.org/faq/upgrade-minifaq.html#4.2
  30. http://openbsd.org/faq/upgrade-minifaq.html#4.3
  31. http://openbsd.org/ports.html
  32. http://openbsd.org/faq/upgrade-minifaq.html#4.2.2
  33. http://openbsd.org/faq/upgrade-minifaq.html#3.1
  34. http://openbsd.org/faq/upgrade-minifaq.html#4.1
  35. mailto:kwooding@@codetalker.com
@


1.14
log
@sync. Txt faq is not out of date
@
text
@d58 1
a58 1
   $OpenBSD: index.html,v 1.78 1999/09/24 21:33:54 wvdputte Exp $
d254 1
a254 1
   $OpenBSD: faq1.html,v 1.16 1999/09/24 01:46:13 ericj Exp $
d579 1
a579 1
   $OpenBSD: faq2.html,v 1.19 1999/09/24 01:46:14 ericj Exp $
d711 1
a711 1
   $OpenBSD: faq3.html,v 1.10 1999/09/24 01:46:14 ericj Exp $
d965 1
a965 1
   $OpenBSD: faq4.html,v 1.58 1999/09/24 02:19:57 ericj Exp $
d1375 1
a1375 1
   $OpenBSD: faq5.html,v 1.32 1999/09/24 01:46:14 ericj Exp $
d2213 1
a2213 1
   $OpenBSD: faq6.html,v 1.29 1999/09/24 20:03:44 ericj Exp $
d2234 1
a2234 1
  18. http://www.swcp.com/~synk/ipf-howto.txt
d2303 1
a2303 1
   $OpenBSD: faq7.html,v 1.7 1999/09/24 01:46:14 ericj Exp $
d2900 1
a2900 1
   $OpenBSD: faq8.html,v 1.32 1999/09/24 01:46:14 ericj Exp $
d3080 1
a3080 1
   $OpenBSD: faq9.html,v 1.13 1999/09/24 01:46:14 ericj Exp $
d3826 1
a3826 1
   $OpenBSD: faq10.html,v 1.30 1999/09/24 01:46:13 ericj Exp $
d3953 1
a3953 1
   $OpenBSD: faq11-2.4.html,v 1.4 1999/09/24 17:50:41 ericj Exp $
d4216 1
a4216 1
   $OpenBSD: faq11.html,v 1.1 1999/09/24 01:46:14 ericj Exp $
d4360 1
a4360 1
   $OpenBSD: faq12.html,v 1.20 1999/09/24 01:46:14 ericj Exp $
d4398 1
a4398 1
   $OpenBSD: faq13.html,v 1.5 1999/09/24 01:46:14 ericj Exp $
d4903 1
a4903 1
   $OpenBSD: faq14.html,v 1.3 1999/09/24 01:46:14 ericj Exp $
d5664 1
a5664 1
   $OpenBSD: upgrade-minifaq.html,v 1.7 1999/07/27 05:25:48 kjell Exp $
@


1.13
log
@sync
@
text
@d2 1
a2 1
   [OpenBSD]
d4 1
a4 1
Frequently Asked Questions
d7 23
a29 1
   [2.5 logo]
d33 6
a38 5
   versions is still availible and you should always check [1]errata.html
   for important updates. The FAQ only follows release versions of
   OpenBSD and will not have information pertaining to any -current
   options until it has been released on CD. This is so we do not have
   any confusion on to which versions are being used or documented.
d40 1
a40 1
     * [2]OpenBSD 2.4
d45 4
a48 4
   versions of the FAQ are also availible in both PostScript and Text
   versions.
     * [3]PostScript Version
     * [4]Text Version
d50 1
a50 1
   Any questions can be directed to: [5]faq@@openbsd.org
d53 3
a55 3
   [6]Eric Jackson
   [7]Wim Vandeputte
   [8]Chris Cappuccio
d58 1
a58 1
  [9]1.0 - Introduction to OpenBSD
d60 1
a60 75
     * [10]1.1 - What is OpenBSD?
     * [11]1.2 - What platforms are supported?
     * [12]1.3 - Is OpenBSD really free?
     * [13]1.4 - Why might I want to use OpenBSD?
     * [14]1.5 - How can I help support OpenBSD?
     * [15]1.6 - Who maintains OpenBSD?

  [16]2.0 - Other OpenBSD information resources

     * [17]2.1 - Web Pages
     * [18]2.2 - Mailing Lists
     * [19]2.3 - Manual Pages
     * [20]2.4 - Reporting Bugs

  [21]3.0 - Obtaining OpenBSD

     * [22]3.1 - Buying an OpenBSD CD
     * [23]3.1.1 - Buying OpenBSD T-Shirts
     * [24]3.2 - Downloading via FTP or AFS
     * [25]3.3 - Obtaining Current Source Code

  [26]4.0 - Installation and Disk Setup

     * [27]4.1 - Installing from CD
     * [28]4.2 - Installing from FTP
     * [29]4.3 - Installing via DHCP
     * [30]4.3.1 - Upgrading from various versions of Openbsd
     * [31]4.4 - What files are needed for Installation?
     * [32]4.5 - How much space do I need for an OpenBSD installation?
     * [33]4.6 - Multibooting OpenBSD
     * [34]4.7 - Sending your dmesg to dmesg@@openbsd.org after the
       install

  [35]5.0 - Kernel Configuration and Setup

     * [36]5.1 - Why do I need a custom kernel?
     * [37]5.2 - Kernel configuration Options
     * [38]5.3 - Building your own kernel
     * [39]5.4 - Boot-time configuration

  [40]6.0 - Networking setup

     * [41]6.1 - Initial network setup
     * [42]6.2 - IP Filter and Network Address Translation
     * [43]6.3 - Dynamic Host Configuration Protocol
     * [44]6.4 - Point to Point Protocol

  [45]7.0 - Keyboard controls

     * [46]7.1 - How do I remap the keyboard?
     * [47]7.2 - Is there gpm or the like in OpenBSD?

  [48]8.0 - General Questions

     * [49]8.1 - What are these kerberos warnings when I first login?
     * [50]8.2 - How do I change virtual terminals?
     * [51]8.3 - I forgot my root password..... What do I do!
     * [52]8.4 - X won't start, I get lots of error messages
     * [53]8.5 - What is CVS, and how do I use it?
     * [54]8.6 - What is the ports tree?
     * [55]8.7 - What are packages?
     * [56]8.8 - Is there any way to use my floppy drive if it's not
       attached during boot?
     * [57]8.9 - OpenBSD Bootloader (i386 specific)
     * [58]8.10 - Using S/Key on your OpenBSD system
     * [59]8.11 - Why is my Macintosh losing so much time?
     * [60]8.12 - Will OpenBSD run on multiprocessor machines?

  [61]9.0 - Migrating from Linux

     * [62]9.1 - Tips for Linux (and other free Unix-like OS) users
     * [63]9.2 - Dual boot of Linux and OpenBSD
     * [64]9.3 - Converting your linux (or other System-7 style) password
       file to BSD-style.
     * [65]9.4 - Getting OpenBSD and Linux to interact
d62 25
a86 1
  [66]10.0 - System Administration
a87 17
     * [67]10.1 - When I try to su to root it says that I'm in the wrong
       group
     * [68]10.2 - How do I duplicate a filesystem?
     * [69]10.3 - How do I get daemons like httpd and sendmail to start
       up with the system?
     * [70]10.4 - Why do users get relaying access denied when they are
       remotely sending mail through my OpenBSD system?
     * [71]10.5 - I've set up POP, but I get errors when accessing my
       mail thru POP. What can i do?
     * [72]10.6 - Setting up a Secure HTTP Server using SSL(8)
     * [73]10.7 - I made changes to /etc/passwd with vi(1), but the
       changes didn't seem to take place. Why?
     * [74]10.8 - How do I add a user? or delete a user?
     * [75]10.9 - How do I create a ftp-only account?
     * [76]10.10 - Setting up user disk quotas
     * [77]10.11 - Setting up Kerberos Client/Server
     * [78]10.12 - Setting up an Anonymous FTP Server
d89 1
a89 21
  [79]11.0 - OpenBSD 2.4 Specific Information

     * [80]11.1 - Why do I get UserDir errors when running httpd(8)?
     * [81]11.2 - Installing at a partition 4GB or higher (i386 specific)
     * [82]Log24.txt - Specific OpenBSD 2.4 Install Example

  [83]12.0 - Performance Tuning

     * [84]12.1 - Networking
     * [85]12.2 - Disk I/O
     * [86]12.3 - Tuning kmem
     * [87]12.4 - Hardware Choices
     * [88]12.5 - Why aren't we using async mounts?

  [89]13.0 For Advanced Users

     * [90]13.1 - Using OpenBSD's new PCI-IDE code

  [91]14.0 IPsec

     * [92]IPsec
d91 1
a91 12
  [93]15.0 Using Disks in OpenBSD

     * [94]15.1 - Using OpenBSD's Disklabel
     * [95]15.2 - Using OpenBSD's fdisk
     * [96]15.3 - Adding extra disks in OpenBSD
     * [97]15.4 - How to swap to a file
     * [98]15.5 - Soft-updates
     * [99]15.6 - When I boot after installation of OpenBSD/i386, it says
       "partition 3 id 0".
     * [100]15.7 - How do I get a dmesg from a boot floppy?
     * [101]15.8 - I cannot boot OpenBSD. It just says: "reading boot..
       Bad magic" (Installing Bootblocks - i386 specific)
d94 7
a100 113
   [102][back] [103]www@@openbsd.org
   $OpenBSD: index.html,v 1.71 1999/09/22 22:05:27 ericj Exp $

References

   1. http://openbsd.org/errata.html
   2. http://openbsd.org/faq/faq11-2.4.html
   3. http://openbsd.org/faq/obsd-faq.ps
   4. http://openbsd.org/faq/obsd-faq.txt
   5. mailto:faq@@openbsd.org
   6. mailto:ericj@@openbsd.org
   7. mailto:wvdputte@@openbsd.org
   8. mailto:chris@@openbsd.org
   9. http://openbsd.org/faq/faq1.html
  10. http://openbsd.org/faq/faq1.html#1.1
  11. http://openbsd.org/faq/faq1.html#1.2
  12. http://openbsd.org/faq/faq1.html#1.3
  13. http://openbsd.org/faq/faq1.html#1.4
  14. http://openbsd.org/faq/faq1.html#1.5
  15. http://openbsd.org/faq/faq1.html#1.6
  16. http://openbsd.org/faq/faq2.html
  17. http://openbsd.org/faq/faq2.html#2.1
  18. http://openbsd.org/faq/faq2.html#2.2
  19. http://openbsd.org/faq/faq2.html#2.3
  20. http://openbsd.org/faq/faq2.html#2.4
  21. http://openbsd.org/faq/faq3.html
  22. http://openbsd.org/faq/faq3.html#3.1
  23. http://openbsd.org/faq/faq3.html#3.1.1
  24. http://openbsd.org/faq/faq3.html#3.2
  25. http://openbsd.org/faq/faq3.html#3.3
  26. http://openbsd.org/faq/faq4.html
  27. http://openbsd.org/faq/faq4.html#4.1
  28. http://openbsd.org/faq/faq4.html#4.2
  29. http://openbsd.org/faq/faq4.html#4.3
  30. http://openbsd.org/faq/upgrade-minifaq.html
  31. http://openbsd.org/faq/faq4.html#4.4
  32. http://openbsd.org/faq/faq4.html#4.5
  33. http://openbsd.org/faq/faq4.html#4.6
  34. http://openbsd.org/faq/faq4.html#4.7
  35. http://openbsd.org/faq/faq5.html
  36. http://openbsd.org/faq/faq5.html#5.1
  37. http://openbsd.org/faq/faq5.html#5.2
  38. http://openbsd.org/faq/faq5.html#5.3
  39. http://openbsd.org/faq/faq5.html#5.4
  40. http://openbsd.org/faq/faq6.html
  41. http://openbsd.org/faq/faq6.html#6.1
  42. http://openbsd.org/faq/faq6.html#6.2
  43. http://openbsd.org/faq/faq6.html#6.3
  44. http://openbsd.org/faq/faq6.html#6.4
  45. http://openbsd.org/faq/faq7.html
  46. http://openbsd.org/faq/faq7.html#7.1
  47. http://openbsd.org/faq/faq7.html#7.2
  48. http://openbsd.org/faq/faq8.html
  49. http://openbsd.org/faq/faq8.html#8.1
  50. http://openbsd.org/faq/faq8.html#8.2
  51. http://openbsd.org/faq/faq8.html#8.3
  52. http://openbsd.org/faq/faq8.html#8.4
  53. http://openbsd.org/faq/faq8.html#8.5
  54. http://openbsd.org/faq/faq8.html#8.6
  55. http://openbsd.org/faq/faq8.html#8.7
  56. http://openbsd.org/faq/faq8.html#8.8
  57. http://openbsd.org/faq/faq8.html#8.9
  58. http://openbsd.org/faq/faq8.html#8.10
  59. http://openbsd.org/faq/faq8.html#8.11
  60. http://openbsd.org/faq/faq8.html#8.12
  61. http://openbsd.org/faq/faq9.html
  62. http://openbsd.org/faq/faq9.html#9.1
  63. http://openbsd.org/faq/faq9.html#9.2
  64. http://openbsd.org/faq/faq9.html#9.3
  65. http://openbsd.org/faq/faq9.html#9.4
  66. http://openbsd.org/faq/faq10.html
  67. http://openbsd.org/faq/faq10.html#10.1
  68. http://openbsd.org/faq/faq10.html#10.2
  69. http://openbsd.org/faq/faq10.html#10.3
  70. http://openbsd.org/faq/faq10.html#10.4
  71. http://openbsd.org/faq/faq10.html#10.5
  72. http://openbsd.org/faq/faq10.html#10.6
  73. http://openbsd.org/faq/faq10.html#10.7
  74. http://openbsd.org/faq/faq10.html#10.8
  75. http://openbsd.org/faq/faq10.html#10.9
  76. http://openbsd.org/faq/faq10.html#10.10
  77. http://openbsd.org/faq/faq10.html#10.11
  78. http://openbsd.org/faq/faq10.html#10.12
  79. http://openbsd.org/faq/faq11-2.4.html
  80. http://openbsd.org/faq/faq11-2.4.html#11.1
  81. http://openbsd.org/faq/faq11-2.4.html#11.2
  82. http://openbsd.org/faq/log24.txt
  83. http://openbsd.org/faq/faq12.html
  84. http://openbsd.org/faq/faq12.html#12.1
  85. http://openbsd.org/faq/faq12.html#12.2
  86. http://openbsd.org/faq/faq12.html#12.3
  87. http://openbsd.org/faq/faq12.html#12.4
  88. http://openbsd.org/faq/faq12.html#12.5
  89. http://openbsd.org/faq/faq13.html
  90. http://openbsd.org/faq/faq13.html#13.1
  91. http://openbsd.org/faq/faq14.html
  92. http://openbsd.org/faq/faq14.html#14.1
  93. http://openbsd.org/faq/faq15.html
  94. http://openbsd.org/faq/faq15.html#15.1
  95. http://openbsd.org/faq/faq15.html#15.2
  96. http://openbsd.org/faq/faq15.html#15.3
  97. http://openbsd.org/faq/faq15.html#15.4
  98. http://openbsd.org/faq/faq15.html#15.5
  99. http://openbsd.org/faq/faq15.html#15.6
 100. http://openbsd.org/faq/faq15.html#15.7
 101. http://openbsd.org/faq/faq15.html#15.8
 102. http://openbsd.org/index.html
 103. mailto:www@@openbsd.org


   [1][Back to Main Index]

                         1.0 - Introduction to OpenBSD
d105 1
a105 1
   The [2]OpenBSD project produces a freely available, multi-platform
d107 1
a107 1
   portability, standardization, correctness, and security. [3]OpenBSD
d114 9
a122 9
     * [4]i386 - CD bootable
     * [5]sparc - CD bootable
     * [6]alpha - CD bootable
     * [7]hp300
     * [8]amiga
     * [9]mac68k
     * [10]powerpc
     * [11]pmax
     * [12]mvme88k
d128 1
a128 1
   will boot on several hardware platforms. See [13]section 3.0 of this
d132 2
a133 2
     * [14]arc
     * [15]mvme68k
d138 1
a138 1
   [16]http://www.openbsd.org/plat.html
d142 1
a142 1
   [17]8.12
d159 1
a159 1
   [18]http://www.openbsd.org/policy.html.
d202 1
a202 1
   [19]http://www.openbsd.org/donations.html
d208 1
a208 1
   [20]donations@@openbsd.org.
d220 1
a220 1
       Send e-mail to [21]donations@@openbsd.org to find out how to
d226 1
a226 1
       inquire as to current need. Write to [22]donations@@openbsd.org to
d233 1
a233 1
       [23]faq@@openbsd.org). Form a local user group and get your friends
d250 1
a250 1
   [24][To Section 2.0 - Other OpenBSD information resources]
d253 2
a254 2
   [25][back] [26]www@@openbsd.org
   $OpenBSD: faq1.html,v 1.15 1999/09/22 22:11:23 ericj Exp $
d258 32
a289 26
   1. http://openbsd.org/faq/index.html
   2. http://openbsd.org/index.html
   3. http://openbsd.org/index.html
   4. http://openbsd.org/i386.html
   5. http://openbsd.org/sparc.html
   6. http://openbsd.org/alpha.html
   7. http://openbsd.org/hp300.html
   8. http://openbsd.org/amiga.html
   9. http://openbsd.org/mac68k.html
  10. http://openbsd.org/powerpc.html
  11. http://openbsd.org/pmax.html
  12. http://openbsd.org/mvme88k.html
  13. http://openbsd.org/faq/faq3.html
  14. http://openbsd.org/arc.html
  15. http://openbsd.org/mvme68k.html
  16. http://openbsd.org/plat.html
  17. http://openbsd.org/faq/faq8.html#8.12
  18. http://openbsd.org/policy.html
  19. http://openbsd.org/donations.html
  20. mailto:donations@@openbsd.org
  21. mailto:donations@@openbsd.org
  22. mailto:donations@@openbsd.org
  23. mailto:faq@@openbsd.org
  24. http://openbsd.org/faq/faq2.html
  25. http://openbsd.org/faq/index.html
  26. mailto:www@@openbsd.org
d291 1
d293 2
a294 2
   [1][Back to Main Index] [2][To Section 1.0 - Introduction to OpenBSD]
   [3][To Section 3.0 - Obtaining OpenBSD]
d296 6
a301 1
                   2.0 - Other OpenBSD information resources
d306 1
a306 1
   [4]http://www.OpenBSD.org
d312 2
a313 2
   [5]http://www.monkey.org/openbsd-mobile/ and
   [6]http://www.cpio.net/openbsd/laptops/
d319 1
a319 1
   send an e-mail message to [7]majordomo@@openbsd.org. That address is an
d336 1
a336 1
   [8]majordomo@@openbsd.org. It might look like this:
d341 1
a341 1
   message to [9]majordomo@@openbsd.org with a message body of "help".
d353 1
a353 1
   mailing lists web page: [10]http://www.openbsd.org/mail.html
d355 1
a355 1
   [11]http://www.monkey.org/cgi-bin/wilma . This website contains
d359 1
a359 1
   [12]openbsd-mobile@@monkey.org. This mailing list is a discussion of
d367 1
a367 1
   [13]http://www.monkey.org/openbsd-mobile/archive/
d378 8
a385 8
     * [14]afterboot(8) - things to check after the first complete boot
     * [15]boot(8) - system boot strapping procedures
     * [16]passwd.conf(5) - format of the password configuration file
     * [17]adduser_proc(8) - procedure for adding new users
     * [18]adduser(8) - command for adding new users
     * [19]vipw(8) - edit the pass word file
     * [20]man(1) - display the on-line manual pages
     * [21]sendbug(1) - send a problem report (PR) about OpenBSD to a
d387 7
a393 7
     * [22]disklabel(8) - Read and write disk pack label.
     * [23]ifconfig(8) - configure network interface parameters.
     * [24]route(8) - manually manipulate the routing tables.
     * [25]netstat(1) - show network status.
     * [26]reboot, halt(8) - Stopping and restarting the system.
     * [27]shutdown(8) - close down the system at a given time.
     * [28]boot_config(8) - how to change kernel configuration at boot
d397 1
a397 1
   [29]http://www.openbsd.org/cgi-bin/man.cgi.
d460 1
a460 1
   tree unformatted, and many times thru the use of [30]CVS, they will be
d476 1
a476 1
   program like gv (GhostView). GhostView can be found in our [31]Ports
d483 1
a483 1
   [32]http://www.openbsd.org/report.html
d570 3
a572 3
       [33]http://cvs.openbsd.org/cgi-bin/wwwgnats.pl.
     * Look in the [34]bugs@@openbsd.org list archives:
       [35]http://www.openbsd.org/mail.html.
d574 2
a575 2
   [36][Back to Main Index] [37][To Section 1.0 - Introduction to
   OpenBSD] [38][To Section 3.0 - Obtaining OpenBSD]
d578 2
a579 2
   [39][back] [40]www@@openbsd.org
   $OpenBSD: faq2.html,v 1.18 1999/09/22 22:18:13 ericj Exp $
d583 7
a589 7
   1. http://openbsd.org/faq/index.html
   2. http://openbsd.org/faq/faq1.html
   3. http://openbsd.org/faq/faq3.html
   4. http://www.openbsd.org/
   5. http://www.monkey.org/openbsd-mobile/
   6. http://www.cpio.net/openbsd/laptops/
   7. mailto:majordomo@@openbsd.org
d592 32
a623 31
  10. http://openbsd.org/mail.html
  11. http://www.monkey.org/cgi-bin/wilma
  12. mailto:openbsd-mobile@@monkey.org
  13. http://www.monkey.org/openbsd-mobile/archive/
  14. http://www.openbsd.org/cgi-bin/man.cgi?query=afterboot&apropos=0&sektion=8&format=html
  15. http://www.openbsd.org/cgi-bin/man.cgi?query=boot&apropos=0&sektion=8&format=html
  16. http://www.openbsd.org/cgi-bin/man.cgi?query=passwd.conf&apropos=0&sektion=5&format=html
  17. http://www.openbsd.org/cgi-bin/man.cgi?query=adduser_proc&apropos=0&sektion=8&format=html
  18. http://www.openbsd.org/cgi-bin/man.cgi?query=adduser&apropos=0&sektion=8&format=html
  19. http://www.openbsd.org/cgi-bin/man.cgi?query=vipw&apropos=0&sektion=8&format=html
  20. http://www.openbsd.org/cgi-bin/man.cgi?query=man&apropos=0&sektion=1&format=html
  21. http://www.openbsd.org/cgi-bin/man.cgi?query=sendbug&apropos=0&sektion=1&format=html
  22. http://www.openbsd.org/cgi-bin/man.cgi?query=disklabel&apropos=0&sektion=8&format=html
  23. http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&apropos=0&sektion=8&format=html
  24. http://www.openbsd.org/cgi-bin/man.cgi?query=route&apropos=0&sektion=8&format=html
  25. http://www.openbsd.org/cgi-bin/man.cgi?query=netstat&apropos=0&sektion1&format=html
  26. http://www.openbsd.org/cgi-bin/man.cgi?query=reboot&apropos=0&sektion=8&format=html
  27. http://www.openbsd.org/cgi-bin/man.cgi?query=shutdown&apropos=0&sektion=8&format=html
  28. http://www.openbsd.org/cgi-bin/man.cgi?query=boot_config&apropos=0&sektion=8&format=html
  29. http://www.openbsd.org/cgi-bin/man.cgi
  30. http://openbsd.org/faq/faq8.html#8.5
  31. http://openbsd.org/ports.html
  32. http://openbsd.org/report.html
  33. http://cvs.openbsd.org/cgi-bin/wwwgnats.pl
  34. mailto:bugs@@openbsd.org
  35. http://www.openbsd.org/mail.html
  36. http://openbsd.org/faq/index.html
  37. http://openbsd.org/faq/faq1.html
  38. http://openbsd.org/faq/faq3.html
  39. http://openbsd.org/faq/index.html
  40. mailto:www@@openbsd.org
d626 1
a626 2
   [1][Back to Main Index] [2][To Section 2.0 - Other OpenBSD information
   resources] [3][To Section 4.0 - Installation Guide]
d628 9
a636 1
                            3.0 - Obtaining OpenBSD
d642 1
a642 1
   [4]http://www.openbsd.org/orders.html.
d668 1
a668 1
   these at [5]http://www.OpenBSD.org/tshirts.html. Enjoy :)
d680 1
a680 1
   [6]http://www.openbsd.org/ftp.html
d690 1
a690 1
   [7]http://www.openbsd.org/anoncvs.html.
d692 1
a692 1
   or check [8]The OpenBSD FAQ
d700 1
a700 1
   [9]http://www.openbsd.org/ctm.html.
d704 1
a704 1
   [10]Http://www.openbsd.org/cgi-bin/cvsweb/
d706 2
a707 2
   [11][Back to Main Index] [12][To Section 2.0 - Other OpenBSD
   information resources] [13][To Section 4.0 - Installation Guide]
d710 2
a711 2
   [14][back] [15]www@@openbsd.org
   $OpenBSD: faq3.html,v 1.9 1999/09/15 05:16:23 ericj Exp $
d715 17
a731 15
   1. http://openbsd.org/faq/index.html
   2. http://openbsd.org/faq/faq2.html
   3. http://openbsd.org/faq/faq4.html
   4. http://openbsd.org/orders.html
   5. http://openbsd.org/tshirts.html
   6. http://openbsd.org/ftp.html
   7. http://openbsd.org/anoncvs.html
   8. http://openbsd.org/faq/faq8.html#8.5
   9. http://openbsd.org/ctm.html
  10. http://www.openbsd.org/cgi-bin/cvsweb/
  11. http://openbsd.org/faq/index.html
  12. http://openbsd.org/faq/faq2.html
  13. http://openbsd.org/faq/faq4.html
  14. http://openbsd.org/faq/index.html
  15. mailto:www@@openbsd.org
d733 1
d735 2
a736 2
   [1][Back to Main Index] [2][To Section 3.0 - Obtaining OpenBSD] [3][To
   Section 5.0 - Kernel configuration and Disk Setup]
d738 10
a747 1
                           4.0 - Installation Guide.
d753 1
a753 1
   [4]http://www.openbsd.org/orders.html. If you are using either the
d780 1
a780 1
   through the rest of the install process use [5]log25.txt, which is an
d790 1
a790 1
   depending on your ROM version. Then simply follow the [6]install
d809 2
a810 2
   for the i386 architecture. And again follow the [7]install walkthrough
   guide.
d831 1
a831 1
   Consult the [8]install text for help.
d843 1
a843 1
   Consult the [9]install text for help.
d912 1
a912 1
   at the [10]NTLDR Hacking Guide.
d918 1
a918 1
   Some bootloaders of choice are [11]osbs20b8.zip or [12]The Ranish
d923 1
a923 1
   Please refer to [13]INSTALL.linux, which gives indepth instructions on
d942 1
a942 1
   Also check with [14]section 15.7
d960 2
a961 2
   [15][Back to Main Index] [16][To Section 3.0 - Obtaining OpenBSD]
   [17][To Section 5.0 - Kernel configuration and Disk Setup]
d964 2
a965 2
   [18][back] [19]www@@openbsd.org
   $OpenBSD: faq4.html,v 1.56 1999/09/15 05:16:23 ericj Exp $
d969 25
a993 19
   1. http://openbsd.org/faq/index.html
   2. http://openbsd.org/faq/faq3.html
   3. http://openbsd.org/faq/faq5.html
   4. http://openbsd.org/orders.html
   5. http://openbsd.org/faq/log25.txt
   6. http://openbsd.org/faq/log25.txt
   7. http://openbsd.org/faq/log25.txt
   8. http://openbsd.org/faq/log25.txt
   9. http://openbsd.org/faq/log25.txt
  10. http://www.dorsai.org/~dcl/publications/NTLDR_Hacking/
  11. http://www.freebird.org/sw-map/bootmanager.html
  12. http://www.users.intercom.com/~ranish/part/
  13. http://openbsd.org/faq/INSTALL.linux
  14. http://openbsd.org/faq/faq15.html#15.7
  15. http://openbsd.org/faq/index.html
  16. http://openbsd.org/faq/faq3.html
  17. http://openbsd.org/faq/faq5.html
  18. http://openbsd.org/faq/index.html
  19. mailto:www@@openbsd.org
d995 1
d997 2
a998 2
   [1][Back to Main Index] [2][To Section 4.0 - Installation Guide]
   [3][To Section 6.0 - Networking]
d1000 6
a1005 1
                   5.0 - Kernel Configuration and Disk Setup
d1028 1
a1028 1
   them, those that are most commonly used. Check the [4]options(4) man
d1039 6
a1044 6
     * [5]Alpha Kernel Conf Files
     * [6]i386 Kernel Configuration files
     * [7]mac68k Kernel Configuration files
     * [8]pmax Kernel Configuration Files
     * [9]sparc Kernel Configuration Files
     * [10]Other Arch's
d1050 1
a1050 1
   Kernel Config be sure to look through [11]/sys/conf/GENERIC and see
d1069 6
a1074 6
     * [12]COMPAT_SVR4(8) - Compatibility with SVR4 binaries.
     * [13]COMPAT_BSDOS(8) - Compatibility with BSD/OS binaries.
     * [14]COMPAT_LINUX(8) - Compatibility with Linux binaries.
     * [15]COMPAT_SUNOS(8) - Compatibility with SunOS binaries.
     * [16]COMPAT_ULTRIX(8) - Compatibility with Ultrix binaries.
     * [17]COMPAT_FREEBSD(8) - Compatibility with FreeBSD binaries.
d1077 1
a1077 1
     * [18]COMPAT_IBCS2(8) - Compatibility to run ibcs2 binaries.
d1094 1
a1094 1
     * [19]DDB - This compiles in the in-kernel debugger. This isn't
d1096 1
a1096 1
     * [20]KGDB - Compiles a remote kernel debugger using gdb's `remote
d1104 1
a1104 1
       allows users to use [21]ktrace(1).
d1108 1
a1108 1
       [22]kgmon(8).
d1130 1
a1130 1
     * NULLFS - Code to have a loopback filesystem. [23]mount_null(8) has
d1149 1
a1149 1
       softupdates more read the [24]Softupdates FAQ section.
d1160 1
a1160 1
       Read [25]options(4) for more details.
d1162 1
a1162 1
       read [26]FAQ 10
d1175 1
a1175 1
       arch's. Read [27]lkm(4) for more information.
d1177 1
a1177 1
       [28]init(8) for more information on kernel security levels.
d1184 2
a1185 2
       Default is 8. For more on CCD read the [29]CCD(4) man page, or the
       [30]Performance Tuning FAQ section.
d1192 1
a1192 1
   Also check the [31]Networking FAQ or the [32]Networking Performance
d1204 1
a1204 1
       of mbuf clusters. Read [33]options(4) for more information on this
d1207 1
a1207 1
       [34]ns(4)
d1209 1
a1209 1
       See [35]iso(4) for more information.
d1233 1
a1233 1
     * PPP_FILTER - This option turns on [36]pcap(3) based filtering for
d1238 1
a1238 1
       [37]ipsec(4) for more details. This now implies option KEY, which
d1275 1
a1275 1
   [38]afterboot(8) man page.
d1302 1
a1302 1
#config SOMEFILE (read more about it here : [39]config(8))
d1320 1
a1320 1
   new bootblocks. To do so, read [40]faq15.8 on OpenBSD's Bootloader.
d1335 1
a1335 1
   Most of this document can be found in the man page [41]boot_config(8)
d1367 1
a1367 1
   and Compile a new kernel. Refer to [42]Building your own kernel for
d1370 2
a1371 2
   [43][Back to Main Index] [44][To Section 4.0 - Installation Guide]
   [45][To Section 6.0 - Networking]
d1374 2
a1375 2
   [46][back] [47]www@@openbsd.org
   $OpenBSD: faq5.html,v 1.31 1999/09/15 05:16:23 ericj Exp $
d1379 48
a1426 47
   1. http://openbsd.org/faq/index.html
   2. http://openbsd.org/faq/faq4.html
   3. http://openbsd.org/faq/faq6.html
   4. http://www.openbsd.org/cgi-bin/man.cgi?query=options&apropos=0&sektion=4&format=html
   5. http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/alpha/conf/
   6. http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/i386/conf/
   7. http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/mac68k/conf/
   8. http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/pmax/conf/
   9. http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/sparc/conf/
  10. http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/
  11. http://www.openbsd.org/cgi-bin/cvsweb/src/sys/conf/GENERIC
  12. http://www.openbsd.org/cgi-bin/man.cgi?query=compat_svr4&sektion=8&apropos=0&manpath=OpenBSD+Current
  13. http://www.openbsd.org/cgi-bin/man.cgi?query=compat_bsdos&sektion=8&apropos=0&manpath=OpenBSD+Current
  14. http://www.openbsd.org/cgi-bin/man.cgi?query=compat_linux&sektion=8&apropos=0&manpath=OpenBSD+Current
  15. http://www.openbsd.org/cgi-bin/man.cgi?query=compat_sunos&sektion=8&apropos=0&manpath=OpenBSD+Current
  16. http://www.openbsd.org/cgi-bin/man.cgi?query=compat_ultrix&sektion=8&apropos=0&manpath=OpenBSD+Current
  17. http://www.openbsd.org/cgi-bin/man.cgi?query=compat_freebsd&sektion=8&apropos=0&manpath=OpenBSD+Current
  18. http://www.openbsd.org/cgi-bin/man.cgi?query=compat_ibcs2&sektion=8&apropos=0&manpath=OpenBSD+Current
  19. http://www.openbsd.org/cgi-bin/man.cgi?query=ddb&sektion=4&format=html
  20. http://www.openbsd.org/cgi-bin/man.cgi?query=gdb&sektion=1&format=html
  21. http://www.openbsd.org/cgi-bin/man.cgi?query=ktrace&sektion=1&format=html
  22. http://www.openbsd.org/cgi-bin/man.cgi?query=kgmon&sektion=8&format=html
  23. http://www.openbsd.org/cgi-bin/man.cgi?query=mount_null&sektion=8&format=html
  24. http://openbsd.org/faq/faq15.html#15.5
  25. http://www.openbsd.org/cgi-bin/man.cgi?query=options&sektion=4&format=html
  26. http://openbsd.org/faq/faq10.html#10.10
  27. http://www.openbsd.org/cgi-bin/man.cgi?query=lkm&sektion=4&format=html
  28. http://www.openbsd.org/cgi-bin/man.cgi?query=init&sektion=8&format=html
  29. http://www.openbsd.org/cgi-bin/man.cgi?query=ccd&sektion=4&format=html
  30. http://openbsd.org/faq/faq12.html#12.2
  31. http://openbsd.org/faq/faq6.html
  32. http://openbsd.org/faq/faq12.html#12.1
  33. http://www.openbsd.org/cgi-bin/man.cgi?query=options&sektion=4&format=html
  34. http://www.openbsd.org/cgi-bin/man.cgi?query=ns&sektion=4&apropos=0&manpath=OpenBSD+Current
  35. http://www.openbsd.org/cgi-bin/man.cgi?query=iso&sektion=4&format=html
  36. http://www.openbsd.org/cgi-bin/man.cgi?query=pcap&sektion=3&format=html
  37. http://www.openbsd.org/cgi-bin/man.cgi?query=ipsec&sektion=4&format=html
  38. http://www.openbsd.org/cgi-bin/man.cgi?query=afterboot&apropos=0&sektion=8&format=html
  39. http://www.openbsd.org/cgi-bin/man.cgi?query=config&apropos=0&sektion=8&format=html
  40. http://openbsd.org/faq/faq15.html#15.8
  41. http://www.openbsd.org/cgi-bin/man.cgi?query=boot_config&apropos=0&sektion=8&format=html
  42. http://openbsd.org/faq/faq5.html#5.3
  43. http://openbsd.org/faq/index.html
  44. http://openbsd.org/faq/faq4.html
  45. http://openbsd.org/faq/faq6.html
  46. http://openbsd.org/faq/index.html
  47. mailto:www@@openbsd.org
d1429 1
a1429 2
   [1][Back to Main Index] [2][To Section 5.0 - Kernel configuration and
   Disk Setup] [3][To Section 7.0 - Keyboard controls]
d1431 9
a1439 1
                               6.0 - Networking
d1447 1
a1447 1
   basic TCP/IP knowledge. If not, go to the [4]Kernel Configuration and
d1449 1
a1449 1
   recommended reading is the [5]ifconfig(8) and [6]netstat(1) man pages.
d1584 1
a1584 1
   [7]section 12 for further information on tuning NMBCLUSTERS if you are
d1597 1
a1597 1
   [8]routed(8), [9]gated, [10]mrtd, and [11]zebra. OpenBSD has support
d1602 1
a1602 1
6.2 - IP Filter - ipf and ipnat setup
d1605 2
a1606 2
   packet level forwarding permissions [12]ipf(8) and mapping
   hosts/subnets to a range of external addresses [13]ipnat(8). The
d1636 2
a1637 2
   at the IP Filter [14]mailing list archive, the [15]IP Filter web site,
   and finally the [16]IP Filter HOWTO.
d1643 1
a1643 1
   usage, for a more strict definition see [17]ipf(5). Here is assumed
d1672 24
a1695 1
  IPNAT
d1697 9
a1705 1
   Based on [18]RFC 1631, ipnat provides an easy way to map internal
d1709 1
a1709 1
   you can take advantage of reserved address blocks (assigned in [19]RFC
d1715 156
d1872 1
a1872 10
   To use ipnat, ipf must be activated. As outlined above, for changes to
   stay effective through reboots, you should make changes to
   /etc/rc.conf (where it has IPNAT and IPFILTER.) You can manually
   activate ipf with the command below.
# ipf -E

   Example: You have an internal network using 192.168.5.0, with a
   netmask of 255.255.255 0, and you want to give it access to internet
   using OpenBSD (of course!), and a ppp connection using address
   200.1.2.3, use this rule:
d1874 39
a1912 1
map tun0 192.168.5.0/24 -> 200.1.2.3/32
d1914 4
a1917 1
   This rule means:
d1919 129
a2047 74
   "Any IP connections going out tun0 from an address matching the first
   24 bits of 192.168.5.0 should be mapped to the address 200.1.2.3 (only
   one address since /32 means every bit)"

   If you don't like using CIDR notation, IP Filter also allows you to
   use netmasks. A functional equivalent to the example above, using
   netmasks looks like this:

map tun0 192.168.5.0/255.255.255.0 -> 200.1.2.3/255.255.255.255

   But here arises a problem. You are assigning a lot of addresses to
   only one address. But the port numbers aren't changing, and it is very
   likely that your workstations on 192.168.5.0/24 will use the same port
   numbers to initiate connections from. (If this doesn't make sense,
   don't worry, but keep reading.) The way to go around it is to map TCP
   and UDP ports to a certain range with the option "portmap". Since ICMP
   doesn't even use ports, it is not covered by the "portmap" rule. (ICMP
   uses an ID field usually based on a process number) In our example,
   there are now two map rules to cover all of these protocols. The end
   result looks like this:

map tun0 192.168.5.0/24 -> 200.1.2.3/32 portmap tcp/udp 10000:65000
map tun0 192.168.5.0/24 -> 200.1.2.3/32

   If you have a dynamic address assignment (as in, you do not know what
   address they will give you when you connect), you can put the
   interface name in place of the IP address. Note that if you do this,
   you will have to run ipnat -CF -f /etc/ipnat.rules every time your IP
   address changes (or, every time you dial up.)

map tun0 192.168.5.0/24 -> tun0/32 portmap tcp/udp 10000:65000
map tun0 192.168.5.0/24 -> tun0/32

   NAT is also able to help you in renumbering. Say you were assigned a
   net block 35.8.9.0/22, and your internet provider can no longer route
   these addresses to you, or say you are switching providers. Your new
   address block is 192.9.4.0/22, but to switch all 500 devices you have
   on this block would be very time consuming! ipnat provides a feature
   called bimap:

bimap xl0 35.8.9.0/22 -> 192.9.4.0/22

   This will literally map every computer in 35.8.9.0 to a new address in
   192.9.4.0. The drawback of this feature is that the translation is not
   consistent. A computer that initiates a connection from 35.8.9.0 will
   get a random IP address from 192.9.4.0. A future version of IP Filter
   will allow for one-to-one translation (where 35.8.9.99 will always get
   mapped to 192.9.4.99).

   And of course, there are other potential uses of NAT that are probably
   beyond the scope of this document.

  Redirecting ports

   This is another very handy feature of IPNAT. If you have a host on the
   internal network (using private addresses), and you want to let
   incoming connections to it, you just need a simple redirect rule. For
   example, if you have a web server on internal network at 10.2.2.7
   listening on port 80, and want it to be accessible from the outside
   simply redirecting external IP 120.2.3.4 on xl0, just add this rule to
   /etc/ipnat.rules:

rdr xl0 120.2.3.4 port 80 -> 10.2.2.7 port 80

   When you write rules, it may help to visualize the packet flow.

Internet <--> (xl0 120.2.3.4) OpenBSD (xl1 10.2.2.1) <--> LAN <--> (10.2.2.7 XY
Z Web server)

   One last reminder that you must have net.inet.ip.forwarding=1 or
   option IPFORWARDING to use IP Filter (ipf, ipnat). Also, redirect only
   works for packets that are being routed through the OpenBSD box. If a
   web browser from inside the NAT (say, from 10.2.2.5 from the example
   above) tries to connect to port 80 on 120.2.3.4, nothing will happen.
d2049 1
a2049 1
6.3 - DHCP
d2051 1
a2051 1
   To use the DHCP client [20]dhclient(8) included with OpenBSD, edit
d2061 1
a2061 1
   If you want to use OpenBSD as a DHCP server [21]dhcpd(8), edit
d2086 1
a2086 1
6.4 - PPP
d2090 2
a2091 2
     * [22]pppd(8) - Which is the kernel ppp daemon.
     * [23]ppp(8) - Which is the userland ppp daemon.
d2102 1
a2102 1
   your ppp. The userland PPP daemon uses the file [24]/etc/ppp/ppp.conf
d2130 1
a2130 1
   logging levels. This can be changed, refer to [25]ppp(8) for more info
d2205 2
a2206 2
     * [26]ppp.linkup
     * [27]ppp.linkdown
d2208 2
a2209 2
   [28][Back to Main Index] [29][To Section 5.0 - Kernel configuration
   and Disk Setup] [30][To Section 7.0 - Keyboard controls]
d2212 2
a2213 2
   [31][back] [32]www@@openbsd.org
   $OpenBSD: faq6.html,v 1.26 1999/09/15 13:44:59 ericj Exp $
d2217 55
a2271 32
   1. http://openbsd.org/faq/index.html
   2. http://openbsd.org/faq/faq5.html
   3. http://openbsd.org/faq/faq7.html
   4. http://openbsd.org/faq/faq5.html
   5. http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&apropos=0&sektion=8&format=html
   6. http://www.openbsd.org/cgi-bin/man.cgi?query=netstat&apropos=0&sektion=1&format=html
   7. http://openbsd.org/faq/faq12.html
   8. http://www.openbsd.org/cgi-bin/man.cgi?query=routed&apropos=0&sektion=8&format=html
   9. http://www.gated.org/
  10. http://www.mrtd.net/
  11. http://www.zebra.org/
  12. http://www.openbsd.org/cgi-bin/man.cgi?query=ipf&apropos=0&sektion=8&format=html
  13. http://www.openbsd.org/cgi-bin/man.cgi?query=ipnat&apropos=0&sektion=8&format=html
  14. http://false.net/ipfilter/
  15. http://cheops.anu.edu.au/~avalon/ip-filter.html
  16. http://www.swcp.com/~synk/ipf-howto.txt
  17. http://www.openbsd.org/cgi-bin/man.cgi?query=ipf&apropos=0&sektion=5&format=html
  18. http://www.geektools.com/rfc/rfc1631.txt
  19. http://www.geektools.com/rfc/rfc1918.txt
  20. http://www.openbsd.org/cgi-bin/man.cgi?query=dhclient&apropos=0&sektion=8&format=html
  21. http://www.openbsd.org/cgi-bin/man.cgi?query=dhcpd&apropos=0&sektion=8&format=html
  22. http://www.openbsd.org/cgi-bin/man.cgi?query=pppd&sektion=8&format=html
  23. http://www.openbsd.org/cgi-bin/man.cgi?query=ppp&sektion=8&format=html
  24. http://www.openbsd.org/cgi-bin/cvsweb/src/etc/ppp/ppp.conf.sample
  25. http://www.openbsd.org/cgi-bin/man.cgi?query=ppp&sektion=8&format=html
  26. http://www.openbsd.org/cgi-bin/cvsweb/src/etc/ppp/ppp.linkup.sample
  27. http://www.openbsd.org/cgi-bin/cvsweb/src/etc/ppp/ppp.linkdown.sample
  28. http://openbsd.org/faq/index.html
  29. http://openbsd.org/faq/faq5.html
  30. http://openbsd.org/faq/faq7.html
  31. http://openbsd.org/faq/index.html
  32. mailto:www@@openbsd.org
d2274 4
a2277 2
   [1][Back to Main Index] [2][To Section 6.0 - Networking] [3][To
   Section 8.0 - General Questions]
d2279 4
a2282 1
                            7.0 - Keyboard controls
d2298 1
a2298 1
   [4][Back to Main Index] [5][To Section 6.0 - Networking] [6][To
d2302 2
a2303 2
   [7][back] [8]www@@openbsd.org
   $OpenBSD: faq7.html,v 1.6 1999/07/03 05:51:35 ericj Exp $
d2307 7
a2313 8
   1. http://openbsd.org/faq/index.html
   2. http://openbsd.org/faq/faq6.html
   3. http://openbsd.org/faq/faq8.html
   4. http://openbsd.org/faq/index.html
   5. http://openbsd.org/faq/faq6.html
   6. http://openbsd.org/faq/faq8.html
   7. http://openbsd.org/faq/index.html
   8. mailto:www@@openbsd.org
d2316 1
a2316 2
   [1][Back to Main Index] [2][To Section 7.0 - Keyboard controls] [3][To
   Section 9.0 - Tips for linux users]
d2318 18
a2335 1
                            8.0 - General Questions
d2348 3
a2350 3
   need to check into that. See [4]faq10 Kerberos Setup FAQ. If you can't
   STAND that warning and never plan on using Kerberos here is how to get
   rid of it for good.
d2402 1
a2402 1
   [5]http://www.xfree86.org/FAQ/.
d2408 1
a2408 1
   about CVS at [6]http://www.cyclic.com/. CVS can be used by the end
d2438 1
a2438 1
   [7]http://www.openbsd.org/anoncvs.html Once you have chosen a server
d2440 1
a2440 1
   three main modules availible for checkout from the CVS tree. These
d2446 1
a2446 1
       [8]Section 8.6 of the OpenBSD FAQ.
d2456 1
a2456 1
   2022. Be sure to check [9]http://www.openbsd.org/anoncvs.html for
d2492 1
a2492 1
   [10]http://www.openbsd.org/anoncvs.html. In this example I will be
d2532 1
a2532 1
   downloaded from any of the [11]OpenBSD ftp servers as
d2636 1
a2636 1
   help please see: [12]http://www.openbsd.org/ports.html
d2663 1
a2663 1
   Again, like with ports you can use the [13]pkg_info(1) program to view
d2666 2
a2667 2
   To delete packages you will want to use the [14]pkg_delete(1) command.
   It is used the same way as [15]pkg_add(1).
d2672 1
a2672 1
   Packages can be found on any of the [16]OpenBSD ftp mirror sites, or
d2695 1
a2695 1
   [17]boot(8) man page. Here we will go over the most common used
d2713 1
a2713 1
       the [18]Boot Time Config section of the faq.
d2721 1
a2721 1
   For further reading you can read [19]boot_i386(8) man page
d2731 4
a2734 4
     * [20]md4
     * [21]md5
     * [22]sha1
     * [23]rmd160.
d2744 1
a2744 1
   this you will have to use [24]skeyinit(1). With skeyinit(1), you will
d2813 1
a2813 1
   [25]skeyinfo(1), and it will tell you what to use. For example here, I
d2820 1
a2820 1
   use [26]skey(1). I can use exactly that output from above to create my
d2883 1
a2883 1
   [27]http://www.macbsd.com/macbsd/macbsd-docs/faq/faq-3.html#ss3.17
d2887 1
a2887 1
   The answer is in [28]../i386.html:
d2893 1
a2893 1
   please refer to [29]../donations.html to have support in the future.
d2895 2
a2896 2
   [30][Back to Main Index] [31][To Section 7.0 - Keyboard controls]
   [32][To Section 9.0 - Tips for linux users]
d2899 2
a2900 2
   [33][back] [34]www@@openbsd.org
   $OpenBSD: faq8.html,v 1.30 1999/09/07 20:38:28 ericj Exp $
d2904 44
a2947 34
   1. http://openbsd.org/faq/index.html
   2. http://openbsd.org/faq/faq7.html
   3. http://openbsd.org/faq/faq9.html
   4. http://openbsd.org/faq/faq10.html#10.11
   5. http://www.xfree86.org/FAQ/
   6. http://www.cyclic.com/
   7. http://openbsd.org/anoncvs.html
   8. http://openbsd.org/faq/faq8.html#8.6
   9. http://openbsd.org/anoncvs.html
  10. http://openbsd.org/anoncvs.html
  11. http://openbsd.org/ftp.html
  12. http://openbsd.org/ports.html
  13. http://www.openbsd.org/cgi-bin/man.cgi?query=pkg_info&sektion=1&format=html
  14. http://www.openbsd.org/cgi-bin/man.cgi?query=pkg_delete&sektion=1&format=html
  15. http://www.openbsd.org/cgi-bin/man.cgi?query=pkg_add&sektion=1&format=html
  16. http://openbsd.org/ftp.html
  17. http://www.openbsd.org/cgi-bin/man.cgi?query=boot&sektion=8&format=html
  18. http://openbsd.org/faq/faq5.html#5.4
  19. http://www.OpenBSD.org/cgi-bin/man.cgi?query=boot_i386&sektion=8&format=html
  20. http://www.openbsd.org/cgi-bin/man.cgi?query=md4&sektion=3&format=html
  21. http://www.openbsd.org/cgi-bin/man.cgi?query=md5&sektion=3&format=html
  22. http://www.openbsd.org/cgi-bin/man.cgi?query=sha1&sektion=3&format=html
  23. http://www.openbsd.org/cgi-bin/man.cgi?query=rmd160&sektion=3&format=html
  24. http://www.openbsd.org/cgi-bin/man.cgi?query=skeyinit&sektion=1&format=html
  25. http://www.openbsd.org/cgi-bin/man.cgi?query=skeyinfo&sektion=1&format=html
  26. http://www.openbsd.org/cgi-bin/man.cgi?query=skey&sektion=1&format=html
  27. http://www.macbsd.com/macbsd/macbsd-docs/faq/faq-3.html#ss3.17
  28. http://openbsd.org/i386.html
  29. http://openbsd.org/donations.html
  30. http://openbsd.org/faq/index.html
  31. http://openbsd.org/faq/faq7.html
  32. http://openbsd.org/faq/faq9.html
  33. http://openbsd.org/faq/index.html
  34. mailto:www@@openbsd.org
d2949 1
d2951 2
a2952 2
   [1][Back to Main Index] [2][To Section 8.0 - General Questions] [3][To
   Section 10.0 - System Administration]
d2954 7
a2960 1
                          9.0 - Migrating from Linux
d2981 1
a2981 1
       convenient and easy to use [4]web interface to CVS.
d2985 1
a2985 1
       contain. (See [5]http://www.openbsd.org/crypto.html) OpenBSD has
d2998 3
a3000 3
          + IP-Masquerading is done through ipnat. ([6]ipnat(1))
          + ipfwadm is done through ipf ([7]ipf(1), [8]ipf(5))
          + You should look at [9]section 6 for detailed configuration
d3011 1
a3011 1
       ([10]passwd(1), [11]passwd(5))
d3021 1
a3021 1
   Read [12]INSTALL.linux
d3027 1
a3027 1
   it is, grab [13]John the Ripper and use the unshadow utility that
d3061 1
a3061 1
   to follow the instructions on the [14]compat_linux(8) manual page. A
d3064 1
a3064 1
   collection read [15]FAQ 8.6. If you already have the ports tree
d3073 1
a3073 1
   [16]FAQ 15.1.
d3075 2
a3076 2
   [17][Back to Main Index] [18][To Section 8.0 - General Questions]
   [19][To Section 10.0 - System Administration]
d3079 2
a3080 2
   [20][back] [21]www@@openbsd.org
   $OpenBSD: faq9.html,v 1.12 1999/09/22 22:05:28 ericj Exp $
d3084 23
a3106 21
   1. http://openbsd.org/faq/index.html
   2. http://openbsd.org/faq/faq8.html
   3. http://openbsd.org/faq/faq10.html
   4. http://www.openbsd.org/cgi-bin/cvsweb/
   5. http://openbsd.org/crypto.html
   6. http://www.openbsd.org/cgi-bin/man.cgi?query=ipnat&apropos=0&sektion=1&format=html
   7. http://www.openbsd.org/cgi-bin/man.cgi?query=ipf&apropos=0&sektion=1&format=html
   8. http://www.openbsd.org/cgi-bin/man.cgi?query=ipnat&apropos=0&sektion=5&format=html
   9. http://openbsd.org/faq/faq6.html
  10. http://www.openbsd.org/cgi-bin/man.cgi?query=passwd&apropos=0&sektion=1&format=html
  11. http://www.openbsd.org/cgi-bin/man.cgi?query=passwd&apropos=0&sektion=5&format=html
  12. http://openbsd.org/faq/INSTALL.linux
  13. http://www.false.com/security/john/
  14. http://www.openbsd.org/cgi-bin/man.cgi?query=compat_linux&sektion=8&format=html
  15. http://openbsd.org/faq/faq8.html#8.6
  16. http://openbsd.org/faq/faq15.html#15.1
  17. http://openbsd.org/faq/index.html
  18. http://openbsd.org/faq/faq8.html
  19. http://openbsd.org/faq/faq10.html
  20. http://openbsd.org/faq/index.html
  21. mailto:www@@openbsd.org
d3108 1
d3110 2
a3111 2
   [1][Back to Main Index] [2][To Section 9.0 - Migrating from Linux]
   [3][To Section 11.0 - OpenBSD 2.4 Specific Information]
d3113 18
a3130 1
                         10.0 - System Administration
d3138 2
a3139 2
   allowed to use the [4]su(1) userland program to become root. Users who
   are not in "wheel" cannot use su(1). Here is an example of a
d3142 1
a3142 1
   If you are adding a new user with [5]adduser(8), you can put them in
d3149 1
a3149 1
   [6]sudo(8).
d3153 1
a3153 1
   To duplicate your filesystem use [7]dump(8) and [8]restore(8). For
d3160 1
a3160 1
   entire) filesystem. The command [9]tar(1) may be faster for this
d3167 1
a3167 1
   the system. For common daemons you can simply edit [10]/etc/rc.conf.
d3250 1
a3250 1
   The steps shown here are taken in part from the [11]ssl(8) man page.
d3284 1
a3284 1
   /etc/passwd dynamically with [12]pwd_mkdb(8). The main password file
d3312 1
a3312 1
   The best way to add a user in OpenBSD is to use the [13]adduser(8)
d3319 1
a3319 1
   further instructions on adding users read the [14]adduser_proc(8) man
d3322 1
a3322 1
   To delete users you should use the [15]rmuser(8) utility. This will
d3359 1
a3359 1
   [16]edquota(8). A simple use is just edquota <user>. edquota(8) will
d3383 1
a3383 1
   this use [17]quotaon(8). For example:
d3388 1
a3388 1
   [18]quota(1). Using a command of quota <user> will give that users
d3422 1
a3422 1
     * [19]The FreeBSD handbook
d3424 2
a3425 2
     * [20]Designing an Authentication System: a Dialogue in Four Scenes
     * [21]Papers and Documentation Describing KerberosIV
d3428 1
a3428 1
     * [22]Network Security Private Communication in a Public World
d3446 1
a3446 1
   krb.realms. For more information on this refer to [23]krb.conf.
d3457 1
a3457 1
   Again, for further information read the [24]krb.realms. man page.
d3459 1
a3459 1
   Next we will run [25]kdb_init(8) to create the initial Kerberos
d3470 1
a3470 1
   Next we need to use [26]kstash(8) which is used to save the Kerberos
d3540 1
a3540 1
   command line, [27]ext_srvtab(8) creates the service key file
d3606 1
a3606 1
   privileges to a specific principal, see [28]the FreeBSD Handbook.
d3626 1
a3626 1
   you use [29]kinit(1).
d3633 1
a3633 1
   Now we have identified we can list our tickets with [30]klist(1).
d3662 1
a3662 1
   [31]kdestroy(1). For example:
d3672 1
a3672 1
   If you want ticket passing, use Dug Song's [32]krb4 SSH patches. Stock
d3689 2
a3690 2
   the [33]ftp(8) and [34]chroot(2) man pages. Here is an example of
   adding the ftp user. I will do this using [35]adduser(8). We also need
d3735 1
a3735 1
   the [36]ftp(8) man page.
d3785 1
a3785 1
   from [37]inetd.conf. First we must become familiar with some of the
d3821 2
a3822 2
   [38][Back to Main Index] [39][To Section 9.0 - Migrating from Linux]
   [40][To Section 11.0 - OpenBSD 2.4 Specific Information]
d3825 2
a3826 2
   [41][back] [42]www@@openbsd.org
   $OpenBSD: faq10.html,v 1.29 1999/09/07 18:30:17 ericj Exp $
d3830 51
a3880 42
   1. http://openbsd.org/faq/index.html
   2. http://openbsd.org/faq/faq9.html
   3. http://openbsd.org/faq/faq11-2.4.html
   4. http://www.openbsd.org/cgi-bin/man.cgi?query=su&apropos=0&sektion=1&format=html
   5. http://www.openbsd.org/cgi-bin/man.cgi?query=adduser&apropos=0&sektion=8&format=html
   6. http://www.openbsd.org/cgi-bin/man.cgi?query=sudo&sektion=8&format=html
   7. http://www.openbsd.org/cgi-bin/man.cgi?query=dump&sektion=8&format=html
   8. http://www.openbsd.org/cgi-bin/man.cgi?query=restore&sektion=8&format=html
   9. http://www.openbsd.org/cgi-bin/man.cgi?query=tar&sektion=1&format=html
  10. http://www.openbsd.org/cgi-bin/cvsweb/src/etc/rc.conf?rev=1.35
  11. http://www.openbsd.org/cgi-bin/man.cgi?query=ssl&apropos=0&sektion=8&format=html
  12. http://www.openbsd.org/cgi-bin/man.cgi?query=pwd_mkdb&sektion=8&apropos=0
  13. http://www.openbsd.org/cgi-bin/man.cgi?query=adduser&sektion=8&format=html
  14. http://www.openbsd.org/cgi-bin/man.cgi?query=adduser_proc&sektion=8&format=html
  15. http://www.openbsd.org/cgi-bin/man.cgi?query=rmuser&sektion=8&format=html
  16. http://www.openbsd.org/cgi-bin/man.cgi?query=edquota&sektion=8&format=html
  17. http://www.openbsd.org/cgi-bin/man.cgi?query=quotaon&sektion=8&format=html
  18. http://www.openbsd.org/cgi-bin/man.cgi?query=quota&sektion=1&format=html
  19. http://www.freebsd.org/handbook/kerberos.html
  20. http://web.mit.edu/kerberos/www/dialogue.html
  21. http://web.mit.edu/kerberos/www/papers.html#krb4
  22. http://www.amazon.com/exec/obidos/ASIN/0130614661/qid%3D930594963/
  23. http://www.openbsd.org/cgi-bin/man.cgi?query=krb.conf&sektion=5&format=html
  24. http://www.openbsd.org/cgi-bin/man.cgi?query=krb.realms&sektion=5&format=html
  25. http://www.openbsd.org/cgi-bin/man.cgi?query=kbd_init&sektion=8&format=html
  26. http://www.openbsd.org/cgi-bin/man.cgi?query=kstash&sektion=8&format=html
  27. http://www.openbsd.org/cgi-bin/man.cgi?query=ext_srvtab&sektion=8&format=html
  28. http://www.freebsd.org/handbook/kerberos.html#AEN4957
  29. http://www.openbsd.org/cgi-bin/man.cgi?query=kinit&sektion=1&format=html
  30. http://www.openbsd.org/cgi-bin/man.cgi?query=klist&sektion=1&format=html
  31. http://www.openbsd.org/cgi-bin/man.cgi?query=kdestroy&sektion=1&format=html
  32. http://www.monkey.org/~dugsong/ssh-afs-kerberos.html
  33. http://www.openbsd.org/cgi-bin/man.cgi?query=ftpd&sektion=8&format=html
  34. http://www.openbsd.org/cgi-bin/man.cgi?query=chroot&sektion=2&format=html
  35. http://www.openbsd.org/cgi-bin/man.cgi?query=adduser&sektion=8&format=html
  36. http://www.openbsd.org/cgi-bin/man.cgi?query=ftpd&sektion=8&format=html
  37. http://www.openbsd.org/cgi-bin/cvsweb/src/etc/inetd.conf
  38. http://openbsd.org/faq/index.html
  39. http://openbsd.org/faq/faq9.html
  40. http://openbsd.org/faq/faq11-2.4.html
  41. http://openbsd.org/faq/index.html
  42. mailto:www@@openbsd.org
d3883 4
a3886 2
   [1][Back to Main Index] [2][To Section 10.0 - System Administration]
   [3][To Section 12.0 - Performance Tuning]
d3888 3
a3890 1
                    11.0 - OpenBSD 2.4 Specific Information
d3898 1
a3898 1
   [4]http://www.openbsd.org/errata.html
d3903 1
a3903 1
   obtained here [5]http://www.openbsd.org/errata.html. This is fixed in
a3949 3

   [6][Back to Main Index] [7][To Section 10.0 - System Administration]
   [8][To Section 12.0 - Performance Tuning]
d3952 2
a3953 2
   [9][back] [10]www@@openbsd.org
   $OpenBSD: faq11-2.4.html,v 1.1 1999/08/31 00:49:18 chris Exp $
d3957 6
a3962 285
   1. http://openbsd.org/faq/index.html
   2. http://openbsd.org/faq/faq10.html
   3. http://openbsd.org/faq/faq12.html
   4. http://openbsd.org/errata.html#userdir
   5. http://openbsd.org/errata.html#installboot
   6. http://openbsd.org/faq/index.html
   7. http://openbsd.org/faq/faq11-2.4.html
   8. http://openbsd.org/faq/faq12.html
   9. http://openbsd.org/faq/index.html
  10. mailto:www@@openbsd.org

$OpenBSD: INSTALL.linux,v 1.2 1999/07/21 05:47:59 ericj Exp $

   Linux + OpenBSD: it's possible

   by Marc Espie --  espie@@cvs.OpenBSD.org

It is perfectly possible to have Linux and OpenBSD on the same disk.
As of this writing (OpenBSD 2.5 & linux 2.2.3), both can read and write
other partitions, though Linux's support of BSD filesystems is still
experimental. Please note that 2.0 linux kernels, and most 2.1 kernels
don't know how to handle OpenBSD partitions (other BSD partitions are type
A5 and differ significantly from OpenBSD partitions--type A6).

You can even install OpenBSD from an ext2fs partition (choose install from
disk... ext2fs does not appear in the choices, but `default' it is).

If you are starting from scratch, it is better to install Linux first.
Since you are going to use several OSes, you need a way to multi-boot, and
Linux's lilo fits the bill fine.

IMPORTANT: don't forget about lilo. You can't uninstall linux from this
disk without *first* restoring the MBR to an un-liloed state and making
*dead* sure OpenBSD boots as a default.

If you want to grab space from a Windows/DOS partition, use fips.
Fips20 knows all about FAT32, so windows 95 is no longer a problem.

Other sources of information, especially concerning other BSD systems,
must be taken with a healthy does of scepticism. OpenBSD definitely
differs:
- disklabels can hold up to 16 partitions,
- type is A6, not A5,
- the `special' partitions in the disklabel are only a (root), b (swap),
and c (whole disk).

Planning & Good advice
----------------------
If you are starting on a new machine, be prepared to throw your
installation away. It is generally the case that you will install the
machine, play with it for a week/a month, and find out that you don't like
the setup, and then start over.

Write down any interesting information you find out during your first
installation.  Don't do too many things to your box during the first month,
as you will lose these while reinstalling, unless you can do backups
conveniently.

Do you really need to have a dual-boot machines ? Most people don't need
both Linux and OpenBSD.  Once you're satisfied with OpenBSD, you may find
out you just want to erase Linux...

Try to find out what your precise needs are, locate partitions whose size
may change next to each other, as far as possible... Put partitions whose
contents are unimportant (or whose backups are always up-to-date) next to
the frontier between OpenBSD and Linux. For instance, it's usually a good
idea to locate the swap area such that you can grow or shrink it. Keep in
mind that exceptional usage (very large, temporary swaps) can use a
temporary file instead of a partition, under both OpenBSD (svnd) and Linux.

First principles
----------------
OpenBSD doesn't only use the MBR partitions (the ones mapped in the Master
Boot Record) for booting. Afterwards, it trusts some bsd specific
information called the disklabel, which is another completely distinct
description of your hard disk. It does not even have to be consistent with
the usual DOS partitions information.
[OpenBSD requires a primary MBR partition for booting, anything else is
officially unsupported.]

Throughout this document, we will distinguish between MBR partitions and
disklabel partitions whenever this is necessary.

The safest way to deal with things is to allocate one primary MBR partition for
OpenBSD, type A6, that you will partition further with disklabel.

If you can, it is even safer to devote a full disk to OpenBSD: this limits
the number of mistakes you can do. Admittedly there are some cases where
this isn't a option (my machine is a laptop... I have to cope with the
hard disk I have), or where this can be slower (SCSI disk setups will
yield better throughput with swap interleaved among the disks).

Prime rule: *ALWAYS* use the disk partitioning tools that go with the OS.
They know more about its internal workings than you do. So use linux fdisk
for linux partitions, don't let it touch the OpenBSD disklabel, and
reciprocally.

DOS and BIOS and all the problems of the world
----------------------------------------------
Due to historical accident, your machine resident `Operating System',
also known as the BIOS, can only access hard-disks up to cylinder 1024.
Various lying tricks are used, so that your whole disk is usually
accessible to the BIOS, except for very large disks (>8Gb).

fdisk is usually going to give you reliable information: anything that is
before cylinder 1024 can be accessed through the BIOS.

When you first boot up OpenBSD, the kernel will detect your hardware,
and give you a message such as
  wd0 at wdc0 drive 0: <TOSHIBA MK4006MAV>
  wd0: 3909MB, 7944 cyl, 16 head, 63 sec, 512 bytes/sec, 8007552 sec total
  wd0: using 16-sector 16-bit pio transfers, lba addressing
don't panic. This is just the real disk geometry. Trust fdisk on this one.

If fdisk shows you more than 1024 cylinders, you will have to cram OpenBSD
into that. Actually, it's enough that the disklabel partition used for
booting fits within the first 1024 cylinders (a:), so if you can get your
OpenBSD partition to start within 1024 cylinders, just get a small enough
a:, and you're in the clear.  (You can get by with a: a bit under 20Mb,
BTW, just enough for /bin /sbin, a kernel and /etc).

Mapping your disk
-----------------
Starting from Linux, get a grasp of your partitions. Use df to check which
is what, then fdisk to get the actual setup of the disk.

Write down the setup onto a bit of paper, in case you make a mistake further
down.  It can come in very handy.

Disk /dev/hda: 128 heads, 63 sectors, 993 cylinders
Units = cylinders of 8064 * 512 bytes

   Device Boot    Start      End   Blocks   Id  System
/dev/hda1             1      211   850720+   6  DOS 16-bit >=32M
/dev/hda2           212      273   249984   83  Linux native
/dev/hda3           274      992  2899008   a6  OpenBSD

The + at the end of the DOS line is because linux fdisk is brain-damaged
and wants to write output in 1024-sized chunks, so this stands for
`850720 blocks and a half'

Older flavors of linux fdisk won't recognize a6 as OpenBSD.

As you can see, my linux setup is very small. I have enough to check how
things such as gcc work on linux, but my machine is definitely an
OpenBSD developper's box.

Get the display to sectors with u, and jot down the corresponding
information as well:

Disk /dev/hda: 128 heads, 63 sectors, 993 cylinders
Units = sectors of 1 * 512 bytes

   Device Boot    Start      End   Blocks   Id  System
/dev/hda1            63  1701503   850720+   6  DOS 16-bit >=32M
/dev/hda2       1701504  2201471   249984   83  Linux native
/dev/hda3       2201472  7999487  2899008   a6  OpenBSD
--
Okay, finally switch to expert mode, and write the corresponding data.

Disk /dev/hda: 128 heads, 63 sectors, 993 cylinders

Nr AF  Hd Sec  Cyl  Hd Sec  Cyl   Start    Size ID
 1 00   1   1    0 127  63  210      63 1701441 06
 2 00   0   1  211 127  63  272 1701504  499968 83
 3 00   0   1  273 127  63  991 2201472 5798016 a6
 4 00   0   0    0   0   0    0       0       0 00


Note that this is STILL the same data. The good point about this last
display is that it is almost what you're going to see in OpenBSD fdisk,
usually ! (I think there may be some very weird cases where this won't
match)

There are some differences though, mostly because Linux fdisk has made
some rather confusing choices:
- in simple mode it starts numbering cylinders at 1... whereas
everything else starts from 0.
- in simple mode it shows blocks of 1024 bytes, which makes for half-blocks
(marked with a +) and sizes halved from the real block size.
- in expert mode it shows extended partitions offset from the start
of the extended partition.
- the hd/sec/cyl is a confusing order, as the sector number is computed
from cyl/hd/sec, in that order.
- it never shows and doesn't care about the real disk geometry.

You will notice that I don't have a linux swap partition visible. My
linux setup currently uses the OpenBSD swap area.

Before starting to install OpenBSD, now would be a good time to check the
INSTALL.pt document...  Especially note the alignment restriction of
partitions (first sector of a partition must be at head 0, sector 1 of a
cylinder). This is enforced by Linux' fdisk.

The other point to note is that extended partitions are actually linked
lists. This will show up in OpenBSD's fdisk.

Your clock and OpenBSD
----------------------
OpenBSD expects your hardware clock to be in universal time, and uses
time zones to give you local time. With Linux, this depends...
most distributions use a small program called hwclock to set up the
system time from the hardware clock when booting... there is a --utc
option if your hardware clock is in universal time, but this is not
always what happens by default.

For instance, on a redhat system, up to 5.2, this happens in
/etc/rc.d/rc.sysinit which loads an /etc/sysconfig/clock that defines a
variable called UTC, and then proceeds calling hwclock.
- ensure UTC is set to true,
- adjust your hardware clock from the system time if necessary, e.g.,
hwclock --systohc --utc.

Normally, this is one of the choices that the Linux installation program
lets you do: set your hardware clock to GMT.

The Linux partition table and OpenBSD
-------------------------------------
There used to be a problem with Linux's rc: it always mounts all file systems
even in single-user mode.  The 2.2 kernels fix that in a handy way: the
partition recorded in the MBR is scanned for a disklabel, and marked with
a ! if one is found. Then, the rest of the disk is scanned, before
coming back to the disklabel itself. That way, changes to the
OpenBSD disklabel won't affect the setup of the rest of the disk.

Anyhow, you may want to check that you can still boot from a Linux kernel
which doesn't know about disklabels.  The long term solution is to fix your
inittab and rc scripts to make deadly sure thhat single-user boot will work
-- preferably by moving disk mounts to multi-user.

The OpenBSD installation
------------------------
If you've got the space, you can install from your ext2fs partitions. This
is what I did, a long time in the past, as I had a slip connection to the
rest of the world, and the OpenBSD install floppy does not include slip.

REMEMBER TO BACKUP ALL IMPORTANT DATA ON YOUR DISK BEFORE DOING THE
INSTALLATION !!!

So you cp floppy*.fs /dev/fd0, then reboot from the floppy.

First, the booter loads, then there is a boot prompt. Five seconds later,
the kernel and the ram disk image are loaded, and the kernel is run.
After a while, through a few more prompts, you get to fdisk and you can
enter the new partition into the MBR.

This is what the fdisk dump looked like after my changes:
Disk: wd0       geometry: 992/128/63 [7999488 sectors]
Offset: 0       Signatures: 0xAA55,0x0
         Starting        Ending
 #: id  cyl  hd sec -  cyl  hd sec [     start -       size]
-------------------------------------------------------------------------
 0: 06    0   1   1 -  210 127  63 [        63 -    1701441] DOS > 32MB
 1: 83  211   0   1 -  272 127  63 [   1701504 -     499968] Linux files*
 2: A6  273   0   1 -  991 127  63 [   2201472 -    5798016] OpenBSD
 3: 00    0   0   0 -    0   0   0 [         0 -          0] unused

fdisk geometry tells me that I needn't worry about cylinder 1024.
This matches very  closely with what linux fdisk saw.

If you had extended partitions, it would be a trifle bit harder:
you just follow the extended partition links using select, jot down
whatever you need, add the OpenBSD partition into the MBR to look like
you want it to, and save everything.

The * at the end of partition #1 means that the system normally boots under
Linux. In reality, lilo takes control and disregards this completely.

After you leave fdisk, you get to the interesting part: the disklabel
itself. If all goes well, OpenBSD synthesizes a nice disklabel out of what
it can deduce from the disk, including the ext2fs partitions.

There are only a few subtleties to take care of:
- initially, you can ONLY edit the disklabel part that matches the
OpenBSD partition that was declared in the MBR (what you just entered in
fdisk, the `slice' from FreeBSD lingo). Most simple installation don't
need to edit more than that, but you can use b 0 * to unlock the whole
disk (this is a bad idea in most cases).
- your real disk geometry becomes more relevant. The Berkeley fast file system
can't use partial cylinder groups, hence BSD partitions should start
on cylinder boundaries, as any remaining sectors  will be lost anyway.
(Actually, what's important is the disk geometry that disklabel gives you.
Trust it on that). In my case, sectors/cylinder=1008 and bytes/sector=512,
so the granularity of disklabel partitions is 504 Kb.
- units for size and offset can be given as sectors (default) or cylinders.
a3963 241
After edition, this is what my disklabel looks like:
# editing

# using MBR partition 2: type A6 off 2201472 (0x219780) size 5798016 (0x587880)
# /dev/rwd0c:
type: ESDI
disk:
label: TOSHIBA MK4006M
flags:
bytes/sector: 512
sectors/track: 63
tracks/cylinder: 16
sectors/cylinder: 1008
cylinders: 7944
total sectors: 8007552
rpm: 3600
interleave: 1
trackskew: 0
cylinderskew: 0
headswitch: 0           # milliseconds
track-to-track seek: 0  # milliseconds
drivedata: 0

16 partitions:
#        size   offset    fstype   [fsize bsize   cpg]
  a:   104832  2201472    4.2BSD     1024  8192    16   # (Cyl. 2184 - 2287)
  b:   274176  2306304      swap                        # (Cyl. 2288 - 2559)
  c:  8007552        0    unused        0     0         # (Cyl.    0 - 7943)
  d:   613872  2580480    4.2BSD     1024  8192    16   # (Cyl. 2560 - 3168)
  e:   920304  4846464    4.2BSD     1024  8192    16   # (Cyl. 4808 - 5720)
  f:   628992  4217472    4.2BSD     1024  8192    16   # (Cyl. 4184 - 4807)
  g:   204624  5766768    4.2BSD     1024  8192    16   # (Cyl. 5721 - 5923)
  h:  1073520  5971392    4.2BSD     1024  8192    16   # (Cyl. 5924 - 6988)
  i:   962640  7044912    4.2BSD     1024  8192    16   # (Cyl. 6989 - 7943)
  j:  1701441       63     MSDOS                        # (Cyl.    0*- 1687)
  k:   499968  1701504    ext2fs                        # (Cyl. 1688 - 2183)
  l:  1023120  3194352    4.2BSD     1024  8192    16   # (Cyl. 3169 - 4183)

Things that check, more or less automatically:
- this disklabel is saved in MBR partition #2 (basic DOS partition 2),
as expected.
- all the BSD partitions proper are aligned on a cylinder boundary (ie no '*').
the root partition begins at the precise same offset the corresponding DOS
partition begins, and it extends for the same length.
- the ext2fs partitions have the exact same layout under the OpenBSD
disklabel.
- the swap partition is very large. It gets used as mfs for my tmp
directories.

And here is the corresponding /etc/fstab:
/dev/wd0a       /          ffs    rw    1       1
/dev/wd0d       /usr       ffs    ro    1       2
/dev/wd0l       /usr/local ffs    ro    1       2
/dev/wd0e       /home      ffs    rw    1       2
/dev/wd0g       /var       ffs    rw    1       2
/dev/wd0h       /big       ffs    ro    1       2
/dev/wd0f       /usr/obj   ffs    rw    1       2
/dev/wd0i       /vbig      ffs    rw    1       2
/dev/wd0j       /dos       msdos  rw    1       2
/dev/wd0k       /linux     ext2fs rw
/dev/wd0b       /tmp       mfs    rw

One point that is somewhat laborious is that the disklabel -E mode
(which you are currently using) tends to move partitions around to ensure
that ALL defined partitions are contiguous. For that reason, it is better
if you don't have to use b 0 *, otherwise partitions will be moved around to
remove holes, without regard for the rigid MBR partitioning.
ext2fs and DOS partitions  should be recognized and positioned
automatically if all goes well.

Once the disklabel is written to disk, the installation proceeds as usual.

ext2fs partitions are perfectly usable from OpenBSD.

Booting
-------
First time I booted my system back, I did not get into OpenBSD as expected...
I plain forgot I had installed lilo in the master boot block, and lilo
does not heed the active partition flag. The fix was rather simple: from
the Linux system, I just had to edit lilo.conf to add the OpenBSD entry:

boot=/dev/hda
map=/boot/map
install=/boot/boot.b
prompt
timeout=500
other=/dev/hda3
        label=bsd
        table=/dev/hda
image=/boot/vmlinuz-2.2.3
        label=linux
        vga=4
        root=/dev/hda2
        read-only
image=/boot/vmlinuz-2.0.36-0.7
        label=linux.orig
        root=/dev/hda2
        read-only
other=/dev/hda1
        label=dos
        table=/dev/hda

More details: I've kept the original redhat installation as
vmlinuz-2.0.36 because I'm paranoid, but the real setup uses only
bsd, linux, and dos.

Rerun lilo (DON'T FORGET THAT STEP), and voila, OpenBSD is able to boot!

Linux and OpenBSD partitions
----------------------------
The 2.2 kernel does incorporate my patch for the correct handling of
OpenBSD partitions. You will probably need to reconfigure and rebuild
your linux kernel to recognize BSD disklabels... Here is how it shows up
on my box:

Partition check:
 hda: hda1 hda2 hda3! < hda5 hda6 hda7 hda8 hda9 hda10 hda11 hda12 hda13 hda14
hda15 >

- the disklabel is detected early, but handled later.
- disklabel handling should remove duplicates: all partitions that are present
as both MBR and disklabel partition should get removed silently. (this does
not seem to work as advertized presently).
- the remaining partitions are checked for consistency.

and here is my linux fstab:

/dev/hda2               /                       ext2    defaults        1 1
/dev/hda6               swap                    swap    defaults        0 0
/dev/hda5               /bsd                    ufs     ufstype=44bsd   1 2
/dev/hda7               /bsd/usr                ufs     ufstype=44bsd   1 2
/dev/hda8               /home                   ufs     ufstype=44bsd   1 2
/dev/hda9               /bsd/usr/obj            ufs     ufstype=44bsd   1 2
/dev/hda1               /dos                    vfat    defaults        1 2
/dev/fd0                /mnt/floppy             ext2    noauto          0 0
/dev/cdrom              /mnt/cdrom              iso9660 noauto,ro

2.2 kernels also include a working UFS, though you may run into problems when
writing to ufs partitions.   Note the ufstype=44bsd. If you forget that
in your mounts, it will fail. Depending upon your installation, you may
get a failure message, or you will have to dig through /var/log/ to find
it.

Running Linux binaries under OpenBSD
------------------------------------
You just have to recompile your BSD kernel with COMPAT_LINUX, and set up
/emul/linux as explained in compat_linux(1). If you run GENERIC, you don't
have to recompile anything, as this is the default setup.

It's a good idea to mount your Linux file system under another point, then
make symbolic links so that you can control what gets used precisely.

As you have a complete linux system, don't bother with the ports
emul/linux_lib entry: it's only a set of Linux libraries for people who
don't have a Linux system running.

A small detail that may cause problems: uname still says `OpenBSD', even
under Linux compatibility.  The reason behind that is that we don't want
netscape to tell it was run from a Linux box, when it is used under
OpenBSD.

Some programs, for instance maple, do depend on uname answering `Linux'.
For maple, this is straigthforward: you just have to fudge
/usr/local/maple/bin/maple.system.type to check OpenBSD in the same
class with Linux.

Similar shell scripts are easy to fix.  Binary programs that don't run
suid can be coerced by using LD_PRELOAD.

As a rule, this should be achieved on a program-by-program basis.
The more networking programs that do tell they're running under OpenBSD,
the merrier !

A word of caution: brain-damaged linux installations
----------------------------------------------------
I just reinstalled the linux side of my laptop using redhat 5.2.  This
CD does insist on having TWO linux partitions: one root partition, and one
swap partition (even though I have 32 Mb of memory, largely enough for
the installation). Since it uses a 2.0.36 kernel, it does NOT handle BSD
disklabels, so I couldn't tell it to use my swap area (I have this bad
feeling that distributed 2.2 boot kernels won't include BSD disklabel
handling anyway). Instead, I had to back my last OpenBSD partition up,
fiddle with my fdisk setup to feed the last cylinder as a swap partition
to their brain dead install CD. Then fetch the latest kernel source to the
linux side, and recompile to get a fully working linux setup. Finally,
reset the fdisk/disklabel to its normal state, and get the backed-up
partition to its normal location.

Another word of caution: getting enough rope to hang yourself
-------------------------------------------------------------
One previous version of this document got into much nastier details, and
gave installation instructions that were thoroughly dangerous.
- various tools may yield distinct views of your disk. These will match,
most often, but not always. Don't get confused if various fdisk, disklabel
utilities don't yield the same information. Generally, sector sizes and
offsets should match.
- try to keep various OSes segregated to their areas. Don't depend on
OpenBSD information to be correct for your linux setup and vice-versa.
Some weird problem with the brain-damaged PC architecture may force us to
tweak things so that OpenBSD will work seamlessly everywhere. Compatibility
with weird tricks is not a priority.

This being said, you will have noticed by now that the OpenBSD disklabel is
just another description of your hard-disk. It is almost completely
independent from the MBR description (it just has to be on the right sector
for the boot process to find it). You can get into trouble if things don't
match. Let it live within its MBR partition, unless you're completely sure
you know what you are doing, and don't expect there will always be someone
to get you out of trouble. If your setup is really too weird, no-one can help.

As far as the boot process goes, I think lilo allows you to boot from ANY
partition recorded in the MBR, including extended partitions. The only
limitation is that the next stage bootstrap MUST take place entirely within
the first 1024 cylinders of the disk, as seen by the BIOS.  OpenBSD
MBR partitions that extend beyond cylinder 1024 are no problem, as long as
the disklabel root (a) partition doesn't extend beyond cylinder 1024.

Since Windows, OpenBSD, and linux all have that limitation, the easiest way
is to start with Windows partitions (entirely within the first 1024
cylinders), follow with the linux boot partition (still within the first
1024 cylinders), then the OpenBSD area (which can span the 1024 cylinders
boundary, as long as a lives within the limit), and the remaining linux
partitions.

Weirder setups are unwarranted.  Several bsd on the same disk MAY be
possible, but will be harder to manage:
- it is better if disklabels match,
- linux will obey the first disklabel it finds, try to ensure this is
OpenBSD disklabel, it can describe more partitions than the others,
- other BSD may get confused with each other data. Normally, the A5/A6
split ensures that Net/Free won't get mixed up with OpenBSD,
- FreeBSD and NetBSD will probably get confused with each other,
- if you have a 1024 cylinder limit, all boot areas must stay within the
1024 cylinder boundary, so only one of the BSD may span that limit, apart
from very, very nasty tricks.

Finally, how much disk space do you have anyway ?  Do you really need to
cram that many OSes on the same disk ? Put them on separate disks rather.
If you reach that stage, you'd better be ready to hack at the linux kernel
to recognize several disklabels, for instance, or generally know what
you're doing.
d3965 1
d3967 2
d3970 6
a3975 4
   [1][Back to Main Index] [2][To Section 11.0 - OpenBSD 2.4 Specific
   Information]

                           12.0 - Performance Tuning
d3978 1
a3978 1
12.1 - Networking
d3984 1
a3984 1
   The [3]options(4) man page talks about the options presented.
d3996 1
a3996 1
12.2 - Disk I/O
d4009 1
a4009 1
       The first option is the use of [4]ccd(4), the Concatenated Disk
d4032 1
a4032 1
   on configuring ccd, look at [5]ccdconfig(8))
d4051 3
a4053 3
       Another solution is [6]raid(4) which will have you use
       [7]raidctl(8) to control your raid devices. OpenBSD's RAID is
       based upon Greg Oster's [8]NetBSD port of the CMU [9]RAIDframe
d4063 2
a4064 2
   say the least. Not so with RAIDframe. Read the [10]raid(4) and
   [11]raidctl(8) man pages to get full details. There are many options
d4096 1
a4096 1
       more about softupdates in the [12]softupdates FAQ entry. If you
d4100 1
a4100 1
12.3 - Tuning kmem
d4118 1
a4118 1
12.4 - Hardware choices
d4185 1
a4185 1
12.5 - Why aren't we using async mounts?
d4196 1
a4196 1
   the stability of the system. Check the manpage for [13]mount(8)."
d4212 1
a4212 2
   [14][Back to Main Index] [15][To Section 11.0 - OpenBSD 2.4 Specific
   Information]
d4215 2
a4216 2
   [16][back] [17]www@@openbsd.org
   $OpenBSD: faq12.html,v 1.19 1999/09/15 05:16:23 ericj Exp $
d4220 21
a4240 17
   1. http://openbsd.org/faq/index.html
   2. http://openbsd.org/faq/faq11-2.4.html
   3. http://www.openbsd.org/cgi-bin/man.cgi?query=options&apropos=0&sektion=4&format=html
   4. http://www.openbsd.org/cgi-bin/man.cgi?query=ccd&apropos=0&sektion=4&format=html
   5. http://www.openbsd.org/cgi-bin/man.cgi?query=ccdconfig&apropos=0&sektion=8&format=html
   6. http://www.openbsd.org/cgi-bin/man.cgi?query=raid&apropos=0&sektion=4&format=html
   7. http://www.openbsd.org/cgi-bin/man.cgi?query=raidctl&apropos=0&sektion=8&format=html
   8. http://www.cs.usask.ca/staff/oster/raid.html
   9. http://www.pdl.cs.cmu.edu/RAIDframe/
  10. http://www.openbsd.org/cgi-bin/man.cgi?query=raid&apropos=0&sektion=4&format=html
  11. http://www.openbsd.org/cgi-bin/man.cgi?query=raidctl&apropos=0&sektion=8&format=html
  12. http://openbsd.org/faq/faq15.html#15.5
  13. http://www.openbsd.org/cgi-bin/man.cgi?query=mount&apropos=0&sektion=8&format=html
  14. http://openbsd.org/faq/index.html
  15. http://openbsd.org/faq/faq11-2.4.html
  16. http://openbsd.org/faq/index.html
  17. mailto:www@@openbsd.org
d4242 1
d4244 2
a4245 2
   [1][Back to Main Index] [2][To Section 12.0 - Performance Tuning]
   [3][To Section 14.0 - IPsec]
d4247 2
a4248 1
                           13.0 - For Advanced Users
d4251 1
a4251 1
13.1 - Using OpenBSD's new PCI-IDE code
d4264 1
a4264 1
       From: Constantine Sapuntzakis <[4]csapuntz@@stanford.edu>
d4355 2
a4356 2
   [5][Back to Main Index] [6][To Section 12.0 - Performance Tuning]
   [7][To Section 14.0 - IPsec]
d4359 2
a4360 2
   [8][back] [9]www@@openbsd.org
   $OpenBSD: faq13.html,v 1.4 1999/09/15 05:16:23 ericj Exp $
d4364 8
a4371 9
   1. http://openbsd.org/faq/index.html
   2. http://openbsd.org/faq/faq12.html
   3. http://openbsd.org/faq/faq14.html
   4. mailto:csapuntz@@stanford.edu
   5. http://openbsd.org/faq/index.html
   6. http://openbsd.org/faq/faq12.html
   7. http://openbsd.org/faq/faq14.html
   8. http://openbsd.org/faq/index.html
   9. mailto:www@@openbsd.org
d4373 1
d4375 2
a4376 2
   [1][Back to Main Index] [2][To Section 13.0 - For Advanced Users]
   [3][To Section 15.0 - Using Disks in OpenBSD]
d4378 2
a4379 1
                         14.0 - Using IPsec in OpenBSD
d4382 5
a4386 5
   IPSec is partially documented in the [4]vpn(8) man page. There are
   various files in [5]/usr/share/ipsec/ directory which can also assist
   you. The manual pages for [6]ipsec(4), [7]ipsecadm(8),
   [8]photurisd(8), [9]startkey(1), [10]isakmpd(8) and
   [11]isakmpd.conf(5) are also available!
d4388 1
a4388 1
   You should also check [12]Codetalker which has an FAQ for setting up
d4393 2
a4394 2
   [13][Back to Main Index] [14][To Section 13.0 - For Advanced Users]
   [15][To Section 15.0 - Using Disks in OpenBSD]
d4397 2
a4398 2
   [16][back] [17]www@@openbsd.org
   $OpenBSD: faq14.html,v 1.2 1999/09/15 13:44:59 ericj Exp $
d4402 16
a4417 17
   1. http://openbsd.org/faq/index.html
   2. http://openbsd.org/faq/faq13.html
   3. http://openbsd.org/faq/faq15.html
   4. http://www.openbsd.org/cgi-bin/man.cgi?query=vpn&apropos=0&sektion=0&format=html
   5. http://www.openbsd.org/cgi-bin/cvsweb/src/share/ipsec/
   6. http://www.openbsd.org/cgi-bin/man.cgi?query=ipsec&apropos=0&sektion=4&format=html
   7. http://www.openbsd.org/cgi-bin/man.cgi?query=ipsecadm&apropos=0&sektion=8&format=html
   8. http://www.openbsd.org/cgi-bin/man.cgi?query=photurisd&apropos=0&sektion=8&format=html
   9. http://www.openbsd.org/cgi-bin/man.cgi?query=startkey&apropos=0&sektion=1&format=html
  10. http://www.openbsd.org/cgi-bin/man.cgi?query=isakmpd&apropos=0&sektion=8&format=html
  11. http://www.openbsd.org/cgi-bin/man.cgi?query=isakmpd.conf&apropos=0&sektion=5&format=html
  12. http://www.codetalker.com/greenbox/docs/vpn-24-minifaq.html
  13. http://openbsd.org/faq/index.html
  14. http://openbsd.org/faq/faq13.html
  15. http://openbsd.org/faq/faq15.html
  16. http://openbsd.org/faq/index.html
  17. mailto:www@@openbsd.org
d4419 1
d4421 2
a4422 1
   [1][Back to Main Index] [2][To Section 14.0 - IPsec]
d4424 10
a4433 1
                     15.0 - Working with Disks in OpenBSD
d4436 1
a4436 1
15.1 - Using the OpenBSD disklabel
d4438 1
a4438 1
   Be sure to check the [3]disklabel(8) man page!
d4567 1
a4567 1
   To see an example install involving disklabel check [4]log25.txt
d4569 1
a4569 1
15.2 - Using fdisk
d4571 1
a4571 1
   First be sure to check the fdisk main page. [5]fdisk(8)
d4658 1
a4658 1
15.3 - Adding extra disks in OpenBSD
d4661 1
a4661 1
   [6]fdisk(8) (i386 only) and [7]disklabel(8) to set up your disk in
d4715 1
a4715 1
   the filesystem on that disk using [8]newfs(8).
d4743 1
a4743 1
15.4 - How to swap to a file
d4747 2
a4748 2
   per-process limits first with csh's [9]unlimit(1), or sh's
   [10]ulimit(1).)
d4750 1
a4750 1
   With OpenBSD 2.5 came the introduction of [11]swapctl(8), which made
d4779 1
a4779 1
15.5 - Soft-updates
d4801 1
a4801 1
   as possible (kernel coredumps, tracebacks, etc) to [12]Costa. Do not
d4804 1
a4804 1
15.6 - When I boot after installation of OpenBSD/i386, it says "partition 3 id
d4810 1
a4810 1
   use [13]installboot(8). For example, the most common usage is:
d4832 1
a4832 1
   [14]http://www.prz.tu-berlin.de/~wolf/os-bs.html
d4844 1
a4844 1
   For further instructions read [15]INSTALL.linux
d4846 1
a4846 1
15.7 - How do I get a dmesg from a boot floppy?
d4856 1
a4856 1
   Also check with [16]section 4.7
d4858 1
a4858 2
    15.8 - I cannot boot OpenBSD. It just says: "reading boot.. Bad magic"
                    (Installing Bootblocks - i386 specific)
d4899 1
a4899 1
   [17][Back to Main Index] [18][To Section 14.0 - IPsec]
d4902 2
a4903 2
   [19][back] [20]www@@openbsd.org
   $OpenBSD: faq15.html,v 1.3 1999/09/15 13:03:29 ericj Exp $
d4907 26
a4932 20
   1. http://openbsd.org/faq/index.html
   2. http://openbsd.org/faq/faq14.html
   3. http://www.openbsd.org/cgi-bin/man.cgi?query=disklabel&sektion=8&format=html
   4. http://openbsd.org/faq/log25.txt
   5. http://www.openbsd.org/cgi-bin/man.cgi?query=fdisk&apropos=0&sektion=8&format=html
   6. http://www.openbsd.org/cgi-bin/man.cgi?query=fdisk&apropos=0&sektion=8&format=html
   7. http://www.openbsd.org/cgi-bin/man.cgi?query=disklabel&apropos=0&sektion=8&format=html
   8. http://www.openbsd.org/cgi-bin/man.cgi?query=newfs&apropos=0&sektion=8&format=html
   9. http://www.openbsd.org/cgi-bin/man.cgi?query=unlimit&sektion=1&format=html
  10. http://www.openbsd.org/cgi-bin/man.cgi?query=ulimit&sektion=1&format=html
  11. http://www.openbsd.org/cgi-bin/man.cgi?query=swapctl&sektion=8&format=html
  12. mailto:csapuntz@@openbsd.org
  13. http://www.openbsd.org/cgi-bin/man.cgi?query=installboot&sektion=8&format=html
  14. http://www.prz.tu-berlin.de/~wolf/os-bs.html
  15. http://openbsd.org/faq/INSTALL.linux
  16. http://openbsd.org/faq/faq4.html#4.7
  17. http://openbsd.org/faq/index.html
  18. http://openbsd.org/faq/faq14.html
  19. http://openbsd.org/faq/index.html
  20. mailto:www@@openbsd.org
@


1.12
log
@sync
@
text
@d2 3
a4 1
OpenBSD Frequently Asked Questions - Ver. 2.5
d10 14
a23 11
   in some cases will work on earlier versions. This FAQ will take you
   through most critical steps to setting up your own OpenBSD system. The
   addressed questions will range from newbie to advanced users.
   Hopefully you will find this FAQ useful.

   This FAQ was recently updated to support the newest version of
   OpenBSD. To view information for previous versions, please refer to
   [1]FAQ section 11.0, or [2]errata.html.

   Text and PostScript Versions have been created for those of you
   without constant web access. These will be updated weekly.
d65 3
a67 13
     * [32]4.5 - Using the OpenBSD disklabel
     * [33]4.6 - Using fdisk
     * [34]4.7 - Adding extra disks in OpenBSD
     * [35]4.8 - How to swap to a file
     * [36]4.9 - Soft-updates
     * [37]4.10 - How much space do I need for an OpenBSD installation?
     * [38]4.11 - When I boot after installation of OpenBSD/i386, it says
       "partition 3 id 0".
     * [39]4.12 - How do I get a dmesg from a boot floppy?
     * [40]4.13 - I cannot boot OpenBSD. It just says: "reading boot..
       Bad magic" (i386 specific)
     * [41]4.14 - Multibooting OpenBSD
     * [42]4.15 - Sending your dmesg to dmesg@@openbsd.org after the
d70 1
a70 1
  [43]5.0 - Kernel Configuration and Setup
d72 27
a98 28
     * [44]5.1 - Why do I need a custom kernel?
     * [45]5.2 - Kernel configuration Options
     * [46]5.3 - Building your own kernel
     * [47]5.4 - Boot-time configuration

  [48]6.0 - Networking setup

     * [49]6.1 - Initial network setup
     * [50]6.2 - IP Filter and Network Address Translation
     * [51]6.3 - IPSec
     * [52]6.4 - Dynamic Host Configuration Protocol
     * [53]6.5 - Point to Point Protocol

  [54]7.0 - Keyboard controls

     * [55]7.1 - How do I remap the keyboard?
     * [56]7.2 - Is there gpm or the like in OpenBSD?

  [57]8.0 - General Questions

     * [58]8.1 - What are these kerberos warnings when I first login?
     * [59]8.2 - How do I change virtual terminals?
     * [60]8.3 - I forgot my root password..... What do I do!
     * [61]8.4 - X won't start, I get lots of error messages
     * [62]8.5 - What is CVS, and how do I use it?
     * [63]8.6 - What is the ports tree?
     * [64]8.7 - What are packages?
     * [65]8.8 - Is there any way to use my floppy drive if it's not
d100 10
a109 10
     * [66]8.9 - OpenBSD Bootloader (i386 specific)
     * [67]8.10 - Using S/Key on your OpenBSD system
     * [68]8.11 - Why is my Macintosh losing so much time?
     * [69]8.12 - Will OpenBSD run on multiprocessor machines?

  [70]9.0 - Migrating from Linux

     * [71]9.1 - Tips for Linux (and other free Unix-like OS) users
     * [72]9.2 - Dual boot of Linux and OpenBSD
     * [73]9.3 - Converting your linux (or other System-7 style) password
d111 1
d113 1
a113 1
  [74]10.0 - System Administration
d115 1
a115 1
     * [75]10.1 - When I try to su to root it says that I'm in the wrong
d117 2
a118 2
     * [76]10.2 - How do I duplicate a filesystem?
     * [77]10.3 - How do I get daemons like httpd and sendmail to start
d120 1
a120 1
     * [78]10.4 - Why do users get relaying access denied when they are
d122 1
a122 1
     * [79]10.5 - I've set up POP, but I get errors when accessing my
d124 2
a125 2
     * [80]10.6 - Setting up a Secure HTTP Server using SSL(8)
     * [81]10.7 - I made changes to /etc/passwd with vi(1), but the
d127 7
a133 5
     * [82]10.8 - How do I add a user? or delete a user?
     * [83]10.9 - How do I create a ftp-only account?
     * [84]10.10 - Setting up user disk quotas
     * [85]10.11 - Setting up Kerberos Client/Server
     * [86]10.12 - Setting up an Anonymous FTP Server
d135 3
a137 1
  [87]11.0 - OpenBSD 2.4 Specific Information
d139 1
a139 3
     * [88]11.1 - Why do I get UserDir errors when running httpd(8)?
     * [89]11.2 - Installing at a partition 4GB or higher (i386 specific)
     * [90]Log24.txt - Specific OpenBSD 2.4 Install Example
d141 5
a145 1
  [91]12.0 - Performance Tuning
d147 1
a147 5
     * [92]12.1 - Networking
     * [93]12.2 - Disk I/O
     * [94]12.3 - Tuning kmem
     * [95]12.4 - Hardware Choices
     * [96]12.5 - Why aren't we using async mounts?
d149 1
a149 1
  [97]13.0 For Advanced Users
d151 16
a166 1
     * [98]13.1 - Using OpenBSD's new PCI-IDE code
d169 2
a170 2
   [99][back] [100]www@@openbsd.org
   $OpenBSD: index.html,v 1.62 1999/08/31 20:07:12 ericj Exp $
d174 2
a175 2
   1. http://openbsd.org/faq/faq11-2.4.html
   2. http://openbsd.org/errata.html
d208 69
a276 66
  35. http://openbsd.org/faq/faq4.html#4.8
  36. http://openbsd.org/faq/faq4.html#4.9
  37. http://openbsd.org/faq/faq4.html#4.10
  38. http://openbsd.org/faq/faq4.html#4.11
  39. http://openbsd.org/faq/faq4.html#4.12
  40. http://openbsd.org/faq/faq4.html#4.13
  41. http://openbsd.org/faq/faq4.html#4.14
  42. http://openbsd.org/faq/faq4.html#4.15
  43. http://openbsd.org/faq/faq5.html
  44. http://openbsd.org/faq/faq5.html#5.1
  45. http://openbsd.org/faq/faq5.html#5.2
  46. http://openbsd.org/faq/faq5.html#5.3
  47. http://openbsd.org/faq/faq5.html#5.4
  48. http://openbsd.org/faq/faq6.html
  49. http://openbsd.org/faq/faq6.html#6.1
  50. http://openbsd.org/faq/faq6.html#6.2
  51. http://openbsd.org/faq/faq6.html#6.3
  52. http://openbsd.org/faq/faq6.html#6.4
  53. http://openbsd.org/faq/faq6.html#6.5
  54. http://openbsd.org/faq/faq7.html
  55. http://openbsd.org/faq/faq7.html#7.1
  56. http://openbsd.org/faq/faq7.html#7.2
  57. http://openbsd.org/faq/faq8.html
  58. http://openbsd.org/faq/faq8.html#8.1
  59. http://openbsd.org/faq/faq8.html#8.2
  60. http://openbsd.org/faq/faq8.html#8.3
  61. http://openbsd.org/faq/faq8.html#8.4
  62. http://openbsd.org/faq/faq8.html#8.5
  63. http://openbsd.org/faq/faq8.html#8.6
  64. http://openbsd.org/faq/faq8.html#8.7
  65. http://openbsd.org/faq/faq8.html#8.8
  66. http://openbsd.org/faq/faq8.html#8.9
  67. http://openbsd.org/faq/faq8.html#8.10
  68. http://openbsd.org/faq/faq8.html#8.11
  69. http://openbsd.org/faq/faq8.html#8.12
  70. http://openbsd.org/faq/faq9.html
  71. http://openbsd.org/faq/faq9.html#9.1
  72. http://openbsd.org/faq/faq9.html#9.2
  73. http://openbsd.org/faq/faq9.html#9.3
  74. http://openbsd.org/faq/faq10.html
  75. http://openbsd.org/faq/faq10.html#10.1
  76. http://openbsd.org/faq/faq10.html#10.2
  77. http://openbsd.org/faq/faq10.html#10.3
  78. http://openbsd.org/faq/faq10.html#10.4
  79. http://openbsd.org/faq/faq10.html#10.5
  80. http://openbsd.org/faq/faq10.html#10.6
  81. http://openbsd.org/faq/faq10.html#10.7
  82. http://openbsd.org/faq/faq10.html#10.8
  83. http://openbsd.org/faq/faq10.html#10.9
  84. http://openbsd.org/faq/faq10.html#10.10
  85. http://openbsd.org/faq/faq10.html#10.11
  86. http://openbsd.org/faq/faq10.html#10.12
  87. http://openbsd.org/faq/faq11-2.4.html
  88. http://openbsd.org/faq/faq11-2.4.html#11.1
  89. http://openbsd.org/faq/faq11-2.4.html#11.2
  90. http://openbsd.org/faq/log24.txt
  91. http://openbsd.org/faq/faq12.html
  92. http://openbsd.org/faq/faq12.html#12.1
  93. http://openbsd.org/faq/faq12.html#12.2
  94. http://openbsd.org/faq/faq12.html#12.3
  95. http://openbsd.org/faq/faq12.html#12.4
  96. http://openbsd.org/faq/faq12.html#12.5
  97. http://openbsd.org/faq/faq13.html
  98. http://openbsd.org/faq/faq13.html#13.1
  99. http://openbsd.org/index.html
 100. mailto:www@@openbsd.org
d321 1
a321 1
   Yes, OpenBSD will run on your multiprocessor machine, but it wil only
d435 1
a435 1
   $OpenBSD: faq1.html,v 1.14 1999/08/17 22:56:19 wvdputte Exp $
d748 1
a748 1
   $OpenBSD: faq2.html,v 1.17 1999/07/26 15:10:46 ericj Exp $
d795 1
a795 1
   resources] [3][To Section 4.0 - Installation and Disk Setup]
d868 1
a868 2
   information resources] [13][To Section 4.0 - Installation and Disk
   Setup]
d872 1
a872 1
   $OpenBSD: faq3.html,v 1.8 1999/07/10 15:46:32 wvdputte Exp $
d896 1
a896 1
                      4.0 - Installation and disk setup.
d1015 30
a1044 1
4.5 - Using the OpenBSD disklabel
d1046 1
a1046 1
   Be sure to check the [10]disklabel(8) man page!
d1048 1
a1048 10
   Disklabel is used to identify disks and/or partitions. The main idea
   behind them is abstraction of disk hardware, since there exists
   several partitioning tables. A disklabel is a universal partitioning
   table. These labels tell the system everything about the disk, but
   most of it is irrelevant. The important parts of the label are both
   the part that tells the disk geometry and also the part that actually
   defines what partitions exist on your disk. This label resides on the
   beginning of the disk, this is to help bootstrap code use them (since
   most ROM based booting reads the first sectors of the first disk).
   Disklabel can, on some systems, be used to install bootstrap code.
d1050 4
a1053 7
   As an additional gain, using disklabel helps overcome architecture
   limitations on disk partitioning. For example, on i386, you can only
   have 4 primary partitions. (Partitions that other operating systems,
   such as Windows NT or DOS can see.) With disklabel, you use one of
   these 'primary' partitions to store *all* of your OpenBSD partitions
   (eg. 'swap', '/', '/usr' and '/var'). And you still have 3 more
   partitions available for other OSs!
d1055 3
a1057 7
   You can think of them as 'subpartitions' for installation purposes.
   But they are a necessity for kernel disk access based on geometry. And
   remember to use 'b' for the swap label, and 'a' for root filesystem
   (default names in kernel). (Note also that in other FAQ documents we
   usually refer to these OpenBSD 'subpartitions' as partitions. Most
   architectures do not have two layers of partitions like the i386
   does.)
d1059 3
a1061 2
   To just view the current disklabel for your disk just do:
# disklabel <disk-device name>
d1063 1
a1063 20
   This will give output similar to this:
# using MBR partition 3: type A6 off 64 (0x40) size 16777152 (0xffffc0)
# /dev/rwd0c:
type: ESDI
disk:
label: TOSHIBA MK2720FC
flags:
bytes/sector: 512
sectors/track: 63
tracks/cylinder: 16
sectors/cylinder: 1008
cylinders: 2633
total sectors: 2654064
rpm: 3600
interleave: 1
trackskew: 0
cylinderskew: 0
headswitch: 0           # milliseconds
track-to-track seek: 0  # milliseconds
drivedata: 0
d1065 4
a1068 6
16 partitions:
#        size   offset    fstype   [fsize bsize   cpg]
  a:  2071440    65583    4.2BSD     1024  8192    16   # (Cyl.   65*- 2120)
  b:    65520       63      swap                        # (Cyl.    0*- 65)
  c:  2654064        0    unused        0     0         # (Cyl.    0 - 2632)
  j:   512001  2137023    4.2BSD     1024  8192    16   # (Cyl. 2120*- 2627*)
d1070 1
a1070 5
   In this example, there are 4 labels - A, B, C, J. A is one main
   partition, B is swap, and J is another partition. C in all cases
   represents the full disk. This is helpful in showing what values in
   size, cyl, etc you have to work with. But with this command you cannot
   change any values, you can just view.
d1072 2
a1073 5
   To be able to edit your label's interactively you would use the -E
   flag.
   Example:
# disklabel -E wd0
# using MBR partition 3: type A6 off 64 (0x40) size 16777152 (0xffffc0)
d1075 1
a1075 2
Treating sectors 64-16777216 as the OpenBSD portion of the disk.
You can use the 'b' command to change this.
d1077 3
a1079 36
Initial label editor (enter '?' for help at any prompt)
> ?
Available commands:
        p [unit]  - print label.
        M         - show entire OpenBSD man page for disklabel.
        e         - edit drive parameters.
        a [part]  - add new partition.
        b         - set OpenBSD disk boundaries.
        c [part]  - change partition size.
        d [part]  - delete partition.
        m [part]  - modify existing partition.
        r         - recalculate free space.
        u         - undo last change.
        s [path]  - save label to file.
        w         - write label to disk.
        q         - quit and save changes.
        x         - exit without saving changes.
        ? [cmnd]  - this message or command specific help.
Numeric parameters may use suffixes to indicate units:
        'b' for bytes, 'c' for cylinders, 'k' for kilobytes, 'm' for megabytes,
        'g' for gigabytes or no suffix for sectors (usually 512 bytes).
        Non-sector units will be rounded to the nearest cylinder.
Entering '?' at most prompts will give you (simple) context sensitive help.
> p
device: /dev/rwd0c
type: ESDI
disk:
label: TOSHIBA MK2720FC
bytes/sector: 512
sectors/track: 63
tracks/cylinder: 16
sectors/cylinder: 1008
cylinders: 2633
total sectors: 2654064
free sectors: 14193711
rpm: 3600
d1081 9
a1089 8
16 partitions:
#        size   offset    fstype   [fsize bsize   cpg]
  a:  2071440    65583    4.2BSD     1024  8192    16   # (Cyl.   65*- 2120)
  b:    65520       63      swap                        # (Cyl.    0*- 65)
  c:  2654064        0    unused        0     0         # (Cyl.    0 - 2632)
  j:   512001  2137023    4.2BSD     1024  8192    16   # (Cyl. 2120*- 2627*)
> q
No changes.
d1091 1
a1091 3
   In this example we get into disklabel's interactive mode. From here we
   can issue the command "?" asking for help. This gives us many commands
   we can use to add, delete, edit existing labels.
d1093 6
a1098 3
   There is a new feature on disklabel, to help installation. The '-f'
   flag writes a 'fstab' like file, if given a mount point for a label.
   This is only used at installation.
d1100 2
a1101 1
   To see an example install involving disklabel check [11]log25.txt
d1103 2
a1104 1
4.6 - Using fdisk
d1106 2
a1107 1
   First be sure to check the fdisk main page. [12]fdisk(8)
d1109 3
a1111 6
   Fdisk is a program to help with the maintenance of your partitions.
   This program is used at install time to set up your OpenBSD partition
   (this partition can contain several labels, each with
   filesystems/swap/etc.). It can divide space on your drives and set one
   active. This program will usually be used in Single User Mode ( boot
   -s ). Fdisk also sets the MBR on your various hard disks.
d1113 2
a1114 3
   For installation purposes, most times you'll only need ONE Openbsd
   partition, and then using disklabel to put a swap and a filesystem on
   it.
d1116 1
a1116 2
   To just view your partition table using fdisk just use:
# fdisk fd0
d1118 19
a1136 10
   Which will give an output similar to this:
         Disk: fd0       geometry: 80/2/18 [2880 sectors]
         Offset: 0       Signatures: 0xAA55,0x0
                  Starting        Ending
          #: id  cyl  hd sec -  cyl  hd sec [     start -       size]
----------------------------------------------------------------------
         *0: A6    0   0   1 -   79   1  18 [         0 -       2880] OpenBSD
          1: 00    0   0   0 -    0   0   0 [         0 -          0] unused
          2: A7    0   0   2 -   79   1  18 [         1 -       2879] NEXTSTEP
          3: 00    0   0   0 -    0   0   0 [         0 -          0] unused
a1137 3
   In this example we are viewing the fdisk output of floppy drive. We
   can see the OpenBSD partition (A6) and its size. The * tells us that
   the OpenBSD partition is a bootable partition.
d1139 2
a1140 20
   In the previous example we just viewed our information. What if we
   want to edit our partition table? Well, to do so we must use the -e
   flag. This will bring up a command line prompt to interact with fdisk.
# fdisk -e wd0
Enter 'help' for information
fdisk: 1> help
        help            Command help list
        manual          Show entire OpenBSD man page for fdisk
        reinit          Re-initialize loaded MBR (to defaults)
        disk            Edit current drive stats
        edit            Edit given table entry
        flag            Flag given table entry as bootable
        update          Update machine code in loaded MBR
        select          Select extended partition table entry MBR
        print           Print loaded MBR partition table
        write           Write loaded MBR to disk
        exit            Exit edit of current MBR, without saving changes
        quit            Quit edit of current MBR, saving current changes
        abort           Abort program without saving current changes
fdisk: 1>
d1142 1
a1142 2
   It is perfectly safe in fdisk to go in and explore, just make sure to
   answer N to saving the changes and *DON'T* use the write command.
d1144 1
a1144 31
   Here is an overview of the commands you can use when you choose the -e
   flag.
     * help Display a list of commands that fdisk understands in the
       interactive edit mode.
     * reinit Initialize the currently selected, in-memory copy of the
       boot block.
     * disk Display the current drive geometry that fdisk has probed. You
       are given a chance to edit it if you wish.
     * edit Edit a given table entry in the memory copy of the current
       boot block. You may edit either in BIOS geometry mode, or in
       sector offsets and sizes.
     * flag Make the given partition table entry bootable. Only one entry
       can be marked bootable. If you wish to boot from an extended
       partition, you will need to mark the partition table entry for the
       extended partition as bootable.
     * update Update the machine code in the memory copy of the currently
       selected boot block.
     * select Select and load into memory the boot block pointed to by
       the extended partition table entry in the current boot block.
     * print Print the currently selected in-memory copy of the boot
       block and its MBR table to the terminal.
     * write Write the in-memory copy of the boot block to disk. You will
       be asked to confirm this operation.
     * exit Exit the current level of fdisk, either returning to the
       previously selected in-memory copy of a boot block, or exiting the
       program if there is none.
     * quit Exit the current level of fdisk, either returning to the
       previously selected in-memory copy of a boot block, or exiting the
       program if there is none. Unlike exit it does write the modified
       block out.
     * abort Quit program without saving current changes.
d1146 2
a1147 1
4.7 - Adding new disks in OpenBSD
d1149 5
a1153 3
   Well once you get your disk installed PROPERLY you need to use
   [13]fdisk(8) (i386 only) and [14]disklabel(8) to set up your disk in
   OpenBSD.
d1155 2
a1156 2
   For i386 folks, start with fdisk. Other architectures can ignore this.
# fdisk -i sd2
d1158 1
a1158 4
   This will initialize the disk's "real" partition table for exclusive
   use by OpenBSD. Next you need to create a disklabel for it. This will
   seem confusing.
# disklabel -e sd2
d1160 8
a1167 11
(screen goes blank, your $EDITOR comes up)
type: SCSI
...bla...
sectors/track: 63
total sectors: 6185088
...bla...
16 partitions:
#        size   offset    fstype   [fsize bsize   cpg]
  c:  6185088        0    unused        0     0         # (Cyl.    0 - 6135)
  d:  1405080       63    4.2BSD     1024  8192    16   # (Cyl.    0*- 1393*)
  e:  4779945  1405143    4.2BSD     1024  8192    16   # (Cyl. 1393*- 6135)
d1169 6
a1174 13
   First, ignore the 'c' partition, it's always there and is for programs
   like disklabel to function! For normal operations, fsize should always
   be 1024, bsize should always be 8192, and cpg should always be 16.
   Fstype is 4.2BSD. Total sectors is the total size of the disk. Say
   this is a 3 gigabyte disk. Three gigabytes in disk manufacturer terms
   is 3000 megabytes. So divide 6185088/3000 (use bc(1)). You get 2061.
   So to make up partition sizes for a, d, e, f, g, ... just multiply
   X*2061 to get X megabytes of space on that partition. The offset for
   your first new partition should be the same as the "sectors/track"
   reported earlier in disklabel's output. For us it is 63. The offset
   for each partition afterwards should be a combination of the size of
   each partition and the offset of each partition (Except the C
   partition, since it has no play into this equation.)
d1176 6
a1181 5
   Or, if you just want one partition on the disk, say you will use the
   whole thing for web storage or a home directory or something, just
   take the total size of the disk and subtract the sectors per track
   from it. 6185088-63 = 6185025. Your partition is
    d:  6185025       63    4.2BSD     1024  8192    16
d1183 6
a1188 9
   If all this seems needlessly complex, you can just use disklabel -E to
   get the same partitioning mode that you got on your install disk!
   There, you can just use "96M" to specify "96 megabytes". (Or, if you
   have a disk big enough, 96G for 96 gigs!) Unfortunately, the -E mode
   uses the BIOS disk geometry, not the real disk geometry, and often
   times the two are not the same. To get around this limitation, type 'g
   d' for 'geometry disk'. (Other options are 'g b' for 'geometry bios'
   and 'g u' for geometry user, or simply, what the label said before
   disklabel made any changes.)
d1190 10
a1199 2
   That was a lot. But you are not finished. Finally, you need to create
   the filesystem on that disk using [15]newfs(8).
d1201 4
a1204 1
bsd# newfs wd1a
d1206 16
a1221 3
   Or whatever your disk was named as per OpenBSD's disk numbering
   scheme. (Look at the output from dmesg(1) to see what your disk was
   named by OpenBSD.)
d1223 7
a1229 4
   Now figure out where you are going to mount this new partition you
   just created. Say you want to put it on /u. First, make the directory
   /u. Then, mount it.
mount /dev/wd1a /u
d1231 18
a1248 2
   Finally, add it to /etc/fstab
/dev/wd1a /u ffs rw 1 1
d1250 50
a1299 6
   What if you need to migrate an existing directory like /usr/local? You
   should mount the new drive in /mnt and use cpio -pdum to copy
   /usr/local to the /mnt directory. Edit the /etc/fstab file to show
   that the /usr/local partition is now /dev/wd1a (your freshly formatted
   partition.) Example:
   /dev/wd1a /usr/local ffs rw 1 1
d1301 26
a1326 4
   Reboot into single user mode..boot -s Move the existing /usr/local to
   /usr/local-backup (or delete it if you feel lucky) and create an empty
   directory /usr/local. Then reboot the system, and whala!! the files
   are there!
d1328 52
a1379 1
4.8 - How do I swap to a file?
d1381 21
a1401 4
   With OpenBSD 2.5 came the introduction of [16]swapctl(8), which made
   dealing with swap devices much easier. Swapping to a file doesn't
   require a custom built kernel, although that can still be done, this
   faq will show you how to add swap space both ways.
d1403 5
a1407 5
   To swap to a file permanently, first make a kernel with vnd0c as swap.
   If you have wd0a as root filesystem, wd0b is the previous swap, use
   this line in the kernel configuration file (refer to compiling a new
   kernel if in doubt):
config          bsd     root on wd0a swap on wd0b and vnd0c dumps on wd0b
d1409 1
a1409 3
   Second make the file for swap. If you want a 32MB swapfile named
   /newswap do:
   # dd if=/dev/zero of=/newswap bs=1k count=32768
d1411 2
a1412 3
   Add a line to your /etc/fstab file to indicate where the new swap will
   be.
   /dev/vnd0c none swap sw 0 0
d1414 8
a1421 3
   Now boot with the new kernel. Then create the vnd0 device to use that
   file as a device:
   # vnconfig -c -v vnd0 /newswap
d1423 12
a1434 2
   And add it now to swap:
   # swapon /dev/vnd0c
d1436 6
a1441 2
   You can now see if it is working with:
   # pstat -s
d1443 3
a1445 1
4.9 - Softupdates
d1447 3
a1449 1
   Softupdates are experimental and are NOT recomended for regular users.
d1451 2
a1452 6
   Over the last few years Kirk McKusick has been working on something
   called "soft updates". This is based on an idea proposed by Greg
   Ganger and Yale Patt that imposing a partial ordering on the buffer
   cache opertions would permit the requirement for synchronous writing
   of directory entries to be removed from the FFS code. Thus, a large
   performance increase of disk writing performance.
d1454 1
a1454 1
   To enable Softupdates your kernel must have option
d1456 3
a1458 1
   option FFS_SOFTUPDATES
d1460 1
a1460 5
   then you need to boot into single-user mode:
        boot>boot -s
        [snip]
        bsd# tunefs -s enable <raw device>
        bsd# reboot -n
d1462 9
a1470 3
   GOOD LUCK. Please direct all problem reports with as MUCH information
   as possible (kernel coredumps, tracebacks, etc) to [17]Costa. Do not
   waste his time with any other questions or incomplete problem reports.
d1472 4
a1475 1
4.10 - How much space do I need for an OpenBSD installation?
d1477 3
a1479 14
   The following are suggested sub-tree sizes for a full system install.
   The numbers include enough extra space to permit you to run a typical
   home system that is connected to the internet:
SYSTEM          /       /usr    /var    /usr/X11R6
alpha           56M     540M    27M     161M
amiga           45M     399M    24M      36M
arc             47M     268M    20M      60M
hp300           31M     234M    24M      47M
i386            35M     229M    24M      72M
mac68k          29M     232M    24M      36M
mvme68k         48M     448M    24M       -  (no Xserver)
pmax            50M     355M    24M      60M
sparc           40M     259M    24M      49M
powerpc         39M     423M    26M     124M
d1481 1
a1481 7
   When you are in the disklabel editor, you may choose to make your
   entire system have just an 'a' and 'b' partition. The 'a' partition
   you set up in disklabel will become your root partition, which should
   be the sum of all the 3 main values above (/, /usr, and /var) plus
   some space for /tmp. The 'b' partition you set up automatically
   becomes your system swap partition -- we recommend a minimum of 32MB
   but if you have disk to spare make it at least 64MB.
d1483 1
a1483 5
   However, we recommend you use many separate partitions so that users
   cannot fill up your important partitions as easily, thus causing nasty
   denial of service problems. If you want to be extra cautious, you
   should make the following separate partitions: / swap /usr /var /tmp
   /var/tmp /home.
d1485 1
a1485 1
4.11 - How do I get rid of in "partition 3 id 0" error on boot? (i386)
d1487 1
a1487 4
   This means that your MBR (Master Boot Record) was not installed
   properly or that your BIOS is not compatible with your current MBR. To
   solve this first try to reinstall the OpenBSD boot blocks. To do so
   use [18]installboot(8). For example, the most common usage is:
d1489 1
a1489 1
     * Boot from the OpenBSD bootdisk
d1491 1
a1491 3
     * # fsck /dev/rwd0a && mount /dev/wd0a /mnt
     * # cp /usr/mdec/boot /mnt/boot
     * # /usr/mdec/installboot -v /mnt/boot /usr/mdec/biosboot wd0
d1493 1
a1493 2
     Here substitute your disk devices for rwd0a & wd0a. This will
   install the boot blocks again.
d1495 1
a1495 1
     Then Reboot.
d1497 1
a1497 5
   If this doesn't work you still have a few more options. So, luck
   hasn't run out yet. The first is to use a bootloader such as OS-BS.
   The OpenBSD cd has the os-bs bootloader included in the tools
   directory. If you didn't purchase a CD-ROM, you can download os-bs
   from any of the OpenBSD ftp sites.
d1499 2
a1500 1
   pub/OpenBSD/2.5/tools/osbs135.exe
d1502 4
a1505 2
   and take some time to look through the web pages at
   [19]http://www.prz.tu-berlin.de/~wolf/os-bs.html
d1507 3
a1509 2
   There are also other commercial bootloaders or lilo that you can use
   for multi-booting.
d1511 2
a1512 1
   Here is a simple outline of how to get lilo onto your system.
d1514 1
a1514 4
     * Boot a DOS floppy and do a fdisk /MBR. Make sure you do that on
       the drive you'll be booting from.
     * Boot from a linux disk and install LILO & chain it to your OpenBSD
       boot block.
d1516 47
a1562 1
   For further instructions read [20]INSTALL.linux
a1563 1
4.12 - How do I get a dmesg from a boot floppy?
d1565 2
a1566 4
   RAMDISK images (boot floppies) do not ship with the dmesg utility.
   They do, however, have the /kern filesystem mounted. To copy the dmesg
   information to a file, do a:
   # cat /kern/msgbuf >mydmesg
d1568 2
a1569 2
   Boot disks also have 'more' to page through the output:
   # more /kern/msgbuf
d1571 1
a1571 1
   Also check with [21]section 4.15
d1573 1
a1573 1
4.13 - Reinstalling bootblocks (i386 specific)
d1575 4
a1578 24
   Older versions of MS-DOS can only deal with disk geometries of 1024
   cylinders or less. Since virtually all modern disks have more than
   1024 cylinders, most SCSI BIOS chips (which come on the SCSI
   controller card) and IDE BIOS (which is part of the rest of the PC
   BIOS) have an option (sometimes the default) to "translate" the real
   disk geometry into something that fits within MS-DOS' ability.
   However, not all BIOS chips "translate" the geometry in the same way.
   If you change your BIOS (either with a new motherboard or a new SCSI
   controller), and the new one uses a different "translated" geometry,
   you will be unable to load the second stage boot loader (and thus
   unable to load the kernel). (This is because the first stage boot
   loader contains a list of the blocks that comprise /boot in terms of
   the original "translated" geometry.) If you are using IDE disks, and
   you make changes to your BIOS settings, you can (unknowingly) change
   its translation also (most IDE BIOS offer 3 different translations.)
   To fix your boot block so that you can boot normally, just put a boot
   floppy in your hard drive, and at the boot prompt, type "b hd0a:/bsd"
   to force it to boot from the first hard disk (and not the floppy).
   Your machine should come up normally. You now need to update the first
   stage boot loader to see the new geometry (and re-write the boot block
   accordingly).
   Our example will assume your boot disk is sd0 (but for IDE it would be
   wd0, etc..):
# cd /usr/mdec; ./installboot /boot biosboot sd0
d1580 2
a1581 1
4.14 - Multibooting OpenBSD
d1583 15
a1597 1
   OpenBSD & NT
d1599 9
a1607 4
   To multiboot OpenBSD and NT, you can use NTloader, the bootloader that
   NT uses. To multi-boot with NT, you need a copy of your OpenBSD pbr.
   After running installboot, you can copy it something like this:
        # dd if=/dev/rsd0a of=openbsd.pbr bs=512 count=1
d1609 3
a1611 3
   Now boot NT and put openbsd.pbr in c:. Add a line like this to the end
   of c:\boot.ini:
        c:\openbsd.pbr="OpenBSD"
d1613 5
a1617 3
   When you reboot, you should be able to select OpenBSD from the NT
   loader menu. There is much more information available about NTloader
   at the [22]NTLDR Hacking Guide.
d1619 5
a1623 1
   OpenBSD & Windows or DOS
d1625 6
a1630 4
   To boot OpenBSD along with Windows 3.1, Windows95, or DOS you must use
   a boot loader on the system that can handle OpenBSD, Windows, and DOS!
   Some bootloaders of choice are [23]osbs20b8.zip or [24]The Ranish
   Partition Manager. Both of these are able to boot OpenBSD partitions.
d1632 3
a1634 1
   OpenBSD & Linux
d1636 2
a1637 2
   Please refer to [25]INSTALL.linux, which gives indepth instructions on
   getting OpenBSD working with Linux.
d1639 2
a1640 1
4.15 - Sending your dmesg to dmesg@@openbsd.org after the install
d1642 4
a1645 3
   Just to remind people, it's important for the OpenBSD developers to
   keep track of what hardware works, and what hardware doesn't work
   perfectly..
d1647 10
a1656 9
   A quote from /usr/src/etc/root/root.mail
If you wish to ensure that OpenBSD runs better on your machines, please do us
a favor (after you have your mail system setup!) and type
        dmesg | mail dmesg@@openbsd.org
so that we can see what kinds of configurations people are running.  We will
use this information to improve device driver support in future releases.
(We would be much happier if this information was for the supplied GENERIC
kernel; not for a custom compiled kernel).  The device driver information
we get from this helps us fix existing drivers.
d1658 3
a1660 1
   Also check with [26]section 4.12
d1662 1
a1662 6
   Make sure you send email from an account that is able to also receive
   email so developers can contact you back if they have something they
   want you to test or change in order to get your setup working. It's
   not important at all to send the email from the same machine that is
   running OpenBSD, so if that machine is unable to receive email, just
 dmesg | mail your-account@@yourmail.dom
d1664 1
a1664 2
   and then forward that message to
 dmesg@@openbsd.org
d1666 4
a1669 2
   where your-account@@yourmail.dom is your regular email account. (or
   transfer the dmesg output using ftp/scp/floppydisk/carrier-pigeon/...)
d1671 1
a1671 2
   NOTE - Please send only GENERIC kernel dmesg's. Custom kernels that
   have device drivers removed are not helpful.
d1673 5
a1677 3
   [27][Back to Main Index] [28][To Section 3.0 - Obtaining OpenBSD]
   [29][To Section 5.0 - Kernel configuration and Disk Setup]
     _________________________________________________________________
d1679 1
a1679 2
   [30][back] [31]www@@openbsd.org
   $OpenBSD: faq4.html,v 1.52 1999/08/11 13:24:53 ericj Exp $
d1681 2
a1682 1
References
d1684 1
a1684 31
   1. http://openbsd.org/faq/index.html
   2. http://openbsd.org/faq/faq3.html
   3. http://openbsd.org/faq/faq5.html
   4. http://openbsd.org/orders.html
   5. http://openbsd.org/faq/log25.txt
   6. http://openbsd.org/faq/log25.txt
   7. http://openbsd.org/faq/log25.txt
   8. http://openbsd.org/faq/log25.txt
   9. http://openbsd.org/faq/log25.txt
  10. http://www.openbsd.org/cgi-bin/man.cgi?query=disklabel&sektion=8&format=html
  11. http://openbsd.org/faq/log25.txt
  12. http://www.openbsd.org/cgi-bin/man.cgi?query=fdisk&apropos=0&sektion=8&format=html
  13. http://www.openbsd.org/cgi-bin/man.cgi?query=fdisk&apropos=0&sektion=8&format=html
  14. http://www.openbsd.org/cgi-bin/man.cgi?query=disklabel&apropos=0&sektion=8&format=html
  15. http://www.openbsd.org/cgi-bin/man.cgi?query=newfs&apropos=0&sektion=8&format=html
  16. http://www.openbsd.org/cgi-bin/man.cgi?query=swapctl&sektion=8&format=html
  17. mailto:csapuntz@@openbsd.org
  18. http://www.openbsd.org/cgi-bin/man.cgi?query=installboot&sektion=8&format=html
  19. http://www.prz.tu-berlin.de/~wolf/os-bs.html
  20. http://openbsd.org/faq/INSTALL.linux
  21. http://openbsd.org/faq/faq4.html#4.15
  22. http://www.dorsai.org/~dcl/publications/NTLDR_Hacking/
  23. http://www.freebird.org/sw-map/bootmanager.html
  24. http://www.users.intercom.com/~ranish/part/
  25. http://openbsd.org/faq/INSTALL.linux
  26. http://openbsd.org/faq/faq4.html#4.12
  27. http://openbsd.org/faq/index.html
  28. http://openbsd.org/faq/faq3.html
  29. http://openbsd.org/faq/faq5.html
  30. http://openbsd.org/faq/index.html
  31. mailto:www@@openbsd.org
d1686 2
d1689 1
a1689 2
   [1][Back to Main Index] [2][To Section 4.0 - Installation and Disk
   Setup] [3][To Section 6.0 - Networking]
d1691 7
a1697 1
                   5.0 - Kernel Configuration and Disk Setup
d1699 1
a1699 1
5.1 - Why would I want to create my own custom kernel?
d1701 8
a1708 2
   It is a joyous occasion when you as a user get to configure and build
   your own custom kernel. Why would you want to do this though?
d1710 9
a1718 5
     * You can define which drivers your computer has support for.
     * You can get rid of unneeded drivers in the GENERIC kernel
     * Speed up boot times
     * Remove default options or add options which may not have been
       enabled by default
d1720 3
a1722 1
5.2 - Kernel Configuration Options
d1724 6
a1729 8
   Kernel Configuration Options are options that you add to your kernel
   configuration that place certain features into your kernel. This
   allows you to have exactly the support you want, without having
   support for unneeded devices. There are multitudes of options that
   allow you to customize your kernel. Here we will go over only some of
   them, those that are most commonly used. Check the [4]options(4) man
   page for a more complete list of options. You can also check the
   example configuration files that are available for your architecture.
d1731 105
a1835 6
   Not all kernel options have been tested for compatibility with all
   other options. Don't put an option in your kernel unless you actually
   have a reason to do so! The one kernel configuration which gets the
   most testing is the GENERIC kernel. This is usually a combination of
   the options in /usr/src/sys/arch/<your arch>/conf/GENERIC and
   /usr/src/sys/conf/GENERIC.
d1837 1
a1837 6
     * [5]Alpha Kernel Conf Files
     * [6]i386 Kernel Configuration files
     * [7]mac68k Kernel Configuration files
     * [8]pmax Kernel Configuration Files
     * [9]sparc Kernel Configuration Files
     * [10]Other Arch's
d1839 10
a1848 6
   Look closely at these files and you will notice a line like:
   include "../../../conf/GENERIC"
   This means that it *IS* referencing yet another configuration file.
   This file stores non arch-dependent options. So when creating your
   Kernel Config be sure to look through [11]/sys/conf/GENERIC and see
   what you want. There ARE options in there that are NEEDED.
d1850 2
a1851 10
   All of the options listed below should be placed in your kernel
   configuration file in the format of:
   option OPTION
   for example. To place option debug in the kernel, add a line like
   this:
   option DEBUG
   Options in the OpenBSD kernel are translated into compiler
   preprocessor options, therefore an option like DEBUG would have the
   source compiled with option -DDEBUG. Which is equivalent to doing a
   #define DEBUG throughout the kernel.
d1853 5
a1857 4
   OpenBSD has a great many compatibility options which allow you to use
   binaries from other OS's. Not all are availibly on every
   architechture, so be sure to read the man pages for each option to see
   if your arch is supported.
d1859 2
a1860 16
     * [12]COMPAT_SVR4(8) - Compatibility with SVR4 binaries.
     * [13]COMPAT_BSDOS(8) - Compatibility with BSD/OS binaries.
     * [14]COMPAT_LINUX(8) - Compatibility with Linux binaries.
     * [15]COMPAT_SUNOS(8) - Compatibility with SunOS binaries.
     * [16]COMPAT_ULTRIX(8) - Compatibility with Ultrix binaries.
     * [17]COMPAT_FREEBSD(8) - Compatibility with FreeBSD binaries.
     * COMPAT_HPUX - Compatibility with HP-UX binaries. Only available on
       some m68k arch's.
     * [18]COMPAT_IBCS2(8) - Compatibility to run ibcs2 binaries.
     * COMPAT_OSF1 - Run Digital Unix binaries. Available only on Alpha
       platform.
     * COMPAT_43 - Compatibility with 4.3BSD. Use of this is certainly
       discouraged, But it is needed for our Navigator port
     * COMPAT_11 - Compatibility with NetBSD 1.1
     * COMPAT_NOMID - Compatibility with a.out executables that lack a
       machine id.
d1862 6
a1867 7
   It is always helpful to be able to debug problems with the kernel. But
   many choose not to put these options in their kernel because these
   options add considerable size to the kernel. They are however
   extremely helpful in a case where a bug might be present. This well
   help the developers discover the source of your problems much quicker.
   Here is a list of popular debugging options that can be added to your
   kernel.
d1869 1
a1869 18
     * [19]DDB - This compiles in the in-kernel debugger. This isn't
       available on all platforms. So be sure to read before adding it.
     * [20]KGDB - Compiles a remote kernel debugger using gdb's `remote
       target` feature.
     * makeoptions DEBUG="-g" - Makes bsd.gdb along with bsd. This is
       useful for debugging crash dumps with gdb. NOTE: This option also
       turns on option DEBUG
     * DEBUG - Used to put various debugging options in the kernel, where
       the source has defined them.
     * KTRACE - Adds hooks for the system call tracing facility. Which
       allows users to use [21]ktrace(1).
     * DIAGNOSTIC - Adds code to the kernel that does internal
       consistency checks.
     * GPROF - adds code to the kernel for kernel profiling with
       [22]kgmon(8).
     * makeoptions PROF="-pg" - The -pg flag causes the kernel to be
       compiled with support for profiling. Option GPROF is required to
       use this option.
d1871 6
a1876 50
   Filesystem Options.
     * FFS - Berkeley Fast Filesystem NOTE: This option is required
     * EXT2FS - Second Extended File System, This is needed for those of
       you who want to read Linux partitions.
     * MFS - Memory File System that stores files in swapable memory.
       This is not quite stable as of now.
     * NFS - Network File System, This is needed if you will be using
       NFS.
     * CD9660 - This is iso9660 + rockridge filesystem. This is required
       to read from cd's
     * MSDOSFS - Needed to read MS-DOS FAT filesystems. Also has support
       for Windows 95 long name + mixed case extensions.
     * FDESC - Includes code for a file system which can be mounted on
       /dev/fd
     * KERNFS - Includes code which permits the mounting of a special
       file system (normally mounted on /kern) in which files
       representing various kernel variables and parameters may be found.
     * NULLFS - Code to have a loopback filesystem. [23]mount_null(8) has
       more information
     * PROCFS - Includes code for a special file system (conventionally
       mounted on /proc)
     * PORTAL - Includes the (experimental) portal filesystem. This
       permits interesting tricks like opening TCP sockets by opening
       files in the file system.
     * UMAPFS - Includes a loopback file system in which user and group
       ids may be remapped -- this can be useful when mounting alien file
       systems with different uids and gids than the local system (eg,
       remote NFS).
     * UNION - Includes code for the union file system, which permits
       directories to be mounted on top of each other in such a way that
       both file systems remain visible. This code isn't quite stable
       yet.
     * XFS - Add hooks for using a filesystem that is compatible with the
       AFS filesystem. Currently used by the Arla/AFS code.
     * LFS - Log Structured Filesystem.
     * FFS_SOFTUPDATES - Allows for the use of softupdates. To read up on
       softupdates more read the [24]Softupdates FAQ section.
     * NFSSERVER - Allow for the server-side NFS code to be included in
       the kernel.
     * NFSCLIENT - Allow for the client-side NFS code to be included in
       the kernel.
     * FIFO - Support for FIFO's.. RECOMMENDED.
     * NVNODE=integer - Where integer is the size of the cache used by
       the name-to-inode translation routines, (a.k.a. the namei() cache,
       though called by many other names in the kernel source).
     * EXT2FS_SYSTEM_FLAG - This option changes the behavior of the
       APPEND and IMMUTABLE flags for a file on an EXT2FS filesystem.
       Read [25]options(4) for more details.
     * QUOTA - Support for Filesystem Quota's. To read up on using quotas
       read [26]FAQ 10
d1878 2
a1879 26
   Misc. Options
     * PCIVERBOSE - Make the boot process more verbose for PCI
       peripherals.
     * EISAVERBOSE - Make the boot process more verbose for EISA
       peripherals.
     * PCMCIAVERBOSE - Make the boot process more verbose for PCMCIA
       peripherals.
     * APERTURE - Provide in-kernel support for VGA framebuffer mapping
       by user processes. Needed to run X.
     * XSERVER - Support for the X server console driver. Needed for X.
     * LKM - Support for Loadable Kernel Modules. Not available on all
       arch's. Read [27]lkm(4) for more information.
     * INSECURE - Hardwires the kernel security level to -1. Read
       [28]init(8) for more information on kernel security levels.
     * MACHINE_NONCONTIG - Changes part of the VM/pmap interface, to
       allow for non-contiguous memory.
     * RAM_DISK_HOOKS - Allows for machine dependent functions to be
       called when the ramdisk driver is configured.
     * RAM_DISK_IS_ROOT - Forces the ramdisk to be root.
     * CCDNBUF=integer - Set number of component buffers used by CCD(4).
       Default is 8. For more on CCD read the [29]CCD(4) man page, or the
       [30]Performance Tuning FAQ section.
     * KMEMSTATS - This makes malloc(9), the kernel memory allocator keep
       statistics on its use. If option DEBUG is used, this option is
       automatically turned off by config.
     * BOOT_CONFIG - Adds support of the -c boot option.
d1881 1
a1881 52
   Networking Options
   Also check the [31]Networking FAQ or the [32]Networking Performance
   Tuning FAQ.
     * GATEWAY - Enables IPFORWARDING and (on most ports) increases the
       size of NMBCLUSTERS.
     * NMBCLUSTERS=integer - Controls the size mbuf cluster map.
     * IPFORWARDING - Enables IP routing behavior. With this option
       enabled, the machine will forward IP datagrams between its
       interfaces that are destined for other machines.
     * MROUTING - Includes support for IP multicast routers.
     * INET - Includes support for the TCP/IP protocol stack. This option
       is REQUIRED
     * MCLSHIFT=value - This option is the base-2 logarithm of the size
       of mbuf clusters. Read [33]options(4) for more information on this
       option.
     * NS - Include support for the Xerox XNS protocol stack. See
       [34]ns(4)
     * ISO,TPIP - Include support for the ubiquitous OSI protocol stack.
       See [35]iso(4) for more information.
     * EON - Include support for OSI tunneling over IP.
     * CCITT,LLC,HDLC - Include support for the X.25 protocol stack.
     * IPX, IPXIP - Include support for Internetwork Packet Exchange
       protocol commonly in use by Novell NetWare.
     * NETATALK - Include kernel support for the AppleTalk family of
       protocols.
     * TCP_COMPAT_42 - Use of this option is extremely discouraged, so it
       should not be enabled. TCP bug compatibility with 4.2BSD. In
       4.2BSD, TCP sequence numbers were 32-bit signed values. Modern
       implementations of TCP use unsigned values.
     * TCP_NEWRENO - Turns on NewReno fast recovery phase, which allows
       one lost segment to be recovered per round trip time.
     * TCP_SACK - Turns on selective acknowledgements.
     * TCP_FACK - Turns on forward acknowledgements allowing a more
       precise estimate of outstanding data during the fast recovery
       phase by using SACK information. This option can be used together
       with TCP_SACK.
     * IPFILTER - This option enables the IP filtering on the packet
       level using the ipfilter package.
     * IPFILTER_LOG - This option, in conjunction with IPFILTER, enables
       logging of IP packets using ip-filter.
     * IPFILTER_DEFAULT_BLOCK - This option sets the default policy of
       ip-filter. If it is set, ip-filter will block packets by default.
     * PPP_FILTER - This option turns on [36]pcap(3) based filtering for
       ppp connections.
     * PPP_BSDCOMP - PPP BSD compression.
     * PPP_DEFLATE - Used in conjunction with PPP_BSDCOMP.
     * IPSEC - This option enables IP security protocol support. See
       [37]ipsec(4) for more details. This now implies option KEY, which
       gives support for PFKEYv2.
     * ENCDEBUG - This option enables debugging information to be
       conditionally logged in case IPSEC encounters errors.
     * TCP_SIGNATURE - TCP MD5 Signatures, for BGP routing sessions
d1883 7
a1889 21
   PCVT Options (only valid on i386 architecture)
     * PCVT_NSCREENS=integer - Number of pcvt screens. Defaults to 8.
     * PCVT_VT220KEYB - If activated, a keyboard layout resembling a DEC
       VT200 (TM) is generated.
     * PCVT_SCREENSAVER - Enables the builtin screensaver feature.
       Defaults to on.
     * PCVT_PRETTYSCRNS - If enabled, a blinking-star screensaver is
       used. Default is off.
     * PCVT_CTRL_ALT_DEL - If enabled, the key combination <Ctrl> <Alt>
       <Del> invokes a CPU reset. Default is off.
     * PCVT_USEKBDSEC - Do NOT override a security lock for the keyboard.
       Default is on.
     * PCVT_24LINESDEF - If enabled, the 25-line modi (VT emulation with
       25 lines, and HP emulation with 28 lines) default to 24 lines only
       to provide a better compatibility to the original DEV VT220 (TM).
     * PCVT_EMU_MOUSE - Emulate a three-button mouse via the keypad.
       Useful for notebooks when running XFree86. Defaults to off
     * PCVT_META_ESC - If enabled, a sequence composed of <esc>, followed
       by the normal key code is emitted if a key is pressed with the
       <Alt> key modifier. If disabled, then normal key code with the
       value 0x80 added is sent. Defaults to off.
d1891 1
a1891 5
   SCSI Subsystem Options
     * SCSITERSE - Terser SCSI error messages. This omits the table for
       decoding ASC/ASCQ info, saving about 8 bytes or so.
     * SCSIDEBUG - Prints extra debugging info for the SCSI subsystem to
       the console.
d1893 1
a1893 1
5.3 - Building your own kernel
d1895 2
a1896 2
   Full instructions for creating your own custom kernel are in the
   [38]afterboot(8) man page.
d1898 5
a1902 8
   To compile your kernel from the cdrom you need to first have the
   source code available. You just need the kernel source to be able to
   compile the kernel, and this source code is available on the cd. Here
   is how to copy the sources from the cd. This example assumes that CD1
   is mounted on /mnt.
#mkdir -p /usr/src/sys
#cd /mnt/sys
#tar cf - . | ( cd /usr/src/sys; tar xvf - )
d1904 1
a1904 12
   Now to create your custom kernel it is easiest to start with the
   GENERIC kernel. This is located at
   /usr/src/sys/arch/${arch}/conf/GENERIC, where ${arch} is your
   architecture. There are other sample configurations available in that
   directory as well. Here are two examples for compiling your kernel.
   The first example is compiling your kernel on a read-only source tree.
   The second on a writeable source tree.
#cd /somewhere
#cp /usr/src/sys/arch/$ARCH/conf/SOMEFILE .
#vi SOMEFILE (to make the changes you want)
#config -s /usr/src/sys -b . SOMEFILE
#make
d1906 5
a1910 6
   To compile a kernel inside a writeable source tree do the following:
#cd /sys/arch/$ARCH/conf
#vi SOMEFILE (to make any changes you want)
#config SOMEFILE (read more about it here : [39]config(8))
#cd ../compile/SOMEFILE
#make
d1912 3
a1914 3
   Where $ARCH is the architecture you are using (e.g. i386). You can
   also do a make depend to make the dependencies for the next time you
   compile your kernel.
d1916 5
a1920 3
   To move your kernel into place.
#cp /bsd /bsd.old
#cp /sys/arch/$ARCH/compile/SOMEFILE/bsd /bsd
d1922 3
a1924 2
   To revert to your old kernel at boot you need to just
boot>bsd.old
d1926 2
a1927 1
   and your old kernel will be loaded instead of /bsd.
d1929 2
a1930 1
5.4 - Boot Time Configuration
d1932 8
a1939 9
   Sometimes when booting your system you might notice that the kernel
   finds your device but maybe at the wrong IRQ. And maybe you need to
   use this device right away. Well, without rebuilding the kernel you
   can use OpenBSD's boot time kernel configuration. This will only
   correct your problem for one time. If you reboot, you will have to
   repeat this procedure. So, this is only meant as a temporary fix, and
   you should correct the problem by fixing and recompiling your kernel.
   Your kernel does however need option BOOT_CONFIG in the kernel, which
   GENERIC does have.
d1941 1
a1941 4
   Most of this document can be found in the man page [40]boot_config(8)
   To boot into the User Kernel Config, or UKC, at boot time us the -c
   option.
Boot> boot wd0a:/bsd -c
d1943 39
a1981 3
   Or whichever kernel it is you want to boot. Doing this will bring up a
   UKC prompt. From here you can issue commands directly to the kernel
   specifying devices you want to change or disable or even enable.
d1983 15
a1997 1
   Here is a list of common commands in the UKC.
d1999 7
a2005 1
   add device - Add a device through copying another
d2007 11
a2017 1
   change devno | device - Modify one or more devices
d2019 43
a2061 1
   disable devno | device - Disable one or more devices
d2063 3
a2065 1
   enable devno | device - Enable one or more devices
d2067 2
a2068 1
   find devno | device - Find one or more devices
d2070 1
a2070 1
   help - Short summary of these commands
d2072 32
a2103 1
   list - List ALL known devices
a2104 1
   exit/quit - Continue Booting
d2106 2
a2107 2
   show [attr [val]] - Show devices with an attribute and optional with a
   specified value
d2109 1
a2109 4
   Once you get your device configured, use quit or exit and continue
   booting. After doing so you should correct your Kernel configuration
   and Compile a new kernel. Refer to [41]Building your own kernel for
   help.
d2111 1
a2111 3
   [42][Back to Main Index] [43][To Section 4.0 - Installation and Disk
   Setup] [44][To Section 6.0 - Networking]
     _________________________________________________________________
d2113 2
a2114 2
   [45][back] [46]www@@openbsd.org
   $OpenBSD: faq5.html,v 1.27 1999/07/26 15:10:46 ericj Exp $
d2116 2
a2117 1
References
d2119 1
a2119 46
   1. http://openbsd.org/faq/index.html
   2. http://openbsd.org/faq/faq4.html
   3. http://openbsd.org/faq/faq6.html
   4. http://www.openbsd.org/cgi-bin/man.cgi?query=options&apropos=0&sektion=4&format=html
   5. http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/alpha/conf/
   6. http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/i386/conf/
   7. http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/mac68k/conf/
   8. http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/pmax/conf/
   9. http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/sparc/conf/
  10. http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/
  11. http://www.openbsd.org/cgi-bin/cvsweb/src/sys/conf/GENERIC
  12. http://www.openbsd.org/cgi-bin/man.cgi?query=compat_svr4&sektion=8&apropos=0&manpath=OpenBSD+Current
  13. http://www.openbsd.org/cgi-bin/man.cgi?query=compat_bsdos&sektion=8&apropos=0&manpath=OpenBSD+Current
  14. http://www.openbsd.org/cgi-bin/man.cgi?query=compat_linux&sektion=8&apropos=0&manpath=OpenBSD+Current
  15. http://www.openbsd.org/cgi-bin/man.cgi?query=compat_sunos&sektion=8&apropos=0&manpath=OpenBSD+Current
  16. http://www.openbsd.org/cgi-bin/man.cgi?query=compat_ultrix&sektion=8&apropos=0&manpath=OpenBSD+Current
  17. http://www.openbsd.org/cgi-bin/man.cgi?query=compat_freebsd&sektion=8&apropos=0&manpath=OpenBSD+Current
  18. http://www.openbsd.org/cgi-bin/man.cgi?query=compat_ibcs2&sektion=8&apropos=0&manpath=OpenBSD+Current
  19. http://www.openbsd.org/cgi-bin/man.cgi?query=ddb&sektion=4&format=html
  20. http://www.openbsd.org/cgi-bin/man.cgi?query=gdb&sektion=1&format=html
  21. http://www.openbsd.org/cgi-bin/man.cgi?query=ktrace&sektion=1&format=html
  22. http://www.openbsd.org/cgi-bin/man.cgi?query=kgmon&sektion=8&format=html
  23. http://www.openbsd.org/cgi-bin/man.cgi?query=mount_null&sektion=8&format=html
  24. http://openbsd.org/faq/faq4.html#4.9
  25. http://www.openbsd.org/cgi-bin/man.cgi?query=options&sektion=4&format=html
  26. http://openbsd.org/faq/faq10.html#10.10
  27. http://www.openbsd.org/cgi-bin/man.cgi?query=lkm&sektion=4&format=html
  28. http://www.openbsd.org/cgi-bin/man.cgi?query=init&sektion=8&format=html
  29. http://www.openbsd.org/cgi-bin/man.cgi?query=ccd&sektion=4&format=html
  30. http://openbsd.org/faq/faq12.html#12.2
  31. http://openbsd.org/faq/faq6.html
  32. http://openbsd.org/faq/faq12.html#12.1
  33. http://www.openbsd.org/cgi-bin/man.cgi?query=options&sektion=4&format=html
  34. http://www.openbsd.org/cgi-bin/man.cgi?query=ns&sektion=4&apropos=0&manpath=OpenBSD+Current
  35. http://www.openbsd.org/cgi-bin/man.cgi?query=iso&sektion=4&format=html
  36. http://www.openbsd.org/cgi-bin/man.cgi?query=pcap&sektion=3&format=html
  37. http://www.openbsd.org/cgi-bin/man.cgi?query=ipsec&sektion=4&format=html
  38. http://www.openbsd.org/cgi-bin/man.cgi?query=afterboot&apropos=0&sektion=8&format=html
  39. http://www.openbsd.org/cgi-bin/man.cgi?query=config&apropos=0&sektion=8&format=html
  40. http://www.openbsd.org/cgi-bin/man.cgi?query=boot_config&apropos=0&sektion=8&format=html
  41. http://openbsd.org/faq/faq5.html#5.3
  42. http://openbsd.org/faq/index.html
  43. http://openbsd.org/faq/faq4.html
  44. http://openbsd.org/faq/faq6.html
  45. http://openbsd.org/faq/index.html
  46. mailto:www@@openbsd.org
d2121 1
d2123 1
a2123 2
   [1][Back to Main Index] [2][To Section 5.0 - Kernel configuration and
   Disk Setup] [3][To Section 7.0 - Keyboard controls]
d2125 2
a2126 1
                               6.0 - Networking
d2129 2
a2130 1
6.1 - Initial Network Setup
d2132 1
a2132 1
  Interfaces
d2134 8
a2141 4
   Here we assume you have all your network interfaces working, and a
   basic TCP/IP knowledge. If not, go to the [4]Kernel Configuration and
   Setup section, and/or read a good introduction to TCP/IP. Other
   recommended reading is the [5]ifconfig(8) and [6]netstat(1) man pages.
a2142 2
   All your interfaces should be listed with:
# ifconfig -a
d2144 2
a2145 15
lo0: flags=8009<UP,LOOPBACK,MULTICAST>
        inet 127.0.0.1 netmask 0xff000000
lo1: flags=8008<LOOPBACK,MULTICAST>
xl0: flags=8843<UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST>
        media: Ethernet 100baseTX half-duplex
        inet 10.1.1.1 netmask 0xffffff00 broadcast 10.1.1.255
sl0: flags=c010<POINTOPOINT,LINK2,MULTICAST>
        inet 10.1.1.1 netmask 0xffffff00 broadcast 10.1.1.255
sl0: flags=c010<POINTOPOINT,LINK2,MULTICAST>
sl1: flags=c010<POINTOPOINT,LINK2,MULTICAST>
ppp0: flags=8010<POINTOPOINT,MULTICAST>
ppp1: flags=8010<POINTOPOINT,MULTICAST>
tun0: flags=10<POINTOPOINT>
tun1: flags=10<POINTOPOINT>
enc0: flags=8<LOOPBACK>
d2147 1
a2147 9
   First there is lo0 the loopback interface. It MUST have the assigned
   address of 127.0.0.1 no matter what network setup you use. The next
   important one is xl0 in this example (could be neX or epX depending on
   the brand), which is a board itself. Look it has UP and RUNNING flags
   on, as lo0 but no other interface has them. That means obviously they
   are working. Your interface could be down if you never configured it,
   and look like the other interfaces. The others are not part of this
   section, as sl and ppp are for serial line comunication, tun is a
   pseudo-device for tunneling and enc a pseudo-device for encryption.
d2149 1
a2149 3
   If xl0 was uninitialized, you can assign it an address by creating an
   ascii file, /etc/hostname.xl0, containing a string like this:
inet 10.1.1.1 255.255.255.0 NONE
d2151 3
a2153 5
   In the above example we show inet 10.1.1.1, where the second argument
   is our IP address. 255.255.255.0 is our netmask and NONE shows no
   media tags. (full-duplex, etc). This hostname 'mona' needs to have
   record in /etc/hosts:
10.1.1.1        mona    mona.openbsd.org.ar
d2155 2
a2156 12
   What actually happens when you boot is that it looks up 'mona' in
   /etc/hosts, and then configures the interface to 10.1.1.1. If you have
   multiple ethernet interfaces, this is probably a painful way to do
   things, and so you can also put the number right in /etc/hostname.xl0:
inet 10.1.1.1 255.255.255.0 NONE

   Now check that you have a file /etc/myname and a file /etc/mygate. If
   you don't have them, you need to create them. If your gateway is a
   machine named "wintermute" which is also in the /etc/hosts, use these
   commands:
# echo "mona" > /etc/myname
# echo "wintermute" > /etc/mygate
d2158 5
a2162 3
   Ok, you are done for a standalone system, but to activate your
   configuration now (without rebooting) do:
# sh /etc/netstart
d2164 4
a2167 2
   This will give you a few errors, but don't worry as all them are
   concerning 127.0.0.x (loopback)
d2169 1
a2169 2
   Note: if you want to use the system as a gateway, later there's a
   "Firewall Setup" section, but you need to read all this first.
d2171 3
a2173 4
   Now check your routes are ok (here we use -n to make it simpler to
   look at):
# netstat -rn
Routing tables
d2175 5
a2179 10
Internet:
Destination        Gateway            Flags     Refs     Use    Mtu
Interface
default            10.1.1.254         UGS         0        0      -  xl0
10.1.1/24          link#1             UC          0        0      -  xl0
10.1.1.1           127.0.0.1          UGHS        0        0      -  lo0
10.1.1.254         link#1             UHL         1        0      -  xl0
127/8              127.0.0.1          UGRS        0        0      -  lo0
127.0.0.1          127.0.0.1          UH          3       24      -  lo0
224/8              link#1             UCS         0        0      -  xl0
d2181 1
a2181 3
Encap:
Source address/netmask          Port  Destination address/netmask     Port Prot
o SA(Address/SPI/Proto)
d2183 10
a2192 1
   (The default gateway here is 10.1.1.254)
d2194 1
a2194 1
  IP Aliasing
d2196 3
a2198 4
   If you want to map more than one IP address on a single network
   interface, you need to assign an "alias" to it. The way to do it on
   OpenBSD is simply assigning the interface another IP with the "alias"
   option like this:
d2200 2
a2201 1
# ifconfig xl0 alias 10.1.1.2 netmask 255.255.255.255
d2203 2
a2204 5
   Here ne2 is assigned another IP number (remember it already has
   10.1.1.1). Note the netmask used! Don't use 255.255.255.0 in this kind
   of case (both numbers are on the same subnet), only ONE address should
   handle the subnet. If you do such kind of misconfiguration, the
   following error appears:
d2206 6
a2211 1
ifconfig:SIOCAIFADDR: File exists
d2213 2
a2214 2
   Now let's change the configuration file for this, /etc/ifaliases. Add
   to it this line:
d2216 1
a2216 1
xl0   10.1.1.2 255.255.255.255
d2218 6
a2223 2
   This means, simply, interface xl0 should have an alias 10.1.1.2 with
   the netmask 255.255.255.255.
d2225 1
a2225 1
  DNS Client Setup
d2227 5
a2231 7
   Let's assume your DNS servers are 125.2.3.4 and 125.2.3.5, and your
   machine name belongs to the domain yourdomain.com. You should have the
   following lines to your /etc/resolv.conf file:
domain yourdomain.com
nameserver 125.2.3.4
nameserver 125.2.3.5
lookup file bind
d2233 5
a2237 1
  Gateway Setup
d2239 5
a2243 8
   This is the basic information you need to set up your OpenBSD box as a
   gateway (also called a router.) If you are using OpenBSD as a router
   on the Internet, we suggest that you also read the IP Filter setup
   instructions below to block potentially malicious traffic. Also, due
   to the low availability of IPv4 addresses from network service
   providers and regional registries, you may want to look at Network
   Address Translation (next section of this document) for information on
   conserving your IP address space.
d2245 2
a2246 9
   If you want your OpenBSD machine to act as a dedicated router, and you
   are building a custom kernel configuration for it, you can either
   compile your kernel with options IPFORWARDING or GATEWAY. (See
   [7]section 12 for further information on tuning NMBCLUSTERS if you are
   doing this.) For the rest of us, OpenBSD now has a sysctl mechanism to
   turn on and off IP Forwarding at boot. If you want it to "forward" any
   packets between your interfaces, modify the /etc/sysctl.conf line that
   toggles the forwarding variable on bootup:
net.inet.ip.forwarding=1
d2248 13
a2260 3
   To make the changes without booting:
# sysctl -w net.inet.ip.forwarding=1
net.inet.ip.forwarding: 0 -> 1
d2262 25
a2286 6
   Now modify the routes on the other hosts on both sides. There are many
   possible uses of OpenBSD as a router, using software such as
   [8]routed(8), [9]gated, [10]mrtd, and [11]zebra. OpenBSD has support
   in the ports collection for both gated and mrtd. OpenBSD supports
   several T1, HSSI, ATM, FDDI, Ethernet, and serial (PPP/SLIP)
   interfaces.
d2288 4
a2291 1
6.2 - IP Filter - ipf and ipnat setup
d2293 5
a2297 5
   The IP Filter package was created to handle two tasks, dealing with
   packet level forwarding permissions [12]ipf(8) and mapping
   hosts/subnets to a range of external addresses [13]ipnat(8). The
   configuration files for these two services are /etc/ipf.rules and
   /etc/ipnat.rules.
d2299 1
a2299 5
   You need to edit /etc/rc.conf to activate them at boot time. You also
   need to have net.inet.ip.forwarding=1 in your /etc/sysctl.conf (or
   your kernel needs to have IPFORWARDING or GATEWAY options turned on.)
   You also need a kernel compiled with option IPFILTER and IPFILTER_LOG
   (the GENERIC kernels do have these options).
d2301 17
a2317 4
   If you have IP Filter compiled into your kernel, but you don't have it
   turned on in your /etc/rc.conf file, you can still activate it easily.
# ipf -Fa -f /etc/ipf.rules -E
# ipnat -CF -f /etc/ipnat.rules
d2319 1
a2319 3
   The -E flag on ipf 'enables' IP Filter. -Fa clears out any rules that
   you may have in there. -f /etc/ipf.rules loads the rules from
   /etc/ipf.rules.
d2321 4
a2324 3
   If you make changes to /etc/ipf.rules after ipf is loaded, you can
   reload your rules pretty easily!
# ipf -Fa -f /etc/ipf.rules
d2326 1
a2326 2
   Same for ipnat...
# ipnat -CF -f /etc/ipnat.rules
d2328 6
a2333 6
   This document will cover some basic ipf and ipnat configurations
   below. There are a lot of nice examples in /usr/share/ipf/ for ipnat
   and ipf. We recommend you choose the one closest to what you want, and
   modify it to fit your needs. You can find other IP Filter information
   at the IP Filter [14]mailing list archive, the [15]IP Filter web site,
   and finally the [16]IP Filter HOWTO.
d2335 5
a2339 1
  IPF
d2341 1
a2341 5
   Modify rc.conf so it has IPFILTER=YES. The file /etc/ipf.rules has a
   simple yet powerful syntax. Here we deal with the most common ways of
   usage, for a more strict definition see [17]ipf(5). Here is assumed
   xl0 as the external interface to internet, on this one uses to have
   more rules than internal interfaces.
d2343 3
a2345 3
   Configurations usually start letting everything come and go, and then
   apply the necessary rules to block offending packets. So this is
   first:
d2347 4
a2350 2
pass out from any to any
pass in from any to any
d2352 4
a2355 2
   Now let's block any incoming connection to port 82 tcp (eg. there's an
   internal network report agent using http running on several hosts):
d2357 40
a2396 1
block in on xl0 proto tcp from any to any port = 82
d2398 24
a2421 1
   This rule means:
d2423 11
a2433 2
   "Block all incoming packets on xl0 interface whose protocol is TCP no
   matter destination/origin using port 82"
d2435 9
a2443 3
   If you want to log all rejected packets add "log" after "block in", or
   "log quick" if you don't want it to send a message to every console
   root is logged in.
d2445 1
a2445 1
   Also, a typical rule is to block rpc portmap:
d2447 2
a2448 1
block in log on xl0 proto udp from any to any port = sunrpc
d2450 1
a2450 1
  IPNAT
d2452 5
a2456 6
   Based on [18]RFC 1631, ipnat provides an easy way to map internal
   networks to a single routeable ("real") internet address. This is very
   useful if you don't have officially assigned addresses for every host
   on your internal network. When you set up private/internal networks,
   you can take advantage of reserved address blocks (assigned in [19]RFC
   1918), such as:
d2458 9
a2466 3
   10.0.0.0/8 (10.0.0.0 - 10.255.255.255)
   172.16.0.0/12 (172.16.0.0 - 172.31.255.255)
   192.168.0.0/16 (192.168.0.0 - 192.168.255.255)
d2468 4
a2471 5
   To use ipnat, ipf must be activated. As outlined above, for changes to
   stay effective through reboots, you should make changes to
   /etc/rc.conf (where it has IPNAT and IPFILTER.) You can manually
   activate ipf with the command below.
# ipf -E
d2473 1
a2473 4
   Example: You have an internal network using 192.168.5.0, with a
   netmask of 255.255.255 0, and you want to give it access to internet
   using OpenBSD (of course!), and a ppp connection using address
   200.1.2.3, use this rule:
d2475 2
a2476 1
map tun0 192.168.5.0/24 -> 200.1.2.3/32
d2478 3
a2480 1
   This rule means:
d2482 1
a2482 3
   "Any IP connections going out tun0 from an address matching the first
   24 bits of 192.168.5.0 should be mapped to the address 200.1.2.3 (only
   one address since /32 means every bit)"
d2484 2
a2485 3
   If you don't like using CIDR notation, IP Filter also allows you to
   use netmasks. A functional equivalent to the example above, using
   netmasks looks like this:
d2487 1
a2487 1
map tun0 192.168.5.0/255.255.255.0 -> 200.1.2.3/255.255.255.255
d2489 3
a2491 10
   But here arises a problem. You are assigning a lot of addresses to
   only one address. But the port numbers aren't changing, and it is very
   likely that your workstations on 192.168.5.0/24 will use the same port
   numbers to initiate connections from. (If this doesn't make sense,
   don't worry, but keep reading.) The way to go around it is to map TCP
   and UDP ports to a certain range with the option "portmap". Since ICMP
   doesn't even use ports, it is not covered by the "portmap" rule. (ICMP
   uses an ID field usually based on a process number) In our example,
   there are now two map rules to cover all of these protocols. The end
   result looks like this:
d2493 2
a2494 2
map tun0 192.168.5.0/24 -> 200.1.2.3/32 portmap tcp/udp 10000:65000
map tun0 192.168.5.0/24 -> 200.1.2.3/32
d2496 1
a2496 5
   If you have a dynamic address assignment (as in, you do not know what
   address they will give you when you connect), you can put the
   interface name in place of the IP address. Note that if you do this,
   you will have to run ipnat -CF -f /etc/ipnat.rules every time your IP
   address changes (or, every time you dial up.)
d2498 2
a2499 2
map tun0 192.168.5.0/24 -> tun0/32 portmap tcp/udp 10000:65000
map tun0 192.168.5.0/24 -> tun0/32
d2501 1
a2501 6
   NAT is also able to help you in renumbering. Say you were assigned a
   net block 35.8.9.0/22, and your internet provider can no longer route
   these addresses to you, or say you are switching providers. Your new
   address block is 192.9.4.0/22, but to switch all 500 devices you have
   on this block would be very time consuming! ipnat provides a feature
   called bimap:
d2503 6
a2508 1
bimap xl0 35.8.9.0/22 -> 192.9.4.0/22
d2510 5
a2514 6
   This will literally map every computer in 35.8.9.0 to a new address in
   192.9.4.0. The drawback of this feature is that the translation is not
   consistent. A computer that initiates a connection from 35.8.9.0 will
   get a random IP address from 192.9.4.0. A future version of IP Filter
   will allow for one-to-one translation (where 35.8.9.99 will always get
   mapped to 192.9.4.99).
d2516 2
a2517 2
   And of course, there are other potential uses of NAT that are probably
   beyond the scope of this document.
d2519 1
a2519 1
  Redirecting ports
d2521 9
a2529 7
   This is another very handy feature of IPNAT. If you have a host on the
   internal network (using private addresses), and you want to let
   incoming connections to it, you just need a simple redirect rule. For
   example, if you have a web server on internal network at 10.2.2.7
   listening on port 80, and want it to be accessible from the outside
   simply redirecting external IP 120.2.3.4 on xl0, just add this rule to
   /etc/ipnat.rules:
d2531 1
a2531 1
rdr xl0 120.2.3.4 port 80 -> 10.2.2.7 port 80
d2533 1
a2533 1
   When you write rules, it may help to visualize the packet flow.
d2535 1
a2535 2
Internet <--> (xl0 120.2.3.4) OpenBSD (xl1 10.2.2.1) <--> LAN <--> (10.2.2.7 XY
Z Web server)
d2537 10
a2546 5
   One last reminder that you must have net.inet.ip.forwarding=1 or
   option IPFORWARDING to use IP Filter (ipf, ipnat). Also, redirect only
   works for packets that are being routed through the OpenBSD box. If a
   web browser from inside the NAT (say, from 10.2.2.5 from the example
   above) tries to connect to port 80 on 120.2.3.4, nothing will happen.
d2548 1
a2548 1
6.3 - IPSec
d2550 4
a2553 5
   IPSec is partially documented in the [20]vpn(8) man page. There are
   various files in [21]/usr/share/ipsec/ directory which can also assist
   you. The manual pages for [22]ipsec(4), [23]ipsecadm(8),
   [24]photurisd(8), [25]startkey(1), [26]isakmpd(8) and
   [27]isakmpd.conf(5) are also available!
d2555 19
a2573 3
   You should also check [28]Codetalker which has an FAQ for setting up
   an IPSec VPN with OpenBSD. It explains some basic IPSec concepts and
   how to apply them to a VPN setup.
d2575 2
a2576 1
6.4 - DHCP
d2578 9
a2586 5
   To use the DHCP client [29]dhclient(8) included with OpenBSD, edit
   /etc/hostname.xl0 (this is assuming your main ethernet interface is
   xl0. Yours might be ep0 or fxp0 or something else!) All you need to
   put in this hostname file is 'dhcp'
# echo dhcp >/etc/hostname.xl0
d2588 3
a2590 3
   This will cause OpenBSD to automatically start the DHCP client on
   boot. OpenBSD will gather its IP address, default gateway, and DNS
   servers from the DHCP server.
d2592 1
a2592 5
   If you want to use OpenBSD as a DHCP server [30]dhcpd(8), edit
   /etc/rc.conf. Set it up so that dhcpd_flags="-q" instead of
   dhcpd_flags=NO. Put the interfaces that you want dhcpd to *listen* on
   in /etc/dhcpd.interfaces.
# echo xl1 xl2 xl3 >/etc/dhcpd.interfaces
d2594 24
a2617 3
   Then, edit /etc/dhcpd.conf. The options are pretty self explanatory.
        option  domain-name "xyz.mil";
        option  domain-name-servers 192.168.1.3, 192.168.1.5;
d2619 11
a2629 2
        subnet 192.168.1.0 netmask 255.255.255.0 {
                option routers 192.168.1.1;
d2631 7
a2637 2
                range 192.168.1.32 192.168.1.127;
        }
d2639 14
a2652 8
   This will tell your dhcp clients that the domain to append to DNS
   requests is xyz.mil (so, if the user types in 'telnet joe' then it
   will send them to joe.xyz.mil). It will point them to DNS servers
   192.168.1.3 and 192.168.1.5. For hosts that are on the same network as
   an ethernet interface on the OpenBSD machine, which is in the
   192.168.1.0/24 range, it will assign them an IP address between
   192.168.1.32 and 192.168.1.127. It will set their default gateway as
   192.168.1.1.
d2654 2
a2655 1
6.5 - PPP
d2657 1
a2657 20
   PPP is generally an easy thing to set up. What follows is a basic
   introduction based on the information provided in /etc/ppp and the
   [31]ppp(8) manual pages. These are highly suggested reading before
   attempting to setup PPP or even reading this FAQ entry. If you have
   read these the following should look familiar because it is that
   information with a little bit of elaboration.

   First you will need to find out a little bit about how your ISP sets
   up its PPP connections. Does it use scripted login, PAP, CHAP, do you
   have a dynamic or static IP etc. This along with some basic info about
   your modem will allow us to easily create a PPP dial in script for
   your ISP.

   First we will create a PPP conf using what is already in
   /etc/ppp/ppp.conf.sample as a guide. The first section we come to is
   the section labeled default. This is the best place to specify logging
   options, your modem device and dial options. It will always be
   executed when ppp is run. The following is the default section that
   comes standard with /etc/ppp/ppp.conf.sample and an explanation of
   what each parameter does:
d2659 9
a2667 2
   <Default Section>
   default:
d2669 5
a2673 3
   This parameter tells PPP to log output which pertains to the arguments
   you give the parameter.
set log Phase Chat LCP IPCP CCP tun command
d2675 1
a2675 3
   This will set the default modem device on the system which here is com
   2
set device /dev/cua01
d2677 5
a2681 2
   This parameter sets the speed of the serial device.
set speed 115200
d2683 5
a2687 8
   This will set the commands to follow when certain actions take place
   while dialing. Abort the call if the number is busy, abort the call if
   there is no carrier. Wait 5 seconds for carrier. Issue AT and wait for
   response. If AT is ok then dial the number and timeout if not
   connected in 40 seconds. Once dialed in wait for the CONNECT message
   to tell us we are connected.
set dial "ABORT BUSY ABORT NO\\sCARRIER TIMEOUT 5 \"\" AT OK-AT-OK ATE1Q0 OK\\d
ATDT\\T TIMEOUT 40 CONNECT"
d2689 4
a2692 8
   Now that the default modem options are set we will need to create a
   section in the ppp.conf for our ISP. Below are a few examples of what
   could be in there and what type of isp they are tailored for.

   <MyISP Section>
   myisp:
   This of course sets the number to dial for your isp.
set phone 1234567
d2694 2
a2695 5
   This sets the login options. It will abort login if there is no
   carrier with a timeout of 5 seconds. It will then wait for the login:
   prompt and send your login name, and then it will wait for the
   password prompt and send your password.
set login "ABORT NO\\sCARRIER TIMEOUT 5 ogin:--ogin: ppp word: ppp"
d2697 1
a2697 2
   This sets the timeout for the entire login process.
set timeout 120
d2699 3
a2701 5
   This will set the ip address you expect for your side and for the
   remote side of the connection. The /0 bit tells the connection that no
   bits of this ip address need to match and the whole thing can be
   replaced. This also sets your default netmask and gateway.
set ifaddr 10.0.0.1/0 10.0.0.2/0 255.255.255.0 0.0.0.0
d2703 3
a2705 3
   This will make the default gateway the remote end of the ppp
   connection.
add default HISADDR
d2707 3
a2709 4
   This tells ppp to ask the peer for the nameserver addresses that
   should be used. This isn't always supported, but if it is
   /etc/resolv.conf will automatically be updated.
enable dns
d2711 2
a2712 10
   <Pap/Chap Section>
   What if your ISP uses PAP or CHAP? Here is a configuration that will
   work with both PAP or CHAP, PPP will decide which it needs to use.
   myispPAPCHAP:
   This line sets the phone number.
set PHONE 1234567

   PPP will be waiting for the peer to suggest the use of either PAP or
   CHAP.
set LOGIN
d2714 1
a2714 2
   This is where you specify your username.
set authname MyName
d2716 34
a2749 2
   This is where you specify your password.
set authkey MyKey
a2750 2
   This sets the login timeout to 120 seconds.
set timeout 120
d2752 2
a2753 2
   And then procede with the standard commands from above.
   <Static Ip Section>
d2755 1
a2755 1
   All you need to do is change the ifaddr parameter like so:
d2757 1
a2757 1
set ifaddr 209.115.93.18 209.115.93.20
d2759 5
a2763 2
   In this example, your IP is 209.115.93.18, and the peer side IP is
   209.115.93.20.
d2765 46
a2810 3
   [32][Back to Main Index] [33][To Section 5.0 - Kernel configuration
   and Disk Setup] [34][To Section 7.0 - Keyboard controls]
     _________________________________________________________________
d2812 1
a2812 2
   [35][back] [36]www@@openbsd.org
   $OpenBSD: faq6.html,v 1.22 1999/07/26 17:38:46 ericj Exp $
d2814 1
a2814 1
References
d2816 1
a2816 36
   1. http://openbsd.org/faq/index.html
   2. http://openbsd.org/faq/faq5.html
   3. http://openbsd.org/faq/faq7.html
   4. http://openbsd.org/faq/faq5.html
   5. http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&apropos=0&sektion=8&format=html
   6. http://www.openbsd.org/cgi-bin/man.cgi?query=netstat&apropos=0&sektion=1&format=html
   7. http://openbsd.org/faq/faq12.html
   8. http://www.openbsd.org/cgi-bin/man.cgi?query=routed&apropos=0&sektion=8&format=html
   9. http://www.gated.org/
  10. http://www.mrtd.net/
  11. http://www.zebra.org/
  12. http://www.openbsd.org/cgi-bin/man.cgi?query=ipf&apropos=0&sektion=8&format=html
  13. http://www.openbsd.org/cgi-bin/man.cgi?query=ipnat&apropos=0&sektion=8&format=html
  14. http://false.net/ipfilter/
  15. http://cheops.anu.edu.au/~avalon/ip-filter.html
  16. http://www.swcp.com/~synk/ipf-howto.txt
  17. http://www.openbsd.org/cgi-bin/man.cgi?query=ipf&apropos=0&sektion=5&format=html
  18. http://www.geektools.com/rfc/rfc1631.txt
  19. http://www.geektools.com/rfc/rfc1918.txt
  20. http://www.openbsd.org/cgi-bin/man.cgi?query=vpn&apropos=0&sektion=0&format=html
  21. http://www.openbsd.org/cgi-bin/cvsweb/src/share/ipsec/
  22. http://www.openbsd.org/cgi-bin/man.cgi?query=ipsec&apropos=0&sektion=4&format=html
  23. http://www.openbsd.org/cgi-bin/man.cgi?query=ipsecadm&apropos=0&sektion=8&format=html
  24. http://www.openbsd.org/cgi-bin/man.cgi?query=photurisd&apropos=0&sektion=8&format=html
  25. http://www.openbsd.org/cgi-bin/man.cgi?query=startkey&apropos=0&sektion=1&format=html
  26. http://www.openbsd.org/cgi-bin/man.cgi?query=isakmpd&apropos=0&sektion=8&format=html
  27. http://www.openbsd.org/cgi-bin/man.cgi?query=isakmpd.conf&apropos=0&sektion=5&format=html
  28. http://www.codetalker.com/greenbox/docs/vpn-24-minifaq.html
  29. http://www.openbsd.org/cgi-bin/man.cgi?query=dhclient&apropos=0&sektion=8&format=html
  30. http://www.openbsd.org/cgi-bin/man.cgi?query=dhcpd&apropos=0&sektion=8&format=html
  31. http://www.openbsd.org/cgi-bin/man.cgi?query=ppp&apropos=0&sektion=8&format=html
  32. http://openbsd.org/faq/index.html
  33. http://openbsd.org/faq/faq5.html
  34. http://openbsd.org/faq/faq7.html
  35. http://openbsd.org/faq/index.html
  36. mailto:www@@openbsd.org
d2818 2
d2821 4
a2824 2
   [1][Back to Main Index] [2][To Section 6.0 - Networking] [3][To
   Section 8.0 - General Questions]
d2826 4
a2829 1
                            7.0 - Keyboard controls
d2831 8
a2838 1
7.1 - How do I remap the keyboard?
d2840 10
a2849 2
   By using kcon(1), "kcon - keyboard control and remapping for the pcvt
   driver"
d2851 1
a2851 2
   Example:
bsd# kcon -m gb
d2853 10
a2862 1
   This will load the keycap file for Great Britain.
d2864 5
a2868 3
7.2 - Is there gpm or the like in OpenBSD?

   No. But if you are willing to make a port. Please share. :)
d2870 2
a2871 2
   [4][Back to Main Index] [5][To Section 6.0 - Networking] [6][To
   Section 8.0 - General Questions]
d2874 2
a2875 2
   [7][back] [8]www@@openbsd.org
   $OpenBSD: faq7.html,v 1.6 1999/07/03 05:51:35 ericj Exp $
d2880 20
a2899 7
   2. http://openbsd.org/faq/faq6.html
   3. http://openbsd.org/faq/faq8.html
   4. http://openbsd.org/faq/index.html
   5. http://openbsd.org/faq/faq6.html
   6. http://openbsd.org/faq/faq8.html
   7. http://openbsd.org/faq/index.html
   8. mailto:www@@openbsd.org
d2902 2
a2903 2
   [1][Back to Main Index] [2][To Section 7.0 - Keyboard controls] [3][To
   Section 9.0 - Tips for linux users]
d2905 2
a2906 1
                            8.0 - General Questions
d2908 1
a2908 1
8.1 - What are these Kerberos warning when I first login?
d2910 6
a2915 3
   When you first install your system you will most likely notice a
   warning message that is something like this:
   Warning: no Kerberos tickets issued.
d2917 4
a2920 2
   THIS WARNING IS COMPLETELY IRRELEVANT AND SHOULD ONLY BE REMOVED IF
   COMPLETELY NECESSARY
d2922 3
a2924 4
   Well since you probably haven't set up Kerberos on your system, you
   wouldn't be getting a ticket. If you do have Kerberos running, you
   need to check into that. If you can't STAND that warning and never
   plan on using Kerberos here is how to get rid of it for good.
d2926 1
a2926 4
     * Make sure you have the source code.
     * Edit /usr/share/mk/bsd.own.mk and set KERBEROS to 'no', or create
       an /etc/mk.conf file that does this.
     * cd /usr/src/usr.bin/login ; make clean ; make ; make install
d2928 4
a2931 1
8.2 - How do I change virtual terminals?
d2933 5
a2937 3
   Simply type [ctrl] - [alt] - [One of the function keys] or just hit
   [f9]-[f12] which are just mapped to [ctrl] - [alt]
   functions. (i386)
d2939 1
a2939 5
   Only the i386 arch has virtual terminal capabilities. You can also use
   virtual terminals when using X. For example, If you start X on term 1,
   and switch with [ctrl]-[alt]-[F2] to term 2, X will seem to disapear
   and will not come back by simply switching back to term 1. You must
   [ctrl]-[alt]-[F5] to get your X display back.
d2941 5
a2945 1
8.3 - I forgot my root password, what do I do now?
d2947 2
a2948 10
   A few steps to recovery
    1. Boot into single user mode. For i386 arch type boot -s at the boot
       prompt.
    2. mount the drives.
        bsd# fsck -p / && mount -u /
    3. If /usr is not the same partition that / is (and it shouldn't be)
       then you will need to mount it, also
        bsd# fsck -p /usr && mount /usr
    4. run passwd
    5. boot into mulituser mode.. and remember your password!
d2950 1
a2950 1
8.4 - X won't start, I get lots of error messages
d2952 5
a2956 3
   If you have X completely set up and you are using an XF86Config that
   you know works then the problem most likely lies in the
   machdep.allowaperture. You also need to make sure that both:
d2958 1
a2958 2
option XSERVER
option APERTURE
d2960 2
a2961 2
   are in your kernel configuration. [BOTH these are in the GENERIC
   kernel]
d2963 2
a2964 6
   Then you need to edit /etc/sysctl.conf
   and set machdep.allowaperture=1. This will allow X to access the
   aperture driver. This would be set up if the question during install
   about whether or not you would be running X was answered correctly.
   OpenBSD requires for all X servers that the aperture driver be set,
   because it controls access to the I/O ports on video boards.
d2966 2
a2967 2
   For other X problems on the i386, consult the XFree86 FAQ at
   [4]http://www.xfree86.org/FAQ/.
d2969 4
a2972 1
8.5 - What is CVS? and How do I use it?
d2974 3
a2976 6
   CVS is what the OpenBSD project uses to control changes to the source
   code. CVS stands for Concurrent Versions System. You can read more
   about CVS at [5]http://www.cyclic.com/. CVS can be used by the end
   user to keep up to date with source changes, and changes in the ports
   tree. CVS makes it extremely simple to download the source via one of
   the many CVS mirrors for the project.
d2978 2
a2979 1
  How to initially setup your CVS environment
d2981 3
a2983 5
   There are a few ways to initially set up your CVS environment. To
   start off, you will need an initial CVS checkout of the sources. If
   you bought the CD, you're in luck, because it holds the CVS checkout
   for that release. You can extract it from your CD by doing one of the
   following:
d2985 3
a2987 5
   1) copy the tree off it, (assuming the CD is mounted on /mnt):
# mkdir /usr/src
# cd /mnt; cp -Rp CVS Makefile bin distrib etc games gnu \
include kerberosIV lib libexec lkm regress sbin share \
sys usr.bin usr.sbin /usr/src
a2988 5
   2) Or, alternatively, use a union mount with the CD below a writable
   directory. However, be aware that the union filesystem code is not
   flawless.
# mkdir /usr/src
# mount -t union -o -b /mnt /usr/src
d2990 2
a2991 2
   after this, /usr/src will be a nice checkout area where all cvs(1)
   commands will work OK.
d2993 4
a2996 13
   If you don't have an OpenBSD CD, you will have to retrieve the sources
   from on of the OpenBSD AnonCVS servers. These servers are listed on
   [6]http://www.openbsd.org/anoncvs.html Once you have chosen a server
   you need to choose which module you are going to retrieve. There are
   three main modules availible for checkout from the CVS tree. These
   are:
     * src - The src module has the complete source code for OpenBSD.
       This includes userland and kernel sources.
     * ports - The ports module holds all you need to have the complete
       OpenBSD ports tree. To read more on the OpenBSD ports tree, read
       [7]Section 8.6 of the OpenBSD FAQ.
     * www - The www module contains all OpenBSD web pages, including
       this FAQ.
d2998 8
a3005 25
   Now that you have decided which module that you wish to retrieve,
   there is one more step left before you can retrieve it. You must
   decide which method to use. CVS by default retrieves files using
   rsh(1), but some AnonCVS servers don't allow for this so in most cases
   it's best to use ssh. For those of you behind a firewall there are
   also the options of pserver and some AnonCVS servers run ssh on port
   2022. Be sure to check [8]http://www.openbsd.org/anoncvs.html for
   which servers support what protocols. Next I will show how to do a
   simple source checkout. Here I will be using an AnonCVS server located
   in the U.S., but remember that if you are outside of the U.S you need
   to use a server that is located nearby. There are many AnonCVS servers
   located throughout the world, so choose one nearest you. I will also
   be using ssh to retrieve the files.
ericj@@oshibana:~> export CVS_RSH=/usr/local/bin/ssh
ericj@@oshibana:~> echo $CVS_RSH
/usr/local/bin/ssh
ericj@@oshibana:~> export CVSROOT=anoncvs@@anoncvs.usa.openbsd.org:/cvs
ericj@@oshibana:~> cvs get src
Warning: Remote host denied X11 forwarding, perhaps xauth program could not be
run on the server side.
cvs checkout: in directory src:
cvs checkout: cannot open CVS/Entries for reading: No such file or directory
cvs server: Updating src
U src/Makefile
[snip]
d3007 1
a3007 30
   Notice here also that I set the CVSROOT environmental variable. This
   is the variable that tells cvs(1) which AnonCVS server to use. This
   can also be specified using the -d option. For example:
ericj@@oshibana:~>cvs -d anoncvs@@anoncvs.usa.openbsd.org:/cvs get src

   These commands should be run in /usr, which will then create the
   directories of /usr/src, /usr/ports, and /usr/www. Depending, of
   course, on which module you checkout. You can download these modules
   to anywhere, but if you wanted to do work with them (ie make build ),
   it is expected that they be at the place above.

  Keeping your CVS tree up-to-date

   Once you have your initial tree setup, keeping it up-to-date is the
   easy part. You can update your tree at any time you choose, some
   AnonCVS servers update more often then others, so again check
   [9]http://www.openbsd.org/anoncvs.html. In this example I will be
   updating my www module from anoncvs.usa.openbsd.org. Notice the -q
   option that I use, this makes the output not so verbose coming from
   the server.
ericj@@oshibana:~> echo $CVSROOT
anoncvs@@anoncvs.usa.openbsd.org:/cvs
ericj@@oshibana:~> cvs -q up -PAd www
Warning: Remote host denied X11 forwarding, perhaps xauth program could not be
run on the server side.
? www/faq/Makefile
? www/faq/txtdump.sh
U www/want.html
M www/faq/faq8.html
ericj@@oshibana:~>
d3009 12
a3020 1
  Other cvs options
d3022 2
a3023 4
   For some, bandwidth and time are serious problems when updating
   repositories such as these. So CVS has a -z[1-9] option which uses
   gzip to compress the data. To use it, do -z[compression-level], for
   instance, -z3 for a compression level of 3.
d3025 5
a3029 1
8.6 - What is the ports tree?
d3031 4
a3034 6
   The ports tree is a set of Makefiles that download, patch, configure
   and install userland programs so you can run them in OpenBSD
   environment without having to do all that by hand. You can get the
   ports tree from any of the OpenBSD ftp servers in
   /pub/OpenBSD/2.5/ports.tar.gz or try the latest updates in
   /pub/OpenBSD/snapshots/ports.tar.gz.
d3036 5
a3040 5
   If you want to run one of the latest ports collections, you'll need to
   update your /usr/share/mk/ directory. CVS up your /usr/src/ directory
   and do a:
# cd /usr/src/share/mk/
# make install
d3042 5
a3046 1
   first.
d3048 5
a3052 3
   A snapshot of the ports tree is also created daily and can be
   downloaded from any of the [10]OpenBSD ftp servers as
   /pub/OpenBSD/snapshots/ports.tar.gz.
d3054 1
a3054 4
   In 2.5-current this information is now stored in the ports tree. In
   ports/infrastructure/. So, once you are running the latest snapshot,
   with the infrastructure dir, you no longer need to update bsd.port.mk
   per instructions above.
d3056 1
a3056 4
   Ports are set up to be EXTREMELY easy to make and install. Here is an
   example install for someone wanting to install the X11 program xfig.
   You'll notice the dependencies are automatically detected and
   completed:
d3058 10
a3067 40
   First you need to cd to the dir of the program you want. If you are
   searching for a program, you can either update your locate database,
   or use the search function talked about below. Once you are in the dir
   of the program you want, you can just type make install. For example.
fenetyllin:/usr/ports/graphics/xfig# make install
===>  Extracting for xfig-3.2.2
===>  xfig-3.2.2 depends on shared library: jpeg.62. - /usr/local/lib/libjpeg.s
o.62.0 found
===>  xfig-3.2.2 depends on shared library: Xaw3d.6. - not found
===>  Verifying install for Xaw3d.6. in /usr/ports/x11/Xaw3d
>> Xaw3d-1.3.tar.gz doesn't seem to exist on this system.
>> Attempting to fetch from ftp://crl.dec.com/pub/X11/contrib/widgets/Xaw3d/R6.
1/.
Connected to crl.dec.com.
220 crl.dec.com FTP server (Digital UNIX Version 5.60) ready.
331 Guest login ok, send ident as password.
230 Guest login ok, access restrictions apply.
Remote system type is UNIX.
Using binary mode to transfer files.
200 Type set to I.
250 CWD command successful.
250 CWD command successful.
Retrieving pub/X11/contrib/widgets/Xaw3d/R6.1/Xaw3d-1.3.tar.gz
local: Xaw3d-1.3.tar.gz remote: Xaw3d-1.3.tar.gz
227 Entering Passive Mode (192,58,206,2,5,14)
150 Opening BINARY mode data connection for Xaw3d-1.3.tar.gz (0.0.0.0,0) (29027
7 bytes).
100% |**************************************************|   283 KB    00:00 ETA
226 Transfer complete.
290277 bytes received in 101.09 seconds (2.80 KB/s)
221 Goodbye.
===>  Extracting for Xaw3d-1.3
/bin/mkdir -p /usr/ports/x11/Xaw3d/work/xc/lib/Xaw3d/X11/Xaw3d
cd /usr/ports/x11/Xaw3d/work/xc/lib/Xaw3d/X11/Xaw3d; ln -sf ../../*.h .
===>  Patching for Xaw3d-1.3
===>  Configuring for Xaw3d-1.3
mv -f Makefile Makefile.bak
imake -DUseInstalled -I/usr/X11R6/lib/X11/config
make Makefiles
[snip]
d3069 7
a3075 24
   You can see a list of both ports and packages by using the pkg_info
   command.
bsd# /usr/sbin/pkg_info
zsh-3.0.5           The Z shell.
screen-3.7.4        A multi-screen window manager.
ssh-1.2.21          Secure shell client and server (remote login program).
emacs-20.2          GNU editing macros.
lynx-2.7.1ac-0.107  An alphanumeric display oriented World-Wide Web Client.
tcsh-6.07.02        An extended C-shell with many useful features.
bash-2.01           The GNU Borne Again Shell.
zip-2.2             Create/update ZIP files compatabile with pkzip.
mm-2.7              Implementation of MIME, the Multipurpose Internet Mail Exte
n
ircii-2.8.2-epic3.004 An enhanced version of ircII, the Internet Relay Chat cli
ent
ispell-3.1.20       An interactive spelling checker.
tin-1.3.970930      TIN newsreader (termcap based)
procmail-3.11p7     A local mail delivery agent.
strobe-1.03         Fast scatter/gather TCP port scanner
lsof-4.15           Lists information about open files.
xntp3-5.92          Network Time Protocol Implementation.
ncftp-2.4.3
 nmh-0.27            The New MH mail handling program
bzip2-0.1p12        A block-sorting file compressor
d3077 7
a3083 11
   If you are looking for a specific program in the ports tree, you can
   try
fenetyllin:/usr/ports/# make search key="xfig"
Port:   xfig-3.2.2
Path:   /home/ports/graphics/xfig
Info:   A drawing program for X11
Maint:  angelos@@openbsd.org
Index:  graphics x11
B-deps: Xaw3d-1.3 jpeg-6b
R-deps: Xaw3d-1.3 ghostscript-5.10 gv-3.5.8 jpeg-6b png-1.0.2 transfig-3.2.1
Archs:  any
d3085 1
a3085 9
Port:   transfig-3.2.1
Path:   /home/ports/print/transfig
Info:   Tools to convert Xfigs .fig files.
Maint:  angelos@@openbsd.org
Index:  print
B-deps: jpeg-6b
R-deps: ghostscript-5.10 jpeg-6b png-1.0.2
Archs:  any
[snip]
d3087 9
a3095 1
   More information about the ports can be found in the ports man page
d3097 4
a3100 2
   Our ports tree is constantly being expanded, and if you would like to
   help please see: [11]http://www.openbsd.org/ports.html
d3102 1
a3102 1
8.7 - What are packages?
d3104 7
a3110 5
   Packages are the precompiled binaries of some of the most used
   programs. They are ready for use on an OpenBSD system. Again, like the
   ports, packages are very easy to maintain and update. Packages are
   constantly being added so be sure to check each release for additional
   packages.
d3112 1
a3112 9
   Here is a list of tools used in managing packages.
     * pkg_add (1) - a utility for installing software package
       distributions
     * pkg_create (1) - a utility for creating software package
       distributions
     * pkg_delete (1) - a utility for deleting previously installed
       software package distributions
     * pkg_info (1) - a utility for displaying information on software
       packages
d3114 3
a3116 4
   Here is a sample user installing ispell via a package:
   bsd# pkg_add
       ftp://ftp.openbsd.org/pub/OpenBSD/2.5/packages/${arch}/ispell-3.1.
       20.tgz
d3118 2
a3119 1
   where ${arch} is your architecture
d3121 11
a3131 2
   Again, like with ports you can use the [12]pkg_info(1) program to view
   what is already installed on your system.
d3133 5
a3137 3
   To delete packages you will want to use the [13]pkg_delete(1) command.
   It is used the same way as [14]pkg_add(1).
   bsd# /usr/sbin/pkg_delete ispell-3.1.20
d3139 4
a3142 1
   and it is gone.
d3144 4
a3147 2
   Packages can be found on any of the [15]OpenBSD ftp mirror sites, or
   they can be found on your OpenBSD CDs.
d3149 7
a3155 1
8.8 - Is there any way to use my floppy drive if it's not attached during boot?
d3157 3
a3159 3
   Sure. You need to add "flags 0x20" at the end of the fd* entry and
   recompile your kernel. The line should be read:
  fd*     at fdc? drive ? flags 0x20
d3161 6
a3166 2
   After that you would be able to use the floppy drive all the time. It
   doesn't matter if you plugged it later after boot.
d3168 4
a3171 1
8.9 - Boot time Options - Using the OpenBSD bootloader
d3173 3
a3175 2
   When booting your OpenBSD system, you have probably noticed the boot
   prompt.
d3177 1
a3177 1
   boot>
d3179 4
a3182 6
   For most people, you won't have to do anything here. It will
   automatically boot if no commands are given. But sometimes problems
   arise, or special functions are needed. That's where these options
   will come in handy. To start off, you should read through the
   [16]boot(8) man page. Here we will go over the most common used
   commands for the bootloader.
d3184 5
a3188 5
   To start off, if no commands are issued, the bootloader will
   automatically try to boot /bsd. If that fails it will try /obsd, and
   so on till it finds a bootable kernel. You can specify this by hand by
   typing:
   boot> boot wd0a:/bsd
d3190 2
a3191 2
   or
   boot> b /bsd
d3193 8
a3200 1
   This will work if device wd0a is configured as your root device.
d3202 3
a3204 9
   Here is a brief list of options you can use with the OpenBSD kernel.
     * -a : This will allow you to specify an alternate root device after
       booting the kernel.
     * -c : This allows you to enter the boot time configuration. Check
       the [17]Boot Time Config section of the faq.
     * -s : This is the option to boot into single user mode.
     * -d : This option is used to dump the kernel into ddb. Keep in mind
       that you must have DDB built into the kernel.
     * -b : Shortcut for RB_HALT.
d3206 1
a3206 1
   These are entered in the format of: boot [ image [-abcds]]
d3208 2
a3209 1
   For further reading you can read [18]boot_i386(8) man page
d3211 6
a3216 1
8.10 - S/Key
d3218 7
a3224 10
   S/Key is a ``one-time password'' scheme. This allows for one-time
   passwords for use on un-secured channels. This can come very handy for
   those who don't have the ability to use ssh or any other encrypted
   channels. OpenBSD's S/Key implementation can use a variety of
   algorithms as the one-way hash. Here is the list of algorithms
   available:
     * [19]md4
     * [20]md5
     * [21]sha1
     * [22]rmd160.
d3226 7
a3232 1
  Setting up S/Key - The first steps
d3234 6
a3239 4
   To start off the file /etc/skeykeys must exist. If this file is not in
   existence, have the super-user create it. This can be done simply by
   doing:
# touch /etc/skeykeys
d3241 3
a3243 19
   Once that file is in existence, you can initalize your S/Key. To do
   this you will have to use [23]skeyinit(1). With skeyinit(1), you will
   first be prompted for your password to the system. This is the same
   password that you used to log into the system. Running skeyinit(1)
   over an insecure channel is completely not recommended, so this should
   be done over a secure channel (such as ssh) or the console. Once you
   have authorized yourself with your system password you will be asked
   for yet another password. This password is the secret password, and is
   NOT your system password. The secret password is not limited to 8
   characters like system passwords, actually it must be at least 10
   characters. A few word phrases are suggested. Here is an example user
   being added.
oshibana:ericj> skeyinit ericj
[Adding ericj]
Reminder - Only use this method if you are directly connected
           or have an encrypted channel.  If you are using telnet
           or rlogin, exit with no password and use skeyinit -s.
Enter secret password:
Again secret password:
d3245 5
a3249 2
ID ericj skey is otp-md5 99 oshi45820
Next login password: HAUL BUS JAKE DING HOT HOG
d3251 1
a3251 9
   One line of particular importance in here is ID ericj skey is otp-md5
   99 oshi45820. This gives a lot of information to the user. Here is a
   breakdown of the sections and their importance.
     * otp-md5 - This shows which one-way was used to create your
       One-Time Password (otp).
     * 99 - This is your sequence number. This is a number from 100 down
       to 1. Once it reaches one, another secret password must be
       created.
     * oshi45820 - This is your key.
d3253 12
a3264 3
   But of more immediate importance is your password. Your password
   consists of 6 small words, combined together this is your password,
   spaces and all.
d3266 1
a3266 1
  Actually using S/Key to login.
d3268 1
a3268 24
   By now your skey has been initialized, and you have your password.
   You're ready to login. Here is an example session using s/key to
   login.
oshibana:ericj> ftp localhost
Connected to localhost.
220 oshibana.shin.ms FTP server (Version 6.4/OpenBSD) ready.
Name (localhost:ericj): ericj
331 Password [ otp-md5 96 oshi45820 ] for ericj required.
Password:
230- OpenBSD 2.5-current (OSHIBANA) #8: Tue Jun 22 19:20:16 EDT 1999
230-
230- Welcome to OpenBSD: The proactively secure Unix-like operating system.
230-
230- Please use the sendbug(1) utility to report bugs in the system.
230- Before reporting a bug, please try to reproduce it with the latest
230- version of the code.  With bug reports, please try to ensure that
230- enough information to reproduce the problem is enclosed, and if a
230- known fix for it exists, include that as well.
230-
230 User ericj logged in.
Remote system type is UNIX.
Using binary mode to transfer files.
ftp> quit
221 Goodbye.
d3270 1
a3270 11
   Some of you might have noticed that my sequence number has changed.
   otp-md5 96 oshi45820. This is because by now I have used s/key to
   login several times. But how do you get your password after you've
   logged in once? Well to do this, you'll need to know what sequence
   number you're using and your key. As you're probably thinking, how can
   you remember which sequence number you're on? Well this is simple, use
   [24]skeyinfo(1), and it will tell you what to use. For example here, I
   need to generate another password for a login that I might have to
   make in the future. (remember I'm doing this from a secure channel).
oshibana:ericj> skeyinfo
95 oshi45820
d3272 2
a3273 7
   From this I can create the password for my next login. To do so, I'll
   use [25]skey(1). I can use exactly that output from above to create my
   password.
oshibana:ericj> skey 95 oshi45820
Reminder - Do not use this program while logged in via telnet or rlogin.
Enter secret password:
NOOK CHUB HOYT SAC DOLE FUME
d3275 2
a3276 14
   I'm sure many of you won't always have a secure connect to create
   these passwords, and creating them over an insecure connection isn't
   feasible, so how can you create multiple passwords at one time? Well
   you can supply skey(1) with a number of how many passwords you want
   created. This can then be printed out and taken with you wherever you
   go.
oshibana:ericj> skey -n 5 95 oshi45820
Reminder - Do not use this program while logged in via telnet or rlogin.
Enter secret password:
91: SHIM SET LEST HANS SMUG BOOT
92: SUE ARTY YAW SEED KURD BAND
93: JOEY SOOT PHI KYLE CURT REEK
94: WIRE BOGY MESS JUDE RUNT ADD
95: NOOK CHUB HOYT SAC DOLE FUME
d3278 1
a3278 2
   Notice here though, that the bottom password should be the first used,
   because we are counting down from 100.
d3280 4
a3283 11
  Controlling S/Key

   For more control over S/Key there is the /etc/skey.access file. (This
   does not exist by default, so it must be created.) This file can
   restrict S/Key in three primary ways.
     * permit internet - Which will allow certain IPs to connect and use
       s/key.
     * permit user - Which will allow users by login name access to s/key
       use.
     * permit port - Which is really only useful for assigned ports, (ie
       dial-up)
d3285 1
a3285 5
   If I wanted to allow one single user ( ericj ), from a certain IP (
   10.1.1.5 ), I would create a file like so.
# cat /etc/skey.access
permit internet 10.1.1.5
permit user ericj
d3287 5
a3291 1
8.11 - Why is my Macintosh losing so much time?
a3292 5
   This is caused by a hardware bug. OpenBSD uses clock interrupts to
   keep track of the current time, but these interrupts have the lowest
   priority in Apple's architecture. So, under heavy load, (such as disk
   or network activity) clock interrupts will be lost and the Unix clock
   will not advance as it should.
d3294 2
a3295 5
   MacOS gets around the time problem by always reading the hardware
   clock. OpenBSD only reads the hardware clock at boot time and
   thereafter ignores it. You may notice that, at shutdown, the kernel is
   not confident enough to write the Unix time back into the hardware
   clock because this time loss problem is well known.
d3297 5
a3301 4
   The best solution is to run xntpd (found in the ports collection) and
   just deal with the occasional lossage. Sometimes the lossage is so bad
   that even xntpd is afraid to skip the time. In this case, add the -g
   option to ntpd in /etc/rc.securelevel to force tracking.
d3303 1
a3303 2
   See also:
   [26]http://www.macbsd.com/macbsd/macbsd-docs/faq/faq-3.html#ss3.17
d3305 6
a3310 1
8.12 - Will OpenBSD run on multiprocessor machines?
d3312 7
a3318 3
   The answer is in [27]../i386.html:
OpenBSD does not currently support multiple processors, but will run using
one processor on a multi-processor system board.
d3320 1
a3320 3
   The reason is quite simple: there are just not enough developers who
   have access to SMP machines. If you want to donate SMP hardware,
   please refer to [28]../donations.html to have support in the future.
d3322 1
a3322 3
   [29][Back to Main Index] [30][To Section 7.0 - Keyboard controls]
   [31][To Section 9.0 - Tips for linux users]
     _________________________________________________________________
d3324 2
a3325 2
   [32][back] [33]www@@openbsd.org
   $OpenBSD: faq8.html,v 1.29 1999/08/17 22:56:19 wvdputte Exp $
d3327 2
a3328 1
References
d3330 3
a3332 33
   1. http://openbsd.org/faq/index.html
   2. http://openbsd.org/faq/faq7.html
   3. http://openbsd.org/faq/faq9.html
   4. http://www.xfree86.org/FAQ/
   5. http://www.cyclic.com/
   6. http://openbsd.org/anoncvs.html
   7. http://openbsd.org/faq/faq8.html#8.6
   8. http://openbsd.org/anoncvs.html
   9. http://openbsd.org/anoncvs.html
  10. http://openbsd.org/ftp.html
  11. http://openbsd.org/ports.html
  12. http://www.openbsd.org/cgi-bin/man.cgi?query=pkg_info&sektion=1&format=html
  13. http://www.openbsd.org/cgi-bin/man.cgi?query=pkg_delete&sektion=1&format=html
  14. http://www.openbsd.org/cgi-bin/man.cgi?query=pkg_add&sektion=1&format=html
  15. http://openbsd.org/ftp.html
  16. http://www.openbsd.org/cgi-bin/man.cgi?query=boot&sektion=8&format=html
  17. http://openbsd.org/faq/faq5.html#5.4
  18. http://www.OpenBSD.org/cgi-bin/man.cgi?query=boot_i386&sektion=8&format=html
  19. http://www.openbsd.org/cgi-bin/man.cgi?query=md4&sektion=3&format=html
  20. http://www.openbsd.org/cgi-bin/man.cgi?query=md5&sektion=3&format=html
  21. http://www.openbsd.org/cgi-bin/man.cgi?query=sha1&sektion=3&format=html
  22. http://www.openbsd.org/cgi-bin/man.cgi?query=rmd160&sektion=3&format=html
  23. http://www.openbsd.org/cgi-bin/man.cgi?query=skeyinit&sektion=1&format=html
  24. http://www.openbsd.org/cgi-bin/man.cgi?query=skeyinfo&sektion=1&format=html
  25. http://www.openbsd.org/cgi-bin/man.cgi?query=skey&sektion=1&format=html
  26. http://www.macbsd.com/macbsd/macbsd-docs/faq/faq-3.html#ss3.17
  27. http://openbsd.org/i386.html
  28. http://openbsd.org/donations.html
  29. http://openbsd.org/faq/index.html
  30. http://openbsd.org/faq/faq7.html
  31. http://openbsd.org/faq/faq9.html
  32. http://openbsd.org/faq/index.html
  33. mailto:www@@openbsd.org
d3334 1
d3336 1
a3336 2
   [1][Back to Main Index] [2][To Section 8.0 - General Questions] [3][To
   Section 10.0 - System Administration]
d3338 3
a3340 1
                          9.0 - Migrating from Linux
d3342 2
a3343 8
   If you are migrating from Linux to OpenBSD, note that OpenBSD has
   COMPAT_LINUX enabled by default in the GENERIC kernel. To run any
   Linux binaries that are not statically linked (most of them), you need
   to follow the instructions on the [4]compat_linux(8) manual page. A
   simple way to get most of the useful Linux libraries is to install
   linux_lib from your ports collection.
# cd /usr/ports/emulators/linux_lib
# make install
d3345 1
a3345 5
   OpenBSD supports the EXT2FS file system. You must recompile your
   kernel with option EXT2FS in order to get this support. Once you have
   it, you can mount your Linux partitions. Use disklabel disk to see
   what OpenBSD thinks your Linux partition is (but don't use disklabel
   or fdisk to make any changes to it).
d3347 3
a3349 1
9.1 - Simple tips for Linux (and other free Unix-like OS) users
d3351 8
a3358 5
   There are several differences between OpenBSD and Linux. These
   differences include but are not limited to, bootup procedure, network
   interface usage and disk management. Most differences are well
   documented, but involve searching manpages. This document tries to be
   an index of those differences.
d3360 3
a3362 42
     * OpenBSD has a ports tree. This is to accomodate the fact that at
       this point not many applications are native to the OpenBSD
       environment. This is both an attempt to get applications to work
       on OpenBSD for end-users and to get more applications made with
       OpenBSD in mind. Eventually this ports tree will be used to make a
       nice set of binary packages.
     * OpenBSD uses CVS for source changes. With Linux, source code is
       disseminated through separate distributions. OpenBSD has pioneered
       anonymous CVS, which allows anyone to extract the full source tree
       for any version of OpenBSD (from 2.0 to current, and all revisions
       of all files in between) at any time! There is also a very
       convenient and easy to use [5]web interface to CVS.
     * OpenBSD periodically releases snapshots for various architectures
       and makes a stable, official CD release every 6 months.
     * OpenBSD contains STRONG CRYPTO, which USA based OS's can't
       contain. (See [6]http://www.openbsd.org/crypto.html) OpenBSD has
       also gone through heavy security auditing and many security
       features have already been implemented into the source tree.
       (IPSEC, KERBEROS).
     * OpenBSD's kernel is /bsd.
     * The names of hard disks are usually /dev/wd and /dev/sd (ATA/SCSI)
     * /sbin/ifconfig with no arguments in Linux gives the state of all
       the interfaces. Under OpenBSD you need the -a flag.
     * /sbin/route with no arguments in Linux gives the state of all the
       active routes. Under OpenBSD you need the "show" parameter, or do
       a netstat -r (nice).
     * OpenBSD comes with Darren Reed's IP Filter package, not ipfw. This
       means that:
          + IP-Masquerading is done through ipnat. ([7]ipnat(1))
          + ipfwadm is done through ipf ([8]ipf(1), [9]ipf(5))
          + You should look at [10]section 6 for detailed configuration
            assistance and information.
     * Interface address is stored in /etc/hostname.<interfacename>. It
       can be a name instead of an IP address.
     * The machine name is in /etc/myname
     * The default gateway is in /etc/mygate
     * The network interface aliases are in /etc/ifaliases
     * OpenBSD's default shell is /bin/sh, which is the Korn shell.
       Shells such as bash and tcsh can be added as packages or installed
       from the ports tree.
     * Password management changes a lot. The main files are different.
       ([11]passwd(1), [12]passwd(5))
d3364 2
a3365 1
9.2 - Dual booting Linux and OpenBSD
d3367 5
a3371 1
   Yes! it is possible!
d3373 4
a3376 1
   Read [13]INSTALL.linux
d3378 4
a3381 2
9.3 - Converting your Linux (or other System 7-style) password file to
BSD-style
d3383 1
a3383 4
   First, figure out if your Linux password file is shadowed or not. If
   it is, grab [14]John the Ripper and use the unshadow utility that
   comes with it to merge your passwd and shadow files into one System
   7-style file.
d3385 3
a3387 4
   Using your Linux password file, we'll call it linux_passwd, you need
   to add in ::0:0 between fields four and seven. Awk does this for you.
# cat linux_passwd | awk -F : '{printf("%s:%s:%s:%s::0:0:%s:%s:%s\n", $1, $2,$3
,$4,$5,$6,$7); }' > bsd_passwd
d3389 6
a3394 8
   At this point, you want to edit the bsd_passwd file and remove the
   root and other system entries that are already present in your OpenBSD
   password file or aren't applicable with OpenBSD (all of them). Also,
   make sure there are no duplicate usernames or user IDs between
   linux_passwd and bsd_passwd. The easiest way to do this is to start
   with a fresh bsd_passwd.
# cat bsd_passwd >> /etc/master.passwd
# pwd_mkdb
d3396 3
a3398 10
   The last step, pwd_mkdb is necessary to rebuild the /etc/spwd.db and
   /etc/pwd.db files. It also creates a System 7-style password file
   (minus encrypted passwords) at /etc/passwd for programs which use it.
   OpenBSD uses a stronger encryption for passwords, blowfish, which is
   very unlikely to be found on any system which uses full System 7-style
   password files. To switch over to this stronger encryption, simply
   have the users run 'passwd' and change their password. The new
   password they enter will be encrypted with your default setting
   (usually blowfish unless you've edited /etc/passwd.conf). Or, as root,
   you can run passwd username.
d3400 7
a3406 3
   [15][Back to Main Index] [16][To Section 8.0 - General Questions]
   [17][To Section 10.0 - System Administration]
     _________________________________________________________________
d3408 4
a3411 2
   [18][back] [19]www@@openbsd.org
   $OpenBSD: faq9.html,v 1.11 1999/07/25 18:48:58 ericj Exp $
d3413 2
a3414 1
References
d3416 12
a3427 19
   1. http://openbsd.org/faq/index.html
   2. http://openbsd.org/faq/faq8.html
   3. http://openbsd.org/faq/faq10.html
   4. http://www.openbsd.org/cgi-bin/man.cgi?query=compat_linux&sektion=8&format=html
   5. http://www.openbsd.org/cgi-bin/cvsweb/
   6. http://openbsd.org/crypto.html
   7. http://www.openbsd.org/cgi-bin/man.cgi?query=ipnat&apropos=0&sektion=1&format=html
   8. http://www.openbsd.org/cgi-bin/man.cgi?query=ipf&apropos=0&sektion=1&format=html
   9. http://www.openbsd.org/cgi-bin/man.cgi?query=ipnat&apropos=0&sektion=5&format=html
  10. http://openbsd.org/faq/faq6.html
  11. http://www.openbsd.org/cgi-bin/man.cgi?query=passwd&apropos=0&sektion=1&format=html
  12. http://www.openbsd.org/cgi-bin/man.cgi?query=passwd&apropos=0&sektion=5&format=html
  13. http://openbsd.org/faq/INSTALL.linux
  14. http://www.false.com/security/john/
  15. http://openbsd.org/faq/index.html
  16. http://openbsd.org/faq/faq8.html
  17. http://openbsd.org/faq/faq10.html
  18. http://openbsd.org/faq/index.html
  19. mailto:www@@openbsd.org
d3429 5
d3435 9
a3443 2
   [1][Back to Main Index] [2][To Section 9.0 - Migrating from Linux]
   [3][To Section 11.0 - OpenBSD 2.4 Specific Information]
d3445 6
a3450 2
                         10.0 - System Administration
     _________________________________________________________________
d3452 1
a3452 1
10.1 - Why does it say that I'm in the wrong group when I try to su root?
d3454 3
a3456 6
   Existing users must be added to the "wheel" group by hand. This is
   done for security reasons, and you should be cautious with whom you
   give access to. On OpenBSD, users who are in the wheel group are
   allowed to use the [4]su(1) userland program to become root. Users who
   are not in "wheel" cannot use su(1). Here is an example of a
   /etc/group entry to place the user ericj into the "wheel" group.
d3458 1
a3458 4
   If you are adding a new user with [5]adduser(8), you can put them in
   the wheel group by answering wheel at Invite user into other groups:
   This will add them to /etc/group, which will look something like this:
wheel:*:0:root,ericj
d3460 13
a3472 3
   If you are looking for a way to allow users limited access to
   superuser privileges, without putting them in the "wheel" group, use
   [6]sudo(8).
d3474 3
a3476 1
10.2 - How do I duplicate a filesystem?
d3478 12
a3489 4
   To duplicate your filesystem use [7]dump(8) and [8]restore(8). For
   example. To duplicate everything under directory SRC to directory DST,
   do a:
# cd /SRC; dump 0f - . | (cd /DST; restore -rf - )
d3491 13
a3503 5
   dump is designed to give you plenty of backup capabilities, and it may
   be an overkill if you just want to duplicate a part of a (or an
   entire) filesystem. The command [9]tar(1) may be faster for this
   operation. The format looks very similar:
# cd /SRC; tar cf -  . | (cd /DST; tar xpf - )
d3505 1
a3505 1
10.3 - How do I get httpd, sendmail, etc to startup with the system?
d3507 18
a3524 5
   OpenBSD uses rc-style startup to control starting applications with
   the system. For common daemons you can simply edit [10]/etc/rc.conf.
   For example: To have ftpd started at boot time, change the ftpd entry
   from:
   ftpd_flags=NO
d3526 11
a3536 2
   to:
   ftpd_flags="-D"
d3538 5
a3542 1
   You can add any flags that you wish ftpd to start with.
d3544 6
a3549 5
   If you have your own daemons that you want to be started, here is a
   simple entry that you can put into /etc/rc.local.
if [ -x /usr/local/sbin/mydaemon ]; then
        echo -n ' mydaemon';       /usr/local/sbin/mydaemon
fi
d3551 4
a3554 1
   Once in there, it will come up with the system each time.
d3556 1
a3556 2
10.4 - Why do users get relaying access denied when they are remotely sending
mail through my OpenBSD system?
d3558 6
a3563 2
   Try this:
# cat /etc/sendmail.cf | grep relay-domains
d3565 10
a3574 2
   The output may look something like this:
FR-o /etc/mail/relay-domains
d3576 7
a3582 4
   If this file doesn't exist, create it. You will need to enter the
   users who are sending mail remotely with the following syntax:
.domain.com    #Allow any .domain.com user to send mail through us
sub.domain.com #Allow sub.domain.com to send mail through us
d3584 2
a3585 3
   Don't forget send a 'HangUP' signal to sendmail, (a signal which
   causes most daemons to re-read their configration file):
# kill -HUP `cat /var/run/sendmail.pid`
d3587 1
a3587 2
10.5 - I've set up POP, but users have trouble accessing mail thru POP. What
can I do?
d3589 6
a3594 3
   Most issues dealing with POP are problems with temporary files and
   lock files. If your pop server sends an error message such as:
-ERR Couldn't open temporary file, do you own it?
d3596 3
a3598 3
   Try setting up your permissions as such:
permission in  /var
drwxrwxr-x   2 bin     mail     512 May 26 20:08 mail
d3600 2
d3603 1
a3603 2
permissions in  /var/mail
-rw-------   1 username   username        0 May 26 20:08 username
d3605 42
a3646 15
   Another thing to check is that the user actually owns their own
   /var/mail file. Of course this should be the case (as in,
   /var/mail/joe should be owned by joe) but if it isn't set correctly it
   could be the problem!

   Of course, making /var/mail writeable by group mail opens up some
   vague and obscure security problems. It is likely that you will never
   have problems with it. But it could (especially if you are a high
   profile site, ISP,...)! Try running cucipop or another POP daemon from
   the OpenBSD ports collection. Or, you could just have the wrong
   options selected for your pop daemon (like dot locking). Or, you may
   just need to change the directory that it locks in (although then the
   locking would only be valueable for the POP daemon.)

10.6 - Setting up a Secure HTTP server with SSL(8)
a3647 12
   This will take you through all the steps it takes to set up your own
   Secure HTTP server. Since the OpenBSD 2.5 release, OpenBSD has shipped
   with SSLeay. Because of patented RSA algorigthms, these cannot be
   shipped with OpenBSD. libssl includes support for SSL version 2, SSL
   version 3, and TLS version 1. So for now, because of patent
   restrictions, OpenBSD must ship without a fully-functional libssl. But
   it is still completely useable. If you are able to use the RSA
   patented libraries, you can easily upgrade your libssl with a command
   like this.
   # pkg_add
       ftp://ftp.openbsd.org/pub/OpenBSD/${ver}/packages/${arch}/libssl-1
       .1.tgz
d3649 2
a3650 2
   Where ${ver} is the OpenBSD version number, and ${arch} is your
   architecture.
d3652 2
a3653 5
   The steps shown here are taken in part from the [11]ssl(8) man page.
   Refer to it for further information. This FAQ entry only outlines how
   to create an RSA certificate for web servers, not a DSA server
   certificate. To find out how to do so, please refer to the ssl(8) man
   page.
d3655 1
a3655 4
   Here is how you create your server key and certificate. These will go
   into /etc/ssl/private/. To use the RSA features, you must have
   upgraded your libssl. Now you can create your key. Using ssleay,
# ssleay genrsa -out /etc/ssl/private/server.key 1024
d3657 2
a3658 5
   This will create a key of 1024 bits. Next you need to create a
   Certificate Signing Request which is used to get a CA or Certificate
   Authority to sign your key. Here is the command to do so.
   # ssleay req -new -key /etc/ssl/private/server.key -out
       /etc/ssl/private/server.csr
d3660 1
a3660 5
   You would now give /etc/ssl/private/server.csr to the CA to get it
   signed. Or you could also sign the certificate for yourself. Here is
   how you would do this.
   # ssleay x509 -req -days 365 -in /etc/ssl/private/server.csr -signkey
       /etc/ssl/private/server.key -out /etc/ssl/server.crt
d3662 1
a3662 5
   This will sign your key, and it will be valid for up to 365 days. With
   this done you can now start the httpd server. To start httpd(8) with
   ssl you must start the daemon with the -DSSL flag. You can start this
   on boot in /etc/rc.conf by changing the httpd line to look like so:
httpd_flags="-DSSL"
d3664 3
a3666 1
   This server will run on port 443.
d3668 6
a3673 1
10.7 - I edited /etc/passwd, but the changes didn't seem to take place. Why?
d3675 3
a3677 10
   If you edit /etc/passwd, your changes will be lost. OpenBSD generates
   /etc/passwd dynamically with [12]pwd_mkdb(8). The main password file
   in OpenBSD is /etc/master.passwd. According to pwd_mkdb(8),
FILES
     /etc/master.passwd  current password file
     /etc/passwd         a Version 7 format password file
     /etc/pwd.db         insecure password database file
     /etc/pwd.db.tmp     temporary file
     /etc/spwd.db        secure password database file
     /etc/spwd.db.tmp    temporary file
d3679 30
a3708 7
   In a traditional Unix password file, such as /etc/passwd, everything
   including the user's encrypted password is available to anyone on the
   system (and is a prime target for programs such as Crack.) 4.4BSD
   introduces the master.passwd file, which has an extended format (with
   additional options beyond what was provided by /etc/passwd) and is
   only readable by root. For faster access to data, the library calls
   which access this data normally read /etc/pwd.db and /etc/spwd.db.
d3710 2
a3711 7
   OpenBSD does come with a tool with which you should edit your password
   file. It is called vipw(8). Vipw will use vi (or your favourite editor
   defined per $EDITOR) to edit /etc/master.passwd. After you are done
   editing, it will re-create /etc/passwd, /etc/pwd.db, and /etc/spwd.db
   as per your changes. Vipw also takes care of locking these files, so
   that if anyone else attempts to change them at the same time, they
   will be denied access.
d3713 3
a3715 1
10.8 - What is the best way to add and delete users?
d3717 2
a3718 9
   The best way to add a user in OpenBSD is to use the [13]adduser(8)
   script. You can configure this to work however you like by editing
   /etc/adduser.conf. You can add users by hand, but this is the
   recommended way to add users. adduser(8) allows for consistency checks
   on /etc/passwd, /etc/group, and shell databases. It will create the
   entries and HOME directories for you. It can even send a message to
   the user welcoming them. This can be changed to meet your needs. For
   further instructions on adding users read the [14]adduser_proc(8) man
   page.
d3720 1
a3720 4
   To delete users you should use the [15]rmuser(8) utility. This will
   remove all existence of a user. It will remove any crontab(1) entries,
   their HOME dir (if it is owned by the user), and their mail. Of course
   it will also remove their /etc/passwd and /etc/group entries.
d3722 10
a3731 1
10.9 - How do I create an ftp-only account?
d3733 1
a3733 7
   There are a few ways to do this, but a very common way to do such is
   to add /bin/false into /etc/shells. Then when you create the user set
   his shell to /bin/false, they will not be able log in interactively,
   but will be able to use ftp capabilities. adduser(8) will give them a
   home dir by default of /home/. If this is what you desire it doesn't
   need to be changed, however you can set this to whatever directory you
   wish.
d3735 1
a3735 1
10.10 - Setting up Quotas
d3737 1
a3737 3
   Quotas are used to limit users space that they have available to them
   on your drives. It can be very helpful in situations where you have
   limited resources. Quotas can be set in two different ways.
d3739 6
a3744 2
     * User Quotas
     * Group Quotas
d3746 2
a3747 11
   The first step to setting up quotas is to make sure that option QUOTA
   is in your Kernel Configuration. This option is in the GENERIC kernel.
   After this you need to mark in /etc/fstab the filesystems which will
   have quotas enabled. The keywords userquota and groupquota should be
   used to mark each fs that you will be using quotas on. By default the
   files quota.user and quota.group will be created at the root of that
   filesystem to hold the quota information. This default can be
   overwritten by doing, userquota=/var/quotas/quota.user. Or whatever
   file you want to use for holding quota information. Here is an example
   /etc/fstab that has one filesystem with userquotas enabled.
/dev/wd0a / ffs rw,userquota=/var/quotas/quota.user 1 1
d3749 3
a3751 5
   Now it's time to set the user's quotas. To do so you use the utility
   [16]edquota(8). A simple use is just edquota <user>. edquota(8) will
   use vi(1) to edit the quotas unless the environmental variable EDITOR
   is set to a different editor. For example:
   # edquota ericj
d3753 3
a3755 4
   This will give you output similar to this:
Quotas for user ericj:
/: blocks in use: 62, limits (soft = 0, hard = 0)
        inodes in use: 25, limits (soft = 0, hard = 0)
d3757 2
a3758 4
   To add limits, edit it to give results like this:
Quotas for user ericj:
/: blocks in use: 62, limits (soft = 1000, hard = 1050)
        inodes in use: 25, limits (soft = 0, hard = 0)
d3760 7
a3766 7
   In this the softlimit is set to 1000 blocks and the hardlimit is set
   to 1050 blocks. A softlimit is a limit where the user is just warned
   when they cross it and have until their grace period is up to get
   their disk usage below their limit. Grace periods can be set by using
   the -t option on edquota(8). After the grace period is over the
   softlimit is handled as a hardlimit. This usually results in an
   allocation failure.
d3768 6
a3773 32
   Now that the quotas are set, you need to turn the quotas on. To do
   this use [17]quotaon(8). For example:
# quotaon -a

   This will go thru /etc/fstab to turn on the filesystems with quota
   options. Now that quotas are up and running, you can view them by the
   [18]quota(1). Using a command of quota <user> will give that users
   information. When called with no arguments the quota command will give
   your quota statistics. For example:
# quota ericj

   Will result in output similar to this:
Disk quotas for user ericj (uid 1001):
     Filesystem  blocks   quota   limit   grace   files   quota   limit   grace
              /      62    1000    1050              27       0       0

   By default quotas set in /etc/fstab will be started on boot. To turn
   them off use
# quotaoff -a

10.11 - How to Setup Kerberos Clients and Servers under OpenBSD

   As a user/administrator of OpenBSD systems, you are fortunate that
   KerberosIV is an pre-installed component of the default system. Here
   is a guide to setting up both the Kerberos realm server, as well as a
   client.

   An *EXTREMELY* important point to remember is that Kerberos clients
   and servers must have their system clocks synchronized. If there is
   more than a 5 minute time skew, you will receive wierd errors that do
   not immediately reveal themselves to be caused by time skew, such as:
kinit: Can't send request (send_to_kdc)
d3775 4
a3778 2
   Another more accurate error is:
kauth: Time is out of bounds (krb_rd_req)
d3780 3
a3782 8
   An easy way to synchronize system clocks is with xntpd, available in
   the ports tree at /usr/ports/sysutils/xntpd/.
   This FAQ entry assumes you have prior knowledge of the Kerberos
   concepts. For a great, easy to understand, reference, see:
     * [19]The FreeBSD handbook
     * Use the command info kth-krb
     * [20]Designing an Authentication System: a Dialogue in Four Scenes
     * [21]Papers and Documentation Describing KerberosIV
d3784 7
a3790 3
   Or the book
     * [22]Network Security Private Communication in a Public World
       [Kaufman, Perlman, Speciner, 1995]
d3792 9
a3800 1
  How to setup the Kerberos IV REALM and SERVER
d3802 2
a3803 2
   We will be setting up the CIARASYSTEMS.COM realm, with
   avalanche.ciarasystems.com as the main server.
d3805 2
a3806 6
   To start off, we will need to edit our configuration files. These
   files are located at /etc/kerberosIV/. The two files we are concerned
   about are krb.realms and krb.conf. Let's start off with krb.conf.
[root@@avalanche kerberosIV] cat krb.conf
CIARASYSTEMS.COM
CIARASYSTEMS.COM avalanche.ciarasystems.com admin server
d3808 5
a3812 7
   As you can see, this tells kerberos that the domain is
   CIARASYSTEMS.COM (or logical realm) and that within that domain,
   avalanche is the administration server. Next we will look at
   krb.realms. For more information on this refer to [23]krb.conf.
[root@@avalanche kerberosIV] cat krb.realms
avalanche.ciarasystems.com      CIARASYSTEMS.COM
.ciarasystems.com               CIARASYSTEMS.COM
d3814 4
a3817 7
   krb.realms provides a translation from a hostname to the Kerberos
   realm name for the services provided by that host. Each line of the
   translation file is in one of the following forms (domain_name should
   be of the form .XXX.YYY). So in this example, avalanche is the
   hostname of a computer on the CIARASYSTEMS.COM realm. And
   .ciarasystems.com is the domain name on the realm CIARASYSTEMS.COM.
   Again, for further information read the [24]krb.realms. man page.
d3819 6
a3824 6
   Next we will run [25]kdb_init(8) to create the initial Kerberos
   database.
[root@@avalanche kerberosIV] kdb_init
Realm name [default  NO.DEFAULT.REALM ]: CIARASYSTEMS.COM
You will be prompted for the database Master Password.
It is important that you NOT FORGET this password.
d3826 2
a3827 3
Enter Kerberos master password: not shown
Verifying password -
Enter Kerberos master password:
d3829 6
a3834 5
   Next we need to use [26]kstash(8) which is used to save the Kerberos
   key distribution center (KDC) database master key in the master key
   cache file.
[root@@avalanche kerberosIV] kstash
Enter Kerberos master password:
d3836 6
a3841 1
Current Kerberos master key version is 1.
d3843 4
a3846 12
Master key entered.  BEWARE!
Wrote master key to /etc/kerberosIV/master_key
       This saves the encrypted master password in
       /etc/kerberosIV/master_key.
       Next, we need two principals to be added to the database for each
       system that will be secured with Kerberos. Their names are kpasswd
       and rcmd. These two principals are made for each system, with the
       instance being the name of the individual system. These daemons,
       kpasswd and rcmd allow other systems to change Kerberospasswords
       and run commands like rcp, rlogin and rsh.
# kdb_edit
Opening database...
d3848 2
a3849 1
Enter Kerberos master key:
d3851 2
a3852 1
Current Kerberos master key version is 1.
d3854 4
a3857 1
Master key entered.  BEWARE!
d3859 3
a3861 2
Previous or default values are in [brackets] ,
enter return to leave the same, or new value.
d3863 1
a3863 2
Principal name: passwd
Instance: avalanche
d3865 3
a3867 1
<Not found>, Create [y] ? y
d3869 2
a3870 4
Principal: passwd, Instance: avalanche, kdc_key_ver: 1
New Password:                <----- Use 'RANDOM' as password
Verifying password -
New Password:
d3872 2
a3873 1
Random password [y] ? y
d3875 6
a3880 5
Principal's new key version = 1
Expiration date (enter yyyy-mm-dd) [ 1999-12-31 ] ? 2001-12-31
Max ticket lifetime (*5 minutes) [ 255 ] ?
Attributes [ 0 ] ?
Edit O.K.
d3882 1
d3884 5
a3888 2
Principal name: rcmd
Instance: avalanche
a3889 5
, Create [y] ? y
Principal: rcmd, Instance: avalanche, kdc_key_ver: 1
New Password:                 <----- Use 'RANDOM' as password
Verifying password -
New Password:
d3891 4
a3894 1
Random password [y] ? y
d3896 11
a3906 6
Principal's new key version = 1
Expiration date (enter yyyy-mm-dd) [ 1999-12-31 ] ? 2001-12-31
Max ticket lifetime (*5 minutes) [ 255 ] ?
Attributes [ 0 ] ?
Edit O.K.
Principal name:               <----- Hit <ENTER> to end
d3908 2
a3909 7
   A srvtab file is the service key file. These must be extracted from
   the Kerberos key distribution center database in order for services to
   authenticate using Kerberos. For each hostname specified on the
   command line, [27]ext_srvtab(8) creates the service key file
   hostname-new-srvtab, containing all the entries in the database with
   an instance field of hostname.
[root@@avalanche kerberosIV] ext_srvtab avalanche
d3911 4
a3914 1
Enter Kerberos master password:
d3916 2
a3917 1
Current Kerberos master key version is 1.
d3919 8
a3926 2
Master key entered.  BEWARE!
Generating 'avalanche-new-srvtab'....
d3928 6
a3933 2
[root@@avalanche kerberosIV] mv avalanche-new-srvtab srvtab
[root@@avalanche kerberosIV] chmod 600 srvtab
d3935 2
a3936 3
   Now we can add users to our database.
[root@@avalanche kerberosIV] kdb_edit
Opening database...
d3938 8
a3945 7
Enter Kerberos master key:

Current Kerberos master key version is 1.

Master key entered.  BEWARE!
Previous or default values are in [brackets] ,
enter return to leave the same, or new value.
d3947 4
a3950 2
Principal name: jeremie
Instance:
d3952 5
a3956 1
, Create [y] ? y
d3958 2
a3959 3
Principal: jeremie, Instance: , kdc_key_ver: 1
New Password:                <---- enter a secure password here
Verifying password
d3961 1
a3961 8
New Password:                <---- re-enter the password here
Principal's new key version = 1
Expiration date (enter yyyy-mm-dd) [ 2000-01-01 ] ?
Max ticket lifetime (*5 minutes) [ 255 ] ?
Attributes [ 0 ] ?
Edit O.K.
Principal name:          <---- null entry here will cause an exit
                               or you can add more entries.
d3963 4
a3966 3
   So now all the Kerberos particulars are setup. All that is left is to
   enable boot-time loading of the Kerberos server and to enable
   Kerberized-daemons.
d3968 10
a3977 2
   In /etc/rc.conf, set:
   kerberos_server=YES
d3979 2
a3980 5
   In /etc/inetd.conf, uncomment:
telnet       stream  tcp     nowait  root    /usr/libexec/telnetd    telnetd -k
klogin       stream  tcp     nowait  root    /usr/libexec/rlogind    rlogind -k
kshell       stream  tcp     nowait  root    /usr/libexec/rshd       rshd -k
kauth        stream  tcp     nowait  root    /usr/libexec/kauthd     kauthd
d3982 4
a3985 4
   Then, either reboot, or:
[root@@avalanche /] kill -HUP `cat /var/run/inetd.pid`
[root@@avalanche /] /usr/libexec/kerberos >> /var/log/kerberos.log &
[root@@avalanche /] /usr/libexec/kadmind -n >> /var/log/kadmind.log &
d3987 2
a3988 4
   Note: this is a rather simple server setup. Usually, redundant servers
   are setup (as slave servers) so that if one server goes down, all the
   services that depend on Kerberos don't go down. We can also add 'su'
   privileges to a specific principal, see [28]the FreeBSD Handbook.
d3990 3
a3992 1
  How to kerberize your client workstation
d3994 13
a4006 3
   We will be setting the workstation named gatekeeper to be in the
   CIARASYSTEMS.COM realm, with avalanche.ciarasystems.com as the main
   server.
d4008 2
a4009 6
   To start off, we need to setup our krb.conf and krb.realms like the
   above machine. This is so gatekeeper will know what server is the KDC
   and what domain it is on. Again here are the file contents.
[root@@gatekeeper kerberosIV] cat krb.conf
CIARASYSTEMS.COM
CIARASYSTEMS.COM avalanche.ciarasystems.com admin server
d4011 19
a4029 3
[root@@gatekeeper kerberosIV] cat krb.realms
avalanche.ciarasystems.com      CIARASYSTEMS.COM
.ciarasystems.com               CIARASYSTEMS.COM
d4031 14
a4044 7
   Now that is set up, we need to initialize kerberos. To obtain a ticket
   you use [29]kinit(1).
xyz:jeremie% kinit
The OpenBSD Project (gatekeeper)
Kerberos Initialization
Kerberos name: jeremie
Password:
d4046 10
a4055 4
   Now we have identified we can list our tickets with [30]klist(1).
xyz:jeremie$ klist
Ticket file:    /tmp/tkt1000
Principal:      jeremie@@CIARASYSTEMS.COM
d4057 12
a4068 2
  Issued           Expires          Principal
Jun 28 01:03:25  Jun 28 11:03:25  krbtgt.CIARASYSTEMS.COM@@CIARASYSTEMS.COM
d4070 7
a4076 12
   Looks like we are set now. All that's left to do is test it. Here we
   will test it with rlogin(1) and telnet(1).
xyz:jeremie% telnet avalanche
Trying 192.168.0.38...
Connected to avalanche.
Escape character is '^]'.
[ Trying mutual KERBEROS4 ... ]
[ Kerberos V4 accepts you ]
[ Kerberos V4 challenge successful ]
Last login: Sun Jun 27 22:52:25 on ttyp1 from gatekeeper
Warning: no Kerberos tickets issued.
OpenBSD 2.5 (AVALANCHE) #5: Tue Apr  6 01:18:16 EDT 1999
d4078 1
a4078 5
   and
xyz:jeremie% rlogin avalanche
Last login: Sun Jun 27 22:53:39 on ttyp1 from gatekeeper
Warning: no Kerberos tickets issued.
OpenBSD 2.5 (AVALANCHE) #5: Tue Apr  6 01:18:16 EDT 1999
d4080 1
a4080 9
   We can tell that it is indeed using Kerberos to authenticate the
   rlogin session. To get rid of any tickets issued, you would use
   [31]kdestroy(1). For example:
xyz:jeremie% kdestroy
Tickets destroyed.
xyz:jeremie% rlogin avalanche
krcmd: No ticket file (tf_util)
rlogin: warning, using standard rlogin: can't provide Kerberos auth data.
avalanche: Connection refused
d4082 6
a4087 6
   Do not worry about 'Warning: no Kerberos tickets issued.' This is
   because we're only doing kerberos authentication, not ticket passing.
   If you want ticket passing, use Dug Song's [32]krb4 SSH patches. Stock
   KerberosIV doesn't have support for tgt passing, either - only the AFS
   kaserver's implementation of krb4, since the regular KerberosIV kdc
   checks client IP address listed in the ticket.
d4089 20
a4108 1
10.12 - Setting up Anonymous FTP Services.
d4110 3
a4112 3
   Anonymous FTP allows users without accounts to access files on your
   computer via the File Transfer Protocol. This will give an overview of
   setting up the anonymous FTP server, and its logging, etc.
d4114 1
a4114 1
  Adding the FTP account
d4116 6
a4121 13
   To start off, you need to have an account on your system of ''ftp''.
   This account shouldn't have a useable password, and here we will set
   the login directory to /home/ftp. When using anonymous ftp, the ftp
   daemon will chroot itself to /home/ftp. To read up more on that, read
   the [33]ftp(8) and [34]chroot(2) man pages. Here is an example of
   adding the ftp user. I will do this using [35]adduser(8). We also need
   to add /bin/false to our /etc/shells, this is the "shell" that we will
   be giving to the ftp user. This won't allow them to login, even though
   we will give them an empty password. To do this you can simply echo
   /bin/false >> /etc/shells. Also if you wish for that shell to show up
   during the adduser questions, you need to modify /etc/adduser.conf.
oshibana# adduser
Use option ``-silent'' if you don't want see all warnings & questions.
d4123 3
a4125 3
Reading /etc/shells
Check /etc/master.passwd
Check /etc/group
d4127 5
a4131 12
Ok, let's go.
Don't worry about mistakes. I will give you the chance later to correct any inp
ut.
Enter username [a-z0-9_]: ftp
Enter full name []: anonymous ftp
Enter shell csh false ksh nologin sh tcsh zsh [sh]: false
Uid [1002]:
Login group ftp [ftp]:
Login group is ``ftp''. Invite ftp into other groups: guest no
[no]: no
Enter password []:
Use an empty password? (y/n) [y]: y
d4133 1
a4133 13
Name:     ftp
Password: ****
Fullname: anonymous ftp
Uid:      1002
Gid:      1002 (ftp)
Groups:   ftp
HOME:     /home/ftp
Shell:    /usr/bin/false
OK? (y/n) [y]: y
Added user ``ftp''
Copy files from /usr/share/skel to /home/ftp
Add another user? (y/n) [y]: n
Goodbye!
d4135 9
a4143 1
  Directory Setup
d4145 5
a4149 18
   Along with the user, this created the directory /home/ftp. This is
   what we want, but there are some changes that we will have to make to
   get it ready for anonymous ftp. Again these changes are explained in
   the [36]ftp(8) man page.
     * /home/ftp - This is the main directory. It should be owned by root
       and have permissions of 555.
     * /home/ftp/bin - This directory will hold binaries that can be
       executed from within the chrooted ftpd environment. This directory
       should be mode 511. Anonymous FTP only needs ls(1) to operate
       correctly. So you need to copy /bin/ls to /home/ftp/bin.
       ~ftp/bin/ls needs to be mode 111, which is executable only.
     * /home/ftp/etc - Directory to hold user information. You should
       copy /etc/pwd.db and /etc/group to this directory. This directory
       should be mode 511, and the two files should be mode 444. These
       are used to give owner names as opposed to numbers. The password
       fields in pwd.db will not be used.
     * /home/ftp/pub - This is the directory to place files in which you
       wish to share. This directory should also be mode 555.
d4151 5
a4155 11
   Note that all these directories should be owned by ''root''. Here is a
   listing of what the directories should look like after their creation.
oshibana# pwd
/home
oshibana# ls -laR ftp
total 5
dr-xr-xr-x  5 root  ftp    512 Jul  6 11:33 .
drwxr-xr-x  7 root  wheel  512 Jul  6 10:58 ..
dr-x--x--x  2 root  ftp    512 Jul  6 11:33 bin
dr-x--x--x  2 root  ftp    512 Jul  6 11:34 etc
dr-xr-xr-x  2 root  ftp    512 Jul  6 11:33 pub
d4157 2
a4158 5
ftp/bin:
total 178
dr-x--x--x  2 root  ftp     512 Jul  6 11:33 .
dr-xr-xr-x  5 root  ftp     512 Jul  6 11:33 ..
---x--x--x  1 root  ftp  167936 Jul  6 11:33 ls
d4160 3
a4162 6
ftp/etc:
total 43
dr-x--x--x  2 root  ftp    512 Jul  6 11:34 .
dr-xr-xr-x  5 root  ftp    512 Jul  6 11:33 ..
-r--r--r--  1 root  ftp    316 Jul  6 11:34 group
-r--r--r--  1 root  ftp  40960 Jul  6 11:34 pwd.db
d4164 4
a4167 4
ftp/pub:
total 2
dr-xr-xr-x  2 root  ftp  512 Jul  6 11:33 .
dr-xr-xr-x  5 root  ftp  512 Jul  6 11:33 ..
d4169 4
a4172 1
  Starting up the server and logging
d4174 2
a4175 6
   With ftpd you can choose to either run it from inetd or the rc scripts
   can kick it off. These examples will show our daemon being started
   from [37]inetd.conf. First we must become familiar with some of the
   options to ftpd. The default line from /etc/inetd.conf is:
ftp             stream  tcp     nowait  root    /usr/libexec/ftpd       ftpd -U
S
d4177 3
a4179 10
   Here ftpd is invoked with -US. This will log anonymous connections to
   /var/log/ftpd and concurrent sessions to /var/run/utmp. That will
   allow for these sessions to be seen via who(1). For some, you might
   want to run only an anonymous server, and disallow ftp for users. To
   do so you should invoke ftpd with the -A option. Here is a line that
   starts ftpd up for anonymous connections only. It also uses -ll which
   logs each connection to syslog, along with the get, retrieve, etc, ftp
   commands.
ftp             stream  tcp     nowait  root    /usr/libexec/tcpd       ftpd -l
lUSA
d4181 14
a4194 7
   Note - For people using HIGH traffic ftp servers, you might want to
   not invoke ftpd from inetd.conf. The best option is to comment the
   ftpd line from inetd.conf and start ftpd from rc.conf along with the
   -D option. This will start ftpd as a daemon, and has much less
   overhead as starting it from inetd. Here is an example line to start
   it from rc.conf.
ftpd_flags="-DllUSA"           # for non-inetd use: ftpd_flags="-D"
d4196 13
a4208 2
   This of course only works if you have ftpd taken out of
   /etc/inetd.conf.
d4210 7
a4216 1
  Other relevant files
d4218 6
a4223 6
     * /etc/ftpwelcome - This holds the Welcome message for people once
       they have connected to your ftp server.
     * /etc/motd - This holds the message for people once they have
       successfully logged into your ftp server.
     * .message - This file can be placed in any directory. It will be
       shown once a user enters that directory.
d4225 6
a4230 3
   [38][Back to Main Index] [39][To Section 9.0 - Migrating from Linux]
   [40][To Section 11.0 - OpenBSD 2.4 Specific Information]
     _________________________________________________________________
d4232 11
a4242 2
   [41][back] [42]www@@openbsd.org
   $OpenBSD: faq10.html,v 1.28 1999/08/31 00:49:21 chris Exp $
d4244 5
a4248 1
References
a4249 42
   1. http://openbsd.org/faq/index.html
   2. http://openbsd.org/faq/faq9.html
   3. http://openbsd.org/faq/faq11-2.4.html
   4. http://www.openbsd.org/cgi-bin/man.cgi?query=su&apropos=0&sektion=1&format=html
   5. http://www.openbsd.org/cgi-bin/man.cgi?query=adduser&apropos=0&sektion=8&format=html
   6. http://www.openbsd.org/cgi-bin/man.cgi?query=sudo&sektion=8&format=html
   7. http://www.openbsd.org/cgi-bin/man.cgi?query=dump&sektion=8&format=html
   8. http://www.openbsd.org/cgi-bin/man.cgi?query=restore&sektion=8&format=html
   9. http://www.openbsd.org/cgi-bin/man.cgi?query=tar&sektion=1&format=html
  10. http://www.openbsd.org/cgi-bin/cvsweb/src/etc/rc.conf?rev=1.35
  11. http://www.openbsd.org/cgi-bin/man.cgi?query=ssl&apropos=0&sektion=8&format=html
  12. http://www.openbsd.org/cgi-bin/man.cgi?query=pwd_mkdb&sektion=8&apropos=0
  13. http://www.openbsd.org/cgi-bin/man.cgi?query=adduser&sektion=8&format=html
  14. http://www.openbsd.org/cgi-bin/man.cgi?query=adduser_proc&sektion=8&format=html
  15. http://www.openbsd.org/cgi-bin/man.cgi?query=rmuser&sektion=8&format=html
  16. http://www.openbsd.org/cgi-bin/man.cgi?query=edquota&sektion=8&format=html
  17. http://www.openbsd.org/cgi-bin/man.cgi?query=quotaon&sektion=8&format=html
  18. http://www.openbsd.org/cgi-bin/man.cgi?query=quota&sektion=1&format=html
  19. http://www.freebsd.org/handbook/kerberos.html
  20. http://web.mit.edu/kerberos/www/dialogue.html
  21. http://web.mit.edu/kerberos/www/papers.html#krb4
  22. http://www.amazon.com/exec/obidos/ASIN/0130614661/qid%3D930594963/
  23. http://www.openbsd.org/cgi-bin/man.cgi?query=krb.conf&sektion=5&format=html
  24. http://www.openbsd.org/cgi-bin/man.cgi?query=krb.realms&sektion=5&format=html
  25. http://www.openbsd.org/cgi-bin/man.cgi?query=kbd_init&sektion=8&format=html
  26. http://www.openbsd.org/cgi-bin/man.cgi?query=kstash&sektion=8&format=html
  27. http://www.openbsd.org/cgi-bin/man.cgi?query=ext_srvtab&sektion=8&format=html
  28. http://www.freebsd.org/handbook/kerberos.html#AEN4957
  29. http://www.openbsd.org/cgi-bin/man.cgi?query=kinit&sektion=1&format=html
  30. http://www.openbsd.org/cgi-bin/man.cgi?query=klist&sektion=1&format=html
  31. http://www.openbsd.org/cgi-bin/man.cgi?query=kdestroy&sektion=1&format=html
  32. http://www.monkey.org/~dugsong/ssh-afs-kerberos.html
  33. http://www.openbsd.org/cgi-bin/man.cgi?query=ftpd&sektion=8&format=html
  34. http://www.openbsd.org/cgi-bin/man.cgi?query=chroot&sektion=2&format=html
  35. http://www.openbsd.org/cgi-bin/man.cgi?query=adduser&sektion=8&format=html
  36. http://www.openbsd.org/cgi-bin/man.cgi?query=ftpd&sektion=8&format=html
  37. http://www.openbsd.org/cgi-bin/cvsweb/src/etc/inetd.conf
  38. http://openbsd.org/faq/index.html
  39. http://openbsd.org/faq/faq9.html
  40. http://openbsd.org/faq/faq11-2.4.html
  41. http://openbsd.org/faq/index.html
  42. mailto:www@@openbsd.org
d4252 2
a4253 2
   [1][Back to Main Index] [2][To Section 10.0 - System Administration]
   [3][To Section 12.0 - Performance Tuning]
d4255 1
a4255 1
                    11.0 - OpenBSD 2.4 Specific Information
d4258 5
a4262 1
11.1 - In 2.4 why do I get UserDir error when running httpd?
d4264 1
a4264 2
   It seems as though userdir support was left out of 2.4. Make sure to
   pick up the patch at:
d4266 9
a4274 1
   [4]http://www.openbsd.org/errata.html
d4276 1
a4276 1
11.2 - Installing at a partition 4GB or higher
d4278 8
a4285 3
   The 2.4 cd's shipped with a problem in installboot. A patch can be
   obtained here [5]http://www.openbsd.org/errata.html. This is fixed in
   -current.
d4287 1
a4287 6
   To place the partition boot record, installboot used a 32 bit
   multiplication for the sectors times the sectorsize which is larger
   than 2^32 -1 (i.e. multiplication overflow) when the partition starts
   at 4 GB or higher. This means the pbr is installed in the real
   partition address modulo 4GB. It's still possible to install at >= 4GB
   with some effort:
d4289 9
a4297 3
   You have 2 Options for doing so with OpenBSD 2.4. If you have Linux or
   any other unix like OS, you should back up the sectors first before
   trying anything.
d4299 1
a4299 30
     * Suppose the partition starts at cylinder 611, and the drive has
       255 heads, 63 sectors: offset for the obsd partition is
       611*255*63= 9815715 sectors. multiply this by 512 and you get:
       5025646080. 5025646080 mod 2^32 = 730678784
       (You can just subtract 2^32 on a hand calculator...) dividing by
       512 gives sector 1427107.
       Ok, suppose were now in linux (where cylinder numbers are 1 higher
       btw..) and that the obsd partition is DOS partition 4:
       dd if=/dev/hda of=backup.txt skip=1427107 bs=512 count=1
       will backup the data that installboot will nuke ..
       Now install OpenBSD. Return to Linux.
       Now we're going to copy the partition boot record to the right
       place.
       dd if=/dev/hda of=pbr.txt skip=1427107 bs=512 count=1
       dd if=/pbr.txt of=/dev/hda4 bs=512 count=1
       (adding obsd to lilo should now work)
       Now write back the nuked sector:
       dd if=/backup.txt of=/dev/hda seek=1427107 bs=512 count=1
       Caveat: make sure that whatever gets nuked by installboot isn't
       essential to running dd (and starting the other OS). Backing up
       the affected partition is recommended.
     * Use a correct version of installboot (compiled for you by another
       OBSD'er ..):
       put it on another partition, e.g. a DOS partition. Suppose wd0j is
       the DOS partition (see disklabel wd0, this is in case of IDE
       disks), and installboot is named installb there.
       After booting from floppy/CD, press ^C to get into the shell:
          + mkdir dos
          + mount /dev/wd0j dos
          + cp dos/tmp/installb /usr/mdec/installboot
d4301 5
a4305 2
   Now enter 'install' and the installation procedure should use the new
   installboot.
d4307 3
a4309 3
   [6][Back to Main Index] [7][To Section 10.0 - System Administration]
   [8][To Section 12.0 - Performance Tuning]
     _________________________________________________________________
d4311 6
a4316 2
   [9][back] [10]www@@openbsd.org
   $OpenBSD: faq11-2.4.html,v 1.1 1999/08/31 00:49:18 chris Exp $
d4318 2
a4319 1
References
d4321 7
a4327 10
   1. http://openbsd.org/faq/index.html
   2. http://openbsd.org/faq/faq10.html
   3. http://openbsd.org/faq/faq12.html
   4. http://openbsd.org/errata.html#userdir
   5. http://openbsd.org/errata.html#installboot
   6. http://openbsd.org/faq/index.html
   7. http://openbsd.org/faq/faq11-2.4.html
   8. http://openbsd.org/faq/faq12.html
   9. http://openbsd.org/faq/index.html
  10. mailto:www@@openbsd.org
d4329 1
a4329 1
$OpenBSD: INSTALL.linux,v 1.2 1999/07/21 05:47:59 ericj Exp $
d4331 8
a4338 1
   Linux + OpenBSD: it's possible
d4340 1
a4340 1
   by Marc Espie --  espie@@cvs.OpenBSD.org
d4342 5
a4346 6
It is perfectly possible to have Linux and OpenBSD on the same disk.
As of this writing (OpenBSD 2.5 & linux 2.2.3), both can read and write
other partitions, though Linux's support of BSD filesystems is still
experimental. Please note that 2.0 linux kernels, and most 2.1 kernels
don't know how to handle OpenBSD partitions (other BSD partitions are type
A5 and differ significantly from OpenBSD partitions--type A6).
d4348 1
a4348 2
You can even install OpenBSD from an ext2fs partition (choose install from
disk... ext2fs does not appear in the choices, but `default' it is).
d4350 6
a4355 3
If you are starting from scratch, it is better to install Linux first.
Since you are going to use several OSes, you need a way to multi-boot, and
Linux's lilo fits the bill fine.
d4357 1
a4357 3
IMPORTANT: don't forget about lilo. You can't uninstall linux from this
disk without *first* restoring the MBR to an un-liloed state and making
*dead* sure OpenBSD boots as a default.
d4359 2
a4360 2
If you want to grab space from a Windows/DOS partition, use fips.
Fips20 knows all about FAT32, so windows 95 is no longer a problem.
d4362 1
a4362 7
Other sources of information, especially concerning other BSD systems,
must be taken with a healthy does of scepticism. OpenBSD definitely
differs:
- disklabels can hold up to 16 partitions,
- type is A6, not A5,
- the `special' partitions in the disklabel are only a (root), b (swap),
and c (whole disk).
d4364 15
a4378 6
Planning & Good advice
----------------------
If you are starting on a new machine, be prepared to throw your
installation away. It is generally the case that you will install the
machine, play with it for a week/a month, and find out that you don't like
the setup, and then start over.
d4380 1
a4380 4
Write down any interesting information you find out during your first
installation.  Don't do too many things to your box during the first month,
as you will lose these while reinstalling, unless you can do backups
conveniently.
d4382 4
a4385 3
Do you really need to have a dual-boot machines ? Most people don't need
both Linux and OpenBSD.  Once you're satisfied with OpenBSD, you may find
out you just want to erase Linux...
d4387 3
a4389 7
Try to find out what your precise needs are, locate partitions whose size
may change next to each other, as far as possible... Put partitions whose
contents are unimportant (or whose backups are always up-to-date) next to
the frontier between OpenBSD and Linux. For instance, it's usually a good
idea to locate the swap area such that you can grow or shrink it. Keep in
mind that exceptional usage (very large, temporary swaps) can use a
temporary file instead of a partition, under both OpenBSD (svnd) and Linux.
d4391 6
a4396 9
First principles
----------------
OpenBSD doesn't only use the MBR partitions (the ones mapped in the Master
Boot Record) for booting. Afterwards, it trusts some bsd specific
information called the disklabel, which is another completely distinct
description of your hard disk. It does not even have to be consistent with
the usual DOS partitions information.
[OpenBSD requires a primary MBR partition for booting, anything else is
officially unsupported.]
d4398 1
a4398 2
Throughout this document, we will distinguish between MBR partitions and
disklabel partitions whenever this is necessary.
d4400 3
a4402 2
The safest way to deal with things is to allocate one primary MBR partition for
OpenBSD, type A6, that you will partition further with disklabel.
d4404 7
a4410 5
If you can, it is even safer to devote a full disk to OpenBSD: this limits
the number of mistakes you can do. Admittedly there are some cases where
this isn't a option (my machine is a laptop... I have to cope with the
hard disk I have), or where this can be slower (SCSI disk setups will
yield better throughput with swap interleaved among the disks).
d4412 7
a4418 4
Prime rule: *ALWAYS* use the disk partitioning tools that go with the OS.
They know more about its internal workings than you do. So use linux fdisk
for linux partitions, don't let it touch the OpenBSD disklabel, and
reciprocally.
d4420 44
a4463 6
DOS and BIOS and all the problems of the world
----------------------------------------------
Due to historical accident, your machine resident `Operating System',
also known as the BIOS, can only access hard-disks up to cylinder 1024.
Various lying tricks are used, so that your whole disk is usually
accessible to the BIOS, except for very large disks (>8Gb).
d4465 1
a4465 2
fdisk is usually going to give you reliable information: anything that is
before cylinder 1024 can be accessed through the BIOS.
d4467 5
a4471 6
When you first boot up OpenBSD, the kernel will detect your hardware,
and give you a message such as
  wd0 at wdc0 drive 0: <TOSHIBA MK4006MAV>
  wd0: 3909MB, 7944 cyl, 16 head, 63 sec, 512 bytes/sec, 8007552 sec total
  wd0: using 16-sector 16-bit pio transfers, lba addressing
don't panic. This is just the real disk geometry. Trust fdisk on this one.
d4473 12
a4484 6
If fdisk shows you more than 1024 cylinders, you will have to cram OpenBSD
into that. Actually, it's enough that the disklabel partition used for
booting fits within the first 1024 cylinders (a:), so if you can get your
OpenBSD partition to start within 1024 cylinders, just get a small enough
a:, and you're in the clear.  (You can get by with a: a bit under 20Mb,
BTW, just enough for /bin /sbin, a kernel and /etc).
d4486 5
a4490 4
Mapping your disk
-----------------
Starting from Linux, get a grasp of your partitions. Use df to check which
is what, then fdisk to get the actual setup of the disk.
d4492 3
a4494 2
Write down the setup onto a bit of paper, in case you make a mistake further
down.  It can come in very handy.
d4496 2
a4497 2
Disk /dev/hda: 128 heads, 63 sectors, 993 cylinders
Units = cylinders of 8064 * 512 bytes
d4499 1
a4499 4
   Device Boot    Start      End   Blocks   Id  System
/dev/hda1             1      211   850720+   6  DOS 16-bit >=32M
/dev/hda2           212      273   249984   83  Linux native
/dev/hda3           274      992  2899008   a6  OpenBSD
d4501 17
a4517 3
The + at the end of the DOS line is because linux fdisk is brain-damaged
and wants to write output in 1024-sized chunks, so this stands for
`850720 blocks and a half'
a4518 1
Older flavors of linux fdisk won't recognize a6 as OpenBSD.
d4520 2
a4521 3
As you can see, my linux setup is very small. I have enough to check how
things such as gcc work on linux, but my machine is definitely an
OpenBSD developper's box.
d4523 2
a4524 5
Get the display to sectors with u, and jot down the corresponding
information as well:

Disk /dev/hda: 128 heads, 63 sectors, 993 cylinders
Units = sectors of 1 * 512 bytes
d4526 1
a4526 6
   Device Boot    Start      End   Blocks   Id  System
/dev/hda1            63  1701503   850720+   6  DOS 16-bit >=32M
/dev/hda2       1701504  2201471   249984   83  Linux native
/dev/hda3       2201472  7999487  2899008   a6  OpenBSD
--
Okay, finally switch to expert mode, and write the corresponding data.
d4528 98
a4625 1
Disk /dev/hda: 128 heads, 63 sectors, 993 cylinders
d4627 2
a4628 5
Nr AF  Hd Sec  Cyl  Hd Sec  Cyl   Start    Size ID
 1 00   1   1    0 127  63  210      63 1701441 06
 2 00   0   1  211 127  63  272 1701504  499968 83
 3 00   0   1  273 127  63  991 2201472 5798016 a6
 4 00   0   0    0   0   0    0       0       0 00
d4630 3
d4634 2
a4635 4
Note that this is STILL the same data. The good point about this last
display is that it is almost what you're going to see in OpenBSD fdisk,
usually ! (I think there may be some very weird cases where this won't
match)
d4637 1
a4637 11
There are some differences though, mostly because Linux fdisk has made
some rather confusing choices:
- in simple mode it starts numbering cylinders at 1... whereas
everything else starts from 0.
- in simple mode it shows blocks of 1024 bytes, which makes for half-blocks
(marked with a +) and sizes halved from the real block size.
- in expert mode it shows extended partitions offset from the start
of the extended partition.
- the hd/sec/cyl is a confusing order, as the sector number is computed
from cyl/hd/sec, in that order.
- it never shows and doesn't care about the real disk geometry.
d4639 9
a4647 2
You will notice that I don't have a linux swap partition visible. My
linux setup currently uses the OpenBSD swap area.
a4648 4
Before starting to install OpenBSD, now would be a good time to check the
INSTALL.pt document...  Especially note the alignment restriction of
partitions (first sector of a partition must be at head 0, sector 1 of a
cylinder). This is enforced by Linux' fdisk.
d4650 2
a4651 2
The other point to note is that extended partitions are actually linked
lists. This will show up in OpenBSD's fdisk.
d4653 2
a4654 8
Your clock and OpenBSD
----------------------
OpenBSD expects your hardware clock to be in universal time, and uses
time zones to give you local time. With Linux, this depends...
most distributions use a small program called hwclock to set up the
system time from the hardware clock when booting... there is a --utc
option if your hardware clock is in universal time, but this is not
always what happens by default.
d4656 5
a4660 6
For instance, on a redhat system, up to 5.2, this happens in
/etc/rc.d/rc.sysinit which loads an /etc/sysconfig/clock that defines a
variable called UTC, and then proceeds calling hwclock.
- ensure UTC is set to true,
- adjust your hardware clock from the system time if necessary, e.g.,
hwclock --systohc --utc.
d4662 4
a4665 2
Normally, this is one of the choices that the Linux installation program
lets you do: set your hardware clock to GMT.
d4667 3
a4669 8
The Linux partition table and OpenBSD
-------------------------------------
There used to be a problem with Linux's rc: it always mounts all file systems
even in single-user mode.  The 2.2 kernels fix that in a handy way: the
partition recorded in the MBR is scanned for a disklabel, and marked with
a ! if one is found. Then, the rest of the disk is scanned, before
coming back to the disklabel itself. That way, changes to the
OpenBSD disklabel won't affect the setup of the rest of the disk.
d4671 2
a4672 4
Anyhow, you may want to check that you can still boot from a Linux kernel
which doesn't know about disklabels.  The long term solution is to fix your
inittab and rc scripts to make deadly sure thhat single-user boot will work
-- preferably by moving disk mounts to multi-user.
d4674 1
a4674 5
The OpenBSD installation
------------------------
If you've got the space, you can install from your ext2fs partitions. This
is what I did, a long time in the past, as I had a slip connection to the
rest of the world, and the OpenBSD install floppy does not include slip.
d4676 17
a4692 2
REMEMBER TO BACKUP ALL IMPORTANT DATA ON YOUR DISK BEFORE DOING THE
INSTALLATION !!!
a4693 1
So you cp floppy*.fs /dev/fd0, then reboot from the floppy.
d4695 1
a4695 4
First, the booter loads, then there is a boot prompt. Five seconds later,
the kernel and the ram disk image are loaded, and the kernel is run.
After a while, through a few more prompts, you get to fdisk and you can
enter the new partition into the MBR.
d4697 2
a4698 10
This is what the fdisk dump looked like after my changes:
Disk: wd0       geometry: 992/128/63 [7999488 sectors]
Offset: 0       Signatures: 0xAA55,0x0
         Starting        Ending
 #: id  cyl  hd sec -  cyl  hd sec [     start -       size]
-------------------------------------------------------------------------
 0: 06    0   1   1 -  210 127  63 [        63 -    1701441] DOS > 32MB
 1: 83  211   0   1 -  272 127  63 [   1701504 -     499968] Linux files*
 2: A6  273   0   1 -  991 127  63 [   2201472 -    5798016] OpenBSD
 3: 00    0   0   0 -    0   0   0 [         0 -          0] unused
d4700 1
a4700 2
fdisk geometry tells me that I needn't worry about cylinder 1024.
This matches very  closely with what linux fdisk saw.
d4702 1
a4702 4
If you had extended partitions, it would be a trifle bit harder:
you just follow the extended partition links using select, jot down
whatever you need, add the OpenBSD partition into the MBR to look like
you want it to, and save everything.
d4704 10
a4713 2
The * at the end of partition #1 means that the system normally boots under
Linux. In reality, lilo takes control and disregards this completely.
d4715 7
a4721 3
After you leave fdisk, you get to the interesting part: the disklabel
itself. If all goes well, OpenBSD synthesizes a nice disklabel out of what
it can deduce from the disk, including the ext2fs partitions.
d4723 7
a4729 13
There are only a few subtleties to take care of:
- initially, you can ONLY edit the disklabel part that matches the
OpenBSD partition that was declared in the MBR (what you just entered in
fdisk, the `slice' from FreeBSD lingo). Most simple installation don't
need to edit more than that, but you can use b 0 * to unlock the whole
disk (this is a bad idea in most cases).
- your real disk geometry becomes more relevant. The Berkeley fast file system
can't use partial cylinder groups, hence BSD partitions should start
on cylinder boundaries, as any remaining sectors  will be lost anyway.
(Actually, what's important is the disk geometry that disklabel gives you.
Trust it on that). In my case, sectors/cylinder=1008 and bytes/sector=512,
so the granularity of disklabel partitions is 504 Kb.
- units for size and offset can be given as sectors (default) or cylinders.
d4731 2
a4732 2
After edition, this is what my disklabel looks like:
# editing
d4734 2
a4735 1
# using MBR partition 2: type A6 off 2201472 (0x219780) size 5798016 (0x587880)
d4739 1
a4739 1
label: TOSHIBA MK4006M
d4745 2
a4746 2
cylinders: 7944
total sectors: 8007552
d4757 4
a4760 12
  a:   104832  2201472    4.2BSD     1024  8192    16   # (Cyl. 2184 - 2287)
  b:   274176  2306304      swap                        # (Cyl. 2288 - 2559)
  c:  8007552        0    unused        0     0         # (Cyl.    0 - 7943)
  d:   613872  2580480    4.2BSD     1024  8192    16   # (Cyl. 2560 - 3168)
  e:   920304  4846464    4.2BSD     1024  8192    16   # (Cyl. 4808 - 5720)
  f:   628992  4217472    4.2BSD     1024  8192    16   # (Cyl. 4184 - 4807)
  g:   204624  5766768    4.2BSD     1024  8192    16   # (Cyl. 5721 - 5923)
  h:  1073520  5971392    4.2BSD     1024  8192    16   # (Cyl. 5924 - 6988)
  i:   962640  7044912    4.2BSD     1024  8192    16   # (Cyl. 6989 - 7943)
  j:  1701441       63     MSDOS                        # (Cyl.    0*- 1687)
  k:   499968  1701504    ext2fs                        # (Cyl. 1688 - 2183)
  l:  1023120  3194352    4.2BSD     1024  8192    16   # (Cyl. 3169 - 4183)
d4762 5
a4766 10
Things that check, more or less automatically:
- this disklabel is saved in MBR partition #2 (basic DOS partition 2),
as expected.
- all the BSD partitions proper are aligned on a cylinder boundary (ie no '*').
the root partition begins at the precise same offset the corresponding DOS
partition begins, and it extends for the same length.
- the ext2fs partitions have the exact same layout under the OpenBSD
disklabel.
- the swap partition is very large. It gets used as mfs for my tmp
directories.
d4768 5
a4772 12
And here is the corresponding /etc/fstab:
/dev/wd0a       /          ffs    rw    1       1
/dev/wd0d       /usr       ffs    ro    1       2
/dev/wd0l       /usr/local ffs    ro    1       2
/dev/wd0e       /home      ffs    rw    1       2
/dev/wd0g       /var       ffs    rw    1       2
/dev/wd0h       /big       ffs    ro    1       2
/dev/wd0f       /usr/obj   ffs    rw    1       2
/dev/wd0i       /vbig      ffs    rw    1       2
/dev/wd0j       /dos       msdos  rw    1       2
/dev/wd0k       /linux     ext2fs rw
/dev/wd0b       /tmp       mfs    rw
d4774 2
a4775 7
One point that is somewhat laborious is that the disklabel -E mode
(which you are currently using) tends to move partitions around to ensure
that ALL defined partitions are contiguous. For that reason, it is better
if you don't have to use b 0 *, otherwise partitions will be moved around to
remove holes, without regard for the rigid MBR partitioning.
ext2fs and DOS partitions  should be recognized and positioned
automatically if all goes well.
d4777 36
a4812 1
Once the disklabel is written to disk, the installation proceeds as usual.
d4814 8
a4821 1
ext2fs partitions are perfectly usable from OpenBSD.
d4823 3
a4825 6
Booting
-------
First time I booted my system back, I did not get into OpenBSD as expected...
I plain forgot I had installed lilo in the master boot block, and lilo
does not heed the active partition flag. The fix was rather simple: from
the Linux system, I just had to edit lilo.conf to add the OpenBSD entry:
d4827 3
a4829 20
boot=/dev/hda
map=/boot/map
install=/boot/boot.b
prompt
timeout=500
other=/dev/hda3
        label=bsd
        table=/dev/hda
image=/boot/vmlinuz-2.2.3
        label=linux
        vga=4
        root=/dev/hda2
        read-only
image=/boot/vmlinuz-2.0.36-0.7
        label=linux.orig
        root=/dev/hda2
        read-only
other=/dev/hda1
        label=dos
        table=/dev/hda
d4831 1
a4831 3
More details: I've kept the original redhat installation as
vmlinuz-2.0.36 because I'm paranoid, but the real setup uses only
bsd, linux, and dos.
d4833 1
a4833 1
Rerun lilo (DON'T FORGET THAT STEP), and voila, OpenBSD is able to boot!
d4835 1
a4835 6
Linux and OpenBSD partitions
----------------------------
The 2.2 kernel does incorporate my patch for the correct handling of
OpenBSD partitions. You will probably need to reconfigure and rebuild
your linux kernel to recognize BSD disklabels... Here is how it shows up
on my box:
d4837 6
a4842 3
Partition check:
 hda: hda1 hda2 hda3! < hda5 hda6 hda7 hda8 hda9 hda10 hda11 hda12 hda13 hda14
hda15 >
d4844 3
a4846 5
- the disklabel is detected early, but handled later.
- disklabel handling should remove duplicates: all partitions that are present
as both MBR and disklabel partition should get removed silently. (this does
not seem to work as advertized presently).
- the remaining partitions are checked for consistency.
d4848 2
a4849 1
and here is my linux fstab:
d4851 10
a4860 9
/dev/hda2               /                       ext2    defaults        1 1
/dev/hda6               swap                    swap    defaults        0 0
/dev/hda5               /bsd                    ufs     ufstype=44bsd   1 2
/dev/hda7               /bsd/usr                ufs     ufstype=44bsd   1 2
/dev/hda8               /home                   ufs     ufstype=44bsd   1 2
/dev/hda9               /bsd/usr/obj            ufs     ufstype=44bsd   1 2
/dev/hda1               /dos                    vfat    defaults        1 2
/dev/fd0                /mnt/floppy             ext2    noauto          0 0
/dev/cdrom              /mnt/cdrom              iso9660 noauto,ro
d4862 3
a4864 11
2.2 kernels also include a working UFS, though you may run into problems when
writing to ufs partitions.   Note the ufstype=44bsd. If you forget that
in your mounts, it will fail. Depending upon your installation, you may
get a failure message, or you will have to dig through /var/log/ to find
it.

Running Linux binaries under OpenBSD
------------------------------------
You just have to recompile your BSD kernel with COMPAT_LINUX, and set up
/emul/linux as explained in compat_linux(1). If you run GENERIC, you don't
have to recompile anything, as this is the default setup.
d4866 20
a4885 2
It's a good idea to mount your Linux file system under another point, then
make symbolic links so that you can control what gets used precisely.
d4887 2
a4888 3
As you have a complete linux system, don't bother with the ports
emul/linux_lib entry: it's only a set of Linux libraries for people who
don't have a Linux system running.
d4890 31
a4920 4
A small detail that may cause problems: uname still says `OpenBSD', even
under Linux compatibility.  The reason behind that is that we don't want
netscape to tell it was run from a Linux box, when it is used under
OpenBSD.
d4922 1
a4922 4
Some programs, for instance maple, do depend on uname answering `Linux'.
For maple, this is straigthforward: you just have to fudge
/usr/local/maple/bin/maple.system.type to check OpenBSD in the same
class with Linux.
d4924 3
a4926 2
Similar shell scripts are easy to fix.  Binary programs that don't run
suid can be coerced by using LD_PRELOAD.
d4928 2
a4929 3
As a rule, this should be achieved on a program-by-program basis.
The more networking programs that do tell they're running under OpenBSD,
the merrier !
d4931 4
a4934 14
A word of caution: brain-damaged linux installations
----------------------------------------------------
I just reinstalled the linux side of my laptop using redhat 5.2.  This
CD does insist on having TWO linux partitions: one root partition, and one
swap partition (even though I have 32 Mb of memory, largely enough for
the installation). Since it uses a 2.0.36 kernel, it does NOT handle BSD
disklabels, so I couldn't tell it to use my swap area (I have this bad
feeling that distributed 2.2 boot kernels won't include BSD disklabel
handling anyway). Instead, I had to back my last OpenBSD partition up,
fiddle with my fdisk setup to feed the last cylinder as a swap partition
to their brain dead install CD. Then fetch the latest kernel source to the
linux side, and recompile to get a fully working linux setup. Finally,
reset the fdisk/disklabel to its normal state, and get the backed-up
partition to its normal location.
d4936 11
a4946 13
Another word of caution: getting enough rope to hang yourself
-------------------------------------------------------------
One previous version of this document got into much nastier details, and
gave installation instructions that were thoroughly dangerous.
- various tools may yield distinct views of your disk. These will match,
most often, but not always. Don't get confused if various fdisk, disklabel
utilities don't yield the same information. Generally, sector sizes and
offsets should match.
- try to keep various OSes segregated to their areas. Don't depend on
OpenBSD information to be correct for your linux setup and vice-versa.
Some weird problem with the brain-damaged PC architecture may force us to
tweak things so that OpenBSD will work seamlessly everywhere. Compatibility
with weird tricks is not a priority.
d4948 13
a4960 7
This being said, you will have noticed by now that the OpenBSD disklabel is
just another description of your hard-disk. It is almost completely
independent from the MBR description (it just has to be on the right sector
for the boot process to find it). You can get into trouble if things don't
match. Let it live within its MBR partition, unless you're completely sure
you know what you are doing, and don't expect there will always be someone
to get you out of trouble. If your setup is really too weird, no-one can help.
d4962 5
a4966 6
As far as the boot process goes, I think lilo allows you to boot from ANY
partition recorded in the MBR, including extended partitions. The only
limitation is that the next stage bootstrap MUST take place entirely within
the first 1024 cylinders of the disk, as seen by the BIOS.  OpenBSD
MBR partitions that extend beyond cylinder 1024 are no problem, as long as
the disklabel root (a) partition doesn't extend beyond cylinder 1024.
d4968 9
a4976 6
Since Windows, OpenBSD, and linux all have that limitation, the easiest way
is to start with Windows partitions (entirely within the first 1024
cylinders), follow with the linux boot partition (still within the first
1024 cylinders), then the OpenBSD area (which can span the 1024 cylinders
boundary, as long as a lives within the limit), and the remaining linux
partitions.
d4978 2
a4979 11
Weirder setups are unwarranted.  Several bsd on the same disk MAY be
possible, but will be harder to manage:
- it is better if disklabels match,
- linux will obey the first disklabel it finds, try to ensure this is
OpenBSD disklabel, it can describe more partitions than the others,
- other BSD may get confused with each other data. Normally, the A5/A6
split ensures that Net/Free won't get mixed up with OpenBSD,
- FreeBSD and NetBSD will probably get confused with each other,
- if you have a 1024 cylinder limit, all boot areas must stay within the
1024 cylinder boundary, so only one of the BSD may span that limit, apart
from very, very nasty tricks.
d4981 1
a4981 5
Finally, how much disk space do you have anyway ?  Do you really need to
cram that many OSes on the same disk ? Put them on separate disks rather.
If you reach that stage, you'd better be ready to hack at the linux kernel
to recognize several disklabels, for instance, or generally know what
you're doing.
d4983 3
d4987 4
d4992 2
a4993 2
   [1][Back to Main Index] [2][To Section 11.0 - OpenBSD 2.4 Specific
   Information]
d4995 6
a5000 2
                           12.0 - Performance Tuning
     _________________________________________________________________
d5002 4
a5005 1
12.1 - Networking
d5007 1
a5007 3
   If you run a busy server, gateway or firewall, you should make sure to
   prevent memory starvation to various parts of the kernel described
   below.
d5009 4
a5012 1
   The [3]options(4) man page talks about the options presented.
d5014 4
a5017 9
   An option you may need to change for a busy server, gateway or
   firewall is NMBCLUSTERS. This controls the size of the kernel mbuf
   cluster map. On your computer, if you get messages like "mb_map full",
   you need to increase this value. If traffic on a networking interface
   stops for no apparent reason, this may also be a sign that you need to
   increase this value. A reasonable value on the i386 port with most
   100Mbps ethernet interfaces (no matter how many the machine has) is
   8192.
   option NMBCLUSTERS=8192
d5019 5
a5023 1
12.2 - Disk I/O
d5025 3
a5027 8
   Disk I/O speed is a significant factor in the overall speed of your
   computer. It becomes increasingly important when your computer is
   hosting a multi-user environment (users of all kinds, from those who
   log-in interactively to those who see you as a file-server or a
   web-server.) Data storage constantly needs attention, especially when
   your partitions run out of space and when your disks fail. OpenBSD has
   several options to increase the speed of your disk operations and
   provide fault tolerance.
d5029 3
a5031 1
  CCD
d5033 3
a5035 9
       The first option is the use of [4]ccd(4), the Concatenated Disk
       Driver. This allows you to join several partitions into one
       virtual disk (and thus, you can make several disks look like one
       disk). This concept is similar to that of LVM (logical volume
       management), which is found in many commercial Unix flavors.
       If you are running GENERIC, ccd is already enabled. If not, you
       may need to add it to your kernel configuration. To start the
       setup of ccd, you need to add support for it in your kernel. A
       line such as:
d5037 2
a5038 1
pseudo-device   ccd     4       # concatenated disk devices
d5040 2
a5041 5
   The above example gives you up to 4 ccd devices (virtual disks). Now
   you need to figure out what partitions on your real disks that you
   want to dedicate to ccd. Use disklabel to mark these partitions as
   type 'ccd'. On some architectures, disklabel may not allow you to do
   this. In this case, mark them as 'ffs'.
d5043 1
a5043 3
   If you are using ccd to gain performance by striping, note that you
   will not get optimum performance unless you use the same model of
   disks with the same disklabel settings.
d5045 1
a5045 6
   Edit /etc/ccd.conf to look something like this: (for more information
   on configuring ccd, look at [5]ccdconfig(8))
# Configuration file for concatenated disk devices
#
# ccd   ileave  flags   component devices
ccd0   16      none    /dev/sd2e /dev/sd3e
d5047 6
a5052 2
   To make your changes take effect, run
# ccdconfig -C
d5054 1
a5054 7
   As long as /etc/ccd.conf exists, ccd will automatically configure
   itself upon boot. Now, you have a new disk, ccd0, a combination of
   /dev/sd2e and /dev/sd3e. Just use disklabel on it like you normally
   would to make the partition or partitions you want to use. Again,
   don't use the 'c' partition as an actual partition that you put stuff
   on. Make sure your useable partitions are at least one cylinder off
   from the beginning of the disk.
d5056 1
a5056 1
  RAID
d5058 5
a5062 8
       Another solution is [6]raid(4) which will have you use
       [7]raidctl(8) to control your raid devices. OpenBSD's RAID is
       based upon Greg Oster's [8]NetBSD port of the CMU [9]RAIDframe
       software. OpenBSD has support for RAID levels of 0, 1, 4, and 5.
       With raid, as with ccd, support must be in the KERNEL. Unlike ccd,
       support for RAID is not found in GENERIC, it must be compiled into
       your kernel (RAID support adds some 500K to the size of an i386
       kernel!)
d5064 3
a5066 1
pseudo-device   raid   4       # RAIDframe disk device
d5068 2
a5069 5
   Setting up RAID on some operating systems is confusing and painful to
   say the least. Not so with RAIDframe. Read the [10]raid(4) and
   [11]raidctl(8) man pages to get full details. There are many options
   and possible configurations, a detailed explanation is beyond the
   scope of this document.
d5071 4
a5074 1
  Filesystem Buffer
d5076 1
a5076 6
   For fileservers with memory to spare, you can increase
       BUFCACHEPERCENT. That is, what percentage of your RAM should you
       use as a file system buffer. This option may change when the
       Unified Buffer Cache is completed and is part of OpenBSD. In the
       mean time, to increase BUFCACHEPERCENT, you should add a line to
       your kernel configuration like this:
d5078 3
a5080 1
   option BUFCACHEPERCENT=30
d5082 2
a5083 2
   Of course you can make it as low as 5 percent (the default) or as high
   as 50 percent (or more.)
d5085 1
a5085 1
  Soft updates
d5087 5
a5091 15
   Another tool that can be used to speed up your system is softupdates.
       One of the slowest operations in the traditional BSD file system
       is updating metainfo (which happens, among other times, when you
       create or delete files and directories.) Softupdates attempts to
       update metainfo in RAM instead of writing to the hard disk each
       and every single metainfo update. Another effect of this is that
       the metainfo on disk should always be complete, although not
       always up to date. So, a system crash should not require fsck upon
       boot up, but simply a background version of fsck that makes
       changes to the metainfo in RAM (a la softupdates). This means
       rebooting a server is much faster, because you don't have to wait
       for fsck! (OpenBSD does not have this feature yet.) You can read
       more about softupdates in the [12]softupdates FAQ entry. If you
       use softupdates, you will most certainly want to take advantage of
       the Tuning kmem section below.
d5093 1
a5093 1
12.3 - Tuning kmem
d5095 2
a5096 4
   If you start using the performance tuning measures above, you may
   start running out of kernel memory. If you start getting panics like
   "out of space in kmem_map" then you need to try
   option NKMEMCLUSTERS=8192
d5098 2
a5099 3
   Note that 8192 is valid for the i386 architecture, but may be too
   little or too much for others. Look at /usr/include/machine/param.h to
   see more information.
d5101 1
a5101 6
   You may also want to increase the number of static kernel maps and
   entries. The default value for these options is architecture dependent
   and is specified in /sys/vm/vm_map.h. If you are using soft updates,
   the following values should keep you going!
   option MAX_KMAP=120
       option MAX_KMAPENT=6000
d5103 4
a5106 1
12.4 - Hardware choices
d5108 1
a5108 3
   (Note- this section is heavily centered around the i386, or PC,
   architecture. That is to say... other architectures don't give you
   quite as many choices!)
d5110 1
a5110 7
   The performance of your applications depends heavily on your OS and
   the facilities it provides. This may be part of the reason that you
   are using OpenBSD. The performance of your applications also depends
   heavily on your hardware. For many folks, the Price/Performance ratio
   of a brand new PC with a Intel Pentium III or AMD Athlon processor is
   much better then the Price/Performance ratio of a Sun UltraSparc 60!
   And, the price of OpenBSD can't be beat.
d5112 4
a5115 7
   If you are shopping for a new PC, whether you are buying it piece by
   piece or completely pre-built, you want to make sure first that you
   are buying reliable parts. In the PC world, this is not easy. Bad or
   otherwise unreliable or mismatched parts can make OpenBSD run poorly
   and crash often. The best advice we can give is to be careful, buy
   brands and parts that have been reviewed by an authority you trust.
   Sometimes, when you skimp on the price of a PC, you lose in quality!
d5117 2
a5118 44
   There are certain things that will help bring out the maximum
   performance of your hardware:
     * Use multiple disks.
       Instead of buying one 20GB disk, buy multiple 4GB or 9GB disks.
       While this may cost more, distributing the load over multiple
       spindles will decrease the amount of time necessary to access data
       on the disks. And, with more spindles, you will get more
       reliability and faster data access with RAID.
     * Use SCSI where you can.
       If you are building a server, and you need more then 10GB of disk
       space, the SCSI architecture is the best choice. IDE limits you to
       two disks per controller. Wide SCSI limits you to 15 per
       controller! While SCSI costs more, the flexibility and performance
       can justify these costs. IDE was not designed for use in a
       multi-user, multi-tasking environment.
     * Use SDRAM.
       This option applies mainly to PCs. Most other architectures don't
       give you a choice of what kind of RAM you can use. Several PCs
       still do. Avoid SIMMs, as there are not many companies
       manufacturing them anymore, and in some cases they cost more then
       equivalent SDRAM!
     * Use ECC or parity RAM.
       Parity adds some functionality to see if the data in RAM has been
       corrupted. ECC extends this functionality and attempts to correct
       some bit corruption errors on the fly. This option applies mainly
       to PCs. Most other architectures simply require parity or ECC
       capable RAM. Several non-PC computers won't even boot with
       non-parity RAM. If you aren't using ECC/parity RAM, you may get
       data corruption and other abnormalities. Several manufacturers of
       "cheap PC RAM" don't even make an ECC variety! This will help you
       avoid them! PC manufacturers often sell several product lines,
       divided around "servers" and "workstations." The servers will
       incorporate ECC RAM into their architecture. Unix workstation
       manufacturers have been using parity (and now ECC) for several
       years in all of their product lines.
     * Avoid ISA devices.
       While most folks avoid ISA devices, because they are generally
       hard to configure and out of date, there are still plenty in
       existence. If you are using the ISA bus for your disk or network
       controllers, (or even worse, for both) remember that the ISA bus
       itself can be a performance bottleneck. If you need speed, look to
       PCI. Of course, there are still several ISA bus cards that work
       just fine. Unfortunately, most of these are sound cards and serial
       port cards.
d5120 1
a5120 1
12.5 - Why aren't we using async mounts?
d5122 2
a5123 5
   Question: "I simply do "mount -u -o async /" which makes one package I
   use (which insists on touching a few hundred things from time to time)
   useable. Why is async mounting frowned upon and not on by default (as
   it is in some other unixen) ? Surely it is much simpler and therefore
   a safer way of improving performance in some applications ?"
d5125 24
a5148 12
   Answer: "Async mounts is indeed faster then sync mounts, but they are
   also less safe. What happens in case of a power failure? Or a hardware
   problem? The quest for speed should not sacrifice the reliabilty and
   the stability of the system. Check the manpage for [13]mount(8)."
             async   All I/O to the file system should be done asynchronously.
                     This is a dangerous flag to set since it does not guaran-
                     tee to keep a consistent file system structure on the
                     disk.  You should not use this flag unless you are pre-
                     pared to recreate the file system should your system
                     crash.  The most common use of this flag is to speed up
                     restore(8) where it can give a factor of two speed in-
                     crease.
d5150 13
a5162 5
   On the other hand, when you are dealing with temp data that you can
   recreate from scratch after a crash, you could gain speed by using a
   separate partition, used for that data only, mounted async. If you
   don't mind risking the loss of all the data in the partition when
   something goes wrong...
d5164 1
a5164 2
   [14][Back to Main Index] [15][To Section 11.0 - OpenBSD 2.4 Specific
   Information]
d5167 2
a5168 2
   [16][back] [17]www@@openbsd.org
   $OpenBSD: faq12.html,v 1.18 1999/08/31 00:49:20 chris Exp $
d5173 19
a5191 16
   2. http://openbsd.org/faq/faq11-2.4.html
   3. http://www.openbsd.org/cgi-bin/man.cgi?query=options&apropos=0&sektion=4&format=html
   4. http://www.openbsd.org/cgi-bin/man.cgi?query=ccd&apropos=0&sektion=4&format=html
   5. http://www.openbsd.org/cgi-bin/man.cgi?query=ccdconfig&apropos=0&sektion=8&format=html
   6. http://www.openbsd.org/cgi-bin/man.cgi?query=raid&apropos=0&sektion=4&format=html
   7. http://www.openbsd.org/cgi-bin/man.cgi?query=raidctl&apropos=0&sektion=8&format=html
   8. http://www.cs.usask.ca/staff/oster/raid.html
   9. http://www.pdl.cs.cmu.edu/RAIDframe/
  10. http://www.openbsd.org/cgi-bin/man.cgi?query=raid&apropos=0&sektion=4&format=html
  11. http://www.openbsd.org/cgi-bin/man.cgi?query=raidctl&apropos=0&sektion=8&format=html
  12. http://openbsd.org/faq/faq4.html#4.9
  13. http://www.openbsd.org/cgi-bin/man.cgi?query=mount&apropos=0&sektion=8&format=html
  14. http://openbsd.org/faq/index.html
  15. http://openbsd.org/faq/faq11-2.4.html
  16. http://openbsd.org/faq/index.html
  17. mailto:www@@openbsd.org
@


1.11
log
@proper naming for 2.4 faq entries
@
text
@d108 2
d111 1
a111 1
  [68]9.0 - Migrating from Linux
d113 3
a115 3
     * [69]9.1 - Tips for Linux (and other free Unix-like OS) users
     * [70]9.2 - Dual boot of Linux and OpenBSD
     * [71]9.3 - Converting your linux (or other System-7 style) password
d118 1
a118 1
  [72]10.0 - System Administration
d120 1
a120 1
     * [73]10.1 - When I try to su to root it says that I'm in the wrong
d122 2
a123 2
     * [74]10.2 - How do I duplicate a filesystem?
     * [75]10.3 - How do I get daemons like httpd and sendmail to start
d125 1
a125 1
     * [76]10.4 - Why do users get relaying access denied when they are
d127 1
a127 1
     * [77]10.5 - I've set up POP, but I get errors when accessing my
d129 2
a130 2
     * [78]10.6 - Setting up a Secure HTTP Server using SSL(8)
     * [79]10.7 - I made changes to /etc/passwd with vi(1), but the
d132 5
a136 5
     * [80]10.8 - How do I add a user? or delete a user?
     * [81]10.9 - How do I create a ftp-only account?
     * [82]10.10 - Setting up user disk quotas
     * [83]10.11 - Setting up Kerberos Client/Server
     * [84]10.12 - Setting up an Anonymous FTP Server
d138 1
a138 1
  [85]11.0 - OpenBSD 2.4 Specific Information
d140 3
a142 3
     * [86]11.1 - Why do I get UserDir errors when running httpd(8)?
     * [87]11.2 - Installing at a partition 4GB or higher (i386 specific)
     * [88]Log24.txt - Specific OpenBSD 2.4 Install Example
d144 1
a144 1
  [89]12.0 - Performance Tuning
d146 5
a150 5
     * [90]12.1 - Networking
     * [91]12.2 - Disk I/O
     * [92]12.3 - Tuning kmem
     * [93]12.4 - Hardware Choices
     * [94]12.5 - Why aren't we using async mounts?
d152 1
a152 1
  [95]13.0 For Advanced Users
d154 1
a154 1
     * [96]13.1 - Using OpenBSD's new PCI-IDE code
d157 2
a158 2
   [97][back] [98]www@@openbsd.org
   $OpenBSD: obsd-faq.txt,v 1.10 1999/08/10 19:02:58 ericj Exp $
d169 1
a169 1
   8. mailto:chris@@dqc.org
d229 33
a261 31
  68. http://openbsd.org/faq/faq9.html
  69. http://openbsd.org/faq/faq9.html#9.1
  70. http://openbsd.org/faq/faq9.html#9.2
  71. http://openbsd.org/faq/faq9.html#9.3
  72. http://openbsd.org/faq/faq10.html
  73. http://openbsd.org/faq/faq10.html#10.1
  74. http://openbsd.org/faq/faq10.html#10.2
  75. http://openbsd.org/faq/faq10.html#10.3
  76. http://openbsd.org/faq/faq10.html#10.4
  77. http://openbsd.org/faq/faq10.html#10.5
  78. http://openbsd.org/faq/faq10.html#10.6
  79. http://openbsd.org/faq/faq10.html#10.7
  80. http://openbsd.org/faq/faq10.html#10.8
  81. http://openbsd.org/faq/faq10.html#10.9
  82. http://openbsd.org/faq/faq10.html#10.10
  83. http://openbsd.org/faq/faq10.html#10.11
  84. http://openbsd.org/faq/faq10.html#10.12
  85. http://openbsd.org/faq/faq11-2.4.html
  86. http://openbsd.org/faq/faq11-2.4.html#11.1
  87. http://openbsd.org/faq/faq11-2.4.html#11.2
  88. http://openbsd.org/faq/log24.txt
  89. http://openbsd.org/faq/faq12.html
  90. http://openbsd.org/faq/faq12.html#12.1
  91. http://openbsd.org/faq/faq12.html#12.2
  92. http://openbsd.org/faq/faq12.html#12.3
  93. http://openbsd.org/faq/faq12.html#12.4
  94. http://openbsd.org/faq/faq12.html#12.5
  95. http://openbsd.org/faq/faq13.html
  96. http://openbsd.org/faq/faq13.html#13.1
  97. http://openbsd.org/index.html
  98. mailto:www@@openbsd.org
d306 4
d325 1
a325 1
   [17]http://www.openbsd.org/policy.html.
d368 1
a368 1
   [18]http://www.openbsd.org/donations.html
d374 1
a374 1
   [19]donations@@openbsd.org.
d386 1
a386 1
       Send e-mail to [20]donations@@openbsd.org to find out how to
d392 1
a392 1
       inquire as to current need. Write to [21]donations@@openbsd.org to
d399 1
a399 1
       [22]faq@@openbsd.org). Form a local user group and get your friends
d416 1
a416 1
   [23][To Section 2.0 - Other OpenBSD information resources]
d419 2
a420 2
   [24][back] [25]www@@openbsd.org
   $OpenBSD: obsd-faq.txt,v 1.10 1999/08/10 19:02:58 ericj Exp $
d440 3
a442 3
  17. http://openbsd.org/policy.html
  18. http://openbsd.org/donations.html
  19. mailto:donations@@openbsd.org
d445 5
a449 4
  22. mailto:faq@@openbsd.org
  23. http://openbsd.org/faq/faq2.html
  24. http://openbsd.org/faq/index.html
  25. mailto:www@@openbsd.org
d733 1
a733 1
   $OpenBSD: obsd-faq.txt,v 1.10 1999/08/10 19:02:58 ericj Exp $
d858 1
a858 1
   $OpenBSD: obsd-faq.txt,v 1.10 1999/08/10 19:02:58 ericj Exp $
d889 57
a945 19
   i386, sparc or alpha platforms, you can boot directly off the CD. If
   not, you will have to create a bootdisk. You can get the boot disk
   from ftp://ftp.openbsd.org/pub/OpenBSD/2.5/$ARCH/floppy25.fs

   To create this boot disk, use either the unix tool [5]dd(1) or from
   MS-DOS/Windows, use rawrite from the tools directory on the CD.
   Rawrite doesn't work if you are an NT user, so you can also use
   fdimage or ntrw.exe which are both also in the tools directory.

   To use dd, do the following:
# dd if=floppy25.fs of=/dev/fd0c bs=126b

   fd0c is usually your first floppy disk.

   After that is completed, boot from your media of choice, (cdrom or
   bootdisk) and answer the questions accordingly. Here is an example
   installation.

   [6]Example Install
d966 1
a966 1
   Consult the [7]install text for help.
d978 1
a978 1
   Consult the [8]install text for help.
d999 1
d1003 1
a1003 1
   Be sure to check the [9]disklabel(8) man page!
d1132 1
a1132 1
   To see an example install involving disklabel check [10]log25.txt
d1136 1
a1136 1
   First be sure to check the fdisk main page. [11]fdisk(8)
d1226 1
a1226 1
   [12]fdisk(8) (i386 only) and [13]disklabel(8) to set up your disk in
d1280 1
a1280 1
   the filesystem on that disk using [14]newfs(8).
d1310 1
a1310 1
   With OpenBSD 2.5 came the introduction of [15]swapctl(8), which made
d1361 1
a1361 1
   as possible (kernel coredumps, tracebacks, etc) to [16]Costa. Do not
d1400 1
a1400 1
   use [17]installboot(8). For example, the most common usage is:
d1422 1
a1422 1
   [18]http://www.prz.tu-berlin.de/~wolf/os-bs.html
d1434 1
a1434 1
   For further instructions read [19]INSTALL.linux
d1446 1
a1446 1
   Also check with [20]section 4.15
d1490 1
a1490 1
   at the [21]NTLDR Hacking Guide.
d1496 1
a1496 1
   Some bootloaders of choice are [22]osbs20b8.zip or [23]The Ranish
d1501 1
a1501 1
   Please refer to [24]INSTALL.linux, which gives indepth instructions on
d1520 1
a1520 1
   Also check with [25]section 4.12
d1522 5
a1526 6
   (and make sure you send email from an account that is able to also
   receive email so developers can contact you back if they have
   something they want you to test or change in order to get your setup
   working. It's not important at all to send the email from the same
   machine that is running OpenBSD, so if that machine is unable to
   receive email, just
a1528 1

d1532 2
d1535 5
a1539 2
   [26][Back to Main Index] [27][To Section 3.0 - Obtaining OpenBSD]
   [28][To Section 5.0 - Kernel configuration and Disk Setup]
d1542 2
a1543 2
   [29][back] [30]www@@openbsd.org
   $OpenBSD: obsd-faq.txt,v 1.10 1999/08/10 19:02:58 ericj Exp $
d1551 1
a1551 1
   5. http://www.openbsd.org/cgi-bin/man.cgi?query=dd&apropos=0&sektion=1&format=html
d1555 3
a1557 3
   9. http://www.openbsd.org/cgi-bin/man.cgi?query=disklabel&sektion=8&format=html
  10. http://openbsd.org/faq/log25.txt
  11. http://www.openbsd.org/cgi-bin/man.cgi?query=fdisk&apropos=0&sektion=8&format=html
d1559 19
a1577 18
  13. http://www.openbsd.org/cgi-bin/man.cgi?query=disklabel&apropos=0&sektion=8&format=html
  14. http://www.openbsd.org/cgi-bin/man.cgi?query=newfs&apropos=0&sektion=8&format=html
  15. http://www.openbsd.org/cgi-bin/man.cgi?query=swapctl&sektion=8&format=html
  16. mailto:csapuntz@@openbsd.org
  17. http://www.openbsd.org/cgi-bin/man.cgi?query=installboot&sektion=8&format=html
  18. http://www.prz.tu-berlin.de/~wolf/os-bs.html
  19. http://openbsd.org/faq/INSTALL.linux
  20. http://openbsd.org/faq/faq4.html#4.15
  21. http://www.dorsai.org/~dcl/publications/NTLDR_Hacking/
  22. http://www.freebird.org/sw-map/bootmanager.html
  23. http://www.users.intercom.com/~ranish/part/
  24. http://openbsd.org/faq/INSTALL.linux
  25. http://openbsd.org/faq/faq4.html#4.12
  26. http://openbsd.org/faq/index.html
  27. http://openbsd.org/faq/faq3.html
  28. http://openbsd.org/faq/faq5.html
  29. http://openbsd.org/faq/index.html
  30. mailto:www@@openbsd.org
d1946 1
a1946 1
   $OpenBSD: obsd-faq.txt,v 1.10 1999/08/10 19:02:58 ericj Exp $
d2500 1
a2500 1
   $OpenBSD: obsd-faq.txt,v 1.10 1999/08/10 19:02:58 ericj Exp $
d2566 1
a2566 1
   $OpenBSD: obsd-faq.txt,v 1.10 1999/08/10 19:02:58 ericj Exp $
d2957 1
a2957 1
   -a : This will allow you to specify an alternate root device after
d2959 1
a2959 1
       -c : This allows you to enter the boot time configuration. Check
d2961 2
a2962 2
       -s : This is the option to boot into single user mode.
       -d : This option is used to dump the kernel into ddb. Keep in mind
d2964 1
a2964 1
       -b : Shortcut for RB_HALT.
d3110 34
a3143 2
   [26][Back to Main Index] [27][To Section 7.0 - Keyboard controls]
   [28][To Section 9.0 - Tips for linux users]
d3146 2
a3147 2
   [29][back] [30]www@@openbsd.org
   $OpenBSD: obsd-faq.txt,v 1.10 1999/08/10 19:02:58 ericj Exp $
d3176 3
a3178 3
  26. http://openbsd.org/faq/index.html
  27. http://openbsd.org/faq/faq7.html
  28. http://openbsd.org/faq/faq9.html
d3180 4
a3183 1
  30. mailto:www@@openbsd.org
d3301 1
a3301 1
   $OpenBSD: obsd-faq.txt,v 1.10 1999/08/10 19:02:58 ericj Exp $
d4025 1
a4025 1
   $OpenBSD: obsd-faq.txt,v 1.10 1999/08/10 19:02:58 ericj Exp $
d4142 1
a4142 1
   $OpenBSD: obsd-faq.txt,v 1.10 1999/08/10 19:02:58 ericj Exp $
d4157 1
a4157 1
$OpenBSD: obsd-faq.txt,v 1.10 1999/08/10 19:02:58 ericj Exp $
d4725 1
a4725 1
   The above example gives you up to 4 ccd devices (virual disks). Now
d4912 2
a4913 2
   seperate partition, used for that data only, mounted async. If you
   don't mind risking to loose all the data in the partition when
d4921 1
a4921 1
   $OpenBSD: obsd-faq.txt,v 1.10 1999/08/10 19:02:58 ericj Exp $
d5673 1
a5673 1
   $OpenBSD: obsd-faq.txt,v 1.10 1999/08/10 19:02:58 ericj Exp $
@


1.10
log
@sync
@
text
@d156 1
a156 1
   $OpenBSD: index.html,v 1.58 1999/08/09 12:47:57 wvdputte Exp $
d160 1
a160 1
   1. http://openbsd.org/faq/faq24.html
d244 3
a246 3
  85. http://openbsd.org/faq/faq24.html
  86. http://openbsd.org/faq/faq24.html#11.1
  87. http://openbsd.org/faq/faq24.html#11.2
d412 1
a412 1
   $OpenBSD: faq1.html,v 1.13 1999/07/01 18:37:42 ericj Exp $
d724 1
a724 1
   $OpenBSD: faq2.html,v 1.17 1999/07/26 15:10:46 ericj Exp $
d849 1
a849 1
   $OpenBSD: faq3.html,v 1.8 1999/07/10 15:46:32 wvdputte Exp $
d1492 1
a1492 1
   $OpenBSD: faq4.html,v 1.47 1999/08/09 12:47:57 wvdputte Exp $
d1894 1
a1894 1
   $OpenBSD: faq5.html,v 1.27 1999/07/26 15:10:46 ericj Exp $
d2448 1
a2448 1
   $OpenBSD: faq6.html,v 1.22 1999/07/26 17:38:46 ericj Exp $
d2514 1
a2514 1
   $OpenBSD: faq7.html,v 1.6 1999/07/03 05:51:35 ericj Exp $
d3063 1
a3063 1
   $OpenBSD: faq8.html,v 1.26 1999/07/30 19:52:14 ericj Exp $
d3214 1
a3214 1
   $OpenBSD: faq9.html,v 1.11 1999/07/25 18:48:58 ericj Exp $
d3938 1
a3938 1
   $OpenBSD: faq10.html,v 1.27 1999/08/02 15:31:04 ericj Exp $
d3944 1
a3944 1
   3. http://openbsd.org/faq/faq24.html
d3981 1
a3981 1
  40. http://openbsd.org/faq/faq24.html
d4055 1
a4055 1
   $OpenBSD: faq24.html,v 1.3 1999/06/30 16:01:27 ericj Exp $
d4065 1
a4065 1
   7. http://openbsd.org/faq/faq24.html
d4070 1
a4070 1
$OpenBSD: INSTALL.linux,v 1.2 1999/07/21 05:47:59 ericj Exp $
d4834 1
a4834 1
   $OpenBSD: faq12.html,v 1.15 1999/08/02 15:31:04 ericj Exp $
d4839 1
a4839 1
   2. http://openbsd.org/faq/faq24.html
d4852 1
a4852 1
  15. http://openbsd.org/faq/faq24.html
d5586 1
a5586 1
   $OpenBSD: upgrade-minifaq.html,v 1.7 1999/07/27 05:25:48 kjell Exp $
@


1.9
log
@New INSTALL.linux and update txt faq
@
text
@d72 2
d75 1
a75 1
  [42]5.0 - Kernel Configuration and Setup
d77 28
a104 28
     * [43]5.1 - Why do I need a custom kernel?
     * [44]5.2 - Kernel configuration Options
     * [45]5.3 - Building your own kernel
     * [46]5.4 - Boot-time configuration

  [47]6.0 - Networking setup

     * [48]6.1 - Initial network setup
     * [49]6.2 - IP Filter and Network Address Translation
     * [50]6.3 - IPSec
     * [51]6.4 - Dynamic Host Configuration Protocol
     * [52]6.5 - Point to Point Protocol

  [53]7.0 - Keyboard controls

     * [54]7.1 - How do I remap the keyboard?
     * [55]7.2 - Is there gpm or the like in OpenBSD?

  [56]8.0 - General Questions

     * [57]8.1 - What are these kerberos warnings when I first login?
     * [58]8.2 - How do I change virtual terminals?
     * [59]8.3 - I forgot my root password..... What do I do!
     * [60]8.4 - X craps out when I startup.. what am I doing wrong?
     * [61]8.5 - What is CVS, and how do I use it?
     * [62]8.6 - What is the ports tree?
     * [63]8.7 - What are packages?
     * [64]8.8 - Is there any way to use my floppy drive if it's not
d106 2
a107 2
     * [65]8.9 - OpenBSD Bootloader (i386 specific)
     * [66]8.10 - Using S/Key on your OpenBSD system
d109 1
a109 1
  [67]9.0 - Migrating from Linux
d111 4
a114 2
     * [68]9.1 - Tips for Linux (and other free Unix-like OS) users
     * [69]9.2 - Dual boot of Linux and OpenBSD
d116 1
a116 1
  [70]10.0 - System Administration
d118 1
a118 1
     * [71]10.1 - When I try to su to root it says that I'm in the wrong
d120 2
a121 2
     * [72]10.2 - How do I duplicate a filesystem?
     * [73]10.3 - How do I get daemons like httpd and sendmail to start
d123 1
a123 1
     * [74]10.4 - Why do users get relaying access denied when they are
d125 1
a125 1
     * [75]10.5 - I've set up POP, but I get errors when accessing my
d127 2
a128 2
     * [76]10.6 - Setting up a Secure HTTP Server using SSL(8)
     * [77]10.7 - I made changes to /etc/passwd with vi(1), but the
d130 23
a152 18
     * [78]10.8 - How do I add a user? or delete a user?
     * [79]10.9 - How do I create a ftp-only account?
     * [80]10.10 - Setting up user disk quotas
     * [81]10.11 - Setting up Kerberos Client/Server
     * [82]10.12 - Setting up an Anonymous FTP Server

  [83]11.0 - OpenBSD 2.4 Specific Information

     * [84]11.1 - Why do I get UserDir errors when running httpd(8)?
     * [85]11.2 - Installing at a partition 4GB or higher (i386 specific)
     * [86]Log24.txt - Specific OpenBSD 2.4 Install Example

  [87]12.0 - Performance Tuning

     * [88]12.1 - Networking
     * [89]12.2 - Disk I/O
     * [90]12.3 - Tuning kmem
     * [91]12.4 - Hardware Choices
d155 2
a156 2
   [92][back] [93]www@@openbsd.org
   $OpenBSD: index.html,v 1.52 1999/07/06 16:39:03 ericj Exp $
d201 57
a257 52
  42. http://openbsd.org/faq/faq5.html
  43. http://openbsd.org/faq/faq5.html#5.1
  44. http://openbsd.org/faq/faq5.html#5.2
  45. http://openbsd.org/faq/faq5.html#5.3
  46. http://openbsd.org/faq/faq5.html#5.4
  47. http://openbsd.org/faq/faq6.html
  48. http://openbsd.org/faq/faq6.html#6.1
  49. http://openbsd.org/faq/faq6.html#6.2
  50. http://openbsd.org/faq/faq6.html#6.3
  51. http://openbsd.org/faq/faq6.html#6.4
  52. http://openbsd.org/faq/faq6.html#6.5
  53. http://openbsd.org/faq/faq7.html
  54. http://openbsd.org/faq/faq7.html#7.1
  55. http://openbsd.org/faq/faq7.html#7.2
  56. http://openbsd.org/faq/faq8.html
  57. http://openbsd.org/faq/faq8.html#8.1
  58. http://openbsd.org/faq/faq8.html#8.2
  59. http://openbsd.org/faq/faq8.html#8.3
  60. http://openbsd.org/faq/faq8.html#8.4
  61. http://openbsd.org/faq/faq8.html#8.5
  62. http://openbsd.org/faq/faq8.html#8.6
  63. http://openbsd.org/faq/faq8.html#8.7
  64. http://openbsd.org/faq/faq8.html#8.8
  65. http://openbsd.org/faq/faq8.html#8.9
  66. http://openbsd.org/faq/faq8.html#8.10
  67. http://openbsd.org/faq/faq9.html
  68. http://openbsd.org/faq/faq9.html#9.1
  69. http://openbsd.org/faq/faq9.html#9.2
  70. http://openbsd.org/faq/faq10.html
  71. http://openbsd.org/faq/faq10.html#10.1
  72. http://openbsd.org/faq/faq10.html#10.2
  73. http://openbsd.org/faq/faq10.html#10.3
  74. http://openbsd.org/faq/faq10.html#10.4
  75. http://openbsd.org/faq/faq10.html#10.5
  76. http://openbsd.org/faq/faq10.html#10.6
  77. http://openbsd.org/faq/faq10.html#10.7
  78. http://openbsd.org/faq/faq10.html#10.8
  79. http://openbsd.org/faq/faq10.html#10.9
  80. http://openbsd.org/faq/faq10.html#10.10
  81. http://openbsd.org/faq/faq10.html#10.11
  82. http://openbsd.org/faq/faq10.html#10.12
  83. http://openbsd.org/faq/faq24.html
  84. http://openbsd.org/faq/faq24.html#11.1
  85. http://openbsd.org/faq/faq24.html#11.2
  86. http://openbsd.org/faq/log24.txt
  87. http://openbsd.org/faq/faq12.html
  88. http://openbsd.org/faq/faq12.html#12.1
  89. http://openbsd.org/faq/faq12.html#12.2
  90. http://openbsd.org/faq/faq12.html#12.3
  91. http://openbsd.org/faq/faq12.html#12.4
  92. http://openbsd.org/index.html
  93. mailto:www@@openbsd.org
d453 2
a454 2
   A lot of valuable information can be found here regarding about all
   aspects of the OpenBSD project.
d500 2
a501 2
   [11]http://www.monkey.org/cgi-bin/wilma ,here they have searchable
   archives of the OpenBSD mailing lists.
d504 2
a505 2
   [12]openbsd-mobile@@monkey.org. Which is a discussion of the use of
   OpenBSD in mobile computing.
d534 1
a534 1
     * [24]route(8) - manualy manipulate the routing tables.
d627 3
a633 3

   Before submitting any bug report, please ready
   [32]http://www.openbsd.org/report.html
d724 1
a724 1
   $OpenBSD: faq2.html,v 1.16 1999/07/03 05:51:35 ericj Exp $
d977 1
a977 1
   But they are a necesity for kernel disk access based on geometry. And
d1017 1
a1017 1
   represents the full disk. This is helpful in showing what valuses in
d1021 1
a1021 1
   To be able to edit your label's interactivly you would use the -E
d1295 1
a1295 1
   Over the last few years Krik McKusick has been working on something
d1398 2
d1431 1
a1431 1
   To multiboot OpenBSD and NT, you can use NTloader, the bootloader the
d1442 1
a1442 1
   at the [20]NTLDR Hacking Guide.
d1448 1
a1448 1
   Some bootloaders of choice are [21]osbs20b8.zip or [22]The Ranish
d1453 1
a1453 1
   Please refer to [23]INSTALL.linux, which gives indepth instructions on
d1456 33
a1488 2
   [24][Back to Main Index] [25][To Section 3.0 - Obtaining OpenBSD]
   [26][To Section 5.0 - Kernel configuration and Disk Setup]
d1491 2
a1492 2
   [27][back] [28]www@@openbsd.org
   $OpenBSD: faq4.html,v 1.45 1999/07/13 01:34:00 ericj Exp $
d1515 11
a1525 9
  20. http://www.dorsai.org/~dcl/publications/NTLDR_Hacking/
  21. http://www.freebird.org/sw-map/bootmanager.html
  22. http://www.users.intercom.com/~ranish/part/
  23. http://openbsd.org/faq/INSTALL.linux
  24. http://openbsd.org/faq/index.html
  25. http://openbsd.org/faq/faq3.html
  26. http://openbsd.org/faq/faq5.html
  27. http://openbsd.org/faq/index.html
  28. mailto:www@@openbsd.org
d1550 1
a1550 1
   allow you to customize you kernel. Here we will go over only some of
d1553 1
a1553 1
   example configuration files that are availible for your architecture.
d1598 1
a1598 1
     * COMPAT_HPUX - Compatibility with HP-UX binaries. Only availible on
d1601 1
a1601 1
     * COMPAT_OSF1 - Run Digital Unix binaries. Availible only on Alpha
d1611 1
a1611 1
   options add considerable size to the kernel. There are however
d1613 3
a1615 3
   help your or developers discover the source of your problems much
   quicker. Here is a list of popular debugging options that can be added
   to your kernel.
d1618 1
a1618 1
       availible on all platforms. So be sure to read before adding it.
d1697 1
a1697 1
     * LKM - Support for Loadable Kernel Modules. Not availible on all
d1764 1
a1764 1
       conditionally logged incase IPSEC encounters errors.
d1785 1
a1785 1
       by the normalkey code is emitted if a key is pressed with the
d1800 16
a1815 1
   To compile your kernel from the cdrom do the following:
d1885 3
a1887 2
   booting. After so you should correct your Kernel configuration and
   Compile a new kernel. Refer to [41]Building your own kernel for help.
d1894 1
a1894 1
   $OpenBSD: faq5.html,v 1.25 1999/07/06 20:44:23 ericj Exp $
d1958 2
a1959 2
   Setup section, and/or read a nice intro to TCP/IP. Other recommended
   reading are the [5]ifconfig(8) and [6]netstat(1) man pages.
d1984 1
a1984 1
   on, as lo0 but no other interface have them. That means oviously they
d1990 2
a1991 2
   If xl0 was uninitialized, you can assign it an address creating a
   ascii file /etc/hostname.xl0 having a string like this:
d2008 1
a2008 1
   machine named "wintermute" wich is also in the /etc/hosts, use this
d2056 2
a2057 2
   of cases (both numbers are on the same subnet), only ONE address
   should handle the subnet. If you do such kind of misconfiguration, the
d2114 2
a2115 2
   The IP Filter package was created to handle with two tasks, dealing
   with packet level forwarding permissions [12]ipf(8) and mapping
d2126 2
a2127 3
   If you have IP Filter compiled in to your kernel, but you don't have
   it turned on in your /etc/rc.conf file, you can still activate it
   easily.
d2144 4
a2147 4
   and ipf. We recommend you to choose the one closer to what you want,
   and modify it to fit your needs. You can find other IP Filter
   information at the IP Filter [14]mailing list archive, the [15]IP
   Filter web site, and finally the [16]the IP Filter HOWTO.
d2158 2
a2159 1
   apply the necesary rules to block offending packets. So this is first:
d2164 1
a2164 1
   Now lets block any incoming connection to port 82 tcp (eg. there's an
d2186 1
a2186 1
   useful if you don't have officially asigned addresses for every host
d2224 1
a2224 1
   don't worry, but keep reading.) The way to go arount it is to map TCP
d2268 1
a2268 1
   listening on port 80, and want it to be accesible from the outside
d2306 1
a2306 1
   boot. OpenBSD will gather its' IP address, default gateway, and DNS
d2337 5
a2341 5
   intro based on the information provided in /etc/ppp and the [31]ppp(8)
   manual pages. These are highly suggested reading before attempting to
   setup PPP or even reading this FAQ entry. If you have read these the
   following should look familiar because it is that info with a little
   bit of elaboration.
d2398 1
a2398 1
   This will set the ip address you expect your your side and for the
d2434 15
a2448 1
   <Sta
d2483 5
d2577 1
a2577 1
8.4 - X wont start, I get tons of error messages
d2581 1
a2581 1
   machdep.allowapature. You also need to make sure that both:
d2613 1
a2613 1
   for that release. You can extract it from your CD by doing the
d2616 15
d2646 6
a2651 6
   there is one more step left before you can retrive it. You must decide
   in which method you will retrive it. CVS by default retrieves files
   using rsh(1), but some AnonCVS servers don't allow for this so in most
   cases it's best to use ssh. For those of you behind a firewall there
   are also the options of pserver and some AnonCVS servers run ssh on
   port 2022. Be sure to check [8]http://www.openbsd.org/anoncvs.html for
d2655 3
a2657 3
   to use a server that is also located there. There are many AnonCVS
   servers located throughout the world, so choose one nearest you. I
   will also be using ssh to retrieve the files.
d2712 1
a2712 1
   and install userland programs so you can run them an OpenBSD
d2889 1
a2889 1
   will come in handy. To start of, you should read through the
d2894 2
a2895 2
   automatially try to boot /bsd. If that fails it will try /obsd, and so
   on till it finds a bootable kernel. You can specify this by hand by
d2923 1
a2923 1
   channels. OpenBSD's S/Key implimentation can use a variety of
d2925 1
a2925 1
   availible:
d2933 2
a2934 2
   To start of the file /etc/skeykeys must exist. If this file is not in
   existance, have the super-user create it. This can be done simply by
d2938 1
a2938 1
   Once that file is in existance, you can initalize your S/Key. To do
d2962 1
a2962 1
   99 oshi45820. This gives alot of information to the user. Here is a
d2964 1
a2964 1
     * otp-md5 - This shows which one-way has was used to create your
d3003 1
a3003 1
   otp-md5 96 oshi45820. This is because by now i have used s/key to
d3006 2
a3007 2
   number your using and your key. As you're probobly thinking, how can
   you remember which sequence number your on? Well this is simple, use
d3063 1
a3063 1
   $OpenBSD: faq8.html,v 1.25 1999/07/06 21:53:07 deraadt Exp $
d3176 35
a3210 2
   [14][Back to Main Index] [15][To Section 8.0 - General Questions]
   [16][To Section 10.0 - System Administration]
d3213 2
a3214 2
   [17][back] [18]www@@openbsd.org
   $OpenBSD: faq9.html,v 1.10 1999/07/05 18:11:02 ericj Exp $
d3231 6
a3236 5
  14. http://openbsd.org/faq/index.html
  15. http://openbsd.org/faq/faq8.html
  16. http://openbsd.org/faq/faq10.html
  17. http://openbsd.org/faq/index.html
  18. mailto:www@@openbsd.org
d3280 2
a3281 1
   For example: To have ftpd started on boot change the ftpd entry from:
d3351 1
a3351 1
   restictions, OpenBSD must ship without a fully-functional libssl. But
d3364 1
a3364 1
   to creating an RSA certificate for web servers, not a DSA server
d3369 2
a3370 2
   to /etc/ssl/private/. To use the RSA features, you must have upgraded
   your libssl. Now you can create your key. Using ssleay,
d3427 4
a3430 4
   recommended way to addusers. adduser(8) allows for consistancy checks
   on /etc/passwd, /etc/group, and shell databases. It will create then
   entries for you, and HOME directory, and even send a message to the
   user welcoming them. This can be changed to meet your needs. For
d3501 2
a3502 2
   infoformation. When called with no arguments will give your quota
   statistics. For example:
d3522 1
a3522 1
   and servers much have their system clocks synchronized. If there is
d3550 1
a3550 1
   about are krb.realms and krb.conf. Lets start off with krb.conf.
d3592 16
d3793 1
a3793 1
   setting up the anonymous FTP server, and it's logging, etc.
d3804 4
a3807 5
   be giving to the ftp user. This will allow them not to login, even
   though we will give them an empty password. To do this you can simply
   echo /bin/false >> /etc/shells. Also if you wish for that shell to
   show up during the adduser questions, you need to modify
   /etc/adduser.conf.
d3938 1
a3938 1
   $OpenBSD: faq10.html,v 1.25 1999/07/19 14:39:04 ericj Exp $
d4070 1
a4070 7
$OpenBSD: INSTALL.linux,v 1.1 1998/12/21 21:37:25 ericj Exp $

Warning: this document is currently being reviewed. It's not yet complete,
and probably contains loads of errors. As an example, I can't figure out
why Linux doesn't need mkswap as it shares the exact same blocks with
OpenBSD.

d4074 1
a4074 1
   by Marc Espie --  Marc.Espie@@OpenBSD.org
d4077 5
a4081 2
As of this writing, OpenBSD can read and write Linux' partitions, whereas
Linux cannot access OpenBSD partitions (they differ from NetBSD partitions).
d4086 7
a4092 3
First, make a bootable floppy of Linux.  Then, you  have to find some room
for OpenBSD.  Don't worry about swap space: you can share Linux' swap
partition.
d4098 30
a4127 1
must be taken with a healthy does of scepticism.
d4131 10
a4140 36
OpenBSD does not use the DOS partitions for more than booting.  You just
need a small DOS partition to put your OpenBSD root.  Afterwards, OpenBSD
heeds some other information entirely, called the BSD disklabel.  This
disklabel is another completely distinct description of your hard disk.
It does not even have to be consistent with the usual DOS partitions
information.

Throughout this document, we will distinguish between DOS partitions and
BSD partitions whenever this is necessary.

For consistency, it's better if all parts of the disks that
are actually used by OpenBSD are flagged as occupied, type A6, though it
is not necessary.  The only part of the disk that should appear both as a BSD
partition and as a DOS partition is the root partition: it MUST begin on
the same sector for the boot process to work.

One way to visualize things is to picture OpenBSD embedded inside DOS
partitions: the DOS partitions used by OpenBSD may each contain several
OpenBSD partitions. As long as the DOS partition table has the right
start and length for each partition it will be kept happy.

The OpenBSD disklabel is just another mechanism that yield another
description of the disk. It is vitally important that the BSD root
partition start precisely where the corresponding DOS partition is supposed
to start, and it is better when all BSD partitions stay inside their
DOS partitions boundaries.  Apart from OpenBSD partitions proper, the
BSD disklabel can contain a BSD description of other DOS partitions, but
this is not mandatory. If you don't have any constraints, having a correct
description of all partitions is better, but with bigger disks, keep in mind
that OpenBSD disklabels can't hold more than 16 partitions.

Contrarily to popular belief, OpenBSD does *NOT* need one contiguous chunk
of the disk (a `slice' in FreeBSD lingo).  It is probably the simplest setup,
but other considerations (such as the need to boot several OS, and to have
several small primary partitions that all within the first  1024 BIOS
cylinders) may lead you to use two chunks for OpenBSD.
d4142 4
a4145 1
If you can, it is MUCH better to devote a full disk to OpenBSD: this limits
d4148 31
a4178 1
hard disk I have).
d4184 4
a4187 2
Here is my disk:
--
d4191 14
a4204 16
   Device Boot   Begin    Start      End   Blocks   Id  System
/dev/hda1            1        1      260  1048288+   6  DOS 16-bit >=32M
/dev/hda2          261      261      273    52416   83  Linux native
/dev/hda4          287      287      601  1270080    5  Extended
/dev/hda5          287      287      303    68512   82  Linux swap
/dev/hda6          304      304      456   616864+  83  Linux native
/dev/hda7          457      457      520   258016+  83  Linux native
/dev/hda8          521      521      537    68512+  83  Linux native
/dev/hda9          538      538      601   258016+  83  Linux native

(In case you're wondering, yes this is a big disk. The Linux playground is
large, the OpenBSD area will be huge. As a developer, I usually have loads
of source & binaries lying around... a simple OpenBSD installation can fit
within 300 Mb with room to spare.)
In my setup hda2 is /, hda6 is /usr, hda7 is /usr/local, hda8 is /var, and
hda9 is /home.
d4208 1
a4208 1
--
d4212 6
a4217 9
   Device Boot   Begin    Start      End   Blocks   Id  System
/dev/hda1           63       63  2096639  1048288+   6  DOS 16-bit >=32M
/dev/hda2      2096640  2096640  2201471    52416   83  Linux native
/dev/hda4      2306304  2306304  4846463  1270080    5  Extended
/dev/hda5      2306368  2306368  2443391    68512   82  Linux swap
/dev/hda6      2443455  2443455  3677183   616864+  83  Linux native
/dev/hda7      3677247  3677247  4193279   258016+  83  Linux native
/dev/hda8      4193343  4193343  4330367    68512+  83  Linux native
/dev/hda9      4330431  4330431  4846463   258016+  83  Linux native
a4218 1
Okay, finally switch to expert mode, and note the corresponding data.
d4222 5
a4226 9
 1 00   1   1    0 127  63  259      63 2096577 06
 2 00   0   1  260 127  63  272 2096640  104832 83
 3 00   0   0    0   0   0    0       0       0 00
 4 00   0   1  286 127  63  600 2306304 2540160 05
 5 00   1   2  286 127  63  302      64  137024 82
 6 00   1   1  303 127  63  455      63 1233729 83
 7 00   1   1  456 127  63  519      63  516033 83
 8 00   1   1  520 127  63  536      63  137025 83
 9 00   1   1  537 127  63  600      63  516033 83
d4229 3
a4231 1
display is that it is almost what you're going to see in OpenBSD fdisk !
d4245 2
a4246 12
You will notice that the 3rd primary partition is empty... this is where
I intend to stick my OpenBSD root partition (both DOS and BSD partitions),
and that I have left cylinders 601--992 empty... this is where I intend to
stick the rest of OpenBSD.
After OpenBSD is installed, partition 3 will show up as:
/dev/hda3          274      274      286    52416   a6  Unknown
/dev/hda3      2201472  2201472  2306303    52416   a6  Unknown

(recent Linux fdisk will display a6 as OpenBSD, but they still don't know
how to deal with the disklabel. Important: NEVER use Linux fdisk to fiddle
with OpenBSD disklabels.)

d4254 1
a4254 1
lists. This will show up in OpenBSD' fdisk.
d4265 3
a4267 3
For instance, on a redhat 5.1 system, this happens in /etc/rc.d/rc.sysinit
which loads an /etc/sysconfig/clock that defines a variable called UTC, and
then proceeds calling hwclock.
d4272 3
d4277 11
a4287 8
There is a problem with many Linux rc that do mount all file systems even
in single-user mode.  After you've installed OpenBSD, if your Linux kernel
knows about BSD disklabels, it may insert lots of BSD partitions in its
list. Then, at the next reboot, you're in trouble. The simplest way around
this problem is probably to make sure you can boot from a Linux kernel
that doesn't know about disklabels.   Otherwise, you may wish to check
your inittab and your rc to make deadly sure that single-user boot
will work.
d4292 2
a4293 2
is what I did, as I have a slip connection to the rest of the world, and
the OpenBSD install floppy does not include slip.
d4298 1
a4298 1
So you cp floppy*.fs /dev/fd0, then reboot...
d4300 4
a4303 22
First, the BSD kernel + ram disk loads, then there is a boot prompt, and
five seconds later, the boot proper starts.

After a while, you will see your disk configuration scroll by.  I got:
  wd0 at wdc0 drive 0: <TOSHIBA MK4006MAV>
  wd0: 3909MB, 7944 cyl, 16 head, 63 sec, 512 bytes/sec, 8007552 sec total
  wd0: using 16-sector 16-bit pio transfers, lba addressing

at which point I got somewhat confused, especially as this is a configuration w
ith
more than 1024 cylinders.  In fact, this is the actual disk geometry, when
you inquire about it, but the geometry that the BIOS does see IS the fdisk
geometry, with 993 cylinders.  As the 1024 cylinders is purely a BIOS
limitation, there is no actual trouble.

If you want to be sure, enquire at the boot prompt:
boot>machine diskconfig
before the automatic boot sequence continues.


Then I got into fdisk, and I proceeded to enter my new OpenBSD partition.
This is what the fdisk dump looked after my changes:
d4305 1
d4311 15
a4325 63
 0: 06    0   1   1 -  259 127  63 [        63 -    2096577] DOS > 32MB
 1: 83  260   0   1 -  272 127  63 [   2096640 -     104832] Linux files*
 2: A6  273   0   1 -  285 127  63 [   2201472 -     104832] OpenBSD
 3: 05  286   0   1 -  600 127  63 [   2306304 -    2540160] Extended DOS

Selected extended partition 3
New MBR at offset 2306304.
Offset: 2306304 Signatures: 0xAA55,0x0
         Starting        Ending
 #: id  cyl  hd sec -  cyl  hd sec [     start -       size]
-------------------------------------------------------------------------
 0: 82  286   1   2 -  302 127  63 [   2306368 -     137024] Linux swap
 1: 05  303   0   1 -  455 127  63 [   2443392 -    1233792] Extended DOS
 2: 00    0   0   0 -    0   0   0 [   2306304 -          0] unused
 3: 00    0   0   0 -    0   0   0 [   2306304 -          0] unused

Selected extended partition 1
New MBR at offset 2443392.
Offset: 2443392 Signatures: 0xAA55,0x0
         Starting        Ending
 #: id  cyl  hd sec -  cyl  hd sec [     start -       size]
-------------------------------------------------------------------------
 0: 83  303   1   1 -  455 127  63 [   2443455 -    1233729] Linux files*
 1: 05  456   0   1 -  519 127  63 [   3677184 -     516096] Extended DOS
 2: 00    0   0   0 -    0   0   0 [   2443392 -          0] unused
 3: 00    0   0   0 -    0   0   0 [   2443392 -          0] unused

Selected extended partition 1
New MBR at offset 3677184.
Offset: 3677184 Signatures: 0xAA55,0x0
         Starting        Ending
 #: id  cyl  hd sec -  cyl  hd sec [     start -       size]
-------------------------------------------------------------------------
 0: 83  456   1   1 -  519 127  63 [   3677247 -     516033] Linux files*
 1: 05  520   0   1 -  536 127  63 [   4193280 -     137088] Extended DOS
 2: 00    0   0   0 -    0   0   0 [   3677184 -          0] unused
 3: 00    0   0   0 -    0   0   0 [   3677184 -          0] unused

Selected extended partition 1
New MBR at offset 4193280.
Offset: 4193280 Signatures: 0xAA55,0x0
         Starting        Ending
 #: id  cyl  hd sec -  cyl  hd sec [     start -       size]
-------------------------------------------------------------------------
 0: 83  520   1   1 -  536 127  63 [   4193343 -     137025] Linux files*
 1: 05  537   0   1 -  600 127  63 [   4330368 -     516096] Extended DOS
 2: 00    0   0   0 -    0   0   0 [   4193280 -          0] unused
 3: 00    0   0   0 -    0   0   0 [   4193280 -          0] unused

Selected extended partition 1
New MBR at offset 4330368.
Offset: 4330368 Signatures: 0xAA55,0x0
         Starting        Ending
 #: id  cyl  hd sec -  cyl  hd sec [     start -       size]
-------------------------------------------------------------------------
 0: 83  537   1   1 -  600 127  63 [   4330431 -     516033] Linux files*
 1: 00    0   0   0 -    0   0   0 [         0 -          0] unused
 2: 00    0   0   0 -    0   0   0 [   4330368 -          0] unused
 3: 00    0   0   0 -    0   0   0 [   4330368 -          0] unused

Nothing to it... you just follow the extended partition links using select,
jot down whatever you need, add the OpenBSD partition to look like you want
it to, and save everything.
d4332 6
a4337 4
- initially, you can ONLY edit the disklabel part that matches the OpenBSD
DOS partition (a `slice' in FreeBSD lingo). You have to use b 0 *  before
you can edit the whole disk.
- the real disk geometry becomes relevant. The Berkeley fast file system
d4340 3
d4346 1
d4348 1
a4348 1
# using MBR partition 2: type A6 off 2201472 (0x219780) size 104832 (0x19980)
d4371 1
a4371 1
  b:   137024  2306368      swap                        # (Cyl. 2288 - 2423*)
d4373 14
a4386 15
  d:   409248  4846464    4.2BSD     1024  8192    16   # (Cyl. 4808 - 5213)
  e:   511056  5255712    4.2BSD     1024  8192    16   # (Cyl. 5214 - 5720)
  f:   204624  5766768    4.2BSD     1024  8192    16   # (Cyl. 5721 - 5923)
  g:  1073520  5971392    4.2BSD     1024  8192    16   # (Cyl. 5924 - 6988)
  h:   962640  7044912    4.2BSD     1024  8192    16   # (Cyl. 6989 - 7943)
  i:  2096577       63     MSDOS                        # (Cyl.    0*- 2079*)
  j:   104832  2096640    ext2fs                        # (Cyl. 2080 - 2183)
  l:  1233729  2443455    ext2fs                        # (Cyl. 2424*- 3647*)
  m:   516033  3677247    ext2fs                        # (Cyl. 3648*- 4159*)
  n:   137025  4193343    ext2fs                        # (Cyl. 4160*- 4295*)
  o:   516033  4330431    ext2fs                        # (Cyl. 4296*- 4807*)

Things to check:
- this disklabel is saved in MBR2 (basic DOS partition 2), as expected.
- all the BSD partitions proper are aligned on a cylinder boundary.
a4388 2
Other BSD partitions don't show up in the DOS partition setup, hence they
begin precisely on cylinder 601/4808.
d4391 15
d4409 5
a4413 4
that ALL defined partitions are contiguous. Hence, you may need some fiddling
around and printing to ensure that Linux partitions do show up where they
should.  In my case, disklabel moved the swap and all the ext2fs partitions
slightly, and I add to adjust them manually...
d4417 1
a4417 2
ext2fs partitions are perfectly usable from OpenBSD. My /home partition
is ext2fs, I have been using it for a week now without any trouble.
d4424 1
a4424 1
the Linux system, I just had to edit lilo.conf to add the obsd entry:
d4430 13
a4442 10
timeout=50
image=/boot/myvmlinuz
   label=linux
   root=/dev/hda2
   vga=4
   read-only
image=/boot/vmlinuz-2.0.34-1
   label=redhat
   root=/dev/hda2
   read-only
d4444 6
a4449 5
   label=dos
   table=/dev/hda
other=/dev/hda3
   label=obsd
   table=/dev/hda
d4451 1
a4451 1
rerun lilo, and voila, OpenBSD was able to boot !
d4455 32
a4486 375
As of 2.0.35/2.1.122, Linux does not support OpenBSD partitions. The way
the Linux kernel works is reasonably straightforward (code in
drivers/block/genhd.c): when detecting a BSD partition (type A5),
it checks and parses the first block for a disklabel, and use that
information to instantiate some new partitions,
that will show up in that drive's partition list, exactly like extended
partitions do show up. Unfortunately, that check is hard coded for a type A5
(NetBSD/FreeBSD) partition, and it recognizes 8 partitions disklabels only
anyway.

Just hacking the Linux code to recognize A6 is not quite enough.  You also
need to trim down the resulting list of partitions, as your ext2fs
partitions will now show up twice !
I'm experimenting with the following patch, which should make it to linux-kerne
l
soon:
--------------------------------------------------------------
diff -ur linux.orig/drivers/block/genhd.c linux/drivers/block/genhd.c
--- linux.orig/drivers/block/genhd.c
Mon Aug  4 20:45:35 1997
+++ linux/drivers/block/genhd.c
Thu Sep 24 18:55:31 1998
@@@@ -205,11 +206,46 @@@@
 }

 #ifdef CONFIG_BSD_DISKLABEL
+static void check_and_add_bsd_partition(struct gendisk *hd, struct bsd_partiti
on *bsd_p)
+{
+
struct hd_struct *lin_p;
+

/* check relative position of partitions.  */
+
for (lin_p = hd->part + 1; lin_p - hd->part < current_minor; lin_p++) {
+


/* no relationship -> try again */
+

if (lin_p->start_sect + lin_p->nr_sects <= bsd_p->p_offset
+


|| lin_p->start_sect >= bsd_p->p_offset + bsd_p->p_size)
+


continue;

+


/* equal -> no need to add */
+

if (lin_p->start_sect == bsd_p->p_offset &&
+


lin_p->nr_sects == bsd_p->p_size)
+


return;
+


/* bsd living within dos partition */
+

if (lin_p->start_sect <= bsd_p->p_offset && lin_p->start_sect
+


+ lin_p->nr_sects >= bsd_p->p_offset + bsd_p->p_size) {
+#ifdef DEBUG_BSD_DISKLABEL
+


printk("w: %d %ld+%ld,%d+%d",
+



lin_p - hd->part, lin_p->start_sect, lin_p->nr_sects,
+



bsd_p->p_offset, bsd_p->p_size);
+#endif
+


break;
+

}
+


/* ouch: bsd and linux overlap. Don't even try for that partition */
+#ifdef DEBUG_BSD_DISKLABEL
+

printk("???: %d %ld+%ld,%d+%d",
+


lin_p - hd->part, lin_p->start_sect, lin_p->nr_sects,
+


bsd_p->p_offset, bsd_p->p_size);
+#endif
+

printk("???");
+

return;
+
} /* if the bsd partition is not described by DOS, we end up there */
+
add_partition(hd, current_minor, bsd_p->p_offset, bsd_p->p_size);
+
current_minor++;
+}
 /*
  * Create devices for BSD partitions listed in a disklabel, under a
  * dos-like partition. See extended_partition() for more information.
  */
-static void bsd_disklabel_partition(struct gendisk *hd, kdev_t dev)
+static void bsd_disklabel_partition(struct gendisk *hd, kdev_t dev, int max_pa
rtitions)
 {

struct buffer_head *bh;

struct bsd_disklabel *l;
@@@@ -225,19 +261,15 @@@@


return;

}

-
p = &l->d_partitions[0];
-
while (p - &l->d_partitions[0] <= BSD_MAXPARTITIONS) {
+
if (l->d_npartitions < max_partitions)
+

max_partitions = l->d_npartitions;
+
for (p = l->d_partitions; p - l->d_partitions <  max_partitions; p++) {


if ((current_minor & mask) >= (4 + hd->max_p))



break;
-
-

if (p->p_fstype != BSD_FS_UNUSED) {
-


add_partition(hd, current_minor, p->p_offset, p->p_size);
-


current_minor++;
-

}
-

p++;
+

if (p->p_fstype != BSD_FS_UNUSED)
+


check_and_add_bsd_partition(hd, p);

}

brelse(bh);
-
 }
 #endif

@@@@ -248,6 +280,11 @@@@

struct partition *p;

unsigned char *data;

int mask = (1 << hd->minor_shift) - 1;
+#ifdef CONFIG_BSD_DISKLABEL
+
/* no bsd disklabel as a default */
+
kdev_t bsd_kdev = 0;
+
int bsd_maxpart;
+#endif
 #ifdef CONFIG_BLK_DEV_IDE

int tested_for_xlate = 0;

@@@@ -365,13 +402,29 @@@@




hd->part[minor].nr_sects = 2;


}
 #ifdef CONFIG_BSD_DISKLABEL
+


/* tag first disklabel for late recognition */


if (SYS_IND(p) == BSD_PARTITION) {
-


printk(" <");
-


bsd_disklabel_partition(hd, MKDEV(hd->major, minor));
-


printk(" >");
+


printk("!");
+


if (!bsd_kdev) {
+



bsd_kdev = MKDEV(hd->major, minor);
+



bsd_maxpart = BSD_MAXPARTITIONS;
+


}
+

} else if (SYS_IND(p) == OPENBSD_PARTITION) {
+


printk("!");
+


if (!bsd_kdev) {
+



bsd_kdev = MKDEV(hd->major, minor);
+



bsd_maxpart = OPENBSD_MAXPARTITIONS;
+


}


}
 #endif

}
+#ifdef CONFIG_BSD_DISKLABEL
+
if (bsd_kdev) {
+

printk(" <");
+

bsd_disklabel_partition(hd, bsd_kdev, bsd_maxpart);
+

printk(" >");
+
}
+#endif

/*

 *  Check for old-style Disk Manager partition table

 */
diff -ur linux.orig/include/linux/genhd.h linux/include/linux/genhd.h
--- linux.orig/include/linux/genhd.h
Wed Mar 18 20:25:30 1998
+++ linux/include/linux/genhd.h
Thu Sep 24 18:55:43 1998
@@@@ -69,12 +70,19 @@@@
 #ifdef CONFIG_BSD_DISKLABEL
 /*
  * BSD disklabel support by Yossi Gottlieb <yogo@@math.tau.ac.il>
+ *
+ * updated by Marc Espie <Marc.Espie@@openbsd.org>
  */

+/* check against BSD src/sys/sys/disklabel.h for consistency */
+
 #define BSD_PARTITION

0xa5
/* Partition ID */
+#define OPENBSD_PARTITION
0xa6

 #define BSD_DISKMAGIC
(0x82564557UL)
/* The disk magic number */
 #define BSD_MAXPARTITIONS
8
+#define OPENBSD_MAXPARTITIONS 16
+
 #define BSD_FS_UNUSED

0
/* disklabel unused partition entry ID */
 struct bsd_disklabel {

__u32
d_magic;

/* the magic number */
----------------------------------------------------------------------
It does:
- trigger the recognition of OpenBSD disklabels,
- force bsd partitions to appear at the end of the partition list,
- check the bsd disklabel for redundancy and consistency with the dos
partition table, so that the same partition does not show up twice.

You also need a working ufs, such as
<ftp://sunsite.unc.edu/pub/Linux/ALPHA/ufs/u2fs-0.4.3.tar.gz>
This package yields a new module, plus a small patch to tie the module
with the rest of the Linux kernel. I would recommend checking that patch
manually, as Linux module information tends to vary widely, and it is
pretty trivial to add by hand anyway.
d4491 2
a4492 1
/emul/linux as explained in compat_linux(1).
a4495 4
Don't bother with the ports emul/linux_lib entry: it's only a set of Linux
libraries for people who don't have a Linux system running.

As of this writing, most applications work, apart from sound.
d4497 3
a4499 2
The Linux sound devices use differing ioctl from OpenBSD, hence anything that
needs to change the audio mode won't work, and produce audio garbage at best.
d4518 69
d4632 3
a4634 3
       may need to add it to your kernel configuration. To start setup of
       ccd, you need to add support for it in your kernel. A line such
       as:
d4670 1
a4670 1
       based off of Greg Oster's [8]NetBSD port of the CMU [9]RAIDframe
d4681 3
a4683 3
   [11]raidctl(8) man pages to get the whole scoop, there are too many
   options and possible configurations which are beyond the scope of this
   document.
d4729 1
a4729 1
   entries. The default value for these options is architecture dependant
d4802 28
a4829 1
   [13][Back to Main Index] [14][To Section 11.0 - OpenBSD 2.4 Specific
d4833 2
a4834 2
   [15][back] [16]www@@openbsd.org
   $OpenBSD: faq12.html,v 1.10 1999/06/30 16:01:27 ericj Exp $
d4850 5
a4854 4
  13. http://openbsd.org/faq/index.html
  14. http://openbsd.org/faq/faq24.html
  15. http://openbsd.org/faq/index.html
  16. mailto:www@@openbsd.org
d4863 1
a4863 1
   Last Update - 03 Jun 1999
d4908 1
d4910 1
a4910 1
   [22]4.3: My make build dies with unimplemented syscall errors.
d4933 1
a4933 1
   Between formal releases, a series of snapshot releases are [23]made
d4946 1
a4946 1
   can be [24]fetched and [25]built. This procedure should eliminate most
d4961 1
a4961 1
   Short answer: [26]http://www.openbsd.org/anoncvs.html
d5222 1
a5222 1
   You need to build a new cap_mkdb. See [27]3.1.
d5267 1
a5267 1
   For detailed instructions, see section [28]4.2.
d5272 1
a5272 1
   kernel before attempting a make build. See [29]4.3 for details.
d5291 1
a5291 1
   the egcs-snapshot, available from the [30]ports collection. If this
d5435 1
a5435 1
     make build and proceed. See [31]4.2.2.]
d5470 1
a5470 1
   and similar to the cap_mkdb issue described in [32]3.1.
d5524 1
a5524 1
   the perl changes mentioned in [33]4.1 mean that you can remove the
d5536 16
d5586 1
a5586 1
   $OpenBSD: upgrade-minifaq.html,v 1.6 1999/07/05 20:05:36 kjell Exp $
d5589 1
a5589 1
   [34]kwooding@@codetalker.com
d5614 14
a5627 13
  22. http://openbsd.org/faq/upgrade-minifaq.html#4.3
  23. ftp://ftp.openbsd.org/pub/OpenBSD/snapshots/
  24. http://openbsd.org/faq/upgrade-minifaq.html#1.4
  25. http://openbsd.org/faq/upgrade-minifaq.html#1.5
  26. http://openbsd.org/anoncvs.html
  27. http://openbsd.org/faq/upgrade-minifaq.html#3.1
  28. http://openbsd.org/faq/upgrade-minifaq.html#4.2
  29. http://openbsd.org/faq/upgrade-minifaq.html#4.3
  30. http://openbsd.org/ports.html
  31. http://openbsd.org/faq/upgrade-minifaq.html#4.2.2
  32. http://openbsd.org/faq/upgrade-minifaq.html#3.1
  33. http://openbsd.org/faq/upgrade-minifaq.html#4.1
  34. mailto:kwooding@@codetalker.com
@


1.8
log
@sync
@
text
@d5 1
a5 1
   [2.4 logo]
d17 4
a20 3
   For some a text version of the faq would be much more handy. So please
   check out [3]obsd-faq.txt. Print it out, pass it to your friends. Add
   to it, (but make sure you send diffs to me).
d22 1
a22 1
   Any questions can be directed to: [4]faq@@openbsd.org
d25 3
a27 3
   [5]Eric Jackson
   [6]Wim Vandeputte
   [7]Chris Cappuccio
d30 1
a30 1
  [8]1.0 - Introduction to OpenBSD
d32 35
a66 35
     * [9]1.1 - What is OpenBSD?
     * [10]1.2 - What platforms are supported?
     * [11]1.3 - Is OpenBSD really free?
     * [12]1.4 - Why might I want to use OpenBSD?
     * [13]1.5 - How can I help support OpenBSD?
     * [14]1.6 - Who maintains OpenBSD?

  [15]2.0 - Other OpenBSD information resources

     * [16]2.1 - Web Pages
     * [17]2.2 - Mailing Lists
     * [18]2.3 - Manual Pages
     * [19]2.4 - Reporting Bugs

  [20]3.0 - Obtaining OpenBSD

     * [21]3.1 - Buying an OpenBSD CD
     * [22]3.1.1 - Buying OpenBSD T-Shirts
     * [23]3.2 - Downloading via FTP or AFS
     * [24]3.3 - Obtaining Current Source Code

  [25]4.0 - Installation and Disk Setup

     * [26]4.1 - Installing from CD
     * [27]4.2 - Installing from FTP
     * [28]4.3 - Installing via DHCP
     * [29]4.3.1 - Upgrading from various versions of Openbsd
     * [30]4.4 - What files are needed for Installation?
     * [31]4.5 - Using the OpenBSD disklabel
     * [32]4.6 - Using fdisk
     * [33]4.7 - Adding extra disks in OpenBSD
     * [34]4.8 - How to swap to a file
     * [35]4.9 - Soft-updates
     * [36]4.10 - How much space do I need for an OpenBSD installation?
     * [37]4.11 - When I boot after installation of i386 OpenBSD it says
d68 35
a102 36
     * [38]4.12 - How do I get a dmesg from a boot floppy?
     * [39]4.13 - I changed scsi controllers and now I cannot boot
       OpenBSD. It just says: "reading boot.. Bad magic" ( Installing
       Boot blocks - i386 specific)
     * [40]4.14 - Multibooting OpenBSD

  [41]5.0 - Kernel Configuration and Setup

     * [42]5.1 - Why do I need a custom kernel?
     * [43]5.2 - Kernel configuration Options
     * [44]5.3 - Building your own kernel
     * [45]5.4 - Boot-time configuration

  [46]6.0 - Networking

     * [47]6.1 - Initial network setup
     * [48]6.2 - IPF, NAT
     * [49]6.3 - IPSEC
     * [50]6.4 - DHCP
     * [51]6.5 - PPP

  [52]7.0 - Keyboard controls

     * [53]7.1 - How do I remap the keyboard?
     * [54]7.2 - Is there gpm or the like in OpenBSD?

  [55]8.0 - General Questions

     * [56]8.1 - What are these kerberos warnings when I first login?
     * [57]8.2 - How do I change virtual terminals?
     * [58]8.3 - I forgot my root password..... WHAT DO I DO?!?
     * [59]8.4 - X craps out when I startup.. what am I doing wrong?
     * [60]8.5 - What is CVS, and how do I use it?
     * [61]8.6 - What is the ports tree?
     * [62]8.7 - What are packages?
     * [63]8.8 - Is there any way to use my floppy drive if it's not
d104 2
a105 1
     * [64]8.9 - OpenBSD Bootloader (i386 specific)
d107 1
a107 1
  [65]9.0 - Migrating from Linux
d109 2
a110 2
     * [66]9.1 - Simple tips for ex-linux users
     * [67]9.2 - Dual boot of Linux and OpenBSD
d112 1
a112 1
  [68]10.0 - System Administration
d114 1
a114 1
     * [69]10.1 - When I try to su to root it says that I'm in the wrong
d116 4
a119 4
     * [70]10.2 - How do I duplicate a filesystem?
     * [71]10.3 - How do I get httpd, sendmail, etc to start up with the
       system?
     * [72]10.4 - Why do users get relaying access denied when they are
d121 1
a121 1
     * [73]10.5 - I've set up POP, but I get errors when accessing my
d123 2
a124 2
     * [74]10.6 - Setting up a Secure HTTP Server using SSL(8)
     * [75]10.7 - I made changes to /etc/passwd with vi(1), but the
d126 18
a143 17
     * [76]10.8 - How do I add a user? or delete a user?
     * [77]10.9 - How do I create a ftp-only account?
     * [78]10.10 - Setting up user disk quota's
     * [79]10.11 - Setting up Kerberos Client/Server

  [80]11.0 - OpenBSD 2.4 Specific Information

     * [81]11.1 - Why do I get UserDir errors when running httpd(8)?
     * [82]11.2 - Installing at a partition 4GB or higher (i386 specific)
     * [83]Log24.txt - Specific OpenBSD 2.4 Install Example

  [84]12.0 - Performance Tuning

     * [85]12.1 - Networking
     * [86]12.2 - Disk IO
     * [87]12.3 - Tuning kmem
     * [88]12.4 - Hardware Choices
d146 2
a147 2
   [89][back] [90]www@@openbsd.org
   $OpenBSD: index.html,v 1.46 1999/06/28 17:29:27 ericj Exp $
d153 91
a243 88
   3. http://openbsd.org/faq/obsd-faq.txt
   4. mailto:faq@@openbsd.org
   5. mailto:ericj@@openbsd.org
   6. mailto:wvdputte@@openbsd.org
   7. mailto:chris@@dqc.org
   8. http://openbsd.org/faq/faq1.html
   9. http://openbsd.org/faq/faq1.html#1.1
  10. http://openbsd.org/faq/faq1.html#1.2
  11. http://openbsd.org/faq/faq1.html#1.3
  12. http://openbsd.org/faq/faq1.html#1.4
  13. http://openbsd.org/faq/faq1.html#1.5
  14. http://openbsd.org/faq/faq1.html#1.6
  15. http://openbsd.org/faq/faq2.html
  16. http://openbsd.org/faq/faq2.html#2.1
  17. http://openbsd.org/faq/faq2.html#2.2
  18. http://openbsd.org/faq/faq2.html#2.3
  19. http://openbsd.org/faq/faq2.html#2.4
  20. http://openbsd.org/faq/faq3.html
  21. http://openbsd.org/faq/faq3.html#3.1
  22. http://openbsd.org/faq/faq3.html#3.1.1
  23. http://openbsd.org/faq/faq3.html#3.2
  24. http://openbsd.org/faq/faq3.html#3.3
  25. http://openbsd.org/faq/faq4.html
  26. http://openbsd.org/faq/faq4.html#4.1
  27. http://openbsd.org/faq/faq4.html#4.2
  28. http://openbsd.org/faq/faq4.html#4.3
  29. http://openbsd.org/faq/upgrade-minifaq.html
  30. http://openbsd.org/faq/faq4.html#4.4
  31. http://openbsd.org/faq/faq4.html#4.5
  32. http://openbsd.org/faq/faq4.html#4.6
  33. http://openbsd.org/faq/faq4.html#4.7
  34. http://openbsd.org/faq/faq4.html#4.8
  35. http://openbsd.org/faq/faq4.html#4.9
  36. http://openbsd.org/faq/faq4.html#4.10
  37. http://openbsd.org/faq/faq4.html#4.11
  38. http://openbsd.org/faq/faq4.html#4.12
  39. http://openbsd.org/faq/faq4.html#4.13
  40. http://openbsd.org/faq/faq4.html#4.14
  41. http://openbsd.org/faq/faq5.html
  42. http://openbsd.org/faq/faq5.html#5.1
  43. http://openbsd.org/faq/faq5.html#5.2
  44. http://openbsd.org/faq/faq5.html#5.3
  45. http://openbsd.org/faq/faq5.html#5.4
  46. http://openbsd.org/faq/faq6.html
  47. http://openbsd.org/faq/faq6.html#6.1
  48. http://openbsd.org/faq/faq6.html#6.2
  49. http://openbsd.org/faq/faq6.html#6.3
  50. http://openbsd.org/faq/faq6.html#6.4
  51. http://openbsd.org/faq/faq6.html#6.5
  52. http://openbsd.org/faq/faq7.html
  53. http://openbsd.org/faq/faq7.html#7.1
  54. http://openbsd.org/faq/faq7.html#7.2
  55. http://openbsd.org/faq/faq8.html
  56. http://openbsd.org/faq/faq8.html#8.1
  57. http://openbsd.org/faq/faq8.html#8.2
  58. http://openbsd.org/faq/faq8.html#8.3
  59. http://openbsd.org/faq/faq8.html#8.4
  60. http://openbsd.org/faq/faq8.html#8.5
  61. http://openbsd.org/faq/faq8.html#8.6
  62. http://openbsd.org/faq/faq8.html#8.7
  63. http://openbsd.org/faq/faq8.html#8.8
  64. http://openbsd.org/faq/faq8.html#8.9
  65. http://openbsd.org/faq/faq9.html
  66. http://openbsd.org/faq/faq9.html#9.1
  67. http://openbsd.org/faq/faq9.html#9.2
  68. http://openbsd.org/faq/faq10.html
  69. http://openbsd.org/faq/faq10.html#10.1
  70. http://openbsd.org/faq/faq10.html#10.2
  71. http://openbsd.org/faq/faq10.html#10.3
  72. http://openbsd.org/faq/faq10.html#10.4
  73. http://openbsd.org/faq/faq10.html#10.5
  74. http://openbsd.org/faq/faq10.html#10.6
  75. http://openbsd.org/faq/faq10.html#10.7
  76. http://openbsd.org/faq/faq10.html#10.8
  77. http://openbsd.org/faq/faq10.html#10.9
  78. http://openbsd.org/faq/faq10.html#10.10
  79. http://openbsd.org/faq/faq10.html#10.11
  80. http://openbsd.org/faq/faq24.html
  81. http://openbsd.org/faq/faq24.html#11.1
  82. http://openbsd.org/faq/faq24.html#11.2
  83. http://openbsd.org/faq/log24.txt
  84. http://openbsd.org/faq/faq12.html
  85. http://openbsd.org/faq/faq12.html#12.1
  86. http://openbsd.org/faq/faq12.html#12.2
  87. http://openbsd.org/faq/faq12.html#12.3
  88. http://openbsd.org/faq/faq12.html#12.4
  89. http://openbsd.org/index.html
  90. mailto:www@@openbsd.org
d275 3
a277 2
   bootable means that -for those savvy people who bought the CD- OpenBSD
   can be booted directly from the it.
d280 2
a281 2
     * [13]arc
     * [14]mvme68k
d286 1
a286 1
   [15]http://www.openbsd.org/plat.html
d294 7
a300 4
   OpenBSD has put NO further restrictions other than those implied by
   the original BSD license, which will allow greater applicability.
   Because of this, software which is written under stricter licenses
   cannot be included in the regular distribution of OpenBSD.
d303 1
a303 1
   [16]http://www.openbsd.org/policy.html.
d346 1
a346 1
   [17]http://www.openbsd.org/donations.html
d352 1
a352 1
   [18]donations@@openbsd.org.
d364 1
a364 1
       Send e-mail to [19]donations@@openbsd.org to find out how to
d370 1
a370 1
       inquire as to current need. Write to [20]donations@@openbsd.org to
d377 1
a377 1
       [21]faq@@openbsd.org). Form a local user group and get your friends
d394 1
a394 1
   [22][To Section 2.0 - Other OpenBSD information resources]
d397 2
a398 2
   [23][back] [24]www@@openbsd.org
   $OpenBSD: faq1.html,v 1.11 1999/06/30 16:01:27 ericj Exp $
d403 2
a404 2
   2. http://www.openbsd.org/
   3. http://www.openbsd.org/
d414 6
a419 6
  13. http://openbsd.org/arc.html
  14. http://openbsd.org/mvme68k.html
  15. http://openbsd.org/plat.html
  16. http://openbsd.org/policy.html
  17. http://openbsd.org/donations.html
  18. mailto:donations@@openbsd.org
d422 5
a426 4
  21. mailto:faq@@openbsd.org
  22. http://openbsd.org/faq/faq2.html
  23. http://openbsd.org/faq/index.html
  24. mailto:www@@openbsd.org
d454 1
a454 2

   subscribe announce
d460 1
a460 2

   auth 90855167 subscribe announce you@@example.com
d468 1
a468 2

   unsubscribe announce
a536 1

a548 1

a574 1

d584 27
d619 1
a619 2
   [30]http://www.openbsd.org/report.html

d626 1
a630 1

d661 1
a661 1
wd0 at wdc0 drive 0: &ltTOSHIBA MK2720FC>
d665 1
a665 1
midi0 at sb0: &ltSB MIDI UART>
d701 3
a703 3
       [31]http://cvs.openbsd.org/cgi-bin/wwwgnats.pl.
     * Look in the [32]bugs@@openbsd.org list archives:
       [33]http://www.openbsd.org/mail.html.
d705 2
a706 2
   [34][Back to Main Index] [35][To Section 1.0 - Introduction to
   OpenBSD] [36][To Section 3.0 - Obtaining OpenBSD]
d709 2
a710 2
   [37][back] [38]www@@openbsd.org
   $OpenBSD: faq2.html,v 1.13 1999/06/08 23:37:52 ericj Exp $
d743 11
a753 9
  30. http://openbsd.org/report.html
  31. http://cvs.openbsd.org/cgi-bin/wwwgnats.pl
  32. mailto:bugs@@openbsd.org
  33. http://www.openbsd.org/mail.html
  34. http://openbsd.org/faq/index.html
  35. http://openbsd.org/faq/faq1.html
  36. http://openbsd.org/faq/faq3.html
  37. http://openbsd.org/faq/index.html
  38. mailto:www@@openbsd.org
d835 1
a835 1
   $OpenBSD: faq3.html,v 1.7 1999/06/28 21:47:58 ericj Exp $
d848 1
a848 1
  10. http://openbsd.org/www.openbsd.org/cgi-bin/cvsweb/
d876 1
a876 1
# dd if=floppy25.fs of=/dev/rfd0a bs=32k
d878 1
a878 1
   or to whichever device you want to write the floppy binary to.
d971 2
a972 1
   # disklabel < disk-device name >
d1088 2
a1089 1
   # fdisk fd0
d1168 1
a1168 1
fdisk -i sd2
d1173 1
a1173 1
disklabel -e sd2
d1220 1
a1220 1
   bsd# newfs wd1a
d1250 2
a1251 2
   require a custom built kernel, But that can still be done, this faq
   will show you how to add swap space both ways.
d1265 1
a1265 1
   /dev/vnd0c none sw 0 0
d1330 1
a1330 1
   should make the following seperate partitions: / swap /usr /var /tmp
d1379 4
a1382 1
# cat /kern/msgbuf >mydmesg
d1409 1
a1409 1
cd /usr/mdec; ./installboot /boot biosboot sd0
d1445 1
a1445 1
   $OpenBSD: faq4.html,v 1.41 1999/06/30 16:01:27 ericj Exp $
d1510 1
a1510 1
   the options in /usr/src/sys/arch//conf/GENERIC and
d1663 1
a1663 1
     * BOOT_CONFIG - Addeds support of the -c boot option.
d1712 2
a1713 1
       [37]ipsec(4) for more details
d1716 1
d1726 2
a1727 2
     * PCVT_CTRL_ALT_DEL - If enabled, the key combination < Ctrl> < Alt>
       < Del> invokes a CPU reset. Default is off.
d1735 4
a1738 4
     * PCVT_META_ESC - If enabled, a sequence composed of < esc >,
       followed by the normalkey code is emitted if a key is pressed with
       the < Alt > key modifier. If disabled, then normal key code with
       the value 0x80 added is sent. Defaults to off.
a1751 1

a1758 1

a1769 1

a1773 1

a1792 1

d1829 1
a1829 1
   $OpenBSD: faq5.html,v 1.22 1999/06/30 16:01:27 ericj Exp $
a1896 1

d1927 1
d1929 4
a1932 4
inet mona 255.255.255.0 NONE

   This hostname 'mona' needs to have record in /etc/hosts:

a1944 1

a1949 1

a1959 1

a2009 1

d2013 1
a2033 1

a2036 1

d2180 1
a2180 1
   thse addresses to you, or say you are switching providers. Your new
d2369 1
a2369 15
   <Static Ip Section>

   All you need to do is change the ifaddr parameter like so:

set ifaddr 209.115.93.18 209.115.93.20

   In this example, your IP is 209.115.93.18, and the peer side IP is
   209.115.93.20.

   [32][Back to Main Index] [33][To Section 5.0 - Kernel configuration
   and Disk Setup] [34][To Section 7.0 - Keyboard controls]
     _________________________________________________________________

   [35][back] [36]www@@openbsd.org
   $OpenBSD: faq6.html,v 1.18 1999/06/30 16:01:27 ericj Exp $
a2403 5
  32. http://openbsd.org/faq/index.html
  33. http://openbsd.org/faq/faq5.html
  34. http://openbsd.org/faq/faq7.html
  35. http://openbsd.org/faq/index.html
  36. mailto:www@@openbsd.org
d2417 1
d2419 1
a2419 1
   bsd# kcon -m gb will load the keycap file for Great Britain.
d2430 1
a2430 1
   $OpenBSD: faq7.html,v 1.5 1999/05/21 02:44:00 ericj Exp $
a2452 1

d2486 6
a2491 5
          + bsd# fsck -p / && mount -u /
          + if /usr is on a different partition you need to mount that
            also
    3. type passwd
    4. boot into mulituser mode.. and REMEMBER your password .
d2502 1
a2502 1
   are in you kernel configuration. [BOTH these are in the GENERIC
d2509 2
a2510 2
   OpenBSD 2.4 requires for all X servers that the aperture driver be
   set, because it controls access to the I/O ports on video boards.
d2521 2
a2522 1
   tree.
d2524 1
a2524 2
   CVS makes it extremely simple to download the source via one of the
   many CVS mirrors for the project.
d2526 45
a2570 14
   Here are some simple commands to get you going on CVS.

   For all these commands a CVSROOT variable must be set. You can do this
   by:

   If you use csh or tcsh use:
   bsd# setenv CVSROOT anoncvs@@anoncvs.ca.openbsd.org:/cvs

   or if you use sh or ksh use:
   bsd# export CVSROOT="anoncvs@@anoncvs.ca.openbsd.org:/cvs"

   It is best to try to find a mirror that is closest to you. You can
   obtain a list of CVS mirrors from
   [6]http://www.openbsd.org/anoncvs.html.
d2572 30
a2601 4
   All these commands are run from the /usr directory if you do not have
   the source code already. The source or ports however can be initially
   downloaded in tarred and gzipped form from any of the ftp servers.
   They are set and ready to be used with CVS.
d2603 1
a2603 6
     * bsd# cvs -q get -PAd src [to get source code] or
     * bsd# cvs -q get -PAd ports [to get the ports tree]

   If you already have an existing source or ports tree:
     * bsd# cvs -q up -PAd src
     * bsd# cvs -q up -PAd ports
a2609 16
   There are many different connections you can make to a CVS mirror.
   This is to accompany people from all types of networks, whether you
   are behind a firewall, etc.

   You can make either a ssh, rsh, or pserver connection to the servers.
   Many mirrors also run ssh on port 2022.

   To do this you can use the variable $CVS_RSH. rsh(1) is what CVS uses
   by default, but using the $CVS_RSH environment variable you can have
   CVS use ssh.
   An example:

   #setenv CVS_RSH /usr/local/bin/ssh
   or
   #export CVS_RSH=/usr/local/bin/ssh

d2628 1
a2628 1
   downloaded from any of the [7]OpenBSD ftp servers as
d2632 3
a2634 4
   ports/infrastructure/ all that's left in /usr/src/share/mk for ports
   is just a pointer to this new area. So, once you have the ports
   working with the infrastructure dir, you no longer need to do the step
   from above.
d2721 1
a2721 1
Info:   Tools to convert Xfig's .fig files.
d2732 1
a2732 1
   help please see: [8]http://www.openbsd.org/ports.html
d2753 3
a2756 3
   bsd# pkg_add
   ftp://ftp.openbsd.org/pub/OpenBSD/2.5/packages/${arch}/ispell-3.1.20.t
   gz
d2759 1
a2759 1
   Again, like with ports you can use the pkg_info(1) program to view
d2762 2
a2763 3
   To delete packages you will want to use the pkg_delete(1) command. It
   is used the same way as pkg_add(1).

d2768 2
a2769 3
   Packages can be found on any of the OpenBSD ftp mirror sites.
   [9]Http://www.OpenBSD.org/ftp.html
   or they can be found on your OpenBSD CD's.
d2775 1
a2775 1
   fd* at fdc? drive ? flags 0x20
d2782 2
a2783 2
   When booting your OpenBSD system, many of you have probably noticed
   the boot prompt.
d2791 1
a2791 1
   [10]boot(8) man page. Here we will go over the most common used
d2798 1
a2799 1
   boot> boot wd0a:/bsd
d2805 2
a2806 3
   Here is a quick overview of options to be used with the boot
       parameter.
     * -a : This will allow you to specify an alternate root device after
d2808 4
a2811 4
     * -c : This allows you to enter the boot time configuration. Check
       the [11]Boot Time Config section of the faq.
     * -s : This is the option to boot into single user mode.
     * -d : This option is used to dump the kernel into ddb. Keep in mind
d2813 3
a2815 1
     * -b : Shortcut for RB_HALT.
d2817 85
a2901 2
   These are entered in the format of:
   boot [ image [-abcds]]
d2903 55
a2957 1
   For further reading you can read [12]boot_i386(8) man page
d2959 2
a2960 2
   [13][Back to Main Index] [14][To Section 7.0 - Keyboard controls]
   [15][To Section 9.0 - Tips for linux users]
d2963 2
a2964 2
   [16][back] [17]www@@openbsd.org
   $OpenBSD: faq8.html,v 1.18 1999/06/30 16:01:27 ericj Exp $
d2974 24
a2997 11
   7. http://openbsd.org/ftp.html
   8. http://openbsd.org/ports.html
   9. http://openbsd.org/ftp.html
  10. http://www.openbsd.org/cgi-bin/man.cgi?query=boot&sektion=8&format=html
  11. http://openbsd.org/faq/faq5.html#5.4
  12. http://www.OpenBSD.org/cgi-bin/man.cgi?query=boot_i386&sektion=8&format=html
  13. http://openbsd.org/faq/index.html
  14. http://openbsd.org/faq/faq7.html
  15. http://openbsd.org/faq/faq9.html
  16. http://openbsd.org/faq/index.html
  17. mailto:www@@openbsd.org
d3004 15
a3018 1
     _________________________________________________________________
d3038 4
a3041 3
       of all files in between) at any time! OpenBSD also does
       periodically release snapshots for various architectures and makes
       a stable, official CD release every 6 months.
d3043 1
a3043 1
       contain. (See [4]http://www.openbsd.org/crypto.html) OpenBSD has
d3056 3
a3058 3
          + IP-Masquerading is done through ipnat. ([5]ipnat(1))
          + ipfwadm is done through ipf ([6]ipf(1), [7]ipf(5))
          + You should look at [8]section 6 for detailed configuration
d3069 1
a3069 1
       ([9]passwd(1), [10]passwd(5))
d3075 1
a3075 1
   Read [11]INSTALL.linux
d3077 2
a3078 2
   [12][Back to Main Index] [13][To Section 8.0 - General Questions]
   [14][To Section 10.0 - System Administration]
d3081 2
a3082 2
   [15][back] [16]www@@openbsd.org
   $OpenBSD: faq9.html,v 1.9 1999/06/27 21:32:24 ericj Exp $
d3089 15
a3103 13
   4. http://openbsd.org/crypto.html
   5. http://www.openbsd.org/cgi-bin/man.cgi?query=ipnat&apropos=0&sektion=1&format=html
   6. http://www.openbsd.org/cgi-bin/man.cgi?query=ipf&apropos=0&sektion=1&format=html
   7. http://www.openbsd.org/cgi-bin/man.cgi?query=ipnat&apropos=0&sektion=5&format=html
   8. http://openbsd.org/faq/faq6.html
   9. http://www.openbsd.org/cgi-bin/man.cgi?query=passwd&apropos=0&sektion=1&format=html
  10. http://www.openbsd.org/cgi-bin/man.cgi?query=passwd&apropos=0&sektion=5&format=html
  11. http://openbsd.org/faq/INSTALL.linux
  12. http://openbsd.org/faq/index.html
  13. http://openbsd.org/faq/faq8.html
  14. http://openbsd.org/faq/faq10.html
  15. http://openbsd.org/faq/index.html
  16. mailto:www@@openbsd.org
d3112 1
a3112 1
10.1 - Why does it say that I'm in the wrong group when I su to root?
d3114 10
a3123 8
   With OpenBSD's [4]adduser(8) utility does not allow for you to add any
   users to the "wheel" group. This means that they must be added to the
   "wheel" group by hand. This is done for security reasons, and you
   should be cautious with whom you give access to. On OpenBSD, users who
   are in the "wheel" group are allowed to use the [5]su(1) userland
   program to become root. Users who are not in "wheel" cannot use su(1).
   Here is an example of a /etc/group entry to place the user ericj into
   the "wheel" group.
d3141 1
a3141 1
# cd /SRC; tar cf - | (cd /DST; tar xpf - )
d3147 5
a3151 2
   For example: To have ftpd started on boot change -
ftpd_flags=NO -- > ftpd_flags="-D"
d3167 1
a3167 1
cat /etc/sendmail.cf | grep relay-domains
d3177 3
a3179 2
   Don't forget to:
kill -1 `cat /var/run/sendmail.pid`
d3221 3
a3224 3
   # pkg_add
   ftp://ftp.openbsd.org/pub/OpenBSD/${ver}/packages/${arch}/libssl-1.1.t
   gz
d3237 1
a3237 1
   # ssleay genrsa -out /etc/ssl/private/server.key 1024
d3288 1
a3288 1
10.8 - What is the best way to add users? and delete them?
d3305 1
a3305 1
10.9 - How do i create an ftp-only account?
d3321 2
a3322 2
     * 1 - User Quotas
     * 2 - Group Quotas
a3342 1

d3347 1
a3347 2
   To add limits, edit it to something similar to this:

a3361 1

a3368 1

d3377 2
a3378 1
   them off use quotaoff -a
d3409 1
a3409 1
  HOW TO SETUP THE KERBEROS IV REALM and SERVER
d3444 1
a3444 1
Enter Kerberos master password:
d3465 1
a3465 1
, Create [y] ? y
d3514 33
d3553 2
a3554 1
   In /etc/inetd.conf uncomment:
d3570 1
a3570 1
  HOW TO KERBERIZE YOUR CLIENT WORKSTATION
d3589 1
a3589 1
bash-2.03$ kinit
d3596 1
a3596 1
bash-2.03$ klist
d3605 1
a3605 1
bash-2.03$ telnet avalanche
d3616 2
a3617 3
and

bash-2.03$ rlogin avalanche
d3625 1
a3625 1
bash-2.03$ kdestroy
d3627 1
a3627 1
bash-2.03$ rlogin avalanche
d3639 147
a3785 2
   [33][Back to Main Index] [34][To Section 9.0 - Migrating from Linux]
   [35][To Section 11.0 - OpenBSD 2.4 Specific Information]
d3788 2
a3789 2
   [36][back] [37]www@@openbsd.org
   $OpenBSD: faq10.html,v 1.21 1999/06/30 16:01:27 ericj Exp $
d3796 2
a3797 2
   4. http://www.openbsd.org/cgi-bin/man.cgi?query=adduser&sektion=8&format=html
   5. http://www.openbsd.org/cgi-bin/man.cgi?query=su&apropos=0&sektion=1&format=html
d3825 10
a3834 5
  33. http://openbsd.org/faq/index.html
  34. http://openbsd.org/faq/faq9.html
  35. http://openbsd.org/faq/faq24.html
  36. http://openbsd.org/faq/index.html
  37. mailto:www@@openbsd.org
d5022 1
d5024 1
a5024 1
   [21]4.3: My make build dies with unimplemented syscall errors.
d5047 1
a5047 1
   Between formal releases, a series of snapshot releases are [22]made
d5060 1
a5060 1
   can be [23]fetched and [24]built. This procedure should eliminate most
d5075 1
a5075 1
   Short answer: [25]http://www.openbsd.org/anoncvs.html
d5336 1
a5336 1
   You need to build a new cap_mkdb. See [26]3.1.
d5381 1
a5381 1
   For detailed instructions, see section [27]4.2.
d5386 1
a5386 1
   kernel before attempting a make build. See [28]4.3 for details.
d5391 2
a5392 2
   available. Until then (or for the brave of heart) read the following
   carefully.
d5405 1
a5405 1
   the egcs-snapshot, available from the [29]ports collection. If this
d5414 6
a5419 1
   To bootstrap to the in-tree egcs, read the following carefully.
d5549 1
a5549 1
     make build and proceed. See [30]4.2.2.]
d5584 1
a5584 1
   and similar to the cap_mkdb issue described in [31]3.1.
d5638 1
a5638 1
   the perl changes mentioned in [32]4.1 mean that you can remove the
d5642 8
d5684 1
a5684 1
   $OpenBSD: upgrade-minifaq.html,v 1.5 1999/06/30 16:01:28 ericj Exp $
d5687 1
a5687 1
   [33]kwooding@@codetalker.com
d5711 14
a5724 13
  21. http://openbsd.org/faq/upgrade-minifaq.html#4.3
  22. ftp://ftp.openbsd.org/pub/OpenBSD/snapshots/
  23. http://openbsd.org/faq/upgrade-minifaq.html#1.4
  24. http://openbsd.org/faq/upgrade-minifaq.html#1.5
  25. http://openbsd.org/anoncvs.html
  26. http://openbsd.org/faq/upgrade-minifaq.html#3.1
  27. http://openbsd.org/faq/upgrade-minifaq.html#4.2
  28. http://openbsd.org/faq/upgrade-minifaq.html#4.3
  29. http://openbsd.org/ports.html
  30. http://openbsd.org/faq/upgrade-minifaq.html#4.2.2
  31. http://openbsd.org/faq/upgrade-minifaq.html#3.1
  32. http://openbsd.org/faq/upgrade-minifaq.html#4.1
  33. mailto:kwooding@@codetalker.com
@


1.7
log
@sync
@
text
@a25 15156
        _________________________________________________________________

  [7]1.0 - Introduction to OpenBSD

     * [8]1.1 - What is OpenBSD?
     * [9]1.2 - What platforms are supported?
     * [10]1.3 - Is OpenBSD really free?
     * [11]1.4 - Why might I want to use OpenBSD?
     * [12]1.5 - How can I help support OpenBSD?
     * [13]1.6 - Who maintains OpenBSD?

  [14]2.0 - Other OpenBSD information resources

     * [15]2.1 - Web Pages
     * [16]2.2 - Mailing Lists
     * [17]2.3 - Manual Pages
     * [18]2.4 - Reporting Bugs

  [19]3.0 - Obtaining OpenBSD

     * [20]3.1 - Buying an OpenBSD CD
     * [21]3.1.1 - Buying OpenBSD T-Shirts
     * [22]3.2 - Downloading via FTP or AFS
     * [23]3.3 - Obtaining Current Source Code

  [24]4.0 - Installation and Disk Setup

     * [25]4.1 - Installing from CD
     * [26]4.2 - Installing from FTP
     * [27]4.3 - Installing via DHCP
     * [28]4.3.1 - Upgrading from various versions of Openbsd
     * [29]4.4 - What files are needed for Installation?
     * [30]4.5 - Using the OpenBSD disklabel
     * [31]4.6 - Using fdisk
     * [32]4.7 - Adding extra disks in OpenBSD
     * [33]4.8 - How to swap to a file
     * [34]4.9 - Soft-updates
     * [35]4.10 - How much space do I need for an OpenBSD installation?
     * [36]4.11 - When I boot after installation of i386 OpenBSD it says
       "partition 3 id 0".
     * [37]4.12 - How do I get a dmesg from a boot floppy?
     * [38]4.13 - I changed scsi controllers and now I cannot boot
       OpenBSD. It just says: "reading boot.. Bad magic" ( Installing
       Boot blocks - i386 specific)
     * [39]4.14 - Multibooting OpenBSD

  [40]5.0 - Kernel Configuration and Setup

     * [41]5.1 - Why do I need a custom kernel?
     * [42]5.2 - Kernel configuration Options
     * [43]5.3 - Building your own kernel
     * [44]5.4 - Boot-time configuration

  [45]6.0 - Networking

     * [46]6.1 - Initial network setup
     * [47]6.2 - IPF, NAT
     * [48]6.3 - IPSEC
     * [49]6.4 - DHCP
     * [50]6.5 - PPP

  [51]7.0 - Keyboard controls

     * [52]7.1 - How do I remap the keyboard?
     * [53]7.2 - Is there gpm or the like in OpenBSD?

  [54]8.0 - General Questions

     * [55]8.1 - What are these kerberos warnings when I first login?
     * [56]8.2 - How do I change virtual terminals?
     * [57]8.3 - I forgot my root password..... WHAT DO I DO?!?
     * [58]8.4 - X craps out when I startup.. what am I doing wrong?
     * [59]8.5 - What is CVS, and how do I use it?
     * [60]8.6 - What is the ports tree?
     * [61]8.7 - What are packages?
     * [62]8.8 - Is there any way to use my floppy drive if it's not
       attached during boot?
     * [63]8.9 - OpenBSD Bootloader (i386 specific)

  [64]9.0 - Migrating from Linux

     * [65]9.1 - Simple tips for ex-linux users
     * [66]9.2 - Dual boot of Linux and OpenBSD

  [67]10.0 - System Administration

     * [68]10.1 - When I try to su to root it says that I'm in the wrong
       group
     * [69]10.2 - How do I duplicate a filesystem?
     * [70]10.3 - How do I get httpd, sendmail, etc to start up with the
       system?
     * [71]10.4 - Why do users get relaying access denied when they are
       remotely sending mail through my OpenBSD system?
     * [72]10.5 - I've set up POP, but I get errors when accessing my
       mail thru POP. What can i do?
     * [73]10.6 - Setting up a Secure HTTP Server using SSL(8)
     * [74]10.7 - I made changes to /etc/passwd with vi(1), but the
       changes didn't seem to take place. Why?
     * [75]10.8 - How do I add a user? or delete a user?
     * [76]10.9 - How do I create a ftp-only account?
     * [77]10.10 - Setting up user disk quota's

  [78]11.0 - OpenBSD 2.4 Specific Information

     * [79]11.1 - Why do I get UserDir errors when running httpd(8)?
     * [80]11.2 - Installing at a partition 4GB or higher (i386 specific)
     * [81]Log24.txt - Specific OpenBSD 2.4 Install Example

  [82]12.0 - Performance Tuning

     * [83]12.1 - Networking
     * [84]12.2 - Disk IO
     _________________________________________________________________

   [85][back] [86]www@@openbsd.org
   $OpenBSD: obsd-faq.txt,v 1.6 1999/06/25 18:53:51 ericj Exp $

References

   1. http://www.openbsd.org/faq/faq24.html
   2. http://www.openbsd.org/errata.html
   3. http://www.openbsd.org/faq/obsd-faq.txt
   4. mailto:faq@@openbsd.org
   5. mailto:ericj@@openbsd.org
   6. mailto:wvdputte@@openbsd.org
   7. http://www.openbsd.org/faq/faq1.html
   8. http://www.openbsd.org/faq/faq1.html#1.1
   9. http://www.openbsd.org/faq/faq1.html#1.2
  10. http://www.openbsd.org/faq/faq1.html#1.3
  11. http://www.openbsd.org/faq/faq1.html#1.4
  12. http://www.openbsd.org/faq/faq1.html#1.5
  13. http://www.openbsd.org/faq/faq1.html#1.6
  14. http://www.openbsd.org/faq/faq2.html
  15. http://www.openbsd.org/faq/faq2.html#2.1
  16. http://www.openbsd.org/faq/faq2.html#2.2
  17. http://www.openbsd.org/faq/faq2.html#2.3
  18. http://www.openbsd.org/faq/faq2.html#2.4
  19. http://www.openbsd.org/faq/faq3.html
  20. http://www.openbsd.org/faq/faq3.html#3.1
  21. http://www.openbsd.org/faq/faq3.html#3.1.1
  22. http://www.openbsd.org/faq/faq3.html#3.2
  23. http://www.openbsd.org/faq/faq3.html#3.3
  24. http://www.openbsd.org/faq/faq4.html
  25. http://www.openbsd.org/faq/faq4.html#4.1
  26. http://www.openbsd.org/faq/faq4.html#4.2
  27. http://www.openbsd.org/faq/faq4.html#4.3
  28. http://www.openbsd.org/faq/upgrade-minifaq.html
  29. http://www.openbsd.org/faq/faq4.html#4.4
  30. http://www.openbsd.org/faq/faq4.html#4.5
  31. http://www.openbsd.org/faq/faq4.html#4.6
  32. http://www.openbsd.org/faq/faq4.html#4.7
  33. http://www.openbsd.org/faq/faq4.html#4.8
  34. http://www.openbsd.org/faq/faq4.html#4.9
  35. http://www.openbsd.org/faq/faq4.html#4.10
  36. http://www.openbsd.org/faq/faq4.html#4.11
  37. http://www.openbsd.org/faq/faq4.html#4.12
  38. http://www.openbsd.org/faq/faq4.html#4.13
  39. http://www.openbsd.org/faq/faq4.html#4.14
  40. http://www.openbsd.org/faq/faq5.html
  41. http://www.openbsd.org/faq/faq5.html#5.1
  42. http://www.openbsd.org/faq/faq5.html#5.2
  43. http://www.openbsd.org/faq/faq5.html#5.3
  44. http://www.openbsd.org/faq/faq5.html#5.4
  45. http://www.openbsd.org/faq/faq6.html
  46. http://www.openbsd.org/faq/faq6.html#6.1
  47. http://www.openbsd.org/faq/faq6.html#6.2
  48. http://www.openbsd.org/faq/faq6.html#6.3
  49. http://www.openbsd.org/faq/faq6.html#6.4
  50. http://www.openbsd.org/faq/faq6.html#6.5
  51. http://www.openbsd.org/faq/faq7.html
  52. http://www.openbsd.org/faq/faq7.html#7.1
  53. http://www.openbsd.org/faq/faq7.html#7.2
  54. http://www.openbsd.org/faq/faq8.html
  55. http://www.openbsd.org/faq/faq8.html#8.1
  56. http://www.openbsd.org/faq/faq8.html#8.2
  57. http://www.openbsd.org/faq/faq8.html#8.3
  58. http://www.openbsd.org/faq/faq8.html#8.4
  59. http://www.openbsd.org/faq/faq8.html#8.5
  60. http://www.openbsd.org/faq/faq8.html#8.6
  61. http://www.openbsd.org/faq/faq8.html#8.7
  62. http://www.openbsd.org/faq/faq8.html#8.8
  63. http://www.openbsd.org/faq/faq8.html#8.9
  64. http://www.openbsd.org/faq/faq9.html
  65. http://www.openbsd.org/faq/faq9.html#9.1
  66. http://www.openbsd.org/faq/faq9.html#9.2
  67. http://www.openbsd.org/faq/faq10.html
  68. http://www.openbsd.org/faq/faq10.html#10.1
  69. http://www.openbsd.org/faq/faq10.html#10.2
  70. http://www.openbsd.org/faq/faq10.html#10.3
  71. http://www.openbsd.org/faq/faq10.html#10.4
  72. http://www.openbsd.org/faq/faq10.html#10.5
  73. http://www.openbsd.org/faq/faq10.html#10.6
  74. http://www.openbsd.org/faq/faq10.html#10.7
  75. http://www.openbsd.org/faq/faq10.html#10.8
  76. http://www.openbsd.org/faq/faq10.html#10.9
  77. http://www.openbsd.org/faq/faq10.html#10.10
  78. http://www.openbsd.org/faq/faq24.html
  79. http://www.openbsd.org/faq/faq24.html#11.1
  80. http://www.openbsd.org/faq/faq24.html#11.2
  81. http://www.openbsd.org/faq/log24.txt
  82. http://www.openbsd.org/faq/faq12.html
  83. http://www.openbsd.org/faq/faq12.html#12.1
  84. http://www.openbsd.org/faq/faq12.html#12.2
  85. http://www.openbsd.org/index.html
  86. mailto:www@@openbsd.org


   [1][Back to Main Index]

                         1.0 - Introduction to OpenBSD
     _________________________________________________________________

1.1 - What is OpenBSD?

   The [2]OpenBSD project produces a freely available, multi-platform
   4.4BSD-based UNIX-like operating system. Our efforts place emphasis on
   portability, standardization, correctness, and security. [3]OpenBSD
   supports binary emulation of most binaries from SVR4 (Solaris),
   FreeBSD, Linux, BSDI, SunOS, and HPUX.

1.2 - On what systems does OpenBSD run?

   OpenBSD 2.5 will install and run on the following platforms:
     * [4]i386 - bootable
     * [5]sparc - bootable
     * [6]alpha - bootable
     * [7]hp300
     * [8]amiga
     * [9]mac68k
     * [10]powerpc
     * [11]pmax

     * the pmax port is not included on the 2.5 cd. But can be downloaded
       from any of the OpenBSD ftp sites

   * note * - bootable means that for those smart people who bought the
   cd, that it OpenBSD can be booted directly from the CD.

   Previous releases of OpenBSD also had ports for:
     * [12]arc
     * [13]mvme68k

   These were removed from the 2.4 release, but were included in 2.3 if
   you are interested. You can see updated information about specific
   platforms at [14]http://www.openbsd.org/plat.html

1.3 - Is OpenBSD really free?

   OpenBSD is all free. The binaries are free. The source is free. All
   parts of OpenBSD have reasonable copyright terms permitting free
   redistribution. This includes the ability to REUSE most parts of the
   OpenBSD source tree, either for personal or commercial purposes.
   OpenBSD has put NO further restrictions other than those implied by
   the original BSD license, which will allow greater applicability.
   Because of this, software which is written under stricter licenses
   cannot be included in the regular distribution of OpenBSD.

   For futher reading on other popular licenses read:
   [15]http://www.openbsd.org/policy.html.

   The maintainers of OpenBSD support the project largely from their own
   pockets. This includes the time spent programming for the project,
   equipment used to support the many ports, the network resources used
   to distribute OpenBSD to you, and the time spent answering questions
   and investigating users' bug reports. The OpenBSD developers are not
   independently wealthy and even small contributions of time, equipment,
   and resources make a big difference.

1.4 - Why might I want to use OpenBSD?

   New users frequently want to know whether OpenBSD is superior to some
   other free UNIX-like operating system. That question is largely
   un-answerable and is the subject of countless (and useless) religious
   debates. Do not, under any circumstances, ask such a question on an
   OpenBSD mailing list.

   Below are some reasons why we think OpenBSD is a useful operating
   system. Whether OpenBSD is right for you is a question that only you
   can answer.

     * OpenBSD runs on many different hardware platforms.
     * OpenBSD is thought of by many security professionals to be the
       most secure UNIX-like operating system as the result of a
       10-member 1.5-year long comprehensive source code security audit.
     * OpenBSD is a full-featured UNIX-like operating system available in
       source form at no charge.
     * OpenBSD integrates cutting-edge security technology suitable for
       building firewalls and private network services in a distributed
       environment.
     * OpenBSD benefits from strong on-going development in many areas,
       offering opportunities to work with emerging technologies with an
       international community of programmers and end-users.
     * OpenBSD offers opportunities for ordinary people to participate in
       the development and testing of the product.

1.5 - How can I help support OpenBSD?

   We are greatly indebted to the people and organizations that have
   contributed to the OpenBSD project. They are acknowledged by name
   here:

   [16]http://www.openbsd.org/donations.html

   OpenBSD has a constant need for several types of support from the user
   community. If you find OpenBSD useful, you are strongly encouraged to
   find a way to contribute. If none of the suggestions below are right
   for you, feel free to propose an alternative by sending e-mail to
   [17]donations@@openbsd.org.

     * Buy an OpenBSD CD. It includes the current full release of
       OpenBSD, and is bootable on many platforms. It also generates
       revenue to support the OpenBSD project, and reduces the strain on
       network resources used to deliver the distribution via the
       Internet. This inexpensive two-CD set includes full source.
       Remember, your friends need their own copy!
     * Donate money. The project has a constant need for cash to pay for
       equipment, network connectivity, and expenses relating to CD
       publishing. Manufacturing CDs requires an up-front out-of-pocket
       investment for the OpenBSD developers, without guaranteed return.
       Send e-mail to [18]donations@@openbsd.org to find out how to
       contribute. Even small donations make a profound difference.
     * Donate equipment and parts. The project has a constant need for
       general and specific hardware. Items such as IDE and SCSI disks,
       and various types of RAM are always welcome. For other types of
       hardware such as computer systems and motherboards, you should
       inquire as to current need. Write to [19]donations@@openbsd.org to
       arrange for shipment.
     * Donate your time and skills. Programmers who enjoy writing
       operating systems are naturally always welcome, but there are
       literally dozens of other ways that people can be useful. Follow
       mailing lists and help answer new-user questions.
     * Help maintain documentation by submitting new FAQ material (to
       [20]faq@@openbsd.org). Form a local user group and get your friends
       hooked on OpenBSD. Make a case to your employer for using OpenBSD
       at work. If you're a student, talk to your professors about using
       OpenBSD as a learning tool for Computer Science or Engineering
       courses. It's also worth mentioning one of the most important ways
       you should not try to "help" The OpenBSD project: do not waste
       your time engaging in operating system flame wars on Usenet
       newsgroups. It does not help the project to find new users and can
       cause substantial harm to important relationships that developers
       have with other developers.

1.6 - Who maintains OpenBSD?

   OpenBSD is maintained by a development team spread across many
   different countries. The project is coordinated by Theo de Raadt,
   located in Canada.

   [21][To Section 2.0 - Other OpenBSD information resources]
     _________________________________________________________________

   [22][back] [23]www@@openbsd.org
   $OpenBSD: obsd-faq.txt,v 1.6 1999/06/25 18:53:51 ericj Exp $

References

   1. http://www.openbsd.org/faq/index.html
   2. http://www.openbsd.org/
   3. http://www.openbsd.org/
   4. http://www.openbsd.org/i386.html
   5. http://www.openbsd.org/sparc.html
   6. http://www.openbsd.org/alpha.html
   7. http://www.openbsd.org/hp300.html
   8. http://www.openbsd.org/amiga.html
   9. http://www.openbsd.org/mac68k.html
  10. http://www.openbsd.org/powerpc.html
  11. http://www.openbsd.org/pmax.html
  12. http://www.openbsd.org/arc.html
  13. http://www.openbsd.org/mvme68k.html
  14. http://www.openbsd.org/plat.html
  15. http://www.openbsd.org/policy.html
  16. http://www.openbsd.org/donations.html
  17. mailto:donations@@openbsd.org
  18. mailto:donations@@openbsd.org
  19. mailto:donations@@openbsd.org
  20. mailto:faq@@openbsd.org
  21. http://www.openbsd.org/faq/faq2.html
  22. http://www.openbsd.org/faq/index.html
  23. mailto:www@@openbsd.org


   [1][Back to Main Index] [2][To Section 1.0 - Introduction to OpenBSD]
   [3][To Section 3.0 - Obtaining OpenBSD]

                   2.0 - Other OpenBSD information resources

2.1 - Web Pages of Interest

   The official website for the OpenBSD project is located at:
   [4]http://www.OpenBSD.org

   A lot of valuable information can be found here regarding about all
   aspects of the OpenBSD project.

   Additional information for laptop users can be found at:
   [5]http://www.monkey.org/openbsd-mobile/ and
   [6]http://www.cpio.net/openbsd/laptops/

2.2 - Mailing Lists

   The OpenBSD project maintains several popular mailing lists which
   users should subscribe to and follow. To subscribe to a mailing list,
   send an e-mail message to [7]majordomo@@openbsd.org. That address is an
   automated subscription service. In the body of your message, on a
   single line, you should include a subscribe command for the list you
   wish to join. For example:

   subscribe announce

   The list processor will reply to you, asking for confirmation of your
   intent to join the list. The confirmation you send back to the list
   processor will be included in its reply to you. It will look something
   like this:

   auth 90855167 subscribe announce you@@example.com

   Once you have confirmed your intent to join, you will be immediately
   added to the list, and the list processor will notify you that you
   were successfully added.

   To unsubscribe from a list, you will again send an e-mail message to
   [8]majordomo@@openbsd.org. It might look like this:

   unsubscribe announce

   If you have any difficulties with the mailing list system, please
   first read the instructions. They can be obtained by sending an e-mail
   message to [9]majordomo@@openbsd.org with a message body of "help".
   These are the currently-available OpenBSD mailing lists:

     * announce - Important announcements. This is a low-volume list.
     * tech - General technical discussions
     * misc - User questions and answers
     * bugs - Bugs received via sendbug(1) and discussions about them.
     * source-changes - Automated mailing of CVS source tree changes.
     * ports - Automated mailing of CVS source tree changes.
     * advocacy - Discussion of advocating OpenBSD.

   Archives of the OpenBSD mailing lists can be found by visiting the
   mailing lists web page: [10]http://www.openbsd.org/mail.html
   You can also get mail archives from
   [11]http://www.monkey.org/cgi-bin/wilma ,here they have searchable
   archives of the OpenBSD mailing lists.

   Another mailing list that may be of interest is
   [12]openbsd-mobile@@monkey.org. Which is a discussion of the use of
   OpenBSD in mobile computing.

   To subscribe to this list use:

   'echo subscribe | mail "openbsd-mobile-request@@monkey.org"'

   The archives for that can be found at:
   [13]http://www.monkey.org/openbsd-mobile/archive/

2.3 - Manual Pages

   OpenBSD comes with extensive documentation in the form of manual
   pages, as well as longer documents relating to specific applications.
   To access the manual pages and other documentation, be sure that you
   installed the man, misc, and text distributions.

   Here is a list of some of the most useful manual pages for new users:

     * [14]afterboot(8) - things to check after the first complete boot
     * [15]boot(8) - system boot strapping procedures
     * [16]passwd.conf(5) - format of the password configuration file
     * [17]adduser_proc(8) - procedure for adding new users
     * [18]adduser(8) - command for adding new users
     * [19]vipw(8) - edit the pass word file
     * [20]man(1) - display the on-line manual pages
     * [21]sendbug(1) - send a problem report (PR) about OpenBSD to a
       central support site.
     * [22]disklabel(8) - Read and write disk pack label.
     * [23]ifconfig(8) - configure network interface parameters.
     * [24]route(8) - manualy manipulate the routing tables.
     * [25]netstat(1) - show network status.
     * [26]reboot, halt(8) - Stopping and restarting the system.
     * [27]shutdown(8) - close down the system at a given time.
     * [28]boot_config(8) - how to change kernel configuration at boot

   Also, If you are one of the people who didn't install the man*.tar.gz
   package, you can find all the OpenBSD man pages on the web at
   [29]http://www.openbsd.org/cgi-bin/man.cgi.

   In general, if you know the name of a command or a manual page, you
   can read it by executing `man command'. For example: `man vi' to read
   about the vi editor. If you don't know the name of the command, or if
   `man command' doesn't find the manual page, you can search the manual
   page database by executing `apropos something' or `man -k something'
   where something is a likely word that might appear in the title of the
   manual page you're looking for. For example:

bsd# apropos "time zone"
tzfile (5) - time zone information
zdump (8) - time zone dumper
zic (8) - time zone compiler

   The parenthetical numbers indicate the section of the manual in which
   that page can be found. In some cases, you may find manual pages with
   identical names living in separate sections of the manual. For
   example, assume that you want to know the format of the configuration
   files for the cron daemon. Once you know the section of the manual for
   the page you want, you would execute `man n command' where n is the
   manual section number.

bsd# man -k cron
cron (8) - daemon to execute scheduled commands (Vixie Cron)
crontab (1) - maintain crontab files for individual users (V3)
crontab (5) - tables for driving cron
bsd# man 5 crontab

   In addition to the UNIX manual pages, there is a typesettable document
   set (included in the misc distribution). It lives in the
   /usr/share/doc directory. If you also installed the text distribution,
   then you can format each document set with a `make' in the appropriate
   subdirectory. The psd subdirectory is the Programmer's Supplementary
   Documents distribution. The smm subdirectory is the System Manager's
   Manual. The usd subdirectory is the UNIX User's Supplementary
   Documents distribution. You can perform your `make' in the three
   distribution subdirectories, or you can select a specific section of a
   distribution and do a `make' in its subdirectory. Some of the
   subdirectories are empty. By default, formatting the documents will
   result in Postscript output, suitable for printing. The Postscript
   output can be quite large -- you should assume 250-300% increase in
   volume. If you do not have access to a Postscript printer or display,
   you may also format the documents for reading on a terminal display.
   In each Makefile you'll need to add the flag -Tascii to each instance
   of the groff commands (or execute it by hand). Some of the documents
   use the ms formatting macros, and some use the me macros. The Makefile
   in each document subdirectory (eg, /usr/share/doc/usd/04.csh/Makefile)
   will tell you which one to use. For example:

bsd# cd /usr/share/doc/usd/04.csh
bsd# groff -Tascii -ms tabs csh.1 csh.2 csh.3 csh.4 csh.a csh.g > csh.txt
bsd# more csh.txt

   The UNIX manual pages are generally more current and trustworthy than
   the typesettable documents. The typesettable documents sometimes
   explain complicated applications in more detail than the manual pages
   do.

2.4 - Reporting Bugs

   Proper bug reporting is one of the most important responsibilities of
   end users. Very detailed information is required to diagnose most
   serious bugs. Developers frequently get bugs reports via e-mail such
   as these:

   Before submitting any bug report, please ready
   [30]http://www.openbsd.org/report.html

From: joeuser@@example.com
To: bugs@@openbsd.org
Subject: HELP!!!

I have a PC and it won't boot!!!!! It's a 486!!!!!

   Hopefully most people understand why such reports get summarily
   deleted. All bug reports should contain detailed information. If Joe
   User had really wanted his bug investigated, his bug report would have
   looked something like this:

From: smartuser@@example.com
To: bugs@@openbsd.org
Subject: 2.5 panics on an i386

After installing OpenBSD 2.5 from the CD which I purchased via your outstanding
on-line ordering system, I find that the system halts before the kernel even
gets loaded. After booting with a bootdisk and escaping to a shell. This is the
dmesg output:

OpenBSD 2.5-current (OSHIBANA) #2: Fri Jun  4 11:11:41 EDT 1999
    shinobi@@oshibana:/sys/arch/i386/compile/OSHIBANA
cpu0: F00F bug workaround installed
cpu0: Intel Pentium (P54C) ("GenuineIntel" 586-class) 120 MHz
cpu0: FPU,V86,DE,PSE,TSC,MSR,MCE,CX8
BIOS mem  = 654336 conventional, 15728640 extended
real mem  = 16384000
avail mem = 13725696
using 225 buffers containing 921600 bytes of memory
mainbus0 (root)
bios0 at mainbus0: AT/286+(63) BIOS, date 08/20/96
bios0: apminfo 0xf02dc00c diskinfo 0xf02dc034 cksumlen 1 memmap 0xf02dc0b0
apm0 at bios0: Power Management spec V1.1
apm0: battery life expectancy 96%
apm0: AC on, battery charge high, charging, estimated 1:28 minutes
pci0 at mainbus0 bus 0: configuration mode 1 (no bios)
"Toshiba (2nd ID) Host-PCI" rev 0x11 at pci0 dev 0 function 0 not configured
"Chips and Technologies 65550" rev 0x04 at pci0 dev 4 function 0 not configured
isa0 at mainbus0
isadma0 at isa0
wdc0 at isa0 port 0x1f0-0x1f7 irq 14
wd0 at wdc0 drive 0: &ltTOSHIBA MK2720FC>
wd0: 1296MB, 2633 cyl, 16 head, 63 sec, 512 bytes/sec, 2654280 sec total
wd0: using 16-sector 16-bit pio transfers, lba addressing (128KB cache)
sb0 at isa0 port 0x220-0x237 irq 7 drq 1: dsp v3.02
midi0 at sb0: &ltSB MIDI UART>
audio0 at sb0
opl0 at sb0: model OPL3
midi at opl0 not configured
pccom0 at isa0 port 0x3f8-0x3ff irq 4: ns16550a, 16 byte fifo
pccom1 at isa0 port 0x2f8-0x2ff irq 3: ns16550a, 16 byte fifo
pccom2 at isa0 port 0x3e8-0x3ef irq 5: ns16550a, 16 byte fifo
vt0 at isa0 port 0x60-0x6f irq 1: generic VGA, 80 col, color, 8 scr, mf2-kbd
pms0 at vt0 irq 12
fdc0 at isa0 port 0x3f0-0x3f5 irq 6 drq 2
fd0 at fdc0 drive 0: 1.44MB 80 cyl, 2 head, 18 sec
pcic0 at isa0 port 0x3e0-0x3e1 iomem 0xd0000-0xd3fff
pcic0: controller 0 (Intel 82365SL Revision 1) has sockets A and B
pcmcia0 at pcic0 controller 0 socket 0
pcmcia1 at pcic0 controller 0 socket 1
biomask 40c0 netmask 42c0 ttymask 56c2
root on wd0a
pctr: 586-class performance counters and user-level cycle counter enabled
rootdev=0x0 rrootdev=0x300 rawdev=0x302

Thank you!

   If Joe User had a working OpenBSD system from which he wanted to
   submit a bug report, he would have used the sendbug(1) utility to
   submit his bug report to the GNATS problem tracking system. Obviously
   you can't use sendbug(1) when your system won't boot, but you should
   use it whenever possible. You will still need to include detailed
   information about what happened, the exact configuration of your
   system, and how to reproduce the problem. The sendbug(1) command
   requires that your system be able to deliver electronic mail
   successfully on the Internet.

   If you have submitted a bug report and you want to check its current
   status without annoying anyone, the best ways are:

     * Visit the GNATS tracking system:
       [31]http://cvs.openbsd.org/cgi-bin/wwwgnats.pl.
     * Look in the [32]bugs@@openbsd.org list archives:
       [33]http://www.openbsd.org/mail.html.

   [34][Back to Main Index] [35][To Section 1.0 - Introduction to
   OpenBSD] [36][To Section 3.0 - Obtaining OpenBSD]
     _________________________________________________________________

   [37][back] [38]www@@openbsd.org
   $OpenBSD: obsd-faq.txt,v 1.6 1999/06/25 18:53:51 ericj Exp $

References

   1. http://www.openbsd.org/faq/index.html
   2. http://www.openbsd.org/faq/faq1.html
   3. http://www.openbsd.org/faq/faq3.html
   4. http://www.openbsd.org/
   5. http://www.monkey.org/openbsd-mobile/
   6. http://www.cpio.net/openbsd/laptops/
   7. mailto:majordomo@@openbsd.org
   8. mailto:majordomo@@openbsd.org
   9. mailto:majordomo@@openbsd.org
  10. http://www.openbsd.org/mail.html
  11. http://www.monkey.org/cgi-bin/wilma
  12. mailto:openbsd-mobile@@monkey.org
  13. http://www.monkey.org/openbsd-mobile/archive/
  14. http://www.openbsd.org/cgi-bin/man.cgi?query=afterboot&apropos=0&sektion=8&format=html
  15. http://www.openbsd.org/cgi-bin/man.cgi?query=boot&apropos=0&sektion=8&format=html
  16. http://www.openbsd.org/cgi-bin/man.cgi?query=passwd.conf&apropos=0&sektion=5&format=html
  17. http://www.openbsd.org/cgi-bin/man.cgi?query=adduser_proc&apropos=0&sektion=8&format=html
  18. http://www.openbsd.org/cgi-bin/man.cgi?query=adduser&apropos=0&sektion=8&format=html
  19. http://www.openbsd.org/cgi-bin/man.cgi?query=vipw&apropos=0&sektion=8&format=html
  20. http://www.openbsd.org/cgi-bin/man.cgi?query=man&apropos=0&sektion=1&format=html
  21. http://www.openbsd.org/cgi-bin/man.cgi?query=sendbug&apropos=0&sektion=1&format=html
  22. http://www.openbsd.org/cgi-bin/man.cgi?query=disklabel&apropos=0&sektion=8&format=html
  23. http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&apropos=0&sektion=8&format=html
  24. http://www.openbsd.org/cgi-bin/man.cgi?query=route&apropos=0&sektion=8&format=html
  25. http://www.openbsd.org/cgi-bin/man.cgi?query=netstat&apropos=0&sektion1&format=html
  26. http://www.openbsd.org/cgi-bin/man.cgi?query=reboot&apropos=0&sektion=8&format=html
  27. http://www.openbsd.org/cgi-bin/man.cgi?query=shutdown&apropos=0&sektion=8&format=html
  28. http://www.openbsd.org/cgi-bin/man.cgi?query=boot_config&apropos=0&sektion=8&format=html
  29. http://www.openbsd.org/cgi-bin/man.cgi
  30. http://www.openbsd.org/report.html
  31. http://cvs.openbsd.org/cgi-bin/wwwgnats.pl
  32. mailto:bugs@@openbsd.org
  33. http://www.openbsd.org/mail.html
  34. http://www.openbsd.org/faq/index.html
  35. http://www.openbsd.org/faq/faq1.html
  36. http://www.openbsd.org/faq/faq3.html
  37. http://www.openbsd.org/faq/index.html
  38. mailto:www@@openbsd.org


   [1][Back to Main Index] [2][To Section 2.0 - Other OpenBSD information
   resources] [3][To Section 4.0 - Installation and Disk Setup]

                            3.0 - Obtaining OpenBSD

3.1 - Buying an OpenBSD CD

   Purchasing an OpenBSD CD is generally the best way to get started.
   Visit the ordering page to purchase your copy:
   [4]http://www.openbsd.org/orders.html.

   There are many good reasons to own an OpenBSD CD:
     * CD sales support on-going development of OpenBSD.
     * Development of a multi-platform operating system requires constant
       investment in equipment.
     * Your support in the form of a CD purchase has a real impact on
       future development.
     * The CD contains binaries (and source) for all supported platforms.
     * The CD is bootable on several platforms, and can be used to
       bootstrap a machine without a pre-existing installed operating
       system.
     * The CD is useful for bootstrapping even if you choose to install a
       snapshot.
     * Installing from CD is faster! Installing from CD preserves network
       connectivity resources.
     * OpenBSD CD's always come with very nice stickers. You system isn't
       fully complete without these. You can only get these stickers by
       buying a CD set or donating hardware.

   If you're installing a release version of OpenBSD, you should use a
   CD. Snapshot releases can only be installed over the network.

3.1.1 - Buying OpenBSD T-Shirts

   Yes, OpenBSD now has t-shirts for your wearing enjoyment. You can view
   these at [5]http://www.OpenBSD.org/tshirts.html. Enjoy :)

3.2 - Downloading via FTP or AFS

   There are numerous international mirror sites offering FTP access to
   OpenBSD releases and snapshots. AFS access is also available. You
   should always use the site closest to you. Before you begin fetching a
   release or snapshot, you may wish to use ping and traceroute to
   determine which mirror site is nearest to you and whether that nearest
   mirror is performing adequately. Of course, your OpenBSD release CD is
   always closer than any mirror. Access information is here:

   [6]http://www.openbsd.org/ftp.html

3.3 - Obtaining Current Source Code

   Source to OpenBSD is freely redistributable and available at no
   charge. Generally the best way to get started with a current source
   tree is to install the source from the most recent CD and then
   configure AnonCVS to update it regularly. Information about AnonCVS,
   including how to set it up, is available here:

   [7]http://www.openbsd.org/anoncvs.html.

   or check [8]The OpenBSD FAQ

   If you don't have sufficient network bandwidth to support AnonCVS, or
   if your Internet access is via UUCP, you can still keep your source
   current by using CTM instead of AnonCVS. If that's your situation,
   then starting with a recent release CD is even more important.
   Information about CTM, including how to set it up, is available here:

   [9]http://www.openbsd.org/ctm.html.

   [10][Back to Main Index] [11][To Section 2.0 - Other OpenBSD
   information resources] [12][To Section 4.0 - Installation and Disk
   Setup]
     _________________________________________________________________

   [13][back] [14]www@@openbsd.org
   $OpenBSD: obsd-faq.txt,v 1.6 1999/06/25 18:53:51 ericj Exp $

References

   1. http://www.openbsd.org/faq/index.html
   2. http://www.openbsd.org/faq/faq2.html
   3. http://www.openbsd.org/faq/faq4.html
   4. http://www.openbsd.org/orders.html
   5. http://www.openbsd.org/tshirts.html
   6. http://www.openbsd.org/ftp.html
   7. http://www.openbsd.org/anoncvs.html
   8. http://www.openbsd.org/faq/faq8.html#8.5
   9. http://www.openbsd.org/ctm.html
  10. http://www.openbsd.org/faq/index.html
  11. http://www.openbsd.org/faq/faq2.html
  12. http://www.openbsd.org/faq/faq4.html
  13. http://www.openbsd.org/faq/index.html
  14. mailto:www@@openbsd.org


   [1][Back to Main Index] [2][To Section 3.0 - Obtaining OpenBSD] [3][To
   Section 5.0 - Kernel configuration and Disk Setup]

                      4.0 - Installation and disk setup.

4.1 - Installing from the OpenBSD CD

   Installing from a CD is definatly the BEST choice, but first you must
   have purchased a cd. You can obtain a cd from
   [4]http://www.openbsd.org/orders.html. If you are using either the
   i386, SPARC or Alpha platforms you can boot directly off the CD. If
   not, you will have to create a bootdisk. You can get the boot disk
   from ftp://ftp.openbsd.org/pub/OpenBSD/2.5/$ARCH/floppy25.fs

   To create this boot disk, use either the unix tool [5]dd(1) or MSDOS
   rawrite from the tools directory on the cd. Rawrite doesnt work if you
   are an NT user, so you can also use fdimage or ntrw.exe which are both
   also in the tools directory.

   To use dd, do the following:
# dd if=floppy25.fs of=/dev/fd0a

   or to whichever device you want to write the floppy binary to.

   After that is completed, boot from your media of choice, (cdrom or
   bootdisk) and answer the questions accordingly. Here is an example
   installation.

   [6]Example Install

4.2 - Installation via FTP

   The ftp installation is almost the same as the normal installation.
   The same bootdisk will be used.

   floppy25.fs

   Just like the CD install you will set up your disk, then when you
   specify install media you choose (f)tp. You must take care to give the
   proper settings when you are asked to configure your network. Have
   handy, your ipaddress (see below for dhcp), netmask, nameserver
   addresses, and default route. Once your network is configured
   correctly, you must choose the (f)tp installation option. You will be
   asked a few simple questions about proxys and passive or active
   transfers, and the you will be presented with a list of ftp servers.
   Select the one closest to you, and your on your way.

   Consult the [7]install text for help.

4.3 - Installation via DHCP

   Installation via DHCP is the same as ftp, except your system will use
   DHCP to configure your network. When you arrive at the network config
   option, choose DHCP and your network will be setup accordingly. The
   all you have to do is follow the remainder of the directions from ftp
   install above and you will be set.

   Consult the [8]install text for help.

4.4 - What files are needed for Installation?

   There are many packages containing the OpenBSD binaries, but which
   ones do you need to get your system up and running? Here is an
   overview of each package.

     * base25.tar.gz - Has the BASE OpenBSD system *NEEDED*
     * etc25.tar.gz - Has all the files in /etc *NEEDED*
     * comp25.tar.gz - Has the compiler and its tools, libs. *STRONGLY
       SUGGESTED*
     * man25.tar.gz - Holds man pages *STRONGLY SUGGESTED*
     * misc25.tar.gz - Holds misc info, setup docs
     * game25.tar.gz - Has the Games for OpenBSD *FUN*
     * xbase25.tar.gz - Has the base install for X11
     * xfont25.tar.gz - Holds X11's font server and fonts
     * xlink25.tar.gz - Has the X servers link kit
     * xserv25.tar.gz - Has X11's X servers
     * xshare25.tar.gz - Has manpages, locale settings, includes, etc for
       X

4.5 - Using the OpenBSD disklabel

   Be sure to check the [9]disklabel(8) man page!

   Disklabel is used to identify disk's and/or partitions. The main idea
   behind them is abstraction of disk hardware, since there exists
   several partitioning tables. A disklabel is a universal partitioning
   table. These labels tell the system everything about the disk, from
   the Maker to rpm's to track-to-track seek. This label resides on the
   beginning of the disk, this isto help bootstrap code use them (since
   most ROM based booting reads the first sectors of the first disk). It
   also will show you partitions and their types on your disk. Disklabel
   can, on some systems, be used to install bootstrap code.

   As an additional gain, using disklabels helps overcome architecture
   limitations on disk partitioning. For example on i386 you can only
   have 4 primary partitions, with disklabel you can put several labels
   on one partition (eg. 'swap', '/', '/usr' and '/var'). And you still
   have 3 more partitions available for other OSs!

   You can think of them as 'subpartitions' for installation purposes.
   But they are a necesity for kernel disk access based on geometry. And
   remember to use 'b' for the swap label, and 'a' for root filesystem
   (default names in kernel).

   To just view the current disklabel for your disk just do:
   # disklabel < disk-device name >
   This will give output similar to this:
# using MBR partition 3: type A6 off 64 (0x40) size 16777152 (0xffffc0)
# /dev/rwd0c:
type: ESDI
disk:
label: TOSHIBA MK2720FC
flags:
bytes/sector: 512
sectors/track: 63
tracks/cylinder: 16
sectors/cylinder: 1008
cylinders: 2633
total sectors: 2654064
rpm: 3600
interleave: 1
trackskew: 0
cylinderskew: 0
headswitch: 0           # milliseconds
track-to-track seek: 0  # milliseconds
drivedata: 0

16 partitions:
#        size   offset    fstype   [fsize bsize   cpg]
  a:  2071440    65583    4.2BSD     1024  8192    16   # (Cyl.   65*- 2120)
  b:    65520       63      swap                        # (Cyl.    0*- 65)
  c:  2654064        0    unused        0     0         # (Cyl.    0 - 2632)
  j:   512001  2137023    4.2BSD     1024  8192    16   # (Cyl. 2120*- 2627*)

   In this example, there are 4 labels - A, B, C, J. A is one main
   partition, B is swap, and J is another partition. C in all cases
   represents the full disk. This is helpful in showing what valuses in
   size, cyl, etc you have to work with. But with this command you cannot
   change any values, you can just view.

   To be able to edit your label's interactivly you would use the -E
   flag.
   Example:
# disklabel -E wd0
# using MBR partition 3: type A6 off 64 (0x40) size 16777152 (0xffffc0)

Treating sectors 64-16777216 as the OpenBSD portion of the disk.
You can use the 'b' command to change this.

Initial label editor (enter '?' for help at any prompt)
> ?
Available commands:
        p [unit]  - print label.
        M         - show entire OpenBSD man page for disklabel.
        e         - edit drive parameters.
        a [part]  - add new partition.
        b         - set OpenBSD disk boundaries.
        c [part]  - change partition size.
        d [part]  - delete partition.
        m [part]  - modify existing partition.
        r         - recalculate free space.
        u         - undo last change.
        s [path]  - save label to file.
        w         - write label to disk.
        q         - quit and save changes.
        x         - exit without saving changes.
        ? [cmnd]  - this message or command specific help.
Numeric parameters may use suffixes to indicate units:
        'b' for bytes, 'c' for cylinders, 'k' for kilobytes, 'm' for megabytes,
        'g' for gigabytes or no suffix for sectors (usually 512 bytes).
        Non-sector units will be rounded to the nearest cylinder.
Entering '?' at most prompts will give you (simple) context sensitive help.
> p
device: /dev/rwd0c
type: ESDI
disk:
label: TOSHIBA MK2720FC
bytes/sector: 512
sectors/track: 63
tracks/cylinder: 16
sectors/cylinder: 1008
cylinders: 2633
total sectors: 2654064
free sectors: 14193711
rpm: 3600

16 partitions:
#        size   offset    fstype   [fsize bsize   cpg]
  a:  2071440    65583    4.2BSD     1024  8192    16   # (Cyl.   65*- 2120)
  b:    65520       63      swap                        # (Cyl.    0*- 65)
  c:  2654064        0    unused        0     0         # (Cyl.    0 - 2632)
  j:   512001  2137023    4.2BSD     1024  8192    16   # (Cyl. 2120*- 2627*)
> q
No changes.

   In this example we get into disklabel's interactive mode. From here we
   can issue the command "?" asking for help. This gives us many commands
   we can use to add, delete, edit existing labels.

   There is a new feature on disklabel, to help installation. The '-f'
   flag writes a 'fstab' like file, if given a mount point for a label.
   This is only used at installation.

   To see an example install involving disklabel check [10]log25.txt

4.6 - Using fdisk

   First be sure to check the fdisk main page. [11]fdisk(8)

   Fdisk is a program to help with the maintenance of your partitions.
   This program is used at install time to set up your OpenBSD partition
   (this partition can contain several labels, each with
   filesystems/swap/etc.). It can divide space on your drives and set one
   active. This program will usually be used in Single User Mode ( boot
   -s ). Fdisk also sets the MBR on your various hard disks.

   For installation purposes, most times you'll only need ONE Openbsd
   partition, and then using disklabel to put a swap and a filesystem on
   it.

   To just view your partition table using fdisk just use:
   # fdisk fd0
   Which will give an output similar to this:
         Disk: fd0       geometry: 80/2/18 [2880 sectors]
         Offset: 0       Signatures: 0xAA55,0x0
                  Starting        Ending
          #: id  cyl  hd sec -  cyl  hd sec [     start -       size]
----------------------------------------------------------------------
         *0: A6    0   0   1 -   79   1  18 [         0 -       2880] OpenBSD
          1: 00    0   0   0 -    0   0   0 [         0 -          0] unused
          2: A7    0   0   2 -   79   1  18 [         1 -       2879] NEXTSTEP
          3: 00    0   0   0 -    0   0   0 [         0 -          0] unused

   In this example we are viewing the fdisk output of floppy drive. We
   can see the OpenBSD partition (A6) and its size. The * tells us that
   the OpenBSD partition is a bootable partition.

   In the previous example we just viewed our information. What if we
   want to edit our partition table? Well, to do so we must use the -e
   flag. This will bring up a command line prompt to interact with fdisk.

# fdisk -e wd0
Enter 'help' for information
fdisk: 1> help
        help            Command help list
        manual          Show entire OpenBSD man page for fdisk
        reinit          Re-initialize loaded MBR (to defaults)
        disk            Edit current drive stats
        edit            Edit given table entry
        flag            Flag given table entry as bootable
        update          Update machine code in loaded MBR
        select          Select extended partition table entry MBR
        print           Print loaded MBR partition table
        write           Write loaded MBR to disk
        exit            Exit edit of current MBR, without saving changes
        quit            Quit edit of current MBR, saving current changes
        abort           Abort program without saving current changes
fdisk: 1>

   It is perfectly safe in fdisk to go in and explore, just make sure to
   answer N to saving the changes and *DON'T* use the write command.

   Here is an overview of the commands you can use when you choose the -e
   flag.
     * help Display a list of commands that fdisk understands in the
       interactive edit mode.
     * reinit Initialize the currently selected, in-memory copy of the
       boot block.
     * disk Display the current drive geometry that fdisk has probed. You
       are given a chance to edit it if you wish.
     * edit Edit a given table entry in the memory copy of the current
       boot block. You may edit either in BIOS geometry mode, or in
       sector offsets and sizes.
     * flag Make the given partition table entry bootable. Only one entry
       can be marked bootable. If you wish to boot from an extended
       partition, you will need to mark the partition table entry for the
       extended partition as bootable.
     * update Update the machine code in the memory copy of the currently
       selected boot block.
     * select Select and load into memory the boot block pointed to by
       the extended partition table entry in the current boot block.
     * print Print the currently selected in-memory copy of the boot
       block and its MBR table to the terminal.
     * write Write the in-memory copy of the boot block to disk. You will
       be asked to confirm this operation.
     * exit Exit the current level of fdisk, either returning to the
       previously selected in-memory copy of a boot block, or exiting the
       program if there is none.
     * quit Exit the current level of fdisk, either returning to the
       previously selected in-memory copy of a boot block, or exiting the
       program if there is none. Unlike exit it does write the modified
       block out.
     * abort Quit program without saving current changes.

4.7 - Adding new disks in OpenBSD

   Well once you get your disk installed PROPERLY you need to use
   [12]fdisk(8) and [13]disklabel(8) to set up your disk in OpenBSD.
   Making sure that the partition ID is 'A6'. Once you have done this,
   OpenBSD will be able to recognize the new disk, and you need to create
   the filesystem on that disk using [14]newfs(8).

   bsd# newfs wd1a

   or so on using OpenBSD's disk numbering scheme
  wd0
  wd1
  wd2

   Edit fstab to mount the new disk at a mount point of your choice, and
   reboot.

   If you need to migrate an existing directory like /usr/bin. You should
   mount the new drive in /mnt and use cpio -pdum to copy /usr/bin to the
   /mnt directory. Edit the /etc/fstab file to show that /usr/bin will be
   mounted on the new drive. example:

   /dev/wd1a /usr/bin ffs rw 1 1

   Reboot into single user mode..boot -s Move the existing /usr/bin to
   /usr/bin-backup and create an empty /usr/bin. Then reboot the system,
   and whala!! the files are there!

4.8 - How do I swap to a file?

   With OpenBSD 2.5 came the introduction of [15]swapctl(8), which made
   dealing with swap devices much easier. Swapping to a file doesn't
   require a custom built kernel, But that can still be done, this faq
   will show you how to add swap space both ways.

   To swap to a file permanently, first make a kernel with vnd0c as swap.
   If you have wd0a as root filesystem, wd0b is the previous swap, use
   this line in the kernel configuration file (refer to compiling a new
   kernel if in doubt):

config          bsd     root on wd0a swap on wd0b and vnd0c dumps on wd0b

   Second make the file for swap. If you want a 32MB swapfile named
   /newswap do:

   # dd if=/dev/zero of=/newswap bs=1k count=32768

   Add a line to your /etc/fstab file to indicate where the new swap will
   be.

   /dev/vnd0c none sw 0 0

   Now boot with the new kernel. Then create the vnd0 device to use that
   file as a device:

   # vnconfig -c -v vnd0 /newswap

   And add it now to swap:

   # swapon /dev/vnd0c

   You can now see if it is working with:

   # pstat -s

4.9 - Softupdates

   Softupdates are experimental and are NOT recomended for regular users.

   Over the last few years Krik McKusick has been working on something
   called "soft updates". This is based on an idea proposed by Greg
   Ganger and Yale Patt that imposing a partial ordering on the buffer
   cache opertions would permit the requirement for synchronous writing
   of directory entries to be removed from the FFS code. Thus, a large
   performance increase of disk writing performance.

   To enable Softupdates your kernel must have option

   option FFS_SOFTUPDATES

   then you need to boot into single-user mode:

boot>boot -s
[snip]
bsd# tunefs -s enable <raw device>
bsd# reboot -n

   GOOD LUCK. Please direct all problem reports with as MUCH information
   as possible (kernel coredumps, tracebacks, etc) to [16]Costa. Do not
   waste his time with any other questions or incomplete problem reports.

4.10 - How much space do I need for an OpenBSD installation?

   The following are suggested sub-tree sizes for a full system install.
   The numbers include enough extra space to permit you to run a typical
   home system that is connected to the internet:

SYSTEM          /       /usr    /var    /usr/X11R6
alpha           56M     540M    27M     161M
amiga           45M     399M    24M      36M
arc             47M     268M    20M      60M
hp300           31M     234M    24M      47M
i386            35M     229M    24M      72M
mac68k          29M     232M    24M      36M
mvme68k         48M     448M    24M       -  (no Xserver)
pmax            50M     355M    24M      60M
sparc           40M     259M    24M      49M
powerpc         39M     423M    26M     124M

   When you are in the disklabel editor, you may choose to make your
   entire system have just an 'a' and 'b' partition. The 'a' partition
   you set up in disklabel will become your root partition, which should
   be the sum of all the 3 main values above (/, /usr, and /var) plus
   some space for /tmp. The 'b' partition you set up automatically
   becomes your system swap partition -- we recommend a minimum of 32MB
   but if you have disk to spare make it at least 64MB.

   However, we recommend you use many seperate partitions so that users
   cannot fill up your important partitions as easily, thus causing nasty
   denial of service problems. If you are extra cautious, you will make
   at least the following seperate partitions: / swap /usr /var /tmp
   /var/tmp /home.

4.11 - How do I get rid of in "partition 3 id 0" error on boot?

   This means that your MBR (Master Boot Record) was not installed
   properly or that your BIOS is not compatible with your current MBR. To
   solve this first try to reinstall the OpenBSD boot blocks. To do so
   use [17]intsallboot(8). For example, the most common usage is:

     * Boot from the OpenBSD bootdisk

     * # fsck /dev/rwd0a && mount /dev/wd0a /mnt
     * # cp /usr/mdec/boot /mnt/boot
     * # /usr/mdec/installboot -v /mnt/boot /usr/mdec/biosboot wd0

     Here substitute your disk devices for rwd0a & wd0a. This will
   install the boot blocks again.

     Then Reboot.

   If this doesn't work you still have a few more options. So, luck
   hasn't run out yet. The first is to use a bootloader such as OS-BS.
   The OpenBSD cd has the os-bs bootloader included in the tools
   directory. If you didn't purchase a CD-ROM, you can download os-bs
   from any of the OpenBSD ftp sites.

   pub/OpenBSD/2.5/tools/osbs135.exe

   and take some time to look through the web pages at
   [18]http://www.prz.tu-berlin.de/~wolf/os-bs.html

   There are also other commercial bootloaders or lilo that you can use
   for multi-booting.

   Here is a simple outline of how to get lilo onto your system.

     * Boot a DOS floppy and do a fdisk /MBR. Make sure you do that on
       the drive you'll be booting from.
     * Boot from a linux disk and install LILO & chain it to your OpenBSD
       boot block.

   For further instructions read [19]INSTALL.linux

4.12 - How do I get a dmesg from a boot floppy?

   RAMDISK images (boot floppies) do not ship with the dmesg utility.
   They do, however, have the /kern filesystem mounted. To copy the dmesg
   information to a file, do a:
# cat /kern/msgbuf >mydmesg

4.13 - Installing bootblocks (i386 specific)

   PC BIOS's can only deal with disk geometries with 1024 cylinders or
   less. Since most disks these days have more than 1024 cylinders, most
   PC scsi controllers "translate" the real disk geometry into something
   that fits within the BIOS's parameters. However, not all scsi
   controllers "translate" the geometry in the same way. If you change
   scsi controllers and they use a different "translated" geometry you
   will be unable to load the second stage boot loader (and thus unable
   to load the kernel) because the first stage boot loader contains a
   list of the blocks that comprise /boot in terms of the "translated"
   geometry. To fix this, just boot from a boot floppy and at the boot
   prompt, type "b hd0a:/bsd" to boot from the first hard disk (and not
   the floppy). Your machine should come up normally. You now need to
   update the first stage boot loader (aka the boot block). This is also
   the same way to for any disk device, ide disks and scsi disks in
   OpenBSD.
   To do this, assuming your boot disk is sd0:
cd /usr/mdec; ./installboot /boot biosboot sd0

4.14 - Multibooting OpenBSD

   OpenBSD & NT

   To multiboot OpenBSD and NT, you can use NTloader. The bootloader the
   NT uses. To multi-boot with NT, you need a copy of your OpenBSD pbr.
   After running installboot, you can copy it something like this:

# dd if=/dev/rsd0a of=openbsd.pbr count=1

   Now boot NT and put openbsd.pbr in c:. Add a line like this to the end
   of c:\boot.ini:

c:\openbsd.pbr="OpenBSD"

   When you reboot, you should be able to select OpenBSD from the NT
   loader menu. There is much more information available about NTloader
   at the [20]NTLDR Hacking Guide.

   OpenBSD & Windows or DOS

   To boot OpenBSD along with Windows 3.1, Windows95, or DOS you must
   simply put a boot loader on the system that can handle these OS's.
   Some bootloaders of choice are [21]osbs20b8.zip or [22]The Ranish
   Partition Manager. Both of these are known to be able to boot OpenBSD
   partitions.

   OpenBSD & Linux

   Please refer to [23]INSTALL.linux, which gives indepth instructions on
   getting OpenBSD working with Linux.

   [24][Back to Main Index] [25][To Section 3.0 - Obtaining OpenBSD]
   [26][To Section 5.0 - Kernel configuration and Disk Setup]
     _________________________________________________________________

   [27][back] [28]www@@openbsd.org
   $OpenBSD: obsd-faq.txt,v 1.6 1999/06/25 18:53:51 ericj Exp $

References

   1. http://www.openbsd.org/faq/index.html
   2. http://www.openbsd.org/faq/faq3.html
   3. http://www.openbsd.org/faq/faq5.html
   4. http://www.openbsd.org/orders.html
   5. http://www.openbsd.org/cgi-bin/man.cgi?query=dd&apropos=0&sektion=1&format=html
   6. http://www.openbsd.org/faq/log25.txt
   7. http://www.openbsd.org/faq/log25.txt
   8. http://www.openbsd.org/faq/log25.txt
   9. http://www.openbsd.org/cgi-bin/man.cgi?query=disklabel&apropos=0&sektion=8&format=html
  10. http://www.openbsd.org/faq/log25.txt
  11. http://www.openbsd.org/cgi-bin/man.cgi?query=fdisk&apropos=0&sektion=8&format=html
  12. http://www.openbsd.org/cgi-bin/man.cgi?query=fdisk&apropos=0&sektion=8&format=html
  13. http://www.openbsd.org/cgi-bin/man.cgi?query=disklabel&apropos=0&sektion=8&format=html
  14. http://www.openbsd.org/cgi-bin/man.cgi?query=newfs&apropos=0&sektion=8&format=html
  15. http://www.openbsd.org/cgi-bin/man.cgi?query=swapctl&sektion=8&format=html
  16. mailto:csapuntz@@openbsd.org
  17. http://www.openbsd.org/cgi-bin/man.cgi?query=installboot&sektion=8&format=html
  18. http://www.prz.tu-berlin.de/~wolf/os-bs.html
  19. http://www.openbsd.org/faq/INSTALL.linux
  20. http://www.dorsai.org/~dcl/publications/NTLDR_Hacking/
  21. http://www.freebird.org/sw-map/bootmanager.html
  22. http://www.users.intercom.com/~ranish/part/
  23. http://www.openbsd.org/faq/INSTALL.linux
  24. http://www.openbsd.org/faq/index.html
  25. http://www.openbsd.org/faq/faq3.html
  26. http://www.openbsd.org/faq/faq5.html
  27. http://www.openbsd.org/faq/index.html
  28. mailto:www@@openbsd.org


   [1][Back to Main Index] [2][To Section 4.0 - Installation and Disk
   Setup] [3][To Section 6.0 - Networking]

                   5.0 - Kernel Configuration and Disk Setup

5.1 - Why would I want to create my own custom kernel?

   Its a joyous occasion when you as a user get to configure and build
   your own custom kernel. Why would you want to do this though?

     * You can define which drivers your computer has support for.
     * You can get rid of uneeded drivers in the GENERIC kernel
     * Speed up boot times
     * Remove default options or add options which may not have been
       enabled by default

5.2 - Kernel Configuration Options

   Kernel Configuration Options are options that you add to your kernel
   configuration that place certain features into your kernel. This
   allows you to have exactly the support you want, without having
   support for uneeded devices. There are multitudes of options that
   allow you to customize you kernel. Here we will go over only some of
   them, one's that are most commonly used. Check the [4]options(4) man
   page for a more complete list of options. You can also check the
   example configuration files that are availible for your architecture.

     * [5]Alpha Kernel Conf Files
     * [6]i386 Kernel Configuration files
     * [7]mac68k Kernel Configuration files
     * [8]pmax Kernel Configuration Files
     * [9]sparc Kernel Configuration Files
     * [10]Other Arch's

   Look closely at these files and you will notice a line like:
   include "../../../conf/GENERIC"
   This means that it *IS* referencing yet another configuration file.
   This file stores non arch-dependent options. So when creating your
   Kernel Config be sure to look through [11]/sys/conf/GENERIC and see
   what you want. There ARE options in there that are NEEDED.

   OpenBSD has a great many compatibility options which allow you to use
   binaries from other OS's. Not all are availibly on every
   architechture, so be sure to read the man pages for each option to see
   if your arch is supported.

     * [12]compat_svr4(8) - Compatibility with SVR4 binaries.
     * [13]compat_bsdos(8) - Compatibility with BSD/OS binaries.
     * [14]compat_linux(8) - Compatibility with Linux binaries.
     * [15]compat_sunox(8) - Compatibility with SunOS binaries.
     * [16]compat_ultrix(8) - Compatibility with Ultrix binaries.
     * [17]compat_freebsd(8) - Compatibility with FreeBSD binaries.
     * compat_hpux - Compatibility with HP-UX binaries. Only availible on
       some m68k arch's.
     * [18]compat_ibcs2(8) - Compatibility to run ibcs2 binaries.
     * compat_osf1 - Run Digital Unix binaries. Availible only on Alpha
       platform.

5.3 - Building your own kernel

   Full instructions for creating your own custom kernel are in the
   [19]afterboot(8) man page.

   To compile your kernel from the cdrom do the following:

#cd /somewhere
#cp /usr/src/sys/arch/$ARCH/conf/SOMEFILE .
#vi SOMEFILE (to make the changes you want)
#config -s /usr/src/sys -b . SOMEFILE
#make

   To compile a kernel inside a writeable source tree do the following:

#cd /sys/arch/$ARCH/conf
#vi SOMEFILE (to make any changes you want)
#config SOMEFILE (read more about it here : [20]config(8))
#cd ../compile/SOMEFILE
#make

   Where $ARCH is the architecture you are using (e.g. i386). You can
   also do a make depend to make the dependencies for the next time you
   compile your kernel.

   To move your kernel into place.

#cp /bsd /bsd.old
#cp /sys/arch/$ARCH/compile/SOMEFILE/bsd /bsd

   To revert to your old kernel at boot you need to just

boot>bsd.old

   and your old kernel will be loaded instead of /bsd.

5.4 - Boot Time Configuration

   Sometimes when booting your system you might notice that the kernel
   finds your device but maybe at the wrong IRQ. And maybe you need to
   use this device right away. Well, without rebuilding the kernel you
   can use OpenBSD's boot time kernel configuration. This will only
   correct your problem for one time. If you reboot, you will have to
   repeat this procedure. So, this is only meant as a temporary fix, and
   you should correct the problem by fixing and recompiling your kernel.
   Your kernel does however need option BOOT_CONFIG in the kernel, which
   GENERIC does have.

   Most of this document can be found in the man page [21]boot_config(8)
   To boot into the User Kernel Config, or UKC, at boot time us the -c
   option.

Boot> boot wd0a:/bsd -c

   Or whichever kernel it is you want to boot. Doing this will bring up a
   UKC prompt. From here you can issue commands directly to the kernel
   specifying devices you want to change or disable or even enable.

   Here is a list of common commands in the UKC.

   add device - Add a device through copying another

   change devno | device - Modify one or more devices

   disable devno | device - Disable one or more devices

   enable devno | device - Enable one or more devices

   find devno | device - Find one or more devices

   help - Short summary of these commands

   list - List ALL known devices

   exit/quit - Continue Booting

   show [attr [val]] - Show devices with an attribute and optional with a
   specified value

   Once you get your device configured, use quit or exit and continue
   booting. After so you should correct your Kernel configuration and
   Compile a new kernel. Refer to [22]Building your own kernel for help.

   [23][Back to Main Index] [24][To Section 4.0 - Installation and Disk
   Setup] [25][To Section 6.0 - Networking]
     _________________________________________________________________

   [26][back] [27]www@@openbsd.org
   $OpenBSD: obsd-faq.txt,v 1.6 1999/06/25 18:53:51 ericj Exp $

References

   1. http://www.openbsd.org/faq/index.html
   2. http://www.openbsd.org/faq/faq4.html
   3. http://www.openbsd.org/faq/faq6.html
   4. http://www.openbsd.org/cgi-bin/man.cgi?query=options&apropos=0&sektion=4&format=html
   5. http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/alpha/conf/
   6. http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/i386/conf/
   7. http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/mac68k/conf/
   8. http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/pmax/conf/
   9. http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/sparc/conf/
  10. http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/
  11. http://www.openbsd.org/cgi-bin/cvsweb/src/sys/conf/GENERIC
  12. http://www.openbsd.org/cgi-bin/man.cgi?query=compat_svr4&sektion=8&apropos=0&manpath=OpenBSD+Current
  13. http://www.openbsd.org/cgi-bin/man.cgi?query=compat_bsdos&sektion=8&apropos=0&manpath=OpenBSD+Current
  14. http://www.openbsd.org/cgi-bin/man.cgi?query=compat_linux&sektion=8&apropos=0&manpath=OpenBSD+Current
  15. http://www.openbsd.org/cgi-bin/man.cgi?query=compat_sunos&sektion=8&apropos=0&manpath=OpenBSD+Current
  16. http://www.openbsd.org/cgi-bin/man.cgi?query=compat_ultrix&sektion=8&apropos=0&manpath=OpenBSD+Current
  17. http://www.openbsd.org/cgi-bin/man.cgi?query=compat_freebsd&sektion=8&apropos=0&manpath=OpenBSD+Current
  18. http://www.openbsd.org/cgi-bin/man.cgi?query=compat_ibcs2&sektion=8&apropos=0&manpath=OpenBSD+Current
  19. http://www.openbsd.org/cgi-bin/man.cgi?query=afterboot&apropos=0&sektion=8&format=html
  20. http://www.openbsd.org/cgi-bin/man.cgi?query=config&apropos=0&sektion=8&format=html
  21. http://www.openbsd.org/cgi-bin/man.cgi?query=boot_config&apropos=0&sektion=8&format=html
  22. http://www.openbsd.org/faq/faq5.html#5.3
  23. http://www.openbsd.org/faq/index.html
  24. http://www.openbsd.org/faq/faq4.html
  25. http://www.openbsd.org/faq/faq6.html
  26. http://www.openbsd.org/faq/index.html
  27. mailto:www@@openbsd.org


   [1][Back to Main Index] [2][To Section 5.0 - Kernel configuration and
   Disk Setup] [3][To Section 7.0 - Keyboard controls]

                               6.0 - Networking
     _________________________________________________________________

6.1 - Initial Network Setup

  Interfaces

   Here we assume you have all your network interfaces working, and a
   basic TCP/IP knowledge. If not, go to the [4]Kernel Configuration and
   Setup section, and/or read a nice intro to TCP/IP. Other recommended
   reading are the [5]ifconfig(8) and [6]netstat(1) man pages.

   All your interfaces should be listed with:

# ifconfig -a

lo0: flags=8009<UP,LOOPBACK,MULTICAST>
        inet 127.0.0.1 netmask 0xff000000
lo1: flags=8008<LOOPBACK,MULTICAST>
xl0: flags=8843<UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST>
        media: Ethernet 100baseTX half-duplex
        inet 10.1.1.1 netmask 0xffffff00 broadcast 10.1.1.255
sl0: flags=c010&ltPOINTOPOINT,LINK2,MULTICAST>
        inet 10.1.1.1 netmask 0xffffff00 broadcast 10.1.1.255
sl0: flags=c010<POINTOPOINT,LINK2,MULTICAST>
sl1: flags=c010<POINTOPOINT,LINK2,MULTICAST>
ppp0: flags=8010<POINTOPOINT,MULTICAST>
ppp1: flags=8010<POINTOPOINT,MULTICAST>
tun0: flags=10<POINTOPOINT>
tun1: flags=10<POINTOPOINT>
enc0: flags=8<LOOPBACK>

   First there is lo0 the loopback interface. It MUST have the assigned
   address of 127.0.0.1 no matter what network setup you use. The next
   important one is xl0 in this example (could be neX or epX depending on
   the brand), which is a board itself. Look it has UP and RUNNING flags
   on, as lo0 but no other interface have them. That means oviously they
   are working. Your interface could be down if you never configured it,
   and look like the other interfaces. The others are not part of this
   section, as sl and ppp are for serial line comunication, tun is a
   pseudo-device for tunneling and enc a pseudo-device for encryption.

   If xl0 was uninitialized, you can assign it an address creating a
   ascii file /etc/hostname.xl0 having a string like this:

inet mona 255.255.255.0 NONE

   Here "mona" is a name that exists as a record in /etc/hosts:

10.1.1.1        mona    mona.openbsd.org.ar

   Now check that you have a file /etc/myname and a file /etc/mygate. If
   you don't have them, you need to create them. If your gateway is a
   machine named "wintermute" wich is also in the /etc/hosts, use this
   commands:

# echo "mona" >> /etc/myname; echo "wintermute" >> /etc/mygate

   Ok, you are done for a standalone system, but to activate your
   configuration now (without rebooting) do:

# sh /etc/netstart

   This will give you a few errors, but don't worry as all them are
   concerning 127.0.0.x (loopback)

   Note: if you want to use the system as a gateway, later there's a
   "Firewall Setup" section, but you need to read all this first.

   Now check your routes are ok (here we use -n aso to make it simpler to
   look at):

# netstat -rn
Routing tables

Internet:
Destination        Gateway            Flags     Refs     Use    Mtu
Interface
default            10.1.1.254         UGS         0        0      -  xl0
10.1.1/24          link#1             UC          0        0      -  xl0
10.1.1.1           127.0.0.1          UGHS        0        0      -  lo0
10.1.1.254         link#1             UHL         1        0      -  xl0
127/8              127.0.0.1          UGRS        0        0      -  lo0
127.0.0.1          127.0.0.1          UH          3       24      -  lo0
224/8              link#1             UCS         0        0      -  xl0

Encap:
Source address/netmask          Port  Destination address/netmask     Port Prot
o SA(Address/SPI/Proto)

   (The gateway here is shown as 10.1.1.254)

  IP Aliasing

   If you want to map more than one IP address on a single network
   interface, you need to assign an "alias" to it. The way to do it on
   OpenBSD is simply assigning the interface another IP with the "alias"
   option like this:

# ifconfig xl0 alias 10.1.1.2 netmask 255.255.255.255

   Here ne2 is assigned another IP number (remember it already has
   10.1.1.1). Note the netmask used! Don't use 255.255.255.0 in this kind
   of cases (both numbers are on the same subnet), only ONE address shoud
   handle the subnet. If you do such kind of misconfiguration the
   following error appears:

ifconfig:SIOCAIFADDR: File exists

   Now let's change the configuration file for this, /etc/ifaliases. Add
   to it this line:

xl0   10.1.1.2 255.255.255.255

  DNS Client Setup

   Let's assume your DNS servers are 125.2.3.4 and 125.2.3.5, and your
   machine name belongs to the domain yourdomain.com. Add the following
   lines to your /etc/resolv.conf file:

domain yourdomain.com
nameserver 125.2.3.4
nameserver 125.2.3.5

  Gateway Setup

   This is a minimal explanation, only for internal/secure networks! Read
   Firewall Setup if you plan to put a gateway to internet.

   If you want to put a host that connects two subnets, and you want it
   to "forward" any packet from them modify /etc/sysctl.conf line that
   toggles the forwarding variable on bootup:

net.inet.forwarding=1

   To make the changes without booting:

# sysctl -w net.inet.ip.forwarding=1
net.inet.ip.forwarding: 0 -> 1

   Now modify the routes on the other hosts on both sides.

6.2 - IPF/NAT Setup

  IPF and IPNAT Setup

   The IPFilter package was created to handle with two tasks, dealing
   with packet level forwarding permissions and mapping hosts/subnets to
   a range of external addresses. The configuration files are
   /etc/ipf.rules and /etc/ipnat.rules, and also part of /etc/

   rc.conf to activate them at boot time. You also need to have
   net.inet.ip.forwarding=1! You also need a kernel compiled with option
   IPFILTER and IPFILTER_LOG (the GENERIC one present in the installation
   have them).

   There are a lot of nice examples on /usr/share/ipf/ for both. We
   recommend you to choose the one closer to what you want, and modify it
   to fit your needs.

  IPF

   Modify rc.conf so it has IPFILTER=YES. The file /etc/ipf.rules has a
   simple yet powerful syntax. Here we deal with the most common ways of
   usage, for a more strict definition see man 5 ipf. Here is assumed xl0
   as the external interface to internet, on this one uses to have more
   rules than internal interfaces.

   Configurations usually start letting everything come and go, and then
   apply the necesary rules to block offending packets. So this is first:

pass out from any to any
pass in from any to any

   Now lets block any incoming connection to port 82 tcp (eg. there's an
   internal network report agent using http running on several hosts):

block in on xl0 proto tcp from any to any port = 82

   This rule means:

   "Block all incoming packets on xl0 interface whose protocol is TCP no
   matter destination/origin using port 82"

   If you want to log all rejected packets add "log" after "block in", or
   "log quick" if you don't want it to send a message to every console
   root is logged in.

   Also a typical rule is to block rpc portmap:

block in log on xl0 proto udp from any to any port = sunrpc

  IPNAT

   Based on RFC 1631, ipnat provides an easy way to map internal networks
   on a range of external addresses. This is very useful if you don't
   have officially asigned addresses for every host on your internal
   network. When you set up private/internal networks you can take
   advantage of reserved address blocks like:

10.0.0.0, 192.168.0.0, and 172.16.0.0

   If you have an internal network using 192.168.0.0 and you want to give
   them access to internet using OpenBSD (of course!) and a ppp
   connection using address 200.1.2.3, use this rule:

map ppp0 192.168.0.0/16 -> 200.1.2.3/32

   Note the /16 and /32, this means:

   "Any outgoing connection whose comming from an address matching the
   first 16 bits of 192.168.0.0 should be mapped on local address
   200.1.2.3 (only one address since /32 means every bit)"

   But here arises a problem. You are assigning a lot of addresses to
   only ona (or a few) address. The way to go arount it is to map TCP and
   UDP ports to a certain range with the option "portmap". But remember
   ICMP doesnt work this way, it only has an ID field (usually based on
   process number). So now its like this:

map ppp0 192.168.0.0/16 -> 200.1.2.3/32 portmap tcp/udp 1024:65000
map ppp0 192.168.0.0/16 -> 200.1.2.3/32

   This way things work better. If you have a dynamic address assignment
   (like regular dialup modem account), you can do this:

map ppp0 192.168.0.0/16 -> ppp0/32 portmap tcp/udp 1024:65000
map ppp0 192.168.0.0/16 -> ppp0/32

  Redirecting ports

   This is another very handy feature of IPNAT. If you have a host on the
   internal network (using private addresses), and you want to let
   incoming connections to it, you just need a simple redirect rule. For
   example, if you have a web server on internal network at 10.2.2.7
   listening on port 80, and want it to be accesible from the outside
   simply redirecting external IP 120.2.3.4 on xl0, just add this rule to
   /etc/ipnat.rules:

rdr xl0 120.2.3.4 port 80 -> 10.2.2.7 port 80

   This is a little graph:

Internet <--> (xl0) OpenBSD (xl1) <--> LAN <--> 10.2.2.7
            128.2.3.4      whatever  10.2.2.0   Web server

   Remember to activate kernel must have option IP FORWARDING. Also
   remember that EVERY packet MUST pass through the OpenBSD box, i.e. you
   can't redirect ports to hosts on the same network and address external
   to the OpenBSD box.

6.3 - IPSEC

   Be sure to check [7]vpn man page.

   You can also check [8]Codetalker

6.4 - DHCP

   This section is not yet completed. Please Check back soon.

6.5 - PPP

   PPP is generally an easy thing to set up. What follows is a basic
   intro based on the information provided in /etc/ppp and the [9]ppp(8)
   manual pages. These are highly suggested reading before attempting to
   setup PPP or even reading this FAQ entry. If you have read these the
   following should look farmiliar because it is that info with a little
   bit of elaboration.

   First you will need to find out a little bit about how your ISP sets
   up its PPP connections. Does it use scripted login, PAP, CHAP, do you
   have a dynamic or static IP etc. This along with some basic info about
   your modem will allow us to easily create a PPP dial in script for
   your ISP.

   First we will create a PPP conf using what is already in
   /etc/ppp/ppp.conf.sample as a guide. The first section we come to is
   the section labeled default. This is the best place to specify logging
   options, your modem device and dial options. It will always be
   executed when ppp is run. The following is the default section that
   comes standard with /etc/ppp/ppp.conf.sample and an explanation of
   what each parameter does:
   <Default Section>
default:
set log Phase Chat LCP IPCP CCP tun command      #This parameter tells PPP to l
og output which pertains
                                                 #to the arguments you give the
 parameter.

set device /dev/cua01                            #This will set the default mod
em device on the system
                                                 #which here is comm 2.

set speed 115200                                 #This parameter sets the speed
 of the serial device.

set dial "ABORT BUSY ABORT NO\\sCARRIER TIMEOUT 5 \"\" AT OK-AT-OK ATE1Q0 OK \\
dATDT\\T TIMEOUT 40 CONNECT"
                                                 #This will set the commands to
 follow when certian actions
                                                 #take place while dialing.  Ab
ort the call if the number is
                                                 #busy, abort the call if there
 is no carrier.  Wait 5 seconds for
                                                 #carrier. Issue AT and wait fo
r response. If AT is ok then dial the
                                                 #number and timeout if not con
nected in 40 seconds. Once dialed
                                                 #in wait for the CONNECT messa
ge to tell us we are connected.

   Now that the default modem options are set we will need to create a
   section in the ppp.conf for our ISP. Below are a few examples of what
   could be in there and what type of isp they are tailored for.
   <MyISP Section>
myisp:
set phone 1234567                        #This of course sets the number to dia
l for your isp.

set login "ABORT NO\\sCARRIER TIMEOUT 5 ogin:--ogin: ppp word: ppp"
                                         #This sets the login options.  It will
 abort login if
                                         #there is no carrier with a timeout of
 5 seconds.  It
                                         #will then wait for the login: prompt
and send
                                         #your login name, and then it will wai
t for the password
                                         #prompt and send your password.

set timeout 120                          #This sets the timeout for the entire
login process.

set ifaddr 10.0.0.1/0 10.0.0.2/0 255.255.255.0 0.0.0.0
                                         #This will set the ip address you expe
ct your your side
                                         #and for the remote side of the connec
tion. The /0 bit
                                         #tells the connection that no bits of
this ip address
                                         #need to match and the whole thing can
 be replaced.
                                         #This also sets your default netmask a
nd gateway.

add default HISADDR                      #This will make the default gateway th
e remote end of
                                         #the ppp connection.

enable dns                               #This tells ppp to ask the peer for th
e nameserver
                                         #addresses that should be used. This i
snt always supported,
                                         #but if it is /etc/resolv.conf will au
tomatically be updated.

   <Pap/Chap Section>

   What if your ISP uses PAP or CHAP? Here is a configuration that will
   work with both PAP or CHAP, PPP will decide which it needs to use.
myispPAPCHAP:
set PHONE 1234567                        #This line sets the phone number.

set LOGIN                                #PPP will be waiting for the peer to s
uggest the use of
                                         #either PAP or CHAP.

set authname MyName                      #This is where you specify your userna
me.

set authkey MyKey                        #This is where you specify your passwo
rd.

set timeout 120                          #This sets the login timeout to 120 se
conds.

   And then procede with the standard commands from above.
   <Static Ip Section>

   All you need to do is change the ifaddr parameter like so:

set ifaddr 209.115.93.18 209.115.93.20

   In this example, your ip is 209.115.93.18, and the peer side ip is
   209.115.93.20.

   [10][Back to Main Index] [11][To Section 5.0 - Kernel configuration
   and Disk Setup] [12][To Section 7.0 - Keyboard controls]
     _________________________________________________________________

   [13][back] [14]www@@openbsd.org
   $OpenBSD: obsd-faq.txt,v 1.6 1999/06/25 18:53:51 ericj Exp $

References

   1. http://www.openbsd.org/faq/index.html
   2. http://www.openbsd.org/faq/faq5.html
   3. http://www.openbsd.org/faq/faq7.html
   4. http://www.openbsd.org/faq/faq5.html
   5. http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&apropos=0&sektion=8&format=html
   6. http://www.openbsd.org/cgi-bin/man.cgi?query=netstat&apropos=0&sektion=1&format=html
   7. http://www.openbsd.org/cgi-bin/man.cgi?query=vpn&apropos=0&sektion=0&format=html
   8. http://www.codetalker.com/greenbox/docs/vpn-24-minifaq.html
   9. http://www.openbsd.org/cgi-bin/man.cgi?query=ppp&apropos=0&sektion=8&format=html
  10. http://www.openbsd.org/faq/index.html
  11. http://www.openbsd.org/faq/faq5.html
  12. http://www.openbsd.org/faq/faq7.html
  13. http://www.openbsd.org/faq/index.html
  14. mailto:www@@openbsd.org


   [1][Back to Main Index] [2][To Section 6.0 - Networking] [3][To
   Section 8.0 - General Questions]

                            7.0 - Keyboard controls

7.1 - How do I remap the keyboard?

   By using kcon(1), "kcon - keyboard control and remapping for the pcvt
   driver"

   Example:

   bsd# kcon -m gb will load the keycap file for Great Britain.

7.2 - Is there gpm or the like in OpenBSD?

   No. But if you are willing to make a port. Please share. :)

   [4][Back to Main Index] [5][To Section 6.0 - Networking] [6][To
   Section 8.0 - General Questions]
     _________________________________________________________________

   [7][back] [8]www@@openbsd.org
   $OpenBSD: obsd-faq.txt,v 1.6 1999/06/25 18:53:51 ericj Exp $

References

   1. http://www.openbsd.org/faq/index.html
   2. http://www.openbsd.org/faq/faq6.html
   3. http://www.openbsd.org/faq/faq8.html
   4. http://www.openbsd.org/faq/index.html
   5. http://www.openbsd.org/faq/faq6.html
   6. http://www.openbsd.org/faq/faq8.html
   7. http://www.openbsd.org/faq/index.html
   8. mailto:www@@openbsd.org


   [1][Back to Main Index] [2][To Section 7.0 - Keyboard controls] [3][To
   Section 9.0 - Tips for linux users]

                            8.0 - General Questions

8.1 - What are these Kerberos warning when I first login?

   When you first install your system you will most likely notice a
   warning message that is something like this:

   Warning: no Kerberos tickets issued.

   THIS WARNING IS COMPLETELY IRRELEVANT AND SHOULD ONLY BE REMOVED IF
   COMPLETELY NECESSARY

   Well since you probably haven't set up Kerberos on your system, you
   wouldn't be getting a ticket. If you do have Kerberos running, you
   need to check into that. If you can't STAND that warning and never
   plan on using Kerberos here is how to get rid of it for good.

     * Make sure you have the source code.
     * Edit /usr/share/mk/bsd.own.mk and set KERBEROS to 'no', or create
       an /etc/mk.conf file that does this.
     * cd /usr/src/usr.bin/login ; make clean ; make ; make install

8.2 - How do I change virtual terminals?

   Simply type [ctrl] - [alt] - [One of the function keys] or just hit
   [f9]-[f12] which are just mapped to [ctrl] - [alt]
   functions. (i386)

   Only the i386 arch has virtual terminal capabilities. You can also use
   virtual terminals when using X. For example, If you start X on term 1,
   and switch with [ctrl]-[alt]-[F2] to term 2, X will seem to disapear
   and will not come back by simply switching back to term 1. You must
   [ctrl]-[alt]-[F5] to get your X display back.

8.3 - I forgot my root password, what do I do now?

   A few steps to recovery
    1. Boot into single user mode. For i386 arch type boot -s at the boot
       prompt.
    2. mount the drives.
          + bsd# fsck -p / && mount -u /
          + if /usr is on a different partition you need to mount that
            also
    3. type passwd
    4. boot into mulituser mode.. and REMEMBER your password .

8.4 - X wont start, I get tons of error messages

   If you have X completely set up and you are using an XF86Config that
   you know works then the problem most likely lies in the
   machdep.allowapature. You also need to make sure that both:

option XSERVER
option APERTURE

   are in you kernel configuration. [BOTH these are in the GENERIC
   kernel]

   Then you need to edit /etc/sysctl.conf
   and set machdep.allowaperture=1. This will allow X to access the
   aperture driver. This would be set up if the question during install
   about whether or not you would be running X was answered correctly.
   OpenBSD 2.4 requires for all X servers that the aperture driver be
   set, because it controls access to the I/O ports on video boards.

   For other X problems on the i386, consult the XFree86 FAQ at
   [4]http://www.xfree86.org/FAQ/.

8.5 - What is CVS? and How do I use it?

   CVS is what the OpenBSD project uses to control changes to the source
   code. CVS stands for Concurrent Versions System. You can read more
   about CVS at [5]http://www.cyclic.com/. CVS can be used by the end
   user to keep up to date with source changes, and changes in the ports
   tree.

   CVS makes it extremely simple to download the source via one of the
   many CVS mirrors for the project.

   Here are some simple commands to get you going on CVS.

   For all these commands a CVSROOT variable must be set. You can do this
   by:

   If you use csh or tcsh use:
   bsd# setenv CVSROOT anoncvs@@anoncvs.ca.openbsd.org:/cvs

   or if you use sh or ksh use:
   bsd# export CVSROOT="anoncvs@@anoncvs.ca.openbsd.org:/cvs"

   It is best to try to find a mirror that is closest to you. You can
   obtain a list of CVS mirrors from
   [6]http://www.openbsd.org/anoncvs.html.

   All these commands are run from the /usr directory if you do not have
   the source code already. The source or ports however can be initially
   downloaded in tarred and gzipped form from any of the ftp servers.
   They are set and ready to be used with CVS.

     * bsd# cvs -q get -PAd src [to get source code] or
     * bsd# cvs -q get -PAd ports [to get the ports tree]

   If you already have an existing source or ports tree:
     * bsd# cvs -q up -PAd src
     * bsd# cvs -q up -PAd ports

   For some, bandwidth and time are serious problems when updating
   repository's such as these. So CVS has a -z[1-9] option which uses
   gzip to compress the data. To use it, do -z[compression-level], for
   instance, -z3 for a compression level of 3.

   There are many different connections you can make to a CVS mirror.
   This is to accompany people from all types of networks, whether you
   are behind a firewall, etc.

   You can make either a ssh, rsh, or pserver connection to the servers.
   Many mirrors also run ssh on port 2022.

   To do this you can use the variable $CVS_RSH. rsh(1) is what CVS uses
   by default, but using the $CVS_RSH environment variable you can have
   CVS use ssh.
   An example:

   #setenv CVS_RSH /usr/local/bin/ssh
   or
   #export CVS_RSH=/usr/local/bin/ssh

8.6 - What is the ports tree?

   The ports tree is a set of Makefiles that download, patch, configure
   and install userland programs so you can run them an OpenBSD
   environment without having to do all that by hand. You can get the
   ports tree from any of the OpenBSD ftp servers in
   /pub/OpenBSD/2.5/ports.tar.gz or try the latest updates in
   /pub/OpenBSD/snapshots/ports.tar.gz.

   If you want to run one of the latest ports collections, you'll need to
   update your /usr/share/mk/ directory. CVS up your /usr/src/ directory
   and do a:
# cd /usr/src/share/mk/
# make install

   first.

   In 2.5-current this information is now stored in the ports tree. In
   ports/infrastructure/ all thats left in /usr/src/share/mk for ports is
   just a pointer to this new area.

   Ports are set up to be EXTREMELY easy to make and install. Here is an
   example install for someone wanting to install the X11 program xfig.
   You'll notice the dependencies are automaticly detected and completed:

fenetyllin:/usr/ports/graphics/xfig# make install
===>  Extracting for xfig-3.2.2
===>  xfig-3.2.2 depends on shared library: jpeg.62. - /usr/local/lib/libjpeg.s
o.62.0 found
===>  xfig-3.2.2 depends on shared library: Xaw3d.6. - not found
===>  Verifying install for Xaw3d.6. in /usr/ports/x11/Xaw3d
>> Xaw3d-1.3.tar.gz doesn't seem to exist on this system.
>> Attempting to fetch from ftp://crl.dec.com/pub/X11/contrib/widgets/Xaw3d/R6.
1/.
Connected to crl.dec.com.
220 crl.dec.com FTP server (Digital UNIX Version 5.60) ready.
331 Guest login ok, send ident as password.
230 Guest login ok, access restrictions apply.
Remote system type is UNIX.
Using binary mode to transfer files.
200 Type set to I.
250 CWD command successful.
250 CWD command successful.
Retrieving pub/X11/contrib/widgets/Xaw3d/R6.1/Xaw3d-1.3.tar.gz
local: Xaw3d-1.3.tar.gz remote: Xaw3d-1.3.tar.gz
227 Entering Passive Mode (192,58,206,2,5,14)
150 Opening BINARY mode data connection for Xaw3d-1.3.tar.gz (0.0.0.0,0) (29027
7 bytes).
100% |**************************************************|   283 KB    00:00 ETA
226 Transfer complete.
290277 bytes received in 101.09 seconds (2.80 KB/s)
221 Goodbye.
===>  Extracting for Xaw3d-1.3
/bin/mkdir -p /usr/ports/x11/Xaw3d/work/xc/lib/Xaw3d/X11/Xaw3d
cd /usr/ports/x11/Xaw3d/work/xc/lib/Xaw3d/X11/Xaw3d; ln -sf ../../*.h .
===>  Patching for Xaw3d-1.3
===>  Configuring for Xaw3d-1.3
mv -f Makefile Makefile.bak
imake -DUseInstalled -I/usr/X11R6/lib/X11/config
make Makefiles
[snip]

   You can see a list of both ports and packages by using the pkg_info
   command.
bsd# /usr/sbin/pkg_info
zsh-3.0.5           The Z shell.
screen-3.7.4        A multi-screen window manager.
ssh-1.2.21          Secure shell client and server (remote login program).
emacs-20.2          GNU editing macros.
lynx-2.7.1ac-0.107  An alphanumeric display oriented World-Wide Web Client.
tcsh-6.07.02        An extended C-shell with many useful features.
bash-2.01           The GNU Borne Again Shell.
zip-2.2             Create/update ZIP files compatabile with pkzip.
mm-2.7              Implementation of MIME, the Multipurpose Internet Mail Exte
n
ircii-2.8.2-epic3.004 An enhanced version of ircII, the Internet Relay Chat cli
ent
ispell-3.1.20       An interactive spelling checker.
tin-1.3.970930      TIN newsreader (termcap based)
procmail-3.11p7     A local mail delivery agent.
strobe-1.03         Fast scatter/gather TCP port scanner
lsof-4.15           Lists information about open files.
xntp3-5.92          Network Time Protocol Implementation.
ncftp-2.4.3
 nmh-0.27            The New MH mail handling program
bzip2-0.1p12        A block-sorting file compressor

   If you are looking for a specific program in the ports tree, you can
   try
fenetyllin:/usr/ports/# make search key="xfig"
Port:   xfig-3.2.2
Path:   /home/ports/graphics/xfig
Info:   A drawing program for X11
Maint:  angelos@@openbsd.org
Index:  graphics x11
B-deps: Xaw3d-1.3 jpeg-6b
R-deps: Xaw3d-1.3 ghostscript-5.10 gv-3.5.8 jpeg-6b png-1.0.2 transfig-3.2.1
Archs:  any

Port:   transfig-3.2.1
Path:   /home/ports/print/transfig
Info:   Tools to convert Xfig's .fig files.
Maint:  angelos@@openbsd.org
Index:  print
B-deps: jpeg-6b
R-deps: ghostscript-5.10 jpeg-6b png-1.0.2
Archs:  any
[snip]

   More information about the ports can be found in the ports man page

   Our ports tree is constantly being expanded, and if you would like to
   help please see: [7]http://www.openbsd.org/ports.html

8.7 - What are packages?

   Packages are the precompiled binaries of some of the most used
   programs. They are ready for use on an OpenBSD system. Again, like the
   ports, packages are very easy to maintain and update. Packages are
   constantly being added so be sure to check each release for additional
   packages.

   Here is a list of tools used in managing packages.
     * pkg_add (1) - a utility for installing software package
       distributions
     * pkg_create (1) - a utility for creating software package
       distributions
     * pkg_delete (1) - a utility for deleting previously installed
       software package distributions
     * pkg_info (1) - a utility for displaying information on software
       packages

   Here is a sample user installing ispell via a package:

   bsd# pkg_add
   ftp://ftp.openbsd.org/pub/OpenBSD/2.5/packages/${arch}/ispell-3.1.20.t
   gz
   where ${arch} is your architecture

   Again, like with ports you can use the pkg_info(1) program to view
   what is already installed on your system.

   To delete packages you will want to use the pkg_delete(1) command. It
   is used the same way as pkg_add(1).

   bsd# /usr/sbin/pkg_delete ispell-3.1.20

   and it is gone.

   Packages can be found on any of the OpenBSD ftp mirror sites.
   [8]Http://www.OpenBSD.org/ftp.html
   or they can be found on your OpenBSD CD's.

8.8 - Is there any way to use my floppy drive if it's not attached during boot?

   Sure. You need to add "flags 0x20" at the end of the fd* entry and
   recompile your kernel. The line should be read:
   fd* at fdc? drive ? flags 0x20

   After that you would be able to use the floppy drive all the time. It
   doesn't matter if you plugged it later after boot.

8.9 - Boot time Options - Using the OpenBSD bootloader

   When booting your OpenBSD system, many of you have probobly noticed
   the boot prompt.

   boot>

   For most people, you won't have to do anything here. It will
   automatically boot if no commands are given. But sometimes problems
   arise, or special functions are needed. Thats where these options will
   come in handy. To start of, you should read through the [9]boot(8) man
   page. Here we will go over the most common used commands for the
   bootloader.

   To start off, if no commands are issued, the bootloader will
   automatially try to boot /bsd. If that fails it will try /obsd, and so
   on till it finds a bootable kernel. You can specify this by hand by
   typing:

   boot> boot wd0a:/bsd
   or
   boot> b /bsd

   This will work if device wd0a is configured as your root device.

   Here is a quick overview of options to be used with the boot
       parameter.
     * -a : This will allow you to specify an alternate root device after
       booting the kernel.
     * -c : This allows you to enter the boot time configuration. Check
       the [10]Boot Time Config section of the faq.
     * -s : This is the option to boot into single user mode.
     * -d : This option is used to dump the kernel into ddb. Keep in mind
       that you must have DDB built into the kernel.
     * -b : Shortcut for RB_HALT.

   These are entered in the format of:
   boot [ image [-abcds]]

   For further reading you can read [11]boot_i386(8) man page

   [12][Back to Main Index] [13][To Section 7.0 - Keyboard controls]
   [14][To Section 9.0 - Tips for linux users]
     _________________________________________________________________

   [15][back] [16]www@@openbsd.org
   $OpenBSD: obsd-faq.txt,v 1.6 1999/06/25 18:53:51 ericj Exp $

References

   1. http://www.openbsd.org/faq/index.html
   2. http://www.openbsd.org/faq/faq7.html
   3. http://www.openbsd.org/faq/faq9.html
   4. http://www.xfree86.org/FAQ/
   5. http://www.cyclic.com/
   6. http://www.openbsd.org/anoncvs.html
   7. http://www.openbsd.org/ports.html
   8. http://www.openbsd.org/ftp.html
   9. http://www.openbsd.org/cgi-bin/man.cgi?query=boot&sektion=8&format=html
  10. http://www.openbsd.org/faq/faq5.html#5.4
  11. http://www.OpenBSD.org/cgi-bin/man.cgi?query=boot_i386&sektion=8&format=html
  12. http://www.openbsd.org/faq/index.html
  13. http://www.openbsd.org/faq/faq7.html
  14. http://www.openbsd.org/faq/faq9.html
  15. http://www.openbsd.org/faq/index.html
  16. mailto:www@@openbsd.org


   [1][Back to Main Index] [2][To Section 8.0 - General Questions] [3][To
   Section 10.0 - System Administration]

                          9.0 - Migrating from Linux
     _________________________________________________________________

9.1 - Simple tips for Linux users

   There are several differences between OpenBSD and Linux. These
   differences include but are not limited to, bootup procedure, network
   interface usage and disk management. Most differences are well
   documented, but involve searching manpages. This document tries to be
   an index of those differences.

     * OpenBSD has a ports tree. This is to accomodate the fact that at
       this point not many applications are native to the OpenBSD
       environment. This is both an attempt to get applications to work
       on OpenBSD for end-users and to get more applications made with
       OpenBSD in mind. Eventually this ports tree will be used to make a
       nice set of binary packages.
     * OpenBSD uses CVS for source changes. Unlike Linux which is done
       primarily thru separate distributions, OpenBSD uses CVS which
       allows anyone to extract the full source tree at ANY given time.
       OpenBSD also does periodically release snapshots for various
       architectures and makes a CD release every 6 months.
     * OpenBSD contains STRONG CRYPTO, which USA based OS's can't
       contain. (See [4]http://www.openbsd.org/crypto.html) OpenBSD has
       also gone thru heavy security auditing and many security features
       have already been implemented into the source tree. (IPSEC,
       KERBEROS).
     * OpenBSD's kernel is /bsd.
     * The names of hard disks are usually /dev/wd and /dev/sd (ATA/SCSI)
     * /sbin/ifconfig with no arguments in Linux gives the state of all
       the interfaces. Under OpenBSD you need the -a flag.
     * /sbin/route with no arguments in Linux gives the state of all the
       active routes. Under OpenBSD you need the "show" parameter, or do
       a netstat -r (nice).
     * IP-Masquerading is done through ipnat. ([5]ipnat(1))
     * ipfwadm is done through ipf ([6]ipf(1), [7]ipf(5))
     * Interface address is stored in /etc/hostname.<interfacename>. It
       can be a name instead of an IP address.
     * The machine name is in /etc/myname
     * The default gateway is in /etc/mygate
     * The network interface aliases are in /etc/ifaliases
     * OpenBSD's default shell is csh. Shells such as bash and tcsh can
       be added as packages or installed from the ports tree.
     * Password management changes a lot. The main files are different.
       ([8]passwd(1), [9]passwd(5))

9.2 - Dual booting Linux and OpenBSD

   Yes! it is possible!

   Read [10]INSTALL.linux

   [11][Back to Main Index] [12][To Section 8.0 - General Questions]
   [13][To Section 10.0 - System Administration]
     _________________________________________________________________

   [14][back] [15]www@@openbsd.org
   $OpenBSD: obsd-faq.txt,v 1.6 1999/06/25 18:53:51 ericj Exp $

References

   1. http://www.openbsd.org/faq/index.html
   2. http://www.openbsd.org/faq/faq8.html
   3. http://www.openbsd.org/faq/faq10.html
   4. http://www.openbsd.org/crypto.html
   5. http://www.openbsd.org/cgi-bin/man.cgi?query=ipnat&apropos=0&sektion=1&format=html
   6. http://www.openbsd.org/cgi-bin/man.cgi?query=ipf&apropos=0&sektion=1&format=html
   7. http://www.openbsd.org/cgi-bin/man.cgi?query=ipnat&apropos=0&sektion=5&format=html
   8. http://www.openbsd.org/cgi-bin/man.cgi?query=passwd&apropos=0&sektion=1&format=html
   9. http://www.openbsd.org/cgi-bin/man.cgi?query=passwd&apropos=0&sektion=5&format=html
  10. http://www.openbsd.org/faq/INSTALL.linux
  11. http://www.openbsd.org/faq/index.html
  12. http://www.openbsd.org/faq/faq8.html
  13. http://www.openbsd.org/faq/faq10.html
  14. http://www.openbsd.org/faq/index.html
  15. mailto:www@@openbsd.org


   [1][Back to Main Index] [2][To Section 9.0 - Migrating from Linux]
   [3][To Section 11.0 - OpenBSD 2.4 Specific Information]

                         10.0 - System Administration
     _________________________________________________________________

10.1 - Why does it say that I'm in the wrong group when I su to root?

   To be able to use [4]su(1) to root you must be in group 0, "wheel".
   This MUST be placed specifically in /etc/group. It isn't enough to
   have them listed in /etc/passwd. Once this is done you should be able
   to su correctly.

10.2 - How do I duplicate a filesystem?

   Use dump/restore. For example. To duplicate everything under directory
   SRC to directory DST, do a:
# cd /SRC; dump 0f - . | (cd /DST; restore -rf - )

10.3 - How do I get httpd, sendmail, etc to startup with the system?

   OpenBSD uses rc-style startup to control starting applications with
   the system. For common daemons you can simply edit [5]/etc/rc.conf.
   For example: To have ftpd started on boot change -
ftpd_flags=NO -- > ftpd_flags="-D"

   You can add any flags that you wish ftpd to start with.

   If you have your own daemon's that you want to be started, here is a
   simple entry that you can put into /etc/rc.local.
if [ -x /usr/local/sbin/mydaemon ]; then
        echo -n ' mydaemon';       /usr/local/sbin/mydaemon
fi

   Once in there, it will come up with the system each time.

10.4 - Why do users get relaying access denied when they are remotely sending
mail through my OpenBSD system?

   Try this:
cat /etc/sendmail.cf | grep relay-domains

   The output may look something like this:
FR-o /etc/mail/relay-domains

   If this file doesn't exist, create it. You will need to enter the
   users who are sending mail remotely with the following syntax:
.domain.com    #if it is dynamic
sub.domain.com #if static

   Don't forget to:
kill -1 `cat /var/run/sendmail.pid`

10.5 - I've set up POP, but users have trouble accessing mail thru POP. What
can i do?

   Most issues dealing with pop are accessing files, mainly temp files.
   Some clients give errors such as:
-ERR Couldn't open temporary file, do you own it?K

   Try setting up your permissions as such:
permission in  /var
drwxrwxr-x   2 bin     mail     512 May 26 20:08 mail


permissions in  /var/mail
-rw-------   1 username   username        0 May 26 20:08 username

   Double check that the user owns his file in /var/mail , this should be
   done by default.

10.6 - Setting up a Secure HTTP server with SSL(8)

   This will take you through all the steps it takes to set up your own
   Secure HTTP server. Since the OpenBSD 2.5 release, OpenBSD has shipped
   with ssleay. Because of copyrighted RSA algorigthms, these cannot be
   shipped with OpenBSD. libssl includes support for SSL version 2, SSL
   version 3, and TLS version 1. So for now, because of copyright
   restictions, OpenBSD must ship without a fully-functional libssl. But
   it is still completely useable. If you are able to use the RSA
   patented library's you can easily upgrade your libssl with a command
   like this.

   #pkg_add
   ftp://ftp.openbsd.org/pub/OpenBSD/${ver}/packages/${arch}/libssl-1.1.t
   gz
   Where ${ver} is the OpenBSD version number, and ${arch} is your
   architecture.

   The steps shown here are taken pretty much from the [6]ssl(8) man
   page. So you can refer to that for further information. Also, this faq
   will only go over creating a RSA certificate for web servers, not a
   DSA server certificate. To find out how to do so, please refer to the
   ssl(8) man page.

   I will no show how to create your key and certificate. These will go
   to /etc/ssl/private/. This means that you will have to have upgraded
   your libssl. Now we can create our key. You can do so with a line like
   such:

   # ssleay genrsa -out /etc/ssl/private/server.key 1024

   This will create a key of 1024 bits. Next you need to create a
   Certificate Signing Request which is used to get a CA or Certificate
   Authority to sign your key. Here is the command to do so.

   # ssleay req -new -key /etc/ssl/private/server.key -out
   /etc/ssl/private/server.csr

   You would now give /etc/ssl/private/server.csr to the CA to get it
   signed. Or you could also sign the certificate for yourself. Here is
   how you would do this.

   # ssleay x509 -req -days 365 -in /etc/ssl/private/server.csr -signkey
   /etc/ssl/private/server.key -out /etc/ssl/server.crt

   This will sign your key, and it will be valid for up to 365 days. With
   this done you can now start the httpd server. To start httpd(8) with
   ssl you must start the daemon with the -DSSL flag. You can start this
   on boot in /etc/rc.conf by changing the httpd line to look like so:

httpd_flags="-DSSL"

   This server will run on port 443.

10.7 - I edited /etc/passwd with vi(1), but the changes didn't seem to take
place. Why?

   Changes will not be made right away because OpenBSD has a user
   database which needs updated when changes are made in /etc/passwd.
   Tools are made to do this immediatly for you though. You should use
   vipw(8) to edit the passwd file by hand. This will allow for checking
   of the passwd file before entering it into the database and after the
   check is done it will automatically execute pwd_mkdb(8). If you have
   made changes, without using a tool such as vipw, you can run
   pwd_mkdb(8) by hand.

10.8 - What is the best way to add users? and delete them?

   The best way to add a user in OpenBSD is to use the [7]adduser(8)
   script. You can configure this to work however you like by editing
   /etc/adduser.conf. You can add users by hand, but this is the
   recommended way to addusers. adduser(8) allows for consistancy checks
   on /etc/passwd, /etc/group, and shell databases. It will create then
   entries for you, and HOME directory, and even send a message to the
   user welcoming them. This can be changed to meet your needs. For
   further instructions on adding users read the [8]adduser_proc(8) man
   page.

   To delete users you should use the [9]rmuser(8) utility. This will
   remove all existance of a user. It will remove any crontab(1) entries,
   their HOME dir (if it is owned by the user). Along with their
   /etc/passwd and /etc/group entries.

10.9 - How do i create an ftp-only account?

   There are a few ways to do this, but a very common way to do such is
   to add /usr/bin/false into /etc/shells. Then when you create the user
   set his shell to /usr/bin/false, this they he will not be able to get
   a shell but will be able to keep their ftp capabilities. adduser(8)
   will give them a home dir by default of /home/foo. If this is what you
   desire it doesn't need to be changed, however you can set this to
   whatever directory you wish.

10.10 - Setting up Quota's

   Quota's are used to limit users space that they have available to them
   on your drives. It can be very helpfull in situations of limited
   resources. quota's can be set in two different ways.

     * 1 - User Quota's
     * 2 - Group Quota's

   The first step to setting up quota's is to make sure that option QUOTA
   is in your Kernel Configuration. This option is in the GENERIC kernel.
   After this you need to mark in /etc/fstab the filesystems which will
   have quota's enabled. The keywords userquota and groupquota should be
   used to mark each fs that you will be using quota's on. By default the
   files quota.user and quota.group will be created at the root of that
   filesystem to hold the quota information. This default can be
   overwritten by doing, userquota=/var/quotas/quota.user. Or whatever
   file you want to use for holding quota information. Here is an example
   /etc/fstab that has one filesystem with userquota's enabled.

/dev/wd0a / ffs rw,userquota=/var/quotas/quota.user 1 1

   Now it's time to set the users quota's. To do so you use the utility
   [10]edquota(8) . A simple use is just edquota < user >. edquota(8)
   will use vi(1) to edit the quota's unless the environmental variable
   EDITOR is set to a different editor. For example:

   #edquota ericj

   This will give you output similar to this:

Quotas for user ericj:
/: blocks in use: 62, limits (soft = 0, hard = 0)
        inodes in use: 25, limits (soft = 0, hard = 0)

   To add limits, edit it to something similar to this:

Quotas for user ericj:
/: blocks in use: 62, limits (soft = 1000, hard = 1050)
        inodes in use: 25, limits (soft = 0, hard = 0)

   In this the softlimit is set to 1000 blocks and the hardlimit is set
   to 1050 blocks. A softlimit is a limit where the user is just warned
   when they cross it and have until their grace period is up to get
   their disk usage below their limit. Grace period's can be set by using
   the -t option on edquota(8). After the grace period is over the
   softlimit is handled as a hardlimit. This usually results in an
   allocation failure.

   Now that the quota's are set you, you need to turn the quota's on. To
   do this use [11]quota(1). Using a command of quota < user > will give
   that users info. quota with no arguments will give your quota
   statistics. For example:

# quota ericj

   Will result in output similar to this:

Disk quotas for user ericj (uid 1001):
     Filesystem  blocks   quota   limit   grace   files   quota   limit   grace
              /      62    1000    1050              27       0       0

   By default quota's set in /etc/fstab will be started on boot. To turn
   them of use quotaoff -a

   [12][Back to Main Index] [13][To Section 9.0 - Migrating from Linux]
   [14][To Section 11.0 - OpenBSD 2.4 Specific Information]
     _________________________________________________________________

   [15][back] [16]www@@openbsd.org
   $OpenBSD: obsd-faq.txt,v 1.6 1999/06/25 18:53:51 ericj Exp $

References

   1. http://www.openbsd.org/faq/index.html
   2. http://www.openbsd.org/faq/faq9.html
   3. http://www.openbsd.org/faq/faq24.html
   4. http://www.openbsd.org/cgi-bin/man.cgi?query=su&apropos=0&sektion=1&format=html
   5. http://www.openbsd.org/cgi-bin/cvsweb/src/etc/rc.conf?rev=1.35
   6. http://www.openbsd.org/cgi-bin/man.cgi?query=ssl&apropos=0&sektion=8&format=html
   7. http://www.openbsd.org/cgi-bin/man.cgi?query=adduser&sektion=8&format=html
   8. http://www.openbsd.org/cgi-bin/man.cgi?query=adduser_proc&sektion=8&format=html
   9. http://www.openbsd.org/cgi-bin/man.cgi?query=rmuser&sektion=8&format=html
  10. http://www.openbsd.org/cgi-bin/man.cgi?query=edquota&sektion=8&format=html
  11. http://www.openbsd.org/cgi-bin/man.cgi?query=quotaon&sektion=8&format=html>quotaon(8)</a>.Forexample:</p><p><pre># quotaon -a </pre> </p> <p> This will go thru /etc/fstab to turn on the filesystems with quota options. Now that quota's are up and running, you can view them by the <a href=
  12. http://www.openbsd.org/faq/index.html
  13. http://www.openbsd.org/faq/faq9.html
  14. http://www.openbsd.org/faq/faq24.html
  15. http://www.openbsd.org/faq/index.html
  16. mailto:www@@openbsd.org


   [1][Back to Main Index] [2][To Section 10.0 - System Administration]
   [3][To Section 12.0 - Performance Tuning]

                    11.0 - OpenBSD 2.4 Specific Information
     _________________________________________________________________

11.1 - In 2.4 why do I get UserDir error when running httpd?

   It seems as though userdir support was left out of 2.4. Make sure to
   pick up the patch at:

   [4]http://www.openbsd.org/errata.html

11.2 - Installing at a partition 4GB or higher

   The 2.4 cd's shipped with a problem in installboot. A patch can be
   obtained here [5]http://www.openbsd.org/errata.html. This is fixed in
   -current.

   To place the partition boot record, installboot used a 32 bit
   multiplication for the sectors times the sectorsize which is larger
   than 2^32 -1 (i.e. multiplication overflow) when the partition starts
   at 4 GB or higher. This means the pbr is installed in the reall
   partition address modulo 4GB. It's still possible to install at >= 4GB
   with some effort:

   You have 2 Options for doing so with OpenBSD 2.4. If you have Linux or
   any other unix like OS, you should back up the sectors first before
   trying anything.

     * Suppose the partition starts at cylinder 611, and the drive has
       255 heads, 63 sectors: offset for the obsd partition is
       611*255*63= 9815715 sectors. multiply this by 512 and you get:
       5025646080. 5025646080 mod 2^32 = 730678784
       (You can just subtract 2^32 on a hand calculator...) dividing by
       512 gives sector 1427107.
       Ok, suppose were now in linux (where cylinder numbers are 1 higher
       btw..) and that the obsd partition is DOS partition 4:
       dd if=/dev/hda of=backup.txt skip=1427107 bs=512 count=1
       will backup the data that installboot will nuke ..
       Now install OpenBSD. Return to Linux.
       Now we're going to copy the partition boot record to the right
       place.
       dd if=/dev/hda of=pbr.txt skip=1427107 bs=512 count=1
       dd if=/pbr.txt of=/dev/hda4 bs=512 count=1
       (adding obsd to lilo should now work)
       Now write back the nuked sector:
       dd if=/backup.txt of=/dev/hda seek=1427107 bs=512 count=1
       Caveat: make sure that whatever gets nuked by installboot isn't
       essential to running dd (and starting the other OS). Backing up
       the affected partition is recommended.
     * Use a correct version of installboot (compiled for you by another
       OBSD'er ..):
       put it on another partition, e.g. a DOS partition. Suppose wd0j is
       the DOS partition (see disklabel wd0, this is in case of IDE
       disks), and installboot is named installb there.
       After booting from floppy/CD, press ^C to get into the shell:
          + mkdir dos
          + mount /dev/wd0j dos
          + cp dos/tmp/installb /usr/mdec/installboot

   Now enter 'install' and the installation procedure should use the new
   installboot.

   [6][Back to Main Index] [7][To Section 10.0 - System Administration]
   [8][To Section 12.0 - Performance Tuning]
     _________________________________________________________________

   [9][back] [10]www@@openbsd.org
   $OpenBSD: obsd-faq.txt,v 1.6 1999/06/25 18:53:51 ericj Exp $

References

   1. http://www.openbsd.org/faq/index.html
   2. http://www.openbsd.org/faq/faq10.html
   3. http://www.openbsd.org/faq/faq12.html
   4. http://www.openbsd.org/errata.html#userdir
   5. http://www.openbsd.org/errata.html#installboot
   6. http://www.openbsd.org/faq/index.html
   7. http://www.openbsd.org/faq/faq24.html
   8. http://www.openbsd.org/faq/faq12.html
   9. http://www.openbsd.org/faq/index.html
  10. mailto:www@@openbsd.org

$OpenBSD: obsd-faq.txt,v 1.6 1999/06/25 18:53:51 ericj Exp $

Warning: this document is currently being reviewed. It's not yet complete,
and probably contains loads of errors. As an example, I can't figure out
why Linux doesn't need mkswap as it shares the exact same blocks with
OpenBSD.


   Linux + OpenBSD: it's possible

   by Marc Espie --  Marc.Espie@@OpenBSD.org

It is perfectly possible to have Linux and OpenBSD on the same disk.
As of this writing, OpenBSD can read and write Linux' partitions, whereas
Linux cannot access OpenBSD partitions (they differ from NetBSD partitions).

You can even install OpenBSD from an ext2fs partition (choose install from
disk... ext2fs does not appear in the choices, but `default' it is).

First, make a bootable floppy of Linux.  Then, you  have to find some room
for OpenBSD.  Don't worry about swap space: you can share Linux' swap
partition.

If you want to grab space from a Windows/DOS partition, use fips.
Fips20 knows all about FAT32, so windows 95 is no longer a problem.

Other sources of information, especially concerning other BSD systems,
must be taken with a healthy does of scepticism.

First principles
----------------
OpenBSD does not use the DOS partitions for more than booting.  You just
need a small DOS partition to put your OpenBSD root.  Afterwards, OpenBSD
heeds some other information entirely, called the BSD disklabel.  This
disklabel is another completely distinct description of your hard disk.
It does not even have to be consistent with the usual DOS partitions
information.

Throughout this document, we will distinguish between DOS partitions and
BSD partitions whenever this is necessary.

For consistency, it's better if all parts of the disks that
are actually used by OpenBSD are flagged as occupied, type A6, though it
is not necessary.  The only part of the disk that should appear both as a BSD
partition and as a DOS partition is the root partition: it MUST begin on
the same sector for the boot process to work.

One way to visualize things is to picture OpenBSD embedded inside DOS
partitions: the DOS partitions used by OpenBSD may each contain several
OpenBSD partitions. As long as the DOS partition table has the right
start and length for each partition it will be kept happy.

The OpenBSD disklabel is just another mechanism that yield another
description of the disk. It is vitally important that the BSD root
partition start precisely where the corresponding DOS partition is supposed
to start, and it is better when all BSD partitions stay inside their
DOS partitions boundaries.  Apart from OpenBSD partitions proper, the
BSD disklabel can contain a BSD description of other DOS partitions, but
this is not mandatory. If you don't have any constraints, having a correct
description of all partitions is better, but with bigger disks, keep in mind
that OpenBSD disklabels can't hold more than 16 partitions.

Contrarily to popular belief, OpenBSD does *NOT* need one contiguous chunk
of the disk (a `slice' in FreeBSD lingo).  It is probably the simplest setup,
but other considerations (such as the need to boot several OS, and to have
several small primary partitions that all within the first  1024 BIOS
cylinders) may lead you to use two chunks for OpenBSD.

If you can, it is MUCH better to devote a full disk to OpenBSD: this limits
the number of mistakes you can do. Admittedly there are some cases where
this isn't a option (my machine is a laptop... I have to cope with the
hard disk I have).

Mapping your disk
-----------------
Starting from Linux, get a grasp of your partitions. Use df to check which
is what, then fdisk to get the actual setup of the disk.
Here is my disk:
--
Disk /dev/hda: 128 heads, 63 sectors, 993 cylinders
Units = cylinders of 8064 * 512 bytes

   Device Boot   Begin    Start      End   Blocks   Id  System
/dev/hda1            1        1      260  1048288+   6  DOS 16-bit >=32M
/dev/hda2          261      261      273    52416   83  Linux native
/dev/hda4          287      287      601  1270080    5  Extended
/dev/hda5          287      287      303    68512   82  Linux swap
/dev/hda6          304      304      456   616864+  83  Linux native
/dev/hda7          457      457      520   258016+  83  Linux native
/dev/hda8          521      521      537    68512+  83  Linux native
/dev/hda9          538      538      601   258016+  83  Linux native

(In case you're wondering, yes this is a big disk. The Linux playground is
large, the OpenBSD area will be huge. As a developer, I usually have loads
of source & binaries lying around... a simple OpenBSD installation can fit
within 300 Mb with room to spare.)
In my setup hda2 is /, hda6 is /usr, hda7 is /usr/local, hda8 is /var, and
hda9 is /home.

Get the display to sectors with u, and jot down the corresponding
information as well:
--
Disk /dev/hda: 128 heads, 63 sectors, 993 cylinders
Units = sectors of 1 * 512 bytes

   Device Boot   Begin    Start      End   Blocks   Id  System
/dev/hda1           63       63  2096639  1048288+   6  DOS 16-bit >=32M
/dev/hda2      2096640  2096640  2201471    52416   83  Linux native
/dev/hda4      2306304  2306304  4846463  1270080    5  Extended
/dev/hda5      2306368  2306368  2443391    68512   82  Linux swap
/dev/hda6      2443455  2443455  3677183   616864+  83  Linux native
/dev/hda7      3677247  3677247  4193279   258016+  83  Linux native
/dev/hda8      4193343  4193343  4330367    68512+  83  Linux native
/dev/hda9      4330431  4330431  4846463   258016+  83  Linux native

Okay, finally switch to expert mode, and note the corresponding data.
Disk /dev/hda: 128 heads, 63 sectors, 993 cylinders

Nr AF  Hd Sec  Cyl  Hd Sec  Cyl   Start    Size ID
 1 00   1   1    0 127  63  259      63 2096577 06
 2 00   0   1  260 127  63  272 2096640  104832 83
 3 00   0   0    0   0   0    0       0       0 00
 4 00   0   1  286 127  63  600 2306304 2540160 05
 5 00   1   2  286 127  63  302      64  137024 82
 6 00   1   1  303 127  63  455      63 1233729 83
 7 00   1   1  456 127  63  519      63  516033 83
 8 00   1   1  520 127  63  536      63  137025 83
 9 00   1   1  537 127  63  600      63  516033 83

Note that this is STILL the same data. The good point about this last
display is that it is almost what you're going to see in OpenBSD fdisk !

There are some differences though, mostly because Linux fdisk has made
some rather confusing choices:
- in simple mode it starts numbering cylinders at 1... whereas
everything else starts from 0.
- in simple mode it shows blocks of 1024 bytes, which makes for half-blocks
(marked with a +) and sizes halved from the real block size.
- in expert mode it shows extended partitions offset from the start
of the extended partition.
- the hd/sec/cyl is a confusing order, as the sector number is computed
from cyl/hd/sec, in that order.
- it never shows and doesn't care about the real disk geometry.

You will notice that the 3rd primary partition is empty... this is where
I intend to stick my OpenBSD root partition (both DOS and BSD partitions),
and that I have left cylinders 601--992 empty... this is where I intend to
stick the rest of OpenBSD.
After OpenBSD is installed, partition 3 will show up as:
/dev/hda3          274      274      286    52416   a6  Unknown
/dev/hda3      2201472  2201472  2306303    52416   a6  Unknown

(recent Linux fdisk will display a6 as OpenBSD, but they still don't know
how to deal with the disklabel. Important: NEVER use Linux fdisk to fiddle
with OpenBSD disklabels.)


Before starting to install OpenBSD, now would be a good time to check the
INSTALL.pt document...  Especially note the alignment restriction of
partitions (first sector of a partition must be at head 0, sector 1 of a
cylinder). This is enforced by Linux' fdisk.

The other point to note is that extended partitions are actually linked
lists. This will show up in OpenBSD' fdisk.

Your clock and OpenBSD
----------------------
OpenBSD expects your hardware clock to be in universal time, and uses
time zones to give you local time. With Linux, this depends...
most distributions use a small program called hwclock to set up the
system time from the hardware clock when booting... there is a --utc
option if your hardware clock is in universal time, but this is not
always what happens by default.

For instance, on a redhat 5.1 system, this happens in /etc/rc.d/rc.sysinit
which loads an /etc/sysconfig/clock that defines a variable called UTC, and
then proceeds calling hwclock.
- ensure UTC is set to true,
- adjust your hardware clock from the system time if necessary, e.g.,
hwclock --systohc --utc.

The Linux partition table and OpenBSD
-------------------------------------
There is a problem with many Linux rc that do mount all file systems even
in single-user mode.  After you've installed OpenBSD, if your Linux kernel
knows about BSD disklabels, it may insert lots of BSD partitions in its
list. Then, at the next reboot, you're in trouble. The simplest way around
this problem is probably to make sure you can boot from a Linux kernel
that doesn't know about disklabels.   Otherwise, you may wish to check
your inittab and your rc to make deadly sure that single-user boot
will work.

The OpenBSD installation
------------------------
If you've got the space, you can install from your ext2fs partitions. This
is what I did, as I have a slip connection to the rest of the world, and
the OpenBSD install floppy does not include slip.

REMEMBER TO BACKUP ALL IMPORTANT DATA ON YOUR DISK BEFORE DOING THE
INSTALLATION !!!

So you cp floppy*.fs /dev/fd0, then reboot...

First, the BSD kernel + ram disk loads, then there is a boot prompt, and
five seconds later, the boot proper starts.

After a while, you will see your disk configuration scroll by.  I got:
  wd0 at wdc0 drive 0: <TOSHIBA MK4006MAV>
  wd0: 3909MB, 7944 cyl, 16 head, 63 sec, 512 bytes/sec, 8007552 sec total
  wd0: using 16-sector 16-bit pio transfers, lba addressing

at which point I got somewhat confused, especially as this is a configuration w
ith
more than 1024 cylinders.  In fact, this is the actual disk geometry, when
you inquire about it, but the geometry that the BIOS does see IS the fdisk
geometry, with 993 cylinders.  As the 1024 cylinders is purely a BIOS
limitation, there is no actual trouble.

If you want to be sure, enquire at the boot prompt:
boot>machine diskconfig
before the automatic boot sequence continues.


Then I got into fdisk, and I proceeded to enter my new OpenBSD partition.
This is what the fdisk dump looked after my changes:

Disk: wd0       geometry: 992/128/63 [7999488 sectors]
Offset: 0       Signatures: 0xAA55,0x0
         Starting        Ending
 #: id  cyl  hd sec -  cyl  hd sec [     start -       size]
-------------------------------------------------------------------------
 0: 06    0   1   1 -  259 127  63 [        63 -    2096577] DOS > 32MB
 1: 83  260   0   1 -  272 127  63 [   2096640 -     104832] Linux files*
 2: A6  273   0   1 -  285 127  63 [   2201472 -     104832] OpenBSD
 3: 05  286   0   1 -  600 127  63 [   2306304 -    2540160] Extended DOS

Selected extended partition 3
New MBR at offset 2306304.
Offset: 2306304 Signatures: 0xAA55,0x0
         Starting        Ending
 #: id  cyl  hd sec -  cyl  hd sec [     start -       size]
-------------------------------------------------------------------------
 0: 82  286   1   2 -  302 127  63 [   2306368 -     137024] Linux swap
 1: 05  303   0   1 -  455 127  63 [   2443392 -    1233792] Extended DOS
 2: 00    0   0   0 -    0   0   0 [   2306304 -          0] unused
 3: 00    0   0   0 -    0   0   0 [   2306304 -          0] unused

Selected extended partition 1
New MBR at offset 2443392.
Offset: 2443392 Signatures: 0xAA55,0x0
         Starting        Ending
 #: id  cyl  hd sec -  cyl  hd sec [     start -       size]
-------------------------------------------------------------------------
 0: 83  303   1   1 -  455 127  63 [   2443455 -    1233729] Linux files*
 1: 05  456   0   1 -  519 127  63 [   3677184 -     516096] Extended DOS
 2: 00    0   0   0 -    0   0   0 [   2443392 -          0] unused
 3: 00    0   0   0 -    0   0   0 [   2443392 -          0] unused

Selected extended partition 1
New MBR at offset 3677184.
Offset: 3677184 Signatures: 0xAA55,0x0
         Starting        Ending
 #: id  cyl  hd sec -  cyl  hd sec [     start -       size]
-------------------------------------------------------------------------
 0: 83  456   1   1 -  519 127  63 [   3677247 -     516033] Linux files*
 1: 05  520   0   1 -  536 127  63 [   4193280 -     137088] Extended DOS
 2: 00    0   0   0 -    0   0   0 [   3677184 -          0] unused
 3: 00    0   0   0 -    0   0   0 [   3677184 -          0] unused

Selected extended partition 1
New MBR at offset 4193280.
Offset: 4193280 Signatures: 0xAA55,0x0
         Starting        Ending
 #: id  cyl  hd sec -  cyl  hd sec [     start -       size]
-------------------------------------------------------------------------
 0: 83  520   1   1 -  536 127  63 [   4193343 -     137025] Linux files*
 1: 05  537   0   1 -  600 127  63 [   4330368 -     516096] Extended DOS
 2: 00    0   0   0 -    0   0   0 [   4193280 -          0] unused
 3: 00    0   0   0 -    0   0   0 [   4193280 -          0] unused

Selected extended partition 1
New MBR at offset 4330368.
Offset: 4330368 Signatures: 0xAA55,0x0
         Starting        Ending
 #: id  cyl  hd sec -  cyl  hd sec [     start -       size]
-------------------------------------------------------------------------
 0: 83  537   1   1 -  600 127  63 [   4330431 -     516033] Linux files*
 1: 00    0   0   0 -    0   0   0 [         0 -          0] unused
 2: 00    0   0   0 -    0   0   0 [   4330368 -          0] unused
 3: 00    0   0   0 -    0   0   0 [   4330368 -          0] unused

Nothing to it... you just follow the extended partition links using select,
jot down whatever you need, add the OpenBSD partition to look like you want
it to, and save everything.

After you leave fdisk, you get to the interesting part: the disklabel
itself. If all goes well, OpenBSD synthesizes a nice disklabel out of what
it can deduce from the disk, including the ext2fs partitions.

There are only a few subtleties to take care of:
- initially, you can ONLY edit the disklabel part that matches the OpenBSD
DOS partition (a `slice' in FreeBSD lingo). You have to use b 0 *  before
you can edit the whole disk.
- the real disk geometry becomes relevant. The Berkeley fast file system
can't use partial cylinder groups, hence BSD partitions should start
on cylinder boundaries, as any remaining sectors  will be lost anyway.
- units for size and offset can be given as sectors (default) or cylinders.

After edition, this is what my disklabel looks like:

# using MBR partition 2: type A6 off 2201472 (0x219780) size 104832 (0x19980)
# /dev/rwd0c:
type: ESDI
disk:
label: TOSHIBA MK4006M
flags:
bytes/sector: 512
sectors/track: 63
tracks/cylinder: 16
sectors/cylinder: 1008
cylinders: 7944
total sectors: 8007552
rpm: 3600
interleave: 1
trackskew: 0
cylinderskew: 0
headswitch: 0           # milliseconds
track-to-track seek: 0  # milliseconds
drivedata: 0

16 partitions:
#        size   offset    fstype   [fsize bsize   cpg]
  a:   104832  2201472    4.2BSD     1024  8192    16   # (Cyl. 2184 - 2287)
  b:   137024  2306368      swap                        # (Cyl. 2288 - 2423*)
  c:  8007552        0    unused        0     0         # (Cyl.    0 - 7943)
  d:   409248  4846464    4.2BSD     1024  8192    16   # (Cyl. 4808 - 5213)
  e:   511056  5255712    4.2BSD     1024  8192    16   # (Cyl. 5214 - 5720)
  f:   204624  5766768    4.2BSD     1024  8192    16   # (Cyl. 5721 - 5923)
  g:  1073520  5971392    4.2BSD     1024  8192    16   # (Cyl. 5924 - 6988)
  h:   962640  7044912    4.2BSD     1024  8192    16   # (Cyl. 6989 - 7943)
  i:  2096577       63     MSDOS                        # (Cyl.    0*- 2079*)
  j:   104832  2096640    ext2fs                        # (Cyl. 2080 - 2183)
  l:  1233729  2443455    ext2fs                        # (Cyl. 2424*- 3647*)
  m:   516033  3677247    ext2fs                        # (Cyl. 3648*- 4159*)
  n:   137025  4193343    ext2fs                        # (Cyl. 4160*- 4295*)
  o:   516033  4330431    ext2fs                        # (Cyl. 4296*- 4807*)

Things to check:
- this disklabel is saved in MBR2 (basic DOS partition 2), as expected.
- all the BSD partitions proper are aligned on a cylinder boundary.
the root partition begins at the precise same offset the corresponding DOS
partition begins, and it extends for the same length.
Other BSD partitions don't show up in the DOS partition setup, hence they
begin precisely on cylinder 601/4808.
- the ext2fs partitions have the exact same layout under the OpenBSD
disklabel.

One point that is somewhat laborious is that the disklabel -E mode
(which you are currently using) tends to move partitions around to ensure
that ALL defined partitions are contiguous. Hence, you may need some fiddling
around and printing to ensure that Linux partitions do show up where they
should.  In my case, disklabel moved the swap and all the ext2fs partitions
slightly, and I add to adjust them manually...

Once the disklabel is written to disk, the installation proceeds as usual.

ext2fs partitions are perfectly usable from OpenBSD. My /home partition
is ext2fs, I have been using it for a week now without any trouble.

Booting
-------
First time I booted my system back, I did not get into OpenBSD as expected...
I plain forgot I had installed lilo in the master boot block, and lilo
does not heed the active partition flag. The fix was rather simple: from
the Linux system, I just had to edit lilo.conf to add the obsd entry:

boot=/dev/hda
map=/boot/map
install=/boot/boot.b
prompt
timeout=50
image=/boot/myvmlinuz
   label=linux
   root=/dev/hda2
   vga=4
   read-only
image=/boot/vmlinuz-2.0.34-1
   label=redhat
   root=/dev/hda2
   read-only
other=/dev/hda1
   label=dos
   table=/dev/hda
other=/dev/hda3
   label=obsd
   table=/dev/hda

rerun lilo, and voila, OpenBSD was able to boot !

Linux and OpenBSD partitions
----------------------------
As of 2.0.35/2.1.122, Linux does not support OpenBSD partitions. The way
the Linux kernel works is reasonably straightforward (code in
drivers/block/genhd.c): when detecting a BSD partition (type A5),
it checks and parses the first block for a disklabel, and use that
information to instantiate some new partitions,
that will show up in that drive's partition list, exactly like extended
partitions do show up. Unfortunately, that check is hard coded for a type A5
(NetBSD/FreeBSD) partition, and it recognizes 8 partitions disklabels only
anyway.

Just hacking the Linux code to recognize A6 is not quite enough.  You also
need to trim down the resulting list of partitions, as your ext2fs
partitions will now show up twice !
I'm experimenting with the following patch, which should make it to linux-kerne
l
soon:
--------------------------------------------------------------
diff -ur linux.orig/drivers/block/genhd.c linux/drivers/block/genhd.c
--- linux.orig/drivers/block/genhd.c
Mon Aug  4 20:45:35 1997
+++ linux/drivers/block/genhd.c
Thu Sep 24 18:55:31 1998
@@@@ -205,11 +206,46 @@@@
 }

 #ifdef CONFIG_BSD_DISKLABEL
+static void check_and_add_bsd_partition(struct gendisk *hd, struct bsd_partiti
on *bsd_p)
+{
+
struct hd_struct *lin_p;
+

/* check relative position of partitions.  */
+
for (lin_p = hd->part + 1; lin_p - hd->part < current_minor; lin_p++) {
+


/* no relationship -> try again */
+

if (lin_p->start_sect + lin_p->nr_sects <= bsd_p->p_offset
+


|| lin_p->start_sect >= bsd_p->p_offset + bsd_p->p_size)
+


continue;

+


/* equal -> no need to add */
+

if (lin_p->start_sect == bsd_p->p_offset &&
+


lin_p->nr_sects == bsd_p->p_size)
+


return;
+


/* bsd living within dos partition */
+

if (lin_p->start_sect <= bsd_p->p_offset && lin_p->start_sect
+


+ lin_p->nr_sects >= bsd_p->p_offset + bsd_p->p_size) {
+#ifdef DEBUG_BSD_DISKLABEL
+


printk("w: %d %ld+%ld,%d+%d",
+



lin_p - hd->part, lin_p->start_sect, lin_p->nr_sects,
+



bsd_p->p_offset, bsd_p->p_size);
+#endif
+


break;
+

}
+


/* ouch: bsd and linux overlap. Don't even try for that partition */
+#ifdef DEBUG_BSD_DISKLABEL
+

printk("???: %d %ld+%ld,%d+%d",
+


lin_p - hd->part, lin_p->start_sect, lin_p->nr_sects,
+


bsd_p->p_offset, bsd_p->p_size);
+#endif
+

printk("???");
+

return;
+
} /* if the bsd partition is not described by DOS, we end up there */
+
add_partition(hd, current_minor, bsd_p->p_offset, bsd_p->p_size);
+
current_minor++;
+}
 /*
  * Create devices for BSD partitions listed in a disklabel, under a
  * dos-like partition. See extended_partition() for more information.
  */
-static void bsd_disklabel_partition(struct gendisk *hd, kdev_t dev)
+static void bsd_disklabel_partition(struct gendisk *hd, kdev_t dev, int max_pa
rtitions)
 {

struct buffer_head *bh;

struct bsd_disklabel *l;
@@@@ -225,19 +261,15 @@@@


return;

}

-
p = &l->d_partitions[0];
-
while (p - &l->d_partitions[0] <= BSD_MAXPARTITIONS) {
+
if (l->d_npartitions < max_partitions)
+

max_partitions = l->d_npartitions;
+
for (p = l->d_partitions; p - l->d_partitions <  max_partitions; p++) {


if ((current_minor & mask) >= (4 + hd->max_p))



break;
-
-

if (p->p_fstype != BSD_FS_UNUSED) {
-


add_partition(hd, current_minor, p->p_offset, p->p_size);
-


current_minor++;
-

}
-

p++;
+

if (p->p_fstype != BSD_FS_UNUSED)
+


check_and_add_bsd_partition(hd, p);

}

brelse(bh);
-
 }
 #endif

@@@@ -248,6 +280,11 @@@@

struct partition *p;

unsigned char *data;

int mask = (1 << hd->minor_shift) - 1;
+#ifdef CONFIG_BSD_DISKLABEL
+
/* no bsd disklabel as a default */
+
kdev_t bsd_kdev = 0;
+
int bsd_maxpart;
+#endif
 #ifdef CONFIG_BLK_DEV_IDE

int tested_for_xlate = 0;

@@@@ -365,13 +402,29 @@@@




hd->part[minor].nr_sects = 2;


}
 #ifdef CONFIG_BSD_DISKLABEL
+


/* tag first disklabel for late recognition */


if (SYS_IND(p) == BSD_PARTITION) {
-


printk(" <");
-


bsd_disklabel_partition(hd, MKDEV(hd->major, minor));
-


printk(" >");
+


printk("!");
+


if (!bsd_kdev) {
+



bsd_kdev = MKDEV(hd->major, minor);
+



bsd_maxpart = BSD_MAXPARTITIONS;
+


}
+

} else if (SYS_IND(p) == OPENBSD_PARTITION) {
+


printk("!");
+


if (!bsd_kdev) {
+



bsd_kdev = MKDEV(hd->major, minor);
+



bsd_maxpart = OPENBSD_MAXPARTITIONS;
+


}


}
 #endif

}
+#ifdef CONFIG_BSD_DISKLABEL
+
if (bsd_kdev) {
+

printk(" <");
+

bsd_disklabel_partition(hd, bsd_kdev, bsd_maxpart);
+

printk(" >");
+
}
+#endif

/*

 *  Check for old-style Disk Manager partition table

 */
diff -ur linux.orig/include/linux/genhd.h linux/include/linux/genhd.h
--- linux.orig/include/linux/genhd.h
Wed Mar 18 20:25:30 1998
+++ linux/include/linux/genhd.h
Thu Sep 24 18:55:43 1998
@@@@ -69,12 +70,19 @@@@
 #ifdef CONFIG_BSD_DISKLABEL
 /*
  * BSD disklabel support by Yossi Gottlieb <yogo@@math.tau.ac.il>
+ *
+ * updated by Marc Espie <Marc.Espie@@openbsd.org>
  */

+/* check against BSD src/sys/sys/disklabel.h for consistency */
+
 #define BSD_PARTITION

0xa5
/* Partition ID */
+#define OPENBSD_PARTITION
0xa6

 #define BSD_DISKMAGIC
(0x82564557UL)
/* The disk magic number */
 #define BSD_MAXPARTITIONS
8
+#define OPENBSD_MAXPARTITIONS 16
+
 #define BSD_FS_UNUSED

0
/* disklabel unused partition entry ID */
 struct bsd_disklabel {

__u32
d_magic;

/* the magic number */
----------------------------------------------------------------------
It does:
- trigger the recognition of OpenBSD disklabels,
- force bsd partitions to appear at the end of the partition list,
- check the bsd disklabel for redundancy and consistency with the dos
partition table, so that the same partition does not show up twice.

You also need a working ufs, such as
<ftp://sunsite.unc.edu/pub/Linux/ALPHA/ufs/u2fs-0.4.3.tar.gz>
This package yields a new module, plus a small patch to tie the module
with the rest of the Linux kernel. I would recommend checking that patch
manually, as Linux module information tends to vary widely, and it is
pretty trivial to add by hand anyway.

Running Linux binaries under OpenBSD
------------------------------------
You just have to recompile your BSD kernel with COMPAT_LINUX, and set up
/emul/linux as explained in compat_linux(1).

It's a good idea to mount your Linux file system under another point, then
make symbolic links so that you can control what gets used precisely.
Don't bother with the ports emul/linux_lib entry: it's only a set of Linux
libraries for people who don't have a Linux system running.

As of this writing, most applications work, apart from sound.

The Linux sound devices use differing ioctl from OpenBSD, hence anything that
needs to change the audio mode won't work, and produce audio garbage at best.

A small detail that may cause problems: uname still says `OpenBSD', even
under Linux compatibility.  The reason behind that is that we don't want
netscape to tell it was run from a Linux box, when it is used under
OpenBSD.

Some programs, for instance maple, do depend on uname answering `Linux'.
For maple, this is straigthforward: you just have to fudge
/usr/local/maple/bin/maple.system.type to check OpenBSD in the same
class with Linux.

Similar shell scripts are easy to fix.  Binary programs that don't run
suid can be coerced by using LD_PRELOAD.

As a rule, this should be achieved on a program-by-program basis.
The more networking programs that do tell they're running under OpenBSD,
the merrier !



   [1][Back to Main Index] [2][To Section 11.0 - OpenBSD 2.4 Specific
   Information]

                           12.0 - Performance Tuning
     _________________________________________________________________

12.1 - Networking

   If you run a busy gateway or firewall, you should make sure you
   prevent memory starvation.

   Add these to your kernel config and compile a custom kernel:

     * option "NMBCLUSTERS=8192"
     * option "MAX_KMAP=120"
     * option "MAX_KMAPENT=6000"
     * option "NKMEMCLUSTERS=8192"

12.2 - Disk I/O

   Disk I/O is, on any system, a main factor in the overall speed of the
   computer. And is also a part of any system that needs protected the
   most. OpenBSD has a couple of options you can choose from when it
   comes to disk fault tolerence.

   The first option is the use of [3]ccd(4). CCD(4) is what is called a
   Concatenated Disk Driver. This basically allows you to combine one or
   more disks into what is called a "virtual disk" As in, the system
   see's it as one disk, and uses it as such. This concept is similar to
   that of LVM, which is found in many commercial flavors. To start setup
   of CCD, you need to add support for it in your kernel. A line such as:

pseudo-device   ccd     4       # concatenated disk devices

   would allow for 4 CCD devices. Which happens to be the MAX number of
   CCD devices allowed.

   NOTE: Support is in the GENERIC Kernel.

   One of the many things you can do through the use of CCD is provide
   for "striping", which can definately give a performance boost.

   Another solution is [4]raid(4) which will have you use [5]raidctl(8).
   to control your raid devices. Through the use of RAIDframe devices you
   can achieve both striping and mirroring. OpenBSD has support for RAID
   levels of 0, 1, 4, and 5. With raid, as with CCD, support must be in
   the KERNEL.

pseudo-device   raid   4       # RAIDframe disk device

   As with the CCD kernel support, Support is in the GENERIC kernel.

   For fileservers with enough memory, you can increase BUFCACHEPERCENT.
   To do this you should add a line to your kernel configuration like
   this:

   option BUFCACHEPERCENT=50

   Or whatever number you want it set too.

   Another tool that can be used to speed up your is softupdates. You can
   read more about these at the [6]softupdates FAQ entry.

   [7][Back to Main Index] [8][To Section 11.0 - OpenBSD 2.4 Specific
   Information]
     _________________________________________________________________

   [9][back] [10]www@@openbsd.org
   $OpenBSD: obsd-faq.txt,v 1.6 1999/06/25 18:53:51 ericj Exp $

References

   1. http://www.openbsd.org/faq/index.html
   2. http://www.openbsd.org/faq/faq24.html
   3. http://www.openbsd.org/cgi-bin/man.cgi?query=ccd&apropos=0&sektion=4&format=html
   4. http://www.openbsd.org/cgi-bin/man.cgi?query=raid&apropos=0&sektion=4&format=html
   5. http://www.openbsd.org/cgi-bin/man.cgi?query=raidctl&apropos=0&sektion=8&format=html
   6. http://www.openbsd.org/faq/faq4.html#4.9
   7. http://www.openbsd.org/faq/index.html
   8. http://www.openbsd.org/faq/faq24.html
   9. http://www.openbsd.org/faq/index.html
  10. mailto:www@@openbsd.org


MINI-FAQ: Upgrading OpenBSD

  Latest OpenBSD Version - 2.5

    Kjell Wooding <[1]kwooding@@codetalker.com>

   Last Update - 03 Jun 1999

     If you've ever tried compiling the -current sources from an older
     OpenBSD release, you're aware that the process isn't always
     straightforward. This Mini-FAQ is an attempt to address the most
     common issues encountered when upgrading between OpenBSD releases,
     or from the releases to -current

  1.0: General Upgrade Questions

   [2]1.1: Terminology. What is -current? What are Snapshots?
   [3]1.2: What is the easiest way to upgrade to -current?
   [4]1.3: I looked, but didn't see any snapshots on the FTP site. Where
   did they go?
   [5]1.4: How do I get the latest source?
   [6]1.5: Okay, I have the tree. How do I build it.
   [7]1.6: My make build stopped halfway. Do I have to redo the whole
   thing?

  2.0: Upgrading from 2.3

   [8]2.1: What are the major problems upgrading from 2.3 to 2.4?
   [9]2.2: I tried the build, but it failed when trying to compile
   ssleay.
   [10]2.3: I tried the build, but it failed when trying to make
   something for the PowerPC.

  3.0: Upgrading from 2.4

   [11]3.1: What are the major problems upgrading from 2.4 to 2.5?
   [12]3.2: I tried the build, but it failed on cap_mkdb.

  4.0: Upgrading from 2.5

   [13]4.1: What are the major problems upgrading from 2.5 to -current?
   [14]4.2: How do I upgrade gcc to egcs

     [15]4.2.1 - i386 and sparc are no longer #define'ed
     [16]4.2.2 - Build fails in xlint
     [17]4.2.3 - Core Dump on uthread_autoinit.c
     [18]4.2.4 - egcs seems much slower than gcc
     [19]4.2.5 - egcs generates larger code than gcc
     [20]4.2.6 - After installing egcs I have very little disk space
     left

   [21]4.3: My make build dies with unimplemented syscall errors.

                           _____________________

  1.0: General Upgrade Questions

    1.1: Terminology. What is -current? What are Snapshots?

   Unlike Operating System projects like Linux and FreeBSD, OpenBSD
   development happens from a single source tree. On approximately
   six-month intervals, OpenBSD releases are produced. These are numbered
   in the conventional (2.x) manner. The current OpenBSD release is 2.5.

   -current, short for openbsd-current, refers to the up-to-the-minute
   version of the source tree contained in the CVS repository. This is
   the tree most commonly used by OpenBSD developers. The -current tree
   contains all the code that is planned for the next release. From time
   to time, brave souls will abandon the formal releases and run
   openbsd-current, usually to take advantage of features that have not
   yet made it into the formal releases. Because of its uncertain nature,
   however, upgrading to -current is not recommended for non-technical
   users.

   Between formal releases, a series of snapshot releases are [22]made
   available. Snapshots are test releases of the -current source tree.
   Because they reflect the current state of development, there is no
   guarantee that snapshot releases will work correctly (or even at all).
   Snapshots are quite useful when moving from a formal release (or older
   version of -current) to the current tree.

    1.2: What is the best way to upgrade to -current?

   Due to changes in the underlying libraries, moving directly from a
   release to -current is not always easy. The most painless way to move
   up to -current is to first upgrade to the latest snapshot (usually,
   via an FTP install). Once the snapshot is installed, the latest source
   can be [23]fetched and [24]built. This procedure should eliminate most
   toolchain and library problems.

    1.3: I looked, but didn't see any snapshots on the FTP site. Where did they
    go?

   The snapshots used to be taken temporarily offline right around the
   release time of a new version. This is no longer the OpenBSD policy.

   Snapshots may be removed as they become old (or no longer relevant).
   If no snapshot is available, you should upgrade to the most recent
   release and build the remainder of the way from source.

    1.4: How do I get the latest source?

   Short answer: [25]http://www.openbsd.org/anoncvs.html

   For example. To retrieve the entire tree via CVS: (using the bash
   shell. Others substitute setenv for export)
 # export CVSROOT=anoncvs@@anoncvs.ca.openbsd.org:/cvs
 # export CVS_RSH=/usr/local/bin/ssh
 # cd /usr
 # cvs -q get -PA src

    1.5: Okay, I have the tree. How do I build it.

   Basic instructions are in /usr/src/Makefile. This is a slightly
   expanded version.

1. Clean out the old object files.

   If you created a separate /usr/obj directory, clean that, and
   rebuild the symbolic links:

   # rm -rf /usr/obj
   # mkdir /usr/obj
   # cd /usr/src
   # make obj

   If you're worried there are object files in your source tree,
   do this:

   # cd /usr/src
   # find . -type l -name obj | xargs rm
   # make cleandir
   # rm -rf /usr/obj
   # mkdir /usr/obj
   # make obj

2. Perform any verion-specific configuration changes. For example,
   2.3 users must add the named user and group before
   moving to 2.4 or later. See the specific Mini-FAQ section for
   your version.

3. Make sure all the appropriate directories are created. This
   is especially important when upgrading from older versions, but is
   sometimes necessary in other cases. The easiest way to do this is:

   # cd /usr/src/etc && make DESTDIR=/ distrib-dirs

4. Compile a new kernel.

   # cd /usr/src/sys/arch/`machine`/conf
   # cp GENERIC MYKERNEL
   # vi MYKERNEL
   (edit MYKERNEL to your liking)
   # config MYKERNEL
   # cd ../compile/MYKERNEL
   # make clean && make depend && make
   (arc architecture only) copy bsd.ecoff to your FAT partition
   # cp /bsd /bsd.old && cp bsd /bsd
   # chown root.wheel /bsd (if you compiled as someone else)
   (reboot)

5. Compile the system.

   # cd /usr/src
   # make build

6. Update /etc and /dev by hand. These are not updated
   automatically. Choose a directory with enough space to
   hold /, /dev, /var, and /etc. Here I'll use /home/newroot
   (Note: make sure the directory hierarchy you choose
   does not have group write (g+w) or other write (o+w)
   permissions or sendmail will complain during this step.
   This makes /tmp a bad choice):

   # mkdir /home/newroot
   # export DESTDIR=/home/newroot
   # cd /usr/src/etc && make distribution-etc-root-var

   Now compare the files in /home/newroot with their
   installed counterparts. Replace or update the files as
   necessary.

   # rm -rf /home/newroot   (when done)

7. Reboot to make sure the new /etc files are correct

    1.6: My make build stopped halfway. Do I have to redo the whole thing?

   I would, but if you really want to pick up where you left off, do a:
 # cd /usr/src
 # make -n build

   This will show you what make build is doing. For example, mine tells
   me:
 (cd /usr/src/share/mk &&  make install)
 (cd /usr/src/include;  make includes)
 make cleandir
 (cd /usr/src/lib && make depend && make &&   make install)
 (cd /usr/src/gnu/lib && make depend && make &&   make install)
 (cd /usr/src/kerberosIV && make build)
 make depend && make &&  make install

   To pick up where you left off, just reissue the commands from the
   point where the compile died.

   If you do this procedure a lot, you may want to create a new target in
   your makefile. Simply copy the entry for build (to build-noclean, for
   example), and remove the make cleandir reference.

  2.0: Upgrading from 2.3

    2.1: What are the major problems upgrading from 2.3 to 2.4?

    New User: named

   After 2.3, the named DNS daemon was moved to a chroot jail. To make
   this change possible, the named user was created. If you do not have
   it already, you will need to create this user to ensure that all
   directories get created properly during the build process.

   Add the following entry to /etc/passwd using vipw
   named:*:70:70::0:0:BIND Daemon:/var/named:/sbin/nologin

   Add the following to /etc/group:
   named:*:70:

    2.2: I tried the build, but it failed when trying to compile ssleay.

   You are likely missing an entry for the named user in your password
   file.

   Short Answer:

   Create this user prior to the build.

   Long Answer:

   The named user is required in order to set permissions correctly. If
   this user is missing, part of the build process fails. If you capture
   your build to a file (say, with a make build &>/tmp/build.log) you
   will notice the following message:
  (cd /usr/src/etc && make DESTDIR=/ distrib-dirs)
  install -d -o root -g wheel -m 755 /
  mtree -def mtree/4.4BSD.dist -p // -u

  mtree: unknown user named
  mtree: failed at line 1632 of the specification
  *** Error code 1 (ignored)

   Unfortunately for us, the build continued happily on its way, totally
   ignoring the fact that an error occurred.

   If the named user exists, mtree works properly:
  missing: ./var/named (created)
  missing: ./var/named/dev (created)
  missing: ./var/named/etc (created)
  missing: ./etc/afs (created)
  missing: ./etc/ssl (created)
  missing: ./etc/ssl/private (created)
  missing: ./usr/obj (not created: File exists)
  missing: ./usr/share/doc/html (created)
  missing: ./usr/share/doc/html/lynx_help (created)
  missing: ./usr/share/doc/html/lynx_help/keystrokes (created)
  missing: ./usr/share/doc/usd/13.viref (created)
  missing: ./usr/share/man/cat4/powerpc (created)
  missing: ./usr/share/man/man4/alpha (created)
  missing: ./usr/share/man/man4/pmax (created)
  missing: ./usr/share/man/man4/powerpc (created)
  missing: ./usr/share/tmac/mdoc (created)
  missing: ./var/www/htdocs/manual/vhosts (created)
  missing: ./usr/include/ssl (created)

   The reason for the fail, then, is that the /usr/include/ssl directory
   was never created. Without the header files, the ssleay build fails.

   Fix:

   Create the named user and group. Remove /usr/include/ssl, /var/named,
   and any other directory from the list above that was mistakenly
   created as a normal file by the make build.

    2.3: I tried the build, but it failed when trying to make something for the
    PowerPC.

   Your directory tree is incomplete. Specifically, the
   /usr/share/man/cat4/powerpc directory is missing.

   Quick Fix:

   Create this directory and proceed with the compilation

   Complete Fix:

   Create the entire directory tree. Do a:
  # cd /usr/src/etc && make DESTDIR=/ distrib-dirs

   You will likely see an output like the following:
  install -d -o root -g wheel -m 755 /
  mtree -def mtree/4.4BSD.dist -p // -u

  missing: ./var/named (created)
  missing: ./var/named/dev (created)
  missing: ./var/named/etc (created)
  missing: ./etc/afs (created)
  missing: ./etc/ssl (created)
  missing: ./etc/ssl/private (created)
  missing: ./usr/obj (not created: File exists)
  missing: ./usr/share/doc/html (created)
  missing: ./usr/share/doc/html/lynx_help (created)
  missing: ./usr/share/doc/html/lynx_help/keystrokes (created)
  missing: ./usr/share/doc/usd/13.viref (created)
  missing: ./usr/share/man/cat4/powerpc (created)
  missing: ./usr/share/man/man4/alpha (created)
  missing: ./usr/share/man/man4/pmax (created)
  missing: ./usr/share/man/man4/powerpc (created)
  missing: ./usr/share/tmac/mdoc (created)
  missing: ./var/www/htdocs/manual/vhosts (created)
  missing: ./usr/include/ssl (created)

   Note that /usr/share/man/cat4/powerpc was one of the directories
   created by this process.

  3.0: Upgrading from 2.4

    3.1: What are the major problems upgrading from 2.4 to 2.5?

    cap_mkdb

   The syntax for invoking cap_mkdb has changed slightly. Before doing a
   make build, rebuild cap_mkdb from the latest source:
# cd /usr/src/usr.bin/cap_mkdb
# make clean && make && make install

   The make build should then run to completion

    Man Page Changes

   Several man pages were moved from section 1 to later sections
   Unfortunately, if the old man pages are left in section 1, unwary
   users will not see the latest version of the page.

   The following pages should be removed:
/usr/share/man/cat1/ipf.0
/usr/share/man/cat1/ipnat.0
/usr/share/man/cat1/ipsecadm.0

    Snake

   You will need to remove the contents of the obj directory before
   upgrading /usr/src/games/snake.

    3.2: I tried the build, but it failed on cap_mkdb.

   Symptom:

   A make build resulted in an error like this:
  cap_mkdb -i -f terminfo terminfo.src
  cap_mkdb: illegal option -- i
  usage: cap_mkdb [-v] [-f outfile] file1 [file2 ...]
  *** Error code 1

   Quick Fix:

   You need to build a new cap_mkdb. See [26]3.1.

  4.0: Upgrading from 2.5

    4.1: What are the major problems upgrading from 2.5 to -current?

      perl and make

   The latest version of Perl (5.005_03) requires a new version of make
   to compile properly. You must rebuild make before building the new
   Perl. Do a:
# cd /usr/src/usr.bin/make
# make clean && make && make install

   Then go ahead and rebuild the new Perl. You will need to clean out the
   Perl obj directory by hand before building.

   Perl developers should take note of the latest changes. From
   millert@@openbsd.org:
The version of perl in the OpenBSD source tree (post 2.5) has been
upgraded to 5.005_03.  The build method has changed somewhat but
most of that should be invisible.  The important changes that affect
people are as follows:

    1) Perl lib files have moved from /usr/lib/perl5 to the more correct
       /usr/libdata/perl5
    2) The default site_perl directories now live in /usr/local.  Ie:
       if you install a perl module, it will place itself in
       /usr/local/libdata/perl5/site_lib.  This makes it easy to
       see what non-stock modules you have.  It also means that we
       can have perl modules in the ports system easily.
    3) The perl library man pages are now install in /usr/share/man/cat3p
       You'll need to update your man.conf based on the src/etc/man.conf
       to take advantage of them.  This means you can now do
       "man 3p less" and get info on the less pragma but "man less"
       will still get you the less pager manpage.

If you have modules or other non-stock perl files the simplest thing
to do is to move /usr/lib/perl5 to /usr/libdata/perl5 and add a link
from /usr/lib/perl5 to /usr/libdata/perl5.  Alternately, you could
just edit the installed Config.pm file and fix up the paths there.

      Compiler Change: egcs replaces gcc

   This change is likely the most significant change you will encounter.
   For detailed instructions, see section [27]4.2.

      Kernel Structure - statfs - changed

   The statfs structure has changed as of May 31. You must rebuild your
   kernel before attempting a make build. See [28]4.3 for details.

    4.2: How do I upgrade gcc to egcs

   The safest way will be to upgrade to a recent snapshot, once one is
   available. Until then (or for the brave of heart) read the following
   carefully.

   First, note that some platforms have not been bootstrapped
   successfully yet. To date, the following should work, if you are
   careful:
     * i386
     * sparc
     * m68k
     * alpha

   mips and rs6000 have problems.

   To test whether your platform can be bootstrapped, grab and install
   the egcs-snapshot, available from the [29]ports collection. If this
   works, the in-tree version likely will, too. This is the safest method
   of proceeding.

   Now, before going any futher, ensure that your copies of binutils,
   gas, and ld are up to date. Note that there are two copies of gas and
   ld in the tree. On i386 and sparc, the binutils versions are not used.
   Check /usr/src/gnu/usr.bin/gas and /usr/src/gnu/usr.bin/ld instead.

   To bootstrap to the in-tree egcs, read the following carefully.

   From espie@@openbsd.org:

Today, the compiler changes.

Exit gcc 2.8.1, enter egcs... or more precisely, gcc 2.95 prerelease.

This is probably going to be a rough ride, but I can't work out all
the kinks on every architecture by myself.

I'm going to start importing stuff *now*. There will be a second message
to tech@@ once things are settled...

Thanks to everyone who helped me sorting stuff out, most especially
niklas, turan, and millert.

Why the switch
--------------
as most of you already know, egcs is now the *official* compiler supported
by the FSF.  The upcoming july release as been re-christened gcc 2.95.

Just looking at the log messages will show you many improvements:
support for newer processors is better, C++ is more accurately matching
the ANSI/ISO standards, Fortran 77 is more closely integrated.
There are also countless bug-fixes and code generation improvements.

Also the development is more open. There is a cvs tree, there are several
mailing-lists available, and we are cooperating closely with the egcs
team. More precisely, I've been feeding patches back to the egcs team
so that OpenBSD configurations are officially supported.
Also, the development team is highly responsive to bug-reports, and problems
get fixed.

There also is a band-wagon phenomenon: everyone is switching to egcs,
which means lots of code to test the compiler on, and that we can benefit
from related projects.

Why now
-------
egcs-1.1 was unfit for some purposes. Specifically, code size on i386
was larger than gcc 2.8.1, which yielded floppy-disks problems.
At 2.5 freeze, the only code fit to include was a somewhat unstable
snapshot.  In the interest of stability, after much pondering, egcs was
not put into 2.5.

Right now, the egcs project is going through a release cycle which will
yield egcs 1.2.  Judging from their time schedule, there is ample margin
between egcs 1.2 and the next release of OpenBSD.  Also, we want to get
in now, so that we get a chance to report problems on less frequently
used architectures, and get everything fixed for 1.2.

egcs `feature freeze' is supposed to occur on may 7th, and the current
snapshot 19990502 looks solid.

What works and what doesn't
---------------------------
egcs runs an i386 OpenBSD system without problems.  m68k works as well,
with a few work-arounds linked to obscure bugs that will get fixed.
sparc seems to be running as well.  There is some linker trouble on some
other arches that needs to be fixed before our next release.

Right now, constructors across dynamic libraries are not quite ready.

egcs now features a stand-alone cpp which is going to be better than
the current hackish solution we use. This means a few interface changes
and possibly weird warnings.

Keeping gcc 2.8.1 ?
-------------------
due to size constraints, as soon as egcs is imported, gcc is going
to move to cvs Attic.  If you don't want to deal with egcs now, you'll
have to be careful through your cvs updates.
Some Makefiles are bound to change: includes, gnu/usr.bin, and gnu/lib.
xlint and cpp.sh are going to change as well.

How to bootstrap the compiler
-----------------------------
the simplest way is probably to trust the various arch maintainers
and download a snapshot.

If you want to do stuff the hard way, you must first remake proper
obj dirs:
cd /usr/src
make obj

If you run i386, gas must be up-to-date.
If you run sparc, ld must be up-to-date.

then build libiberty:
cd /usr/src/gnu/egcs/libiberty
make -f Makefile.bsd-wrapper clean
make -f Makefile.bsd-wrapper depend
make -f Makefile.bsd-wrapper
make -f Makefile.bsd-wrapper install

then the C compiler:
cd /usr/src/gnu/egcs/gcc
make -f Makefile.bsd-wrapper clean
make -f Makefile.bsd-wrapper depend
make -f Makefile.bsd-wrapper
make -f Makefile.bsd-wrapper install

rebuild the C compiler with the new version:
cd /usr/src/gnu/egcs/gcc
make -f Makefile.bsd-wrapper clean
make -f Makefile.bsd-wrapper depend
make -f Makefile.bsd-wrapper
make -f Makefile.bsd-wrapper install

rebuild the includes
cd /usr/src/include
make includes

build all egcs libraries and install them
cd /usr/src/gnu/egcs
make -f Makefile.bsd-wrapper clean
make -f Makefile.bsd-wrapper depend
make -f Makefile.bsd-wrapper
make -f Makefile.bsd-wrapper install

install the new cpp driver
cd /usr/src/usr.bin/cpp
make install

then you're all set, and a standard make build should work...

     [author note: Actually, it doesn't quite work. xlint will fail to
     build. The fix is simple though. Simply do a make && make install
     in the /usr/src/usr.bin/xlint/xlint directory before you attempt a
     make build and proceed. See [30]4.2.2.]
If it doesn't, you're using an arch that didn't go through make build yet.
The most probably occurrence is an Internal Compiler Error, as known as an
ICE.

First try to see if the ICE will go away with -O1 or -O0. In that case, you
can put a work-around in the Makefile until it's fixed
(see /usr/src/lib/libm/Makefile for an example of how to put in such
work-arounds for m68k).

Then the error needs to be reported to the egcs-bugs mailing list.

At a minimum, you must run the source through the same compiler invocation,
with an addition of -v -save-temps to the options.

-v yields the precise sequence of commands invoked by gcc. -save-temps
will give you a pre-processed C file (.i) or C++ (.ii) that the egcs people
can make sense of... you can't ask them to run OpenBSD on their boxes.

If you have more time, you can try to trim down the pre-processed C file to
the bare minimum that triggers the bug. Dichotomy works nicely.

   If you made it through this procedure, and everything is still
   working, congratulations. If not, check the following sections for
   advice. Problems not listed here should be posted to tech@@openbsd.org.

      4.2.1 - i386 and sparc are no longer #define'ed

   This is true. egcs uses the cleaner __i386__ and __sparc__. If you
   need to compile code that relies on the old defines, add a -Dsparc or
   -Di386 to the appropriate location of your Makefile.

      4.2.2 - Build fails in xlint

   This is due to semantic differences in cpp. The workaround is simple,
   and similar to the cap_mkdb issue described in [31]3.1.

   Do a:
# cd /usr/src/usr.bin/xlint/xlint
# make && make install

   now re-run make, and the build should continue.

      4.2.3 - Core Dump on uthread_autoinit.c

   You have fallen victim to a linker bug. Here's a relevant message:
   From: Marc Espie
   Subject: egcs core-dumping on uthread_autoinit.c

   If this happens to you, this is a known linker problem... the cc1 you have
   was linked in a weird way.

   Initially, I made cc1 link against static /usr/lib/libiberty.a to avoid this
   problem, but this was cutting things too close, and the bug reappeared,
   probably thanks to unrelated changes in libc or elsewhere...

   The tree has been patched with a work-around in

   src/gnu/egcs/f/lang-options.h

   make sure you have the kludged version of that file (at least rev 1.2),
   recompile and reinstall cc1, the problem should go away.

   What's going on is that the 386 linker gets something wrong because of
   the huge strings array in toplev.c, and something gets mislinked, so
   that
   void f(void) __attribute((constructor)) {}
   kills cc1.

   As a work-around, I've killed Fortran options help texts, until someone find
s
   where the linker errs.

      4.2.4 - egcs seems much slower than gcc

   It is, but there is a reason. egcs performs more optimizing passes.
   Data alignment and other such functionality will be better with
   egcs-generated code.

      4.2.5 - egcs generates larger code than gcc

   Yes it does. This is especially noticable with the old -O2 gcc switch.
   egcs introduces a new option, -Os which optimizes for space. This is
   roughly comparable to the old -O2 behavior.

      4.2.6 - After installing egcs I have very little disk space left

   egcs installs into a different subdirectory than gcc 2.8.1. You may
   remove gcc once egcs is bootstrapped and working. (on a related note,
   the perl changes mentioned in [32]4.1 mean that you can remove the
   /usr/lib/perl5 directory. The new location for this data is
   /usr/libdata/perl5.)

    4.3: My make build dies with unimplemented syscall errors.

   Short Answer:

   The kernel structure statfs has changed. You will need to recompile
   the kernel before attempting a make build.

   Long Answer:

   The kernel structure statfs has changed. The new struct statfs has the
   following features:
     * Has a u_int32_t flags field--now softdep can have a real flag.
     * Uses u_int32_t instead of longs (nicer on the alpha). Note: the
       man page used to lie about setting invalid/unused fields to -1.
       SunOS does that but our code never has.
     * Gets rid of f_type completely. It hasn't been used since NetBSD
       0.9 and having it there but always 0 is confusing. It is
       conceivable that this may cause some old code to not compile but
       that is better than silently breaking.
     * Adds a mount_info union that contains the FSTYPE_args struct. This
       means that mount can now tell you all the options a filesystem was
       mounted with. This is especially nice for NFS.

   Other changes:
     * The linux statfs emulation didn't convert between BSD fs names and
       linux f_type numbers. Now it does, since the BSD f_type number is
       useless to linux apps (and has been removed anyway)
     * FreeBSD's struct statfs is different from our (both old and new)
       and thus needs conversion. Previously, the OpenBSD syscalls were
       used without any real translation.
     * mount(8) will now show extra info when invoked with no arguments.
       However, to see everything you need to use the -v (verbose) flag.

   --
   $OpenBSD: obsd-faq.txt,v 1.6 1999/06/25 18:53:51 ericj Exp $
   Copyright  1998-1999, Kjell Wooding.
   Please send any comments, questions, or suggestions to
   [33]kwooding@@codetalker.com

References

   1. mailto:kwooding@@codetalker.com
   2. http://www.openbsd.org/faq/upgrade-minifaq.html#1.1
   3. http://www.openbsd.org/faq/upgrade-minifaq.html#1.2
   4. http://www.openbsd.org/faq/upgrade-minifaq.html#1.3
   5. http://www.openbsd.org/faq/upgrade-minifaq.html#1.4
   6. http://www.openbsd.org/faq/upgrade-minifaq.html#1.5
   7. http://www.openbsd.org/faq/upgrade-minifaq.html#1.6
   8. http://www.openbsd.org/faq/upgrade-minifaq.html#2.1
   9. http://www.openbsd.org/faq/upgrade-minifaq.html#2.2
  10. http://www.openbsd.org/faq/upgrade-minifaq.html#2.3
  11. http://www.openbsd.org/faq/upgrade-minifaq.html#3.1
  12. http://www.openbsd.org/faq/upgrade-minifaq.html#3.2
  13. http://www.openbsd.org/faq/upgrade-minifaq.html#4.1
  14. http://www.openbsd.org/faq/upgrade-minifaq.html#4.2
  15. http://www.openbsd.org/faq/upgrade-minifaq.html#4.2.1
  16. http://www.openbsd.org/faq/upgrade-minifaq.html#4.2.2
  17. http://www.openbsd.org/faq/upgrade-minifaq.html#4.2.3
  18. http://www.openbsd.org/faq/upgrade-minifaq.html#4.2.4
  19. http://www.openbsd.org/faq/upgrade-minifaq.html#4.2.5
  20. http://www.openbsd.org/faq/upgrade-minifaq.html#4.2.6
  21. http://www.openbsd.org/faq/upgrade-minifaq.html#4.3
  22. ftp://ftp.openbsd.org/pub/OpenBSD/snapshots/
  23. http://www.openbsd.org/faq/upgrade-minifaq.html#1.4
  24. http://www.openbsd.org/faq/upgrade-minifaq.html#1.5
  25. http://www.openbsd.org/anoncvs.html
  26. http://www.openbsd.org/faq/upgrade-minifaq.html#3.1
  27. http://www.openbsd.org/faq/upgrade-minifaq.html#4.2
  28. http://www.openbsd.org/faq/upgrade-minifaq.html#4.3
  29. http://www.openbsd.org/ports.html
  30. http://www.openbsd.org/faq/upgrade-minifaq.html#4.2.2
  31. http://www.openbsd.org/faq/upgrade-minifaq.html#3.1
  32. http://www.openbsd.org/faq/upgrade-minifaq.html#4.1
  33. mailto:kwooding@@codetalker.com


OpenBSD Frequently Asked Questions - Ver. 2.5
     _________________________________________________________________

   [2.4 logo]

   This FAQ is specifically designed for the 2.5 release of OpenBSD, but
   in some cases will work on earlier versions. This FAQ will take you
   through most critical steps to setting up your own OpenBSD system. The
   addressed questions will range from newbie to advanced users.
   Hopefully you will find this FAQ useful.

   This FAQ was recently updated to support the newest version of
   OpenBSD. To view information for previous versions, please refer to
   [1]FAQ section 11.0, or [2]errata.html.

   For some a text version of the faq would be much more handy. So please
   check out [3]obsd-faq.txt. Print it out, pass it to your friends. Add
   to it, (but make sure you send diffs to me).

   Any questions can be directed to: [4]faq@@openbsd.org

   The Current FAQ maintainers are:
   [5]Eric Jackson
   [6]Wim Vandeputte
        _________________________________________________________________

  [7]1.0 - Introduction to OpenBSD

     * [8]1.1 - What is OpenBSD?
     * [9]1.2 - What platforms are supported?
     * [10]1.3 - Is OpenBSD really free?
     * [11]1.4 - Why might I want to use OpenBSD?
     * [12]1.5 - How can I help support OpenBSD?
     * [13]1.6 - Who maintains OpenBSD?

  [14]2.0 - Other OpenBSD information resources

     * [15]2.1 - Web Pages
     * [16]2.2 - Mailing Lists
     * [17]2.3 - Manual Pages
     * [18]2.4 - Reporting Bugs

  [19]3.0 - Obtaining OpenBSD

     * [20]3.1 - Buying an OpenBSD CD
     * [21]3.1.1 - Buying OpenBSD T-Shirts
     * [22]3.2 - Downloading via FTP or AFS
     * [23]3.3 - Obtaining Current Source Code

  [24]4.0 - Installation and Disk Setup

     * [25]4.1 - Installing from CD
     * [26]4.2 - Installing from FTP
     * [27]4.3 - Installing via DHCP
     * [28]4.3.1 - Upgrading from various versions of Openbsd
     * [29]4.4 - What files are needed for Installation?
     * [30]4.5 - Using the OpenBSD disklabel
     * [31]4.6 - Using fdisk
     * [32]4.7 - Adding extra disks in OpenBSD
     * [33]4.8 - How to swap to a file
     * [34]4.9 - Soft-updates
     * [35]4.10 - How much space do I need for an OpenBSD installation?
     * [36]4.11 - When I boot after installation of i386 OpenBSD it says
       "partition 3 id 0".
     * [37]4.12 - How do I get a dmesg from a boot floppy?
     * [38]4.13 - I changed scsi controllers and now I cannot boot
       OpenBSD. It just says: "reading boot.. Bad magic" ( Installing
       Boot blocks - i386 specific)
     * [39]4.14 - Multibooting OpenBSD

  [40]5.0 - Kernel Configuration and Setup

     * [41]5.1 - Why do I need a custom kernel?
     * [42]5.2 - Kernel configuration Options
     * [43]5.3 - Building your own kernel
     * [44]5.4 - Boot-time configuration

  [45]6.0 - Networking

     * [46]6.1 - Initial network setup
     * [47]6.2 - IPF, NAT
     * [48]6.3 - IPSEC
     * [49]6.4 - DHCP
     * [50]6.5 - PPP

  [51]7.0 - Keyboard controls

     * [52]7.1 - How do I remap the keyboard?
     * [53]7.2 - Is there gpm or the like in OpenBSD?

  [54]8.0 - General Questions

     * [55]8.1 - What are these kerberos warnings when I first login?
     * [56]8.2 - How do I change virtual terminals?
     * [57]8.3 - I forgot my root password..... WHAT DO I DO?!?
     * [58]8.4 - X craps out when I startup.. what am I doing wrong?
     * [59]8.5 - What is CVS, and how do I use it?
     * [60]8.6 - What is the ports tree?
     * [61]8.7 - What are packages?
     * [62]8.8 - Is there any way to use my floppy drive if it's not
       attached during boot?
     * [63]8.9 - OpenBSD Bootloader (i386 specific)

  [64]9.0 - Migrating from Linux

     * [65]9.1 - Simple tips for ex-linux users
     * [66]9.2 - Dual boot of Linux and OpenBSD

  [67]10.0 - System Administration

     * [68]10.1 - When I try to su to root it says that I'm in the wrong
       group
     * [69]10.2 - How do I duplicate a filesystem?
     * [70]10.3 - How do I get httpd, sendmail, etc to start up with the
       system?
     * [71]10.4 - Why do users get relaying access denied when they are
       remotely sending mail through my OpenBSD system?
     * [72]10.5 - I've set up POP, but I get errors when accessing my
       mail thru POP. What can i do?
     * [73]10.6 - Setting up a Secure HTTP Server using SSL(8)
     * [74]10.7 - I made changes to /etc/passwd with vi(1), but the
       changes didn't seem to take place. Why?
     * [75]10.8 - How do I add a user? or delete a user?
     * [76]10.9 - How do I create a ftp-only account?
     * [77]10.10 - Setting up user disk quota's

  [78]11.0 - OpenBSD 2.4 Specific Information

     * [79]11.1 - Why do I get UserDir errors when running httpd(8)?
     * [80]11.2 - Installing at a partition 4GB or higher (i386 specific)
     * [81]Log24.txt - Specific OpenBSD 2.4 Install Example

  [82]12.0 - Performance Tuning

     * [83]12.1 - Networking
     * [84]12.2 - Disk IO
     * [85]12.3 - Tuning kmem
     _________________________________________________________________

   [86][back] [87]www@@openbsd.org
   $OpenBSD: obsd-faq.txt,v 1.6 1999/06/25 18:53:51 ericj Exp $

References

   1. http://www.openbsd.org/faq/faq24.html
   2. http://www.openbsd.org/errata.html
   3. http://www.openbsd.org/faq/obsd-faq.txt
   4. mailto:faq@@openbsd.org
   5. mailto:ericj@@openbsd.org
   6. mailto:wvdputte@@openbsd.org
   7. http://www.openbsd.org/faq/faq1.html
   8. http://www.openbsd.org/faq/faq1.html#1.1
   9. http://www.openbsd.org/faq/faq1.html#1.2
  10. http://www.openbsd.org/faq/faq1.html#1.3
  11. http://www.openbsd.org/faq/faq1.html#1.4
  12. http://www.openbsd.org/faq/faq1.html#1.5
  13. http://www.openbsd.org/faq/faq1.html#1.6
  14. http://www.openbsd.org/faq/faq2.html
  15. http://www.openbsd.org/faq/faq2.html#2.1
  16. http://www.openbsd.org/faq/faq2.html#2.2
  17. http://www.openbsd.org/faq/faq2.html#2.3
  18. http://www.openbsd.org/faq/faq2.html#2.4
  19. http://www.openbsd.org/faq/faq3.html
  20. http://www.openbsd.org/faq/faq3.html#3.1
  21. http://www.openbsd.org/faq/faq3.html#3.1.1
  22. http://www.openbsd.org/faq/faq3.html#3.2
  23. http://www.openbsd.org/faq/faq3.html#3.3
  24. http://www.openbsd.org/faq/faq4.html
  25. http://www.openbsd.org/faq/faq4.html#4.1
  26. http://www.openbsd.org/faq/faq4.html#4.2
  27. http://www.openbsd.org/faq/faq4.html#4.3
  28. http://www.openbsd.org/faq/upgrade-minifaq.html
  29. http://www.openbsd.org/faq/faq4.html#4.4
  30. http://www.openbsd.org/faq/faq4.html#4.5
  31. http://www.openbsd.org/faq/faq4.html#4.6
  32. http://www.openbsd.org/faq/faq4.html#4.7
  33. http://www.openbsd.org/faq/faq4.html#4.8
  34. http://www.openbsd.org/faq/faq4.html#4.9
  35. http://www.openbsd.org/faq/faq4.html#4.10
  36. http://www.openbsd.org/faq/faq4.html#4.11
  37. http://www.openbsd.org/faq/faq4.html#4.12
  38. http://www.openbsd.org/faq/faq4.html#4.13
  39. http://www.openbsd.org/faq/faq4.html#4.14
  40. http://www.openbsd.org/faq/faq5.html
  41. http://www.openbsd.org/faq/faq5.html#5.1
  42. http://www.openbsd.org/faq/faq5.html#5.2
  43. http://www.openbsd.org/faq/faq5.html#5.3
  44. http://www.openbsd.org/faq/faq5.html#5.4
  45. http://www.openbsd.org/faq/faq6.html
  46. http://www.openbsd.org/faq/faq6.html#6.1
  47. http://www.openbsd.org/faq/faq6.html#6.2
  48. http://www.openbsd.org/faq/faq6.html#6.3
  49. http://www.openbsd.org/faq/faq6.html#6.4
  50. http://www.openbsd.org/faq/faq6.html#6.5
  51. http://www.openbsd.org/faq/faq7.html
  52. http://www.openbsd.org/faq/faq7.html#7.1
  53. http://www.openbsd.org/faq/faq7.html#7.2
  54. http://www.openbsd.org/faq/faq8.html
  55. http://www.openbsd.org/faq/faq8.html#8.1
  56. http://www.openbsd.org/faq/faq8.html#8.2
  57. http://www.openbsd.org/faq/faq8.html#8.3
  58. http://www.openbsd.org/faq/faq8.html#8.4
  59. http://www.openbsd.org/faq/faq8.html#8.5
  60. http://www.openbsd.org/faq/faq8.html#8.6
  61. http://www.openbsd.org/faq/faq8.html#8.7
  62. http://www.openbsd.org/faq/faq8.html#8.8
  63. http://www.openbsd.org/faq/faq8.html#8.9
  64. http://www.openbsd.org/faq/faq9.html
  65. http://www.openbsd.org/faq/faq9.html#9.1
  66. http://www.openbsd.org/faq/faq9.html#9.2
  67. http://www.openbsd.org/faq/faq10.html
  68. http://www.openbsd.org/faq/faq10.html#10.1
  69. http://www.openbsd.org/faq/faq10.html#10.2
  70. http://www.openbsd.org/faq/faq10.html#10.3
  71. http://www.openbsd.org/faq/faq10.html#10.4
  72. http://www.openbsd.org/faq/faq10.html#10.5
  73. http://www.openbsd.org/faq/faq10.html#10.6
  74. http://www.openbsd.org/faq/faq10.html#10.7
  75. http://www.openbsd.org/faq/faq10.html#10.8
  76. http://www.openbsd.org/faq/faq10.html#10.9
  77. http://www.openbsd.org/faq/faq10.html#10.10
  78. http://www.openbsd.org/faq/faq24.html
  79. http://www.openbsd.org/faq/faq24.html#11.1
  80. http://www.openbsd.org/faq/faq24.html#11.2
  81. http://www.openbsd.org/faq/log24.txt
  82. http://www.openbsd.org/faq/faq12.html
  83. http://www.openbsd.org/faq/faq12.html#12.1
  84. http://www.openbsd.org/faq/faq12.html#12.2
  85. http://www.openbsd.org/faq/faq12.html#12.3
  86. http://www.openbsd.org/index.html
  87. mailto:www@@openbsd.org


   [1][Back to Main Index]

                         1.0 - Introduction to OpenBSD
     _________________________________________________________________

1.1 - What is OpenBSD?

   The [2]OpenBSD project produces a freely available, multi-platform
   4.4BSD-based UNIX-like operating system. Our efforts place emphasis on
   portability, standardization, correctness, and security. [3]OpenBSD
   supports binary emulation of most binaries from SVR4 (Solaris),
   FreeBSD, Linux, BSDI, SunOS, and HPUX.

1.2 - On what systems does OpenBSD run?

   OpenBSD 2.5 will install and run on the following platforms:
     * [4]i386 - CD bootable
     * [5]sparc - CD bootable
     * [6]alpha - CD bootable
     * [7]hp300
     * [8]amiga
     * [9]mac68k
     * [10]powerpc
     * [11]pmax
     * [12]mvme88k

     * The ports for pmax and mvme88k are not included on the 2.5 CD.
       They can be downloaded from any of the OpenBSD ftp sites

   bootable means that -for those savvy people who bought the CD- OpenBSD
   can be booted directly from the it.

   Previous releases of OpenBSD also had ports for:
     * [13]arc
     * [14]mvme68k

   These were removed from the 2.4 release, but were included in 2.3 if
   you are interested. If you have the proper equipment, bring them up to
   date! You can see updated information about specific platforms at
   [15]http://www.openbsd.org/plat.html

1.3 - Is OpenBSD really free?

   OpenBSD is all free. The binaries are free. The source is free. All
   parts of OpenBSD have reasonable copyright terms permitting free
   redistribution. This includes the ability to REUSE most parts of the
   OpenBSD source tree, either for personal or commercial purposes.
   OpenBSD has put NO further restrictions other than those implied by
   the original BSD license, which will allow greater applicability.
   Because of this, software which is written under stricter licenses
   cannot be included in the regular distribution of OpenBSD.

   For futher reading on other popular licenses read:
   [16]http://www.openbsd.org/policy.html.

   The maintainers of OpenBSD support the project largely from their own
   pockets. This includes the time spent programming for the project,
   equipment used to support the many ports, the network resources used
   to distribute OpenBSD to you, and the time spent answering questions
   and investigating users' bug reports. The OpenBSD developers are not
   independently wealthy and even small contributions of time, equipment,
   and resources make a big difference.

1.4 - Why might I want to use OpenBSD?

   New users frequently want to know whether OpenBSD is superior to some
   other free UNIX-like operating system. That question is largely
   un-answerable and is the subject of countless (and useless) religious
   debates. Do not, under any circumstances, ask such a question on an
   OpenBSD mailing list.

   Below are some reasons why we think OpenBSD is a useful operating
   system. Whether OpenBSD is right for you is a question that only you
   can answer.

     * OpenBSD runs on many different hardware platforms.
     * OpenBSD is thought of by many security professionals to be the
       most secure UNIX-like operating system as the result of a
       10-member 1.5-year long comprehensive source code security audit.
     * OpenBSD is a full-featured UNIX-like operating system available in
       source form at no charge.
     * OpenBSD integrates cutting-edge security technology suitable for
       building firewalls and private network services in a distributed
       environment.
     * OpenBSD benefits from strong on-going development in many areas,
       offering opportunities to work with emerging technologies with an
       international community of programmers and end-users.
     * OpenBSD offers opportunities for ordinary people to participate in
       the development and testing of the product.

1.5 - How can I help support OpenBSD?

   We are greatly indebted to the people and organizations that have
   contributed to the OpenBSD project. They are acknowledged by name
   here:

   [17]http://www.openbsd.org/donations.html

   OpenBSD has a constant need for several types of support from the user
   community. If you find OpenBSD useful, you are strongly encouraged to
   find a way to contribute. If none of the suggestions below are right
   for you, feel free to propose an alternative by sending e-mail to
   [18]donations@@openbsd.org.

     * Buy an OpenBSD CD. It includes the current full release of
       OpenBSD, and is bootable on many platforms. It also generates
       revenue to support the OpenBSD project, and reduces the strain on
       network resources used to deliver the distribution via the
       Internet. This inexpensive two-CD set includes full source.
       Remember, your friends need their own copy!
     * Donate money. The project has a constant need for cash to pay for
       equipment, network connectivity, and expenses relating to CD
       publishing. Manufacturing CDs requires an up-front out-of-pocket
       investment for the OpenBSD developers, without guaranteed return.
       Send e-mail to [19]donations@@openbsd.org to find out how to
       contribute. Even small donations make a profound difference.
     * Donate equipment and parts. The project has a constant need for
       general and specific hardware. Items such as IDE and SCSI disks,
       and various types of RAM are always welcome. For other types of
       hardware such as computer systems and motherboards, you should
       inquire as to current need. Write to [20]donations@@openbsd.org to
       arrange for shipment.
     * Donate your time and skills. Programmers who enjoy writing
       operating systems are naturally always welcome, but there are
       literally dozens of other ways that people can be useful. Follow
       mailing lists and help answer new-user questions.
     * Help maintain documentation by submitting new FAQ material (to
       [21]faq@@openbsd.org). Form a local user group and get your friends
       hooked on OpenBSD. Make a case to your employer for using OpenBSD
       at work. If you're a student, talk to your professors about using
       OpenBSD as a learning tool for Computer Science or Engineering
       courses. It's also worth mentioning one of the most important ways
       you should not try to "help" The OpenBSD project: do not waste
       your time engaging in operating system flame wars on Usenet
       newsgroups. It does not help the project to find new users and can
       cause substantial harm to important relationships that developers
       have with other developers.

1.6 - Who maintains OpenBSD?

   OpenBSD is maintained by a development team spread across many
   different countries. The project is coordinated by Theo de Raadt,
   located in Canada.

   [22][To Section 2.0 - Other OpenBSD information resources]
     _________________________________________________________________

   [23][back] [24]www@@openbsd.org
   $OpenBSD: obsd-faq.txt,v 1.6 1999/06/25 18:53:51 ericj Exp $

References

   1. http://www.openbsd.org/faq/index.html
   2. http://www.openbsd.org/
   3. http://www.openbsd.org/
   4. http://www.openbsd.org/i386.html
   5. http://www.openbsd.org/sparc.html
   6. http://www.openbsd.org/alpha.html
   7. http://www.openbsd.org/hp300.html
   8. http://www.openbsd.org/amiga.html
   9. http://www.openbsd.org/mac68k.html
  10. http://www.openbsd.org/powerpc.html
  11. http://www.openbsd.org/pmax.html
  12. http://www.openbsd.org/mvme88k.html
  13. http://www.openbsd.org/arc.html
  14. http://www.openbsd.org/mvme68k.html
  15. http://www.openbsd.org/plat.html
  16. http://www.openbsd.org/policy.html
  17. http://www.openbsd.org/donations.html
  18. mailto:donations@@openbsd.org
  19. mailto:donations@@openbsd.org
  20. mailto:donations@@openbsd.org
  21. mailto:faq@@openbsd.org
  22. http://www.openbsd.org/faq/faq2.html
  23. http://www.openbsd.org/faq/index.html
  24. mailto:www@@openbsd.org


   [1][Back to Main Index] [2][To Section 1.0 - Introduction to OpenBSD]
   [3][To Section 3.0 - Obtaining OpenBSD]

                   2.0 - Other OpenBSD information resources

2.1 - Web Pages of Interest

   The official website for the OpenBSD project is located at:
   [4]http://www.OpenBSD.org

   A lot of valuable information can be found here regarding about all
   aspects of the OpenBSD project.

   Additional information for laptop users can be found at:
   [5]http://www.monkey.org/openbsd-mobile/ and
   [6]http://www.cpio.net/openbsd/laptops/

2.2 - Mailing Lists

   The OpenBSD project maintains several popular mailing lists which
   users should subscribe to and follow. To subscribe to a mailing list,
   send an e-mail message to [7]majordomo@@openbsd.org. That address is an
   automated subscription service. In the body of your message, on a
   single line, you should include a subscribe command for the list you
   wish to join. For example:

   subscribe announce

   The list processor will reply to you, asking for confirmation of your
   intent to join the list. The confirmation you send back to the list
   processor will be included in its reply to you. It will look something
   like this:

   auth 90855167 subscribe announce you@@example.com

   Once you have confirmed your intent to join, you will be immediately
   added to the list, and the list processor will notify you that you
   were successfully added.

   To unsubscribe from a list, you will again send an e-mail message to
   [8]majordomo@@openbsd.org. It might look like this:

   unsubscribe announce

   If you have any difficulties with the mailing list system, please
   first read the instructions. They can be obtained by sending an e-mail
   message to [9]majordomo@@openbsd.org with a message body of "help".
   These are the currently-available OpenBSD mailing lists:

     * announce - Important announcements. This is a low-volume list.
     * tech - General technical discussions
     * misc - User questions and answers
     * bugs - Bugs received via sendbug(1) and discussions about them.
     * source-changes - Automated mailing of CVS source tree changes.
     * ports - Automated mailing of CVS source tree changes.
     * advocacy - Discussion of advocating OpenBSD.

   Archives of the OpenBSD mailing lists can be found by visiting the
   mailing lists web page: [10]http://www.openbsd.org/mail.html
   You can also get mail archives from
   [11]http://www.monkey.org/cgi-bin/wilma ,here they have searchable
   archives of the OpenBSD mailing lists.

   Another mailing list that may be of interest is
   [12]openbsd-mobile@@monkey.org. Which is a discussion of the use of
   OpenBSD in mobile computing.

   To subscribe to this list use:

   'echo subscribe | mail "openbsd-mobile-request@@monkey.org"'

   The archives for that can be found at:
   [13]http://www.monkey.org/openbsd-mobile/archive/

2.3 - Manual Pages

   OpenBSD comes with extensive documentation in the form of manual
   pages, as well as longer documents relating to specific applications.
   To access the manual pages and other documentation, be sure that you
   installed the man, misc, and text distributions.

   Here is a list of some of the most useful manual pages for new users:

     * [14]afterboot(8) - things to check after the first complete boot
     * [15]boot(8) - system boot strapping procedures
     * [16]passwd.conf(5) - format of the password configuration file
     * [17]adduser_proc(8) - procedure for adding new users
     * [18]adduser(8) - command for adding new users
     * [19]vipw(8) - edit the pass word file
     * [20]man(1) - display the on-line manual pages
     * [21]sendbug(1) - send a problem report (PR) about OpenBSD to a
       central support site.
     * [22]disklabel(8) - Read and write disk pack label.
     * [23]ifconfig(8) - configure network interface parameters.
     * [24]route(8) - manualy manipulate the routing tables.
     * [25]netstat(1) - show network status.
     * [26]reboot, halt(8) - Stopping and restarting the system.
     * [27]shutdown(8) - close down the system at a given time.
     * [28]boot_config(8) - how to change kernel configuration at boot

   Also, If you are one of the people who didn't install the man*.tar.gz
   package, you can find all the OpenBSD man pages on the web at
   [29]http://www.openbsd.org/cgi-bin/man.cgi.

   In general, if you know the name of a command or a manual page, you
   can read it by executing `man command'. For example: `man vi' to read
   about the vi editor. If you don't know the name of the command, or if
   `man command' doesn't find the manual page, you can search the manual
   page database by executing `apropos something' or `man -k something'
   where something is a likely word that might appear in the title of the
   manual page you're looking for. For example:

bsd# apropos "time zone"
tzfile (5) - time zone information
zdump (8) - time zone dumper
zic (8) - time zone compiler

   The parenthetical numbers indicate the section of the manual in which
   that page can be found. In some cases, you may find manual pages with
   identical names living in separate sections of the manual. For
   example, assume that you want to know the format of the configuration
   files for the cron daemon. Once you know the section of the manual for
   the page you want, you would execute `man n command' where n is the
   manual section number.

bsd# man -k cron
cron (8) - daemon to execute scheduled commands (Vixie Cron)
crontab (1) - maintain crontab files for individual users (V3)
crontab (5) - tables for driving cron
bsd# man 5 crontab

   In addition to the UNIX manual pages, there is a typesettable document
   set (included in the misc distribution). It lives in the
   /usr/share/doc directory. If you also installed the text distribution,
   then you can format each document set with a `make' in the appropriate
   subdirectory. The psd subdirectory is the Programmer's Supplementary
   Documents distribution. The smm subdirectory is the System Manager's
   Manual. The usd subdirectory is the UNIX User's Supplementary
   Documents distribution. You can perform your `make' in the three
   distribution subdirectories, or you can select a specific section of a
   distribution and do a `make' in its subdirectory. Some of the
   subdirectories are empty. By default, formatting the documents will
   result in Postscript output, suitable for printing. The Postscript
   output can be quite large -- you should assume 250-300% increase in
   volume. If you do not have access to a Postscript printer or display,
   you may also format the documents for reading on a terminal display.
   In each Makefile you'll need to add the flag -Tascii to each instance
   of the groff commands (or execute it by hand). Some of the documents
   use the ms formatting macros, and some use the me macros. The Makefile
   in each document subdirectory (eg, /usr/share/doc/usd/04.csh/Makefile)
   will tell you which one to use. For example:

bsd# cd /usr/share/doc/usd/04.csh
bsd# groff -Tascii -ms tabs csh.1 csh.2 csh.3 csh.4 csh.a csh.g > csh.txt
bsd# more csh.txt

   The UNIX manual pages are generally more current and trustworthy than
   the typesettable documents. The typesettable documents sometimes
   explain complicated applications in more detail than the manual pages
   do.

2.4 - Reporting Bugs

   Proper bug reporting is one of the most important responsibilities of
   end users. Very detailed information is required to diagnose most
   serious bugs. Developers frequently get bugs reports via e-mail such
   as these:

   Before submitting any bug report, please ready
   [30]http://www.openbsd.org/report.html

From: joeuser@@example.com
To: bugs@@openbsd.org
Subject: HELP!!!

I have a PC and it won't boot!!!!! It's a 486!!!!!

   Hopefully most people understand why such reports get summarily
   deleted. All bug reports should contain detailed information. If Joe
   User had really wanted his bug investigated, his bug report would have
   looked something like this:

From: smartuser@@example.com
To: bugs@@openbsd.org
Subject: 2.5 panics on an i386

After installing OpenBSD 2.5 from the CD which I purchased via your outstanding
on-line ordering system, I find that the system halts before the kernel even
gets loaded. After booting with a bootdisk and escaping to a shell. This is the
dmesg output:

OpenBSD 2.5-current (OSHIBANA) #2: Fri Jun  4 11:11:41 EDT 1999
    shinobi@@oshibana:/sys/arch/i386/compile/OSHIBANA
cpu0: F00F bug workaround installed
cpu0: Intel Pentium (P54C) ("GenuineIntel" 586-class) 120 MHz
cpu0: FPU,V86,DE,PSE,TSC,MSR,MCE,CX8
BIOS mem  = 654336 conventional, 15728640 extended
real mem  = 16384000
avail mem = 13725696
using 225 buffers containing 921600 bytes of memory
mainbus0 (root)
bios0 at mainbus0: AT/286+(63) BIOS, date 08/20/96
bios0: apminfo 0xf02dc00c diskinfo 0xf02dc034 cksumlen 1 memmap 0xf02dc0b0
apm0 at bios0: Power Management spec V1.1
apm0: battery life expectancy 96%
apm0: AC on, battery charge high, charging, estimated 1:28 minutes
pci0 at mainbus0 bus 0: configuration mode 1 (no bios)
"Toshiba (2nd ID) Host-PCI" rev 0x11 at pci0 dev 0 function 0 not configured
"Chips and Technologies 65550" rev 0x04 at pci0 dev 4 function 0 not configured
isa0 at mainbus0
isadma0 at isa0
wdc0 at isa0 port 0x1f0-0x1f7 irq 14
wd0 at wdc0 drive 0: &ltTOSHIBA MK2720FC>
wd0: 1296MB, 2633 cyl, 16 head, 63 sec, 512 bytes/sec, 2654280 sec total
wd0: using 16-sector 16-bit pio transfers, lba addressing (128KB cache)
sb0 at isa0 port 0x220-0x237 irq 7 drq 1: dsp v3.02
midi0 at sb0: &ltSB MIDI UART>
audio0 at sb0
opl0 at sb0: model OPL3
midi at opl0 not configured
pccom0 at isa0 port 0x3f8-0x3ff irq 4: ns16550a, 16 byte fifo
pccom1 at isa0 port 0x2f8-0x2ff irq 3: ns16550a, 16 byte fifo
pccom2 at isa0 port 0x3e8-0x3ef irq 5: ns16550a, 16 byte fifo
vt0 at isa0 port 0x60-0x6f irq 1: generic VGA, 80 col, color, 8 scr, mf2-kbd
pms0 at vt0 irq 12
fdc0 at isa0 port 0x3f0-0x3f5 irq 6 drq 2
fd0 at fdc0 drive 0: 1.44MB 80 cyl, 2 head, 18 sec
pcic0 at isa0 port 0x3e0-0x3e1 iomem 0xd0000-0xd3fff
pcic0: controller 0 (Intel 82365SL Revision 1) has sockets A and B
pcmcia0 at pcic0 controller 0 socket 0
pcmcia1 at pcic0 controller 0 socket 1
biomask 40c0 netmask 42c0 ttymask 56c2
root on wd0a
pctr: 586-class performance counters and user-level cycle counter enabled
rootdev=0x0 rrootdev=0x300 rawdev=0x302

Thank you!

   If Joe User had a working OpenBSD system from which he wanted to
   submit a bug report, he would have used the sendbug(1) utility to
   submit his bug report to the GNATS problem tracking system. Obviously
   you can't use sendbug(1) when your system won't boot, but you should
   use it whenever possible. You will still need to include detailed
   information about what happened, the exact configuration of your
   system, and how to reproduce the problem. The sendbug(1) command
   requires that your system be able to deliver electronic mail
   successfully on the Internet.

   If you have submitted a bug report and you want to check its current
   status without annoying anyone, the best ways are:

     * Visit the GNATS tracking system:
       [31]http://cvs.openbsd.org/cgi-bin/wwwgnats.pl.
     * Look in the [32]bugs@@openbsd.org list archives:
       [33]http://www.openbsd.org/mail.html.

   [34][Back to Main Index] [35][To Section 1.0 - Introduction to
   OpenBSD] [36][To Section 3.0 - Obtaining OpenBSD]
     _________________________________________________________________

   [37][back] [38]www@@openbsd.org
   $OpenBSD: obsd-faq.txt,v 1.6 1999/06/25 18:53:51 ericj Exp $

References

   1. http://www.openbsd.org/faq/index.html
   2. http://www.openbsd.org/faq/faq1.html
   3. http://www.openbsd.org/faq/faq3.html
   4. http://www.openbsd.org/
   5. http://www.monkey.org/openbsd-mobile/
   6. http://www.cpio.net/openbsd/laptops/
   7. mailto:majordomo@@openbsd.org
   8. mailto:majordomo@@openbsd.org
   9. mailto:majordomo@@openbsd.org
  10. http://www.openbsd.org/mail.html
  11. http://www.monkey.org/cgi-bin/wilma
  12. mailto:openbsd-mobile@@monkey.org
  13. http://www.monkey.org/openbsd-mobile/archive/
  14. http://www.openbsd.org/cgi-bin/man.cgi?query=afterboot&apropos=0&sektion=8&format=html
  15. http://www.openbsd.org/cgi-bin/man.cgi?query=boot&apropos=0&sektion=8&format=html
  16. http://www.openbsd.org/cgi-bin/man.cgi?query=passwd.conf&apropos=0&sektion=5&format=html
  17. http://www.openbsd.org/cgi-bin/man.cgi?query=adduser_proc&apropos=0&sektion=8&format=html
  18. http://www.openbsd.org/cgi-bin/man.cgi?query=adduser&apropos=0&sektion=8&format=html
  19. http://www.openbsd.org/cgi-bin/man.cgi?query=vipw&apropos=0&sektion=8&format=html
  20. http://www.openbsd.org/cgi-bin/man.cgi?query=man&apropos=0&sektion=1&format=html
  21. http://www.openbsd.org/cgi-bin/man.cgi?query=sendbug&apropos=0&sektion=1&format=html
  22. http://www.openbsd.org/cgi-bin/man.cgi?query=disklabel&apropos=0&sektion=8&format=html
  23. http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&apropos=0&sektion=8&format=html
  24. http://www.openbsd.org/cgi-bin/man.cgi?query=route&apropos=0&sektion=8&format=html
  25. http://www.openbsd.org/cgi-bin/man.cgi?query=netstat&apropos=0&sektion1&format=html
  26. http://www.openbsd.org/cgi-bin/man.cgi?query=reboot&apropos=0&sektion=8&format=html
  27. http://www.openbsd.org/cgi-bin/man.cgi?query=shutdown&apropos=0&sektion=8&format=html
  28. http://www.openbsd.org/cgi-bin/man.cgi?query=boot_config&apropos=0&sektion=8&format=html
  29. http://www.openbsd.org/cgi-bin/man.cgi
  30. http://www.openbsd.org/report.html
  31. http://cvs.openbsd.org/cgi-bin/wwwgnats.pl
  32. mailto:bugs@@openbsd.org
  33. http://www.openbsd.org/mail.html
  34. http://www.openbsd.org/faq/index.html
  35. http://www.openbsd.org/faq/faq1.html
  36. http://www.openbsd.org/faq/faq3.html
  37. http://www.openbsd.org/faq/index.html
  38. mailto:www@@openbsd.org


   [1][Back to Main Index] [2][To Section 2.0 - Other OpenBSD information
   resources] [3][To Section 4.0 - Installation and Disk Setup]

                            3.0 - Obtaining OpenBSD

3.1 - Buying an OpenBSD CD

   Purchasing an OpenBSD CD is generally the best way to get started.
   Visit the ordering page to purchase your copy:
   [4]http://www.openbsd.org/orders.html.

   There are many good reasons to own an OpenBSD CD:
     * CD sales support on-going development of OpenBSD.
     * Development of a multi-platform operating system requires constant
       investment in equipment.
     * Your support in the form of a CD purchase has a real impact on
       future development.
     * The CD contains binaries (and source) for all supported platforms.
     * The CD is bootable on several platforms, and can be used to
       bootstrap a machine without a pre-existing installed operating
       system.
     * The CD is useful for bootstrapping even if you choose to install a
       snapshot.
     * Installing from CD is faster! Installing from CD preserves network
       connectivity resources.
     * OpenBSD CD's always come with very nice stickers. You system isn't
       fully complete without these. You can only get these stickers by
       buying a CD set or donating hardware.

   If you're installing a release version of OpenBSD, you should use a
   CD. Snapshot releases can only be installed over the network.

3.1.1 - Buying OpenBSD T-Shirts

   Yes, OpenBSD now has t-shirts for your wearing enjoyment. You can view
   these at [5]http://www.OpenBSD.org/tshirts.html. Enjoy :)

3.2 - Downloading via FTP or AFS

   There are numerous international mirror sites offering FTP access to
   OpenBSD releases and snapshots. AFS access is also available. You
   should always use the site closest to you. Before you begin fetching a
   release or snapshot, you may wish to use ping and traceroute to
   determine which mirror site is nearest to you and whether that nearest
   mirror is performing adequately. Of course, your OpenBSD release CD is
   always closer than any mirror. Access information is here:

   [6]http://www.openbsd.org/ftp.html

3.3 - Obtaining Current Source Code

   Source to OpenBSD is freely redistributable and available at no
   charge. Generally the best way to get started with a current source
   tree is to install the source from the most recent CD and then
   configure AnonCVS to update it regularly. Information about AnonCVS,
   including how to set it up, is available here:

   [7]http://www.openbsd.org/anoncvs.html.

   or check [8]The OpenBSD FAQ

   If you don't have sufficient network bandwidth to support AnonCVS, or
   if your Internet access is via UUCP, you can still keep your source
   current by using CTM instead of AnonCVS. If that's your situation,
   then starting with a recent release CD is even more important.
   Information about CTM, including how to set it up, is available here:

   [9]http://www.openbsd.org/ctm.html.

   [10][Back to Main Index] [11][To Section 2.0 - Other OpenBSD
   information resources] [12][To Section 4.0 - Installation and Disk
   Setup]
     _________________________________________________________________

   [13][back] [14]www@@openbsd.org
   $OpenBSD: obsd-faq.txt,v 1.6 1999/06/25 18:53:51 ericj Exp $

References

   1. http://www.openbsd.org/faq/index.html
   2. http://www.openbsd.org/faq/faq2.html
   3. http://www.openbsd.org/faq/faq4.html
   4. http://www.openbsd.org/orders.html
   5. http://www.openbsd.org/tshirts.html
   6. http://www.openbsd.org/ftp.html
   7. http://www.openbsd.org/anoncvs.html
   8. http://www.openbsd.org/faq/faq8.html#8.5
   9. http://www.openbsd.org/ctm.html
  10. http://www.openbsd.org/faq/index.html
  11. http://www.openbsd.org/faq/faq2.html
  12. http://www.openbsd.org/faq/faq4.html
  13. http://www.openbsd.org/faq/index.html
  14. mailto:www@@openbsd.org


   [1][Back to Main Index] [2][To Section 3.0 - Obtaining OpenBSD] [3][To
   Section 5.0 - Kernel configuration and Disk Setup]

                      4.0 - Installation and disk setup.

4.1 - Installing from the OpenBSD CD

   Installing from a CD is definatly the BEST choice, but first you must
   have purchased a cd. You can obtain a cd from
   [4]http://www.openbsd.org/orders.html. If you are using either the
   i386, SPARC or Alpha platforms you can boot directly off the CD. If
   not, you will have to create a bootdisk. You can get the boot disk
   from ftp://ftp.openbsd.org/pub/OpenBSD/2.5/$ARCH/floppy25.fs

   To create this boot disk, use either the unix tool [5]dd(1) or MSDOS
   rawrite from the tools directory on the cd. Rawrite doesnt work if you
   are an NT user, so you can also use fdimage or ntrw.exe which are both
   also in the tools directory.

   To use dd, do the following:
# dd if=floppy25.fs of=/dev/fd0a

   or to whichever device you want to write the floppy binary to.

   After that is completed, boot from your media of choice, (cdrom or
   bootdisk) and answer the questions accordingly. Here is an example
   installation.

   [6]Example Install

4.2 - Installation via FTP

   The ftp installation is almost the same as the normal installation.
   The same bootdisk will be used.

   floppy25.fs

   Just like the CD install you will set up your disk, then when you
   specify install media you choose (f)tp. You must take care to give the
   proper settings when you are asked to configure your network. Have
   handy, your ipaddress (see below for dhcp), netmask, nameserver
   addresses, and default route. Once your network is configured
   correctly, you must choose the (f)tp installation option. You will be
   asked a few simple questions about proxys and passive or active
   transfers, and the you will be presented with a list of ftp servers.
   Select the one closest to you, and your on your way.

   Consult the [7]install text for help.

4.3 - Installation via DHCP

   Installation via DHCP is the same as ftp, except your system will use
   DHCP to configure your network. When you arrive at the network config
   option, choose DHCP and your network will be setup accordingly. The
   all you have to do is follow the remainder of the directions from ftp
   install above and you will be set.

   Consult the [8]install text for help.

4.4 - What files are needed for Installation?

   There are many packages containing the OpenBSD binaries, but which
   ones do you need to get your system up and running? Here is an
   overview of each package.

     * base25.tar.gz - Has the BASE OpenBSD system *NEEDED*
     * etc25.tar.gz - Has all the files in /etc *NEEDED*
     * comp25.tar.gz - Has the compiler and its tools, libs. *STRONGLY
       SUGGESTED*
     * man25.tar.gz - Holds man pages *STRONGLY SUGGESTED*
     * misc25.tar.gz - Holds misc info, setup docs
     * game25.tar.gz - Has the Games for OpenBSD *FUN*
     * xbase25.tar.gz - Has the base install for X11
     * xfont25.tar.gz - Holds X11's font server and fonts
     * xlink25.tar.gz - Has the X servers link kit
     * xserv25.tar.gz - Has X11's X servers
     * xshare25.tar.gz - Has manpages, locale settings, includes, etc for
       X

4.5 - Using the OpenBSD disklabel

   Be sure to check the [9]disklabel(8) man page!

   Disklabel is used to identify disk's and/or partitions. The main idea
   behind them is abstraction of disk hardware, since there exists
   several partitioning tables. A disklabel is a universal partitioning
   table. These labels tell the system everything about the disk, from
   the Maker to rpm's to track-to-track seek. This label resides on the
   beginning of the disk, this isto help bootstrap code use them (since
   most ROM based booting reads the first sectors of the first disk). It
   also will show you partitions and their types on your disk. Disklabel
   can, on some systems, be used to install bootstrap code.

   As an additional gain, using disklabels helps overcome architecture
   limitations on disk partitioning. For example on i386 you can only
   have 4 primary partitions, with disklabel you can put several labels
   on one partition (eg. 'swap', '/', '/usr' and '/var'). And you still
   have 3 more partitions available for other OSs!

   You can think of them as 'subpartitions' for installation purposes.
   But they are a necesity for kernel disk access based on geometry. And
   remember to use 'b' for the swap label, and 'a' for root filesystem
   (default names in kernel).

   To just view the current disklabel for your disk just do:
   # disklabel < disk-device name >
   This will give output similar to this:
# using MBR partition 3: type A6 off 64 (0x40) size 16777152 (0xffffc0)
# /dev/rwd0c:
type: ESDI
disk:
label: TOSHIBA MK2720FC
flags:
bytes/sector: 512
sectors/track: 63
tracks/cylinder: 16
sectors/cylinder: 1008
cylinders: 2633
total sectors: 2654064
rpm: 3600
interleave: 1
trackskew: 0
cylinderskew: 0
headswitch: 0           # milliseconds
track-to-track seek: 0  # milliseconds
drivedata: 0

16 partitions:
#        size   offset    fstype   [fsize bsize   cpg]
  a:  2071440    65583    4.2BSD     1024  8192    16   # (Cyl.   65*- 2120)
  b:    65520       63      swap                        # (Cyl.    0*- 65)
  c:  2654064        0    unused        0     0         # (Cyl.    0 - 2632)
  j:   512001  2137023    4.2BSD     1024  8192    16   # (Cyl. 2120*- 2627*)

   In this example, there are 4 labels - A, B, C, J. A is one main
   partition, B is swap, and J is another partition. C in all cases
   represents the full disk. This is helpful in showing what valuses in
   size, cyl, etc you have to work with. But with this command you cannot
   change any values, you can just view.

   To be able to edit your label's interactivly you would use the -E
   flag.
   Example:
# disklabel -E wd0
# using MBR partition 3: type A6 off 64 (0x40) size 16777152 (0xffffc0)

Treating sectors 64-16777216 as the OpenBSD portion of the disk.
You can use the 'b' command to change this.

Initial label editor (enter '?' for help at any prompt)
> ?
Available commands:
        p [unit]  - print label.
        M         - show entire OpenBSD man page for disklabel.
        e         - edit drive parameters.
        a [part]  - add new partition.
        b         - set OpenBSD disk boundaries.
        c [part]  - change partition size.
        d [part]  - delete partition.
        m [part]  - modify existing partition.
        r         - recalculate free space.
        u         - undo last change.
        s [path]  - save label to file.
        w         - write label to disk.
        q         - quit and save changes.
        x         - exit without saving changes.
        ? [cmnd]  - this message or command specific help.
Numeric parameters may use suffixes to indicate units:
        'b' for bytes, 'c' for cylinders, 'k' for kilobytes, 'm' for megabytes,
        'g' for gigabytes or no suffix for sectors (usually 512 bytes).
        Non-sector units will be rounded to the nearest cylinder.
Entering '?' at most prompts will give you (simple) context sensitive help.
> p
device: /dev/rwd0c
type: ESDI
disk:
label: TOSHIBA MK2720FC
bytes/sector: 512
sectors/track: 63
tracks/cylinder: 16
sectors/cylinder: 1008
cylinders: 2633
total sectors: 2654064
free sectors: 14193711
rpm: 3600

16 partitions:
#        size   offset    fstype   [fsize bsize   cpg]
  a:  2071440    65583    4.2BSD     1024  8192    16   # (Cyl.   65*- 2120)
  b:    65520       63      swap                        # (Cyl.    0*- 65)
  c:  2654064        0    unused        0     0         # (Cyl.    0 - 2632)
  j:   512001  2137023    4.2BSD     1024  8192    16   # (Cyl. 2120*- 2627*)
> q
No changes.

   In this example we get into disklabel's interactive mode. From here we
   can issue the command "?" asking for help. This gives us many commands
   we can use to add, delete, edit existing labels.

   There is a new feature on disklabel, to help installation. The '-f'
   flag writes a 'fstab' like file, if given a mount point for a label.
   This is only used at installation.

   To see an example install involving disklabel check [10]log25.txt

4.6 - Using fdisk

   First be sure to check the fdisk main page. [11]fdisk(8)

   Fdisk is a program to help with the maintenance of your partitions.
   This program is used at install time to set up your OpenBSD partition
   (this partition can contain several labels, each with
   filesystems/swap/etc.). It can divide space on your drives and set one
   active. This program will usually be used in Single User Mode ( boot
   -s ). Fdisk also sets the MBR on your various hard disks.

   For installation purposes, most times you'll only need ONE Openbsd
   partition, and then using disklabel to put a swap and a filesystem on
   it.

   To just view your partition table using fdisk just use:
   # fdisk fd0
   Which will give an output similar to this:
         Disk: fd0       geometry: 80/2/18 [2880 sectors]
         Offset: 0       Signatures: 0xAA55,0x0
                  Starting        Ending
          #: id  cyl  hd sec -  cyl  hd sec [     start -       size]
----------------------------------------------------------------------
         *0: A6    0   0   1 -   79   1  18 [         0 -       2880] OpenBSD
          1: 00    0   0   0 -    0   0   0 [         0 -          0] unused
          2: A7    0   0   2 -   79   1  18 [         1 -       2879] NEXTSTEP
          3: 00    0   0   0 -    0   0   0 [         0 -          0] unused

   In this example we are viewing the fdisk output of floppy drive. We
   can see the OpenBSD partition (A6) and its size. The * tells us that
   the OpenBSD partition is a bootable partition.

   In the previous example we just viewed our information. What if we
   want to edit our partition table? Well, to do so we must use the -e
   flag. This will bring up a command line prompt to interact with fdisk.

# fdisk -e wd0
Enter 'help' for information
fdisk: 1> help
        help            Command help list
        manual          Show entire OpenBSD man page for fdisk
        reinit          Re-initialize loaded MBR (to defaults)
        disk            Edit current drive stats
        edit            Edit given table entry
        flag            Flag given table entry as bootable
        update          Update machine code in loaded MBR
        select          Select extended partition table entry MBR
        print           Print loaded MBR partition table
        write           Write loaded MBR to disk
        exit            Exit edit of current MBR, without saving changes
        quit            Quit edit of current MBR, saving current changes
        abort           Abort program without saving current changes
fdisk: 1>

   It is perfectly safe in fdisk to go in and explore, just make sure to
   answer N to saving the changes and *DON'T* use the write command.

   Here is an overview of the commands you can use when you choose the -e
   flag.
     * help Display a list of commands that fdisk understands in the
       interactive edit mode.
     * reinit Initialize the currently selected, in-memory copy of the
       boot block.
     * disk Display the current drive geometry that fdisk has probed. You
       are given a chance to edit it if you wish.
     * edit Edit a given table entry in the memory copy of the current
       boot block. You may edit either in BIOS geometry mode, or in
       sector offsets and sizes.
     * flag Make the given partition table entry bootable. Only one entry
       can be marked bootable. If you wish to boot from an extended
       partition, you will need to mark the partition table entry for the
       extended partition as bootable.
     * update Update the machine code in the memory copy of the currently
       selected boot block.
     * select Select and load into memory the boot block pointed to by
       the extended partition table entry in the current boot block.
     * print Print the currently selected in-memory copy of the boot
       block and its MBR table to the terminal.
     * write Write the in-memory copy of the boot block to disk. You will
       be asked to confirm this operation.
     * exit Exit the current level of fdisk, either returning to the
       previously selected in-memory copy of a boot block, or exiting the
       program if there is none.
     * quit Exit the current level of fdisk, either returning to the
       previously selected in-memory copy of a boot block, or exiting the
       program if there is none. Unlike exit it does write the modified
       block out.
     * abort Quit program without saving current changes.

4.7 - Adding new disks in OpenBSD

   Well once you get your disk installed PROPERLY you need to use
   [12]fdisk(8) and [13]disklabel(8) to set up your disk in OpenBSD.
   Making sure that the partition ID is 'A6'. Once you have done this,
   OpenBSD will be able to recognize the new disk, and you need to create
   the filesystem on that disk using [14]newfs(8).

   bsd# newfs wd1a

   or so on using OpenBSD's disk numbering scheme
  wd0
  wd1
  wd2

   Edit fstab to mount the new disk at a mount point of your choice, and
   reboot.

   If you need to migrate an existing directory like /usr/bin. You should
   mount the new drive in /mnt and use cpio -pdum to copy /usr/bin to the
   /mnt directory. Edit the /etc/fstab file to show that /usr/bin will be
   mounted on the new drive. example:

   /dev/wd1a /usr/bin ffs rw 1 1

   Reboot into single user mode..boot -s Move the existing /usr/bin to
   /usr/bin-backup and create an empty /usr/bin. Then reboot the system,
   and whala!! the files are there!

4.8 - How do I swap to a file?

   With OpenBSD 2.5 came the introduction of [15]swapctl(8), which made
   dealing with swap devices much easier. Swapping to a file doesn't
   require a custom built kernel, But that can still be done, this faq
   will show you how to add swap space both ways.

   To swap to a file permanently, first make a kernel with vnd0c as swap.
   If you have wd0a as root filesystem, wd0b is the previous swap, use
   this line in the kernel configuration file (refer to compiling a new
   kernel if in doubt):

config          bsd     root on wd0a swap on wd0b and vnd0c dumps on wd0b

   Second make the file for swap. If you want a 32MB swapfile named
   /newswap do:

   # dd if=/dev/zero of=/newswap bs=1k count=32768

   Add a line to your /etc/fstab file to indicate where the new swap will
   be.

   /dev/vnd0c none sw 0 0

   Now boot with the new kernel. Then create the vnd0 device to use that
   file as a device:

   # vnconfig -c -v vnd0 /newswap

   And add it now to swap:

   # swapon /dev/vnd0c

   You can now see if it is working with:

   # pstat -s

4.9 - Softupdates

   Softupdates are experimental and are NOT recomended for regular users.

   Over the last few years Krik McKusick has been working on something
   called "soft updates". This is based on an idea proposed by Greg
   Ganger and Yale Patt that imposing a partial ordering on the buffer
   cache opertions would permit the requirement for synchronous writing
   of directory entries to be removed from the FFS code. Thus, a large
   performance increase of disk writing performance.

   To enable Softupdates your kernel must have option

   option FFS_SOFTUPDATES

   then you need to boot into single-user mode:

boot>boot -s
[snip]
bsd# tunefs -s enable <raw device>
bsd# reboot -n

   GOOD LUCK. Please direct all problem reports with as MUCH information
   as possible (kernel coredumps, tracebacks, etc) to [16]Costa. Do not
   waste his time with any other questions or incomplete problem reports.

4.10 - How much space do I need for an OpenBSD installation?

   The following are suggested sub-tree sizes for a full system install.
   The numbers include enough extra space to permit you to run a typical
   home system that is connected to the internet:

SYSTEM          /       /usr    /var    /usr/X11R6
alpha           56M     540M    27M     161M
amiga           45M     399M    24M      36M
arc             47M     268M    20M      60M
hp300           31M     234M    24M      47M
i386            35M     229M    24M      72M
mac68k          29M     232M    24M      36M
mvme68k         48M     448M    24M       -  (no Xserver)
pmax            50M     355M    24M      60M
sparc           40M     259M    24M      49M
powerpc         39M     423M    26M     124M

   When you are in the disklabel editor, you may choose to make your
   entire system have just an 'a' and 'b' partition. The 'a' partition
   you set up in disklabel will become your root partition, which should
   be the sum of all the 3 main values above (/, /usr, and /var) plus
   some space for /tmp. The 'b' partition you set up automatically
   becomes your system swap partition -- we recommend a minimum of 32MB
   but if you have disk to spare make it at least 64MB.

   However, we recommend you use many seperate partitions so that users
   cannot fill up your important partitions as easily, thus causing nasty
   denial of service problems. If you are extra cautious, you will make
   at least the following seperate partitions: / swap /usr /var /tmp
   /var/tmp /home.

4.11 - How do I get rid of in "partition 3 id 0" error on boot?

   This means that your MBR (Master Boot Record) was not installed
   properly or that your BIOS is not compatible with your current MBR. To
   solve this first try to reinstall the OpenBSD boot blocks. To do so
   use [17]intsallboot(8). For example, the most common usage is:

     * Boot from the OpenBSD bootdisk

     * # fsck /dev/rwd0a && mount /dev/wd0a /mnt
     * # cp /usr/mdec/boot /mnt/boot
     * # /usr/mdec/installboot -v /mnt/boot /usr/mdec/biosboot wd0

     Here substitute your disk devices for rwd0a & wd0a. This will
   install the boot blocks again.

     Then Reboot.

   If this doesn't work you still have a few more options. So, luck
   hasn't run out yet. The first is to use a bootloader such as OS-BS.
   The OpenBSD cd has the os-bs bootloader included in the tools
   directory. If you didn't purchase a CD-ROM, you can download os-bs
   from any of the OpenBSD ftp sites.

   pub/OpenBSD/2.5/tools/osbs135.exe

   and take some time to look through the web pages at
   [18]http://www.prz.tu-berlin.de/~wolf/os-bs.html

   There are also other commercial bootloaders or lilo that you can use
   for multi-booting.

   Here is a simple outline of how to get lilo onto your system.

     * Boot a DOS floppy and do a fdisk /MBR. Make sure you do that on
       the drive you'll be booting from.
     * Boot from a linux disk and install LILO & chain it to your OpenBSD
       boot block.

   For further instructions read [19]INSTALL.linux

4.12 - How do I get a dmesg from a boot floppy?

   RAMDISK images (boot floppies) do not ship with the dmesg utility.
   They do, however, have the /kern filesystem mounted. To copy the dmesg
   information to a file, do a:
# cat /kern/msgbuf >mydmesg

4.13 - Installing bootblocks (i386 specific)

   PC BIOS's can only deal with disk geometries with 1024 cylinders or
   less. Since most disks these days have more than 1024 cylinders, most
   PC scsi controllers "translate" the real disk geometry into something
   that fits within the BIOS's parameters. However, not all scsi
   controllers "translate" the geometry in the same way. If you change
   scsi controllers and they use a different "translated" geometry you
   will be unable to load the second stage boot loader (and thus unable
   to load the kernel) because the first stage boot loader contains a
   list of the blocks that comprise /boot in terms of the "translated"
   geometry. To fix this, just boot from a boot floppy and at the boot
   prompt, type "b hd0a:/bsd" to boot from the first hard disk (and not
   the floppy). Your machine should come up normally. You now need to
   update the first stage boot loader (aka the boot block). This is also
   the same way to for any disk device, ide disks and scsi disks in
   OpenBSD.
   To do this, assuming your boot disk is sd0:
cd /usr/mdec; ./installboot /boot biosboot sd0

4.14 - Multibooting OpenBSD

   OpenBSD & NT

   To multiboot OpenBSD and NT, you can use NTloader. The bootloader the
   NT uses. To multi-boot with NT, you need a copy of your OpenBSD pbr.
   After running installboot, you can copy it something like this:

# dd if=/dev/rsd0a of=openbsd.pbr count=1

   Now boot NT and put openbsd.pbr in c:. Add a line like this to the end
   of c:\boot.ini:

c:\openbsd.pbr="OpenBSD"

   When you reboot, you should be able to select OpenBSD from the NT
   loader menu. There is much more information available about NTloader
   at the [20]NTLDR Hacking Guide.

   OpenBSD & Windows or DOS

   To boot OpenBSD along with Windows 3.1, Windows95, or DOS you must
   simply put a boot loader on the system that can handle these OS's.
   Some bootloaders of choice are [21]osbs20b8.zip or [22]The Ranish
   Partition Manager. Both of these are known to be able to boot OpenBSD
   partitions.

   OpenBSD & Linux

   Please refer to [23]INSTALL.linux, which gives indepth instructions on
   getting OpenBSD working with Linux.

   [24][Back to Main Index] [25][To Section 3.0 - Obtaining OpenBSD]
   [26][To Section 5.0 - Kernel configuration and Disk Setup]
     _________________________________________________________________

   [27][back] [28]www@@openbsd.org
   $OpenBSD: obsd-faq.txt,v 1.6 1999/06/25 18:53:51 ericj Exp $

References

   1. http://www.openbsd.org/faq/index.html
   2. http://www.openbsd.org/faq/faq3.html
   3. http://www.openbsd.org/faq/faq5.html
   4. http://www.openbsd.org/orders.html
   5. http://www.openbsd.org/cgi-bin/man.cgi?query=dd&apropos=0&sektion=1&format=html
   6. http://www.openbsd.org/faq/log25.txt
   7. http://www.openbsd.org/faq/log25.txt
   8. http://www.openbsd.org/faq/log25.txt
   9. http://www.openbsd.org/cgi-bin/man.cgi?query=disklabel&apropos=0&sektion=8&format=html
  10. http://www.openbsd.org/faq/log25.txt
  11. http://www.openbsd.org/cgi-bin/man.cgi?query=fdisk&apropos=0&sektion=8&format=html
  12. http://www.openbsd.org/cgi-bin/man.cgi?query=fdisk&apropos=0&sektion=8&format=html
  13. http://www.openbsd.org/cgi-bin/man.cgi?query=disklabel&apropos=0&sektion=8&format=html
  14. http://www.openbsd.org/cgi-bin/man.cgi?query=newfs&apropos=0&sektion=8&format=html
  15. http://www.openbsd.org/cgi-bin/man.cgi?query=swapctl&sektion=8&format=html
  16. mailto:csapuntz@@openbsd.org
  17. http://www.openbsd.org/cgi-bin/man.cgi?query=installboot&sektion=8&format=html
  18. http://www.prz.tu-berlin.de/~wolf/os-bs.html
  19. http://www.openbsd.org/faq/INSTALL.linux
  20. http://www.dorsai.org/~dcl/publications/NTLDR_Hacking/
  21. http://www.freebird.org/sw-map/bootmanager.html
  22. http://www.users.intercom.com/~ranish/part/
  23. http://www.openbsd.org/faq/INSTALL.linux
  24. http://www.openbsd.org/faq/index.html
  25. http://www.openbsd.org/faq/faq3.html
  26. http://www.openbsd.org/faq/faq5.html
  27. http://www.openbsd.org/faq/index.html
  28. mailto:www@@openbsd.org


   [1][Back to Main Index] [2][To Section 4.0 - Installation and Disk
   Setup] [3][To Section 6.0 - Networking]

                   5.0 - Kernel Configuration and Disk Setup

5.1 - Why would I want to create my own custom kernel?

   Its a joyous occasion when you as a user get to configure and build
   your own custom kernel. Why would you want to do this though?

     * You can define which drivers your computer has support for.
     * You can get rid of uneeded drivers in the GENERIC kernel
     * Speed up boot times
     * Remove default options or add options which may not have been
       enabled by default

5.2 - Kernel Configuration Options

   Kernel Configuration Options are options that you add to your kernel
   configuration that place certain features into your kernel. This
   allows you to have exactly the support you want, without having
   support for uneeded devices. There are multitudes of options that
   allow you to customize you kernel. Here we will go over only some of
   them, one's that are most commonly used. Check the [4]options(4) man
   page for a more complete list of options. You can also check the
   example configuration files that are availible for your architecture.

     * [5]Alpha Kernel Conf Files
     * [6]i386 Kernel Configuration files
     * [7]mac68k Kernel Configuration files
     * [8]pmax Kernel Configuration Files
     * [9]sparc Kernel Configuration Files
     * [10]Other Arch's

   Look closely at these files and you will notice a line like:
   include "../../../conf/GENERIC"
   This means that it *IS* referencing yet another configuration file.
   This file stores non arch-dependent options. So when creating your
   Kernel Config be sure to look through [11]/sys/conf/GENERIC and see
   what you want. There ARE options in there that are NEEDED.

   All of the options listed below should be placed in your kernel
   configuration file in the format of:
   option OPTION
   for example. To place option debug in the kernel, add a line like
   this:
   option DEBUG
   Options in the OpenBSD kernel are translated into compiler
   preprocessor options, therefore an option like DEBUG would have the
   source compiled with option -DDEBUG. Which is equivalent to doing a
   #define DEBUG throughout the kernel.

   OpenBSD has a great many compatibility options which allow you to use
   binaries from other OS's. Not all are availibly on every
   architechture, so be sure to read the man pages for each option to see
   if your arch is supported.

     * [12]COMPAT_SVR4(8) - Compatibility with SVR4 binaries.
     * [13]COMPAT_BSDOS(8) - Compatibility with BSD/OS binaries.
     * [14]COMPAT_LINUX(8) - Compatibility with Linux binaries.
     * [15]COMPAT_SUNOS(8) - Compatibility with SunOS binaries.
     * [16]COMPAT_ULTRIX(8) - Compatibility with Ultrix binaries.
     * [17]COMPAT_FREEBSD(8) - Compatibility with FreeBSD binaries.
     * COMPAT_HPUX - Compatibility with HP-UX binaries. Only availible on
       some m68k arch's.
     * [18]COMPAT_IBCS2(8) - Compatibility to run ibcs2 binaries.
     * COMPAT_OSF1 - Run Digital Unix binaries. Availible only on Alpha
       platform.
     * COMPAT_43 - Compatibility with 4.3BSD. Use of this is certainly
       discouraged, But it is needed for our Navigator port
     * COMPAT_11 - Compatibility with NetBSD 1.1
     * COMPAT_NOMID - Compatibility with a.out executables that lack a
       machine id.

   It is always helpful to be able to debug problems with the kernel. But
   many choose not to put these options in their kernel because these
   options add considerable size to the kernel. There are however
   extremely helpful in a case where a bug might be present. This well
   help your or developers discover the source of your problems much
   quicker. Here is a list of popular debugging options that can be added
   to your kernel.

     * [19]DDB - This compiles in the in-kernel debugger. This isn't
       availible on all platforms. So be sure to read before adding it.
     * [20]KGDB - Compiles a remote kernel debugger using gdb's `remote
       target` feature.
     * makeoptions DEBUG="-g" - Makes bsd.gdb along with bsd. This is
       useful for debugging crash dumps with gdb. NOTE: This option also
       turns on option DEBUG
     * DEBUG - Used to put various debugging options in the kernel, where
       the source has defined them.
     * KTRACE - Adds hooks for the system call tracing facility. Which
       allows users to use [21]ktrace(1).
     * DIAGNOSTIC - Adds code to the kernel that does internal
       consistency checks.
     * GPROF - adds code to the kernel for kernel profiling with
       [22]kgmon(8).
     * makeoptions PROF="-pg" - The -pg flag causes the kernel to be
       compiled with support for profiling. Option GPROF is required to
       use this option.

   Filesystem Options.
     * FFS - Berkeley Fast Filesystem NOTE: This option is required
     * EXT2FS - Second Extended File System, This is needed for those of
       you who want to read Linux partitions.
     * MFS - Memory File System that stores files in swapable memory.
       This is not quite stable as of now.
     * NFS - Network File System, This is needed if you will be using
       NFS.
     * CD9660 - This is iso9660 + rockridge filesystem. This is required
       to read from cd's
     * MSDOSFS - Needed to read MS-DOS FAT filesystems. Also has support
       for Windows 95 long name + mixed case extensions.
     * FDESC - Includes code for a file system which can be mounted on
       /dev/fd
     * KERNFS - Includes code which permits the mounting of a special
       file system (normally mounted on /kern) in which files
       representing various kernel variables and parameters may be found.
     * NULLFS - Code to have a loopback filesystem. [23]mount_null(8) has
       more information
     * PROCFS - Includes code for a special file system (conventionally
       mounted on /proc)
     * PORTAL - Includes the (experimental) portal filesystem. This
       permits interesting tricks like opening TCP sockets by opening
       files in the file system.
     * UMAPFS - Includes a loopback file system in which user and group
       ids may be remapped -- this can be useful when mounting alien file
       systems with different uids and gids than the local system (eg,
       remote NFS).
     * UNION - Includes code for the union file system, which permits
       directories to be mounted on top of each other in such a way that
       both file systems remain visible. This code isnt quite stable yet.
     * XFS - Add hooks for using a filesystem that is compatible with the
       AFS filesystem. Currently used by the Arla/AFS code.
     * LFS - Log Structured Filesystem.
     * FFS_SOFTUPDATES - Allows for the use of softupdates. To read up on
       softupdates more read the [24]Softupdates FAQ section.
     * NFSSERVER - Allow for the server-side NFS code to be included in
       the kernel.
     * NFSCLIENT - Allow for the client-side NFS code to be included in
       the kernel.
     * FIFO - Support for FIFO's.. RECOMMENDED.
     * NVNODE=integer - Where integer is the size of the cache used by
       the name-to-inode translation routines, (a.k.a. the namei() cache,
       though called by many other names in the kernel source).
     * EXT2FS_SYSTEM_FLAG - This option changes the behavior of the
       APPEND and IMMUTABLE flags for a file on an EXT2FS filesystem.
       Read [25]options(4) for more details.
     * QUOTA - Support for Filesystem Quota's. To read up on using quotas
       read [26]FAQ 10

   Misc. Options
     * PCIVERBOSE - Make the boot process more verbose for PCI
       peripherals.
     * EISAVERBOSE - Make the boot process more verbose for EISA
       peripherals.
     * PCMCIAVERBOSE - Make the boot process more verbose for PCMCIA
       peripherals.
     * APERTURE - Provide in-kernel support for VGA framebuffer mapping
       by user processes. Needed to run X.
     * XSERVER - Support for the X server console driver. Needed for X.
     * LKM - Support for Loadable Kernel Modules. Not availible on all
       arch's. Read [27]lkm(4) for more information.
     * INSECURE - Hardwires the kernel security level to -1. Read
       [28]init(8) for more information on kernel security levels.
     * MACHINE_NONCONTIG - Changes part of the VM/pmap interface, to
       allow for non-contiguous memory.
     * RAM_DISK_HOOKS - Allows for machine dependent functions to be
       called when the ramdisk driver is configured.
     * RAM_DISK_IS_ROOT - Forces the ramdisk to be root.
     * CCDNBUF=integer - Set number of component buffers used by CCD(4).
       Default is 8. For more on CCD read the [29]CCD(4) man page, or the
       [30]Performance Tuning FAQ section.
     * KMEMSTATS - This makes malloc(9), the kernel memory allocator keep
       statistics on its use. If option DEBUG is used, this option is
       automatically turned off by config.
     * BOOT_CONFIG - Addeds support of the -c boot option.

   Networking Options
   Also check the [31]Networking FAQ or the [32]Networking Performance
   Tuning FAQ.
     * GATEWAY - Enables IPFORWARDING and (on most ports) increases the
       size of NMBCLUSTERS.
     * NMBCLUSTERS=integer - Controls the size mbuf cluster map.
     * IPFORWARDING - Enables IP routing behavior. With this option
       enabled, the machine will forward IP datagrams between its
       interfaces that are destined for other machines.
     * MROUTING - Includes support for IP multicast routers.
     * INET - Includes support for the TCP/IP protocol stack. This option
       is REQUIRED
     * MCLSHIFT=value - This option is the base-2 logarithm of the size
       of mbuf clusters. Read [33]options(4) for more information on this
       option.
     * NS - Include support for the Xerox XNS protocol stack. See
       [34]ns(4)
     * ISO,TPIP - Include support for the ubiquitous OSI protocol stack.
       See [35]iso(4) for more information.
     * EON - Include support for OSI tunneling over IP.
     * CCITT,LLC,HDLC - Include support for the X.25 protocol stack.
     * IPX, IPXIP - Include support for Internetwork Packet Exchange
       protocol commonly in use by Novell NetWare.
     * NETATALK - Include kernel support for the AppleTalk family of
       protocols.
     * TCP_COMPAT_42 - Use of this option is extremely discouraged, so it
       should not be enabled. TCP bug compatibility with 4.2BSD. In
       4.2BSD, TCP sequence numbers were 32-bit signed values. Modern
       implementations of TCP use unsigned values.
     * TCP_NEWRENO - Turns on NewReno fast recovery phase, which allows
       one lost segment to be recovered per round trip time.
     * TCP_SACK - Turns on selective acknowledgements.
     * TCP_FACK - Turns on forward acknowledgements allowing a more
       precise estimate of outstanding data during the fast recovery
       phase by using SACK information. This option can be used together
       with TCP_SACK.
     * PFIL_HOOKS - This option turns on the packet filter interface
       hooks. Read [36]pfil(9) for more information.
     * IPFILTER - This option enables the IP filtering on the packet
       level using the ipfilter package.
     * IPFILTER_LOG - This option, in conjunction with IPFILTER, enables
       logging of IP packets using ip-filter.
     * IPFILTER_DEFAULT_BLOCK - This option sets the default policy of
       ip-filter. If it is set, ip-filter will block packets by default.
     * PPP_FILTER - This option turns on [37]pcap(3) based filtering for
       ppp connections.
     * PPP_BSDCOMP - PPP BSD compression.
     * PPP_DEFLATE - Used in conjunction with PPP_BSDCOMP.
     * IPSEC - This option enables IP security protocol support. See
       [38]ipsec(4) for more details
     * ENCDEBUG - This option enables debugging information to be
       conditionally logged incase IPSEC encounters errors.
     * KEY - Enables PFKEYv2 (RFC 2367) support. While not IP specific,
       this option is usually used in conjunction with option IPSEC.

   PCVT Options
     * PCVT_NSCREENS=integer - Number of pcvt screens. Defaults to 8.
     * PCVT_VT220KEYB - If activated, a keyboard layout resembling a DEC
       VT200 (TM) is generated.
     * PCVT_SCREENSAVER - Enables the builtin screensaver feature.
       Defaults to on.
     * PCVT_PRETTYSCRNS - If enabled, a blinking-star screensaver is
       used. Default is off.
     * PCVT_CTRL_ALT_DEL - If enabled, the key combination < Ctrl> < Alt>
       < Del> invokes a CPU reset. Default is off.
     * PCVT_USEKBDSEC - Do NOT override a security lock for the keyboard.
       Default is on.
     * PCVT_24LINESDEF - If enabled, the 25-line modi (VT emulation with
       25 lines, and HP emulation with 28 lines) default to 24 lines only
       to provide a better compatibility to the original DEV VT220 (TM).
     * PCVT_EMU_MOUSE - Emulate a three-button mouse via the keypad.
       Useful for notebooks when running XFree86. Defaults to off
     * PCVT_META_ESC - If enabled, a sequence composed of < esc >,
       followed by the normalkey code is emitted if a key is pressed with
       the < Alt > key modifier. If disabled, then normal key code with
       the value 0x80 added is sent. Defaults to off.

   SCSI Subsystem Options
     * SCSITERSE - Terser SCSI error messages. This omits the table for
       decoding ASC/ASCQ info, saving about 8 bytes or so.
     * SCSIDEBUG - Prints extra debugging info for the SCSI subsystem to
       the console.

5.3 - Building your own kernel

   Full instructions for creating your own custom kernel are in the
   [39]afterboot(8) man page.

   To compile your kernel from the cdrom do the following:

#cd /somewhere
#cp /usr/src/sys/arch/$ARCH/conf/SOMEFILE .
#vi SOMEFILE (to make the changes you want)
#config -s /usr/src/sys -b . SOMEFILE
#make

   To compile a kernel inside a writeable source tree do the following:

#cd /sys/arch/$ARCH/conf
#vi SOMEFILE (to make any changes you want)
#config SOMEFILE (read more about it here : [40]config(8))
#cd ../compile/SOMEFILE
#make

   Where $ARCH is the architecture you are using (e.g. i386). You can
   also do a make depend to make the dependencies for the next time you
   compile your kernel.

   To move your kernel into place.

#cp /bsd /bsd.old
#cp /sys/arch/$ARCH/compile/SOMEFILE/bsd /bsd

   To revert to your old kernel at boot you need to just

boot>bsd.old

   and your old kernel will be loaded instead of /bsd.

5.4 - Boot Time Configuration

   Sometimes when booting your system you might notice that the kernel
   finds your device but maybe at the wrong IRQ. And maybe you need to
   use this device right away. Well, without rebuilding the kernel you
   can use OpenBSD's boot time kernel configuration. This will only
   correct your problem for one time. If you reboot, you will have to
   repeat this procedure. So, this is only meant as a temporary fix, and
   you should correct the problem by fixing and recompiling your kernel.
   Your kernel does however need option BOOT_CONFIG in the kernel, which
   GENERIC does have.

   Most of this document can be found in the man page [41]boot_config(8)
   To boot into the User Kernel Config, or UKC, at boot time us the -c
   option.

Boot> boot wd0a:/bsd -c

   Or whichever kernel it is you want to boot. Doing this will bring up a
   UKC prompt. From here you can issue commands directly to the kernel
   specifying devices you want to change or disable or even enable.

   Here is a list of common commands in the UKC.

   add device - Add a device through copying another

   change devno | device - Modify one or more devices

   disable devno | device - Disable one or more devices

   enable devno | device - Enable one or more devices

   find devno | device - Find one or more devices

   help - Short summary of these commands

   list - List ALL known devices

   exit/quit - Continue Booting

   show [attr [val]] - Show devices with an attribute and optional with a
   specified value

   Once you get your device configured, use quit or exit and continue
   booting. After so you should correct your Kernel configuration and
   Compile a new kernel. Refer to [42]Building your own kernel for help.

   [43][Back to Main Index] [44][To Section 4.0 - Installation and Disk
   Setup] [45][To Section 6.0 - Networking]
     _________________________________________________________________

   [46][back] [47]www@@openbsd.org
   $OpenBSD: obsd-faq.txt,v 1.6 1999/06/25 18:53:51 ericj Exp $

References

   1. http://www.openbsd.org/faq/index.html
   2. http://www.openbsd.org/faq/faq4.html
   3. http://www.openbsd.org/faq/faq6.html
   4. http://www.openbsd.org/cgi-bin/man.cgi?query=options&apropos=0&sektion=4&format=html
   5. http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/alpha/conf/
   6. http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/i386/conf/
   7. http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/mac68k/conf/
   8. http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/pmax/conf/
   9. http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/sparc/conf/
  10. http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/
  11. http://www.openbsd.org/cgi-bin/cvsweb/src/sys/conf/GENERIC
  12. http://www.openbsd.org/cgi-bin/man.cgi?query=compat_svr4&sektion=8&apropos=0&manpath=OpenBSD+Current
  13. http://www.openbsd.org/cgi-bin/man.cgi?query=compat_bsdos&sektion=8&apropos=0&manpath=OpenBSD+Current
  14. http://www.openbsd.org/cgi-bin/man.cgi?query=compat_linux&sektion=8&apropos=0&manpath=OpenBSD+Current
  15. http://www.openbsd.org/cgi-bin/man.cgi?query=compat_sunos&sektion=8&apropos=0&manpath=OpenBSD+Current
  16. http://www.openbsd.org/cgi-bin/man.cgi?query=compat_ultrix&sektion=8&apropos=0&manpath=OpenBSD+Current
  17. http://www.openbsd.org/cgi-bin/man.cgi?query=compat_freebsd&sektion=8&apropos=0&manpath=OpenBSD+Current
  18. http://www.openbsd.org/cgi-bin/man.cgi?query=compat_ibcs2&sektion=8&apropos=0&manpath=OpenBSD+Current
  19. http://www.openbsd.org/cgi-bin/man.cgi?query=ddb&sektion=4&format=html
  20. http://www.openbsd.org/cgi-bin/man.cgi?query=gdb&sektion=1&format=html
  21. http://www.openbsd.org/cgi-bin/man.cgi?query=ktrace&sektion=1&format=html
  22. http://www.openbsd.org/cgi-bin/man.cgi?query=kgmon&sektion=8&format=html
  23. http://www.openbsd.org/cgi-bin/man.cgi?query=mount_null&sektion=8&format=html
  24. http://www.openbsd.org/faq/faq4.html#4.9
  25. http://www.openbsd.org/cgi-bin/man.cgi?query=options&sektion=4&format=html
  26. http://www.openbsd.org/faq/faq10.html#10.10
  27. http://www.openbsd.org/cgi-bin/man.cgi?query=lkm&sektion=4&format=html
  28. http://www.openbsd.org/cgi-bin/man.cgi?query=init&sektion=8&format=html
  29. http://www.openbsd.org/cgi-bin/man.cgi?query=ccd&sektion=4&format=html
  30. http://www.openbsd.org/faq/faq12.html#12.2
  31. http://www.openbsd.org/faq/faq6.html
  32. http://www.openbsd.org/faq/faq12.html#12.1
  33. http://www.openbsd.org/cgi-bin/man.cgi?query=options&sektion=4&format=html
  34. http://www.openbsd.org/cgi-bin/man.cgi?query=ns&sektion=4&apropos=0&manpath=OpenBSD+Current
  35. http://www.openbsd.org/cgi-bin/man.cgi?query=iso&sektion=4&format=html
  36. http://www.openbsd.org/cgi-bin/man.cgi?query=pfil&sektion=9&format=html
  37. http://www.openbsd.org/cgi-bin/man.cgi?query=pcap&sektion=3&format=html
  38. http://www.openbsd.org/cgi-bin/man.cgi?query=ipsec&sektion=4&format=html
  39. http://www.openbsd.org/cgi-bin/man.cgi?query=afterboot&apropos=0&sektion=8&format=html
  40. http://www.openbsd.org/cgi-bin/man.cgi?query=config&apropos=0&sektion=8&format=html
  41. http://www.openbsd.org/cgi-bin/man.cgi?query=boot_config&apropos=0&sektion=8&format=html
  42. http://www.openbsd.org/faq/faq5.html#5.3
  43. http://www.openbsd.org/faq/index.html
  44. http://www.openbsd.org/faq/faq4.html
  45. http://www.openbsd.org/faq/faq6.html
  46. http://www.openbsd.org/faq/index.html
  47. mailto:www@@openbsd.org


   [1][Back to Main Index] [2][To Section 5.0 - Kernel configuration and
   Disk Setup] [3][To Section 7.0 - Keyboard controls]

                               6.0 - Networking
     _________________________________________________________________

6.1 - Initial Network Setup

  Interfaces

   Here we assume you have all your network interfaces working, and a
   basic TCP/IP knowledge. If not, go to the [4]Kernel Configuration and
   Setup section, and/or read a nice intro to TCP/IP. Other recommended
   reading are the [5]ifconfig(8) and [6]netstat(1) man pages.

   All your interfaces should be listed with:

# ifconfig -a

lo0: flags=8009<UP,LOOPBACK,MULTICAST>
        inet 127.0.0.1 netmask 0xff000000
lo1: flags=8008<LOOPBACK,MULTICAST>
xl0: flags=8843<UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST>
        media: Ethernet 100baseTX half-duplex
        inet 10.1.1.1 netmask 0xffffff00 broadcast 10.1.1.255
sl0: flags=c010&ltPOINTOPOINT,LINK2,MULTICAST>
        inet 10.1.1.1 netmask 0xffffff00 broadcast 10.1.1.255
sl0: flags=c010<POINTOPOINT,LINK2,MULTICAST>
sl1: flags=c010<POINTOPOINT,LINK2,MULTICAST>
ppp0: flags=8010<POINTOPOINT,MULTICAST>
ppp1: flags=8010<POINTOPOINT,MULTICAST>
tun0: flags=10<POINTOPOINT>
tun1: flags=10<POINTOPOINT>
enc0: flags=8<LOOPBACK>

   First there is lo0 the loopback interface. It MUST have the assigned
   address of 127.0.0.1 no matter what network setup you use. The next
   important one is xl0 in this example (could be neX or epX depending on
   the brand), which is a board itself. Look it has UP and RUNNING flags
   on, as lo0 but no other interface have them. That means oviously they
   are working. Your interface could be down if you never configured it,
   and look like the other interfaces. The others are not part of this
   section, as sl and ppp are for serial line comunication, tun is a
   pseudo-device for tunneling and enc a pseudo-device for encryption.

   If xl0 was uninitialized, you can assign it an address creating a
   ascii file /etc/hostname.xl0 having a string like this:

inet mona 255.255.255.0 NONE

   This hostname 'mona' needs to have record in /etc/hosts:

10.1.1.1        mona    mona.openbsd.org.ar

   What actually happens when you boot is that it looks up 'mona' in
   /etc/hosts, and then configures the interface to 10.1.1.1. If you have
   multiple ethernet interfaces, this is probably a painful way to do
   things, and so you can also put the number right in /etc/hostname.xl0:
inet 10.1.1.1 255.255.255.0 NONE

   Now check that you have a file /etc/myname and a file /etc/mygate. If
   you don't have them, you need to create them. If your gateway is a
   machine named "wintermute" wich is also in the /etc/hosts, use this
   commands:

# echo "mona" > /etc/myname
# echo "wintermute" > /etc/mygate

   Ok, you are done for a standalone system, but to activate your
   configuration now (without rebooting) do:

# sh /etc/netstart

   This will give you a few errors, but don't worry as all them are
   concerning 127.0.0.x (loopback)

   Note: if you want to use the system as a gateway, later there's a
   "Firewall Setup" section, but you need to read all this first.

   Now check your routes are ok (here we use -n to make it simpler to
   look at):

# netstat -rn
Routing tables

Internet:
Destination        Gateway            Flags     Refs     Use    Mtu
Interface
default            10.1.1.254         UGS         0        0      -  xl0
10.1.1/24          link#1             UC          0        0      -  xl0
10.1.1.1           127.0.0.1          UGHS        0        0      -  lo0
10.1.1.254         link#1             UHL         1        0      -  xl0
127/8              127.0.0.1          UGRS        0        0      -  lo0
127.0.0.1          127.0.0.1          UH          3       24      -  lo0
224/8              link#1             UCS         0        0      -  xl0

Encap:
Source address/netmask          Port  Destination address/netmask     Port Prot
o SA(Address/SPI/Proto)

   (The default gateway here is 10.1.1.254)

  IP Aliasing

   If you want to map more than one IP address on a single network
   interface, you need to assign an "alias" to it. The way to do it on
   OpenBSD is simply assigning the interface another IP with the "alias"
   option like this:

# ifconfig xl0 alias 10.1.1.2 netmask 255.255.255.255

   Here ne2 is assigned another IP number (remember it already has
   10.1.1.1). Note the netmask used! Don't use 255.255.255.0 in this kind
   of cases (both numbers are on the same subnet), only ONE address
   should handle the subnet. If you do such kind of misconfiguration, the
   following error appears:

ifconfig:SIOCAIFADDR: File exists

   Now let's change the configuration file for this, /etc/ifaliases. Add
   to it this line:

xl0   10.1.1.2 255.255.255.255

   This means, simply, interface xl0 should have an alias 10.1.1.2 with
   the netmask 255.255.255.255.

  DNS Client Setup

   Let's assume your DNS servers are 125.2.3.4 and 125.2.3.5, and your
   machine name belongs to the domain yourdomain.com. You should have the
   following lines to your /etc/resolv.conf file:

domain yourdomain.com
nameserver 125.2.3.4
nameserver 125.2.3.5

  Gateway Setup

   This is the basic information you need to set up your OpenBSD box as a
   gateway (also called a router.) If you are using OpenBSD as a router
   on the Internet, we suggest that you also read the IP Filter setup
   instructions below to block potentially malicious traffic. Also, due
   to the low availability of IPv4 addresses from network service
   providers and regional registries, you may want to look at Network
   Address Translation (next section of this document) for information on
   conserving your IP address space.

   If you want your OpenBSD machine to act as a dedicated router, and you
   are building a custom kernel configuration for it, you can either
   compile your kernel with options IPFORWARDING or GATEWAY. (See
   [7]section 12 for further information on tuning NMBCLUSTERS if you are
   doing this.) For the rest of us, OpenBSD now has a sysctl mechanism to
   turn on and off IP Forwarding at boot. If you want it to "forward" any
   packets between your interfaces, modify the /etc/sysctl.conf line that
   toggles the forwarding variable on bootup:

net.inet.ip.forwarding=1

   To make the changes without booting:

# sysctl -w net.inet.ip.forwarding=1
net.inet.ip.forwarding: 0 -> 1

   Now modify the routes on the other hosts on both sides. There are many
   possible uses of OpenBSD as a router, using software such as
   [8]routed(8), [9]gated, [10]mrtd, and [11]zebra. OpenBSD has support
   in the ports collection for both gated and mrtd. OpenBSD supports
   several T1, HSSI, ATM, FDDI, Ethernet, and serial (PPP/SLIP)
   interfaces.

6.2 - IP Filter - ipf and ipnat setup

   The IP Filter package was created to handle with two tasks, dealing
   with packet level forwarding permissions [12]ipf(8) and mapping
   hosts/subnets to a range of external addresses [13]ipnat(8). The
   configuration files for these two services are /etc/ipf.rules and
   /etc/ipnat.rules.

   You need to edit /etc/rc.conf to activate them at boot time. You also
   need to have net.inet.ip.forwarding=1 in your /etc/sysctl.conf (or
   your kernel needs to have IPFORWARDING or GATEWAY options turned on.)
   You also need a kernel compiled with option IPFILTER and IPFILTER_LOG
   (the GENERIC kernels do have these options).

   If you have IP Filter compiled in to your kernel, but you don't have
   it turned on in your /etc/rc.conf file, you can still activate it
   easily.
# ipf -Fa -f /etc/ipf.rules -E
# ipnat -CF -f /etc/ipnat.rules

   The -E flag on ipf 'enables' IP Filter. -Fa clears out any rules that
   you may have in there. -f /etc/ipf.rules loads the rules from
   /etc/ipf.rules.

   If you make changes to /etc/ipf.rules after ipf is loaded, you can
   reload your rules pretty easily!
# ipf -Fa -f /etc/ipf.rules

   Same for ipnat...
# ipnat -CF -f /etc/ipnat.rules

   This document will cover some basic ipf and ipnat configurations
   below. There are a lot of nice examples in /usr/share/ipf/ for ipnat
   and ipf. We recommend you to choose the one closer to what you want,
   and modify it to fit your needs. You can find other IP Filter
   information at the IP Filter [14]mailing list archive, the [15]IP
   Filter web site, and finally the [16]the IP Filter HOWTO.

  IPF

   Modify rc.conf so it has IPFILTER=YES. The file /etc/ipf.rules has a
   simple yet powerful syntax. Here we deal with the most common ways of
   usage, for a more strict definition see [17]ipf(5). Here is assumed
   xl0 as the external interface to internet, on this one uses to have
   more rules than internal interfaces.

   Configurations usually start letting everything come and go, and then
   apply the necesary rules to block offending packets. So this is first:

pass out from any to any
pass in from any to any

   Now lets block any incoming connection to port 82 tcp (eg. there's an
   internal network report agent using http running on several hosts):

block in on xl0 proto tcp from any to any port = 82

   This rule means:

   "Block all incoming packets on xl0 interface whose protocol is TCP no
   matter destination/origin using port 82"

   If you want to log all rejected packets add "log" after "block in", or
   "log quick" if you don't want it to send a message to every console
   root is logged in.

   Also, a typical rule is to block rpc portmap:

block in log on xl0 proto udp from any to any port = sunrpc

  IPNAT

   Based on [18]RFC 1631, ipnat provides an easy way to map internal
   networks to a single routeable ("real") internet address. This is very
   useful if you don't have officially asigned addresses for every host
   on your internal network. When you set up private/internal networks
   you can take advantage of reserved address blocks (assigned in [19]RFC
   1918), such as:

   10.0.0.0/8 (10.0.0.0 - 10.255.255.255)
   172.16.0.0/12 (172.16.0.0 - 172.31.255.255)
   192.168.0.0/16 (192.168.0.0 - 192.168.255.255)

   To use ipnat, ipf must be activated. As outlined above, for changes to
   stay effective through reboots, you should make changes to
   /etc/rc.conf (where it has IPNAT and IPFILTER.) You can manually
   activate ipf with the command below.
# ipf -E

   Example: You have an internal network using 192.168.5.0, with a
   netmask of 255.255.255 0, and you want to give it access to internet
   using OpenBSD (of course!), and a ppp connection using address
   200.1.2.3, use this rule:

map tun0 192.168.5.0/24 -> 200.1.2.3/32

   This rule means:

   "Any IP connections going out tun0 from an address matching the first
   24 bits of 192.168.0.0 should be mapped to the address 200.1.2.3 (only
   one address since /32 means every bit)"

   If you don't like using CIDR notation, IP Filter also allows you to
   use netmasks. A functional equivalent to the example above, using
   netmasks looks like this:

map tun0 192.168.5.0/255.255.255.0 -> 200.1.2.3/255.255.255.255

   But here arises a problem. You are assigning a lot of addresses to
   only one address. But the port numbers aren't changing, and it is very
   likely that your workstations on 192.168.5.0/24 will use the same port
   numbers to initiate connections from. (If this doesn't make sense,
   don't worry, but keep reading.) The way to go arount it is to map TCP
   and UDP ports to a certain range with the option "portmap". Since ICMP
   doesn't even use ports, it is not covered by the "portmap" rule. (ICMP
   uses an ID field usually based on a process number) In our example,
   there are now two map rules to cover all of these protocols. The end
   result looks like this:

map tun0 192.168.5.0/24 -> 200.1.2.3/32 portmap tcp/udp 10000:65000
map tun0 192.168.5.0/24 -> 200.1.2.3/32

   If you have a dynamic address assignment (as in, you do not know what
   address they will give you when you connect), you can put the
   interface name in place of the IP address. Note that if you do this,
   you will have to run ipnat -CF -f /etc/ipnat.rules every time your IP
   address changes (or, every time you dial up.)

map tun0 192.168.5.0/24 -> tun0/32 portmap tcp/udp 10000:65000
map tun0 192.168.5.0/24 -> tun0/32

   NAT is also able to help you in renumbering. Say you were assigned a
   net block 35.8.9.0/22, and your internet provider can no longer route
   thse addresses to you, or say you are switching providers. Your new
   address block is 192.9.4.0/22, but to switch all 500 devices you have
   on this block would be very time consuming! ipnat provides a feature
   called bimap:

bimap xl0 35.8.9.0/22 -> 192.9.4.0/22

   This will literally map every computer in 35.8.9.0 to a new address in
   192.9.4.0. The drawback of this feature is that the translation is not
   consistent. A computer that initiates a connection from 35.8.9.0 will
   get a random IP address from 192.9.4.0. A future version of IP Filter
   will allow for one-to-one translation (where 35.8.9.99 will always get
   mapped to 192.9.4.99).

   And of course, there are other potential uses of NAT that are probably
   beyond the scope of this document.

  Redirecting ports

   This is another very handy feature of IPNAT. If you have a host on the
   internal network (using private addresses), and you want to let
   incoming connections to it, you just need a simple redirect rule. For
   example, if you have a web server on internal network at 10.2.2.7
   listening on port 80, and want it to be accesible from the outside
   simply redirecting external IP 120.2.3.4 on xl0, just add this rule to
   /etc/ipnat.rules:

rdr xl0 120.2.3.4 port 80 -> 10.2.2.7 port 80

   When you write rules, it may help to visualize the packet flow.

Internet <--> (xl0 120.2.3.4) OpenBSD (xl1 10.2.2.1) <--> LAN <--> (10.2.2.7 XY
Z Web server)

   One last reminder that you must have net.inet.ip.forwarding=1 or
   option IPFORWARDING to use IP Filter (ipf, ipnat). Also, redirect only
   works for packets that are being routed through the OpenBSD box. If a
   web browser from inside the NAT (say, from 10.2.2.5 from the example
   above) tries to connect to port 80 on 120.2.3.4, nothing will happen.

6.3 - IPSec

   IPSec is partially documented in the [20]vpn(8) man page. There are
   various files in [21]/usr/share/ipsec/ directory which can also assist
   you. The manual pages for [22]ipsec(4), [23]ipsecadm(8),
   [24]photurisd(8), [25]startkey(1), [26]isakmpd(8) and
   [27]isakmpd.conf(5) are also available!

   You should also check [28]Codetalker which has an FAQ for setting up
   an IPSec VPN with OpenBSD. It explains some basic IPSec concepts and
   how to apply them to a VPN setup.

6.4 - DHCP

   To use the DHCP client [29]dhclient(8) included with OpenBSD, edit
   /etc/hostname.xl0 (this is assuming your main ethernet interface is
   xl0. Yours might be ep0 or fxp0 or something else!) All you need to
   put in this hostname file is 'dhcp'
# echo dhcp >/etc/hostname.xl0

   This will cause OpenBSD to automatically start the DHCP client on
   boot. OpenBSD will gather its' IP address, default gateway, and DNS
   servers from the DHCP server.

   If you want to use OpenBSD as a DHCP server [30]dhcpd(8), edit
   /etc/rc.conf. Set it up so that dhcpd_flags="-q" instead of
   dhcpd_flags=NO. Put the interfaces that you want dhcpd to *listen* on
   in /etc/dhcpd.interfaces.
# echo xl1 xl2 xl3 >/etc/dhcpd.interfaces

   Then, edit /etc/dhcpd.conf. The options are pretty self explanatory.
        option  domain-name "xyz.mil";
        option  domain-name-servers 192.168.1.3, 192.168.1.5;

        subnet 192.168.1.0 netmask 255.255.255.0 {
                option routers 192.168.1.1;

                range 192.168.1.32 192.168.1.127;
        }

   This will tell your dhcp clients that the domain to append to DNS
   requests is xyz.mil (so, if the user types in 'telnet joe' then it
   will send them to joe.xyz.mil). It will point them to DNS servers
   192.168.1.3 and 192.168.1.5. For hosts that are on the same network as
   an ethernet interface on the OpenBSD machine, which is in the
   192.168.1.0/24 range, it will assign them an IP address between
   192.168.1.32 and 192.168.1.127. It will set their default gateway as
   192.168.1.1.

6.5 - PPP

   PPP is generally an easy thing to set up. What follows is a basic
   intro based on the information provided in /etc/ppp and the [31]ppp(8)
   manual pages. These are highly suggested reading before attempting to
   setup PPP or even reading this FAQ entry. If you have read these the
   following should look farmiliar because it is that info with a little
   bit of elaboration.

   First you will need to find out a little bit about how your ISP sets
   up its PPP connections. Does it use scripted login, PAP, CHAP, do you
   have a dynamic or static IP etc. This along with some basic info about
   your modem will allow us to easily create a PPP dial in script for
   your ISP.

   First we will create a PPP conf using what is already in
   /etc/ppp/ppp.conf.sample as a guide. The first section we come to is
   the section labeled default. This is the best place to specify logging
   options, your modem device and dial options. It will always be
   executed when ppp is run. The following is the default section that
   comes standard with /etc/ppp/ppp.conf.sample and an explanation of
   what each parameter does:
   <Default Section>
default:
set log Phase Chat LCP IPCP CCP tun command      #This parameter tells PPP to l
og output which pertains
                                                 #to the arguments you give the
 parameter.

set device /dev/cua01                            #This will set the default mod
em device on the system
                                                 #which here is comm 2.

set speed 115200                                 #This parameter sets the speed
 of the serial device.

set dial "ABORT BUSY ABORT NO\\sCARRIER TIMEOUT 5 \"\" AT OK-AT-OK ATE1Q0 OK \\
dATDT\\T TIMEOUT 40 CONNECT"
                                                 #This will set the commands to
 follow when certian actions
                                                 #take place while dialing.  Ab
ort the call if the number is
                                                 #busy, abort the call if there
 is no carrier.  Wait 5 seconds for
                                                 #carrier. Issue AT and wait fo
r response. If AT is ok then dial the
                                                 #number and timeout if not con
nected in 40 seconds. Once dialed
                                                 #in wait for the CONNECT messa
ge to tell us we are connected.

   Now that the default modem options are set we will need to create a
   section in the ppp.conf for our ISP. Below are a few examples of what
   could be in there and what type of isp they are tailored for.
   <MyISP Section>
myisp:
set phone 1234567                        #This of course sets the number to dia
l for your isp.

set login "ABORT NO\\sCARRIER TIMEOUT 5 ogin:--ogin: ppp word: ppp"
                                         #This sets the login options.  It will
 abort login if
                                         #there is no carrier with a timeout of
 5 seconds.  It
                                         #will then wait for the login: prompt
and send
                                         #your login name, and then it will wai
t for the password
                                         #prompt and send your password.

set timeout 120                          #This sets the timeout for the entire
login process.

set ifaddr 10.0.0.1/0 10.0.0.2/0 255.255.255.0 0.0.0.0
                                         #This will set the ip address you expe
ct your your side
                                         #and for the remote side of the connec
tion. The /0 bit
                                         #tells the connection that no bits of
this ip address
                                         #need to match and the whole thing can
 be replaced.
                                         #This also sets your default netmask a
nd gateway.

add default HISADDR                      #This will make the default gateway th
e remote end of
                                         #the ppp connection.

enable dns                               #This tells ppp to ask the peer for th
e nameserver
                                         #addresses that should be used. This i
snt always supported,
                                         #but if it is /etc/resolv.conf will au
tomatically be updated.

   <Pap/Chap Section>

   What if your ISP uses PAP or CHAP? Here is a configuration that will
   work with both PAP or CHAP, PPP will decide which it needs to use.
myispPAPCHAP:
set PHONE 1234567                        #This line sets the phone number.

set LOGIN                                #PPP will be waiting for the peer to s
uggest the use of
                                         #either PAP or CHAP.

set authname MyName                      #This is where you specify your userna
me.

set authkey MyKey                        #This is where you specify your passwo
rd.

set timeout 120                          #This sets the login timeout to 120 se
conds.

   And then procede with the standard commands from above.
   <Static Ip Section>

   All you need to do is change the ifaddr parameter like so:

set ifaddr 209.115.93.18 209.115.93.20

   In this example, your IP is 209.115.93.18, and the peer side IP is
   209.115.93.20.

   [32][Back to Main Index] [33][To Section 5.0 - Kernel configuration
   and Disk Setup] [34][To Section 7.0 - Keyboard controls]
     _________________________________________________________________

   [35][back] [36]www@@openbsd.org
   $OpenBSD: obsd-faq.txt,v 1.6 1999/06/25 18:53:51 ericj Exp $

References

   1. http://www.openbsd.org/faq/index.html
   2. http://www.openbsd.org/faq/faq5.html
   3. http://www.openbsd.org/faq/faq7.html
   4. http://www.openbsd.org/faq/faq5.html
   5. http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&apropos=0&sektion=8&format=html
   6. http://www.openbsd.org/cgi-bin/man.cgi?query=netstat&apropos=0&sektion=1&format=html
   7. http://www.openbsd.org/faq/faq12.html
   8. http://www.openbsd.org/cgi-bin/man.cgi?query=routed&apropos=0&sektion=8&format=html
   9. http://www.gated.org/
  10. http://www.mrtd.net/
  11. http://www.zebra.org/
  12. http://www.openbsd.org/cgi-bin/man.cgi?query=ipf&apropos=0&sektion=8&format=html
  13. http://www.openbsd.org/cgi-bin/man.cgi?query=ipnat&apropos=0&sektion=8&format=html
  14. http://false.net/ipfilter/
  15. http://cheops.anu.edu.au/~avalon/ip-filter.html
  16. http://www.swcp.com/~synk/ipf-howto.txt
  17. http://www.openbsd.org/cgi-bin/man.cgi?query=ipf&apropos=0&sektion=5&format=html
  18. http://www.geektools.com/rfc/rfc1631.txt
  19. http://www.geektools.com/rfc/rfc1918.txt
  20. http://www.openbsd.org/cgi-bin/man.cgi?query=vpn&apropos=0&sektion=0&format=html
  21. http://www.openbsd.org/cgi-bin/cvsweb/src/share/ipsec/
  22. http://www.openbsd.org/cgi-bin/man.cgi?query=ipsec&apropos=0&sektion=4&format=html
  23. http://www.openbsd.org/cgi-bin/man.cgi?query=ipsecadm&apropos=0&sektion=8&format=html
  24. http://www.openbsd.org/cgi-bin/man.cgi?query=photurisd&apropos=0&sektion=8&format=html
  25. http://www.openbsd.org/cgi-bin/man.cgi?query=startkey&apropos=0&sektion=1&format=html
  26. http://www.openbsd.org/cgi-bin/man.cgi?query=isakmpd&apropos=0&sektion=8&format=html
  27. http://www.openbsd.org/cgi-bin/man.cgi?query=isakmpd.conf&apropos=0&sektion=5&format=html
  28. http://www.codetalker.com/greenbox/docs/vpn-24-minifaq.html
  29. http://www.openbsd.org/cgi-bin/man.cgi?query=dhclient&apropos=0&sektion=8&format=html
  30. http://www.openbsd.org/cgi-bin/man.cgi?query=dhcpd&apropos=0&sektion=8&format=html
  31. http://www.openbsd.org/cgi-bin/man.cgi?query=ppp&apropos=0&sektion=8&format=html
  32. http://www.openbsd.org/faq/index.html
  33. http://www.openbsd.org/faq/faq5.html
  34. http://www.openbsd.org/faq/faq7.html
  35. http://www.openbsd.org/faq/index.html
  36. mailto:www@@openbsd.org


   [1][Back to Main Index] [2][To Section 6.0 - Networking] [3][To
   Section 8.0 - General Questions]

                            7.0 - Keyboard controls

7.1 - How do I remap the keyboard?

   By using kcon(1), "kcon - keyboard control and remapping for the pcvt
   driver"

   Example:

   bsd# kcon -m gb will load the keycap file for Great Britain.

7.2 - Is there gpm or the like in OpenBSD?

   No. But if you are willing to make a port. Please share. :)

   [4][Back to Main Index] [5][To Section 6.0 - Networking] [6][To
   Section 8.0 - General Questions]
     _________________________________________________________________

   [7][back] [8]www@@openbsd.org
   $OpenBSD: obsd-faq.txt,v 1.6 1999/06/25 18:53:51 ericj Exp $

References

   1. http://www.openbsd.org/faq/index.html
   2. http://www.openbsd.org/faq/faq6.html
   3. http://www.openbsd.org/faq/faq8.html
   4. http://www.openbsd.org/faq/index.html
   5. http://www.openbsd.org/faq/faq6.html
   6. http://www.openbsd.org/faq/faq8.html
   7. http://www.openbsd.org/faq/index.html
   8. mailto:www@@openbsd.org


   [1][Back to Main Index] [2][To Section 7.0 - Keyboard controls] [3][To
   Section 9.0 - Tips for linux users]

                            8.0 - General Questions

8.1 - What are these Kerberos warning when I first login?

   When you first install your system you will most likely notice a
   warning message that is something like this:

   Warning: no Kerberos tickets issued.

   THIS WARNING IS COMPLETELY IRRELEVANT AND SHOULD ONLY BE REMOVED IF
   COMPLETELY NECESSARY

   Well since you probably haven't set up Kerberos on your system, you
   wouldn't be getting a ticket. If you do have Kerberos running, you
   need to check into that. If you can't STAND that warning and never
   plan on using Kerberos here is how to get rid of it for good.

     * Make sure you have the source code.
     * Edit /usr/share/mk/bsd.own.mk and set KERBEROS to 'no', or create
       an /etc/mk.conf file that does this.
     * cd /usr/src/usr.bin/login ; make clean ; make ; make install

8.2 - How do I change virtual terminals?

   Simply type [ctrl] - [alt] - [One of the function keys] or just hit
   [f9]-[f12] which are just mapped to [ctrl] - [alt]
   functions. (i386)

   Only the i386 arch has virtual terminal capabilities. You can also use
   virtual terminals when using X. For example, If you start X on term 1,
   and switch with [ctrl]-[alt]-[F2] to term 2, X will seem to disapear
   and will not come back by simply switching back to term 1. You must
   [ctrl]-[alt]-[F5] to get your X display back.

8.3 - I forgot my root password, what do I do now?

   A few steps to recovery
    1. Boot into single user mode. For i386 arch type boot -s at the boot
       prompt.
    2. mount the drives.
          + bsd# fsck -p / && mount -u /
          + if /usr is on a different partition you need to mount that
            also
    3. type passwd
    4. boot into mulituser mode.. and REMEMBER your password .

8.4 - X wont start, I get tons of error messages

   If you have X completely set up and you are using an XF86Config that
   you know works then the problem most likely lies in the
   machdep.allowapature. You also need to make sure that both:

option XSERVER
option APERTURE

   are in you kernel configuration. [BOTH these are in the GENERIC
   kernel]

   Then you need to edit /etc/sysctl.conf
   and set machdep.allowaperture=1. This will allow X to access the
   aperture driver. This would be set up if the question during install
   about whether or not you would be running X was answered correctly.
   OpenBSD 2.4 requires for all X servers that the aperture driver be
   set, because it controls access to the I/O ports on video boards.

   For other X problems on the i386, consult the XFree86 FAQ at
   [4]http://www.xfree86.org/FAQ/.

8.5 - What is CVS? and How do I use it?

   CVS is what the OpenBSD project uses to control changes to the source
   code. CVS stands for Concurrent Versions System. You can read more
   about CVS at [5]http://www.cyclic.com/. CVS can be used by the end
   user to keep up to date with source changes, and changes in the ports
   tree.

   CVS makes it extremely simple to download the source via one of the
   many CVS mirrors for the project.

   Here are some simple commands to get you going on CVS.

   For all these commands a CVSROOT variable must be set. You can do this
   by:

   If you use csh or tcsh use:
   bsd# setenv CVSROOT anoncvs@@anoncvs.ca.openbsd.org:/cvs

   or if you use sh or ksh use:
   bsd# export CVSROOT="anoncvs@@anoncvs.ca.openbsd.org:/cvs"

   It is best to try to find a mirror that is closest to you. You can
   obtain a list of CVS mirrors from
   [6]http://www.openbsd.org/anoncvs.html.

   All these commands are run from the /usr directory if you do not have
   the source code already. The source or ports however can be initially
   downloaded in tarred and gzipped form from any of the ftp servers.
   They are set and ready to be used with CVS.

     * bsd# cvs -q get -PAd src [to get source code] or
     * bsd# cvs -q get -PAd ports [to get the ports tree]

   If you already have an existing source or ports tree:
     * bsd# cvs -q up -PAd src
     * bsd# cvs -q up -PAd ports

   For some, bandwidth and time are serious problems when updating
   repository's such as these. So CVS has a -z[1-9] option which uses
   gzip to compress the data. To use it, do -z[compression-level], for
   instance, -z3 for a compression level of 3.

   There are many different connections you can make to a CVS mirror.
   This is to accompany people from all types of networks, whether you
   are behind a firewall, etc.

   You can make either a ssh, rsh, or pserver connection to the servers.
   Many mirrors also run ssh on port 2022.

   To do this you can use the variable $CVS_RSH. rsh(1) is what CVS uses
   by default, but using the $CVS_RSH environment variable you can have
   CVS use ssh.
   An example:

   #setenv CVS_RSH /usr/local/bin/ssh
   or
   #export CVS_RSH=/usr/local/bin/ssh

8.6 - What is the ports tree?

   The ports tree is a set of Makefiles that download, patch, configure
   and install userland programs so you can run them an OpenBSD
   environment without having to do all that by hand. You can get the
   ports tree from any of the OpenBSD ftp servers in
   /pub/OpenBSD/2.5/ports.tar.gz or try the latest updates in
   /pub/OpenBSD/snapshots/ports.tar.gz.

   If you want to run one of the latest ports collections, you'll need to
   update your /usr/share/mk/ directory. CVS up your /usr/src/ directory
   and do a:
# cd /usr/src/share/mk/
# make install

   first.

   A snapshot of the ports tree is also created daily and can be
   downloaded from any of the [7]OpenBSD ftp servers as
   /pub/OpenBSD/snapshots/ports.tar.gz.

   In 2.5-current this information is now stored in the ports tree. In
   ports/infrastructure/ all thats left in /usr/src/share/mk for ports is
   just a pointer to this new area. So, once you have the ports working
   witht the infrastructure dir, you no longer need to do the step from
   above.

   Ports are set up to be EXTREMELY easy to make and install. Here is an
   example install for someone wanting to install the X11 program xfig.
   You'll notice the dependencies are automaticly detected and completed:

   First you need to cd to the dir of the program you want. If you are
   searching for a program, you can either update your locate database,
   or use the search function talked about below. Once you are in the dir
   of the program you want, you can just type make install. For example.
fenetyllin:/usr/ports/graphics/xfig# make install
===>  Extracting for xfig-3.2.2
===>  xfig-3.2.2 depends on shared library: jpeg.62. - /usr/local/lib/libjpeg.s
o.62.0 found
===>  xfig-3.2.2 depends on shared library: Xaw3d.6. - not found
===>  Verifying install for Xaw3d.6. in /usr/ports/x11/Xaw3d
>> Xaw3d-1.3.tar.gz doesn't seem to exist on this system.
>> Attempting to fetch from ftp://crl.dec.com/pub/X11/contrib/widgets/Xaw3d/R6.
1/.
Connected to crl.dec.com.
220 crl.dec.com FTP server (Digital UNIX Version 5.60) ready.
331 Guest login ok, send ident as password.
230 Guest login ok, access restrictions apply.
Remote system type is UNIX.
Using binary mode to transfer files.
200 Type set to I.
250 CWD command successful.
250 CWD command successful.
Retrieving pub/X11/contrib/widgets/Xaw3d/R6.1/Xaw3d-1.3.tar.gz
local: Xaw3d-1.3.tar.gz remote: Xaw3d-1.3.tar.gz
227 Entering Passive Mode (192,58,206,2,5,14)
150 Opening BINARY mode data connection for Xaw3d-1.3.tar.gz (0.0.0.0,0) (29027
7 bytes).
100% |**************************************************|   283 KB    00:00 ETA
226 Transfer complete.
290277 bytes received in 101.09 seconds (2.80 KB/s)
221 Goodbye.
===>  Extracting for Xaw3d-1.3
/bin/mkdir -p /usr/ports/x11/Xaw3d/work/xc/lib/Xaw3d/X11/Xaw3d
cd /usr/ports/x11/Xaw3d/work/xc/lib/Xaw3d/X11/Xaw3d; ln -sf ../../*.h .
===>  Patching for Xaw3d-1.3
===>  Configuring for Xaw3d-1.3
mv -f Makefile Makefile.bak
imake -DUseInstalled -I/usr/X11R6/lib/X11/config
make Makefiles
[snip]

   You can see a list of both ports and packages by using the pkg_info
   command.
bsd# /usr/sbin/pkg_info
zsh-3.0.5           The Z shell.
screen-3.7.4        A multi-screen window manager.
ssh-1.2.21          Secure shell client and server (remote login program).
emacs-20.2          GNU editing macros.
lynx-2.7.1ac-0.107  An alphanumeric display oriented World-Wide Web Client.
tcsh-6.07.02        An extended C-shell with many useful features.
bash-2.01           The GNU Borne Again Shell.
zip-2.2             Create/update ZIP files compatabile with pkzip.
mm-2.7              Implementation of MIME, the Multipurpose Internet Mail Exte
n
ircii-2.8.2-epic3.004 An enhanced version of ircII, the Internet Relay Chat cli
ent
ispell-3.1.20       An interactive spelling checker.
tin-1.3.970930      TIN newsreader (termcap based)
procmail-3.11p7     A local mail delivery agent.
strobe-1.03         Fast scatter/gather TCP port scanner
lsof-4.15           Lists information about open files.
xntp3-5.92          Network Time Protocol Implementation.
ncftp-2.4.3
 nmh-0.27            The New MH mail handling program
bzip2-0.1p12        A block-sorting file compressor

   If you are looking for a specific program in the ports tree, you can
   try
fenetyllin:/usr/ports/# make search key="xfig"
Port:   xfig-3.2.2
Path:   /home/ports/graphics/xfig
Info:   A drawing program for X11
Maint:  angelos@@openbsd.org
Index:  graphics x11
B-deps: Xaw3d-1.3 jpeg-6b
R-deps: Xaw3d-1.3 ghostscript-5.10 gv-3.5.8 jpeg-6b png-1.0.2 transfig-3.2.1
Archs:  any

Port:   transfig-3.2.1
Path:   /home/ports/print/transfig
Info:   Tools to convert Xfig's .fig files.
Maint:  angelos@@openbsd.org
Index:  print
B-deps: jpeg-6b
R-deps: ghostscript-5.10 jpeg-6b png-1.0.2
Archs:  any
[snip]

   More information about the ports can be found in the ports man page

   Our ports tree is constantly being expanded, and if you would like to
   help please see: [8]http://www.openbsd.org/ports.html

8.7 - What are packages?

   Packages are the precompiled binaries of some of the most used
   programs. They are ready for use on an OpenBSD system. Again, like the
   ports, packages are very easy to maintain and update. Packages are
   constantly being added so be sure to check each release for additional
   packages.

   Here is a list of tools used in managing packages.
     * pkg_add (1) - a utility for installing software package
       distributions
     * pkg_create (1) - a utility for creating software package
       distributions
     * pkg_delete (1) - a utility for deleting previously installed
       software package distributions
     * pkg_info (1) - a utility for displaying information on software
       packages

   Here is a sample user installing ispell via a package:

   bsd# pkg_add
   ftp://ftp.openbsd.org/pub/OpenBSD/2.5/packages/${arch}/ispell-3.1.20.t
   gz
   where ${arch} is your architecture

   Again, like with ports you can use the pkg_info(1) program to view
   what is already installed on your system.

   To delete packages you will want to use the pkg_delete(1) command. It
   is used the same way as pkg_add(1).

   bsd# /usr/sbin/pkg_delete ispell-3.1.20

   and it is gone.

   Packages can be found on any of the OpenBSD ftp mirror sites.
   [9]Http://www.OpenBSD.org/ftp.html
   or they can be found on your OpenBSD CD's.

8.8 - Is there any way to use my floppy drive if it's not attached during boot?

   Sure. You need to add "flags 0x20" at the end of the fd* entry and
   recompile your kernel. The line should be read:
   fd* at fdc? drive ? flags 0x20

   After that you would be able to use the floppy drive all the time. It
   doesn't matter if you plugged it later after boot.

8.9 - Boot time Options - Using the OpenBSD bootloader

   When booting your OpenBSD system, many of you have probobly noticed
   the boot prompt.

   boot>

   For most people, you won't have to do anything here. It will
   automatically boot if no commands are given. But sometimes problems
   arise, or special functions are needed. Thats where these options will
   come in handy. To start of, you should read through the [10]boot(8)
   man page. Here we will go over the most common used commands for the
   bootloader.

   To start off, if no commands are issued, the bootloader will
   automatially try to boot /bsd. If that fails it will try /obsd, and so
   on till it finds a bootable kernel. You can specify this by hand by
   typing:

   boot> boot wd0a:/bsd
   or
   boot> b /bsd

   This will work if device wd0a is configured as your root device.

   Here is a quick overview of options to be used with the boot
       parameter.
     * -a : This will allow you to specify an alternate root device after
       booting the kernel.
     * -c : This allows you to enter the boot time configuration. Check
       the [11]Boot Time Config section of the faq.
     * -s : This is the option to boot into single user mode.
     * -d : This option is used to dump the kernel into ddb. Keep in mind
       that you must have DDB built into the kernel.
     * -b : Shortcut for RB_HALT.

   These are entered in the format of:
   boot [ image [-abcds]]

   For further reading you can read [12]boot_i386(8) man page

   [13][Back to Main Index] [14][To Section 7.0 - Keyboard controls]
   [15][To Section 9.0 - Tips for linux users]
     _________________________________________________________________

   [16][back] [17]www@@openbsd.org
   $OpenBSD: obsd-faq.txt,v 1.6 1999/06/25 18:53:51 ericj Exp $

References

   1. http://www.openbsd.org/faq/index.html
   2. http://www.openbsd.org/faq/faq7.html
   3. http://www.openbsd.org/faq/faq9.html
   4. http://www.xfree86.org/FAQ/
   5. http://www.cyclic.com/
   6. http://www.openbsd.org/anoncvs.html
   7. http://www.openbsd.org/ftp.html
   8. http://www.openbsd.org/ports.html
   9. http://www.openbsd.org/ftp.html
  10. http://www.openbsd.org/cgi-bin/man.cgi?query=boot&sektion=8&format=html
  11. http://www.openbsd.org/faq/faq5.html#5.4
  12. http://www.OpenBSD.org/cgi-bin/man.cgi?query=boot_i386&sektion=8&format=html
  13. http://www.openbsd.org/faq/index.html
  14. http://www.openbsd.org/faq/faq7.html
  15. http://www.openbsd.org/faq/faq9.html
  16. http://www.openbsd.org/faq/index.html
  17. mailto:www@@openbsd.org


   [1][Back to Main Index] [2][To Section 8.0 - General Questions] [3][To
   Section 10.0 - System Administration]

                          9.0 - Migrating from Linux
     _________________________________________________________________

9.1 - Simple tips for Linux users

   There are several differences between OpenBSD and Linux. These
   differences include but are not limited to, bootup procedure, network
   interface usage and disk management. Most differences are well
   documented, but involve searching manpages. This document tries to be
   an index of those differences.

     * OpenBSD has a ports tree. This is to accomodate the fact that at
       this point not many applications are native to the OpenBSD
       environment. This is both an attempt to get applications to work
       on OpenBSD for end-users and to get more applications made with
       OpenBSD in mind. Eventually this ports tree will be used to make a
       nice set of binary packages.
     * OpenBSD uses CVS for source changes. Unlike Linux which is done
       primarily thru separate distributions, OpenBSD uses CVS which
       allows anyone to extract the full source tree at ANY given time.
       OpenBSD also does periodically release snapshots for various
       architectures and makes a CD release every 6 months.
     * OpenBSD contains STRONG CRYPTO, which USA based OS's can't
       contain. (See [4]http://www.openbsd.org/crypto.html) OpenBSD has
       also gone thru heavy security auditing and many security features
       have already been implemented into the source tree. (IPSEC,
       KERBEROS).
     * OpenBSD's kernel is /bsd.
     * The names of hard disks are usually /dev/wd and /dev/sd (ATA/SCSI)
     * /sbin/ifconfig with no arguments in Linux gives the state of all
       the interfaces. Under OpenBSD you need the -a flag.
     * /sbin/route with no arguments in Linux gives the state of all the
       active routes. Under OpenBSD you need the "show" parameter, or do
       a netstat -r (nice).
     * IP-Masquerading is done through ipnat. ([5]ipnat(1))
     * ipfwadm is done through ipf ([6]ipf(1), [7]ipf(5))
     * Interface address is stored in /etc/hostname.<interfacename>. It
       can be a name instead of an IP address.
     * The machine name is in /etc/myname
     * The default gateway is in /etc/mygate
     * The network interface aliases are in /etc/ifaliases
     * OpenBSD's default shell is csh. Shells such as bash and tcsh can
       be added as packages or installed from the ports tree.
     * Password management changes a lot. The main files are different.
       ([8]passwd(1), [9]passwd(5))

9.2 - Dual booting Linux and OpenBSD

   Yes! it is possible!

   Read [10]INSTALL.linux

   [11][Back to Main Index] [12][To Section 8.0 - General Questions]
   [13][To Section 10.0 - System Administration]
     _________________________________________________________________

   [14][back] [15]www@@openbsd.org
   $OpenBSD: obsd-faq.txt,v 1.6 1999/06/25 18:53:51 ericj Exp $

References

   1. http://www.openbsd.org/faq/index.html
   2. http://www.openbsd.org/faq/faq8.html
   3. http://www.openbsd.org/faq/faq10.html
   4. http://www.openbsd.org/crypto.html
   5. http://www.openbsd.org/cgi-bin/man.cgi?query=ipnat&apropos=0&sektion=1&format=html
   6. http://www.openbsd.org/cgi-bin/man.cgi?query=ipf&apropos=0&sektion=1&format=html
   7. http://www.openbsd.org/cgi-bin/man.cgi?query=ipnat&apropos=0&sektion=5&format=html
   8. http://www.openbsd.org/cgi-bin/man.cgi?query=passwd&apropos=0&sektion=1&format=html
   9. http://www.openbsd.org/cgi-bin/man.cgi?query=passwd&apropos=0&sektion=5&format=html
  10. http://www.openbsd.org/faq/INSTALL.linux
  11. http://www.openbsd.org/faq/index.html
  12. http://www.openbsd.org/faq/faq8.html
  13. http://www.openbsd.org/faq/faq10.html
  14. http://www.openbsd.org/faq/index.html
  15. mailto:www@@openbsd.org


   [1][Back to Main Index] [2][To Section 9.0 - Migrating from Linux]
   [3][To Section 11.0 - OpenBSD 2.4 Specific Information]

                         10.0 - System Administration
     _________________________________________________________________

10.1 - Why does it say that I'm in the wrong group when I su to root?

   To be able to use [4]su(1) to root you must be in group 0, "wheel".
   This MUST be placed specifically in /etc/group. It isn't enough to
   have them listed in /etc/passwd. Once this is done you should be able
   to su correctly.

10.2 - How do I duplicate a filesystem?

   Use dump/restore. For example. To duplicate everything under directory
   SRC to directory DST, do a:
# cd /SRC; dump 0f - . | (cd /DST; restore -rf - )

10.3 - How do I get httpd, sendmail, etc to startup with the system?

   OpenBSD uses rc-style startup to control starting applications with
   the system. For common daemons you can simply edit [5]/etc/rc.conf.
   For example: To have ftpd started on boot change -
ftpd_flags=NO -- > ftpd_flags="-D"

   You can add any flags that you wish ftpd to start with.

   If you have your own daemon's that you want to be started, here is a
   simple entry that you can put into /etc/rc.local.
if [ -x /usr/local/sbin/mydaemon ]; then
        echo -n ' mydaemon';       /usr/local/sbin/mydaemon
fi

   Once in there, it will come up with the system each time.

10.4 - Why do users get relaying access denied when they are remotely sending
mail through my OpenBSD system?

   Try this:
cat /etc/sendmail.cf | grep relay-domains

   The output may look something like this:
FR-o /etc/mail/relay-domains

   If this file doesn't exist, create it. You will need to enter the
   users who are sending mail remotely with the following syntax:
.domain.com    #if it is dynamic
sub.domain.com #if static

   Don't forget to:
kill -1 `cat /var/run/sendmail.pid`

10.5 - I've set up POP, but users have trouble accessing mail thru POP. What
can i do?

   Most issues dealing with pop are accessing files, mainly temp files.
   Some clients give errors such as:
-ERR Couldn't open temporary file, do you own it?K

   Try setting up your permissions as such:
permission in  /var
drwxrwxr-x   2 bin     mail     512 May 26 20:08 mail


permissions in  /var/mail
-rw-------   1 username   username        0 May 26 20:08 username

   Double check that the user owns his file in /var/mail , this should be
   done by default.

10.6 - Setting up a Secure HTTP server with SSL(8)

   This will take you through all the steps it takes to set up your own
   Secure HTTP server. Since the OpenBSD 2.5 release, OpenBSD has shipped
   with ssleay. Because of copyrighted RSA algorigthms, these cannot be
   shipped with OpenBSD. libssl includes support for SSL version 2, SSL
   version 3, and TLS version 1. So for now, because of copyright
   restictions, OpenBSD must ship without a fully-functional libssl. But
   it is still completely useable. If you are able to use the RSA
   patented library's you can easily upgrade your libssl with a command
   like this.

   #pkg_add
   ftp://ftp.openbsd.org/pub/OpenBSD/${ver}/packages/${arch}/libssl-1.1.t
   gz
   Where ${ver} is the OpenBSD version number, and ${arch} is your
   architecture.

   The steps shown here are taken pretty much from the [6]ssl(8) man
   page. So you can refer to that for further information. Also, this faq
   will only go over creating a RSA certificate for web servers, not a
   DSA server certificate. To find out how to do so, please refer to the
   ssl(8) man page.

   I will no show how to create your key and certificate. These will go
   to /etc/ssl/private/. This means that you will have to have upgraded
   your libssl. Now we can create our key. You can do so with a line like
   such:

   # ssleay genrsa -out /etc/ssl/private/server.key 1024

   This will create a key of 1024 bits. Next you need to create a
   Certificate Signing Request which is used to get a CA or Certificate
   Authority to sign your key. Here is the command to do so.

   # ssleay req -new -key /etc/ssl/private/server.key -out
   /etc/ssl/private/server.csr

   You would now give /etc/ssl/private/server.csr to the CA to get it
   signed. Or you could also sign the certificate for yourself. Here is
   how you would do this.

   # ssleay x509 -req -days 365 -in /etc/ssl/private/server.csr -signkey
   /etc/ssl/private/server.key -out /etc/ssl/server.crt

   This will sign your key, and it will be valid for up to 365 days. With
   this done you can now start the httpd server. To start httpd(8) with
   ssl you must start the daemon with the -DSSL flag. You can start this
   on boot in /etc/rc.conf by changing the httpd line to look like so:

httpd_flags="-DSSL"

   This server will run on port 443.

10.7 - I edited /etc/passwd with vi(1), but the changes didn't seem to take
place. Why?

   Changes will not be made right away because OpenBSD has a user
   database which needs updated when changes are made in /etc/passwd.
   Tools are made to do this immediatly for you though. You should use
   vipw(8) to edit the passwd file by hand. This will allow for checking
   of the passwd file before entering it into the database and after the
   check is done it will automatically execute pwd_mkdb(8). If you have
   made changes, without using a tool such as vipw, you can run
   pwd_mkdb(8) by hand.

10.8 - What is the best way to add users? and delete them?

   The best way to add a user in OpenBSD is to use the [7]adduser(8)
   script. You can configure this to work however you like by editing
   /etc/adduser.conf. You can add users by hand, but this is the
   recommended way to addusers. adduser(8) allows for consistancy checks
   on /etc/passwd, /etc/group, and shell databases. It will create then
   entries for you, and HOME directory, and even send a message to the
   user welcoming them. This can be changed to meet your needs. For
   further instructions on adding users read the [8]adduser_proc(8) man
   page.

   To delete users you should use the [9]rmuser(8) utility. This will
   remove all existance of a user. It will remove any crontab(1) entries,
   their HOME dir (if it is owned by the user). Along with their
   /etc/passwd and /etc/group entries.

10.9 - How do i create an ftp-only account?

   There are a few ways to do this, but a very common way to do such is
   to add /usr/bin/false into /etc/shells. Then when you create the user
   set his shell to /usr/bin/false, this they he will not be able to get
   a shell but will be able to keep their ftp capabilities. adduser(8)
   will give them a home dir by default of /home/foo. If this is what you
   desire it doesn't need to be changed, however you can set this to
   whatever directory you wish.

10.10 - Setting up Quota's

   Quota's are used to limit users space that they have available to them
   on your drives. It can be very helpfull in situations of limited
   resources. quota's can be set in two different ways.

     * 1 - User Quota's
     * 2 - Group Quota's

   The first step to setting up quota's is to make sure that option QUOTA
   is in your Kernel Configuration. This option is in the GENERIC kernel.
   After this you need to mark in /etc/fstab the filesystems which will
   have quota's enabled. The keywords userquota and groupquota should be
   used to mark each fs that you will be using quota's on. By default the
   files quota.user and quota.group will be created at the root of that
   filesystem to hold the quota information. This default can be
   overwritten by doing, userquota=/var/quotas/quota.user. Or whatever
   file you want to use for holding quota information. Here is an example
   /etc/fstab that has one filesystem with userquota's enabled.

/dev/wd0a / ffs rw,userquota=/var/quotas/quota.user 1 1

   Now it's time to set the users quota's. To do so you use the utility
   [10]edquota(8) . A simple use is just edquota < user >. edquota(8)
   will use vi(1) to edit the quota's unless the environmental variable
   EDITOR is set to a different editor. For example:

   #edquota ericj

   This will give you output similar to this:

Quotas for user ericj:
/: blocks in use: 62, limits (soft = 0, hard = 0)
        inodes in use: 25, limits (soft = 0, hard = 0)

   To add limits, edit it to something similar to this:

Quotas for user ericj:
/: blocks in use: 62, limits (soft = 1000, hard = 1050)
        inodes in use: 25, limits (soft = 0, hard = 0)

   In this the softlimit is set to 1000 blocks and the hardlimit is set
   to 1050 blocks. A softlimit is a limit where the user is just warned
   when they cross it and have until their grace period is up to get
   their disk usage below their limit. Grace period's can be set by using
   the -t option on edquota(8). After the grace period is over the
   softlimit is handled as a hardlimit. This usually results in an
   allocation failure.

   Now that the quota's are set you, you need to turn the quota's on. To
   do this use [11]quota(1). Using a command of quota < user > will give
   that users info. quota with no arguments will give your quota
   statistics. For example:

# quota ericj

   Will result in output similar to this:

Disk quotas for user ericj (uid 1001):
     Filesystem  blocks   quota   limit   grace   files   quota   limit   grace
              /      62    1000    1050              27       0       0

   By default quota's set in /etc/fstab will be started on boot. To turn
   them of use quotaoff -a

   [12][Back to Main Index] [13][To Section 9.0 - Migrating from Linux]
   [14][To Section 11.0 - OpenBSD 2.4 Specific Information]
     _________________________________________________________________

   [15][back] [16]www@@openbsd.org
   $OpenBSD: obsd-faq.txt,v 1.6 1999/06/25 18:53:51 ericj Exp $

References

   1. http://www.openbsd.org/faq/index.html
   2. http://www.openbsd.org/faq/faq9.html
   3. http://www.openbsd.org/faq/faq24.html
   4. http://www.openbsd.org/cgi-bin/man.cgi?query=su&apropos=0&sektion=1&format=html
   5. http://www.openbsd.org/cgi-bin/cvsweb/src/etc/rc.conf?rev=1.35
   6. http://www.openbsd.org/cgi-bin/man.cgi?query=ssl&apropos=0&sektion=8&format=html
   7. http://www.openbsd.org/cgi-bin/man.cgi?query=adduser&sektion=8&format=html
   8. http://www.openbsd.org/cgi-bin/man.cgi?query=adduser_proc&sektion=8&format=html
   9. http://www.openbsd.org/cgi-bin/man.cgi?query=rmuser&sektion=8&format=html
  10. http://www.openbsd.org/cgi-bin/man.cgi?query=edquota&sektion=8&format=html
  11. http://www.openbsd.org/cgi-bin/man.cgi?query=quotaon&sektion=8&format=html>quotaon(8)</a>.Forexample:</p><p><pre># quotaon -a </pre> </p> <p> This will go thru /etc/fstab to turn on the filesystems with quota options. Now that quota's are up and running, you can view them by the <a href=
  12. http://www.openbsd.org/faq/index.html
  13. http://www.openbsd.org/faq/faq9.html
  14. http://www.openbsd.org/faq/faq24.html
  15. http://www.openbsd.org/faq/index.html
  16. mailto:www@@openbsd.org


   [1][Back to Main Index] [2][To Section 10.0 - System Administration]
   [3][To Section 12.0 - Performance Tuning]

                    11.0 - OpenBSD 2.4 Specific Information
     _________________________________________________________________

11.1 - In 2.4 why do I get UserDir error when running httpd?

   It seems as though userdir support was left out of 2.4. Make sure to
   pick up the patch at:

   [4]http://www.openbsd.org/errata.html

11.2 - Installing at a partition 4GB or higher

   The 2.4 cd's shipped with a problem in installboot. A patch can be
   obtained here [5]http://www.openbsd.org/errata.html. This is fixed in
   -current.

   To place the partition boot record, installboot used a 32 bit
   multiplication for the sectors times the sectorsize which is larger
   than 2^32 -1 (i.e. multiplication overflow) when the partition starts
   at 4 GB or higher. This means the pbr is installed in the reall
   partition address modulo 4GB. It's still possible to install at >= 4GB
   with some effort:

   You have 2 Options for doing so with OpenBSD 2.4. If you have Linux or
   any other unix like OS, you should back up the sectors first before
   trying anything.

     * Suppose the partition starts at cylinder 611, and the drive has
       255 heads, 63 sectors: offset for the obsd partition is
       611*255*63= 9815715 sectors. multiply this by 512 and you get:
       5025646080. 5025646080 mod 2^32 = 730678784
       (You can just subtract 2^32 on a hand calculator...) dividing by
       512 gives sector 1427107.
       Ok, suppose were now in linux (where cylinder numbers are 1 higher
       btw..) and that the obsd partition is DOS partition 4:
       dd if=/dev/hda of=backup.txt skip=1427107 bs=512 count=1
       will backup the data that installboot will nuke ..
       Now install OpenBSD. Return to Linux.
       Now we're going to copy the partition boot record to the right
       place.
       dd if=/dev/hda of=pbr.txt skip=1427107 bs=512 count=1
       dd if=/pbr.txt of=/dev/hda4 bs=512 count=1
       (adding obsd to lilo should now work)
       Now write back the nuked sector:
       dd if=/backup.txt of=/dev/hda seek=1427107 bs=512 count=1
       Caveat: make sure that whatever gets nuked by installboot isn't
       essential to running dd (and starting the other OS). Backing up
       the affected partition is recommended.
     * Use a correct version of installboot (compiled for you by another
       OBSD'er ..):
       put it on another partition, e.g. a DOS partition. Suppose wd0j is
       the DOS partition (see disklabel wd0, this is in case of IDE
       disks), and installboot is named installb there.
       After booting from floppy/CD, press ^C to get into the shell:
          + mkdir dos
          + mount /dev/wd0j dos
          + cp dos/tmp/installb /usr/mdec/installboot

   Now enter 'install' and the installation procedure should use the new
   installboot.

   [6][Back to Main Index] [7][To Section 10.0 - System Administration]
   [8][To Section 12.0 - Performance Tuning]
     _________________________________________________________________

   [9][back] [10]www@@openbsd.org
   $OpenBSD: obsd-faq.txt,v 1.6 1999/06/25 18:53:51 ericj Exp $

References

   1. http://www.openbsd.org/faq/index.html
   2. http://www.openbsd.org/faq/faq10.html
   3. http://www.openbsd.org/faq/faq12.html
   4. http://www.openbsd.org/errata.html#userdir
   5. http://www.openbsd.org/errata.html#installboot
   6. http://www.openbsd.org/faq/index.html
   7. http://www.openbsd.org/faq/faq24.html
   8. http://www.openbsd.org/faq/faq12.html
   9. http://www.openbsd.org/faq/index.html
  10. mailto:www@@openbsd.org

$OpenBSD: obsd-faq.txt,v 1.6 1999/06/25 18:53:51 ericj Exp $

Warning: this document is currently being reviewed. It's not yet complete,
and probably contains loads of errors. As an example, I can't figure out
why Linux doesn't need mkswap as it shares the exact same blocks with
OpenBSD.


   Linux + OpenBSD: it's possible

   by Marc Espie --  Marc.Espie@@OpenBSD.org

It is perfectly possible to have Linux and OpenBSD on the same disk.
As of this writing, OpenBSD can read and write Linux' partitions, whereas
Linux cannot access OpenBSD partitions (they differ from NetBSD partitions).

You can even install OpenBSD from an ext2fs partition (choose install from
disk... ext2fs does not appear in the choices, but `default' it is).

First, make a bootable floppy of Linux.  Then, you  have to find some room
for OpenBSD.  Don't worry about swap space: you can share Linux' swap
partition.

If you want to grab space from a Windows/DOS partition, use fips.
Fips20 knows all about FAT32, so windows 95 is no longer a problem.

Other sources of information, especially concerning other BSD systems,
must be taken with a healthy does of scepticism.

First principles
----------------
OpenBSD does not use the DOS partitions for more than booting.  You just
need a small DOS partition to put your OpenBSD root.  Afterwards, OpenBSD
heeds some other information entirely, called the BSD disklabel.  This
disklabel is another completely distinct description of your hard disk.
It does not even have to be consistent with the usual DOS partitions
information.

Throughout this document, we will distinguish between DOS partitions and
BSD partitions whenever this is necessary.

For consistency, it's better if all parts of the disks that
are actually used by OpenBSD are flagged as occupied, type A6, though it
is not necessary.  The only part of the disk that should appear both as a BSD
partition and as a DOS partition is the root partition: it MUST begin on
the same sector for the boot process to work.

One way to visualize things is to picture OpenBSD embedded inside DOS
partitions: the DOS partitions used by OpenBSD may each contain several
OpenBSD partitions. As long as the DOS partition table has the right
start and length for each partition it will be kept happy.

The OpenBSD disklabel is just another mechanism that yield another
description of the disk. It is vitally important that the BSD root
partition start precisely where the corresponding DOS partition is supposed
to start, and it is better when all BSD partitions stay inside their
DOS partitions boundaries.  Apart from OpenBSD partitions proper, the
BSD disklabel can contain a BSD description of other DOS partitions, but
this is not mandatory. If you don't have any constraints, having a correct
description of all partitions is better, but with bigger disks, keep in mind
that OpenBSD disklabels can't hold more than 16 partitions.

Contrarily to popular belief, OpenBSD does *NOT* need one contiguous chunk
of the disk (a `slice' in FreeBSD lingo).  It is probably the simplest setup,
but other considerations (such as the need to boot several OS, and to have
several small primary partitions that all within the first  1024 BIOS
cylinders) may lead you to use two chunks for OpenBSD.

If you can, it is MUCH better to devote a full disk to OpenBSD: this limits
the number of mistakes you can do. Admittedly there are some cases where
this isn't a option (my machine is a laptop... I have to cope with the
hard disk I have).

Mapping your disk
-----------------
Starting from Linux, get a grasp of your partitions. Use df to check which
is what, then fdisk to get the actual setup of the disk.
Here is my disk:
--
Disk /dev/hda: 128 heads, 63 sectors, 993 cylinders
Units = cylinders of 8064 * 512 bytes

   Device Boot   Begin    Start      End   Blocks   Id  System
/dev/hda1            1        1      260  1048288+   6  DOS 16-bit >=32M
/dev/hda2          261      261      273    52416   83  Linux native
/dev/hda4          287      287      601  1270080    5  Extended
/dev/hda5          287      287      303    68512   82  Linux swap
/dev/hda6          304      304      456   616864+  83  Linux native
/dev/hda7          457      457      520   258016+  83  Linux native
/dev/hda8          521      521      537    68512+  83  Linux native
/dev/hda9          538      538      601   258016+  83  Linux native

(In case you're wondering, yes this is a big disk. The Linux playground is
large, the OpenBSD area will be huge. As a developer, I usually have loads
of source & binaries lying around... a simple OpenBSD installation can fit
within 300 Mb with room to spare.)
In my setup hda2 is /, hda6 is /usr, hda7 is /usr/local, hda8 is /var, and
hda9 is /home.

Get the display to sectors with u, and jot down the corresponding
information as well:
--
Disk /dev/hda: 128 heads, 63 sectors, 993 cylinders
Units = sectors of 1 * 512 bytes

   Device Boot   Begin    Start      End   Blocks   Id  System
/dev/hda1           63       63  2096639  1048288+   6  DOS 16-bit >=32M
/dev/hda2      2096640  2096640  2201471    52416   83  Linux native
/dev/hda4      2306304  2306304  4846463  1270080    5  Extended
/dev/hda5      2306368  2306368  2443391    68512   82  Linux swap
/dev/hda6      2443455  2443455  3677183   616864+  83  Linux native
/dev/hda7      3677247  3677247  4193279   258016+  83  Linux native
/dev/hda8      4193343  4193343  4330367    68512+  83  Linux native
/dev/hda9      4330431  4330431  4846463   258016+  83  Linux native

Okay, finally switch to expert mode, and note the corresponding data.
Disk /dev/hda: 128 heads, 63 sectors, 993 cylinders

Nr AF  Hd Sec  Cyl  Hd Sec  Cyl   Start    Size ID
 1 00   1   1    0 127  63  259      63 2096577 06
 2 00   0   1  260 127  63  272 2096640  104832 83
 3 00   0   0    0   0   0    0       0       0 00
 4 00   0   1  286 127  63  600 2306304 2540160 05
 5 00   1   2  286 127  63  302      64  137024 82
 6 00   1   1  303 127  63  455      63 1233729 83
 7 00   1   1  456 127  63  519      63  516033 83
 8 00   1   1  520 127  63  536      63  137025 83
 9 00   1   1  537 127  63  600      63  516033 83

Note that this is STILL the same data. The good point about this last
display is that it is almost what you're going to see in OpenBSD fdisk !

There are some differences though, mostly because Linux fdisk has made
some rather confusing choices:
- in simple mode it starts numbering cylinders at 1... whereas
everything else starts from 0.
- in simple mode it shows blocks of 1024 bytes, which makes for half-blocks
(marked with a +) and sizes halved from the real block size.
- in expert mode it shows extended partitions offset from the start
of the extended partition.
- the hd/sec/cyl is a confusing order, as the sector number is computed
from cyl/hd/sec, in that order.
- it never shows and doesn't care about the real disk geometry.

You will notice that the 3rd primary partition is empty... this is where
I intend to stick my OpenBSD root partition (both DOS and BSD partitions),
and that I have left cylinders 601--992 empty... this is where I intend to
stick the rest of OpenBSD.
After OpenBSD is installed, partition 3 will show up as:
/dev/hda3          274      274      286    52416   a6  Unknown
/dev/hda3      2201472  2201472  2306303    52416   a6  Unknown

(recent Linux fdisk will display a6 as OpenBSD, but they still don't know
how to deal with the disklabel. Important: NEVER use Linux fdisk to fiddle
with OpenBSD disklabels.)


Before starting to install OpenBSD, now would be a good time to check the
INSTALL.pt document...  Especially note the alignment restriction of
partitions (first sector of a partition must be at head 0, sector 1 of a
cylinder). This is enforced by Linux' fdisk.

The other point to note is that extended partitions are actually linked
lists. This will show up in OpenBSD' fdisk.

Your clock and OpenBSD
----------------------
OpenBSD expects your hardware clock to be in universal time, and uses
time zones to give you local time. With Linux, this depends...
most distributions use a small program called hwclock to set up the
system time from the hardware clock when booting... there is a --utc
option if your hardware clock is in universal time, but this is not
always what happens by default.

For instance, on a redhat 5.1 system, this happens in /etc/rc.d/rc.sysinit
which loads an /etc/sysconfig/clock that defines a variable called UTC, and
then proceeds calling hwclock.
- ensure UTC is set to true,
- adjust your hardware clock from the system time if necessary, e.g.,
hwclock --systohc --utc.

The Linux partition table and OpenBSD
-------------------------------------
There is a problem with many Linux rc that do mount all file systems even
in single-user mode.  After you've installed OpenBSD, if your Linux kernel
knows about BSD disklabels, it may insert lots of BSD partitions in its
list. Then, at the next reboot, you're in trouble. The simplest way around
this problem is probably to make sure you can boot from a Linux kernel
that doesn't know about disklabels.   Otherwise, you may wish to check
your inittab and your rc to make deadly sure that single-user boot
will work.

The OpenBSD installation
------------------------
If you've got the space, you can install from your ext2fs partitions. This
is what I did, as I have a slip connection to the rest of the world, and
the OpenBSD install floppy does not include slip.

REMEMBER TO BACKUP ALL IMPORTANT DATA ON YOUR DISK BEFORE DOING THE
INSTALLATION !!!

So you cp floppy*.fs /dev/fd0, then reboot...

First, the BSD kernel + ram disk loads, then there is a boot prompt, and
five seconds later, the boot proper starts.

After a while, you will see your disk configuration scroll by.  I got:
  wd0 at wdc0 drive 0: <TOSHIBA MK4006MAV>
  wd0: 3909MB, 7944 cyl, 16 head, 63 sec, 512 bytes/sec, 8007552 sec total
  wd0: using 16-sector 16-bit pio transfers, lba addressing

at which point I got somewhat confused, especially as this is a configuration w
ith
more than 1024 cylinders.  In fact, this is the actual disk geometry, when
you inquire about it, but the geometry that the BIOS does see IS the fdisk
geometry, with 993 cylinders.  As the 1024 cylinders is purely a BIOS
limitation, there is no actual trouble.

If you want to be sure, enquire at the boot prompt:
boot>machine diskconfig
before the automatic boot sequence continues.


Then I got into fdisk, and I proceeded to enter my new OpenBSD partition.
This is what the fdisk dump looked after my changes:

Disk: wd0       geometry: 992/128/63 [7999488 sectors]
Offset: 0       Signatures: 0xAA55,0x0
         Starting        Ending
 #: id  cyl  hd sec -  cyl  hd sec [     start -       size]
-------------------------------------------------------------------------
 0: 06    0   1   1 -  259 127  63 [        63 -    2096577] DOS > 32MB
 1: 83  260   0   1 -  272 127  63 [   2096640 -     104832] Linux files*
 2: A6  273   0   1 -  285 127  63 [   2201472 -     104832] OpenBSD
 3: 05  286   0   1 -  600 127  63 [   2306304 -    2540160] Extended DOS

Selected extended partition 3
New MBR at offset 2306304.
Offset: 2306304 Signatures: 0xAA55,0x0
         Starting        Ending
 #: id  cyl  hd sec -  cyl  hd sec [     start -       size]
-------------------------------------------------------------------------
 0: 82  286   1   2 -  302 127  63 [   2306368 -     137024] Linux swap
 1: 05  303   0   1 -  455 127  63 [   2443392 -    1233792] Extended DOS
 2: 00    0   0   0 -    0   0   0 [   2306304 -          0] unused
 3: 00    0   0   0 -    0   0   0 [   2306304 -          0] unused

Selected extended partition 1
New MBR at offset 2443392.
Offset: 2443392 Signatures: 0xAA55,0x0
         Starting        Ending
 #: id  cyl  hd sec -  cyl  hd sec [     start -       size]
-------------------------------------------------------------------------
 0: 83  303   1   1 -  455 127  63 [   2443455 -    1233729] Linux files*
 1: 05  456   0   1 -  519 127  63 [   3677184 -     516096] Extended DOS
 2: 00    0   0   0 -    0   0   0 [   2443392 -          0] unused
 3: 00    0   0   0 -    0   0   0 [   2443392 -          0] unused

Selected extended partition 1
New MBR at offset 3677184.
Offset: 3677184 Signatures: 0xAA55,0x0
         Starting        Ending
 #: id  cyl  hd sec -  cyl  hd sec [     start -       size]
-------------------------------------------------------------------------
 0: 83  456   1   1 -  519 127  63 [   3677247 -     516033] Linux files*
 1: 05  520   0   1 -  536 127  63 [   4193280 -     137088] Extended DOS
 2: 00    0   0   0 -    0   0   0 [   3677184 -          0] unused
 3: 00    0   0   0 -    0   0   0 [   3677184 -          0] unused

Selected extended partition 1
New MBR at offset 4193280.
Offset: 4193280 Signatures: 0xAA55,0x0
         Starting        Ending
 #: id  cyl  hd sec -  cyl  hd sec [     start -       size]
-------------------------------------------------------------------------
 0: 83  520   1   1 -  536 127  63 [   4193343 -     137025] Linux files*
 1: 05  537   0   1 -  600 127  63 [   4330368 -     516096] Extended DOS
 2: 00    0   0   0 -    0   0   0 [   4193280 -          0] unused
 3: 00    0   0   0 -    0   0   0 [   4193280 -          0] unused

Selected extended partition 1
New MBR at offset 4330368.
Offset: 4330368 Signatures: 0xAA55,0x0
         Starting        Ending
 #: id  cyl  hd sec -  cyl  hd sec [     start -       size]
-------------------------------------------------------------------------
 0: 83  537   1   1 -  600 127  63 [   4330431 -     516033] Linux files*
 1: 00    0   0   0 -    0   0   0 [         0 -          0] unused
 2: 00    0   0   0 -    0   0   0 [   4330368 -          0] unused
 3: 00    0   0   0 -    0   0   0 [   4330368 -          0] unused

Nothing to it... you just follow the extended partition links using select,
jot down whatever you need, add the OpenBSD partition to look like you want
it to, and save everything.

After you leave fdisk, you get to the interesting part: the disklabel
itself. If all goes well, OpenBSD synthesizes a nice disklabel out of what
it can deduce from the disk, including the ext2fs partitions.

There are only a few subtleties to take care of:
- initially, you can ONLY edit the disklabel part that matches the OpenBSD
DOS partition (a `slice' in FreeBSD lingo). You have to use b 0 *  before
you can edit the whole disk.
- the real disk geometry becomes relevant. The Berkeley fast file system
can't use partial cylinder groups, hence BSD partitions should start
on cylinder boundaries, as any remaining sectors  will be lost anyway.
- units for size and offset can be given as sectors (default) or cylinders.

After edition, this is what my disklabel looks like:

# using MBR partition 2: type A6 off 2201472 (0x219780) size 104832 (0x19980)
# /dev/rwd0c:
type: ESDI
disk:
label: TOSHIBA MK4006M
flags:
bytes/sector: 512
sectors/track: 63
tracks/cylinder: 16
sectors/cylinder: 1008
cylinders: 7944
total sectors: 8007552
rpm: 3600
interleave: 1
trackskew: 0
cylinderskew: 0
headswitch: 0           # milliseconds
track-to-track seek: 0  # milliseconds
drivedata: 0

16 partitions:
#        size   offset    fstype   [fsize bsize   cpg]
  a:   104832  2201472    4.2BSD     1024  8192    16   # (Cyl. 2184 - 2287)
  b:   137024  2306368      swap                        # (Cyl. 2288 - 2423*)
  c:  8007552        0    unused        0     0         # (Cyl.    0 - 7943)
  d:   409248  4846464    4.2BSD     1024  8192    16   # (Cyl. 4808 - 5213)
  e:   511056  5255712    4.2BSD     1024  8192    16   # (Cyl. 5214 - 5720)
  f:   204624  5766768    4.2BSD     1024  8192    16   # (Cyl. 5721 - 5923)
  g:  1073520  5971392    4.2BSD     1024  8192    16   # (Cyl. 5924 - 6988)
  h:   962640  7044912    4.2BSD     1024  8192    16   # (Cyl. 6989 - 7943)
  i:  2096577       63     MSDOS                        # (Cyl.    0*- 2079*)
  j:   104832  2096640    ext2fs                        # (Cyl. 2080 - 2183)
  l:  1233729  2443455    ext2fs                        # (Cyl. 2424*- 3647*)
  m:   516033  3677247    ext2fs                        # (Cyl. 3648*- 4159*)
  n:   137025  4193343    ext2fs                        # (Cyl. 4160*- 4295*)
  o:   516033  4330431    ext2fs                        # (Cyl. 4296*- 4807*)

Things to check:
- this disklabel is saved in MBR2 (basic DOS partition 2), as expected.
- all the BSD partitions proper are aligned on a cylinder boundary.
the root partition begins at the precise same offset the corresponding DOS
partition begins, and it extends for the same length.
Other BSD partitions don't show up in the DOS partition setup, hence they
begin precisely on cylinder 601/4808.
- the ext2fs partitions have the exact same layout under the OpenBSD
disklabel.

One point that is somewhat laborious is that the disklabel -E mode
(which you are currently using) tends to move partitions around to ensure
that ALL defined partitions are contiguous. Hence, you may need some fiddling
around and printing to ensure that Linux partitions do show up where they
should.  In my case, disklabel moved the swap and all the ext2fs partitions
slightly, and I add to adjust them manually...

Once the disklabel is written to disk, the installation proceeds as usual.

ext2fs partitions are perfectly usable from OpenBSD. My /home partition
is ext2fs, I have been using it for a week now without any trouble.

Booting
-------
First time I booted my system back, I did not get into OpenBSD as expected...
I plain forgot I had installed lilo in the master boot block, and lilo
does not heed the active partition flag. The fix was rather simple: from
the Linux system, I just had to edit lilo.conf to add the obsd entry:

boot=/dev/hda
map=/boot/map
install=/boot/boot.b
prompt
timeout=50
image=/boot/myvmlinuz
   label=linux
   root=/dev/hda2
   vga=4
   read-only
image=/boot/vmlinuz-2.0.34-1
   label=redhat
   root=/dev/hda2
   read-only
other=/dev/hda1
   label=dos
   table=/dev/hda
other=/dev/hda3
   label=obsd
   table=/dev/hda

rerun lilo, and voila, OpenBSD was able to boot !

Linux and OpenBSD partitions
----------------------------
As of 2.0.35/2.1.122, Linux does not support OpenBSD partitions. The way
the Linux kernel works is reasonably straightforward (code in
drivers/block/genhd.c): when detecting a BSD partition (type A5),
it checks and parses the first block for a disklabel, and use that
information to instantiate some new partitions,
that will show up in that drive's partition list, exactly like extended
partitions do show up. Unfortunately, that check is hard coded for a type A5
(NetBSD/FreeBSD) partition, and it recognizes 8 partitions disklabels only
anyway.

Just hacking the Linux code to recognize A6 is not quite enough.  You also
need to trim down the resulting list of partitions, as your ext2fs
partitions will now show up twice !
I'm experimenting with the following patch, which should make it to linux-kerne
l
soon:
--------------------------------------------------------------
diff -ur linux.orig/drivers/block/genhd.c linux/drivers/block/genhd.c
--- linux.orig/drivers/block/genhd.c
Mon Aug  4 20:45:35 1997
+++ linux/drivers/block/genhd.c
Thu Sep 24 18:55:31 1998
@@@@ -205,11 +206,46 @@@@
 }

 #ifdef CONFIG_BSD_DISKLABEL
+static void check_and_add_bsd_partition(struct gendisk *hd, struct bsd_partiti
on *bsd_p)
+{
+
struct hd_struct *lin_p;
+

/* check relative position of partitions.  */
+
for (lin_p = hd->part + 1; lin_p - hd->part < current_minor; lin_p++) {
+


/* no relationship -> try again */
+

if (lin_p->start_sect + lin_p->nr_sects <= bsd_p->p_offset
+


|| lin_p->start_sect >= bsd_p->p_offset + bsd_p->p_size)
+


continue;

+


/* equal -> no need to add */
+

if (lin_p->start_sect == bsd_p->p_offset &&
+


lin_p->nr_sects == bsd_p->p_size)
+


return;
+


/* bsd living within dos partition */
+

if (lin_p->start_sect <= bsd_p->p_offset && lin_p->start_sect
+


+ lin_p->nr_sects >= bsd_p->p_offset + bsd_p->p_size) {
+#ifdef DEBUG_BSD_DISKLABEL
+


printk("w: %d %ld+%ld,%d+%d",
+



lin_p - hd->part, lin_p->start_sect, lin_p->nr_sects,
+



bsd_p->p_offset, bsd_p->p_size);
+#endif
+


break;
+

}
+


/* ouch: bsd and linux overlap. Don't even try for that partition */
+#ifdef DEBUG_BSD_DISKLABEL
+

printk("???: %d %ld+%ld,%d+%d",
+


lin_p - hd->part, lin_p->start_sect, lin_p->nr_sects,
+


bsd_p->p_offset, bsd_p->p_size);
+#endif
+

printk("???");
+

return;
+
} /* if the bsd partition is not described by DOS, we end up there */
+
add_partition(hd, current_minor, bsd_p->p_offset, bsd_p->p_size);
+
current_minor++;
+}
 /*
  * Create devices for BSD partitions listed in a disklabel, under a
  * dos-like partition. See extended_partition() for more information.
  */
-static void bsd_disklabel_partition(struct gendisk *hd, kdev_t dev)
+static void bsd_disklabel_partition(struct gendisk *hd, kdev_t dev, int max_pa
rtitions)
 {

struct buffer_head *bh;

struct bsd_disklabel *l;
@@@@ -225,19 +261,15 @@@@


return;

}

-
p = &l->d_partitions[0];
-
while (p - &l->d_partitions[0] <= BSD_MAXPARTITIONS) {
+
if (l->d_npartitions < max_partitions)
+

max_partitions = l->d_npartitions;
+
for (p = l->d_partitions; p - l->d_partitions <  max_partitions; p++) {


if ((current_minor & mask) >= (4 + hd->max_p))



break;
-
-

if (p->p_fstype != BSD_FS_UNUSED) {
-


add_partition(hd, current_minor, p->p_offset, p->p_size);
-


current_minor++;
-

}
-

p++;
+

if (p->p_fstype != BSD_FS_UNUSED)
+


check_and_add_bsd_partition(hd, p);

}

brelse(bh);
-
 }
 #endif

@@@@ -248,6 +280,11 @@@@

struct partition *p;

unsigned char *data;

int mask = (1 << hd->minor_shift) - 1;
+#ifdef CONFIG_BSD_DISKLABEL
+
/* no bsd disklabel as a default */
+
kdev_t bsd_kdev = 0;
+
int bsd_maxpart;
+#endif
 #ifdef CONFIG_BLK_DEV_IDE

int tested_for_xlate = 0;

@@@@ -365,13 +402,29 @@@@




hd->part[minor].nr_sects = 2;


}
 #ifdef CONFIG_BSD_DISKLABEL
+


/* tag first disklabel for late recognition */


if (SYS_IND(p) == BSD_PARTITION) {
-


printk(" <");
-


bsd_disklabel_partition(hd, MKDEV(hd->major, minor));
-


printk(" >");
+


printk("!");
+


if (!bsd_kdev) {
+



bsd_kdev = MKDEV(hd->major, minor);
+



bsd_maxpart = BSD_MAXPARTITIONS;
+


}
+

} else if (SYS_IND(p) == OPENBSD_PARTITION) {
+


printk("!");
+


if (!bsd_kdev) {
+



bsd_kdev = MKDEV(hd->major, minor);
+



bsd_maxpart = OPENBSD_MAXPARTITIONS;
+


}


}
 #endif

}
+#ifdef CONFIG_BSD_DISKLABEL
+
if (bsd_kdev) {
+

printk(" <");
+

bsd_disklabel_partition(hd, bsd_kdev, bsd_maxpart);
+

printk(" >");
+
}
+#endif

/*

 *  Check for old-style Disk Manager partition table

 */
diff -ur linux.orig/include/linux/genhd.h linux/include/linux/genhd.h
--- linux.orig/include/linux/genhd.h
Wed Mar 18 20:25:30 1998
+++ linux/include/linux/genhd.h
Thu Sep 24 18:55:43 1998
@@@@ -69,12 +70,19 @@@@
 #ifdef CONFIG_BSD_DISKLABEL
 /*
  * BSD disklabel support by Yossi Gottlieb <yogo@@math.tau.ac.il>
+ *
+ * updated by Marc Espie <Marc.Espie@@openbsd.org>
  */

+/* check against BSD src/sys/sys/disklabel.h for consistency */
+
 #define BSD_PARTITION

0xa5
/* Partition ID */
+#define OPENBSD_PARTITION
0xa6

 #define BSD_DISKMAGIC
(0x82564557UL)
/* The disk magic number */
 #define BSD_MAXPARTITIONS
8
+#define OPENBSD_MAXPARTITIONS 16
+
 #define BSD_FS_UNUSED

0
/* disklabel unused partition entry ID */
 struct bsd_disklabel {

__u32
d_magic;

/* the magic number */
----------------------------------------------------------------------
It does:
- trigger the recognition of OpenBSD disklabels,
- force bsd partitions to appear at the end of the partition list,
- check the bsd disklabel for redundancy and consistency with the dos
partition table, so that the same partition does not show up twice.

You also need a working ufs, such as
<ftp://sunsite.unc.edu/pub/Linux/ALPHA/ufs/u2fs-0.4.3.tar.gz>
This package yields a new module, plus a small patch to tie the module
with the rest of the Linux kernel. I would recommend checking that patch
manually, as Linux module information tends to vary widely, and it is
pretty trivial to add by hand anyway.

Running Linux binaries under OpenBSD
------------------------------------
You just have to recompile your BSD kernel with COMPAT_LINUX, and set up
/emul/linux as explained in compat_linux(1).

It's a good idea to mount your Linux file system under another point, then
make symbolic links so that you can control what gets used precisely.
Don't bother with the ports emul/linux_lib entry: it's only a set of Linux
libraries for people who don't have a Linux system running.

As of this writing, most applications work, apart from sound.

The Linux sound devices use differing ioctl from OpenBSD, hence anything that
needs to change the audio mode won't work, and produce audio garbage at best.

A small detail that may cause problems: uname still says `OpenBSD', even
under Linux compatibility.  The reason behind that is that we don't want
netscape to tell it was run from a Linux box, when it is used under
OpenBSD.

Some programs, for instance maple, do depend on uname answering `Linux'.
For maple, this is straigthforward: you just have to fudge
/usr/local/maple/bin/maple.system.type to check OpenBSD in the same
class with Linux.

Similar shell scripts are easy to fix.  Binary programs that don't run
suid can be coerced by using LD_PRELOAD.

As a rule, this should be achieved on a program-by-program basis.
The more networking programs that do tell they're running under OpenBSD,
the merrier !



   [1][Back to Main Index] [2][To Section 11.0 - OpenBSD 2.4 Specific
   Information]

                           12.0 - Performance Tuning
     _________________________________________________________________

12.1 - Networking

   If you run a busy server, gateway or firewall, you should make sure to
   prevent memory starvation to various parts of the kernel described
   below.

   The [3]options(4) man page talks about the options presented.

   An option you may need to chane for a busy server, gateway or firewall
   is NMBCLUSTERS. This controls the size of the kernel mbuf cluster map.
   On your computer, if you get messages like "mb_map full", you need to
   increase this value. If traffic on a networking interface stops for no
   apparent reason, this may also be a sign that you need to increase
   this value. A reasonable value on the i386 port with most 100Mbps
   ethernet interfaces (no matter how many the machine has) is 8192.
   option NMBCLUSTERS=8192

12.2 - Disk I/O

   Disk I/O speed is a significant factor in the overall speed of your
   computer. It becomes increasingly important when your computer is
   hosting a multi-user environment (users of all kinds, from those who
   log-in interactively to those who see you as a file-server or a
   web-server.) Data storage constantly needs attention, especially when
   your partitions run out of space and when your disks fail. OpenBSD has
   several options to increase the speed of your disk operations and
   provide fault tolerance.

  CCD

       The first option is the use of [4]ccd(4), the Concatenated Disk
       Driver. This allows you to join several partitions into one
       virtual disk (and thus, you can make several disks look like one
       disk). This concept is similar to that of LVM, which is found in
       many commercial Unix flavors.
       If you are running GENERIC, ccd is already enabled. If not, you
       may need to add it to your kernel configuration. To start setup of
       ccd, you need to add support for it in your kernel. A line such
       as:

pseudo-device   ccd     4       # concatenated disk devices

   The above configuration entry gives you up to 4 ccd devices (virual
   disks), which is also the maximum number of ccd devices allowed.

  RAID

       Another solution is [5]raid(4) which will have you use
       [6]raidctl(8). to control your raid devices. OpenBSD's RAID is
       based off of Greg Oster's [7]NetBSD port of the CMU [8]RAIDframe
       software. OpenBSD has support for RAID levels of 0, 1, 4, and 5.
       With raid, as with ccd, support must be in the KERNEL. Unlike ccd,
       support for RAID is not found in GENERIC, it must be compiled into
       your kernel (RAID support adds some 500K to the size of an i386
       kernel!)

pseudo-device   raid   4       # RAIDframe disk device

  Filesystem Buffer

   For fileservers with memory to spare, you can increase
       BUFCACHEPERCENT. That is, what percentage of your RAM should you
       use as a file system buffer. This option will eventually go away
       when the Unified Buffer Cache is completed and part of OpenBSD. In
       the mean time, to increase BUFCACHEPERCENT, you should add a line
       to your kernel configuration like this:

   option BUFCACHEPERCENT=30

   Of course you can make it as low as 5 percent (the default) or as high
   as 50 percent (or more.)

  Soft updates

   Another tool that can be used to speed up your system is softupdates.
       One of the slowest operations in the traditional BSD file system
       is updating metainfo (which happens, among other times, when you
       create or delete files and directories.) Softupdates attempts to
       update metainfo in RAM instead of writing to the hard disk each
       and every single metainfo update. Another effect of this is that
       the metainfo on disk should always be complete, although not
       always up to date. So, a system crash should not require fsck upon
       boot up, but simply a background version of fsck that makes
       changes to the metainfo in RAM (a la softupdates). This means
       rebooting a server is much faster, because you don't have to wait
       for fsck! (OpenBSD does not have this feature yet.) You can read
       more about softupdates in the [9]softupdates FAQ entry. If you use
       softupdates, you will most certainly want to take advantage of the
       Tuning kmem section below.

12.3 - Tuning kmem

   If you start using the performance tuning measures above, you may
   start running out of kernel memory. If you start getting panics like
   "out of space in kmem_map" then you need to try
   option NKMEMCLUSTERS=8192

   Note that 8192 is valid for the i386 architecture, but may be too
   little or too much for others. Look at /usr/include/machine/param.h to
   see more information.

   You may also want to increase the number of static kernel maps and
   entries. The default value for these options is architecture dependant
   and is specified in /sys/vm/vm_map.h. If you are using soft updates,
   the following values should keep you going!
   option MAX_KMAP=120
       option MAX_KMAPENT=6000

   [10][Back to Main Index] [11][To Section 11.0 - OpenBSD 2.4 Specific
   Information]
     _________________________________________________________________

   [12][back] [13]www@@openbsd.org
   $OpenBSD: obsd-faq.txt,v 1.6 1999/06/25 18:53:51 ericj Exp $

References

   1. http://www.openbsd.org/faq/index.html
   2. http://www.openbsd.org/faq/faq24.html
   3. http://www.openbsd.org/cgi-bin/man.cgi?query=options&apropos=0&sektion=4&format=html
   4. http://www.openbsd.org/cgi-bin/man.cgi?query=ccd&apropos=0&sektion=4&format=html
   5. http://www.openbsd.org/cgi-bin/man.cgi?query=raid&apropos=0&sektion=4&format=html
   6. http://www.openbsd.org/cgi-bin/man.cgi?query=raidctl&apropos=0&sektion=8&format=html
   7. http://www.cs.usask.ca/staff/oster/raid.html
   8. http://www.pdl.cs.cmu.edu/RAIDframe/
   9. http://www.openbsd.org/faq/faq4.html#4.9
  10. http://www.openbsd.org/faq/index.html
  11. http://www.openbsd.org/faq/faq24.html
  12. http://www.openbsd.org/faq/index.html
  13. mailto:www@@openbsd.org


MINI-FAQ: Upgrading OpenBSD

  Latest OpenBSD Version - 2.5

    Kjell Wooding <[1]kwooding@@codetalker.com>

   Last Update - 03 Jun 1999

     If you've ever tried compiling the -current sources from an older
     OpenBSD release, you're aware that the process isn't always
     straightforward. This Mini-FAQ is an attempt to address the most
     common issues encountered when upgrading between OpenBSD releases,
     or from the releases to -current

  1.0: General Upgrade Questions

   [2]1.1: Terminology. What is -current? What are Snapshots?
   [3]1.2: What is the easiest way to upgrade to -current?
   [4]1.3: I looked, but didn't see any snapshots on the FTP site. Where
   did they go?
   [5]1.4: How do I get the latest source?
   [6]1.5: Okay, I have the tree. How do I build it.
   [7]1.6: My make build stopped halfway. Do I have to redo the whole
   thing?

  2.0: Upgrading from 2.3

   [8]2.1: What are the major problems upgrading from 2.3 to 2.4?
   [9]2.2: I tried the build, but it failed when trying to compile
   ssleay.
   [10]2.3: I tried the build, but it failed when trying to make
   something for the PowerPC.

  3.0: Upgrading from 2.4

   [11]3.1: What are the major problems upgrading from 2.4 to 2.5?
   [12]3.2: I tried the build, but it failed on cap_mkdb.

  4.0: Upgrading from 2.5

   [13]4.1: What are the major problems upgrading from 2.5 to -current?
   [14]4.2: How do I upgrade gcc to egcs

     [15]4.2.1 - i386 and sparc are no longer #define'ed
     [16]4.2.2 - Build fails in xlint
     [17]4.2.3 - Core Dump on uthread_autoinit.c
     [18]4.2.4 - egcs seems much slower than gcc
     [19]4.2.5 - egcs generates larger code than gcc
     [20]4.2.6 - After installing egcs I have very little disk space
     left

   [21]4.3: My make build dies with unimplemented syscall errors.

                           _____________________

  1.0: General Upgrade Questions

    1.1: Terminology. What is -current? What are Snapshots?

   Unlike Operating System projects like Linux and FreeBSD, OpenBSD
   development happens from a single source tree. On approximately
   six-month intervals, OpenBSD releases are produced. These are numbered
   in the conventional (2.x) manner. The current OpenBSD release is 2.5.

   -current, short for openbsd-current, refers to the up-to-the-minute
   version of the source tree contained in the CVS repository. This is
   the tree most commonly used by OpenBSD developers. The -current tree
   contains all the code that is planned for the next release. From time
   to time, brave souls will abandon the formal releases and run
   openbsd-current, usually to take advantage of features that have not
   yet made it into the formal releases. Because of its uncertain nature,
   however, upgrading to -current is not recommended for non-technical
   users.

   Between formal releases, a series of snapshot releases are [22]made
   available. Snapshots are test releases of the -current source tree.
   Because they reflect the current state of development, there is no
   guarantee that snapshot releases will work correctly (or even at all).
   Snapshots are quite useful when moving from a formal release (or older
   version of -current) to the current tree.

    1.2: What is the best way to upgrade to -current?

   Due to changes in the underlying libraries, moving directly from a
   release to -current is not always easy. The most painless way to move
   up to -current is to first upgrade to the latest snapshot (usually,
   via an FTP install). Once the snapshot is installed, the latest source
   can be [23]fetched and [24]built. This procedure should eliminate most
   toolchain and library problems.

    1.3: I looked, but didn't see any snapshots on the FTP site. Where did they
    go?

   The snapshots used to be taken temporarily offline right around the
   release time of a new version. This is no longer the OpenBSD policy.

   Snapshots may be removed as they become old (or no longer relevant).
   If no snapshot is available, you should upgrade to the most recent
   release and build the remainder of the way from source.

    1.4: How do I get the latest source?

   Short answer: [25]http://www.openbsd.org/anoncvs.html

   For example. To retrieve the entire tree via CVS: (using the bash
   shell. Others substitute setenv for export)
 # export CVSROOT=anoncvs@@anoncvs.ca.openbsd.org:/cvs
 # export CVS_RSH=/usr/local/bin/ssh
 # cd /usr
 # cvs -q get -PA src

    1.5: Okay, I have the tree. How do I build it.

   Basic instructions are in /usr/src/Makefile. This is a slightly
   expanded version.

1. Clean out the old object files.

   If you created a separate /usr/obj directory, clean that, and
   rebuild the symbolic links:

   # rm -rf /usr/obj
   # mkdir /usr/obj
   # cd /usr/src
   # make obj

   If you're worried there are object files in your source tree,
   do this:

   # cd /usr/src
   # find . -type l -name obj | xargs rm
   # make cleandir
   # rm -rf /usr/obj
   # mkdir /usr/obj
   # make obj

2. Perform any verion-specific configuration changes. For example,
   2.3 users must add the named user and group before
   moving to 2.4 or later. See the specific Mini-FAQ section for
   your version.

3. Make sure all the appropriate directories are created. This
   is especially important when upgrading from older versions, but is
   sometimes necessary in other cases. The easiest way to do this is:

   # cd /usr/src/etc && make DESTDIR=/ distrib-dirs

4. Compile a new kernel.

   # cd /usr/src/sys/arch/`machine`/conf
   # cp GENERIC MYKERNEL
   # vi MYKERNEL
   (edit MYKERNEL to your liking)
   # config MYKERNEL
   # cd ../compile/MYKERNEL
   # make clean && make depend && make
   (arc architecture only) copy bsd.ecoff to your FAT partition
   # cp /bsd /bsd.old && cp bsd /bsd
   # chown root.wheel /bsd (if you compiled as someone else)
   (reboot)

5. Compile the system.

   # cd /usr/src
   # make build

6. Update /etc and /dev by hand. These are not updated
   automatically. Choose a directory with enough space to
   hold /, /dev, /var, and /etc. Here I'll use /home/newroot
   (Note: make sure the directory hierarchy you choose
   does not have group write (g+w) or other write (o+w)
   permissions or sendmail will complain during this step.
   This makes /tmp a bad choice):

   # mkdir /home/newroot
   # export DESTDIR=/home/newroot
   # cd /usr/src/etc && make distribution-etc-root-var

   Now compare the files in /home/newroot with their
   installed counterparts. Replace or update the files as
   necessary.

   # rm -rf /home/newroot   (when done)

7. Reboot to make sure the new /etc files are correct

    1.6: My make build stopped halfway. Do I have to redo the whole thing?

   I would, but if you really want to pick up where you left off, do a:
 # cd /usr/src
 # make -n build

   This will show you what make build is doing. For example, mine tells
   me:
 (cd /usr/src/share/mk &&  make install)
 (cd /usr/src/include;  make includes)
 make cleandir
 (cd /usr/src/lib && make depend && make &&   make install)
 (cd /usr/src/gnu/lib && make depend && make &&   make install)
 (cd /usr/src/kerberosIV && make build)
 make depend && make &&  make install

   To pick up where you left off, just reissue the commands from the
   point where the compile died.

   If you do this procedure a lot, you may want to create a new target in
   your makefile. Simply copy the entry for build (to build-noclean, for
   example), and remove the make cleandir reference.

  2.0: Upgrading from 2.3

    2.1: What are the major problems upgrading from 2.3 to 2.4?

    New User: named

   After 2.3, the named DNS daemon was moved to a chroot jail. To make
   this change possible, the named user was created. If you do not have
   it already, you will need to create this user to ensure that all
   directories get created properly during the build process.

   Add the following entry to /etc/passwd using vipw
   named:*:70:70::0:0:BIND Daemon:/var/named:/sbin/nologin

   Add the following to /etc/group:
   named:*:70:

    2.2: I tried the build, but it failed when trying to compile ssleay.

   You are likely missing an entry for the named user in your password
   file.

   Short Answer:

   Create this user prior to the build.

   Long Answer:

   The named user is required in order to set permissions correctly. If
   this user is missing, part of the build process fails. If you capture
   your build to a file (say, with a make build &>/tmp/build.log) you
   will notice the following message:
  (cd /usr/src/etc && make DESTDIR=/ distrib-dirs)
  install -d -o root -g wheel -m 755 /
  mtree -def mtree/4.4BSD.dist -p // -u

  mtree: unknown user named
  mtree: failed at line 1632 of the specification
  *** Error code 1 (ignored)

   Unfortunately for us, the build continued happily on its way, totally
   ignoring the fact that an error occurred.

   If the named user exists, mtree works properly:
  missing: ./var/named (created)
  missing: ./var/named/dev (created)
  missing: ./var/named/etc (created)
  missing: ./etc/afs (created)
  missing: ./etc/ssl (created)
  missing: ./etc/ssl/private (created)
  missing: ./usr/obj (not created: File exists)
  missing: ./usr/share/doc/html (created)
  missing: ./usr/share/doc/html/lynx_help (created)
  missing: ./usr/share/doc/html/lynx_help/keystrokes (created)
  missing: ./usr/share/doc/usd/13.viref (created)
  missing: ./usr/share/man/cat4/powerpc (created)
  missing: ./usr/share/man/man4/alpha (created)
  missing: ./usr/share/man/man4/pmax (created)
  missing: ./usr/share/man/man4/powerpc (created)
  missing: ./usr/share/tmac/mdoc (created)
  missing: ./var/www/htdocs/manual/vhosts (created)
  missing: ./usr/include/ssl (created)

   The reason for the fail, then, is that the /usr/include/ssl directory
   was never created. Without the header files, the ssleay build fails.

   Fix:

   Create the named user and group. Remove /usr/include/ssl, /var/named,
   and any other directory from the list above that was mistakenly
   created as a normal file by the make build.

    2.3: I tried the build, but it failed when trying to make something for the
    PowerPC.

   Your directory tree is incomplete. Specifically, the
   /usr/share/man/cat4/powerpc directory is missing.

   Quick Fix:

   Create this directory and proceed with the compilation

   Complete Fix:

   Create the entire directory tree. Do a:
  # cd /usr/src/etc && make DESTDIR=/ distrib-dirs

   You will likely see an output like the following:
  install -d -o root -g wheel -m 755 /
  mtree -def mtree/4.4BSD.dist -p // -u

  missing: ./var/named (created)
  missing: ./var/named/dev (created)
  missing: ./var/named/etc (created)
  missing: ./etc/afs (created)
  missing: ./etc/ssl (created)
  missing: ./etc/ssl/private (created)
  missing: ./usr/obj (not created: File exists)
  missing: ./usr/share/doc/html (created)
  missing: ./usr/share/doc/html/lynx_help (created)
  missing: ./usr/share/doc/html/lynx_help/keystrokes (created)
  missing: ./usr/share/doc/usd/13.viref (created)
  missing: ./usr/share/man/cat4/powerpc (created)
  missing: ./usr/share/man/man4/alpha (created)
  missing: ./usr/share/man/man4/pmax (created)
  missing: ./usr/share/man/man4/powerpc (created)
  missing: ./usr/share/tmac/mdoc (created)
  missing: ./var/www/htdocs/manual/vhosts (created)
  missing: ./usr/include/ssl (created)

   Note that /usr/share/man/cat4/powerpc was one of the directories
   created by this process.

  3.0: Upgrading from 2.4

    3.1: What are the major problems upgrading from 2.4 to 2.5?

    cap_mkdb

   The syntax for invoking cap_mkdb has changed slightly. Before doing a
   make build, rebuild cap_mkdb from the latest source:
# cd /usr/src/usr.bin/cap_mkdb
# make clean && make && make install

   The make build should then run to completion

    Man Page Changes

   Several man pages were moved from section 1 to later sections
   Unfortunately, if the old man pages are left in section 1, unwary
   users will not see the latest version of the page.

   The following pages should be removed:
/usr/share/man/cat1/ipf.0
/usr/share/man/cat1/ipnat.0
/usr/share/man/cat1/ipsecadm.0

    Snake

   You will need to remove the contents of the obj directory before
   upgrading /usr/src/games/snake.

    3.2: I tried the build, but it failed on cap_mkdb.

   Symptom:

   A make build resulted in an error like this:
  cap_mkdb -i -f terminfo terminfo.src
  cap_mkdb: illegal option -- i
  usage: cap_mkdb [-v] [-f outfile] file1 [file2 ...]
  *** Error code 1

   Quick Fix:

   You need to build a new cap_mkdb. See [26]3.1.

  4.0: Upgrading from 2.5

    4.1: What are the major problems upgrading from 2.5 to -current?

      perl and make

   The latest version of Perl (5.005_03) requires a new version of make
   to compile properly. You must rebuild make before building the new
   Perl. Do a:
# cd /usr/src/usr.bin/make
# make clean && make && make install

   Then go ahead and rebuild the new Perl. You will need to clean out the
   Perl obj directory by hand before building.

   Perl developers should take note of the latest changes. From
   millert@@openbsd.org:
The version of perl in the OpenBSD source tree (post 2.5) has been
upgraded to 5.005_03.  The build method has changed somewhat but
most of that should be invisible.  The important changes that affect
people are as follows:

    1) Perl lib files have moved from /usr/lib/perl5 to the more correct
       /usr/libdata/perl5
    2) The default site_perl directories now live in /usr/local.  Ie:
       if you install a perl module, it will place itself in
       /usr/local/libdata/perl5/site_lib.  This makes it easy to
       see what non-stock modules you have.  It also means that we
       can have perl modules in the ports system easily.
    3) The perl library man pages are now install in /usr/share/man/cat3p
       You'll need to update your man.conf based on the src/etc/man.conf
       to take advantage of them.  This means you can now do
       "man 3p less" and get info on the less pragma but "man less"
       will still get you the less pager manpage.

If you have modules or other non-stock perl files the simplest thing
to do is to move /usr/lib/perl5 to /usr/libdata/perl5 and add a link
from /usr/lib/perl5 to /usr/libdata/perl5.  Alternately, you could
just edit the installed Config.pm file and fix up the paths there.

      Compiler Change: egcs replaces gcc

   This change is likely the most significant change you will encounter.
   For detailed instructions, see section [27]4.2.

      Kernel Structure - statfs - changed

   The statfs structure has changed as of May 31. You must rebuild your
   kernel before attempting a make build. See [28]4.3 for details.

    4.2: How do I upgrade gcc to egcs

   The safest way will be to upgrade to a recent snapshot, once one is
   available. Until then (or for the brave of heart) read the following
   carefully.

   First, note that some platforms have not been bootstrapped
   successfully yet. To date, the following should work, if you are
   careful:
     * i386
     * sparc
     * m68k
     * alpha

   mips and rs6000 have problems.

   To test whether your platform can be bootstrapped, grab and install
   the egcs-snapshot, available from the [29]ports collection. If this
   works, the in-tree version likely will, too. This is the safest method
   of proceeding.

   Now, before going any futher, ensure that your copies of binutils,
   gas, and ld are up to date. Note that there are two copies of gas and
   ld in the tree. On i386 and sparc, the binutils versions are not used.
   Check /usr/src/gnu/usr.bin/gas and /usr/src/gnu/usr.bin/ld instead.

   To bootstrap to the in-tree egcs, read the following carefully.

   From espie@@openbsd.org:

Today, the compiler changes.

Exit gcc 2.8.1, enter egcs... or more precisely, gcc 2.95 prerelease.

This is probably going to be a rough ride, but I can't work out all
the kinks on every architecture by myself.

I'm going to start importing stuff *now*. There will be a second message
to tech@@ once things are settled...

Thanks to everyone who helped me sorting stuff out, most especially
niklas, turan, and millert.

Why the switch
--------------
as most of you already know, egcs is now the *official* compiler supported
by the FSF.  The upcoming july release as been re-christened gcc 2.95.

Just looking at the log messages will show you many improvements:
support for newer processors is better, C++ is more accurately matching
the ANSI/ISO standards, Fortran 77 is more closely integrated.
There are also countless bug-fixes and code generation improvements.

Also the development is more open. There is a cvs tree, there are several
mailing-lists available, and we are cooperating closely with the egcs
team. More precisely, I've been feeding patches back to the egcs team
so that OpenBSD configurations are officially supported.
Also, the development team is highly responsive to bug-reports, and problems
get fixed.

There also is a band-wagon phenomenon: everyone is switching to egcs,
which means lots of code to test the compiler on, and that we can benefit
from related projects.

Why now
-------
egcs-1.1 was unfit for some purposes. Specifically, code size on i386
was larger than gcc 2.8.1, which yielded floppy-disks problems.
At 2.5 freeze, the only code fit to include was a somewhat unstable
snapshot.  In the interest of stability, after much pondering, egcs was
not put into 2.5.

Right now, the egcs project is going through a release cycle which will
yield egcs 1.2.  Judging from their time schedule, there is ample margin
between egcs 1.2 and the next release of OpenBSD.  Also, we want to get
in now, so that we get a chance to report problems on less frequently
used architectures, and get everything fixed for 1.2.

egcs `feature freeze' is supposed to occur on may 7th, and the current
snapshot 19990502 looks solid.

What works and what doesn't
---------------------------
egcs runs an i386 OpenBSD system without problems.  m68k works as well,
with a few work-arounds linked to obscure bugs that will get fixed.
sparc seems to be running as well.  There is some linker trouble on some
other arches that needs to be fixed before our next release.

Right now, constructors across dynamic libraries are not quite ready.

egcs now features a stand-alone cpp which is going to be better than
the current hackish solution we use. This means a few interface changes
and possibly weird warnings.

Keeping gcc 2.8.1 ?
-------------------
due to size constraints, as soon as egcs is imported, gcc is going
to move to cvs Attic.  If you don't want to deal with egcs now, you'll
have to be careful through your cvs updates.
Some Makefiles are bound to change: includes, gnu/usr.bin, and gnu/lib.
xlint and cpp.sh are going to change as well.

How to bootstrap the compiler
-----------------------------
the simplest way is probably to trust the various arch maintainers
and download a snapshot.

If you want to do stuff the hard way, you must first remake proper
obj dirs:
cd /usr/src
make obj

If you run i386, gas must be up-to-date.
If you run sparc, ld must be up-to-date.

then build libiberty:
cd /usr/src/gnu/egcs/libiberty
make -f Makefile.bsd-wrapper clean
make -f Makefile.bsd-wrapper depend
make -f Makefile.bsd-wrapper
make -f Makefile.bsd-wrapper install

then the C compiler:
cd /usr/src/gnu/egcs/gcc
make -f Makefile.bsd-wrapper clean
make -f Makefile.bsd-wrapper depend
make -f Makefile.bsd-wrapper
make -f Makefile.bsd-wrapper install

rebuild the C compiler with the new version:
cd /usr/src/gnu/egcs/gcc
make -f Makefile.bsd-wrapper clean
make -f Makefile.bsd-wrapper depend
make -f Makefile.bsd-wrapper
make -f Makefile.bsd-wrapper install

rebuild the includes
cd /usr/src/include
make includes

build all egcs libraries and install them
cd /usr/src/gnu/egcs
make -f Makefile.bsd-wrapper clean
make -f Makefile.bsd-wrapper depend
make -f Makefile.bsd-wrapper
make -f Makefile.bsd-wrapper install

install the new cpp driver
cd /usr/src/usr.bin/cpp
make install

then you're all set, and a standard make build should work...

     [author note: Actually, it doesn't quite work. xlint will fail to
     build. The fix is simple though. Simply do a make && make install
     in the /usr/src/usr.bin/xlint/xlint directory before you attempt a
     make build and proceed. See [30]4.2.2.]
If it doesn't, you're using an arch that didn't go through make build yet.
The most probably occurrence is an Internal Compiler Error, as known as an
ICE.

First try to see if the ICE will go away with -O1 or -O0. In that case, you
can put a work-around in the Makefile until it's fixed
(see /usr/src/lib/libm/Makefile for an example of how to put in such
work-arounds for m68k).

Then the error needs to be reported to the egcs-bugs mailing list.

At a minimum, you must run the source through the same compiler invocation,
with an addition of -v -save-temps to the options.

-v yields the precise sequence of commands invoked by gcc. -save-temps
will give you a pre-processed C file (.i) or C++ (.ii) that the egcs people
can make sense of... you can't ask them to run OpenBSD on their boxes.

If you have more time, you can try to trim down the pre-processed C file to
the bare minimum that triggers the bug. Dichotomy works nicely.

   If you made it through this procedure, and everything is still
   working, congratulations. If not, check the following sections for
   advice. Problems not listed here should be posted to tech@@openbsd.org.

      4.2.1 - i386 and sparc are no longer #define'ed

   This is true. egcs uses the cleaner __i386__ and __sparc__. If you
   need to compile code that relies on the old defines, add a -Dsparc or
   -Di386 to the appropriate location of your Makefile.

      4.2.2 - Build fails in xlint

   This is due to semantic differences in cpp. The workaround is simple,
   and similar to the cap_mkdb issue described in [31]3.1.

   Do a:
# cd /usr/src/usr.bin/xlint/xlint
# make && make install

   now re-run make, and the build should continue.

      4.2.3 - Core Dump on uthread_autoinit.c

   You have fallen victim to a linker bug. Here's a relevant message:
   From: Marc Espie
   Subject: egcs core-dumping on uthread_autoinit.c

   If this happens to you, this is a known linker problem... the cc1 you have
   was linked in a weird way.

   Initially, I made cc1 link against static /usr/lib/libiberty.a to avoid this
   problem, but this was cutting things too close, and the bug reappeared,
   probably thanks to unrelated changes in libc or elsewhere...

   The tree has been patched with a work-around in

   src/gnu/egcs/f/lang-options.h

   make sure you have the kludged version of that file (at least rev 1.2),
   recompile and reinstall cc1, the problem should go away.

   What's going on is that the 386 linker gets something wrong because of
   the huge strings array in toplev.c, and something gets mislinked, so
   that
   void f(void) __attribute((constructor)) {}
   kills cc1.

   As a work-around, I've killed Fortran options help texts, until someone find
s
   where the linker errs.

      4.2.4 - egcs seems much slower than gcc

   It is, but there is a reason. egcs performs more optimizing passes.
   Data alignment and other such functionality will be better with
   egcs-generated code.

      4.2.5 - egcs generates larger code than gcc

   Yes it does. This is especially noticable with the old -O2 gcc switch.
   egcs introduces a new option, -Os which optimizes for space. This is
   roughly comparable to the old -O2 behavior.

      4.2.6 - After installing egcs I have very little disk space left

   egcs installs into a different subdirectory than gcc 2.8.1. You may
   remove gcc once egcs is bootstrapped and working. (on a related note,
   the perl changes mentioned in [32]4.1 mean that you can remove the
   /usr/lib/perl5 directory. The new location for this data is
   /usr/libdata/perl5.)

    4.3: My make build dies with unimplemented syscall errors.

   Short Answer:

   The kernel structure statfs has changed. You will need to recompile
   the kernel before attempting a make build.

   Long Answer:

   The kernel structure statfs has changed. The new struct statfs has the
   following features:
     * Has a u_int32_t flags field--now softdep can have a real flag.
     * Uses u_int32_t instead of longs (nicer on the alpha). Note: the
       man page used to lie about setting invalid/unused fields to -1.
       SunOS does that but our code never has.
     * Gets rid of f_type completely. It hasn't been used since NetBSD
       0.9 and having it there but always 0 is confusing. It is
       conceivable that this may cause some old code to not compile but
       that is better than silently breaking.
     * Adds a mount_info union that contains the FSTYPE_args struct. This
       means that mount can now tell you all the options a filesystem was
       mounted with. This is especially nice for NFS.

   Other changes:
     * The linux statfs emulation didn't convert between BSD fs names and
       linux f_type numbers. Now it does, since the BSD f_type number is
       useless to linux apps (and has been removed anyway)
     * FreeBSD's struct statfs is different from our (both old and new)
       and thus needs conversion. Previously, the OpenBSD syscalls were
       used without any real translation.
     * mount(8) will now show extra info when invoked with no arguments.
       However, to see everything you need to use the -v (verbose) flag.

   --
   $OpenBSD: obsd-faq.txt,v 1.6 1999/06/25 18:53:51 ericj Exp $
   Copyright  1998-1999, Kjell Wooding.
   Please send any comments, questions, or suggestions to
   [33]kwooding@@codetalker.com

References

   1. mailto:kwooding@@codetalker.com
   2. http://www.openbsd.org/faq/upgrade-minifaq.html#1.1
   3. http://www.openbsd.org/faq/upgrade-minifaq.html#1.2
   4. http://www.openbsd.org/faq/upgrade-minifaq.html#1.3
   5. http://www.openbsd.org/faq/upgrade-minifaq.html#1.4
   6. http://www.openbsd.org/faq/upgrade-minifaq.html#1.5
   7. http://www.openbsd.org/faq/upgrade-minifaq.html#1.6
   8. http://www.openbsd.org/faq/upgrade-minifaq.html#2.1
   9. http://www.openbsd.org/faq/upgrade-minifaq.html#2.2
  10. http://www.openbsd.org/faq/upgrade-minifaq.html#2.3
  11. http://www.openbsd.org/faq/upgrade-minifaq.html#3.1
  12. http://www.openbsd.org/faq/upgrade-minifaq.html#3.2
  13. http://www.openbsd.org/faq/upgrade-minifaq.html#4.1
  14. http://www.openbsd.org/faq/upgrade-minifaq.html#4.2
  15. http://www.openbsd.org/faq/upgrade-minifaq.html#4.2.1
  16. http://www.openbsd.org/faq/upgrade-minifaq.html#4.2.2
  17. http://www.openbsd.org/faq/upgrade-minifaq.html#4.2.3
  18. http://www.openbsd.org/faq/upgrade-minifaq.html#4.2.4
  19. http://www.openbsd.org/faq/upgrade-minifaq.html#4.2.5
  20. http://www.openbsd.org/faq/upgrade-minifaq.html#4.2.6
  21. http://www.openbsd.org/faq/upgrade-minifaq.html#4.3
  22. ftp://ftp.openbsd.org/pub/OpenBSD/snapshots/
  23. http://www.openbsd.org/faq/upgrade-minifaq.html#1.4
  24. http://www.openbsd.org/faq/upgrade-minifaq.html#1.5
  25. http://www.openbsd.org/anoncvs.html
  26. http://www.openbsd.org/faq/upgrade-minifaq.html#3.1
  27. http://www.openbsd.org/faq/upgrade-minifaq.html#4.2
  28. http://www.openbsd.org/faq/upgrade-minifaq.html#4.3
  29. http://www.openbsd.org/ports.html
  30. http://www.openbsd.org/faq/upgrade-minifaq.html#4.2.2
  31. http://www.openbsd.org/faq/upgrade-minifaq.html#3.1
  32. http://www.openbsd.org/faq/upgrade-minifaq.html#4.1
  33. mailto:kwooding@@codetalker.com

Enter pathname of shell or RETURN for sh: _
erase ^?, werase ^W, kill ^U, intr ^C
(I)nstall, (U)pgrade or (S)hell? _i
=================================================
Welcome to the OpenBSD/i386 2.5 installation program.

This program is designed to help you put OpenBSD on your disk in a simple and
rational way.

As with anything which modifies your disk's contents, this program can cause
SIGNIFICANT data loss, and you are advised to make sure your data is backed
up before beginning the installation process.

Default answers are displayed in brackets after the questions.  You can hit
Control-C at any time to quit, but if you do so at a prompt, you may have
to hit return.  Also, quitting in the middle of installation may leave your
system in an inconsistent state.  If you hit Control-C and restart the
install, the install program will remember many of your old answers.

Proceed with installation? [n] _y

Cool! Let's get to it...
Specify terminal type [pcvt25]: _

The installation program needs to know which disk to consider the root disk.
Note the unit number may be different than the unit number you used in the
boot program (especially on a PC with multiple disk controllers).
Available disks are:

wd0
wd1
sd0

Which disk is the root disk [wd0]? _
Do you want to use the *entire* disk for OpenBSD? [no] _yes

[...]

Inside the BIOS 'A6' ('OpenBSD') partition you just created, there resides an
OpenBSD partition table which defines how this BIOS partition is to be split
up. This table declares the offsets and sizes of your / partition, your swap
space, and any other partitions you might create.  (NOTE: The OpenBSD disk
label offsets are absolute, ie. relative to the start of the disk... NOT
relative to the start of the BIOS 'A6' partition).

If this disk is shared with other operating systems, those operating systems
should have a BIOS partition entry that spans the space they occupy completely.
For safety, also make sure all OpenBSD file systems are within the offset and
size specified in the 'A6' BIOS partition table.  (By default, the disklabel
editor will try to enforce this).  If you are unsure of how to use multiple
partitions properly (ie. seperating /,  /usr, /tmp, /var, /usr/local, and other
things) just split the space into a root and swap partition for now.

# using MBR partition 3: type A6 off 63 (0x3f) size 4991553 (0x4c2a41)

Treating sectors 63-16386300 as the OpenBSD portion of the disk.
You can use the 'b' command to change this.

Initial label editor (enter '?' for help at any prompt)
> _d a
> _a a
offset: [63] _
size: [16386237] _64M
Rounding to nearest cylinder: 131040
FS type: [4.2BSD] _
mount point: [none] _/
fragment size: [1024] _
block size: [8192] _
cpg: [16] _
> _a b
offset: [131103] _
size: [16255197] _64M
Rounding to nearest cylinder: 131040
FS type: [swap] _
> _a d
offset: [262143] _
size: [16124157] _64M
Rounding to nearest cylinder: 131040
FS type: [4.2BSD] _
mount point: [none] _/tmp
fragment size: [1024] _
block size: [8192] _
cpg: [16] _
> _a e
offset: [393183] _
size: [15993117] _64M
Rounding to nearest cylinder: 131040
FS type: [4.2BSD] _
mount point: [none] _/var
fragment size: [1024] _
block size: [8192] _
cpg: [16] _
> _a g
offset: [524223] _
size: [15862077] _300M
Rounding to nearest cylinder: 614880
FS type: [4.2BSD] _
mount point: [none] _/usr
fragment size: [1024] _
block size: [8192] _
cpg: [16] _
> _a h
offset: [1139103] _
size: [15247197] _*
FS type: [4.2BSD] _
mount point: [none] _/home
fragment size: [1024] _
block size: [8192] _
cpg: [16] _
> _w
> _q

You will now have the opportunity to enter filesystem information for wd0.
You will be prompted for the mount point (full path, including the prepending
'/' character) for each BSD partition on wd0.  Enter "none" to skip a
partition or "done" when you are finished.

The following partitions will be used for the root filesystem and swap:

wd0a
/

wd0b
swap

Mount point for wd0d (size=65520k) [/tmp, RET, none, or done]? _
Mount point for wd0e (size=65520k) [/var, RET, none, or done]? _
Mount point for wd0g (size=307440k) [/usr, RET, none, or done]? _
Mount point for wd0h (size=1926256k) [/home, RET, none, or done]? _done

Nowq you can select another disk to initialize.  (Do not re-select a
disk you have already entered information for).  Available disks are:

wd0
wd1

Which one? [done] _

You have configured the following devices and mount points:

wd0a /
wd0d /tmp
wd0e /var
wd0g /usr
wd0h /home

Filesystems will now be created on these devices.
If you made any mistakes, you may edit this now.
Edit using ed? [n] _

============================================================
The next step will overwrite any existing data on:

wd0a wd0d wd0e wd0g wd0h

Are you really sure that you're ready to proceed? [n] _y
[...]

You will now be given the opportunity to configure the network.  This will be
useful if you need to transfer the installation sets via FTP, HTTP, or NFS.
Even if you choose not to transfer installation sets that way, this information
will be preserved and copied into the new root filesystem.

Configure the network [y] _
Enter system hostname (short form): [] _mybox
Enter DNS domain name: [] _someisp.com

If you have any devices being configured by a DHCP server
it is recommended that you do not enter a default route or
any name servers.

You may configure the following network interfaces (the interfaces marked
with [X] have been successfully configured):


[ ] xl0

[ ] fxp0

Configure which interface? (or, enter 'done') [xl0] _
IP address (or 'dhcp')? [] _199.185.137.55
Symbolic (host) name? [mybox] _
Netmask ? [255.255.255.0] _
Your network interface might require non-default
media directives.  The default media is:

media: Ethernet 100baseTX half-duplex
This is a list of supported media:
        media autoselect
        media 100baseTX mediaopt full-duplex
        media 100baseTX mediaopt half-duplex
        media 100baseTX
        media 10baseT mediaopt full-duplex
        media 10baseT
        media 10baseT mediaopt half-duplex
If the default is not satisfactory, and you wish to use another
media, copy that line from above (ie. "media 100baseTX")
Media directives? [] _

You may configure the following network interfaces (the interfaces marked
with [X] have been successfully configured):


[X] xl0

[ ] fxp0

Configure which interface? (or, enter 'done') [done] _
Enter IP address of default route: [none] _199.185.137.128
Enter IP address of primary nameserver: [none] _199.185.137.1
Would you like to use the nameserver now? [y] _

You will now be given the opportunity to escape to the command shell to do
any additional network configuration you may need.  This may include adding
additional routes, if needed.  In addition, you might take this opportunity
to redo the default route in the event that it failed above.
Escape to shell? [n] _
/dev/wd0a on /mnt type ffs (local)
/dev/wd0d on /mnt/tmp type ffs (local)
/dev/wd0e on /mnt/var type ffs (local)
/dev/wd0g on /mnt/usr type ffs (local)
/dev/wd0h on /mnt/home type ffs (local)

Please enter the initial password that the root account will have.
Password (will not echo): _
Password (again): _

It is now time to extract the installation sets onto the hard disk.  Make sure
the sets are either on a local device (i.e. tape, CD-ROM) or on a network
server.  You will have the chance to repeat this step or to extract sets from
several places, so you don't have to try to load all the sets in one try and
can recover from some errors.

Install from (f)tp, (h)ttp, (t)ape, (C)D-ROM, (N)FS or local (d)isk? _c

The following CD-ROM devices are installed on your system; please select
the CD-ROM device containing the partition with the installation sets:

acd0
cd0

Which is the CD-ROM with the installation media? [abort] _acd0
Partition? [c] _

There are two CD-ROM filesystem types currently supported by this program:
cd9660

ISO-9660
ffs

Berkeley Fast Filesystem

Which filesystem type? [cd9660] _
Enter the directory relative to the mount point that
contains the file. [/2.5/i386] _

You will now be asked for files to extract.  In addition to the
files listed in the selector you may enter any file located in
/mnt2//2.5/i386.  You can also enter 'all' to install all the standard
sets, or 'list' to list the files avilable in /mnt2//2.5/i386.
When you are done selecting files, enter 'done'.
Some of these sets are required for your install and some are optional --
You will want at least the base and bsd sets.
Consult the intallation notes if you are not sure which sets are required!

The following sets are available for extraction.
Enter filename, `list', `all', or `done'.
You may de-select a set by prepending a '-' to it's name.


[X] base25.tar.gz

[X] etc25.tar.gz

[ ] misc25.tar.gz

[ ] comp25.tar.gz

[ ] man25.tar.gz

[ ] game25.tar.gz

[ ] xbase25.tar.gz

[ ] xshare25.tar.gz

[ ] xfont25.tar.gz

[ ] xserv25.tar.gz

[X] bsd

File name []? _*

The following sets are available for extraction.
Enter filename, `list', `all', or `done'.
You may de-select a set by prepending a '-' to it's name.


[X] base25.tar.gz

[X] etc25.tar.gz

[X] misc25.tar.gz

[X] comp25.tar.gz

[X] text25.tar.gz

[X] man25.tar.gz

[X] game25.tar.gz

[X] xbase25.tar.gz

[X] xshare25.tar.gz

[X] xfont25.tar.gz

[X] xserv25.tar.gz

[X] bsd
File name []? _-game*

The following sets are available for extraction.
Enter filename, `list', `all', or `done'.
You may de-select a set by prepending a '-' to it's name.


[X] base25.tar.gz

[X] etc25.tar.gz

[X] misc25.tar.gz

[X] comp25.tar.gz

[X] text25.tar.gz

[X] man25.tar.gz

[ ] game25.tar.gz

[X] xbase25.tar.gz

[X] xshare25.tar.gz

[X] xfont25.tar.gz

[X] xserv25.tar.gz

[X] bsd
File name []? _done

Ready to extract selected file sets? [y] _

/mnt2//2.5/i386/base25.tar.gz:
100% |***************************************************| 17774 KB   00:00 ETA
/mnt2//2.5/i386/etc25.tar.gz:
100% |***************************************************|   161 KB   00:00 ETA
/mnt2//2.5/i386/bsd:
100% |***************************************************|  2281 KB   00:00 ETA
/mnt2//2.5/i386/misc25.tar.gz:
100% |***************************************************|  1637 KB   00:00 ETA
/mnt2//2.5/i386/comp25.tar.gz:
100% |***************************************************| 11481 KB   00:00 ETA
/mnt2//2.5/i386/man25.tar.gz:
100% |***************************************************|  3543 KB   00:00 ETA
/mnt2//2.5/i386/xbase25.tar.gz:
100% |***************************************************|  5376 KB   00:00 ETA
/mnt2//2.5/i386/xshare25.tar.gz:
100% |***************************************************|  1482 KB   00:00 ETA
/mnt2//2.5/i386/xfont25.tar.gz:
100% |***************************************************|  6017 KB   00:00 ETA
/mnt2//2.5/i386/xserv25.tar.gz:
100% |***************************************************| 15188 KB   00:00 ETA

Extract more sets? [n] _
Copying fstab...done.
Copying hostname.xl0...done.
Copying hosts...done.
Copying myname...done.
Copying mygate...done.
Copying resolv.conf...done.

Select a time zone for your location. Timezones are represented on the
system by a directory structure rooted in "/usr/share/timezone". Most
timezones can be selected by entering a token like "MET" or "GMT-6".
Other zones are grouped by continent, with detailed zone information
separated by a slash ("/"), e.g. "US/Pacific" or "Canada/Mountain".

To get a listing of what's available in /usr/share/zoneinfo, enter "?"
at the prompts below.

What timezone are you in [`?' for list] [GMT]? _?
Africa/      Chile/       GMT          Jamaica      Navajo       UCT
America/     Cuba         GMT+0        Japan        PRC          US/
Antarctica/  EET          GMT-0        Kwajalein    PST8PDT      UTC
Arctic/      EST          GMT0         Libya        Pacific/     Universal
Asia/        EST5EDT      Greenwich    MET          Poland       W-SU
Atlantic/    Egypt        HST          MST          Portugal     WET
Australia/   Eire         Hongkong     MST7MDT      ROC          Zulu
Brazil/      Etc/         Iceland      Mexico/      ROK          posixrules
CET          Europe/      Indian/      Mideast/     Singapore
CST6CDT      Factory      Iran         NZ           SystemV/
Canada/      GB           Israel       NZ-CHAT      Turkey
What timezone are you in [`?' for list] [GMT]? _Canada
There are several timezones available within zone 'Canada'
Select a sub-timezone [`?' for list]: _?
Atlantic            Eastern             Pacific
Central             Mountain            Saskatchewan
East-Saskatchewan   Newfoundland        Yukon
Select a sub-timezone [`?' for list]: _Mountain
You have selected timezone "Canada/Mountain".
Installing timezone link...done.
Installing boot block...
boot: /mnt/boot
proto: /usr/mdec/biosboot
device: /dev/rwd0c
/usr/mdec/biosboot: entry point 0
proto bootblock size 512
room for 12 filesystem blocks at 0x16f
Will load 6 blocks of size 8192 each.
Using disk geometry of 63 sectors and 128 heads.
 0: 19 @@(0 93 45) (5903-5921)
 1: 63 @@(0 94 1) (5922-5984)
 2: 14 @@(0 95 1) (5985-5998)
/mnt/boot: 3 entries total
using MBR partition 3: type 166 (0xa6) offset 63 (0x3f)

Do you expect to run X windows on this machine? [y or n] _y
Enabling machdep.allowaperture. Read xf86(4) for more information.

Making all device nodes (by running /dev/MAKEDEV) ...... done.
Unmounting filesystems... /mnt/usr /mnt/var /mnt/tmp /mnt ... Done.
Done.

CONGRATULATIONS!  You have successfully installed OpenBSD!  To boot the
installed system, enter halt at the command prompt. Once the system has
halted, reset the machine and boot from the disk.

# _reboot



OpenBSD Frequently Asked Questions - Ver. 2.5
     _________________________________________________________________

   [2.4 logo]

   This FAQ is specifically designed for the 2.5 release of OpenBSD, but
   in some cases will work on earlier versions. This FAQ will take you
   through most critical steps to setting up your own OpenBSD system. The
   addressed questions will range from newbie to advanced users.
   Hopefully you will find this FAQ useful.

   This FAQ was recently updated to support the newest version of
   OpenBSD. To view information for previous versions, please refer to
   [1]FAQ section 11.0, or [2]errata.html.

   For some a text version of the faq would be much more handy. So please
   check out [3]obsd-faq.txt. Print it out, pass it to your friends. Add
   to it, (but make sure you send diffs to me).

   Any questions can be directed to: [4]faq@@openbsd.org

   The Current FAQ maintainers are:
   [5]Eric Jackson
   [6]Wim Vandeputte
   [7]Chris Cappuccio
        _________________________________________________________________

  [8]1.0 - Introduction to OpenBSD

     * [9]1.1 - What is OpenBSD?
     * [10]1.2 - What platforms are supported?
     * [11]1.3 - Is OpenBSD really free?
     * [12]1.4 - Why might I want to use OpenBSD?
     * [13]1.5 - How can I help support OpenBSD?
     * [14]1.6 - Who maintains OpenBSD?

  [15]2.0 - Other OpenBSD information resources

     * [16]2.1 - Web Pages
     * [17]2.2 - Mailing Lists
     * [18]2.3 - Manual Pages
     * [19]2.4 - Reporting Bugs

  [20]3.0 - Obtaining OpenBSD

     * [21]3.1 - Buying an OpenBSD CD
     * [22]3.1.1 - Buying OpenBSD T-Shirts
     * [23]3.2 - Downloading via FTP or AFS
     * [24]3.3 - Obtaining Current Source Code

  [25]4.0 - Installation and Disk Setup

     * [26]4.1 - Installing from CD
     * [27]4.2 - Installing from FTP
     * [28]4.3 - Installing via DHCP
     * [29]4.3.1 - Upgrading from various versions of Openbsd
     * [30]4.4 - What files are needed for Installation?
     * [31]4.5 - Using the OpenBSD disklabel
     * [32]4.6 - Using fdisk
     * [33]4.7 - Adding extra disks in OpenBSD
     * [34]4.8 - How to swap to a file
     * [35]4.9 - Soft-updates
     * [36]4.10 - How much space do I need for an OpenBSD installation?
     * [37]4.11 - When I boot after installation of i386 OpenBSD it says
       "partition 3 id 0".
     * [38]4.12 - How do I get a dmesg from a boot floppy?
     * [39]4.13 - I changed scsi controllers and now I cannot boot
       OpenBSD. It just says: "reading boot.. Bad magic" ( Installing
       Boot blocks - i386 specific)
     * [40]4.14 - Multibooting OpenBSD

  [41]5.0 - Kernel Configuration and Setup

     * [42]5.1 - Why do I need a custom kernel?
     * [43]5.2 - Kernel configuration Options
     * [44]5.3 - Building your own kernel
     * [45]5.4 - Boot-time configuration

  [46]6.0 - Networking

     * [47]6.1 - Initial network setup
     * [48]6.2 - IPF, NAT
     * [49]6.3 - IPSEC
     * [50]6.4 - DHCP
     * [51]6.5 - PPP

  [52]7.0 - Keyboard controls

     * [53]7.1 - How do I remap the keyboard?
     * [54]7.2 - Is there gpm or the like in OpenBSD?

  [55]8.0 - General Questions

     * [56]8.1 - What are these kerberos warnings when I first login?
     * [57]8.2 - How do I change virtual terminals?
     * [58]8.3 - I forgot my root password..... WHAT DO I DO?!?
     * [59]8.4 - X craps out when I startup.. what am I doing wrong?
     * [60]8.5 - What is CVS, and how do I use it?
     * [61]8.6 - What is the ports tree?
     * [62]8.7 - What are packages?
     * [63]8.8 - Is there any way to use my floppy drive if it's not
       attached during boot?
     * [64]8.9 - OpenBSD Bootloader (i386 specific)

  [65]9.0 - Migrating from Linux

     * [66]9.1 - Simple tips for ex-linux users
     * [67]9.2 - Dual boot of Linux and OpenBSD

  [68]10.0 - System Administration

     * [69]10.1 - When I try to su to root it says that I'm in the wrong
       group
     * [70]10.2 - How do I duplicate a filesystem?
     * [71]10.3 - How do I get httpd, sendmail, etc to start up with the
       system?
     * [72]10.4 - Why do users get relaying access denied when they are
       remotely sending mail through my OpenBSD system?
     * [73]10.5 - I've set up POP, but I get errors when accessing my
       mail thru POP. What can i do?
     * [74]10.6 - Setting up a Secure HTTP Server using SSL(8)
     * [75]10.7 - I made changes to /etc/passwd with vi(1), but the
       changes didn't seem to take place. Why?
     * [76]10.8 - How do I add a user? or delete a user?
     * [77]10.9 - How do I create a ftp-only account?
     * [78]10.10 - Setting up user disk quota's

  [79]11.0 - OpenBSD 2.4 Specific Information

     * [80]11.1 - Why do I get UserDir errors when running httpd(8)?
     * [81]11.2 - Installing at a partition 4GB or higher (i386 specific)
     * [82]Log24.txt - Specific OpenBSD 2.4 Install Example

  [83]12.0 - Performance Tuning

     * [84]12.1 - Networking
     * [85]12.2 - Disk IO
     * [86]12.3 - Tuning kmem
     * [87]12.4 - Hardware Choices
     _________________________________________________________________

   [88][back] [89]www@@openbsd.org
   $OpenBSD: index.html,v 1.45 1999/06/28 02:15:35 ericj Exp $

References

   1. http://www.openbsd.org/faq/faq24.html
   2. http://www.openbsd.org/errata.html
   3. http://www.openbsd.org/faq/obsd-faq.txt
   4. mailto:faq@@openbsd.org
   5. mailto:ericj@@openbsd.org
   6. mailto:wvdputte@@openbsd.org
   7. mailto:chris@@dqc.org
   8. http://www.openbsd.org/faq/faq1.html
   9. http://www.openbsd.org/faq/faq1.html#1.1
  10. http://www.openbsd.org/faq/faq1.html#1.2
  11. http://www.openbsd.org/faq/faq1.html#1.3
  12. http://www.openbsd.org/faq/faq1.html#1.4
  13. http://www.openbsd.org/faq/faq1.html#1.5
  14. http://www.openbsd.org/faq/faq1.html#1.6
  15. http://www.openbsd.org/faq/faq2.html
  16. http://www.openbsd.org/faq/faq2.html#2.1
  17. http://www.openbsd.org/faq/faq2.html#2.2
  18. http://www.openbsd.org/faq/faq2.html#2.3
  19. http://www.openbsd.org/faq/faq2.html#2.4
  20. http://www.openbsd.org/faq/faq3.html
  21. http://www.openbsd.org/faq/faq3.html#3.1
  22. http://www.openbsd.org/faq/faq3.html#3.1.1
  23. http://www.openbsd.org/faq/faq3.html#3.2
  24. http://www.openbsd.org/faq/faq3.html#3.3
  25. http://www.openbsd.org/faq/faq4.html
  26. http://www.openbsd.org/faq/faq4.html#4.1
  27. http://www.openbsd.org/faq/faq4.html#4.2
  28. http://www.openbsd.org/faq/faq4.html#4.3
  29. http://www.openbsd.org/faq/upgrade-minifaq.html
  30. http://www.openbsd.org/faq/faq4.html#4.4
  31. http://www.openbsd.org/faq/faq4.html#4.5
  32. http://www.openbsd.org/faq/faq4.html#4.6
  33. http://www.openbsd.org/faq/faq4.html#4.7
  34. http://www.openbsd.org/faq/faq4.html#4.8
  35. http://www.openbsd.org/faq/faq4.html#4.9
  36. http://www.openbsd.org/faq/faq4.html#4.10
  37. http://www.openbsd.org/faq/faq4.html#4.11
  38. http://www.openbsd.org/faq/faq4.html#4.12
  39. http://www.openbsd.org/faq/faq4.html#4.13
  40. http://www.openbsd.org/faq/faq4.html#4.14
  41. http://www.openbsd.org/faq/faq5.html
  42. http://www.openbsd.org/faq/faq5.html#5.1
  43. http://www.openbsd.org/faq/faq5.html#5.2
  44. http://www.openbsd.org/faq/faq5.html#5.3
  45. http://www.openbsd.org/faq/faq5.html#5.4
  46. http://www.openbsd.org/faq/faq6.html
  47. http://www.openbsd.org/faq/faq6.html#6.1
  48. http://www.openbsd.org/faq/faq6.html#6.2
  49. http://www.openbsd.org/faq/faq6.html#6.3
  50. http://www.openbsd.org/faq/faq6.html#6.4
  51. http://www.openbsd.org/faq/faq6.html#6.5
  52. http://www.openbsd.org/faq/faq7.html
  53. http://www.openbsd.org/faq/faq7.html#7.1
  54. http://www.openbsd.org/faq/faq7.html#7.2
  55. http://www.openbsd.org/faq/faq8.html
  56. http://www.openbsd.org/faq/faq8.html#8.1
  57. http://www.openbsd.org/faq/faq8.html#8.2
  58. http://www.openbsd.org/faq/faq8.html#8.3
  59. http://www.openbsd.org/faq/faq8.html#8.4
  60. http://www.openbsd.org/faq/faq8.html#8.5
  61. http://www.openbsd.org/faq/faq8.html#8.6
  62. http://www.openbsd.org/faq/faq8.html#8.7
  63. http://www.openbsd.org/faq/faq8.html#8.8
  64. http://www.openbsd.org/faq/faq8.html#8.9
  65. http://www.openbsd.org/faq/faq9.html
  66. http://www.openbsd.org/faq/faq9.html#9.1
  67. http://www.openbsd.org/faq/faq9.html#9.2
  68. http://www.openbsd.org/faq/faq10.html
  69. http://www.openbsd.org/faq/faq10.html#10.1
  70. http://www.openbsd.org/faq/faq10.html#10.2
  71. http://www.openbsd.org/faq/faq10.html#10.3
  72. http://www.openbsd.org/faq/faq10.html#10.4
  73. http://www.openbsd.org/faq/faq10.html#10.5
  74. http://www.openbsd.org/faq/faq10.html#10.6
  75. http://www.openbsd.org/faq/faq10.html#10.7
  76. http://www.openbsd.org/faq/faq10.html#10.8
  77. http://www.openbsd.org/faq/faq10.html#10.9
  78. http://www.openbsd.org/faq/faq10.html#10.10
  79. http://www.openbsd.org/faq/faq24.html
  80. http://www.openbsd.org/faq/faq24.html#11.1
  81. http://www.openbsd.org/faq/faq24.html#11.2
  82. http://www.openbsd.org/faq/log24.txt
  83. http://www.openbsd.org/faq/faq12.html
  84. http://www.openbsd.org/faq/faq12.html#12.1
  85. http://www.openbsd.org/faq/faq12.html#12.2
  86. http://www.openbsd.org/faq/faq12.html#12.3
  87. http://www.openbsd.org/faq/faq12.html#12.4
  88. http://www.openbsd.org/index.html
  89. mailto:www@@openbsd.org


   [1][Back to Main Index]

                         1.0 - Introduction to OpenBSD
     _________________________________________________________________

1.1 - What is OpenBSD?

   The [2]OpenBSD project produces a freely available, multi-platform
   4.4BSD-based UNIX-like operating system. Our efforts place emphasis on
   portability, standardization, correctness, and security. [3]OpenBSD
   supports binary emulation of most binaries from SVR4 (Solaris),
   FreeBSD, Linux, BSDI, SunOS, and HPUX.

1.2 - On what systems does OpenBSD run?

   OpenBSD 2.5 will install and run on the following platforms:
     * [4]i386 - CD bootable
     * [5]sparc - CD bootable
     * [6]alpha - CD bootable
     * [7]hp300
     * [8]amiga
     * [9]mac68k
     * [10]powerpc
     * [11]pmax
     * [12]mvme88k

     * The ports for pmax and mvme88k are not included on the 2.5 CD.
       They can be downloaded from any of the OpenBSD ftp sites

   bootable means that -for those savvy people who bought the CD- OpenBSD
   can be booted directly from the it.

   Previous releases of OpenBSD also had ports for:
     * [13]arc
     * [14]mvme68k

   These were removed from the 2.4 release, but were included in 2.3 if
   you are interested. If you have the proper equipment, bring them up to
   date! You can see updated information about specific platforms at
   [15]http://www.openbsd.org/plat.html

1.3 - Is OpenBSD really free?

   OpenBSD is all free. The binaries are free. The source is free. All
   parts of OpenBSD have reasonable copyright terms permitting free
   redistribution. This includes the ability to REUSE most parts of the
   OpenBSD source tree, either for personal or commercial purposes.
   OpenBSD has put NO further restrictions other than those implied by
   the original BSD license, which will allow greater applicability.
   Because of this, software which is written under stricter licenses
   cannot be included in the regular distribution of OpenBSD.

   For futher reading on other popular licenses read:
   [16]http://www.openbsd.org/policy.html.

   The maintainers of OpenBSD support the project largely from their own
   pockets. This includes the time spent programming for the project,
   equipment used to support the many ports, the network resources used
   to distribute OpenBSD to you, and the time spent answering questions
   and investigating users' bug reports. The OpenBSD developers are not
   independently wealthy and even small contributions of time, equipment,
   and resources make a big difference.

1.4 - Why might I want to use OpenBSD?

   New users frequently want to know whether OpenBSD is superior to some
   other free UNIX-like operating system. That question is largely
   un-answerable and is the subject of countless (and useless) religious
   debates. Do not, under any circumstances, ask such a question on an
   OpenBSD mailing list.

   Below are some reasons why we think OpenBSD is a useful operating
   system. Whether OpenBSD is right for you is a question that only you
   can answer.

     * OpenBSD runs on many different hardware platforms.
     * OpenBSD is thought of by many security professionals to be the
       most secure UNIX-like operating system as the result of a
       10-member 1.5-year long comprehensive source code security audit.
     * OpenBSD is a full-featured UNIX-like operating system available in
       source form at no charge.
     * OpenBSD integrates cutting-edge security technology suitable for
       building firewalls and private network services in a distributed
       environment.
     * OpenBSD benefits from strong on-going development in many areas,
       offering opportunities to work with emerging technologies with an
       international community of programmers and end-users.
     * OpenBSD offers opportunities for ordinary people to participate in
       the development and testing of the product.

1.5 - How can I help support OpenBSD?

   We are greatly indebted to the people and organizations that have
   contributed to the OpenBSD project. They are acknowledged by name
   here:

   [17]http://www.openbsd.org/donations.html

   OpenBSD has a constant need for several types of support from the user
   community. If you find OpenBSD useful, you are strongly encouraged to
   find a way to contribute. If none of the suggestions below are right
   for you, feel free to propose an alternative by sending e-mail to
   [18]donations@@openbsd.org.

     * Buy an OpenBSD CD. It includes the current full release of
       OpenBSD, and is bootable on many platforms. It also generates
       revenue to support the OpenBSD project, and reduces the strain on
       network resources used to deliver the distribution via the
       Internet. This inexpensive two-CD set includes full source.
       Remember, your friends need their own copy!
     * Donate money. The project has a constant need for cash to pay for
       equipment, network connectivity, and expenses relating to CD
       publishing. Manufacturing CDs requires an up-front out-of-pocket
       investment for the OpenBSD developers, without guaranteed return.
       Send e-mail to [19]donations@@openbsd.org to find out how to
       contribute. Even small donations make a profound difference.
     * Donate equipment and parts. The project has a constant need for
       general and specific hardware. Items such as IDE and SCSI disks,
       and various types of RAM are always welcome. For other types of
       hardware such as computer systems and motherboards, you should
       inquire as to current need. Write to [20]donations@@openbsd.org to
       arrange for shipment.
     * Donate your time and skills. Programmers who enjoy writing
       operating systems are naturally always welcome, but there are
       literally dozens of other ways that people can be useful. Follow
       mailing lists and help answer new-user questions.
     * Help maintain documentation by submitting new FAQ material (to
       [21]faq@@openbsd.org). Form a local user group and get your friends
       hooked on OpenBSD. Make a case to your employer for using OpenBSD
       at work. If you're a student, talk to your professors about using
       OpenBSD as a learning tool for Computer Science or Engineering
       courses. It's also worth mentioning one of the most important ways
       you should not try to "help" The OpenBSD project: do not waste
       your time engaging in operating system flame wars on Usenet
       newsgroups. It does not help the project to find new users and can
       cause substantial harm to important relationships that developers
       have with other developers.

1.6 - Who maintains OpenBSD?

   OpenBSD is maintained by a development team spread across many
   different countries. The project is coordinated by Theo de Raadt,
   located in Canada.

   [22][To Section 2.0 - Other OpenBSD information resources]
     _________________________________________________________________

   [23][back] [24]www@@openbsd.org
   $OpenBSD: faq1.html,v 1.10 1999/06/24 22:16:23 ericj Exp $

References

   1. http://www.openbsd.org/faq/index.html
   2. http://www.openbsd.org/
   3. http://www.openbsd.org/
   4. http://www.openbsd.org/i386.html
   5. http://www.openbsd.org/sparc.html
   6. http://www.openbsd.org/alpha.html
   7. http://www.openbsd.org/hp300.html
   8. http://www.openbsd.org/amiga.html
   9. http://www.openbsd.org/mac68k.html
  10. http://www.openbsd.org/powerpc.html
  11. http://www.openbsd.org/pmax.html
  12. http://www.openbsd.org/mvme88k.html
  13. http://www.openbsd.org/arc.html
  14. http://www.openbsd.org/mvme68k.html
  15. http://www.openbsd.org/plat.html
  16. http://www.openbsd.org/policy.html
  17. http://www.openbsd.org/donations.html
  18. mailto:donations@@openbsd.org
  19. mailto:donations@@openbsd.org
  20. mailto:donations@@openbsd.org
  21. mailto:faq@@openbsd.org
  22. http://www.openbsd.org/faq/faq2.html
  23. http://www.openbsd.org/faq/index.html
  24. mailto:www@@openbsd.org


   [1][Back to Main Index] [2][To Section 1.0 - Introduction to OpenBSD]
   [3][To Section 3.0 - Obtaining OpenBSD]

                   2.0 - Other OpenBSD information resources

2.1 - Web Pages of Interest

   The official website for the OpenBSD project is located at:
   [4]http://www.OpenBSD.org

   A lot of valuable information can be found here regarding about all
   aspects of the OpenBSD project.

   Additional information for laptop users can be found at:
   [5]http://www.monkey.org/openbsd-mobile/ and
   [6]http://www.cpio.net/openbsd/laptops/

2.2 - Mailing Lists

   The OpenBSD project maintains several popular mailing lists which
   users should subscribe to and follow. To subscribe to a mailing list,
   send an e-mail message to [7]majordomo@@openbsd.org. That address is an
   automated subscription service. In the body of your message, on a
   single line, you should include a subscribe command for the list you
   wish to join. For example:

   subscribe announce

   The list processor will reply to you, asking for confirmation of your
   intent to join the list. The confirmation you send back to the list
   processor will be included in its reply to you. It will look something
   like this:

   auth 90855167 subscribe announce you@@example.com

   Once you have confirmed your intent to join, you will be immediately
   added to the list, and the list processor will notify you that you
   were successfully added.

   To unsubscribe from a list, you will again send an e-mail message to
   [8]majordomo@@openbsd.org. It might look like this:

   unsubscribe announce

   If you have any difficulties with the mailing list system, please
   first read the instructions. They can be obtained by sending an e-mail
   message to [9]majordomo@@openbsd.org with a message body of "help".
   These are the currently-available OpenBSD mailing lists:

     * announce - Important announcements. This is a low-volume list.
     * tech - General technical discussions
     * misc - User questions and answers
     * bugs - Bugs received via sendbug(1) and discussions about them.
     * source-changes - Automated mailing of CVS source tree changes.
     * ports - Automated mailing of CVS source tree changes.
     * advocacy - Discussion of advocating OpenBSD.

   Archives of the OpenBSD mailing lists can be found by visiting the
   mailing lists web page: [10]http://www.openbsd.org/mail.html
   You can also get mail archives from
   [11]http://www.monkey.org/cgi-bin/wilma ,here they have searchable
   archives of the OpenBSD mailing lists.

   Another mailing list that may be of interest is
   [12]openbsd-mobile@@monkey.org. Which is a discussion of the use of
   OpenBSD in mobile computing.

   To subscribe to this list use:

   'echo subscribe | mail "openbsd-mobile-request@@monkey.org"'

   The archives for that can be found at:
   [13]http://www.monkey.org/openbsd-mobile/archive/

2.3 - Manual Pages

   OpenBSD comes with extensive documentation in the form of manual
   pages, as well as longer documents relating to specific applications.
   To access the manual pages and other documentation, be sure that you
   installed the man, misc, and text distributions.

   Here is a list of some of the most useful manual pages for new users:

     * [14]afterboot(8) - things to check after the first complete boot
     * [15]boot(8) - system boot strapping procedures
     * [16]passwd.conf(5) - format of the password configuration file
     * [17]adduser_proc(8) - procedure for adding new users
     * [18]adduser(8) - command for adding new users
     * [19]vipw(8) - edit the pass word file
     * [20]man(1) - display the on-line manual pages
     * [21]sendbug(1) - send a problem report (PR) about OpenBSD to a
       central support site.
     * [22]disklabel(8) - Read and write disk pack label.
     * [23]ifconfig(8) - configure network interface parameters.
     * [24]route(8) - manualy manipulate the routing tables.
     * [25]netstat(1) - show network status.
     * [26]reboot, halt(8) - Stopping and restarting the system.
     * [27]shutdown(8) - close down the system at a given time.
     * [28]boot_config(8) - how to change kernel configuration at boot

   Also, If you are one of the people who didn't install the man*.tar.gz
   package, you can find all the OpenBSD man pages on the web at
   [29]http://www.openbsd.org/cgi-bin/man.cgi.

   In general, if you know the name of a command or a manual page, you
   can read it by executing `man command'. For example: `man vi' to read
   about the vi editor. If you don't know the name of the command, or if
   `man command' doesn't find the manual page, you can search the manual
   page database by executing `apropos something' or `man -k something'
   where something is a likely word that might appear in the title of the
   manual page you're looking for. For example:

bsd# apropos "time zone"
tzfile (5) - time zone information
zdump (8) - time zone dumper
zic (8) - time zone compiler

   The parenthetical numbers indicate the section of the manual in which
   that page can be found. In some cases, you may find manual pages with
   identical names living in separate sections of the manual. For
   example, assume that you want to know the format of the configuration
   files for the cron daemon. Once you know the section of the manual for
   the page you want, you would execute `man n command' where n is the
   manual section number.

bsd# man -k cron
cron (8) - daemon to execute scheduled commands (Vixie Cron)
crontab (1) - maintain crontab files for individual users (V3)
crontab (5) - tables for driving cron
bsd# man 5 crontab

   In addition to the UNIX manual pages, there is a typesettable document
   set (included in the misc distribution). It lives in the
   /usr/share/doc directory. If you also installed the text distribution,
   then you can format each document set with a `make' in the appropriate
   subdirectory. The psd subdirectory is the Programmer's Supplementary
   Documents distribution. The smm subdirectory is the System Manager's
   Manual. The usd subdirectory is the UNIX User's Supplementary
   Documents distribution. You can perform your `make' in the three
   distribution subdirectories, or you can select a specific section of a
   distribution and do a `make' in its subdirectory. Some of the
   subdirectories are empty. By default, formatting the documents will
   result in Postscript output, suitable for printing. The Postscript
   output can be quite large -- you should assume 250-300% increase in
   volume. If you do not have access to a Postscript printer or display,
   you may also format the documents for reading on a terminal display.
   In each Makefile you'll need to add the flag -Tascii to each instance
   of the groff commands (or execute it by hand). Some of the documents
   use the ms formatting macros, and some use the me macros. The Makefile
   in each document subdirectory (eg, /usr/share/doc/usd/04.csh/Makefile)
   will tell you which one to use. For example:

bsd# cd /usr/share/doc/usd/04.csh
bsd# groff -Tascii -ms tabs csh.1 csh.2 csh.3 csh.4 csh.a csh.g > csh.txt
bsd# more csh.txt

   The UNIX manual pages are generally more current and trustworthy than
   the typesettable documents. The typesettable documents sometimes
   explain complicated applications in more detail than the manual pages
   do.

2.4 - Reporting Bugs

   Proper bug reporting is one of the most important responsibilities of
   end users. Very detailed information is required to diagnose most
   serious bugs. Developers frequently get bugs reports via e-mail such
   as these:

   Before submitting any bug report, please ready
   [30]http://www.openbsd.org/report.html

From: joeuser@@example.com
To: bugs@@openbsd.org
Subject: HELP!!!

I have a PC and it won't boot!!!!! It's a 486!!!!!

   Hopefully most people understand why such reports get summarily
   deleted. All bug reports should contain detailed information. If Joe
   User had really wanted his bug investigated, his bug report would have
   looked something like this:

From: smartuser@@example.com
To: bugs@@openbsd.org
Subject: 2.5 panics on an i386

After installing OpenBSD 2.5 from the CD which I purchased via your outstanding
on-line ordering system, I find that the system halts before the kernel even
gets loaded. After booting with a bootdisk and escaping to a shell. This is the
dmesg output:

OpenBSD 2.5-current (OSHIBANA) #2: Fri Jun  4 11:11:41 EDT 1999
    shinobi@@oshibana:/sys/arch/i386/compile/OSHIBANA
cpu0: F00F bug workaround installed
cpu0: Intel Pentium (P54C) ("GenuineIntel" 586-class) 120 MHz
cpu0: FPU,V86,DE,PSE,TSC,MSR,MCE,CX8
BIOS mem  = 654336 conventional, 15728640 extended
real mem  = 16384000
avail mem = 13725696
using 225 buffers containing 921600 bytes of memory
mainbus0 (root)
bios0 at mainbus0: AT/286+(63) BIOS, date 08/20/96
bios0: apminfo 0xf02dc00c diskinfo 0xf02dc034 cksumlen 1 memmap 0xf02dc0b0
apm0 at bios0: Power Management spec V1.1
apm0: battery life expectancy 96%
apm0: AC on, battery charge high, charging, estimated 1:28 minutes
pci0 at mainbus0 bus 0: configuration mode 1 (no bios)
"Toshiba (2nd ID) Host-PCI" rev 0x11 at pci0 dev 0 function 0 not configured
"Chips and Technologies 65550" rev 0x04 at pci0 dev 4 function 0 not configured
isa0 at mainbus0
isadma0 at isa0
wdc0 at isa0 port 0x1f0-0x1f7 irq 14
wd0 at wdc0 drive 0: &ltTOSHIBA MK2720FC>
wd0: 1296MB, 2633 cyl, 16 head, 63 sec, 512 bytes/sec, 2654280 sec total
wd0: using 16-sector 16-bit pio transfers, lba addressing (128KB cache)
sb0 at isa0 port 0x220-0x237 irq 7 drq 1: dsp v3.02
midi0 at sb0: &ltSB MIDI UART>
audio0 at sb0
opl0 at sb0: model OPL3
midi at opl0 not configured
pccom0 at isa0 port 0x3f8-0x3ff irq 4: ns16550a, 16 byte fifo
pccom1 at isa0 port 0x2f8-0x2ff irq 3: ns16550a, 16 byte fifo
pccom2 at isa0 port 0x3e8-0x3ef irq 5: ns16550a, 16 byte fifo
vt0 at isa0 port 0x60-0x6f irq 1: generic VGA, 80 col, color, 8 scr, mf2-kbd
pms0 at vt0 irq 12
fdc0 at isa0 port 0x3f0-0x3f5 irq 6 drq 2
fd0 at fdc0 drive 0: 1.44MB 80 cyl, 2 head, 18 sec
pcic0 at isa0 port 0x3e0-0x3e1 iomem 0xd0000-0xd3fff
pcic0: controller 0 (Intel 82365SL Revision 1) has sockets A and B
pcmcia0 at pcic0 controller 0 socket 0
pcmcia1 at pcic0 controller 0 socket 1
biomask 40c0 netmask 42c0 ttymask 56c2
root on wd0a
pctr: 586-class performance counters and user-level cycle counter enabled
rootdev=0x0 rrootdev=0x300 rawdev=0x302

Thank you!

   If Joe User had a working OpenBSD system from which he wanted to
   submit a bug report, he would have used the sendbug(1) utility to
   submit his bug report to the GNATS problem tracking system. Obviously
   you can't use sendbug(1) when your system won't boot, but you should
   use it whenever possible. You will still need to include detailed
   information about what happened, the exact configuration of your
   system, and how to reproduce the problem. The sendbug(1) command
   requires that your system be able to deliver electronic mail
   successfully on the Internet.

   If you have submitted a bug report and you want to check its current
   status without annoying anyone, the best ways are:

     * Visit the GNATS tracking system:
       [31]http://cvs.openbsd.org/cgi-bin/wwwgnats.pl.
     * Look in the [32]bugs@@openbsd.org list archives:
       [33]http://www.openbsd.org/mail.html.

   [34][Back to Main Index] [35][To Section 1.0 - Introduction to
   OpenBSD] [36][To Section 3.0 - Obtaining OpenBSD]
     _________________________________________________________________

   [37][back] [38]www@@openbsd.org
   $OpenBSD: faq2.html,v 1.13 1999/06/08 23:37:52 ericj Exp $

References

   1. http://www.openbsd.org/faq/index.html
   2. http://www.openbsd.org/faq/faq1.html
   3. http://www.openbsd.org/faq/faq3.html
   4. http://www.openbsd.org/
   5. http://www.monkey.org/openbsd-mobile/
   6. http://www.cpio.net/openbsd/laptops/
   7. mailto:majordomo@@openbsd.org
   8. mailto:majordomo@@openbsd.org
   9. mailto:majordomo@@openbsd.org
  10. http://www.openbsd.org/mail.html
  11. http://www.monkey.org/cgi-bin/wilma
  12. mailto:openbsd-mobile@@monkey.org
  13. http://www.monkey.org/openbsd-mobile/archive/
  14. http://www.openbsd.org/cgi-bin/man.cgi?query=afterboot&apropos=0&sektion=8&format=html
  15. http://www.openbsd.org/cgi-bin/man.cgi?query=boot&apropos=0&sektion=8&format=html
  16. http://www.openbsd.org/cgi-bin/man.cgi?query=passwd.conf&apropos=0&sektion=5&format=html
  17. http://www.openbsd.org/cgi-bin/man.cgi?query=adduser_proc&apropos=0&sektion=8&format=html
  18. http://www.openbsd.org/cgi-bin/man.cgi?query=adduser&apropos=0&sektion=8&format=html
  19. http://www.openbsd.org/cgi-bin/man.cgi?query=vipw&apropos=0&sektion=8&format=html
  20. http://www.openbsd.org/cgi-bin/man.cgi?query=man&apropos=0&sektion=1&format=html
  21. http://www.openbsd.org/cgi-bin/man.cgi?query=sendbug&apropos=0&sektion=1&format=html
  22. http://www.openbsd.org/cgi-bin/man.cgi?query=disklabel&apropos=0&sektion=8&format=html
  23. http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&apropos=0&sektion=8&format=html
  24. http://www.openbsd.org/cgi-bin/man.cgi?query=route&apropos=0&sektion=8&format=html
  25. http://www.openbsd.org/cgi-bin/man.cgi?query=netstat&apropos=0&sektion1&format=html
  26. http://www.openbsd.org/cgi-bin/man.cgi?query=reboot&apropos=0&sektion=8&format=html
  27. http://www.openbsd.org/cgi-bin/man.cgi?query=shutdown&apropos=0&sektion=8&format=html
  28. http://www.openbsd.org/cgi-bin/man.cgi?query=boot_config&apropos=0&sektion=8&format=html
  29. http://www.openbsd.org/cgi-bin/man.cgi
  30. http://www.openbsd.org/report.html
  31. http://cvs.openbsd.org/cgi-bin/wwwgnats.pl
  32. mailto:bugs@@openbsd.org
  33. http://www.openbsd.org/mail.html
  34. http://www.openbsd.org/faq/index.html
  35. http://www.openbsd.org/faq/faq1.html
  36. http://www.openbsd.org/faq/faq3.html
  37. http://www.openbsd.org/faq/index.html
  38. mailto:www@@openbsd.org


   [1][Back to Main Index] [2][To Section 2.0 - Other OpenBSD information
   resources] [3][To Section 4.0 - Installation and Disk Setup]

                            3.0 - Obtaining OpenBSD

3.1 - Buying an OpenBSD CD

   Purchasing an OpenBSD CD is generally the best way to get started.
   Visit the ordering page to purchase your copy:
   [4]http://www.openbsd.org/orders.html.

   There are many good reasons to own an OpenBSD CD:
     * CD sales support on-going development of OpenBSD.
     * Development of a multi-platform operating system requires constant
       investment in equipment.
     * Your support in the form of a CD purchase has a real impact on
       future development.
     * The CD contains binaries (and source) for all supported platforms.
     * The CD is bootable on several platforms, and can be used to
       bootstrap a machine without a pre-existing installed operating
       system.
     * The CD is useful for bootstrapping even if you choose to install a
       snapshot.
     * Installing from CD is faster! Installing from CD preserves network
       connectivity resources.
     * OpenBSD CD's always come with very nice stickers. You system isn't
       fully complete without these. You can only get these stickers by
       buying a CD set or donating hardware.

   If you're installing a release version of OpenBSD, you should use a
   CD. Snapshot releases can only be installed over the network.

3.1.1 - Buying OpenBSD T-Shirts

   Yes, OpenBSD now has t-shirts for your wearing enjoyment. You can view
   these at [5]http://www.OpenBSD.org/tshirts.html. Enjoy :)

3.2 - Downloading via FTP or AFS

   There are numerous international mirror sites offering FTP access to
   OpenBSD releases and snapshots. AFS access is also available. You
   should always use the site closest to you. Before you begin fetching a
   release or snapshot, you may wish to use ping and traceroute to
   determine which mirror site is nearest to you and whether that nearest
   mirror is performing adequately. Of course, your OpenBSD release CD is
   always closer than any mirror. Access information is here:

   [6]http://www.openbsd.org/ftp.html

3.3 - Obtaining Current Source Code

   Source to OpenBSD is freely redistributable and available at no
   charge. Generally the best way to get started with a current source
   tree is to install the source from the most recent CD and then
   configure AnonCVS to update it regularly. Information about AnonCVS,
   including how to set it up, is available here:

   [7]http://www.openbsd.org/anoncvs.html.

   or check [8]The OpenBSD FAQ

   If you don't have sufficient network bandwidth to support AnonCVS, or
   if your Internet access is via UUCP, you can still keep your source
   current by using CTM instead of AnonCVS. If that's your situation,
   then starting with a recent release CD is even more important.
   Information about CTM, including how to set it up, is available here:

   [9]http://www.openbsd.org/ctm.html.

   [10][Back to Main Index] [11][To Section 2.0 - Other OpenBSD
   information resources] [12][To Section 4.0 - Installation and Disk
   Setup]
     _________________________________________________________________

   [13][back] [14]www@@openbsd.org
   $OpenBSD: faq3.html,v 1.6 1999/05/21 05:36:11 ericj Exp $

References

   1. http://www.openbsd.org/faq/index.html
   2. http://www.openbsd.org/faq/faq2.html
   3. http://www.openbsd.org/faq/faq4.html
   4. http://www.openbsd.org/orders.html
   5. http://www.openbsd.org/tshirts.html
   6. http://www.openbsd.org/ftp.html
   7. http://www.openbsd.org/anoncvs.html
   8. http://www.openbsd.org/faq/faq8.html#8.5
   9. http://www.openbsd.org/ctm.html
  10. http://www.openbsd.org/faq/index.html
  11. http://www.openbsd.org/faq/faq2.html
  12. http://www.openbsd.org/faq/faq4.html
  13. http://www.openbsd.org/faq/index.html
  14. mailto:www@@openbsd.org


   [1][Back to Main Index] [2][To Section 3.0 - Obtaining OpenBSD] [3][To
   Section 5.0 - Kernel configuration and Disk Setup]

                      4.0 - Installation and disk setup.

4.1 - Installing from the OpenBSD CD

   Installing from a CD is definatly the BEST choice, but first you must
   have purchased a cd. You can obtain a cd from
   [4]http://www.openbsd.org/orders.html. If you are using either the
   i386, SPARC or Alpha platforms you can boot directly off the CD. If
   not, you will have to create a bootdisk. You can get the boot disk
   from ftp://ftp.openbsd.org/pub/OpenBSD/2.5/$ARCH/floppy25.fs

   To create this boot disk, use either the unix tool [5]dd(1) or MSDOS
   rawrite from the tools directory on the cd. Rawrite doesnt work if you
   are an NT user, so you can also use fdimage or ntrw.exe which are both
   also in the tools directory.

   To use dd, do the following:
# dd if=floppy25.fs of=/dev/fd0a

   or to whichever device you want to write the floppy binary to.

   After that is completed, boot from your media of choice, (cdrom or
   bootdisk) and answer the questions accordingly. Here is an example
   installation.

   [6]Example Install

4.2 - Installation via FTP

   The ftp installation is almost the same as the normal installation.
   The same bootdisk will be used.

   floppy25.fs

   Just like the CD install you will set up your disk, then when you
   specify install media you choose (f)tp. You must take care to give the
   proper settings when you are asked to configure your network. Have
   handy, your ipaddress (see below for dhcp), netmask, nameserver
   addresses, and default route. Once your network is configured
   correctly, you must choose the (f)tp installation option. You will be
   asked a few simple questions about proxys and passive or active
   transfers, and the you will be presented with a list of ftp servers.
   Select the one closest to you, and your on your way.

   Consult the [7]install text for help.

4.3 - Installation via DHCP

   Installation via DHCP is the same as ftp, except your system will use
   DHCP to configure your network. When you arrive at the network config
   option, choose DHCP and your network will be setup accordingly. The
   all you have to do is follow the remainder of the directions from ftp
   install above and you will be set.

   Consult the [8]install text for help.

4.4 - What files are needed for Installation?

   There are many packages containing the OpenBSD binaries, but which
   ones do you need to get your system up and running? Here is an
   overview of each package.

     * base25.tar.gz - Has the BASE OpenBSD system *NEEDED*
     * etc25.tar.gz - Has all the files in /etc *NEEDED*
     * comp25.tar.gz - Has the compiler and its tools, libs. *STRONGLY
       SUGGESTED*
     * man25.tar.gz - Holds man pages *STRONGLY SUGGESTED*
     * misc25.tar.gz - Holds misc info, setup docs
     * game25.tar.gz - Has the Games for OpenBSD *FUN*
     * xbase25.tar.gz - Has the base install for X11
     * xfont25.tar.gz - Holds X11's font server and fonts
     * xlink25.tar.gz - Has the X servers link kit
     * xserv25.tar.gz - Has X11's X servers
     * xshare25.tar.gz - Has manpages, locale settings, includes, etc for
       X

4.5 - Using the OpenBSD disklabel

   Be sure to check the [9]disklabel(8) man page!

   Disklabel is used to identify disk's and/or partitions. The main idea
   behind them is abstraction of disk hardware, since there exists
   several partitioning tables. A disklabel is a universal partitioning
   table. These labels tell the system everything about the disk, from
   the Maker to rpm's to track-to-track seek. This label resides on the
   beginning of the disk, this isto help bootstrap code use them (since
   most ROM based booting reads the first sectors of the first disk). It
   also will show you partitions and their types on your disk. Disklabel
   can, on some systems, be used to install bootstrap code.

   As an additional gain, using disklabels helps overcome architecture
   limitations on disk partitioning. For example on i386 you can only
   have 4 primary partitions, with disklabel you can put several labels
   on one partition (eg. 'swap', '/', '/usr' and '/var'). And you still
   have 3 more partitions available for other OSs!

   You can think of them as 'subpartitions' for installation purposes.
   But they are a necesity for kernel disk access based on geometry. And
   remember to use 'b' for the swap label, and 'a' for root filesystem
   (default names in kernel).

   To just view the current disklabel for your disk just do:
   # disklabel < disk-device name >
   This will give output similar to this:
# using MBR partition 3: type A6 off 64 (0x40) size 16777152 (0xffffc0)
# /dev/rwd0c:
type: ESDI
disk:
label: TOSHIBA MK2720FC
flags:
bytes/sector: 512
sectors/track: 63
tracks/cylinder: 16
sectors/cylinder: 1008
cylinders: 2633
total sectors: 2654064
rpm: 3600
interleave: 1
trackskew: 0
cylinderskew: 0
headswitch: 0           # milliseconds
track-to-track seek: 0  # milliseconds
drivedata: 0

16 partitions:
#        size   offset    fstype   [fsize bsize   cpg]
  a:  2071440    65583    4.2BSD     1024  8192    16   # (Cyl.   65*- 2120)
  b:    65520       63      swap                        # (Cyl.    0*- 65)
  c:  2654064        0    unused        0     0         # (Cyl.    0 - 2632)
  j:   512001  2137023    4.2BSD     1024  8192    16   # (Cyl. 2120*- 2627*)

   In this example, there are 4 labels - A, B, C, J. A is one main
   partition, B is swap, and J is another partition. C in all cases
   represents the full disk. This is helpful in showing what valuses in
   size, cyl, etc you have to work with. But with this command you cannot
   change any values, you can just view.

   To be able to edit your label's interactivly you would use the -E
   flag.
   Example:
# disklabel -E wd0
# using MBR partition 3: type A6 off 64 (0x40) size 16777152 (0xffffc0)

Treating sectors 64-16777216 as the OpenBSD portion of the disk.
You can use the 'b' command to change this.

Initial label editor (enter '?' for help at any prompt)
> ?
Available commands:
        p [unit]  - print label.
        M         - show entire OpenBSD man page for disklabel.
        e         - edit drive parameters.
        a [part]  - add new partition.
        b         - set OpenBSD disk boundaries.
        c [part]  - change partition size.
        d [part]  - delete partition.
        m [part]  - modify existing partition.
        r         - recalculate free space.
        u         - undo last change.
        s [path]  - save label to file.
        w         - write label to disk.
        q         - quit and save changes.
        x         - exit without saving changes.
        ? [cmnd]  - this message or command specific help.
Numeric parameters may use suffixes to indicate units:
        'b' for bytes, 'c' for cylinders, 'k' for kilobytes, 'm' for megabytes,
        'g' for gigabytes or no suffix for sectors (usually 512 bytes).
        Non-sector units will be rounded to the nearest cylinder.
Entering '?' at most prompts will give you (simple) context sensitive help.
> p
device: /dev/rwd0c
type: ESDI
disk:
label: TOSHIBA MK2720FC
bytes/sector: 512
sectors/track: 63
tracks/cylinder: 16
sectors/cylinder: 1008
cylinders: 2633
total sectors: 2654064
free sectors: 14193711
rpm: 3600

16 partitions:
#        size   offset    fstype   [fsize bsize   cpg]
  a:  2071440    65583    4.2BSD     1024  8192    16   # (Cyl.   65*- 2120)
  b:    65520       63      swap                        # (Cyl.    0*- 65)
  c:  2654064        0    unused        0     0         # (Cyl.    0 - 2632)
  j:   512001  2137023    4.2BSD     1024  8192    16   # (Cyl. 2120*- 2627*)
> q
No changes.

   In this example we get into disklabel's interactive mode. From here we
   can issue the command "?" asking for help. This gives us many commands
   we can use to add, delete, edit existing labels.

   There is a new feature on disklabel, to help installation. The '-f'
   flag writes a 'fstab' like file, if given a mount point for a label.
   This is only used at installation.

   To see an example install involving disklabel check [10]log25.txt

4.6 - Using fdisk

   First be sure to check the fdisk main page. [11]fdisk(8)

   Fdisk is a program to help with the maintenance of your partitions.
   This program is used at install time to set up your OpenBSD partition
   (this partition can contain several labels, each with
   filesystems/swap/etc.). It can divide space on your drives and set one
   active. This program will usually be used in Single User Mode ( boot
   -s ). Fdisk also sets the MBR on your various hard disks.

   For installation purposes, most times you'll only need ONE Openbsd
   partition, and then using disklabel to put a swap and a filesystem on
   it.

   To just view your partition table using fdisk just use:
   # fdisk fd0
   Which will give an output similar to this:
         Disk: fd0       geometry: 80/2/18 [2880 sectors]
         Offset: 0       Signatures: 0xAA55,0x0
                  Starting        Ending
          #: id  cyl  hd sec -  cyl  hd sec [     start -       size]
----------------------------------------------------------------------
         *0: A6    0   0   1 -   79   1  18 [         0 -       2880] OpenBSD
          1: 00    0   0   0 -    0   0   0 [         0 -          0] unused
          2: A7    0   0   2 -   79   1  18 [         1 -       2879] NEXTSTEP
          3: 00    0   0   0 -    0   0   0 [         0 -          0] unused

   In this example we are viewing the fdisk output of floppy drive. We
   can see the OpenBSD partition (A6) and its size. The * tells us that
   the OpenBSD partition is a bootable partition.

   In the previous example we just viewed our information. What if we
   want to edit our partition table? Well, to do so we must use the -e
   flag. This will bring up a command line prompt to interact with fdisk.
# fdisk -e wd0
Enter 'help' for information
fdisk: 1> help
        help            Command help list
        manual          Show entire OpenBSD man page for fdisk
        reinit          Re-initialize loaded MBR (to defaults)
        disk            Edit current drive stats
        edit            Edit given table entry
        flag            Flag given table entry as bootable
        update          Update machine code in loaded MBR
        select          Select extended partition table entry MBR
        print           Print loaded MBR partition table
        write           Write loaded MBR to disk
        exit            Exit edit of current MBR, without saving changes
        quit            Quit edit of current MBR, saving current changes
        abort           Abort program without saving current changes
fdisk: 1>

   It is perfectly safe in fdisk to go in and explore, just make sure to
   answer N to saving the changes and *DON'T* use the write command.

   Here is an overview of the commands you can use when you choose the -e
   flag.
     * help Display a list of commands that fdisk understands in the
       interactive edit mode.
     * reinit Initialize the currently selected, in-memory copy of the
       boot block.
     * disk Display the current drive geometry that fdisk has probed. You
       are given a chance to edit it if you wish.
     * edit Edit a given table entry in the memory copy of the current
       boot block. You may edit either in BIOS geometry mode, or in
       sector offsets and sizes.
     * flag Make the given partition table entry bootable. Only one entry
       can be marked bootable. If you wish to boot from an extended
       partition, you will need to mark the partition table entry for the
       extended partition as bootable.
     * update Update the machine code in the memory copy of the currently
       selected boot block.
     * select Select and load into memory the boot block pointed to by
       the extended partition table entry in the current boot block.
     * print Print the currently selected in-memory copy of the boot
       block and its MBR table to the terminal.
     * write Write the in-memory copy of the boot block to disk. You will
       be asked to confirm this operation.
     * exit Exit the current level of fdisk, either returning to the
       previously selected in-memory copy of a boot block, or exiting the
       program if there is none.
     * quit Exit the current level of fdisk, either returning to the
       previously selected in-memory copy of a boot block, or exiting the
       program if there is none. Unlike exit it does write the modified
       block out.
     * abort Quit program without saving current changes.

4.7 - Adding new disks in OpenBSD

   Well once you get your disk installed PROPERLY you need to use
   [12]fdisk(8) and [13]disklabel(8) to set up your disk in OpenBSD.
   Making sure that the partition ID is "A6". Once you have done this,
   OpenBSD will be able to recognize the new disk, and you need to create
   the filesystem on that disk using [14]newfs(8).

   bsd# newfs wd1a

   or so on using OpenBSD's disk numbering scheme
wd0
wd1
wd2

   Edit fstab to mount the new disk at a mount point of your choice, and
   reboot.

   If you need to migrate an existing directory like /usr/bin. You should
   mount the new drive in /mnt and use cpio -pdum to copy /usr/bin to the
   /mnt directory. Edit the /etc/fstab file to show that /usr/bin will be
   mounted on the new drive. example:
   /dev/wd1a /usr/bin ffs rw 1 1

   Reboot into single user mode..boot -s Move the existing /usr/bin to
   /usr/bin-backup and create an empty /usr/bin. Then reboot the system,
   and whala!! the files are there!

4.8 - How do I swap to a file?

   With OpenBSD 2.5 came the introduction of [15]swapctl(8), which made
   dealing with swap devices much easier. Swapping to a file doesn't
   require a custom built kernel, But that can still be done, this faq
   will show you how to add swap space both ways.

   To swap to a file permanently, first make a kernel with vnd0c as swap.
   If you have wd0a as root filesystem, wd0b is the previous swap, use
   this line in the kernel configuration file (refer to compiling a new
   kernel if in doubt):
config          bsd     root on wd0a swap on wd0b and vnd0c dumps on wd0b

   Second make the file for swap. If you want a 32MB swapfile named
   /newswap do:
   # dd if=/dev/zero of=/newswap bs=1k count=32768

   Add a line to your /etc/fstab file to indicate where the new swap will
   be.
   /dev/vnd0c none sw 0 0

   Now boot with the new kernel. Then create the vnd0 device to use that
   file as a device:
   # vnconfig -c -v vnd0 /newswap

   And add it now to swap:
   # swapon /dev/vnd0c

   You can now see if it is working with:
   # pstat -s

4.9 - Softupdates

   Softupdates are experimental and are NOT recomended for regular users.

   Over the last few years Krik McKusick has been working on something
   called "soft updates". This is based on an idea proposed by Greg
   Ganger and Yale Patt that imposing a partial ordering on the buffer
   cache opertions would permit the requirement for synchronous writing
   of directory entries to be removed from the FFS code. Thus, a large
   performance increase of disk writing performance.

   To enable Softupdates your kernel must have option

   option FFS_SOFTUPDATES

   then you need to boot into single-user mode:
        boot>boot -s
        [snip]
        bsd# tunefs -s enable <raw device>
        bsd# reboot -n

   GOOD LUCK. Please direct all problem reports with as MUCH information
   as possible (kernel coredumps, tracebacks, etc) to [16]Costa. Do not
   waste his time with any other questions or incomplete problem reports.

4.10 - How much space do I need for an OpenBSD installation?

   The following are suggested sub-tree sizes for a full system install.
   The numbers include enough extra space to permit you to run a typical
   home system that is connected to the internet:
SYSTEM          /       /usr    /var    /usr/X11R6
alpha           56M     540M    27M     161M
amiga           45M     399M    24M      36M
arc             47M     268M    20M      60M
hp300           31M     234M    24M      47M
i386            35M     229M    24M      72M
mac68k          29M     232M    24M      36M
mvme68k         48M     448M    24M       -  (no Xserver)
pmax            50M     355M    24M      60M
sparc           40M     259M    24M      49M
powerpc         39M     423M    26M     124M

   When you are in the disklabel editor, you may choose to make your
   entire system have just an 'a' and 'b' partition. The 'a' partition
   you set up in disklabel will become your root partition, which should
   be the sum of all the 3 main values above (/, /usr, and /var) plus
   some space for /tmp. The 'b' partition you set up automatically
   becomes your system swap partition -- we recommend a minimum of 32MB
   but if you have disk to spare make it at least 64MB.

   However, we recommend you use many seperate partitions so that users
   cannot fill up your important partitions as easily, thus causing nasty
   denial of service problems. If you are extra cautious, you will make
   at least the following seperate partitions: / swap /usr /var /tmp
   /var/tmp /home.

4.11 - How do I get rid of in "partition 3 id 0" error on boot?

   This means that your MBR (Master Boot Record) was not installed
   properly or that your BIOS is not compatible with your current MBR. To
   solve this first try to reinstall the OpenBSD boot blocks. To do so
   use [17]intsallboot(8). For example, the most common usage is:

     * Boot from the OpenBSD bootdisk

     * # fsck /dev/rwd0a && mount /dev/wd0a /mnt
     * # cp /usr/mdec/boot /mnt/boot
     * # /usr/mdec/installboot -v /mnt/boot /usr/mdec/biosboot wd0

     Here substitute your disk devices for rwd0a & wd0a. This will
   install the boot blocks again.

     Then Reboot.

   If this doesn't work you still have a few more options. So, luck
   hasn't run out yet. The first is to use a bootloader such as OS-BS.
   The OpenBSD cd has the os-bs bootloader included in the tools
   directory. If you didn't purchase a CD-ROM, you can download os-bs
   from any of the OpenBSD ftp sites.

   pub/OpenBSD/2.5/tools/osbs135.exe

   and take some time to look through the web pages at
   [18]http://www.prz.tu-berlin.de/~wolf/os-bs.html

   There are also other commercial bootloaders or lilo that you can use
   for multi-booting.

   Here is a simple outline of how to get lilo onto your system.

     * Boot a DOS floppy and do a fdisk /MBR. Make sure you do that on
       the drive you'll be booting from.
     * Boot from a linux disk and install LILO & chain it to your OpenBSD
       boot block.

   For further instructions read [19]INSTALL.linux

4.12 - How do I get a dmesg from a boot floppy?

   RAMDISK images (boot floppies) do not ship with the dmesg utility.
   They do, however, have the /kern filesystem mounted. To copy the dmesg
   information to a file, do a:
# cat /kern/msgbuf >mydmesg

4.13 - Installing bootblocks (i386 specific)

   PC BIOS's can only deal with disk geometries with 1024 cylinders or
   less. Since most disks these days have more than 1024 cylinders, most
   PC scsi controllers "translate" the real disk geometry into something
   that fits within the BIOS's parameters. However, not all scsi
   controllers "translate" the geometry in the same way. If you change
   scsi controllers and they use a different "translated" geometry you
   will be unable to load the second stage boot loader (and thus unable
   to load the kernel) because the first stage boot loader contains a
   list of the blocks that comprise /boot in terms of the "translated"
   geometry. To fix this, just boot from a boot floppy and at the boot
   prompt, type "b hd0a:/bsd" to boot from the first hard disk (and not
   the floppy). Your machine should come up normally. You now need to
   update the first stage boot loader (aka the boot block). This is also
   the same way to for any disk device, ide disks and scsi disks in
   OpenBSD.
   To do this, assuming your boot disk is sd0:
cd /usr/mdec; ./installboot /boot biosboot sd0

4.14 - Multibooting OpenBSD

   OpenBSD & NT

   To multiboot OpenBSD and NT, you can use NTloader. The bootloader the
   NT uses. To multi-boot with NT, you need a copy of your OpenBSD pbr.
   After running installboot, you can copy it something like this:
        # dd if=/dev/rsd0a of=openbsd.pbr count=1

   Now boot NT and put openbsd.pbr in c:. Add a line like this to the end
   of c:\boot.ini:
        c:\openbsd.pbr="OpenBSD"

   When you reboot, you should be able to select OpenBSD from the NT
   loader menu. There is much more information available about NTloader
   at the [20]NTLDR Hacking Guide.

   OpenBSD & Windows or DOS

   To boot OpenBSD along with Windows 3.1, Windows95, or DOS you must
   simply put a boot loader on the system that can handle these OS's.
   Some bootloaders of choice are [21]osbs20b8.zip or [22]The Ranish
   Partition Manager. Both of these are known to be able to boot OpenBSD
   partitions.

   OpenBSD & Linux

   Please refer to [23]INSTALL.linux, which gives indepth instructions on
   getting OpenBSD working with Linux.

   [24][Back to Main Index] [25][To Section 3.0 - Obtaining OpenBSD]
   [26][To Section 5.0 - Kernel configuration and Disk Setup]
     _________________________________________________________________

   [27][back] [28]www@@openbsd.org
   $OpenBSD: faq4.html,v 1.38 1999/06/25 19:16:29 ericj Exp $

References

   1. http://www.openbsd.org/faq/index.html
   2. http://www.openbsd.org/faq/faq3.html
   3. http://www.openbsd.org/faq/faq5.html
   4. http://www.openbsd.org/orders.html
   5. http://www.openbsd.org/cgi-bin/man.cgi?query=dd&apropos=0&sektion=1&format=html
   6. http://www.openbsd.org/faq/log25.txt
   7. http://www.openbsd.org/faq/log25.txt
   8. http://www.openbsd.org/faq/log25.txt
   9. http://www.openbsd.org/cgi-bin/man.cgi?query=disklabel&sektion=8&format=html
  10. http://www.openbsd.org/faq/log25.txt
  11. http://www.openbsd.org/cgi-bin/man.cgi?query=fdisk&apropos=0&sektion=8&format=html
  12. http://www.openbsd.org/cgi-bin/man.cgi?query=fdisk&apropos=0&sektion=8&format=html
  13. http://www.openbsd.org/cgi-bin/man.cgi?query=disklabel&apropos=0&sektion=8&format=html
  14. http://www.openbsd.org/cgi-bin/man.cgi?query=newfs&apropos=0&sektion=8&format=html
  15. http://www.openbsd.org/cgi-bin/man.cgi?query=swapctl&sektion=8&format=html
  16. mailto:csapuntz@@openbsd.org
  17. http://www.openbsd.org/cgi-bin/man.cgi?query=installboot&sektion=8&format=html
  18. http://www.prz.tu-berlin.de/~wolf/os-bs.html
  19. http://www.openbsd.org/faq/INSTALL.linux
  20. http://www.dorsai.org/~dcl/publications/NTLDR_Hacking/
  21. http://www.freebird.org/sw-map/bootmanager.html
  22. http://www.users.intercom.com/~ranish/part/
  23. http://www.openbsd.org/faq/INSTALL.linux
  24. http://www.openbsd.org/faq/index.html
  25. http://www.openbsd.org/faq/faq3.html
  26. http://www.openbsd.org/faq/faq5.html
  27. http://www.openbsd.org/faq/index.html
  28. mailto:www@@openbsd.org


   [1][Back to Main Index] [2][To Section 4.0 - Installation and Disk
   Setup] [3][To Section 6.0 - Networking]

                   5.0 - Kernel Configuration and Disk Setup

5.1 - Why would I want to create my own custom kernel?

   It is a joyous occasion when you as a user get to configure and build
   your own custom kernel. Why would you want to do this though?

     * You can define which drivers your computer has support for.
     * You can get rid of uneeded drivers in the GENERIC kernel
     * Speed up boot times
     * Remove default options or add options which may not have been
       enabled by default

5.2 - Kernel Configuration Options

   Kernel Configuration Options are options that you add to your kernel
   configuration that place certain features into your kernel. This
   allows you to have exactly the support you want, without having
   support for uneeded devices. There are multitudes of options that
   allow you to customize you kernel. Here we will go over only some of
   them, one's that are most commonly used. Check the [4]options(4) man
   page for a more complete list of options. You can also check the
   example configuration files that are availible for your architecture.

   Not all kernel options have been tested for compatibility with all
   other options. Don't put an option in your kernel unless you actually
   have a reason to do so! The one kernel configuration which gets the
   most testing is the GENERIC kernel. This is usually a combination of
   the options in /usr/src/sys/arch//conf/GENERIC and
   /usr/src/sys/conf/GENERIC.

     * [5]Alpha Kernel Conf Files
     * [6]i386 Kernel Configuration files
     * [7]mac68k Kernel Configuration files
     * [8]pmax Kernel Configuration Files
     * [9]sparc Kernel Configuration Files
     * [10]Other Arch's

   Look closely at these files and you will notice a line like:
   include "../../../conf/GENERIC"
   This means that it *IS* referencing yet another configuration file.
   This file stores non arch-dependent options. So when creating your
   Kernel Config be sure to look through [11]/sys/conf/GENERIC and see
   what you want. There ARE options in there that are NEEDED.

   All of the options listed below should be placed in your kernel
   configuration file in the format of:
   option OPTION
   for example. To place option debug in the kernel, add a line like
   this:
   option DEBUG
   Options in the OpenBSD kernel are translated into compiler
   preprocessor options, therefore an option like DEBUG would have the
   source compiled with option -DDEBUG. Which is equivalent to doing a
   #define DEBUG throughout the kernel.

   OpenBSD has a great many compatibility options which allow you to use
   binaries from other OS's. Not all are availibly on every
   architechture, so be sure to read the man pages for each option to see
   if your arch is supported.

     * [12]COMPAT_SVR4(8) - Compatibility with SVR4 binaries.
     * [13]COMPAT_BSDOS(8) - Compatibility with BSD/OS binaries.
     * [14]COMPAT_LINUX(8) - Compatibility with Linux binaries.
     * [15]COMPAT_SUNOS(8) - Compatibility with SunOS binaries.
     * [16]COMPAT_ULTRIX(8) - Compatibility with Ultrix binaries.
     * [17]COMPAT_FREEBSD(8) - Compatibility with FreeBSD binaries.
     * COMPAT_HPUX - Compatibility with HP-UX binaries. Only availible on
       some m68k arch's.
     * [18]COMPAT_IBCS2(8) - Compatibility to run ibcs2 binaries.
     * COMPAT_OSF1 - Run Digital Unix binaries. Availible only on Alpha
       platform.
     * COMPAT_43 - Compatibility with 4.3BSD. Use of this is certainly
       discouraged, But it is needed for our Navigator port
     * COMPAT_11 - Compatibility with NetBSD 1.1
     * COMPAT_NOMID - Compatibility with a.out executables that lack a
       machine id.

   It is always helpful to be able to debug problems with the kernel. But
   many choose not to put these options in their kernel because these
   options add considerable size to the kernel. There are however
   extremely helpful in a case where a bug might be present. This well
   help your or developers discover the source of your problems much
   quicker. Here is a list of popular debugging options that can be added
   to your kernel.

     * [19]DDB - This compiles in the in-kernel debugger. This isn't
       availible on all platforms. So be sure to read before adding it.
     * [20]KGDB - Compiles a remote kernel debugger using gdb's `remote
       target` feature.
     * makeoptions DEBUG="-g" - Makes bsd.gdb along with bsd. This is
       useful for debugging crash dumps with gdb. NOTE: This option also
       turns on option DEBUG
     * DEBUG - Used to put various debugging options in the kernel, where
       the source has defined them.
     * KTRACE - Adds hooks for the system call tracing facility. Which
       allows users to use [21]ktrace(1).
     * DIAGNOSTIC - Adds code to the kernel that does internal
       consistency checks.
     * GPROF - adds code to the kernel for kernel profiling with
       [22]kgmon(8).
     * makeoptions PROF="-pg" - The -pg flag causes the kernel to be
       compiled with support for profiling. Option GPROF is required to
       use this option.

   Filesystem Options.
     * FFS - Berkeley Fast Filesystem NOTE: This option is required
     * EXT2FS - Second Extended File System, This is needed for those of
       you who want to read Linux partitions.
     * MFS - Memory File System that stores files in swapable memory.
       This is not quite stable as of now.
     * NFS - Network File System, This is needed if you will be using
       NFS.
     * CD9660 - This is iso9660 + rockridge filesystem. This is required
       to read from cd's
     * MSDOSFS - Needed to read MS-DOS FAT filesystems. Also has support
       for Windows 95 long name + mixed case extensions.
     * FDESC - Includes code for a file system which can be mounted on
       /dev/fd
     * KERNFS - Includes code which permits the mounting of a special
       file system (normally mounted on /kern) in which files
       representing various kernel variables and parameters may be found.
     * NULLFS - Code to have a loopback filesystem. [23]mount_null(8) has
       more information
     * PROCFS - Includes code for a special file system (conventionally
       mounted on /proc)
     * PORTAL - Includes the (experimental) portal filesystem. This
       permits interesting tricks like opening TCP sockets by opening
       files in the file system.
     * UMAPFS - Includes a loopback file system in which user and group
       ids may be remapped -- this can be useful when mounting alien file
       systems with different uids and gids than the local system (eg,
       remote NFS).
     * UNION - Includes code for the union file system, which permits
       directories to be mounted on top of each other in such a way that
       both file systems remain visible. This code isnt quite stable yet.
     * XFS - Add hooks for using a filesystem that is compatible with the
       AFS filesystem. Currently used by the Arla/AFS code.
     * LFS - Log Structured Filesystem.
     * FFS_SOFTUPDATES - Allows for the use of softupdates. To read up on
       softupdates more read the [24]Softupdates FAQ section.
     * NFSSERVER - Allow for the server-side NFS code to be included in
       the kernel.
     * NFSCLIENT - Allow for the client-side NFS code to be included in
       the kernel.
     * FIFO - Support for FIFO's.. RECOMMENDED.
     * NVNODE=integer - Where integer is the size of the cache used by
       the name-to-inode translation routines, (a.k.a. the namei() cache,
       though called by many other names in the kernel source).
     * EXT2FS_SYSTEM_FLAG - This option changes the behavior of the
       APPEND and IMMUTABLE flags for a file on an EXT2FS filesystem.
       Read [25]options(4) for more details.
     * QUOTA - Support for Filesystem Quota's. To read up on using quotas
       read [26]FAQ 10

   Misc. Options
     * PCIVERBOSE - Make the boot process more verbose for PCI
       peripherals.
     * EISAVERBOSE - Make the boot process more verbose for EISA
       peripherals.
     * PCMCIAVERBOSE - Make the boot process more verbose for PCMCIA
       peripherals.
     * APERTURE - Provide in-kernel support for VGA framebuffer mapping
       by user processes. Needed to run X.
     * XSERVER - Support for the X server console driver. Needed for X.
     * LKM - Support for Loadable Kernel Modules. Not availible on all
       arch's. Read [27]lkm(4) for more information.
     * INSECURE - Hardwires the kernel security level to -1. Read
       [28]init(8) for more information on kernel security levels.
     * MACHINE_NONCONTIG - Changes part of the VM/pmap interface, to
       allow for non-contiguous memory.
     * RAM_DISK_HOOKS - Allows for machine dependent functions to be
       called when the ramdisk driver is configured.
     * RAM_DISK_IS_ROOT - Forces the ramdisk to be root.
     * CCDNBUF=integer - Set number of component buffers used by CCD(4).
       Default is 8. For more on CCD read the [29]CCD(4) man page, or the
       [30]Performance Tuning FAQ section.
     * KMEMSTATS - This makes malloc(9), the kernel memory allocator keep
       statistics on its use. If option DEBUG is used, this option is
       automatically turned off by config.
     * BOOT_CONFIG - Addeds support of the -c boot option.

   Networking Options
   Also check the [31]Networking FAQ or the [32]Networking Performance
   Tuning FAQ.
     * GATEWAY - Enables IPFORWARDING and (on most ports) increases the
       size of NMBCLUSTERS.
     * NMBCLUSTERS=integer - Controls the size mbuf cluster map.
     * IPFORWARDING - Enables IP routing behavior. With this option
       enabled, the machine will forward IP datagrams between its
       interfaces that are destined for other machines.
     * MROUTING - Includes support for IP multicast routers.
     * INET - Includes support for the TCP/IP protocol stack. This option
       is REQUIRED
     * MCLSHIFT=value - This option is the base-2 logarithm of the size
       of mbuf clusters. Read [33]options(4) for more information on this
       option.
     * NS - Include support for the Xerox XNS protocol stack. See
       [34]ns(4)
     * ISO,TPIP - Include support for the ubiquitous OSI protocol stack.
       See [35]iso(4) for more information.
     * EON - Include support for OSI tunneling over IP.
     * CCITT,LLC,HDLC - Include support for the X.25 protocol stack.
     * IPX, IPXIP - Include support for Internetwork Packet Exchange
       protocol commonly in use by Novell NetWare.
     * NETATALK - Include kernel support for the AppleTalk family of
       protocols.
     * TCP_COMPAT_42 - Use of this option is extremely discouraged, so it
       should not be enabled. TCP bug compatibility with 4.2BSD. In
       4.2BSD, TCP sequence numbers were 32-bit signed values. Modern
       implementations of TCP use unsigned values.
     * TCP_NEWRENO - Turns on NewReno fast recovery phase, which allows
       one lost segment to be recovered per round trip time.
     * TCP_SACK - Turns on selective acknowledgements.
     * TCP_FACK - Turns on forward acknowledgements allowing a more
       precise estimate of outstanding data during the fast recovery
       phase by using SACK information. This option can be used together
       with TCP_SACK.
     * IPFILTER - This option enables the IP filtering on the packet
       level using the ipfilter package.
     * IPFILTER_LOG - This option, in conjunction with IPFILTER, enables
       logging of IP packets using ip-filter.
     * IPFILTER_DEFAULT_BLOCK - This option sets the default policy of
       ip-filter. If it is set, ip-filter will block packets by default.
     * PPP_FILTER - This option turns on [36]pcap(3) based filtering for
       ppp connections.
     * PPP_BSDCOMP - PPP BSD compression.
     * PPP_DEFLATE - Used in conjunction with PPP_BSDCOMP.
     * IPSEC - This option enables IP security protocol support. See
       [37]ipsec(4) for more details
     * ENCDEBUG - This option enables debugging information to be
       conditionally logged incase IPSEC encounters errors.

   PCVT Options (only valid on i386 architecture)
     * PCVT_NSCREENS=integer - Number of pcvt screens. Defaults to 8.
     * PCVT_VT220KEYB - If activated, a keyboard layout resembling a DEC
       VT200 (TM) is generated.
     * PCVT_SCREENSAVER - Enables the builtin screensaver feature.
       Defaults to on.
     * PCVT_PRETTYSCRNS - If enabled, a blinking-star screensaver is
       used. Default is off.
     * PCVT_CTRL_ALT_DEL - If enabled, the key combination < Ctrl> < Alt>
       < Del> invokes a CPU reset. Default is off.
     * PCVT_USEKBDSEC - Do NOT override a security lock for the keyboard.
       Default is on.
     * PCVT_24LINESDEF - If enabled, the 25-line modi (VT emulation with
       25 lines, and HP emulation with 28 lines) default to 24 lines only
       to provide a better compatibility to the original DEV VT220 (TM).
     * PCVT_EMU_MOUSE - Emulate a three-button mouse via the keypad.
       Useful for notebooks when running XFree86. Defaults to off
     * PCVT_META_ESC - If enabled, a sequence composed of < esc >,
       followed by the normalkey code is emitted if a key is pressed with
       the < Alt > key modifier. If disabled, then normal key code with
       the value 0x80 added is sent. Defaults to off.

   SCSI Subsystem Options
     * SCSITERSE - Terser SCSI error messages. This omits the table for
       decoding ASC/ASCQ info, saving about 8 bytes or so.
     * SCSIDEBUG - Prints extra debugging info for the SCSI subsystem to
       the console.

5.3 - Building your own kernel

   Full instructions for creating your own custom kernel are in the
   [38]afterboot(8) man page.

   To compile your kernel from the cdrom do the following:

#cd /somewhere
#cp /usr/src/sys/arch/$ARCH/conf/SOMEFILE .
#vi SOMEFILE (to make the changes you want)
#config -s /usr/src/sys -b . SOMEFILE
#make

   To compile a kernel inside a writeable source tree do the following:

#cd /sys/arch/$ARCH/conf
#vi SOMEFILE (to make any changes you want)
#config SOMEFILE (read more about it here : [39]config(8))
#cd ../compile/SOMEFILE
#make

   Where $ARCH is the architecture you are using (e.g. i386). You can
   also do a make depend to make the dependencies for the next time you
   compile your kernel.

   To move your kernel into place.

#cp /bsd /bsd.old
#cp /sys/arch/$ARCH/compile/SOMEFILE/bsd /bsd

   To revert to your old kernel at boot you need to just

boot>bsd.old

   and your old kernel will be loaded instead of /bsd.

5.4 - Boot Time Configuration

   Sometimes when booting your system you might notice that the kernel
   finds your device but maybe at the wrong IRQ. And maybe you need to
   use this device right away. Well, without rebuilding the kernel you
   can use OpenBSD's boot time kernel configuration. This will only
   correct your problem for one time. If you reboot, you will have to
   repeat this procedure. So, this is only meant as a temporary fix, and
   you should correct the problem by fixing and recompiling your kernel.
   Your kernel does however need option BOOT_CONFIG in the kernel, which
   GENERIC does have.

   Most of this document can be found in the man page [40]boot_config(8)
   To boot into the User Kernel Config, or UKC, at boot time us the -c
   option.

Boot> boot wd0a:/bsd -c

   Or whichever kernel it is you want to boot. Doing this will bring up a
   UKC prompt. From here you can issue commands directly to the kernel
   specifying devices you want to change or disable or even enable.

   Here is a list of common commands in the UKC.

   add device - Add a device through copying another

   change devno | device - Modify one or more devices

   disable devno | device - Disable one or more devices

   enable devno | device - Enable one or more devices

   find devno | device - Find one or more devices

   help - Short summary of these commands

   list - List ALL known devices

   exit/quit - Continue Booting

   show [attr [val]] - Show devices with an attribute and optional with a
   specified value

   Once you get your device configured, use quit or exit and continue
   booting. After so you should correct your Kernel configuration and
   Compile a new kernel. Refer to [41]Building your own kernel for help.

   [42][Back to Main Index] [43][To Section 4.0 - Installation and Disk
   Setup] [44][To Section 6.0 - Networking]
     _________________________________________________________________

   [45][back] [46]www@@openbsd.org
   $OpenBSD: faq5.html,v 1.21 1999/06/27 21:32:23 ericj Exp $

References

   1. http://www.openbsd.org/faq/index.html
   2. http://www.openbsd.org/faq/faq4.html
   3. http://www.openbsd.org/faq/faq6.html
   4. http://www.openbsd.org/cgi-bin/man.cgi?query=options&apropos=0&sektion=4&format=html
   5. http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/alpha/conf/
   6. http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/i386/conf/
   7. http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/mac68k/conf/
   8. http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/pmax/conf/
   9. http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/sparc/conf/
  10. http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/
  11. http://www.openbsd.org/cgi-bin/cvsweb/src/sys/conf/GENERIC
  12. http://www.openbsd.org/cgi-bin/man.cgi?query=compat_svr4&sektion=8&apropos=0&manpath=OpenBSD+Current
  13. http://www.openbsd.org/cgi-bin/man.cgi?query=compat_bsdos&sektion=8&apropos=0&manpath=OpenBSD+Current
  14. http://www.openbsd.org/cgi-bin/man.cgi?query=compat_linux&sektion=8&apropos=0&manpath=OpenBSD+Current
  15. http://www.openbsd.org/cgi-bin/man.cgi?query=compat_sunos&sektion=8&apropos=0&manpath=OpenBSD+Current
  16. http://www.openbsd.org/cgi-bin/man.cgi?query=compat_ultrix&sektion=8&apropos=0&manpath=OpenBSD+Current
  17. http://www.openbsd.org/cgi-bin/man.cgi?query=compat_freebsd&sektion=8&apropos=0&manpath=OpenBSD+Current
  18. http://www.openbsd.org/cgi-bin/man.cgi?query=compat_ibcs2&sektion=8&apropos=0&manpath=OpenBSD+Current
  19. http://www.openbsd.org/cgi-bin/man.cgi?query=ddb&sektion=4&format=html
  20. http://www.openbsd.org/cgi-bin/man.cgi?query=gdb&sektion=1&format=html
  21. http://www.openbsd.org/cgi-bin/man.cgi?query=ktrace&sektion=1&format=html
  22. http://www.openbsd.org/cgi-bin/man.cgi?query=kgmon&sektion=8&format=html
  23. http://www.openbsd.org/cgi-bin/man.cgi?query=mount_null&sektion=8&format=html
  24. http://www.openbsd.org/faq/faq4.html#4.9
  25. http://www.openbsd.org/cgi-bin/man.cgi?query=options&sektion=4&format=html
  26. http://www.openbsd.org/faq/faq10.html#10.10
  27. http://www.openbsd.org/cgi-bin/man.cgi?query=lkm&sektion=4&format=html
  28. http://www.openbsd.org/cgi-bin/man.cgi?query=init&sektion=8&format=html
  29. http://www.openbsd.org/cgi-bin/man.cgi?query=ccd&sektion=4&format=html
  30. http://www.openbsd.org/faq/faq12.html#12.2
  31. http://www.openbsd.org/faq/faq6.html
  32. http://www.openbsd.org/faq/faq12.html#12.1
  33. http://www.openbsd.org/cgi-bin/man.cgi?query=options&sektion=4&format=html
  34. http://www.openbsd.org/cgi-bin/man.cgi?query=ns&sektion=4&apropos=0&manpath=OpenBSD+Current
  35. http://www.openbsd.org/cgi-bin/man.cgi?query=iso&sektion=4&format=html
  36. http://www.openbsd.org/cgi-bin/man.cgi?query=pcap&sektion=3&format=html
  37. http://www.openbsd.org/cgi-bin/man.cgi?query=ipsec&sektion=4&format=html
  38. http://www.openbsd.org/cgi-bin/man.cgi?query=afterboot&apropos=0&sektion=8&format=html
  39. http://www.openbsd.org/cgi-bin/man.cgi?query=config&apropos=0&sektion=8&format=html
  40. http://www.openbsd.org/cgi-bin/man.cgi?query=boot_config&apropos=0&sektion=8&format=html
  41. http://www.openbsd.org/faq/faq5.html#5.3
  42. http://www.openbsd.org/faq/index.html
  43. http://www.openbsd.org/faq/faq4.html
  44. http://www.openbsd.org/faq/faq6.html
  45. http://www.openbsd.org/faq/index.html
  46. mailto:www@@openbsd.org


   [1][Back to Main Index] [2][To Section 5.0 - Kernel configuration and
   Disk Setup] [3][To Section 7.0 - Keyboard controls]

                               6.0 - Networking
     _________________________________________________________________

6.1 - Initial Network Setup

  Interfaces

   Here we assume you have all your network interfaces working, and a
   basic TCP/IP knowledge. If not, go to the [4]Kernel Configuration and
   Setup section, and/or read a nice intro to TCP/IP. Other recommended
   reading are the [5]ifconfig(8) and [6]netstat(1) man pages.

   All your interfaces should be listed with:

# ifconfig -a

lo0: flags=8009<UP,LOOPBACK,MULTICAST>
        inet 127.0.0.1 netmask 0xff000000
lo1: flags=8008<LOOPBACK,MULTICAST>
xl0: flags=8843<UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST>
        media: Ethernet 100baseTX half-duplex
        inet 10.1.1.1 netmask 0xffffff00 broadcast 10.1.1.255
sl0: flags=c010<POINTOPOINT,LINK2,MULTICAST>
        inet 10.1.1.1 netmask 0xffffff00 broadcast 10.1.1.255
sl0: flags=c010<POINTOPOINT,LINK2,MULTICAST>
sl1: flags=c010<POINTOPOINT,LINK2,MULTICAST>
ppp0: flags=8010<POINTOPOINT,MULTICAST>
ppp1: flags=8010<POINTOPOINT,MULTICAST>
tun0: flags=10<POINTOPOINT>
tun1: flags=10<POINTOPOINT>
enc0: flags=8<LOOPBACK>

   First there is lo0 the loopback interface. It MUST have the assigned
   address of 127.0.0.1 no matter what network setup you use. The next
   important one is xl0 in this example (could be neX or epX depending on
   the brand), which is a board itself. Look it has UP and RUNNING flags
   on, as lo0 but no other interface have them. That means oviously they
   are working. Your interface could be down if you never configured it,
   and look like the other interfaces. The others are not part of this
   section, as sl and ppp are for serial line comunication, tun is a
   pseudo-device for tunneling and enc a pseudo-device for encryption.

   If xl0 was uninitialized, you can assign it an address creating a
   ascii file /etc/hostname.xl0 having a string like this:

inet mona 255.255.255.0 NONE

   This hostname 'mona' needs to have record in /etc/hosts:

10.1.1.1        mona    mona.openbsd.org.ar

   What actually happens when you boot is that it looks up 'mona' in
   /etc/hosts, and then configures the interface to 10.1.1.1. If you have
   multiple ethernet interfaces, this is probably a painful way to do
   things, and so you can also put the number right in /etc/hostname.xl0:
inet 10.1.1.1 255.255.255.0 NONE

   Now check that you have a file /etc/myname and a file /etc/mygate. If
   you don't have them, you need to create them. If your gateway is a
   machine named "wintermute" wich is also in the /etc/hosts, use this
   commands:

# echo "mona" > /etc/myname
# echo "wintermute" > /etc/mygate

   Ok, you are done for a standalone system, but to activate your
   configuration now (without rebooting) do:

# sh /etc/netstart

   This will give you a few errors, but don't worry as all them are
   concerning 127.0.0.x (loopback)

   Note: if you want to use the system as a gateway, later there's a
   "Firewall Setup" section, but you need to read all this first.

   Now check your routes are ok (here we use -n to make it simpler to
   look at):

# netstat -rn
Routing tables

Internet:
Destination        Gateway            Flags     Refs     Use    Mtu
Interface
default            10.1.1.254         UGS         0        0      -  xl0
10.1.1/24          link#1             UC          0        0      -  xl0
10.1.1.1           127.0.0.1          UGHS        0        0      -  lo0
10.1.1.254         link#1             UHL         1        0      -  xl0
127/8              127.0.0.1          UGRS        0        0      -  lo0
127.0.0.1          127.0.0.1          UH          3       24      -  lo0
224/8              link#1             UCS         0        0      -  xl0

Encap:
Source address/netmask          Port  Destination address/netmask     Port Prot
o SA(Address/SPI/Proto)

   (The default gateway here is 10.1.1.254)

  IP Aliasing

   If you want to map more than one IP address on a single network
   interface, you need to assign an "alias" to it. The way to do it on
   OpenBSD is simply assigning the interface another IP with the "alias"
   option like this:

# ifconfig xl0 alias 10.1.1.2 netmask 255.255.255.255

   Here ne2 is assigned another IP number (remember it already has
   10.1.1.1). Note the netmask used! Don't use 255.255.255.0 in this kind
   of cases (both numbers are on the same subnet), only ONE address
   should handle the subnet. If you do such kind of misconfiguration, the
   following error appears:

ifconfig:SIOCAIFADDR: File exists

   Now let's change the configuration file for this, /etc/ifaliases. Add
   to it this line:

xl0   10.1.1.2 255.255.255.255

   This means, simply, interface xl0 should have an alias 10.1.1.2 with
   the netmask 255.255.255.255.

  DNS Client Setup

   Let's assume your DNS servers are 125.2.3.4 and 125.2.3.5, and your
   machine name belongs to the domain yourdomain.com. You should have the
   following lines to your /etc/resolv.conf file:

domain yourdomain.com
nameserver 125.2.3.4
nameserver 125.2.3.5

  Gateway Setup

   This is the basic information you need to set up your OpenBSD box as a
   gateway (also called a router.) If you are using OpenBSD as a router
   on the Internet, we suggest that you also read the IP Filter setup
   instructions below to block potentially malicious traffic. Also, due
   to the low availability of IPv4 addresses from network service
   providers and regional registries, you may want to look at Network
   Address Translation (next section of this document) for information on
   conserving your IP address space.

   If you want your OpenBSD machine to act as a dedicated router, and you
   are building a custom kernel configuration for it, you can either
   compile your kernel with options IPFORWARDING or GATEWAY. (See
   [7]section 12 for further information on tuning NMBCLUSTERS if you are
   doing this.) For the rest of us, OpenBSD now has a sysctl mechanism to
   turn on and off IP Forwarding at boot. If you want it to "forward" any
   packets between your interfaces, modify the /etc/sysctl.conf line that
   toggles the forwarding variable on bootup:

net.inet.ip.forwarding=1

   To make the changes without booting:

# sysctl -w net.inet.ip.forwarding=1
net.inet.ip.forwarding: 0 -> 1

   Now modify the routes on the other hosts on both sides. There are many
   possible uses of OpenBSD as a router, using software such as
   [8]routed(8), [9]gated, [10]mrtd, and [11]zebra. OpenBSD has support
   in the ports collection for both gated and mrtd. OpenBSD supports
   several T1, HSSI, ATM, FDDI, Ethernet, and serial (PPP/SLIP)
   interfaces.

6.2 - IP Filter - ipf and ipnat setup

   The IP Filter package was created to handle with two tasks, dealing
   with packet level forwarding permissions [12]ipf(8) and mapping
   hosts/subnets to a range of external addresses [13]ipnat(8). The
   configuration files for these two services are /etc/ipf.rules and
   /etc/ipnat.rules.

   You need to edit /etc/rc.conf to activate them at boot time. You also
   need to have net.inet.ip.forwarding=1 in your /etc/sysctl.conf (or
   your kernel needs to have IPFORWARDING or GATEWAY options turned on.)
   You also need a kernel compiled with option IPFILTER and IPFILTER_LOG
   (the GENERIC kernels do have these options).

   If you have IP Filter compiled in to your kernel, but you don't have
   it turned on in your /etc/rc.conf file, you can still activate it
   easily.
# ipf -Fa -f /etc/ipf.rules -E
# ipnat -CF -f /etc/ipnat.rules

   The -E flag on ipf 'enables' IP Filter. -Fa clears out any rules that
   you may have in there. -f /etc/ipf.rules loads the rules from
   /etc/ipf.rules.

   If you make changes to /etc/ipf.rules after ipf is loaded, you can
   reload your rules pretty easily!
# ipf -Fa -f /etc/ipf.rules

   Same for ipnat...
# ipnat -CF -f /etc/ipnat.rules

   This document will cover some basic ipf and ipnat configurations
   below. There are a lot of nice examples in /usr/share/ipf/ for ipnat
   and ipf. We recommend you to choose the one closer to what you want,
   and modify it to fit your needs. You can find other IP Filter
   information at the IP Filter [14]mailing list archive, the [15]IP
   Filter web site, and finally the [16]the IP Filter HOWTO.

  IPF

   Modify rc.conf so it has IPFILTER=YES. The file /etc/ipf.rules has a
   simple yet powerful syntax. Here we deal with the most common ways of
   usage, for a more strict definition see [17]ipf(5). Here is assumed
   xl0 as the external interface to internet, on this one uses to have
   more rules than internal interfaces.

   Configurations usually start letting everything come and go, and then
   apply the necesary rules to block offending packets. So this is first:

pass out from any to any
pass in from any to any

   Now lets block any incoming connection to port 82 tcp (eg. there's an
   internal network report agent using http running on several hosts):

block in on xl0 proto tcp from any to any port = 82

   This rule means:

   "Block all incoming packets on xl0 interface whose protocol is TCP no
   matter destination/origin using port 82"

   If you want to log all rejected packets add "log" after "block in", or
   "log quick" if you don't want it to send a message to every console
   root is logged in.

   Also, a typical rule is to block rpc portmap:

block in log on xl0 proto udp from any to any port = sunrpc

  IPNAT

   Based on [18]RFC 1631, ipnat provides an easy way to map internal
   networks to a single routeable ("real") internet address. This is very
   useful if you don't have officially asigned addresses for every host
   on your internal network. When you set up private/internal networks,
   you can take advantage of reserved address blocks (assigned in [19]RFC
   1918), such as:

   10.0.0.0/8 (10.0.0.0 - 10.255.255.255)
   172.16.0.0/12 (172.16.0.0 - 172.31.255.255)
   192.168.0.0/16 (192.168.0.0 - 192.168.255.255)

   To use ipnat, ipf must be activated. As outlined above, for changes to
   stay effective through reboots, you should make changes to
   /etc/rc.conf (where it has IPNAT and IPFILTER.) You can manually
   activate ipf with the command below.
# ipf -E

   Example: You have an internal network using 192.168.5.0, with a
   netmask of 255.255.255 0, and you want to give it access to internet
   using OpenBSD (of course!), and a ppp connection using address
   200.1.2.3, use this rule:

map tun0 192.168.5.0/24 -> 200.1.2.3/32

   This rule means:

   "Any IP connections going out tun0 from an address matching the first
   24 bits of 192.168.5.0 should be mapped to the address 200.1.2.3 (only
   one address since /32 means every bit)"

   If you don't like using CIDR notation, IP Filter also allows you to
   use netmasks. A functional equivalent to the example above, using
   netmasks looks like this:

map tun0 192.168.5.0/255.255.255.0 -> 200.1.2.3/255.255.255.255

   But here arises a problem. You are assigning a lot of addresses to
   only one address. But the port numbers aren't changing, and it is very
   likely that your workstations on 192.168.5.0/24 will use the same port
   numbers to initiate connections from. (If this doesn't make sense,
   don't worry, but keep reading.) The way to go arount it is to map TCP
   and UDP ports to a certain range with the option "portmap". Since ICMP
   doesn't even use ports, it is not covered by the "portmap" rule. (ICMP
   uses an ID field usually based on a process number) In our example,
   there are now two map rules to cover all of these protocols. The end
   result looks like this:

map tun0 192.168.5.0/24 -> 200.1.2.3/32 portmap tcp/udp 10000:65000
map tun0 192.168.5.0/24 -> 200.1.2.3/32

   If you have a dynamic address assignment (as in, you do not know what
   address they will give you when you connect), you can put the
   interface name in place of the IP address. Note that if you do this,
   you will have to run ipnat -CF -f /etc/ipnat.rules every time your IP
   address changes (or, every time you dial up.)

map tun0 192.168.5.0/24 -> tun0/32 portmap tcp/udp 10000:65000
map tun0 192.168.5.0/24 -> tun0/32

   NAT is also able to help you in renumbering. Say you were assigned a
   net block 35.8.9.0/22, and your internet provider can no longer route
   thse addresses to you, or say you are switching providers. Your new
   address block is 192.9.4.0/22, but to switch all 500 devices you have
   on this block would be very time consuming! ipnat provides a feature
   called bimap:

bimap xl0 35.8.9.0/22 -> 192.9.4.0/22

   This will literally map every computer in 35.8.9.0 to a new address in
   192.9.4.0. The drawback of this feature is that the translation is not
   consistent. A computer that initiates a connection from 35.8.9.0 will
   get a random IP address from 192.9.4.0. A future version of IP Filter
   will allow for one-to-one translation (where 35.8.9.99 will always get
   mapped to 192.9.4.99).

   And of course, there are other potential uses of NAT that are probably
   beyond the scope of this document.

  Redirecting ports

   This is another very handy feature of IPNAT. If you have a host on the
   internal network (using private addresses), and you want to let
   incoming connections to it, you just need a simple redirect rule. For
   example, if you have a web server on internal network at 10.2.2.7
   listening on port 80, and want it to be accesible from the outside
   simply redirecting external IP 120.2.3.4 on xl0, just add this rule to
   /etc/ipnat.rules:

rdr xl0 120.2.3.4 port 80 -> 10.2.2.7 port 80

   When you write rules, it may help to visualize the packet flow.

Internet <--> (xl0 120.2.3.4) OpenBSD (xl1 10.2.2.1) <--> LAN <--> (10.2.2.7 XY
Z Web server)

   One last reminder that you must have net.inet.ip.forwarding=1 or
   option IPFORWARDING to use IP Filter (ipf, ipnat). Also, redirect only
   works for packets that are being routed through the OpenBSD box. If a
   web browser from inside the NAT (say, from 10.2.2.5 from the example
   above) tries to connect to port 80 on 120.2.3.4, nothing will happen.

6.3 - IPSec

   IPSec is partially documented in the [20]vpn(8) man page. There are
   various files in [21]/usr/share/ipsec/ directory which can also assist
   you. The manual pages for [22]ipsec(4), [23]ipsecadm(8),
   [24]photurisd(8), [25]startkey(1), [26]isakmpd(8) and
   [27]isakmpd.conf(5) are also available!

   You should also check [28]Codetalker which has an FAQ for setting up
   an IPSec VPN with OpenBSD. It explains some basic IPSec concepts and
   how to apply them to a VPN setup.

6.4 - DHCP

   To use the DHCP client [29]dhclient(8) included with OpenBSD, edit
   /etc/hostname.xl0 (this is assuming your main ethernet interface is
   xl0. Yours might be ep0 or fxp0 or something else!) All you need to
   put in this hostname file is 'dhcp'
# echo dhcp >/etc/hostname.xl0

   This will cause OpenBSD to automatically start the DHCP client on
   boot. OpenBSD will gather its' IP address, default gateway, and DNS
   servers from the DHCP server.

   If you want to use OpenBSD as a DHCP server [30]dhcpd(8), edit
   /etc/rc.conf. Set it up so that dhcpd_flags="-q" instead of
   dhcpd_flags=NO. Put the interfaces that you want dhcpd to *listen* on
   in /etc/dhcpd.interfaces.
# echo xl1 xl2 xl3 >/etc/dhcpd.interfaces

   Then, edit /etc/dhcpd.conf. The options are pretty self explanatory.
        option  domain-name "xyz.mil";
        option  domain-name-servers 192.168.1.3, 192.168.1.5;

        subnet 192.168.1.0 netmask 255.255.255.0 {
                option routers 192.168.1.1;

                range 192.168.1.32 192.168.1.127;
        }

   This will tell your dhcp clients that the domain to append to DNS
   requests is xyz.mil (so, if the user types in 'telnet joe' then it
   will send them to joe.xyz.mil). It will point them to DNS servers
   192.168.1.3 and 192.168.1.5. For hosts that are on the same network as
   an ethernet interface on the OpenBSD machine, which is in the
   192.168.1.0/24 range, it will assign them an IP address between
   192.168.1.32 and 192.168.1.127. It will set their default gateway as
   192.168.1.1.

6.5 - PPP

   PPP is generally an easy thing to set up. What follows is a basic
   intro based on the information provided in /etc/ppp and the [31]ppp(8)
   manual pages. These are highly suggested reading before attempting to
   setup PPP or even reading this FAQ entry. If you have read these the
   following should look farmiliar because it is that info with a little
   bit of elaboration.

   First you will need to find out a little bit about how your ISP sets
   up its PPP connections. Does it use scripted login, PAP, CHAP, do you
   have a dynamic or static IP etc. This along with some basic info about
   your modem will allow us to easily create a PPP dial in script for
   your ISP.

   First we will create a PPP conf using what is already in
   /etc/ppp/ppp.conf.sample as a guide. The first section we come to is
   the section labeled default. This is the best place to specify logging
   options, your modem device and dial options. It will always be
   executed when ppp is run. The following is the default section that
   comes standard with /etc/ppp/ppp.conf.sample and an explanation of
   what each parameter does:

   <Default Section>
   default:

   This parameter tells PPP to log output which pertains to the arguments
   you give the parameter.

set log Phase Chat LCP IPCP CCP tun command

   This will set the default modem device on the system which here is com
   2

set device /dev/cua01

   This parameter sets the speed of the serial device.

set speed 115200

   This will set the commands to follow when certian actions take place
   while dialing. Abort the call if the number is busy, abort the call if
   there is no carrier. Wait 5 seconds for carrier. Issue AT and wait for
   response. If AT is ok then dial the number and timeout if not
   connected in 40 seconds. Once dialed in wait for the CONNECT message
   to tell us we are connected.

set dial "ABORT BUSY ABORT NO\\sCARRIER TIMEOUT 5 \"\" AT OK-AT-OK ATE1Q0 OK\\d
ATDT\\T TIMEOUT 40 CONNECT"

   Now that the default modem options are set we will need to create a
   section in the ppp.conf for our ISP. Below are a few examples of what
   could be in there and what type of isp they are tailored for.

   <MyISP Section>
   myisp:
   This of course sets the number to dial for your isp.

set phone 1234567

   This sets the login options. It will abort login if there is no
   carrier with a timeout of 5 seconds. It will then wait for the login:
   prompt and send your login name, and then it will wait for the
   password prompt and send your password.

set login "ABORT NO\\sCARRIER TIMEOUT 5 ogin:--ogin: ppp word: ppp"

   This sets the timeout for the entire login process.

set timeout 120

   This will set the ip address you expect your your side and for the
   remote side of the connection. The /0 bit tells the connection that no
   bits of this ip address need to match and the whole thing can be
   replaced. This also sets your default netmask and gateway.

set ifaddr 10.0.0.1/0 10.0.0.2/0 255.255.255.0 0.0.0.0

   This will make the default gateway the remote end of the ppp
   connection.

add default HISADDR

   This tells ppp to ask the peer for the nameserver addresses that
   should be used. This isnt always supported, but if it is
   /etc/resolv.conf will automatically be updated.

enable dns

   <Pap/Chap Section>
   What if your ISP uses PAP or CHAP? Here is a configuration that will
   work with both PAP or CHAP, PPP will decide which it needs to use.
   myispPAPCHAP:
   This line sets the phone number.

set PHONE 1234567

   PPP will be waiting for the peer to suggest the use of either PAP or
   CHAP.

set LOGIN

   This is where you specify your username.

set authname MyName

   This is where you specify your password.

set authkey MyKey

   This sets the login timeout to 120 seconds.

set timeout 120

   And then procede with the standard commands from above.
   <Static Ip Section>

   All you need to do is change the ifaddr parameter like so:

set ifaddr 209.115.93.18 209.115.93.20

   In this example, your IP is 209.115.93.18, and the peer side IP is
   209.115.93.20.

   [32][Back to Main Index] [33][To Section 5.0 - Kernel configuration
   and Disk Setup] [34][To Section 7.0 - Keyboard controls]
     _________________________________________________________________

   [35][back] [36]www@@openbsd.org
   $OpenBSD: faq6.html,v 1.16 1999/06/27 21:32:23 ericj Exp $

References

   1. http://www.openbsd.org/faq/index.html
   2. http://www.openbsd.org/faq/faq5.html
   3. http://www.openbsd.org/faq/faq7.html
   4. http://www.openbsd.org/faq/faq5.html
   5. http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&apropos=0&sektion=8&format=html
   6. http://www.openbsd.org/cgi-bin/man.cgi?query=netstat&apropos=0&sektion=1&format=html
   7. http://www.openbsd.org/faq/faq12.html
   8. http://www.openbsd.org/cgi-bin/man.cgi?query=routed&apropos=0&sektion=8&format=html
   9. http://www.gated.org/
  10. http://www.mrtd.net/
  11. http://www.zebra.org/
  12. http://www.openbsd.org/cgi-bin/man.cgi?query=ipf&apropos=0&sektion=8&format=html
  13. http://www.openbsd.org/cgi-bin/man.cgi?query=ipnat&apropos=0&sektion=8&format=html
  14. http://false.net/ipfilter/
  15. http://cheops.anu.edu.au/~avalon/ip-filter.html
  16. http://www.swcp.com/~synk/ipf-howto.txt
  17. http://www.openbsd.org/cgi-bin/man.cgi?query=ipf&apropos=0&sektion=5&format=html
  18. http://www.geektools.com/rfc/rfc1631.txt
  19. http://www.geektools.com/rfc/rfc1918.txt
  20. http://www.openbsd.org/cgi-bin/man.cgi?query=vpn&apropos=0&sektion=0&format=html
  21. http://www.openbsd.org/cgi-bin/cvsweb/src/share/ipsec/
  22. http://www.openbsd.org/cgi-bin/man.cgi?query=ipsec&apropos=0&sektion=4&format=html
  23. http://www.openbsd.org/cgi-bin/man.cgi?query=ipsecadm&apropos=0&sektion=8&format=html
  24. http://www.openbsd.org/cgi-bin/man.cgi?query=photurisd&apropos=0&sektion=8&format=html
  25. http://www.openbsd.org/cgi-bin/man.cgi?query=startkey&apropos=0&sektion=1&format=html
  26. http://www.openbsd.org/cgi-bin/man.cgi?query=isakmpd&apropos=0&sektion=8&format=html
  27. http://www.openbsd.org/cgi-bin/man.cgi?query=isakmpd.conf&apropos=0&sektion=5&format=html
  28. http://www.codetalker.com/greenbox/docs/vpn-24-minifaq.html
  29. http://www.openbsd.org/cgi-bin/man.cgi?query=dhclient&apropos=0&sektion=8&format=html
  30. http://www.openbsd.org/cgi-bin/man.cgi?query=dhcpd&apropos=0&sektion=8&format=html
  31. http://www.openbsd.org/cgi-bin/man.cgi?query=ppp&apropos=0&sektion=8&format=html
  32. http://www.openbsd.org/faq/index.html
  33. http://www.openbsd.org/faq/faq5.html
  34. http://www.openbsd.org/faq/faq7.html
  35. http://www.openbsd.org/faq/index.html
  36. mailto:www@@openbsd.org


   [1][Back to Main Index] [2][To Section 6.0 - Networking] [3][To
   Section 8.0 - General Questions]

                            7.0 - Keyboard controls

7.1 - How do I remap the keyboard?

   By using kcon(1), "kcon - keyboard control and remapping for the pcvt
   driver"

   Example:

   bsd# kcon -m gb will load the keycap file for Great Britain.

7.2 - Is there gpm or the like in OpenBSD?

   No. But if you are willing to make a port. Please share. :)

   [4][Back to Main Index] [5][To Section 6.0 - Networking] [6][To
   Section 8.0 - General Questions]
     _________________________________________________________________

   [7][back] [8]www@@openbsd.org
   $OpenBSD: faq7.html,v 1.5 1999/05/21 02:44:00 ericj Exp $

References

   1. http://www.openbsd.org/faq/index.html
   2. http://www.openbsd.org/faq/faq6.html
   3. http://www.openbsd.org/faq/faq8.html
   4. http://www.openbsd.org/faq/index.html
   5. http://www.openbsd.org/faq/faq6.html
   6. http://www.openbsd.org/faq/faq8.html
   7. http://www.openbsd.org/faq/index.html
   8. mailto:www@@openbsd.org


   [1][Back to Main Index] [2][To Section 7.0 - Keyboard controls] [3][To
   Section 9.0 - Tips for linux users]

                            8.0 - General Questions

8.1 - What are these Kerberos warning when I first login?

   When you first install your system you will most likely notice a
   warning message that is something like this:

   Warning: no Kerberos tickets issued.

   THIS WARNING IS COMPLETELY IRRELEVANT AND SHOULD ONLY BE REMOVED IF
   COMPLETELY NECESSARY

   Well since you probably haven't set up Kerberos on your system, you
   wouldn't be getting a ticket. If you do have Kerberos running, you
   need to check into that. If you can't STAND that warning and never
   plan on using Kerberos here is how to get rid of it for good.

     * Make sure you have the source code.
     * Edit /usr/share/mk/bsd.own.mk and set KERBEROS to 'no', or create
       an /etc/mk.conf file that does this.
     * cd /usr/src/usr.bin/login ; make clean ; make ; make install

8.2 - How do I change virtual terminals?

   Simply type [ctrl] - [alt] - [One of the function keys] or just hit
   [f9]-[f12] which are just mapped to [ctrl] - [alt]
   functions. (i386)

   Only the i386 arch has virtual terminal capabilities. You can also use
   virtual terminals when using X. For example, If you start X on term 1,
   and switch with [ctrl]-[alt]-[F2] to term 2, X will seem to disapear
   and will not come back by simply switching back to term 1. You must
   [ctrl]-[alt]-[F5] to get your X display back.

8.3 - I forgot my root password, what do I do now?

   A few steps to recovery
    1. Boot into single user mode. For i386 arch type boot -s at the boot
       prompt.
    2. mount the drives.
          + bsd# fsck -p / && mount -u /
          + if /usr is on a different partition you need to mount that
            also
    3. type passwd
    4. boot into mulituser mode.. and REMEMBER your password .

8.4 - X wont start, I get tons of error messages

   If you have X completely set up and you are using an XF86Config that
   you know works then the problem most likely lies in the
   machdep.allowapature. You also need to make sure that both:

option XSERVER
option APERTURE

   are in you kernel configuration. [BOTH these are in the GENERIC
   kernel]

   Then you need to edit /etc/sysctl.conf
   and set machdep.allowaperture=1. This will allow X to access the
   aperture driver. This would be set up if the question during install
   about whether or not you would be running X was answered correctly.
   OpenBSD 2.4 requires for all X servers that the aperture driver be
   set, because it controls access to the I/O ports on video boards.

   For other X problems on the i386, consult the XFree86 FAQ at
   [4]http://www.xfree86.org/FAQ/.

8.5 - What is CVS? and How do I use it?

   CVS is what the OpenBSD project uses to control changes to the source
   code. CVS stands for Concurrent Versions System. You can read more
   about CVS at [5]http://www.cyclic.com/. CVS can be used by the end
   user to keep up to date with source changes, and changes in the ports
   tree.

   CVS makes it extremely simple to download the source via one of the
   many CVS mirrors for the project.

   Here are some simple commands to get you going on CVS.

   For all these commands a CVSROOT variable must be set. You can do this
   by:

   If you use csh or tcsh use:
   bsd# setenv CVSROOT anoncvs@@anoncvs.ca.openbsd.org:/cvs

   or if you use sh or ksh use:
   bsd# export CVSROOT="anoncvs@@anoncvs.ca.openbsd.org:/cvs"

   It is best to try to find a mirror that is closest to you. You can
   obtain a list of CVS mirrors from
   [6]http://www.openbsd.org/anoncvs.html.

   All these commands are run from the /usr directory if you do not have
   the source code already. The source or ports however can be initially
   downloaded in tarred and gzipped form from any of the ftp servers.
   They are set and ready to be used with CVS.

     * bsd# cvs -q get -PAd src [to get source code] or
     * bsd# cvs -q get -PAd ports [to get the ports tree]

   If you already have an existing source or ports tree:
     * bsd# cvs -q up -PAd src
     * bsd# cvs -q up -PAd ports

   For some, bandwidth and time are serious problems when updating
   repository's such as these. So CVS has a -z[1-9] option which uses
   gzip to compress the data. To use it, do -z[compression-level], for
   instance, -z3 for a compression level of 3.

   There are many different connections you can make to a CVS mirror.
   This is to accompany people from all types of networks, whether you
   are behind a firewall, etc.

   You can make either a ssh, rsh, or pserver connection to the servers.
   Many mirrors also run ssh on port 2022.

   To do this you can use the variable $CVS_RSH. rsh(1) is what CVS uses
   by default, but using the $CVS_RSH environment variable you can have
   CVS use ssh.
   An example:

   #setenv CVS_RSH /usr/local/bin/ssh
   or
   #export CVS_RSH=/usr/local/bin/ssh

8.6 - What is the ports tree?

   The ports tree is a set of Makefiles that download, patch, configure
   and install userland programs so you can run them an OpenBSD
   environment without having to do all that by hand. You can get the
   ports tree from any of the OpenBSD ftp servers in
   /pub/OpenBSD/2.5/ports.tar.gz or try the latest updates in
   /pub/OpenBSD/snapshots/ports.tar.gz.

   If you want to run one of the latest ports collections, you'll need to
   update your /usr/share/mk/ directory. CVS up your /usr/src/ directory
   and do a:
# cd /usr/src/share/mk/
# make install

   first.

   A snapshot of the ports tree is also created daily and can be
   downloaded from any of the [7]OpenBSD ftp servers as
   /pub/OpenBSD/snapshots/ports.tar.gz.

   In 2.5-current this information is now stored in the ports tree. In
   ports/infrastructure/ all thats left in /usr/src/share/mk for ports is
   just a pointer to this new area. So, once you have the ports working
   witht the infrastructure dir, you no longer need to do the step from
   above.

   Ports are set up to be EXTREMELY easy to make and install. Here is an
   example install for someone wanting to install the X11 program xfig.
   You'll notice the dependencies are automaticly detected and completed:

   First you need to cd to the dir of the program you want. If you are
   searching for a program, you can either update your locate database,
   or use the search function talked about below. Once you are in the dir
   of the program you want, you can just type make install. For example.
fenetyllin:/usr/ports/graphics/xfig# make install
===>  Extracting for xfig-3.2.2
===>  xfig-3.2.2 depends on shared library: jpeg.62. - /usr/local/lib/libjpeg.s
o.62.0 found
===>  xfig-3.2.2 depends on shared library: Xaw3d.6. - not found
===>  Verifying install for Xaw3d.6. in /usr/ports/x11/Xaw3d
>> Xaw3d-1.3.tar.gz doesn't seem to exist on this system.
>> Attempting to fetch from ftp://crl.dec.com/pub/X11/contrib/widgets/Xaw3d/R6.
1/.
Connected to crl.dec.com.
220 crl.dec.com FTP server (Digital UNIX Version 5.60) ready.
331 Guest login ok, send ident as password.
230 Guest login ok, access restrictions apply.
Remote system type is UNIX.
Using binary mode to transfer files.
200 Type set to I.
250 CWD command successful.
250 CWD command successful.
Retrieving pub/X11/contrib/widgets/Xaw3d/R6.1/Xaw3d-1.3.tar.gz
local: Xaw3d-1.3.tar.gz remote: Xaw3d-1.3.tar.gz
227 Entering Passive Mode (192,58,206,2,5,14)
150 Opening BINARY mode data connection for Xaw3d-1.3.tar.gz (0.0.0.0,0) (29027
7 bytes).
100% |**************************************************|   283 KB    00:00 ETA
226 Transfer complete.
290277 bytes received in 101.09 seconds (2.80 KB/s)
221 Goodbye.
===>  Extracting for Xaw3d-1.3
/bin/mkdir -p /usr/ports/x11/Xaw3d/work/xc/lib/Xaw3d/X11/Xaw3d
cd /usr/ports/x11/Xaw3d/work/xc/lib/Xaw3d/X11/Xaw3d; ln -sf ../../*.h .
===>  Patching for Xaw3d-1.3
===>  Configuring for Xaw3d-1.3
mv -f Makefile Makefile.bak
imake -DUseInstalled -I/usr/X11R6/lib/X11/config
make Makefiles
[snip]

   You can see a list of both ports and packages by using the pkg_info
   command.
bsd# /usr/sbin/pkg_info
zsh-3.0.5           The Z shell.
screen-3.7.4        A multi-screen window manager.
ssh-1.2.21          Secure shell client and server (remote login program).
emacs-20.2          GNU editing macros.
lynx-2.7.1ac-0.107  An alphanumeric display oriented World-Wide Web Client.
tcsh-6.07.02        An extended C-shell with many useful features.
bash-2.01           The GNU Borne Again Shell.
zip-2.2             Create/update ZIP files compatabile with pkzip.
mm-2.7              Implementation of MIME, the Multipurpose Internet Mail Exte
n
ircii-2.8.2-epic3.004 An enhanced version of ircII, the Internet Relay Chat cli
ent
ispell-3.1.20       An interactive spelling checker.
tin-1.3.970930      TIN newsreader (termcap based)
procmail-3.11p7     A local mail delivery agent.
strobe-1.03         Fast scatter/gather TCP port scanner
lsof-4.15           Lists information about open files.
xntp3-5.92          Network Time Protocol Implementation.
ncftp-2.4.3
 nmh-0.27            The New MH mail handling program
bzip2-0.1p12        A block-sorting file compressor

   If you are looking for a specific program in the ports tree, you can
   try
fenetyllin:/usr/ports/# make search key="xfig"
Port:   xfig-3.2.2
Path:   /home/ports/graphics/xfig
Info:   A drawing program for X11
Maint:  angelos@@openbsd.org
Index:  graphics x11
B-deps: Xaw3d-1.3 jpeg-6b
R-deps: Xaw3d-1.3 ghostscript-5.10 gv-3.5.8 jpeg-6b png-1.0.2 transfig-3.2.1
Archs:  any

Port:   transfig-3.2.1
Path:   /home/ports/print/transfig
Info:   Tools to convert Xfig's .fig files.
Maint:  angelos@@openbsd.org
Index:  print
B-deps: jpeg-6b
R-deps: ghostscript-5.10 jpeg-6b png-1.0.2
Archs:  any
[snip]

   More information about the ports can be found in the ports man page

   Our ports tree is constantly being expanded, and if you would like to
   help please see: [8]http://www.openbsd.org/ports.html

8.7 - What are packages?

   Packages are the precompiled binaries of some of the most used
   programs. They are ready for use on an OpenBSD system. Again, like the
   ports, packages are very easy to maintain and update. Packages are
   constantly being added so be sure to check each release for additional
   packages.

   Here is a list of tools used in managing packages.
     * pkg_add (1) - a utility for installing software package
       distributions
     * pkg_create (1) - a utility for creating software package
       distributions
     * pkg_delete (1) - a utility for deleting previously installed
       software package distributions
     * pkg_info (1) - a utility for displaying information on software
       packages

   Here is a sample user installing ispell via a package:

   bsd# pkg_add
   ftp://ftp.openbsd.org/pub/OpenBSD/2.5/packages/${arch}/ispell-3.1.20.t
   gz
   where ${arch} is your architecture

   Again, like with ports you can use the pkg_info(1) program to view
   what is already installed on your system.

   To delete packages you will want to use the pkg_delete(1) command. It
   is used the same way as pkg_add(1).

   bsd# /usr/sbin/pkg_delete ispell-3.1.20

   and it is gone.

   Packages can be found on any of the OpenBSD ftp mirror sites.
   [9]Http://www.OpenBSD.org/ftp.html
   or they can be found on your OpenBSD CD's.

8.8 - Is there any way to use my floppy drive if it's not attached during boot?

   Sure. You need to add "flags 0x20" at the end of the fd* entry and
   recompile your kernel. The line should be read:
   fd* at fdc? drive ? flags 0x20

   After that you would be able to use the floppy drive all the time. It
   doesn't matter if you plugged it later after boot.

8.9 - Boot time Options - Using the OpenBSD bootloader

   When booting your OpenBSD system, many of you have probobly noticed
   the boot prompt.

   boot>

   For most people, you won't have to do anything here. It will
   automatically boot if no commands are given. But sometimes problems
   arise, or special functions are needed. Thats where these options will
   come in handy. To start of, you should read through the [10]boot(8)
   man page. Here we will go over the most common used commands for the
   bootloader.

   To start off, if no commands are issued, the bootloader will
   automatially try to boot /bsd. If that fails it will try /obsd, and so
   on till it finds a bootable kernel. You can specify this by hand by
   typing:

   boot> boot wd0a:/bsd
   or
   boot> b /bsd

   This will work if device wd0a is configured as your root device.

   Here is a quick overview of options to be used with the boot
       parameter.
     * -a : This will allow you to specify an alternate root device after
       booting the kernel.
     * -c : This allows you to enter the boot time configuration. Check
       the [11]Boot Time Config section of the faq.
     * -s : This is the option to boot into single user mode.
     * -d : This option is used to dump the kernel into ddb. Keep in mind
       that you must have DDB built into the kernel.
     * -b : Shortcut for RB_HALT.

   These are entered in the format of:
   boot [ image [-abcds]]

   For further reading you can read [12]boot_i386(8) man page

   [13][Back to Main Index] [14][To Section 7.0 - Keyboard controls]
   [15][To Section 9.0 - Tips for linux users]
     _________________________________________________________________

   [16][back] [17]www@@openbsd.org
   $OpenBSD: faq8.html,v 1.17 1999/06/23 21:31:30 ericj Exp $

References

   1. http://www.openbsd.org/faq/index.html
   2. http://www.openbsd.org/faq/faq7.html
   3. http://www.openbsd.org/faq/faq9.html
   4. http://www.xfree86.org/FAQ/
   5. http://www.cyclic.com/
   6. http://www.openbsd.org/anoncvs.html
   7. http://www.openbsd.org/ftp.html
   8. http://www.openbsd.org/ports.html
   9. http://www.openbsd.org/ftp.html
  10. http://www.openbsd.org/cgi-bin/man.cgi?query=boot&sektion=8&format=html
  11. http://www.openbsd.org/faq/faq5.html#5.4
  12. http://www.OpenBSD.org/cgi-bin/man.cgi?query=boot_i386&sektion=8&format=html
  13. http://www.openbsd.org/faq/index.html
  14. http://www.openbsd.org/faq/faq7.html
  15. http://www.openbsd.org/faq/faq9.html
  16. http://www.openbsd.org/faq/index.html
  17. mailto:www@@openbsd.org


   [1][Back to Main Index] [2][To Section 8.0 - General Questions] [3][To
   Section 10.0 - System Administration]

                          9.0 - Migrating from Linux
     _________________________________________________________________

9.1 - Simple tips for Linux (and other free Unix-like OS) users

   There are several differences between OpenBSD and Linux. These
   differences include but are not limited to, bootup procedure, network
   interface usage and disk management. Most differences are well
   documented, but involve searching manpages. This document tries to be
   an index of those differences.

     * OpenBSD has a ports tree. This is to accomodate the fact that at
       this point not many applications are native to the OpenBSD
       environment. This is both an attempt to get applications to work
       on OpenBSD for end-users and to get more applications made with
       OpenBSD in mind. Eventually this ports tree will be used to make a
       nice set of binary packages.
     * OpenBSD uses CVS for source changes. With Linux, source code is
       disseminated through separate distributions. OpenBSD has pioneered
       anonymous CVS, which allows anyone to extract the full source tree
       for any version of OpenBSD (from 2.0 to current, and all revisions
       of all files in between) at any time! OpenBSD also does
       periodically release snapshots for various architectures and makes
       a stable, official CD release every 6 months.
     * OpenBSD contains STRONG CRYPTO, which USA based OS's can't
       contain. (See [4]http://www.openbsd.org/crypto.html) OpenBSD has
       also gone through heavy security auditing and many security
       features have already been implemented into the source tree.
       (IPSEC, KERBEROS).
     * OpenBSD's kernel is /bsd.
     * The names of hard disks are usually /dev/wd and /dev/sd (ATA/SCSI)
     * /sbin/ifconfig with no arguments in Linux gives the state of all
       the interfaces. Under OpenBSD you need the -a flag.
     * /sbin/route with no arguments in Linux gives the state of all the
       active routes. Under OpenBSD you need the "show" parameter, or do
       a netstat -r (nice).
     * OpenBSD comes with Darren Reed's IP Filter package, not ipfw. This
       means that:
          + IP-Masquerading is done through ipnat. ([5]ipnat(1))
          + ipfwadm is done through ipf ([6]ipf(1), [7]ipf(5))
          + You should look at [8]section 6 for detailed configuration
            assistance and information.
     * Interface address is stored in /etc/hostname.<interfacename>. It
       can be a name instead of an IP address.
     * The machine name is in /etc/myname
     * The default gateway is in /etc/mygate
     * The network interface aliases are in /etc/ifaliases
     * OpenBSD's default shell is /bin/sh, which is the Korn shell.
       Shells such as bash and tcsh can be added as packages or installed
       from the ports tree.
     * Password management changes a lot. The main files are different.
       ([9]passwd(1), [10]passwd(5))

9.2 - Dual booting Linux and OpenBSD

   Yes! it is possible!

   Read [11]INSTALL.linux

   [12][Back to Main Index] [13][To Section 8.0 - General Questions]
   [14][To Section 10.0 - System Administration]
     _________________________________________________________________

   [15][back] [16]www@@openbsd.org
   $OpenBSD: faq9.html,v 1.9 1999/06/27 21:32:24 ericj Exp $

References

   1. http://www.openbsd.org/faq/index.html
   2. http://www.openbsd.org/faq/faq8.html
   3. http://www.openbsd.org/faq/faq10.html
   4. http://www.openbsd.org/crypto.html
   5. http://www.openbsd.org/cgi-bin/man.cgi?query=ipnat&apropos=0&sektion=1&format=html
   6. http://www.openbsd.org/cgi-bin/man.cgi?query=ipf&apropos=0&sektion=1&format=html
   7. http://www.openbsd.org/cgi-bin/man.cgi?query=ipnat&apropos=0&sektion=5&format=html
   8. http://www.openbsd.org/faq/faq6.html
   9. http://www.openbsd.org/cgi-bin/man.cgi?query=passwd&apropos=0&sektion=1&format=html
  10. http://www.openbsd.org/cgi-bin/man.cgi?query=passwd&apropos=0&sektion=5&format=html
  11. http://www.openbsd.org/faq/INSTALL.linux
  12. http://www.openbsd.org/faq/index.html
  13. http://www.openbsd.org/faq/faq8.html
  14. http://www.openbsd.org/faq/faq10.html
  15. http://www.openbsd.org/faq/index.html
  16. mailto:www@@openbsd.org


   [1][Back to Main Index] [2][To Section 9.0 - Migrating from Linux]
   [3][To Section 11.0 - OpenBSD 2.4 Specific Information]

                         10.0 - System Administration
     _________________________________________________________________

10.1 - Why does it say that I'm in the wrong group when I su to root?

   With OpenBSD's [4]adduser(8) utility does not allow for you to add any
   users to the "wheel" group. This means that they must be added to the
   "wheel" group by hand. This is done for security reasons, and you
   should be cautious with whom you give access to. On OpenBSD, users who
   are in the "wheel" group are allowed to use the [5]su(1) userland
   program to become root. Users who are not in "wheel" cannot use su(1).
   Here is an example of a /etc/group entry to place the user ericj into
   the "wheel" group.
wheel:*:0:root,ericj

   If you are looking for a way to allow users limited access to
   superuser privliges, without putting them in the "wheel" group, use
   [6]sudo(8).

10.2 - How do I duplicate a filesystem?

   To duplicate your filesystem use [7]dump(8) and [8]restore(8). For
   example. To duplicate everything under directory SRC to directory DST,
   do a:
# cd /SRC; dump 0f - . | (cd /DST; restore -rf - )

   dump is designed to give you plenty of backup capabilities, and it may
   be an overkill if you just want to duplicate a part of a (or an
   entire) filesystem. The command [9]tar(1) may be faster for this
   operation. The format looks very similar:
# cd /SRC; tar cf - | (cd /DST; tar xpf - )

10.3 - How do I get httpd, sendmail, etc to startup with the system?

   OpenBSD uses rc-style startup to control starting applications with
   the system. For common daemons you can simply edit [10]/etc/rc.conf.
   For example: To have ftpd started on boot change -
ftpd_flags=NO -- > ftpd_flags="-D"

   You can add any flags that you wish ftpd to start with.

   If you have your own daemons that you want to be started, here is a
   simple entry that you can put into /etc/rc.local.
if [ -x /usr/local/sbin/mydaemon ]; then
        echo -n ' mydaemon';       /usr/local/sbin/mydaemon
fi

   Once in there, it will come up with the system each time.

10.4 - Why do users get relaying access denied when they are remotely sending
mail through my OpenBSD system?

   Try this:
cat /etc/sendmail.cf | grep relay-domains

   The output may look something like this:
FR-o /etc/mail/relay-domains

   If this file doesn't exist, create it. You will need to enter the
   users who are sending mail remotely with the following syntax:
.domain.com    #Allow any .domain.com user to send mail through us
sub.domain.com #Allow sub.domain.com to send mail through us

   Don't forget to:
kill -1 `cat /var/run/sendmail.pid`

10.5 - I've set up POP, but users have trouble accessing mail thru POP. What
can I do?

   Most issues dealing with POP are problems with temporary files and
   lock files. If your pop server sends an error message such as:
-ERR Couldn't open temporary file, do you own it?

   Try setting up your permissions as such:
permission in  /var
drwxrwxr-x   2 bin     mail     512 May 26 20:08 mail


permissions in  /var/mail
-rw-------   1 username   username        0 May 26 20:08 username

   Another thing to check is that the user actually owns their own
   /var/mail file. Of course this should be the case (as in,
   /var/mail/joe should be owned by joe) but if it isn't set correctly it
   could be the problem!

   Of course, making /var/mail writeable by group mail opens up some
   vague and obscure security problems. It is likely that you will never
   have problems with it. But it could (especially if you are a high
   profile site, ISP,...)! Try running cucipop or another POP daemon from
   the OpenBSD ports collection. Or, you could just have the wrong
   options selected for your pop daemon (like dot locking). Or, you may
   just need to change the directory that it locks in (although then the
   locking would only be valueable for the POP daemon.)

10.6 - Setting up a Secure HTTP server with SSL(8)

   This will take you through all the steps it takes to set up your own
   Secure HTTP server. Since the OpenBSD 2.5 release, OpenBSD has shipped
   with SSLeay. Because of patented RSA algorigthms, these cannot be
   shipped with OpenBSD. libssl includes support for SSL version 2, SSL
   version 3, and TLS version 1. So for now, because of patent
   restictions, OpenBSD must ship without a fully-functional libssl. But
   it is still completely useable. If you are able to use the RSA
   patented libraries, you can easily upgrade your libssl with a command
   like this.

   # pkg_add
   ftp://ftp.openbsd.org/pub/OpenBSD/${ver}/packages/${arch}/libssl-1.1.t
   gz
   Where ${ver} is the OpenBSD version number, and ${arch} is your
   architecture.

   The steps shown here are taken in part from the [11]ssl(8) man page.
   Refer to it for further information. This FAQ entry only outlines how
   to creating an RSA certificate for web servers, not a DSA server
   certificate. To find out how to do so, please refer to the ssl(8) man
   page.

   Here is how you create your server key and certificate. These will go
   to /etc/ssl/private/. To use the RSA features, you must have upgraded
   your libssl. Now you can create your key. Using ssleay,
   # ssleay genrsa -out /etc/ssl/private/server.key 1024

   This will create a key of 1024 bits. Next you need to create a
   Certificate Signing Request which is used to get a CA or Certificate
   Authority to sign your key. Here is the command to do so.
   # ssleay req -new -key /etc/ssl/private/server.key -out
       /etc/ssl/private/server.csr

   You would now give /etc/ssl/private/server.csr to the CA to get it
   signed. Or you could also sign the certificate for yourself. Here is
   how you would do this.
   # ssleay x509 -req -days 365 -in /etc/ssl/private/server.csr -signkey
       /etc/ssl/private/server.key -out /etc/ssl/server.crt

   This will sign your key, and it will be valid for up to 365 days. With
   this done you can now start the httpd server. To start httpd(8) with
   ssl you must start the daemon with the -DSSL flag. You can start this
   on boot in /etc/rc.conf by changing the httpd line to look like so:
httpd_flags="-DSSL"

   This server will run on port 443.

10.7 - I edited /etc/passwd, but the changes didn't seem to take place. Why?

   If you edit /etc/passwd, your changes will be lost. OpenBSD generates
   /etc/passwd dynamically with [12]pwd_mkdb(8). The main password file
   in OpenBSD is /etc/master.passwd. According to pwd_mkdb(8),
FILES
     /etc/master.passwd  current password file
     /etc/passwd         a Version 7 format password file
     /etc/pwd.db         insecure password database file
     /etc/pwd.db.tmp     temporary file
     /etc/spwd.db        secure password database file
     /etc/spwd.db.tmp    temporary file

   In a traditional Unix password file, such as /etc/passwd, everything
   including the user's encrypted password is available to anyone on the
   system (and is a prime target for programs such as Crack.) 4.4BSD
   introduces the master.passwd file, which has an extended format (with
   additional options beyond what was provided by /etc/passwd) and is
   only readable by root. For faster access to data, the library calls
   which access this data normally read /etc/pwd.db and /etc/spwd.db.

   OpenBSD does come with a tool with which you should edit your password
   file. It is called vipw(8). Vipw will use vi (or your favourite editor
   defined per $EDITOR) to edit /etc/master.passwd. After you are done
   editing, it will re-create /etc/passwd, /etc/pwd.db, and /etc/spwd.db
   as per your changes. Vipw also takes care of locking these files, so
   that if anyone else attempts to change them at the same time, they
   will be denied access.

10.8 - What is the best way to add users? and delete them?

   The best way to add a user in OpenBSD is to use the [13]adduser(8)
   script. You can configure this to work however you like by editing
   /etc/adduser.conf. You can add users by hand, but this is the
   recommended way to addusers. adduser(8) allows for consistancy checks
   on /etc/passwd, /etc/group, and shell databases. It will create then
   entries for you, and HOME directory, and even send a message to the
   user welcoming them. This can be changed to meet your needs. For
   further instructions on adding users read the [14]adduser_proc(8) man
   page.

   To delete users you should use the [15]rmuser(8) utility. This will
   remove all existance of a user. It will remove any crontab(1) entries,
   their HOME dir (if it is owned by the user), and their mail. Of course
   it will also remove their /etc/passwd and /etc/group entries.

10.9 - How do i create an ftp-only account?

   There are a few ways to do this, but a very common way to do such is
   to add /bin/false into /etc/shells. Then when you create the user set
   his shell to /bin/false, they will not be able log in interactively,
   but will be able to use ftp capabilities. adduser(8) will give them a
   home dir by default of /home/. If this is what you desire it doesn't
   need to be changed, however you can set this to whatever directory you
   wish.

10.10 - Setting up Quotas

   Quotas are used to limit users space that they have available to them
   on your drives. It can be very helpful in situations where you have
   limited resources. Quotas can be set in two different ways.

     * 1 - User Quotas
     * 2 - Group Quotas

   The first step to setting up quotas is to make sure that option QUOTA
   is in your Kernel Configuration. This option is in the GENERIC kernel.
   After this you need to mark in /etc/fstab the filesystems which will
   have quotas enabled. The keywords userquota and groupquota should be
   used to mark each fs that you will be using quotas on. By default the
   files quota.user and quota.group will be created at the root of that
   filesystem to hold the quota information. This default can be
   overwritten by doing, userquota=/var/quotas/quota.user. Or whatever
   file you want to use for holding quota information. Here is an example
   /etc/fstab that has one filesystem with userquotas enabled.
/dev/wd0a / ffs rw,userquota=/var/quotas/quota.user 1 1

   Now it's time to set the user's quotas. To do so you use the utility
   [16]edquota(8) . A simple use is just edquota < user >. edquota(8)
   will use vi(1) to edit the quotas unless the environmental variable
   EDITOR is set to a different editor. For example:
   # edquota ericj

   This will give you output similar to this:

Quotas for user ericj:
/: blocks in use: 62, limits (soft = 0, hard = 0)
        inodes in use: 25, limits (soft = 0, hard = 0)

   To add limits, edit it to something similar to this:

Quotas for user ericj:
/: blocks in use: 62, limits (soft = 1000, hard = 1050)
        inodes in use: 25, limits (soft = 0, hard = 0)

   In this the softlimit is set to 1000 blocks and the hardlimit is set
   to 1050 blocks. A softlimit is a limit where the user is just warned
   when they cross it and have until their grace period is up to get
   their disk usage below their limit. Grace periods can be set by using
   the -t option on edquota(8). After the grace period is over the
   softlimit is handled as a hardlimit. This usually results in an
   allocation failure.

   Now that the quotas are set, you need to turn the quotas on. To do
   this use [17]quotaon(8). For example:

# quotaon -a

   This will go thru /etc/fstab to turn on the filesystems with quota
   options. Now that quotas are up and running, you can view them by the
   [18]quota(1). Using a command of quota < user > will give that users
   info. quota with no arguments will give your quota statistics. For
   example:

# quota ericj

   Will result in output similar to this:
Disk quotas for user ericj (uid 1001):
     Filesystem  blocks   quota   limit   grace   files   quota   limit   grace
              /      62    1000    1050              27       0       0

   By default quotas set in /etc/fstab will be started on boot. To turn
   them of use quotaoff -a

   [19][Back to Main Index] [20][To Section 9.0 - Migrating from Linux]
   [21][To Section 11.0 - OpenBSD 2.4 Specific Information]
     _________________________________________________________________

   [22][back] [23]www@@openbsd.org
   $OpenBSD: faq10.html,v 1.18 1999/06/28 05:45:25 ericj Exp $

References

   1. http://www.openbsd.org/faq/index.html
   2. http://www.openbsd.org/faq/faq9.html
   3. http://www.openbsd.org/faq/faq24.html
   4. http://www.openbsd.org/cgi-bin/man.cgi?query=adduser&sektion=8&format=html
   5. http://www.openbsd.org/cgi-bin/man.cgi?query=su&apropos=0&sektion=1&format=html
   6. http://www.openbsd.org/cgi-bin/man.cgi?query=sudo&sektion=8&format=html
   7. http://www.openbsd.org/cgi-bin/man.cgi?query=dump&sektion=8&format=html
   8. http://www.openbsd.org/cgi-bin/man.cgi?query=restore&sektion=8&format=html
   9. http://www.openbsd.org/cgi-bin/man.cgi?query=tar&sektion=1&format=html
  10. http://www.openbsd.org/cgi-bin/cvsweb/src/etc/rc.conf?rev=1.35
  11. http://www.openbsd.org/cgi-bin/man.cgi?query=ssl&apropos=0&sektion=8&format=html
  12. http://www.openbsd.org/cgi-bin/man.cgi?query=pwd_mkdb&sektion=8&apropos=0
  13. http://www.openbsd.org/cgi-bin/man.cgi?query=adduser&sektion=8&format=html
  14. http://www.openbsd.org/cgi-bin/man.cgi?query=adduser_proc&sektion=8&format=html
  15. http://www.openbsd.org/cgi-bin/man.cgi?query=rmuser&sektion=8&format=html
  16. http://www.openbsd.org/cgi-bin/man.cgi?query=edquota&sektion=8&format=html
  17. http://www.openbsd.org/cgi-bin/man.cgi?query=quotaon&sektion=8&format=html
  18. http://www.openbsd.org/cgi-bin/man.cgi?query=quota&sektion=1&format=html
  19. http://www.openbsd.org/faq/index.html
  20. http://www.openbsd.org/faq/faq9.html
  21. http://www.openbsd.org/faq/faq24.html
  22. http://www.openbsd.org/faq/index.html
  23. mailto:www@@openbsd.org


   [1][Back to Main Index] [2][To Section 10.0 - System Administration]
   [3][To Section 12.0 - Performance Tuning]

                    11.0 - OpenBSD 2.4 Specific Information
     _________________________________________________________________

11.1 - In 2.4 why do I get UserDir error when running httpd?

   It seems as though userdir support was left out of 2.4. Make sure to
   pick up the patch at:

   [4]http://www.openbsd.org/errata.html

11.2 - Installing at a partition 4GB or higher

   The 2.4 cd's shipped with a problem in installboot. A patch can be
   obtained here [5]http://www.openbsd.org/errata.html. This is fixed in
   -current.

   To place the partition boot record, installboot used a 32 bit
   multiplication for the sectors times the sectorsize which is larger
   than 2^32 -1 (i.e. multiplication overflow) when the partition starts
   at 4 GB or higher. This means the pbr is installed in the reall
   partition address modulo 4GB. It's still possible to install at >= 4GB
   with some effort:

   You have 2 Options for doing so with OpenBSD 2.4. If you have Linux or
   any other unix like OS, you should back up the sectors first before
   trying anything.

     * Suppose the partition starts at cylinder 611, and the drive has
       255 heads, 63 sectors: offset for the obsd partition is
       611*255*63= 9815715 sectors. multiply this by 512 and you get:
       5025646080. 5025646080 mod 2^32 = 730678784
       (You can just subtract 2^32 on a hand calculator...) dividing by
       512 gives sector 1427107.
       Ok, suppose were now in linux (where cylinder numbers are 1 higher
       btw..) and that the obsd partition is DOS partition 4:
       dd if=/dev/hda of=backup.txt skip=1427107 bs=512 count=1
       will backup the data that installboot will nuke ..
       Now install OpenBSD. Return to Linux.
       Now we're going to copy the partition boot record to the right
       place.
       dd if=/dev/hda of=pbr.txt skip=1427107 bs=512 count=1
       dd if=/pbr.txt of=/dev/hda4 bs=512 count=1
       (adding obsd to lilo should now work)
       Now write back the nuked sector:
       dd if=/backup.txt of=/dev/hda seek=1427107 bs=512 count=1
       Caveat: make sure that whatever gets nuked by installboot isn't
       essential to running dd (and starting the other OS). Backing up
       the affected partition is recommended.
     * Use a correct version of installboot (compiled for you by another
       OBSD'er ..):
       put it on another partition, e.g. a DOS partition. Suppose wd0j is
       the DOS partition (see disklabel wd0, this is in case of IDE
       disks), and installboot is named installb there.
       After booting from floppy/CD, press ^C to get into the shell:
          + mkdir dos
          + mount /dev/wd0j dos
          + cp dos/tmp/installb /usr/mdec/installboot

   Now enter 'install' and the installation procedure should use the new
   installboot.

   [6][Back to Main Index] [7][To Section 10.0 - System Administration]
   [8][To Section 12.0 - Performance Tuning]
     _________________________________________________________________

   [9][back] [10]www@@openbsd.org
   $OpenBSD: faq24.html,v 1.2 1999/05/21 18:40:48 wvdputte Exp $

References

   1. http://www.openbsd.org/faq/index.html
   2. http://www.openbsd.org/faq/faq10.html
   3. http://www.openbsd.org/faq/faq12.html
   4. http://www.openbsd.org/errata.html#userdir
   5. http://www.openbsd.org/errata.html#installboot
   6. http://www.openbsd.org/faq/index.html
   7. http://www.openbsd.org/faq/faq24.html
   8. http://www.openbsd.org/faq/faq12.html
   9. http://www.openbsd.org/faq/index.html
  10. mailto:www@@openbsd.org

$OpenBSD: INSTALL.linux,v 1.1 1998/12/21 21:37:25 ericj Exp $

Warning: this document is currently being reviewed. It's not yet complete,
and probably contains loads of errors. As an example, I can't figure out
why Linux doesn't need mkswap as it shares the exact same blocks with
OpenBSD.


   Linux + OpenBSD: it's possible

   by Marc Espie --  Marc.Espie@@OpenBSD.org

It is perfectly possible to have Linux and OpenBSD on the same disk.
As of this writing, OpenBSD can read and write Linux' partitions, whereas
Linux cannot access OpenBSD partitions (they differ from NetBSD partitions).

You can even install OpenBSD from an ext2fs partition (choose install from
disk... ext2fs does not appear in the choices, but `default' it is).

First, make a bootable floppy of Linux.  Then, you  have to find some room
for OpenBSD.  Don't worry about swap space: you can share Linux' swap
partition.

If you want to grab space from a Windows/DOS partition, use fips.
Fips20 knows all about FAT32, so windows 95 is no longer a problem.

Other sources of information, especially concerning other BSD systems,
must be taken with a healthy does of scepticism.

First principles
----------------
OpenBSD does not use the DOS partitions for more than booting.  You just
need a small DOS partition to put your OpenBSD root.  Afterwards, OpenBSD
heeds some other information entirely, called the BSD disklabel.  This
disklabel is another completely distinct description of your hard disk.
It does not even have to be consistent with the usual DOS partitions
information.

Throughout this document, we will distinguish between DOS partitions and
BSD partitions whenever this is necessary.

For consistency, it's better if all parts of the disks that
are actually used by OpenBSD are flagged as occupied, type A6, though it
is not necessary.  The only part of the disk that should appear both as a BSD
partition and as a DOS partition is the root partition: it MUST begin on
the same sector for the boot process to work.

One way to visualize things is to picture OpenBSD embedded inside DOS
partitions: the DOS partitions used by OpenBSD may each contain several
OpenBSD partitions. As long as the DOS partition table has the right
start and length for each partition it will be kept happy.

The OpenBSD disklabel is just another mechanism that yield another
description of the disk. It is vitally important that the BSD root
partition start precisely where the corresponding DOS partition is supposed
to start, and it is better when all BSD partitions stay inside their
DOS partitions boundaries.  Apart from OpenBSD partitions proper, the
BSD disklabel can contain a BSD description of other DOS partitions, but
this is not mandatory. If you don't have any constraints, having a correct
description of all partitions is better, but with bigger disks, keep in mind
that OpenBSD disklabels can't hold more than 16 partitions.

Contrarily to popular belief, OpenBSD does *NOT* need one contiguous chunk
of the disk (a `slice' in FreeBSD lingo).  It is probably the simplest setup,
but other considerations (such as the need to boot several OS, and to have
several small primary partitions that all within the first  1024 BIOS
cylinders) may lead you to use two chunks for OpenBSD.

If you can, it is MUCH better to devote a full disk to OpenBSD: this limits
the number of mistakes you can do. Admittedly there are some cases where
this isn't a option (my machine is a laptop... I have to cope with the
hard disk I have).

Mapping your disk
-----------------
Starting from Linux, get a grasp of your partitions. Use df to check which
is what, then fdisk to get the actual setup of the disk.
Here is my disk:
--
Disk /dev/hda: 128 heads, 63 sectors, 993 cylinders
Units = cylinders of 8064 * 512 bytes

   Device Boot   Begin    Start      End   Blocks   Id  System
/dev/hda1            1        1      260  1048288+   6  DOS 16-bit >=32M
/dev/hda2          261      261      273    52416   83  Linux native
/dev/hda4          287      287      601  1270080    5  Extended
/dev/hda5          287      287      303    68512   82  Linux swap
/dev/hda6          304      304      456   616864+  83  Linux native
/dev/hda7          457      457      520   258016+  83  Linux native
/dev/hda8          521      521      537    68512+  83  Linux native
/dev/hda9          538      538      601   258016+  83  Linux native

(In case you're wondering, yes this is a big disk. The Linux playground is
large, the OpenBSD area will be huge. As a developer, I usually have loads
of source & binaries lying around... a simple OpenBSD installation can fit
within 300 Mb with room to spare.)
In my setup hda2 is /, hda6 is /usr, hda7 is /usr/local, hda8 is /var, and
hda9 is /home.

Get the display to sectors with u, and jot down the corresponding
information as well:
--
Disk /dev/hda: 128 heads, 63 sectors, 993 cylinders
Units = sectors of 1 * 512 bytes

   Device Boot   Begin    Start      End   Blocks   Id  System
/dev/hda1           63       63  2096639  1048288+   6  DOS 16-bit >=32M
/dev/hda2      2096640  2096640  2201471    52416   83  Linux native
/dev/hda4      2306304  2306304  4846463  1270080    5  Extended
/dev/hda5      2306368  2306368  2443391    68512   82  Linux swap
/dev/hda6      2443455  2443455  3677183   616864+  83  Linux native
/dev/hda7      3677247  3677247  4193279   258016+  83  Linux native
/dev/hda8      4193343  4193343  4330367    68512+  83  Linux native
/dev/hda9      4330431  4330431  4846463   258016+  83  Linux native

Okay, finally switch to expert mode, and note the corresponding data.
Disk /dev/hda: 128 heads, 63 sectors, 993 cylinders

Nr AF  Hd Sec  Cyl  Hd Sec  Cyl   Start    Size ID
 1 00   1   1    0 127  63  259      63 2096577 06
 2 00   0   1  260 127  63  272 2096640  104832 83
 3 00   0   0    0   0   0    0       0       0 00
 4 00   0   1  286 127  63  600 2306304 2540160 05
 5 00   1   2  286 127  63  302      64  137024 82
 6 00   1   1  303 127  63  455      63 1233729 83
 7 00   1   1  456 127  63  519      63  516033 83
 8 00   1   1  520 127  63  536      63  137025 83
 9 00   1   1  537 127  63  600      63  516033 83

Note that this is STILL the same data. The good point about this last
display is that it is almost what you're going to see in OpenBSD fdisk !

There are some differences though, mostly because Linux fdisk has made
some rather confusing choices:
- in simple mode it starts numbering cylinders at 1... whereas
everything else starts from 0.
- in simple mode it shows blocks of 1024 bytes, which makes for half-blocks
(marked with a +) and sizes halved from the real block size.
- in expert mode it shows extended partitions offset from the start
of the extended partition.
- the hd/sec/cyl is a confusing order, as the sector number is computed
from cyl/hd/sec, in that order.
- it never shows and doesn't care about the real disk geometry.

You will notice that the 3rd primary partition is empty... this is where
I intend to stick my OpenBSD root partition (both DOS and BSD partitions),
and that I have left cylinders 601--992 empty... this is where I intend to
stick the rest of OpenBSD.
After OpenBSD is installed, partition 3 will show up as:
/dev/hda3          274      274      286    52416   a6  Unknown
/dev/hda3      2201472  2201472  2306303    52416   a6  Unknown

(recent Linux fdisk will display a6 as OpenBSD, but they still don't know
how to deal with the disklabel. Important: NEVER use Linux fdisk to fiddle
with OpenBSD disklabels.)


Before starting to install OpenBSD, now would be a good time to check the
INSTALL.pt document...  Especially note the alignment restriction of
partitions (first sector of a partition must be at head 0, sector 1 of a
cylinder). This is enforced by Linux' fdisk.

The other point to note is that extended partitions are actually linked
lists. This will show up in OpenBSD' fdisk.

Your clock and OpenBSD
----------------------
OpenBSD expects your hardware clock to be in universal time, and uses
time zones to give you local time. With Linux, this depends...
most distributions use a small program called hwclock to set up the
system time from the hardware clock when booting... there is a --utc
option if your hardware clock is in universal time, but this is not
always what happens by default.

For instance, on a redhat 5.1 system, this happens in /etc/rc.d/rc.sysinit
which loads an /etc/sysconfig/clock that defines a variable called UTC, and
then proceeds calling hwclock.
- ensure UTC is set to true,
- adjust your hardware clock from the system time if necessary, e.g.,
hwclock --systohc --utc.

The Linux partition table and OpenBSD
-------------------------------------
There is a problem with many Linux rc that do mount all file systems even
in single-user mode.  After you've installed OpenBSD, if your Linux kernel
knows about BSD disklabels, it may insert lots of BSD partitions in its
list. Then, at the next reboot, you're in trouble. The simplest way around
this problem is probably to make sure you can boot from a Linux kernel
that doesn't know about disklabels.   Otherwise, you may wish to check
your inittab and your rc to make deadly sure that single-user boot
will work.

The OpenBSD installation
------------------------
If you've got the space, you can install from your ext2fs partitions. This
is what I did, as I have a slip connection to the rest of the world, and
the OpenBSD install floppy does not include slip.

REMEMBER TO BACKUP ALL IMPORTANT DATA ON YOUR DISK BEFORE DOING THE
INSTALLATION !!!

So you cp floppy*.fs /dev/fd0, then reboot...

First, the BSD kernel + ram disk loads, then there is a boot prompt, and
five seconds later, the boot proper starts.

After a while, you will see your disk configuration scroll by.  I got:
  wd0 at wdc0 drive 0: <TOSHIBA MK4006MAV>
  wd0: 3909MB, 7944 cyl, 16 head, 63 sec, 512 bytes/sec, 8007552 sec total
  wd0: using 16-sector 16-bit pio transfers, lba addressing

at which point I got somewhat confused, especially as this is a configuration w
ith
more than 1024 cylinders.  In fact, this is the actual disk geometry, when
you inquire about it, but the geometry that the BIOS does see IS the fdisk
geometry, with 993 cylinders.  As the 1024 cylinders is purely a BIOS
limitation, there is no actual trouble.

If you want to be sure, enquire at the boot prompt:
boot>machine diskconfig
before the automatic boot sequence continues.


Then I got into fdisk, and I proceeded to enter my new OpenBSD partition.
This is what the fdisk dump looked after my changes:

Disk: wd0       geometry: 992/128/63 [7999488 sectors]
Offset: 0       Signatures: 0xAA55,0x0
         Starting        Ending
 #: id  cyl  hd sec -  cyl  hd sec [     start -       size]
-------------------------------------------------------------------------
 0: 06    0   1   1 -  259 127  63 [        63 -    2096577] DOS > 32MB
 1: 83  260   0   1 -  272 127  63 [   2096640 -     104832] Linux files*
 2: A6  273   0   1 -  285 127  63 [   2201472 -     104832] OpenBSD
 3: 05  286   0   1 -  600 127  63 [   2306304 -    2540160] Extended DOS

Selected extended partition 3
New MBR at offset 2306304.
Offset: 2306304 Signatures: 0xAA55,0x0
         Starting        Ending
 #: id  cyl  hd sec -  cyl  hd sec [     start -       size]
-------------------------------------------------------------------------
 0: 82  286   1   2 -  302 127  63 [   2306368 -     137024] Linux swap
 1: 05  303   0   1 -  455 127  63 [   2443392 -    1233792] Extended DOS
 2: 00    0   0   0 -    0   0   0 [   2306304 -          0] unused
 3: 00    0   0   0 -    0   0   0 [   2306304 -          0] unused

Selected extended partition 1
New MBR at offset 2443392.
Offset: 2443392 Signatures: 0xAA55,0x0
         Starting        Ending
 #: id  cyl  hd sec -  cyl  hd sec [     start -       size]
-------------------------------------------------------------------------
 0: 83  303   1   1 -  455 127  63 [   2443455 -    1233729] Linux files*
 1: 05  456   0   1 -  519 127  63 [   3677184 -     516096] Extended DOS
 2: 00    0   0   0 -    0   0   0 [   2443392 -          0] unused
 3: 00    0   0   0 -    0   0   0 [   2443392 -          0] unused

Selected extended partition 1
New MBR at offset 3677184.
Offset: 3677184 Signatures: 0xAA55,0x0
         Starting        Ending
 #: id  cyl  hd sec -  cyl  hd sec [     start -       size]
-------------------------------------------------------------------------
 0: 83  456   1   1 -  519 127  63 [   3677247 -     516033] Linux files*
 1: 05  520   0   1 -  536 127  63 [   4193280 -     137088] Extended DOS
 2: 00    0   0   0 -    0   0   0 [   3677184 -          0] unused
 3: 00    0   0   0 -    0   0   0 [   3677184 -          0] unused

Selected extended partition 1
New MBR at offset 4193280.
Offset: 4193280 Signatures: 0xAA55,0x0
         Starting        Ending
 #: id  cyl  hd sec -  cyl  hd sec [     start -       size]
-------------------------------------------------------------------------
 0: 83  520   1   1 -  536 127  63 [   4193343 -     137025] Linux files*
 1: 05  537   0   1 -  600 127  63 [   4330368 -     516096] Extended DOS
 2: 00    0   0   0 -    0   0   0 [   4193280 -          0] unused
 3: 00    0   0   0 -    0   0   0 [   4193280 -          0] unused

Selected extended partition 1
New MBR at offset 4330368.
Offset: 4330368 Signatures: 0xAA55,0x0
         Starting        Ending
 #: id  cyl  hd sec -  cyl  hd sec [     start -       size]
-------------------------------------------------------------------------
 0: 83  537   1   1 -  600 127  63 [   4330431 -     516033] Linux files*
 1: 00    0   0   0 -    0   0   0 [         0 -          0] unused
 2: 00    0   0   0 -    0   0   0 [   4330368 -          0] unused
 3: 00    0   0   0 -    0   0   0 [   4330368 -          0] unused

Nothing to it... you just follow the extended partition links using select,
jot down whatever you need, add the OpenBSD partition to look like you want
it to, and save everything.

After you leave fdisk, you get to the interesting part: the disklabel
itself. If all goes well, OpenBSD synthesizes a nice disklabel out of what
it can deduce from the disk, including the ext2fs partitions.

There are only a few subtleties to take care of:
- initially, you can ONLY edit the disklabel part that matches the OpenBSD
DOS partition (a `slice' in FreeBSD lingo). You have to use b 0 *  before
you can edit the whole disk.
- the real disk geometry becomes relevant. The Berkeley fast file system
can't use partial cylinder groups, hence BSD partitions should start
on cylinder boundaries, as any remaining sectors  will be lost anyway.
- units for size and offset can be given as sectors (default) or cylinders.

After edition, this is what my disklabel looks like:

# using MBR partition 2: type A6 off 2201472 (0x219780) size 104832 (0x19980)
# /dev/rwd0c:
type: ESDI
disk:
label: TOSHIBA MK4006M
flags:
bytes/sector: 512
sectors/track: 63
tracks/cylinder: 16
sectors/cylinder: 1008
cylinders: 7944
total sectors: 8007552
rpm: 3600
interleave: 1
trackskew: 0
cylinderskew: 0
headswitch: 0           # milliseconds
track-to-track seek: 0  # milliseconds
drivedata: 0

16 partitions:
#        size   offset    fstype   [fsize bsize   cpg]
  a:   104832  2201472    4.2BSD     1024  8192    16   # (Cyl. 2184 - 2287)
  b:   137024  2306368      swap                        # (Cyl. 2288 - 2423*)
  c:  8007552        0    unused        0     0         # (Cyl.    0 - 7943)
  d:   409248  4846464    4.2BSD     1024  8192    16   # (Cyl. 4808 - 5213)
  e:   511056  5255712    4.2BSD     1024  8192    16   # (Cyl. 5214 - 5720)
  f:   204624  5766768    4.2BSD     1024  8192    16   # (Cyl. 5721 - 5923)
  g:  1073520  5971392    4.2BSD     1024  8192    16   # (Cyl. 5924 - 6988)
  h:   962640  7044912    4.2BSD     1024  8192    16   # (Cyl. 6989 - 7943)
  i:  2096577       63     MSDOS                        # (Cyl.    0*- 2079*)
  j:   104832  2096640    ext2fs                        # (Cyl. 2080 - 2183)
  l:  1233729  2443455    ext2fs                        # (Cyl. 2424*- 3647*)
  m:   516033  3677247    ext2fs                        # (Cyl. 3648*- 4159*)
  n:   137025  4193343    ext2fs                        # (Cyl. 4160*- 4295*)
  o:   516033  4330431    ext2fs                        # (Cyl. 4296*- 4807*)

Things to check:
- this disklabel is saved in MBR2 (basic DOS partition 2), as expected.
- all the BSD partitions proper are aligned on a cylinder boundary.
the root partition begins at the precise same offset the corresponding DOS
partition begins, and it extends for the same length.
Other BSD partitions don't show up in the DOS partition setup, hence they
begin precisely on cylinder 601/4808.
- the ext2fs partitions have the exact same layout under the OpenBSD
disklabel.

One point that is somewhat laborious is that the disklabel -E mode
(which you are currently using) tends to move partitions around to ensure
that ALL defined partitions are contiguous. Hence, you may need some fiddling
around and printing to ensure that Linux partitions do show up where they
should.  In my case, disklabel moved the swap and all the ext2fs partitions
slightly, and I add to adjust them manually...

Once the disklabel is written to disk, the installation proceeds as usual.

ext2fs partitions are perfectly usable from OpenBSD. My /home partition
is ext2fs, I have been using it for a week now without any trouble.

Booting
-------
First time I booted my system back, I did not get into OpenBSD as expected...
I plain forgot I had installed lilo in the master boot block, and lilo
does not heed the active partition flag. The fix was rather simple: from
the Linux system, I just had to edit lilo.conf to add the obsd entry:

boot=/dev/hda
map=/boot/map
install=/boot/boot.b
prompt
timeout=50
image=/boot/myvmlinuz
   label=linux
   root=/dev/hda2
   vga=4
   read-only
image=/boot/vmlinuz-2.0.34-1
   label=redhat
   root=/dev/hda2
   read-only
other=/dev/hda1
   label=dos
   table=/dev/hda
other=/dev/hda3
   label=obsd
   table=/dev/hda

rerun lilo, and voila, OpenBSD was able to boot !

Linux and OpenBSD partitions
----------------------------
As of 2.0.35/2.1.122, Linux does not support OpenBSD partitions. The way
the Linux kernel works is reasonably straightforward (code in
drivers/block/genhd.c): when detecting a BSD partition (type A5),
it checks and parses the first block for a disklabel, and use that
information to instantiate some new partitions,
that will show up in that drive's partition list, exactly like extended
partitions do show up. Unfortunately, that check is hard coded for a type A5
(NetBSD/FreeBSD) partition, and it recognizes 8 partitions disklabels only
anyway.

Just hacking the Linux code to recognize A6 is not quite enough.  You also
need to trim down the resulting list of partitions, as your ext2fs
partitions will now show up twice !
I'm experimenting with the following patch, which should make it to linux-kerne
l
soon:
--------------------------------------------------------------
diff -ur linux.orig/drivers/block/genhd.c linux/drivers/block/genhd.c
--- linux.orig/drivers/block/genhd.c
Mon Aug  4 20:45:35 1997
+++ linux/drivers/block/genhd.c
Thu Sep 24 18:55:31 1998
@@@@ -205,11 +206,46 @@@@
 }

 #ifdef CONFIG_BSD_DISKLABEL
+static void check_and_add_bsd_partition(struct gendisk *hd, struct bsd_partiti
on *bsd_p)
+{
+
struct hd_struct *lin_p;
+

/* check relative position of partitions.  */
+
for (lin_p = hd->part + 1; lin_p - hd->part < current_minor; lin_p++) {
+


/* no relationship -> try again */
+

if (lin_p->start_sect + lin_p->nr_sects <= bsd_p->p_offset
+


|| lin_p->start_sect >= bsd_p->p_offset + bsd_p->p_size)
+


continue;

+


/* equal -> no need to add */
+

if (lin_p->start_sect == bsd_p->p_offset &&
+


lin_p->nr_sects == bsd_p->p_size)
+


return;
+


/* bsd living within dos partition */
+

if (lin_p->start_sect <= bsd_p->p_offset && lin_p->start_sect
+


+ lin_p->nr_sects >= bsd_p->p_offset + bsd_p->p_size) {
+#ifdef DEBUG_BSD_DISKLABEL
+


printk("w: %d %ld+%ld,%d+%d",
+



lin_p - hd->part, lin_p->start_sect, lin_p->nr_sects,
+



bsd_p->p_offset, bsd_p->p_size);
+#endif
+


break;
+

}
+


/* ouch: bsd and linux overlap. Don't even try for that partition */
+#ifdef DEBUG_BSD_DISKLABEL
+

printk("???: %d %ld+%ld,%d+%d",
+


lin_p - hd->part, lin_p->start_sect, lin_p->nr_sects,
+


bsd_p->p_offset, bsd_p->p_size);
+#endif
+

printk("???");
+

return;
+
} /* if the bsd partition is not described by DOS, we end up there */
+
add_partition(hd, current_minor, bsd_p->p_offset, bsd_p->p_size);
+
current_minor++;
+}
 /*
  * Create devices for BSD partitions listed in a disklabel, under a
  * dos-like partition. See extended_partition() for more information.
  */
-static void bsd_disklabel_partition(struct gendisk *hd, kdev_t dev)
+static void bsd_disklabel_partition(struct gendisk *hd, kdev_t dev, int max_pa
rtitions)
 {

struct buffer_head *bh;

struct bsd_disklabel *l;
@@@@ -225,19 +261,15 @@@@


return;

}

-
p = &l->d_partitions[0];
-
while (p - &l->d_partitions[0] <= BSD_MAXPARTITIONS) {
+
if (l->d_npartitions < max_partitions)
+

max_partitions = l->d_npartitions;
+
for (p = l->d_partitions; p - l->d_partitions <  max_partitions; p++) {


if ((current_minor & mask) >= (4 + hd->max_p))



break;
-
-

if (p->p_fstype != BSD_FS_UNUSED) {
-


add_partition(hd, current_minor, p->p_offset, p->p_size);
-


current_minor++;
-

}
-

p++;
+

if (p->p_fstype != BSD_FS_UNUSED)
+


check_and_add_bsd_partition(hd, p);

}

brelse(bh);
-
 }
 #endif

@@@@ -248,6 +280,11 @@@@

struct partition *p;

unsigned char *data;

int mask = (1 << hd->minor_shift) - 1;
+#ifdef CONFIG_BSD_DISKLABEL
+
/* no bsd disklabel as a default */
+
kdev_t bsd_kdev = 0;
+
int bsd_maxpart;
+#endif
 #ifdef CONFIG_BLK_DEV_IDE

int tested_for_xlate = 0;

@@@@ -365,13 +402,29 @@@@




hd->part[minor].nr_sects = 2;


}
 #ifdef CONFIG_BSD_DISKLABEL
+


/* tag first disklabel for late recognition */


if (SYS_IND(p) == BSD_PARTITION) {
-


printk(" <");
-


bsd_disklabel_partition(hd, MKDEV(hd->major, minor));
-


printk(" >");
+


printk("!");
+


if (!bsd_kdev) {
+



bsd_kdev = MKDEV(hd->major, minor);
+



bsd_maxpart = BSD_MAXPARTITIONS;
+


}
+

} else if (SYS_IND(p) == OPENBSD_PARTITION) {
+


printk("!");
+


if (!bsd_kdev) {
+



bsd_kdev = MKDEV(hd->major, minor);
+



bsd_maxpart = OPENBSD_MAXPARTITIONS;
+


}


}
 #endif

}
+#ifdef CONFIG_BSD_DISKLABEL
+
if (bsd_kdev) {
+

printk(" <");
+

bsd_disklabel_partition(hd, bsd_kdev, bsd_maxpart);
+

printk(" >");
+
}
+#endif

/*

 *  Check for old-style Disk Manager partition table

 */
diff -ur linux.orig/include/linux/genhd.h linux/include/linux/genhd.h
--- linux.orig/include/linux/genhd.h
Wed Mar 18 20:25:30 1998
+++ linux/include/linux/genhd.h
Thu Sep 24 18:55:43 1998
@@@@ -69,12 +70,19 @@@@
 #ifdef CONFIG_BSD_DISKLABEL
 /*
  * BSD disklabel support by Yossi Gottlieb <yogo@@math.tau.ac.il>
+ *
+ * updated by Marc Espie <Marc.Espie@@openbsd.org>
  */

+/* check against BSD src/sys/sys/disklabel.h for consistency */
+
 #define BSD_PARTITION

0xa5
/* Partition ID */
+#define OPENBSD_PARTITION
0xa6

 #define BSD_DISKMAGIC
(0x82564557UL)
/* The disk magic number */
 #define BSD_MAXPARTITIONS
8
+#define OPENBSD_MAXPARTITIONS 16
+
 #define BSD_FS_UNUSED

0
/* disklabel unused partition entry ID */
 struct bsd_disklabel {

__u32
d_magic;

/* the magic number */
----------------------------------------------------------------------
It does:
- trigger the recognition of OpenBSD disklabels,
- force bsd partitions to appear at the end of the partition list,
- check the bsd disklabel for redundancy and consistency with the dos
partition table, so that the same partition does not show up twice.

You also need a working ufs, such as
<ftp://sunsite.unc.edu/pub/Linux/ALPHA/ufs/u2fs-0.4.3.tar.gz>
This package yields a new module, plus a small patch to tie the module
with the rest of the Linux kernel. I would recommend checking that patch
manually, as Linux module information tends to vary widely, and it is
pretty trivial to add by hand anyway.

Running Linux binaries under OpenBSD
------------------------------------
You just have to recompile your BSD kernel with COMPAT_LINUX, and set up
/emul/linux as explained in compat_linux(1).

It's a good idea to mount your Linux file system under another point, then
make symbolic links so that you can control what gets used precisely.
Don't bother with the ports emul/linux_lib entry: it's only a set of Linux
libraries for people who don't have a Linux system running.

As of this writing, most applications work, apart from sound.

The Linux sound devices use differing ioctl from OpenBSD, hence anything that
needs to change the audio mode won't work, and produce audio garbage at best.

A small detail that may cause problems: uname still says `OpenBSD', even
under Linux compatibility.  The reason behind that is that we don't want
netscape to tell it was run from a Linux box, when it is used under
OpenBSD.

Some programs, for instance maple, do depend on uname answering `Linux'.
For maple, this is straigthforward: you just have to fudge
/usr/local/maple/bin/maple.system.type to check OpenBSD in the same
class with Linux.

Similar shell scripts are easy to fix.  Binary programs that don't run
suid can be coerced by using LD_PRELOAD.

As a rule, this should be achieved on a program-by-program basis.
The more networking programs that do tell they're running under OpenBSD,
the merrier !



   [1][Back to Main Index] [2][To Section 11.0 - OpenBSD 2.4 Specific
   Information]

                           12.0 - Performance Tuning
     _________________________________________________________________

12.1 - Networking

   If you run a busy server, gateway or firewall, you should make sure to
   prevent memory starvation to various parts of the kernel described
   below.

   The [3]options(4) man page talks about the options presented.

   An option you may need to chane for a busy server, gateway or firewall
   is NMBCLUSTERS. This controls the size of the kernel mbuf cluster map.
   On your computer, if you get messages like "mb_map full", you need to
   increase this value. If traffic on a networking interface stops for no
   apparent reason, this may also be a sign that you need to increase
   this value. A reasonable value on the i386 port with most 100Mbps
   ethernet interfaces (no matter how many the machine has) is 8192.
   option NMBCLUSTERS=8192

12.2 - Disk I/O

   Disk I/O speed is a significant factor in the overall speed of your
   computer. It becomes increasingly important when your computer is
   hosting a multi-user environment (users of all kinds, from those who
   log-in interactively to those who see you as a file-server or a
   web-server.) Data storage constantly needs attention, especially when
   your partitions run out of space and when your disks fail. OpenBSD has
   several options to increase the speed of your disk operations and
   provide fault tolerance.

  CCD

       The first option is the use of [4]ccd(4), the Concatenated Disk
       Driver. This allows you to join several partitions into one
       virtual disk (and thus, you can make several disks look like one
       disk). This concept is similar to that of LVM, which is found in
       many commercial Unix flavors.
       If you are running GENERIC, ccd is already enabled. If not, you
       may need to add it to your kernel configuration. To start setup of
       ccd, you need to add support for it in your kernel. A line such
       as:

pseudo-device   ccd     4       # concatenated disk devices

   The above example gives you up to 4 ccd devices (virual disks). Now
   you need to figure out what partitions on your real disks that you
   want to dedicate to ccd. Use disklabel to mark these partitions as
   type 'ccd'. On some architectures, disklabel may not allow you to do
   this. In this case, mark them as 'ffs'.

   If you are using ccd to gain performance by striping, note that you
   will not get optimum performance unless you use the same model of
   disks with the same disklabel settings.

   Edit /etc/ccd.conf to look something like this: (for more information
   on configuring ccd, look at [5]ccdconfig(8))
# Configuration file for concatenated disk devices
#
# ccd   ileave  flags   component devices
ccd0   16      none    /dev/sd2e /dev/sd3e

   To make your changes take effect, run
# ccdconfig -C

   As long as /etc/ccd.conf exists, ccd will automatically configure
   itself upon boot. Now, you have a new disk, ccd0, a combination of
   /dev/sd2e and /dev/sd3e. Just use disklabel on it like you normally
   would to make the partition or partitions you want to use. Again,
   don't use the 'c' partition as an actual partition that you put stuff
   on. Make sure your useable partitions are at least one cylinder off
   from the beginning of the disk.

  RAID

       Another solution is [6]raid(4) which will have you use
       [7]raidctl(8) to control your raid devices. OpenBSD's RAID is
       based off of Greg Oster's [8]NetBSD port of the CMU [9]RAIDframe
       software. OpenBSD has support for RAID levels of 0, 1, 4, and 5.
       With raid, as with ccd, support must be in the KERNEL. Unlike ccd,
       support for RAID is not found in GENERIC, it must be compiled into
       your kernel (RAID support adds some 500K to the size of an i386
       kernel!)

pseudo-device   raid   4       # RAIDframe disk device

   Setting up RAID on Sun^H^H^Hsome operating systems is confusing and
   painful to say the least. Not so with RAIDframe. Read the [10]raid(4)
   and [11]raidctl(8) man pages to get the whole scoop, there are too
   many options and possible configurations which are beyond the scope of
   this document.

  Filesystem Buffer

   For fileservers with memory to spare, you can increase
       BUFCACHEPERCENT. That is, what percentage of your RAM should you
       use as a file system buffer. This option may change when the
       Unified Buffer Cache is completed and is part of OpenBSD. In the
       mean time, to increase BUFCACHEPERCENT, you should add a line to
       your kernel configuration like this:

   option BUFCACHEPERCENT=30

   Of course you can make it as low as 5 percent (the default) or as high
   as 50 percent (or more.)

  Soft updates

   Another tool that can be used to speed up your system is softupdates.
       One of the slowest operations in the traditional BSD file system
       is updating metainfo (which happens, among other times, when you
       create or delete files and directories.) Softupdates attempts to
       update metainfo in RAM instead of writing to the hard disk each
       and every single metainfo update. Another effect of this is that
       the metainfo on disk should always be complete, although not
       always up to date. So, a system crash should not require fsck upon
       boot up, but simply a background version of fsck that makes
       changes to the metainfo in RAM (a la softupdates). This means
       rebooting a server is much faster, because you don't have to wait
       for fsck! (OpenBSD does not have this feature yet.) You can read
       more about softupdates in the [12]softupdates FAQ entry. If you
       use softupdates, you will most certainly want to take advantage of
       the Tuning kmem section below.

12.3 - Tuning kmem

   If you start using the performance tuning measures above, you may
   start running out of kernel memory. If you start getting panics like
   "out of space in kmem_map" then you need to try
   option NKMEMCLUSTERS=8192

   Note that 8192 is valid for the i386 architecture, but may be too
   little or too much for others. Look at /usr/include/machine/param.h to
   see more information.

   You may also want to increase the number of static kernel maps and
   entries. The default value for these options is architecture dependant
   and is specified in /sys/vm/vm_map.h. If you are using soft updates,
   the following values should keep you going!
   option MAX_KMAP=120
       option MAX_KMAPENT=6000

12.4 - Hardware choices

   (Note- this section is heavily centered around the i386, or PC,
   architecture. That is to say... other architectures don't give you
   quite as many choices!)

   The performance of your applications depends heavily on your OS and
   the facilities it provides. This may be part of the reason that you
   are using OpenBSD. The performance of your applications also depends
   heavily on your hardware. For many folks, the Price/Performance ratio
   of a brand new PC with a Intel Pentium III or AMD Athlon processor is
   much better then the Price/Performance ratio of a Sun UltraSparc 60!
   And, the price of OpenBSD can't be beat.

   If you are shopping for a new PC, whether you are buying it piece by
   piece or completely pre-built, you want to make sure first that you
   are buying reliable parts. In the PC world, this is not easy. Bad or
   otherwise unreliable or mismatched parts can make OpenBSD run poorly
   and crash often. The best advice we can give is to be careful, buy
   brands and parts that have been reviewed by an authority you trust.
   Sometimes, when you skimp on the price of a PC, you lose in quality!

   There are certain things that will help bring out the maximum
   performance of your hardware:
     * Use multiple disks.
       Instead of buying one 20GB disk, buy multiple 4GB or 9GB disks.
       While this may cost more, distributing the load over multiple
       spindles will decrease the amount of time necessary to access data
       on the disks. And, with more spindles, you will get more
       reliability and faster data access with RAID.
     * Use SCSI where you can.
       If you are building a server, and you need more then 10GB of disk
       space, the SCSI architecture is the best choice. IDE limits you to
       two disks per controller. Wide SCSI limits you to 15 per
       controller! While SCSI costs more, the flexibility and performance
       can justify these costs. IDE was not designed for use in a
       mult-user, mult-tasking environment.
     * Use SDRAM.
       This option applies mainly to PCs. Most other architectures don't
       give you a choice of what kind of RAM you can use. Several PCs
       still do. Avoid SIMMs, as there are not many companies
       manufacturing them anymore, and in some cases they cost more then
       equivalent SDRAM!
     * Use ECC or parity RAM.
       Parity adds some functionality to see if the data in RAM has been
       corrupted. ECC extends this functionality and attempts to correct
       some bit corruption errors on the fly. This option applies mainly
       to PCs. Most other architectures simply require parity or ECC
       capable RAM. Several non-PC computers won't even boot with
       non-parity RAM. If you aren't using ECC/parity RAM, you may get
       data corruption and other abnormalities. Several manufacturers of
       "cheap PC RAM" don't even make an ECC variety! This will help you
       avoid them! PC manufacturers often sell several product lines,
       divided around "servers" and "workstations." The servers will
       incorporate ECC RAM into their architecture. Unix workstation
       manufacturers have been using parity (and now ECC) for several
       years in all of their product lines.
     * Avoid ISA devices.
       While most folks avoid ISA devices, because they are generally
       hard to configure and out of date, there are still plenty in
       existance. If you are using the ISA bus for your disk or network
       controllers, (or even worse, for both) remember that the ISA bus
       itself can be a performance bottleneck. If you need speed, look to
       PCI. Of course, there are still several ISA bus cards that work
       just fine. Unfortunately, most of these are sound cards and serial
       port cards.

   [13][Back to Main Index] [14][To Section 11.0 - OpenBSD 2.4 Specific
   Information]
     _________________________________________________________________

   [15][back] [16]www@@openbsd.org
   $OpenBSD: faq12.html,v 1.8 1999/06/28 02:11:11 ericj Exp $

References

   1. http://www.openbsd.org/faq/index.html
   2. http://www.openbsd.org/faq/faq24.html
   3. http://www.openbsd.org/cgi-bin/man.cgi?query=options&apropos=0&sektion=4&format=html
   4. http://www.openbsd.org/cgi-bin/man.cgi?query=ccd&apropos=0&sektion=4&format=html
   5. http://www.openbsd.org/cgi-bin/man.cgi?query=ccdconfig&apropos=0&sektion=8&format=html
   6. http://www.openbsd.org/cgi-bin/man.cgi?query=raid&apropos=0&sektion=4&format=html
   7. http://www.openbsd.org/cgi-bin/man.cgi?query=raidctl&apropos=0&sektion=8&format=html
   8. http://www.cs.usask.ca/staff/oster/raid.html
   9. http://www.pdl.cs.cmu.edu/RAIDframe/
  10. http://www.openbsd.org/cgi-bin/man.cgi?query=raid&apropos=0&sektion=4&format=html
  11. http://www.openbsd.org/cgi-bin/man.cgi?query=raidctl&apropos=0&sektion=8&format=html
  12. http://www.openbsd.org/faq/faq4.html#4.9
  13. http://www.openbsd.org/faq/index.html
  14. http://www.openbsd.org/faq/faq24.html
  15. http://www.openbsd.org/faq/index.html
  16. mailto:www@@openbsd.org


MINI-FAQ: Upgrading OpenBSD

  Latest OpenBSD Version - 2.5

    Kjell Wooding <[1]kwooding@@codetalker.com>

   Last Update - 03 Jun 1999

     If you've ever tried compiling the -current sources from an older
     OpenBSD release, you're aware that the process isn't always
     straightforward. This Mini-FAQ is an attempt to address the most
     common issues encountered when upgrading between OpenBSD releases,
     or from the releases to -current

  1.0: General Upgrade Questions

   [2]1.1: Terminology. What is -current? What are Snapshots?
   [3]1.2: What is the easiest way to upgrade to -current?
   [4]1.3: I looked, but didn't see any snapshots on the FTP site. Where
   did they go?
   [5]1.4: How do I get the latest source?
   [6]1.5: Okay, I have the tree. How do I build it.
   [7]1.6: My make build stopped halfway. Do I have to redo the whole
   thing?

  2.0: Upgrading from 2.3

   [8]2.1: What are the major problems upgrading from 2.3 to 2.4?
   [9]2.2: I tried the build, but it failed when trying to compile
   ssleay.
   [10]2.3: I tried the build, but it failed when trying to make
   something for the PowerPC.

  3.0: Upgrading from 2.4

   [11]3.1: What are the major problems upgrading from 2.4 to 2.5?
   [12]3.2: I tried the build, but it failed on cap_mkdb.

  4.0: Upgrading from 2.5

   [13]4.1: What are the major problems upgrading from 2.5 to -current?
   [14]4.2: How do I upgrade gcc to egcs

     [15]4.2.1 - i386 and sparc are no longer #define'ed
     [16]4.2.2 - Build fails in xlint
     [17]4.2.3 - Core Dump on uthread_autoinit.c
     [18]4.2.4 - egcs seems much slower than gcc
     [19]4.2.5 - egcs generates larger code than gcc
     [20]4.2.6 - After installing egcs I have very little disk space
     left

   [21]4.3: My make build dies with unimplemented syscall errors.

                           _____________________

  1.0: General Upgrade Questions

    1.1: Terminology. What is -current? What are Snapshots?

   Unlike Operating System projects like Linux and FreeBSD, OpenBSD
   development happens from a single source tree. On approximately
   six-month intervals, OpenBSD releases are produced. These are numbered
   in the conventional (2.x) manner. The current OpenBSD release is 2.5.

   -current, short for openbsd-current, refers to the up-to-the-minute
   version of the source tree contained in the CVS repository. This is
   the tree most commonly used by OpenBSD developers. The -current tree
   contains all the code that is planned for the next release. From time
   to time, brave souls will abandon the formal releases and run
   openbsd-current, usually to take advantage of features that have not
   yet made it into the formal releases. Because of its uncertain nature,
   however, upgrading to -current is not recommended for non-technical
   users.

   Between formal releases, a series of snapshot releases are [22]made
   available. Snapshots are test releases of the -current source tree.
   Because they reflect the current state of development, there is no
   guarantee that snapshot releases will work correctly (or even at all).
   Snapshots are quite useful when moving from a formal release (or older
   version of -current) to the current tree.

    1.2: What is the best way to upgrade to -current?

   Due to changes in the underlying libraries, moving directly from a
   release to -current is not always easy. The most painless way to move
   up to -current is to first upgrade to the latest snapshot (usually,
   via an FTP install). Once the snapshot is installed, the latest source
   can be [23]fetched and [24]built. This procedure should eliminate most
   toolchain and library problems.

    1.3: I looked, but didn't see any snapshots on the FTP site. Where did they
    go?

   The snapshots used to be taken temporarily offline right around the
   release time of a new version. This is no longer the OpenBSD policy.

   Snapshots may be removed as they become old (or no longer relevant).
   If no snapshot is available, you should upgrade to the most recent
   release and build the remainder of the way from source.

    1.4: How do I get the latest source?

   Short answer: [25]http://www.openbsd.org/anoncvs.html

   For example. To retrieve the entire tree via CVS: (using the bash
   shell. Others substitute setenv for export)
 # export CVSROOT=anoncvs@@anoncvs.ca.openbsd.org:/cvs
 # export CVS_RSH=/usr/local/bin/ssh
 # cd /usr
 # cvs -q get -PA src

    1.5: Okay, I have the tree. How do I build it.

   Basic instructions are in /usr/src/Makefile. This is a slightly
   expanded version.

1. Clean out the old object files.

   If you created a separate /usr/obj directory, clean that, and
   rebuild the symbolic links:

   # rm -rf /usr/obj
   # mkdir /usr/obj
   # cd /usr/src
   # make obj

   If you're worried there are object files in your source tree,
   do this:

   # cd /usr/src
   # find . -type l -name obj | xargs rm
   # make cleandir
   # rm -rf /usr/obj
   # mkdir /usr/obj
   # make obj

2. Perform any verion-specific configuration changes. For example,
   2.3 users must add the named user and group before
   moving to 2.4 or later. See the specific Mini-FAQ section for
   your version.

3. Make sure all the appropriate directories are created. This
   is especially important when upgrading from older versions, but is
   sometimes necessary in other cases. The easiest way to do this is:

   # cd /usr/src/etc && make DESTDIR=/ distrib-dirs

4. Compile a new kernel.

   # cd /usr/src/sys/arch/`machine`/conf
   # cp GENERIC MYKERNEL
   # vi MYKERNEL
   (edit MYKERNEL to your liking)
   # config MYKERNEL
   # cd ../compile/MYKERNEL
   # make clean && make depend && make
   (arc architecture only) copy bsd.ecoff to your FAT partition
   # cp /bsd /bsd.old && cp bsd /bsd
   # chown root.wheel /bsd (if you compiled as someone else)
   (reboot)

5. Compile the system.

   # cd /usr/src
   # make build

6. Update /etc and /dev by hand. These are not updated
   automatically. Choose a directory with enough space to
   hold /, /dev, /var, and /etc. Here I'll use /home/newroot
   (Note: make sure the directory hierarchy you choose
   does not have group write (g+w) or other write (o+w)
   permissions or sendmail will complain during this step.
   This makes /tmp a bad choice):

   # mkdir /home/newroot
   # export DESTDIR=/home/newroot
   # cd /usr/src/etc && make distribution-etc-root-var

   Now compare the files in /home/newroot with their
   installed counterparts. Replace or update the files as
   necessary.

   # rm -rf /home/newroot   (when done)

7. Reboot to make sure the new /etc files are correct

    1.6: My make build stopped halfway. Do I have to redo the whole thing?

   I would, but if you really want to pick up where you left off, do a:
 # cd /usr/src
 # make -n build

   This will show you what make build is doing. For example, mine tells
   me:
 (cd /usr/src/share/mk &&  make install)
 (cd /usr/src/include;  make includes)
 make cleandir
 (cd /usr/src/lib && make depend && make &&   make install)
 (cd /usr/src/gnu/lib && make depend && make &&   make install)
 (cd /usr/src/kerberosIV && make build)
 make depend && make &&  make install

   To pick up where you left off, just reissue the commands from the
   point where the compile died.

   If you do this procedure a lot, you may want to create a new target in
   your makefile. Simply copy the entry for build (to build-noclean, for
   example), and remove the make cleandir reference.

  2.0: Upgrading from 2.3

    2.1: What are the major problems upgrading from 2.3 to 2.4?

    New User: named

   After 2.3, the named DNS daemon was moved to a chroot jail. To make
   this change possible, the named user was created. If you do not have
   it already, you will need to create this user to ensure that all
   directories get created properly during the build process.

   Add the following entry to /etc/passwd using vipw
   named:*:70:70::0:0:BIND Daemon:/var/named:/sbin/nologin

   Add the following to /etc/group:
   named:*:70:

    2.2: I tried the build, but it failed when trying to compile ssleay.

   You are likely missing an entry for the named user in your password
   file.

   Short Answer:

   Create this user prior to the build.

   Long Answer:

   The named user is required in order to set permissions correctly. If
   this user is missing, part of the build process fails. If you capture
   your build to a file (say, with a make build &>/tmp/build.log) you
   will notice the following message:
  (cd /usr/src/etc && make DESTDIR=/ distrib-dirs)
  install -d -o root -g wheel -m 755 /
  mtree -def mtree/4.4BSD.dist -p // -u

  mtree: unknown user named
  mtree: failed at line 1632 of the specification
  *** Error code 1 (ignored)

   Unfortunately for us, the build continued happily on its way, totally
   ignoring the fact that an error occurred.

   If the named user exists, mtree works properly:
  missing: ./var/named (created)
  missing: ./var/named/dev (created)
  missing: ./var/named/etc (created)
  missing: ./etc/afs (created)
  missing: ./etc/ssl (created)
  missing: ./etc/ssl/private (created)
  missing: ./usr/obj (not created: File exists)
  missing: ./usr/share/doc/html (created)
  missing: ./usr/share/doc/html/lynx_help (created)
  missing: ./usr/share/doc/html/lynx_help/keystrokes (created)
  missing: ./usr/share/doc/usd/13.viref (created)
  missing: ./usr/share/man/cat4/powerpc (created)
  missing: ./usr/share/man/man4/alpha (created)
  missing: ./usr/share/man/man4/pmax (created)
  missing: ./usr/share/man/man4/powerpc (created)
  missing: ./usr/share/tmac/mdoc (created)
  missing: ./var/www/htdocs/manual/vhosts (created)
  missing: ./usr/include/ssl (created)

   The reason for the fail, then, is that the /usr/include/ssl directory
   was never created. Without the header files, the ssleay build fails.

   Fix:

   Create the named user and group. Remove /usr/include/ssl, /var/named,
   and any other directory from the list above that was mistakenly
   created as a normal file by the make build.

    2.3: I tried the build, but it failed when trying to make something for the
    PowerPC.

   Your directory tree is incomplete. Specifically, the
   /usr/share/man/cat4/powerpc directory is missing.

   Quick Fix:

   Create this directory and proceed with the compilation

   Complete Fix:

   Create the entire directory tree. Do a:
  # cd /usr/src/etc && make DESTDIR=/ distrib-dirs

   You will likely see an output like the following:
  install -d -o root -g wheel -m 755 /
  mtree -def mtree/4.4BSD.dist -p // -u

  missing: ./var/named (created)
  missing: ./var/named/dev (created)
  missing: ./var/named/etc (created)
  missing: ./etc/afs (created)
  missing: ./etc/ssl (created)
  missing: ./etc/ssl/private (created)
  missing: ./usr/obj (not created: File exists)
  missing: ./usr/share/doc/html (created)
  missing: ./usr/share/doc/html/lynx_help (created)
  missing: ./usr/share/doc/html/lynx_help/keystrokes (created)
  missing: ./usr/share/doc/usd/13.viref (created)
  missing: ./usr/share/man/cat4/powerpc (created)
  missing: ./usr/share/man/man4/alpha (created)
  missing: ./usr/share/man/man4/pmax (created)
  missing: ./usr/share/man/man4/powerpc (created)
  missing: ./usr/share/tmac/mdoc (created)
  missing: ./var/www/htdocs/manual/vhosts (created)
  missing: ./usr/include/ssl (created)

   Note that /usr/share/man/cat4/powerpc was one of the directories
   created by this process.

  3.0: Upgrading from 2.4

    3.1: What are the major problems upgrading from 2.4 to 2.5?

    cap_mkdb

   The syntax for invoking cap_mkdb has changed slightly. Before doing a
   make build, rebuild cap_mkdb from the latest source:
# cd /usr/src/usr.bin/cap_mkdb
# make clean && make && make install

   The make build should then run to completion

    Man Page Changes

   Several man pages were moved from section 1 to later sections
   Unfortunately, if the old man pages are left in section 1, unwary
   users will not see the latest version of the page.

   The following pages should be removed:
/usr/share/man/cat1/ipf.0
/usr/share/man/cat1/ipnat.0
/usr/share/man/cat1/ipsecadm.0

    Snake

   You will need to remove the contents of the obj directory before
   upgrading /usr/src/games/snake.

    3.2: I tried the build, but it failed on cap_mkdb.

   Symptom:

   A make build resulted in an error like this:
  cap_mkdb -i -f terminfo terminfo.src
  cap_mkdb: illegal option -- i
  usage: cap_mkdb [-v] [-f outfile] file1 [file2 ...]
  *** Error code 1

   Quick Fix:

   You need to build a new cap_mkdb. See [26]3.1.

  4.0: Upgrading from 2.5

    4.1: What are the major problems upgrading from 2.5 to -current?

      perl and make

   The latest version of Perl (5.005_03) requires a new version of make
   to compile properly. You must rebuild make before building the new
   Perl. Do a:
# cd /usr/src/usr.bin/make
# make clean && make && make install

   Then go ahead and rebuild the new Perl. You will need to clean out the
   Perl obj directory by hand before building.

   Perl developers should take note of the latest changes. From
   millert@@openbsd.org:
The version of perl in the OpenBSD source tree (post 2.5) has been
upgraded to 5.005_03.  The build method has changed somewhat but
most of that should be invisible.  The important changes that affect
people are as follows:

    1) Perl lib files have moved from /usr/lib/perl5 to the more correct
       /usr/libdata/perl5
    2) The default site_perl directories now live in /usr/local.  Ie:
       if you install a perl module, it will place itself in
       /usr/local/libdata/perl5/site_lib.  This makes it easy to
       see what non-stock modules you have.  It also means that we
       can have perl modules in the ports system easily.
    3) The perl library man pages are now install in /usr/share/man/cat3p
       You'll need to update your man.conf based on the src/etc/man.conf
       to take advantage of them.  This means you can now do
       "man 3p less" and get info on the less pragma but "man less"
       will still get you the less pager manpage.

If you have modules or other non-stock perl files the simplest thing
to do is to move /usr/lib/perl5 to /usr/libdata/perl5 and add a link
from /usr/lib/perl5 to /usr/libdata/perl5.  Alternately, you could
just edit the installed Config.pm file and fix up the paths there.

      Compiler Change: egcs replaces gcc

   This change is likely the most significant change you will encounter.
   For detailed instructions, see section [27]4.2.

      Kernel Structure - statfs - changed

   The statfs structure has changed as of May 31. You must rebuild your
   kernel before attempting a make build. See [28]4.3 for details.

    4.2: How do I upgrade gcc to egcs

   The safest way will be to upgrade to a recent snapshot, once one is
   available. Until then (or for the brave of heart) read the following
   carefully.

   First, note that some platforms have not been bootstrapped
   successfully yet. To date, the following should work, if you are
   careful:
     * i386
     * sparc
     * m68k
     * alpha

   mips and rs6000 have problems.

   To test whether your platform can be bootstrapped, grab and install
   the egcs-snapshot, available from the [29]ports collection. If this
   works, the in-tree version likely will, too. This is the safest method
   of proceeding.

   Now, before going any futher, ensure that your copies of binutils,
   gas, and ld are up to date. Note that there are two copies of gas and
   ld in the tree. On i386 and sparc, the binutils versions are not used.
   Check /usr/src/gnu/usr.bin/gas and /usr/src/gnu/usr.bin/ld instead.

   To bootstrap to the in-tree egcs, read the following carefully.

   From espie@@openbsd.org:

Today, the compiler changes.

Exit gcc 2.8.1, enter egcs... or more precisely, gcc 2.95 prerelease.

This is probably going to be a rough ride, but I can't work out all
the kinks on every architecture by myself.

I'm going to start importing stuff *now*. There will be a second message
to tech@@ once things are settled...

Thanks to everyone who helped me sorting stuff out, most especially
niklas, turan, and millert.

Why the switch
--------------
as most of you already know, egcs is now the *official* compiler supported
by the FSF.  The upcoming july release as been re-christened gcc 2.95.

Just looking at the log messages will show you many improvements:
support for newer processors is better, C++ is more accurately matching
the ANSI/ISO standards, Fortran 77 is more closely integrated.
There are also countless bug-fixes and code generation improvements.

Also the development is more open. There is a cvs tree, there are several
mailing-lists available, and we are cooperating closely with the egcs
team. More precisely, I've been feeding patches back to the egcs team
so that OpenBSD configurations are officially supported.
Also, the development team is highly responsive to bug-reports, and problems
get fixed.

There also is a band-wagon phenomenon: everyone is switching to egcs,
which means lots of code to test the compiler on, and that we can benefit
from related projects.

Why now
-------
egcs-1.1 was unfit for some purposes. Specifically, code size on i386
was larger than gcc 2.8.1, which yielded floppy-disks problems.
At 2.5 freeze, the only code fit to include was a somewhat unstable
snapshot.  In the interest of stability, after much pondering, egcs was
not put into 2.5.

Right now, the egcs project is going through a release cycle which will
yield egcs 1.2.  Judging from their time schedule, there is ample margin
between egcs 1.2 and the next release of OpenBSD.  Also, we want to get
in now, so that we get a chance to report problems on less frequently
used architectures, and get everything fixed for 1.2.

egcs `feature freeze' is supposed to occur on may 7th, and the current
snapshot 19990502 looks solid.

What works and what doesn't
---------------------------
egcs runs an i386 OpenBSD system without problems.  m68k works as well,
with a few work-arounds linked to obscure bugs that will get fixed.
sparc seems to be running as well.  There is some linker trouble on some
other arches that needs to be fixed before our next release.

Right now, constructors across dynamic libraries are not quite ready.

egcs now features a stand-alone cpp which is going to be better than
the current hackish solution we use. This means a few interface changes
and possibly weird warnings.

Keeping gcc 2.8.1 ?
-------------------
due to size constraints, as soon as egcs is imported, gcc is going
to move to cvs Attic.  If you don't want to deal with egcs now, you'll
have to be careful through your cvs updates.
Some Makefiles are bound to change: includes, gnu/usr.bin, and gnu/lib.
xlint and cpp.sh are going to change as well.

How to bootstrap the compiler
-----------------------------
the simplest way is probably to trust the various arch maintainers
and download a snapshot.

If you want to do stuff the hard way, you must first remake proper
obj dirs:
cd /usr/src
make obj

If you run i386, gas must be up-to-date.
If you run sparc, ld must be up-to-date.

then build libiberty:
cd /usr/src/gnu/egcs/libiberty
make -f Makefile.bsd-wrapper clean
make -f Makefile.bsd-wrapper depend
make -f Makefile.bsd-wrapper
make -f Makefile.bsd-wrapper install

then the C compiler:
cd /usr/src/gnu/egcs/gcc
make -f Makefile.bsd-wrapper clean
make -f Makefile.bsd-wrapper depend
make -f Makefile.bsd-wrapper
make -f Makefile.bsd-wrapper install

rebuild the C compiler with the new version:
cd /usr/src/gnu/egcs/gcc
make -f Makefile.bsd-wrapper clean
make -f Makefile.bsd-wrapper depend
make -f Makefile.bsd-wrapper
make -f Makefile.bsd-wrapper install

rebuild the includes
cd /usr/src/include
make includes

build all egcs libraries and install them
cd /usr/src/gnu/egcs
make -f Makefile.bsd-wrapper clean
make -f Makefile.bsd-wrapper depend
make -f Makefile.bsd-wrapper
make -f Makefile.bsd-wrapper install

install the new cpp driver
cd /usr/src/usr.bin/cpp
make install

then you're all set, and a standard make build should work...

     [author note: Actually, it doesn't quite work. xlint will fail to
     build. The fix is simple though. Simply do a make && make install
     in the /usr/src/usr.bin/xlint/xlint directory before you attempt a
     make build and proceed. See [30]4.2.2.]
If it doesn't, you're using an arch that didn't go through make build yet.
The most probably occurrence is an Internal Compiler Error, as known as an
ICE.

First try to see if the ICE will go away with -O1 or -O0. In that case, you
can put a work-around in the Makefile until it's fixed
(see /usr/src/lib/libm/Makefile for an example of how to put in such
work-arounds for m68k).

Then the error needs to be reported to the egcs-bugs mailing list.

At a minimum, you must run the source through the same compiler invocation,
with an addition of -v -save-temps to the options.

-v yields the precise sequence of commands invoked by gcc. -save-temps
will give you a pre-processed C file (.i) or C++ (.ii) that the egcs people
can make sense of... you can't ask them to run OpenBSD on their boxes.

If you have more time, you can try to trim down the pre-processed C file to
the bare minimum that triggers the bug. Dichotomy works nicely.

   If you made it through this procedure, and everything is still
   working, congratulations. If not, check the following sections for
   advice. Problems not listed here should be posted to tech@@openbsd.org.

      4.2.1 - i386 and sparc are no longer #define'ed

   This is true. egcs uses the cleaner __i386__ and __sparc__. If you
   need to compile code that relies on the old defines, add a -Dsparc or
   -Di386 to the appropriate location of your Makefile.

      4.2.2 - Build fails in xlint

   This is due to semantic differences in cpp. The workaround is simple,
   and similar to the cap_mkdb issue described in [31]3.1.

   Do a:
# cd /usr/src/usr.bin/xlint/xlint
# make && make install

   now re-run make, and the build should continue.

      4.2.3 - Core Dump on uthread_autoinit.c

   You have fallen victim to a linker bug. Here's a relevant message:
   From: Marc Espie
   Subject: egcs core-dumping on uthread_autoinit.c

   If this happens to you, this is a known linker problem... the cc1 you have
   was linked in a weird way.

   Initially, I made cc1 link against static /usr/lib/libiberty.a to avoid this
   problem, but this was cutting things too close, and the bug reappeared,
   probably thanks to unrelated changes in libc or elsewhere...

   The tree has been patched with a work-around in

   src/gnu/egcs/f/lang-options.h

   make sure you have the kludged version of that file (at least rev 1.2),
   recompile and reinstall cc1, the problem should go away.

   What's going on is that the 386 linker gets something wrong because of
   the huge strings array in toplev.c, and something gets mislinked, so
   that
   void f(void) __attribute((constructor)) {}
   kills cc1.

   As a work-around, I've killed Fortran options help texts, until someone find
s
   where the linker errs.

      4.2.4 - egcs seems much slower than gcc

   It is, but there is a reason. egcs performs more optimizing passes.
   Data alignment and other such functionality will be better with
   egcs-generated code.

      4.2.5 - egcs generates larger code than gcc

   Yes it does. This is especially noticable with the old -O2 gcc switch.
   egcs introduces a new option, -Os which optimizes for space. This is
   roughly comparable to the old -O2 behavior.

      4.2.6 - After installing egcs I have very little disk space left

   egcs installs into a different subdirectory than gcc 2.8.1. You may
   remove gcc once egcs is bootstrapped and working. (on a related note,
   the perl changes mentioned in [32]4.1 mean that you can remove the
   /usr/lib/perl5 directory. The new location for this data is
   /usr/libdata/perl5.)

    4.3: My make build dies with unimplemented syscall errors.

   Short Answer:

   The kernel structure statfs has changed. You will need to recompile
   the kernel before attempting a make build.

   Long Answer:

   The kernel structure statfs has changed. The new struct statfs has the
   following features:
     * Has a u_int32_t flags field--now softdep can have a real flag.
     * Uses u_int32_t instead of longs (nicer on the alpha). Note: the
       man page used to lie about setting invalid/unused fields to -1.
       SunOS does that but our code never has.
     * Gets rid of f_type completely. It hasn't been used since NetBSD
       0.9 and having it there but always 0 is confusing. It is
       conceivable that this may cause some old code to not compile but
       that is better than silently breaking.
     * Adds a mount_info union that contains the FSTYPE_args struct. This
       means that mount can now tell you all the options a filesystem was
       mounted with. This is especially nice for NFS.

   Other changes:
     * The linux statfs emulation didn't convert between BSD fs names and
       linux f_type numbers. Now it does, since the BSD f_type number is
       useless to linux apps (and has been removed anyway)
     * FreeBSD's struct statfs is different from our (both old and new)
       and thus needs conversion. Previously, the OpenBSD syscalls were
       used without any real translation.
     * mount(8) will now show extra info when invoked with no arguments.
       However, to see everything you need to use the -v (verbose) flag.

   --
   $OpenBSD: upgrade-minifaq.html,v 1.4 1999/06/21 21:54:39 ericj Exp $
   Copyright  1998-1999, Kjell Wooding.
   Please send any comments, questions, or suggestions to
   [33]kwooding@@codetalker.com

References

   1. mailto:kwooding@@codetalker.com
   2. http://www.openbsd.org/faq/upgrade-minifaq.html#1.1
   3. http://www.openbsd.org/faq/upgrade-minifaq.html#1.2
   4. http://www.openbsd.org/faq/upgrade-minifaq.html#1.3
   5. http://www.openbsd.org/faq/upgrade-minifaq.html#1.4
   6. http://www.openbsd.org/faq/upgrade-minifaq.html#1.5
   7. http://www.openbsd.org/faq/upgrade-minifaq.html#1.6
   8. http://www.openbsd.org/faq/upgrade-minifaq.html#2.1
   9. http://www.openbsd.org/faq/upgrade-minifaq.html#2.2
  10. http://www.openbsd.org/faq/upgrade-minifaq.html#2.3
  11. http://www.openbsd.org/faq/upgrade-minifaq.html#3.1
  12. http://www.openbsd.org/faq/upgrade-minifaq.html#3.2
  13. http://www.openbsd.org/faq/upgrade-minifaq.html#4.1
  14. http://www.openbsd.org/faq/upgrade-minifaq.html#4.2
  15. http://www.openbsd.org/faq/upgrade-minifaq.html#4.2.1
  16. http://www.openbsd.org/faq/upgrade-minifaq.html#4.2.2
  17. http://www.openbsd.org/faq/upgrade-minifaq.html#4.2.3
  18. http://www.openbsd.org/faq/upgrade-minifaq.html#4.2.4
  19. http://www.openbsd.org/faq/upgrade-minifaq.html#4.2.5
  20. http://www.openbsd.org/faq/upgrade-minifaq.html#4.2.6
  21. http://www.openbsd.org/faq/upgrade-minifaq.html#4.3
  22. ftp://ftp.openbsd.org/pub/OpenBSD/snapshots/
  23. http://www.openbsd.org/faq/upgrade-minifaq.html#1.4
  24. http://www.openbsd.org/faq/upgrade-minifaq.html#1.5
  25. http://www.openbsd.org/anoncvs.html
  26. http://www.openbsd.org/faq/upgrade-minifaq.html#3.1
  27. http://www.openbsd.org/faq/upgrade-minifaq.html#4.2
  28. http://www.openbsd.org/faq/upgrade-minifaq.html#4.3
  29. http://www.openbsd.org/ports.html
  30. http://www.openbsd.org/faq/upgrade-minifaq.html#4.2.2
  31. http://www.openbsd.org/faq/upgrade-minifaq.html#3.1
  32. http://www.openbsd.org/faq/upgrade-minifaq.html#4.1
  33. mailto:kwooding@@codetalker.com

Enter pathname of shell or RETURN for sh: _
erase ^?, werase ^W, kill ^U, intr ^C
(I)nstall, (U)pgrade or (S)hell? _i
=================================================
Welcome to the OpenBSD/i386 2.5 installation program.

This program is designed to help you put OpenBSD on your disk in a simple and
rational way.

As with anything which modifies your disk's contents, this program can cause
SIGNIFICANT data loss, and you are advised to make sure your data is backed
up before beginning the installation process.

Default answers are displayed in brackets after the questions.  You can hit
Control-C at any time to quit, but if you do so at a prompt, you may have
to hit return.  Also, quitting in the middle of installation may leave your
system in an inconsistent state.  If you hit Control-C and restart the
install, the install program will remember many of your old answers.

Proceed with installation? [n] _y

Cool! Let's get to it...
Specify terminal type [pcvt25]: _

The installation program needs to know which disk to consider the root disk.
Note the unit number may be different than the unit number you used in the
boot program (especially on a PC with multiple disk controllers).
Available disks are:

wd0
wd1
sd0

Which disk is the root disk [wd0]? _
Do you want to use the *entire* disk for OpenBSD? [no] _yes

[...]

Inside the BIOS 'A6' ('OpenBSD') partition you just created, there resides an
OpenBSD partition table which defines how this BIOS partition is to be split
up. This table declares the offsets and sizes of your / partition, your swap
space, and any other partitions you might create.  (NOTE: The OpenBSD disk
label offsets are absolute, ie. relative to the start of the disk... NOT
relative to the start of the BIOS 'A6' partition).

If this disk is shared with other operating systems, those operating systems
should have a BIOS partition entry that spans the space they occupy completely.
For safety, also make sure all OpenBSD file systems are within the offset and
size specified in the 'A6' BIOS partition table.  (By default, the disklabel
editor will try to enforce this).  If you are unsure of how to use multiple
partitions properly (ie. seperating /,  /usr, /tmp, /var, /usr/local, and other
things) just split the space into a root and swap partition for now.

# using MBR partition 3: type A6 off 63 (0x3f) size 4991553 (0x4c2a41)

Treating sectors 63-16386300 as the OpenBSD portion of the disk.
You can use the 'b' command to change this.

Initial label editor (enter '?' for help at any prompt)
> _d a
> _a a
offset: [63] _
size: [16386237] _64M
Rounding to nearest cylinder: 131040
FS type: [4.2BSD] _
mount point: [none] _/
fragment size: [1024] _
block size: [8192] _
cpg: [16] _
> _a b
offset: [131103] _
size: [16255197] _64M
Rounding to nearest cylinder: 131040
FS type: [swap] _
> _a d
offset: [262143] _
size: [16124157] _64M
Rounding to nearest cylinder: 131040
FS type: [4.2BSD] _
mount point: [none] _/tmp
fragment size: [1024] _
block size: [8192] _
cpg: [16] _
> _a e
offset: [393183] _
size: [15993117] _64M
Rounding to nearest cylinder: 131040
FS type: [4.2BSD] _
mount point: [none] _/var
fragment size: [1024] _
block size: [8192] _
cpg: [16] _
> _a g
offset: [524223] _
size: [15862077] _300M
Rounding to nearest cylinder: 614880
FS type: [4.2BSD] _
mount point: [none] _/usr
fragment size: [1024] _
block size: [8192] _
cpg: [16] _
> _a h
offset: [1139103] _
size: [15247197] _*
FS type: [4.2BSD] _
mount point: [none] _/home
fragment size: [1024] _
block size: [8192] _
cpg: [16] _
> _w
> _q

You will now have the opportunity to enter filesystem information for wd0.
You will be prompted for the mount point (full path, including the prepending
'/' character) for each BSD partition on wd0.  Enter "none" to skip a
partition or "done" when you are finished.

The following partitions will be used for the root filesystem and swap:

wd0a
/

wd0b
swap

Mount point for wd0d (size=65520k) [/tmp, RET, none, or done]? _
Mount point for wd0e (size=65520k) [/var, RET, none, or done]? _
Mount point for wd0g (size=307440k) [/usr, RET, none, or done]? _
Mount point for wd0h (size=1926256k) [/home, RET, none, or done]? _done

Nowq you can select another disk to initialize.  (Do not re-select a
disk you have already entered information for).  Available disks are:

wd0
wd1

Which one? [done] _

You have configured the following devices and mount points:

wd0a /
wd0d /tmp
wd0e /var
wd0g /usr
wd0h /home

Filesystems will now be created on these devices.
If you made any mistakes, you may edit this now.
Edit using ed? [n] _

============================================================
The next step will overwrite any existing data on:

wd0a wd0d wd0e wd0g wd0h

Are you really sure that you're ready to proceed? [n] _y
[...]

You will now be given the opportunity to configure the network.  This will be
useful if you need to transfer the installation sets via FTP, HTTP, or NFS.
Even if you choose not to transfer installation sets that way, this information
will be preserved and copied into the new root filesystem.

Configure the network [y] _
Enter system hostname (short form): [] _mybox
Enter DNS domain name: [] _someisp.com

If you have any devices being configured by a DHCP server
it is recommended that you do not enter a default route or
any name servers.

You may configure the following network interfaces (the interfaces marked
with [X] have been successfully configured):


[ ] xl0

[ ] fxp0

Configure which interface? (or, enter 'done') [xl0] _
IP address (or 'dhcp')? [] _199.185.137.55
Symbolic (host) name? [mybox] _
Netmask ? [255.255.255.0] _
Your network interface might require non-default
media directives.  The default media is:

media: Ethernet 100baseTX half-duplex
This is a list of supported media:
        media autoselect
        media 100baseTX mediaopt full-duplex
        media 100baseTX mediaopt half-duplex
        media 100baseTX
        media 10baseT mediaopt full-duplex
        media 10baseT
        media 10baseT mediaopt half-duplex
If the default is not satisfactory, and you wish to use another
media, copy that line from above (ie. "media 100baseTX")
Media directives? [] _

You may configure the following network interfaces (the interfaces marked
with [X] have been successfully configured):


[X] xl0

[ ] fxp0

Configure which interface? (or, enter 'done') [done] _
Enter IP address of default route: [none] _199.185.137.128
Enter IP address of primary nameserver: [none] _199.185.137.1
Would you like to use the nameserver now? [y] _

You will now be given the opportunity to escape to the command shell to do
any additional network configuration you may need.  This may include adding
additional routes, if needed.  In addition, you might take this opportunity
to redo the default route in the event that it failed above.
Escape to shell? [n] _
/dev/wd0a on /mnt type ffs (local)
/dev/wd0d on /mnt/tmp type ffs (local)
/dev/wd0e on /mnt/var type ffs (local)
/dev/wd0g on /mnt/usr type ffs (local)
/dev/wd0h on /mnt/home type ffs (local)

Please enter the initial password that the root account will have.
Password (will not echo): _
Password (again): _

It is now time to extract the installation sets onto the hard disk.  Make sure
the sets are either on a local device (i.e. tape, CD-ROM) or on a network
server.  You will have the chance to repeat this step or to extract sets from
several places, so you don't have to try to load all the sets in one try and
can recover from some errors.

Install from (f)tp, (h)ttp, (t)ape, (C)D-ROM, (N)FS or local (d)isk? _c

The following CD-ROM devices are installed on your system; please select
the CD-ROM device containing the partition with the installation sets:

acd0
cd0

Which is the CD-ROM with the installation media? [abort] _acd0
Partition? [c] _

There are two CD-ROM filesystem types currently supported by this program:
cd9660

ISO-9660
ffs

Berkeley Fast Filesystem

Which filesystem type? [cd9660] _
Enter the directory relative to the mount point that
contains the file. [/2.5/i386] _

You will now be asked for files to extract.  In addition to the
files listed in the selector you may enter any file located in
/mnt2//2.5/i386.  You can also enter 'all' to install all the standard
sets, or 'list' to list the files avilable in /mnt2//2.5/i386.
When you are done selecting files, enter 'done'.
Some of these sets are required for your install and some are optional --
You will want at least the base and bsd sets.
Consult the intallation notes if you are not sure which sets are required!

The following sets are available for extraction.
Enter filename, `list', `all', or `done'.
You may de-select a set by prepending a '-' to it's name.


[X] base25.tar.gz

[X] etc25.tar.gz

[ ] misc25.tar.gz

[ ] comp25.tar.gz

[ ] man25.tar.gz

[ ] game25.tar.gz

[ ] xbase25.tar.gz

[ ] xshare25.tar.gz

[ ] xfont25.tar.gz

[ ] xserv25.tar.gz

[X] bsd

File name []? _*

The following sets are available for extraction.
Enter filename, `list', `all', or `done'.
You may de-select a set by prepending a '-' to it's name.


[X] base25.tar.gz

[X] etc25.tar.gz

[X] misc25.tar.gz

[X] comp25.tar.gz

[X] text25.tar.gz

[X] man25.tar.gz

[X] game25.tar.gz

[X] xbase25.tar.gz

[X] xshare25.tar.gz

[X] xfont25.tar.gz

[X] xserv25.tar.gz

[X] bsd
File name []? _-game*

The following sets are available for extraction.
Enter filename, `list', `all', or `done'.
You may de-select a set by prepending a '-' to it's name.


[X] base25.tar.gz

[X] etc25.tar.gz

[X] misc25.tar.gz

[X] comp25.tar.gz

[X] text25.tar.gz

[X] man25.tar.gz

[ ] game25.tar.gz

[X] xbase25.tar.gz

[X] xshare25.tar.gz

[X] xfont25.tar.gz

[X] xserv25.tar.gz

[X] bsd
File name []? _done

Ready to extract selected file sets? [y] _

/mnt2//2.5/i386/base25.tar.gz:
100% |***************************************************| 17774 KB   00:00 ETA
/mnt2//2.5/i386/etc25.tar.gz:
100% |***************************************************|   161 KB   00:00 ETA
/mnt2//2.5/i386/bsd:
100% |***************************************************|  2281 KB   00:00 ETA
/mnt2//2.5/i386/misc25.tar.gz:
100% |***************************************************|  1637 KB   00:00 ETA
/mnt2//2.5/i386/comp25.tar.gz:
100% |***************************************************| 11481 KB   00:00 ETA
/mnt2//2.5/i386/man25.tar.gz:
100% |***************************************************|  3543 KB   00:00 ETA
/mnt2//2.5/i386/xbase25.tar.gz:
100% |***************************************************|  5376 KB   00:00 ETA
/mnt2//2.5/i386/xshare25.tar.gz:
100% |***************************************************|  1482 KB   00:00 ETA
/mnt2//2.5/i386/xfont25.tar.gz:
100% |***************************************************|  6017 KB   00:00 ETA
/mnt2//2.5/i386/xserv25.tar.gz:
100% |***************************************************| 15188 KB   00:00 ETA

Extract more sets? [n] _
Copying fstab...done.
Copying hostname.xl0...done.
Copying hosts...done.
Copying myname...done.
Copying mygate...done.
Copying resolv.conf...done.

Select a time zone for your location. Timezones are represented on the
system by a directory structure rooted in "/usr/share/timezone". Most
timezones can be selected by entering a token like "MET" or "GMT-6".
Other zones are grouped by continent, with detailed zone information
separated by a slash ("/"), e.g. "US/Pacific" or "Canada/Mountain".

To get a listing of what's available in /usr/share/zoneinfo, enter "?"
at the prompts below.

What timezone are you in [`?' for list] [GMT]? _?
Africa/      Chile/       GMT          Jamaica      Navajo       UCT
America/     Cuba         GMT+0        Japan        PRC          US/
Antarctica/  EET          GMT-0        Kwajalein    PST8PDT      UTC
Arctic/      EST          GMT0         Libya        Pacific/     Universal
Asia/        EST5EDT      Greenwich    MET          Poland       W-SU
Atlantic/    Egypt        HST          MST          Portugal     WET
Australia/   Eire         Hongkong     MST7MDT      ROC          Zulu
Brazil/      Etc/         Iceland      Mexico/      ROK          posixrules
CET          Europe/      Indian/      Mideast/     Singapore
CST6CDT      Factory      Iran         NZ           SystemV/
Canada/      GB           Israel       NZ-CHAT      Turkey
What timezone are you in [`?' for list] [GMT]? _Canada
There are several timezones available within zone 'Canada'
Select a sub-timezone [`?' for list]: _?
Atlantic            Eastern             Pacific
Central             Mountain            Saskatchewan
East-Saskatchewan   Newfoundland        Yukon
Select a sub-timezone [`?' for list]: _Mountain
You have selected timezone "Canada/Mountain".
Installing timezone link...done.
Installing boot block...
boot: /mnt/boot
proto: /usr/mdec/biosboot
device: /dev/rwd0c
/usr/mdec/biosboot: entry point 0
proto bootblock size 512
room for 12 filesystem blocks at 0x16f
Will load 6 blocks of size 8192 each.
Using disk geometry of 63 sectors and 128 heads.
 0: 19 @@(0 93 45) (5903-5921)
 1: 63 @@(0 94 1) (5922-5984)
 2: 14 @@(0 95 1) (5985-5998)
/mnt/boot: 3 entries total
using MBR partition 3: type 166 (0xa6) offset 63 (0x3f)

Do you expect to run X windows on this machine? [y or n] _y
Enabling machdep.allowaperture. Read xf86(4) for more information.

Making all device nodes (by running /dev/MAKEDEV) ...... done.
Unmounting filesystems... /mnt/usr /mnt/var /mnt/tmp /mnt ... Done.
Done.

CONGRATULATIONS!  You have successfully installed OpenBSD!  To boot the
installed system, enter halt at the command prompt. Once the system has
halted, reset the machine and boot from the disk.

# _reboot



OpenBSD Frequently Asked Questions - Ver. 2.5
     _________________________________________________________________

   [2.4 logo]

   This FAQ is specifically designed for the 2.5 release of OpenBSD, but
   in some cases will work on earlier versions. This FAQ will take you
   through most critical steps to setting up your own OpenBSD system. The
   addressed questions will range from newbie to advanced users.
   Hopefully you will find this FAQ useful.

   This FAQ was recently updated to support the newest version of
   OpenBSD. To view information for previous versions, please refer to
   [1]FAQ section 11.0, or [2]errata.html.

   For some a text version of the faq would be much more handy. So please
   check out [3]obsd-faq.txt. Print it out, pass it to your friends. Add
   to it, (but make sure you send diffs to me).

   Any questions can be directed to: [4]faq@@openbsd.org

   The Current FAQ maintainers are:
   [5]Eric Jackson
   [6]Wim Vandeputte
d149 3
a151 3
   1. http://www.openbsd.org/faq/faq24.html
   2. http://www.openbsd.org/errata.html
   3. http://www.openbsd.org/faq/obsd-faq.txt
d156 82
a237 82
   8. http://www.openbsd.org/faq/faq1.html
   9. http://www.openbsd.org/faq/faq1.html#1.1
  10. http://www.openbsd.org/faq/faq1.html#1.2
  11. http://www.openbsd.org/faq/faq1.html#1.3
  12. http://www.openbsd.org/faq/faq1.html#1.4
  13. http://www.openbsd.org/faq/faq1.html#1.5
  14. http://www.openbsd.org/faq/faq1.html#1.6
  15. http://www.openbsd.org/faq/faq2.html
  16. http://www.openbsd.org/faq/faq2.html#2.1
  17. http://www.openbsd.org/faq/faq2.html#2.2
  18. http://www.openbsd.org/faq/faq2.html#2.3
  19. http://www.openbsd.org/faq/faq2.html#2.4
  20. http://www.openbsd.org/faq/faq3.html
  21. http://www.openbsd.org/faq/faq3.html#3.1
  22. http://www.openbsd.org/faq/faq3.html#3.1.1
  23. http://www.openbsd.org/faq/faq3.html#3.2
  24. http://www.openbsd.org/faq/faq3.html#3.3
  25. http://www.openbsd.org/faq/faq4.html
  26. http://www.openbsd.org/faq/faq4.html#4.1
  27. http://www.openbsd.org/faq/faq4.html#4.2
  28. http://www.openbsd.org/faq/faq4.html#4.3
  29. http://www.openbsd.org/faq/upgrade-minifaq.html
  30. http://www.openbsd.org/faq/faq4.html#4.4
  31. http://www.openbsd.org/faq/faq4.html#4.5
  32. http://www.openbsd.org/faq/faq4.html#4.6
  33. http://www.openbsd.org/faq/faq4.html#4.7
  34. http://www.openbsd.org/faq/faq4.html#4.8
  35. http://www.openbsd.org/faq/faq4.html#4.9
  36. http://www.openbsd.org/faq/faq4.html#4.10
  37. http://www.openbsd.org/faq/faq4.html#4.11
  38. http://www.openbsd.org/faq/faq4.html#4.12
  39. http://www.openbsd.org/faq/faq4.html#4.13
  40. http://www.openbsd.org/faq/faq4.html#4.14
  41. http://www.openbsd.org/faq/faq5.html
  42. http://www.openbsd.org/faq/faq5.html#5.1
  43. http://www.openbsd.org/faq/faq5.html#5.2
  44. http://www.openbsd.org/faq/faq5.html#5.3
  45. http://www.openbsd.org/faq/faq5.html#5.4
  46. http://www.openbsd.org/faq/faq6.html
  47. http://www.openbsd.org/faq/faq6.html#6.1
  48. http://www.openbsd.org/faq/faq6.html#6.2
  49. http://www.openbsd.org/faq/faq6.html#6.3
  50. http://www.openbsd.org/faq/faq6.html#6.4
  51. http://www.openbsd.org/faq/faq6.html#6.5
  52. http://www.openbsd.org/faq/faq7.html
  53. http://www.openbsd.org/faq/faq7.html#7.1
  54. http://www.openbsd.org/faq/faq7.html#7.2
  55. http://www.openbsd.org/faq/faq8.html
  56. http://www.openbsd.org/faq/faq8.html#8.1
  57. http://www.openbsd.org/faq/faq8.html#8.2
  58. http://www.openbsd.org/faq/faq8.html#8.3
  59. http://www.openbsd.org/faq/faq8.html#8.4
  60. http://www.openbsd.org/faq/faq8.html#8.5
  61. http://www.openbsd.org/faq/faq8.html#8.6
  62. http://www.openbsd.org/faq/faq8.html#8.7
  63. http://www.openbsd.org/faq/faq8.html#8.8
  64. http://www.openbsd.org/faq/faq8.html#8.9
  65. http://www.openbsd.org/faq/faq9.html
  66. http://www.openbsd.org/faq/faq9.html#9.1
  67. http://www.openbsd.org/faq/faq9.html#9.2
  68. http://www.openbsd.org/faq/faq10.html
  69. http://www.openbsd.org/faq/faq10.html#10.1
  70. http://www.openbsd.org/faq/faq10.html#10.2
  71. http://www.openbsd.org/faq/faq10.html#10.3
  72. http://www.openbsd.org/faq/faq10.html#10.4
  73. http://www.openbsd.org/faq/faq10.html#10.5
  74. http://www.openbsd.org/faq/faq10.html#10.6
  75. http://www.openbsd.org/faq/faq10.html#10.7
  76. http://www.openbsd.org/faq/faq10.html#10.8
  77. http://www.openbsd.org/faq/faq10.html#10.9
  78. http://www.openbsd.org/faq/faq10.html#10.10
  79. http://www.openbsd.org/faq/faq10.html#10.11
  80. http://www.openbsd.org/faq/faq24.html
  81. http://www.openbsd.org/faq/faq24.html#11.1
  82. http://www.openbsd.org/faq/faq24.html#11.2
  83. http://www.openbsd.org/faq/log24.txt
  84. http://www.openbsd.org/faq/faq12.html
  85. http://www.openbsd.org/faq/faq12.html#12.1
  86. http://www.openbsd.org/faq/faq12.html#12.2
  87. http://www.openbsd.org/faq/faq12.html#12.3
  88. http://www.openbsd.org/faq/faq12.html#12.4
  89. http://www.openbsd.org/index.html
d293 1
a293 1
   For futher reading on other popular licenses read:
d389 1
a389 1
   $OpenBSD: faq1.html,v 1.10 1999/06/24 22:16:23 ericj Exp $
d393 1
a393 1
   1. http://www.openbsd.org/faq/index.html
d396 14
a409 14
   4. http://www.openbsd.org/i386.html
   5. http://www.openbsd.org/sparc.html
   6. http://www.openbsd.org/alpha.html
   7. http://www.openbsd.org/hp300.html
   8. http://www.openbsd.org/amiga.html
   9. http://www.openbsd.org/mac68k.html
  10. http://www.openbsd.org/powerpc.html
  11. http://www.openbsd.org/pmax.html
  12. http://www.openbsd.org/mvme88k.html
  13. http://www.openbsd.org/arc.html
  14. http://www.openbsd.org/mvme68k.html
  15. http://www.openbsd.org/plat.html
  16. http://www.openbsd.org/policy.html
  17. http://www.openbsd.org/donations.html
d414 2
a415 2
  22. http://www.openbsd.org/faq/faq2.html
  23. http://www.openbsd.org/faq/index.html
d684 3
a686 3
   1. http://www.openbsd.org/faq/index.html
   2. http://www.openbsd.org/faq/faq1.html
   3. http://www.openbsd.org/faq/faq3.html
d693 1
a693 1
  10. http://www.openbsd.org/mail.html
d713 1
a713 1
  30. http://www.openbsd.org/report.html
d717 4
a720 4
  34. http://www.openbsd.org/faq/index.html
  35. http://www.openbsd.org/faq/faq1.html
  36. http://www.openbsd.org/faq/faq3.html
  37. http://www.openbsd.org/faq/index.html
d793 6
a798 2
   [10][Back to Main Index] [11][To Section 2.0 - Other OpenBSD
   information resources] [12][To Section 4.0 - Installation and Disk
d802 2
a803 2
   [13][back] [14]www@@openbsd.org
   $OpenBSD: faq3.html,v 1.6 1999/05/21 05:36:11 ericj Exp $
d807 15
a821 14
   1. http://www.openbsd.org/faq/index.html
   2. http://www.openbsd.org/faq/faq2.html
   3. http://www.openbsd.org/faq/faq4.html
   4. http://www.openbsd.org/orders.html
   5. http://www.openbsd.org/tshirts.html
   6. http://www.openbsd.org/ftp.html
   7. http://www.openbsd.org/anoncvs.html
   8. http://www.openbsd.org/faq/faq8.html#8.5
   9. http://www.openbsd.org/ctm.html
  10. http://www.openbsd.org/faq/index.html
  11. http://www.openbsd.org/faq/faq2.html
  12. http://www.openbsd.org/faq/faq4.html
  13. http://www.openbsd.org/faq/index.html
  14. mailto:www@@openbsd.org
d831 1
a831 1
   Installing from a CD is definatly the BEST choice, but first you must
d840 2
a841 2
   Rawrite doesnt work if you are an NT user, so you can also use fdimage
   or ntrw.exe which are both also in the tools directory.
d869 1
a869 1
   proxys and passive or active transfers, and the you will be presented
d1378 1
a1378 1
   To multiboot OpenBSD and NT, you can use NTloader. The bootloader the
d1408 1
a1408 1
   $OpenBSD: faq4.html,v 1.40 1999/06/28 17:35:55 ericj Exp $
d1412 4
a1415 4
   1. http://www.openbsd.org/faq/index.html
   2. http://www.openbsd.org/faq/faq3.html
   3. http://www.openbsd.org/faq/faq5.html
   4. http://www.openbsd.org/orders.html
d1417 3
a1419 3
   6. http://www.openbsd.org/faq/log25.txt
   7. http://www.openbsd.org/faq/log25.txt
   8. http://www.openbsd.org/faq/log25.txt
d1421 1
a1421 1
  10. http://www.openbsd.org/faq/log25.txt
d1430 1
a1430 1
  19. http://www.openbsd.org/faq/INSTALL.linux
d1434 5
a1438 5
  23. http://www.openbsd.org/faq/INSTALL.linux
  24. http://www.openbsd.org/faq/index.html
  25. http://www.openbsd.org/faq/faq3.html
  26. http://www.openbsd.org/faq/faq5.html
  27. http://www.openbsd.org/faq/index.html
d1453 1
a1453 1
     * You can get rid of uneeded drivers in the GENERIC kernel
d1463 1
a1463 1
   support for uneeded devices. There are multitudes of options that
d1465 1
a1465 1
   them, one's that are most commonly used. Check the [4]options(4) man
d1580 2
a1581 1
       both file systems remain visible. This code isnt quite stable yet.
d1795 1
a1795 1
   $OpenBSD: faq5.html,v 1.21 1999/06/27 21:32:23 ericj Exp $
d1799 3
a1801 3
   1. http://www.openbsd.org/faq/index.html
   2. http://www.openbsd.org/faq/faq4.html
   3. http://www.openbsd.org/faq/faq6.html
d1822 1
a1822 1
  24. http://www.openbsd.org/faq/faq4.html#4.9
d1824 1
a1824 1
  26. http://www.openbsd.org/faq/faq10.html#10.10
d1828 3
a1830 3
  30. http://www.openbsd.org/faq/faq12.html#12.2
  31. http://www.openbsd.org/faq/faq6.html
  32. http://www.openbsd.org/faq/faq12.html#12.1
d1839 5
a1843 5
  41. http://www.openbsd.org/faq/faq5.html#5.3
  42. http://www.openbsd.org/faq/index.html
  43. http://www.openbsd.org/faq/faq4.html
  44. http://www.openbsd.org/faq/faq6.html
  45. http://www.openbsd.org/faq/index.html
d2246 1
a2246 1
   following should look farmiliar because it is that info with a little
d2277 1
a2277 1
   This will set the commands to follow when certian actions take place
d2315 1
a2315 1
   should be used. This isnt always supported, but if it is
d2354 1
a2354 1
   $OpenBSD: faq6.html,v 1.17 1999/06/28 18:55:20 ericj Exp $
d2358 4
a2361 4
   1. http://www.openbsd.org/faq/index.html
   2. http://www.openbsd.org/faq/faq5.html
   3. http://www.openbsd.org/faq/faq7.html
   4. http://www.openbsd.org/faq/faq5.html
d2364 1
a2364 1
   7. http://www.openbsd.org/faq/faq12.html
d2389 4
a2392 4
  32. http://www.openbsd.org/faq/index.html
  33. http://www.openbsd.org/faq/faq5.html
  34. http://www.openbsd.org/faq/faq7.html
  35. http://www.openbsd.org/faq/index.html
d2423 7
a2429 7
   1. http://www.openbsd.org/faq/index.html
   2. http://www.openbsd.org/faq/faq6.html
   3. http://www.openbsd.org/faq/faq8.html
   4. http://www.openbsd.org/faq/index.html
   5. http://www.openbsd.org/faq/faq6.html
   6. http://www.openbsd.org/faq/faq8.html
   7. http://www.openbsd.org/faq/index.html
d2543 1
a2543 1
   repository's such as these. So CVS has a -z[1-9] option which uses
d2585 4
a2588 4
   ports/infrastructure/ all thats left in /usr/src/share/mk for ports is
   just a pointer to this new area. So, once you have the ports working
   witht the infrastructure dir, you no longer need to do the step from
   above.
d2592 2
a2593 1
   You'll notice the dependencies are automaticly detected and completed:
d2738 1
a2738 1
   When booting your OpenBSD system, many of you have probobly noticed
d2745 4
a2748 4
   arise, or special functions are needed. Thats where these options will
   come in handy. To start of, you should read through the [10]boot(8)
   man page. Here we will go over the most common used commands for the
   bootloader.
d2782 1
a2782 1
   $OpenBSD: faq8.html,v 1.17 1999/06/23 21:31:30 ericj Exp $
d2786 3
a2788 3
   1. http://www.openbsd.org/faq/index.html
   2. http://www.openbsd.org/faq/faq7.html
   3. http://www.openbsd.org/faq/faq9.html
d2791 4
a2794 4
   6. http://www.openbsd.org/anoncvs.html
   7. http://www.openbsd.org/ftp.html
   8. http://www.openbsd.org/ports.html
   9. http://www.openbsd.org/ftp.html
d2796 1
a2796 1
  11. http://www.openbsd.org/faq/faq5.html#5.4
d2798 4
a2801 4
  13. http://www.openbsd.org/faq/index.html
  14. http://www.openbsd.org/faq/faq7.html
  15. http://www.openbsd.org/faq/faq9.html
  16. http://www.openbsd.org/faq/index.html
d2876 4
a2879 4
   1. http://www.openbsd.org/faq/index.html
   2. http://www.openbsd.org/faq/faq8.html
   3. http://www.openbsd.org/faq/faq10.html
   4. http://www.openbsd.org/crypto.html
d2883 1
a2883 1
   8. http://www.openbsd.org/faq/faq6.html
d2886 5
a2890 5
  11. http://www.openbsd.org/faq/INSTALL.linux
  12. http://www.openbsd.org/faq/index.html
  13. http://www.openbsd.org/faq/faq8.html
  14. http://www.openbsd.org/faq/faq10.html
  15. http://www.openbsd.org/faq/index.html
d2913 1
a2913 1
   superuser privliges, without putting them in the "wheel" group, use
d3083 1
a3083 1
   remove all existance of a user. It will remove any crontab(1) entries,
d3168 1
a3168 1
   KerberosIV is an pre-installed ocmponent of the default system. Here
d3338 1
a3338 1
   Now that is set up, we need to initalize kerberos. To obtain a ticket
d3396 1
a3396 1
   $OpenBSD: faq10.html,v 1.20 1999/06/28 18:55:21 ericj Exp $
d3400 3
a3402 3
   1. http://www.openbsd.org/faq/index.html
   2. http://www.openbsd.org/faq/faq9.html
   3. http://www.openbsd.org/faq/faq24.html
d3432 4
a3435 4
  33. http://www.openbsd.org/faq/index.html
  34. http://www.openbsd.org/faq/faq9.html
  35. http://www.openbsd.org/faq/faq24.html
  36. http://www.openbsd.org/faq/index.html
d3461 1
a3461 1
   at 4 GB or higher. This means the pbr is installed in the reall
d3508 1
a3508 1
   $OpenBSD: faq24.html,v 1.2 1999/05/21 18:40:48 wvdputte Exp $
d3512 9
a3520 9
   1. http://www.openbsd.org/faq/index.html
   2. http://www.openbsd.org/faq/faq10.html
   3. http://www.openbsd.org/faq/faq12.html
   4. http://www.openbsd.org/errata.html#userdir
   5. http://www.openbsd.org/errata.html#installboot
   6. http://www.openbsd.org/faq/index.html
   7. http://www.openbsd.org/faq/faq24.html
   8. http://www.openbsd.org/faq/faq12.html
   9. http://www.openbsd.org/faq/index.html
d4348 8
a4355 7
   An option you may need to chane for a busy server, gateway or firewall
   is NMBCLUSTERS. This controls the size of the kernel mbuf cluster map.
   On your computer, if you get messages like "mb_map full", you need to
   increase this value. If traffic on a networking interface stops for no
   apparent reason, this may also be a sign that you need to increase
   this value. A reasonable value on the i386 port with most 100Mbps
   ethernet interfaces (no matter how many the machine has) is 8192.
d4516 1
a4516 1
       mult-user, mult-tasking environment.
d4540 1
a4540 1
       existance. If you are using the ISA bus for your disk or network
d4552 1
a4552 1
   $OpenBSD: faq12.html,v 1.9 1999/06/28 17:29:27 ericj Exp $
d4556 2
a4557 2
   1. http://www.openbsd.org/faq/index.html
   2. http://www.openbsd.org/faq/faq24.html
d4567 4
a4570 4
  12. http://www.openbsd.org/faq/faq4.html#4.9
  13. http://www.openbsd.org/faq/index.html
  14. http://www.openbsd.org/faq/faq24.html
  15. http://www.openbsd.org/faq/index.html
d5010 1
a5010 1
   Now, before going any futher, ensure that your copies of binutils,
d5272 1
a5272 1
   $OpenBSD: upgrade-minifaq.html,v 1.4 1999/06/21 21:54:39 ericj Exp $
d5280 20
a5299 20
   2. http://www.openbsd.org/faq/upgrade-minifaq.html#1.1
   3. http://www.openbsd.org/faq/upgrade-minifaq.html#1.2
   4. http://www.openbsd.org/faq/upgrade-minifaq.html#1.3
   5. http://www.openbsd.org/faq/upgrade-minifaq.html#1.4
   6. http://www.openbsd.org/faq/upgrade-minifaq.html#1.5
   7. http://www.openbsd.org/faq/upgrade-minifaq.html#1.6
   8. http://www.openbsd.org/faq/upgrade-minifaq.html#2.1
   9. http://www.openbsd.org/faq/upgrade-minifaq.html#2.2
  10. http://www.openbsd.org/faq/upgrade-minifaq.html#2.3
  11. http://www.openbsd.org/faq/upgrade-minifaq.html#3.1
  12. http://www.openbsd.org/faq/upgrade-minifaq.html#3.2
  13. http://www.openbsd.org/faq/upgrade-minifaq.html#4.1
  14. http://www.openbsd.org/faq/upgrade-minifaq.html#4.2
  15. http://www.openbsd.org/faq/upgrade-minifaq.html#4.2.1
  16. http://www.openbsd.org/faq/upgrade-minifaq.html#4.2.2
  17. http://www.openbsd.org/faq/upgrade-minifaq.html#4.2.3
  18. http://www.openbsd.org/faq/upgrade-minifaq.html#4.2.4
  19. http://www.openbsd.org/faq/upgrade-minifaq.html#4.2.5
  20. http://www.openbsd.org/faq/upgrade-minifaq.html#4.2.6
  21. http://www.openbsd.org/faq/upgrade-minifaq.html#4.3
d5301 10
a5310 10
  23. http://www.openbsd.org/faq/upgrade-minifaq.html#1.4
  24. http://www.openbsd.org/faq/upgrade-minifaq.html#1.5
  25. http://www.openbsd.org/anoncvs.html
  26. http://www.openbsd.org/faq/upgrade-minifaq.html#3.1
  27. http://www.openbsd.org/faq/upgrade-minifaq.html#4.2
  28. http://www.openbsd.org/faq/upgrade-minifaq.html#4.3
  29. http://www.openbsd.org/ports.html
  30. http://www.openbsd.org/faq/upgrade-minifaq.html#4.2.2
  31. http://www.openbsd.org/faq/upgrade-minifaq.html#3.1
  32. http://www.openbsd.org/faq/upgrade-minifaq.html#4.1
@


1.6
log
@sync
@
text
@d141 1
a141 1
   $OpenBSD: obsd-faq.txt,v 1.5 1999/06/22 18:57:35 ericj Exp $
d379 1
a379 1
   $OpenBSD: obsd-faq.txt,v 1.5 1999/06/22 18:57:35 ericj Exp $
d669 1
a669 1
   $OpenBSD: obsd-faq.txt,v 1.5 1999/06/22 18:57:35 ericj Exp $
d788 1
a788 1
   $OpenBSD: obsd-faq.txt,v 1.5 1999/06/22 18:57:35 ericj Exp $
d1331 1
a1331 1
   $OpenBSD: obsd-faq.txt,v 1.5 1999/06/22 18:57:35 ericj Exp $
d1511 1
a1511 1
   $OpenBSD: obsd-faq.txt,v 1.5 1999/06/22 18:57:35 ericj Exp $
d1939 1
a1939 1
   $OpenBSD: obsd-faq.txt,v 1.5 1999/06/22 18:57:35 ericj Exp $
d1982 1
a1982 1
   $OpenBSD: obsd-faq.txt,v 1.5 1999/06/22 18:57:35 ericj Exp $
d2334 1
a2334 1
   $OpenBSD: obsd-faq.txt,v 1.5 1999/06/22 18:57:35 ericj Exp $
d2416 1
a2416 1
   $OpenBSD: obsd-faq.txt,v 1.5 1999/06/22 18:57:35 ericj Exp $
d2671 1
a2671 1
   $OpenBSD: obsd-faq.txt,v 1.5 1999/06/22 18:57:35 ericj Exp $
d2762 1
a2762 1
   $OpenBSD: obsd-faq.txt,v 1.5 1999/06/22 18:57:35 ericj Exp $
d2777 1
a2777 1
$OpenBSD: obsd-faq.txt,v 1.5 1999/06/22 18:57:35 ericj Exp $
d3656 1
a3656 1
   $OpenBSD: obsd-faq.txt,v 1.5 1999/06/22 18:57:35 ericj Exp $
d4370 1
a4370 1
   $OpenBSD: obsd-faq.txt,v 1.5 1999/06/22 18:57:35 ericj Exp $
d4552 1
a4552 1
   $OpenBSD: index.html,v 1.43 1999/06/24 03:36:18 ericj Exp $
d4793 1
a4793 1
   $OpenBSD: faq1.html,v 1.10 1999/06/24 22:16:23 ericj Exp $
d5084 1
a5084 1
   $OpenBSD: faq2.html,v 1.13 1999/06/08 23:37:52 ericj Exp $
d5203 1
a5203 1
   $OpenBSD: faq3.html,v 1.6 1999/05/21 05:36:11 ericj Exp $
d5746 1
a5746 1
   $OpenBSD: faq4.html,v 1.37 1999/06/22 16:59:44 ericj Exp $
d6129 1
a6129 1
   $OpenBSD: faq5.html,v 1.19 1999/06/25 17:51:22 ericj Exp $
d6706 1
a6706 1
   $OpenBSD: faq6.html,v 1.14 1999/06/24 21:54:51 ericj Exp $
d6771 1
a6771 1
   $OpenBSD: faq7.html,v 1.5 1999/05/21 02:44:00 ericj Exp $
d7133 1
a7133 1
   $OpenBSD: faq8.html,v 1.17 1999/06/23 21:31:30 ericj Exp $
d7216 1
a7216 1
   $OpenBSD: faq9.html,v 1.8 1999/04/04 12:24:05 wvdputte Exp $
d7471 1
a7471 1
   $OpenBSD: faq10.html,v 1.16 1999/06/17 17:00:06 ericj Exp $
d7562 1
a7562 1
   $OpenBSD: faq24.html,v 1.2 1999/05/21 18:40:48 wvdputte Exp $
d7577 1
a7577 1
$OpenBSD: INSTALL.linux,v 1.1 1998/12/21 21:37:25 ericj Exp $
d8507 1
a8507 1
   $OpenBSD: faq12.html,v 1.7 1999/06/24 14:11:09 ericj Exp $
d8524 11196
@


1.5
log
@sync
@
text
@d141 1
a141 1
   $OpenBSD: index.html,v 1.42 1999/06/22 16:59:43 ericj Exp $
d379 1
a379 1
   $OpenBSD: faq1.html,v 1.9 1999/05/11 02:22:19 ericj Exp $
d669 1
a669 1
   $OpenBSD: faq2.html,v 1.13 1999/06/08 23:37:52 ericj Exp $
d788 1
a788 1
   $OpenBSD: faq3.html,v 1.6 1999/05/21 05:36:11 ericj Exp $
d1331 1
a1331 1
   $OpenBSD: faq4.html,v 1.37 1999/06/22 16:59:44 ericj Exp $
d1511 1
a1511 1
   $OpenBSD: faq5.html,v 1.15 1999/06/08 23:37:52 ericj Exp $
d1939 1
a1939 1
   $OpenBSD: faq6.html,v 1.13 1999/06/09 00:04:28 wvdputte Exp $
d1982 1
a1982 1
   $OpenBSD: faq7.html,v 1.5 1999/05/21 02:44:00 ericj Exp $
d2334 1
a2334 1
   $OpenBSD: faq8.html,v 1.16 1999/06/16 17:03:10 ericj Exp $
d2416 1
a2416 1
   $OpenBSD: faq9.html,v 1.8 1999/04/04 12:24:05 wvdputte Exp $
d2671 1
a2671 1
   $OpenBSD: faq10.html,v 1.16 1999/06/17 17:00:06 ericj Exp $
d2762 1
a2762 1
   $OpenBSD: faq24.html,v 1.2 1999/05/21 18:40:48 wvdputte Exp $
d2777 1
a2777 1
$OpenBSD: INSTALL.linux,v 1.1 1998/12/21 21:37:25 ericj Exp $
d3656 1
a3656 1
   $OpenBSD: faq12.html,v 1.4 1999/06/18 21:43:04 ericj Exp $
d4370 1
a4370 1
   $OpenBSD: upgrade-minifaq.html,v 1.4 1999/06/21 21:54:39 ericj Exp $
d4410 5298
@


1.4
log
@oops, resync
@
text
@d17 3
a19 6
   Since alot of people have requested a text version of the faq, I
   created one. For now I will release it once a week, because changes
   are being made everyday to the OpenBSD FAQ. Right now it is just a
   simple cut/paste job until i get something more permenent setup.

   [3]obsd-faq.txt
d70 1
d72 1
a72 1
  [39]5.0 - Kernel Configuration and Setup
d74 28
a101 28
     * [40]5.1 - Why do I need a custom kernel?
     * [41]5.2 - Kernel configuration Options
     * [42]5.3 - Building your own kernel
     * [43]5.4 - Boot-time configuration

  [44]6.0 - Networking

     * [45]6.1 - Initial network setup
     * [46]6.2 - IPF, NAT
     * [47]6.3 - IPSEC
     * [48]6.4 - DHCP
     * [49]6.5 - PPP

  [50]7.0 - Keyboard controls

     * [51]7.1 - How do I remap the keyboard?
     * [52]7.2 - Is there gpm or the like in OpenBSD?

  [53]8.0 - General Questions

     * [54]8.1 - What are these kerberos warnings when I first login?
     * [55]8.2 - How do I change virtual terminals?
     * [56]8.3 - I forgot my root password..... WHAT DO I DO?!?
     * [57]8.4 - X craps out when I startup.. what am I doing wrong?
     * [58]8.5 - What is CVS, and how do I use it?
     * [59]8.6 - What is the ports tree?
     * [60]8.7 - What are packages?
     * [61]8.8 - Is there any way to use my floppy drive if it's not
d103 1
a103 1
     * [62]8.9 - OpenBSD Bootloader (i386 specific)
d105 1
a105 1
  [63]9.0 - Migrating from Linux
d107 2
a108 2
     * [64]9.1 - Simple tips for ex-linux users
     * [65]9.2 - Dual boot of Linux and OpenBSD
d110 1
a110 1
  [66]10.0 - System Administration
d112 1
a112 1
     * [67]10.1 - When I try to su to root it says that I'm in the wrong
d114 2
a115 2
     * [68]10.2 - How do I duplicate a filesystem?
     * [69]10.3 - How do I get httpd, sendmail, etc to start up with the
d117 1
a117 1
     * [70]10.4 - Why do users get relaying access denied when they are
d119 1
a119 1
     * [71]10.5 - I've set up POP, but I get errors when accessing my
d121 2
a122 2
     * [72]10.6 - Setting up a Secure HTTP Server using SSL(8)
     * [73]10.7 - I made changes to /etc/passwd with vi(1), but the
d124 3
a126 3
     * [74]10.8 - How do I add a user? or delete a user?
     * [75]10.9 - How do I create a ftp-only account?
     * [76]10.10 - Setting up user disk quota's
d128 1
a128 1
  [77]11.0 - OpenBSD 2.4 Specific Information
d130 3
a132 3
     * [78]11.1 - Why do I get UserDir errors when running httpd(8)?
     * [79]11.2 - Installing at a partition 4GB or higher (i386 specific)
     * [80]Log24.txt - Specific OpenBSD 2.4 Install Example
d134 1
a134 1
  [81]12.0 - Performance Tuning
d136 2
a137 2
     * [82]12.1 - Networking
     * [83]12.2 - Disk IO
d140 2
a141 2
   [84][back] [85]www@@openbsd.org
   $OpenBSD: index.html,v 1.40 1999/06/17 17:00:06 ericj Exp $
d183 48
a230 47
  39. http://www.openbsd.org/faq/faq5.html
  40. http://www.openbsd.org/faq/faq5.html#5.1
  41. http://www.openbsd.org/faq/faq5.html#5.2
  42. http://www.openbsd.org/faq/faq5.html#5.3
  43. http://www.openbsd.org/faq/faq5.html#5.4
  44. http://www.openbsd.org/faq/faq6.html
  45. http://www.openbsd.org/faq/faq6.html#6.1
  46. http://www.openbsd.org/faq/faq6.html#6.2
  47. http://www.openbsd.org/faq/faq6.html#6.3
  48. http://www.openbsd.org/faq/faq6.html#6.4
  49. http://www.openbsd.org/faq/faq6.html#6.5
  50. http://www.openbsd.org/faq/faq7.html
  51. http://www.openbsd.org/faq/faq7.html#7.1
  52. http://www.openbsd.org/faq/faq7.html#7.2
  53. http://www.openbsd.org/faq/faq8.html
  54. http://www.openbsd.org/faq/faq8.html#8.1
  55. http://www.openbsd.org/faq/faq8.html#8.2
  56. http://www.openbsd.org/faq/faq8.html#8.3
  57. http://www.openbsd.org/faq/faq8.html#8.4
  58. http://www.openbsd.org/faq/faq8.html#8.5
  59. http://www.openbsd.org/faq/faq8.html#8.6
  60. http://www.openbsd.org/faq/faq8.html#8.7
  61. http://www.openbsd.org/faq/faq8.html#8.8
  62. http://www.openbsd.org/faq/faq8.html#8.9
  63. http://www.openbsd.org/faq/faq9.html
  64. http://www.openbsd.org/faq/faq9.html#9.1
  65. http://www.openbsd.org/faq/faq9.html#9.2
  66. http://www.openbsd.org/faq/faq10.html
  67. http://www.openbsd.org/faq/faq10.html#10.1
  68. http://www.openbsd.org/faq/faq10.html#10.2
  69. http://www.openbsd.org/faq/faq10.html#10.3
  70. http://www.openbsd.org/faq/faq10.html#10.4
  71. http://www.openbsd.org/faq/faq10.html#10.5
  72. http://www.openbsd.org/faq/faq10.html#10.6
  73. http://www.openbsd.org/faq/faq10.html#10.7
  74. http://www.openbsd.org/faq/faq10.html#10.8
  75. http://www.openbsd.org/faq/faq10.html#10.9
  76. http://www.openbsd.org/faq/faq10.html#10.10
  77. http://www.openbsd.org/faq/faq24.html
  78. http://www.openbsd.org/faq/faq24.html#11.1
  79. http://www.openbsd.org/faq/faq24.html#11.2
  80. http://www.openbsd.org/faq/log24.txt
  81. http://www.openbsd.org/faq/faq12.html
  82. http://www.openbsd.org/faq/faq12.html#12.1
  83. http://www.openbsd.org/faq/faq12.html#12.2
  84. http://www.openbsd.org/index.html
  85. mailto:www@@openbsd.org
d811 2
d1294 34
a1327 2
   [20][Back to Main Index] [21][To Section 3.0 - Obtaining OpenBSD]
   [22][To Section 5.0 - Kernel configuration and Disk Setup]
d1330 2
a1331 2
   [23][back] [24]www@@openbsd.org
   $OpenBSD: faq4.html,v 1.35 1999/06/17 18:38:07 ericj Exp $
d1354 9
a1362 5
  20. http://www.openbsd.org/faq/index.html
  21. http://www.openbsd.org/faq/faq3.html
  22. http://www.openbsd.org/faq/faq5.html
  23. http://www.openbsd.org/faq/index.html
  24. mailto:www@@openbsd.org
d3649 1
a3649 2
   read more about these at [6]http://www.OpenBSD.org/softupdates.html or
   you can read the [7]softupdates FAQ entry.
d3651 1
a3651 1
   [8][Back to Main Index] [9][To Section 11.0 - OpenBSD 2.4 Specific
d3655 2
a3656 2
   [10][back] [11]www@@openbsd.org
   $OpenBSD: faq12.html,v 1.3 1999/05/29 05:34:18 ericj Exp $
d3665 5
a3669 6
   6. http://www.openbsd.org/softupdate.html
   7. http://www.openbsd.org/faq/faq4.html#4.9
   8. http://www.openbsd.org/faq/index.html
   9. http://www.openbsd.org/faq/faq24.html
  10. http://www.openbsd.org/faq/index.html
  11. mailto:www@@openbsd.org
d4370 1
a4370 1
   $OpenBSD: upgrade-minifaq.html,v 1.3 1999/06/03 20:08:31 kjell Exp $
@


1.3
log
@update
@
text
@d2 4373
@


1.2
log
@Fixed typo (namme -> name) Zbynek.Chmela@@vscht.cz
@
text
@a0 2239
OpenBSD Frequently Asked Questions - Ver. 2.5 

This FAQ is specifically designed for the 2.5 release of OpenBSD, but in some
cases will work on earlier versions. This FAQ will take you through most 
critical steps to setting up your own OpenBSD system. The addressed
questions will range from newbie to advanced users. Hopefully you will
find this FAQ useful. 

This FAQ was recently updated to support the newest version of OpenBSD. To
view information for previous versions, please refer to FAQ section 11.0, or
errata.html. 

Any questions can be directed to: faq@@openbsd.org 

The Current FAQ maintainers are:
Eric Jackson
Wim Vandeputte


1.0 - Introduction to OpenBSD

     1.1 - What is OpenBSD? 
     1.2 - What platforms are supported? 
     1.3 - Is OpenBSD really free? 
     1.4 - Why might I want to use OpenBSD? 
     1.5 - How can I help support OpenBSD? 
     1.6 - Who maintains OpenBSD? 

2.0 - Other OpenBSD information resources 

     2.1 - Web Pages 
     2.2 - Mailing Lists 
     2.3 - Manual Pages 
     2.4 - Reporting Bugs 

3.0 - Obtaining OpenBSD 

     3.1 - Buying an OpenBSD CD 
     3.1.1 - Buying OpenBSD T-Shirts 
     3.2 - Downloading via FTP or AFS 
     3.3 - Obtaining Current Source Code 

4.0 - Installation and Disk Setup 

     4.1 - Installing from CD 
     4.2 - Installing from FTP 
     4.3 - Installing via DHCP 
     4.4 - What files are needed for Installation? 
     4.5 - Using the OpenBSD disklabel 
     4.6 - Using fdisk 
     4.7 - Adding extra disks in OpenBSD 
     4.8 - How to swap to a file 
     4.9 - Soft-updates 
     4.10 - How much space do I need for an OpenBSD installation? 
     4.11 - When I boot after installation of i386 OpenBSD it says "partition 
	    3 id 0". 
     4.12 - How do I get a dmesg from a boot floppy? 
     4.13 - I changed scsi controllers and now I cannot boot OpenBSD. It just 
	    says: "reading boot.. Bad magic" 
	   ( Installing Boot blocks - i386 specific ) 

For Upgrading from various versions of OpenBSD, be sure to read the Upgrade 
Mini-FAQ at http://www.codetalker.com/greenbox/docs/obsd-upgrade-minifaq.html 

5.0 - Kernel Configuration and Setup 

     5.1 - Why do I need a custom kernel? 
     5.2 - Kernel configuration Options 
     5.3 - Building your own kernel 
     5.4 - Boot-time configuration 

6.0 - Networking 

     6.1 - Initial network setup 
     6.2 - IPF, NAT 
     6.3 - IPSEC 
     6.4 - DHCP 
     6.5 - PPP 

7.0 - Keyboard controls 

     7.1 - How do I remap the keyboard? 
     7.2 - Is there gpm or the like in OpenBSD? 

8.0 - General Questions 

     8.1 - What are these kerberos warnings when I first login? 
     8.2 - How do I change virtual terminals? 
     8.3 - I forgot my root password..... WHAT DO I DO?!? 
     8.4 - X craps out when I startup.. what am I doing wrong? 
     8.5 - What is CVS, and how do I use it? 
     8.6 - What is the ports tree? 
     8.7 - What are packages? 
     8.8 - Is there any way to use my floppy drive if it's not attached 
	   during boot? 

9.0 - Migrating from Linux 

     9.1 - Simple tips for ex-linux users 
     9.2 - Dual boot of Linux and OpenBSD 

10.0 - System Administration 

     10.1 - When I try to su to root it says that I'm in the wrong group 
     10.2 - How do I duplicate a filesystem? 
     10.3 - How do I get httpd, sendmail, etc to start up with the system? 
     10.4 - Why do users get relaying access denied when they are remotely 
	    sending mail through my OpenBSD system? 
     10.5 - I've set up POP, but I get errors when accessing my mail thru POP.
	    What can i do? 
     10.6 - Setting up a Secure HTTP Server using SSL(8) 
     10.7 - I made changes to /etc/passwd with vi(1), but the changes didn't 
	    seem to take place. Why? 
     10.8 - How do I add a user? or delete a user? 
     10.9 - How do I create a ftp-only account? 

11.0 - OpenBSD 2.4 Specific Information 

     11.1 - Why do I get UserDir errors when running httpd(8)? 
     11.2 - Installing at a partition 4GB or higher (i386 specific) 
     Log24.txt - Specific OpenBSD 2.4 Install Example 

12.0 - Performance Tuning 

     12.1 - Networking 
     12.2 - Disk IO 

1.0 - Introduction to OpenBSD

1.1 - What is OpenBSD?

The OpenBSD project produces a freely available, multi-platform
4.4BSD-based UNIX-like operating system. Our efforts place emphasis
on portability, standardization, correctness, and security. OpenBSD
supports binary emulation of most binaries from SVR4 (Solaris),
FreeBSD, Linux, BSDI, SunOS, and HPUX.


1.2 - On what systems does OpenBSD run?

OpenBSD 2.5 will install and run on the following platforms: 

     i386 - bootable 
     sparc - bootable 
     alpha - bootable 
     hp300 
     amiga 
     mac68k 
     powerpc 
     pmax 
          the pmax port is not included on the 2.5 cd. But can be
          downloaded from any of the OpenBSD ftp sites 

* note * - bootable means that for those smart people who bought the
cd, that it OpenBSD can be booted directly from the CD. 

Previous releases of OpenBSD also had ports for: 

     arc 
     mvme68k 

These were removed from the 2.4 release, but were included in 2.3 if you
are interested. You can see updated information about specific platforms
at http://www.openbsd.org/plat.html


1.3 - Is OpenBSD really free?

OpenBSD is all free. The binaries are free. The source is free. All parts of
OpenBSD have reasonable copyright terms permitting free redistribution.
This includes the ability to REUSE most parts of the OpenBSD source
tree, either for personal or commercial purposes. OpenBSD has put NO
further restrictions other than those implied by the original BSD license,
which will allow greater applicability. Because of this, software which is
written under stricter licenses cannot be included in the regular distribution
of OpenBSD. 

For futher reading on other popular licenses read:
http://www.openbsd.org/policy.html. 

The maintainers of OpenBSD support the project largely from their own
pockets. This includes the time spent programming for the project,
equipment used to support the many ports, the network resources used to
distribute OpenBSD to you, and the time spent answering questions and
investigating users' bug reports. The OpenBSD developers are not
independently wealthy and even small contributions of time, equipment,
and resources make a big difference. 


1.4 - Why might I want to use OpenBSD?

New users frequently want to know whether OpenBSD is superior to
some other free UNIX-like operating system. That question is largely
un-answerable and is the subject of countless (and useless) religious
debates. Do not, under any circumstances, ask such a question on an
OpenBSD mailing list. 

Below are some reasons why we think OpenBSD is a useful operating
system. Whether OpenBSD is right for you is a question that only you can
answer. 

     OpenBSD runs on many different hardware platforms. 
     OpenBSD is thought of by many security professionals to be the
     most secure UNIX-like operating system as the result of a
     10-member 1.5-year long comprehensive source code security
     audit. 
     OpenBSD is a full-featured UNIX-like operating system available
     in source form at no charge. 
     OpenBSD integrates cutting-edge security technology suitable for
     building firewalls and private network services in a distributed
     environment. 
     OpenBSD benefits from strong on-going development in many
     areas, offering opportunities to work with emerging technologies
     with an international community of programmers and end-users. 
     OpenBSD offers opportunities for ordinary people to participate in
     the development and testing of the product. 


1.5 - How can I help support OpenBSD?

We are greatly indebted to the people and organizations that have
contributed to the OpenBSD project. They are acknowledged by name
here: 

http://www.openbsd.org/donations.html 

OpenBSD has a constant need for several types of support from the user
community. If you find OpenBSD useful, you are strongly encouraged to
find a way to contribute. If none of the suggestions below are right for
you, feel free to propose an alternative by sending e-mail to
donations@@openbsd.org. 

 -   Buy an OpenBSD CD. It includes the current full release of
     OpenBSD, and is bootable on many platforms. It also generates
     revenue to support the OpenBSD project, and reduces the strain
     on network resources used to deliver the distribution via the
     Internet. This inexpensive two-CD set includes full source.
     Remember, your friends need their own copy! 
 -   Donate money. The project has a constant need for cash to pay for
     equipment, network connectivity, and expenses relating to CD
     publishing. Manufacturing CDs requires an up-front out-of-pocket
     investment for the OpenBSD developers, without guaranteed
     return. Send e-mail to donations@@openbsd.org to find out how to
     contribute. Even small donations make a profound difference. 
     Donate equipment and parts. The project has a constant need for
     general and specific hardware. Items such as IDE and SCSI disks,
     and various types of RAM are always welcome. For other types of
     hardware such as computer systems and motherboards, you
     should inquire as to current need. Write to
     donations@@openbsd.org to arrange for shipment. 
 -   Donate your time and skills. Programmers who enjoy writing
     operating systems are naturally always welcome, but there are
     literally dozens of other ways that people can be useful. Follow
     mailing lists and help answer new-user questions. 
 -   Help maintain documentation by submitting new FAQ material (to
     faq@@openbsd.org). Form a local user group and get your friends
     hooked on OpenBSD. Make a case to your employer for using
 -   OpenBSD at work. If you're a student, talk to your professors
     about using OpenBSD as a learning tool for Computer Science or
     Engineering courses. It's also worth mentioning one of the most
     important ways you should not try to "help" The OpenBSD
     project: do not waste your time engaging in operating system flame
     wars on Usenet newsgroups. It does not help the project to find
     new users and can cause substantial harm to important
     relationships that developers have with other developers. 


1.6 - Who maintains OpenBSD?

OpenBSD is maintained by a development team spread across many
different countries. The project is coordinated by Theo de Raadt, located
in Canada. 

2.0 - Other OpenBSD information resources

2.1 - Web Pages of Interest

The official website for the OpenBSD project is located at:
http://www.OpenBSD.org 

A lot of valuable information can be found here regarding about all
aspects of the OpenBSD project. 

Additional information for laptop users can be found at:
http://www.monkey.org/openbsd-mobile/ and
http://www.cpio.net/openbsd/laptops/ 


2.2 - Mailing Lists

The OpenBSD project maintains several popular mailing lists which users
should subscribe to and follow. To subscribe to a mailing list, send an
e-mail message to majordomo@@openbsd.org. That address is an
automated subscription service. In the body of your message, on a single
line, you should include a subscribe command for the list you wish to join.
For example: 

subscribe announce 

The list processor will reply to you, asking for confirmation of your intent
to join the list. The confirmation you send back to the list processor will
be included in its reply to you. It will look something like this: 

auth 90855167 subscribe announce you@@example.com 

Once you have confirmed your intent to join, you will be immediately
added to the list, and the list processor will notify you that you were
successfully added. 

To unsubscribe from a list, you will again send an e-mail message to
majordomo@@openbsd.org. It might look like this: 

unsubscribe announce 

If you have any difficulties with the mailing list system, please first read the
instructions. They can be obtained by sending an e-mail message to
majordomo@@openbsd.org with a message body of "help". These are the
currently-available OpenBSD mailing lists:

     announce - Important announcements. This is a low-volume list. 
     tech - General technical discussions 
     misc - User questions and answers 
     bugs - Bugs received via sendbug(1) and discussions about them. 
     source-changes - Automated mailing of CVS source tree
     changes. 
     ports - Automated mailing of CVS source tree changes. 
     advocacy - Discussion of advocating OpenBSD. 

Archives of the OpenBSD mailing lists can be found by visiting the mailing
lists web page: http://www.openbsd.org/mail.html 
You can also get mail archives from
http://www.monkey.org/cgi-bin/wilma ,here they have searchable archives
of the OpenBSD mailing lists. 

Another mailing list that may be of interest is
openbsd-mobile@@monkey.org. Which is a discussion of the use of
OpenBSD in mobile computing. 

To subscribe to this list use: 

'echo subscribe | mail
"openbsd-mobile-request@@monkey.org"' 

The archives for that can be found at:
http://www.monkey.org/openbsd-mobile/archive/ 


2.3 - Manual Pages

OpenBSD comes with extensive documentation in the form of manual
pages, as well as longer documents relating to specific applications. To
access the manual pages and other documentation, be sure that you
installed the man, misc, and text distributions. 

Here is a list of some of the most useful manual pages for new users: 

     afterboot(8) - things to check after the first complete boot 
     boot(8) - system boot strapping procedures 
     passwd.conf(5) - format of the password configuration file 
     adduser_proc(8) - procedure for adding new users 
     adduser(8) - command for adding new users 
     vipw(8) - edit the pass word file 
     man(1) - display the on-line manual pages 
     sendbug(1) - send a problem report (PR) about OpenBSD to a
     central support site. 
     disklabel(8) - Read and write disk pack label. 
     ifconfig(8) - configure network interface parameters. 
     route(8) - manualy manipulate the routing tables. 
     netstat(1) - show network status. 
     reboot, halt(8) - Stopping and restarting the system. 
     shutdown(8) - close down the system at a given time. 
     boot_config(8) - how to change kernel configuration at boot 

Also, If you are one of the people who didn't install the man*.tar.gz
package, you can find all the OpenBSD man pages on the web at
http://www.openbsd.org/cgi-bin/man.cgi. 

In general, if you know the name of a command or a manual page, you
can read it by executing `man command'. For example: `man vi' to
read about the vi editor. If you don't know the name of the command, or
if `man command' doesn't find the manual page, you can search the
manual page database by executing `apropos something' or `man
-k something' where something is a likely word that might appear in
the title of the manual page you're looking for. For example: 

bsd# apropos "time zone"
tzfile (5) - time zone information
zdump (8) - time zone dumper
zic (8) - time zone compiler

The parenthetical numbers indicate the section of the manual in which that
page can be found. In some cases, you may find manual pages with
identical names living in separate sections of the manual. For example,
assume that you want to know the format of the configuration files for the
cron daemon. Once you know the section of the manual for the page you
want, you would execute `man n command' where n is the manual
section number. 

bsd# man -k cron
cron (8) - daemon to execute scheduled commands (Vixie Cron)
crontab (1) - maintain crontab files for individual users (V3)
crontab (5) - tables for driving cron
bsd# man 5 crontab

In addition to the UNIX manual pages, there is a typesettable document
set (included in the misc distribution). It lives in the /usr/share/doc
directory. If you also installed the text distribution, then you can format
each document set with a `make' in the appropriate subdirectory. The psd
subdirectory is the Programmer's Supplementary Documents distribution.
The smm subdirectory is the System Manager's Manual. The usd
subdirectory is the UNIX User's Supplementary Documents distribution.
You can perform your `make' in the three distribution subdirectories, or
you can select a specific section of a distribution and do a `make' in its
subdirectory. Some of the subdirectories are empty. By default,
formatting the documents will result in Postscript output, suitable for
printing. The Postscript output can be quite large -- you should assume
250-300% increase in volume. If you do not have access to a Postscript
printer or display, you may also format the documents for reading on a
terminal display. In each Makefile you'll need to add the flag -Tascii to
each instance of the groff commands (or execute it by hand). Some of the
documents use the ms formatting macros, and some use the me macros.
The Makefile in each document subdirectory (eg,
/usr/share/doc/usd/04.csh/Makefile) will tell you which one to use. For
example: 

bsd# cd /usr/share/doc/usd/04.csh
bsd# groff -Tascii -ms tabs csh.1 csh.2 csh.3 csh.4 csh.a csh.g > csh.txt 
bsd# more csh.txt

The UNIX manual pages are generally more current and trustworthy than
the typesettable documents. The typesettable documents sometimes
explain complicated applications in more detail than the manual pages do. 


2.4 - Reporting Bugs

Proper bug reporting is one of the most important responsibilities of end
users. Very detailed information is required to diagnose most serious
bugs. Developers frequently get bugs reports via e-mail such as these: 

Before submitting any bug report, please ready
http://www.openbsd.org/report.html 

From: joeuser@@example.com
To: bugs@@openbsd.org
Subject: HELP!!!

I have a PC and it won't boot!!!!! It's a 486!!!!!


Hopefully most people understand why such reports get summarily
deleted. All bug reports should contain detailed information. If Joe User
had really wanted his bug investigated, his bug report would have looked
something like this: 

From: smartuser@@example.com
To: bugs@@openbsd.org
Subject: 2.4 panics on an i386

After installing OpenBSD 2.4 from the CD which I purchased via your outstanding
on-line ordering system, I find that the system halts before the kernel even
gets loaded. After booting with a bootdisk and escaping to a shell. This is the
dmesg output:
 
OpenBSD 2.4 (PLASMA) #2: Thu Dec 24 23:27:17 GMT 1998
    root@@plasma:/sys/arch/i386/compile/PLASMA
cpu0: Intel Pentium (P54C) ("GenuineIntel" 586-class) 90 MHz
cpu0: F00F bug workaround installed
BIOS mem  = 654336 conventional, 32505856 extended
real mem  = 33161216
avail mem = 28893184
using 430 buffers containing 1761280 bytes of memory
mainbus0 (root)
bios0 at mainbus0: AT/286+(e9) BIOS, date 08/14/97
bios0: pciinfo 0xf031b00c apminfo 0xf031b028 diskinfo 0xf031b050 cksumlen 1 memmap 0xf031b0cc
apm0 at bios0: Power Management spec V1.1
apm0: AC on, battery charge [no battery]
pci0 at mainbus0 bus 0: configuration mode 1 (bios)
pchb0 at pci0 dev 0 function 0 "Intel 82439TX System Controller (MTXC)" rev 0x01
"Intel 82371AB PIIX4 ISA Bridge" rev 0x01 at pci0 dev 7 function 0 not configured
"Cirrus Logic CL-GD5446" rev 0x45 at pci0 dev 17 function 0 not configured
isa0 at mainbus0
ep0 at isa0 port 0x300-0x30f irq 3: address 00:10:4b:25:b4:4c, utp (default utp)
lpt0 at isa0 port 0x378-0x37b irq 7
isadma0 at isa0
wdc0 at isa0 port 0x1f0-0x1f7 irq 14
atapibus0 at wdc0
wd0 at wdc0 drive 0: <WDC AC21600H>
wd0: 1549MB, 3148 cyl, 16 head, 63 sec, 512 bytes/sec (128KB cache)
wd0: using 16-sector 16-bit pio transfers, lba addressing
wdc1 at isa0 port 0x170-0x177 irq 15
atapibus1 at wdc1
acd0 at atapibus1 drive 1: <BCD 24XM CD-ROM, VER 1.0> ATAPI 5/cdrom removable
acd0: 1367Kb/sec, 128Kb cache, audio play, 255 volume levels
npx0 at isa0 port 0xf0-0xff: using exception 16
pccom0 at isa0 port 0x3f8-0x3ff irq 4: ns16550a, 16 byte fifo
pccom1 at isa0 port 0x2f8-0x2ff irq 3: ns16550a, 16 byte fifo
pcvt: doreset() - got KEYB_R_RESEND response ... [one time only msg]
pcvt: doreset() - Caution - no PC keyboard detected!
vt0 at isa0 port 0x60-0x6f irq 1: unknown Cirrus, 80 col, color, 8 scr, unknown kbd
fdc0 at isa0 port 0x3f0-0x3f7 irq 6 drq 2
fd0 at fdc0 drive 0: 1.44MB 80 cyl, 2 head, 18 sec
biomask c040 netmask c048 ttymask c0ca
root on wd0a
pctr: Pentium performance counters and user-level cycle counter enabled
dkcsum: wd0 matched BIOS disk 80
rootdev=0x0 rrootdev=0x300 rawdev=0x302

Thank you!

If Joe User had a working OpenBSD system from which he wanted to
submit a bug report, he would have used the sendbug(1) utility to submit
his bug report to the GNATS problem tracking system. Obviously you
can't use sendbug(1) when your system won't boot, but you should use it
whenever possible. You will still need to include detailed information
about what happened, the exact configuration of your system, and how to
reproduce the problem. The sendbug(1) command requires that your
system be able to deliver electronic mail successfully on the Internet. 

If you have submitted a bug report and you want to check its current
status without annoying anyone, the best ways are: 

     Visit the GNATS tracking system:
     http://cvs.openbsd.org/cgi-bin/wwwgnats.pl. 
     Look in the bugs@@openbsd.org list archives:
     http://www.openbsd.org/mail.html. 

3.0 - Obtaining OpenBSD

3.1 - Buying an OpenBSD CD

Purchasing an OpenBSD CD is generally the best way to get started.
Visit the ordering page to purchase your copy:
http://www.openbsd.org/orders.html. 

There are many good reasons to own an OpenBSD CD: 

     CD sales support on-going development of OpenBSD. 
     Development of a multi-platform operating system requires
     constant investment in equipment. 
     Your support in the form of a CD purchase has a real impact on
     future development. 
     The CD contains binaries (and source) for all supported platforms. 
     The CD is bootable on several platforms, and can be used to
     bootstrap a machine without a pre-existing installed operating
     system. 
     The CD is useful for bootstrapping even if you choose to install a
     snapshot. 
     Installing from CD is faster! Installing from CD preserves network
     connectivity resources. 
     OpenBSD CD's always come with very nice stickers. You system
     isn't fully complete without these. You can only get these stickers
     by buying a CD set or donating hardware. 

If you're installing a release version of OpenBSD, you should use a CD.
Snapshot releases can only be installed over the network. 

3.1.1 - Buying OpenBSD T-Shirts

Yes, OpenBSD now has t-shirts for your wearing enjoyment. You can
view these at http://www.OpenBSD.org/tshirts.html. Enjoy :) 

3.2 - Downloading via FTP or AFS

There are numerous international mirror sites offering FTP access to
OpenBSD releases and snapshots. AFS access is also available. You
should always use the site closest to you. Before you begin fetching a
release or snapshot, you may wish to use ping and traceroute to
determine which mirror site is nearest to you and whether that nearest
mirror is performing adequately. Of course, your OpenBSD release CD
is always closer than any mirror. Access information is here: 

http://www.openbsd.org/ftp.html 

3.3 - Obtaining Current Source Code

Source to OpenBSD is freely redistributable and available at no charge.
Generally the best way to get started with a current source tree is to install
the source from the most recent CD and then configure AnonCVS to
update it regularly. Information about AnonCVS, including how to set it
up, is available here: 

http://www.openbsd.org/anoncvs.html. 

or check The OpenBSD FAQ 

If you don't have sufficient network bandwidth to support AnonCVS, or
if your Internet access is via UUCP, you can still keep your source
current by using CTM instead of AnonCVS. If that's your situation, then
starting with a recent release CD is even more important. Information
about CTM, including how to set it up, is available here: 

http://www.openbsd.org/ctm.html. 

4.1 - Installing from the OpenBSD CD

Installing from a CD is definatly the BEST choice, but first you must have
purchased a cd. You can obtain a cd from
http://www.openbsd.org/orders.html. If you are using either the i386,
SPARC or Alpha platforms you can boot directly off the CD. If not, you
will have to create a bootdisk. You can get the boot disk from
ftp://ftp.openbsd.org/pub/OpenBSD/2.5/$ARCH/floppy25.fs

To create this boot disk, use either the unix tool dd(1) or MSDOS
rawrite from the tools directory on the cd. Rawrite doesnt work if you are
an NT user, so you can also use fdimage or ntrw.exe which are both
also in the tools directory. 

To use dd, do the following:

# dd if=floppy25.fs of=/dev/fd0a 

or to whichever device you want to write the floppy binary to. 

After that is completed, boot from your media of choice, (cdrom or
bootdisk) and answer the questions accordingly. Here is an example
installation. 

Example Install 


4.2 - Installation via FTP

The ftp installation is almost the same as the normal installation. The same
bootdisk will be used. 

floppy25.fs 

Just like the CD install you will set up your disk, then when you specify
install media you choose (f)tp. You must take care to give the proper
settings when you are asked to configure your network. Have handy,
your ipaddress (see below for dhcp), netmask, nameserver addresses,
and default route. Once your network is configured correctly, you must
choose the (f)tp installation option. You will be asked a few simple
questions about proxys and passive or active transfers, and the you will
be presented with a list of ftp servers. Select the one closest to you, and
your on your way. 

Consult the install text for help. 


4.3 - Installation via DHCP

Installation via DHCP is the same as ftp, except your system will use
DHCP to configure your network. When you arrive at the network config
option, choose DHCP and your network will be setup accordingly. The
all you have to do is follow the remainder of the directions from ftp install
above and you will be set. 

Consult the install text for help. 


4.4 - What files are needed for Installation?

There are many packages containing the OpenBSD binaries, but which
ones do you need to get your system up and running? Here is an
overview of each package. 

     base25.tar.gz - Has the BASE OpenBSD system *NEEDED* 
     etc25.tar.gz - Has all the files in /etc *NEEDED* 
     comp25.tar.gz - Has the compiler and its tools, libs.
     *STRONGLY SUGGESTED* 
     man25.tar.gz - Holds man pages *STRONGLY SUGGESTED* 
     misc25.tar.gz - Holds misc info, setup docs 
     text25.tar.gz - Holds more text files, and setup documentation 
     game25.tar.gz - Has the Games for OpenBSD *FUN* 
     xbase25.tar.gz - Has the base install for X11 
     xfont25.tar.gz - Holds X11's font server and fonts 
     xlink25.tar.gz - Has the X servers link kit 
     xserv25.tar.gz - Has X11's X servers 
     xshare25.tar.gz - Has manpages, locale settings, includes, etc for
     X 


4.5 - Using the OpenBSD disklabel

Be sure to check the disklabel(8) man page! 

Disklabel is used to identify disk's and/or partitions. The main idea behind
them is abstraction of disk hardware, since there exists several partitioning
tables. A disklabel is a universal partitioning table. These labels tell the
system everything about the disk, from the Maker to rpm's to
track-to-track seek. This label resides on the beginning of the disk, this
isto help bootstrap code use them (since most ROM based booting reads
the first sectors of the first disk). It also will show you partitions and their
types on your disk. Disklabel can, on some systems, be used to install
bootstrap code. 

As an additional gain, using disklabels helps overcome architecture
limitations on disk partitioning. For example on i386 you can only have 4
primary partitions, with disklabel you can put several labels on one
partition (eg. 'swap', '/', '/usr' and '/var'). And you still have 3 more
partitions available for other OSs! 

You can think of them as 'subpartitions' for installation purposes. But they
are a necesity for kernel disk access based on geometry. And remember
to use 'b' for the swap label, and 'a' for root filesystem (default names in
kernel). 

To just view the current disklabel for your disk just do:
# disklabel < disk-device name >
This will give output similar to this:

# using MBR partition 3: type A6 off 64 (0x40) size 16777152 (0xffffc0)
# /dev/rwd0c:
type: ESDI
disk: 
label: TOSHIBA MK2720FC
flags:
bytes/sector: 512
sectors/track: 63
tracks/cylinder: 16
sectors/cylinder: 1008
cylinders: 2633
total sectors: 2654064
rpm: 3600
interleave: 1
trackskew: 0
cylinderskew: 0
headswitch: 0           # milliseconds
track-to-track seek: 0  # milliseconds
drivedata: 0 

16 partitions:
#        size   offset    fstype   [fsize bsize   cpg]
  a:  2071440    65583    4.2BSD     1024  8192    16   # (Cyl.   65*- 2120)
  b:    65520       63      swap                        # (Cyl.    0*- 65)
  c:  2654064        0    unused        0     0         # (Cyl.    0 - 2632)
  j:   512001  2137023    4.2BSD     1024  8192    16   # (Cyl. 2120*- 2627*)

In this example, there are 4 labels - A, B, C, J. A is one main partition, B
is swap, and J is another partition. C in all cases represents the full disk.
This is helpful in showing what valuses in size, cyl, etc you have to work
with. But with this command you cannot change any values, you can just
view. 

To be able to edit your label's interactivly you would use the -E flag.
Example:

# disklabel -E wd0
# using MBR partition 3: type A6 off 64 (0x40) size 16777152 (0xffffc0)

Treating sectors 64-16777216 as the OpenBSD portion of the disk.
You can use the 'b' command to change this.

Initial label editor (enter '?' for help at any prompt)
> ?
Available commands:
        p [unit]  - print label.
        M         - show entire OpenBSD man page for disklabel.
        e         - edit drive parameters.
        a [part]  - add new partition.
        b         - set OpenBSD disk boundaries.
        c [part]  - change partition size.
        d [part]  - delete partition.
        m [part]  - modify existing partition.
        r         - recalculate free space.
        u         - undo last change.
        s [path]  - save label to file.
        w         - write label to disk.
        q         - quit and save changes.
        x         - exit without saving changes.
        ? [cmnd]  - this message or command specific help.
Numeric parameters may use suffixes to indicate units:
        'b' for bytes, 'c' for cylinders, 'k' for kilobytes, 'm' for megabytes,
        'g' for gigabytes or no suffix for sectors (usually 512 bytes).
        Non-sector units will be rounded to the nearest cylinder.
Entering '?' at most prompts will give you (simple) context sensitive help.
> p 
device: /dev/rwd0c
type: ESDI
disk: 
label: TOSHIBA MK2720FC
bytes/sector: 512
sectors/track: 63
tracks/cylinder: 16
sectors/cylinder: 1008
cylinders: 2633
total sectors: 2654064
free sectors: 14193711
rpm: 3600

16 partitions:
#        size   offset    fstype   [fsize bsize   cpg]
  a:  2071440    65583    4.2BSD     1024  8192    16   # (Cyl.   65*- 2120)
  b:    65520       63      swap                        # (Cyl.    0*- 65)
  c:  2654064        0    unused        0     0         # (Cyl.    0 - 2632)
  j:   512001  2137023    4.2BSD     1024  8192    16   # (Cyl. 2120*- 2627*)
> q
No changes.

In this example we get into disklabel's interactive mode. From here we
can issue the command "?" asking for help. This gives us many commands
we can use to add, delete, edit existing labels. 

There is a new feature on disklabel, to help installation. The '-f' flag writes
a 'fstab' like file, if given a mount point for a label. This is only used at
installation. 

To see an example install involving disklabel check log25.txt 


4.6 - Using fdisk

First be sure to check the fdisk main page. fdisk(8) 

Fdisk is a program to help with the maintenance of your partitions. This
program is used at install time to set up your OpenBSD partition (this
partition can contain several labels, each with filesystems/swap/etc.). It
can divide space on your drives and set one active. This program will
usually be used in Single User Mode ( boot -s ). Fdisk also sets the MBR
on your various hard disks. 

For installation purposes, most times you'll only need ONE Openbsd
partition, and then using disklabel to put a swap and a filesystem on it. 

To just view your partition table using fdisk just use:
# fdisk fd0
Which will give an output similar to this:

         Disk: fd0       geometry: 80/2/18 [2880 sectors]
         Offset: 0       Signatures: 0xAA55,0x0
                  Starting        Ending
          #: id  cyl  hd sec -  cyl  hd sec [     start -       size]
----------------------------------------------------------------------
         *0: A6    0   0   1 -   79   1  18 [         0 -       2880] OpenBSD
          1: 00    0   0   0 -    0   0   0 [         0 -          0] unused
          2: A7    0   0   2 -   79   1  18 [         1 -       2879] NEXTSTEP
          3: 00    0   0   0 -    0   0   0 [         0 -          0] unused

In this example we are viewing the fdisk output of floppy drive. We can
see the OpenBSD partition (A6) and its size. The * tells us that the
OpenBSD partition is a bootable partition. 

In the previous example we just viewed our information. What if we want
to edit our partition table? Well, to do so we must use the -e flag. This
will bring up a command line prompt to interact with fdisk. 

# fdisk -e wd0
Enter 'help' for information
fdisk: 1> help
        help            Command help list
        manual          Show entire OpenBSD man page for fdisk
        reinit          Re-initialize loaded MBR (to defaults)
        disk            Edit current drive stats
        edit            Edit given table entry
        flag            Flag given table entry as bootable
        update          Update machine code in loaded MBR
        select          Select extended partition table entry MBR
        print           Print loaded MBR partition table
        write           Write loaded MBR to disk
        exit            Exit edit of current MBR, without saving changes
        quit            Quit edit of current MBR, saving current changes
        abort           Abort program without saving current changes
fdisk: 1> 
 

It is perfectly safe in fdisk to go in and explore, just make sure to answer
N to saving the changes and *DON'T* use the write command. 

Here is an overview of the commands you can use when you choose the
-e flag.

     help Display a list of commands that fdisk understands in the
     interactive edit mode. 
     reinit Initialize the currently selected, in-memory copy of the boot
     block. 
     disk Display the current drive geometry that fdisk has probed.
     You are given a chance to edit it if you wish. 
     edit Edit a given table entry in the memory copy of the current
     boot block. You may edit either in BIOS geometry mode, or in
     sector offsets and sizes. 
     flag Make the given partition table entry bootable. Only one entry
     can be marked bootable. If you wish to boot from an extended
     partition, you will need to mark the partition table entry for the
     extended partition as bootable. 
     update Update the machine code in the memory copy of the
     currently selected boot block. 
     select Select and load into memory the boot block pointed to by
     the extended partition table entry in the current boot block. 
     print Print the currently selected in-memory copy of the boot
     block and its MBR table to the terminal. 
     write Write the in-memory copy of the boot block to disk. You
     will be asked to confirm this operation. 
     exit Exit the current level of fdisk, either returning to the previously
     selected in-memory copy of a boot block, or exiting the program if
     there is none. 
     quit Exit the current level of fdisk, either returning to the previously
     selected in-memory copy of a boot block, or exiting the program if
     there is none. Unlike exit it does write the modified block out. 
     abort Quit program without saving current changes. 


4.7 - Adding new disks in OpenBSD

Well once you get your disk installed PROPERLY you need to use
fdisk(8) and disklabel(8) to set up your disk in OpenBSD. Making sure
that the partition ID is 'A6'. Once you have done this, OpenBSD will be
able to recognize the new disk, and you need to create the filesystem on
that disk using newfs(8). 

bsd# newfs wd1a 

or so on using OpenBSD's disk numbering scheme 

  wd0
  wd1
  wd2

Edit fstab to mount the new disk at a mount point of your choice, and
reboot. 

If you need to migrate an existing directory like /usr/bin. You should
mount the new drive in /mnt and use cpio -pdum to copy /usr/bin to the
/mnt directory. Edit the /etc/fstab file to show that /usr/bin will be mounted
on the new drive. example: 

/dev/wd1a /usr/bin ffs rw 1 1 

Reboot into single user mode..boot -s Move the existing /usr/bin to
/usr/bin-backup and create an empty /usr/bin. Then reboot the system,
and whala!! the files are there! 


4.8 - How do I swap to a file?

First make a kernel with vnd0c as swap. If you have wd0a as root
filesystem, wd0b is the previous swap, use this line in the kernel
configuration file (refer to compiling a new kernel if in doubt): 

config          bsd     root on wd0a swap on wd0b and vnd0c dumps on wd0b

Second make the file for swap. If you want a 32MB swapfile named
/newswap do: 

# dd if=/dev/zero of=/newswap bs=1k count=32768 

Add a line to your /etc/fstab file to indicate where the new swap will be. 

/dev/vnd0c none sw 0 0 

Now boot with the new kernel. Then create the vnd0 device to use that
file as a device: 

# vnconfig -c -v vnd0 /newswap 

And add it now to swap: 

# swapon /dev/vnd0c 

You can now see if it is working with: 

# pstat -s 


4.9 - Softupdates

Softupdates are experimental and are NOT recomended for
regular users. 

Please read http://www.openbsd.org/softupdate.html 

To enable Softupdates your kernel must have option 

option FFS_SOFTUPDATES 

then you need to boot into single-user mode: 

boot>boot -s
[snip]
bsd# tunefs -s enable <raw device>
bsd# reboot -n

GOOD LUCK. you just might need it. 


4.10 - How much space do I need for an
OpenBSD installation?

The following are suggested sub-tree sizes for a full system install. The
numbers include enough extra space to permit you to run a typical home
system that is connected to the internet: 

SYSTEM          /       /usr    /var    /usr/X11R6
alpha           50M     433M    20M     160MB
amiga           27M     173M    20M      64M
arc             47M     268M    20M      60M
hp300           26M     120M    20M      50M
i386            30M     172M    20M      85M
mac68k          26M     172M    20M      75M
mvme68k         26M     173M    20M      60MB (no Xserver)
pmax            44M     267M    20M      60M
sparc           35M     194M    20M      50M

When you are in the disklabel editor, you may choose to make your
entire system have just an 'a' and 'b' partition. The 'a' partition you set up
in disklabel will become your root partition, which should be the sum of
all the 3 main values above (/, /usr, and /var) plus some space for /tmp.
The 'b' partition you set up automatically becomes your system swap
partition -- we recommend a minimum of 32MB but if you have disk to
spare make it at least 64MB. 

However, we recommend you use many seperate partitions so that users
cannot fill up your important partitions as easily, thus causing nasty denial
of service problems. If you are extra cautious, you will make at least the
following seperate partitions: / swap /usr /var /tmp /var/tmp /home. 


4.11 - How do I get rid of "partition 3 id 0"
error on boot?

The solution to this is problem is using a bootloader. The OpenBSD cd
has the os-bs bootloader included in the tools directory. If you didn't
purchase a CD-ROM, you can download os-bs from any of the
OpenBSD ftp sites. 

pub/OpenBSD/2.5/tools/osbs135.exe 

and take some time to look through the web pages at
http://www.prz.tu-berlin.de/~wolf/os-bs.html 

There are also other commercial bootloaders or lilo that you can use for
multi-booting. 


4.12 - How do I get a dmesg from a boot
floppy?

RAMDISK images (boot floppies) do not ship with the dmesg utility.
They do, however, have the /kern filesystem mounted. To copy the
dmesg information to a file, do a: 

# cat /kern/msgbuf >mydmesg

4.13 - Installing bootblocks (i386 specific)

PC BIOS's can only deal with disk geometries with 1024 cylinders or
less. Since most disks these days have more than 1024 cylinders, most
PC scsi controllers "translate" the real disk geometry into something that
fits within the BIOS's parameters. However, not all scsi controllers
"translate" the geometry in the same way. If you change scsi controllers
and they use a different "translated" geometry you will be unable to load
the second stage boot loader (and thus unable to load the kernel) because
the first stage boot loader contains a list of the blocks that comprise /boot
in terms of the "translated" geometry. To fix this, just boot from a boot
floppy and at the boot prompt, type "b hd0a:/bsd" to boot from the first
hard disk (and not the floppy). Your machine should come up normally.
You now need to update the first stage boot loader (aka the boot block).
This is also the same way to for any disk device, ide disks and scsi disks
in OpenBSD. 
To do this, assuming your boot disk is sd0: 

cd /usr/mdec; ./installboot /boot biosboot sd0

5.0 - Kernel Configuration and
Disk Setup

5.1 - Why would I want to create my own
custom kernel?

Its a joyous occasion when you as a user get to configure and build your
own custom kernel. Why would you want to do this though? 

     You can define which drivers your computer has support for. 
     You can get rid of uneeded drivers in the GENERIC kernel 
     Speed up boot times 
     Remove default options or add options which may not have been
     enabled by default 

5.2 - Kernel Configuration Options

Kernel Configuration Options are options that you add to your kernel
configuration that place certain features into your kernel. This allows you
to have exactly the support you want, without having support for uneeded
devices. There are multitudes of options that allow you to customize you
kernel. Here we will go over only some of them, one's that are most
commonly used. Check the options(4) man page for a more complete list
of options. You can also check the example configuration files that are
availible for your architecture. 

     Alpha Kernel Conf Files 
     i386 Kernel Configuration files 
     mac68k Kernel Configuration files 
     pmax Kernel Configuration Files 
     sparc Kernel Configuration Files 
     Other Arch's 

OpenBSD has a great many compatibility options which allow you to use
binaries from other OS's. Not all are availibly on every architechture, so
be sure to read the man pages for each option to see if your arch is
supported. 

     compat_svr4(8) - Compatibility with SVR4 binaries. 
     compat_bsdos(8) - Compatibility with BSD/OS binaries. 
     compat_linux(8) - Compatibility with Linux binaries. 
     compat_sunox(8) - Compatibility with SunOS binaries. 
     compat_ultrix(8) - Compatibility with Ultrix binaries. 
     compat_freebsd(8) - Compatibility with FreeBSD binaries. 
     compat_hpux - Compatibility with HP-UX binaries. Only availible
     on some m68k arch's. 
     compat_ibcs2(8) - Compatibility to run ibcs2 binaries. 
     compat_osf1 - Run Digital Unix binaries. Availible only on Alpha
     platform. 

5.3 - Building your own kernel

Full instructions for creating your own custom kernel are in the
afterboot(8) man page. 

To compile your kernel from the cdrom do the following: 

#cd /somewhere
#cp /usr/src/sys/arch/$ARCH/conf/SOMEFILE .
#vi SOMEFILE (to make the changes you want)
#config -s /usr/src/sys -b . SOMEFILE
#make 

To compile a kernel inside a writeable source tree do the following: 

#cd /sys/arch/$ARCH/conf
#vi SOMEFILE (to make any changes you want)
#config SOMEFILE (read more about it here : config(8))
#cd ../compile/SOMEFILE
#make 

Where $ARCH is the architecture you are using (e.g. i386). You can also
do a make depend to make the dependencies for the next time you
compile your kernel. 

To move your kernel into place. 

#cp /bsd /bsd.old
#cp /sys/arch/$ARCH/compile/SOMEFILE/bsd /bsd

To revert to your old kernel at boot you need to just 

boot>bsd.old

and your old kernel will be loaded instead of /bsd. 

5.4 - Boot Time Configuration 

Sometimes when booting your system you might notice that the kernel
finds your device but maybe at the wrong IRQ. And maybe you need to
use this device right away. Well, without rebuilding the kernel you can use
OpenBSD's boot time kernel configuration. This will only correct your
problem for one time. If you reboot, you will have to repeat this
procedure. So, this is only meant as a temporary fix, and you should
correct the problem by fixing and recompiling your kernel. 

Most of this document can be found in the man page boot_config(8) 

To boot into the User Kernel Config, or UKC, at boot time us the -c
option. 

Boot> boot wd0a:/bsd -c

Or whichever kernel it is you want to boot. Doing this will bring up a
UKC prompt. From here you can issue commands directly to the kernel
specifying devices you want to change or disable or even enable. 

Here is a list of common commands in the UKC. 

add device - Add a device through copying another 

change devno | device - Modify one or more devices 

disable devno | device - Disable one or more devices 

enable devno | device - Enable one or more devices 

find devno | device - Find one or more devices 

help - Short summary of these commands 

list - List ALL known devices 

exit/quit - Continue Booting 

show [attr [val]] - Show devices with an attribute and
optional with a specified value 

Once you get your device configured, use quit or exit and continue
booting. After so you should correct your Kernel configuration and
Compile a new kernel. Refer to Building your own kernel for help. 


6.0 - Networking




6.1 - Initial Network Setup

Interfaces

Here we assume you have all your network interfaces working, and a
basic TCP/IP knowledge. If not, go to the Kernel Configuration and
Setup section, and/or read a nice intro to TCP/IP. Other recommended
reading are the ifconfig(8) and netstat(1) man pages. 

All your interfaces should be listed with: 

# ifconfig -a

lo0: flags=8009<UP,LOOPBACK,MULTICAST>
        inet 127.0.0.1 netmask 0xff000000
lo1: flags=8008<LOOPBACK,MULTICAST>
xl0: flags=8843<UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST>
        media: Ethernet 100baseTX half-duplex
        inet 10.1.1.1 netmask 0xffffff00 broadcast 10.1.1.255
sl0: flags=c010&ltPOINTOPOINT,LINK2,MULTICAST>
        inet 10.1.1.1 netmask 0xffffff00 broadcast 10.1.1.255
sl0: flags=c010<POINTOPOINT,LINK2,MULTICAST>
sl1: flags=c010<POINTOPOINT,LINK2,MULTICAST>
ppp0: flags=8010<POINTOPOINT,MULTICAST>
ppp1: flags=8010<POINTOPOINT,MULTICAST>
tun0: flags=10<POINTOPOINT>
tun1: flags=10<POINTOPOINT>
enc0: flags=8<LOOPBACK>

First there is lo0 the loopback interface. It MUST have the assigned
address of 127.0.0.1 no matter what network setup you use. The next
important one is xl0 in this example (could be neX or epX depending on
the brand), which is a board itself. Look it has UP and RUNNING flags
on, as lo0 but no other interface have them. That means oviously they are
working. Your interface could be down if you never configured it, and
look like the other interfaces. The others are not part of this section, as sl
and ppp are for serial line comunication, tun is a pseudo-device for
tunneling and enc a pseudo-device for encryption. 

If xl0 was uninitialized, you can assign it an address creating a ascii file
/etc/hostname.xl0 having a string like this: 

inet mona 255.255.255.0 NONE

Here "mona" is a name that exists as a record in /etc/hosts: 

10.1.1.1        mona    mona.openbsd.org.ar

Now check that you have a file /etc/myname and a file /etc/mygate. If you
don't have them, you need to create them. If your gateway is a machine
named "wintermute" wich is also in the /etc/hosts, use this commands: 

# echo "mona" >> /etc/myname; echo "wintermute" >> /etc/mygate

Ok, you are done for a standalone system, but to activate your
configuration now (without rebooting) do: 

# sh /etc/netstart

This will give you a few errors, but don't worry as all them are concerning
127.0.0.x (loopback) 

Note: if you want to use the system as a gateway, later there's a "Firewall
Setup" section, but you need to read all this first. 

Now check your routes are ok (here we use -n aso to make it simpler to
look at): 

# netstat -rn
Routing tables

Internet:
Destination        Gateway            Flags     Refs     Use    Mtu
Interface
default            10.1.1.254         UGS         0        0      -  xl0
10.1.1/24          link#1             UC          0        0      -  xl0
10.1.1.1           127.0.0.1          UGHS        0        0      -  lo0
10.1.1.254         link#1             UHL         1        0      -  xl0
127/8              127.0.0.1          UGRS        0        0      -  lo0
127.0.0.1          127.0.0.1          UH          3       24      -  lo0
224/8              link#1             UCS         0        0      -  xl0

Encap:
Source address/netmask          Port  Destination address/netmask     Port Proto SA(Address/SPI/Proto)

(The gateway here is shown as 10.1.1.254) 

IP Aliasing

If you want to map more than one IP address on a single network
interface, you need to assign an "alias" to it. The way to do it on
OpenBSD is simply assigning the interface another IP with the "alias"
option like this: 

# ifconfig xl0 alias 10.1.1.2 netmask 255.255.255.255

Here ne2 is assigned another IP number (remember it already has
10.1.1.1). Note the netmask used! Don't use 255.255.255.0 in this kind
of cases (both numbers are on the same subnet), only ONE address
shoud handle the subnet. If you do such kind of misconfiguration the
following error appears: 

ifconfig:SIOCAIFADDR: File exists

Now let's change the configuration file for this, /etc/ifaliases. Add to it this
line: 

xl0   10.1.1.2 255.255.255.255

DNS Client Setup

Let's assume your DNS servers are 125.2.3.4 and 125.2.3.5, and your
machine name belongs to the domain yourdomain.com. Add the
following lines to your /etc/resolv.conf file: 

domain yourdomain.com
nameserver 125.2.3.4
nameserver 125.2.3.5

Gateway Setup

This is a minimal explanation, only for internal/secure networks! Read
Firewall Setup if you plan to put a gateway to internet. 

If you want to put a host that connects two subnets, and you want it to
"forward" any packet from them modify /etc/sysctl.conf line that toggles
the forwarding variable on bootup: 

net.inet.forwarding=1

To make the changes without booting: 

# sysctl -w net.inet.ip.forwarding=1
net.inet.ip.forwarding: 0 -> 1

Now modify the routes on the other hosts on both sides. 

6.2 - IPF/NAT Setup

IPF and IPNAT Setup

The IPFilter package was created to handle with two tasks, dealing with
packet level forwarding permissions and mapping hosts/subnets to a
range of external addresses. The configuration files are /etc/ipf.rules and
/etc/ipnat.rules, and also part of /etc/ 

rc.conf to activate them at boot time. You also need to have
net.inet.ip.forwarding=1! You also need a kernel compiled with option
IPFILTER and IPFILTER_LOG (the GENERIC one present in the
installation have them). 

There are a lot of nice examples on /usr/share/ipf/ for both. We
recommend you to choose the one closer to what you want, and modify it
to fit your needs. 

IPF

Modify rc.conf so it has IPFILTER=YES. The file /etc/ipf.rules has a
simple yet powerful syntax. Here we deal with the most common ways of
usage, for a more strict definition see man 5 ipf. Here is assumed xl0 as
the external interface to internet, on this one uses to have more rules than
internal interfaces. 

Configurations usually start letting everything come and go, and then apply
the necesary rules to block offending packets. So this is first: 

pass out from any to any
pass in from any to any 

Now lets block any incoming connection to port 82 tcp (eg. there's an
internal network report agent using http running on several hosts): 

block in on xl0 proto tcp from any to any port = 82

This rule means: 

"Block all incoming packets on xl0 interface whose protocol is TCP no
matter destination/origin using port 82" 

If you want to log all rejected packets add "log" after "block in", or "log
quick" if you don't want it to send a message to every console root is
logged in. 

Also a typical rule is to block rpc portmap: 

block in log on xl0 proto udp from any to any port = sunrpc

IPNAT

Based on RFC 1631, ipnat provides an easy way to map internal
networks on a range of external addresses. This is very useful if you don't
have officially asigned addresses for every host on your internal network.
When you set up private/internal networks you can take advantage of
reserved address blocks like: 

10.0.0.0, 192.168.0.0, and 172.16.0.0

If you have an internal network using 192.168.0.0 and you want to give
them access to internet using OpenBSD (of course!) and a ppp
connection using address 200.1.2.3, use this rule: 

map ppp0 192.168.0.0/16 -> 200.1.2.3/32

Note the /16 and /32, this means: 

"Any outgoing connection whose comming from an address matching the
first 16 bits of 192.168.0.0 should be mapped on local address
200.1.2.3 (only one address since /32 means every bit)" 

But here arises a problem. You are assigning a lot of addresses to only
ona (or a few) address. The way to go arount it is to map TCP and UDP
ports to a certain range with the option "portmap". But remember ICMP
doesnt work this way, it only has an ID field (usually based on process
number). So now its like this: 

map ppp0 192.168.0.0/16 -> 200.1.2.3/32 portmap tcp/udp 1024:65000
map ppp0 192.168.0.0/16 -> 200.1.2.3/32

This way things work better. If you have a dynamic address assignment
(like regular dialup modem account), you can do this: 

map ppp0 192.168.0.0/16 -> ppp0/32 portmap tcp/udp 1024:65000
map ppp0 192.168.0.0/16 -> ppp0/32


Redirecting ports

This is another very handy feature of IPNAT. If you have a host on the
internal network (using private addresses), and you want to let incoming
connections to it, you just need a simple redirect rule. For example, if you
have a web server on internal network at 10.2.2.7 listening on port 80,
and want it to be accesible from the outside simply redirecting external IP
120.2.3.4 on xl0, just add this rule to /etc/ipnat.rules: 

rdr xl0 120.2.3.4 port 80 -> 10.2.2.7 port 80

This is a little graph: 

Internet <--> (xl0) OpenBSD (xl1) <--> LAN <--> 10.2.2.7
            128.2.3.4      whatever  10.2.2.0   Web server

Remember to activate kernel must have option IP FORWARDING. Also
remember that EVERY packet MUST pass through the OpenBSD box,
i.e. you can't redirect ports to hosts on the same network and address
external to the OpenBSD box. 


6.3 - IPSEC

Be sure to check vpn man page. 

You can also check Codetalker 


6.4 - DHCP

This section is not yet completed. Please Check back soon. 


6.5 - PPP 

PPP is generally an easy thing to set up. What follows is a basic intro
based on the information provided in /etc/ppp and the ppp(8) manual
pages. These are highly suggested reading before attempting to setup PPP
or even reading this FAQ entry. If you have read these the following
should look farmiliar because it is that info with a little bit of elaboration. 

First you will need to find out a little bit about how your ISP sets up its
PPP connections. Does it use scripted login, PAP, CHAP, do you have a
dynamic or static IP etc. This along with some basic info about your
modem will allow us to easily create a PPP dial in script for your ISP. 

First we will create a PPP conf using what is already in
/etc/ppp/ppp.conf.sample as a guide. The first section we come to
is the section labeled default. This is the best place to specify logging
options, your modem device and dial options. It will always be executed
when ppp is run. The following is the default section that comes standard
with /etc/ppp/ppp.conf.sample and an explanation of what each
parameter does: 

<Default Section> 

default:
set log Phase Chat LCP IPCP CCP tun command      #This parameter tells PPP to log output which pertains 
                                                 #to the arguments you give the parameter.

set device /dev/cua01                            #This will set the default modem device on the system 
                                                 #which here is comm 2.

set speed 115200                                 #This parameter sets the speed of the serial device.

set dial "ABORT BUSY ABORT NO\\sCARRIER TIMEOUT 5 \"\" AT OK-AT-OK ATE1Q0 OK \\dATDT\\T TIMEOUT 40 CONNECT"
                                                 #This will set the commands to follow when certian actions 
                                                 #take place while dialing.  Abort the call if the number is 
                                                 #busy, abort the call if there is no carrier.  Wait 5 seconds for 
                                                 #carrier. Issue AT and wait for response. If AT is ok then dial the 
                                                 #number and timeout if not connected in 40 seconds. Once dialed
                                                 #in wait for the CONNECT message to tell us we are connected.

Now that the default modem options are set we will need to create a
section in the ppp.conf for our ISP. Below are a few examples of what
could be in there and what type of isp they are tailored for. 

<MyISP Section> 

myisp:
set phone 1234567                        #This of course sets the number to dial for your isp.

set login "ABORT NO\\sCARRIER TIMEOUT 5 ogin:--ogin: ppp word: ppp"
                                         #This sets the login options.  It will abort login if
                                         #there is no carrier with a timeout of 5 seconds.  It 
                                         #will then wait for the login: prompt and send
                                         #your login name, and then it will wait for the password 
                                         #prompt and send your password.

set timeout 120                          #This sets the timeout for the entire login process.

set ifaddr 10.0.0.1/0 10.0.0.2/0 255.255.255.0 0.0.0.0
                                         #This will set the ip address you expect your your side 
                                         #and for the remote side of the connection. The /0 bit 
                                         #tells the connection that no bits of this ip address 
                                         #need to match and the whole thing can be replaced. 
                                         #This also sets your default netmask and gateway.

add default HISADDR                      #This will make the default gateway the remote end of 
                                         #the ppp connection.

enable dns                               #This tells ppp to ask the peer for the nameserver 
                                         #addresses that should be used. This isnt always supported, 
                                         #but if it is /etc/resolv.conf will automatically be updated.

<Pap/Chap Section> 

What if your ISP uses PAP or CHAP? Here is a configuration that will
work with both PAP or CHAP, PPP will decide which it needs to use. 

myispPAPCHAP:
set PHONE 1234567                        #This line sets the phone number.

set LOGIN                                #PPP will be waiting for the peer to suggest the use of 
                                         #either PAP or CHAP.

set authname MyName                      #This is where you specify your username.

set authkey MyKey                        #This is where you specify your password.

set timeout 120                          #This sets the login timeout to 120 seconds.

And then procede with the standard commands from above. 

<Static Ip Section> 

All you need to do is change the ifaddr parameter like so: 

set ifaddr 209.115.93.18 209.115.93.20

In this example, your ip is 209.115.93.18, and the peer side ip is
209.115.93.20. 
7.0 - Keyboard controls

7.1 - How do I remap the keyboard?

By using kcon(1), "kcon - keyboard control and remapping for the pcvt
driver" 

Example: 

bsd# kcon -m gb will load the keycap file for Great Britain. 

7.2 - Is there gpm or the like in OpenBSD?

No. But if you are willing to make a port. Please share. :) 


8.0 - General Questions


8.1 - What are these Kerberos warning
when I first login?

When you first install your system you will most likely notice a warning
message that is something like this: 

Warning: no Kerberos tickets issued. 

THIS WARNING IS COMPLETELY IRRELEVANT AND
SHOULD ONLY BE REMOVED IF COMPLETELY
NECESSARY 

Well since you probably haven't set up Kerberos on your system, you
wouldn't be getting a ticket. If you do have Kerberos running, you need
to check into that. If you can't STAND that warning and never plan on
using Kerberos here is how to get rid of it for good. 

     Make sure you have the source code. 
     Edit /usr/share/mk/bsd.own.mk and set KERBEROS to 'no', or
     create an /etc/mk.conf file that does this. 
     cd /usr/src/usr.bin/login ; make clean ; make ; make install 


8.2 - How do I change virtual terminals?

Simply type [ctrl] - [alt] - [One of the function keys] or
just hit [f9]-[f12] which are just mapped to [ctrl] - [alt] functions.
(i386) 

Only the i386 arch has virtual terminal capabilities. You can also use
virtual terminals when using X. For example, If you start X on term 1, and
switch with [ctrl]-[alt]-[F2] to term 2, X will seem to disapear and will
not come back by simply switching back to term 1. You must
[ctrl]-[alt]-[F5] to get your X display back. 


8.3 - I forgot my root password, what do I
do now?

A few steps to recovery 

   1.Boot into single user mode. For i386 arch type boot -s at the boot
     prompt. 
   2.mount the drives. 
          bsd# fsck -p / && mount -u / 
          if /usr is on a different partition you need to mount that also 
   3.type passwd 
   4.boot into mulituser mode.. and REMEMBER your password . 

8.4 - X wont start, I get tons of error
messages

If you have X completely set up and you are using an XF86Config that
you know works then the problem most likely lies in the
machdep.allowapature. You also need to make sure that both: 

option XSERVER
option APERTURE

are in you kernel configuration. [BOTH these are in the GENERIC
kernel] 

Then you need to edit /etc/sysctl.conf and set machdep.allowaperture=1.
This will allow X to access the aperture driver. This would be set up if the
question during install about whether or not you would be running X was
answered correctly. OpenBSD 2.4 requires for all X servers that the
aperture driver be set, because it controls access to the I/O ports on
video boards. 

For other X problems on the i386, consult the XFree86 FAQ at
http://www.xfree86.org/FAQ/. 

8.5 - What is CVS? and How do I use it?

CVS is what the OpenBSD project uses to control changes to the source
code. CVS stands for Concurrent Versions System. You can read more
about CVS at http://www.cyclic.com/. CVS can be used by the end user
to keep up to date with source changes, and changes in the ports tree. 

CVS makes it extremely simple to download the source via one of the
many CVS mirrors for the project. 

Here are some simple commands to get you going on CVS. 

For all these commands a CVSROOT variable must be set. You
can do this by: 

If you use csh or tcsh use:
bsd# setenv CVSROOT anoncvs@@anoncvs.ca.openbsd.org:/cvs

or if you use sh or ksh use:
bsd# export
CVSROOT="anoncvs@@anoncvs.ca.openbsd.org:/cvs" 

It is best to try to find a mirror that is closest to you. You can obtain a list
of CVS mirrors from http://www.openbsd.org/anoncvs.html. 

All these commands are run from the /usr directory if you do not have the
source code already. The source or ports however can be initially
downloaded in tarred and gzipped form from any of the ftp servers. They
are set and ready to be used with CVS. 

     bsd# cvs -q get -PAd src [to get source code] or 
     bsd# cvs -q get -PAd ports [to get the ports tree] 

If you already have an existing source or ports tree: 

     bsd# cvs -q up -PAd src 
     bsd# cvs -q up -PAd ports 

For some, bandwidth and time are serious problems when updating
repository's such as these. So CVS has a -z[1-9] option which uses gzip
to compress the data. To use it, do -z[compression-level], for instance,
-z3 for a compression level of 3. 

There are many different connections you can make to a CVS mirror.
This is to accompany people from all types of networks, whether you are
behind a firewall, etc. 

You can make either a ssh, rsh, or pserver connection to the servers.
Many mirrors also run ssh on port 2022. 

To do this you can use the variable $CVS_RSH. rsh(1) is what CVS
uses by default, but using the $CVS_RSH environment variable you can
have CVS use ssh. 
An example: 

#setenv CVS_RSH /usr/local/bin/ssh
or
#export CVS_RSH=/usr/local/bin/ssh 

8.6 - What is the ports tree?

The ports tree is a set of Makefiles that download, patch, configure and
install userland programs so you can run them an OpenBSD environment
without having to do all that by hand. You can get the ports tree from any
of the OpenBSD ftp servers in /pub/OpenBSD/2.5/ports.tar.gz or
try the latest updates in /pub/OpenBSD/snapshots/ports.tar.gz. 

If you want to run one of the latest ports collections, you'll need to update
your /usr/share/mk/ directory. CVS up your /usr/src/ directory
and do a: 

# cd /usr/src/share/mk/
# make install

first. 

In 2.5-current this information is now stored in the ports tree. In
ports/infrastructure/ all thats left in /usr/src/share/mk for ports is just a
pointer to this new area. 

Ports are set up to be EXTREMELY easy to make and install. Here is an
example install for someone wanting to install the X11 program xfig.
You'll notice the dependencies are automaticly detected and completed: 

fenetyllin:/usr/ports/graphics/xfig# make install
===>  Extracting for xfig-3.2.2
===>  xfig-3.2.2 depends on shared library: jpeg.62. - /usr/local/lib/libjpeg.so.62.0 found
===>  xfig-3.2.2 depends on shared library: Xaw3d.6. - not found
===>  Verifying install for Xaw3d.6. in /usr/ports/x11/Xaw3d
>> Xaw3d-1.3.tar.gz doesn't seem to exist on this system.
>> Attempting to fetch from ftp://crl.dec.com/pub/X11/contrib/widgets/Xaw3d/R6.1/.
Connected to crl.dec.com.
220 crl.dec.com FTP server (Digital UNIX Version 5.60) ready.
331 Guest login ok, send ident as password.
230 Guest login ok, access restrictions apply.
Remote system type is UNIX.
Using binary mode to transfer files.
200 Type set to I.
250 CWD command successful.
250 CWD command successful.
Retrieving pub/X11/contrib/widgets/Xaw3d/R6.1/Xaw3d-1.3.tar.gz
local: Xaw3d-1.3.tar.gz remote: Xaw3d-1.3.tar.gz
227 Entering Passive Mode (192,58,206,2,5,14)
150 Opening BINARY mode data connection for Xaw3d-1.3.tar.gz (0.0.0.0,0) (290277 bytes).
100% |**************************************************|   283 KB    00:00 ETA
226 Transfer complete.
290277 bytes received in 101.09 seconds (2.80 KB/s)
221 Goodbye.
===>  Extracting for Xaw3d-1.3
/bin/mkdir -p /usr/ports/x11/Xaw3d/work/xc/lib/Xaw3d/X11/Xaw3d
cd /usr/ports/x11/Xaw3d/work/xc/lib/Xaw3d/X11/Xaw3d; ln -sf ../../*.h .
===>  Patching for Xaw3d-1.3
===>  Configuring for Xaw3d-1.3
mv -f Makefile Makefile.bak
imake -DUseInstalled -I/usr/X11R6/lib/X11/config
make Makefiles
[snip]

You can see a list of both ports and packages by using the pkg_info
command. 

bsd# /usr/sbin/pkg_info
zsh-3.0.5           The Z shell.
screen-3.7.4        A multi-screen window manager.
ssh-1.2.21          Secure shell client and server (remote login program).
emacs-20.2          GNU editing macros.
lynx-2.7.1ac-0.107  An alphanumeric display oriented World-Wide Web Client.
tcsh-6.07.02        An extended C-shell with many useful features.
bash-2.01           The GNU Borne Again Shell.
zip-2.2             Create/update ZIP files compatabile with pkzip.
mm-2.7              Implementation of MIME, the Multipurpose Internet Mail Exten
ircii-2.8.2-epic3.004 An enhanced version of ircII, the Internet Relay Chat client
ispell-3.1.20       An interactive spelling checker.
tin-1.3.970930      TIN newsreader (termcap based)
procmail-3.11p7     A local mail delivery agent.
strobe-1.03         Fast scatter/gather TCP port scanner
lsof-4.15           Lists information about open files.
xntp3-5.92          Network Time Protocol Implementation.
ncftp-2.4.3        
 nmh-0.27            The New MH mail handling program
bzip2-0.1p12        A block-sorting file compressor

If you are looking for a specific program in the ports tree, you can try 

fenetyllin:/usr/ports/# make search key="xfig"
Port:   xfig-3.2.2
Path:   /home/ports/graphics/xfig
Info:   A drawing program for X11
Maint:  angelos@@openbsd.org
Index:  graphics x11
B-deps: Xaw3d-1.3 jpeg-6b
R-deps: Xaw3d-1.3 ghostscript-5.10 gv-3.5.8 jpeg-6b png-1.0.2 transfig-3.2.1
Archs:  any

Port:   transfig-3.2.1
Path:   /home/ports/print/transfig
Info:   Tools to convert Xfig's .fig files.
Maint:  angelos@@openbsd.org
Index:  print
B-deps: jpeg-6b
R-deps: ghostscript-5.10 jpeg-6b png-1.0.2
Archs:  any
[snip]

More information about the ports can be found in the ports man page 

Our ports tree is constantly being expanded, and if you would like to help
please see: http://www.openbsd.org/ports.html 


8.7 - What are packages?

Packages are the precompiled binaries of some of the most used
programs. They are ready for use on an OpenBSD system. Again, like
the ports, packages are very easy to maintain and update. Packages are
constantly being added so be sure to check each release for additional
packages. 

Here is a list of tools used in managing packages.

     pkg_add (1) - a utility for installing software package distributions 
     pkg_create (1) - a utility for creating software package
     distributions 
     pkg_delete (1) - a utility for deleting previously installed software
     package distributions 
     pkg_info (1) - a utility for displaying information on software
     packages 

Here is a sample user installing ispell via a package: 

bsd# pkg_add
ftp://ftp.openbsd.org/pub/OpenBSD/2.5/packages/${arch}/ispell-3.1.20.tgz

where ${arch} is your architecture 

Again, like with ports you can use the pkg_info(1) program to view what
is already installed on your system. 

To delete packages you will want to use the pkg_delete(1) command. It
is used the same way as pkg_add(1). 

bsd# /usr/sbin/pkg_delete ispell-3.1.20 

and it is gone. 

Packages can be found on any of the OpenBSD ftp mirror sites.
Http://www.OpenBSD.org/ftp.html
or they can be found on your OpenBSD CD's. 

8.8 - Is there any way to use my floppy
drive if it's not attached during boot?

Sure. You need to add "flags 0x20" at the end of the fd* entry and
recompile your kernel. The line should be read: 

fd* at fdc? drive ? flags 0x20 

After that you would be able to use the floppy drive all the time. It doesn't
matter if you plugged it later after boot. 


9.0 - Migrating from Linux 



9.1 - Simple tips for Linux users

There are several differences between OpenBSD and Linux. These
differences include but are not limited to, bootup procedure, network
interface usage and disk management. Most differences are well
documented, but involve searching manpages. This document tries to be
an index of those differences. 

     OpenBSD has a ports tree. This is to accomodate the fact that at
     this point not many applications are native to the OpenBSD
     environment. This is both an attempt to get applications to work on
     OpenBSD for end-users and to get more applications made with
     OpenBSD in mind. Eventually this ports tree will be used to make
     a nice set of binary packages. 
     OpenBSD uses CVS for source changes. Unlike Linux which is
     done primarily thru separate distributions, OpenBSD uses CVS
     which allows anyone to extract the full source tree at ANY given
     time. OpenBSD also does periodically release snapshots for
     various architectures and makes a CD release every 6 months. 
     OpenBSD contains STRONG CRYPTO, which USA based OS's
     can't contain. (See http://www.openbsd.org/crypto.html)
     OpenBSD has also gone thru heavy security auditing and many
     security features have already been implemented into the source
     tree. (IPSEC, KERBEROS). 
     OpenBSD's kernel is /bsd. 
     The names of hard disks are usually /dev/wd and /dev/sd
     (ATA/SCSI) 
     /sbin/ifconfig with no arguments in Linux gives the state of all the
     interfaces. Under OpenBSD you need the -a flag. 
     /sbin/route with no arguments in Linux gives the state of all the
     active routes. Under OpenBSD you need the "show" parameter, or
     do a netstat -r (nice). 
     IP-Masquerading is done through ipnat. (ipnat(1)) 
     ipfwadm is done through ipf (ipf(1), ipf(5)) 
     Interface address is stored in /etc/hostname.<interfacename>. It
     can be a name instead of an IP address. 
     The machine name is in /etc/myname 
     The default gateway is in /etc/mygate 
     The network interface aliases are in /etc/ifaliases 
     OpenBSD's default shell is csh. Shells such as bash and tcsh can
     be added as packages or installed from the ports tree. 
     Password management changes a lot. The main files are different.
     (passwd(1), passwd(5)) 


9.2 - Dual booting Linux and OpenBSD

Yes! it is possible! 

Read INSTALL.linux 

10.0 - System Administration



10.1 - Why does it say that I'm in the
wrong group when I su to root?

To be able to use su(1) to root you must be in group 0, "wheel". This
MUST be placed specifically in /etc/group. It isn't enough to have
them listed in /etc/passwd. Once this is done you should be able to su
correctly. 


10.2 - How do I duplicate a filesystem?

Use dump/restore. For example. To duplicate everything under directory
SRC to directory DST, do a: 

# cd /SRC; dump 0f - . | (cd /DST; restore -rf - )

10.3 - How do I get httpd, sendmail, etc to
startup with the system?

OpenBSD uses rc-style startup to control starting applications with the
system. For common daemons you can simply edit /etc/rc.conf. 
For example: To have ftpd started on boot change - 

ftpd_flags=NO -- > ftpd_flags="-D"

You can add any flags that you wish ftpd to start with. 

If you have your own daemon's that you want to be started, here is a
simple entry that you can put into /etc/rc.local.

if [ -x /usr/local/sbin/mydaemon ]; then
        echo -n ' mydaemon';       /usr/local/sbin/mydaemon
fi


Once in there, it will come up with the system each time. 

10.4 - Why do users get relaying access
denied when they are remotely sending
mail through my OpenBSD system?

Try this: 

cat /etc/sendmail.cf | grep relay-domains

The output may look something like this: 

FR-o /etc/mail/relay-domains

If this file doesn't exist, create it. You will need to enter the users who are
sending mail remotely with the following syntax: 

.domain.com    #if it is dynamic
sub.domain.com #if static

Don't forget to: 

kill -1 `cat /var/run/sendmail.pid`


10.5 - I've set up POP, but users have
trouble accessing mail thru POP. What can
i do?

Most issues dealing with pop are accessing files, mainly temp files. Some
clients give errors such as: 

-ERR Couldn't open temporary file, do you own it?K

Try setting up your permissions as such: 

permission in  /var
drwxrwxr-x   2 bin     mail     512 May 26 20:08 mail


permissions in  /var/mail
-rw-------   1 username   username        0 May 26 20:08 username

Double check that the user owns his file in /var/mail , this should be done
by default. 

10.6 - Setting up a Secure HTTP server
with SSL(8)

This will take you through all the steps it takes to set up your own Secure
HTTP server. Since the OpenBSD 2.5 release, OpenBSD has shipped
with ssleay. Because of copyrighted RSA algorigthms, these cannot be
shipped with OpenBSD. libssl includes support for SSL version 2, SSL
version 3, and TLS version 1. So for now, because of copyright
restictions, OpenBSD must ship without a fully-functional libssl. But it is
still completely useable. If you are able to use the RSA patented library's
you can easily upgrade your libssl with a command like this. 

#pkg_add
ftp://ftp.openbsd.org/pub/OpenBSD/${ver}/packages/${arch}/libssl-1.1.tgz

Where ${ver} is the OpenBSD version number, and ${arch} is your
architecture. 

The steps shown here are taken pretty much from the ssl(8) man page.
So you can refer to that for further information. Also, this faq will only go
over creating a RSA certificate for web servers, not a DSA server
certificate. To find out how to do so, please refer to the ssl(8) man page. 

I will no show how to create your key and certificate. These will go to
/etc/ssl/private/. This means that you will have to have upgraded your
libssl. Now we can create our key. You can do so with a line like such: 

# ssleay genrsa -out /etc/ssl/private/server.key 1024 

This will create a key of 1024 bits. Next you need to create a
Certificate Signing Request which is used to get a CA or Certificate
Authority to sign your key. Here is the command to do so. 

# ssleay req -new -key /etc/ssl/private/server.key -out
/etc/ssl/private/server.csr 

You would now give /etc/ssl/private/server.csr to the CA to get it signed.
Or you could also sign the certificate for yourself. Here is how you would
do this. 

# ssleay x509 -req -days 365 -in /etc/ssl/private/server.csr -signkey
/etc/ssl/private/server.key -out /etc/ssl/server.crt 

This will sign your key, and it will be valid for up to 365 days. With this
done you can now start the httpd server. To start httpd(8) with ssl you
must start the daemon with the -DSSL flag. You can start this on boot in
/etc/rc.conf by changing the httpd line to look like so: 

httpd_flags="-DSSL"

This server will run on port 443. 

10.7 - I edited /etc/passwd with vi(1), but
the changes didn't seem to take place.
Why?

Changes will not be made right away because OpenBSD has a user
database which needs updated when changes are made in /etc/passwd.
Tools are made to do this immediatly for you though. You should use
vipw(8) to edit the passwd file by hand. This will allow for checking of the
passwd file before entering it into the database and after the check is
done it will automatically execute pwd_mkdb(8). If you have made
changes, without using a tool such as vipw, you can run pwd_mkdb(8) by
hand. 

10.8 - What is the best way to add users?
and delete them?

The best way to add a user in OpenBSD is to use the adduser(8) script.
You can configure this to work however you like by editing
/etc/adduser.conf. You can add users by hand, but this is the
recommended way to addusers. adduser(8) allows for consistancy
checks on /etc/passwd, /etc/group, and shell databases. It will create
then entries for you, and HOME directory, and even send a message to
the user welcoming them. This can be changed to meet your needs. For
further instructions on adding users read the adduser_proc(8) man page. 

To delete users you should use the rmuser(8) utility. This will remove all
existance of a user. It will remove any crontab(1) entries, their HOME dir
(if it is owned by the user). Along with their /etc/passwd and /etc/group
entries. 

10.9 - How do i create an ftp-only account?

There are a few ways to do this, but a very common way to do such is to
add /usr/bin/false into /etc/shells. Then when you create the user set his
shell to /usr/bin/false, this they he will not be able to get a shell but will be
able to keep their ftp capabilities. adduser(8) will give them a home dir by
default of /home/foo. If this is what you desire it doesn't need to be
changed, however you can set this to whatever directory you wish. 


11.0 - OpenBSD 2.4 Specific
Information



11.1 - In 2.4 why do I get UserDir error
when running httpd?

It seems as though userdir support was left out of 2.4. Make sure to pick
up the patch at: 

http://www.openbsd.org/errata.html 

11.2 - Installing at a partition 4GB or
higher

The 2.4 cd's shipped with a problem in installboot. A patch can be
obtained here http://www.openbsd.org/errata.html. This is fixed in
-current. 

To place the partition boot record, installboot used a 32 bit multiplication
for the sectors times the sectorsize which is larger than 2^32 -1 (i.e.
multiplication overflow) when the partition starts at 4 GB or higher. This
means the pbr is installed in the reall partition address modulo 4GB. It's
still possible to install at >= 4GB with some effort: 

You have 2 Options for doing so with OpenBSD 2.4. If you have Linux
or any other unix like OS, you should back up the sectors first before
trying anything. 

     Suppose the partition starts at cylinder 611, and the drive has 255
     heads, 63 sectors: offset for the obsd partition is 611*255*63=
     9815715 sectors. multiply this by 512 and you get: 5025646080.
     5025646080 mod 2^32 = 730678784 

     (You can just subtract 2^32 on a hand calculator...) dividing by
     512 gives sector 1427107. 

     Ok, suppose were now in linux (where cylinder numbers are 1
     higher btw..) and that the obsd partition is DOS partition 4: 

     dd if=/dev/hda of=backup.txt skip=1427107 bs=512 count=1 

     will backup the data that installboot will nuke .. 

     Now install OpenBSD. Return to Linux. 

     Now we're going to copy the partition boot record to the right
     place. 

     dd if=/dev/hda of=pbr.txt skip=1427107 bs=512 count=1 
     dd if=/pbr.txt of=/dev/hda4 bs=512 count=1 

     (adding obsd to lilo should now work) 

     Now write back the nuked sector: 

     dd if=/backup.txt of=/dev/hda seek=1427107 bs=512
     count=1 

     Caveat: make sure that whatever gets nuked by installboot isn't
     essential to running dd (and starting the other OS). Backing up the
     affected partition is recommended. 

     Use a correct version of installboot (compiled for you by another
     OBSD'er ..): 

     put it on another partition, e.g. a DOS partition. Suppose wd0j is
     the DOS partition (see disklabel wd0, this is in case of IDE disks),
     and installboot is named installb there. 

     After booting from floppy/CD, press ^C to get into the shell: 
          mkdir dos
          mount /dev/wd0j dos
          cp dos/tmp/installb /usr/mdec/installboot

Now enter 'install' and the installation procedure should use the new
installboot. 

12.0 - Performance Tuning



12.1 - Networking

If you run a busy gateway or firewall, you should make sure you prevent
memory starvation. 

Add these to your kernel config and compile a custom kernel: 

     option "NMBCLUSTERS=8192" 
     option "MAX_KMAP=120" 
     option "MAX_KMAPENT=6000" 
     option "NKMEMCLUSTERS=8192" 

12.2 - Disk I/O

Disk I/O is, on any system, a main factor in the overall speed of the
computer. And is also a part of any system that needs protected the most.
OpenBSD has a couple of options you can choose from when it comes to
disk fault tolerence. 

The first option is the use of ccd(4). CCD(4) is what is called a
Concatenated Disk Driver. This basically allows you to combine one or
more disks into what is called a "virtual disk" As in, the system see's it as
one disk, and uses it as such. This concept is similar to that of LVM,
which is found in many commercial flavors. To start setup of CCD, you
need to add support for it in your kernel. A line such as: 

pseudo-device   ccd     4       # concatenated disk devices

would allow for 4 CCD devices. Which happens to be the MAX number
of CCD devices allowed. 

NOTE: Support is in the GENERIC Kernel. 

One of the many things you can do through the use of CCD is provide for
"striping", which can definately give a performance boost. 

Another solution is raid(4) which will have you use raidctl(8). to control
your raid devices. Through the use of RAIDframe devices you can
achieve both striping and mirroring. OpenBSD has support for RAID
levels of 0, 1, 4, and 5. With raid, as with CCD, support must be in the
KERNEL. 

pseudo-device   raid   4       # RAIDframe disk device

As with the CCD kernel support, Support is in the GENERIC kernel. 

For fileservers with enough memory, you can increase
BUFCACHEPERCENT. To do this you should add a line to your kernel
configuration like this: 

option BUFCACHEPERCENT=50 

Or whatever number you want it set too. 

Another tool that can be used to speed up your is softupdates. You can
read more about these at http://www.OpenBSD.org/softupdates.html or
you can read the softupdates FAQ entry. 




$OpenBSD: obsd-faq.txt,v 1.1 1999/05/30 23:34:39 ericj Exp $
@


1.1
log
@text version of the faq
@
text
@d1305 1
a1305 1
machine namme belongs to the domain yourdomain.com. Add the
d2239 1
a2239 1
$OpenBSD$
@

