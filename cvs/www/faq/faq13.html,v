head	1.199;
access;
symbols;
locks; strict;
comment	@# @;


1.199
date	2017.03.11.02.57.05;	author tj;	state Exp;
branches;
next	1.198;
commitid	tDES2Wi1Pb3Q7uCn;

1.198
date	2017.02.09.17.22.19;	author tb;	state Exp;
branches;
next	1.197;
commitid	T7p2qUf6sgevbhcO;

1.197
date	2017.01.08.04.13.42;	author tb;	state Exp;
branches;
next	1.196;
commitid	b6RiElQFka2by5Tf;

1.196
date	2016.10.25.15.13.48;	author tj;	state Exp;
branches;
next	1.195;
commitid	YZEan5zbLki8TjlP;

1.195
date	2016.09.22.14.48.23;	author tj;	state Exp;
branches;
next	1.194;
commitid	2y9bWL7Ks8Cb08Uf;

1.194
date	2016.08.16.19.29.26;	author tj;	state Exp;
branches;
next	1.193;
commitid	Kszu0QtvnlErGThd;

1.193
date	2016.08.15.02.22.13;	author tb;	state Exp;
branches;
next	1.192;
commitid	3DeixV5YkPOb78RN;

1.192
date	2016.06.17.10.51.14;	author tb;	state Exp;
branches;
next	1.191;
commitid	h8SpZqBO89PMlpg2;

1.191
date	2016.06.17.00.25.33;	author tj;	state Exp;
branches;
next	1.190;
commitid	C6OT4QARoaY1nAFC;

1.190
date	2016.06.16.17.56.23;	author tj;	state Exp;
branches;
next	1.189;
commitid	2dqfGsSCyF1AYolM;

1.189
date	2016.06.16.17.37.17;	author tj;	state Exp;
branches;
next	1.188;
commitid	wvAiHlkWYSF3VfXw;

1.188
date	2016.06.14.16.26.11;	author tj;	state Exp;
branches;
next	1.187;
commitid	PCHwYJ8G2TIOYpMG;

1.187
date	2016.06.13.22.32.38;	author tj;	state Exp;
branches;
next	1.186;
commitid	3Eya6bNOlnfrrChW;

1.186
date	2016.06.13.21.46.19;	author tj;	state Exp;
branches;
next	1.185;
commitid	jc7Wx5HXT6m8mTcn;

1.185
date	2016.04.21.00.45.48;	author tj;	state Exp;
branches;
next	1.184;
commitid	HtZ8nUjqaAunZXL2;

1.184
date	2016.04.16.00.30.41;	author tj;	state Exp;
branches;
next	1.183;
commitid	rTxoenHHaeutOff1;

1.183
date	2016.04.15.22.19.21;	author tj;	state Exp;
branches;
next	1.182;
commitid	SbVa2HBPaB5JhGVM;

1.182
date	2016.04.15.20.39.49;	author tb;	state Exp;
branches;
next	1.181;
commitid	jwteSMEb4rFzI8UA;

1.181
date	2016.04.15.16.42.34;	author tj;	state Exp;
branches;
next	1.180;
commitid	4iGhbtsBAhiGE70P;

1.180
date	2016.04.15.09.11.58;	author ratchov;	state Exp;
branches;
next	1.179;
commitid	UqLs0Yro8pTkpDW5;

1.179
date	2016.04.13.16.38.17;	author tj;	state Exp;
branches;
next	1.178;
commitid	fgcHfYqalkPGcLdc;

1.178
date	2016.03.29.01.27.39;	author tb;	state Exp;
branches;
next	1.177;
commitid	4Y8oU6GBrSY1UOfW;

1.177
date	2016.03.27.19.52.09;	author sthen;	state Exp;
branches;
next	1.176;
commitid	hi2ObFv9LGB98JY5;

1.176
date	2016.03.22.10.54.47;	author sthen;	state Exp;
branches;
next	1.175;
commitid	cyODCFvIgxpUoVc0;

1.175
date	2016.03.21.08.24.24;	author tb;	state Exp;
branches;
next	1.174;
commitid	FszPYViUktw26pO0;

1.174
date	2016.03.21.05.46.21;	author beck;	state Exp;
branches;
next	1.173;
commitid	zEx6zFkNSFFExu0v;

1.173
date	2016.03.20.22.24.57;	author tj;	state Exp;
branches;
next	1.172;
commitid	oo3sAEjx5cFwFwEI;

1.172
date	2016.02.27.08.25.06;	author ratchov;	state Exp;
branches;
next	1.171;
commitid	UNppwdDtqsXw3QsU;

1.171
date	2016.02.27.08.23.31;	author ratchov;	state Exp;
branches;
next	1.170;
commitid	knLinKHEaoDzj5HO;

1.170
date	2016.02.27.08.22.24;	author ratchov;	state Exp;
branches;
next	1.169;
commitid	WSxKDKplBEf6eEer;

1.169
date	2016.02.27.08.19.13;	author ratchov;	state Exp;
branches;
next	1.168;
commitid	6wLCXq0Z1GlpDTmc;

1.168
date	2016.02.27.08.15.12;	author ratchov;	state Exp;
branches;
next	1.167;
commitid	QuSbCQs0aADvsPP6;

1.167
date	2016.02.27.08.04.25;	author ratchov;	state Exp;
branches;
next	1.166;
commitid	XlHwzbRRL8cjl0FZ;

1.166
date	2016.02.21.23.00.03;	author tj;	state Exp;
branches;
next	1.165;
commitid	qziXKpCDvdBiUiz2;

1.165
date	2016.02.21.00.09.36;	author tj;	state Exp;
branches;
next	1.164;
commitid	hS1D9hk71V5AyPoY;

1.164
date	2016.02.20.22.59.20;	author tj;	state Exp;
branches;
next	1.163;
commitid	8IPwAs1etKEHjS9q;

1.163
date	2016.02.06.17.08.16;	author tj;	state Exp;
branches;
next	1.162;
commitid	PRx5cyhy98Rcqrpv;

1.162
date	2016.01.26.20.58.30;	author tj;	state Exp;
branches;
next	1.161;
commitid	elNG1gXRQ2O8fy29;

1.161
date	2016.01.08.13.06.28;	author schwarze;	state Exp;
branches;
next	1.160;
commitid	BEzBLERgdROmlObX;

1.160
date	2015.12.23.23.12.11;	author mmcc;	state Exp;
branches;
next	1.159;
commitid	BrGfAEDDfoXcUJhc;

1.159
date	2015.12.23.21.39.44;	author mmcc;	state Exp;
branches;
next	1.158;
commitid	rLnEE8xwWbOSPhFr;

1.158
date	2015.11.25.17.36.15;	author sthen;	state Exp;
branches;
next	1.157;
commitid	wKin7F4EiE7tWtFb;

1.157
date	2015.10.18.19.42.11;	author nick;	state Exp;
branches;
next	1.156;
commitid	HJnmhJAcdZq1TNFu;

1.156
date	2015.09.24.06.41.09;	author schwarze;	state Exp;
branches;
next	1.155;
commitid	Fxxkh06lh1JVWjuy;

1.155
date	2015.07.02.05.49.04;	author bentley;	state Exp;
branches;
next	1.154;
commitid	AP3UllesavMDEUhQ;

1.154
date	2015.05.11.11.18.30;	author sthen;	state Exp;
branches;
next	1.153;
commitid	wRrXxcro6dFYiwF8;

1.153
date	2015.02.24.09.26.04;	author ratchov;	state Exp;
branches;
next	1.152;
commitid	vzUUAnV6wUUfbCp2;

1.152
date	2014.12.01.09.49.46;	author bentley;	state Exp;
branches;
next	1.151;
commitid	VffT7s4nM0NK88NG;

1.151
date	2014.05.20.11.09.13;	author nick;	state Exp;
branches;
next	1.150;

1.150
date	2014.05.05.08.12.07;	author landry;	state Exp;
branches;
next	1.149;

1.149
date	2014.05.01.15.01.14;	author nick;	state Exp;
branches;
next	1.148;

1.148
date	2014.03.30.19.13.39;	author nick;	state Exp;
branches;
next	1.147;

1.147
date	2013.05.01.15.17.36;	author bcallah;	state Exp;
branches;
next	1.146;

1.146
date	2013.02.18.16.23.55;	author nick;	state Exp;
branches;
next	1.145;

1.145
date	2013.02.17.04.04.46;	author nick;	state Exp;
branches;
next	1.144;

1.144
date	2012.11.01.15.05.30;	author nick;	state Exp;
branches;
next	1.143;

1.143
date	2012.05.14.06.04.45;	author brett;	state Exp;
branches;
next	1.142;

1.142
date	2012.05.01.14.39.46;	author nick;	state Exp;
branches;
next	1.141;

1.141
date	2011.11.09.03.10.21;	author nick;	state Exp;
branches;
next	1.140;

1.140
date	2011.11.01.10.52.27;	author nick;	state Exp;
branches;
next	1.139;

1.139
date	2011.07.12.10.28.22;	author sthen;	state Exp;
branches;
next	1.138;

1.138
date	2011.05.30.13.33.29;	author lum;	state Exp;
branches;
next	1.137;

1.137
date	2010.11.06.20.11.30;	author ratchov;	state Exp;
branches;
next	1.136;

1.136
date	2010.07.04.17.07.56;	author nick;	state Exp;
branches;
next	1.135;

1.135
date	2010.01.16.23.47.46;	author ratchov;	state Exp;
branches;
next	1.134;

1.134
date	2009.11.30.12.50.27;	author nick;	state Exp;
branches;
next	1.133;

1.133
date	2009.10.22.13.41.51;	author jmc;	state Exp;
branches;
next	1.132;

1.132
date	2009.10.22.06.12.01;	author ratchov;	state Exp;
branches;
next	1.131;

1.131
date	2009.10.21.16.47.43;	author ratchov;	state Exp;
branches;
next	1.130;

1.130
date	2009.10.13.10.05.24;	author steven;	state Exp;
branches;
next	1.129;

1.129
date	2009.09.19.21.28.41;	author jakemsr;	state Exp;
branches;
next	1.128;

1.128
date	2009.09.09.02.02.54;	author nick;	state Exp;
branches;
next	1.127;

1.127
date	2009.04.07.00.41.14;	author nick;	state Exp;
branches;
next	1.126;

1.126
date	2009.01.25.18.09.49;	author jasper;	state Exp;
branches;
next	1.125;

1.125
date	2008.11.12.02.59.41;	author nick;	state Exp;
branches;
next	1.124;

1.124
date	2008.11.03.23.18.05;	author jakemsr;	state Exp;
branches;
next	1.123;

1.123
date	2008.10.27.21.53.58;	author ratchov;	state Exp;
branches;
next	1.122;

1.122
date	2008.05.01.16.58.15;	author steven;	state Exp;
branches;
next	1.121;

1.121
date	2008.05.01.16.12.13;	author steven;	state Exp;
branches;
next	1.120;

1.120
date	2008.04.30.22.36.24;	author steven;	state Exp;
branches;
next	1.119;

1.119
date	2007.12.01.14.29.56;	author steven;	state Exp;
branches;
next	1.118;

1.118
date	2007.11.29.01.48.23;	author nick;	state Exp;
branches;
next	1.117;

1.117
date	2007.11.05.08.20.15;	author jmc;	state Exp;
branches;
next	1.116;

1.116
date	2007.09.21.06.11.18;	author steven;	state Exp;
branches;
next	1.115;

1.115
date	2007.07.09.17.42.06;	author aanriot;	state Exp;
branches;
next	1.114;

1.114
date	2007.07.05.07.13.32;	author steven;	state Exp;
branches;
next	1.113;

1.113
date	2007.06.20.18.14.14;	author miod;	state Exp;
branches;
next	1.112;

1.112
date	2007.05.04.05.29.56;	author steven;	state Exp;
branches;
next	1.111;

1.111
date	2007.05.01.18.24.10;	author steven;	state Exp;
branches;
next	1.110;

1.110
date	2006.11.01.05.06.03;	author steven;	state Exp;
branches;
next	1.109;

1.109
date	2006.09.22.07.06.04;	author steven;	state Exp;
branches;
next	1.108;

1.108
date	2006.09.21.21.25.14;	author steven;	state Exp;
branches;
next	1.107;

1.107
date	2006.08.19.17.21.25;	author steven;	state Exp;
branches;
next	1.106;

1.106
date	2006.05.01.06.14.46;	author steven;	state Exp;
branches;
next	1.105;

1.105
date	2006.03.09.03.17.45;	author nick;	state Exp;
branches;
next	1.104;

1.104
date	2006.01.31.13.30.03;	author bernd;	state Exp;
branches;
next	1.103;

1.103
date	2006.01.06.23.53.56;	author steven;	state Exp;
branches;
next	1.102;

1.102
date	2005.12.13.17.19.57;	author steven;	state Exp;
branches;
next	1.101;

1.101
date	2005.12.11.22.50.40;	author steven;	state Exp;
branches;
next	1.100;

1.100
date	2005.11.25.20.23.06;	author steven;	state Exp;
branches;
next	1.99;

1.99
date	2005.11.01.11.39.56;	author nick;	state Exp;
branches;
next	1.98;

1.98
date	2005.10.28.01.36.38;	author nick;	state Exp;
branches;
next	1.97;

1.97
date	2005.10.19.21.47.14;	author nick;	state Exp;
branches;
next	1.96;

1.96
date	2005.10.19.10.24.31;	author nick;	state Exp;
branches;
next	1.95;

1.95
date	2005.10.19.10.12.53;	author nick;	state Exp;
branches;
next	1.94;

1.94
date	2005.10.19.00.41.20;	author nick;	state Exp;
branches;
next	1.93;

1.93
date	2005.10.10.02.45.22;	author nick;	state Exp;
branches;
next	1.92;

1.92
date	2005.08.14.03.36.15;	author nick;	state Exp;
branches;
next	1.91;

1.91
date	2005.08.09.08.23.07;	author jmc;	state Exp;
branches;
next	1.90;

1.90
date	2005.07.09.01.49.25;	author nick;	state Exp;
branches;
next	1.89;

1.89
date	2005.06.27.01.54.12;	author nick;	state Exp;
branches;
next	1.88;

1.88
date	2005.06.27.01.40.57;	author nick;	state Exp;
branches;
next	1.87;

1.87
date	2005.05.02.10.41.15;	author nick;	state Exp;
branches;
next	1.86;

1.86
date	2005.05.01.17.26.02;	author nick;	state Exp;
branches;
next	1.85;

1.85
date	2005.05.01.14.01.06;	author nick;	state Exp;
branches;
next	1.84;

1.84
date	2005.04.27.00.26.02;	author nick;	state Exp;
branches;
next	1.83;

1.83
date	2005.04.24.16.14.44;	author nick;	state Exp;
branches;
next	1.82;

1.82
date	2004.10.20.23.04.26;	author nick;	state Exp;
branches;
next	1.81;

1.81
date	2004.01.01.04.13.34;	author nick;	state Exp;
branches;
next	1.80;

1.80
date	2003.07.25.19.55.38;	author nick;	state Exp;
branches;
next	1.79;

1.79
date	2003.07.23.02.01.56;	author nick;	state Exp;
branches;
next	1.78;

1.78
date	2003.06.28.23.01.32;	author jolan;	state Exp;
branches;
next	1.77;

1.77
date	2003.06.22.18.54.12;	author david;	state Exp;
branches;
next	1.76;

1.76
date	2003.06.15.01.56.38;	author nick;	state Exp;
branches;
next	1.75;

1.75
date	2003.05.02.15.41.59;	author nick;	state Exp;
branches;
next	1.74;

1.74
date	2003.04.03.15.12.53;	author nick;	state Exp;
branches;
next	1.73;

1.73
date	2003.03.29.20.22.58;	author nick;	state Exp;
branches;
next	1.72;

1.72
date	2003.03.22.22.02.20;	author nick;	state Exp;
branches;
next	1.71;

1.71
date	2003.03.18.03.41.04;	author nick;	state Exp;
branches;
next	1.70;

1.70
date	2003.02.28.00.34.28;	author nick;	state Exp;
branches;
next	1.69;

1.69
date	2003.02.25.04.00.10;	author david;	state Exp;
branches;
next	1.68;

1.68
date	2003.02.24.00.44.43;	author kjell;	state Exp;
branches;
next	1.67;

1.67
date	2003.02.22.19.22.38;	author kjell;	state Exp;
branches;
next	1.66;

1.66
date	2003.02.22.19.14.06;	author kjell;	state Exp;
branches;
next	1.65;

1.65
date	2003.02.20.03.09.56;	author nick;	state Exp;
branches;
next	1.64;

1.64
date	2003.02.18.02.53.38;	author nick;	state Exp;
branches;
next	1.63;

1.63
date	2003.01.12.22.48.23;	author kjell;	state Exp;
branches;
next	1.62;

1.62
date	2003.01.01.13.01.59;	author nick;	state Exp;
branches;
next	1.61;

1.61
date	2002.11.26.01.02.04;	author nick;	state Exp;
branches;
next	1.60;

1.60
date	2002.11.03.00.21.54;	author mcbride;	state Exp;
branches;
next	1.59;

1.59
date	2002.09.26.18.20.28;	author nick;	state Exp;
branches;
next	1.58;

1.58
date	2002.07.12.02.51.35;	author nick;	state Exp;
branches;
next	1.57;

1.57
date	2002.07.07.21.58.21;	author nick;	state Exp;
branches;
next	1.56;

1.56
date	2002.07.02.01.17.58;	author nick;	state Exp;
branches;
next	1.55;

1.55
date	2002.07.01.22.28.27;	author nick;	state Exp;
branches;
next	1.54;

1.54
date	2002.06.20.06.17.32;	author chris;	state Exp;
branches;
next	1.53;

1.53
date	2002.05.29.19.24.44;	author nick;	state Exp;
branches;
next	1.52;

1.52
date	2002.05.03.13.24.33;	author jsyn;	state Exp;
branches;
next	1.51;

1.51
date	2002.02.20.03.13.15;	author nick;	state Exp;
branches;
next	1.50;

1.50
date	2002.01.27.22.44.34;	author nick;	state Exp;
branches;
next	1.49;

1.49
date	2002.01.21.20.28.25;	author nick;	state Exp;
branches;
next	1.48;

1.48
date	2002.01.13.00.00.32;	author ericj;	state Exp;
branches;
next	1.47;

1.47
date	2002.01.12.01.39.29;	author ericj;	state Exp;
branches;
next	1.46;

1.46
date	2001.12.23.03.09.52;	author miod;	state Exp;
branches;
next	1.45;

1.45
date	2001.10.04.09.59.02;	author wilfried;	state Exp;
branches;
next	1.44;

1.44
date	2001.09.10.19.26.32;	author jufi;	state Exp;
branches;
next	1.43;

1.43
date	2001.08.25.09.31.33;	author jufi;	state Exp;
branches;
next	1.42;

1.42
date	2001.08.15.17.39.10;	author jufi;	state Exp;
branches;
next	1.41;

1.41
date	2001.08.08.21.06.32;	author jsyn;	state Exp;
branches;
next	1.40;

1.40
date	2001.03.26.17.14.09;	author todd;	state Exp;
branches;
next	1.39;

1.39
date	2001.02.25.07.15.09;	author ericj;	state Exp;
branches;
next	1.38;

1.38
date	2001.01.27.22.19.47;	author ericj;	state Exp;
branches;
next	1.37;

1.37
date	2000.12.26.16.17.40;	author ericj;	state Exp;
branches;
next	1.36;

1.36
date	2000.10.11.18.04.04;	author mickey;	state Exp;
branches;
next	1.35;

1.35
date	2000.07.25.00.07.53;	author chris;	state Exp;
branches;
next	1.34;

1.34
date	2000.05.26.07.10.32;	author chris;	state Exp;
branches;
next	1.33;

1.33
date	2000.05.26.06.18.02;	author chris;	state Exp;
branches;
next	1.32;

1.32
date	2000.04.26.22.37.08;	author chris;	state Exp;
branches;
next	1.31;

1.31
date	2000.04.23.22.17.36;	author chris;	state Exp;
branches;
next	1.30;

1.30
date	2000.04.20.21.48.31;	author chris;	state Exp;
branches;
next	1.29;

1.29
date	2000.04.14.02.14.59;	author wvdputte;	state Exp;
branches;
next	1.28;

1.28
date	2000.04.13.00.46.27;	author chris;	state Exp;
branches;
next	1.27;

1.27
date	2000.03.24.14.05.02;	author wvdputte;	state Exp;
branches;
next	1.26;

1.26
date	2000.03.10.01.36.36;	author wvdputte;	state Exp;
branches;
next	1.25;

1.25
date	2000.03.09.02.10.02;	author chris;	state Exp;
branches;
next	1.24;

1.24
date	2000.03.04.01.37.00;	author ericj;	state Exp;
branches;
next	1.23;

1.23
date	2000.02.08.19.04.28;	author chris;	state Exp;
branches;
next	1.22;

1.22
date	2000.01.06.17.50.12;	author chris;	state Exp;
branches;
next	1.21;

1.21
date	99.12.15.18.30.38;	author chris;	state Exp;
branches;
next	1.20;

1.20
date	99.12.06.21.45.58;	author chris;	state Exp;
branches;
next	1.19;

1.19
date	99.12.06.21.42.08;	author chris;	state Exp;
branches;
next	1.18;

1.18
date	99.10.29.04.13.22;	author chris;	state Exp;
branches;
next	1.17;

1.17
date	99.10.29.03.27.53;	author chris;	state Exp;
branches;
next	1.16;

1.16
date	99.10.27.19.13.40;	author ericj;	state Exp;
branches;
next	1.15;

1.15
date	99.10.19.22.09.39;	author chris;	state Exp;
branches;
next	1.14;

1.14
date	99.10.19.17.09.38;	author chris;	state Exp;
branches;
next	1.13;

1.13
date	99.10.19.15.26.50;	author chris;	state Exp;
branches;
next	1.12;

1.12
date	99.10.19.02.24.11;	author chris;	state Exp;
branches;
next	1.11;

1.11
date	99.10.19.01.36.55;	author chris;	state Exp;
branches;
next	1.10;

1.10
date	99.10.18.22.51.49;	author chris;	state Exp;
branches;
next	1.9;

1.9
date	99.10.18.22.08.33;	author chris;	state Exp;
branches;
next	1.8;

1.8
date	99.10.18.19.51.26;	author ericj;	state Exp;
branches;
next	1.7;

1.7
date	99.10.18.18.08.31;	author chris;	state Exp;
branches;
next	1.6;

1.6
date	99.10.18.17.25.34;	author chris;	state Exp;
branches;
next	1.5;

1.5
date	99.09.24.01.46.14;	author ericj;	state Exp;
branches;
next	1.4;

1.4
date	99.09.15.05.16.23;	author ericj;	state Exp;
branches;
next	1.3;

1.3
date	99.09.15.04.24.43;	author ericj;	state Exp;
branches;
next	1.2;

1.2
date	99.08.31.15.07.20;	author chris;	state Exp;
branches;
next	1.1;

1.1
date	99.07.30.19.48.19;	author ericj;	state Exp;
branches;
next	;


desc
@@


1.199
log
@merge "problems with signatures" text into the main signify section.
remove some ugly formatting in section titles.

ok tb
@
text
@<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>

<!-- If you make edits to any FAQ documents, please start each sentence
     on a new line, and try to keep the general formatting consistent
     with the rest of the pages -->

<title>OpenBSD FAQ: Multimedia</title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<meta name="copyright" content="This document copyright 2008-2017 by OpenBSD.">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" type="text/css" href="../openbsd.css">
<link rel="canonical" href="https://www.openbsd.org/faq/faq13.html">
</head>

<!--
Copyright (c) 2005-2007 Steven Mestdagh <steven@@openbsd.org>

Permission to use, copy, modify, and distribute this documentation for
any purpose with or without fee is hereby granted, provided that the
above copyright notice and this permission notice appear in all copies.

THE DOCUMENTATION IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL
WARRANTIES WITH REGARD TO THIS DOCUMENTATION INCLUDING ALL IMPLIED
WARRANTIES OF MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE
AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL
DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR
PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER
TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS DOCUMENTATION
-->

<body bgcolor= "#ffffff" text= "#000000">

<h2>
<a href="../index.html">
<font color="#0000ff"><i>Open</i></font><font color="#000084">BSD</font></a>
<font color="#e00000">FAQ - Multimedia</font>
<small>
<a href="index.html" style="font-weight:normal; float:right">[FAQ Index]</a>
</small>
</h2>
<hr>

<ul>
  <li><a href="#confaudio"  >Configuring audio devices</a>
  <li><a href="#playaudio"  >Playing different kinds of audio</a>
  <li><a href="#playCD"     >Playing audio CDs</a>
  <li><a href="#recordaudio">Recording audio samples</a>
  <li><a href="#recordmon"  >Recording a monitor mix of all audio playback</a>
  <li><a href="#audioserver">OpenBSD's audio server (sndiod)</a>
  <li><a href="#audioprob"  >Debugging audio problems</a>
  <li><a href="#midi"       >Using MIDI instruments</a>
  <li><a href="#playDVD"    >Playing DVDs</a>
  <li><a href="#burnCD"     >Burning CDs and DVDs</a>
<ul>
  <li><a href="#burnIntro"  >Introduction and basic setup</a>
  <li><a href="#writeCD"    >Writing CDs</a>
  <li><a href="#writeDVD"   >Writing DVDs</a>
</ul>
  <li><a href="#plugins"    >Browser plugins (Java and Flash)</a>
</ul>
<hr>

<h2 id="confaudio">Configuring audio devices</h2>

All supported audio drivers are already included in the GENERIC kernel, so
there is no need for extra configuration or installation of drivers.
Running <a href="http://man.openbsd.org/mixerctl">mixerctl(1)</a> with no
arguments will list the device's mixer controls and current settings.

<blockquote><pre>
$ <b>mixerctl</b>
</pre></blockquote>

Some devices have only a handful of controls, some have a hundred or more.
Note that not every option of every audio chip necessarily reaches the
outside world.
There may be, for example, more outputs listed than are physically available
on a sound card or motherboard.

<p>
There are a few controls that are common to many devices:

<ul>
  <li><tt>outputs.master</tt> controls the playback output level
  <li><tt>record.source</tt> controls what inputs are mixed into the
      ADC (analog to digital converter), used when recording
  <li><tt>record.volume</tt> controls the input level of the ADC
</ul>

The controls of an audio device may be labeled differently.
Usually the controls have a meaningful label, but sometimes one must simply
try different settings to see what effect each control has.

<p>
Some devices use what is known as EAPD, which stands for external amplifier
power down.
However, this is just another on/off switch.
It is probably referred to as "power down" because it is often used for
power saving, which means this type of control is more often found in laptops.
Sometimes it is necessary to set controls with <tt>eapd</tt> or
<tt>extamp</tt> in their name to <tt>on</tt> to get an output signal.

<p>
As a basic example of common <tt>mixerctl</tt> usage, to set the volume
of the left and right channels to 200, you would issue

<blockquote><pre>
$ <b>mixerctl outputs.master=200,200</b>
outputs.master: 255,255 -> 207,207
</pre></blockquote>

Notice how the value becomes 207.
The reason for this is that this audio device uses
only 5 bits for volume control, leading to only 32 possible values.
Other hardware could have different resolution.

<p>
To unmute the master channel, you would do:

<blockquote><pre>
$ <b>mixerctl outputs.master.mute=off</b>
outputs.master.mute: on -> off
</pre></blockquote>

To make the changes take effect on each reboot, edit
<tt>/etc/mixerctl.conf</tt>.
For example:

<blockquote><pre>
$ <b>cat /etc/mixerctl.conf</b>
outputs.master=200,200
outputs.master.mute=off
outputs.headphones=160,160
outputs.headphones.mute=off
</pre></blockquote>

To change the default audio output device, for example to use an external
DAC rather than your motherboard's onboard audio, just change
<a href="http://man.openbsd.org/sndiod">sndiod(8)</a>'s startup flags to
use that device:

<blockquote><pre>
# <b>rcctl set sndiod flags -f rsnd/1</b>
# <b>rcctl restart sndiod</b>
</pre></blockquote>

This would make the second audio device (<tt>rsnd/1</tt>) the default.

<h2 id="playaudio">Playing different kinds of audio</h2>

OpenBSD comes with <a href="http://man.openbsd.org/aucat">aucat(1)</a>,
a program for recording and playing WAV, AIFF and AU files.
The following example will play a WAV file.

<blockquote><pre>
$ <b>aucat -i filename.wav</b>
</pre></blockquote>

Other audio formats are handled by audio ports.

<h2 id="playCD">Playing audio CDs</h2>

It is possible to play audio CDs by either having the CD drive play
the disc and send analog audio to the sound card, or by reading the
audio data and sending the digital samples to the sound card over
the PCI bus.

<p>
To play an audio CD using the analog output of your CD-ROM drive, you can

<ul>
  <li>Use the headphones output, usually at the front side of the drive.
  <li>Connect the audio output at the back side of the drive to your audio card.
</ul>

Use the <a href="http://man.openbsd.org/cdio">cdio(1)</a> utility to play a CD:

<blockquote><pre>
$ <b>cdio play</b>
</pre></blockquote>

This will play from the first CD-ROM drive, <tt>cd0</tt>, by default.
Note that the user running cdio should have permissions to read the CD-ROM
device (e.g. <tt>/dev/rcd0c</tt>).
As this device is only readable by root or the operator group by default,
you may want to add the user to the <tt>operator</tt> group for convenience
by adjusting this group's line in <tt>/etc/group</tt>.
Alternatively, you can modify the file permissions of the device as needed.

<p>
Note that you may need to unmute the CD input of the mixer.
Just like the outputs, the actual name of this input may vary between
systems, but you will be using a command like:

<blockquote><pre>
$ <b>mixerctl inputs.cd.mute=off</b>
</pre></blockquote>

It is also possible that there is no analog audio connection between
your CD drive and audio device.
In this case, you could use <tt>cdio</tt>'s <tt>cdplay</tt> command
to send the CD audio data to the sound card through the PCI bus.

<blockquote><pre>
$ <b>cdio cdplay</b>
</pre></blockquote>

Many GUI CD players are in the <tt>audio</tt> section of packages and ports.

<h2 id="recordaudio">Recording audio samples</h2>

<a href="http://man.openbsd.org/aucat">aucat(1)</a> comes with OpenBSD and
can be used for recording.

<blockquote><pre>
$ <b>aucat -o file.wav</b>
</pre></blockquote>

The above command will start the recording of a file in WAV format.
Press [CTRL]-C to finish the recording.
The file will contain signed 16-bit stereo samples at 48kHz.
Other sample formats, sample rates and number of channels can be also be
recorded.
See the manual for details.

<p>
To use aucat to play the file back, run:

<blockquote><pre>
$ <b>aucat -i file.wav</b>
</pre></blockquote>

If recording seemed to work, but playback of the recording was silent or
not what was expected, the mixer probably needs some configuration.
Make sure that you select the right device to record from and that the
source is unmuted.
You can set the necessary parameters using
<a href="http://man.openbsd.org/mixerctl">mixerctl(1)</a>.
For example:

<blockquote><pre>
inputs.mic.mute=off
inputs.mic.preamp=on
inputs.mic.source=mic0
record.source=mic
record.volume=255,255
record.volume.mute=off
record.mic=255
record.mic.mute=off
</pre></blockquote>

These are settings for recording from a microphone.
Pre-amplifying has been enabled, otherwise the recorded sound can be pretty
silent on some systems.
However, pre-amplifying can also be quite loud on other systems.

<h2 id="recordmon">Recording a monitor mix of all audio playback</h2>

A monitoring stream records combined audio output from all playback devices,
allowing you to duplicate or save anything going through the audio subsystem.
This feature can be useful for screencasts or any kind of live audio mixing.

<p>
Create the monitor sub-device <tt>mon</tt> for
<a href="http://man.openbsd.org/sndiod">sndiod(8)</a> by using:

<blockquote><pre>
# <b>rcctl set sndiod flags -s default -m play,mon -s mon</b>
# <b>rcctl restart sndiod</b>
</pre></blockquote>

Configure your program to record audio from the <tt>snd/0.mon</tt> device:

<blockquote><pre>
$ <b>aucat -f snd/0.mon -o file.wav</b>
</pre></blockquote>

At this point, whatever your system plays is recorded in <tt>file.wav</tt>.

<h2 id="audioserver">OpenBSD's audio server (sndiod)</h2>

<!-- This section Copyright (c) 2009 Alexandre Ratchov -->

<h3>What latency do I need?</h3>

The latency is the time between when a program takes the decision to play
a sample and when the user hears the sample.
Since audio data is always buffered, this delay is proportional to
the audio buffer size.
The following values are recommended:

<ul>
  <li>Real-time synthesizers: 5ms.
      This is the time it takes between hitting a key on your MIDI keyboard
      and actually hearing the note.
      Roughly, 5ms corresponds to the time it takes for the sound to
      propagate 1.75m.
  <li>Games: 50ms.
      This is the time between when you see an event and you hear the
      corresponding sound.
  <li>Movie players and alike: 500ms and more.
      Such applications "know" the sound to play in advance, and send audio
      data in such a way that it is played simultaneously with the
      corresponding picture.
</ul>

The smaller audio buffers are (to achieve low latency), the larger the
probability to overrun/underrun is.
Buffer overruns/underruns result in stuttering of the sound.

<p>
sndiod(8) imposes a minimum latency on all audio applications,
and the default latency is 160ms.

If you plan to use applications that require a lower latency, use the
<tt>-b</tt> option to select the desired latency (expressed in number of
frames).
For instance, at 48000 samples/second, 50ms latency corresponds to:

<blockquote>
48000 samples/second x 0.050 seconds = 2400 samples
</blockquote>

Then do:

<blockquote><pre>
# <b>rcctl set sndiod flags -b2400</b>
</pre></blockquote>

<h3>Does low latency improve audio-video synchronization?</h3>

No, synchronizing audio to video doesn't require low latency.
Synchronization problems are often caused by the software itself.
Forcing the application to use smaller buffers (by starting sndiod(8)
in low latency mode) may hide the actual problem in some cases, and
give the feeling that the software works better, but obviously the
right thing to do is to start searching for the corresponding bug.

<h3>How do I use a remote sound card?</h3>

sndiod(8) can be configured to accept connections from the network,
allowing other machines to use the sound card as well.
On the remote system, the one with the sound card, run:

<blockquote><pre>
# <b>rcctl set sndiod flags -L-</b>
</pre></blockquote>

On the local system, configure your program to use:

<blockquote><pre>
snd@@hostname/0
</pre></blockquote>

where "hostname" is the address of the remote system.
The <tt>AUDIODEVICE</tt> environment variable could be set to the above value
to make the remote sound card the default audio device.

<p>
Any system able to connect to TCP port 11025 of the remote host will be able
to use the audio device.
For privacy reasons, only one user from one system may have connections
to it at a given time.
If multiple systems have to use the audio device simultaneously, the
sndio(7) authorization cookie must be the same.
For instance, copy your <tt>~/.aucat_cookie</tt> to all accounts
that may use the audio device.

<p>
To avoid glitches, TCP traffic on port 11025 could be prioritized with
the packet filter.
With the default configuration, sndiod will consume around 200kB/s of
network bandwidth.

<h2 id="audioprob">Debugging audio problems</h2>

If you do not hear anything when playing audio, it's possible there
is a mixer control turned to low or simply muted.
See <a href="#confaudio">this section</a> for configuring the mixer.
Please unmute <b>all</b> inputs and outputs before reporting a problem.

<p>
If you believe your device should be working, but for whatever reason isn't,
then it's time for a little debugging.
The following steps can determine if data is being processed by the DAC.

<blockquote><pre>
$ <b>cat > /dev/audio < /dev/zero &amp;</b>
[1] 9926
$ <b>audioctl play.{bytes,errors}</b>
play.bytes=3312000
play.errors=0
$ <b>audioctl play.{bytes,errors}</b>
play.bytes=7065600
play.errors=0
$ <b>audioctl play.{bytes,errors}</b>
play.bytes=9379200
play.errors=0
$ <b>kill %1</b>
$ <b>fg %1</b>
cat > /dev/audio < /dev/zero
Terminated
</pre></blockquote>

Here we see that the processed data count <tt>play.samples</tt> increases
each time we check, so data is flowing.
We also see that the device has not underrun any samples (<tt>play.errors</tt>).
That's good too.

<p>
Note that even if you had speakers plugged in when running the above
test, you should not have heard anything.
The test sends zeros to the device, which is silence for all currently
supported default encodings.

<p>
Since we know the device can process data, it's a good idea to check the mixer
settings again.
Make sure all outputs and all inputs are unmuted and are at a reasonable level.

<p>
If you are still having problems at this point, it's probably time to
<a href="../report.html">file a bug report</a>.
Besides the normal bug report information such as a full dmesg and description
of the problem, please also include the default output of <tt>mixerctl -v</tt>
and the output of the above test for DAC processing.

<h2 id="midi">Using MIDI instruments</h2>

The Musical Instrument Digital Interface (MIDI) protocol provides a
standardized and efficient means to represent musical performance information
as electronic data.
MIDI data contains only instructions needed by a synthesizer to play the
sounds, rather than the actual sounds.

<p>
To play MIDI data, a synthesizer connected to a MIDI port of the machine is
required.
Similarly, to record a MIDI data a MIDI instrument is required (such as a MIDI
keyboard).
Certain sound cards contain embedded MIDI synthesizers that are attached as
MIDI ports.
Advanced MIDI instruments may contain multiple subparts (synthesizers,
keyboards, control surfaces, etc...), they appear as multiple MIDI ports
on OpenBSD.

<p>
When you already have OpenBSD running, look for MIDI ports in the output of
the dmesg(8) command.
An example of MIDI ports in a dmesg output is:

<blockquote><pre>
umidi0 at uhub2 port 2 configuration 1 interface 0 "Roland Roland XV-2020" rev 1.10/1.00 addr 2
midi0 at umidi0: &lt;USB MIDI I/F&gt;
umidi1 at uhub1 port 2 configuration 1 interface 1 "Evolution Electronics Ltd. USB Keystation 61es" rev 1.00/1.25 addr 3
midi1 at umidi1: &lt;USB MIDI I/F&gt;
</pre></blockquote>

It shows three MIDI ports, known by
<a href="http://man.openbsd.org/sndio">sndio(7)</a> as:

<ul>
  <li><tt>rmidi/0</tt> - synthesizer connected via USB
  <li><tt>rmidi/1</tt> - a MIDI master keyboard
</ul>

They are backed by the <tt>/dev/rmidi0</tt> and <tt>/dev/rmidi1</tt>
character devices.
The latter devices are handy for testing the hardware, bypassing most
software layers.

To test your MIDI keyboard, you can use the
<a href="http://man.openbsd.org/hexdump">hexdump(1)</a> utility to display
MIDI data you're playing on it:

<blockquote><pre>
$ <b>hexdump -e '1/1 "%02x\n"' &lt; /dev/rmidi0</b>
90
3c
71
...
</pre></blockquote>

The output of the keyboard can be connected to the input of the synthesizer,
as follows:

<blockquote><pre>
$ <b>cat -u &lt; /dev/rmidi0 &gt; /dev/rmidi1</b>
</pre></blockquote>

Now you can hear on the synthesizer what you're playing on the MIDI keyboard.

<p>
The main utility to play standard MIDI files is
<a href="http://man.openbsd.org/midiplay">midiplay(1)</a>.
Playing a standard MIDI file, in this example through the synthesizer is as
easy as:

<blockquote><pre>
$ <b>midiplay -f rmidi/0 file.mid</b>
</pre></blockquote>

The <a href="http://man.openbsd.org/sndiod">sndiod(8)</a> server exposes MIDI
thru ports, allowing programs to send each other MIDI data.
For instance, if you have no hardware synthesizer connected, you could
start a software one (like the audio/fluidsynth port) and then use it as MIDI
output:

<blockquote><pre>
$ <b>midiplay -f midithru/0 file.mid</b>
</pre></blockquote>

To record MIDI files, you can use the <tt>smfrec</tt> utility bundled in
the <tt>audio/midish</tt> port.
For instance:

<blockquote><pre>
$ <b>smfrec -d rmidi/0 -i rmidi/1 file.mid</b>
</pre></blockquote>

This will record what is played on the keyboard (<tt>rmidi/1</tt>) while
sending it in real-time on the synthesizer (<tt>rmidi/0</tt>) so you can hear
what you're playing.
More complicated operations like editing, routing, mixing and transforming
MIDI data can be achieved using the <tt>rmidish</tt> utility bundled in the
<tt>audio/midish</tt> port.

<h2 id="playDVD">Playing DVDs</h2>

OpenBSD supports DVD media through the ISO 9660 filesystem, which is also used
on CD-ROMs, and also through the
<a href="http://www.osta.org/specs/">Universal Disk Format (UDF)</a> filesystem
which is found on some DVDs.
However, almost all DVD-Video and DVD-ROM discs use the UDF bridge format,
which is a combination of the DVD MicroUDF (subset of UDF 1.02) and ISO 9660
filesystems.
It is used for backward compatibility reasons.

<p>
Some popular media players, supporting DVD playback, have been ported to
OpenBSD.
Some popular examples are <a href="https://www.videolan.org/">VLC</a>
and <a href="http://www.mplayerhq.hu/">mplayer</a>.
Please read the installation instructions that come with these packages,
because these tools may need further setup.
With these utilities, it is possible to play the DVDs by directly accessing
the raw device.
Of course, it is also possible to mount a DVD using
<a href="http://man.openbsd.org/mount_cd9660">mount_cd9660(8)</a> and play
the files directly.

<p>
<b>Notes:</b>

<ul>
  <li>Nearly all DVDs you buy are encrypted using the Content Scrambling
      System (CSS).
      To be able to play these encrypted DVDs, you can use the <b>libdvd</b>
      library, also available through packages and ports.
  <li>Be aware that a region code may be present on your DVD disk(s).
      This should not be much of a problem when playing DVDs on a computer.
</ul>

<h2 id="burnCD">Burning CDs and DVDs</h2>

<h3 id="burnIntro">Introduction and basic setup</h3>

You should first make sure your CD/DVD writer has been recognized and
configured by the kernel.
Most SCSI devices are supported.
SATA, IDE/ATAPI and USB devices are supported through SCSI emulation.
You can quickly find your device in the output of
<a href="http://man.openbsd.org/dmesg">dmesg(8)</a>.
Just look for lines beginning with "cd."
For example:

<blockquote><pre>
cd0 at scsibus0 targ 0 lun 0: &lt;TOSHIBA, CD-ROM XM-5702B, 2826&gt; SCSI0 5/cdrom removable
cd1 at scsibus1 targ 4 lun 0: &lt;PLEXTOR, CD-R PX-R412C, 1.04&gt; SCSI2 5/cdrom removable
</pre></blockquote>

<h4>Error: <tt>mount_cd9660: /dev/cd2c on /mnt/cdrom: No such file or
directory</tt></h4>

By default, the OpenBSD installer creates only two cd device nodes,
<tt>cd0</tt> and <tt>cd1</tt>.
To start using your <tt>cd2</tt> device, you must create the necessary
device nodes for it.
The recommended way to do that is using the
<a href="http://man.openbsd.org/MAKEDEV">MAKEDEV(8)</a> script.

<blockquote><pre>
# <b>cd /dev</b>
# <b>./MAKEDEV cd2</b>
</pre></blockquote>

In what follows, we will mostly be accessing the CD/DVD writer through the
<i>raw</i> character device, <b>not</b> the <i>block</i> device.

<h4>Checking CD/DVD writer operation</h4>

It is recommended to check whether your CD/DVD writer is working correctly.
In this example, we'll be using this USB DVD writer:

<blockquote><pre>
cd2 at scsibus2 targ 1 lun 0: &lt;LITE-ON, DVDRW LDW-851S, GS0C&gt; SCSI0 5/cdrom removable
</pre></blockquote>

Try to use it by mounting an existing CD/DVD in it.
If desired, you could also check the transfer rate you are getting when
copying files to your hard disk.

<h3 id="writeCD">Writing CDs</h3>

<h4>Creating data CD-ROMs</h4>

First, you will want to create an ISO 9660 filesystem to put on a CD-ROM.
To do this you can use the
<a href="http://man.openbsd.org/mkhybrid">mkhybrid(8)</a>
utility in the base system, or the <tt>mkisofs</tt> utility from the
<tt>cdrtools</tt> <a href="faq15.html#PkgMgmt">package</a>.
In the examples below, we will use <tt>mkhybrid</tt>, although <tt>mkisofs</tt>
usage is very similar.

<p>
For example, to store the OpenBSD kernel sources in an ISO9660 image, you
might do:

<blockquote><pre>
$ <b>mkhybrid -R -o sys.iso /usr/src/sys</b>

Using ALTQ_RMC.000;1 for  /usr/src/sys/altq/altq_rmclass_debug.h (altq_rmclass.h)
...
Using IEEE8021.00H;1 for  /usr/src/sys/net80211/ieee80211_amrr.c (ieee80211.c)
 10.89% done, estimate finish Sat Nov  3 08:01:23 2007
 21.78% done, estimate finish Sat Nov  3 08:01:28 2007
...
 87.12% done, estimate finish Sat Nov  3 08:01:31 2007
 98.01% done, estimate finish Sat Nov  3 08:01:32 2007
Total translation table size: 0
Total rockridge attributes bytes: 896209
Total directory bytes: 2586624
Path table size(bytes): 11886
Max brk space used 0
45919 extents written (89 Mb)
</pre></blockquote>

The <tt>-R</tt> option tells <tt>mkhybrid</tt> to create Rock Ridge
extensions in the ISO 9660 image.
The Rock Ridge Interchange Protocol was created to support POSIX filesystem
semantics in ISO 9660 filesystems, such as longer file names, ownerships,
permissions, file links, soft links, device nodes, deep file hierarchies
(more than 8 levels of subdirectories), etc.

<p>
If you want the long file names on your CD-ROM to be readable on Windows
systems, you should add the <tt>-J</tt> flag to include Joliet extensions
in the ISO 9660 image as well.

<p>
After creating the filesystem, you can verify it by
<a href="faq14.html#MountImage">mounting the ISO 9660 image</a>.
If all is well, you are now ready to burn the CD-R(W).
The easiest way to do this is to use the
<a href="http://man.openbsd.org/cdio">cdio(1)</a> utility.

<p>
If you are using multi-write media such as CD-RW, you will need to blank the
media before burning it.

<blockquote><pre>
# <b>cdio -f cd1c blank</b>
</pre></blockquote>

You are now ready to burn the image created in the above example to a blank
CD-R(W).
You could use a command similar to:

<blockquote><pre>
# <b>cdio -f cd1c tao sys.iso</b>
</pre></blockquote>

With the options specified above, we're asking cdio to use the second CD-ROM
device as the CD writer.

<p>
To verify whether the CD-ROM has been written correctly, you can mount it
and check whether everything is there.
To mount the filesystem, you should use the <i>block</i> device for the
CD-ROM drive, which in this case is still the CD writer:

<blockquote><pre>
# <b>mount /dev/cd1c /mnt/cdrom</b>
</pre></blockquote>

<h4>Creating audio CDs</h4>

To burn audio CDs, you can again use
<a href="http://man.openbsd.org/cdio">cdio(1)</a> with the <tt>tao -a</tt>
option.

<p>
As an example, we'll be making a backup copy of a music CD.
This involves two steps:

<ol>
<li>Fetch the audio tracks from the original CD.

<blockquote><pre>
# <b>cdio -f cd1c cdrip</b>
</pre></blockquote>

This command will extract a series of WAV files from your second CD-ROM drive
to your disk.

<li>Write the audio tracks to a blank CD.

<blockquote><pre>
# <b>cdio -f cd1c tao -a *.wav</b>
</pre></blockquote>
</ol>

<h3 id="writeDVD">Writing DVDs</h3>

There are a few important things about DVD you should know about before
proceeding to write your own DVDs.

<p>
<b>Important notes:</b>

<ul>
  <li>If you really want to know all about DVDs, you can read the very
      extensive <a href="http://www.dvddemystified.com/dvdfaq.html">DVD FAQ</a>
      document to start with.
  <li>This section has seen only very limited testing, and we certainly have
      not tried every possible media and writer combination.
      Nevertheless, we have had, or have heard of, positive experiences with
      all of the DVD formats mentioned below.
</ul>

<h4>Different DVD formats</h4>

There are a number of different DVD formats.
Commonly used are the DVD-R, DVD-RW, DVD+R, and DVD+RW formats (R means
writable once, RW means it can be rewritten a few thousand times).
They are pretty much competing standards.

<p>
A pretty different format is DVD-RAM, which was mainly developed as a
data drive and has advanced packet writing functions, allowing it to be
used like a kind of optical hard disk.
DVD-RAM is not recommended for video usage as video gets written to the
discs in a format not compatible with normal DVD players.

<p>
The important thing is using media which suits your DVD writer.
If you expect compatibility with other DVD players, watch your step and
be sure to read
<a href="http://www.dvddemystified.com/dvdfaq.html#4.3.1">this section</a>
of the DVD FAQ.

<h4>DVD writing speed</h4>

It may be useful to point out that DVD speed indications differ from CD-ROM
speed indications.
The following table gives an overview:

<p>
<table border="1" style="empty-cells: show;">
<tr align="center">
<td>DVD read/write speed</td>
<td>Transfer rate (MB/s)</td>
<td>Equivalent CD-R(W) read/write speed</td>
</tr>
<tr align="center">
<td>1x</td>
<td>1.32</td>
<td>9x</td>
</tr>
<tr align="center">
<td>2x</td>
<td>2.64</td>
<td>18x</td>
</tr>
<tr align="center">
<td>4x</td>
<td>5.28</td>
<td>36x</td>
</tr>
<tr align="center">
<td>8x</td>
<td>10.57</td>
<td>72x</td>
</tr>
</table>

<p>
As can been seen from the table, the transfer rates are relatively high,
and you should check whether your bus (SCSI, IDE/ATAPI, SATA, USB) is
performant enough to handle this throughput.
In general, the speed of SCSI, SATA, and IDE/ATAPI buses should be just fine.

<h4>Writing the DVD</h4>

Basically, the process is very similar to writing CD-R(W)s.
The software used, however, is different.
At the moment, the best option is <tt>growisofs</tt> from the
<tt>sysutils/dvd+rw-tools</tt> package.
This utility writes an ISO 9660 image to the DVD medium.
All recordable DVD formats are supported by the dvd+rw-tools.

<p>
In case you want to find out more info about the media in your DVD writer,
you can use the <tt>dvd+rw-tools</tt> utility.

There are two options to write the DVD:

<ul>
  <li>Pre-master an ISO 9660 from your data, storing the image on your hard
      disk, then write this image to the DVD.
  <li>Write an ISO 9660 from your data immediately to the DVD.
</ul>

I created a pre-mastered ISO 9660 image from the OpenBSD CVS modules
(src, xenocara, ports and www) contained in the /cvs directory on my disk.
I used the following command, which looks very similar to the one I used
to create the CD-ROM image above.

<blockquote><pre>
$ <b>mkhybrid -r -o cvs.iso /cvs</b>
</pre></blockquote>

If desired, check the ISO 9660 filesystem by
<a href="faq14.html#MountImage">mounting the image</a>.
To write this image (about 2 GB) to an empty DVD disc, one could use:

<blockquote><pre>
# <b>growisofs -dvd-compat -Z /dev/rcd2c=cvs.iso</b>
Executing 'builtin_dd if=cvs.iso of=/dev/rcd2c obs=32k seek=0'
/dev/rcd2c: pre-formatting blank DVD+RW...
/dev/rcd2c: "Current Write Speed" is 4.1x1385KBps.
  23822336/1545832448 ( 1.5%) @@3.9x, remaining 5:19
  42172416/1545832448 ( 2.7%) @@3.9x, remaining 5:20
  60522496/1545832448 ( 3.9%) @@3.9x, remaining 4:54
...
1504706560/1545832448 (97.3%) @@3.9x, remaining 0:07
1523318784/1545832448 (98.5%) @@3.9x, remaining 0:04
1541898240/1545832448 (99.7%) @@3.9x, remaining 0:00
/dev/rcd2c: flushing cache
/dev/rcd2c: writing lead-out
/dev/rcd2c: reloading tray
</pre></blockquote>

The <tt>-Z</tt> option tells growisofs to burn an initial session to the
device, which in this case is my DVD writer, attached to <tt>cd2</tt>.
The <tt>-dvd-compat</tt> option closes the disk, which means no more sessions
can be appended to it.
This should provide better compatibility with video DVD players and some
older DVD-ROM units.

<p>
Notice how growisofs indicates the writing speed, in this case 3.9x
DVD speed, which is what could be expected from the media and writer
combination, as indicated by <tt>dvd+rw-tools</tt>.

<p>
If you are short on disk space and cannot store an ISO 9660 image for a
DVD, you can write your data directly to the DVD.
Let's first do a dry run, which simulates the creation of the filesystem.

<blockquote><pre>
# <b>growisofs -dry-run -Z /dev/rcd2c -R /cvs</b>
</pre></blockquote>

If this succeeds, just leave out the -dry-run option and start burning the
DVD.

<p>
It is also possible to append data to an existing DVD, by using the
<tt>-M</tt> option, which merges a new session to an existing one:

<blockquote><pre>
# <b>growisofs -M /dev/rcd2c -R /mydata</b>
</pre></blockquote>

For more information about growisofs, refer to the man page.

<p>
When you have finished writing the DVD, mount it and check whether
everything you expected to be there is indeed there.

<h4>Why am I not getting the writing speed I expected?</h4>

Instead of the above writing output, you may see something like:

<blockquote><pre>
   4784128/1545832448 ( 0.3%) @@0.7x, remaining 26:50
   7929856/1545832448 ( 0.5%) @@0.7x, remaining 29:05
  14123008/1545832448 ( 0.9%) @@0.7x, remaining 27:06
...
</pre></blockquote>

which is much slower.
It means you are somehow not getting enough throughput on whatever bus
your DVD writer is using.
In the above example, the USB DVD writer was attached to a machine on which
the <a href="http://man.openbsd.org/ehci">ehci(4)</a> driver, used by USB 2.0
controllers, failed to initialize properly.
As always, you are welcome to provide patches and test results.
The DVD writer fell back to the slower USB 1.1 interface, which causes
reduced throughput.
Indeed, USB 1.1 is limited to 12 Mbit/s, which amounts to 1.43 MB/s or 1.08x
in DVD speed terms.
The DVD writer falls back to a lower pace than the maximum to reduce the risk
of buffer underruns.

<h2 id="plugins">Browser plugins (Java and Flash)</h2>

Java plugin support can be obtained with the <tt>icedtea-web</tt> package.
In your browser, check for the list of detected plugins and ensure icedtea-web
is there.
This is usually found via <tt>about:plugins</tt> in Mozilla browsers and
<tt>chrome://components</tt> in Chromium/Iridium.

<p>
Note that due to the security issues with Java applets on the web, most
browsers disable Java support by default.
You will be prompted for your explicit consent to run applets via icedtea-web.

<p>
Adobe's Flash plugin is distributed in binary form only, and they do not
provide a native OpenBSD version.
Considering their security record, we thank them for this neglect.

<p>
If you are just looking to watch Flash videos from common websites,
there are a number of options in packages, including
<a href="https://github.com/monsieurvideo/get-flash-videos">get-flash-videos</a>,
<a href="http://flavio.tordini.org/minitube">minitube</a>,
<a href="http://docs.livestreamer.io/">livestreamer</a>
and <a href="http://rg3.github.io/youtube-dl/">youtube-dl</a>.

<p>
</body>
</html>
@


1.198
log
@2017
@
text
@d52 1
a52 1
  <li><a href="#audioserver">OpenBSD's audio server, sndiod</a>
d283 1
a283 1
<h2 id="audioserver">OpenBSD's audio server, sndiod</h2>
@


1.197
log
@s/or DOS //
@
text
@d11 1
@


1.196
log
@fix a broken link; spotted by steven roberts
@
text
@d659 2
a660 2
or DOS systems, you should add the <tt>-J</tt> flag to include Joliet
extensions in the ISO 9660 image as well.
@


1.195
log
@the dvd+rw-mediainfo package is called dvd+rw-tools now.

from ian sutton
@
text
@d425 1
a425 1
<a href="report.html">file a bug report</a>.
@


1.194
log
@new section on changing the default audio output device.

ok sthen
@
text
@d816 1
a816 1
you can use the <tt>dvd+rw-mediainfo</tt> utility.
d866 1
a866 1
combination, as indicated by dvd+rw-mediainfo.
@


1.193
log
@tls on openbsd.org is now real:
- link to https://www.openbsd.org from the sub-projects' pages
- make internal links relative
- switch link rel=canonical to https to please some search engines
"go ahead" from beck, "do it!!!!" tj
@
text
@d46 1
a46 1
  <li><a href="#confaudio"  >Configuring audio devices with mixerctl</a>
d65 1
a65 1
<h2 id="confaudio">Configuring audio devices with mixerctl</h2>
d138 12
@


1.192
log
@get flash videos redirects from github.com to github.io. update.
from validator.w3.org/checklink
@
text
@d13 1
a13 1
<link rel="canonical" href="http://www.openbsd.org/faq/faq13.html">
d413 1
a413 1
<a href="http://www.openbsd.org/report.html">file a bug report</a>.
@


1.191
log
@remove man page connotations from section titles. there are man page links
directly below them in almost every instance.

ok tb
@
text
@d931 1
a931 1
and <a href="http://rg3.github.com/youtube-dl/">youtube-dl</a>.
@


1.190
log
@zap more invisible <p> tags, remove commented-out bits, clean up formatting.
@
text
@d46 1
a46 1
  <li><a href="#confaudio"  >Configuring audio devices with mixerctl(1)</a>
d51 1
a51 1
  <li><a href="#audioserver">OpenBSD's audio server, sndiod(8)</a>
d65 1
a65 1
<h2 id="confaudio">Configuring audio devices with mixerctl(1)</h2>
d270 1
a270 1
<h2 id="audioserver">OpenBSD's audio server, sndiod(8)</h2>
@


1.189
log
@tidy up browser plugin section and remove some redundant text.
@
text
@d61 1
a61 1
  <li><a href="#plugins">Browser plugins (Java and Flash)</a>
d202 2
a203 2
<a href="http://man.openbsd.org/aucat">aucat(1)</a>
comes with OpenBSD and can be used for recording.
d407 3
a409 4
Since we know the device can process data, it's a good idea to check
the mixer settings again.
Make sure all outputs and all inputs are unmuted and are at a reasonable
level.
d414 3
a416 4
Besides the normal bug report information such as a full dmesg and
description of the problem, please also include the default output
of <tt>mixerctl -v</tt> and the output of the above test for DAC
processing.
d421 4
a424 6
standardized and efficient means to represent musical performance
information as electronic data.
MIDI data contains only instructions needed by a synthesizer to play
the sounds, rather than the actual sounds.

<!-- <h3>Devices setup</h3> -->
d427 6
a432 6
To play MIDI data, a synthesizer connected to a MIDI port of the
machine is required.
Similarly, to record a MIDI data a MIDI instrument is required
(such as a MIDI keyboard).
Certain sound cards contain embedded MIDI synthesizers that are
attached as MIDI ports.
d434 2
a435 2
keyboards, control surfaces, etc...), they appear as multiple MIDI
ports on OpenBSD.
d438 2
a439 2
When you already have OpenBSD running, look for MIDI ports in the
output of the dmesg(8) command.
d453 2
a454 2
<li> <tt>rmidi/0</tt> - synthesizer connected via USB
<li> <tt>rmidi/1</tt> - a MIDI master keyboard
d463 2
a464 2
<a href="http://man.openbsd.org/hexdump">hexdump(1)</a>
utility to display MIDI data you're playing on it:
d474 2
a475 2
The output of the keyboard can be connected to the input of the
synthesizer, as follows:
d481 1
a481 4
Now you can hear on the synthesizer what you're playing on the MIDI
keyboard.

<!-- <h3>Playing, recording MIDI sequences</h3> -->
d486 2
a487 2
Playing a standard MIDI file, in this example through the synthesizer,
is as easy as:
d493 2
a494 4
The
<a href="http://man.openbsd.org/sndiod">sndiod(8)</a>
server exposes MIDI thru ports, allowing programs to send each other
MIDI data.
d496 2
a497 2
start a software one (like the audio/fluidsynth port) and then use
it as MIDI output:
d511 6
a516 6
will record what is played on the keyboard (<tt>rmidi/1</tt>) while
sending it in real-time on the synthesizer (<tt>rmidi/0</tt>) so you
can hear what you're playing.
More complicated operations like editing, routing, mixing and
transforming MIDI data can be achieved using the <tt>rmidish</tt>
utility bundled in the <tt>audio/midish</tt> port.
d520 4
a523 4
OpenBSD supports DVD media through the ISO 9660 filesystem, which
is also used on CD-ROMs, and also through the
<a href="http://www.osta.org/specs/">Universal Disk Format (UDF)</a>
filesystem which is found on some DVDs.
d532 2
a533 4
Examples are <a href="http://freecode.com/projects/ogle">ogle</a>,
<a href="http://www.mplayerhq.hu/">mplayer</a>,
<a href="http://www.xine-project.org/">xine</a> and
<a href="https://www.kde.org/applications/multimedia/kaffeine/">kaffeine</a>.
d536 2
a537 2
With these utilities, it is possible to play the DVDs by directly
accessing the raw device.
d539 2
a540 2
<a href="http://man.openbsd.org/mount_cd9660">mount_cd9660(8)</a>
and play the files directly.
d544 1
d546 6
a551 6
<li>Nearly all DVDs you buy are encrypted using the Content Scrambling
System (CSS).
To be able to play these encrypted DVDs, you can use the
<b>libdvd</b> library, also available through packages and ports.
<li>Be aware that a region code may be present on your DVD disk(s).
This should not be much of a problem when playing DVDs on a computer.
d580 1
a580 2
<a href="http://man.openbsd.org/MAKEDEV">MAKEDEV(8)</a>
script.
d610 1
a610 1
utility in the base system, or the mkisofs utility which comes with the
d655 1
a655 2
<a href="http://man.openbsd.org/cdio">cdio(1)</a>
utility.
d673 2
a674 2
With the options specified above, we're asking cdio to use the second
CD-ROM device as the CD writer.
d689 2
a690 2
<a href="http://man.openbsd.org/cdio">cdio(1)</a>
with the <tt>tao -a</tt> option.
d720 1
d722 7
a728 8
<li>If you really want to know all about DVDs, you can read the very
extensive
<a href="http://www.dvddemystified.com/dvdfaq.html">DVD FAQ</a>
document to start with.
<li>This section has seen only very limited testing, and we certainly have
not tried every possible media and writer combination.
Nevertheless, we have had, or have heard of, positive experiences with
all of the DVD formats mentioned below.
d809 3
a811 3
<li>Pre-master an ISO 9660 from your data, storing the image on your hard
disk, then write this image to the DVD.
<li>Write an ISO 9660 from your data immediately to the DVD.
a813 1
<p>
d823 2
a824 2
If desired, check the ISO 9660 filesystem by <a href="faq14.html#MountImage">
mounting the image</a>.
d897 2
a898 3
the
<a href="http://man.openbsd.org/ehci">ehci(4)</a>
driver, used by USB 2.0 controllers, failed to initialize properly.
d902 4
a905 4
Indeed, USB 1.1 is limited to 12 Mbit/s, which amounts to 1.43 MB/s or
1.08x in DVD speed terms.
The DVD writer falls back to a lower pace than the maximum to reduce the
risk of buffer underruns.
a908 1
<p>
@


1.188
log
@- simplify faq section titles, making the actual topics more prevalent
- merge flash and java sections into a single browser plugin section
- correct some tab/space inconsistency
- fix invalid html

from christian heckendorf <mbie at ulmus.me>

discussed with tb
@
text
@d61 1
a61 1
  <li><a href="#browserplug">Flash and Java in web browsers</a>
d921 1
a921 1
<h2 id="browserplug">Flash and Java in web browsers</h2>
d923 6
a928 7
<h3 id="javaplugin">Java support in web browsers</h3>

If it's available for your platform, just install the <tt>icedtea-web</tt>
package.
In your browser, check for the list of detected plugins (<tt>about:config</tt>
in Mozilla-based browsers, <tt>about:plugins</tt> in <tt>www/epiphany</tt>
or <tt>about:</tt> in <tt>www/midori</tt>) and ensure icedtea-web is there.
d935 3
a937 4
<h3 id="flashplugin">Flash support in web browsers</h3>

The Flash plugin is distributed by Adobe in binary form only.
Adobe does not provide a native OpenBSD plugin.
d945 2
a946 3
<a href="http://docs.livestreamer.io/">livestreamer</a>,
and
<a href="http://rg3.github.com/youtube-dl/">youtube-dl</a>.
@


1.187
log
@trim away some verbosity, mention rcctl instead of editing rc.conf.local,
fix some weird wording.
@
text
@d46 1
a46 1
  <li><a href="#confaudio"  >How do I configure my audio device?</a>
d48 2
a49 2
  <li><a href="#playCD"     >How can I play audio CDs in OpenBSD?</a>
  <li><a href="#recordaudio">Can I use OpenBSD to record audio samples?</a>
d51 5
a55 5
  <li><a href="#audioserver">How do I set up an audio server?</a>
  <li><a href="#audioprob"  >What can I do if I have audio problems?</a>
  <li><a href="#midi"       >How do I use my MIDI instruments?</a>
  <li><a href="#playDVD"    >How can I play DVDs in OpenBSD?</a>
  <li><a href="#burnCD"     >How do I burn CDs and DVDs?</a>
d61 1
a61 2
  <li><a href="#javaplugin" >Can I have Java in my web browser?</a>
  <li><a href="#flashplugin">Can I have Flash in my web browser?</a>
d65 1
a65 1
<h2 id="confaudio">How do I configure my audio device?</h2>
d151 1
a151 1
<h2 id="playCD">How can I play audio CDs in OpenBSD?</h2>
d200 1
a200 1
<h2 id="recordaudio">Can I use OpenBSD to record audio samples?</h2>
d270 1
a270 1
<h2 id="audioserver">How do I set up an audio server?</h2>
d365 1
a365 1
<h2 id="audioprob">What can I do if I have audio problems?</h2>
d420 1
a420 1
<h2 id="midi">How do I use my MIDI instruments?</h2>
d527 1
a527 1
<h2 id="playDVD">How can I play DVDs in OpenBSD?</h2>
d564 1
a564 1
<h2 id="burnCD">How do I burn CDs and DVDs?</h2>
d921 3
a923 1
<h2 id="javaplugin">Can I have Java support in my web browser?</h2>
d936 1
a936 1
<h2 id="flashplugin">Can I have Flash in my web browser?</h2>
@


1.186
log
@trim some fat from the cd burning steps. you know a section is too verbose
when it says "can we get on with it?"
@
text
@d57 3
a59 3
  <li><a href="#burnIntro">Introduction and basic setup</a>
  <li><a href="#writeCD"  >Writing CDs</a>
  <li><a href="#writeDVD" >Writing DVDs</a>
d70 2
a71 3
Running
<a href="http://man.openbsd.org/mixerctl">mixerctl(1)</a>
with no arguments will list the device's mixer controls and current settings.
d87 4
a90 5
<li><tt>outputs.master</tt> controls the playback output level
<li><tt>record.source</tt> controls what inputs are mixed into the
ADC (analog to digital converter), used when recording
<li><tt>record.volume</tt> controls the input
level of the ADC
d142 1
a142 3
<p>
OpenBSD comes with
<a href="http://man.openbsd.org/aucat">aucat(1)</a>,
a149 1
<p>
a151 4
A good starting point to learn more about different audio file formats is
this Wikipedia article:
<a href="http://en.wikipedia.org/wiki/Audio_file_format">Audio file formats</a>.

d163 2
a164 4
<li>Use the headphones output, usually at the front side of the drive.
<li>Connect the audio output at the back side of the drive to your audio card.
Yes, this is a supplementary cable next to the data (SATA/IDE/SCSI) and power
cables.
d167 1
a167 6
<p>
A nice command line utility called
<a href="http://man.openbsd.org/cdio">cdio(1)</a>
has been included in the base system.
Called without parameters, it will enter interactive mode.
If you want to play the CD right away, just enter:
d177 2
a178 2
you may want to add the user to the operator group for convenience by
adjusting this group's line in <tt>/etc/group</tt>.
d199 1
a199 3
If you prefer a beautiful GUI, there are plenty of X11-based CD players in
the packages and ports collection.
Just have a look in the <tt>audio</tt> section.
d212 4
a215 3
The file will contain signed 16-bit stereo samples, sampled at 48kHz.
Other sample formats, sample rates and number of channels can be recorded.
See the manual for more details.
d284 12
a295 13
<li>Real-time synthesizers: 5ms.
This is the time it takes between hitting a key on your MIDI keyboard
and actually hearing the note.
Roughly, 5ms corresponds to the time it takes for the sound to
propagate 1.75m.

<li>Games: 50ms.
This is the time between when you see an event and you hear the corresponding
sound.

<li>Movie players and alike: 500ms and more.
Such applications "know" the sound to play in advance, and send audio data
in such a way that it is played simultaneously with the corresponding picture.
d315 1
a315 1
then add:
d318 1
a318 1
sndiod_flags="-b2400"
a320 4
to <tt>/etc/rc.conf.local</tt>, or adjust the flags using the
<a href="http://man.openbsd.org/rcctl">rcctl(8)</a>
utility.

d323 1
a323 2
No.
Synchronizing audio to video doesn't require low latency.
d330 1
a330 1
<h3>How to use a remote sound card?</h3>
d334 1
a334 1
On the remote system (the one with the sound card) add:
d337 1
a337 1
sndiod_flags="-L-"
a339 3
to <tt>/etc/rc.conf.local</tt>, or adjust the flags using the
<a href="http://man.openbsd.org/rcctl">rcctl(8)</a>
utility.
d351 2
a352 2
Note that any system able to connect to TCP port 11025 of the remote
host will be able to use the audio device.
d379 1
a379 1
$ <b>cat > /dev/audio < /dev/zero &amp; </b>
d398 1
a398 2
We also see
that the device has not underrun any samples (<tt>play.errors</tt>).
@


1.185
log
@delete section numbers. this will make adding and removing content a lot
less work.
@
text
@d46 10
a55 10
<li><a href="#confaudio"  >How do I configure my audio device?</a>
<li><a href="#playaudio"  >Playing different kinds of audio</a>
<li><a href="#playCD"     >How can I play audio CDs in OpenBSD?</a>
<li><a href="#recordaudio">Can I use OpenBSD to record audio samples?</a>
<li><a href="#recordmon"  >Recording a monitor mix of all audio playback</a>
<li><a href="#audioserver">How do I set up an audio server?</a>
<li><a href="#audioprob"  >What can I do if I have audio problems?</a>
<li><a href="#midi"       >How do I use my MIDI instruments?</a>
<li><a href="#playDVD"    >How can I play DVDs in OpenBSD?</a>
<li><a href="#burnCD"     >How do I burn CDs and DVDs?</a>
d61 2
a62 2
<li><a href="#javaplugin" >Can I have Java in my web browser?</a>
<li><a href="#flashplugin">Can I have Flash in my web browser?</a>
a609 7
<h4>But <tt>cdrecord -scanbus</tt> does not work!</h4>

Yes, OpenBSD uses a different device namespace than the OS for which the
<tt>cdrecord</tt> utility was written.
All configured devices should be in the dmesg output, as mentioned above.
The information you need is right there.

a640 21
The <a href="http://man.openbsd.org/time">time(1)</a>
command can help here.

<p>
If something goes wrong here and you are getting errors during this phase,
it is wise to fix the problem and not to start writing a CD/DVD yet.

<h4>I want to write a CD here! Can we get on with it?</h4>

Before proceeding, it is a good idea to keep a few words of advice in mind:

<ul>
<li>Do not run any disk-intensive jobs while writing a CD/DVD.
Doing this will reduce the throughput to your CD/DVD writer.
If the throughput drops below what the writer is expecting for too long,
its buffer will run empty.
This phenomenon is also known as a "buffer underrun."
<li>Prevent shocks during writing as this may cause the laser beam to drift
from its track, which may lead to errors on the disc.
<li>Not every DVD writer supports every DVD format, see below.
</ul>
@


1.184
log
@tweak [faq index] button and sync the pf user's guide with that style.
@
text
@d9 1
a9 2
<title>13 - Multimedia</title>
<meta name= "description"   content= "OpenBSD FAQ 13 - Multimedia">
d38 1
a38 1
<font color="#e00000">FAQ 13 - Multimedia</font>
d46 10
a55 11
<li><a href="#confaudio"  >13.1 - How do I configure my audio device?</a>
<li><a href="#playaudio"  >13.2 - Playing different kinds of audio</a>
<li><a href="#playCD"     >13.3 - How can I play audio CDs in OpenBSD?</a>
<li><a href="#recordaudio">13.4 - Can I use OpenBSD to record audio samples?</a>
<li><a href="#recordmon"  >13.5 - Recording a monitor mix of all audio
                           playback</a>
<li><a href="#audioserver">13.6 - How do I set up an audio server?</a>
<li><a href="#audioprob"  >13.7 - What can I do if I have audio problems?</a>
<li><a href="#midi"       >13.8 - How do I use my MIDI instruments?</a>
<li><a href="#playDVD"    >13.9 - How can I play DVDs in OpenBSD?</a>
<li><a href="#burnCD"     >13.10 - How do I burn CDs and DVDs?</a>
d57 3
a59 3
  <li><a href="#burnIntro">13.10.1 - Introduction and basic setup</a>
  <li><a href="#writeCD"  >13.10.2 - Writing CDs</a>
  <li><a href="#writeDVD" >13.10.3 - Writing DVDs</a>
d61 2
a62 2
<li><a href="#javaplugin" >13.11 - Can I have Java in my web browser?</a>
<li><a href="#flashplugin">13.12 - Can I have Flash in my web browser?</a>
d66 1
a66 1
<h2 id="confaudio">13.1 - How do I configure my audio device?</h2>
d142 1
a142 1
<h2 id="playaudio">13.2 - Playing different kinds of audio</h2>
d161 1
a161 1
<h2 id="playCD">13.3 - How can I play audio CDs in OpenBSD?</h2>
d219 1
a219 1
<h2 id="recordaudio">13.4 - Can I use OpenBSD to record audio samples?</h2>
d265 1
a265 1
<h2 id="recordmon">13.5 - Recording a monitor mix of all audio playback</h2>
d288 1
a288 1
<h2 id="audioserver">13.6 - How do I set up an audio server?</h2>
d392 1
a392 1
<h2 id="audioprob">13.7 - What can I do if I have audio problems?</h2>
d396 1
a396 1
See <a href="#confaudio">section 13.1</a> for configuring the mixer.
d448 1
a448 1
<h2 id="midi">13.8 - How do I use my MIDI instruments?</h2>
d555 1
a555 1
<h2 id="playDVD">13.9 - How can I play DVDs in OpenBSD?</h2>
d592 1
a592 1
<h2 id="burnCD">13.10 - How do I burn CDs and DVDs?</h2>
d594 1
a594 1
<h3 id="burnIntro">13.10.1 - Introduction and basic setup</h3>
d670 1
a670 1
<h3 id="writeCD">13.10.2 - Writing CDs</h3>
d781 1
a781 1
<h3 id="writeDVD">13.10.3 - Writing DVDs</h3>
d977 1
a977 1
<h2 id="javaplugin">13.11 - Can I have Java support in my web browser?</h2>
d990 1
a990 1
<h2 id="flashplugin">13.12 - Can I have Flash in my web browser?</h2>
@


1.183
log
@save some space by moving the [faq index] button to the top right corner
and removing the <h3> table of contents.
@
text
@d40 3
a42 1
<small><a href= "index.html" style="float:right;">[FAQ Index]</a></small>
@


1.182
log
@use short form man links in the faq and fix a few broken links
@
text
@d40 1
a42 3
<p>
<a href= "index.html">[FAQ Index]</a>
<p>
a43 1
<h3>Table of Contents</h3>
a1005 3
<hr>
<p>
<a href= "index.html">[FAQ Index]</a>
@


1.181
log
@each faq page has header and footer links that look like this:

[faq index] [to section x - some topic] [to section y - another topic]

that can be very useful if the faq you're reading only covers one topic,
or if the pages are meant to be read in order. it makes sense to have
them on the pf and smtpd faq pages, but the main faq contains a variety
of unrelated topics, so they're not actually very useful there. remove.

while here, make a few subject titles more concise.

ok tb
@
text
@d74 1
a74 1
<a href="http://man.openbsd.org/?query=mixerctl">mixerctl(1)</a>
d149 1
a149 1
<a href="http://man.openbsd.org/?query=aucat">aucat(1)</a>,
d183 1
a183 1
<a href="http://man.openbsd.org/?query=cdio">cdio(1)</a>
d224 1
a224 1
<a href="http://man.openbsd.org/?query=aucat">aucat(1)</a>
d249 1
a249 1
<a href="http://man.openbsd.org/?query=mixerctl">mixerctl(1)</a>.
d276 1
a276 1
<a href="http://man.openbsd.org/?query=sndiod">sndiod(8)</a> by using:
d343 1
a343 1
<a href="http://man.openbsd.org/?query=rcctl">rcctl(8)</a>
d367 1
a367 1
<a href="http://man.openbsd.org/?query=rcctl">rcctl(8)</a>
d485 1
a485 1
<a href="http://man.openbsd.org/?query=sndio">sndio(7)</a> as:
d498 1
a498 1
<a href="http://man.openbsd.org/?query=hexdump">hexdump(1)</a>
d523 1
a523 1
<a href="http://man.openbsd.org/?query=midiplay">midiplay(1)</a>.
d532 1
a532 1
<a href="http://man.openbsd.org/?query=sndiod">sndiod(8)</a>
d581 1
a581 1
<a href="http://man.openbsd.org/?query=mount_cd9660">mount_cd9660(8)</a>
d604 1
a604 1
<a href="http://man.openbsd.org/?query=dmesg">dmesg(8)</a>.
d628 1
a628 1
<a href="http://man.openbsd.org/?query=MAKEDEV">MAKEDEV(8)</a>
d651 1
a651 1
The <a href="http://man.openbsd.org/?query=time">time(1)</a>
d679 1
a679 1
<a href="http://man.openbsd.org/?query=mkhybrid">mkhybrid(8)</a>
d725 1
a725 1
<a href="http://man.openbsd.org/?query=cdio">cdio(1)</a>
d760 1
a760 1
<a href="http://man.openbsd.org/?query=cdio">cdio(1)</a>
d970 1
a970 1
<a href="http://man.openbsd.org/?query=ehci">ehci(4)</a>
@


1.180
log
@Remove reference to play.seek, as it doesn't exist anymore.
@
text
@a43 3
<a href= "faq12.html">[To Section 12 - Hardware and Platform-Specific
                      Questions]</a>
<a href= "faq14.html">[To Section 14 - Disk Setup]</a>
d57 1
a57 1
<li><a href="#playDVD"    >13.9 - How can I playback video DVDs in OpenBSD?</a>
d64 2
a65 4
<li><a href="#javaplugin" >13.11 - Can I have Java support in my web browser?
                           (amd64 only)</a>
<li><a href="#flashplugin">13.12 - Can I have Flash support in my web
                           browser?</a>
d558 1
a558 1
<h2 id="playDVD">13.9 - How can I playback video DVDs in OpenBSD?</h2>
d980 1
a980 2
<h2 id="javaplugin">13.11 - Can I have Java support in my web browser?
(amd64 only)</h2>
d982 2
a983 1
Just install the <tt>icedtea-web</tt> package.
d993 1
a993 1
<h2 id="flashplugin">13.12 - Can I have Flash support in my web browser?</h2>
a1011 3
<a href= "faq12.html">[To Section 12 - Hardware and Platform-Specific
                      Questions]</a>
<a href= "faq14.html">[To Section 14 - Disk Setup]</a>
@


1.179
log
@new section on recording monitor mixes; from lists at wrant.com

with input from tb ratchov and myself
@
text
@d432 1
a432 2
We also see that the device is keeping enough data buffered
(<tt>play.seek</tt>)
@


1.178
log
@new openbsd faq style. joint with tj and validator.w3.org
@
text
@d55 7
a61 5
<li><a href="#audioserver">13.5 - How do I set up an audio server?</a>
<li><a href="#audioprob"  >13.6 - What can I do if I have audio problems?</a>
<li><a href="#midi"	  >13.7 - How do I use my MIDI instruments?</a>
<li><a href="#playDVD"    >13.8 - How can I playback video DVDs in OpenBSD?</a>
<li><a href="#burnCD"     >13.9 - How do I burn CDs and DVDs?</a>
d63 3
a65 3
  <li><a href="#burnIntro">13.9.1 - Introduction and basic setup</a>
  <li><a href="#writeCD"  >13.9.2 - Writing CDs</a>
  <li><a href="#writeDVD" >13.9.3 - Writing DVDs</a>
d67 1
a67 1
<li><a href="#javaplugin" >13.10 - Can I have Java support in my web browser?
d69 1
a69 1
<li><a href="#flashplugin">13.11 - Can I have Flash support in my web
d273 24
a296 1
<h2 id="audioserver">13.5 - How do I set up an audio server?</h2>
d400 1
a400 1
<h2 id="audioprob">13.6 - What can I do if I have audio problems?</h2>
d457 1
a457 1
<h2 id="midi">13.7 - How do I use my MIDI instruments?</h2>
d564 1
a564 1
<h2 id="playDVD">13.8 - How can I playback video DVDs in OpenBSD?</h2>
d601 1
a601 1
<h2 id="burnCD">13.9 - How do I burn CDs and DVDs?</h2>
d603 1
a603 1
<h3 id="burnIntro">13.9.1 - Introduction and basic setup</h3>
d679 1
a679 1
<h3 id="writeCD">13.9.2 - Writing CDs</h3>
d790 1
a790 1
<h3 id="writeDVD">13.9.3 - Writing DVDs</h3>
d986 1
a986 1
<h2 id="javaplugin">13.10 - Can I have Java support in my web browser?
d999 1
a999 1
<h2 id="flashplugin">13.11 - Can I have Flash support in my web browser?</h2>
d1008 5
a1012 3
<a href="https://github.com/monsieurvideo/get-flash-videos">
get-flash-videos</a>, <a href="http://flavio.tordini.org/minitube">minitube</a>
and <a href="http://rg3.github.com/youtube-dl/">youtube-dl</a>.
@


1.177
log
@add a small sprinkling of css to improve readability in the faq, ok tj@@ tb@@
@
text
@d36 1
d38 4
a41 2
<img alt="[OpenBSD]" height=30 width=141 src="../images/smalltitle.gif" border="0">
</a>
d47 1
a47 2

<h1><font color="#e00000">13 - Multimedia</font></h1><hr>
@


1.176
log
@fix URIs, the / before querystring isn't optional, if it isn't fixed up
by the browser the server returns 400 Bad Request
@
text
@d12 2
@


1.175
log
@Some cleanup after beck@@'s monster man.openbsd.org diff.
@
text
@d73 1
a73 1
<a href="http://man.openbsd.org?query=mixerctl">mixerctl(1)</a>
d148 1
a148 1
<a href="http://man.openbsd.org?query=aucat">aucat(1)</a>,
d182 1
a182 1
<a href="http://man.openbsd.org?query=cdio">cdio(1)</a>
d223 1
a223 1
<a href="http://man.openbsd.org?query=aucat">aucat(1)</a>
d248 1
a248 1
<a href="http://man.openbsd.org?query=mixerctl">mixerctl(1)</a>.
d319 1
a319 1
<a href="http://man.openbsd.org?query=rcctl">rcctl(8)</a>
d343 1
a343 1
<a href="http://man.openbsd.org?query=rcctl">rcctl(8)</a>
d462 1
a462 1
<a href="http://man.openbsd.org?query=sndio">sndio(7)</a> as:
d475 1
a475 1
<a href="http://man.openbsd.org?query=hexdump">hexdump(1)</a>
d500 1
a500 1
<a href="http://man.openbsd.org?query=midiplay">midiplay(1)</a>.
d509 1
a509 1
<a href="http://man.openbsd.org?query=sndiod">sndiod(8)</a>
d558 1
a558 1
<a href="http://man.openbsd.org?query=mount_cd9660">mount_cd9660(8)</a>
d581 1
a581 1
<a href="http://man.openbsd.org?query=dmesg">dmesg(8)</a>.
d605 1
a605 1
<a href="http://man.openbsd.org?query=MAKEDEV">MAKEDEV(8)</a>
d628 1
a628 1
The <a href="http://man.openbsd.org?query=time">time(1)</a>
d656 1
a656 1
<a href="http://man.openbsd.org?query=mkhybrid">mkhybrid(8)</a>
d702 1
a702 1
<a href="http://man.openbsd.org?query=cdio">cdio(1)</a>
d737 1
a737 1
<a href="http://man.openbsd.org?query=cdio">cdio(1)</a>
d947 1
a947 1
<a href="http://man.openbsd.org?query=ehci">ehci(4)</a>
@


1.174
log
@change http://www.openbsd.org/cgi-bin/man.cgi to be http://man.openbsd.org
this points stuff to the new place and gets us ready to deprecate the old
place we did this.
@
text
@d558 2
a559 2
<a href="http://man.openbsd.org?query=mount_cd9660">
mount_cd9660(8)</a> and play the files directly.
@


1.173
log
@fix a few broken links; from peter de wachter
@
text
@d73 1
a73 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mixerctl">mixerctl(1)</a>
d148 1
a148 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=aucat">aucat(1)</a>,
d182 1
a182 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=cdio">cdio(1)</a>
d223 1
a223 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=aucat">aucat(1)</a>
d248 1
a248 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mixerctl">mixerctl(1)</a>.
d319 1
a319 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rcctl">rcctl(8)</a>
d343 1
a343 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rcctl">rcctl(8)</a>
d462 1
a462 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sndio">sndio(7)</a> as:
d475 1
a475 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hexdump">hexdump(1)</a>
d500 1
a500 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=midiplay">midiplay(1)</a>.
d509 1
a509 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sndiod">sndiod(8)</a>
d558 1
a558 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mount_cd9660">
d581 1
a581 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dmesg">dmesg(8)</a>.
d605 1
a605 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=MAKEDEV">MAKEDEV(8)</a>
d628 1
a628 1
The <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=time">time(1)</a>
d656 1
a656 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mkhybrid">mkhybrid(8)</a>
d702 1
a702 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=cdio">cdio(1)</a>
d737 1
a737 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=cdio">cdio(1)</a>
d947 1
a947 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ehci">ehci(4)</a>
@


1.172
log
@Remove unused <p> last commits left.

from tj@@, thanks
@
text
@d549 1
a549 1
Examples are <a href="http://www.dtek.chalmers.se/groups/dvd/">ogle</a>,
d551 2
a552 2
<a href="http://www.xine-project.org/">xine</a>, and
<a href="http://kaffeine.sourceforge.net/">kaffeine</a>.
@


1.171
log
@Update audioctl output to what it outputs nowadays.

ok tj@@
@
text
@a69 1
<p>
@


1.170
log
@Don't mention sound may be distorted because the device doesn't
support certain encodings as this is fixed since years. Remove advices
about manually setting ports/irq/drq of isa cards.

ok tj@@
@
text
@d387 2
a388 3
$ <b>audioctl play.{seek,samples,errors}</b>
play.seek=48000
play.samples=3312000
d390 2
a391 3
$ <b>audioctl play.{seek,samples,errors}</b>
play.seek=57600
play.samples=7065600
d393 2
a394 3
$ <b>audioctl play.{seek,samples,errors}</b>
play.seek=48000
play.samples=9379200
@


1.169
log
@Remove entries about what's sndiod and whether it's needed, as the man
page is easily reachable and now it's enabled by default.

ok tj@@
@
text
@a379 43
If sound is distorted, it could be that your sound card only supports
a single or limited set of sample rates or encodings.
See <a href="#confaudio">section 13.1</a> for examples of determining what
parameters your audio device supports.

<p>
If your device only supports unusual encodings or only one or a few
sample rates and applications you use do not perform the necessary
format conversions, consider using an audio server.
See <a href="#audioserver">section 13.5</a>.

<p>
If you are still experiencing trouble, here are some things to consider:

<ul>
<li>Some old ISA cards have particular quirks:
  <ul>
  <li>Some need to be configured with a different I/O address and IRQ value
  to avoid conflicts with other hardware.
  You can easily try different combinations using the
  <a href="faq5.html#BootConfig">User Kernel Configuration (UKC)</a>.
  <li>It is possible that a less than optimal driver attaches to the sound
  device, and that you can get better results using another driver.
  This is not the easiest thing to spot, but take a closer look at your
  <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dmesg">dmesg(8)</a>
  output, and find the lines where audio drivers attach.
  If you see more than one sound driver attaching (or trying to), test
  them one at a time by disabling some and leaving one enabled using the
  <a href="faq5.html#BootConfig">User Kernel Configuration (UKC)</a>.
  </ul>

<li>Find information about your sound device.
Use the documentation, or use an internet search engine to find its
specifications.
For
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ac97">ac97(4)</a>
and
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=azalia">azalia(4)</a>
devices, look for documentation for both the controller and the codec.
They may actually help you find the source of the problem.
</ul>

<p>
@


1.168
log
@Remove details about different kind of audio files as the information
is easy to find (ex on wikipedia). Don't encourage feeding /dev/audio
directly as this doesn't work as expected.

ok tj@@
@
text
@a223 1
Yes, most devices support recording.
a270 35

<h3>What's the sndiod(8) audio server?</h3>

The
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sndiod">sndiod(8)</a>
daemon is an intermediate layer between audio or MIDI programs and the hardware.
It performs the necessary audio processing to allow any program to work on
any supported hardware.
It exposes at least one sub-device that any number of audio programs can
connect to and use as if it were audio hardware.
During playback, sndiod receives audio data concurrently from all programs,
mixes it and sends the result to the hardware device.
Similarly, during recording it duplicates audio data recorded from the
device and sends it to all programs.

<p>
By default, it accepts connections from programs running on the same
system only.
It initializes only when programs are using its services, thus consuming
a negligible amount of system resources.
Systems with no audio hardware can use sndiod(8) to keep hot-pluggable
devices usable by default at virtually no cost.

<h3>Do I need an audio server?</h3>

If applications you use are compatible with your hardware and you don't plan
to run multiple applications concurrently, then you don't strictly need an
audio server.
sndiod(8) is started by default at boot time.
There is no more reason to disable sndiod(8) on a system with no audio
hardware than there is to disable getty(8) on a headless system.

<p>
Note that sndiod can be bypassed by using <b>rsnd/0</b> as audio device
instead of the default one.
@


1.167
log
@Remove the parts about configuration of the audio device as audio
devices need no configuration except the mixer preferences.

ok tj@@
@
text
@a146 10
<h3>Digitized audio</h3>

<h4>Lossless audio formats (AU, PCM, WAV, FLAC, TTA)</h4>

Some of the lossless audio formats may be played without the need for third
party software, provided they contain the uncompressed digital samples in
chunks of bytes.
These formats include Sun audio (AU), raw PCM files (without headers), and
RIFF WAV.

d150 1
a150 1
a program for recording and playing uncompressed audio.
a156 6
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=aucat">aucat(1)</a>
supports both headerless and WAV audio files with the <tt>-i</tt> option.
aucat also plays Sun audio files where the audio data is encoded
as 8 kHz monaural mulaw, which is the most common encoding for this
type of audio file.

d158 1
a158 14
It is also possible to play uncompressed audio data by passing it
directly to the audio device.
To do this, you need to know its main parameters: encoding
type, number of channels, sample rate, bits per sample.
If you don't know this, you might find out with the
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=file">file(1)</a>
utility:

<blockquote><pre>
$ <b>file music.au</b>
music.au:  Sun/NeXT audio data: 16-bit linear PCM, stereo, 44100 Hz
$ <b>file music.wav</b>
music.wav: Microsoft RIFF, WAVE audio data, 16 bit, stereo 44100 Hz
</pre></blockquote>
a159 77
The only remaining things to know about these example files is that they
use little-endian byte ordering and signed linear quantization.
You could figure this out by reading the header with
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hexdump">hexdump(1)</a>.
If you are using a headerless (raw) file, there is no way to know the
parameters beforehand.
Set the following parameters accordingly using
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=audioctl">audioctl(1)</a>.

<blockquote><pre>
play.encoding=slinear_le
play.rate=44100
play.channels=2
play.precision=16
</pre></blockquote>

Next, pass the audio file to the sound device:

<blockquote><pre>
$ <b>cat music.au > /dev/sound</b>
</pre></blockquote>

If you applied the correct settings, you should be hearing what you expected.

<p>
Note: Always use <tt>/dev/sound</tt>, not <tt>/dev/audio</tt>, if you want
the settings you applied with audioctl to stay in place.

<p>
There are, of course, other utilities you can use to play these files.

<p>
Apart from the above, there are audio formats which use lossless data
compression.
Examples are the Free Lossless Audio Codec (FLAC) and TTA.
The FLAC implementation has been ported to OpenBSD and may be found under
<tt>audio/flac</tt> in packages and ports.

<h4>Audio formats using lossy compression (Ogg Vorbis, MP3, WMA, AAC)</h4>

Lossy compression methods are often used for audio or other media files.
The idea is that an amount of data is thrown away during compression, but
in such a way that the compressed result is still very usable and has a
"good enough" quality to be played.
The advantage is that these techniques enable much higher compression ratios,
resulting in reduced file sizes and bandwidth requirements.

<p>
A good example is the free, open and unpatented
<a href="http://www.vorbis.com/">Ogg Vorbis</a> format.
To play Ogg Vorbis files, you can use the ogg123 utility, which is bundled
in the <tt>audio/vorbis-tools</tt> package.

<blockquote><pre>
$ <b>ogg123 music.ogg</b>

Audio Device:   Sun audio driver output

Playing: music.ogg
Ogg Vorbis stream: 2 channel, 44100 Hz
Time: 00:02.95 [02:21.45] of 02:24.40  (133.1 kbps)  Output Buffer  87.5%
</pre></blockquote>

Of course, Ogg Vorbis plugins exist for many other audio software.

<p>
Another example is the very popular MPEG-1 Audio Layer 3 (MP3) encoding,
which has, however, its share of licensing and patent issues.
Many tools can play MP3 files; just have a look through the <tt>audio</tt>
section of the packages and ports system and pick one you like.

<p>
How about the proprietary Windows Media Audio (WMA) format?
Files of this type can be played using <tt>x11/mplayer</tt> which uses the
<a href="http://ffmpeg.sourceforge.net">FFmpeg</a> framework.

<p>
a162 35

<h3>Synthesized sound</h3>

<h4>MIDI</h4>

The Musical Instrument Digital Interface (MIDI) protocol, is handled
by <a href="#midi">MIDI devices</a>.
If you don't have a MIDI synthesizer, but you wish to play a standard
MIDI file (SMF), you can use software to render MIDI data, generating
audio files.
By default, the <tt>audio/timidity</tt> port renders MIDI files and play
them on the audio device:

<blockquote><pre>
$ <b>timidity file.mid</b>
</pre></blockquote>

<h4>MOD</h4>

A Soundtracker module is a binary format that mixes audio samples
with sequencing orders, making it possible to play rather long pieces
of digital music with reasonably good quality.

<p>
The easiest way to play your favorite MOD files on OpenBSD is probably to
use a player from packages and ports that supports it.

<p>
You will also find a number of so-called "trackers" in the <tt>audio</tt>
section of the packages and ports collection, e.g. tracker, soundtracker.
With these trackers you can not only play but also generate your own modules.
Note, however, that not every tracker format is supported by the tools in
the ports tree.
You are always welcome to <a href="ports/index.html">submit a port</a>
of your favorite tracker software.
@


1.166
log
@re-add link to get-flash-videos, using their newer github page.
@
text
@a69 6
The devices in OpenBSD that are related to audio are: <tt>/dev/audio</tt>,
<tt>/dev/sound</tt>, <tt>/dev/audioctl</tt> and <tt>/dev/mixer</tt>.
For a good overview of the audio driver layer, please read the
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=audio">audio(4)</a>
man page.

a72 74
To find out about options for your specific sound chip, you must find out
which sound chip you have.
Supported chips may be found on the hardware compatibility page for your
<a href="../plat.html">platform</a>.
When you already have OpenBSD running, look for a sound driver in the output
of the
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dmesg">dmesg(8)</a>
command, and read its man page to find more specific information like options
and other details about the driver.
An example of an audio chip in a dmesg output is:

<blockquote><pre>
auich0 at pci0 dev 31 function 5 "Intel 82801BA AC97" rev 0x04: irq 10, ICH2 AC97
ac97: codec id 0x41445360 (Analog Devices AD1885)
ac97: codec features headphone, Analog Devices Phat Stereo
audio0 at auich0
</pre></blockquote>

OpenBSD provides two tools for monitoring and configuring audio devices.
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=audioctl">audioctl(1)</a>
is used for the audio processing parameters, such as encoding, sample rate
and number of channels, while
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mixerctl">mixerctl(1)</a>
is used for the mixing parameters such as channel source, gain level and mute.

<p>
The following command uses
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=audioctl">audioctl(1)</a>
to display the default processing parameters of an audio device:

<blockquote><pre>
$ <b>audioctl -f /dev/audio</b>
</pre></blockquote>

Note that <tt>-f /dev/audio</tt> was used explicitly.
Opening <tt>/dev/audio</tt> causes the audio device to reset to the default
parameters, which is what we wanted to see.

<p>
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=audioctl">audioctl(1)</a>
is also quite useful for exploring the capabilities of an audio device.
For example, to see if the device supports some common sample rates, you
could simply try setting the playback rate:

<blockquote><pre>
$ <b>audioctl play.rate=48000</b>
play.rate: -> 48000
$ <b>audioctl play.rate=44100</b>
play.rate: -> 44100
$ <b>audioctl play.rate=22050</b>
audioctl: set failed: Invalid argument
$ <b>audioctl play.rate=8000</b>
audioctl: set failed: Invalid argument
</pre></blockquote>

This device supports 48000 and 44100 Hz playback rates, but not 22050 or 8000.
Note that if a sample rate is not supported, there is not always an error
message, but the returned sample rate is not the one that was desired.

<blockquote><pre>
$ <b>audioctl play.rate=48000</b>
play.rate: -> 48000
$ <b>audioctl play.rate=44100</b>
play.rate: -> 48000
$ <b>audioctl play.rate=22050</b>
play.rate: -> 48000
$ <b>audioctl play.rate=8000</b>
play.rate: -> 48000
</pre></blockquote>

This device supports 48000 Hz playback only.

<p>
Audio hardware is usually capable of at least some minimal mixing.
a91 2
<li><tt>inputs.dac</tt> controls the level from the DAC (digital to
analog converter), used when playing an audio file
d94 1
a94 1
<li><tt>record.volume</tt> or <tt>record.record</tt> controls the input
a98 2
For instance, there might not be an <tt>outputs.master</tt> as above,
but there is an <tt>outputs.outputs</tt> which does the same thing.
d121 1
a121 1
The reason for this is that this audio device has an AC'97 codec, which uses
@


1.165
log
@- remove section 13.8  "tell me about ogg vorbis and mp3 encoding"
- remove section 13.11 "but i want my media in format foo"
- remove section 13.12 "is it possible to play streaming media under openbsd"
- remove mention of a program whose homepage 404s now
- zap 20 or so whitespaces

ok tb
@
text
@d1287 3
a1289 2
<a href="http://flavio.tordini.org/minitube">minitube</a> and
<a href="http://rg3.github.com/youtube-dl/">youtube-dl</a>.
@


1.164
log
@- remove section 1.9 "what's new in 5.8" (just read the release page)
- remove section 2.1 "web pages of interest"
- amd 64 -> amd64
- mail list -> mailing list
- clean up table of contents
- remove "back" button on index (browsers can do this by themselves now)

ok tb
@
text
@d54 2
a55 3
<li><a href="#lossyaudio" >13.8 - Tell me about Ogg Vorbis and MP3 encoding</a>
<li><a href="#playDVD"    >13.9 - How can I playback video DVDs in OpenBSD?</a>
<li><a href="#burnCD"     >13.10 - How do I burn CDs and DVDs?</a>
d57 3
a59 3
  <li><a href="#burnIntro">13.10.1 - Introduction and basic setup</a>
  <li><a href="#writeCD"  >13.10.2 - Writing CDs</a>
  <li><a href="#writeDVD" >13.10.3 - Writing DVDs</a>
d61 1
a61 4
<li><a href="#convert"    >13.11 - But I want my media files in format FOO</a>
<li><a href="#streaming"  >13.12 - Is it possible to play streaming media under
                           OpenBSD?</a>
<li><a href="#javaplugin" >13.13 - Can I have Java support in my web browser?
d63 1
a63 1
<li><a href="#flashplugin">13.14 - Can I have Flash support in my web
d770 1
a770 2
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sndio">sndio(7)</a>
as:
d843 1
a843 47
<h2 id="lossyaudio">13.8 - Tell me about Ogg Vorbis and MP3 encoding</h2>

These formats were already mentioned <a href="#playaudio">above</a>.
In this section, we will give a brief introduction about encoding such files.
If you are interested in learning how these audio compression codecs work,
Wikipedia has articles on
<a href="https://en.wikipedia.org/wiki/Vorbis">Vorbis</a>,
<a href="https://en.wikipedia.org/wiki/MP3">MP3</a> and many others.

<h3>Ogg Vorbis</h3>

Encoding raw, WAV or AIFF format audio to <a href="http://www.vorbis.com/">
Ogg Vorbis</a> may be done with the <b>oggenc</b> utility, contained in the
<tt>audio/vorbis-tools</tt> package, which is available through OpenBSD's
packages and ports system.

<p>
Say you have a number of WAV files ready to encode.
To encode all these files using an approximate bit rate of 192 kbps, you
could issue a command like

<blockquote><pre>
$ <b>oggenc *.wav -b 192</b>
</pre></blockquote>

When finished, this will give you a set of .ogg files in the current directory.
More extensive examples, as well as encoding options, can be found in the
oggenc manual page.

<h3>MPEG-1 Audio Layer 3 (MP3)</h3>

If you want to use the MP3 format, you can use
<a href="http://lame.sourceforge.net/">LAME</a>,
an educational tool to be used for learning about MP3 encoding.
Lame is included in the OpenBSD ports tree.

<p>
Below is a simple example of encoding a WAV file with a bit rate of 192 kbps:

<blockquote><pre>
$ <b>lame -b 192 track01.wav track01.mp3</b>
</pre></blockquote>

For all options and details, please consult the manual page that comes with
lame.

<h2 id="playDVD">13.9 - How can I playback video DVDs in OpenBSD?</h2>
d880 1
a880 1
<h2 id="burnCD">13.10 - How do I burn CDs and DVDs?</h2>
d882 1
a882 1
<h3 id="burnIntro">13.10.1 - Introduction and basic setup</h3>
d958 1
a958 1
<h3 id="writeCD">13.10.2 - Writing CDs</h3>
d1069 1
a1069 1
<h3 id="writeDVD">13.10.3 - Writing DVDs</h3>
d1265 1
a1265 125
<h2 id="convert">13.11 - But I want my media files in format FOO</h2>

<h3>Converting between different audio formats</h3>

Let's say we want to process the sound recording from
<a href="#recordaudio">FAQ 13 - Audio Recording</a>.
This recording has been stored in the raw format.
It will be useful to convert it, because the raw format does not include
headers and the recording parameters will need to be specified at every
usage of the file.

<p>
One sound conversion tool is <tt>audio/sox</tt>, available through
packages and ports.
<b>sox</b> supports AIFF, AU, MP3, Ogg Vorbis, RIFF WAV and raw formats,
as well as some of the more exotic audio formats out there.
Below is an example for converting the recording to RIFF WAV format.

<blockquote><pre>
$ <b>sox -U -c 1 -r 8000 -b myvoice.raw myvoice.wav</b>
</pre></blockquote>

Note that the specified parameters correspond to the recording parameters
specified before the recording.
This was just an example.
More audio-related libraries and software can be used for audio conversion.

<p>
<b>Note:</b>
It is not recommended to convert between different lossy compression formats.
For instance, the MP3 and Vorbis codecs throw away different parts of an
original audio waveform.
Therefore, when converting a MP3 file to Ogg Vorbis, the end result will
sound worse than the original MP3.

<h3>Converting between different video formats</h3>

It's important to make a clear distinction between

<ul>
<li>the container file format - popular examples are MP4, OGG, MPEG, MOV,
AVI, ASF, MKV, etc.
<li>the video codec - for example MPEG-1, MPEG-2, MPEG-4 compliant codecs
(like Xvid and DivX), FFmpeg, H.264, etc.
</ul>

<p>
Two popular utilities are <tt>multimedia/transcode</tt> and
<b>mencoder</b> (part of <tt>x11/mplayer</tt>).
They use or can use the <b>libavcodec</b> library as part of the
<tt>graphics/ffmpeg</tt> port, which generates good quality output.
You can, of course, also use <b>ffmpeg</b> directly.
It should also be possible to use the XviD encoder in
<tt>multimedia/xvidcore</tt>.

<p>
The documentation that comes with these packages, under the form of manual
pages or HTML documents in <tt>/usr/local/share/doc</tt>, contains many
examples, so it is HIGHLY recommended to read those documents.

<h2 id="streaming">13.12 - Is it possible to play streaming media under
OpenBSD?</h2>

Yes, it is.
Many audio and video streams will work just fine, on a limited number of
platforms.
A few of them will not.

<p>
This is not meant to be a complete, overly detailed answer to have every
possible streaming format work on any hardware architecture.
You may want to learn more about streaming media to start with.

<p>
The first thing to understand is that there are a number of different
streaming protocols around.
The streaming <b>protocol</b> defines how the streams will be sent over the
network.
They have been developed to allow efficient transmission of audio/video
over the internet in real-time.
Mostly, the streaming protocol is a (Layer 7) application protocol, which
can use either UDP or TCP (Layer 4) transport protocols.
The User Datagram Protocol (UDP) is very suited for this type of
application since it doesn't do any retransmission of packets or other
overhead.
A number of specialized but proprietary protocols have been developed, e.g.
Microsoft Media Services (MMS) and the Real Time Streaming Protocol (RTSP).
As we will see, HTTP (which uses TCP) is sometimes used as well, even
though it does not allow serving streams at a steady bitrate like UDP,
RTSP and MMS.

<p>
Next, there is the streaming <b>format</b>, which is how the audio/video
data has been organized and can be played.
The most widely used streaming formats are MP3, Real Audio (RA, RM) and
Windows Media (ASF), all proprietary technologies.
Occasionally you will also encounter streams in the open Ogg Vorbis format.

<ul>
<li>Determine the streaming protocol and format.<br>
This is usually indicated on the website where you access the stream.
<li>Figure out the precise URL.<br>
Many websites link to a container metafile or playlist (such as M3U, ASX, RAM),
which contains the actual location of the stream.
Just save the file, and read the URL from it.
Other websites may contain some JavaScript code to generate the URL.
In that case, the best tip is: dig up the HTML source and scripts it refers to.
There is a good chance you can reconstruct the URL from it.

<li>To play streams, your best bet is probably <tt>x11/mplayer</tt>,
which is available through packages and ports.
It supports most of the streaming protocols and formats, and has been
reported to work on amd64, i386, powerpc and sparc64 platforms.
But there are alternatives:
<b>ogg123</b> from <tt>audio/vorbis-tools</tt> (for Ogg Vorbis streams),
<tt>audio/mpg123</tt> and <tt>audio/mpg321</tt> (for MP3 streams),
XMMS in <tt>audio/xmms</tt> and the Videolan Client in <tt>x11/vlc</tt>.
</ul>

Windows Media (ASF) streams will often work, though they may contain data
in formats supported only through the <tt>graphics/win32-codecs</tt> port,
which runs on i386 only ('pkg_info win32-codecs' will tell you which
codecs).

<h2 id="javaplugin">13.13 - Can I have Java support in my web browser?
d1274 3
a1276 3
Note that due to the security issues with Java applets on the web,
most browsers disable Java support by default, you will be prompted for
your explicit consent to run applets via icedtea-web.
d1278 1
a1278 1
<h2 id="flashplugin">13.14 - Can I have Flash support in my web browser?</h2>
d1286 3
a1288 5
there are a number of options in packages, including:
<a href="http://code.google.com/p/get-flash-videos/">get_flash_videos</a>,
<a href="http://flavio.tordini.org/minitube">minitube</a>,
<a href="http://rg3.github.com/youtube-dl/">youtube-dl</a>,
get_iplayer and yt.
d1294 2
a1295 1
<a href= "faq12.html">[To Section 12 - Hardware and Platform-Specific Questions]</a>
@


1.163
log
@new sentence, new line. many formatting improvements and zapped whitespaces.
remove a couple dead links. mention rcctl as an alternative to rc.conf.local.

ok tb
@
text
@d4 5
@


1.162
log
@unify table of contents with actual page titles, fixing a few broken links
in the process. few minor tweaks while here.

ok tb
@
text
@d30 1
a30 1
<img alt="[OpenBSD]" height=30 width=141 src="../images/smalltitle.gif" border="0">    
d34 2
a35 1
<a href= "faq12.html">[To Section 12 - Hardware and Platform-Specific Questions]</a>
d46 1
a46 1
<li><a href="#audioserver">13.5 - How do I setup an audio server?</a>
d59 3
a61 3
  OpenBSD?</a>
<li><a href="#javaplugin" >13.13 - Can I have Java support in my web
  browser? (amd64 only)</a>
d63 1
a63 5
  browser?</a>
<!--
<li><a href="#camera"     >13.xx - Can I use my digital camera under OpenBSD?</a>
<li><a href="#scanner"    >13.yy - How do I set up and use my scanner?</a>
-->
d72 2
a73 2
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=audio&amp;sektion=4">audio(4)</a>
manual page.
d76 1
a76 1
All supported audio drivers are already included in the GENERIC kernel so
d79 3
a81 2
which sound chip you have. Supported chips may be found on the hardware
compatibility page for your <a href="../plat.html">platform</a>.
d83 4
a86 4
of the 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dmesg&amp;sektion=8">dmesg(8)</a>
command, and read its manual page to find more specific information like
options and other details about the driver.
d96 6
a101 8
<p>
OpenBSD base provides two tools for monitoring and configuring audio devices.
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=audioctl&amp;sektion=1">audioctl(1)</a>
is used for the audio processing parameters, such as encoding,
sample rate and number of channels, while
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mixerctl&amp;sektion=1">mixerctl(1)</a>
is used for the mixing parameters, such as channel source,
gain level and mute.
d105 2
a106 2
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=audioctl&amp;sektion=1">audioctl(1)</a>
to display the default processing parameters of an audio device.
d109 1
a109 2
$ <strong>audioctl -f /dev/audio</strong>
...
d117 1
a117 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=audioctl&amp;sektion=1">audioctl(1)</a>
d123 1
a123 1
$ <strong>audioctl play.rate=48000</strong>
d125 1
a125 1
$ <strong>audioctl play.rate=44100</strong>
d127 1
a127 1
$ <strong>audioctl play.rate=22050</strong>
d129 1
a129 1
$ <strong>audioctl play.rate=8000</strong>
a130 1
$
d133 3
a135 4
This device supports 48000 and 44100 Hz playback rates, but not
22050 or 8000.
Note that if a sample rate is not supported, there is not always an
error message, but the returned sample rate is not the one that was desired.
d138 1
a138 1
$ <strong>audioctl play.rate=48000</strong>
d140 1
a140 1
$ <strong>audioctl play.rate=44100</strong>
d142 1
a142 1
$ <strong>audioctl play.rate=22050</strong>
d144 1
a144 1
$ <strong>audioctl play.rate=8000</strong>
a145 1
$
d153 1
a153 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mixerctl&amp;sektion=1">mixerctl(1)</a>
d157 1
a157 2
$ <strong>mixerctl</strong>
...
d161 4
a164 4
Note that not every option of every audio chip necessarily reaches the outside
world.
So there may be, for example, more outputs listed than are physically
available on a sound card or motherboard.
d186 2
a187 2
Some devices use what is known as EAPD, which stands for external
amplifier power down.
d189 2
a190 3
It is probably refered to as "power down" because it is often used
for power saving, which means this type of control is more often found
in laptops.
d195 2
a196 2
As a basic example of common mixerctl usage, to set the volume of the
left and right channels to 200, you would issue
d199 2
a200 2
$ <strong>mixerctl outputs.master=200,200</strong>
outputs.master: 255,255 -&gt; 207,207
d209 1
a209 1
To unmute the master channel, you would do
d212 2
a213 2
$ <strong>mixerctl outputs.master.mute=off</strong>
outputs.master.mute: on -&gt; off
d216 3
a218 3
<p>
To make the changes take effect on each reboot, edit <i>/etc/mixerctl.conf</i>,
for example:
d221 1
a221 1
$ <strong>cat /etc/mixerctl.conf</strong>
d237 2
a238 2
These formats include Sun audio (AU), raw PCM files (without
headers), and RIFF WAV.
d242 1
a242 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=aucat&amp;sektion=1">aucat(1)</a>,
d247 1
a247 1
$ <strong>aucat -i filename.wav</strong>
d250 2
a251 2
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=aucat&amp;sektion=1">aucat(1)</a>
supports both headerless and WAV audio files with the -i option.
d262 1
a262 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=file&amp;sektion=1">file(1)</a>
d266 1
a266 1
$ <strong>file music.au</strong>
d268 1
a268 4
</pre></blockquote>

<blockquote><pre>
$ <strong>file music.wav</strong>
d275 1
a275 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hexdump&amp;sektion=1">hexdump(1)</a>.
d279 1
a279 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=audioctl&amp;sektion=1">audioctl(1)</a>.
d291 1
a291 1
$ <strong>cat music.au > /dev/sound</strong>
d298 1
a298 1
the settings you applied with audioctl to stay in place. 
a301 2
Such as XMMS which is available in packages and ports and can play
numerous other audio formats.
d315 1
a315 1
good enough quality to be played.
d317 1
a317 1
resulting in reduced disk space and bandwidth requirements.
d323 1
a323 1
in the <tt>audio/vorbis-tools</tt> package. For example:
d326 1
a326 1
$ <strong>ogg123 music.ogg</strong>
d340 1
a340 1
Many tools can play MP3 files, just have a look through the <tt>audio</tt>
d344 2
a345 2
How about the proprietary Windows Media Audio (WMA) format? Files of this
type can be played using <tt>x11/mplayer</tt> which uses the
d366 1
a366 1
$ <strong>timidity file.mid</strong>
d377 1
a377 4
use the XMMS software, available through packages and ports.
You should install the <tt>-mikmod</tt> subpackage for XMMS to let it use
the MikMod sound library, which supports the MOD, S3M, IT and XM module
formats.
d382 1
a382 2
With these trackers you can not only play but also generate your own
modules.
d397 1
d400 3
a402 4
<li>Connect the audio output at the back side of the drive to your audio
card.
Yes, this is a supplementary cable next to the data (SATA/IDE/SCSI)
and power cables.
d407 4
a410 3
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=cdio&amp;sektion=1">cdio(1)</a>,
has been included in the base system. Called without parameters, it will
enter interactive mode. If you want to play the CD right away, just enter
d413 1
a413 1
$ <strong>cdio play</strong>
a415 1
<p>
d420 1
a420 1
for convenience you may want to add the user to the operator group by
d430 1
a430 1
$ <strong>mixerctl inputs.cd.mute=off</strong>
d435 1
a435 1
In this case you could use <tt>cdio</tt>'s <tt>cdplay</tt> command
d439 1
a439 1
$ <strong>cdio cdplay</strong>
a441 1
<p>
d448 2
a449 4
Yes.
Most devices support recording.

<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=aucat&amp;sektion=1">aucat(1)</a>
d453 1
a453 1
$ <strong>aucat -o file.wav</strong>
d463 1
a463 1
Use aucat to play the file back:
d466 1
a466 1
$ <strong>aucat -i file.wav</strong>
a468 1
<p>
d474 1
a474 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mixerctl&amp;sektion=1">mixerctl(1)</a>.
d493 1
a493 1
<h2 id="audioserver">13.5 - How do I setup an audio server?</h2>
a498 1
<p>
d501 7
a507 8
daemon is an intermediate layer between audio or MIDI
programs and the hardware.
It performs the necessary audio processing to allow any program to
work on any supported hardware.
It exposes at least one sub-device that any number of audio programs
can connect to and use as if it were audio hardware.
During playback, sndiod receives audio data concurrently from all
programs, mixes it and sends the result to the hardware device.
d513 4
a516 3
system only; it initializes only when programs are using its services,
thus, consuming a negligible amount of system resources.
Systems with no audio hardware can use sndiod to keep hot-pluggable
d521 6
a526 7
<p>
If applications you use are compatible with your hardware and you
don't plan to run multiple applications concurrently, then you don't strictly
need an audio server.
Since OpenBSD 5.1, sndiod(8) is started by default at boot time.
There is no more reason to disable sndiod(8) on a system with no
audio hardware than there is to disable getty(8) on a headless system.
d541 1
a541 3

<li>
Real-time synthesizers: 5ms.
d547 7
a553 11
<li>
Games: 50ms.
This is the time between when you see an event and you hear the
corresponding sound.

<li>
Movie players and alike: 500ms and more.
Such applications ``know'' the sound to play in advance, and send
audio data in such a way that it is played simultaneously with the
corresponding picture.

d556 3
a558 3
The smaller audio buffers are (to achieve low latency), the larger
the probability to overrun/underrun is.
Buffer overruns/underruns result in ``stuttering'' of the sound.
d565 1
a565 1
``-b'' option to select the desired latency (expressed in number of
a566 1

d575 3
a577 3
<pre>
<strong>sndiod_flags="-b2400"</strong>
</pre>
d579 3
a581 1
to <tt>/etc/rc.conf.local</tt>.
d585 3
a587 3
No. Synchronizing audio to video doesn't require low latency.
Synchronization problems are often caused by the software itself
(poor implementation, bugs,&nbsp;...).
d589 1
a589 1
in low latency mode) may hide the actual problem in some cases and
d595 1
a595 1
sndiod(8) can be configured to accept connections from the network
a596 1

d599 3
a601 5
<pre>
<strong>sndiod_flags="-L-"</strong>
</pre>

to <tt>/etc/rc.conf.local</tt>.
d603 3
d608 3
a610 3
<pre>
<strong>snd@@hostname/0</strong>
</pre>
d612 2
a613 2
where ``hostname'' is the address of the remote system.
The AUDIODEVICE environment variable could be set to the above value
d618 2
a619 2
host, will be able to use the audio device.
For privacy reasons only one user from one system may have connections
d627 4
a630 5
To avoid glitches, TCP traffic on port 11025 could be
<!-- a href="pf/queueing.html">prioritized</a> -->prioritized
with the packet filter.
With the default configuration sndiod will consume around 200kB/s of
network bandwidth. 
a633 1
<p>
d636 1
a636 3
See section
<a href="#confaudio">13.1 - How do I configure my audio device</a>
for configuring the mixer.
d642 2
a643 3
See section
<a href="#confaudio">13.1 - How do I configure my audio device</a>
for examples of determining what parameters your audio device supports.
d649 1
a649 2
See section
<a href="#audioserver">13.5 - How do I setup an audio server?</a>
d653 1
d655 1
a655 2
<li>
Some old ISA cards have particular quirks:
d657 2
a658 2
  <li>Some need to be configured with a different
  I/O address and IRQ value to avoid conflicts with other hardware.
d664 1
a664 1
  <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dmesg&amp;sektion=8">dmesg(8)</a>
d670 2
a671 2
<li>
Find information about your sound device.
d675 1
a675 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ac97&amp;sektion=4">ac97(4)</a>
d677 2
a678 3
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=azalia&amp;sektion=4">azalia(4)</a>
devices, look for documentation for
both the controller and the codec.
d688 1
a688 1
$ <strong>cat > /dev/audio < /dev/zero &</strong>
d690 1
a690 1
$ <strong>audioctl play.{seek,samples,errors}</strong>
d694 1
a694 1
$ <strong>audioctl play.{seek,samples,errors}</strong>
d698 1
a698 1
$ <strong>audioctl play.{seek,samples,errors}</strong>
d702 2
a703 2
$ <strong>kill %1</strong>
$ <strong>fg %1</strong>
d728 1
a728 2
If at this point you are still having problems, it's probably
time to
d740 2
a741 5
A MIDI data contain only instructions needed by a synthesizer to play
the sounds, rather than the sounds.
More information:
<a href="http://www.harmony-central.com/MIDI/Doc/tutorial.html">Tutorial
on MIDI and Music Synthesis</a>.
d747 3
a749 2
machine is required. Similarly, to record a MIDI data a MIDI
instrument is required (eg. a MIDI keyboard).
d759 1
a759 2
An example of MIDI ports in a dmesg
output is:
d773 1
a773 1
<li> <tt>rmidi/0</tt> - synthesizer connected by USB
d779 2
a780 1
The latter are handy for testing the hardware, bypassing most software layers.
d783 1
a783 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hexdump&amp;sektion=1">hexdump(1)</a>
d787 1
a787 1
$ <strong>hexdump -e '1/1 "%02x\n"' &lt; /dev/rmidi0</strong>
d798 1
a798 1
$ <strong>cat -u &lt; /dev/rmidi0 &gt; /dev/rmidi1</strong>
d808 1
a808 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=midiplay&amp;sektion=1">midiplay(1)</a>.
d813 1
a813 1
$ <strong>midiplay -f rmidi/0 file.mid</strong>
a815 1
<p>
d821 1
a821 1
start a software one (like the audio/fluidsynth port), and then use
d825 1
a825 1
$ <strong>midiplay -f midithru/0 file.mid</strong>
a827 1
<p>
d829 2
a830 1
the <tt>audio/midish</tt> port, for instance:
d833 1
a833 1
$ <strong>smfrec -d rmidi/0 -i rmidi/1 file.mid</strong>
d840 1
a840 1
transforming MIDI data, can be achieved using the <tt>rmidish</tt>
d845 2
a846 3
These formats were already mentioned in
<a href="#playaudio">Playing different kinds of audio</a>.
In this section we will give a brief introduction about encoding such files.
d848 3
a850 3
further reading may be found through these Wikipedia articles about
<a href="http://en.wikipedia.org/wiki/Vorbis">Vorbis</a> and
<a href="http://en.wikipedia.org/wiki/MP3">MP3</a>.
d854 4
a857 4
Encoding raw, WAV or AIFF format audio to
<a href="http://www.vorbis.com/">Ogg Vorbis</a> may be done with the
<b>oggenc</b> utility, contained in the <tt>audio/vorbis-tools</tt> package,
which is available through OpenBSD's packages and ports system.
d860 1
a860 2
Say you have a number of WAV files ready to encode, for example your
favorite album you just extracted from its CD.
d863 1
d865 1
a865 1
$ <strong>oggenc *.wav -b 192</strong>
d874 2
a875 2
If for some reason you want to use the MP3 format, you can use
<a href="http://lame.sourceforge.net/">"Lame ain't an MP3 encoder" (LAME)</a>,
a877 2
Note that due to MP3 patents, you will not find this package on the
<a href="../orders.html">official CD sets</a>.
d881 1
d883 1
a883 1
$ <strong>lame -b 192 track01.wav track01.mp3</strong>
d891 2
a892 2
OpenBSD supports DVD media through the ISO 9660 filesystem which
is also used on CD-ROMs, and, since OpenBSD 3.8, also through the newer
a900 5
As most computers with DVD-ROM drives use software decoding, it is
recommended to have at least a 350-MHz Pentium II or equivalent CPU to have
good quality playback.

<p>
d909 1
a909 1
With these utilities, it is possible to playback the DVD by directly
d911 3
a913 3
Of course, it is also possible to mount a DVD first using
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mount_cd9660&amp;sektion=8">mount_cd9660(8)</a>,
and play the files on this or any other mounted filesystem.
d920 1
a920 1
To be able to playback these encrypted DVDs, you can use the
d932 6
a937 5
Most SCSI devices are supported. SATA, IDE/ATAPI and USB devices are supported
through SCSI emulation. You will quickly find your device in a
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dmesg&amp;sektion=8">dmesg(8)</a>
output.
Just look for lines beginning with "cd", for example
d946 2
a947 2
Yes. OpenBSD uses a different device namespace than the OS for which the
cdrecord utility was written.
d951 2
a952 1
<h4>Error: <tt>mount_cd9660: /dev/cd2c on /mnt/cdrom: No such file or directory</tt></h4>
d959 2
a960 2
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=MAKEDEV&amp;sektion=8">MAKEDEV(8)</a>
(select your specific platform) script:
d963 2
a964 2
# <strong>cd /dev</strong>
# <strong>./MAKEDEV cd2</strong>
d973 1
a973 1
In this example, I'll be using this USB 2.0 DVD writer:
d982 2
a983 3
The
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=time&amp;sektion=1">time(1)</a>
command will be your willing assistant.
d994 5
a998 4
<li>Do not run any disk-intensive jobs while writing a CD/DVD. Doing this
will reduce the throughput to your CD/DVD writer. If the throughput drops
below what the writer is expecting for too long, its buffer will run empty.
This phenomenon is also known as a "buffer underrun".
d1010 1
a1010 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mkhybrid&amp;sektion=8">mkhybrid(8)</a>
d1012 3
a1014 4
cdrtools <a href="faq15.html#PkgMgmt">package</a> and which does a better
job with large file trees.
In the examples below, we will use mkhybrid, although mkisofs usage is
very similar.
d1017 2
a1018 2
As an example usage, let's say I wanted to store the OpenBSD kernel sources
in an ISO 9660 image:
d1021 1
a1021 1
$ <strong>mkhybrid -R -o sys.iso /usr/src/sys</strong>
a1038 1
<p>
d1056 1
a1056 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=cdio&amp;sektion=1">cdio(1)</a>
d1064 1
a1064 1
# <strong>cdio -f cd1c blank</strong>
d1067 3
a1069 2
You are now ready to burn the image created in the above
example to a blank CD-R(W). You could use a command similar to:
d1072 1
a1072 1
# <strong>cdio -f cd1c tao sys.iso</strong>
d1085 1
a1085 1
# <strong>mount /dev/cd1c /mnt/cdrom</strong>
a1087 1

d1091 2
a1092 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=cdio&amp;sektion=1">cdio(1)</a> with the <tt>tao -a</tt> option.
d1095 1
a1095 1
As an example, I'll be making a backup copy of one of my music CDs.
d1100 1
a1100 1
For example:
d1102 1
a1102 1
# <strong>cdio -f cd1c cdrip</strong>
d1104 1
d1107 1
d1109 1
a1109 1
For example:
d1111 1
a1111 1
# <strong>cdio -f cd1c tao -a *.wav</strong>
d1123 1
a1123 1
<li>If you really want to know all about DVD, I suggest you read the very
d1135 3
a1137 3
There are a number of different DVD formats. Commonly used are the DVD-R,
DVD-RW, DVD+R, and DVD+RW formats (R means writable once, RW means it can
be rewritten a few thousand times).
d1143 3
a1145 3
used like a kind of optical hard disk. DVD-RAM is not recommended for
video usage as video gets written to the discs in a format not compatible
with normal DVD players.
d1148 1
a1148 1
The important thing is you use media which suit your DVD writer.
d1157 2
a1158 1
speed indications. The following table gives an overview:
a1192 5
Especially the older USB 1.0 and 1.1 interfaces work at slower transfer
rates, with maximal rates of 1.5 Mbit/s and 12 Mbit/s, respectively.
That means USB 1.0 has a maximal throughput of 178.8 kByte/s and
USB 1.1 has a maximal throughput of 1.43 MB/s.
USB 2.0 is much faster: 480 Mbit/s or 57.2 MB/s.
d1197 3
a1199 3
Basically, the process is very similar to writing CD-R(W)s. The software
used, however, is different.
At the moment, the best option is <b>growisofs</b> from the
d1205 2
a1206 32
In case you want to find out more info about the media in your DVD writer
(for example if you lost the info label in the jewel case or are just
disorganized like me), you can use the <b>dvd+rw-mediainfo</b> utility.

<!--blockquote><pre>
$ <strong>dvd+rw-mediainfo /dev/rcd2c</strong>
INQUIRY:                [LITE-ON ][DVDRW LDW-851S  ][GS0C]
GET [CURRENT] CONFIGURATION:
 Mounted Media:         1Ah, DVD+RW
 Current Write Speed:   4.0x1385=5540KB/s
 Write Speed #0:        4.0x1385=5540KB/s
 Write Speed #1:        2.4x1385=3324KB/s
GET [CURRENT] PERFORMANCE:
 Write Performance:     4.0x1385=5540KB/s@@[0 -> 0]
 Speed Descriptor#0:    00/0 R@@2.4x1385=3324KB/s W@@4.0x1385=5540KB/s
 Speed Descriptor#1:    00/0 R@@2.4x1385=3324KB/s W@@2.4x1385=3324KB/s
READ DVD STRUCTURE[#0h]:
 Media Book Type:       92h, DVD+RW book [revision 2]
 Media ID:              SONY/S11
 Legacy lead-out at:    2295104*2KB=4700372992
READ DISC INFORMATION:
 Disc status:           blank
 Number of Sessions:    1
 State of Last Session: empty
 Number of Tracks:      1
READ TRACK INFORMATION[#1]:
 Track State:           blank
 Track Start Address:   0*2KB
 Free Blocks:           2295104*2KB
 Track Size:            2295104*2KB
READ CAPACITY:          1*2048=2048
</pre></blockquote-->
d1209 1
d1212 1
a1212 1
disk; then write this image to the DVD.
d1223 1
a1223 1
$ <strong>mkhybrid -r -o cvs.iso /cvs</strong>
d1226 2
a1227 2
If desired, check the ISO 9660 filesystem by
<a href="faq14.html#MountImage">mounting the image</a>.
d1231 1
a1231 1
# <strong>growisofs -dvd-compat -Z /dev/rcd2c=cvs.iso</strong>
d1248 1
a1248 1
device, which in this case is my DVD writer, attached to cd2.
d1254 2
a1255 1
<p>Notice how growisofs indicates the writing speed, in this case 3.9x
d1261 2
a1262 2
DVD, you can write your data directly to the DVD. Let's first do a dry
run, which simulates the creation of the filesystem.
d1265 1
a1265 1
# <strong>growisofs -dry-run -Z /dev/rcd2c -R /cvs</strong>
a1270 4
<blockquote><pre>
# <strong>growisofs -Z /dev/rcd2c -R /cvs</strong>
</pre></blockquote>

d1272 2
a1273 2
It is also possible to append data to an existing DVD, by using the -M
option, which merges a new session to an existing one:
d1276 1
a1276 1
# <strong>growisofs -M /dev/rcd2c -R /mydata</strong>
d1279 1
a1279 1
For more information about growisofs, refer to the manual page.
d1282 2
a1283 2
When you have finished writing the DVD, mount it and see whether everything
you expected to be there, is indeed there.
d1301 1
a1301 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ehci&amp;sektion=4">ehci(4)</a>
d1308 1
a1308 1
The DVD writer falls back to a lower pace than the maximum, to reduce the
d1330 1
a1330 1
$ <strong>sox -U -c 1 -r 8000 -b myvoice.raw myvoice.wav</strong>
d1335 2
a1336 2
This was just an example. More audio-related libraries and software can
be used for audio conversion.
d1344 1
a1344 1
probably sound worse than the original MP3.
d1349 1
d1351 2
a1352 2
<li>the container file format - popular examples are
MP4, OGG, MPEG, MOV, AVI, ASF.
d1354 1
a1354 3
(like Xvid and DivX), FFmpeg, WMV, ... - read this
<a href="http://en.wikipedia.org/wiki/Video_codec">Wikipedia article
about video codecs</a> to find out more.
a1356 3
In OpenBSD, support for MPEG and AVI containers is most mature at this
time.

d1371 2
a1372 1
<h2 id="streaming">13.12 - Is it possible to play streaming media under OpenBSD?</h2>
a1382 3
A slightly dated but still good starting point is this
<a href="http://www.oreilly.com/catalog/sound/chapter/ch05.html">chapter
about streaming media</a> from the O'Reilly book titled Designing Web Audio.
a1408 7
<p>
As an example, I'll explain in a few steps how I get to listen to
<a href="http://www.radio1.be">Radio 1</a>,
one of the Belgian national radio stations.
Browser-embedded plugins are not available on OpenBSD, so the story is
usually not an instant "click and play".

a1411 7
In this case, I followed the link "Listen live" from the main site, and
it's telling me my operating system is not supported.
They are being nice by saying I can also listen to their MP3 streams
without their embedded Flash player.
Apart from that, a list of links to the national radio stations appears,
allowing me to proceed to the next step.
Note that I used a JavaScript-enabled browser to get this far.
d1413 2
a1414 2
Many websites link to a container metafile or playlist
(such as M3U, ASX, RAM), which contains the actual location of the stream.
a1415 11
In my example this is

<blockquote><pre>
$ <strong>ftp http://internetradio.vrt.be/dab/hoeluisteren/pc/help/gebruiksvoorwaarden/stream_11.m3U</strong>
$ <strong>cat stream_11.m3U</strong>
http://mp3.streampower.be/radio1-mid.mp3
http://mp3.streampower.be/radio1-low.mp3
http://mp3.streampower.be/radio1-high.mp3
</pre></blockquote>

It looks like I can even choose between low, medium and high quality streams.
d1417 1
a1417 2
In that case, the best tip is: dig up the HTML source and scripts it
refers to.
a1427 13
Continuing the example:

<blockquote><pre>
$ <strong>mplayer -loop 0 http://mp3.streampower.be/radio1-mid.mp3</strong>
</pre></blockquote>

<li>Optionally, you may want to make it a little easier by including an
alias in your <tt>.profile</tt>:

<blockquote><pre>
alias radio1='mplayer -loop 0 http://mp3.streampower.be/radio1-mid.mp3'
</pre></blockquote>

a1429 6
<!--  
check out http://www.cbc.ca/listen/index.html
it has DivX streams over MMS as well as Ogg Vorbis streams over HTTP.
maybe a good example but also nearly an ideal case...
-->

d1434 8
a1441 13
Some Real Audio streams can be made to work on i386 using <b>mplayer</b>
in conjunction with the
<tt>graphics/win32-codecs</tt> and <tt>emulators/fedora/base</tt> ports
(see
<a href="http://marc.info/?t=107060510300001&amp;r=1&amp;w=2">this
thread</a> on the ports mailing list).

<h2 id="javaplugin">13.13 - Can I have Java support in my web browser? (amd64 only)</h2>

Just install the <tt>icedtea-web</tt> package. In your browser, check
for the list of detected plugins (<tt>about:config</tt> in Mozilla-based
browsers, <tt>about:plugins</tt> in <tt>www/epiphany</tt> or
<tt>about:</tt> in <tt>www/midori</tt>) and ensure icedtea-web is there.
d1449 1
a1460 13
Also, the <a href="http://gnashdev.org/">Gnash</a> project has made a
lot of progress lately, and may fill your needs.

<p>


<!--
this would be interesting, but lack of hardware at the moment

<h2 id="camera">13.xx - Can I use my digital camera under OpenBSD?</h2>

<h2 id="scanner">13.yy - How do I set up and use my scanner?</h2>
-->
a1469 1

@


1.161
log
@fix man page links after renaming sndiod(1) to sndiod(8)
@
text
@d56 1
a56 1
<li><a href="#convert"    >13.11 - But I want my media files in format FOO.</a>
d1392 1
a1392 1
<h2 id="convert">13.11 - But I want my media files in format FOO.</h2>
@


1.160
log
@capitalize Flash
@
text
@d520 1
a520 1
<h3>What's the sndiod(1) audio server</h3>
d524 1
a524 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sndiod">sndiod(1)</a>
d549 2
a550 2
Since OpenBSD 5.1, sndiod(1) is started by default at boot time.
There is no more reason to disable sndiod(1) on a system with no
d592 1
a592 1
sndiod(1) imposes a minimum latency on all audio applications,
d618 1
a618 1
Forcing the application to use smaller buffers (by starting sndiod(1)
d625 1
a625 1
sndiod(1) can be configured to accept connections from the network
d858 1
a858 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sndiod">sndiod(1)</a>
@


1.159
log
@capitalize Java
@
text
@d1591 1
a1591 1
If you are just looking to watch flash videos from common websites,
@


1.158
log
@Fixes for audio parts of faq13, from Jan Stary, ok ratchov

- fix a typo
- the "aucat sound server" is sndiod
- let sentences be sentences
@
text
@d1581 2
a1582 2
Note that due to the security issues with java applets on the web,
most browsers disable java support by default, you will be prompted for
@


1.157
log
@
in comes 5.8
@
text
@d48 1
a48 1
<li><a href="#lossyaudio" >13.8 - Tell me about Ogg Vorbis and MP3 encoding?</a>
d227 1
a227 1
To make the changes take affect on each reboot, edit <i>/etc/mixerctl.conf</i>,
d683 1
a683 1
format conversions, consider using aucat(1) as audio server.
d748 2
a749 2
<tt>play.seek</tt>
that the device has not underrun any samples <tt>play.errors</tt>.
d884 1
a884 1
<h2 id="lossyaudio">13.8 - Tell me about Ogg Vorbis and MP3 encoding?</h2>
@


1.156
log
@typo; chenga2 at rpi dot edu
@
text
@a1175 2
You are welcome to <a href="mailto:faq@@openbsd.org">let us know</a> about
your successes or failures.
@


1.155
log
@Clean up meta tags.

name=distribution, name=keywords, and name=resource-type have no effect
in modern search engines and just clutter up the page source.

From Pavel Plamenov.
@
text
@d820 1
a820 1
The latter are handly for testing the hardware, bypassing most software layers.
@


1.154
log
@Add 'link rel="canonical"' to pages, acting as a hint to search engines
to list the copies on www.openbsd.org rather than mirrors.

From Carlin Bingham, ok millert@@ nick@@
@
text
@a4 1
<meta name= "resource-type" content= "document">
a5 2
<meta name= "keywords"      content= "openbsd,faq13">
<meta name= "distribution"  content= "global">
@


1.153
log
@aucat -M option was removed, suggest using shell file redirections
instead. Mention that softsynths could be used as midi output, as
nowadays they are almost usable.

ok and fixes from sthen, nick and remco
@
text
@d10 1
@


1.152
log
@Convert the rest of the FAQ to id="" instead of <a name=""></a>.

prodded by nick@@
@
text
@d811 3
a813 1
It shows three MIDI ports, corresponding to:
d816 2
a817 2
<li> <tt>/dev/rmidi0</tt> - synthesizer connected by USB
<li> <tt>/dev/rmidi1</tt> - a MIDI master keyboard
d820 3
a822 3
These devices are known by
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sndio">sndio(7)</a>
as <tt>rmidi/0</tt> and <tt>rmidi/1</tt>.
d829 1
a829 1
$ <strong>aucat -Mq rmidi/1 -o - | hexdump -e '1/1 "%02x\n"'</strong>
d840 1
a840 1
$ <strong>aucat -M -q rmidi/0 -q rmidi/1</strong>
a844 3
Refer to the 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=aucat&amp;sektion=1">aucat(1)</a>
manual page for further information.
d856 13
@


1.151
log
@
close tag -- from Micah Muer at gmail dot com, thanks!
@
text
@d72 1
a72 2
<a name="confaudio"></a>
<h2>13.1 - How do I configure my audio device?</h2>
d240 1
a240 3

<a name="playaudio"></a>
<h2>13.2 - Playing different kinds of audio</h2>
d409 1
a409 3
<p>
<a name="playCD"></a>
<h2>13.3 - How can I play audio CDs in OpenBSD?</h2>
d468 1
a468 3
<p>
<a name="recordaudio"></a>
<h2>13.4 - Can I use OpenBSD to record audio samples?</h2>
d518 1
a518 3
<p>
<a name="audioserver"></a>
<h2>13.5 - How do I setup an audio server?</h2>
d665 1
a665 3
<p>
<a name="audioprob"></a>
<h2>13.6 - What can I do if I have audio problems?</h2>
d775 1
a775 3
<p>
<a name="midi"></a>
<h2>13.7 - How do I use my MIDI instruments?</h2>
d874 1
a874 3
<p>
<a name="lossyaudio"></a>
<h2>13.8 - Tell me about Ogg Vorbis and MP3 encoding?</h2>
d922 1
a922 3
<p>
<a name="playDVD"></a>
<h2>13.9 - How can I playback video DVDs in OpenBSD?</h2>
d964 1
d966 1
a966 5
<a name="burnCD"></a>
<h2>13.10 - How do I burn CDs and DVDs?</h2>

<a name="burnIntro"></a>
<h3>13.10.1 - Introduction and basic setup</h3>
d1040 1
a1040 2
<a name="writeCD"></a>
<h3>13.10.2 - Writing CDs</h3>
d1150 1
a1150 3

<a name="writeDVD"></a>
<h3>13.10.3 - Writing DVDs</h3>
d1384 1
a1384 3
<p>
<a name="convert"></a>
<h2>13.11 - But I want my media files in format FOO.</h2>
d1448 1
a1448 3
<p>
<a name="streaming"></a>
<h2>13.12 - Is it possible to play streaming media under OpenBSD?</h2>
d1565 1
a1565 3
<p>
<a name="javaplugin"></a>
<h2>13.13 - Can I have Java support in my web browser? (amd64 only)</h2>
d1577 1
a1577 3
<p>
<a name="flashplugin"></a>
<h2>13.14 - Can I have Flash support in my web browser?</h2>
d1598 1
a1598 2
<a name="camera"></a>
<h2>13.xx - Can I use my digital camera under OpenBSD?</h2>
d1600 1
a1600 2
<a name="scanner"></a>
<h2>13.yy - How do I set up and use my scanner?</h2>
@


1.150
log
@Rewrite the section about java applets support in browsers via
icedtea-web, and add a blurb about security concerns.
ok/tweaks kurt@@ nick@@
@
text
@d1599 1
a1599 1
<tt>about:</tt> in <tt>www/midori<tt>) and ensure icedtea-web is there.
@


1.149
log
@
welcome 5.5!
@
text
@d62 1
a62 1
  browser? (i386 &amp; amd64 only)</a>
a1592 1
<a name="javaflash"></a>
d1594 1
a1594 2
<h2>13.13 - Can I have Java support in my web browser? (i386 &amp;
amd64 only)</h2>
d1596 9
a1604 28
The Java plugin is part of the Java Development Toolkit (JDK).
For licensing reasons, OpenBSD cannot ship binary packages for the JDK.
This means you will have to build it from ports.
Further information on building the JDK can be found in
<a href="faq8.html#Programming">FAQ 8 - Programming Languages</a>.
Once you have finished building the JDK, you can install either the full
JDK package or just the Java Runtime Environment (JRE) which is in a
subpackage and contains the browser plugin.

<p>
Upon installation, instructions are displayed for using the Java plugin
with the Firefox or Seamonkey web browser.
Create the symlink as explained, and then you should see the Java plugin
upon entering "about:plugins" in the URL bar.

<p>
For KDE's Konqueror web browser, either the java binary must be in your PATH,
or its absolute path can be configured from the menu
Settings -&gt; Configure Konqueror -&gt; Java &amp; JavaScript.
By default, the java binary is located in
<tt>/usr/local/jre-<i>version</i>/bin/</tt> or
<tt>/usr/local/jdk-<i>version</i>/bin/</tt>, depending on whether
you installed the JRE or the JDK.

<p>
<b>Note:</b> Java support has only been tested with the Firefox,
Seamonkey, and Konqueror web browsers.
If it works well for you using a different browser, please let us know.
@


1.148
log
@
remove www@@ references, simplify footers on all pages.
@
text
@d669 1
a669 1
<a href="pf/queueing.html">prioritized</a>
@


1.147
log
@Remove (i386 only) from "Can I have Flash support in my web browser?" in
the indexes to match the actual paragraph.
Update copyright on the main FAQ page.
ok nick@@
@
text
@a4 1
<link rev= "made" href= "mailto:www@@openbsd.org">
a34 1
<font color= "#0000e0">
a37 1
</font>
d1658 2
a1659 1
<font color= "#0000e0">
a1662 9
</font>

<p>
<hr>
<a href= "index.html"><img height= "24" width= "24" src= "../images/back.gif" border= "0" alt="[back]"></a>
<a href="mailto:www@@openbsd.org">www@@openbsd.org</a>
<br>
<small>$OpenBSD: faq13.html,v 1.146 2013/02/18 16:23:55 nick Exp $</small>

@


1.146
log
@
http://www.dvddemystified.com is back after a six month absence, so revert
back to original source.
@
text
@d67 1
a67 1
  browser? (i386 only)</a>
d1672 1
a1672 1
<small>$OpenBSD: faq13.html,v 1.145 2013/02/17 04:04:46 nick Exp $</small>
@


1.145
log
@
dvddemystified.com is gone, change link to point to last copy in
web.archive.org.  Pointed out by Erling dot Westenvic at gmail dot com.
@
text
@d1186 1
a1186 1
<a href="http://web.archive.org/web/20120620010610/http://www.dvddemystified.com/dvdfaq.html">DVD FAQ</a>
d1672 1
a1672 1
<small>$OpenBSD: faq13.html,v 1.144 2012/11/01 15:05:30 nick Exp $</small>
@


1.144
log
@
enter 5.2!
@
text
@d1185 2
a1186 1
extensive <a href="http://www.dvddemystified.com/dvdfaq.html">DVD FAQ</a>
d1672 1
a1672 1
<small>$OpenBSD: faq13.html,v 1.143 2012/05/14 06:04:45 brett Exp $</small>
@


1.143
log
@Added the "-loop 0" flag to the mplayer streaming example, as this results in far fewer disconnected streams. I've also sent an email to mplayer-docs mailing list suggestion this to be documented in the man page. "No objection" from Nick Holland (who also suggested fixing the man page).
@
text
@d563 1
a563 1
On OpenBSD 5.1, sndiod(1) is started by default at boot time.
d1671 1
a1671 1
<small>$OpenBSD: faq13.html,v 1.142 2012/05/01 14:39:46 nick Exp $</small>
@


1.142
log
@
updates for 5.1 from ratchov@@
@
text
@d1565 1
a1565 1
$ <strong>mplayer http://mp3.streampower.be/radio1-mid.mp3</strong>
d1572 1
a1572 1
alias radio1='mplayer http://mp3.streampower.be/radio1-mid.mp3'
d1671 1
a1671 1
<small>$OpenBSD: faq13.html,v 1.141 2011/11/09 03:10:21 nick Exp $</small>
@


1.141
log
@
modernize: SCSI is rarely seen now, most things that use sd(4) are
SCSI-like.  Plus, SATA and SAS are options now.
@
text
@d492 1
a492 1
The file will contain signed 16-bit stereo samples, sampled at 44.1 kHz.
d534 1
a534 1
<h3>Do I need an audio server?</h3>
d536 20
a555 5
The <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=aucat&amp;sektion=1">aucat(1)</a>
utility can be used as an audio server,
which acts as a layer between the audio(4) driver
and audio applications.
It aims to:
d557 1
a557 1
<ul>
d559 7
a565 34
<li>
Overcome incompatibilities between hardware and applications.
For instance the application may not support the encodings or sample rates
of the hardware; if so, the server can do the necessary conversions on the fly.

<li>
Allow multiple applications to use the hardware concurrently.
For instance, to use a background music player while running an application
playing sounds, or to
simultaneously use the front speakers for music and the headphone socket for
telephony is another example.

</ul>

If applications you use are compatible with your hardware and you don't
plan to run multiple applications concurently, then you don't need an audio
server.

<h3>How do I setup aucat(1)?</h3>

There's no configuration file and, in most cases, no tweaking is needed. Typing:

<pre>
$ <strong>aucat -l</strong>
</pre>

will start the server on the default audio device (the one the
<tt>/dev/audio</tt> symlink points to) running at 44.1kHz and
using two channels (stereo).
This means that applications using stereo at 44.1kHz will
run optimally, i.e. without triggering conversion code.
If the device doesn't support those parameters,
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=aucat&amp;sektion=1">aucat(1)</a>
will automatically pick another set of parameters.
d568 2
a569 10
If you start aucat as root, it will increase its priority,
to decrease the probability of buffer underruns or overruns.

It can be started at system boot by appending:

<pre>
<strong>aucat_flags=""</strong>
</pre>

to <tt>/etc/rc.conf.local</tt>.
d606 2
a607 2
In server mode, aucat(1) imposes a minimum latency on all audio applications,
and the default latency is around 250ms.
d609 3
a611 2
If you plan to use applications that require a lower latency, use the ``-b'' option
to select the desired latency (expressed in number of frames).
d613 1
a613 1
For instance, at 44100 samples/second, 50ms latency corresponds to:
d616 1
a616 1
44100 samples/second x 0.050 seconds = 2205 samples
d619 1
a619 3
then run
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=aucat&amp;sektion=1">aucat(1)</a>
as follows:
d622 1
a622 1
$ <strong>aucat -b 2205 -l</strong>
d625 2
d629 1
a629 1
Synchronizing audio to video doesn't require low latency.
d632 1
a632 1
Forcing the application to use smaller buffers (by starting aucat(1)
d637 40
a680 1

d836 1
a836 1
as <tt>rmidi:0</tt> and <tt>rmidi:1</tt>.
d843 1
a843 1
$ <strong>midicat -q rmidi:1 -o - | hexdump -e '1/1 "%02x\n"'</strong>
d854 1
a854 1
$ <strong>midicat -q rmidi:0 -q rmidi:1</strong>
d860 1
a860 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=midicat&amp;sektion=1">midicat(1)</a>
d872 1
a872 1
$ <strong>midiplay -f rmidi:0 file.mid</strong>
d880 1
a880 1
$ <strong>smfrec -d rmidi:0 -i rmidi:1 file.mid</strong>
d883 2
a884 2
will record what is played on the keyboard (<tt>rmidi:1</tt>) while
sending it in real-time on the synthesizer (<tt>rmidi:0</tt>) so you
d1671 1
a1671 1
<small>$OpenBSD: faq13.html,v 1.140 2011/11/01 10:52:27 nick Exp $</small>
@


1.140
log
@
updates for 5.0 (and some non-version-related improvements).
@
text
@d428 4
a431 2
<li>Connect the audio output at the back side to your audio card. Yes, this
is a supplementary cable next to the data (SCSI/IDE) and power cables.
d973 1
a973 1
Most SCSI devices are supported. IDE/ATAPI and USB devices are supported
d1232 2
a1233 2
and you should check whether your bus (SCSI, (E)IDE/ATAPI, USB) is performant
enough to handle this throughput.
d1239 1
a1239 1
In general, the speed of SCSI and (E)IDE/ATAPI buses should be just fine.
d1651 1
a1651 1
<small>$OpenBSD: faq13.html,v 1.139 2011/07/12 10:28:22 sthen Exp $</small>
@


1.139
log
@Mention some of the ports that can be used to watch flash videos.
Idea from Antti Harri, ok/suggestions nick@@
@
text
@d1609 4
a1612 6
<h2>13.14 - Can I have Flash support in my web browser? (i386 only)</h2>
<!--
	XXX for 5.0: opera-flash-plugin has been removed, also gnash
	is improved over earlier versions so consider suggesting that
	instead.
-->
d1614 2
a1615 1
Firstly, if you are just looking to watch flash videos from common websites,
d1621 2
a1624 57
The Flash plugin is distributed by Adobe in binary form only.
Adobe does not provide a native OpenBSD plugin, but there is a Linux
plugin which you can use under Linux emulation.
This plugin is available only for the i386 platform.

<p>
Before continuing, it is a good idea to read about Linux emulation in the
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=compat_linux&amp;sektion=8">compat_linux(8)</a>
manual page, and also
<a href="faq9.html#Interact">FAQ 9 - Running Linux binaries on OpenBSD</a>.

<p>
If you have understood this and you didn't install the necessary files yet,
just add the fedora package.
Assuming you have the environment variable <tt>PKG_PATH</tt> set
(see <a href="faq15.html#Easy">FAQ 15</a>),

<blockquote><pre>
# <b>pkg_add -i fedora_base</b>
</pre></blockquote>

This will automatically set <tt>kern.emul.linux=1</tt>, but not permanently.
If you need permanent Linux emulation, you need to specify that in
<tt>/etc/sysctl.conf</tt>, as explained in
<a href="faq9.html#Interact">FAQ 9 - Running Linux binaries on OpenBSD</a>.

<p>
Another thing you should know is that Linux shared libraries and modules
cannot be used with OpenBSD executables, so you will need a Linux browser
as well.

<p>
One candidate is the <a href="http://www.opera.com/">Opera</a> web browser,
available in the ports tree.
OpenBSD does not distribute packages for it, since Opera's license is not
clear about its redistribution.
However, installation should not take long, since it is distributed in
binary form by Opera Software.
After that you can easily install the Flash plugin from the ports tree.

<blockquote><pre>
# <b>cd /usr/ports/www/opera</b>
# <b>make install</b>
# <b>cd /usr/ports/www/opera-flashplugin</b>
# <b>make install</b>
</pre></blockquote>

<p>
<b>Note:</b>
It should be sufficient to perform the last step alone, and the ports
system will install the dependencies automatically.
For clarity, however, we split the process into a few steps here to
explain.

<p>
If you have followed the above guidelines, the Flash plugin should now be
listed when you type "about:plugins" in the URL bar.
d1649 1
a1649 1
<small>$OpenBSD: faq13.html,v 1.138 2011/05/30 13:33:29 lum Exp $</small>
@


1.138
log
@Some small things:
1. Make some meta tags more pertinent.
2. "a name" anchors align with top of browser.
3. Remove reference to waveplay, it was removed from
ports one year ago. (@@ 13.2 Playing different kinds of Audio....)
@
text
@d1610 5
d1616 8
d1705 1
a1705 1
<small>$OpenBSD: faq13.html,v 1.137 2010/11/06 20:11:30 ratchov Exp $</small>
@


1.137
log
@it's not necessary to renice aucat by hand anymore, neither the hack
using su(8) is necessary to start it at system boot. Use sndio(7)
midi port names which are consistend with ``soft'' midi ports.

ok nick, jakemsr
@
text
@d7 2
a8 2
<meta name= "description"   content= "the OpenBSD FAQ page">
<meta name= "keywords"      content= "openbsd,faq">
d322 3
a324 4
There are other utilities you can use, such as
<tt>audio/waveplay</tt> in packages and ports.
Of course, popular software like XMMS is also able to play these files,
among other audio formats.
d415 1
a415 1

d474 1
a474 1

d526 1
d654 1
a654 1

d767 1
a767 1

d868 1
d918 1
a918 1

d1387 1
a1387 1

d1453 1
a1453 1

d1572 1
d1607 1
a1607 1

d1692 1
a1692 1
<small>$OpenBSD: faq13.html,v 1.136 2010/07/04 17:07:56 nick Exp $</small>
@


1.136
log
@
mkisofs -> mkhybrid, from jirib at live dot com, while there, noticed
that the -R would often be better a -r, and an XF4 reference that
should be xenocara.
@
text
@d578 2
a579 3
If you have the necessary privileges, you can increase its priority,
to decrease the probability of buffer underruns or overruns, for
instance:
d581 1
a581 8
<pre>
$ <strong>sudo renice -n -20 `pgrep -x aucat`</strong>
</pre>

Note that aucat(1) starts in full-duplex mode by default, which requires your
device to support full-duplex mode.
If it doesn't, you have to start aucat(1) in play-only or record-only mode,
for example:
d584 1
a584 1
$ <strong>aucat -l -m play</strong>
d587 1
a587 13
<h3>How do I start aucat(1) at system boot?</h3>

If you're the only local user of the machine, you can start
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=aucat&amp;sektion=1">aucat(1)</a>
at system boot from
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc.local&amp;sektion=8">rc.local(8)</a>,
for instance:

<pre>
<strong>nice -n -20 su -m mylogin -c "aucat -l"</strong>
</pre>

The aucat(1) process cannot be shared between multiple users.
a798 1
midi0 at pcppi0: &lt;PC speaker&gt;
d800 1
a800 1
midi1 at umidi0: &lt;USB MIDI I/F&gt;
d802 1
a802 1
midi2 at umidi1: &lt;USB MIDI I/F&gt;
d808 2
a809 3
<li> <tt>/dev/rmidi0</tt> - the PC speaker
<li> <tt>/dev/rmidi1</tt> - synthesizer connected by USB
<li> <tt>/dev/rmidi2</tt> - a MIDI master keyboard
d812 4
d821 1
a821 1
$ <strong>hexdump -e '1/1 "%02x\n"' &lt;/dev/rmidi2 </strong>
d832 1
a832 1
$ <strong>cat -u /dev/rmidi1 &gt;/dev/rmidi2</strong>
a836 2
Indeed information on what you play is captured from /dev/rmidi1 and
sent to /dev/rmidi2 in real-time.
d838 1
a838 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=midi&amp;sektion=4">midi(4)</a>
d850 1
a850 1
$ <strong>midiplay -d 1 file.mid</strong>
a852 3
Notice that we specified MIDI device number 1 (ie. <tt>/dev/rmidi1</tt>)
as a parameter because device number 0 is used by default.

d858 1
a858 1
$ <strong>smfrec -d /dev/rmidi1 -i /dev/rmidi2 file.mid</strong>
d861 2
a862 2
will record what is played on the keyboard (<tt>/dev/rmidi2</tt>) while
sending it in real-time on the synthesizer (<tt>/dev/rmidi1</tt>) so you
d1690 1
a1690 1
<small>$OpenBSD: faq13.html,v 1.135 2010/01/16 23:47:46 ratchov Exp $</small>
@


1.135
log
@Fix the suggested command to start aucat to a command
that actually works.

From Laurent Ghigonis <ooookiwi at gmail.com>, Thanks!
@
text
@d1313 1
a1313 1
(src, XF4, ports and www) contained in the /cvs directory on my disk.
d1318 1
a1318 1
$ <strong>mkisofs -R -o cvs.iso /cvs</strong>
d1713 1
a1713 1
<small>$OpenBSD: faq13.html,v 1.134 2009/11/30 12:50:27 nick Exp $</small>
@


1.134
log
@
punctuation, validation and spelling corrections from Alan Bueno.
@
text
@d604 1
a604 1
<strong>nice -n -20 su -m mylogin aucat -l</strong>
d1713 1
a1713 1
<small>$OpenBSD: faq13.html,v 1.133 2009/10/22 13:41:51 jmc Exp $</small>
@


1.133
log
@tweak 13.5; ok nick ratchov
@
text
@d527 1
a527 1
<a name="audioserver">
d600 1
a600 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc.local&sektion=8">rc.local(8)</a>,
d699 1
a699 1
<a href="#audioserver">13.5 - How do I setup an audio server</a>.
d1713 1
a1713 1
<small>$OpenBSD: faq13.html,v 1.132 2009/10/22 06:12:01 ratchov Exp $</small>
@


1.132
log
@typo: s/precess/process/
from ajacoutot and remco _at d-compu.dyndns.org
@
text
@d534 3
a536 1
The audio server is a layer between the audio(4) driver
d538 1
a538 3
The <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=aucat&amp;sektion=1">aucat(1)</a>
utility has audio server capability.
It's aimed to:
d544 2
a545 2
For instance the application may not support encodings or sample rates of the
hardware, if so the server will do the necessary conversions on the fly.
d548 4
a551 4
Allow multiple applications to use the hardware concurently.
For instance, use a background music player while running an application
playing sounds.
Using simultaneously the front speakers for music and headphones for
d557 1
a557 1
plan to run multiple applications concurently, then you need no audio
d562 1
a562 1
There's no config file and in most cases, no tweaking is needed, typing:
d573 1
a573 1
If the device doesn't support above parameters,
d578 1
a578 1
If you have the necessary privileges, you can increase it's priority,
d588 2
a589 1
If it doesn't, you have to start aucat(1) in play-only or record-only mode, example:
d599 1
a599 1
at system boot at your behalf from
d621 3
a623 3
This is the time it takes between you hit a key on your MIDI keyboard
and you actually hear the note.
Roughly, 5ms corresponds to the time it takes to the sound to
d634 2
a635 2
audio data in a way it is played simultaneously with the corresponding
picture.
d644 1
a644 1
In server mode, aucat(1) imposes a minimum latency to all audio applications,
d647 1
a647 1
If you plan to use applications that require lower latency, use the ``-b'' option
d672 1
a672 1
right thing to do is to start searching the corresponding bug.
d1713 1
a1713 1
<small>$OpenBSD: faq13.html,v 1.131 2009/10/21 16:47:43 ratchov Exp $</small>
@


1.131
log
@add a new section about how to setup audio server
ok nick@@
@
text
@d606 1
a606 1
The aucat(1) precess cannot be shared between multiple users.
d1712 1
a1712 1
<small>$OpenBSD: faq13.html,v 1.130 2009/10/13 10:05:24 steven Exp $</small>
@


1.130
log
@refer to the OpenBSD Porter's Handbook instead of porting.html
@
text
@d50 6
a55 5
<li><a href="#audioprob"  >13.5 - What can I do if I have audio problems?</a>
<li><a href="#midi"	  >13.6 - How do I use my MIDI instruments?</a>
<li><a href="#lossyaudio" >13.7 - Tell me about Ogg Vorbis and MP3 encoding?</a>
<li><a href="#playDVD"    >13.8 - How can I playback video DVDs in OpenBSD?</a>
<li><a href="#burnCD"     >13.9 - How do I burn CDs and DVDs?</a>
d57 3
a59 3
  <li><a href="#burnIntro">13.9.1 - Introduction and basic setup</a>
  <li><a href="#writeCD"  >13.9.2 - Writing CDs</a>
  <li><a href="#writeDVD" >13.9.3 - Writing DVDs</a>
d61 2
a62 2
<li><a href="#convert"    >13.10 - But I want my media files in format FOO.</a>
<li><a href="#streaming"  >13.11 - Is it possible to play streaming media under
d64 1
a64 1
<li><a href="#javaplugin" >13.12 - Can I have Java support in my web
d66 1
a66 1
<li><a href="#flashplugin">13.13 - Can I have Flash support in my web
d527 146
d675 1
a675 1
<h2>13.5 - What can I do if I have audio problems?</h2>
d688 1
a688 1
a single or limited set of sample rates.
d694 5
a698 22
If your device only supports on or a few sample rates,
there are applications in the packages and ports collection that
perform rate resampling.
This will allow you to play audio with different sample rates than your
device supports.
For example, <tt>x11/mplayer</tt> has a "<tt>-srate</tt>" switch to specify
a desired output sample rate.
You would set that to a rate your sound device supports.
KDE's <tt>artsd</tt> and some games support similar options.
Read the documentation of your specific audio application to find out
whether it supports rate resampling.

<p>
Rate resampling can also be accomplished with <tt>aucat</tt>.
For example:

<blockquote><pre>
$ <strong>mpg321 -s file.mp3 | aucat -r 22050 -i -</strong>
</pre></blockquote>

The above command will play 22050 Hz sample rate MP3 audio file
using <tt>mpg321</tt> and <tt>aucat</tt>.
d788 1
a788 1
<h2>13.6 - How do I use my MIDI instruments?</h2>
d891 1
a891 1
<h2>13.7 - Tell me about Ogg Vorbis and MP3 encoding?</h2>
d941 1
a941 1
<h2>13.8 - How can I playback video DVDs in OpenBSD?</h2>
d985 1
a985 1
<h2>13.9 - How do I burn CDs and DVDs?</h2>
d988 1
a988 1
<h3>13.9.1 - Introduction and basic setup</h3>
d1048 1
a1048 1
<h3>I want to write a CD here! Can we get on with it?</h3>
d1063 1
a1063 1
<h3>13.9.2 - Writing CDs</h3>
d1175 1
a1175 1
<h3>13.9.3 - Writing DVDs</h3>
d1410 1
a1410 1
<h2>13.10 - But I want my media files in format FOO.</h2>
d1476 1
a1476 1
<h2>13.11 - Is it possible to play streaming media under OpenBSD?</h2>
d1595 1
a1595 1
<h2>13.12 - Can I have Java support in my web browser? (i386 &amp;
d1629 1
a1629 1
<h2>13.13 - Can I have Flash support in my web browser? (i386 only)</h2>
d1712 1
a1712 1
<small>$OpenBSD: faq13.html,v 1.128 2009/09/09 02:02:54 nick Exp $</small>
@


1.129
log
@at least ffmpeg and libquicktime (maybe others) have been able to
produce streams in MP4 containers since OpenBSD 4.4.  don't say it's
not possible.

ok nick@@
@
text
@d412 1
a412 1
You are always welcome to <a href="../porting.html">submit a port</a>
@


1.128
log
@
bunches of fixes from Alan R. S. Bueno (alan dot bsd at gmail dot com),
many thanks!
@
text
@a1328 1
No utilities in the ports tree can create streams in MP4 containers yet.
d1582 1
a1582 1
<small>$OpenBSD: faq13.html,v 1.127 2009/04/07 00:41:14 nick Exp $</small>
@


1.127
log
@
updated/corrected links from Benoit Lecocq (blq at arcane-labs dot net),
thanks!
@
text
@d667 1
a667 1
on MIDI and Music Synthesis</a>
d1583 1
a1583 1
<small>$OpenBSD: faq13.html,v 1.126 2009/01/25 18:09:49 jasper Exp $</small>
@


1.126
log
@- fix a bunch of tyop's

from Tom Van Looy, thanks!
@
text
@d794 1
a794 1
<a href="http://mp3dev.org/">"Lame ain't an MP3 encoder" (LAME)</a>,
d832 1
a832 1
<a href="http://www.xinehq.de/">xine</a>, and
d1583 1
a1583 1
<small>$OpenBSD: faq13.html,v 1.125 2008/11/12 02:59:41 nick Exp $</small>
@


1.125
log
@
punctation, standardizing, other misc. cleanup, from from Alan R. S.
Bueno (alan dot bsd at gmail dot com)
@
text
@d382 1
a382 1
If you don't have a MIDI sythesizer, but you wish to play a standard
d1372 1
a1372 1
application since it doesn't do any retransmision of packets or other
d1583 1
a1583 1
<small>$OpenBSD: faq13.html,v 1.124 2008/11/03 23:18:05 jakemsr Exp $</small>
@


1.124
log
@overhaul audio(4) portions

input/ok ratchov
@
text
@d534 2
a535 2
see section
<a href="#confaudio ">13.1 - How do I configure my audio device</a>
d543 1
a543 1
<a href="#confaudio ">13.1 - How do I configure my audio device</a>
d669 1
a669 1
<!-- <h3>Devices setup</h3> --->
d730 1
a730 1
<!-- <h3>Playing, recording MIDI sequences</h3> --->
d1583 1
a1583 1
<small>$OpenBSD: faq13.html,v 1.123 2008/10/27 21:53:58 ratchov Exp $</small>
@


1.123
log
@move all MIDI-related stuff in a new section. Except a small
``how to play a .mid on audio(4)'' section that's left together
with the .mod section. Add notes about how to test input and
record MIDI.
ok steven
@
text
@d50 5
a54 4
<li><a href="#midi"	  >13.5 - How do I use my MIDI instruments?</a>
<li><a href="#lossyaudio" >13.6 - Tell me about Ogg Vorbis and MP3 encoding?</a>
<li><a href="#playDVD"    >13.7 - How can I playback video DVDs in OpenBSD?</a>
<li><a href="#burnCD"     >13.8 - How do I burn CDs and DVDs?</a>
d56 3
a58 3
  <li><a href="#burnIntro">13.8.1 - Introduction and basic setup</a>
  <li><a href="#writeCD"  >13.8.2 - Writing CDs</a>
  <li><a href="#writeDVD" >13.8.3 - Writing DVDs</a>
d60 2
a61 2
<li><a href="#convert"    >13.9 - But I want my media files in format FOO.</a>
<li><a href="#streaming"  >13.10 - Is it possible to play streaming media under
d63 1
a63 1
<li><a href="#javaplugin" >13.11 - Can I have Java support in my web
d65 1
a65 1
<li><a href="#flashplugin">13.12 - Can I have Flash support in my web
d104 12
a115 4
You can test whether or not your audio device is working properly by sending
an audio file (usually with .au extension) to it.
If you don't have an audio file, you can also send any text or binary file
to the device:
d118 2
a119 1
$ <strong>cat filename > /dev/audio</strong>
d122 3
a124 3
If you hear something (if it's not an audio file it will not sound good and
may sound loud, too), it means that the chip is supported by OpenBSD and was
recognized and configured by the kernel at boot time.
d127 35
a161 2
<b>Note:</b>
Not every variation or utilization of every chip has been tested or debugged.
d164 15
a178 14
If you did not hear anything upon entering the above command, there are a
number of possible reasons:
<ul>
<li>The file you sent to the device is so small you can hardly hear it.
Try again with a file of at least 10 kB.
<li>The chip was recognized and configured correctly, but the sound is muted
and must be unmuted to hear it, see below.
<li>The chip was recognized but not configured correctly.
Maybe you have an old ISA card which needs to be configured with a different
I/O address and IRQ value to avoid conflicts with other hardware.
You can easily try different combinations using the
<a href="faq5.html#BootConfig">User Kernel Configuration (UKC)</a>.
<li>Your card/chipset is not fully supported.
</ul>
d181 2
a182 4
Note that even if you did hear a sound, it does not necessarily mean that
everything is going to be functioning as desired.
If you encounter problems while playing sound, here is another list of
things to check:
d184 7
a190 18
<li>Find information about your sound device.
Use the documentation, or use an internet search engine to find its
specifications.
They may actually help you find the source of the problem.
<li>Please unmute <b>all</b> outputs (see below) before reporting a problem.
Sometimes the listed outputs do not represent reality, for instance the
headphones output may be mixed up with the line output.
<li>It is possible that a less than optimal driver attaches to the sound
device, and that you can get better results using another driver.
This is not the easiest thing to spot, but take a closer look at your
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dmesg&amp;sektion=8">dmesg(8)</a>
output, and find the lines where audio drivers attach.
If you see more than one sound driver attaching (or trying to), test
them one at a time by disabling some and leaving one enabled using the
<a href="faq5.html#BootConfig">User Kernel Configuration (UKC)</a>.
<li>You have a sound device which can play only fixed sample rates.
In this case, there are some audio tools which support rate resampling,
as mentioned in <a href="#playaudio">Playing different kinds of audio</a>.
d193 15
a207 7
<p>
To tune the parameters for the audio device, such as playing sample rate,
you can use
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=audioctl&amp;sektion=1">audioctl(1)</a>.
To tune the sound volume and other mixer settings, you can use
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mixerctl&amp;sektion=1">mixerctl(1)</a>.
Both utilities are provided as part of the base system.
d210 2
a211 2
For instance, to set the sound volume of the left and right channels to 200,
you would, for example (see Note 2 below), issue
d219 1
a219 1
The reason for this is that my audio device has an AC'97 codec, which uses
d221 1
a221 1
Obviously, other hardware could have different resolution.
d232 1
a232 1
To make your changes permanent you need to edit <i>/etc/mixerctl.conf</i>,
a242 18
<b>Note 1:</b>
You may see more outputs than there are on your sound card or motherboard.
This is because audio chips are generally cheaper to install on boards than
the jacks used to connect the outputs, so not every option of every audio
chip necessarily reaches the outside world.

<p>
<b>Note 2:</b>
The outputs of the audio device in your system may be labeled differently.
For instance, you might not have an "outputs.master" as in the above
example, you may need to adjust "outputs.output" or something else instead.
This depends on the audio driver, and you can easily find the proper name
by listing the controls with

<blockquote><pre>
$ <b>mixerctl -a</b>
</pre></blockquote>

d256 17
d274 3
a276 1
In order to play such a file, you should know its main parameters: encoding
d322 1
a322 2
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=aucat&amp;sektion=1">aucat(1)</a>,
and <tt>audio/waveplay</tt> in packages and ports.
a375 17
<h4>Coping with fixed rate sound devices</h4>

Some sound devices can play only fixed sample rates.
For instance, you may be trying to play a 22050 Hz file through a sound
chip which is locked at 48000 Hz.

<p>
There are audio utilities in the packages and ports collection that
tackle this problem by performing rate resampling.
For example, <tt>x11/mplayer</tt> has a "<tt>-srate</tt>" switch to specify
a desired output sample rate.
You would set that to the rate your sound device is using.
KDE's <tt>artsd</tt> and some games support similar options.
Read the documentation of your specific audio application to find out
whether it supports rate resampling.


d419 6
d443 1
a443 1
This will read from the first CD-ROM drive, <tt>cd0</tt>, by default.
d460 9
d478 5
a482 5
Yes, to do this you can use /dev/sound or /dev/audio as an input device.
<p>
First, set the relevant recording parameters with
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=audioctl&amp;sektion=1">audioctl(1)</a>,
e.g.
d485 1
a485 4
record.encoding=mulaw
record.rate=8000
record.channels=1
record.precision=8
d488 5
a492 6
Here I'm using nonuniform quantizing with the mu-law algorithm, with one
channel, a sampling rate of 8000 Hz and using 8 bits per sample.
The mu-law and A-law algorithms are especially useful when digitizing speech
signals, because they achieve a greater coding efficiency.
This means that the quality of the sampled speech will be better for a given
number of bits per sample, or less bits will be required for a given quality.
d495 5
a499 3
If you decide to adopt the above values (only those!), you can use the
/dev/audio device which uses them by default, so you do not need to set them
explicitly in that case.
d502 3
a504 1
Next, make sure that you select the right device to record from and that the
d511 1
a511 1
inputs.mic.mute=on
d517 1
a517 1
record.mic=0
d521 1
a521 1
In this example, I'll be recording from a microphone.
d523 7
a529 1
silent.
d532 6
a537 4
To do the actual recording, just use
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=cat&amp;sektion=1">cat(1)</a>
or
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dd&amp;sektion=1">dd(1)</a>:
d539 6
a544 3
<blockquote><pre>
$ <strong>dd if=/dev/audio of=myvoice.raw</strong>
</pre></blockquote>
d546 12
a557 9
Press [CTRL]-C to finish the recording.
The output is a raw sequence of bytes.
This sound can be played, as explained in
<a href="#playaudio">Playing different kinds of audio</a>.
For a quick test, assuming the audio parameters are set correctly:

<blockquote><pre>
$ <strong>dd if=myvoice.raw of=/dev/audio</strong>
</pre></blockquote>
d560 2
a561 2
Again, if you set other encoding parameters, you should be using the
/dev/sound device.
a562 1
Another example of encoding parameters:
d564 1
a564 4
record.encoding=slinear_le
record.rate=22050
record.channels=2
record.precision=8
d567 2
a568 4
This will result in PCM with signed linear (uniform) quantization, stored in
little-endian byte ordering, at a sampling rate of 22050 Hz, in stereo,
and using 8 bits to represent one sample
(2^8 = 256 quantization levels).
d571 84
a654 4
<b>Note:</b>
You will probably want to convert this recording in raw (headerless) format
to a more usable format for further processing.
Read <a href="#convert">FAQ 13 - Conversion</a> to find out more.
d658 1
a658 1
<h2>13.5 - How do I use my MIDI instruments?</h2>
d761 1
a761 1
<h2>13.6 - Tell me about Ogg Vorbis and MP3 encoding?</h2>
d811 1
a811 1
<h2>13.7 - How can I playback video DVDs in OpenBSD?</h2>
d855 1
a855 1
<h2>13.8 - How do I burn CDs and DVDs?</h2>
d858 1
a858 1
<h3>13.8.1 - Introduction and basic setup</h3>
d933 1
a933 1
<h3>13.8.2 - Writing CDs</h3>
d1045 1
a1045 1
<h3>13.8.3 - Writing DVDs</h3>
d1280 1
a1280 1
<h2>13.9 - But I want my media files in format FOO.</h2>
d1347 1
a1347 1
<h2>13.10 - Is it possible to play streaming media under OpenBSD?</h2>
d1466 1
a1466 1
<h2>13.11 - Can I have Java support in my web browser? (i386 &amp;
d1500 1
a1500 1
<h2>13.12 - Can I have Flash support in my web browser? (i386 only)</h2>
d1560 1
d1583 1
a1583 1
<small>$OpenBSD: faq13.html,v 1.122 2008/05/01 16:58:15 steven Exp $</small>
@


1.122
log
@java also works in konqueror - explain how.
thanks to kraktus at googlemail.com and christian.guyard at tele2.fr
who mentioned this ages ago via www@@.

some more rewording while here.
@
text
@d50 4
a53 3
<li><a href="#lossyaudio" >13.5 - Tell me about Ogg Vorbis and MP3 encoding?</a>
<li><a href="#playDVD"    >13.6 - How can I playback video DVDs in OpenBSD?</a>
<li><a href="#burnCD"     >13.7 - How do I burn CDs and DVDs?</a>
d55 3
a57 3
  <li><a href="#burnIntro">13.7.1 - Introduction and basic setup</a>
  <li><a href="#writeCD"  >13.7.2 - Writing CDs</a>
  <li><a href="#writeDVD" >13.7.3 - Writing DVDs</a>
d59 2
a60 2
<li><a href="#convert"    >13.8 - But I want my media files in format FOO.</a>
<li><a href="#streaming"  >13.9 - Is it possible to play streaming media under
d62 1
a62 1
<li><a href="#javaplugin" >13.10 - Can I have Java support in my web
d64 1
a64 1
<li><a href="#flashplugin">13.11 - Can I have Flash support in my web
d358 7
a364 26
The Musical Instrument Digital Interface (MIDI) protocol provides a
standardized and efficient means to represent musical performance
information as electronic data. A MIDI file can be extremely small as
compared to a sampled audio file, because it contains only instructions
needed by a synthesizer to play the sounds.

<p>
Two widely used technologies in music synthesizers are:
<ul>
<li>Frequency Modulation (FM) Synthesis: an older method which approximates
the waveform of each instrument using a set of parameters; generally poor
quality, inexpensive to implement and therefore used on many sound cards.
<li>Wavetable Synthesis: a newer method which uses small digitized recordings
of real instruments; better quality sound, requires on-board memory, found
only on more expensive sound cards.
</ul>

<p>
Most of the necessary information about MIDI on OpenBSD can be found in the
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=midi&amp;sektion=4">midi(4)</a>
manual page.

<p>
The main utility to handle standard MIDI files is
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=midiplay&amp;sektion=1">midiplay(1)</a>.
To get a list of MIDI devices available on your system, try the following:
d367 1
a367 4
$ <strong>midiplay -l</strong>
0: SB MIDI UART
1: SB Yamaha OPL3
2: PC speaker
a369 24
In this example, we see the UART output to which an external MIDI device
can be connected, the Yamaha OPL3 FM on-board synthesizer, and the plain
old speaker.

<p>
<b>Note:</b>
Not all sound cards have an on-board MIDI synthesizer, so you may see only
an UART ouput and the PC speaker listed.

<p>
Playing a standard MIDI file, in this example through the OPL3 synthesizer,
is as easy as:

<blockquote><pre>
$ <strong>midiplay -d 1 file.mid</strong>
</pre></blockquote>

Notice that we specified MIDI device number 1 as a parameter because
device number 0 is used by default.

<p>
More information: <a href="http://www.harmony-central.com/MIDI/Doc/tutorial.html">Tutorial
on MIDI and Music Synthesis</a>

d532 103
d636 1
a636 1
<h2>13.5 - Tell me about Ogg Vorbis and MP3 encoding?</h2>
d686 1
a686 1
<h2>13.6 - How can I playback video DVDs in OpenBSD?</h2>
d730 1
a730 1
<h2>13.7 - How do I burn CDs and DVDs?</h2>
d733 1
a733 1
<h3>13.7.1 - Introduction and basic setup</h3>
d808 1
a808 1
<h3>13.7.2 - Writing CDs</h3>
d920 1
a920 1
<h3>13.7.3 - Writing DVDs</h3>
d1155 1
a1155 1
<h2>13.8 - But I want my media files in format FOO.</h2>
d1222 1
a1222 1
<h2>13.9 - Is it possible to play streaming media under OpenBSD?</h2>
d1341 1
a1341 1
<h2>13.10 - Can I have Java support in my web browser? (i386 &amp;
d1375 1
a1375 1
<h2>13.11 - Can I have Flash support in my web browser? (i386 only)</h2>
a1434 2


d1457 1
a1457 1
<small>$OpenBSD: faq13.html,v 1.121 2008/05/01 16:12:13 steven Exp $</small>
@


1.121
log
@forgot to update toc
@
text
@d61 1
a61 1
<li><a href="#javaplugin" >13.10 - Can I have a Java plugin in my web
d63 1
a63 1
<li><a href="#flashplugin">13.11 - Can I have a Flash plugin in my web
d1283 1
a1283 1
<h2>13.10 - Can I have a Java plugin in my web browser? (i386 &amp;
d1297 1
a1297 1
with a Firefox or Mozilla web browser.
d1302 11
a1312 2
<b>Note:</b> The Java plugin has only been tested with the Firefox and
Mozilla browsers.
d1317 1
a1317 1
<h2>13.11 - Can I have a Flash plugin in my web browser? (i386 only)</h2>
d1401 1
a1401 1
<small>$OpenBSD: faq13.html,v 1.120 2008/04/30 22:36:24 steven Exp $</small>
@


1.120
log
@update for 4.3
@
text
@d62 1
a62 1
  browser? (i386 only)</a>
d1392 1
a1392 1
<small>$OpenBSD: faq13.html,v 1.119 2007/12/01 14:29:56 steven Exp $</small>
@


1.119
log
@don't use "CD-ROM" for rewritable media; jiri at navratil.cz
@
text
@d1283 2
a1284 1
<h2>13.10 - Can I have a Java plugin in my web browser? (i386 only)</h2>
d1392 1
a1392 1
<small>$OpenBSD: faq13.html,v 1.118 2007/11/29 01:48:23 nick Exp $</small>
@


1.118
log
@
sync with rename of faq12.html
@
text
@d809 1
a809 1
CD-ROM before burning it.
d1391 1
a1391 1
<small>$OpenBSD: faq13.html,v 1.117 2007/11/05 08:20:15 jmc Exp $</small>
@


1.117
log
@cdio can now rip/write, so use it for examples instead of cdrtools;
also myisofs -> mkhybrid, since the latter is already in base;

ok steven nick
@
text
@d38 1
a38 1
<a href= "faq12.html">[To Section 12 - Platform-Specific Questions]</a>
d1382 1
a1382 1
<a href= "faq12.html">[To Section 12 - Platform-Specific Questions]</a>
d1391 1
a1391 1
<small>$OpenBSD: faq13.html,v 1.116 2007/09/21 06:11:18 steven Exp $</small>
@


1.116
log
@fix dmesg man page section.

from Mark Bucciarelli <mark at k16i.net>
@
text
@d758 1
a758 1
cdrtools <a href="faq15.html#PkgMgmt">package</a> and which may do a better
d760 1
a760 1
In the examples below, we will use mkisofs, although mkhybrid usage is
d768 1
a768 1
$ <strong>mkisofs -R -o sys.iso /usr/src/sys</strong>
d772 3
a774 3
Using XFS_DEV-.000;1 for  /usr/src/sys/xfs/xfs_dev-common.c (xfs_dev-bsd.c)
 12.06% done, estimate finish Sun Mar 27 21:18:47 2005
 24.09% done, estimate finish Sun Mar 27 21:18:43 2005
d776 2
a777 2
 84.32% done, estimate finish Sun Mar 27 21:18:38 2005
 96.37% done, estimate finish Sun Mar 27 21:18:38 2005
d779 5
a783 5
Total rockridge attributes bytes: 0
Total directory bytes: 1822720
Path table size(bytes): 10674
Max brk space used 469000
41508 extents written (81 Mb)
d787 1
a787 1
The <tt>-R</tt> option tells <tt>mkisofs</tt> to create Rock Ridge
d803 3
a805 3
A commonly used package to do this is the <b>cdrecord</b> program,
contained in the cdrtools package, which is available through OpenBSD's
packages and ports system.
d808 2
a809 3
If you are using once-writable media like CD-R, it is always a good idea
to do a dry run before actually burning the CD-ROM, in order not to waste
any discs.
d812 1
a812 1
# <strong>cdrecord -v -dummy dev=/dev/rcd1c sys.iso</strong>
d815 1
a815 1
If this goes well, you are ready to burn the image created in the above
d819 1
a819 1
# <strong>cdrecord -v dev=/dev/rcd1c sys.iso</strong>
d822 2
a823 3
With the options specified above, we're asking cdrecord to provide
verbose output and to use the second CD-ROM device as the CD writer.
Note that we are passing the <i>raw</i> device to cdrecord.
d838 2
a839 4
To burn audio CDs, you can use <b>cdrecord</b> with the <tt>-audio</tt>
flag, or the <a href="http://cdrdao.sourceforge.net/">cdrdao</a> utility
to write in Disk-At-Once mode and avoid gaps between the audio tracks.
Both utilities are available via OpenBSD's packages and ports system.
d846 1
a846 3
<li>Fetch the audio tracks from the original CD: you can do this with
software like <b>cdparanoia</b>, <b>cdda2wav</b> (bundled with the
<tt>sysutils/cdrtools</tt> package), and <b>cdrdao</b>.
d849 1
a849 1
# <strong>cdrdao read-cd --device /dev/rcd0c cdtracks.toc</strong>
d851 4
a854 4
This command will extract a series of WAV files from your first CD-ROM drive
to your disk, and compile a Table Of Contents (TOC) file.
<li>Write the audio tracks to a blank CD: as mentioned above, use
<b>cdrecord</b> or <b>cdrdao</b>, e.g.
d856 1
a856 1
# <strong>cdrdao write --device /dev/rcd1c cdtracks.toc</strong>
a857 1
If desired, try the <tt>cdrdao simulate</tt> command first.
d1391 1
a1391 1
<small>$OpenBSD: faq13.html,v 1.115 2007/07/09 17:42:06 aanriot Exp $</small>
@


1.115
log
@show the border of each cells in html tables, even if they are empty, so
it's easier to read.

discussed with and ok nick@@
@
text
@d89 1
a89 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dmesg&amp;sektion=1">dmesg(1)</a>
d151 1
a151 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dmesg&amp;sektion=1">dmesg(1)</a>
d681 1
a681 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dmesg&amp;sektion=1">dmesg(1)</a>
d1398 1
a1398 1
<small>$OpenBSD: faq13.html,v 1.114 2007/07/05 07:13:32 steven Exp $</small>
@


1.114
log
@flash plugin is now distributed by Adobe.  lteo.openbsd1 at calyptix.com
@
text
@d915 1
a915 1
<table border="1">
d1398 1
a1398 1
<small>$OpenBSD: faq13.html,v 1.113 2007/06/20 18:14:14 miod Exp $</small>
@


1.113
log
@marc.theaimsgroup.com is now marc.info; reminded by Hank Leininger.
@
text
@d1316 2
a1317 2
The Flash plugin is distributed by Macromedia in binary form only.
Macromedia does not provide a native OpenBSD plugin, but there is a Linux
d1398 1
a1398 1
<small>$OpenBSD: faq13.html,v 1.112 2007/05/04 05:29:56 steven Exp $</small>
@


1.112
log
@bump copyright year
@
text
@d1285 1
a1285 1
<a href="http://marc.theaimsgroup.com/?t=107060510300001&amp;r=1&amp;w=2">this
d1398 1
a1398 1
<small>$OpenBSD: faq13.html,v 1.111 2007/05/01 18:24:10 steven Exp $</small>
@


1.111
log
@switch from redhat to fedora. use pkg_add -i while here.
@
text
@d14 1
a14 1
Copyright (c) 2005, 2006 Steven Mestdagh <steven@@openbsd.org>
d1398 1
a1398 1
<small>$OpenBSD: faq13.html,v 1.110 2006/11/01 05:06:03 steven Exp $</small>
@


1.110
log
@updates for 4.0
@
text
@d1283 1
a1283 1
<tt>graphics/win32-codecs</tt> and <tt>emulators/redhat/base</tt> ports
d1329 1
a1329 1
just add the redhat package.
d1334 1
a1334 1
# <b>pkg_add redhat_base-8.0p8</b>
d1398 1
a1398 1
<small>$OpenBSD: faq13.html,v 1.109 2006/09/22 07:06:04 steven Exp $</small>
@


1.109
log
@rework the paragraph about the cdrom device and permissions. it may be
convenient to add the user accessing the device to the operator group.

looks good nick@@
@
text
@d645 7
a651 4
Some popular DVD playback utilities have been ported to OpenBSD.
Examples are <a href="http://www.dtek.chalmers.se/groups/dvd/">ogle</a>
and <a href="http://www.mplayerhq.hu/">mplayer</a>.
Please read the installation instructions that come with the package,
d1398 1
a1398 1
<small>$OpenBSD: faq13.html,v 1.108 2006/09/21 21:25:14 steven Exp $</small>
@


1.108
log
@one may need to unmute the mixer's cd input.
suggested by emmanuel.jarri at gmail
@
text
@d462 5
a466 7
device.
As this device is in the operator group by default, its permissions can
be adjusted as follows:

<blockquote><pre>
# <strong>chmod o+r /dev/rcd0c</strong>
</pre></blockquote>
d1395 1
a1395 1
<small>$OpenBSD: faq13.html,v 1.107 2006/08/19 17:21:25 steven Exp $</small>
@


1.107
log
@split up java and flash plugin articles.

ok nick@@
@
text
@d471 10
a480 1
If you like a beautiful GUI, there are plenty of X11-based CD players in
d1397 1
a1397 1
<small>$OpenBSD: faq13.html,v 1.106 2006/05/01 06:14:46 steven Exp $</small>
@


1.106
log
@updates for 3.9.  "commit!" nick@@
@
text
@d61 4
a64 2
<li><a href="#javaflash"   >13.10 - Can I have Java and/or Flash plugins in
  my web browser? (i386 only)</a>
d1279 2
a1280 13

<h2>13.10 - Can I have Java and/or Flash plugins in my web browser?
(i386 only)</h2>

While these plugins may be quite popular, they have had quite a number
of security issues over the years.
So, if security is dear to you, think hard before using them.

<p>
<b>Note:</b> we did not test every possible plugin and browser combination.


<h3>13.10.1 - Java</h3>
d1298 3
a1300 1
<b>Note:</b> You do not need Linux emulation to run the Java plugin.
d1303 2
a1304 1
<h3>13.10.2 - Flash</h3>
a1314 1

d1388 1
a1388 1
<small>$OpenBSD: faq13.html,v 1.105 2006/03/09 03:17:45 nick Exp $</small>
@


1.105
log
@
bump copyright date (eliminatate Ms from my tree)
@
text
@d1289 1
a1289 1
<h4>Java</h4>
d1310 1
a1310 1
<h4>Flash</h4>
d1326 1
a1326 2
just add the redhat packages.
Note that the plugin requires the Linux counterpart of Openmotif.
d1331 1
a1331 2
# pkg_add redhat_base-8.0p5.tgz
# pkg_add redhat_motif-2.1.30p1.tgz
d1334 1
a1334 2
The first statement will automatically set <tt>kern.emul.linux=1</tt>,
but not permanently.
a1338 1

d1345 2
a1346 2
One candidate is the <a href="http://www.opera.com">Opera</a> web browser,
available in the <tt>www/opera</tt> subdirectory of the ports tree.
d1351 1
a1351 6
Just issue <tt>make install</tt> in the <tt>www/opera</tt> subdirectory.

<p>
Now it is time to install the Flash plugin.
Download the Linux version from Macromedia's website, extract the archive
and copy the files into the plugins subdirectory:
d1354 4
a1357 1
# cp libflashplayer.so /usr/local/lib/opera/plugins
d1360 1
d1362 4
a1365 5
The above command will interfere with the <a href="faq15.html">packages
and ports system</a>, because this file does not get recorded in the
central package repository on your system.
If you want to remove or upgrade the opera package, first remove the flash
plugin before doing so.
d1395 1
a1395 1
<small>$OpenBSD: faq13.html,v 1.104 2006/01/31 13:30:03 bernd Exp $</small>
@


1.104
log
@We have to install libdvd instead of libdvdcss to play encrypted DVDs.

ok steven@@
@
text
@d14 1
a14 1
Copyright (c) 2005, Steven Mestdagh <steven@@openbsd.org>
d1401 1
a1401 1
<small>$OpenBSD: faq13.html,v 1.103 2006/01/06 23:53:56 steven Exp $</small>
@


1.103
log
@thanks to Sigfred Haversen for testing DVD-RAM and pointing out a memory
problem with mkhybrid(8) for large trees; switch examples to mkisofs.

feedback/ok nick@@
@
text
@d653 1
a653 2
<a href="http://www.videolan.org/libdvdcss/">libdvdcss</a>
library, also available through packages and ports.
d1401 1
a1401 1
<small>$OpenBSD: faq13.html,v 1.102 2005/12/13 17:19:57 steven Exp $</small>
@


1.102
log
@fix mkhybrid(8) man page section number.
spotted by Carlos Valiente <superdupont at gmail.com>
@
text
@d746 5
a750 1
utility, which comes with the base system.
d757 1
a757 1
$ <strong>mkhybrid -R -o sys.iso /usr/src/sys</strong>
d776 1
a776 1
The <tt>-R</tt> option tells <tt>mkhybrid</tt> to create Rock Ridge
d871 2
a872 1
For instance, DVD-RAM remains untested.
d1000 1
a1000 1
$ <strong>mkhybrid -R -o cvs.iso /cvs</strong>
a1050 4
Note that, in the case of writing directly to DVD, growisofs will call
mkisofs, from the cdrtools package on which dvd+rw-tools depends, and not
mkhybrid from the base system.

d1402 1
a1402 1
<small>$OpenBSD: faq13.html,v 1.101 2005/12/11 22:50:40 steven Exp $</small>
@


1.101
log
@change my e-mail address. ok nick@@
@
text
@d745 1
a745 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mkhybrid&amp;sektion=1">mkhybrid(1)</a>
d1401 1
a1401 1
<small>$OpenBSD: faq13.html,v 1.100 2005/11/25 20:23:06 steven Exp $</small>
@


1.100
log
@move JDK build instructions from faq13 to faq8 programming languages article.

suggested by ian@@, ok nick@@
@
text
@d14 1
a14 1
Copyright (c) 2005, Steven Mestdagh <steven.mestdagh@@esat.kuleuven.be>
d1401 1
a1401 1
<small>$OpenBSD: faq13.html,v 1.99 2005/11/01 11:39:56 nick Exp $</small>
@


1.99
log
@
update for 3.8
@
text
@d1292 1
a1292 2
Due to Sun's restrictive SCSL license, OpenBSD cannot ship binary packages
for the JDK.
d1294 5
a1298 1
Note that you will need plenty of RAM for this build to succeed.
a1300 35
The JDK ports are in the <tt>devel/jdk</tt> subdirectory of the ports tree.
You can choose among different versions, each in their own subdirectory.
Only the 1.3 and 1.4 versions have a browser plugin.
When you just type <tt>make</tt>, you will see a message asking you to
to fetch the source files manually from Sun's website.
Before you can do that, you need to register on that website, and agree
with the license.
That's why the ports framework cannot start the download automatically.

<p>
Once you have downloaded the necessary distribution files and patch sets,
copy them to the <tt>/usr/ports/distfiles</tt> directory and start the
build by issuing <tt>make</tt> in the port's subdirectory.


<p>
The JDK requires a working Java 2 compiler as a bootstrap to build.
For this purpose, the port uses a Linux version of the JDK.
If you feel this is unfair, you should ask Sun why they do not provide
a native OpenBSD version.
Linux emulation on OpenBSD is restricted to i386 systems, and so the
JDK will build only on i386.
The ports framework should take care of installing the necessary files
and setting <tt>kern.emul.linux=1</tt>.
For more information, please read about Linux emulation in the
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=compat_linux&amp;sektion=8">compat_linux(8)</a>
manual page, and also
<a href="faq9.html#Interact">FAQ 9 - Running Linux binaries on OpenBSD</a>.
Note that this Linux emulation is only required during the build of the
JDK, which results in a native OpenBSD JDK.
<b>You do not need Linux emulation to run the Java plugin.</b>

<p>
After many hours, the build will finish.
Just continue with <tt>make install</tt> to install the JDK.
d1303 1
a1303 1
Make the symlink as explained, and then you should see the Java plugin
d1306 3
d1401 1
a1401 1
<small>$OpenBSD: faq13.html,v 1.98 2005/10/28 01:36:38 nick Exp $</small>
@


1.98
log
@
Add info on fixed-rate soundcards and other troubleshooting guidance.
Diff directly from Steven Mestdagh, encouragement and ok jolan@@.
@
text
@d621 4
a624 5
Currently, OpenBSD supports DVD media through the ISO 9660 filesystem which
is also used on CD-ROMs.
<!-- XXXchange: UDF will be supported as of 3.8 -->
The newer <a href="http://www.osta.org/specs/">Universal Disk Format (UDF)</a>
filesystem on some DVDs is not supported.
d627 2
a628 3
file systems.
This bridge format provides backwards compatibility for operating systems
which do not yet support UDF.
d774 2
a775 2
The Rock Ridge Interchange Protocol was created to support POSIX file system
semantics in ISO 9660 file systems, such as longer file names, ownerships,
d1430 1
a1430 1
<small>$OpenBSD: faq13.html,v 1.97 2005/10/19 21:47:14 nick Exp $</small>
@


1.97
log
@
Clarify comments about Opera, inspired by sturm@@, written by Steven Mestdagh.
ok sturm@@
@
text
@d112 8
a119 1
Otherwise there are a number of possibilities:
d134 24
a157 2
<b>Note:</b>
Not every variation or utilization of every chip has been tested or debugged.
d334 17
d1432 1
a1432 1
<small>$OpenBSD: faq13.html,v 1.96 2005/10/19 10:24:31 nick Exp $</small>
@


1.96
log
@
With or without source code, the quality of Flash's code is questionable.
Suggested by sturm@@.
@
text
@d1334 4
a1337 4
One candidate is the Opera web browser, available in the <tt>www/opera</tt>
subdirectory of the ports tree.
OpenBSD cannot distribute packages for it, since Opera is commercial
software.
d1339 1
a1339 1
binary form.
d1352 3
a1354 2
The above command will interfere with the package system, because this file
does not get recorded in the central package repository on your system.
d1386 1
a1386 1
<small>$OpenBSD: faq13.html,v 1.95 2005/10/19 10:12:53 nick Exp $</small>
@


1.95
log
@
adding files manually messes with the ports system, so here's a warning.
From Steven Mestdagh, thanks!
@
text
@a1297 2
The fact that the source is not released raises questions about the
quality of the code.
d1385 1
a1385 1
<small>$OpenBSD: faq13.html,v 1.94 2005/10/19 00:41:20 nick Exp $</small>
@


1.94
log
@
New: #javaflash
Steven Mestdagh strikes again, with the frequently asked questions about
Java and Flash in OpenBSD browsers.  (personally, lack of those two
disasters makes a good case to USE OpenBSD, but hey, to each their own).
@
text
@d1353 7
d1387 1
a1387 1
<small>$OpenBSD: faq13.html,v 1.93 2005/10/10 02:45:22 nick Exp $</small>
@


1.93
log
@
PR4537: win32codecs ->win32-codecs, reported by Simon Morgan (simon at
16hz dot net), thanks
@
text
@d61 2
d1232 125
d1380 1
a1380 1
<small>$OpenBSD: faq13.html,v 1.92 2005/08/14 03:36:15 nick Exp $</small>
@


1.92
log
@
Steven Mestdagh's improvements on his own work -- sometimes it isn't
always "outputs.master".  Thanks!
@
text
@d1225 1
a1225 1
<tt>graphics/win32codecs</tt> and <tt>emulators/redhat/base</tt> ports
d1253 1
a1253 1
<small>$OpenBSD: faq13.html,v 1.91 2005/08/09 08:23:07 jmc Exp $</small>
@


1.91
log
@AC'97, according to spec;
also, style fix from nick@@

ok deraadt@@ nick@@
@
text
@d138 1
a138 1
you would issue
d148 1
a148 1
Obviously, other hardware could use a different number of bytes.
d170 1
a170 1
<b>Note:</b>
d176 12
d1253 1
a1253 1
<small>$OpenBSD: faq13.html,v 1.90 2005/07/09 01:49:25 nick Exp $</small>
@


1.90
log
@
Wording improvements, directly from Steven Mestdagh (and stuck in my inbox
for WAY too long, sorry Steven!)
@
text
@d146 1
a146 1
The reason for this is that my audio device has an AC97 codec, which uses
d1241 1
a1241 1
<small>$OpenBSD: faq13.html,v 1.89 2005/06/27 01:54:12 nick Exp $</small>
@


1.89
log
@
I Will Run validator.w3.org BEFORE Commit.
I Will Run validator.w3.org BEFORE Commit.
I Will Run validator.w3.org BEFORE Commit.
@
text
@d563 1
d1046 2
a1047 2
One sound conversion tool is <tt>audio/sox</tt>, available through ports
and packages.
d1081 2
a1082 1
Currently support for MPEG and AVI containers is most mature.
d1091 1
a1091 1
It should also be possible to use the XviD encoder from
d1241 1
a1241 1
<small>$OpenBSD: faq13.html,v 1.88 2005/06/27 01:40:57 nick Exp $</small>
@


1.88
log
@
Add two new sections: #convert  and  #streaming.
Yet Another fantastic addtion from Steven Mestdagh, thanks!
@
text
@d58 1
a58 1
<li><a href="#convert"    >13.8 - But I want my media files in format FOO.
d1213 2
a1214 2
<a href="http://marc.theaimsgroup.com/?t=107060510300001&r=1&w=2">this thread</a>
on the ports mailing list).
d1239 1
a1239 1
<small>$OpenBSD: faq13.html,v 1.87 2005/05/02 10:41:15 nick Exp $</small>
@


1.87
log
@
From Steven Mestdagh: "Just discovered that we _can_ actually play most
MOD formats with xmms :)"  Thanks!
@
text
@d58 3
d62 2
a63 2
<li><a href="#camera"     >13.8 - Can I use my digital camera under OpenBSD?</a>
<li><a href="#scanner"    >13.9 - How do I set up and use my scanner?</a>
a500 7
<h3>Converting your sample to other audio formats</h3>

Let's say we want to process the sound recording in the raw format.
Then it will be useful to convert it, because this raw format has no headers
and the recording parameters will need to be specified at every usage of
the file.

d502 4
a505 3
A good sound conversion tool is <tt>audio/sox</tt>, available through ports
and packages.
Below is an example for converting the recording to RIFF WAV format.
a506 6
<blockquote><pre>
$ <strong>sox -U -c 1 -r 8000 -b myvoice.raw myvoice.wav</strong>
</pre></blockquote>

Note that the specified parameters correspond to the recording parameters
specified before the recording.
d1032 185
d1221 1
a1221 1
<h2>13.8 - Can I use my digital camera under OpenBSD?</h2>
d1224 1
a1224 1
<h2>13.9 - How do I set up and use my scanner?</h2>
d1239 1
a1239 1
<small>$OpenBSD: faq13.html,v 1.86 2005/05/01 17:26:02 nick Exp $</small>
@


1.86
log
@
Revert the last one.  One problem with using packages: my ports tree was
WAY out of date, this has changed.  Won't be on CDs, but only a fraction
of packages are on the CDs anyway.  yes, this is a 3.7ism, but that's only
a short time away.
@
text
@d14 1
a14 1
Copyright (c) 2005, Steven Mestdagh <steven.mestdagh@@esat.kuleuven.ac.be>
d357 13
a369 4
To play your favorite MOD files on OpenBSD, you will find a number of
so-called "trackers" in the <tt>audio</tt> section of the packages and
ports collection, e.g. tracker, soundtracker. Note, however, that not
every tracker format is supported by the tools in the ports tree.
d1063 1
a1063 1
<small>$OpenBSD: faq13.html,v 1.85 2005/05/01 14:01:06 nick Exp $</small>
@


1.85
log
@
sox not redistributable, thus ports-only, no package.
From Marcos Latas <carvalholatas at gmail dot com), thanks!
@
text
@d498 1
a498 1
(not packages, however, due to redistribution issues).
d1054 1
a1054 1
<small>$OpenBSD: faq13.html,v 1.84 2005/04/27 00:26:02 nick Exp $</small>
@


1.84
log
@
wrong app.  Spotted by Fabio Olive Leite (fabio.olive at gmail dot com)
@
text
@d498 1
a498 1
and packages.
d1054 1
a1054 1
<small>$OpenBSD: faq13.html,v 1.83 2005/04/24 16:14:44 nick Exp $</small>
@


1.83
log
@
Whole new file: 13 - Multimedia
Written by Steven Mestdagh (steven.mestdagh at esat.kuleuven.ac.be),
this is a fantastic addition to the FAQ, many thanks to Steven for some
great work that will help a lot of people have a lot of fun with OpenBSD.
Not yet connected to the rest of the website.
@
text
@d713 2
a714 2
The <tt>-R</tt> option tells cdrecord to create Rock Ridge extensions in
the ISO 9660 image.
d1054 1
a1054 1
<small>$OpenBSD$</small>
@


1.82
log
@
make "OpenBSD" logo on top of page a "click back" to the OpenBSD home page.
(about time!)
@
text
@d4 1
a4 1
<title>13 - Using IPsec</title>
a5 1
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
d10 1
a10 1
<meta name= "copyright"     content= "This document copyright 2000-2004 by OpenBSD">
d13 17
d31 1
d38 2
a39 2
<a href= "faq12.html">[To Section 12 - For Advanced Users]</a>
<a href= "faq14.html">[To Section 14 - Using disks in OpenBSD]</a>
d42 21
a62 1
<h1><font color="#e00000">13 - Using IPsec (IP Security Protocol)</font></h1>
d65 926
d992 8
a999 1
Due to being insufficiently maintained, this section has been removed.
d1002 4
a1005 1
Hopefully, it will return at a future date.
d1007 34
d1045 2
a1046 2
<a href= "faq12.html">[To Section 12 - For Advanced Users]</a>
<a href= "faq14.html">[To Section 14 - Using disks in OpenBSD]</a>
d1054 1
a1054 1
<small>$OpenBSD: faq13.html,v 1.81 2004/01/01 04:13:34 nick Exp $</small>
d1058 1
@


1.81
log
@
bump copyright to 2004
@
text
@d15 3
a17 1
<img alt="[OpenBSD]" height=30 width=141 src="../images/smalltitle.gif">
d47 1
a47 1
<small>$OpenBSD: faq13.html,v 1.80 2003/07/25 19:55:38 nick Exp $</small>
@


1.80
log
@
Remove unmaintained and inaccurate document.

There are some commits I love to make...  This is not one of them.  This
document was the work of many people, both the people who created it
originally, plus all the translators who have spent considerable time
making it more available in other languages.  And to all these people, I
apologize for the need to do this.  Unfortunately, it has not been
maintained, is not accurate, and no one has stepped forward to revamp
(and test!) the _whole thing_ to bring it up to date.  Unfortunately, a
little fix here and little fix there only makes things less wrong.  This
is not what OpenBSD docs are supposed to be.

Per discussion with JMC, Henning, Markus.
@
text
@d11 1
a11 1
<meta name= "copyright"     content= "This document copyright 2000-2003 by OpenBSD">
d45 1
a45 1
<small>$OpenBSD: faq13.html,v 1.79 2003/07/25 19:29:31 faq Exp $</small>
@


1.79
log
@
finish removing numeric targets (<a name="9.3">).  No words changed.
Also removed some inert stuff from faq11.html...
@
text
@d27 1
a27 14
<h3>Table of Contents</h3>
<ul>
<li><a href="#What"     >13.1 - What is IPsec?</a>
<li><a href="#Why"      >13.2 - That's nice, but why do I want to use IPsec?</a>
<li><a href="#Protocols">13.3 - What are the protocols behind IPsec?</a>
<li><a href="#Wire"     >13.4 - On the wire format</a>
<li><a href="#Config"   >13.5 - Configuring IPsec</a>
<li><a href="#ManKey"   >13.6 - How do I set up IPsec with manual keying?</a>
<li><a href="#isakmpd"  >13.7 - How do I set up isakmpd?</a>
<li><a href="#x509"     >13.8 - How do I use isakmpd with X.509 certificates?</a>
<li><a href="#IKEcl"    >13.9 - What IKE clients are compatible with isakmpd?</a>
<li><a href="#Trouble"  >13.10 - Troubleshooting IPsec/VPN</a>
<li><a href="#SeeAlso"  >13.11 - Related Documentation</a>
</ul>
d30 1
a30 833
<font size="-1">
Portions of this document were taken from:
</font>
<ul style="font-size: small">
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ipsec&amp;sektion=4">ipsec(4)</a>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=vpn&amp;sektion=8">vpn(8)</a>
<li><a href="http://www.freebsd.org/~julian/IPSEC_4_Dummies.html">IPsec for Dummies</a> by Julian Elischer
<li><a href="http://www.secureops.com/vpn/vpn.html">ISAKMP Howto</a> by Patrick Ethier
<li><a href="http://hem.passagen.se/hojg/isakmpd/">X.509v3 certificates with isakmpd</a> by J&ouml;rgen Granstam
</ul>

<hr>

<p>
<a name= "What"></a>
<h2>13.1 - What is IPsec?</h2>

<p>
IPsec is a set of extensions to the IP protocol family.   It provides
cryptographic security services.  These services allow for authentication,
integrity, access control, and confidentiality.  IPsec provides
similar services as SSL, but at the network layer, in a way that is completely
transparent to your applications, and much more powerful.  We say this
because your applications do not have to have any knowledge of IPsec to be
able to use it.
You can use <a href="http://www.openbsd.org/cgi-bin/cvsweb/src/etc/protocols?rev=1.13">any IP protocol</a> over IPsec.  You can create encrypted tunnels (VPNs), or just do encryption between computers.
Since you have so many options, IPsec is rather complex (much more so than SSL!)

<p>
Before you start using IPsec, we strongly recommend that you check out
the "recommended reading" of <a href="faq6.html">part 6</a> of the FAQ.
In particular, if you don't already understand it, the 
<a href="http://www.3com.com/corpinfo/en_US/technology/tech_paper.jsp?DOC_ID=135">Understanding
IP Addressing</a> (or 
<a href="http://www.3com.com/other/pdfs/infra/corpinfo/en_US/501302.pdf">here</a>)
document is highly recommended.

<p>
In a logical sense, IPsec works in any of these three ways:

<ul>
<li>Host-to-Host
<li>Host-to-Network
<li>Network-to-Network
</ul>

<p>
In every scenario that involves a network, we mean to imply
router.  As in, Host-to-Router (and this router controls and encrypts
traffic for a particular <i>Network</i>).

<p>
As you can see, IPsec can be used to tunnel traffic for VPN connections.
However, its utility reaches beyond VPNs.  With a central Internet Key Exchange
registry, every machine on the Internet could talk to another one
and employ powerful encryption and authentication!

<p>
<a name= "Why"></a>
<h2>13.2 - That's nice, but why do I want to use IPsec?</h2>

<p>
The internet protocol, IP, aka IPv4, does not inherently provide any protection
to your transferred data.  It does not even guarantee that the
sender is who he says he is.  IPsec tries to remedy this.  These services 
are considered distinct, but the IPsec supports them in a uniform manner. 

<p>
<h4>Confidentiality</h4> Ensure it is hard for anyone but the receiver
to understand what data has been communicated.  For example, ensuring
the secrecy of passwords when logging into a remote machine over the
Internet.

<p>
<h4>Integrity</h4> Guarantee that the data does not get changed on the
way.  If you are on a line carrying invoicing data you probably
want to know that the amounts and account numbers are correct and
not altered while in-transit.

<p>
<h4>Authenticity</h4> Sign your data so that others can see that it is really
you that sent it.  It is clearly nice to know that documents
are not forged.

<p>
<h4>Replay protection</h4> We need ways to ensure a datagram is
processed only once, regardless of how many times it is received.
I.e. it should not be possible for an attacker to record a transaction
(such as a bank account withdrawal), and then by replaying it verbatim
cause the peer to think a new message (withdrawal request) had been
received.  <i>WARNING: as per the standards specification, replay
protection is not performed when using manual-keyed IPsec (e.g., when
using <a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=ipsecadm&amp;sektion=8">ipsecadm(8)</a>)</i>.

<p>
<a name= "Protocols"></a>
<h2>13.3 - What are the protocols behind IPsec?</h2>

<p>
IPsec provides confidentiality, integrity, authenticity, and replay
protection through two new protocols.  These protocols are called
Authentication Header (AH), and Encapsulating Security Payload (ESP).

<p>
AH provides authentication, integrity, and replay protection (but not
confidentiality).  The main difference between the authentication
features of AH and ESP is that AH also authenticates portions of the
IP header of the packet (such as the source/destination addresses).
ESP authenticates only the packet payload.

<p>
ESP can provide authentication, integrity, replay protection, and
confidentiality of the data (it secures everything in the packet that follows
the  header). Replay protection requires authentication and integrity
(these two go always together). Confidentiality (encryption) can be used
with or without authentication/integrity. Similarly, one could use
authentication/integrity with or without confidentiality.

<p>In practice, it is recommended that ESP be used for most applications.

<p>
<a name= "Wire"></a>
<h2>13.4 - On the wire format</h2>

<p>
The <b>Authentication Header</b>
(AH) comes after the basic IP header and contains cryptographic
hashes of the data and identification information. The hashes can
also cover the invariant parts of the IP header itself. There are
several different RFCs giving a choice of actual algorithms to use in the
AH, however they all must follow the guidelines specified in <a href="http://www.cis.ohio-state.edu/htbin/rfc/rfc2402.html">RFC2402</a>.

<p>
The <b>Encapsulating
Security Payload</b> (ESP) header, allows for rewriting of the payload
in encrypted form. The ESP header does not consider the fields of the IP
header before it and therefore makes no guarantees about anything except
the payload. The various types of ESP applicable must follow <a href="http://www.cis.ohio-state.edu/htbin/rfc/rfc2406.html">RFC2406</a>.
An ESP header can also provide authentication for the payload, (but not
the outer header).

<p>
An orthogonal (mostly) division of IPsec functionality is applied depending
on whether the endpoint doing the IPsec encapsulation is the original source
of the data or a gateway:

<ul>
<li><b>Transport</b> mode is used by a host that is generating the packets.
In transport mode, the security headers are added before the transport
layer (e.g . TCP, UDP) headers, before the IP header is prepended to the
packet. In other words an AH added to the packet will cover the hashing
of the TCP header and some fields of the end-to-end IP header, and an ESP
header will cover the encryption of the TCP header and the data, but
not the end-to-end IP header.

<li><b>Tunnel</b> mode is used when the end-to-end IP header is already
attached to the packet, and one of the ends of the secure connection is
only a gateway. In this mode, the AH and ESP headers are used to cover
the entire packet including the end-to-end header, and a new IP header
is prepended to the packet that covers just the hop to the other end of
the secure connection (though that may of course be several IP hops away).
</ul>

<p>IPsec secured links are defined in terms of <b>Security Associations
</b>(SAs). Each SA is defined for a single unidirectional flow of data,
and usually (ignoring multicast) from one single point to another, covering
traffic distinguishable by some <b>unique selector</b>. All traffic flowing
over a single SA is treated the same. Some traffic may be subject to several
SAs, each of which applies some transform. Groups of SAs are called an
SA <b>Bundle</b>. Incoming packets can be assigned to a particular SA by
the three defining fields, (<b>Destination IP address, Security Parameter
Index, security protocol</b>). SPI can be considered a cookie that is handed
out by the receiver of the SA when the parameters of the connection are
negotiated. The security protocol must be either AH or ESP. Since the IP
address of the receiver is part of the triple, this is a guaranteed unique
value. They can be found from the outer IP header and the first security
header (which contains the SPI and the security protocol).

<p>
An example of a tunnel mode AH packet is:

<p>
<table border="1">
<tr>
<td><b>IPhdr</b></td>
<td><b>AH</b></td>
<td>IPhdr2</td>
<td>TCPhdr</td>
<td>data</td>
</tr>
</table>

<p>
An example of a transport mode AH packet is:

<p>
<table border="1">
<tr>
<td><b>IPhdr</b></td>
<td><b>AH</b></td>
<td>TCPhdr</td>
<td>data</td>
</tr>
</table>

<p>
Because an ESP header cannot authenticate the outer IP header,
it is useful to combine an AH and an ESP header to get the following:

<p>
<table border="1">
<tr>
<td><b>IPhdr</b></td>
<td><b>AH</b></td>
<td><b>ESP</b></td>
<td><i>TCPhdr</i></td>
<td><i>data</i></td>
</tr>
</table>

<p>This is called <b>Transport Adjacency</b>. The tunneling version would
look like:

<p>
<table border="1">
<tr>
<td><b>IPhdr</b></td>
<td><b>AH</b></td>
<td><b>ESP</b></td>
<td><i>IPhdr2</i></td>
<td><i>TCPhdr</i></td>
<td><i>data</i></td>
</tr>
</table>

<p>
However it is not specifically mentioned in the RFC. As with Transport
adjacency, this would authenticate the entire packet except a few headers
in the IP header and also encrypt the payload (seen in italics). When
an AH and an ESP header are directly applied together like this,
the order of the headers should be as shown. It is possible in tunnel mode,
to do arbitrary recursive encapsulation so that order is not specified.

<p>
<a name= "Config"></a>
<h2>13.5 - Configuring IPsec</h2>

<p>
How the IPsec systems and gateways are configured is to some extent
left to the designer, however the RFC has some strong recommendations as
to how this should be implemented, so as to minimize confusion.

<p>
There are two administrative entities that control what happens to a
packet. One is the <b>Security Association Database</b> (SAD, referred
to as TDB or TDB table throughout OpenBSD's IPsec source code)
and the other is the <b>Security Policy Database</b> (SPD).

<p>
They are similar in that given a number of selectors that describe some
traffic, they will deliver an entry that describes the processing needed.
However, the SPD is two steps removed from the actual processing: the
SPD is used for outgoing packets, to decide what SAD entries should
be used, and the SAD entries in turn describe the actual process and the
parameters for it. The SPD entries specify the existing SAD entries
to use (if it's a bundle there can be more than 1), but if there is not
already a suitable one, it is used to create new ones. The fields of the
SA being created can be taken either from the SPD entry or from the packet
that initiated the creation.

<p>
Outgoing packets go from the SPD entry to the specific SA, to get encoding
parameters. Incoming packets get to the correct SA directly using the
SPI/DestIP/Proto triple, and from there get to the SPD entry.

<p>
The SPD can also specify what traffic should bypass IPsec and what should
be dropped, so it must also be consulted for incoming non-IPsec traffic.
SPD entries must be explicitly ordered as several might match a particular
packet, and the processing must be reproducible.

<p>
The SPD can be thought of as similar to a packet filter where the actions
decided upon are the activation of SA processes. Selectors can include
src and dest address, port numbers if relevant, application and user IDs
if available (only on host based transport SAs), hostnames, security
sensitivity levels, protocols, etc.

<p>
A SAD entry would include:

<ul>
<li>Dest IP address
<li>IPsec proto (AH or ESP)
<li>SPI (cookie)
<li>Sequence counter
<li>Seq O/F flag
<li>Anti-replay window info
<li>AH type and info
<li>ESP type and info
<li>Lifetime info
<li>Tunnel/transport mode flags
<li>Path MTU info
</ul>

<p>
A SPD entry would contain:

<ul>
<li>Pointer to active SAs
<li>Selector fields
</ul>

<p>
Each SA can define one ESP header and one AH header.
An IPsec session must have one or the other or both, but cannot be defined
with neither - otherwise there would be no headers to specify the SPI
to look up the SA. The RFC doesn't say what would happen if the
AH and ESP headers disagree about the SPI value. One would presume
this would imply multiple SAs in a bundle.

<p>
The SPD in OpenBSD is managed through the <tt>ipsecadm flow</tt> command.
(You would only make changes to it if you were using manual keying.)
SAD entries can be set manually with
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ipsecadm&amp;sektion=8">ipsecadm(8)</a>,
however the IETF has also defined automatic mechanisms
for initialization of sessions and such things as key exchange.
OpenBSD implements ISAKMP automatic key exchange
(<a href="http://www.cis.ohio-state.edu/htbin/rfc/rfc2407.html">RFC2407</a>,
<a href="http://www.cis.ohio-state.edu/htbin/rfc/rfc2408.html">RFC2408,</a> and
<a href="http://www.cis.ohio-state.edu/htbin/rfc/rfc2409.html">RFC2409</a>)
in the
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=isakmpd&amp;sektion=8">isakmpd(8)</a>
daemons.

<p>
<a name= "ManKey"></a>
<h2>13.6 - How do I set up IPsec with manual keying?</h2>

<p>
Manual keying is the easiest way to get started with IPsec.
You can set up encryption between networks, to create VPNs using this
method.  After you have read this section, you may want to
investigate using <a href="http://www.openbsd.org/cgi-bin/cvsweb/src/share/ipsec/rc.vpn?rev=1.15">/usr/share/ipsec/rc.vpn</a>
to set this up for you automatically.

<p>
First, you need to ensure that the IP ESP protocol is
enabled in the OpenBSD kernel. Though it is enabled by default,
you should verify this fact by doing the following:

<blockquote><tt>
# <b>sysctl net.inet.esp.enable</b><br>
net.inet.esp.enable = 1<br>
</tt></blockquote>

<p>Similarly, if AH is required, verify that it has been enabled:
<blockquote><tt>
# <b>sysctl net.inet.ah.enable</b><br>
net.inet.ah.enable = 1
</tt></blockquote>


<p>
 If necessary,
these protocols may be enabled using the <i>-w</i> option to
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&amp;sektion=8"
>sysctl(8)</a>.

<p>
You can edit <tt>/etc/sysctl.conf</tt> to turn these on (or off) at boot time.
You need to remove the <i>#</i> mark from in front of <i>net.inet.esp.enable</i> and/or
<i>net.inet.ah.enable</i>
(depending on which you plan to use) and make sure they are set to 1.

<p>
Note that in most cases, such as with the <i>rc.vpn</i> script or with the
example below, only ESP is required.  In these cases, <i>you do not
need to enable AH</i>. In fact, there may be security concerns
related to enabling AH if you are not using it.

<p>
Next, you will need to generate your manual keys.
Since the security of the VPN is based on these keys being unguessable,
it is very important that the keys be chosen using a strong random
source.  One practical method of generating them is by using the
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=random&amp;sektion=4">random(4)</a>
device. To produce 160 bits (20 bytes) of randomness, for example, do:

<blockquote><tt>
# <b>openssl rand 20 | hexdump -e '20/1 "%02x"'</b>
</tt></blockquote>

<p>
The number of bits produced is important.  Different cipher types may require different sized keys.

<pre>
Cipher    Key Length
DES       56 bits
3DES      168 bits
BLF       Variable (160 bits recommended)
CAST      Variable (40-128 bits recommended)
SKIPJACK  80 bits
</pre>

<p>
Now, you need to set up SAs, or Security Associations.
A Security Association is a combination of your IP addresses, an SPI, and
your security protocol (AH and/or ESP). The IP addresses are both your
own and that of your destination.  The SPI, or Security Parameter
Index, is a number that OpenBSD uses to classify different SAs.

<p>
<i>These examples only use ESP to encrypt your traffic.  ESP includes
authentication of the contained encrypted data, but does not authenticate
the surrounding IP header, as AH would.  This "limited authentication"
is nevertheless quite sufficient in most cases, especially for ESP in a
tunnel environment.</i>

<blockquote><tt>
# <b>ipsecadm new esp -spi SPI_OUT -src MY_EXTERNAL_IP -dst PEER_EXTERNAL_IP
-forcetunnel -enc blf -auth sha1 -key ENC_KEY -authkey AUTH_KEY</b>
</tt></blockquote>

<p>
Let's put this into practice with two routers, 192.168.5.1 and 192.168.25.9.

<p>
On Host 192.168.5.1:

<blockquote><tt>
# <b>ipsecadm new esp -spi 1000 -src 192.168.5.1 -dst 192.168.25.9 -forcetunnel -enc blf -auth sha1 -key 7762d8707255d974168cbb1d274f8bed4cbd3364 -authkey 6a20367e21c66e5a40739db293cf2ef2a4e6659f</b><br>
# <b>ipsecadm new esp -spi 1001 -dst 192.168.5.1 -src 192.168.25.9 -forcetunnel -enc blf -auth sha1 -key 7762d8707255d974168cbb1d274f8bed4cbd3364 -authkey 6a20367e21c66e5a40739db293cf2ef2a4e6659f</b>
</tt></blockquote>

<p>
On Host 192.168.25.9:

<blockquote><tt>
# <b>ipsecadm new esp -spi 1001 -src 192.168.25.9 -dst 192.168.5.1 -forcetunnel -enc blf -auth sha1 -key 7762d8707255d974168cbb1d274f8bed4cbd3364 -authkey 6a20367e21c66e5a40739db293cf2ef2a4e6659f</b><br>
# <b>ipsecadm new esp -spi 1000 -dst 192.168.25.9 -src 192.168.5.1 -forcetunnel -enc blf -auth sha1 -key 7762d8707255d974168cbb1d274f8bed4cbd3364 -authkey 6a20367e21c66e5a40739db293cf2ef2a4e6659f</b>
</tt></blockquote>

<p>
Notice that the SPIs are different.  See <a href="#Wire">On the wire format</a> for a complete description of what the SPI is and where it is used.

<p>
Now that you have your Security Associations in place,
set up your flows.

<p>
On 192.168.5.1:

<p>
So, right here, <b>two</b> flows will be created, one the local
source address, which covers all packets originating from the local host
to the destination, as well as a flow from the destination back to the local
host.

<blockquote><tt>
# <b>ipsecadm flow -proto esp -dst 192.168.25.9 -spi 1000 -addr 192.168.5.1 255.255.255.255 192.168.25.9 255.255.255.255</b>
</tt></blockquote>

<p>
On 192.168.25.9:

<blockquote><tt>
# <b>ipsecadm flow -proto esp -dst 192.168.5.1 -spi 1001 -addr 192.168.25.9 255.255.255.255 192.168.5.1 255.255.255.255</b>
</tt></blockquote>

<p>
If you want less overhead on your Host-to-Host VPNs, creating the SPI
without <tt>-forcetunnel</tt> will let you use transport mode (whereas, <tt>-forcetunnel</tt>
makes sure all of the IP packet, including the IP header, are encapsulated
by SPI).  If either
the source or destination is a network, you will have to use tunnel
mode.  Creating an SA to and/or from a network will automatically ensure
tunnel mode SPIs are being created.

<p>
This is a simple way to start using IPsec.

<p>
You can use IPsec to tunnel private IP address spaces over the Internet.
Here is a good example... We want to tunnel 192.168.99.0/24, which is behind
208.1.1.1, to 208.1.2.0/24 and 208.1.5.0/24 which are behind 208.2.2.2.
These examples were generated using the <a href="http://www.openbsd.org/cgi-bin/cvsweb/src/share/ipsec/rc.vpn?rev=1.3">rc.vpn</a> script.

<p>
As you can see, when you are using manual keying with IPsec,
you have to specify <b>exactly</b> what you want done.
It won't guess for you.  Look at these examples...


<h2>On 208.1.1.1:</h2>
First, set up the security associations (SAs):<br>
(This sets up the SPIs, encryption methods, and keys.) 

<blockquote><tt>
# <b>ipsecadm new esp -src 208.1.1.1 -dst 208.2.2.2 -forcetunnel -spi 1001 -enc blf -auth sha1 -key 7762d8707255d974168cbb1d274f8bed4cbd3364 -authkey 67e21c66e5a40739db293cf2ef2a4e6659f</b><br>
# <b>ipsecadm new esp -src 208.2.2.2 -dst 208.1.1.1 -forcetunnel -spi 1000 -enc blf -auth sha1 -key 7762d8707255d974168cbb1d274f8bed4cbd3364 -authkey 67e21c66e5a40739db293cf2ef2a4e6659f</b><br>
</tt></blockquote>

<p>
Next, set up a flow from 208.1.1.1 to 208.2.2.2

<blockquote><tt>
# <b>ipsecadm flow -proto esp -dst 208.2.2.2 -spi 1001 -addr 208.1.1.1 255.255.255.255 208.2.2.2 255.255.255.255</b><br>
</tt></blockquote>

<p>
Next, set up a flow from 208.1.2.0/24, which is behind 208.2.2.2, to 192.168.99.0/24

<blockquote><tt>
# <b>ipsecadm flow -proto esp -dst 208.2.2.2 -spi 1001 -addr 192.168.99.0 255.255.255.0 208.1.2.0 255.255.255.0</b><BR>
</tt></blockquote>

<p>
Next, set up a flow from 208.1.5.0/24, which is behind 208.2.2.2, to 192.168.99.0/24

<blockquote><tt>
# <b>ipsecadm flow -proto esp -dst 208.2.2.2 -spi 1001 -addr 192.168.99.0 255.255.255.0 208.1.5.0 255.255.255.0</b><br>
</tt></blockquote>

<p>
Now, set up a flow from 208.1.2.0/24, which is behind 208.2.2.2 to the router 208.1.1.1.

<blockquote><tt>
# <b>ipsecadm flow -proto esp -dst 208.2.2.2 -spi 1001 -addr 208.1.1.1 255.255.255.255 208.1.2.0 255.255.255.0</b><br>
</tt></blockquote>

<p>
OK, set up a flow from 208.1.5.0/24, which is behind 208.2.2.2, to the router 208.1.1.1

<blockquote><tt>
# <b>ipsecadm flow -proto esp -dst 208.2.2.2 -spi 1001 -addr 208.1.1.1 255.255.255.255 208.1.5.0 255.255.255.0</b><br>
</tt></blockquote>

<p>
Finally, set up a flow from the router 208.2.2.2 to 192.168.99.0/24

<blockquote><tt>
# <b>ipsecadm flow -proto esp -dst 208.2.2.2 -spi 1001 -addr 192.168.99.0 255.255.255.0 208.2.2.2 255.255.255.255</b><br>
</tt></blockquote>


<h2>On 208.2.2.2:</h2>

<p>
Same as before, we set up the SAs...

<blockquote><tt>
# <b>ipsecadm new esp -src 208.2.2.2 -dst 208.1.1.1 -forcetunnel -spi 1000 -enc blf -auth sha1 -key 7762d8707255d974168cbb1d274f8bed4cbd3364 -authkey 67e21c66e5a40739db293cf2ef2a4e6659f</b><br>
# <b>ipsecadm new esp -src 208.1.1.1 -dst 208.2.2.2 -forcetunnel -spi 1001 -enc blf -auth sha1 -key 7762d8707255d974168cbb1d274f8bed4cbd3364 -authkey 67e21c66e5a40739db293cf2ef2a4e6659f</b><br>
</tt></blockquote>

<p>
Now, this is the reverse side...
Set up a flow from the router 208.2.2.2 to 208.1.1.1

<blockquote><tt>
# <b>ipsecadm flow -proto esp -dst 208.1.1.1 -spi 1000 -addr 208.2.2.2 255.255.255.255 208.1.1.1 255.255.255.255</b><br>
</tt></blockquote>

<p>
Set up a flow from the network 192.168.99.0/24, which is behind 208.1.1.1, to 208.1.2.0/24

<blockquote><tt>
# <b>ipsecadm flow -proto esp -dst 208.1.1.1 -spi 1000 -addr 208.1.2.0 255.255.255.0 192.168.99.0 255.255.255.0</b><br>
</tt></blockquote>

<p>
Set up a flow from the network 192.168.99.0/24, which is behind 208.1.1.1, to 208.1.5.0/24

<blockquote><tt>
# <b>ipsecadm flow -proto esp -dst 208.1.1.1 -spi 1000 -addr 208.1.5.0 255.255.255.0 192.168.99.0 255.255.255.0</b><br>
</tt></blockquote>

<p>
Now, set up a flow from 192.169.99.0/24, which is behind 208.1.1.1, to the router 208.2.2.2

<blockquote><tt>
# <b>ipsecadm flow -proto esp -dst 208.1.1.1 -spi 1000 -addr 208.2.2.2 255.255.255.255 192.168.99.0 255.255.255.0</b><br>
</tt></blockquote>

<p>
We're almost done...
Two flows left to get 208.1.2.0/24 and 208.1.5.0/24 from the router 208.2.2.2
to the router 208.1.1.1.

<blockquote><tt>
# <b>ipsecadm flow -proto esp -dst 208.1.1.1 -spi 1000 -addr 208.1.2.0 255.255.255.0 208.2.2.2 255.255.255.255 -ingress</b><br>
# <b>ipsecadm flow -proto esp -dst 208.1.1.1 -spi 1000 -addr 208.1.5.0 255.255.255.0 208.2.2.2 255.255.255.255 -ingress</b><br>
</tt></blockquote>

<p>
If you have been using ipsecadm, and you want to get rid of any work
that you've done, and start from scratch, do

<blockquote><tt>
# <b>ipsecadm flush</b>
</tt></blockquote>

<p>
This will flush all IPsec info (SPIs, flows, routing entries) from your system.


<p>
<a name= "isakmpd"></a>
<h2>13.7 - How do I set up isakmpd?</h2>

<p>
If you are thinking about VPNs or other traditional applications
of IPsec, you probably are going to use ISAKMP.  Some commercial
implementations of IPsec do not provide any manual keying ability, instead
they require you to use some form of ISAKMP.


<p>
<h3>13.7.1 - What is isakmpd?</h3>

<p>
ISAKMP is the Internet Security Association and Key Management
Protocol. It is sometimes referred to as IKE, or Internet Key Exchange.  It
is the standard key exchange mechanism for IPsec. It
addresses security concerns using the methods mentioned in 
<a href="http://www.cis.ohio-state.edu/htbin/rfc/rfc2407.html">RFC 2407</a>,
<a href="http://www.cis.ohio-state.edu/htbin/rfc/rfc2408.html">RFC 2408,</a>
and
<a href="http://www.cis.ohio-state.edu/htbin/rfc/rfc2409.html">RFC 2409</a>.
ISAKMP manages the exchange of cryptographic keys that you
would normally have to manage with <a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=ipsecadm&amp;sektion=8">ipsecadm(8)</a>.
It employs a two-phase process for establishing the IPsec parameters
between two IPsec nodes.

<p>
<b>Phase 1</b> - The two ISAKMP peers establish a secure,
authenticated channel upon which to communicate between two daemons. This
establishes a Security Association (SA) between both hosts. <b>Main
Mode</b> and <b>Aggressive Mode</b> are the methods used to establish this
channel. Main Mode sends the various authentication information in a
certain sequence, providing identity protection. Aggressive Mode does not
provide identity protection because all of the authentication information
is sent at the same time. Aggressive mode should only be used in such
cases where network bandwidth is of concern, as it can expose identity
information to an eavesdropper.

<p>
<b>Phase 2</b> - Security Associations are negotiated on behalf of IPsec.
Phase 2 establishes tunnels or endpoint SAs between IPsec hosts.
<b>Quick Mode</b> is used in Phase 2 because there is no need to repeat a
full authentication; Phase 1 has already established the SAs.

<p>
In brief, Phase 1 is used to get a secure channel in which to do the
(quicker) phase 2 setups.  There can be multiple phase 2 setups within the 
same phase 1 channel.  Phase 2 is used to set up the actual tunnels.
In Phase 1, your IPsec nodes establish a connection
where they exchange authentication (Either a X.509 certificate or a
pre-shared secret). This allows each end to make sure the other end is
authenticated.  Phase 2 is an exchange of keys to determine how the data
between the two will be encrypted.

<h3>13.7.2 - How do I get started with isakmpd?</h3>

<p>
By default, OpenBSD comes with the all the necessary binaries for ISAKMP
and the IPsec stack. Example configuration files may be found in
<tt>/usr/share/ipsec/isakmpd</tt>.
For the purposes of this example, copy <i>policy</i>
to <tt>/etc/isakmpd/isakmpd.policy</tt>.  Copy <i>VPN-east.conf</i> to
<tt>/etc/isakmpd/isakmpd.conf</tt>.
Here we attempt to show you how to set up a VPN (tunnel).  If you want to
use isakmpd between single hosts, there are other configuration files in
the <i>samples</i> directory.
The manual pages have detailed information..  Don't forget
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=isakmpd.conf&amp;sektion=5">isakmpd.conf(5)</a> and 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=isakmpd.policy&amp;sektion=5">isakmpd.policy(5)</a>.

<p>
Although both the ESP and AH protocols are enabled in the kernel by default,
you should verify the protocols you need are available by the procedure
outlined in the FAQ section on <a href="#ManKey">
Manual Keying</a>.
Next, you need to edit <tt>/etc/isakmpd/isakmpd.policy</tt>.  
This file tells ISAKMP who can access IPsec. In this scenario, the policy file states that anybody who sends data
using Encapsulating Security Payload (ESP), and has authenticated with the passphrase <i>mekmitasdigoat</i> (or whatever
passphrase you determine), is allowed to communicate with isakmpd.  You can modify this file to let ISAKMP know that we only
want to allow data signed with certain digital certificates or using a certain encryption transform. You could also
allow anybody to access IPsec.  This is only recommended for testing.
To do this, edit your policy file to contain only the following lines:

<blockquote><pre>
KeyNote-Version: 2
Authorizer: &quot;POLICY&quot;
</pre></blockquote>

<p>
The same policy file contains two lines that start with the $ character.
You need to remove these lines before using it; they are only for cvs.  

<p>
A more useful policy file for this example looks like this:

<blockquote><pre>
KeyNote-Version: 2
Comment: This policy accepts ESP SAs from a remote that uses the right password
Authorizer: &quot;POLICY&quot;
Licensees: &quot;passphrase:mekmitasdigoat&quot;
Conditions: app_domain == &quot;IPsec policy&quot; &amp;&amp;
            esp_present == &quot;yes&quot; -&gt; &quot;true&quot;; 
</pre></blockquote>

<p>
Implementing this will give you a basic VPN (tunnel) using ESP only.
On host A, edit <tt>/etc/isakmpd/isakmpd.conf</tt>.  The 249.2.2.2 sample IP address
should be replaced with the external IP address of host A.

<blockquote><pre>
[General] 
Retransmits=		5
Exchange-max-time=	120
Listen-on=		249.2.2.2
</pre></blockquote>

<p>
Do similar for isakmpd.conf on host B.  249.3.3.3 represents the
external IP address for host B.

<blockquote><pre>
[General]
Retransmits=		5
Exchange-max-time=	120
Listen-on=		249.3.3.3
</pre></blockquote>

<p>
This is where you can set up the variables that will affect the main behavior of isakmpd. It is okay to 
use the defaults here.
The <b>Listen-on</b>= value specifies the IP 
that isakmpd should listen on. Only the Internet IP of your gateway is necessary.
If you have multiple external interfaces on your gateway, 
you could list which interfaces you want to listening on by entering them using a comma separated list.

<p>
Next, on host A, edit isakmpd.conf again.

<blockquote><pre>
[Phase 1]
249.3.3.3=		HostB
</pre></blockquote>

<p>
On host B:

<blockquote><pre>
[Phase 1]
249.2.2.2=		HostA
</pre></blockquote>

<p>
This section describes the IP addresses to accept in order to negotiate the phase 1 connection. 
Its value points to the section below (Remember that phase 1 simply 
authenticates the remote peer to make sure they are who they say they are). You can list multiple peers with additional lines in the format of
IP_Address=<i> &lt;PEER-NAME&gt;.</i>

<p>
Next, on host A:

<blockquote><pre>
[Phase 2]
Connections=		HostA-HostB
</pre></blockquote>

<p>
On host B:

<blockquote><pre>
[Phase 2]
Connections=		HostB-HostA
</pre></blockquote>

<p>
This describes Phase 2 of the connection. This is the phase that determines what protocols the two 
peers will use to communicate.

<p>
The <b>Connections</b>= tag refers to the section below. 
It initiates the requirements or the accepted methods to set up Phase 2. This also tells ISAKMPD which 
connections to initiate once started. Note that you can have multiple sections
as illustrated below 
if you are to connect with multiple peer hosts.

<p>
If you do not have the IP address of the remote host, you can specify a Default= that points 
to a section describing a generic entry that will be referenced by any 
incoming IP that is not listed in the <b>Connections</b>= tag.

<p>
On host A:

<blockquote><pre>
[HostB]
Phase=			1
Transport=		udp
Local-address=		249.2.2.2
Address=		249.3.3.3
Configuration=		Default-main-mode
Authentication=		mekmitasdigoat
#Flags=
</pre></blockquote>

<p>
On host B:

<blockquote><pre>
[HostA]
Phase=			1
Transport=		udp
Local-address=		249.3.3.3
Address=		249.2.2.2
Configuration=		Default-main-mode
Authentication=		mekmitasdigoat
#Flags=
</pre></blockquote>

<p>
These represent the sections referred to by the Phase 1 section above. They each 
describe the requirements that the peer gateway must fulfill in order to proceed to Phase 2. There are 
many other options here but the ones mentioned above are the minimum requirements.
a31 27
<ul>
<li><b>Phase=1 </b>is required because the ISAKMPD code uses the same procedures to process Phase 1 and 
Phase 2. It must be <b>1</b> or nothing will work.
<li><b>Transport= </b> gives you different possibilities for different peers. It's 
suggested that udp be used here so we'll leave it at that.
Please note that some peers may be behind a firewall that doesn't let UDP traffic through.  Obviously, this needs to be determined before setup.
<li><b>Local-address </b>is the destination address that the incoming packets point to. In some cases, you 
can be listening on different Interfaces for Phase 1 connections.
In this example, there is only 1 interface listening, therefore this is the IP of the listening 
interface on this peer.
<li><b>Address= </b>is the address that points to the source IP of the incoming packets. This usually points 
to the peer gateway. 
This needs further explanation, because the source IP address of the peer may be unknown!
<li><b>Configuration= </b>points to the section below. You can specify 
multiple sections like this. We use the default one 
specified by the sample file.
<li><b>Authentication=</b> is the pre-shared secret to be used for this particular peer. It is more or less 
a passphrase that each peer uses. This passphrase gets passed to policy to verify whether this 
peer is allowed to use IPSEC with this host. If you change this phrase, you must also change it in the 
policy file because the sample file provides for this passphrase. If you decided to go with a 
minimum policy file then you can specify whatever you want here.
<li><b>Flags=</b> is not currently being used. The RFCs leave room for extra options to be specified for 
phase 1.
<p>There are other tags here that will allow for other options to be set. Refer to 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=isakmpd.conf&amp;sektion=5">isakmpd.conf(5)</a>
for descriptions.
</ul>
a33 1207
On Host A:

<blockquote><pre>
[HostA-HostB]
Phase=			2
ISAKMP-peer=		HostB
Configuration=		Default-quick-mode
Local-ID=		Net-A
Remote-ID=		Net-B
</pre></blockquote>

<p>
On Host B:

<blockquote><pre>
[HostB-HostA]
Phase=			2
ISAKMP-peer=		HostA
Configuration=		Default-quick-mode
Local-ID=		Net-B
Remote-ID=		Net-A
</pre></blockquote>

<p>
These represent the sections referred to by the Phase 2 section above. They are the 
individual settings that ISAKMPD must use to talk between the two gateways for the particular 
connection.

<ul>
<li><b>Phase=2</b> is required because ISAKMPD code uses the same functions to authenticate Phase 1 and Phase 
2. This is required for the VPN to work.
<li><b>ISAKMPD-Peer=</b> is the name of Host section above. This means that we are 
talking to that particular peer to establish a Phase 2 connection. This is provided because you can have 
multiple sections to describe isakmp peers and connections.
<li><b>Configuration=</b> refers to the section below that describes the 
standards by which this host and the particular peer for this connection must abide.
<li><b>Local-ID=</b> refers to an IPsec-ID section below that describes our Private Network to 
the peer gateway. This is the portion that is passed so that the other gateway can set up the proper 
routing table that will transfer data over the VPN to our network.
<li><b>Remote-ID=</b> refers to an IPsec-ID section below that describes what is supposed to be 
the remote Private Network to our host. This portion is interpreted to set up the proper routing tables 
that will transfer data from our Private Network over the VPN to the remote Private Network.
<p>There is another tag that is supported here called Flags=. If you require this tag, read 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=isakmpd.conf&amp;sektion=5">isakmpd.conf(5)</a>.
</ul>

<p>
This is the IPsec-ID section.  These entries need to exist
in the isakmpd.conf files for both Host A and Host B.  This example
will set up 192.168.1.0/255.255.255.0 for Host A (which was connected
to Net-A above) and 192.168.20.0/255.255.255.0 for Host B (Net-B above).

<blockquote><pre>
[Net-A]
ID-type=		IPV4_ADDR_SUBNET
Network=		192.168.1.0
Netmask=		255.255.255.0

[Net-B]
ID-type=		IPV4_ADDR_SUBNET
Network=		192.168.20.0
Netmask=		255.255.255.0
</pre></blockquote>

<p>
These two sections are in the <b>conf</b> file of each host. They are the sections referenced by the 
<b>Local-ID</b> and <b>Remote-ID</b> identifiers. They describe the 
routes that should be set up to allow traffic from one private network to another.
<b>ID-type</b>= can be <b>IPV4_ADDR_SUBNET</b> or <b>IPV4_ADDR</b> (RFC2708 mentions more possible values. Currently only IPv4 is supported in the OpenBSD implementation.  IPv6 may be supported in OpenBSD-current. )
 
<p>
Now, on both hosts, the sample file should read:

<blockquote><pre>
[Default-main-mode]
DOI=			IPSEC
EXCHANGE_TYPE=		ID_PROT
Transforms=		3DES-SHA
</pre></blockquote>

<p>
This section describes the requirements for the encryption methods of Phase 1 connections. The name 
reflects the value of <i>Configuration=</i> variable.  As we can see here, we are stating our 
Domain of Interest which is IPSEC. The <b>EXCHANGE_TYPE</b> variable is set to <b>ID_PROT</b> for Phase 1, 
which identifies the protocols to be covered by this Authentication.
<b>Transforms=</b> is the transform required (or assigned) for this exchange. In this case, this points to 
the section below in the configuration file that says we are receiving a packet 
encrypted with 3DES and a checksum verifiable with SHA. There are a bunch of different transforms defined 
inside the sample <b>VPN-east.conf</b>. These are provided because 3DES and SHA are not always supported 
across different platforms. For OpenBSD there should be no reason to change this for a basic setup. Feel 
free to create multiples of this section and change the transform. The only requirement is that you change  the Configuration= variable.

<blockquote><pre>
[Default-quick-mode]
DOI=			IPSEC
EXCHANGE_TYPE=		QUICK_MODE
Suites=			QM-ESP-3DES-SHA-PFS-SUITE,QM-ESP-DES-MD5-PFS-SUITE
</pre></blockquote>

<p>
This section describes the requirements for the encryption of the data to be sent through the VPN and 
is referred to by <i>Configuration</i> above. Note the difference between this 
section and the Phase 1 equivalent just above is that the <b>EXCHANGE_TYPE</b> is <b>QUICK_MODE</b>. 
This is always the case for Phase 2.
<b>Suites=</b> points to a IPsec Suite section describing the different encryption 
schemes available between the two hosts.
There is much more to be said about ISAKMP and IPsec. By using the above basic descriptions you should 
be able to create a simple but solid VPN that cares and feeds itself.
This is the bare <i>minimum</i> 
<b>isakmpd.conf</b> for both hosts here.
 
<h3>13.7.3 - Starting isakmpd</h3>

<p>
You may wish to use

<blockquote><tt>
# <b>isakmpd -d -DA=90</b>
</tt></blockquote>

<p>
the first time you decide to run this daemon. The daemon will not be
running in daemon mode but as a regular (foreground) process. It will log
everything to your terminal.  To stop isakmpd and flush the routes,
you need to kill the isakmpd process on each node, and run <b>ipsecadm
flush</b>.


<p>
<a name= "x509"></a>
<h2>13.8 - How do I use isakmpd with X.509 certificates?</h2>

<p>
Setting up isakmpd to use certificates instead of pre-shared keys is
not really that much harder in a big network with many untrusted peers
than it would be with a small network. It may actually simplify
configuration, and more importantly, makes key management much more
flexible.


<h2>Generating certificates.</h2>

<p>
There is a good description of how to generate keys and certificates
in the
<a href="http://www.openbsd.org/cgi-bin/cvsweb/src/sbin/isakmpd/README.PKI?rev=1.7">README.PKI</a>
 file in the isakmpd source directory.  You need to
have a CA key, a corresponding CA X.509 certificate, one private key
for each computer on the network that will use isakmpd and one X.509
certificate for each such key.

<p>
In order to be usable by isakmpd, the X.509 certificates need to have
a Subject Alternative Name (subjectAltName) extension added to them.
This extension describes the certificate holder's identity, and may be
added by using either <a 
href="http://www.openbsd.org/cgi-bin/man.cgi?query=certpatch&amp;sektion=8"
>certpatch(8)</a>,
or a custom openssl configuration file such as
<tt>/etc/ssl/x509v3.cnf</tt>. The examples in
<a href="http://www.openbsd.org/cgi-bin/cvsweb/src/sbin/isakmpd/README.PKI?rev=1.7">README.PKI</a>
describe this process using IP addresses as subjectAltName identifiers.

<p>
Though IP addresses are the default mechanism for subjectAltName
extensions, certpatch also supports using either a FQDN (Fully
Qualified Domain Name) or a UFQDN (User FQDN). These can be very
useful for mobile users. An example of an FQDN
might be <tt>www.openbsd.org</tt>. An example of an UFQDN could be an
email address, such as <tt>Jorgen.Granstam@@abc.se</tt>. It should be
noted that unlike IP-based identifiers, isakmpd performs no
verification of the data presented in FQDN or UFQDN-based
identification; the identifiers are treated simply as strings.

<p>
The following examples will use FQDNs as subjectAltNames.

<p>
To insert an FQDN subjectAltName into a certificate one would do
something like this:

<blockquote><tt>
$ <b>/usr/sbin/certpatch -t fqdn -i home.mysite.se -k ca.key originalcert.crt newcert.crt</b>
</tt></blockquote>

<p>
Here the ca.key is the private key of the CA, thus this can only be
done by whoever has access to the CA private key. The (fictional) 
home.mysite.se is the FQDN to be inserted into the certificate. The
originalcert.crt and newcert.crt filenames may be the same name in
which case the original file will be overwritten by the new modified
certificate. 

<p>
These keys and certificates should then be moved to their appropriate
directories. The default locations for the keys and certificates are
as follows:

<p>
<table>
<tr><td><tt>/etc/isakmpd/ca</tt></td>
<td>public-key (PEM-format) certificates of trusted CAs</td></tr>
<tr><td><tt>/etc/isakmpd/certs</tt></td>
<td>trusted public-key (PEM-format) certificates (with subjectAltName extensions)</td></tr>
<tr><td><tt>/etc/isakmpd/private</tt></td>
<td>Private Keys. These should have corresponding public keys in the
<tt>cert</tt> directory, above</td></tr>
</table>

<p>
These locations may be overridden by values in the
[X509-certificates] section of
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=isakmpd.conf&amp;sektion=5">isakmpd.conf(5)</a>.

<p>
Note that if the CA infrastructure is to be trusted, the CA private
key (<tt>/etc/isakmpd/ca/ca.key</tt>) should be kept in a safe place,
should be of an appropriate bit length (i.e. 2048-bit), and should be
encrypted with a strong passphrase.


<h2>Configuration of isakmpd</h2>

<p>
Lets now look at the <tt>/etc/isakmpd/isakmpd.conf</tt> configuration file.  It
was originally taken from the example file in
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=isakmpd.conf&amp;sektion=5">isakmpd.conf(5)</a>
but has been heavily modified. I will also use a much shorter file
here than the example file in the man page to make it easier to
understand. I have also added some commenting
(some comments are left as in the isakmpd.conf(5)) and changed some
names. None of the domain names used here exist as far as I know.

<p>
Actually since everyone who reads this already has a working
configuration for the pre-shared keys case (see previous section) there won't be
many surprises in this file. I won't explain this in every detail,
check isakmpd.conf(5) for descriptions of the parts I don't
comment on. 

<p>
Let's assume our setup looks something like this

<p>
<center>
<pre>
one.mysite.se                                        one.worksite.se
 192.168.1.2--+    10.0.0.1====/======10.0.0.2     +--192.168.2.2 
              |  gw.mysite.se       gw.worksite.se |
              +--192.168.1.1         192.168.2.1---+
two.mysite.se |                                    | two.worksite.se
 192.168.1.3--+                                    +--192.168.2.3
</pre>
</center>

<p>
That is, two networks that should be connected using an IPsec tunnel over an 
otherwise insecure network. Ignore the fact that I am using IP
addresses reserved for private Internets here (RFC1918), I have to use
something. I won't explain how to use isakmpd in combination with NAT
or similar (because I haven't tried that myself).

<p>
Now, let's look at the configuration file. This is the file for the
security gateway gw.mysite.se:

<blockquote><pre>

# *****************************************************************
# ************* Start of the gw.mysite.se isakmpd.conf ************
# *****************************************************************

# A configuration sample for the isakmpd ISAKMP/Oakley (aka IKE) daemon.
[General]
Policy-File=            /etc/isakmpd/isakmpd.policy
Retransmits=            5
Exchange-max-time=      120
Listen-on=              10.0.0.1


# The name work-gw here is used just as a section name and a tag for
# use in this configuration file below and need not actually be the 
# real hostname or domain name of the peer (but it could be). The IP 
# address however needs to be correct. Phase 1, as you might already
# know, is to negotiate an ISAKMP security association (SA). There 
# should of course be one IP and name for each peer we want to
# communicate with.
[Phase 1]
10.0.0.2=               work-gw


# Now phase 2 is negotiating IPsec SAs. As in phase 1, the name here
# is a section name to be used later. Actually, it can be a comma
# separated list of section names here. Thus if traffic from many
# networks (or individual hosts) should be forwarded through this
# tunnel, more section names would be added (and of course corresponding 
# new sections further down). 
[Phase 2]
Connections=            work-gw-my-gw


# Now, here are some parameters for the ISAKMP SA negotiations. Almost 
# self documenting. The section name is from [Phase 1] above. The most 
# interesting tag might be the ID tag. The ID tag is set to the name
# of the section where the identity information about this host that 
# will be presented to connecting peers, can be found. If the ID tag 
# is not available, isakmpd will assume that it will identify itself 
# using the IP address. You might also notice that there is no longer 
# any authentication tag here in this configuration. The authentication
# data is currently used only in the pre-shared key case. 
[work-gw]
Phase=                  1
Transport=              udp
Local-address=          10.0.0.1                # Local address
Address=                10.0.0.2                # Peer address
ID=                     my-ID
Configuration=          Default-main-mode


# This is the identity data. ID-type may also be IPV4_ADDR (the
# default), IPV4_ADDR_SUBNET or UFQDN. The Name tag is used for 
# FQDN and UFQDN, for IPV4_ADDR an Address tag would be used instead.
# For IPV4_ADDR_SUBNET a Network and a Netmask tag would be used.  
[my-ID]
ID-type=                FQDN
Name=                   gw.mysite.se


# This is the section for the IPsec connection. The section name is
# from the list in the [Phase 2] section above. The ISAKMP-peer is,
# of course, the tag of our peer from section [Phase 1] above. The 
# Local-ID and Remote-ID tags should be section names describing which
# packages should be forwarded over the IPsec tunnel to the remote 
# network.
[work-gw-my-gw]
Phase=                  2
ISAKMP-peer=            work-gw
Configuration=          Default-quick-mode
Local-ID=               Net-west
Remote-ID=              Net-east

# Any packet originating from a computer on the network described
# here... 
[Net-west]
ID-type=                IPV4_ADDR_SUBNET
Network=                192.168.1.0
Netmask=                255.255.255.0

# ... and with a destination matching the network described here, 
# will be encrypted and forwarded over the IPsec tunnel to the remote 
# system. 
[Net-east]
ID-type=                IPV4_ADDR_SUBNET
Network=                192.168.2.0
Netmask=                255.255.255.0

# Main mode descriptions


# Here are the data for main mode. Using DES here for real purposes
# is not very smart since DES is no longer considered a secure
# encryption algorithm. 3DES is generally considered to have much better
# security since it has enough bits in the key to be considered secure. 
# Transforms is a list of tags describing main mode transforms. In 
# this example we have only one.
[Default-main-mode]
DOI=                    IPSEC
EXCHANGE_TYPE=          ID_PROT
Transforms=             3DES-MD5


# Certificates stored in PEM format
# This is important when using certificates. The CA certificates should 
# be in the CA-directory (but not the CA private key of course).
# The Cert-directory should have at least the certificate for the
# local host but other certificates are also allowed. The private key 
# should be the private key of the local host. 
[X509-certificates]
CA-directory=           /etc/isakmpd/ca/
Cert-directory=         /etc/isakmpd/certs/
Private-key=            /etc/isakmpd/private/local.key

# Main mode transforms
######################

# Here is our main mode transform. The important thing here is to use
# RSA_SIG as authentication method when using certificates. It is the
# only method supported when using certificates so far. Commercial
# entities in the US will thus have to wait until September 2000 to
# use this due to the RSA patent. Luckily, I am not living in the US. 
# Also important is the GROUP_DESCRIPTION tag. It must match the
# GROUP_DESCRIPTION tag in the Quick mode transforms further down. 
# The Life tag here could possibly be modified. The LIFE_60_SECS might 
# be shorter than necessary for normal use. 

[3DES-MD5]
ENCRYPTION_ALGORITHM=   3DES_CBC
HASH_ALGORITHM=         MD5
AUTHENTICATION_METHOD=  RSA_SIG
GROUP_DESCRIPTION=      MODP_1024
Life=                   LIFE_60_SECS,LIFE_1000_KB

# Quick mode description
########################

[Default-quick-mode]
DOI=                    IPSEC
EXCHANGE_TYPE=          QUICK_MODE
Suites=                 QM-ESP-3DES-MD5-PFS-SUITE

# Quick mode protection suites
##############################
# 3DES

[QM-ESP-3DES-MD5-PFS-SUITE]
Protocols=              QM-ESP-3DES-MD5-PFS

# 3DES

[QM-ESP-3DES-MD5-PFS]
PROTOCOL_ID=            IPSEC_ESP
Transforms=             QM-ESP-3DES-MD5-PFS-XF

# Quick mode transforms

# Don't forget. The GROUP_DESCRIPTION must match the GROUP_DESCRIPTION 
# in main mode above. For forwarding packets between two networks (or
# from a host to a network) we use TUNNEL mode. Between two hosts we
# may also use TRANSPORT mode instead. 
[QM-ESP-3DES-MD5-PFS-XF]
TRANSFORM_ID=           3DES
ENCAPSULATION_MODE=     TUNNEL
AUTHENTICATION_ALGORITHM=       HMAC_MD5
GROUP_DESCRIPTION=      MODP_1024
Life=                   LIFE_60_SECS


# As we know from the isakmpd.config manpage the LIFE_DURATION here is 
# an offer value (60), a minimum acceptable value (45) and a maximum
# acceptable value. The isakmpd.conf example has this set to 
# 600,450/720 instead. That might be a better value for normal use.
[LIFE_60_SECS]
LIFE_TYPE=              SECONDS
LIFE_DURATION=          60,45:72

[LIFE_1000_KB]
LIFE_TYPE=              KILOBYTES
LIFE_DURATION=          1000,768:1536

# *****************************************************************
# ************* End of the gw.mysite.se isakmpd.conf **************
# *****************************************************************
</pre></blockquote>

<p>
So far the configuration for the local system. The remote system is
configured just the same way only opposite. Thus only the first part
of the isakmpd.conf file differs. Let's just look at that first part 
of the isakmpd.conf file for the security gateway gw.worksite.se:

<blockquote><pre>
# *****************************************************************
# ************* Start of the gw.worksite.se isakmpd.conf **********
# *****************************************************************

[General]
Policy-File=            /etc/isakmpd/isakmpd.policy
Retransmits=            5
Exchange-max-time=      120
Listen-on=              10.0.0.2

[Phase 1]
10.0.0.1=               my-gw

[Phase 2]
Connections=            work-gw-my-gw

[my-gw]
Phase=                  1
Transport=              udp
Local-address=          10.0.0.2                # Local address
Address=                10.0.0.1                # Peer address
ID=                     work-ID
Configuration=          Default-main-mode

[work-ID]
ID-type=                FQDN
Name=                   gw.worksite.se

[work-gw-my-gw]
Phase=                  2
ISAKMP-peer=            my-gw
Configuration=          Default-quick-mode
Local-ID=               Net-east
Remote-ID=              Net-west

# *****************************************************************
# ********************** ... to be continued **********************
# *****************************************************************
</pre></blockquote>

<p>
Now that wasn't so hard, just a bit boring to read perhaps. A
slightly more interesting part next.


<h2>The policy file.</h2>

<p>
Actually, the policy file might be slightly confusing for anyone who has
not used it before, especially if things do not work as expected. The man-page
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=isakmpd.policy&amp;sektion=5">isakmpd.policy(5)</a>
is not really that bad. It might perhaps be a
little bit unclear in some parts but generally it's good. 

<p>
The simplest possible working policy file would contain just a
single line:

<blockquote><pre>
authorizer: &quot;POLICY&quot;
</pre></blockquote>

<p>
This basically means that there are no policy limitations on who
would be allowed to connect. Thus not a very secure setup. The
authorizer tag here means the one who has the authorization to decide
the policy. The special authorizer &quot;POLICY&quot; has the ultimate and
unlimited authority on policy. Any other authorizer must first be
authorized by &quot;POLICY&quot; to have any authority here.

<p>
There can also be a set of conditions for what is allowed. The
following policy thus would mean that only someone using the ESP
protocol with some real encryption would be authorized (oh well,
someone using DES would also be authorized here although DES could
almost be considered snake oil today, it is left as an exercise for the
reader to change this policy into not allowing DES either). Note
that anyone who does encrypts with ESP would still be allowed.

<blockquote><pre>
authorizer: &quot;POLICY&quot;
conditions: app_domain == &quot;IPsec policy&quot; &amp;&amp;
            esp_present == &quot;yes&quot; &amp;&amp;
            esp_enc_alg != &quot;null&quot; -&gt; &quot;true&quot;;

</pre></blockquote>

<p>
It is also possible to "sublicense" authority to someone else (might
be one or more entities). The simple case would be the pre-shared key
case. In that case, anyone who knows the pre-shared passphrase is
authorized. Thus:

<blockquote><pre>
authorizer: &quot;POLICY&quot;
licensees:  &quot;passphrase:something really secret&quot;
conditions: app_domain == &quot;IPsec policy&quot; &amp;&amp;
            esp_present == &quot;yes&quot; &amp;&amp;
            esp_enc_alg != &quot;null&quot; -&gt; &quot;true&quot;;
</pre></blockquote>

<p>
This would authorize anyone who knows this passphrase to connect and
comply with the conditions (but remember that the passphrase must also
be set in the Authentication tag in isakmpd.conf).

<p>
Nothing difficult so far. Now to the interesting stuff. First there
can be many licensees, although all must be authorized by &quot;POLICY&quot;.
Further, authorized licensees can sublicense to other licensees. A
licensee can be just a string in case it is further described in the
policy file:

<blockquote><pre>
authorizer: &quot;POLICY&quot;
licensees:  &quot;subpolicyAH&quot; ||  &quot;subpolicyESP&quot;
conditions: app_domain == &quot;IPsec policy&quot; -&gt; &quot;true&quot;;

authorizer: &quot;subpolicyESP&quot; 
licensees:  &quot;passphrase:something more secret&quot;
conditions: esp_present == &quot;yes&quot; -&gt; &quot;true&quot;;

authorizer: &quot;subpolicyAH&quot; 
licensees:  &quot;passphrase:something really secret&quot;
conditions: ah_present == &quot;yes&quot; -&gt; &quot;true&quot;;
</pre></blockquote>

<p>
And now to what everyone has been waiting for. Policy can also be
sub-licensed or delegated to a key. In this case it is usually a
X.509 certificate. The simple use of certificates would be to use
them like the passphrases. Just insert individual users certificates
in the policy file:

<blockquote><pre>
keynote-version: 2
comment: This is an example of a policy delegating to a key.
authorizer: &quot;POLICY&quot;
licensees: &quot;x509-base64:\
        MIIBsTCCARoCAQAwDQYJKoZIhvcNAQEEBQAwITELMAkGA1UEBhMCc2UxEjAQBgNV\
        BAMTCUlLRUxBQiBDQTAeFw0wMDAxMjgxNzQyMTZaFw0wMTAxMjcxNzQyMTZaMCEx\
        CzA           This is would be a user certificate           AQEB\
        BQA                                                         IUuz\
        eOW8P5UGJUH2JVkiA2CTDryFf0CHYwd2P003dtVYw5RvET7XLMpRZiCcWtBdxneW\
        ct+016zUBP/cQMMl+KownxAUq9ezA8GvTyUWC97SOMOgoVj/QR3FHmEjpUi3AgMB\
        AAEwDQYJKoZIhvcNAQEEBQADgYEALGShaAxHvGncev0iFnKrJI4x5T4vlaMP1ad+\
        iWLV5q9H3wickVGN0NPerq0YLwx/VA9WaecYN8V+ALtNKYPuDiT11zwvE8GQeaai\
        NuzgmQ9hh3GifEgN9VEiC3j4kTytonKr0Q+vTLM7xYzheOxvrtUErRwZ9Xs1KzHe\
        yiXHSU8=&quot;
conditions: app_domain == &quot;IPsec policy&quot; &amp;&amp;
            esp_present == &quot;yes&quot; &amp;&amp;
            esp_enc_alg != &quot;null&quot; -&gt; &quot;true&quot;;
</pre></blockquote>

<p>
Now, this is obviously a stupid idea if there are a lot of users. The
certificates that isakmpd reads from the CA- and Certificate
directories, and the certificates received from the peer is converted
into pseudo credentials. Such certificates converted into pseudo
credentials essentially would look something like:

<blockquote><pre>

authorizer: &quot;x509-base64:\
        MIIBsTCCARoCAQAwDQYJKoZIhvcNAQEEBQAwITELMAkGA1UEBhMCc2UxEjAQBgI2\
	CzA  This is would be the public key/certificate of the     AQEB\
        BQA signer of the user certificate (i.e. the CA certificate)IUuz\
        eOW8P5UGJUH2JVkiA2CTDryFf0CHYwd2P003dtVYw5RvET7XLMpRZiCcWtBdxneW\
        ct+016zUBP/cQMMl+KownxAUq9ezA8GvTyUWC97SOMOgoVj/QR3FHmEjpUi3AgMB\
        AAEwDQYJKoZIhvcNAQEEBQADgYEALGShaAxHvGncev0iFnKrJI4x5T4vlaMP1ad+\
        iWLV5q9H3wickVGN0NPerq0YLwx/VA9WaecYN8V+ALtNKYPuDiT11zwvE8GQeaai\
        NuzgmQ9hh3GifEgN9VEiC3j4kTytonKr0Q+vTLM7xYzheOxvrtUErRwZ9Xs1KzHe\
        yiXHSU8=&quot;
licensees:  &quot;x509-base64:\
        MIIBsTCCARoCAQAwDQYJKoZIhvcNAQEEBQAwITELMAkGA1UEBhMCc2UxEjAQBgNV\
        BAMTCUlLRUxBQiBDQTAeFw0wMDAxMjgxNzQyMTZaFw0wMTAxMjcxNzQyMTZaMCEx\
        CzA      This is would be the key of the subject of the     AQEB\
        BQA                        certificate                      IUuz\
        eOW8P5UGJUH2JVkiA2CTDryFf0CHYwd2P003dtVYw5RvET7XLMpRZiCcWtBdxneW\
        ct+016zUBP/cQMMl+KownxAUq9ezA8GvTyUWC97SOMOgoVj/QR3FHmEjpUi3AgMB\
        AAEwDQYJKoZIhvcNAQEEBQADgYEALGShaAxHvGncev0iFnKrJI4x5T4vlaMP1ad+\
        iWLV5q9H3wickVGN0NPerq0YLwx/VA9WaecYN8V+ALtNKYPuDiT11zwvE8GQeaai\
        NuzgmQ9hh3GifEgN9VEiC3j4kTytonKr0Q+vTLM7xYzheOxvrtUErRwZ9Xs1KzHe\
        yiXHSU8=&quot;
conditions: app_domain == &quot;IPsec policy&quot; -&gt; &quot;true&quot;;
</pre></blockquote>

<p>
Now note that these are not authorized by &quot;POLICY&quot; and thus won't have
any effect without a policy authorizing them somehow. Further, this
showed what happens to certificates internally. The above credential
is thus not seen in the policy file. However, it is possible to
sublicense to such credentials. Remember sub-licensing above. It is
thus possible to license all certificates that are signed by a certain
CA by putting the CA certificate as a licensee to &quot;POLICY&quot;:

<blockquote><pre>
keynote-version: 2
comment: This is an example of a policy delegating to a key.
authorizer: &quot;POLICY&quot;
licensees: &quot;x509-base64:\
        MIIBsTCCARoCAQAwDQYJKoZIhvcNAQEEBQAwITELMAkGA1UEBhMCc2UxEjAQBgNV\
        BAMTCUlLRUxBQiBDQTAeFw0wMDAxMjgxNzQyMTZaFw0wMTAxMjcxNzQyMTZaMCEx\
        CzA               This would be the CA certificate          AQEB\
        BQA                                                         IUuz\
        eOW8P5UGJUH2JVkiA2CTDryFf0CHYwd2P003dtVYw5RvET7XLMpRZiCcWtBdxneW\
        ct+016zUBP/cQMMl+KownxAUq9ezA8GvTyUWC97SOMOgoVj/QR3FHmEjpUi3AgMB\
        AAEwDQYJKoZIhvcNAQEEBQADgYEALGShaAxHvGncev0iFnKrJI4x5T4vlaMP1ad+\
        iWLV5q9H3wickVGN0NPerq0YLwx/VA9WaecYN8V+ALtNKYPuDiT11zwvE8GQeaai\
        NuzgmQ9hh3GifEgN9VEiC3j4kTytonKr0Q+vTLM7xYzheOxvrtUErRwZ9Xs1KzHe\
        yiXHSU8=&quot;
conditions: app_domain == &quot;IPsec policy&quot; &amp;&amp;
            esp_present == &quot;yes&quot; &amp;&amp;
            esp_enc_alg != &quot;null&quot; -&gt; &quot;true&quot;;
</pre></blockquote>

<p>
Thus the above policy is a simple example of a policy that delegates
to a CA. Thus any user that has a certificate that is signed by the CA
that has this certificate and otherwise comply to other conditions set
by the policy and the configuration file would be authorized.


<h2>Almost secure...is not secure!</h2>

<p>
Now, to be really safe, this is not enough unfortunately. There are
ways to attack a security gateway that is configured in this way. If
you really don't want the details, skip a to the next section now. To
everyone else, let's try to understand why this is not secure. It's
not hard.

<p>
Consider what information one of the isakmpds has access to at this
stage. From the configuration file, isakmpd knows which IP-address its
peer will send from (in the [Phase 1] section). From the information
it gets at the phase 1 negotiation it knows the ID that the peer
presents itself with and the certificate it gets from the peer proves
that the peer really have this ID. Looks fine so far?

<p>
Well, if the ID information were the IP (the default situation if we
do not provide a phase 1 ID section) everything would be fine. The CA
would have tied the IP to the cert and the IP in the configuration
would be all information we need. It would be possible for an
imposter to use the same IP from another computer in some cases
(e.g. if both computers were on the same local network and the
computer that usually have this IP is down for some reason). It
should however not be possible for an imposter to be able to have a
certificate and a corresponding private key that (falsely) proves
that this IP belongs to the imposter.

<p>
If that ever happened, the imposter would have managed to either steal the
private key from the real owner of the IP, or the imposter would have
managed to fool the CA into issuing a certificate containing false
information somehow. If any of these things happened, then either the
private key had not been protected well enough, the CA had failed
to check the identity of the imposter well enough (or the ID info for
the cert) or the CA private key had not been well enough protected.
Since all these are prerequisites for security to work at all, none
of these situations can be allowed to ever occur.

<p>
Now, in our example the situation is different. Here we actually have
an FQDN in the certificate instead of an IP address. Since we still
have an IP address in the [Phase 1] section this will result in a
possible security problem. What now would happen during an ISAKMP
phase 1 negotiation would be that we could check that the peer was
sending from the expected IP (but as explained earlier that could
possibly be forged in some situations). We could check that the ID
our peer presents actually belongs to our peer. But what we can not
check now is if that ID really is the ID we expect our peer to have,
because isakmpd have never been told what ID that should be.

<p>
Someone now might say that the DNS system ties the IP to the FQDN for
the host. That is true, however today's DNS system is not secure and
can, under some circumstances, be fooled to give out false
information (or, it could be subject to a denial of service (DoS)
attack by an attacker, and the attacker's computer might be able to
fake the DNS server's answer). Secure DNS will come in the future, but
it is not here yet (at least most DNS servers are not secure yet),
thus today, using DNS to check if the FQDN in the cert corresponds to
the expected IP is no guarantee. In fact isakmpd does not check this
with DNS. Even if DNS was secure, checking this would not help in the
case of using an UFQDN.

<p>
Thus in the case of having an FQDN as ID, it could be possible for an
attacker to get an own private key and having this key signed by the
same CA that we use (but with the attacker's own FQDN, of course). Then
launch a DoS attack on our peer so that it goes down (in fact, there
are some flaws in the ISAKMP protocol itself that possibly could be
used to launch a remote DoS against the peer an make it go down,
although I don't know how sensitive isakmpd is to those attacks). Then
the attacker could configure its own computer in the same way as our
peer, connect it to our peers network and try to connect using its
own ID, private key and certificate.

<p>
Since our own isakmpd has not been informed about what ID to our peer (and it is because the attacker is identically configured as
our peer besides the certificate, ID and private key). Further our
isakmpd can check that the certificate was signed by the same CA (but
most CAs sign lots of certs, a cert might not be hard to get), and that
the presented ID is the same as the ID in the cert. However it would
not, with the configuration presented so far, check that this ID is the
expected ID. Thus the attacker would be allowed to connect.


<h3>Preventing the attack.</h3>

<p>
The question now thus is, how can we inform isakmpd about what ID to
expect? This is fortunately easy, and documented in the
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=isakmpd.policy&amp;sektion=5">isakmpd.policy(5)</a>.
We must do the check in the policy. Like
this:

<blockquote><pre>
keynote-version: 2
comment: This is an example of a policy delegating to a key.
authorizer: &quot;POLICY&quot;
licensees: &quot;x509-base64:\
        MIIBsTCCARoCAQAwDQYJKoZIhvcNAQEEBQAwITELMAkGA1UEBhMCc2UxEjAQBgNV\
        BAMTCUlLRUxBQiBDQTAeFw0wMDAxMjgxNzQyMTZaFw0wMTAxMjcxNzQyMTZaMCEx\
        CzA               This would be the CA certificate          AQEB\
        BQA                                                         IUuz\
        eOW8P5UGJUH2JVkiA2CTDryFf0CHYwd2P003dtVYw5RvET7XLMpRZiCcWtBdxneW\
        ct+016zUBP/cQMMl+KownxAUq9ezA8GvTyUWC97SOMOgoVj/QR3FHmEjpUi3AgMB\
        AAEwDQYJKoZIhvcNAQEEBQADgYEALGShaAxHvGncev0iFnKrJI4x5T4vlaMP1ad+\
        iWLV5q9H3wickVGN0NPerq0YLwx/VA9WaecYN8V+ALtNKYPuDiT11zwvE8GQeaai\
        NuzgmQ9hh3GifEgN9VEiC3j4kTytonKr0Q+vTLM7xYzheOxvrtUErRwZ9Xs1KzHe\
        yiXHSU8=&quot;
conditions: app_domain == &quot;IPsec policy&quot; &amp;&amp;
            esp_present == &quot;yes&quot; &amp;&amp;
            esp_enc_alg != &quot;null&quot; &amp;&amp;
            remote_id == &quot;gw.worksite.se&quot; -&gt; &quot;true&quot;;
</pre></blockquote>

<p>
Now only gw.worksite.se should be able to get an IPsec connection.
More allowed IDs could easily be added by adding more alternative
remote_id checks, e.g. by having conditions like these in the policy:

<blockquote><pre>
conditions: app_domain == &quot;IPsec policy&quot; &amp;&amp;
            esp_present == &quot;yes&quot; &amp;&amp;
            esp_enc_alg != &quot;null&quot; &amp;&amp;
            (remote_id == &quot;gw.worksite.se&quot;  ||
               remote_id == &quot;gw.whatsite.se&quot;) -&gt; &quot;true&quot;;
</pre></blockquote>

<p>
With this policy either of gw.worksite.se, gw.somesite.se or 
gw.whatsite.se could connect.

<p>
Some might say that is unfortunate that there has to be entire
certificates inserted in the policy. It requires some work to
reformat the certificates into the format in the policy and it makes
the policy rather unreadable. If someone by mistake replaced a user
certificate with the corresponding CA certificate somewhere in a
complex policy it might cause unauthorized users to be allowed to
connect in some cases and worse, it would not be easily detectable by
reading through the policy file (since X.509 certificates are not in
a human readable format). 

<p>
Now, for the really bleeding edge people out there a solution to this
problem is available. It is now possible to use the certificate
Distinguished Name (DN) instead of a certificate in the policy (the
corresponding certificate must of course be available from the certs
or ca directories on disk so that isakmpd can find it). With this
format the policy above might look like something like this instead:

<blockquote><pre>  
keynote-version: 2
comment: This is an example of a policy delegating to a key.
authorizer: &quot;POLICY&quot;
licensees: &quot;DN:/C=se/CN=IKELAB CA&quot;
conditions: app_domain == &quot;IPsec policy&quot; &amp;&amp;
            esp_present == &quot;yes&quot; &amp;&amp;
            esp_enc_alg != &quot;null&quot; &amp;&amp;
            (remote_id == &quot;gw.worksite.se&quot;  ||
             remote_id == &quot;gw.somesite.se&quot;  ||
             remote_id == &quot;gw.whatsite.se&quot;) -&gt; &quot;true&quot;;
</pre></blockquote>

<p>
Much more readable, isn't it? The information about what the exact DN
for a certificate is can be found by looking at the certificate using
the openssl utility. Something like:

<blockquote><tt>
$ <b>openssl x509 -text &lt; ca.crt</b>
</tt></blockquote>

<p>
More complicated policy configurations are of course possible but
this is a start anyway, and there is another example in the next
section. 

<p>
This should provide the necessary information about the certificate in
ca.crt. Now this is good as long as we have a small or at least
reasonably small policy. It is however still not too great if we have
a gigantic site with lots of users that should be allowed to connect.


<h2>Multiuser configurations and/or centrally managed authorization.</h2>

<p>
Now, lets look at some really cool features of isakmpd. Previously we
assumed that the expected peer was well known and had a static IP
address. This is not always the case. Lots of people use dynamically
assigned IPs or use many different computers. In other cases (like
for a server) we might not know for sure who wants to connect. 

<p>
Therefore one very nice feature of isakmpd is the ability to use a
default tag instead of an IP in the [Phase 1] section, thus allowing
isakmpd negotiations from any IP. This might thus look something like
this:

<blockquote><pre>
[phase 1]
Default=        work-gw
</pre></blockquote>

<p>
First, it should be said that this configuration might not be secure
from DoS attacks. As said before, there are some flaws in the
ISAKMP/IKE protocols. Anyway, using a default [phase 1] section also
enable us to use a kind of &quot;authorization certificates&quot; instead.

<p>
Consider the case where we have a lot of authorized users but when we
would not accept just any user.  Like at a company. We would like
company employees to be allowed to connect but nobody else. Now,
imagine a big company where there might be thousands of employees. We
might like them to all be able to connect from any computer (not only
from within the company network) but everyone should not be allowed to
do anything. It should now be possible to write a policy like this:

<blockquote><pre>
keynote-version: 2
authorizer: &quot;POLICY&quot;
licensees: &quot;telnet@@work&quot; || &quot;telnet@@lab&quot; || &quot;pop3@@work&quot; 
conditions: app_domain == &quot;IPsec policy&quot; &amp;&amp;
            esp_present == &quot;yes&quot; &amp;&amp;
            esp_enc_alg != &quot;null&quot; &amp;&amp;
            remote_id_type == &quot;UFQDN&quot; &amp;&amp;
            (remote_id == &quot;telnet@@worksite.se&quot;  ||
             remote_id == &quot;pop3@@worksite.se&quot;  ||
             remote_id == &quot;telnet@@lab.worksite.se&quot;) -&gt; &quot;true&quot;;

authorizer: &quot;telnet@@work&quot;
licensees: &quot;DN:/C=se/CN=IKELAB CA&quot;
conditions: remote_id == &quot;telnet@@worksite.se&quot; &amp;&amp;
            local_filter_type == &quot;IPv4 address&quot; &amp;&amp;
            local_filter_port == &quot;23&quot; &amp;&amp;
            local_filter == &quot;192.168.002.003&quot;

authorizer: &quot;telnet@@lab&quot;
licensees: &quot;DN:/C=se/CN=IKELAB CA&quot;
conditions: remote_id == &quot;telnet@@lab.worksite.se&quot; &amp;&amp;
            local_filter_type == &quot;IPv4 address&quot; &amp;&amp;
            local_filter_port == &quot;23&quot; &amp;&amp;
            local_filter == &quot;192.168.002.002&quot; -&gt; &quot;true&quot;;

authorizer: &quot;pop3@@work&quot;
licensees: &quot;DN:/C=se/CN=IKELAB CA&quot;
conditions: local_filter_type == &quot;IPv4 address&quot; &amp;&amp;
            local_filter_port == &quot;110&quot; &amp;&amp;
            local_filter == &quot;192.168.002.003&quot; &amp;&amp;
            remote_id == &quot;telnet@@worksite.se&quot; -&gt; &quot;true&quot;;

</pre> </blockquote>

<p>
This might not be exactly how it should be. This is as far as I know
completely untested (in fact, these filter conditions might not work
at all as I expect). Also, a policy such as this one (in fact any
with default as peer IP), would require rewrites of the isakmpd.conf
file too. This would have some security implications too. Further,
for this kind of connections where anyone should be allowed to
connect, it would probably be desirable to log the DN of anyone who
connected. Isakmpd does not yet support that to my knowledge. Also
this probably could have other security implications.  You are on 
your own, you have been warned.  The basic idea should be clear anyway.

<p> 
Just in case someone missed the really interesting possibilities this would
have. If all computers using ISAKMP/IKE this way had a standard set of
conditions for all services the users might like to use from remote, the CA
could actually authorize users by just putting the right subjectAltName
extensions in their certificates. Further, the expiration time for such
certificates could be set to expire relatively often although the users
would be able to download new reissued certificates when their current
certificate is getting old. If the users misuse their authorizations, just
stop reissuing the certificates and they won't get in more after it has
expired. No need to change policy files on all computers just because an
employee e.g. quits their job. The same scheme should work for other
purposes than ISAKMP/IPsec too (including authorization for off-line
systems!) although that would require special software. In any case, any
organization doing this would probably want to be their own CA.

<p>
Multiuser configurations (mobile users) like these are possible with
pre-shared keys too, but then it is required that AGGRESSIVE mode is
used instead of ID_PROT mode since we then must be able to choose the
right password phrase based on ID since we do not know that from what
the IP is in this case (in AGGRESSIVE mode the ID is sent over at an
earlier stage of the negotiation, but it is sent unencrypted, thus
AGGRESSIVE mode is faster because it needs fewer message exchanges,
but it also is a bit less secure since the ID is sent in clear).


<p>
<a name= "IKEcl"></a>
<h2>13.9 - What IKE clients are compatible with isakmpd?</h2>

<p>
<tt>isakmpd</tt> is the ISAKMP/Oakley key management daemon that comes with OpenBSD.
We suspect that it interoperates, at least partially, with most ISAKMP
implementations, but the following have actually been tested.   Note that some
isakmp software out there is actually based on the OpenBSD isakmp daemon.

<p>
The following MS-Windows clients have been reported to be compatible:

<ul>
<!-- <li><a href="http://www.timestep.com/">TimeStep</a> PERMIT/Client -->
<li><a href="http://www.ashleylaurent.com/">Ashley Laurent</a> VPN software
<li><a href="http://www.pgp.com/">PGP VPN</a> software
<li><a href="http://www.ssh.com/">SSH Sentinel</a> IPsec client
<li><a href="http://www.cisco.com/">Cisco</a> IRE client
<li><a href="http://www.microsoft.com">Microsoft</a> Windows 2000, XP
</ul>

<p>
The following gateways/routers have been reported to be compatible:

<ul>
<li><a href="http://www.cisco.com/">Cisco</a> IOS
<li><a href="http://www.cisco.com/">Cisco</a> PIX
<li><a href="http://www.intel.com/">Intel</a> LanRover
<!-- <li><a href="http://www.timestep.com/">TimeStep</a> PERMIT/Gate -->
<li><a href="http://www.cendio.com/">Cendio</a> Fuego
<li><a href="http://www.kame.net/">KAME</a> for FreeBSD
<li><a href="http://www.xs4all.nl/~freeswan/">FreeS/WAN</a> for Linux
<li><a href="http://www.symantec.com/">Symantec</a> Raptor
<li><a href="http://www.ericsson.com/">Ericsson</a> eBox
<li><a href="http://www.f-secure.com/">F-Secure</a> VPN+
<li><a href="http://www.teamware.com/">Teamware</a> TWISS
<li><a href="http://www.3com.com/">3com</a> Pathbuilder
<li><a href="http://www.nortelnetworks.com/">Nortel</a> Contivity
<li><a href="http://www.checkpoint.com/">CheckPoint</a> FW-1
<li><a href="http://www.watchguard.com/">Watchguard</a> Firebox III
<li><a href="http://www.lucent.com/">Lucent</a> Access Point
</ul>

<p>
<a name= "Trouble"></a>
<h2>13.10 - Troubleshooting IPsec/VPN</h2>

<p>
Your first tool for troubleshooting IPsec is <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&amp;sektion=8">tcpdump(8)</a>.
Use <tt>tcpdump</tt> to look for several things.

<p>
First, if you are using tcpdump from 
OpenBSD, you have an enhanced version of tcpdump which can show some
information about ESP and AH packets.  If you are using tcpdump from OpenBSD
2.5 or on another operating system, chances are you have an older
version that will simply show the protocol number for AH or ESP.
(ESP is IP protocol 50, AH is 51)

<ul>
<li>
With tcpdump, look and see if traffic is using AH/ESP or cleartext.
If your traffic is in cleartext, then your flows are set up incorrectly
or your isakmp is not negotiating properly.  Use <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ping&amp;sektion=8">ping(8)</a>
to generate simple traffic.
<p>
For instance, I have two hosts, 208.1.1.1 and 208.2.2.2.  
Logged in to 208.2.2.2, I am doing this:
<pre>
# <b>ping -c 3 208.1.1.1</b>
PING esp.mil (208.1.1.1): 56 data bytes
64 bytes from 208.1.1.1: icmp_seq=0 ttl=255 time=190.155 ms
64 bytes from 208.1.1.1: icmp_seq=1 ttl=255 time=201.040 ms
64 bytes from 208.1.1.1: icmp_seq=2 ttl=255 time=165.481 ms
--- esp.mil ping statistics ---
3 packets transmitted, 3 packets received, 0% packet loss
round-trip min/avg/max = 165.481/185.558/201.040 ms
</pre>
<p>
And in another session, I can see my encapsulated pings:
<pre>
# <b>tcpdump -ni fxp7 host 208.1.1.1</b>
tcpdump: listening on fxp7
14:12:19.630274 esp 208.2.2.2 &gt; 208.1.1.1 spi 0x00001000 seq 4535 len 116
14:12:19.813519 esp 208.1.1.1 &gt; 208.2.2.2 spi 0x00001001 seq 49313 len 116
14:12:20.630277 esp 208.2.2.2 &gt; 208.1.1.1 spi 0x00001000 seq 4536 len 116
14:12:20.832458 esp 208.1.1.1 &gt; 208.2.2.2 spi 0x00001001 seq 49314 len 116
14:12:21.630273 esp 208.2.2.2 &gt; 208.1.1.1 spi 0x00001000 seq 4537 len 116
<b>^C</b>
1831 packets received by filter
0 packets dropped by kernel
</pre>
<p>
<li>ISAKMP runs on UDP port 500.  If this is locked out through a firewall
or packet filter, then you need to change it!
<blockquote><pre>
# Passing in ISAKMP traffic from the security gateways
pass in on ne0 proto udp from gatewB/32 port = 500 to gatewA/32 port = 500
pass out on ne0 proto udp from gatewA/32 port = 500 to gatewB/32 port = 500

# Passing in encrypted traffic from security gateways
pass in proto esp from gatewB/32 to gatewA/32
pass out proto esp from gatewA/32 to gatewB/32
</pre></blockquote>
<p>
<li>
To turn on all useful debugging in isakmpd, start it as
<blockquote><tt>
# <b>/sbin/isakmpd -d -DA=90</b>
</tt></blockquote>
<p>
or (to skip the most detailed timer debug info)
<blockquote><tt>
# <b>/sbin/isakmpd -d -DA=90 -D1=70</b>
</tt></blockquote>
<p>
<li>You need to allow traffic which has been processed by IPsec from netB
into your local firewalled netA.
<blockquote><pre>
# Passing in traffic from the designated subnets.
pass in on enc0 from netB/netBmask to netA/netAmask
</pre></blockquote>
<p>
<li>With tcpdump on OpenBSD, you can decode most cleartext parts of Internet
Key Exchange sessions.  Tcpdump will also show AH payload data.
<p>
<li>Mount a /kern filesystem (if you don't use one by default already.)
<blockquote><tt>
# <b>mkdir /kern; mount -t kernfs /kern /kern</b>
</tt></blockquote>
<p>
In /kern, there is a table of current SA/SPIs, including which have flows
(outgoing SAs) or not (incoming SAs).
There are also traffic counters which you can use to see what traffic is going
where.
<p>
<li>Finally, you can use <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=netstat&amp;sektion=1">netstat(1)</a> to see your SAs.
<blockquote><pre>
$ <b>netstat -rn -f encap</b>
Routing tables

Encap:
Source             Port  Destination        Port  Proto SA(Address/SPI/Proto) 
0.0.0.0/32         0     192.168.99/24      0     0     208.1.1.1/00001000/50
0.0.0.0/32         0     208.1.1.1/32       0     0     208.1.1.1/00001000/50
208.1.2.0/24       0     192.168.99/24      0     0     208.1.1.1/00001000/50
208.1.2.0/24       0     208.1.1.1/32       0     0     208.1.1.1/00001000/50
208.1.5.0/24       0     192.168.99/24      0     0     208.1.1.1/00001000/50
208.1.5.0/24       0     208.1.1.1/32       0     0     208.1.1.1/00001000/50
208.2.2.2/32       0     192.168.99/24      0     0     208.1.1.1/00001000/50
208.2.2.2/32       0     208.1.1.1/32       0     0     208.1.1.1/00001000/50
</pre></blockquote>
<p>
<li>
If all else fails, recompile your kernel with <tt>option ENCDEBUG</tt>.
Then, set the sysctl <tt>net.inet.ip.encdebug</tt> to 1.  Look in your dmesg for
warnings or errors, and report them using <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sendbug&amp;sektion=1">sendbug(1)</a>
to the OpenBSD developers.  Alternately, if you are not sure you have
actually run into a bug, you may want to send a message to one of the <a href="../mail.html">mailing lists</a>.
</ul>


<p>
<a name= "SeeAlso"></a>
<h2>13.11 - Related Documentation</h2>

<p>
IPsec is partially documented in the 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=vpn&amp;sektion=8">vpn(8)</a>
man page.  There are various configuration templates in <a href="http://www.openbsd.org/cgi-bin/cvsweb/src/share/ipsec/">/usr/share/ipsec/</a>
directory which can also assist you.  The manual pages for
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=enc&amp;sektion=4">enc(4)</a>,
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ipsec&amp;sektion=4">ipsec(4)</a>,
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ipsecadm&amp;sektion=8">ipsecadm(8)</a>,
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=isakmpd&amp;sektion=8">isakmpd(8)</a>,
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=isakmpd.conf&amp;sektion=5">isakmpd.conf(5)</a> and
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=isakmpd.policy&amp;sektion=5">isakmpd.policy(5)</a>
are detailed and can assist in setup and operation of IPsec.

<p>
Other links...

<ul>
<li><a href="http://www.ietf.org/html.charters/ipsec-charter.html">IETF IPsec Working Group</a>
<li><a href="http://isakmp-test.ssh.fi/">SSH IPsec interoperability Test Node</a>
<li><a href="http://ipsec-wit.antd.nist.gov/">NIST IPsec Web Based Interoperability Tester</a>
<li><a href="http://www.r4k.net/ipsec/">A port of OpenBSD's IPsec to FreeBSD</a>
<li><a href="http://www.xs4all.nl/~freeswan/">FreeS/WAN - IPsec for Linux</a>
<li><a href="http://www.pintday.org/hack/docs/vpn-24-minifaq.shtml">OpenBSD 2.4 VPN Configuration Mini-FAQ</a>
</ul>

<p> 
<a name="rfc">
And on to the RFCs...
</a>

<ul>
<li><a href="http://www.cis.ohio-state.edu/htbin/rfc/rfc1320.html">RFC 1320</a> - The MD4 Message-Digest Algorithm
<li><a href="http://www.cis.ohio-state.edu/htbin/rfc/rfc1321.html">RFC 1321</a> - The MD5 Message-Digest Algorithm
<li><a href="http://www.cis.ohio-state.edu/htbin/rfc/rfc1828.html">RFC 1828</a> - IP Authentication using Keyed MD5
<li><a href="http://www.cis.ohio-state.edu/htbin/rfc/rfc1829.html">RFC 1829</a> - The ESP DES-CBC Transform
<li><a href="http://www.cis.ohio-state.edu/htbin/rfc/rfc2040.html">RFC 2040</a> - The RC5, RC5-CBC, RC5-CBC-Pad, and RC5-CTS Algorithms
<li><a href="http://www.cis.ohio-state.edu/htbin/rfc/rfc2085.html">RFC 2085</a> - HMAC-MD5 IP Authentication with Replay Prevention
<li><a href="http://www.cis.ohio-state.edu/htbin/rfc/rfc2104.html">RFC 2104</a> - HMAC: Keyed-Hashing for Message Authentication
<li><a href="http://www.cis.ohio-state.edu/htbin/rfc/rfc2144.html">RFC 2144</a> - The CAST-128 Encryption Algorithm 
<li><a href="http://www.cis.ohio-state.edu/htbin/rfc/rfc2202.html">RFC 2202</a> - Test Cases for HMAC-MD5 and HMAC-SHA-1 
<li><a href="http://www.cis.ohio-state.edu/htbin/rfc/rfc2207.html">RFC 2207</a> - RSVP Extensions for IPsec Data Flows
<li><a href="http://www.cis.ohio-state.edu/htbin/rfc/rfc2268.html">RFC 2268</a> - A Description of the RC2 Encryption Algorithm 
<li><a href="http://www.cis.ohio-state.edu/htbin/rfc/rfc2367.html">RFC 2367</a> - PF_KEY Key Management API, Version 2
<li><a href="http://www.cis.ohio-state.edu/htbin/rfc/rfc2401.html">RFC 2401</a> - Security Architecture for the Internet Protocol (<b>IPsec</b>)
<li><a href="http://www.cis.ohio-state.edu/htbin/rfc/rfc2402.html">RFC 2402</a> - IP Authentication Header (<b>AH</b>)
<li><a href="http://www.cis.ohio-state.edu/htbin/rfc/rfc2403.html">RFC 2403</a> - The Use of HMAC-MD5-96 within ESP and AH
<li><a href="http://www.cis.ohio-state.edu/htbin/rfc/rfc2404.html">RFC 2404</a> - The Use of HMAC-SHA-1-96 within ESP and AH
<li><a href="http://www.cis.ohio-state.edu/htbin/rfc/rfc2405.html">RFC 2405</a> - The ESP DES-CBC Cipher Algorithm With Explicit IV
<li><a href="http://www.cis.ohio-state.edu/htbin/rfc/rfc2406.html">RFC 2406</a> - IP Encapsulating Security Payload (<b>ESP</b>)
<li><a href="http://www.cis.ohio-state.edu/htbin/rfc/rfc2407.html">RFC 2407</a> - The Internet IP Security Domain of Interpretation for ISAKMP
<li><a href="http://www.cis.ohio-state.edu/htbin/rfc/rfc2408.html">RFC 2408</a> - Internet Security Association and Key Management Protocol (<b>ISAKMP</b>)
<li><a href="http://www.cis.ohio-state.edu/htbin/rfc/rfc2409.html">RFC 2409</a> - The Internet Key Exchange (<b>IKE</b>)
<li><a href="http://www.cis.ohio-state.edu/htbin/rfc/rfc2410.html">RFC 2410</a> - The NULL Encryption Algorithm and Its Use With IPsec (ha ha...)
<li><a href="http://www.cis.ohio-state.edu/htbin/rfc/rfc2411.html">RFC 2411</a> - IP Security Document Roadmap
<li><a href="http://www.cis.ohio-state.edu/htbin/rfc/rfc2412.html">RFC 2412</a> - The OAKLEY Key Determination Protocol
<li><a href="http://www.cis.ohio-state.edu/htbin/rfc/rfc2451.html">RFC 2451</a> - The ESP CBC-Mode Cipher Algorithms
<li><a href="http://www.cis.ohio-state.edu/htbin/rfc/rfc2631.html">RFC 2631</a> - Diffie-Hellman Key Agreement Method
<li><a href="http://www.cis.ohio-state.edu/htbin/rfc/rfc2709.html">RFC 2709</a> - Security Model with Tunnel-mode IPsec for NAT Domains
</ul>

d45 1
a45 1
<small>$OpenBSD: faq13.html,v 1.77 2003/06/22 18:54:12 david Exp $</small>
@


1.78
log
@IPSec -> IPsec
@
text
@a57 1
<a name= "13.1"></a>
a101 1
<a name= "13.2"></a>
a139 1
<a name= "13.3"></a>
a165 1
<a name= "13.4"></a>
a288 1
<a name="13.5"></a>
a381 1
<a name= "13.6"></a>
@


1.77
log
@doctype/charset cleanup
ok nick@@
@
text
@d1909 1
a1909 1
<li><a href="http://www.ssh.com/">SSH Sentinel</a> IPSec client
d2130 1
a2130 1
<small>$OpenBSD: faq13.html,v 1.76 2003/06/15 01:56:38 nick Exp $</small>
@


1.76
log
@
SSH Sentinel works, from Jason Dixon (jason at dixongroup dot net)
@
text
@d1 1
a1 1
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
d2130 1
a2130 1
<small>$OpenBSD: faq13.html,v 1.75 2003/05/02 15:41:59 nick Exp $</small>
@


1.75
log
@
Link changed (yay! not a stupid typo I made!).  Spotted by Peter Galbavy.
@
text
@d1909 1
d2130 1
a2130 1
<small>$OpenBSD: faq13.html,v 1.74 2003/04/03 15:12:53 nick Exp $</small>
@


1.74
log
@
uh...  find one error, look for it elsewhere.  Bad Nick@@.  Pointed out
by Mathieu Sauve-Frankel (m dot sauve at secureops dot com), thanks!
@
text
@d1907 1
a1907 1
<li><a href="http://www.vpcom.com/">Ashley Laurent</a> VPCom VPN software
d2129 1
a2129 1
<small>$OpenBSD: faq13.html,v 1.73 2003/03/29 20:22:58 nick Exp $</small>
@


1.73
log
@
Typos, caught by Mathieu Sauve-Frankel (m dot sauve at secureops dot com)
Thanks!    ok kjell@@
@
text
@d1831 1
a1831 1
licensees: &quot;DN:\C=se\CN=IKELAB CA&quot;
d1838 1
a1838 1
licensees: &quot;DN:\C=se\CN=IKELAB CA&quot;
d1845 1
a1845 1
licensees: &quot;DN:\C=se\CN=IKELAB CA&quot;
d2129 1
a2129 1
<small>$OpenBSD: faq13.html,v 1.72 2003/03/22 22:02:20 nick Exp $</small>
@


1.72
log
@
typos, spotted by Adrian Daigle (Adrian dot Daigle at Colorado dot edu),
thanks!
@
text
@d1753 1
a1753 1
licensees: &quot;DN:\C=se\CN=IKELAB CA&quot;
d2129 1
a2129 1
<small>$OpenBSD: faq13.html,v 1.71 2003/03/18 03:41:04 nick Exp $</small>
@


1.71
log
@
* [FAQ Index] [Back] [Next] links at top of page ('bout time.  Finally
decided not having them was worse than the lame ideas I had).
* Top heading changed from <h2> to <h1> throughout
* [Back to Main Index] shortened to [FAQ Index] top and bottom
* Bottoms of faq5.html and faq14.html standardized.
@
text
@d70 1
a70 1
Since you have so many options, IPsec is rather complex (much more so then SSL!)
d751 1
a751 1
You need to remove these lines before using it, they are only for cvs.  
d2129 1
a2129 1
<small>$OpenBSD: faq13.html,v 1.70 2003/02/28 00:34:28 nick Exp $</small>
@


1.70
log
@
Typo fixes from Tom Cosgrove (tom dot cosgrove at arches-consulting dot com).
Thanks!
@
text
@d17 6
d2119 1
a2119 1
<a href= "index.html">[Back to Main Index]</a>
d2129 1
a2129 1
<small>$OpenBSD: faq13.html,v 1.69 2003/02/25 04:00:10 david Exp $</small>
@


1.69
log
@remove double word stuttering.
ok nick@@
@
text
@d87 1
a87 1
traffic for a particular <i>Network</i>.)
d2123 1
a2123 1
<small>$OpenBSD: faq13.html,v 1.68 2003/02/24 00:44:43 kjell Exp $</small>
@


1.68
log
@change h1s to h2s for consistency. From tom cosgrove, via nick@@
@
text
@d1430 1
a1430 1
This basically means that that there are no policy limitations on who
d2123 1
a2123 1
<small>$OpenBSD: faq13.html,v 1.67 2003/02/22 19:22:38 kjell Exp $</small>
@


1.67
log
@/etc/isakmpd/policy -> /etc/isakmpd/isakmpd.policy for consistency
from Xavier Santolaria
@
text
@d53 1
a53 1
<h1>13.1 - What is IPsec?</h1>
d98 1
a98 1
<h1>13.2 - That's nice, but why do I want to use IPsec?</h1>
d137 1
a137 1
<h1>13.3 - What are the protocols behind IPsec?</h1>
d164 1
a164 1
<h1>13.4 - On the wire format</h1>
d288 1
a288 1
<h1>13.5 - Configuring IPsec</h1>
d382 1
a382 1
<h1>13.6 - How do I set up IPsec with manual keying?</h1>
d654 1
a654 1
<h1>13.7 - How do I set up isakmpd?</h1>
d1036 1
a1036 1
<h1>13.8 - How do I use isakmpd with X.509 certificates?</h1>
d1888 1
a1888 1
<h1>13.9 - What IKE clients are compatible with isakmpd?</h1>
d1931 1
a1931 1
<h1>13.10 - Troubleshooting IPsec/VPN</h1>
d2050 1
a2050 1
<h1>13.11 - Related Documentation</h1>
d2123 1
a2123 1
<small>$OpenBSD: faq13.html,v 1.66 2003/02/22 19:14:06 kjell Exp $</small>
@


1.66
log
@* setup is noun. 'set up' is the verb form. (pet peeve)
* More hrefs. They are free
* Clarify some text, mainly around subjectAltName, FQDN, and UFQDN identifiers
ok ho@@, nick@@ (many moons ago)
@
text
@d1180 1
a1180 1
Policy-File=            /etc/isakmpd/policy
d1372 1
a1372 1
Policy-File=            /etc/isakmpd/policy
d2123 1
a2123 1
<small>$OpenBSD: faq13.html,v 1.65 2003/02/20 03:09:56 nick Exp $</small>
@


1.65
log
@
Page name cleanups.  Standardize capitalization, and change
x.0 -> x on titles and on "next/previous" links at bottom of page.
From Tom Cosgrove (tom dot cosgrove at arches-consulting dot com), thanks!
@
text
@d28 2
a29 2
<li><a href="#ManKey"   >13.6 - How do I setup IPsec with manual keying?</a>
<li><a href="#isakmpd"  >13.7 - How do I setup isakmpd?</a>
d92 1
a92 1
registry, every machine on the internet could talk to another one
d382 1
a382 1
<h1>13.6 - How do I setup IPsec with manual keying?</h1>
d386 1
a386 1
You can setup encryption between networks, to create VPNs using this
d451 1
a451 1
Now, you need to setup SAs, or Security Associations.
d549 1
a549 1
Next, setup a flow from 208.1.1.1 to 208.2.2.2
d556 1
a556 1
Next, setup a flow from 208.1.2.0/24, which is behind 208.2.2.2, to 192.168.99.0/24
d563 1
a563 1
Next, setup a flow from 208.1.5.0/24, which is behind 208.2.2.2, to 192.168.99.0/24
d570 1
a570 1
Now, setup a flow from 208.1.2.0/24, which is behind 208.2.2.2 to the router 208.1.1.1.
d577 1
a577 1
OK, setup a flow from 208.1.5.0/24, which is behind 208.2.2.2, to the router 208.1.1.1
d584 1
a584 1
Finally, setup a flow from the router 208.2.2.2 to 192.168.99.0/24
d594 1
a594 1
Same as before, we setup the SAs...
d603 1
a603 1
Setup a flow from the router 208.2.2.2 to 208.1.1.1
d610 1
a610 1
Setup a flow from the network 192.168.99.0/24, which is behind 208.1.1.1, to 208.1.2.0/24
d617 1
a617 1
Setup a flow from the network 192.168.99.0/24, which is behind 208.1.1.1, to 208.1.5.0/24
d624 1
a624 1
Now, setup a flow from 192.169.99.0/24, which is behind 208.1.1.1, to the router 208.2.2.2
d654 1
a654 1
<h1>13.7 - How do I setup isakmpd?</h1>
d667 9
a675 4
ISAKMP (sometimes referred to as IKE,
or Internet Key Exchange) is the key exchange mechanism for the VPN. It
meets security concerns using the methods mentioned in RFC 2407, RFC 2408
and RFC 2409. ISAKMP manages the exchange of cryptographic keys that you
d690 2
a691 1
cases where network bandwidth is of concern.
d702 1
a702 1
same phase 1 channel.  Phase 2 is used to setup the actual tunnels.
d712 2
a713 2
By default, OpenBSD comes with the proper binaries for ISAKMP and the
IPsec stack. Example configuration files may be found in
d718 1
a718 1
Here we attempt to show you how to setup a VPN (tunnel).  If you want to
d783 1
a783 1
This is where you can setup the variables that will affect the main behavior of isakmpd. It is okay to 
d955 1
a955 1
will setup 192.168.1.0/255.255.255.0 for Host A (which was connected
d1027 5
a1031 4
the first time you decide to run this daemon. The daemon will not be running in daemon mode but as a 
regular process. It will log everything to your terminal.  To stop isakmpd
and flush the routes, you need to kill the isakmpd process on each node,
and run <b>ipsecadm flush</b>.
d1039 5
a1043 3
Setting up isakmpd to use certificates instead of pre-shared keys is not really that much harder in a big network with many untrusted peers than it would
be with a small network.  It may actually simplify configuration, and more
importantly, key management.
d1058 10
a1067 6
The X.509 certificates need to have a Subject Alternative Name
(SubjectAltName) extension describing the certificate holder.  How to
set a SubjectAltName extension using certpatch for a certificate is
also described in README.PKI for the case of setting an IP address as
the SubjectAltName. Using an IP address here is also the default
behaviour for isakmpd.
d1070 9
a1078 4
Certpatch also support using either a FQDN (Fully Qualified Domain
Name) or a UFQDN (User FQDN). An example of an FQDN might be
<tt>www.openbsd.org</tt>, an example of an UFQDN would be an email
address. Something like <tt>Jorgen.Granstam@@abc.se</tt> for example. 
d1081 1
a1081 4
In this howto document I am going to use FQDNs as
SubjectAltNames. Using IP addresses would be a bit easier since that
is the default behaviour of isakmpd but it is not much of a difference 
as we soon will see. 
d1084 1
a1084 1
To insert an FQDN SubjectAltName into a certificate one would do
d1100 25
a1124 3
Put the keys and certificates in the directories as described at the
end of README.PKI. The CA key (ca.key) should be kept in some safe
place if the keys are really to be seriously used. 
d1141 1
a1141 1
configuration for the preshared keys case (see previous section) there won't be
d1215 1
a1215 1
# data is currently used only in the preshared key case. 
d1442 1
a1442 1
almost be considered snakeoil today, it is left as an exercise for the
d1456 2
a1457 2
be one or more entities). The simple case would be the preshared key
case. In that case, anyone who knows the preshared passphrase is
d1496 1
a1496 1
sublicensed or delegated to a key. In this case it is usually a
d1559 1
a1559 1
sublicense to such credentials. Remember sublicensing above. It is
d1863 1
a1863 1
could actually authorize users by just putting the right SubjectAltName
d1948 1
a1948 1
If your traffic is in cleartext, then your flows are setup incorrectly
d2123 1
a2123 1
<small>$OpenBSD: faq13.html,v 1.64 2003/02/18 02:53:38 nick Exp $</small>
@


1.64
log
@
& -> &amp; for validation...
Spotted by David Krause.  Whoohoo!  I don't think I broke that one!! 8-)
And with that, faq1.html -> faq14.html all pass validation.  Neato.
Now is the time to start the pool of when and what file I break validation
on next.
@
text
@d4 1
a4 1
<title>13.0 - Using IPsec</title>
d17 1
a17 1
<h1><font color="#e00000">13.0 - Using IPsec (IP Security Protocol)</font></h1>
d2077 2
a2078 2
<a href= "faq12.html">[To Section 12.0 - For Advanced Users]</a>
<a href= "faq14.html">[To Section 14.0 - Using disks in OpenBSD]</a>
d2086 1
a2086 1
<small>$OpenBSD: faq13.html,v 1.63 2003/01/12 22:48:23 kjell Exp $</small>
@


1.63
log
@* Match some (approved) changes I'm about to make to the ipsec(4) man page
* Kill -DA=99 references (-DA=90 only, please)
* AH, ESP enabled by default now
* Yes, sample files are included in the base system
* /dev/urandom isn't necessarily strong. use openssl rand
* more consistency in <tt> tags around paths.
* Don't use AH unless you have a real need for it
ok nick@@, ho@@
@
text
@d411 1
a411 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&sektion=8"
d2086 1
a2086 1
<small>$OpenBSD: faq13.html,v 1.62 2003/01/01 13:01:59 nick Exp $</small>
@


1.62
log
@
Rev copyrights to 2003.
@
text
@d107 4
a110 4
<h4>Confidentiality</h4> Make sure it is hard for anyone but the receiver
to understand what data has been communicated.  You do not want
anyone to see your passwords when logging into a remote machine
over the Internet.
d124 8
a131 11
<h4>Replay protection</h4> We need ways to ensure a transaction can only
be carried out once unless we are authorized to repeat it.  I.e. it
should not be possible for someone to record a transaction, and
then replaying it verbatim, in order to get an effect of multiple
transactions being received by the peer.  Consider the attacker has
got to know what the traffic is all about by other means than
cracking the encryption, and that the traffic causes events
favorable for him, like depositing money into his account.  We
need to make sure he cannot just replay that traffic later.
<i>WARNING: as per the standards specification, replay protection is not
performed when using manual-keyed IPsec (e.g., when using <a
d141 2
a142 2
protection through two new protocols.  These protocols are called AH,
Authentication header, and ESP, Encapsulated security payload.
d146 4
a149 3
confidentiality). Its main difference with ESP is that AH also secures
parts of the IP header of the packet (like the source/destination
addresses).
d159 2
d392 3
a394 5
First, you need to turn on IP AH and IP ESP options in the OpenBSD
kernel (if you are only using ESP, such as with the rc.vpn script, or
as with the example below, then <i>you do not need to enable AH</i>. In fact,
there may even be security concerns related to enabling AH if you are not
using it).
d396 4
a399 2
<p>
There is a nice sysctl to enable these protocols.
d401 1
d403 2
a404 4
# <b>sysctl -w net.inet.esp.enable=1</b><br>
net.inet.esp.enable: 0 -&gt; 1<br>
# <b>sysctl -w net.inet.ah.enable=1</b><br>
net.inet.ah.enable: 0 -&gt; 1
d407 1
d409 9
a417 3
You can edit <tt>/etc/sysctl.conf</tt> to turn these on at boot time.
You need to remove the # mark from in front of net.inet.esp.enable and/or
net.inet.ah.enable
d421 7
a427 1
You also need to generate your manual keys.
d432 1
a432 1
device.  To produce 160 bits of randomness, for example, do:
d435 1
a435 1
# <b>dd if=/dev/urandom bs=1024 count=1 | sha1</b>
d707 5
a711 13
IPsec stack. Unfortunately, the same
cannot be said for the sample files. To retrieve them, you need to grab:
/usr/src/sbin/isakmpd/samples/VPN-east.conf and
/usr/src/sbin/isakmpd/samples/policy from the source tree.  You can
either use your CD (if you have one), <a
href="http://www.openbsd.org/cgi-bin/cvsweb/">cvsweb</a>, or
the <a href="../anoncvs.html">command line CVS
client</a>. (Cvsweb has <a
href="http://www.openbsd.org/cgi-bin/cvsweb/src/sbin/isakmpd/samples/VPN-east.conf">VPN-east.conf</a>
and <a
href="http://www.openbsd.org/cgi-bin/cvsweb/src/sbin/isakmpd/samples/policy">policy</a>
readily available).  For the purposes of this example, copy <i>policy</i>
to /etc/isakmpd/isakmpd.policy.  Copy <i>VPN-east.conf</i> to /etc/isakmpd/isakmpd.conf.
d720 5
a724 3
Your first step is to turn on esp.  The top of the FAQ section on <a href="#ManKey">
Manual Keying</a> tells you how to do this both for run-time and boot.
Next, you need to edit /etc/isakmpd/isakmpd.policy.  
d726 1
a726 1
using Encapsulate Security Payload(ESP), and has authenticated with the passphrase mekmitasdigoat (or whatever
d755 1
a755 1
On host A, edit /etc/isakmpd/isakmpd.conf.  The 249.2.2.2 sample IP address
d1017 1
a1017 1
# <b>isakmpd -d -DA=99</b>
d1093 1
a1093 1
Lets now look at the /etc/isakmpd/isakmpd.conf configuration file.  It
d1097 1
a1097 1
here than the example file in the man-page to make it easier to
d1955 1
a1955 1
To turn on all debugging in isakmpd, start it as
d1957 1
a1957 1
# <b>/sbin/isakmpd -d -DA=99</b>
d1962 1
a1962 1
# <b>/sbin/isakmpd -d -DA=99 -D1=70</b>
d2086 1
a2086 1
<small>$OpenBSD: faq13.html,v 1.61 2002/11/26 01:02:04 nick Exp $</small>
@


1.61
log
@
Validation Man strikes again!  More great work from Horacio.  Thanks!
@
text
@d11 1
a11 1
<meta name= "copyright"     content= "This document copyright 2000-2002 by OpenBSD">
d2080 1
a2080 1
<small>$OpenBSD: faq13.html,v 1.60 2002/11/03 00:21:54 mcbride Exp $</small>
@


1.60
log
@isakmpd works with Lucent's Access Point

ok henning@@ nick@@
@
text
@d1 1
d6 1
d17 1
a17 1
<h1><font color=#e00000>13.0 - Using IPsec (IP Security Protocol)</font></h1>
d20 1
a20 1
<P>
d34 2
a35 1
</UL>
d37 1
a37 1
<Font size="-1">
a38 7
<UL>
<LI><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ipsec&sektion=4&format=html">ipsec(4)</a>
<LI><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=vpn&sektion=8&format=html">vpn(8)</a>
<LI><a href="http://www.freebsd.org/~julian/IPSEC_4_Dummies.html">IPsec for Dummies</a> by Julian Elischer
<LI><a href="http://www.secureops.com/vpn/vpn.html">ISAKMP Howto</a> by Patrick Ethier
<LI><a href="http://hem.passagen.se/hojg/isakmpd/">X.509v3 certificates with isakmpd</a> by J&ouml;rgen Granstam
</UL>
d40 8
d49 1
d54 2
a55 2
</p>
<P>
d65 2
a66 1
<P>
d74 2
a75 1
<P>
d77 8
a84 5
<UL>
<LI>Host-to-Host
<LI>Host-to-Network
<LI>Network-to-Network
</UL>
d88 2
a89 1
<P>
a98 1
</p>
d100 1
a100 1
<P>
d105 2
a106 1
<P>
d111 2
a112 1
<P>
d117 2
a118 1
<P>
d122 2
a123 1
<P>
d135 1
a135 1
href="http://www.openbsd.org/cgi-bin/man.cgi?query=ipsecadm&apropos=0&sektion=8&format=html">ipsecadm(8)</a>)</i>.
a140 1
</p>
d142 1
a142 1
<P>
d146 2
a147 1
<P>
d152 2
a153 1
<P>
a164 1
</p>
d166 2
a167 1
<P>The <B>Authentication Header</B>
d172 1
a172 1
AH, however they all must follow the guidelines specified in <a href="http://www.cis.ohio-state.edu/htbin/rfc/rfc2402.html">RFC2402</A>.
d174 3
a176 2
<P>The <B>Encapsulating
Security Payload</B> (ESP) header, allows for rewriting of the payload
d179 1
a179 1
the payload. The various types of ESP applicable must follow <a href="http://www.cis.ohio-state.edu/htbin/rfc/rfc2406.html">RFC2406</A>.
d183 2
a184 1
<P>An orthogonal (mostly) division of IPsec functionality is applied depending
d188 2
a189 2
<UL>
<LI><B>Transport</B> mode is used by a host that is generating the packets.
d195 1
a195 1
not the end-to-end IP header.</LI>
d197 1
a197 1
<LI><B>Tunnel</B> mode is used when the end-to-end IP header is already
d202 2
a203 2
the secure connection (though that may of course be several IP hops away).</LI>
</UL>
d205 2
a206 2
<P>IPsec secured links are defined in terms of <B>Security Associations
</B>(SAs). Each SA is defined for a single unidirectional flow of data,
d208 1
a208 1
traffic distinguishable by some <B>unique selector</B>. All traffic flowing
d211 3
a213 3
SA <B>Bundle</B>. Incoming packets can be assigned to a particular SA by
the three defining fields, (<B>Destination IP address, Security Parameter
Index, security protocol</B>). SPI can be considered a cookie that is handed
d220 3
a222 1
<P>An example of a tunnel mode AH packet is:
d226 2
a227 2
<td><B>IPhdr</B></td>
<td><B>AH</B></td>
d234 3
a236 1
<P>An example of a transport mode AH packet is:
d240 2
a241 2
<td><B>IPhdr</B></td>
<td><B>AH</B></td>
d247 2
a248 1
<P>Because an ESP header cannot authenticate the outer IP header,
d250 1
d254 5
a258 5
<td><B>IPhdr</B></td>
<td><B>AH</B></td>
<td><B>ESP</B></td>
<td><I>TCPhdr</I></td>
<td><I>data</I></td>
d262 1
a262 1
<P>This is called <B>Transport Adjacency</B>. The tunneling version would
d264 1
d268 6
a273 6
<td><B>IPhdr</B></td>
<td><B>AH</B></td>
<td><B>ESP</B></td>
<td><I>IPhdr2</I></td>
<td><I>TCPhdr</I></td>
<td><I>data</I></td>
d277 2
a278 1
<P>However it is not specifically mentioned in the RFC. As with Transport
a288 1
</p>
d290 2
a291 1
<P>How the IPsec systems and gateways are configured is to some extent
d295 3
a297 2
<P>There are two administrative entities that control what happens to a
packet. One is the <B>Security Association Database</B> (SAD, referred
d299 1
a299 1
and the other is the <B>Security Policy Database</B> (SPD).
d301 2
a302 1
<P>They are similar in that given a number of selectors that describe some
d313 2
a314 1
<P>Outgoing packets go from the SPD entry to the specific SA, to get encoding
d318 2
a319 1
<P>The SPD can also specify what traffic should bypass IPsec and what should
d324 2
a325 1
<P>The SPD can be thought of as similar to a packet filter where the actions
d331 19
a349 1
<P>A SAD entry would include:
d351 4
a354 20
<UL>
<LI>Dest IP address
<LI>IPsec proto (AH or ESP)
<LI>SPI (cookie)
<LI>Sequence counter
<LI>Seq O/F flag
<LI>Anti-replay window info
<LI>AH type and info
<LI>ESP type and info
<LI>Lifetime info
<LI>Tunnel/transport mode flags
<LI>Path MTU info
</UL>

<P>A SPD entry would contain:

<UL>
<LI>Pointer to active SAs
<LI>Selector fields
</UL>
d356 2
a357 1
<P>Each SA can define one ESP header and one AH header.
d364 2
a365 1
<P>The SPD in OpenBSD is managed through the <tt>ipsecadm flow</tt> command.
d368 1
a368 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ipsecadm&apropos=0&sektion=8&format=html">ipsecadm(8)</a>,
d373 2
a374 2
<a href="http://www.cis.ohio-state.edu/htbin/rfc/rfc2408.html">RFC2408,</A> and
<a href="http://www.cis.ohio-state.edu/htbin/rfc/rfc2409.html">RFC2409</A>)
d376 1
a376 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=isakmpd&sektion=8">isakmpd(8)</a>
d383 2
a384 2
</p>
<P>
d390 2
a391 1
<P>
d396 3
a398 1
using it).<P>
d400 3
a402 2
<ul><tt>
# <b>sysctl -w net.inet.esp.enable=1</b><BR>
d406 3
a408 1
</tt></ul>
d413 2
a414 1
<P>
d419 1
a419 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=random&sektion=4&format=html">random(4)</a>
d421 2
a422 1
<UL><tt>
d424 3
a426 1
</TT></UL>
d428 2
a429 1
<PRE>
d436 3
a438 2
</PRE>
<P>
d444 3
a446 2
<P>
<I>These examples only use ESP to encrypt your traffic.  ESP includes
d450 3
a452 4
tunnel environment.</I>
<P>
<ul>
<tt>
d455 3
a457 3
</tt>
</ul>
<P>
d459 2
a460 1
<P>
d462 3
a464 3
<UL>
<TT>
# <b>ipsecadm new esp -spi 1000 -src 192.168.5.1 -dst 192.168.25.9 -forcetunnel -enc blf -auth sha1 -key 7762d8707255d974168cbb1d274f8bed4cbd3364 -authkey 6a20367e21c66e5a40739db293cf2ef2a4e6659f</b><BR>
d466 3
a468 2
</TT>
</UL>
d470 3
a472 3
<UL>
<TT>
# <b>ipsecadm new esp -spi 1001 -src 192.168.25.9 -dst 192.168.5.1 -forcetunnel -enc blf -auth sha1 -key 7762d8707255d974168cbb1d274f8bed4cbd3364 -authkey 6a20367e21c66e5a40739db293cf2ef2a4e6659f</b><BR>
d474 3
a476 3
</TT>
</UL>
<P>
d478 2
a479 1
<P>
d482 5
a486 2
<P>
On 192.168.5.1:<P>
d491 6
a496 5
<ul>
<tt>
# <b>ipsecadm flow -proto esp -dst 192.168.25.9 -spi 1000
-addr 192.168.5.1 255.255.255.255 192.168.25.9 255.255.255.255</b>
</tt></ul>
d498 6
a503 6
<ul>
<tt>
# <b>ipsecadm flow -proto esp -dst 192.168.5.1 -spi 1001
-addr 192.168.25.9 255.255.255.255 192.168.5.1 255.255.255.255</b>
</tt></ul>
<P>
d511 1
d514 2
a515 1
<P>
d520 2
a521 1
<P>
d525 2
d528 1
a528 1
First, set up the security associations (SAs):<BR>
d530 2
a531 1
<UL><tt>
d534 3
a536 1
</tt></ul>
d538 2
a539 1
<ul><tt>
d541 3
a543 1
</tt></ul>
d545 2
a546 1
<ul><tt>
d548 3
a550 1
</tt></ul>
d552 2
a553 1
<ul><tt>
d555 3
a557 1
</tt></ul>
d559 2
a560 1
<ul><tT>
d562 3
a564 1
</tt></ul>
d566 2
a567 1
<ul><tt>
d569 3
a571 1
</tt></ul>
d573 2
a574 1
<ul><tt>
d576 3
a578 2
</tt></ul>
<P>
d580 2
d583 2
a584 1
<ul><tt>
d587 3
a589 1
</tt></ul>
d592 2
a593 1
<ul><tt>
d595 3
a597 1
</tt></ul>
d599 2
a600 1
<ul><tt>
d602 3
a604 1
</tt></ul>
d606 2
a607 1
<ul><tt>
d609 3
a611 1
</tt></ul>
d613 2
a614 1
<ul><tt>
d616 3
a618 1
</tt></ul>
d622 2
a623 1
<ul><tt>
d626 3
a628 2
</tt></ul>
<P>
d631 2
a632 1
<ul><tt>
d634 3
a636 1
</tt></ul>
d639 1
d643 3
a645 2
</p> 
<P>If you are thinking about VPNs or other traditional applications
a648 1
<P>
d650 6
a655 1
<h3>13.7.1 - What is isakmpd?</h3> ISAKMP (sometimes referred to as IKE,
d660 1
a660 1
href="http://www.openbsd.org/cgi-bin/man.cgi?query=ipsecadm&apropos=0&sektion=8">ipsecadm(8)</a>.
d664 2
a665 1
<P> <b>Phase 1</b> - The two ISAKMP peers establish a secure,
a673 1
<P>
d675 1
d681 1
a681 2
<P>

d693 1
a693 1
<P>
d712 2
a713 2
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=isakmpd.conf&sektion=5">isakmpd.conf(5)</a> and 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=isakmpd.policy&sektion=5">isakmpd.policy(5)</a>.
d715 1
a715 1
<P>
d725 2
a726 2
<BR>
<UL><PRE>
d729 3
a731 2
</PRE></UL>
<P>
d734 2
a735 1
<P>
d737 2
a738 1
<BR><UL><PRE>
d745 3
a747 1
</pre></UL>
d752 1
a752 1
<UL><PRE>
d757 1
a757 1
</PRE></UL>
d759 1
d763 1
a763 1
<UL><PRE>
d768 1
a768 1
</PRE></UL>
d770 2
a771 1
<p>This is where you can setup the variables that will affect the main behavior of isakmpd. It is okay to 
d777 2
a778 1
<P>
d781 1
a781 1
<UL><PRE>
d784 1
a784 1
</PRE></UL>
d786 1
d789 1
a789 1
<UL><PRE>
d792 1
a792 1
</PRE></UL>
d794 2
a795 1
<p>This section describes the IP addresses to accept in order to negotiate the phase 1 connection. 
d799 1
d802 2
a803 1
<UL><PRE>
d806 1
a806 1
</PRE></UL>
d808 1
d811 1
a811 1
<UL><PRE>
d814 1
a814 1
</PRE></UL>
d816 2
a817 1
<p>This describes Phase 2 of the connection. This is the phase that determines what protocols the two 
d820 2
a821 1
<p>The <b>Connections</b>= tag refers to the section below. 
d827 2
a828 1
<p>If you do not have the IP address of the remote host, you can specify a Default= that points 
d831 2
a832 1
<P>
d834 2
a835 1
<UL><PRE>
d844 1
a844 1
</PRE></UL>
d846 1
d849 1
a849 1
<UL><PRE>
d858 1
a858 1
</PRE></UL>
d860 1
d864 1
d889 1
a889 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=isakmpd.conf&apropos=0&sektion=5&format=html">isakmpd.conf(5)</a>
d892 2
a893 1
<P>
d895 2
a896 1
<UL><PRE>
d903 1
a903 1
</PRE></UL>
d905 1
d907 2
a908 1
<UL><PRE>
d915 1
a915 1
</PRE></UL>
d917 2
a918 1
<p>These represent the sections referred to by the Phase 2 section above. They are the 
d921 1
d937 1
a937 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=isakmpd.conf&apropos=0&sektion=5&format=html">isakmpd.conf(5)</a>.
d939 2
a940 1
<P>
d945 2
a946 1
<UL><PRE>
d956 1
a956 1
</PRE></UL>
d958 2
a959 1
<p>These two sections are in the <b>conf</b> file of each host. They are the sections referenced by the 
d964 1
a964 1
<P>
d966 2
a967 1
<UL><PRE>
d972 1
a972 1
</PRE></UL>
d974 1
d986 1
a986 1
<UL><PRE>
d991 1
a991 1
</PRE></UL>
d993 2
a994 1
<p>This section describes the requirements for the encryption of the data to be sent through the VPN and 
d1006 2
d1009 6
a1014 5
<P>
<ul>
<tt># <b>isakmpd -d -DA=99</b></tt>
</ul>
<P>
d1020 1
d1024 2
a1025 2
</p>
<P>
d1029 1
a1029 1
<P>
d1033 1
d1041 1
d1049 1
d1055 1
d1061 1
d1065 5
a1070 3
<UL><TT>
$ <b>/usr/sbin/certpatch -t fqdn -i home.mysite.se -k ca.key originalcert.crt newcert.crt</b>
</TT></UL>
d1077 1
d1085 2
a1086 1
  
d1089 1
a1089 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=isakmpd.conf&sektion=5">isakmpd.conf(5)</a>
d1095 1
d1102 1
d1105 1
a1106 1

d1124 1
d1128 2
a1129 2
<UL>
<pre>
d1315 2
a1316 2
</pre>
</UL>
d1322 2
a1323 3
<p>
<UL>
<pre>
d1362 2
a1363 2
</pre>
</UL>
a1366 1
<p>
d1371 1
d1374 1
a1374 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=isakmpd.policy&sektion=5">isakmpd.policy(5)</a>
d1377 1
d1381 2
a1382 3
<p>
<UL>
<pre>
d1384 2
a1385 2
</pre>
</UL>
d1393 1
d1402 2
a1403 3
<p>
<UL>
<pre>
d1409 2
a1410 2
</pre>
</UL>
d1416 2
a1417 3
<p>
<UL>
<pre>
d1423 2
a1424 2
</pre>
</UL>
d1429 1
d1436 2
a1437 3
<p>
<UL>
<pre>
d1449 2
a1450 2
</pre>
</UL>
d1457 2
a1458 3
<p>
<UL>
<pre>
d1476 2
a1477 2
</pre>
</UL>
d1484 2
a1485 3
<p>
<UL>
<pre>
d1509 2
a1510 2
</pre>
</UL>
d1519 2
a1520 3
<p>
<UL>
<pre>
d1538 2
a1539 2
</pre>
</UL>
d1545 1
a1545 1
<p>
d1549 1
d1555 1
d1563 1
d1575 1
d1598 1
d1611 1
d1623 1
d1632 1
a1632 1
<p>
d1636 1
d1639 1
a1639 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=isakmpd.policy&sektion=5">isakmpd.policy(5)</a>.
d1642 2
a1643 3
<p>
<UL>
<pre>
d1662 2
a1663 2
</pre>
</UL>
d1668 2
a1669 3
<p>
<UL>
<pre>
d1675 2
a1676 2
</pre>
</UL>
d1700 1
a1700 3
<p>
<UL>
<pre>  
d1711 2
a1712 2
</pre>
</UL>
d1717 2
a1718 2
<p>
<UL><tt>
d1720 2
a1721 1
</tt></UL>
d1726 1
a1732 1
<H2>Multiuser configurations and/or centrally managed authorization.</h2>
d1734 3
d1748 2
a1749 3
<p>
<UL>
<pre>
d1752 2
a1753 2
</pre>
</UL>
d1759 1
d1768 2
a1769 3
<P>
<UL>
<pre>
d1802 1
a1802 3
</pre> 
</UL>
<p> 
d1804 1
a1816 1

a1832 1

d1842 1
d1846 2
a1847 2
</a>
<P>
d1852 2
a1853 1
<P>
d1855 10
a1864 8
<UL>
<!-- <LI><a href="http://www.timestep.com/">TimeStep</a> PERMIT/Client -->
<LI><a href="http://www.vpcom.com/">Ashley Laurent</a> VPCom VPN software
<LI><a href="http://www.pgp.com/">PGP VPN</a> software
<LI><a href="http://www.cisco.com/">Cisco</a> IRE client
<LI><a href="http://www.microsoft.com">Microsoft</a> Windows 2000, XP
</UL>
<P>
d1866 19
a1884 18
<UL>
<LI><a href="http://www.cisco.com/">Cisco</a> IOS
<LI><a href="http://www.cisco.com/">Cisco</a> PIX
<LI><a href="http://www.intel.com/">Intel</a> LanRover
<!-- <LI><a href="http://www.timestep.com/">TimeStep</a> PERMIT/Gate -->
<LI><a href="http://www.cendio.com/">Cendio</a> Fuego
<LI><a href="http://www.kame.net/">KAME</a> for FreeBSD
<LI><a href="http://www.xs4all.nl/~freeswan/">FreeS/WAN</a> for Linux
<LI><a href="http://www.symantec.com/">Symantec</a> Raptor
<LI><a href="http://www.ericsson.com/">Ericsson</a> eBox
<LI><a href="http://www.f-secure.com/">F-Secure</a> VPN+
<LI><a href="http://www.teamware.com/">Teamware</a> TWISS
<LI><a href="http://www.3com.com/">3com</a> Pathbuilder
<LI><a href="http://www.nortelnetworks.com/">Nortel</a> Contivity
<LI><a href="http://www.checkpoint.com/">CheckPoint</a> FW-1
<LI><a href="http://www.watchguard.com/">Watchguard</a> Firebox III
<LI><a href="http://www.lucent.com/">Lucent</a> Access Point
</UL>
d1889 3
a1891 3
</p>
<P>
Your first tool for troubleshooting IPsec is <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&apropos=0&sektion=8&format=html">tcpdump(8)</a>.
d1893 2
a1894 1
<P>
d1901 3
a1903 3
<UL>
<P>
<LI>
d1906 1
a1906 1
or your isakmp is not negotiating properly.  Use <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ping&apropos=0&sektion=8&format=html">ping(8)</a>
d1908 1
a1908 2
<P>
<UL>
d1911 1
a1911 1
<PRE>
d1920 2
a1921 1
</PRE>
d1923 1
a1923 1
<PRE>
d1934 3
a1936 4
</PRE>
</ul>
<P>
<LI>ISAKMP runs on UDP port 500.  If this is locked out through a firewall
d1938 1
a1938 1
<UL><PRE>
d1946 3
a1948 3
</PRE></UL>
<P>
<LI>
d1950 1
a1950 2
<P>
<UL><TT>
d1952 2
a1953 1
</TT></UL><P>
d1955 1
a1955 2
<P>
<UL><TT>
d1957 3
a1959 3
</TT></UL>
<P>
<LI>You need to allow traffic which has been processed by IPsec from netB
d1961 1
a1961 1
<UL><PRE>
d1964 3
a1966 3
</PRE></UL>
<P>
<LI>With tcpdump on OpenBSD, you can decode most cleartext parts of Internet
d1968 3
a1970 4
<P>
<LI>Mount a /kern filesystem (if you don't use one by default already.)
<P>
<UL><TT>
d1972 2
a1973 2
</TT></UL>
<P>
d1978 3
a1980 3
<P>
<LI>Finally, you can use <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=netstat&apropos=0&sektion=1&format=html">netstat(1)</a> to see your SAs.
<UL><PRE>
d1994 3
a1996 3
</PRE></UL>
<P>
<LI>
d1999 1
a1999 1
warnings or errors, and report them using <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sendbug&apropos=0&sektion=1&format=html">sendbug(1)</a>
d2002 2
a2003 1
</UL>
d2008 1
a2008 1
</p>
d2011 1
a2011 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=vpn&apropos=0&sektion=0&format=html">vpn(8)</a>
d2014 6
a2019 6
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=enc&sektion=4">enc(4)</a>,
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ipsec&sektion=4">ipsec(4)</a>,
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ipsecadm&sektion=8">ipsecadm(8)</a>,
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=isakmpd&sektion=8">isakmpd(8)</a>,
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=isakmpd.conf&sektion=5">isakmpd.conf(5)</a> and
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=isakmpd.policy&sektion=5">isakmpd.policy(5)</a>
d2021 2
a2022 1
<P>
d2024 10
a2033 8
<UL>
<LI><a href="http://www.ietf.org/html.charters/ipsec-charter.html">IETF IPsec Working Group</a>
<LI><a href="http://isakmp-test.ssh.fi/">SSH IPsec interoperability Test Node</a>
<LI><a href="http://ipsec-wit.antd.nist.gov/">NIST IPsec Web Based Interoperability Tester</a>
<LI><a href="http://www.r4k.net/ipsec/">A port of OpenBSD's IPsec to FreeBSD</a>
<LI><a href="http://www.xs4all.nl/~freeswan/">FreeS/WAN - IPsec for Linux</a>
<LI><a href="http://www.pintday.org/hack/docs/vpn-24-minifaq.shtml">OpenBSD 2.4 VPN Configuration Mini-FAQ</a>
</UL>
d2035 32
a2066 30
<A name="rfc">
And on to the RFCs...</a>
<UL>
<LI><a href="http://www.cis.ohio-state.edu/htbin/rfc/rfc1320.html">RFC 1320</a> - The MD4 Message-Digest Algorithm
<LI><a href="http://www.cis.ohio-state.edu/htbin/rfc/rfc1321.html">RFC 1321</a> - The MD5 Message-Digest Algorithm
<LI><a href="http://www.cis.ohio-state.edu/htbin/rfc/rfc1828.html">RFC 1828</a> - IP Authentication using Keyed MD5
<LI><a href="http://www.cis.ohio-state.edu/htbin/rfc/rfc1829.html">RFC 1829</a> - The ESP DES-CBC Transform
<LI><a href="http://www.cis.ohio-state.edu/htbin/rfc/rfc2040.html">RFC 2040</a> - The RC5, RC5-CBC, RC5-CBC-Pad, and RC5-CTS Algorithms
<LI><a href="http://www.cis.ohio-state.edu/htbin/rfc/rfc2085.html">RFC 2085</a> - HMAC-MD5 IP Authentication with Replay Prevention
<LI><a href="http://www.cis.ohio-state.edu/htbin/rfc/rfc2104.html">RFC 2104</a> - HMAC: Keyed-Hashing for Message Authentication
<LI><a href="http://www.cis.ohio-state.edu/htbin/rfc/rfc2144.html">RFC 2144</a> - The CAST-128 Encryption Algorithm 
<LI><a href="http://www.cis.ohio-state.edu/htbin/rfc/rfc2202.html">RFC 2202</a> - Test Cases for HMAC-MD5 and HMAC-SHA-1 
<LI><a href="http://www.cis.ohio-state.edu/htbin/rfc/rfc2207.html">RFC 2207</a> - RSVP Extensions for IPsec Data Flows
<LI><a href="http://www.cis.ohio-state.edu/htbin/rfc/rfc2268.html">RFC 2268</a> - A Description of the RC2 Encryption Algorithm 
<LI><a href="http://www.cis.ohio-state.edu/htbin/rfc/rfc2367.html">RFC 2367</a> - PF_KEY Key Management API, Version 2
<LI><a href="http://www.cis.ohio-state.edu/htbin/rfc/rfc2401.html">RFC 2401</a> - Security Architecture for the Internet Protocol (<b>IPsec</b>)
<LI><a href="http://www.cis.ohio-state.edu/htbin/rfc/rfc2402.html">RFC 2402</A> - IP Authentication Header (<b>AH</b>)
<LI><a href="http://www.cis.ohio-state.edu/htbin/rfc/rfc2403.html">RFC 2403</A> - The Use of HMAC-MD5-96 within ESP and AH
<LI><a href="http://www.cis.ohio-state.edu/htbin/rfc/rfc2404.html">RFC 2404</A> - The Use of HMAC-SHA-1-96 within ESP and AH
<LI><a href="http://www.cis.ohio-state.edu/htbin/rfc/rfc2405.html">RFC 2405</A> - The ESP DES-CBC Cipher Algorithm With Explicit IV
<LI><a href="http://www.cis.ohio-state.edu/htbin/rfc/rfc2406.html">RFC 2406</A> - IP Encapsulating Security Payload (<b>ESP</b>)
<LI><a href="http://www.cis.ohio-state.edu/htbin/rfc/rfc2407.html">RFC 2407</A> - The Internet IP Security Domain of Interpretation for ISAKMP
<LI><a href="http://www.cis.ohio-state.edu/htbin/rfc/rfc2408.html">RFC 2408</A> - Internet Security Association and Key Management Protocol (<b>ISAKMP</b>)
<li><a href="http://www.cis.ohio-state.edu/htbin/rfc/rfc2409.html">RFC 2409</A> - The Internet Key Exchange (<b>IKE</b>)
<LI><a href="http://www.cis.ohio-state.edu/htbin/rfc/rfc2410.html">RFC 2410</A> - The NULL Encryption Algorithm and Its Use With IPsec (ha ha...)
<LI><a href="http://www.cis.ohio-state.edu/htbin/rfc/rfc2411.html">RFC 2411</A> - IP Security Document Roadmap
<LI><a href="http://www.cis.ohio-state.edu/htbin/rfc/rfc2412.html">RFC 2412</A> - The OAKLEY Key Determination Protocol
<LI><a href="http://www.cis.ohio-state.edu/htbin/rfc/rfc2451.html">RFC 2451</a> - The ESP CBC-Mode Cipher Algorithms
<LI><a href="http://www.cis.ohio-state.edu/htbin/rfc/rfc2631.html">RFC 2631</a> - Diffie-Hellman Key Agreement Method
<LI><a href="http://www.cis.ohio-state.edu/htbin/rfc/rfc2709.html">RFC 2709</a> - Security Model with Tunnel-mode IPsec for NAT Domains
d2074 1
d2080 2
a2081 2
<small>$OpenBSD: faq13.html,v 1.59 2002/09/26 18:20:28 nick Exp $</small>
</p>
@


1.59
log
@
error, pointed out by David Krausae <openbsd@@davidkrause.com>,
also removal of Photuris info.
@
text
@d1723 2
a1724 1
<li><a href="http://www.watchguard.com/">Watchguard</a> Firebox III
d1916 1
a1916 1
<small>$OpenBSD: faq13.html,v 1.58 2002/07/12 02:51:35 nick Exp $</small>
@


1.58
log
@
Typos, grammar, wording fixes.
From David Krause <openbsd@@davidkrause.com>, thanks!
@
text
@d337 1
a337 3
OpenBSD implements both Photuris (<a href="http://www.cis.ohio-state.edu/htbin/rfc/rfc2522.html">RFC2522</a>, and
<a href="http://www.cis.ohio-state.edu/htbin/rfc/rfc2523.html">RFC2523</a>)
and ISAKMP automatic key exchange
d342 1
a342 2
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=photurisd&apropos=0&sektion=8&format=html">photurisd(8)</a>
and <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=isakmpd&apropos=0&sektion=8&format=html">isakmpd(8)</a>
d612 1
a612 1
Next, you need to edit /etc/isakmpd.policy.  
a1787 11
<LI>Photuris runs on UDP port 468.  Same considerations, but the protocol is ah.
<UL><PRE>
# Passing in Photuris traffic from the security gateways
pass in on ne0 proto udp from gatewB/32 port = 468 to gatewA/32 port = 468
pass out on ne0 proto udp from gatewA/32 port = 468 to gatewB/32 port = 468

# Passing in encrypted traffic from security gateways
pass in proto ah from gatewB/32 to gatewA/32
pass out proto ah from gatewA/32 to gatewB/32
</PRE></UL>
<P>
a1857 2
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=photurisd&sektion=8">photurisd(8)</a>,
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=startkey&sektion=1">startkey(1)</a>,
a1900 2
<LI><a href="http://www.cis.ohio-state.edu/htbin/rfc/rfc2522.html">RFC 2522</a> - Photuris: Session-Key Management Protocol
<LI><a href="http://www.cis.ohio-state.edu/htbin/rfc/rfc2523.html">RFC 2523</a> - Photuris: Extended Schemes and Attributes
d1915 1
a1915 1
<small>$OpenBSD: faq13.html,v 1.57 2002/07/07 21:58:21 nick Exp $</small>
@


1.57
log
@
closes PR #2777.  Photuris documentation is inaccurate, no help provided
to fix, so removed, as per deraadt@@.
@
text
@d117 1
a117 1
favourable for him, like depositing money into his account.  We
d947 1
a947 1
Actually since everyone who reads this already have a working
d1236 1
a1236 1
This basically means that that there is no policy limitations on who
d1415 1
a1415 1
Well, if the ID information was the IP (the default situation if we
d1572 1
a1572 1
this is a start anyway, and there are another example in the next
d1589 1
a1589 1
Therefor one very nice feature of isakmpd is the ability to use a
d1699 1
a1699 1
isakmp software out there are actually based on the OpenBSD isakmp daemon.
d1933 1
a1933 1
<small>$OpenBSD: faq13.html,v 1.56 2002/07/02 01:17:58 nick Exp $</small>
@


1.56
log
@
recommended by EricJ@@ some time ago, done by Sam Smith <S@@mSmith.net>,
standarizing the displayed shell prompts to be either '#' or '$', as
appropriate.  If anyone cares, Sam was even kind enough to list the
sections where changes were made:
   2.2  2.3  4.5  6.6.3  6.9.1  8.3  8.5  8.10  10.12  10.13  13.7
   13.11  14.3  14.4  14.9
Thanks!
@
text
@d27 5
a31 6
<li><a href="#Photuris" >13.7 - How do I setup photurisd?</a>
<li><a href="#isakmpd"  >13.8 - How do I setup isakmpd?</a>
<li><a href="#x509"     >13.9 - How do I use isakmpd with X.509 certificates?</a>
<li><a href="#IKEcl"    >13.10 - What IKE clients are compatible with isakmpd?</a>
<li><a href="#Trouble"  >13.11 - Troubleshooting IPsec/VPN</a>
<li><a href="#SeeAlso"  >13.12 - Related Documentation</a>
a542 52
<a name= "Photuris"></a>
<a name="13.7"></a>
<h1>13.7 - How do I setup photurisd?</h1>
</p>
<P>
Photuris is not widely used and is still considered experimental
as far as the RFC status is concerned.  However, many people have used it
with OpenBSD.
<P>
To setup your photurisd, first edit /etc/photuris/secrets.conf
on each host with photurisd.
<UL>
<PRE>
# <b>cat /etc/photuris/secrets.conf</b>
# Accepted keywords are:
# identity local &quot;id&quot; &quot;secret&quot;
# identity pair local &quot;receivedid&quot; &quot;myid&quot; &quot;secret&quot;
# identity remote &quot;id&quot; &quot;secret&quot;
# identity lookup &quot;tag&quot; username
# Simple 
identity local &quot;Default&quot; &quot;This should be changed.&quot;
identity remote &quot;Default&quot; &quot;This should be changed.&quot;
</PRE></UL>
Change &quot;This should be changed.&quot; to a key of your choice on the 
local config, and another key of your choice on the remote config.  
(Use the same config on your remote box but swap &quot;local&quot; and 
&quot;remote&quot; so that it sees itself as the local key.)
Note that these keys will be replaced in a future version of photurisd 
that will carry out its initial key exchange with public keys.
<P>
Make sure <tt>net.inet.ah.enable</tt> is set to 1.
<UL><PRE>
# <b>sysctl -w net.inet.ah.enable=1</b>
net.inet.ah.enable: 0 -&gt; 1
</PRE></UL>
And run startkey.
<UL><PRE>
# <b>startkey dst=remote.host</B>
</PRE></UL>
Now, run tcpdump to verify that your packets are being encrypted with AH.
(Run a ping in another window or session to generate traffic.)
<UL><PRE>
# <b>tcpdump proto ah</b>
</PRE></UL>
You can also try using tcpdump by the host address if you aren't getting anything.
<UL><PRE>
# <b>tcpdump host remote.host</b>
</PRE></UL>
You can make photurisd automatically set the source and destination
host or networks in /etc/photuris/photuris.startup

<p>
d544 1
a544 2
<a name="13.8"></a>
<h1>13.8 - How do I setup isakmpd?</h1>
d552 1
a552 1
<h3>13.8.1 - What is isakmpd?</h3> ISAKMP (sometimes referred to as IKE,
d588 1
a588 1
<h3>13.8.2 - How do I get started with isakmpd?</h3>
d869 1
a869 1
<h3>13.8.3 - Starting isakmpd</h3>
d883 1
a883 2
<a name="13.9"></a>
<h1>13.9 - How do I use isakmpd with X.509 certificates?</h1>
d1693 1
a1693 2
<a name= "13.10">
<h1>13.10 - What IKE clients are compatible with isakmpd?</h1>
d1731 1
a1731 2
<a name= "13.11"></a>
<h1>13.11 - Troubleshooting IPsec/VPN</h1>
d1862 1
a1862 2
<a name= "13.12"></a>
<h1>13.12 - Related Documentation</h1>
d1933 1
a1933 1
<small>$OpenBSD: faq13.html,v 1.55 2002/07/01 22:28:27 nick Exp $</small>
@


1.55
log
@
add Watchguard Firebox III, to the list of IKE clients,
reported by Dirk Rosler <dirk@@unicircuits.com>.
@
text
@d557 1
a557 1
bsd# <b>cat /etc/photuris/secrets.conf</b>
d576 1
a576 1
bsd# <b>sysctl -w net.inet.ah.enable=1</b>
d581 1
a581 1
bsd# <b>startkey dst=remote.host</B>
d586 1
a586 1
bsd# <b>tcpdump proto ah</b>
d590 1
a590 1
bsd# <b>tcpdump host remote.host</b>
d1812 1
a1812 1
vpn# <b>ping -c 3 208.1.1.1</b>
d1823 1
a1823 1
vpn# <b>tcpdump -ni fxp7 host 208.1.1.1</b>
d1894 1
a1894 1
vpn% <b>netstat -rn -f encap</b>
d1991 1
a1991 1
<small>$OpenBSD: faq13.html,v 1.54 2002/06/20 06:17:32 chris Exp $</small>
@


1.54
log
@Thomas.Walpuski@@gmx.net brings to attention that Win2K/XP can in fact
use tunnel mode with isakmpd.
@
text
@d1782 1
d1991 1
a1991 1
<small>$OpenBSD: faq13.html,v 1.53 2002/05/29 19:24:44 nick Exp $</small>
@


1.53
log
@
Wording improvement, from David Krause <openbsd@@davidkrause.com>, Thanks!
@
text
@d392 2
a393 2
BLF       Variable (40-160, 160 bits recommended)
CAST      Variable (40-128, 128 bits recommended)
d1763 1
a1763 1
<LI><a href="http://www.microsoft.com">Microsoft</a> Windows 2000 (Transport mode only)
d1990 1
a1990 1
<small>$OpenBSD: faq13.html,v 1.52 2002/05/03 13:24:33 jsyn Exp $</small>
@


1.52
log
@grammar + typos; ok nick@@, ericj@@
@
text
@d997 1
a997 3
here than the example file in the man-page, I have removed from that file
most parts that are not needed in this setup. In part to simplify
the understanding of this setup to make it easier to
d1990 1
a1990 1
<small>$OpenBSD: faq13.html,v 1.51 2002/02/20 03:13:15 nick Exp $</small>
@


1.51
log
@
Grammer corrections
Thanks, David Krause <openbsd@@davidkrause.com>
ok ericj@@
@
text
@d627 3
a629 3
Phase 2 is establishes tunnels or endpoint SAs between IPsec hosts.
<b>Quick Mode</b> is used in Phase 2 because there is not need to repeat a
full authentication because Phase 1 has already established the SAs.
d637 1
a637 1
where they exchange authentication (Either a X509 certificate or a
d1992 1
a1992 1
<small>$OpenBSD: faq13.html,v 1.50 2002/01/27 22:44:34 nick Exp $</small>
@


1.50
log
@
Link Cleanup:  Retargeting links, test all links,
man page references, update and repair as needed.
ok ericj@@
@
text
@d996 1
a996 1
but have been heavily modified. I will also use a much shorter file
d999 2
a1000 1
the understanding of this setup. I have also added some commenting
d1002 1
a1002 1
names. None of the domain names used here exists as far as I know.
d1279 1
a1279 1
not used it before, especially if things doesn't work as expected. The man-page
d1992 1
a1992 1
<small>$OpenBSD: faq13.html,v 1.49 2002/01/21 20:28:25 nick Exp $</small>
@


1.49
log
@
Update copyright notice to 2002.  ok ericj@@
@
text
@d38 5
a42 5
<LI><A HREF="http://www.openbsd.org/cgi-bin/man.cgi?query=ipsec&sektion=4&format=html">ipsec(4)</a>
<LI><A HREF="http://www.openbsd.org/cgi-bin/man.cgi?query=vpn&sektion=8&format=html">vpn(8)</a>
<LI><A HREF="http://www.freebsd.org/~julian/IPSEC_4_Dummies.html">IPsec for Dummies</a> by Julian Elischer
<LI><A HREF="http://www.secureops.com/vpn/vpn.html">ISAKMP Howto</a> by Patrick Ethier
<LI><A HREF="http://hem.passagen.se/hojg/isakmpd/">X.509v3 certificates with isakmpd</a> by J&ouml;rgen Granstam
d59 1
a59 1
You can use <A HREF="http://www.openbsd.org/cgi-bin/cvsweb/src/etc/protocols?rev=1.8">any IP protocol</a> over IPsec.  You can create encrypted tunnels (VPNs), or just do encryption between computers.
d63 6
a68 3
the "recommended reading" of <A HREF="faq6.html">part 6</a> of the FAQ.
In particular, if you don't already understand it, the <A HREF="http://www.3com.com/nsc/501302s.html">Understanding
IP Addressing</a> document is highly recommended.
d121 2
a122 2
performed when using manual-keyed IPsec (e.g., when using <A
HREF="http://www.openbsd.org/cgi-bin/man.cgi?query=ipsecadm&apropos=0&sektion=8&format=html">ipsecadm(8)</a>)</i>.
d158 1
a158 1
AH, however they all must follow the guidelines specified in <A HREF="http://www.cis.ohio-state.edu/htbin/rfc/rfc2402.html">RFC2402</A>.
d164 1
a164 1
the payload. The various types of ESP applicable must follow <A HREF="http://www.cis.ohio-state.edu/htbin/rfc/rfc2406.html">RFC2406</A>.
d338 2
a339 2
OpenBSD implements both Photuris (<A HREF="http://www.cis.ohio-state.edu/htbin/rfc/rfc2522.html">RFC2522</a>, and
<A HREF="http://www.cis.ohio-state.edu/htbin/rfc/rfc2523.html">RFC2523</a>)
d341 3
a343 3
(<A HREF="http://www.cis.ohio-state.edu/htbin/rfc/rfc2407.html">RFC2407</a>,
<A HREF="http://www.cis.ohio-state.edu/htbin/rfc/rfc2408.html">RFC2408,</A> and
<A HREF="http://www.cis.ohio-state.edu/htbin/rfc/rfc2409.html">RFC2409</A>)
d358 1
a358 1
investigate using <A HREF="http://www.openbsd.org/cgi-bin/cvsweb/src/share/ipsec/rc.vpn?rev=1.3">/usr/share/ipsec/rc.vpn</a>
d382 1
a382 1
<A HREF="http://www.openbsd.org/cgi-bin/man.cgi?query=random&sektion=4&format=html">random(4)</a>
d433 1
a433 1
Notice that the SPIs are different.  See <A HREF="#13.4">On the wire format</a> for a complete description of what the SPI is and where it is used.
d468 1
a468 1
These examples were generated using the <A HREF="http://www.openbsd.org/cgi-bin/cvsweb/src/share/ipsec/rc.vpn?rev=1.3">rc.vpn</a> script.
d610 2
a611 2
would normally have to manage with <A
HREF="http://www.openbsd.org/cgi-bin/man.cgi?query=ipsecadm&apropos=0&sektion=8">ipsecadm(8)</a>.
d650 7
a656 7
either use your CD (if you have one), <A
HREF="http://www.openbsd.org/cgi-bin/cvsweb/">cvsweb</a>, or
the <A HREF="http://www.usa.openbsd.org/anoncvs.html">command line CVS
client</a>. (Cvsweb has <A
HREF="http://www.openbsd.org/cgi-bin/cvsweb/src/sbin/isakmpd/samples/VPN-east.conf">VPN-east.conf</a>
and <A
HREF="http://www.openbsd.org/cgi-bin/cvsweb/src/sbin/isakmpd/samples/policy">policy</a>
d663 2
a664 2
<A HREF="http://www.openbsd.org/cgi-bin/man.cgi?query=isakmpd.conf&sektion=5">isakmpd.conf(5)</a> and 
<A HREF="http://www.openbsd.org/cgi-bin/man.cgi?query=isakmpd.policy&sektion=5">isakmpd.policy(5)</a>.
d667 2
a668 2
Your first step is to turn on esp.  The <A HREF="#13.6" TARGET="_blank">top
of section 13.6</a> tells you how to do this both for run-time and boot.
d819 1
a819 1
<A HREF="http://www.openbsd.org/cgi-bin/man.cgi?query=isakmpd.conf&apropos=0&sektion=5&format=html">isakmpd.conf(5)</a>
d861 1
a861 1
<A HREF="http://www.openbsd.org/cgi-bin/man.cgi?query=isakmpd.conf&apropos=0&sektion=5&format=html">isakmpd.conf(5)</a>.
d950 1
a950 1
<A HREF="http://www.openbsd.org/cgi-bin/cvsweb/src/sbin/isakmpd/README.PKI?rev=1.7">README.PKI</a>
d995 1
a995 1
<A HREF="http://www.openbsd.org/cgi-bin/man.cgi?query=isakmpd.conf&sektion=5">isakmpd.conf(5)</a>
d1279 1
a1279 1
<A HREF="http://www.openbsd.org/cgi-bin/man.cgi?query=isakmpd.policy&sektion=5">isakmpd.policy(5)</a>
d1540 1
a1540 1
<A HREF="http://www.openbsd.org/cgi-bin/man.cgi?query=isakmpd.policy&sektion=5">isakmpd.policy(5)</a>.
d1760 5
a1764 6
<LI><A HREF="http://www.timestep.com/">TimeStep</a> PERMIT/Client
<LI><A HREF="http://www.vpcom.com/">Ashley Laurent</a> VPCom VPN software
<LI><A HREF="http://www.nai.com/asp_set/products/tns/pgp_vpn.asp">PGP VPN</a> software
<LI><A HREF="http://www.radguard.com/">Radguard</a> cIPro client
<LI><A HREF="http://www.cisco.com/">Cisco</a> IRE client
<LI><A HREF="http://www.microsoft.com">Microsoft</a> Windows 2000 (Transport mode only)
d1769 14
a1782 15
<LI><A HREF="http://www.cisco.com/">Cisco</a> IOS
<LI><A HREF="http://www.cisco.com/">Cisco</a> PIX
<LI><A HREF="http://www.intel.com/">Intel</a> LanRover
<LI><A HREF="http://www.timestep.com/">TimeStep</a> PERMIT/Gate
<LI><A HREF="http://www.cendio.com/">Cendio</a> Fuego
<LI><A HREF="http://www.kame.net/">KAME</a> for FreeBSD
<LI><A HREF="http://www.xs4all.nl/~freeswan/">FreeS/WAN</a> for Linux
<LI><A HREF="http://www.axent.com/">Axent</a> Raptor
<LI><A HREF="http://www.ericsson.com/">Ericsson</a> eBox
<LI><A HREF="http://www.radguard.com/">Radguard</a> cIPro-VPN
<LI><A HREF="http://www.f-secure.com/">F-Secure</a> VPN+
<LI><A HREF="http://www.teamware.com/">Teamware</a> TWISS
<LI><A HREF="http://www.3com.com/">3com</a> Pathbuilder
<LI><A HREF="http://www.nortelnetworks.com/">Nortel</a> Contivity
<LI><A HREF="http://www.checkpoint.com/">CheckPoint</a> FW-1
d1914 1
a1914 1
actually run into a bug, you may want to send a message to one of the <A HREF="../mail.html">mailing lists</a>.
d1925 1
a1925 1
man page.  There are various configuration templates in <A HREF="http://www.openbsd.org/cgi-bin/cvsweb/src/share/ipsec/">/usr/share/ipsec/</a>
d1927 8
a1934 8
<A HREF="http://www.openbsd.org/cgi-bin/man.cgi?query=enc&sektion=4">enc(4)</a>,
<A HREF="http://www.openbsd.org/cgi-bin/man.cgi?query=ipsec&sektion=4">ipsec(4)</a>,
<A HREF="http://www.openbsd.org/cgi-bin/man.cgi?query=ipsecadm&sektion=8">ipsecadm(8)</a>,
<A HREF="http://www.openbsd.org/cgi-bin/man.cgi?query=photurisd&sektion=8">photurisd(8)</a>,
<A HREF="http://www.openbsd.org/cgi-bin/man.cgi?query=startkey&sektion=1">startkey(1)</a>,
<A HREF="http://www.openbsd.org/cgi-bin/man.cgi?query=isakmpd&sektion=8">isakmpd(8)</a>,
<a HREF="http://www.openbsd.org/cgi-bin/man.cgi?query=isakmpd.conf&sektion=5">isakmpd.conf(5)</a> and
<a HREF="http://www.openbsd.org/cgi-bin/man.cgi?query=isakmpd.policy&sektion=5">isakmpd.policy(5)</a>
d1939 6
a1944 6
<LI><A HREF="http://www.ietf.org/html.charters/ipsec-charter.html">IETF IPsec Working Group</a>
<LI><A HREF="http://isakmp-test.ssh.fi/">SSH IPsec interoperability Test Node</a>
<LI><A HREF="http://ipsec-wit.antd.nist.gov/">NIST IPsec Web Based Interoperability Tester</a>
<LI><A HREF="http://www.r4k.net/ipsec/">A port of OpenBSD's IPsec to FreeBSD</a>
<LI><A HREF="http://www.xs4all.nl/~freeswan/">FreeS/WAN - IPsec for Linux</a>
<LI><A HREF="http://www.codetalker.com/greenbox/docs/vpn-24-minifaq.html">OpenBSD 2.4 VPN Configuration Mini-FAQ</a>
d1950 30
a1979 30
<LI><A HREF="http://www.cis.ohio-state.edu/htbin/rfc/rfc1320.html">RFC 1320</a> - The MD4 Message-Digest Algorithm
<LI><A HREF="http://www.cis.ohio-state.edu/htbin/rfc/rfc1321.html">RFC 1321</a> - The MD5 Message-Digest Algorithm
<LI><A HREF="http://www.cis.ohio-state.edu/htbin/rfc/rfc1828.html">RFC 1828</a> - IP Authentication using Keyed MD5
<LI><A HREF="http://www.cis.ohio-state.edu/htbin/rfc/rfc1829.html">RFC 1829</a> - The ESP DES-CBC Transform
<LI><A HREF="http://www.cis.ohio-state.edu/htbin/rfc/rfc2040.html">RFC 2040</a> - The RC5, RC5-CBC, RC5-CBC-Pad, and RC5-CTS Algorithms
<LI><A HREF="http://www.cis.ohio-state.edu/htbin/rfc/rfc2085.html">RFC 2085</a> - HMAC-MD5 IP Authentication with Replay Prevention
<LI><A HREF="http://www.cis.ohio-state.edu/htbin/rfc/rfc2104.html">RFC 2104</a> - HMAC: Keyed-Hashing for Message Authentication
<LI><A HREF="http://www.cis.ohio-state.edu/htbin/rfc/rfc2144.html">RFC 2144</a> - The CAST-128 Encryption Algorithm 
<LI><A HREF="http://www.cis.ohio-state.edu/htbin/rfc/rfc2202.html">RFC 2202</a> - Test Cases for HMAC-MD5 and HMAC-SHA-1 
<LI><A HREF="http://www.cis.ohio-state.edu/htbin/rfc/rfc2207.html">RFC 2207</a> - RSVP Extensions for IPsec Data Flows
<LI><A HREF="http://www.cis.ohio-state.edu/htbin/rfc/rfc2268.html">RFC 2268</a> - A Description of the RC2 Encryption Algorithm 
<LI><A HREF="http://www.cis.ohio-state.edu/htbin/rfc/rfc2367.html">RFC 2367</a> - PF_KEY Key Management API, Version 2
<LI><A HREF="http://www.cis.ohio-state.edu/htbin/rfc/rfc2401.html">RFC 2401</a> - Security Architecture for the Internet Protocol (<b>IPsec</b>)
<LI><A HREF="http://www.cis.ohio-state.edu/htbin/rfc/rfc2402.html">RFC 2402</A> - IP Authentication Header (<b>AH</b>)
<LI><A HREF="http://www.cis.ohio-state.edu/htbin/rfc/rfc2403.html">RFC 2403</A> - The Use of HMAC-MD5-96 within ESP and AH
<LI><A HREF="http://www.cis.ohio-state.edu/htbin/rfc/rfc2404.html">RFC 2404</A> - The Use of HMAC-SHA-1-96 within ESP and AH
<LI><A HREF="http://www.cis.ohio-state.edu/htbin/rfc/rfc2405.html">RFC 2405</A> - The ESP DES-CBC Cipher Algorithm With Explicit IV
<LI><A HREF="http://www.cis.ohio-state.edu/htbin/rfc/rfc2406.html">RFC 2406</A> - IP Encapsulating Security Payload (<b>ESP</b>)
<LI><A HREF="http://www.cis.ohio-state.edu/htbin/rfc/rfc2407.html">RFC 2407</A> - The Internet IP Security Domain of Interpretation for ISAKMP
<LI><A HREF="http://www.cis.ohio-state.edu/htbin/rfc/rfc2408.html">RFC 2408</A> - Internet Security Association and Key Management Protocol (<b>ISAKMP</b>)
<LI><A HREF="http://www.cis.ohio-state.edu/htbin/rfc/rfc2409.html">RFC 2409</A> - The Internet Key Exchange (<b>IKE</b>)
<LI><A HREF="http://www.cis.ohio-state.edu/htbin/rfc/rfc2410.html">RFC 2410</A> - The NULL Encryption Algorithm and Its Use With IPsec (ha ha...)
<LI><A HREF="http://www.cis.ohio-state.edu/htbin/rfc/rfc2411.html">RFC 2411</A> - IP Security Document Roadmap
<LI><A HREF="http://www.cis.ohio-state.edu/htbin/rfc/rfc2412.html">RFC 2412</A> - The OAKLEY Key Determination Protocol
<LI><A HREF="http://www.cis.ohio-state.edu/htbin/rfc/rfc2451.html">RFC 2451</a> - The ESP CBC-Mode Cipher Algorithms
<LI><A HREF="http://www.cis.ohio-state.edu/htbin/rfc/rfc2522.html">RFC 2522</a> - Photuris: Session-Key Management Protocol
<LI><A HREF="http://www.cis.ohio-state.edu/htbin/rfc/rfc2523.html">RFC 2523</a> - Photuris: Extended Schemes and Attributes
<LI><A HREF="http://www.cis.ohio-state.edu/htbin/rfc/rfc2631.html">RFC 2631</a> - Diffie-Hellman Key Agreement Method
<LI><A HREF="http://www.cis.ohio-state.edu/htbin/rfc/rfc2709.html">RFC 2709</a> - Security Model with Tunnel-mode IPsec for NAT Domains
</UL>
d1991 1
a1991 1
<small>$OpenBSD: faq13.html,v 1.48 2002/01/13 00:00:32 ericj Exp $</small>
@


1.48
log
@
change followed link color, so it is more visible in all netscape,
IE, konqueror

from Nick Holland <nick@@holland-consulting.net>
@
text
@d9 1
a9 1
<meta name= "copyright"     content= "This document copyright 2000-2001 by OpenBSD">
d1990 1
a1990 1
<small>$OpenBSD: faq13.html,v 1.47 2002/01/12 01:39:29 ericj Exp $</small>
@


1.47
log
@
re-target the faq.
Change internal links from #10.XX -> #somethingmeaningfull
This will probobly break some external links to us, but will allow
us greater mobility in moving internal things around without breaking
links in the future.

work by Nick Holland <nick@@holland-consulting.net>
@
text
@d12 1
a12 1
<body bgcolor= "#ffffff" text= "#000000" link= "#23238E">
d1990 1
a1990 1
<small>$OpenBSD: faq13.html,v 1.46 2001/12/23 03:09:52 miod Exp $</small>
@


1.46
log
@IPsec is spelled IPsec, not IPSec.
@
text
@d20 13
a32 13
<UL>
<LI><A HREF="#13.1">13.1 - What is IPsec?</a>
<LI><A HREF="#13.2">13.2 - That's nice, but why do I want to use IPsec?</a>
<LI><A HREF="#13.3">13.3 - What are the protocols behind IPsec?</a>
<LI><A HREF="#13.4">13.4 - On the wire format</a>
<LI><A HREF="#13.5">13.5 - Configuring IPsec</a>
<LI><A HREF="#13.6">13.6 - How do I setup IPsec with manual keying?</a>
<LI><A HREF="#13.7">13.7 - How do I setup photurisd?</a>
<LI><A HREF="#13.8">13.8 - How do I setup isakmpd?</a>
<LI><A HREF="#13.9">13.9 - How do I use isakmpd with X.509 certificates?</a>
<LI><A HREF="#13.10">13.10 - What IKE clients are compatible with isakmpd?</a>
<LI><A HREF="#13.11">13.11 - Troubleshooting IPsec/VPN</a>
<LI><A HREF="#13.12">13.12 - Related Documentation</a>
d47 2
a48 1
<a name= "13.1">
d50 1
a50 1
</a>
d81 1
d83 2
a84 1
<a name= "13.2">
d86 2
a87 1
</a>
d120 1
d122 2
a123 1
<a name= "13.3">
d125 2
a126 1
</a>
d143 4
a146 2
<P>
<a name= "13.4">
d148 1
a148 1
</a>
d258 3
a260 1
<A name="13.5">
d262 1
a262 1
</a>
d345 4
a348 2
<P>
<a name= "13.6">
d350 1
a350 1
</a>
d539 4
a542 2
<P>
<a name="13.7">
d544 1
a544 1
</a>
d592 6
a597 2
<P> <a name="13.8"> <h1>13.8 - How do I setup isakmpd?</h1>
</a> <P>If you are thinking about VPNs or other traditional applications
d932 5
a936 2
<P> <a name="13.9"> <h1>13.9 - How do I use isakmpd with X.509 certificates?</h1>
</a>
d1744 2
a1745 1
<P>
d1783 4
a1786 2
<P>
<a name= "13.11">
d1788 1
a1788 1
</a>
d1915 4
a1918 2
<P>
<a name= "13.12">
d1920 1
a1920 1
</a>
d1990 1
a1990 1
<small>$OpenBSD: faq13.html,v 1.45 2001/10/04 09:59:02 wilfried Exp $</small>
@


1.45
log
@e.g. and i.e. cleanup
@
text
@d3 1
a3 1
<title>13.0 - Using IPSec</title>
d15 1
a15 1
<h1><font color=#e00000>13.0 - Using IPSec (IP Security Protocol)</font></h1>
d21 3
a23 3
<LI><A HREF="#13.1">13.1 - What is IPSec?</a>
<LI><A HREF="#13.2">13.2 - That's nice, but why do I want to use IPSec?</a>
<LI><A HREF="#13.3">13.3 - What are the protocols behind IPSec?</a>
d25 2
a26 2
<LI><A HREF="#13.5">13.5 - Configuring IPSec</a>
<LI><A HREF="#13.6">13.6 - How do I setup IPSec with manual keying?</a>
d31 1
a31 1
<LI><A HREF="#13.11">13.11 - Troubleshooting IPSec/VPN</a>
d40 1
a40 1
<LI><A HREF="http://www.freebsd.org/~julian/IPSEC_4_Dummies.html">IPSec for Dummies</a> by Julian Elischer
d48 1
a48 1
<h1>13.1 - What is IPSec?</h1>
d51 1
a51 1
IPSec is a set of extensions to the IP protocol family.   It provides
d53 1
a53 1
integrity, access control, and confidentiality.  IPSec provides
d56 1
a56 1
because your applications do not have to have any knowledge of IPSec to be
d58 2
a59 2
You can use <A HREF="http://www.openbsd.org/cgi-bin/cvsweb/src/etc/protocols?rev=1.8">any IP protocol</a> over IPSec.  You can create encrypted tunnels (VPNs), or just do encryption between computers.
Since you have so many options, IPSec is rather complex (much more so then SSL!)
d61 1
a61 1
Before you start using IPSec, we strongly recommend that you check out
d66 1
a66 1
In a logical sense, IPSec works in any of these three ways:
d76 1
a76 1
As you can see, IPSec can be used to tunnel traffic for VPN connections.
d82 1
a82 1
<h1>13.2 - That's nice, but why do I want to use IPSec?</h1>
d87 2
a88 2
sender is who he says he is.  IPSec tries to remedy this.  These services 
are considered distinct, but the IPSec supports them in a uniform manner. 
d118 1
a118 1
<h1>13.3 - What are the protocols behind IPSec?</h1>
d121 1
a121 1
IPSec provides confidentiality, integrity, authenticity, and replay
d156 2
a157 2
<P>An orthogonal (mostly) division of IPSec functionality is applied depending
on whether the endpoint doing the IPSec encapsulation is the original source
d177 1
a177 1
<P>IPSec secured links are defined in terms of <B>Security Associations
d250 1
a250 1
<h1>13.5 - Configuring IPSec</h1>
d253 1
a253 1
<P>How the IPSec systems and gateways are configured is to some extent
d259 1
a259 1
to as TDB or TDB table throughout OpenBSD's IPSec source code)
d277 2
a278 2
<P>The SPD can also specify what traffic should bypass IPSec and what should
be dropped, so it must also be consulted for incoming non-IPSec traffic.
d292 1
a292 1
<LI>IPSec proto (AH or ESP)
d312 1
a312 1
An IPSec session must have one or the other or both, but cannot be defined
d336 1
a336 1
<h1>13.6 - How do I setup IPSec with manual keying?</h1>
d339 1
a339 1
Manual keying is the easiest way to get started with IPSec.
d447 1
a447 1
This is a simple way to start using IPSec.
d449 1
a449 1
You can use IPSec to tunnel private IP address spaces over the Internet.
d454 1
a454 1
As you can see, when you are using manual keying with IPSec,
d525 1
a525 1
This will flush all IPSec info (SPIs, flows, routing entries) from your system.
d579 2
a580 2
of IPSec, you probably are going to use ISAKMP.  Some commercial
implementations of IPSec do not provide any manual keying ability, instead
d590 2
a591 2
It employs a two-phase process for establishing the IPSec parameters
between two IPSec nodes.
d604 2
a605 2
<b>Phase 2</b> - Security Associations are negotiated on behalf of IPSec.
Phase 2 is establishes tunnels or endpoint SAs between IPSec hosts.
d614 1
a614 1
In Phase 1, your IPSec nodes establish a connection
d624 1
a624 1
IPSec stack. Unfortunately, the same
d648 1
a648 1
This file tells ISAKMP who can access IPSec. In this scenario, the policy file states that anybody who sends data
d652 1
a652 1
allow anybody to access IPSec.  This is only recommended for testing.
d669 1
a669 1
Conditions: app_domain == &quot;IPSec policy&quot; &amp;&amp;
d832 1
a832 1
<li><b>Local-ID=</b> refers to an IPSec-ID section below that describes our Private Network to 
d835 1
a835 1
<li><b>Remote-ID=</b> refers to an IPSec-ID section below that describes what is supposed to be 
d842 1
a842 1
This is the IPSec-ID section.  These entries need to exist
d894 1
a894 1
<b>Suites=</b> points to a IPSec Suite section describing the different encryption 
d896 1
a896 1
There is much more to be said about ISAKMP and IPSec. By using the above basic descriptions you should 
d999 1
a999 1
That is, two networks that should be connected using an IPSec tunnel over an 
d1033 1
a1033 1
# Now phase 2 is negotiating IPSec SAs. As in phase 1, the name here
d1070 1
a1070 1
# This is the section for the IPSec connection. The section name is
d1074 1
a1074 1
# packages should be forwarded over the IPSec tunnel to the remote 
d1091 1
a1091 1
# will be encrypted and forwarded over the IPSec tunnel to the remote 
d1762 1
a1762 1
<h1>13.11 - Troubleshooting IPSec/VPN</h1>
d1765 1
a1765 1
Your first tool for troubleshooting IPSec is <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&apropos=0&sektion=8&format=html">tcpdump(8)</a>.
d1845 1
a1845 1
<LI>You need to allow traffic which has been processed by IPSec from netB
d1895 1
a1895 1
IPSec is partially documented in the 
d1907 1
a1907 1
are detailed and can assist in setup and operation of IPSec.
d1911 5
a1915 5
<LI><A HREF="http://www.ietf.org/html.charters/ipsec-charter.html">IETF IPSec Working Group</a>
<LI><A HREF="http://isakmp-test.ssh.fi/">SSH IPSec interoperability Test Node</a>
<LI><A HREF="http://ipsec-wit.antd.nist.gov/">NIST IPSec Web Based Interoperability Tester</a>
<LI><A HREF="http://www.r4k.net/ipsec/">A port of OpenBSD's IPSec to FreeBSD</a>
<LI><A HREF="http://www.xs4all.nl/~freeswan/">FreeS/WAN - IPSec for Linux</a>
d1931 1
a1931 1
<LI><A HREF="http://www.cis.ohio-state.edu/htbin/rfc/rfc2207.html">RFC 2207</a> - RSVP Extensions for IPSec Data Flows
d1934 1
a1934 1
<LI><A HREF="http://www.cis.ohio-state.edu/htbin/rfc/rfc2401.html">RFC 2401</a> - Security Architecture for the Internet Protocol (<b>IPSec</b>)
d1963 1
a1963 1
<small>$OpenBSD: faq13.html,v 1.44 2001/09/10 19:26:32 jufi Exp $</small>
@


1.44
log
@
powerpc.html -> macppc.html
copyright notices cleaned up.
All work by David Krause <openbsd@@davidkrause.com>
@
text
@d1451 1
a1451 1
(i.e. if both computers were on the same local network and the
d1544 1
a1544 1
remote_id checks, i.e. by having conditions like these in the policy:
d1706 1
a1706 1
employee i.e. quits their job. The same scheme should work for other
d1963 1
a1963 1
<small>$OpenBSD: faq13.html,v 1.43 2001/08/25 09:31:33 jufi Exp $</small>
@


1.43
log
@
copyright extended to 2001
@
text
@d9 1
a9 1
<meta name= "copyright"     content= "This document copyright (C) 2000-2001 OpenBSD">
d1963 1
a1963 1
<small>$OpenBSD: faq13.html,v 1.42 2001/08/15 17:39:10 jufi Exp $</small>
@


1.42
log
@
remove redundant navigation controls and make the page look like the
other FAQs.
remove dead link.
spotted by mpech@@
@
text
@d9 1
a9 1
<meta name= "copyright"     content= "This document copyright (C) 2000 OpenBSD">
d1963 1
a1963 1
<small>$OpenBSD: faq13.html,v 1.41 2001/08/08 21:06:32 jsyn Exp $</small>
@


1.41
log
@giant spelling/grammar clean-up; ok millert@@
@
text
@d15 2
a17 19
<p>
<font color= "#0000e0">
<a href="index.html">[Back to Main Index]</a>
<a href="faq12.html">[To Section 12.0 - For Advanced Users]</a>
<a href="faq14.html">[To Section 14.0 - Using disks in OpenBSD]</a>
</font>
</p>

<p>
<Font size="-1">
Portions of this document were taken from:
<UL>
<LI><A HREF="http://www.openbsd.org/cgi-bin/man.cgi?query=ipsec&sektion=4&format=html">ipsec(4)</a>
<LI><A HREF="http://www.openbsd.org/cgi-bin/man.cgi?query=vpn&sektion=8&format=html">vpn(8)</a>
<LI><A HREF="http://www.freebsd.org/~julian/IPSEC_4_Dummies.html">IPSec for Dummies</a> by Julian Elischer
<LI><A HREF="http://www.secureops.com/vpn/vpn.html">ISAKMP Howto</a> by Patrick Ethier
<LI><A HREF="http://hem.passagen.se/hojg/isakmpd/">X.509v3 certificates with isakmpd</a> by J&ouml;rgen Granstam
</UL>
</font>
d19 1
a19 1
<h1>13.0 - Using IPSec (IP Security Protocol)</h1>
d35 12
a1915 1
<LI><A HREF="http://www.cs.umass.edu/~lmccarth/ipsec.html">Lots of IPSec related links</A>
d1963 1
a1963 1
<small>$OpenBSD: faq13.html,v 1.40 2001/03/26 17:14:09 todd Exp $</small>
@


1.40
log
@spelling
@
text
@d178 1
a178 1
is repended to the packet that covers just the hop to the other end of
d1042 1
a1042 1
# tunnel, more sectionnames would be added (and of course corresponding 
d1120 1
a1120 1
# be in the CA-directory (but not the CA private key ofcourse).
d1283 1
a1283 1
almost be considered snakeoil today, it is left as an excercise for the
d1969 1
a1969 1
<small>$OpenBSD: faq13.html,v 1.39 2001/02/25 07:15:09 ericj Exp $</small>
@


1.39
log
@fix spelling David Wilburn <bug@@gecko.roadtoad.net>
@
text
@d233 1
a233 1
<P>This is called <B>Transport Adjacency</B>. The tunnelling version would
d629 1
a629 1
IPSec stack. Unfotunately, the same
d698 1
a698 1
<p>This is where you can setup the variables that will affect the main behaviour of isakmpd. It is okay to 
d776 1
a776 1
describe the requirements that the peer gateway must fulfil in order to proceed to Phase 2. There are 
d1263 1
a1263 1
The simplest possible working policy file would containg just a
d1318 1
a1318 1
Further, authorized licencees can sublicense to other licensees. A
d1404 1
a1404 1
sublicence to such credentials. Remember sublicensing above. It is
d1445 1
a1445 1
stage. From the configuraton file, isakmpd knows which IP-address its
d1469 1
a1469 1
Since all these are prerequisities for security to work at all, none
d1502 1
a1502 1
althoug I don't know how sensitive isakmpd is to those attacks). Then
d1613 1
a1613 1
resonably small policy. It is however still not too great if we have
d1616 1
a1616 1
<H2>Multiuser configurations and/or centrally managed authorisation.</h2>
d1640 1
a1640 1
enable us to use a kind of &quot;authorisation certificates&quot; instead.
d1714 1
a1714 1
organisation doing this would probably want to be their own CA.
d1969 1
a1969 1
<small>$OpenBSD: faq13.html,v 1.38 2001/01/27 22:19:47 ericj Exp $</small>
@


1.38
log
@
some html cleanup; from mpech@@prosoft.org.lv
@
text
@d259 1
a259 1
left to the designer, however the RFC has some strong recomendations as
d297 1
a297 1
<LI>IPSec proto (SA or ESP)
d1969 1
a1969 1
<small>$OpenBSD: faq13.html,v 1.37 2000/12/26 16:17:40 ericj Exp $</small>
@


1.37
log
@fix path; pointed out by nate@@
@
text
@d496 1
a496 1
<UL><TT>
d499 1
a499 1
</ul></tt>
d504 1
a504 1
</ul></tt>
d506 1
a506 1
<ul><tT>
d508 1
a508 1
</ul></tt>
d512 1
a512 1
</ul></tt>
d516 1
a516 1
</ul></tt>
d523 1
a523 1
</ul></tt>
d529 1
a529 1
</ul></tt>
d572 1
a572 1
<PRE><UL>
d576 1
a576 1
<PRE><UL>
d1969 1
a1969 1
<small>$OpenBSD: faq13.html,v 1.36 2000/10/11 18:04:04 mickey Exp $</small>
@


1.36
log
@repair ISAKMP Howto link
@
text
@d641 1
a641 1
to /etc/isakmpd.policy.  Copy <i>VPN-east.conf</i> to /etc/isakmpd/isakmpd.conf.
d1969 1
a1969 1
<small>$OpenBSD: faq13.html,v 1.35 2000/07/25 00:07:53 chris Exp $</small>
@


1.35
log
@CAST allows 40-128bit keys; angelos@@
@
text
@d31 1
a31 1
<LI><A HREF="http://www.secureops.com/resources/vpn/">ISAKMP Howto</a> by Patrick Ethier
d1969 1
a1969 1
<small>$OpenBSD: faq13.html,v 1.34 2000/05/26 07:10:32 chris Exp $</small>
@


1.34
log
@Misc cleanup
@
text
@d381 2
a382 2
BLF       Variable (160 bits recommended)
CAST      Variable (160 bits recommended)
d1969 1
a1969 1
<small>$OpenBSD: faq13.html,v 1.33 2000/05/26 06:18:02 chris Exp $</small>
@


1.33
log
@Add some crypto ipsec-related rfcs, and <A name> for books.html link
@
text
@d1744 1
d1939 1
d1969 1
a1969 1
<small>$OpenBSD: faq13.html,v 1.32 2000/04/26 22:37:08 chris Exp $</small>
@


1.32
log
@HTML and English fixups from Horacio
(Thanks!)
@
text
@d1924 2
a1925 1
And on to the RFCs...
d1927 5
d1934 2
d1937 1
d1953 1
d1967 1
a1967 1
<small>$OpenBSD: faq13.html,v 1.31 2000/04/23 22:17:36 chris Exp $</small>
@


1.31
log
@wording
@
text
@d32 1
a32 1
<LI><A HREF="http://hem.passagen.se/hojg/isakmpd/">X.509v3 certificates with isakmpd</a> by Jrgen Granstam
d144 1
d249 2
a250 2
in the IP header and also encrypt the payload, (seen in italics). When
an AH and an ESP header are diectly applied together like this,
d287 1
a287 1
<P>The SPD can be though of as similar to a packet filter where the actions
d324 1
a324 1
(You would only make changes to it if you are using manual keying.)
d358 1
a358 1
net.inet.esp.enable: 0 -> 1<br>
d360 1
a360 1
net.inet.ah.enable: 0 -> 1
d468 1
a468 1
</ul></tt>
d472 1
a472 1
</ul></tt>
d476 1
a476 1
</ul></tt>
d480 1
a480 1
</ul></tt>
d484 1
a484 1
</ul></tt>
d488 1
a488 1
</ul></tt>
d492 1
a492 1
</ul></tt>
d546 4
a549 4
# identity local "id" "secret"
# identity pair local "receivedid" "myid" "secret"
# identity remote "id" "secret"
# identity lookup "tag" username
d551 2
a552 2
identity local "Default" "This should be changed."
identity remote "Default" "This should be changed."
d554 4
a557 3
Change "This should be changed." to a key of your choice on the local config,
and another key of your choice on the remote config.  (Use the same config
on your remote box but swap "local" and "remote" so that it sees itself as the local key.)
d564 1
a564 1
net.inet.ah.enable: 0 -> 1
d610 1
a610 1
Phase 2 is establishes tunnels or endpoint SA's between IPSec hosts.
d662 1
a662 1
Authorizer: "POLICY"
d672 4
a675 4
Authorizer: "POLICY"
Licensees: "passphrase:mekmitasdigoat"
Conditions: app_domain == "IPSec policy" &&
            esp_present == "yes" -> "true"; 
d778 2
a779 1
<b>Phase=1 </b>is required because the ISAKMPD code uses the same procedures to process Phase 1 and 
d781 1
a781 1
<b>Transport= </b>is gives you different possibilities for different peers. It's 
d784 1
a784 1
<b>Local-address </b>is the destination address that the incoming packets point to. In some cases, you 
d788 1
a788 1
<b>Address= </b>is the address that points to the source IP of the incoming packets. This usually points 
d791 1
a791 1
<b>Configuration= </b>points to the section below. You can specify 
d794 1
a794 1
<b>Authentication=</b> is the pre-shared secret to be used for this particular peer. It is more or less 
d799 1
a799 1
<b>Flags=</b> is not currently being used. The RFCs leave room for extra options to be specified for 
d801 1
a801 1
There are other tags here that will allow for other options to be set. Refer to 
d804 1
d829 2
a830 1
<b>Phase=2</b> is required because ISAKMPD code uses the same functions to authenticate Phase 1 and Phase 
d832 1
a832 1
<b>ISAKMPD-Peer=</b> is the name of Host section above. This means that we are 
d835 1
a835 1
<b>Configuration=</b> refers to the section below that describes the 
d837 1
a837 1
<b>Local-ID=</b> refers to an IPSec-ID section below that describes our Private Network to 
d840 1
a840 1
<b>Remote-ID=</b> refers to an IPSec-ID section below that describes what is supposed to be 
d843 1
a843 1
There is another tag that is supported here called Flags=. If you require this tag, read 
d845 1
d921 1
a921 1
Setting up isakmpd to use certificates instead of pre-shared keys is not really that much harder in a big network with many untrusted peers then it would
d963 1
a963 1
which case the original file will be overwritten by the new moified
d966 1
a966 1
Put the keys and certificates in the directories as decribed at the
d977 2
a978 2
here than the example file in the man-page, I have removed most parts.
from that file that is not needed in this setup. In part to simplify
d984 1
a984 1
configuration for the preshared keys case (see previos section) there won't be
d989 1
a989 1
Lets assume our setup looks something like this
d1007 1
a1007 1
something. I wont explain how to use isakmpd in combination with NAT
d1010 1
a1010 1
Now, lets look at the configuration file. This is the file for the
d1030 3
a1032 3
# address however needs to be correct. Phase 1 as you might already
# know is to negotiate an ISAKMP security association (SA). There 
# should ofcourse be one IP and name for each peer we want to
d1042 1
a1042 1
# tunnel, more sectionnames would be added (and ofcourse corresponding 
d1076 2
a1077 2
# from the list in the [Phase 2] section above. The ISAKMP-peer is
# ofcourse the tag of our peer from section [Phase 1] above. The 
d1107 1
a1107 1
# are not very smart since DES is no longer considered a secure
d1109 1
a1109 1
# security since it has has enough bits in the key to be considered secure. 
d1132 1
a1132 1
# Here is our main mode transform the important thing here is to use
d1174 1
a1174 1
# from a host to a network, we use TUNNEL mode. Between two hosts we
d1184 1
a1184 1
# As we know from the isakmpd.config manpage The LIFE_DURATION here is 
d1204 1
a1204 1
of the isakmpd.conf file differs. Lets just look at that first part 
d1251 1
a1251 1
slightly more interresting part next.
d1257 1
a1257 1
Actually, the policy file might slightly confusing for anyone who has
d1268 1
a1268 1
authorizer: "POLICY"
d1275 1
a1275 1
the policy. The special authorizer "POLICY" has the ultimate and
d1277 1
a1277 1
authorized by "POLICY" to have any authority here.
d1289 4
a1292 4
authorizer: "POLICY"
conditions: app_domain == "IPsec policy" &&
            esp_present == "yes" &&
            esp_enc_alg != "null" -> "true";
d1304 5
a1308 5
authorizer: "POLICY"
licensees:  "passphrase:something really secret"
conditions: app_domain == "IPsec policy" &&
            esp_present == "yes" &&
            esp_enc_alg != "null" -> "true";
d1317 1
a1317 1
can be many licensees, although all must be authorized by "POLICY". 
d1324 11
a1334 11
authorizer: "POLICY"
licensees:  "subpolicyAH" ||  "subpolicyESP"
conditions: app_domain == "IPsec policy" -> "true";

authorizer: "subpolicyESP" 
licensees:  "passphrase:something more secret"
conditions: esp_present == "yes" -> "true";

authorizer: "subpolicyAH" 
licensees:  "passphrase:something really secret"
conditions: ah_present == "yes" -> "true";
d1340 1
a1340 1
X.509 certificate. The simples use of certificates would be to use
d1348 2
a1349 2
authorizer: "POLICY"
licensees: "x509-base64:\
d1359 4
a1362 4
        yiXHSU8="
conditions: app_domain == "IPsec policy" &&
            esp_present == "yes" &&
            esp_enc_alg != "null" -> "true";
d1366 1
a1366 1
Now, this is obviously a stupid idea if there are a lot of users The
d1375 1
a1375 1
authorizer: "x509-base64:\
d1384 2
a1385 2
        yiXHSU8="
licensees:  "x509-base64:\
d1395 2
a1396 2
        yiXHSU8="
conditions: app_domain == "IPsec policy" -> "true";
d1400 1
a1400 1
Now note that these are not authorized by "POLICY" and thus won't have
d1405 2
a1406 2
thus possble to license all certificates that are signed by a certain
CA by putting the CA certificate as a licensee to "POLICY":
d1412 2
a1413 2
authorizer: "POLICY"
licensees: "x509-base64:\
d1423 4
a1426 4
        yiXHSU8="
conditions: app_domain == "IPsec policy" &&
            esp_present == "yes" &&
            esp_enc_alg != "null" -> "true";
d1441 1
a1441 1
everyone else, lets try to understand why this is not secure. It's
d1462 2
a1463 2
If that ever happened, the imposter have managed to either steal the
private key from the real owner of the IP, or the imposter has
d1465 2
a1466 2
information somehow. If any of these things happens, then either the
private key have not been protected well enough, the CA have failed
d1468 1
a1468 1
the cert) or the CA private key has net been well enough protected.
d1485 5
a1489 5
the host. That is true, however todays DNS system is not secure and
can in under some circumstances be fooled to give out false
information (or, it could be subjected to a denial of service (DoS)
attack by an attacker, and the attackers computer might be able to
fake the DNS servers answer). Secure DNS will come in the future, but
d1498 1
a1498 1
same CA that we use (but with the attackers own FQDN ofcourse). Then
d1512 1
a1512 1
not with the configuration presented so far check that this ID is the
d1528 2
a1529 2
authorizer: "POLICY"
licensees: "x509-base64:\
d1539 5
a1543 5
        yiXHSU8="
conditions: app_domain == "IPsec policy" &&
            esp_present == "yes" &&
            esp_enc_alg != "null" &&
            remote_id == "gw.worksite.se" -> "true";
d1553 5
a1557 5
conditions: app_domain == "IPsec policy" &&
            esp_present == "yes" &&
            esp_enc_alg != "null" &&
            (remote_id == "gw.worksite.se"  ||
               remote_id == "gw.whatsite.se") -> "true";
d1579 1
a1579 1
corresponding certificate must ofcourse be available from the certs
d1588 8
a1595 8
authorizer: "POLICY"
licensees: "DN:\C=se\CN=IKELAB CA"
conditions: app_domain == "IPsec policy" &&
            esp_present == "yes" &&
            esp_enc_alg != "null" &&
            (remote_id == "gw.worksite.se"  ||
             remote_id == "gw.somesite.se"  ||
             remote_id == "gw.whatsite.se") -> "true";
d1604 1
a1604 1
$ <b>openssl x509 -text < ca.crt</b>
d1607 1
a1607 1
More complicated policy configurations are ofcourse possible but
d1640 1
a1640 1
enable us to use a kind of "authorisation certificates" instead.
d1653 30
a1682 30
authorizer: "POLICY"
licensees: "telnet@@work" || "telnet@@lab" || "pop3@@work" 
conditions: app_domain == "IPsec policy" &&
            esp_present == "yes" &&
            esp_enc_alg != "null" &&
            remote_id_type == "UFQDN" &&
            (remote_id == "telnet@@worksite.se"  ||
             remote_id == "pop3@@worksite.se"  ||
             remote_id == "telnet@@lab.worksite.se") -> "true";

authorizer: "telnet@@work"
licensees: "DN:\C=se\CN=IKELAB CA"
conditions: remote_id == "telnet@@worksite.se" &&
            local_filter_type == "IPv4 address" &&
            local_filter_port == "23" &&
            local_filter == "192.168.002.003"

authorizer: "telnet@@lab"
licensees: "DN:\C=se\CN=IKELAB CA"
conditions: remote_id == "telnet@@lab.worksite.se" &&
            local_filter_type == "IPv4 address" &&
            local_filter_port == "23" &&
            local_filter == "192.168.002.002" -> "true";

authorizer: "pop3@@work"
licensees: "DN:\C=se\CN=IKELAB CA"
conditions: local_filter_type == "IPv4 address" &&
            local_filter_port == "110" &&
            local_filter == "192.168.002.003" &&
            remote_id == "telnet@@worksite.se" -> "true";
d1694 1
a1694 1
connect, It would probably be desirable to log the DN of anyone who
d1709 1
a1709 1
stop reissuing the certificates and they wont get in more after it has
d1733 3
a1735 3
We suspect that it interoperates, at least partially, with most any ISAKMP
implementation, but the following have actually been tested.   Note that some
isakmp software out there is actually based on the OpenBSD isakmp daemon.
d1803 5
a1807 5
14:12:19.630274 esp 208.2.2.2 > 208.1.1.1 spi 0x00001000 seq 4535 len 116
14:12:19.813519 esp 208.1.1.1 > 208.2.2.2 spi 0x00001001 seq 49313 len 116
14:12:20.630277 esp 208.2.2.2 > 208.1.1.1 spi 0x00001000 seq 4536 len 116
14:12:20.832458 esp 208.1.1.1 > 208.2.2.2 spi 0x00001001 seq 49314 len 116
14:12:21.630273 esp 208.2.2.2 > 208.1.1.1 spi 0x00001000 seq 4537 len 116
d1842 1
a1842 1
</UL></TT><P>
d1847 1
a1847 1
</UL></TT>
d1863 1
a1863 1
</UL></TT>
d1867 1
a1867 1
There are also traffic counters which you can use to see what traffic going
d1957 1
a1957 1
<small>$OpenBSD: faq13.html,v 1.30 2000/04/20 21:48:31 chris Exp $</small>
@


1.30
log
@Some fixup, much more needed
@
text
@d615 3
a617 2
(quicker) phase 2 setups, there can be several. Phase 2 is used to setup
the actual tunnels. In Phase 1, your IPSec nodes establish a connection
d1718 1
a1718 1
AGGRESSIVE mode is faste because it needs fewer message exchanges,
d1951 1
a1951 1
<small>$OpenBSD: faq13.html,v 1.29 2000/04/14 02:14:59 wvdputte Exp $</small>
@


1.29
log
@Get rid of /absolute link -> ../ftp.html
@
text
@a360 4
If you are using OpenBSD-current, 
<ul><tt>
# <b>sysctl -w net.inet.ip.ipsec-acl = 1</b>
</tt></ul>
d625 1
a625 1
By default, OpenBSD 2.6 comes with the proper binaries for ISAKMP and the
a673 4
This is newer then the policy file included with OpenBSD 2.6.
2.6 users should attempt to compile a current keynote library.
Or, you can remove "passphrase" from the above Licensees line.
<P>
d859 1
a859 1
<b>ID-type</b>= can be <b>IPV4_ADDR_SUBNET</b> or <b>IPV4_ADDR</b> (RFC2708 mentions more possible values. Currently only IPv4 is supported in the OpenBSD 2.6 implementation.  IPv6 may be supported in OpenBSD-current. )
a913 7
X.509v3 certificates work with <i>OpenBSD-current's</i> isakmpd.  This feature
is not functional in the OpenBSD 2.6 release.  Users who want to use this
technology are encouraged to test <A HREF="../ftp.html">snapshots</a>.  
Alternately, you can manually upgrade to an RSA-enabled libcrypto, current
libkeynote and isakmpd.  No attempt has been made to make these
instructions compatible with OpenBSD 2.6.
<P>
d1765 2
a1766 2
First, if you are running
OpenBSD 2.6, you have an enhanced version of tcpdump which can show some
d1769 2
a1770 2
version that will simply show the protocol number for AH or ESP if it sees
either kind of packets on your network.  (ESP is IP protocol 50, AH is 51)
d1850 1
a1850 4
Key Exchange sessions.  If you are using tcpdump from a version of OpenBSD
that is <i>newer</i> then 2.6-RELEASE, tcpdump will also show AH payload
data.  If you are interested in a patch to do this for an older
version of tcpdump, contact <A HREF="mailto:ho@@openbsd.org">ho@@openbsd.org</a>.
d1950 1
a1950 1
<small>$OpenBSD: faq13.html,v 1.28 2000/04/13 00:46:27 chris Exp $</small>
@


1.28
log
@Lots of cleanup
and new section regarding certificates
@
text
@d924 1
a924 1
technology are encouraged to test <A HREF="/ftp.html">snapshots</a>.  
d1968 1
a1968 1
<small>$OpenBSD: faq13.html,v 1.27 2000/03/24 14:05:02 wvdputte Exp $</small>
@


1.27
log
@Use ../relative link to /images/
@
text
@d26 1
a26 1
This document borrows large pieces from:
d28 2
d31 2
a32 2
<LI><A HREF="http://www.openbsd.org/cgi-bin/man.cgi?query=ipsec&sektion=4&format=html">ipsec(4)</a> by Niels Provos, and several other people from the OpenBSD team
<LI><A HREF="http://www.secureops.com/resources/vpn/">Secureops VPN</a>
a33 1
Thanks, folks!
d35 1
a35 1
<p>
d44 6
a49 5
<LI><A HREF="#13.7">13.7 - How do I setup IPSec with photurisd?</a>
<LI><A HREF="#13.8">13.8 - How do I setup IPSec with isakmpd?</a>
<LI><A HREF="#13.9">13.9 - What IKE clients are compatible with isakmpd?</a>
<LI><A HREF="#13.10">13.10 - Troubleshooting IPSec/VPN</a>
<LI><A HREF="#13.11">13.11 - Related Documentation</a>
d360 5
a364 1
</ul></tt>
d370 19
d399 1
a399 1
tunnel environment.</i>
d411 2
a412 2
<ul>
<tt>
d415 2
a416 2
</tt>
</ul>
d419 1
a419 1
<tt>
d423 1
a423 1
</ul>
a429 4
Note that, with the -local option, ipsecadm will actually create two flows,
one with the source address set to 0.0.0.0/32, which handles packets
originating from the gateway.
<P>
d431 1
a431 1
So, right here, <b>two</b> flows will be created, one with 0.0.0.0/32 as the
d438 1
a438 1
-addr 192.168.5.1 255.255.255.255 192.168.25.9 255.255.255.255 -local</b>
d444 1
a444 1
-addr 192.168.25.9 255.255.255.255 192.168.5.1 255.255.255.255 -local</b>
d474 1
a474 1
# <b>ipsecadm flow -proto esp -dst 208.2.2.2 -spi 1001 -addr 208.1.1.1 255.255.255.255 208.2.2.2 255.255.255.255 -local</b><br>
d486 1
a486 1
# <b>ipsecadm flow -proto esp -dst 208.2.2.2 -spi 1001 -addr 208.1.1.1 255.255.255.255 208.1.2.0 255.255.255.0 -local</b><br>
d490 1
a490 1
# <b>ipsecadm flow -proto esp -dst 208.2.2.2 -spi 1001 -addr 208.1.1.1 255.255.255.255 208.1.5.0 255.255.255.0 -local</b><br>
d506 1
a506 1
# <b>ipsecadm flow -proto esp -dst 208.1.1.1 -spi 1000 -addr 208.2.2.2 255.255.255.255 208.1.1.1 255.255.255.255 -local</b><br>
d518 1
a518 1
# <b>ipsecadm flow -proto esp -dst 208.1.1.1 -spi 1000 -addr 208.2.2.2 255.255.255.255 192.168.99.0 255.255.255.0 -local</b><br>
d524 2
a525 2
# <b>ipsecadm flow -proto esp -dst 208.1.1.1 -spi 1000 -addr 208.1.2.0 255.255.255.0 208.2.2.2 255.255.255.255</b><br>
# <b>ipsecadm flow -proto esp -dst 208.1.1.1 -spi 1000 -addr 208.1.5.0 255.255.255.0 208.2.2.2 255.255.255.255</b><br>
d536 1
a536 1
<h1>13.7 - How do I setup IPSec with photurisd?</h1>
d584 1
a584 1
<P> <a name="13.8"> <h1>13.8 - How do I setup IPSec with isakmpd?</h1>
d646 3
d661 1
a661 1
<PRE>
d664 1
a664 1
</PRE>
d670 1
a670 1
<BR><PRE>
d674 1
a674 1
Licensees: "mekmitasdigoat"
d677 4
a680 2
</pre>
This should be identical to the policy file included with OpenBSD 2.6.
d686 1
a686 1
<PRE>
d691 1
a691 1
</PRE>
d696 1
a696 1
<PRE>
d701 1
a701 1
</PRE>
d704 1
a704 1
use the defaults here.<br>
d712 1
a712 1
<PRE>
d715 1
a715 1
</PRE>
d719 1
a719 1
<PRE>
d722 1
a722 1
</PRE>
d727 1
a727 1
IP_Address=<i> &lt;PEER-NAME&gt;.</i><br>
d730 1
a730 1
<PRE>
d733 1
a733 1
</PRE>
d737 1
a737 1
<PRE>
d740 1
a740 1
</PRE>
d756 1
a756 1
<PRE>
d765 1
a765 1
</PRE>
d769 1
a769 1
<PRE>
d778 1
a778 1
</PRE>
d782 1
a782 1
many other options here but the ones mentioned above are the minimum requirements.<br>
d784 1
a784 1
Phase 2. It must be <b>1</b> or nothing will work.<br>
d786 1
a786 1
suggested that udp be used here so we'll leave it at that.<br>
d791 1
a791 1
interface on this peer.<br>
d797 1
a797 1
specified by the sample file.<br>
d802 1
a802 1
minimum policy file then you can specify whatever you want here.<br>
d804 1
a804 1
phase 1.<br>
d810 1
a810 1
<PRE>
d817 1
a817 1
</PRE>
d820 1
a820 1
<PRE>
d827 1
a827 1
</PRE>
d833 1
a833 1
2. This is required for the VPN to work.<br>
d838 1
a838 1
standards by which this host and the particular peer for this connection must abide.<br>
d841 1
a841 1
routing table that will transfer data over the VPN to our network.<br>
d844 1
a844 1
that will transfer data from our Private Network over the VPN to the remote Private Network.<br>
d852 1
a852 1
<PRE>
d862 1
a862 1
</PRE>
d866 1
a866 1
routes that should be set up to allow traffic from one private network to another.<br>
d871 1
a871 1
<PRE>
d876 1
a876 1
</PRE>
d881 1
a881 1
which identifies the protocols to be covered by this Authentication.<br>
d889 1
a889 1
<PRE>
d894 1
a894 1
</PRE>
d899 1
a899 1
This is always the case for Phase 2.<br>
d901 1
a901 1
schemes available between the two hosts.<br>
d909 5
a913 1
<b>$ isakmpd -d -DA=99</b><br>
d919 13
d933 805
a1737 2
<a name= "13.9">
<h1>13.9 - What IKE clients are compatible with isakmpd?</h1>
d1751 1
a1751 1
<LI><A HREF="http://www.cisco.com/">Cisco</a> Win32 client (<i>unreleased?</i>)
d1773 2
a1774 2
<a name= "13.10">
<h1>13.10 - Troubleshooting IPSec/VPN</h1>
d1822 1
a1822 1
<LI>IKE runs on UDP port 500.  If this is locked out through a firewall
d1824 39
d1906 2
a1907 2
<a name= "13.11">
<h1>13.11 - Related Documentation</h1>
d1914 8
a1921 7
<A HREF="http://www.openbsd.org/cgi-bin/man.cgi?query=enc&apropos=0&sektion=4&format=html">enc(4)</a>,
<A HREF="http://www.openbsd.org/cgi-bin/man.cgi?query=ipsec&apropos=0&sektion=4&format=html">ipsec(4)</a>,
<A HREF="http://www.openbsd.org/cgi-bin/man.cgi?query=ipsecadm&apropos=0&sektion=8&format=html">ipsecadm(8)</a>,
<A HREF="http://www.openbsd.org/cgi-bin/man.cgi?query=photurisd&apropos=0&sektion=8&format=html">photurisd(8)</a>,
<A HREF="http://www.openbsd.org/cgi-bin/man.cgi?query=startkey&apropos=0&sektion=1&format=html">startkey(1)</a>,
<A HREF="http://www.openbsd.org/cgi-bin/man.cgi?query=isakmpd&apropos=0&sektion=8&format=html">isakmpd(8)</a> and
<a HREF="http://www.openbsd.org/cgi-bin/man.cgi?query=isakmpd.conf&apropos=0&sektion=5&format=html">isakmpd.conf(5)</a>
d1968 1
a1968 1
<small>$OpenBSD: faq13.html,v 1.26 2000/03/10 01:36:36 wvdputte Exp $</small>
@


1.26
log
@Replaced a couple of /absolute links by ../relative links
@
text
@d13 1
a13 1
<img alt="[OpenBSD]" height=30 width=141 src="/images/smalltitle.gif">
d1082 1
a1082 1
<small>$OpenBSD: faq13.html,v 1.25 2000/03/09 02:10:02 chris Exp $</small>
@


1.25
log
@Fixes from Hal Snyder <hal@@vailsys.com>
@
text
@d9 1
a9 1
<meta name= "copyright"     content= "This document copyright (C) 1999 OpenBSD">
d1018 1
a1018 1
actually run into a bug, you may want to send a message to one of the <A HREF="/mail.html">mailing lists</a>.
d1082 1
a1082 1
<small>$OpenBSD: faq13.html,v 1.24 2000/03/04 01:37:00 ericj Exp $</small>
@


1.24
log
@add </b>
@
text
@d621 1
a621 1
to /etc/isakmpd/policy.  Copy <i>VPN-east.conf</i> to /etc/isakmpd/conf.
d629 1
a629 1
Next, you need to edit /etc/isakmpd/policy.  
d639 1
a639 1
Authoriser: "POLICY"
d649 1
a649 1
Authoriser: "POLICY"
d1082 1
a1082 1
<small>$OpenBSD: faq13.html,v 1.23 2000/02/08 19:04:28 chris Exp $</small>
@


1.23
log
@Fixes to manual keying section
From Dave Hartzell <hartzell@@greatplains.net>
@
text
@d396 1
a396 1
# <b>ipsecadm new esp -spi 1000 -dst 192.168.25.9 -src 192.168.5.1 -forcetunnel -enc blf -auth sha1 -key 7762d8707255d974168cbb1d274f8bed4cbd3364 -authkey 6a20367e21c66e5a40739db293cf2ef2a4e6659f
d1082 1
a1082 1
<small>$OpenBSD: faq13.html,v 1.22 2000/01/06 17:50:12 chris Exp $</small>
@


1.22
log
@First attempt to merge in isakmpd information from Secureops VPN document
This needs more work for style and clarity
@
text
@d388 2
a389 1
# <b>ipsecadm new esp -spi 1000 -src 192.168.5.1 -dst 192.168.25.9 -forcetunnel -enc blf -auth sha1 -key 7762d8707255d974168cbb1d274f8bed4cbd3364 -authkey 6a20367e21c66e5a40739db293cf2ef2a4e6659f</b>
d395 3
a397 2
# <b>ipsecadm new esp -spi 1001 -src 192.168.25.9 -dst 192.168.5.1 -forcetunnel -enc blf -auth sha1 -key 7762d8707255d974168cbb1d274f8bed4cbd3364 -authkey 6a20367e21c66e5a40739db293cf2ef2a4e6659f</b>
</tT>
d1082 1
a1082 1
<small>$OpenBSD: faq13.html,v 1.21 1999/12/15 18:30:38 chris Exp $</small>
@


1.21
log
@CheckPoint is compatible with isakmpd
@
text
@d30 1
d116 1
a116 1
IP<i>WARNING: as per the standards specification, replay protection is not
d360 3
d561 219
d781 60
a840 7
<a name="13.8">
<h1>13.8 - How do I setup IPSec with isakmpd?</h1>
</a>
<P>If you are thinking about VPNs or other traditional applications
of IPSec, you probably are going to use ISAKMP.  Most commercial
implementations of IPSec do not provide any manual keying ability, 
instead they require you to use some form of ISAKMP.
d842 45
a886 1
This section is incomplete! <A HREF="mailto:faq@@openbsd.org">contribute?</a>
d1080 1
a1080 1
<small>$OpenBSD: faq13.html,v 1.20 1999/12/06 21:45:58 chris Exp $</small>
@


1.20
log
@missed a few
@
text
@d586 1
a586 1
The following other gateways/routers have been reported to be compatible:
d602 1
d760 1
a760 1
<small>$OpenBSD: faq13.html,v 1.19 1999/12/06 21:42:08 chris Exp $</small>
@


1.19
log
@Changes for consistency
@
text
@d3 1
a3 1
<title>13 - Using IPSec</title>
d759 1
a759 1
<small>$OpenBSD: faq13.html,v 1.18 1999/10/29 04:13:22 chris Exp $</small>
@


1.18
log
@fix
@
text
@d3 1
a3 1
<title>OpenBSD FAQ: 13 - Using IPSec</title>
d759 1
a759 1
<small>$OpenBSD: faq13.html,v 1.17 1999/10/29 03:27:53 chris Exp $</small>
@


1.17
log
@faq entry to get people started with photurisd
@
text
@a529 2
Change "Default" on your local identity to a name you prefer to use.
Change "Default" on your remote identity to the name of your other computer.
d532 1
a532 1
on your remote box but swap keys so that it sees itself as the local key.)
d759 1
a759 1
<small>$OpenBSD: faq13.html,v 1.16 1999/10/27 19:13:40 ericj Exp $</small>
@


1.16
log
@spelling and added tables. dugsong@@
@
text
@d516 43
a558 1
This section is incomplete! <A HREF="mailto:faq@@openbsd.org">contribute?</a>
d761 1
a761 1
<small>$OpenBSD: faq13.html,v 1.15 1999/10/19 22:09:39 chris Exp $</small>
@


1.15
log
@Add a section for photurisd
@
text
@d18 3
a20 3
<a href= "index.html">[Back to Main Index]</a>
<a href= "faq12.html">[To Section 12.0 - For Advanced Users]</a>
<a href= "faq14.html">[To Section 14.0 - Using disks in OpenBSD]</a>
d115 1
a115 1
<i>WARNING: as per the standards specification, replay protection is not
d134 1
a134 1
the IP header). Replay protection requires authentication and integrity
d143 2
a144 2
(AH) comes after the basic IP header and contains cryptographically
secured Hashes of the data and Identification information. The hashes can
d146 2
a147 2
several differnt RFCs giving a choice of actual algorythms to use in the
AH, however they all must follow the guidlines specified in <A HREF="http://www.cis.ohio-state.edu/htbin/rfc/rfc2402.html">RFC2402</A>.
d152 1
a152 1
header before it and therefore amkes no guarantees about anything except
d154 1
a154 1
An ESP header can also provide Authentication for the payload, (but not
d181 1
a181 1
trafic distiguishable by some <B>unique selector</B>. All traffic flowing
d185 5
a189 5
the three defining fields, (<B>Destination IPaddess, Security Paramiter
Index, Security protocol)</B> SPI can be considered a cookie that is handed
out by the reciever of the SA when the parameters of the connection are
negotiated. and the protocol must be either AH or ESP. Since the IP
address of the reciever is part of the tripple, this is a guaranteed unique
d191 1
a191 1
header (which contains the SPI and the protocol).
d194 10
a203 2

<P><B>[IPHDR][IPoptions][AH]</B>[IPHDR2][IPoptions][TCP][data]
d206 9
a214 2

<P><B>[IPHDR][IPoptions][AH]</B>[TCP][data]
d218 10
a227 2

<P><B>[IPHDR][IPoptions][AH][ESP]</B><I>[TCP][data]</I>
d231 11
d243 1
a243 3
<P><B>[IPHDR][IPoptions][AH][ESP]</B><I>[IPHDR2][IPoptions][TCP][data]</I>

<P>However it is not specifically mentionned in the RFC. As with Transport
d256 1
a256 1
to how this should be implemented, so as to minimise confusion.
d265 1
a265 1
however the SPD is two steps removed from the actual processing. The
d268 1
a268 1
parameters for it. The SPD entries specify the already created SAD entries
d272 1
a272 1
that initialted the creation.
d275 2
a276 2
parameters. Incoming packates get to the correct SA directly using the
SPI/DEST/Proto tripple, and from there get to the SPD entry.
d286 2
a287 2
if available (only on host based transport SAs), hostnames, security sensitivity
levels, protocols etc.
d295 1
a295 1
<LI>Sequnce counter
d297 1
a297 1
<LI>anti-replay window info
d301 1
a301 1
<LI>tunnel/transport mode flags
d308 1
a308 1
<LI>pointer to active SAs
d314 1
a314 1
with neither, otherwise there would be no headers to specify the SPI
d316 2
a317 2
AH and ESP headers dissagree about the SPI value. One would presume
this would imply multiple SA's in a bundle.
d319 1
a319 1
<P>The SPD in OpenBSD is mananged through the <tt>ipsecadm flow</tt> command.
d324 1
a324 1
for initialisation of sessions and such things as key exchange.
d347 1
a347 1
kernel.  (If you are only using ESP, such as with the rc.vpn script, or
d350 1
a350 1
using it.)<P>
d362 3
a364 3
your security protocol (AH and/or ESP.)  The IP addresses are that of both
your own and your destination.  The SPI, or Security Parameter Index, is a
number that OpenBSD uses to classify different SAs.
d506 1
a506 1
This will flush all "IPSec info" (SPIs, flows, routing entries) from your system.
d655 1
a655 1
actually ran into a bug, you may want to send a message to one of the <A HREF="/mail.html">mailing lists</a>.
d719 1
a719 1
<small>$OpenBSD: faq13.html,v 1.14 1999/10/19 17:09:38 chris Exp $</small>
@


1.14
log
@missed 13.6 -> 13.7
@
text
@d3 1
a3 1
<title>OpenBSD FAQ: 13 - Understanding and Using IPSec</title>
d34 1
a34 1
<h1>13.0 - Understanding and Using IPSec (IP Security Protocol)</h1>
d36 11
a46 10
<LI><A HREF="#13.1">What is IPSec?</a>
<LI><A HREF="#13.2">That's nice, but why do I want to use IPSec?</a>
<LI><A HREF="#13.3">What are the protocols behind IPSec?</a>
<LI><A HREF="#13.4">On the wire format</a>
<LI><A HREF="#13.5">Configuring IPSec</a>
<LI><A HREF="#13.6">How do I setup IPSec with manual keying?</a>
<LI><A HREF="#13.7">How do I setup IPSec with isakmpd/IKE?</a>
<LI><A HREF="#13.8">What IKE clients are compatible with isakmpd?</a>
<LI><A HREF="#13.9">Troubleshooting IPSec/VPN</a>
<LI><A HREF="#13.10">Related Documentation</a>
d170 1
a170 1
<LI><B>Tunnel </B>mode is used when the end-to-end IP header is already
d477 11
a487 1
<h1>13.7 - How do I setup IPSec with isakmpd/IKE?</h1>
d492 6
a497 4
instead they require you to use some form of ISAKMP.  Unfortunately, this FAQ
isn't complete yet, certainly not section 13.7.
<a name= "13.8">
<h1>13.8 - What IKE clients are compatible with isakmpd?</h1>
d532 2
a533 2
<a name= "13.9">
<h1>13.9 - Troubleshooting IPSec/VPN</h1>
d626 2
a627 2
<a name= "13.10">
<h1>13.10 - Related Documentation</h1>
d687 1
a687 1
<small>$OpenBSD: faq13.html,v 1.13 1999/10/19 15:26:50 chris Exp $</small>
@


1.13
log
@more minor fixes
@
text
@d482 1
a482 1
isn't complete yet, certainly not section 13.6.
d674 1
a674 1
<small>$OpenBSD: faq13.html,v 1.12 1999/10/19 02:24:11 chris Exp $</small>
@


1.12
log
@Separate out 13.4
@
text
@d40 1
a40 1
<LI><A HREF="#13.5">How should I setup IPSec?</a>
d141 2
a142 2
<P>The <B>Authentication Header
</B>(AH) comes after the basic IP header and contains cryptographically
d146 1
a146 1
AH, however they all must follow the guidlines specified in <A HREF="http://www.cis.ohio-state.edu/htbin/rfc/rfc2402.html">RFC2402</A>.</P>
d154 1
a154 1
the outer header).</P>
d158 1
a158 1
of the data or a gateway:</P>
d190 1
a190 1
header (which contains the SPI and the protocol).</P>
d192 1
a192 1
<P>An example of a tunnel mode AH packet is:</P>
d194 1
a194 1
<P><B>[IPHDR][IPoptions][AH]</B>[IPHDR2][IPoptions][TCP][data]</P>
d196 1
a196 1
<P>An example of a transport mode AH packet is:</P>
d198 1
a198 1
<P><B>[IPHDR][IPoptions][AH]</B>[TCP][data]</P>
d201 1
a201 1
it is useful to combine an AH and an ESP header to get the following:</P>
d203 1
a203 1
<P><B>[IPHDR][IPoptions][AH][ESP]</B><I>[TCP][data]</I></P>
d206 1
a206 1
look like:</P>
d208 1
a208 1
<P><B>[IPHDR][IPoptions][AH][ESP]</B><I>[IPHDR2][IPoptions][TCP][data]</I></P>
d215 1
a215 1
to do arbitrary recursive encapsulation so that order is not specified.</P>
d218 1
a218 1
<h1>13.5 - How should I setup IPSec?</h1>
d223 1
a223 1
to how this should be implemented, so as to minimise confusion.</P>
d226 3
a228 3
packet. One is the <B>Security Association Database</B> (SAD) and the other
is the <B>Security Policy Database</B> (SPD). Each interface supporting
IPSec should have a logically separate SAD and SPD.</P>
d239 1
a239 1
that initialted the creation. </P>
d241 1
a241 1
<P>Outgoing packets go from the SPD entry tothe specific SA, to get encoding
d243 1
a243 1
SPI/DEST/Proto tripple, and from there get to the SPD entry.</P>
d248 1
a248 1
packet, and the processing must be reproducible.</P>
d254 1
a254 1
levels, protocols etc.</P>
d256 1
a256 1
<P>An SAD entry would include:</P>
d260 1
a260 1
<LI>Ipsec proto (SA or ESP)
d272 1
a272 1
<P>An SPD entry would contain:</P>
d279 4
a282 4
<P>Each <B>SA</B> can define one ESP header and one AH header. so
an IPSec session must have one or the other or both, but cannot be defined
with neither, otherwise there would be no headers to specify the <B>SPI</B>
to look up the <B>SA</B>. The RFC doesn't say what would happen if the
d284 1
a284 8
this would imply multiple SA's in a bundle.</P>

<P>These values and SAD entries should be addable by hand by some (implementation
dependent) interface, however the IETF has also defined automatic mechanisms
for initialisation of sessions and such things as key exchange. These are
defined in <A HREF="http://www.cis.ohio-state.edu/htbin/rfc/rfc2407.html">RFC2407</A>,
<A HREF="http://www.cis.ohio-state.edu/htbin/rfc/rfc2408.html">RFC2408,</A> and <A HREF="http://www.cis.ohio-state.edu/htbin/rfc/rfc2409.html">RFC2409</A></P>

d286 17
d317 1
a317 1
using it.  More later.)<P>
d498 1
a498 1
<LI><A HREF="http://www.cisco.com/">Cisco</a> Win32 client
d638 1
d659 2
d674 1
a674 1
<small>$OpenBSD$</small>
@


1.11
log
@minor fixes
@
text
@d40 6
a45 5
<LI><A HREF="#13.5">How do I setup IPSec with manual keying?</a>
<LI><A HREF="#13.6">How do I setup IPSec with isakmpd/IKE?</a>
<LI><A HREF="#13.7">What IKE clients are compatible with isakmpd?</a>
<LI><A HREF="#13.8">Troubleshooting IPSec/VPN</a>
<LI><A HREF="#13.9">Related Documentation</a>
d217 3
a219 1
<P><B><FONT SIZE=+1>Administrative Interface. (Sample implementation)</FONT></B></P>
d226 1
a226 1
packet. One is the <B>Security Association Database </B>(SAD) and the other
d293 2
a294 2
<a name= "13.5">
<h1>13.5 - How do I setup IPSec with manual keying?</h1>
d465 2
a466 2
<a name="13.6">
<h1>13.6 - How do I setup IPSec with isakmpd/IKE?</h1>
d473 2
a474 2
<a name= "13.7">
<h1>13.7 - What IKE clients are compatible with isakmpd?</h1>
d509 2
a510 2
<a name= "13.8">
<h1>13.8 - Troubleshooting IPSec/VPN</h1>
d603 2
a604 2
<a name= "13.9">
<h1>13.9 - Related Documentation</h1>
d661 1
a661 1
<small>$OpenBSD $</small>
@


1.10
log
@Small fixes, changes
@
text
@d3 1
a3 1
<title>OpenBSD FAQ: 13 - IPSec</title>
d34 1
a34 2
<h1>13.0 - IP Security Protocol</h1>

d223 1
a223 1
packet. One is the <B>Security Association Batabase </B>(SAD) and the other
d302 3
a304 1
as with the example below, then you do not need to enable AH.)
d320 5
a324 3
<I>These examples only use ESP to encrypt your traffic.  They do not provide
authentication through AH, but that's OK, because ESP authenticates
its own data.</i>
d376 2
a377 1
tunnels all traffic in a separate ESP/IP packet).  If either
a485 1
<LI><A HREF="http://www.microsoft.com/">Microsoft</a> Windows 2000
d615 11
a625 1
are detailed, and can be very helpful!
d629 2
d632 1
a632 1
<LI><A HREF="http://www.cis.ohio-state.edu/htbin/rfc/rfc2401.html">RFC 2401</a> - Security Architecture for the Internet Protocol
d644 1
d658 1
a658 1
<small>$OpenBSD: faq13.html,v 1.9 1999/10/18 22:08:33 chris Exp $</small>
@


1.9
log
@Add troubleshooting info from Hkan Olsson, interoperability
info from Niklas Hallqvist, and minor fixup.
@
text
@a24 1
<h1>13.0 - IP Security Protocol</h1>
d33 3
d56 5
a60 2
transparent to your applications, and much more powerful (they don't have to
have any knowledge of IPSec.)  Also see <A HREF="http://www.cis.ohio-state.edu/htbin/rfc/rfc2401.html">RFC 2401</a>.
d73 1
a73 1
Of course, in every scenario that involves a network, we mean to imply
d302 3
a304 2
kernel.  (If you are only using ESP, such as the rc.vpn script, then you
do not need to enable AH.)  There is a nice sysctl to do this.
d354 2
a355 2
On 192.168.5.1:<BR>
So, right here, *two* flows will be created, one with 0.0.0.0/32 as the
d372 1
a372 1
without -forcetunnel will let you use transport mode (whereas, -forcetunnel
d385 2
a386 1
As you can see, with IPSec, you have to specify <b>exactly</b> what you want done.
d464 2
a465 2
they require you to use some form of ISAKMP.  Unfortunately, this FAQ
isn't complete yet, certainly not section 13.6. 
d470 4
a473 4
Isakmpd is the ISAKMP/Oakley key management daemon that comes with OpenBSD.
We suspect that it interoperates with most any ISAKMP implementation,
but the following have actually been tested.   Note that some isakmp
software out there is actually based on the OpenBSD isakmp daemon.
d482 1
d487 1
a487 1
<LI><A HREF="http://www.cisco.com/">Cisco</a> IOS IPSec
d497 1
a497 1
<LI><A HREF="http://www.f-secure.com/">F-Secure (previously Datafellows)</a> VPN+
d590 2
a591 2
If all else fails, recompile your kernel with option ENCDEBUG.
Then, set the sysctl net.inet.ip.encdebug to 1.  Look in your dmesg for
d605 1
d612 1
a612 1
can help if you are using any of these components!
d642 1
a642 1
<small>$OpenBSD: faq13.html,v 1.8 1999/10/18 19:51:26 ericj Exp $</small>
@


1.8
log
@conform header
@
text
@d13 1
a13 1
<img alt="[OpenBSD]" height=30 width=141 src="../images/smalltitle.gif">
a15 1

d41 3
a43 2
<LI><A HREF="#13.7">What other IKE clients are compatible with isakmpd?</a>
<LI><A HREF="#13.8">Related Documentation</a>
d137 1
a137 1
</B>(AH) comes after the basic IP&nbsp;header and contains cryptographically
d139 1
a139 1
also cover the invariant parts of the IP&nbsp;header itself. There are
d159 1
a159 1
packet. In other words an AH&nbsp;added to the packet will cover the hashing
d161 2
a162 2
header will cover the encryption of the TCP&nbsp;header and the data, but
not the end-to-end IP&nbsp;header.</LI>
d164 1
a164 1
<LI><B>Tunnel </B>mode is used when the end-to-end IP&nbsp;header is already
d166 2
a167 2
only a gateway. In this mode, the AH&nbsp;and ESP headers are used to cover
the entire packet including the end-to-end header, and a new IP&nbsp;header
d182 1
a182 1
negotiated. and the protocol must be either AH&nbsp;or ESP. Since the IP
d195 2
a196 2
<P>Because an ESP&nbsp;header cannot authenticate the outer IP header,
it is useful to combine an AH&nbsp;and an ESP header to get the following:</P>
d208 1
a208 1
an AH&nbsp;and an ESP&nbsp;header are diectly applied together like this,
d225 2
a226 2
however the SPD&nbsp;is two steps removed from the actual processing. The
SPD&nbsp;is used for outgoing packets, to decide what SAD entries should
d252 11
a262 21
<LI>Dest IP address</LI>

<LI>Ipsec proto (SA&nbsp;or ESP)</LI>

<LI>SPI&nbsp;(cookie)</LI>

<LI>Sequnce counter</LI>

<LI>Seq O/F flag</LI>

<LI>anti-replay window info</LI>

<LI>AH&nbsp;type and info</LI>

<LI>ESP&nbsp;type and info</LI>

<LI>Lifetime info</LI>

<LI>tunnel/transport mode flags</LI>

<LI>PATH MTU&nbsp;info</LI>
d268 2
a269 3
<LI>pointer to active SAs</LI>

<LI>Selector fields</LI>
d272 1
a272 1
<P>Each <B>SA</B> can define one ESP&nbsp;header and one AH header. so
d276 1
a276 1
AH&nbsp;and ESP&nbsp;headers dissagree about the SPI value. One would presume
d297 2
a298 1
kernel.  There is a nice sysctl to do this.
d314 2
a315 1
authentication, but that's OK, because we are tunneling.</i>
d344 9
a352 1
On 192.168.5.1:
d364 7
d444 7
d460 1
a460 1
<h1>13.7 - What other IKE clients are compatible with isakmpd?</h1>
d463 5
d473 2
d477 1
a477 1
The following other clients have been reported to be compatible:
d480 5
d486 7
d496 1
a496 1
<h1>13.8 - Related Documentation</h1>
d499 93
d633 1
a633 1
<small>$OpenBSD: faq13.html,v 1.7 1999/10/18 18:08:31 chris Exp $</small>
@


1.7
log
@Smooth it out a little bit
@
text
@d13 4
d508 1
a508 1
<small>$OpenBSD: faq13.html,v 1.6 1999/10/18 17:25:34 chris Exp $</small>
@


1.6
log
@Something that may actually be useful!!
This is still very rough
Any contributions are more then welcome
Borrows heavily from Julian Elischer and ipsec(4)
@
text
@d36 2
a37 2
<LI><A HREF="#13.5">How do I setup IPSec?</a>
<LI><A HREF="#13.6">How do I setup isakmpd/IKE?</a>
d106 2
a107 1
performed when using manual-keyed IPsec (e.g., when using ipsecadm(8) )</i>.
d294 1
a294 1
<h1>13.5 - How do I setup IPSec?</h1>
d297 17
a313 1
To use IPSec, you need to start by setting up SAs, or Security Associations.
d344 1
a344 1
Notice that the SPIs are different.  The SPIs are used by to keep track of your SAs and flows.
d435 1
a435 1
<h1>13.6 - How do I setup isakmpd/IKE?</h1>
d450 1
a450 1
<LI><A HREF="http://www.pgp.com/">PGPnet</a> software
d504 1
a504 1
<small>$OpenBSD: faq13.html,v 1.5 1999/07/30 19:48:19 chris Exp $</small>
@


1.5
log
@re-organization of the faq, based greatly on the recent changes to the main web page. This way will hopefully allow for greater expansion and readability. Some of the numbers have changed. sorry.
@
text
@d3 1
a3 1
<title>OpenBSD FAQ: 13 - Using IPsec in OpenBSD</title>
d9 1
a9 1
<meta name= "copyright"     content= "This document copyright 1998,1999 by OpenBSD.">
a12 2

<img alt="[OpenBSD]" height=30 width=141 src="../images/smalltitle.gif">
d14 5
a18 1
<h2><font color=#e00000>13.0 - Using IPsec in OpenBSD</font><hr></h2>
d22 268
a289 5
<ul><h3>Table of Contents</h3>
<li><a href="#13.1">IPsec</a>
</ul>
</p> 
<hr>
a290 1
<br>
d292 52
d345 101
a445 2
<a name="13.1"> 
</p>
d449 1
a449 1
man page.  There are various files in <A HREF="http://www.openbsd.org/cgi-bin/cvsweb/src/share/ipsec/">/usr/share/ipsec/</a>
d457 1
a457 2
are also available!
</p>
d459 17
a475 7
You should also check <a href="http://www.codetalker.com/greenbox/docs/vpn-24-minifaq.html">Codetalker</a> which has an FAQ
for setting up an IPSec VPN with OpenBSD.  It explains some basic IPSec concepts and how to apply them to a VPN setup.
</p>

<br>
 
<b>Section Under Work</b>
a476 1
<p>
d480 1
a480 1
<a href= "faq14.html">[To Section 14.0 - Using Disks in OpenBSD]</a>
a481 2
</p>

d487 1
a487 1
<small>$OpenBSD$</small>
@


1.4
log
@move disk information away from faq4 to a new faq15. This will leave room for an expanded installation section. faq14 added also although no information is in there to fill it. Soon it will be the IPsec FAQ
@
text
@d3 1
a3 1
<title>OpenBSD FAQ: 13 - For Advanced Users</title>
d13 2
d16 1
a16 5
<font color= "#0000e0">
<a href= "index.html">[Back to Main Index]</a>
<a href= "faq12.html">[To Section 12.0 - Performance Tuning]</a>
<a href= "faq14.html">[To Section 14.0 - IPsec]</a>
</font>
d20 4
a23 1
<h1>13.0 - For Advanced Users</h1>
d25 2
a26 1
</p>
d29 1
a29 110
<a name= "13.1">
<h2>13.1 - Using OpenBSD's new PCI-IDE code</h2>
</a>

<p>
If you have a current source tree that was last updated after July 25th, you
will notice that OpenBSD has PCI-IDE code enabled by default, a big win on
performance
for anyone using an IDE controller!  The PCI-IDE code introduces new PCI and ISA IDE
code, and both PCI and ISA versions have DMA (or Direct Memory Access) capability.
DMA allows the IDE controller to transfer data right from disk to your memory
instead of running it through the CPU.  This lowers the overall utilization
of your CPU,  keeping disk access fast and clean.
(Note that OpenBSD has implemented the pciide code from NetBSD.)
<P>
<UL><TT>
Date: Mon, 19 Jul 1999 18:07:40 -0700 (PDT)<BR>
From: Constantine Sapuntzakis &lt;<A HREF="mailto:csapuntz@@stanford.edu">csapuntz@@stanford.edu</a>&gt;<BR>
To: tech@@openbsd.org<BR>
Subject: New ATA/IDE stuff in OpenBSD<BR>
<P>
This weekend, I started integrating the IDE code from NetBSD-current
to OpenBSD-current. It should be considered a work-in-progress.
<P>
I'm sending out this e-mail for three reasons: to tell you about the
new stuff, to ask for help in porting this across all the platforms
with IDE, and to ask for help in testing this new feature.
<P>
The code from NetBSD supports DMA, UltraDMA, PCI IDE, better error
recovery, etc. It's also faster too. The code has been extensively
tested in NetBSD but not in OpenBSD. The usual warnings apply: 
the new drivers might cause data loss.
<P>
The new code also has a different way of handling ATAPI devices (like
IDE CD ROMs, IDE tape drives, etc.). ATAPI devices talk the SCSI
packet protocol and the new ATAPI layer acts like a SCSI adapter. As
such, your ATAPI CD will now appear as SCSI CD (cd*), your ATAPI tape
drive as a SCSI tape drive (st*), your ATAPI zip drive like a SCSI
drive (sd*), etc. (note: some older ZIP drives are not ATAPI devices)
<P>
Many ATAPI devices are NOT entirely SCSI-I and SCSI-II compliant.  As
such, our SCSI device drivers may not work with your CD/tape drive/ZIP
drive. Integrating ATAPI device support into our SCSI devices is a
high priority so this shouldn't stay broken for long.  However, in the
interim, you might get SCSI errors to the console if you try to use
the devices. Under no condition should your machine hang or panic.  If
your machine does hang/panic, please send me mail, describing the
steps leading up to the hang and providing a dmesg dump.
<P>
For the best hard disk performance, you should not have an ATAPI
device on the same chain as a hard disk.
<P>
Currently, the ATA stuff is only integrated into the i386 port.  I am
willing to do the integration work on other platforms, but I need an
account on such a machine to do compiles and your help in testing the
resulting kernel.
<P>
To enable this feature on i386, you are going to have to edit some files.
Comments directing what edits to do appear in the following files:
<P>
1) arch/i386/conf/files.i386 (don't forget to uncomment pciide_machdep.c)<BR>
2) conf/files<BR>
3) dev/isa/files.isa<BR>
4) dev/pci/files.pci<BR>
<P>
In addition, look at
<P>
5) arch/i386/conf/NEWATA for how to configure the new stuff
<P>
If you boot the new stuff, I'd appreciate it if you sent me a dmesg dump.
Once you've got a new kernel, if anything goes wrong, please send me mail.
<P>
Feel free to provide positive feedback too. ;)
<P>
Thanks,<BR>
-Costa<BR>
</UL></tt>
<p>
With the PCI IDE code, your chipset may not be known.  If so, you will
get a message like:
<UL>
<PRE>
pciide0: bus-master DMA support present, used without full driver support
</PRE>
</UL>
If you get this message, you can try and force DMA mode by
using 'flags 0x0001' on your pciide entry in your kernel config file.
That would look something like this:
<UL><PRE>
pciide* at pci ? dev ? function ? flags 0x0001
</PRE></ul>
After doing this, the pciide code will try to use DMA mode regardless of
whether or not it actually knows how to do so with your chipset.  If this 
works, and your system makes it through fsck and startup, it is likely
that this will work for good.  If this does not work, and the system hangs
or panics after booting, then you can't use DMA mode (yet, until support
is added for your chipset).  Note that if you find the documentation
for your PCI-IDE controller's chipset, this is a good start to fully
supporting your chipset within the PCI-IDE code.  You can look on the
manufacturer's website or call them.  If your PCI-IDE controller is part
of your motherboard, figure out who manufactures the chipset and pursue their
resources!
<P>
Note that you will know that DMA support has been enabled if you see this
message:
<UL><PRE>
pciide0:0:0: using DMA data transfers
</PRE></UL>
This means that pciide0, channel 0, drive 0 is using DMA data transfers.
</ul>
d32 15
a46 11
Some notes:
</p>
<p>
DMA is not supported on wdc* unless a DMA channel (drq) is
specified. I'm not sure what the "standard" drqs are for hard disk
controllers. To enable
<pre>
wdc0	at isa? port 0x1f0 irq 14 flags 0x00
</pre>
Non-ultra DMA does not necessarily lead to higher bandwidth vs PIO. 
However, it decreases the CPU load significantly.
d48 4
d56 2
a57 2
<a href= "faq12.html">[To Section 12.0 - Performance Tuning]</a>
<a href= "faq14.html">[To Section 14.0 - IPsec]</a>
d66 1
a66 1
<small>$OpenBSD: faq13.html,v 1.3 1999/09/15 04:24:43 ericj Exp $</small>
@


1.3
log
@change h1 -> h2
@
text
@d17 1
d156 1
d165 1
a165 1
<small>$OpenBSD: faq13.html,v 1.2 1999/08/31 15:07:20 chris Exp $</small>
@


1.2
log
@not any more
@
text
@d27 1
a27 1
<h1>13.1 - Using OpenBSD's new PCI-IDE code</h1>
d163 1
a163 1
<small>$OpenBSD: faq13.html,v 1.1 1999/07/30 19:48:19 ericj Exp $</small>
@


1.1
log
@move advanced info to its own faq so that regular users dont attempt things they shouldnt
@
text
@a140 5
The cd driver is mostly working. You will probably get a SCSI error
message to the console when you initially use an audio cd. This is
because OpenBSD tries to read the disklabel of off the audio cd.
</p>
<p>
d163 1
a163 1
<small>$OpenBSD$</small>
@

