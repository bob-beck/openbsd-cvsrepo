head	1.123;
access;
symbols;
locks; strict;
comment	@# @;


1.123
date	2014.04.01.17.03.09;	author nick;	state dead;
branches;
next	1.122;

1.122
date	2013.12.06.20.52.46;	author ajacoutot;	state Exp;
branches;
next	1.121;

1.121
date	2013.11.16.15.12.55;	author ajacoutot;	state Exp;
branches;
next	1.120;

1.120
date	2013.11.01.18.04.04;	author ajacoutot;	state Exp;
branches;
next	1.119;

1.119
date	2013.10.19.06.29.30;	author ajacoutot;	state Exp;
branches;
next	1.118;

1.118
date	2013.08.29.06.30.41;	author ajacoutot;	state Exp;
branches;
next	1.117;

1.117
date	2013.07.15.06.56.19;	author ajacoutot;	state Exp;
branches;
next	1.116;

1.116
date	2013.03.08.15.50.18;	author ajacoutot;	state Exp;
branches;
next	1.115;

1.115
date	2013.01.13.09.31.06;	author ajacoutot;	state Exp;
branches;
next	1.114;

1.114
date	2012.11.05.08.22.12;	author ajacoutot;	state Exp;
branches;
next	1.113;

1.113
date	2012.10.17.13.50.10;	author ajacoutot;	state Exp;
branches;
next	1.112;

1.112
date	2012.08.24.12.38.10;	author ajacoutot;	state Exp;
branches;
next	1.111;

1.111
date	2012.08.13.10.14.16;	author ajacoutot;	state Exp;
branches;
next	1.110;

1.110
date	2012.06.09.08.27.50;	author ajacoutot;	state Exp;
branches;
next	1.109;

1.109
date	2012.05.26.08.43.41;	author ajacoutot;	state Exp;
branches;
next	1.108;

1.108
date	2012.05.02.13.15.06;	author ajacoutot;	state Exp;
branches;
next	1.107;

1.107
date	2012.04.25.12.13.16;	author ajacoutot;	state Exp;
branches;
next	1.106;

1.106
date	2012.04.19.23.56.51;	author ajacoutot;	state Exp;
branches;
next	1.105;

1.105
date	2011.05.07.08.22.00;	author ajacoutot;	state Exp;
branches;
next	1.104;

1.104
date	2010.11.09.08.15.20;	author ajacoutot;	state Exp;
branches;
next	1.103;

1.103
date	2010.09.26.10.09.24;	author ajacoutot;	state Exp;
branches;
next	1.102;

1.102
date	2010.05.23.16.20.41;	author ajacoutot;	state Exp;
branches;
next	1.101;

1.101
date	2010.05.16.20.33.43;	author ajacoutot;	state Exp;
branches;
next	1.100;

1.100
date	2010.03.19.14.01.23;	author ajacoutot;	state Exp;
branches;
next	1.99;

1.99
date	2010.02.09.07.54.03;	author ajacoutot;	state Exp;
branches;
next	1.98;

1.98
date	2009.11.30.13.23.49;	author ajacoutot;	state Exp;
branches;
next	1.97;

1.97
date	2009.10.26.20.27.01;	author ajacoutot;	state Exp;
branches;
next	1.96;

1.96
date	2009.10.20.20.44.41;	author ajacoutot;	state Exp;
branches;
next	1.95;

1.95
date	2009.09.09.06.51.17;	author ajacoutot;	state Exp;
branches;
next	1.94;

1.94
date	2009.07.21.15.20.56;	author ajacoutot;	state Exp;
branches;
next	1.93;

1.93
date	2009.06.13.08.31.49;	author ajacoutot;	state Exp;
branches;
next	1.92;

1.92
date	2009.05.01.13.16.23;	author tobias;	state Exp;
branches;
next	1.91;

1.91
date	2009.04.26.15.44.20;	author tobias;	state Exp;
branches;
next	1.90;

1.90
date	2009.02.22.20.35.21;	author tobias;	state Exp;
branches;
next	1.89;

1.89
date	2008.12.01.07.52.52;	author tobias;	state Exp;
branches;
next	1.88;

1.88
date	2008.03.31.20.01.44;	author tobias;	state Exp;
branches;
next	1.87;

1.87
date	2008.03.20.15.57.34;	author saad;	state Exp;
branches;
next	1.86;

1.86
date	2008.03.02.12.12.59;	author tobias;	state Exp;
branches;
next	1.85;

1.85
date	2008.02.25.15.26.19;	author saad;	state Exp;
branches;
next	1.84;

1.84
date	2008.02.02.17.34.39;	author saad;	state Exp;
branches;
next	1.83;

1.83
date	2008.01.19.17.39.43;	author saad;	state Exp;
branches;
next	1.82;

1.82
date	2007.05.02.15.10.00;	author jufi;	state Exp;
branches;
next	1.81;

1.81
date	2007.04.29.22.23.18;	author saad;	state Exp;
branches;
next	1.80;

1.80
date	2007.02.18.23.01.09;	author saad;	state Exp;
branches;
next	1.79;

1.79
date	2007.02.09.05.15.24;	author saad;	state Exp;
branches;
next	1.78;

1.78
date	2007.02.06.06.04.56;	author saad;	state Exp;
branches;
next	1.77;

1.77
date	2007.02.04.08.19.55;	author saad;	state Exp;
branches;
next	1.76;

1.76
date	2007.02.02.06.46.52;	author saad;	state Exp;
branches;
next	1.75;

1.75
date	2006.12.23.20.51.44;	author jufi;	state Exp;
branches;
next	1.74;

1.74
date	2006.12.02.20.22.09;	author jufi;	state Exp;
branches;
next	1.73;

1.73
date	2006.11.22.15.14.07;	author saad;	state Exp;
branches;
next	1.72;

1.72
date	2006.11.03.14.23.31;	author jufi;	state Exp;
branches;
next	1.71;

1.71
date	2006.10.29.10.58.52;	author jufi;	state Exp;
branches;
next	1.70;

1.70
date	2006.10.23.09.57.07;	author saad;	state Exp;
branches;
next	1.69;

1.69
date	2006.09.08.20.49.53;	author saad;	state Exp;
branches;
next	1.68;

1.68
date	2006.08.30.13.47.18;	author jufi;	state Exp;
branches;
next	1.67;

1.67
date	2006.08.25.09.50.10;	author jufi;	state Exp;
branches;
next	1.66;

1.66
date	2006.08.24.12.42.01;	author jufi;	state Exp;
branches;
next	1.65;

1.65
date	2006.08.08.07.14.20;	author saad;	state Exp;
branches;
next	1.64;

1.64
date	2006.06.26.18.32.12;	author jufi;	state Exp;
branches;
next	1.63;

1.63
date	2006.06.01.06.33.43;	author jufi;	state Exp;
branches;
next	1.62;

1.62
date	2006.05.24.06.48.44;	author jufi;	state Exp;
branches;
next	1.61;

1.61
date	2006.05.14.09.54.41;	author saad;	state Exp;
branches;
next	1.60;

1.60
date	2006.05.02.17.09.33;	author jufi;	state Exp;
branches;
next	1.59;

1.59
date	2006.04.08.15.13.14;	author saad;	state Exp;
branches;
next	1.58;

1.58
date	2006.03.30.18.51.33;	author saad;	state Exp;
branches;
next	1.57;

1.57
date	2006.03.19.12.31.05;	author jufi;	state Exp;
branches;
next	1.56;

1.56
date	2006.03.10.16.35.06;	author saad;	state Exp;
branches;
next	1.55;

1.55
date	2006.02.27.21.23.27;	author saad;	state Exp;
branches;
next	1.54;

1.54
date	2005.12.24.10.04.35;	author saad;	state Exp;
branches;
next	1.53;

1.53
date	2005.11.25.00.26.21;	author saad;	state Exp;
branches;
next	1.52;

1.52
date	2005.11.03.11.30.52;	author saad;	state Exp;
branches;
next	1.51;

1.51
date	2005.11.01.19.05.39;	author jufi;	state Exp;
branches;
next	1.50;

1.50
date	2005.11.01.10.58.27;	author saad;	state Exp;
branches;
next	1.49;

1.49
date	2005.10.09.20.43.49;	author saad;	state Exp;
branches;
next	1.48;

1.48
date	2005.09.01.16.30.41;	author saad;	state Exp;
branches;
next	1.47;

1.47
date	2005.08.13.07.55.56;	author saad;	state Exp;
branches;
next	1.46;

1.46
date	2005.06.16.13.01.09;	author saad;	state Exp;
branches;
next	1.45;

1.45
date	2005.06.04.08.43.13;	author saad;	state Exp;
branches;
next	1.44;

1.44
date	2005.05.30.13.52.07;	author saad;	state Exp;
branches;
next	1.43;

1.43
date	2005.05.25.04.52.28;	author saad;	state Exp;
branches;
next	1.42;

1.42
date	2005.05.20.14.55.34;	author jufi;	state Exp;
branches;
next	1.41;

1.41
date	2005.05.15.21.17.52;	author saad;	state Exp;
branches;
next	1.40;

1.40
date	2005.04.23.07.03.31;	author jufi;	state Exp;
branches;
next	1.39;

1.39
date	2005.03.29.16.46.07;	author saad;	state Exp;
branches;
next	1.38;

1.38
date	2005.03.25.06.40.57;	author saad;	state Exp;
branches;
next	1.37;

1.37
date	2005.02.22.16.47.21;	author saad;	state Exp;
branches;
next	1.36;

1.36
date	2005.02.06.09.25.52;	author saad;	state Exp;
branches;
next	1.35;

1.35
date	2005.02.04.20.42.27;	author jufi;	state Exp;
branches;
next	1.34;

1.34
date	2005.01.24.09.25.15;	author saad;	state Exp;
branches;
next	1.33;

1.33
date	2005.01.18.09.54.29;	author jufi;	state Exp;
branches;
next	1.32;

1.32
date	2005.01.06.19.15.03;	author jufi;	state Exp;
branches;
next	1.31;

1.31
date	2005.01.02.11.46.26;	author jufi;	state Exp;
branches;
next	1.30;

1.30
date	2004.12.27.19.43.40;	author jufi;	state Exp;
branches;
next	1.29;

1.29
date	2004.12.22.20.12.12;	author jufi;	state Exp;
branches;
next	1.28;

1.28
date	2004.12.10.20.12.57;	author saad;	state Exp;
branches;
next	1.27;

1.27
date	2004.12.04.11.39.32;	author jufi;	state Exp;
branches;
next	1.26;

1.26
date	2004.11.29.20.06.45;	author jufi;	state Exp;
branches;
next	1.25;

1.25
date	2004.11.21.11.10.49;	author jufi;	state Exp;
branches;
next	1.24;

1.24
date	2004.11.11.16.33.00;	author jufi;	state Exp;
branches;
next	1.23;

1.23
date	2004.11.04.13.12.00;	author jufi;	state Exp;
branches;
next	1.22;

1.22
date	2004.11.03.21.01.24;	author saad;	state Exp;
branches;
next	1.21;

1.21
date	2004.11.01.13.49.48;	author jufi;	state Exp;
branches;
next	1.20;

1.20
date	2004.11.01.02.56.30;	author saad;	state Exp;
branches;
next	1.19;

1.19
date	2004.10.31.22.05.01;	author jufi;	state Exp;
branches;
next	1.18;

1.18
date	2004.10.23.10.18.07;	author jufi;	state Exp;
branches;
next	1.17;

1.17
date	2004.10.21.14.21.34;	author jufi;	state Exp;
branches;
next	1.16;

1.16
date	2004.10.15.15.53.37;	author saad;	state Exp;
branches;
next	1.15;

1.15
date	2004.10.12.07.18.21;	author jufi;	state Exp;
branches;
next	1.14;

1.14
date	2004.10.11.16.17.32;	author jufi;	state Exp;
branches;
next	1.13;

1.13
date	2004.10.08.09.41.59;	author jufi;	state Exp;
branches;
next	1.12;

1.12
date	2004.10.07.10.23.59;	author jufi;	state Exp;
branches;
next	1.11;

1.11
date	2004.09.21.08.46.21;	author jufi;	state Exp;
branches;
next	1.10;

1.10
date	2004.08.18.16.29.07;	author jufi;	state Exp;
branches;
next	1.9;

1.9
date	2003.12.15.19.20.57;	author horacio;	state Exp;
branches;
next	1.8;

1.8
date	2003.06.01.12.54.16;	author jufi;	state Exp;
branches;
next	1.7;

1.7
date	2003.05.24.21.04.10;	author jufi;	state Exp;
branches;
next	1.6;

1.6
date	2003.05.12.19.07.12;	author jufi;	state Exp;
branches;
next	1.5;

1.5
date	2002.05.27.14.30.56;	author jufi;	state Exp;
branches;
next	1.4;

1.4
date	2002.02.24.19.10.59;	author jufi;	state Exp;
branches;
next	1.3;

1.3
date	2002.02.22.19.05.10;	author jufi;	state Exp;
branches;
next	1.2;

1.2
date	2002.02.22.08.19.41;	author jufi;	state Exp;
branches;
next	1.1;

1.1
date	2002.02.14.15.21.27;	author jufi;	state Exp;
branches;
next	;


desc
@@


1.123
log
@
Abandon translations, per deraadt@@ and ajacoutot@@.
Thanks to all those that did the translation work, and my appologies to
those who had to translate my writing!
@
text
@<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>6 - Le réseau</title>
<link rev= "made" href= "mailto:www@@openbsd.org">
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<meta name= "resource-type" content= "document">
<meta name= "description"   content= "OpenBSD FAQ 6 - Le réseau">
<meta name= "keywords"      content= "openbsd,faq6">
<meta name= "distribution"  content= "global">
<meta name= "copyright"     content= "This document copyright 1998-2012 by OpenBSD.">
</head>

<body bgcolor="#ffffff" text="#000000">
<!-- passes validator.w3.org, please keep it this way -->

<a href="../../fr/index.html">
<img alt="[OpenBSD]" height=30 width=141 src="../../images/smalltitle.gif" border="0">
</a>
<p>
<font color="#0000e0">
<a href="index.html">[Index de la FAQ]</a>
<a href="faq5.html">[Section 5 - Construire le Système à partir des Sources]</a>
<a href="faq7.html">[Section 7 - Contrôles du clavier et de l'affichage]</a></font>

<h1><font color="#e00000">6 - Le réseau</font></h1>
<!-- UNCOMMENT ONLY WHEN THE FILE IS OUT OF SYNC

<hr>
<p>
<b><font color="#e00000">Remarque Importante :</font></b> Le contenu de
   ce fichier est obsolète. Consultez la version anglaise 
   <a href="../faq6.html">ici</a> pour des informations à jour.

<p>
Si vous souhaitez contribuer à l'effort de traduction,
prière de consulter
<a href="../../fr/translation.html">la page de traduction</a>.

-->

<hr>

<p>
<h3>Table des matières</h3>
<ul>
<li><a href= "#Intro">6.1 - Avant d'aller plus loin</a>
<li><a href= "#Setup">6.2 - Configuration du réseau</a>
<ul>
<li><a href="#Setup.if">6.2.1 - Identifier et configurer vos interfaces réseau</a>
<li><a href="#Setup.gateway">6.2.2 - Passerelle par défaut</a>
<li><a href="#Setup.resolver">6.2.3 - Résolution DNS</a>
<li><a href="#Setup.myname">6.2.4 - Nom d'hôte</a>
<li><a href="#Setup.activate">6.2.5 - Activer les changements</a>
<li><a href="#Setup.chkroute">6.2.6 - Vérifier les routes</a>
<li><a href="#Setup.forward">6.2.7 - Mettre en place une passerelle OpenBSD</a>
<li><a href="#Setup.aliases">6.2.8 - Configurer les alias sur une interface</a>
</ul>
<li><a href= "#PF">6.3 - Comment filtrer et utiliser un pare-feu sous
OpenBSD ?</a>
<li><a href= "#DHCP">6.4 - Protocole d'attribution dynamique des
adresses (DHCP)</a>
<ul>
<li><a href="#DHCPclient">6.4.1 - Client DHCP</a>
<li><a href="#DHCPserver">6.4.2 - Serveur DHCP</a>
</ul>
<li><a href= "#PPP">6.5 - Protocole Point à Point (PPP)</a>
<li><a href= "#Tuning">6.6 - Optimisation des paramètres
réseau</a>
<li><a href= "#NFS">6.7 - Utilisation de NFS</a>
<li><a href= "#Bridge">6.9 - Mise en place d'un pont ("bridge") avec OpenBSD</a>
<li><a href= "#PXE">6.10 - Comment démarrer en utilisant PXE ?</a>
<li><a href= "#CARP">6.11 - Protocole de redondance d'adresse commune (CARP)</a>
<li><a href="#OpenNTPD">6.12 - Utiliser OpenNTPD</a>
<li><a href="#Wireless">6.13 - Quels sont les types de cartes Sans Fil
supportées par OpenBSD ?</a>
<li><a href="#Multipath">6.14 - Comment puis-je mettre en oeuvre un
routage multi-chemin à coût égal ?</a>
</ul>

<hr>

<p>
<a name="Intro"></a>
<h2>6.1 - Avant d'aller plus loin</h2>

<p>
Afin de mieux comprendre ce document, vous devriez lire et assimiler
au moins partiellement la section <a href="faq5.html">Construire le Système
à partir des Sources</a> de la FAQ ainsi que le manuel
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&amp;sektion=8">
ifconfig(8)</a> et
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=netstat&amp;sektion=1">netstat(1)</a>.

<p>
Si vous êtes administrateur de réseau et que vous mettez en place
des protocoles de routage, si vous utilisez OpenBSD en tant que routeur, ou si
vous souhaitez en savoir plus sur les réseaux IP, vous devriez lire "<a
href="http://www.scribd.com/doc/52483921/3Com-Understanding-IP-Addressing">
Understanding IP Addressing</a>" (Comprendre l'adressage IP). Il s'agit d'un
excellent document. Vous pouvez vous appuyer sur celui-ci afin de vous aider
à travailler sur les réseaux IP, surtout si vous en avez un ou
plusieurs sous votre responsabilité.

<p>
Si vous travaillez sur des applications telles que des serveurs web, des
serveurs ftp et des serveurs de messagerie, vous pourriez
bénéficier de la <a
href="http://www.rfc-editor.org/rfc.html">lecture des RFCs</a>. À priori, vous
ne pourrez pas toutes les lire. Choisissez les sujets qui vous
intéressent ou les technologies que vous utilisez sur votre
réseau. Lisez-les et voyez comment ces technologies fonctionnent. Les
RFCs standardisent beaucoup (plusieurs milliers) de protocoles Internet et la
façon dont ils sont censés fonctionner.

<p>
<a name="Setup"></a>
<h2>6.2 - Configuration du réseau</h2>

Normalement, OpenBSD est configuré initialement durant la procédure
d'<a href="faq4.html">installation</a>. Cependant il est intéressant de
comprendre ce qui se passe pendant cette procédure et la façon dont
cela fonctionne.
Toute la configuration réseau est effectuée en utilisant de simples
fichiers texte sous le répertoire <i>/etc</i>.

<p>
<a name="Setup.if"></a>
<h3>6.2.1 - Identifier et configurer vos interfaces réseau</h3>

<p>
Sous OpenBSD, les interfaces sont nommées en fonction du type de la carte
réseau, et non en fonction du type de la connexion. Vous pouvez voir
l'initialisation de votre carte pendant la procédure de démarrage, ou après
celle-ci en utilisant la commande <a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=dmesg&amp;sektion=8">dmesg(8)
</a>. Vous avez aussi la possibilité de voir votre carte réseau
grâce à l'utilisation de la commande <a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&amp;sektion=8">
ifconfig(8)</a>. Voici par exemple la sortie de la commande dmesg pour
une carte Intel Fast Ethernet qui utilise le nom de périphérique fxp.

<blockquote><pre>
fxp0 at pci0 dev 10 function 0 "Intel 82557" rev 0x0c: irq 5, address 00:02:b3:2b:10:f7
inphy0 at fxp0 phy 1: i82555 10/100 media interface, rev. 4
</pre></blockquote>

<p>
Si vous ne connaissez pas le nom du périphérique associé à votre carte,
regardez dans la liste des <a href="../../fr/plat.html">plates-formes
actuellement supportées</a> par votre architecture. Vous pourrez y
trouver le nom des cartes les plus courantes et leur équivalent sous
OpenBSD. Ajoutez au nom alphabétique du périphérique (par exemple fxp)
le numéro assigné par le noyau et vous aurez le nom de votre interface
(par exemple fxp0).

Le chiffre est attribué selon plusieurs critères dépendant du type de
carte et d'autres détails du système.
Certaines cartes se voient assigner un chiffre selon l'ordre dans lequel
elles ont été détectées au démarrage et d'autres selon la configuration
des ressources matérielles ou de l'adresse MAC.

<p>
Vous pouvez connaître quelles interfaces réseaux ont été identifiées à
l'aide de l'utilitaire <a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&amp;sektion=8">
ifconfig(8)</a>. La commande suivante montrera toutes les interfaces
réseau d'un système. Cet exemple montre qu'il n'y a qu'une seule
interface Ethernet physique :
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=fxp&amp;sektion=4">fxp(4)</a>.

<blockquote><pre>
$ <b>ifconfig</b>
lo0: flags=8049&lt;UP,LOOPBACK,RUNNING,MULTICAST&gt; mtu 33200
        priority: 0
        groups: lo
        inet6 ::1 prefixlen 128
        inet6 fe80::1%lo0 prefixlen 64 scopeid 0x3
        inet 127.0.0.1 netmask 0xff000000
fxp0: flags=8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; mtu 1500
        lladdr 00:04:ac:dd:39:6a
        priority: 0
        media: Ethernet autoselect (100baseTX full-duplex)
        status: active
        inet 10.0.0.38 netmask 0xffffff00 broadcast 10.0.0.255
        inet6 fe80::204:acff:fedd:396a%fxp0 prefixlen 64 scopeid 0x1
enc0: flags=0&lt;&gt;
        priority: 0
        groups: enc
        status: active
pflog0: flags=141&lt;UP,RUNNING,PROMISC&gt; mtu 33200
        priority: 0
        groups: pflog
</pre></blockquote>

<p>
Comme vous pouvez le voir, <a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&amp;sektion=8">
ifconfig(8)</a> nous fournit ici beaucoup plus d'informations que nécessaire.
Mais nous pouvons tout de même voir notre interface. Dans l'exemple
précédent, la carte est déjà configurée. Ceci est évident de par la
présence d'une configuration réseau IP pour fxp0, à savoir &quot;inet
10.0.0.38 netmask 0xffffff00 broadcast 10.0.0.255&quot;. Les indicateurs
<b>UP</b> et <b>RUNNING</b> sont également présents.

<p>
Finalement, vous noterez que d'autres interfaces sont activées par
défaut. Il s'agit d'interfaces virtuelles servant différentes fonctions.
Les manuels suivants les décrivent :

<ul>
<!-- XXXrelease -->
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=lo&amp;sektion=4">lo</a>
 - Interface "Loopback"
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflog&amp;sektion=4">pflog</a>
 - Interface d'enregistrement du filtre de paquet (PF)
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=enc&amp;sektion=4">enc</a>
 - Interface d'encapsulation
</ul>

D'autres interfaces virtuelles sont automatiquement créées sur demande, incluant :

<ul>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sl&amp;sektion=4">sl</a>
 - Interface SLIP (protocole Internet sur ligne série)
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ppp&amp;sektion=4">ppp</a>
 - Protocole point à point
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tun&amp;sektion=4">tun</a>
 - Interface de tunnel
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=bridge&amp;sektion=4">bridge</a>
 - Interface de pont Ethernet
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=vlan&amp;sektion=4">vlan</a>
 - Interface d'encapsulation IEEE 802.1Q
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=svlan&amp;sektion=4">svlan</a>
 - IEEE 802.1AD Provider Bridges (QinQ)
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=gre&amp;sektion=4">gre</a>
 - Interface d'encapsulation GRE/MobileIP
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=gif&amp;sektion=4">gif</a>
 - Interface générique de tunnel IPv4/IPv6
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=carp&amp;sektion=4">carp</a>
 - Interface du protocole de redondance d'adresse (CARP)
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mpe&amp;sektion=4">mpe</a>
 - MPLS Provider Edge
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=vether&amp;sektion=4">vether</a>
 - Interface Ethernet Virtuelle
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=trunk&amp;sektion=4">trunk</a>
 - Interface d'agrégation et de basculement de link
</ul>

<p>
Les interfaces sont configurées au démarrage en utilisant les fichiers
/etc/hostname.<i>if</i>, où <i>if</i> est remplacé par le nom complet
de chaque interface, et chaque interface possède son propre fichier.
L'exemple précédent devrait utiliser le fichier : <i>/etc/hostname.fxp0</i>.

<p>
Le format de ce fichier est simple :

<blockquote><pre>
address_family address netmask broadcast [autres options]
</pre></blockquote>

Beaucoup plus d'informations sur la syntaxe de ce fichier sont
disponibles dans le manuel <a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=hostname.if&amp;sektion=5">
hostname.if(5)</a>.
Vous devrez le lire si vous avez besoin de configurations moins
triviales.

<p>
Un fichier de configuration typique pour une interface IPv4 ressemblera
à :

<blockquote><pre>
$ <b>cat /etc/hostname.fxp0</b>
inet 10.0.0.38 255.255.255.0 NONE
</pre></blockquote>

<p>
Dans ce cas, nous avons défini une adresse IPv4 (inet), avec une adresse
IP de 10.0.0.38, un masque de sous-réseau de 255.255.255.0 et pas
d'adresse de broadcast spécifique (qui sera mise par défaut à 10.0.0.255
dans notre cas).

<p>
Vous pouvez également spécifier le type de média d'une connexion
Ethernet pour, par exemple, forcer le mode 100baseTX full-duplex.

<blockquote><pre>
inet 10.0.0.38 255.255.255.0 NONE media 100baseTX mediaopt full-duplex
</pre></blockquote>

<p>
(Bien entendu, vous ne devriez jamais forcer le mode full duplex à moins
que les deux extrémités de la connexion ne soient configurées ainsi ! Si
ce n'est pour des besoins spécifiques, la configuration du type de média
n'est pas nécessaire.
Un cas plus réaliste serait de forcer le mode 10base-T ou half duplex
lorsque cela est rendu nécessaire par votre infrastructure.)

<p>
Vous pouvez aussi vouloir utiliser des indicateurs spécifiques à une
certaine interface. Le format du fichier hostname ne change que très
peu.

<blockquote><pre>
$ <b>cat /etc/hostname.vlan0</b>
inet 172.21.0.31 255.255.255.0 NONE vlan 2 vlandev fxp1
</pre></blockquote>

<a name="Setup.gateway"></a>
<h3>6.2.2 - Passerelle par défaut</h3>
Mettez l'adresse IP de votre passerelle par défaut dans le fichier <i>
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mygate&amp;sektion=5">/etc/mygate</a></i>.
Cela permettra à votre route par défaut d'être configurée au démarrage.
Le fichier n'est constitué que d'une seule ligne comportant l'adresse IP
de la passerelle pour cette machine :

<blockquote><pre>
10.0.0.1
</pre></blockquote>

Il est possible d'utiliser un nom symbolique ici mais soyez prudents :
vous ne pouvez jamais être certain que le résolveur soit configuré ni
même accessible AVANT que la passerelle par défaut n'ait été elle-même
configurée.
En d'autres termes, il est souhaitable que cela soit une adresse IP ou
un objet défini dans le fichier <i>/etc/hosts</i>.

<p>
<a name="Setup.resolver"></a>
<h3>6.2.3 - Résolution DNS</h3>
La résolution de noms DNS est configurée par le fichier <a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=resolv.conf&amp;sektion=5"><i>/etc/resolv.conf</i></a>.
Voici un exemple de fichier <i>/etc/resolv.conf</i> :

<blockquote><pre>
search example.com
nameserver 125.2.3.4
nameserver 125.2.3.5
lookup file bind
</pre></blockquote>

Dans notre cas, le domaine par défaut sera <tt>example.com</tt>, il y
a deux serveurs DNS, <tt>125.2.3.4</tt> et <tt>125.2.3.5</tt>, spécifiés
et le fichier <i>/etc/hosts</i> sera consulté avant que les DNS ne le
soient.

<p>
Comme sous la plupart des Unix (ainsi que de nombreux systèmes
non-Unix), il existe un fichier <a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=hosts&amp;sektion=5"><i>/etc/hosts</i></a>
permettant de définir des systèmes qui ne sont pas (ou, si utilisés avec
la directive de priorité "lookup", ne sont pas désirés) dans le système
DNS formel.

<p>
Si vous utilisez DHCP, lisez <a href="#DHCP">6.4 - DHCP</a> en faisant
attention à la partie sur <a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=resolv.conf.tail&amp;sektion=5">resolv.conf.tail(5)</a>.

<p>
<a name="Setup.myname"></a>
<h3>6.2.4 - Nom d'hôte</h3>
Chaque machine sous Unix possède un nom.
Sous OpenBSD, ce nom est défini comme FQDN ("Fully Qualified Domain
Name" - Nom d'Hôte Pleinement Qualifié) dans le fichier <a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=myname&amp;sektion=5"><i>/etc/myname</i></a>.
Si cette machine se nomme "puffy" et que son domaine est "example.com",
le fichier contiendra la ligne :

<blockquote><pre>
puffy.example.com
</pre></blockquote>

<a name="Setup.activate"></a>
<h3>6.2.5 - Activer les changements</h3>
À présent, vous pouvez soit redémarrer, soit lancer le script
<b>/etc/netstart</b>. Vous pouvez l'exécuter simplement en
tapant (en tant que root) :

<blockquote><pre>
# <b>sh /etc/netstart</b>
writing to routing socket: File exists
add net 127: gateway 127.0.0.1: File exists
writing to routing socket: File exists
add net 224.0.0.0: gateway 127.0.0.1: File exists
</pre></blockquote>

<p>
Notez que plusieurs erreurs sont apparues. En exécutant ce script, vous
reconfigurez certaines choses qui le sont déjà. De fait, certaines
routes sont déjà présentes dans la table de routage du noyau. À présent,
votre système devrait être en état de fonctionner. Une nouvelle fois,
vous pouvez vérifier que votre interface a été correctement configurée
avec <a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&amp;sektion=8">
ifconfig(8)</a>.

<p>
Bien que vous puissiez complètement reconfigurer le réseau sous OpenBSD
sans redémarrer, un reboot est FORTEMENT conseillé après tout changement
significatif dans la configuration.
La raison en est que l'environnement de démarrage est légèrement
différent de celui d'un système en production.
Ainsi, si vous avez défini un nom symbolique à résoudre par DNS dans un
de vos fichiers de configuration, vous vous apercevrez probablement que
cela fonctionnait après une reconfiguration mais que lors du démarrage,
votre résolveur pourrait ne pas être disponible et la configuration
échouer.

<p>
<a name="Setup.chkroute"></a>
<h3>6.2.6 - Vérification des routes</h3>
Vous pouvez vérifier vos routes via <a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=netstat&amp;sektion=1">
netstat(1)</a> ou <a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=route&amp;sektion=8">route(8)
</a>. Si vous avez des problèmes de routage, vous pouvez utiliser
l'option -n de la commande route(8) qui affichera l'adresse IP plutôt
que d'effectuer une requête DNS et d'afficher le nom d'hôte. Voici un
exemple qui vous permettra de voir vos tables de routage en utilisant
ces deux programmes.

<blockquote><pre>
$ <b>netstat -rn</b>
Routing tables

Internet:
Destination        Gateway            Flags     Refs     Use    Mtu  Interface
default            10.0.0.1           UGS         0       86      -  fxp0
127/8              127.0.0.1          UGRS        0        0      -  lo0
127.0.0.1          127.0.0.1          UH          0        0      -  lo0
10.0.0/24          link#1             UC          0        0      -  fxp0
10.0.0.1           aa:0:4:0:81:d      UHL         1        0      -  fxp0
10.0.0.38          127.0.0.1          UGHS        0        0      -  lo0
224/4              127.0.0.1          URS         0        0      -  lo0

Encap:
Source             Port  Destination        Port  Proto SA(Address/SPI/Proto)

$ <b>route show</b>
Routing tables

Internet:
Destination      Gateway            Flags
default          10.0.0.1           UG
127.0.0.0        LOCALHOST          UG
localhost        LOCALHOST          UH
10.0.0.0         link#1             U
10.0.0.1         aa:0:4:0:81:d      UH
10.0.0.38        LOCALHOST          UGH
BASE-ADDRESS.MCA LOCALHOST          U
</pre></blockquote>

<p>
<a name="Setup.forward"></a>
<h3>6.2.7 - Mettre en place une passerelle OpenBSD</h3>

<p>
Voici les informations nécessaires à la mise en place d'une passerelle
OpenBSD (appelé aussi routeur). Si vous devez installer OpenBSD pour en
faire un routeur Internet, nous vous suggérons de lire les instructions
sur la mise en place du filtre de paquets (plus loin) afin de bloquer le
trafic non-autorisé. Avec le peu de disponibilité d'adresses <a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=ip&amp;sektion=4">IPv4</a> de
la part des fournisseurs d'accès à Internet ainsi que des registres
Internet régionaux, vous pourriez vouloir vous renseigner sur la
translation d'adresses (NAT) afin d'économiser votre adressage IP.

<p>
Le noyau GENERIC est déjà configuré pour permettre le routage IP,
mais celui-ci doit être explicitement activé. Vous pouvez l'activer
avec l'utilitaire <a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&amp;sektion=8">
sysctl(8)</a>. Afin d'autoriser le routage de façon permanente,
éditez le fichier <a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl.conf&amp;sektion=5">
/etc/sysctl.conf</a> et ajoutez-y la ligne suivante.

<blockquote><pre>
net.inet.ip.forwarding=1
</pre></blockquote>

<p>
Pour prendre en compte ce changement sans redémarrer, vous utiliserez
directement l'utilitaire
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&amp;sektion=8"> sysctl(8)</a>.
Souvenez-vous que ce changement ne sera pas sauvegardé au redémarrage et
que vous devrez être root pour utiliser cette commande.

<blockquote><pre>
# <b>sysctl net.inet.ip.forwarding=1</b>
net.inet.ip.forwarding: 0 -&gt; 1
</pre></blockquote>

<p>
À présent, modifiez les routes sur les hôtes aux deux extrémités.
Ceci est parfois fait avec des entrées statiques de routes, mais
les réseaux les plus avancés peuvent utiliser une riche suite de
démons de routage inclus dans OpenBSD pour passer des routes aux
autres systèmes.
Ils incluent
<a href="http://www.openbgpd.org/">OpenBGPD</a>,
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ospfd&amp;sektion=8">ospfd(8)</a>,
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ospf6d&amp;sektion=8">ospf6d(8)</a>,
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ldpd&amp;sektion=8">ldpd(8)</a>
et
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ripd&amp;sektion=8">ripd(8)</a>.
Additionnellement la collection de ports inclut des logiciels comme
<a href="http://bird.network.cz/">bird</a>,
<a href="http://igmpproxy.sourceforge.net/">igmpproxy</a> et
<a href="http://www.quagga.net">quagga</a>.
OpenBSD supporte quelques interfaces T1, HSSI, ATM, FDDI et (PPP/SLIP),
et bien sûr des périphériques Ethernet (dont 10Gb).

<p>
<a name="Setup.aliases"></a>
<h3>6.2.8 - Configurer les alias sur une interface</h3>

<p>
OpenBSD possède un mécanisme simple pour la mise en place d'alias
IP sur une interface. Pour ce faire, il suffit d'éditer le fichier <a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=hostname.if&amp;sektion=5">
<i>/etc/hostname.&lt;if&gt;</i></a>. Ce fichier est lu au boot par le
script <a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=netstart&amp;sektion=8">
/etc/netstart(8)</a> faisant partie de la séquence de démarrage <a
href="faq10.html#rc">rc</a>. Admettons par exemple qu'un utilisateur utilise
l'interface <b>dc0</b> et se trouve sur le réseau 192.168.0.0. Autres
informations importantes :

<ul>
<li>l'adresse IP pour dc0 est 192.168.0.2
<li>le masque de sous-réseau est 255.255.255.0
</ul>

<p>
Notes sur les alias. Sous OpenBSD, vous utilisez le nom de l'interface
uniquement. Il n'y a pas de différence entre le premier et le second
alias. À la différence d'autres systèmes d'exploitation, OpenBSD ne s'y
réfère pas en tant que dc0:0, dc0:1. Si vous vous référez à une adresse
IP d'alias avec ifconfig ou si vous ajoutez un alias, soyez sûr
d'utiliser la commande "<tt>ifconfig int alias</tt>" au lieu de
"<tt>ifconfig int</tt>". Vous pouvez supprimer les alias en utilisant
"<tt>ifconfig int delete</tt>".

<p>
En admettant que vous utilisiez plusieurs adresses avec alias sur le
même sous-réseau IP, le masque correspondant à chaque alias devient
255.255.255.255. Il n'est pas nécessaire d'utiliser le masque
correspondant à l'adresse IP primaire de l'interface. Dans cet exemple,
<i>/etc/hostname.dc0</i>, deux alias sont configurés pour le
périphérique dc0, qui lui-même possède l'adresse 192.168.0.2 avec un
masque de 255.255.255.0.

<blockquote><pre>
# <b>cat /etc/hostname.dc0</b>
inet 192.168.0.2 255.255.255.0 NONE media 100baseTX
inet alias 192.168.0.3 255.255.255.255
inet alias 192.168.0.4 255.255.255.255
</pre></blockquote>

<p>
Après avoir édité ce fichier, il suffit de redémarrer pour que les
changements prennent effet. Mais vous pouvez aussi créer les alias à la
main en utilisant l'utilitaire <a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&amp;sektion=8">
ifconfig(8)</a>. Pour créer le premier alias, lancez la commande
suivante :

<blockquote><pre>
# <b>ifconfig dc0 inet alias 192.168.0.3 netmask 255.255.255.255</b>
</pre></blockquote>

(mais encore une fois, un redémarrage est conseillé afin d'être certain
que vous ayez rentré la configuration que vous pensiez !)

<p>
Pour voir les alias, utilisez la commande suivante :

<blockquote><pre>
$ <b>ifconfig -A</b>
dc0: flags=8863&lt;UP,BROADCAST,NOTRAILERS,RUNNING,SIMPLEX,MULTICAST&gt;
        media: Ethernet manual
        inet 192.168.0.2 netmask 0xffffff00 broadcast 192.168.0.255
        inet 192.168.0.3 netmask 0xffffffff broadcast 192.168.0.3
</pre></blockquote>


<p>
<a name="PF"></a>
<h2>6.3 - Comment filtrer et utiliser un pare-feu sous OpenBSD ?</h2>
Sous OpenBSD, le filtrage du trafic IP ainsi que la translation
d'adresses (NAT) est pris en charge par "Packet Filter" (filtre de
paquet ; auquel nous nous référerons à présent sous le nom de PF) . PF
est aussi capable de normaliser et de traiter le trafic IP, d'offrir
une gestion de la bande passante et une priorisation des paquets
ainsi que d'être utilisé dans la création de puissants et flexibles
pare-feu. Tout ceci est décrit dans le <a href="../pf/fr/index.html"><b>Guide
de l'Utilisateur PF</b></a>.


<p> 
<a name= "DHCP"></a>
<h2>6.4 - DHCP</h2> 

Le protocole d'attribution dynamique des adresses (DHCP) permet de
configurer les interfaces réseau automatiquement. OpenBSD peut être
serveur DHCP (afin de configurer les autres machines), client DHCP (afin
de recevoir sa configuration à partir d'une autre machine) et, dans
certains cas, les deux.

<p>
<a name="DHCPclient"></a>
<h3>6.4.1 Client DHCP</h3>

<p>
Pour utiliser le client DHCP <a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=dhclient&amp;sektion=8">
dhclient(8)</a> inclus avec OpenBSD, éditez le fichier
<tt>/etc/hostname.xl0</tt> (sous-entendu que l'interface Ethernet soit
xl0. La vôtre pouvant être aussi bien ep0 que fxp0 ou encore autre chose).
Tout ce que vous avez besoin d'écrire dans ce fichier est
'<tt>dhcp</tt>' :

<blockquote><pre>
# <b>echo dhcp &gt; /etc/hostname.xl0</b>
</pre></blockquote>

<p>
Ceci aura pour effet de démarrer automatiquement le client DHCP au
démarrage. OpenBSD se verra attribuer son adresse IP, sa passerelle par
défaut et ses serveurs de noms (DNS) à partir du serveur DHCP.

<p>
Si vous souhaitez démarrer le client DHCP à partir de la ligne de
commande, vérifiez bien que <tt>/etc/dhclient.conf</tt> existe, puis
lancez la commande :

<blockquote><pre>
# <b>dhclient fxp0</b>
</pre></blockquote>

<p>
Où <tt>fxp0</tt> représente l'interface que vous voulez configurer
par DHCP.

<p>
Peu importe la façon dont vous démarrez le client DHCP, vous pouvez
éditer <tt>/etc/dhclient.conf</tt> afin de ne <b>pas</b> mettre à
jour vos DNS à l'aide du serveur dhcp en décommentant les lignes
'request' (il y a des exemples de configurations, mais vous devez les
décommenter afin de changer le comportement par défaut de
dhclient.)

<blockquote><pre>
request subnet-mask, broadcast-address, time-offset, routers,
      domain-name, domain-name-servers, host-name, lpr-servers, ntp-servers;
</pre></blockquote>

<p>
et supprimez <tt>domain-name-servers</tt>. Bien sûr, vous pouvez
également supprimer <tt>host-name</tt> ainsi que d'autres options.

<p>
En changeant les options dans le fichier <a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=dhclient.conf&amp;sektion=5">
dhclient.conf(5)</a>, vous indiquez au client DHCP la façon de créer votre
fichier  <a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=resolv.conf&amp;sektion=5">
resolv.conf(5)</a>.
Le client DHCP écrase toutes les données déjà présentes dans resolv.conf(5)
en utilisant les informations envoyées par le serveur DHCP. De fait, tous les
changements que vous aurez apportés manuellement seront perdus.

<p>
Il existe deux mécanismes pour empêcher cela :
<ul>
<li>
<tt><a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=dhclient.conf&amp;sektion=5#OPTION+MODIFIERS">OPTION MODIFIERS</a>
</tt> (<b>default</b>, <b>supersede</b>, <b>prepend</b>, et <b>append</b>)
vous permet de modifier n'importe quelles options du fichier dhclient.conf(5).

<li>
<a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=resolv.conf.tail&amp;sektion=5"><tt>resolv.conf.tail(5)</tt></a>
vous permet d'ajouter ce que vous souhaitez au fichier resolv.conf(5)
créé par dhclient(8).
</ul>

<p>
Imaginions que vous souhaitiez utiliser le client DHCP mais que vous
vouliez ajouter <tt>lookup file bind</tt> au fichier resolv.conf(5) créé
par dhclient(8).
Il n'existe pas de telle option dans le fichier <tt>dhclient.conf</tt> et
vous devrez donc utiliser <tt>resolv.conf.tail</tt> pour préserver ce
changement.

<blockquote><pre>
# <b>echo "lookup file bind" &gt /etc/resolv.conf.tail</b>
</pre></blockquote>

À présent, votre fichier resolv.conf(5) devrait inclure "lookup file bind"
à la fin.

<blockquote><pre>
nameserver 192.168.1.1
nameserver 192.168.1.2
lookup file bind
</pre></blockquote>

<p>
<a name="DHCPserver"></a>
<h3>6.4.2 Serveur DHCP</h3>

<p>
Pour utiliser OpenBSD en tant que serveur DHCP <a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=dhcpd&amp;sektion=8">dhcpd(8)
</a>, éditez le fichier <tt>/etc/rc.conf.local</tt> afin qu'il contienne la
ligne <tt>dhcpd_flags=""</tt>.
Par exemple :
<pre>
     # <b>echo 'dhcpd_flags=""' &gt;&gt;/etc/rc.conf.local</b>
</pre>

Cela va démarrer dhcpd, qui va s'attacher à toutes les NICs
qui ont une configuration valide dans <tt>/etc/dhcpd.conf</tt>.
Vous pouvez spécifier des interfaces individuelles au lieu de toutes
en les nommant explicitement, par exemple <tt>dhcpd_flags="xl1 xl2
xl3"</tt>.

<p>
Ensuite, éditez <tt>/etc/dhcpd.conf</tt>. Les options sont plutôt
explicites.

<pre>
        option  domain-name "example.com";
        option  domain-name-servers 192.168.1.3, 192.168.1.5;

        subnet 192.168.1.0 netmask 255.255.255.0 {
                option routers 192.168.1.1;

                range 192.168.1.32 192.168.1.127;
        }
</pre>

<p>
Ceci indique à vos clients DHCP que le domaine à ajouter aux
requêtes DNS est example.com (ainsi, si un utilisateur lance la commande
'telnet joe', il sera renvoyé vers joe.example.com). Les clients auront
comme serveurs DNS 192.168.1.3 et 192.168.1.5. Pour les hôtes
présents sur le sous-réseau correspondant à l'interface du
serveur OpenBSD, à savoir dans la plage 192.168.1.0/24, ils se verront
attribuer une adresse IP entre 192.168.1.32 et 192.168.1.127. Leur passerelle
par défaut sera 192.168.1.1.

<p>
Si vous souhaitez démarrer dhcpd(8) à partir de la ligne de
commandes, une fois <tt>/etc/dhcpd.conf</tt> configuré, tapez :

<pre>
     # <b>/etc/rc.d/dhcpd start</b>
     dhcpd(ok)
</pre>

S'il y a des erreurs de configuration fatales, le programme va
se terminer et va vous faire savoir qu'il n'a pas réussi à démarrer
("<tt>dhcpd(failed)</tt>"), et vous dire pourquoi dans
<tt>/var/log/messages</tt>.

<p>
Si vous prévoyez de servir DHCP à des machines Windows, pour
pourriez souhaiter donner à ces clients une adresse de serveur 'WINS'.
Pour ce faire, ajoutez simplement la ligne suivante dans votre fichier
<tt>/etc/dhcpd.conf</tt> :

<pre>
     option    netbios-name-servers    192.168.92.55;
</pre>

<p>
(où <tt>192.168.92.55</tt> est l'adresse IP de votre serveur Windows ou
Samba.) Reportez vous au manuel
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dhcp-options&amp;sektion=5">
dhcp-options(5)</a> si vos clients DHCP ont besoin de plus d'options.


<p>
<a name="PPP"></a>
<h2>6.5 - PPP </h2>

<p>
Le protocole point à point est généralement utilisé
afin de créer une connexion modem vers votre FAI (fournisseur
d'accès à Internet). Sous OpenBSD, deux solutions existent.

<ul>
<li><a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=pppd&amp;sektion=8">
pppd(8)</a>
 - implémentation noyau du service ppp.
<li><a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=ppp&amp;sektion=8">ppp(8)</a>
 - implémentation ppp en espace utilisateur ("userland"). 
</ul>

<p>
Chacune des implémentations (ppp et pppd) offrent des fonctionnalités similaires
de différentes façons. pppd utilise le pilote <a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=ppp&amp;sektion=4">ppp(4)</a>
inclus dans le noyau alors que ppp utilise <a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=tun&amp;sektion=4">tun(4)</a>
dans l'espace utilisateur. Ce document ne couvrira que l'implémentation en
espace utilisateur du service PPP car il est plus simple à utiliser et
diagnostiquer. Pour commencer, vous aurez besoin de certaines informations
concernant votre FAI. En voici une liste non-exhaustive.

<ul>
<li>Le numéro de téléphone de votre FAI
<li>Votre serveur de noms
<li>Votre nom d'utilisateur et votre mot de passe
<li>Votre passerelle
</ul>

<p>
Certaines de ces options ne sont pas obligatoires mais vous aideront
à la mise en place de ppp. Le fichier de configuration du service
PPP est <a
href="http://www.openbsd.org/cgi-bin/cvsweb/src/etc/ppp/ppp.conf.sample">
/etc/ppp/ppp.conf</a>. Selon votre situation, les nombreux fichiers
présents dans <i>/etc/ppp</i> peuvent vous aider à la mise en
place de votre configuration. Vous devriez jeter un oeil à ce
répertoire.

<p>

<h3>Configuration initiale - pour PPP(8)</h3>

<p>
La configuration initiale de PPP nécessite l'édition du fichier
<i>/etc/ppp/ppp.conf</i>. Ce fichier n'existe pas par défaut, mais vous
pouvez vous inspirer du fichier <i>/etc/ppp/ppp.conf.sample</i> afin de
créer votre propre <i>ppp.conf</i>. Je commencerai par une configuration
simple et généralement très employée. Voici
rapidement un petit fichier <i>ppp.conf</i> définissant quelques valeurs
par défaut :

<blockquote><pre>
default:
  set log Phase Chat LCP IPCP CCP tun command     
  set device /dev/cua01                           
  set speed 115200     
  set dial "ABORT BUSY ABORT NO\\sCARRIER TIMEOUT 5 \"\" AT OK-AT-OK ATE1Q0 OK \\dATDT\\T TIMEOUT 40 CONNECT"
</pre></blockquote>

<p>
La section définie par le marqueur <tt>default:</tt> sera
exécutée à chaque fois. Cette section recense des
informations importantes. &quot;set log&quot; défini le niveau de
verbosité des logs. Il peut être changé :
référez-vous au manuel de <a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=ppp&amp;sektion=8">ppp(8)</a>
pour plus d'informations concernant les niveaux d'enregistrement des
différents événements. Le périphérique utilisé est indiqué par &quot;set
device&quot;. Il s'agit du port sur lequel est présent notre modem. Dans
cet exemple, le modem est branché sur le port com 2. Ainsi, le port com
1 sera indiqué par <i>/dev/cua00</i>. La vitesse de la connexion est
précisée par &quot;set speed&quot; et &quot;set dial&quot; renseigne nos
paramètres de numérotation. Avec ceci, nous pouvons changer l'expiration
("timeout") de la connexion, etc. Ceci étant, cette ligne ne devrait pas
tellement varier.

<p>
Nous pouvons maintenant continuer et configurer les informations
spécifiques à notre FAI. Pour ce faire, nous allons rajouter une autre
section en dessous de <tt>default:</tt>. Le marqueur définissant cette
nouvelle section pourra être ce que vous désirez - le plus simple étant
d'utiliser le nom de votre FAI. Ici, nous utiliserons <tt>myisp:</tt> pour
indiquer le commencement de la section correspondant à notre FAI. Voici
une configuration simple contenant le nécessaire afin de nous connecter
:

<blockquote><pre>
myisp:
  set phone 1234567   
  set login "ABORT NO\\sCARRIER TIMEOUT 5 ogin:--ogin: ppp word: ppp"
  set timeout 120   
  set ifaddr 10.0.0.1/0 10.0.0.2/0 255.255.255.0 0.0.0.0
  add default HISADDR 
  enable dns
</pre></blockquote>

<p>
Ici nous avons fourni les éléments essentiels concernant ce FAI. La
première option, &quot;set phone&quot;, donne le numéro de téléphone du
FAI. Nos options d'ouverture de session sont renseignées par &quot;set
login&quot;. Notre "timeout" est égal à 5 ; ce qui signifie que notre
tentative de connexion expirera après 5 secondes si aucune porteuse
n'est trouvée. Dans le cas contraire, &quot;login:&quot; sera envoyé
avec notre nom d'utilisateur et notre mot de passe.

<p>
Dans cet exemple, notre nom d'utilisateur est : ppp ; notre mot de passe
est : ppp. Ces valeurs doivent être changées. La ligne &quot;set
timeout&quot; permet de couper la connexion après 120 secondes de
non-utilisation. L'option &quot;set ifaddr&quot; est un peu plus compliquée.
En voici une explication plus complète.

<blockquote><pre>
set ifaddr 10.0.0.1/0 10.0.0.2/0 255.255.255.0 0.0.0.0
</pre></blockquote>

<p>
La ligne précédente se définit avec le format suivant : &quot;<b>set
ifaddr [myaddr[/nn] [hisaddr[/nn] [netmask [triggeraddr]]]]</b>&quot;.
La première IP désigne l'adresse IP que nous souhaitons nous voir
attribuer. Si vous avez une adresse IP statique, vous devez l'indiquer
ici. Dans notre exemple, nous utilisons la notation /0 qui dit qu'aucun
"bit" de cette adresse ne doit forcément correspondre et que celle-ci
peut être changée. La deuxième adresse IP est celle du FAI. La troisième
option est notre masque de sous-réseau, ici défini à 255.255.255.0. Si
triggeraddr est renseigné, il remplacera myaddr comme adresse IP
utilisée pour la négociation IPCP initiale. Cependant, seule une adresse
incluse dans la gamme d'adressage correspondant à myaddr sera acceptée.
Ceci peut être utile dans la négociation avec certaines implémentations
PPP qui n'attribuent pas d'adresse IP à moins que l'initiateur de la
connexion ne demande explicitement l'adresse &quot;0.0.0.0&quot;.

<p>
L'option suivante &quot;add default HISADDR&quot; attribue comme route
par défaut l'adresse IP de votre FAI. Cette entrée permet d'ajuster
automatiquement notre route par défaut en cas de changement d'adresse IP
de celui-ci. &quot;enable dns&quot; est utilisé afin de récupérer la
liste des serveurs DNS du FAI. N'utilisez PAS cette option si vous avez
votre propre serveur DNS local car ppp empêchera les requêtes vers celui-ci
en remplaçant les lignes "nameserver" de votre fichier
<i>/etc/resolv.conf</i>.

<p>
À la place des méthodes traditionnelles de connexion, certains FAI
utilisent à présent l'authentification CHAP ou PAP. Si c'est le cas, notre
configuration sera un peu différente:

<blockquote><pre>
myisp:
  set phone 1234567   
  set authname ppp
  set authkey ppp
  set login
  set timeout 120   
  set ifaddr 10.0.0.1/0 10.0.0.2/0 255.255.255.0 0.0.0.0
  add default HISADDR 
  enable dns
</pre></blockquote>

<p>
Dans l'exemple précédent, nous spécifions notre nom d'utilisateur (ppp)
et notre mot de passe à l'aide des options authname et authkey,
respectivement. Il n'est pas nécessaire de spécifier le type
d'authentification CHAP ou PAP utilisé, car il sera négocié
automatiquement. "set login" signifie simplement de tenter de se
connecter en utilisant le nom d'utilisateur et le mot de passe précisés
précédemment.

<p>
<h3>Utiliser PPP(8)</h3>

<p>
Maintenant que <i>ppp.conf</i> est configuré, nous pouvons essayer
d'initier une connexion vers notre FAI. Je détaillerais certaines des
options les plus utilisées :

<ul>
<li><tt>ppp -auto myisp</tt> - Cette commande lancera ppp, configurera vos
interfaces, vous connectera à votre FAI et se placera en
arrière-plan.
<li><tt>ppp -ddial myisp</tt> - Cette commande est similaire à -auto mais
si votre connexion est rompue, ppp essayera de se reconnecter automatiquement.
</ul>

<p>
Si les commandes précédentes ne fonctionnent pas, lancez
<i>/usr/sbin/ppp</i> sans option, ce qui vous placera en mode
interactif. Les options peuvent être spécifiées une par une afin de
diagnostiquer les erreurs et autres problèmes. En utilisant la
configuration précédente, ppp enregistrera les événements dans
/var/log/ppp.log. Ce fichier de log ainsi que la page de manuel
contiennent des informations utiles.

<p>
<h3>Autres options de ppp(8)</h3>

<p>
Dans certaines situations, vous pourriez avoir besoin de lancer
certaines commandes au lancement ou à la coupure de votre connexion. Si
vous vous trouvez dans cette situation, il existe deux fichiers que vous
pouvez créer : <i>/etc/ppp/ppp.linkup</i> et
<i>/etc/ppp/ppp.linkdown</i>. Des exemples de configurations sont
disponibles ici :

<ul>
<li><a
href="http://www.openbsd.org/cgi-bin/cvsweb/src/etc/ppp/ppp.linkup.sample">
ppp.linkup</a>
<li><a
href="http://www.openbsd.org/cgi-bin/cvsweb/src/etc/ppp/ppp.linkdown.sample">
ppp.linkdown</a>
</ul>

<p>
<h3>variations sur ppp(8)</h3>

<p>
De  nos jours, beaucoup de FAI offrent des services xDSL plus rapides que les
méthodes traditionnelles de connexion. Ceux-ci incluent des variantes de type
ADSL et SDSL. Bien qu'aucun appel à distance n'est lieu, la connexion reste
basée sur le protocole point-à-point. En voici des exemples:

<ul>
<li>PPPoE
<li>PPPoA
<li>PPTP
</ul>

<p>
<h3>PPPoE/PPPoA</h3>

<p>
Le protocole d'encapsulation de PPP dans Ethernet (PPPoE - "Point to Point
Protocol over Ethernet") permet d'envoyer des paquets PPP à l'intérieur de
trames Ethernet. Le protocole d'encapsulation de PPP dans ATM (PPPoA - "Point
to Point Protocol over ATM") est généralement utilisé dans les réseaux ATM tels
qu'au Royaume-Uni ou en Belgique.

<p>
En résumé cela signifie que vous pouvez établir une connexion vers votre FAI à
l'aide d'une carte Ethernet standard et d'un modem DSL-Ethernet (à l'inverse des
modems USB).

<p>
Si vous possédez un modem compatible PPPoE/PPPoA, il est possible de le
configurer afin qu'il initie lui-même la connexion. Dans le cas contraire, si le
modem est capable de fonctionner en mode &quot;bridge&quot;, il est possible d'activer ce
mode afin que celui-ci fasse "transiter" les paquets vers une machine exécutant
un logiciel PPPoE (voir plus loin).

<p>
Sous OpenBSD, l'interface logicielle PPPoE/PPPoA principale est <a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=pppoe&amp;sektion=8">pppoe(8)
</a>, qui est l'implémentation en espace utilisateur (de la même manière que <a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=ppp&amp;sektion=8">ppp(8)
</a>, précédemment décrit). Une implémentation noyau de PPPoE, <a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=pppoe&amp;sektion=4">pppoe(4)
</a>, a été ajoutée dans OpenBSD.

<p>
<h3>PPTP</h3>

<p>
Le "Point to Point Tunneling Protocol" (PPTP) est un protocole propriétaire
Microsoft. Un client pptp s'interfaçant avec <a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=pppd&amp;sektion=8">pppd(8)
</a> est disponible et est capable de se connecter à un réseau privé virtuel
PPTP (VPN) utilisé par certains fournisseurs d'accès câble ou xDSL. Le logiciel
pptp quant à lui doit être installé en utilisant les <a href="faq15.html#PkgMgmt">
paquets</a> ou les <a href="faq15.html#Ports">ports</a>. De plus amples
instructions sur la façon de mettre en place et d'utiliser pptp sont disponibles
dans la page de manuel installée avec le paquet pptp.

<p>
<a name="Tuning"></a>
<h2>6.6 - Optimisation des paramètres réseau</h2>

L'un des objectifs de OpenBSD est d'avoir le système <i>Just Work</i> pour la grande
majorité de nos utilisateurs.
Les optimisations que vous ne comprenez pas sont beaucoup plus susceptibles 
de briser le système que d'en améliorer ses performances.
Toujours commencer par les paramètres par défaut et ajuster les choses 
<i>uniquement</i> si vous avez un problème.

<p>
<i>TRÈS PEU DE personnes ont besoin d'ajuster un paramètre réseau !</i>

<p>
<h3>6.6.1 - Je ne veux pas que le noyau alloue dynamiquement un port
donné</h3>

<p>
D'après 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&amp;sektion=8#EXAMPLES">sysctl(8)</a> :

<blockquote><pre>
Définie la liste des ports TCP ne devant pas être alloués dynamiquement
par le noyau :

      # <b>sysctl net.inet.tcp.baddynamic=749,750,751,760,761,871</b>

Ceci peut être utile afin d'éviter l'appropriation d'un
port spécifique dont un autre programme a besoin pour fonctionner. Les
éléments listés peuvent être séparés par une virgule et/ou un espace.

Il est aussi possible d'ajouter ou de retirer des ports de la liste courante.

      # <b>sysctl net.inet.tcp.baddynamic=+748</b>
      # <b>sysctl net.inet.tcp.baddynamic=-871</b>
</pre></blockquote>

<p>
<a name="NFS"></a>
<h2>6.7 - Utilisation simple de NFS</h2>

<p>
NFS ("Network File System") est utilisé afin de partager un système de
fichiers à travers un réseau. Voici un certain nombre de manuels à lire
avant la mise en place d'un serveur NFS :

<ul>
<li><a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=nfsd&amp;sektion=8">nfsd(8)
</a>
<li><a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=mountd&amp;sektion=8">
mountd(8)</a>
<li><a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=exports&amp;sektion=5">
exports(5)</a>
</ul>

<p>
Cette section détaillera les étapes nécessaires à la mise en oeuvre
d'une configuration NFS simple. Cet exemple détaille un serveur et ses
clients NFS sur un LAN. Il ne s'agit pas d'étudier la sécurisation de
NFS. Nous assumerons que le filtre de paquets (PF) ou qu'un autre type
de pare-feu est configuré afin d'interdire les accès extérieurs. Si vous
autorisez l'accès à votre serveur NFS depuis l'extérieur et que vous
hébergez des données sensibles, nous vous conseillons fortement
d'utiliser IPsec. Autrement certaines personnes pourraient voir ce qui
transite dans votre trafic NFS. Quelqu'un pourrait également usurper
l'adresse IP que vous autorisez à se connecter à votre serveur NFS.
Plusieurs types d'attaques peuvent en découler. Mais lorsqu'IPsec est
correctement configuré, il offre une protection contre ces attaques.


<h3>Mise en place d'un serveur NFS</h3>


<p>
Les services suivants doivent être activés et mis en route sur 
serveur :

<ul>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=portmap&amp;sektion=8">portmap(8)</a>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mountd&amp;sektion=8">mountd(8)</a>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=nfsd&amp;sektion=8">nfsd(8)</a>
</ul>

<p>
Ces services sont désactivés par défaut sous OpenBSD.
Afin de les activer, veuillez ajouter les lignes suivantes au fichier
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc.conf.local&amp;sektion=8">rc.conf.local(8)</a> :

<blockquote><pre>
portmap_flags=""
mountd_flags=""
nfsd_flags="-tun 4"
</pre></blockquote>

<p>
L'étape suivante consiste à configurer la liste des systèmes de fichiers
qui doivent être mis à disposition des clients.

<p>
Dans cet exemple, nous disposons d'un serveur dont l'adresse IP est
10.0.0.1.
Ce serveur est destiné à fournir le service NFS uniquement aux clients de
son propre sous-réseau. Tout ceci est configurable dans le fichier
/etc/exports.
Ce fichier liste les systèmes de fichiers destinés à être mis à
disposition via NFS et définit les droits d'accès associés.
Plusieurs options sont disponibles. Il convient de lire la page du
manuel
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=exports&amp;sektion=5">exports(5)</a>.
Pour notre serveur, nous utiliserons le fichier exports suivant :

<blockquote><pre>
#
# NFS exports Database
# See exports(5) for more information.  Be very careful, misconfiguration
# of this file can result in your filesystems being readable by the world.
/work -alldirs -ro -network=10.0.0 -mask=255.255.255.0
</pre></blockquote>

<p>
Ceci signifie que le système de fichiers local <tt>/work</tt> sera
accessible par NFS.
L'option <tt>-alldirs</tt> spécifie que les clients seront capables
de monter n'importe quel répertoire situé sous <tt>/work</tt> ainsi que
<tt>/work</tt> lui-même.
Par exemple, s'il existait un répertoire appelé <tt>/work/monday</tt>,
les clients pourraient monter <tt>/work</tt> (et avoir ainsi accès à
tous les fichiers/répertoires situés sous ce répertoire) ou ils
pourraient tout simplement monter <tt>/work/monday</tt> et avoir ainsi
juste accès aux fichiers/répertoires qu'il contient.
L'option <tt>-ro</tt> spécifie que les clients sont autorisés à faire
de la lecture uniquement.
Les deux derniers arguments spécifient que seuls les
clients présents dans le réseau 10.0.0.0 et utilisant un masque de
255.255.255.0 seront autorisés à monter ce système de fichiers.
Ceci est important pour certains serveurs accessibles dans différents
réseaux.

<p>
Une autre remarque importante sur la sécurité : ne vous contentez pas d'ajouter
tout simplement un système de fichiers à /etc/exports sans l'associer à
une liste d'hôte(s) autorisé(s).
Sans cela, n'importe qui pourrait monter vos répertoires exportés par
NFS.

<p>
Vous pouvez maintenant démarrer les services du serveur.
Vous pouvez soit redémarrer (après activation telle qu'indiquée plus
haut) soit exécuter ces services manuellement.

<blockquote><pre>
# <b>/etc/rc.d/portmap start</b>
# <b>/etc/rc.d/mountd start</b>
# <b>/etc/rc.d/nfsd start</b>
</pre></blockquote>

<p>
<tt>nfsd_flags</tt> active les connexions TCP (-t) et UDP (-u)
et autorise 4 instances (-n) de nfsd à être exécutées. Vous devriez
paramétrer un nombre approprié d'instances de serveur NFS pour gérer
le maximum de connexions simultanées que vous souhaitez être en mesure
de traiter en ajustant <tt>nfsd_flags</tt> à rc.conf.local.

<p>
Vous êtes maintenant prêt à monter les systèmes de fichiers exportés
depuis le(s) client(s).

<p>
Rappel : Si vous effectuez des changements au niveau de /etc/exports
alors que NFS est en cours d'exécution, vous avez juste besoin d'en
informer mountd !
Il suffit d'envoyer un signal HUP à ce service et les modifications
seront effectives.
<blockquote><pre>
# <b>/etc/rc.d/mountd reload</b>
</pre></blockquote>
<h3>Montage de Systèmes de Fichiers NFS</h3>

<p>
Les systèmes de fichiers NFS peuvent être montés à partir d'un client
sans avoir besoin d'activer aucun service.
Ils peuvent être montés de la même manière que n'importe quel autre
système de fichiers.

<p>
Les systèmes de fichiers NFS devraient être montés via mount(8), ou plus
précisément,
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mount_nfs&amp;sektion=8">mount_nfs(8)</a>.
Pour monter un système de fichiers <tt>/work</tt> partagé par l'hôte
10.0.0.1 au niveau du système de fichiers local <tt>/mnt</tt>, effectuez
l'opération suivante (veuillez noter que vous n'avez pas besoin
d'utiliser obligatoirement une adresse IP. mountd peut utiliser le DNS)
:
<blockquote><pre>
# <b>mount -t nfs 10.0.0.1:/work /mnt</b>
</pre></blockquote>

<p>
Pour monter le système de fichiers au démarrage, ajoutez la ligne
suivante à /etc/fstab :
<blockquote><pre>
10.0.0.1:/work /mnt nfs rw 0 0
</pre></blockquote>

<p>
Il est important d'utiliser <tt>0 0</tt> à la fin de cette ligne pour
éviter que le système essaie de faire un fsck des systèmes de fichiers
NFS au démarrage. Les autres options de sécurité standard telles que
<tt>noexec</tt>, <tt>nodev</tt>, et <tt>nosuid</tt>, devraient aussi
être utilisées si applicable.
Par exemple :
<blockquote><pre>
10.0.0.1:/work /mnt nfs rw,nodev,nosuid 0 0
</pre></blockquote>

<p>
De cette manière, aucun périphérique ou programme setuid sur le serveur
NFS ne pourra mettre en défaut les mesures de sécurité prises sur le
client NFS.
Si vous ne comptez pas utiliser de programmes mis à disposition par le
serveur NFS, ajoutez noexec à la liste.

<p>
Lorsqu'on accède à un montage NFS avec l'identité de l'utilisateur root,
le serveur réalisera une correspondance automatique de cet accès root
vers l'utilisateur et le groupe "nobody".
C'est une information importante à connaître lorsqu'on prend en compte
les permissions sur les fichiers.
Par exemple, prenez un fichier avec les permissions suivantes :

<blockquote><pre>
-rw-------    1 root     wheel           0 Dec 31 03:00 _daily.B20143
</pre></blockquote>

<p>
Si le fichier était sur un partage NFS et l'utilisateur root essaye
d'accéder à ce fichier depuis le client NFS, l'accès sera interdit.
Ceci est dû au fait que le serveur utilise les identifiants de
l'utilisateur "nobody" lorsque root essaie d'accéder au fichier.
Étant donné que l'utilisateur nobody n'a pas de permissions d'accès au
fichier, l'accès est interdit.

<p>
L'utilisateur et le groupe auxquels root est "traduit" sont
configurables à l'aide du fichier
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=exports&amp;sektion=5"
>exports(5)</a>
sur le serveur NFS.

<h3>Statistiques NFS</h3>

<p>
Pour s'assurer que NFS fonctionne correctement il faut vérifier que tous
ces services sont lancés et enregistrés avec RPC. Pour ce faire,
utilisez rpcinfo(8).

<blockquote><pre>
$ <b>rpcinfo -p 10.0.0.1</b>
   program vers proto   port
    100000    2   tcp    111  portmapper
    100000    2   udp    111  portmapper
    100005    1   udp    633  mountd
    100005    3   udp    633  mountd
    100005    1   tcp    916  mountd
    100005    3   tcp    916  mountd
    100003    2   udp   2049  nfs
    100003    3   udp   2049  nfs
    100003    2   tcp   2049  nfs
    100003    3   tcp   2049  nfs
</pre></blockquote>

<p>
Dans le cadre d'une utilisation normale, d'autres utilitaires peuvent vous
permettre de voir ce qui se passe au niveau NFS. Un de ces utilitaires est <a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=showmount&amp;sektion=8">
showmount(8)</a>, qui permet de voir ce qui est monté et par qui. Il
existe aussi
<a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=nfsstat&amp;sektion=1"
>nfsstat(1)</a>
qui affiche beaucoup plus de statistiques.
Pour utiliser showmount(8), essayez la commande <tt>/usr/bin/showmount
-a hôte</tt>. Par exemple :

<blockquote><pre>
$ <b>/usr/bin/showmount -a 10.0.0.1</b>
All mount points on 10.0.0.1:
10.0.0.37:/work
</pre></blockquote>

<p>
Cette sortie montre que le client  10.0.0.37 a monté le système de
fichiers exporté <tt>/work</tt> mis à disposition par le serveur
10.0.0.1.

<p>
<a name="Bridge"></a>
<h2>6.9 - Mise en place d'un pont ("bridge") avec OpenBSD</h2>

<p>
Un pont ("<a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=bridge&amp;sektion=4">bridge</a>")
est un lien entre deux (ou plusieurs) réseaux séparés. À
l'inverse d'un routeur, les paquets sont transférés à travers le pont de
manière "invisible" -- au niveau logique, les deux segments de réseau
semblent n'en faire qu'un de chaque côté du pont. Le pont ne transférera
que les paquets passant d'un segment à l'autre, ce qui entre autres,
permet de réduire le trafic sur un réseau complexe tout en permettant à
n'importe quel noeud d'accéder à un autre en cas de besoin.

<p>
Notez qu'à cause de sa nature "invisible", une interface faisant partie
d'un pont peut, ou non, posséder une adresse IP. Si c'est le cas,
l'interface aura deux modes d'opération, l'un faisant partie du pont et
l'autre se comportant comme une interface normale. Si aucune interface
ne possède d'adresse IP, le pont fera transiter le trafic mais ne sera
pas administrable par le réseau (ce qui peut être une fonctionnalité
voulue).

<p>
<h3>Exemple simple d'application d'un pont</h3>

<p>
Un de mes racks possède un certain nombre d'anciens systèmes, lesquels
ne sont pas équipés de carte réseau 10BASE-TX. Bien qu'ils possèdent des
ports AUI ou AAUI, ma réserve de transmetteurs est limitée à des câbles
coaxiaux. Une des machines de cette rangée est un serveur d'accès
terminal sous OpenBSD, toujours allumée et connectée au réseau à haut
débit. L'ajout d'une seconde carte équipée d'un port coaxial permettra
d'utiliser cette machine comme un pont vers le réseau coaxial.

<p>
Ce système a, pour le moment, deux cartes réseau, une Intel
EtherExpress/100 (<a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=fxp&amp;sektion=4"><tt>fxp0</tt></a>)
et une carte 3c590-Combo
(<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ep&amp;sektion=4"><tt>ep0</tt></a>)
pour le port coaxial. <tt>fxp0</tt> fait le lien avec le
reste du réseau et possède donc une adresse IP, <tt>ep0</tt>, ne faisant
quant à elle que du "bridging", n'en possède pas. Les machines
connectées sur le segment coaxial communiqueront comme les autres
présentes sur le reste du réseau. À présent, voyons comment arriver à ce
résultat.

<p>
Le fichier <tt>hostname.fxp0</tt> contient les informations concernant
la carte <tt>fxp0</tt>. Cette machine est configurée pour DHCP, donc le
fichier ressemble à celui-ci :

<blockquote><pre>
$ <b>cat /etc/hostname.fxp0</b>
dhcp NONE NONE NONE
</pre></blockquote>

<p>
Ici, aucune surprise.

<p>
Comme vous pouvez le deviner, la configuration de la carte <tt>ep0</tt>
est un peu différente :

<blockquote><pre>
$ <b>cat /etc/hostname.ep0</b>
up media 10base2
</pre></blockquote>

<p>
Ici, nous demandons au système d'activer cette interface en utilisant <a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&amp;sektion=8">
ifconfig(8)</a> et de la configurer pour du 10BASE-2 (coaxial). Aucune adresse
ou information similaire n'est nécessaire pour cette interface. Les
options possibles pour la carte <tt>ep</tt> sont disponibles en détail
dans le <a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=ep&amp;sektion=4">manuel</a>.

<p>
À présent, il nous faut paramétrer le pont. Un pont est initialisé par
l'existence d'un fichier du type
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hostname.if&amp;sektion=5"><tt>hostname.bridge0</tt></a>. 
Dans ma situation, voici un exemple
possible :

<blockquote><pre>
$ <b>cat /etc/hostname.bridge0</b>
add fxp0
add ep0
up
</pre></blockquote>

<p>
Cela indique de mettre en place un pont constitué de deux interfaces,
fxp0 et ep0 et de l'activer. Est-ce que l'ordre dans lequel les cartes
sont énoncées est important ? Non, souvenez-vous qu'un pont est très
symétrique -- les paquets entrent et sortent dans les deux directions.

<p>
C'est tout ! Redémarrez et vous aurez un pont fonctionnel.

<p>
<h3>Un pont faisant office de serveur DHCP</h3>

<p>
Disons que nous avons un petit système qui possède quatre interfaces
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=vr&amp;sektion=4">vr(4)</a>,
de vr0 à vr3. On veut bridger vr1, vr2 et vr3 ensemble, laissant
vr0 pour un uplink (un câble modem par exemple). On veut également
servir les adresses IP à travers ce DHCP sur les interfaces bridgées.
La machine étant un serveur DHCP et un routeur uplink, elle va devoir
avoir une adresse IP sur le réseau bridgé (contrairement à l'exemple
précédent dans lequel elle n'était pas visible sur le réseau).

<p>
Il n'est pas possible d'assigner une adresse IP directement à une interface
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=bridge&amp;sektion=4">bridge(4)</a>.
L'adresse IP devrait être ajoutée à l'une des interfaces, mais nous
ne pouvons pas utiliser une interface physique étant donné que le
lien pourrait être coupé, rendant l'adresse inatteignable.
Heureusement, depuis OpenBSD 4.7, il y a un driver d'interface Ethernet
virtuelle
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=vether&amp;sektion=4">vether(4)</a>
qui peut être utilisé à cet effet. Nous allons l'ajouter au bridge,
lui assigner une adresse IP et faire en sorte que
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dhcpd&amp;sektion=8">dhcpd(8)</a>
écoute sur cette interface.

<p>
Notes:

<ul>
<li>La <a href="#DHCPserver">configuration du serveur DHCP</a> n'est pas
    décrite dans cette section, mais le schéma utilisé ici est le même.
<li>Cela va être aussi le routeur uplink pour votre réseau bridgé, donc
    nous utiliserons l'adresse IP 192.168.1.1 pour être en adéquation
    avec la configuration du serveur DHCP.
<li>Nous ne traiterons pas de la configuration de l'uplink, du routage
    et du firewalling ici.</li>
</ul>

<p>Tout d'abord, marquez vr1, vr2 et vr3 en tant que "up":

<blockquote><pre>
$ <b>cat /etc/hostname.vr1</b>
up
$ <b>cat /etc/hostname.vr2</b>
up
$ <b>cat /etc/hostname.vr3</b>
up
</pre></blockquote>

<p>
Ensuite, créez la configuration vether0:

<blockquote><pre>
$ <b>cat /etc/hostname.vether0</b>
inet 192.168.1.1 255.255.255.0 192.168.1.255
up
</pre></blockquote>

<p>
On configure l'interface bridge de telle façon qu'elle contienne
toutes les interfaces que l'on a évoquées précédemment:

<blockquote><pre>
$ <b>cat /etc/hostname.bridge0</b>
add vether0
add vr1
add vr2
add vr3
up
</pre></blockquote>

<p>
Et pour finir on configure dhcpd(8) pour qu'il écoute sur
l'interface vether0:

<blockquote><pre>
$ <b>grep ^dhcpd_flags= /etc/rc.conf.local</b>
dhcpd_flags="vether0"
</pre></blockquote>

<p>
Redémarrez, et voilà!

<p>
<h3>Le filtrage sur un pont ("filtering bridge")</h3>

Bien qu'il existe certainement des usages pour de simples ponts du genre
évoqué, il est probable que vous souhaitiez FAIRE quelque chose avec les
paquets qui le traversent. Comme vous pouvez vous en douter, <a
href="#PF">Packet Filter</a> peut être utilisé pour restreindre le
trafic traversant votre pont (pont filtrant).

<p>
Gardez à l'esprit que de part la nature d'un pont, les mêmes données
traversent les deux interfaces, ce qui signifie que vous n'avez besoin
de filtrer que sur l'une d'entre elles. Vos déclarations par défaut "Pass
all" ressembleront à l'exemple suivant :

<blockquote><pre>
pass in  on ep0  all
pass out on ep0  all
pass in  on fxp0 all
pass out on fxp0 all
</pre></blockquote>

<p>
Maintenant, admettons que je souhaite filtrer le trafic dirigé vers les
vieux systèmes évoqués précédemment, ne permettant qu'aux protocoles Web
et SSH de les atteindre. Dans ce cas, nous allons autoriser tout le
trafic entrant et sortant sur l'interface <tt>ep0</tt>, mais nous filtrerons sur
l'interface <tt>fxp0</tt> en utilisant <tt>keep state</tt>
pour prendre en charge les données retournées :

<blockquote><pre>
# Autoriser le trafic entrant et sortant sur ep0
pass in quick on ep0 all
pass out quick on ep0 all

# Bloquer tout le trafic sur fxp0
block in  on fxp0 all
block out on fxp0 all

pass in quick on fxp0 proto tcp from any to any port {22, 80} \
     flags S/SA keep state
</pre></blockquote>

<p>
Notez que cette règle bloquera tout, à l'exception des requêtes
entrantes HTTP et SSH, vers la machine qui fait le pont ainsi qu'en
direction des autres noeuds "derrière" elle. Il est possible d'obtenir
d'autres résultats en filtrant sur l'autre interface.

<p>
Pour surveiller et contrôler le pont que vous venez de créer,
servez-vous de la commande <a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&amp;sektion=8">
ifconfig(8)</a> qui peut aussi être utilisée pour créer un
pont après le démarrage.

<p>
<h3>Astuces sur les ponts</h3>

<ul>
<li>Il est HAUTEMENT recommandé de ne filtrer que sur une seule
interface. Bien qu'il soit possible de filtrer sur les deux, vous
devez vraiment en connaître toutes les implications avant de pouvoir
le faire de la bonne manière.

<li>En utilisant l'option <i>blocknonip</i> de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&amp;sektion=8">ifconfig(8)</a>
ou dans
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hostname.if&amp;sektion=5">
hostname.bridge0</a>, vous pouvez empêcher le trafic non-IP (comme
IPX ou NETBEUI) de passer outre votre filtre. Dans certaines
situations, cela peut être important et vous devez savoir qu'un pont
fonctionne pour tous les types de trafic, pas seulement IP.

<li>Un pont requiert que les interfaces réseau soient en mode
"Promiscuous" -- elles écoutent TOUT le trafic réseau, pas seulement
celui leur étant dirigé. Ceci augmentera la charge du processeur et
du bus. Certaines cartes ne fonctionnent pas correctement dans ce
mode, le circuit TI ThunderLAN
(<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tl&amp;sektion=4">tl(4)</a>)
en est un exemple.
</ul>

<a name="PXE"></a>
<h2>6.10 - Comment démarrer en utilisant PXE ? (i386, amd64)</h2>
PXE ("Preboot Execution Environment", environnement d'exécution avant
démarrage) permet de démarrer un ordinateur à partir du réseau plutôt
que d'un disque dur, une disquette ou un CD-ROM. À l'origine, cette
technologie a été développée par Intel mais est maintenant supportée par
la plupart des contrôleurs réseau et des constructeurs. Sachez qu'il
existe plusieurs protocoles de démarrage par le réseau, PXE étant
relativement récent. Traditionnellement, un démarrage PXE est effectué
en utilisant des ROMs présentes sur la carte réseau ou la carte mère elle-
même, mais plusieurs disquettes permettant de démarrer en PXE sont
disponibles sur différentes sources. Beaucoup de ROMs présentes sur des
anciens contrôleurs supportent le démarrage en réseau mais sont
incompatibles avec PXE ; s'il est équipé de tels contrôleurs, un
système OpenBSD/i386 ou amd64 ne pourra pas être démarré par le réseau.


<p>
<h3>Comment fonctionne un démarrage PXE ?</h3>
Tout d'abord, il serait sage de savoir <a href="faq14.html#Boot386">comment
se déroule le processus de démarrage d'OpenBSD/i386 ?</a> sur les
plates-formes i386 et amd64. Au démarrage, chaque interface compatible PXE
émet une requête DHCP en broadcast sur le réseau. Le serveur
DHCP lui attribue alors une adresse IP en lui indiquant l'emplacement du fichier
à exécuter sur le serveur
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tftp&amp;sektion=1">
tftp(1)</a>. Ce fichier se charge ensuite de gérer le reste du
démarrage. Sous OpenBSD
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pxeboot&amp;sektion=8&amp;arch=i386">pxeboot</a>
remplace le fichier
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=boot&amp;sektion=8&amp;arch=i386">boot(8)</a>
standard. Il est alors capable de charger et d'exécuter
un noyau (comme <tt>bsd</tt> ou <a href="faq4.html#bsd.rd">
<tt>bsd.rd</tt></a>) à partir du serveur tftp(1).

<h3>Comment le mettre en place ?</h3>
Le point évident est que vous avez besoin d'une machine ou d'un
contrôleur compatible avec un démarrage PXE. Certaines documentations
précisent que toutes les cartes modernes sont compatibles PXE, mais
c'est tout simplement faux -- de nombreux systèmes à bas prix n'incluent
pas de ROMs PXE ou utilisent un ancien protocole de démarrage sur
réseau. Vous avez également besoin d'un serveur <a href="#DHCP">DHCP</a>
configuré ainsi qu'un serveur TFTP.

<p>
En admettant qu'une machine sous OpenBSD serve les fichiers de démarrage
(cela n'étant PAS obligatoire), le fichier <a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=dhcpd.conf&amp;sektion=5">
dhcpd.conf</a> de votre serveur DHCP devra contenir la ligne suivante :
<pre>
    filename "pxeboot";
</pre>
afin de pouvoir offrir ce fichier de démarrage à une station de
travail. Par exemple :

<pre>
    shared-network LOCAL-NET {
            option  domain-name "example.com";
            option  domain-name-servers 192.168.1.3, 192.168.1.5;

            subnet 192.168.1.0 netmask 255.255.255.0 {
                    option routers 192.168.1.1;
                    <b>filename "pxeboot";</b>
                    range 192.168.1.32 192.168.1.127;
                    default-lease-time 86400;
                    max-lease-time 90000;
            }
    }
</pre>

<p>
Vous devrez aussi activer le service
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tftpd&amp;sektion=8">tftpd(8)</a>.
Pour ce faire, ajoutez "<tt>tftpd_flags=/tftpboot</tt>" à votre fichier
<tt>/etc/rc.conf.local</tt>. Les
fichiers accessibles par tftpd(8) sont contenus dans un répertoire
particulier, ici <tt>/tftpboot</tt>, que nous utiliserons pour cet
exemple. Bien évidemment, ce répertoire doit être créé et contenir les
fichiers nécessaires. Pour un démarrage PXE, vous n'aurez typiquement
besoin que de quelques fichiers :

<ul>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pxeboot&amp;sektion=8&amp;arch=i386">pxeboot</a>,
le chargeur de démarrage (offre la même fonction que
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=boot&amp;sektion=8&amp;arch=i386">boot</a>
pour un démarrage sur disque).
<li><a href="faq4.html#bsd.rd">bsd.rd</a>, le noyau d'installation ou
<tt>bsd</tt>, un noyau adapté.
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=boot.conf&amp;sektion=8&amp;arch=i386">/etc/boot.conf</a>,
le fichier de configuration de boot.
</ul>

Notez que <tt>/etc/boot.conf</tt> n'est nécessaire qu'au cas où vous
souhaiteriez démarrer un noyau ne se nommant pas <tt>bsd</tt>, ou que
les options par défaut de pxeboot ne vous conviennent pas (par exemple
si vous utilisez une console série). Vous pouvez tester votre serveur
tftpd(8) en utilisant un client
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tftp&amp;sektion=1">tftp(1)</a>
afin de vérifier que vous pouvez bien récupérer les fichiers nécessaires.

<p>
Une fois vos serveurs DHCP et TFTP démarrés, vous êtes prêt pour un
essai. Vous devez activer PXE sur votre système ou votre carte réseau ;
consultez la documentation fournie avec votre matériel. Une fois que PXE
est activé, vous devriez voir apparaître des lignes similaires à celles-
ci :

<pre>
    Intel UNDI, PXE-2.0 (build 067)
    Copyright (C) 1997,1998 Intel Corporation

    For Realtek RTL 8139(X) PCI Fast Ethernet Controller v1.00 (990420)

    DHCP MAC ADDR: 00 E0 C5 C8 CF E1
    CLIENT IP: 192.168.1.76  MASK: 255.255.255.0  DHCP IP: 192.168.1.252
    GATEWAY IP: 192.168.1.1
    probing: pc0 com0 com1 apm pxe![2.1] mem[540k 28m a20=on]
    disk: hd0*
    net: mac 00:e0:c5:c8:cf:e1, ip 192.168.1.76, server 192.168.1.252
    >> OpenBSD/i386 PXEBOOT 3.19
    boot>
</pre>

À présent, vous obtenez l'invite de commandes standard d'OpenBSD. Si vous
tapez simplement "<tt>bsd.rd</tt>" pour récupérer le fichier <tt>bsd.rd</tt>
à partir du serveur TFTP.

<pre>
    >> OpenBSD/i386 PXEBOOT 3.19
    boot> bsd.rd
    booting tftp:bsd.rd: 4375152+733120 [58+122112+105468]=0x516d04
    entry point at 0x100120

    Copyright (c) 1982, 1986, 1989, 1991, 1993
            The Regents of the University of California.  All rights reserved.

    Copyright (c) 1995-2013 OpenBSD.  All rights reserved.  http://www.OpenBSD.org

    OpenBSD 5.4 (RAMDISK_CD) #34: Tue Jul 30 12:20:01 MDT 2013
      ...
</pre>

Le noyau d'installation <a href="faq4.html#bsd.rd">bsd.rd</a> va
maintenant se lancer.

<p>

<h3>Est-il possible de démarrer d'autres noyaux OpenBSD que <tt>bsd.rd</tt>
en utilisant PXE ?</h3>

Oui, bien qu'avec les outils actuellement présents dans OpenBSD, le
démarrage PXE ne soit essentiellement prévu que pour installer le
système d'exploitation.

<p>
<a name="CARP"></a>
<h2>6.11 - Protocole de redondance d'adresse commune (CARP)</h2>
<h3>6.11.1 - Qu'est-ce que CARP et comment fonctionne-t-il ?</h3>
<!-- This article written by Sunny Raspet, slr@@mordac.info, and
released under the BSD license -->

<p>
CARP ("Common Address Redundancy Protocol") est un outil aidant à la
redondance du système en ayant plusieurs ordinateurs créant une
interface réseau unique entre eux, afin que si l'un d'eux ne fonctionne
plus, un autre puisse répondre à sa place ; cet outil permet aussi de
mettre en place un certain partage de charge entre les différents
systèmes. CARP est une avancée par rapport au VRRP ("Virtual Router
Redundancy Protocol" - protocole de redondance de routeur virtuel)
standard. Il a été développé une fois que VRRP fut considéré comme non
suffisamment libre à cause d'un brevet Cisco pouvant le couvrir. Pour
plus d'informations sur les origines de CARP et les problèmes légaux
entourant VRRP, rendez-vous sur <a href="../../lyrics.html#35">cette
page</a>.

<p>
Afin d'éviter tout problème légal, Ryan McBride (avec l'aide de Michael
Shalayeff, Marco Pfatschbacher et Markus Friedl) a conçut CARP de
manière à être fondamentalement différent. Si l'inclusion de la
cryptographie reste le changement le plus visible, il n'en reste pas
moins un seul parmi beaucoup d' autres.

<p>
Comment fonctionne-t-il ? CARP est un protocole multicast. Il regroupe
plusieurs systèmes physiques en une ou plusieurs adresses virtuelles.
L'un d'eux est le maître et répond aux paquets destinés au groupe, alors
que les autres se comportent comme des "hot spares" (remplacement à
chaud et automatique du maître). Peu importe les adresses IP et MAC de
l'interface physique locale, les paquets envoyés vers l'adresse CARP
reviennent avec les informations CARP.

<p>
A intervalles paramétrables, le maître annonce son état sur le port IP
112. Si le maître est déconnecté, les autres systèmes du groupe CARP
commencent à annoncer leur présence. L'hôte qui parvient à s'annoncer le
plus fréquemment devient le nouveau maître. Lorsque le système principal
est reconnecté, il se transforme par défaut en hôte de secours, bien
qu'il soit possible de configurer un hôte spécifique en tant que maître
par défaut lorsque cela est faisable (ex. un hôte est un Sun Fire
V120 rapide et les autres sont des SPARCstation IPCs, comparativement plus
lentes).

<p>
Bien que les équipements à haute redondance et tolérance de pannes
minimisent le besoin de CARP, ils ne le suppriment pas. Il n'existe pas
de matériel à tolérance de pannes capable de gérer le fait que quelqu'un
débranche le cordon d'alimentation ou que l'administrateur système tape
<tt>reboot</tt> dans la mauvaise fenêtre. L'utilisation de CARP aide à
rendre transparent une mise à jour ou un redémarrage du point de vue des
utilisateurs, ainsi que le test d'un programme ou une mise à jour
matérielle : si cela ne fonctionne pas, vous pouvez basculer sur le
reste du groupe jusqu'à ce que le problème soit résolu.

<p>
Il existe cependant certaines situations où CARP ne pourra pas vous
venir en aide. La conception de CARP est telle que les membres d'un
groupe doivent appartenir au même réseau physique avec une adresse IP
fixe, bien que depuis l'introduction de la directive carpdev il n'y ait
plus besoin d'adresse IP pour les interfaces physiques. De même, les
services nécessitant une connexion constante au serveur (tels que SSH ou
IRC) ne seront pas transférés de manière transparente aux autres
systèmes, bien que dans ce cas, CARP puisse aider à minimiser le temps
d'arrêt. CARP, lui-même, ne synchronise pas les données entre
applications, ceci doit être fait au travers de "procédés alternatifs"
tels que
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfsync&amp;sektion=4">pfsync(4)</a>
(pour du filtrage redondant),
<a href="http://rsync.samba.org/">rsync</a>, pour dupliquer
manuellement les données entre les machines, ou tout ce qui semble
approprié à votre application.

 

<h3>6.11.2 - Configuration</h3>

<p>
Le contrôle de CARP s'effectue en deux endroits :
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&amp;sektion=8">
sysctl(8)</a> et <a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&amp;sektion=8">
ifconfig(8)</a>. Regardons tout d'abord les paramètres sysctls.

<p>
La première variable sysctl, <tt>net.inet.carp.allow</tt>, définit si
l'hôte gère ou non les paquets CARP. Bien évidemment, ceci est
nécessaire à l'utilisation de CARP. Cette variable sysctl est activée
par défaut.

<p>
La seconde, <tt>net.inet.carp.log</tt>, enregistre les changement d'états
de CARP, les mauvais paquets et d'autres erreurs. Activée pour enregistrer 
les changements d'états par défaut.

<p>
La troisième, <tt>net.inet.carp.preempt</tt> active la sélection
naturelle parmi les hôtes CARP. Le plus à même d'effectuer le travail (à
savoir, celui qui est capable de s'annoncer le plus fréquemment)
deviendra le maître. Celle-ci est désactivée par défaut, ce qui signifie
qu'un système qui n'est pas maître ne tentera pas de (re)gagner ce
status.

<p>
Toutes ces variables sysctl sont documentées dans
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&amp;sektion=3">sysctl(3)</a>.

<p>
Pour ce qui concerne le reste de la configuration de CARP, nous
dépendrons d'<a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&amp;sektion=8">
ifconfig(8)</a>. Les commandes <tt>advbase</tt> et <tt>advskew</tt>,
spécifiques à CARP, définissent l'intervalle entre les annonces CARP.
La formule (en secondes) est <tt>advskew</tt> divisée par 256 puis
ajoutée à <tt>advbase</tt>. <tt>advbase</tt> peut être utilisée pour
diminuer le trafic réseau ou autoriser une plus grande latence avant
qu'un hôte de sauvegarde ne prenne le relais ; <tt>advskew</tt> vous
permet de contrôler quel hôte sera le maître sans trop de délais de
basculement (si cela est nécessaire).

<p>
Ensuite, <tt>pass</tt> crée un mot de passe et <tt>vhid</tt> définit le
numéro d'identification d'hôte virtuel du groupe CARP. Vous devez
assigner un numéro unique pour chaque groupe CARP, même s'ils partagent
(pour des raisons de répartition de charge) la même adresse IP. CARP est
limité à 255 groupes.

<p>
Enfin, <tt>carpdev</tt> spécifie l'interface appartenant à ce groupe
CARP particulier. Par défaut, n'importe quelle interface possédant une
adresse IP dans le même sous-réseau que celui assigné à l'interface CARP
sera utilisée.

<p>
Voyons l'emploi de ces différents paramètres dans une configuration
simple. Admettons que vous déployez deux serveurs Web identiques,
<i>rachael</i>
(192.168.0.5) et <i>pris</i> (192.168.0.6), afin de remplacer un ancien système
à l'adresse 192.168.0.7. Les commandes :

<blockquote><pre>
rachael# <b>ifconfig carp0 create</b>
rachael# <b>ifconfig carp0 vhid 1 pass tyrell carpdev fxp0 \
&nbsp;&nbsp;&nbsp;&nbsp;192.168.0.7 netmask 255.255.255.0</b>
</pre></blockquote>

<p>
créent l'interface carp0 et lui donnent un vhid de 1, le mot de passe
<i>tyrell</i>, l'adresse IP 192.168.0.7 de masque 255.255.255.0 et
assignent fxp0 en tant qu'interface membre. Afin de rendre ces
changements permanents après un redémarrage, vous pouvez créer un
fichier <tt>/etc/hostname.carp0</tt> ressemblant à :

<blockquote><pre>
inet 192.168.0.7 255.255.255.0 192.168.0.255 vhid 1 pass tyrell carpdev
fxp0
</pre></blockquote>

Notez qu'il faut ajouter l'adresse de diffusion ("broadcast") en plus du
vhid et du mot de passe.
Ce champ est nécessaire et est souvent cause d'erreurs en cas d'oubli.

<p>
Faites la même chose sur <i>pris</i>. Le système démarrant en premier
son interface CARP deviendra le maître (en admettant que "preempt" est
désactivé ; sinon, c'est l'inverse qui se produit).

<p>
Mais admettons que vous ne déployez pas cette solution à partir de zéro.
<i>Rachael</i> était déjà en place à l'adresse 192.168.0.7. Comment allez-
vous gérer cette situation ? Heureusement, CARP sait gérer ce genre de
situation. Vous assignez simplement l'adresse à l'interface CARP et laissez
vide l'adresse de l'interface physique spécifiée par le mot-clé `carpdev'.
Cependant, il est plus propre d'avoir une adresse
IP différente pour chaque système, cela rend les accès et la surveillance
individuels bien plus simples.

<p>
Ajoutons un nouveau niveau de complexité ; nous souhaitons que
<i>rachael</i> reste maître lorsque cela est possible. Plusieurs raisons
peuvent nous pousser à cela : différences matérielles, simple préjudice,
"si ce système n'est pas maître, c'est qu'il y a un problème", ou
simplement connaître le maître par défaut sans avoir à recourir à des
scripts envoyant par courriel l'analyse de la sortie d'ifconfig.

<p>
Sur <i>rachael</i>, nous utiliserons la variable sysctl créée
précédemment puis nous éditerons <tt>/etc/sysctl.conf</tt> afin de
rendre ce paramètre permanent.

<blockquote><pre>
rachael# <b>sysctl net.inet.carp.preempt=1</b>
</pre></blockquote>

<p>Configurons également <i>pris</i> :

<blockquote><pre>
pris# <b>ifconfig carp0 advskew 100</b>
</pre></blockquote>

<p>
Ceci décale les annonces de <i>pris</i>, ce qui signifie que
<i>rachael</i> sera maître s'il est fonctionnel.

<p>
Notez que si vous utilisez PF sur une machine CARP, vous devez utiliser
"proto carp" sur toutes les interfaces concernées, avec une ligne
similaire à : <blockquote><pre> pass on fxp0 proto carp keep state
</pre></blockquote>

<h3>6.11.3 - Répartition de charge ("load balancing")</h3>

<p>
Effectuons une avance rapide de quelques mois. Notre entreprise de
l'exemple précédent a grossi au point qu'un seul serveur Web interne
arrive tout juste à gérer la charge. Que faire ? CARP à la rescousse. Il
est temps d'essayer la répartition de charge. Créons une nouvelle interface
et un nouveau groupe CARP sur <i>rachael</i> :

<blockquote><pre>
rachael# <b>ifconfig carp1 create</b>
rachael# <b>ifconfig carp1 vhid 2 advskew 100 pass bryant carpdev fxp0 \
&nbsp;&nbsp;&nbsp;&nbsp;192.168.0.7 netmask 255.255.255.0</b>
</pre></blockquote>

<p>
Sur <i>pris</i>, nous allons également créer un nouveau groupe et une
nouvelle interface, puis activer la variable sysctl "preempt" :

<blockquote><pre>
pris# <b>ifconfig carp1 create</b>
pris# <b>ifconfig carp1 vhid 2 pass bryant carpdev fxp0 \
&nbsp;&nbsp;&nbsp;&nbsp;192.168.0.7 netmask 255.255.255.0</b>
pris# <b>sysctl net.inet.carp.preempt=1</b>
</pre></blockquote>

<p>
À présent nous avons deux groupes CARP avec la même adresse IP. Chaque
groupe est dirigé vers un hôte différent, ce qui signifie que
<i>rachael</i> restera maître du premier groupe, mais que <i>pris</i>
lui succédera comme maître dans le second.

<p>
Bien que ces exemples ne soient que pour un cluster de deux machines, le
même principe reste valable avec plus de systèmes. Notez en revanche
qu'il n'est pas assuré que vous parveniez à une distribution de 50/50
sur les deux machines : CARP utilise une empreinte de l'adresse IP d'origine
afin de savoir quel système répondra à la requête, indépendamment de la
charge.

<h3>6.11.4 - Plus d'information sur CARP</h3>
<ul>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=carp&amp;sektion=4">carp(4)</a>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&amp;sektion=8">ifconfig(8)</a>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&amp;sektion=8">sysctl(8)</a>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&amp;sektion=3">sysctl(3)</a>
<li><a href="http://www.countersiege.com/doc/pfsync-carp/">"Firewall
Failover with pfsync and CARP"</a> (Redondance de pare-feu avec pfsync
et CARP) par Ryan McBride
</ul>

<a name="OpenNTPD"></a>
<h2>6.12 - Utiliser OpenNTPD</h2>
Une horloge précise est importante pour plusieurs applications informatiques.
Cependant, plusieurs personnes ont remarqué que leur montre à 5 euros
est plus précise que leur ordinateur à 2000 euros. Certes, connaître la
date et l'heure est une chose importante. Mais souvent, il est plus
important de synchroniser plusieurs machines afin qu'elles s'accordent
sur la date et l'heure actuelles.
Durant un temps, <a href="http://www.ntp.org">ntp.org</a> a produit une
application "Network Time Protocol"
(<a href="http://www.ietf.org/rfc/rfc1305.txt">RFC1305</a>,
<a href="http://www.ietf.org/rfc/rfc2030.txt">RFC2030</a>),
disponible dans le système des <a href="faq15.html#Ports">ports</a>,
et qui peut être utilisée pour synchroniser les horloges des machines à
travers Internet. Cependant, c'est un programme difficile à configurer,
dont le code est difficile à auditer, et qui nécessite une quantité de
mémoire vive conséquente. En somme, c'est un programme qui rend bien des
services à certaines personnes mais qui est loin d'être une solution
pour tous les utilisateurs.

<p>
<a href="http://www.openntpd.org">OpenNTPD</a> est une tentative pour
résoudre certains de ces problèmes en créant un programme compatible NTP
qui soit facile à administrer, sûr, simple et qui vous permette d'avoir
une horloge exacte sur votre ordinateur.
Le service
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ntpd&amp;sektion=8">ntpd(8)</a>
d'OpenBSD est contrôlé  travers le fichier de configuration
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ntpd.conf&amp;sektion=5"><tt>/etc/ntpd.conf</tt></a>
facile à comprendre.

<p>
En activant tout simplement ntpd(8) dans <a
href="faq10.html#rc">rc.conf.local</a>, l'horloge de votre ordinateur
avancera légèrement et restera synchronisée avec les serveurs de <a
href="http://www.pool.ntp.org/">pool.ntp.org</a>, une collection de
serveurs de temps publics.

Une fois votre horloge réglée de manière précise, ntpd la gardera à un
haut degré d'exactitude. Cependant, si votre horloge est décalée de plus
de quelques minutes, il est <i>vivement</i> recommandé de la régler plus
précisément au démarrage car la synchronisation d'une horloge très
décalée pourrait prendre des jours, voire des semaines. Vous pouvez
la régler manuellement en utilisant l'option "<tt>-s</tt>" de ntpd ou
tout autre moyen permettant de mettre l'horloge de votre système à
l'heure.

<a name="OpenNTPDaccurate"></a>
<h3>6.12.1 - "Mais OpenNTPD n'est pas aussi exact que l'application de
ntp.org !"</h3>
C'est probablement vrai.
Ce n'est pas un des <a
href="http://www.openntpd.org/fr/goals.html">objectifs de la conception</a>
d'OpenNTPD. Ce programme a été d'abord conçu pour être libre, simple,
fiable et sécurisé.
Si vous avez réellement besoin d'une précision de l'ordre de la micro-
seconde, alors OpenNTPD n'est pas pour vous. Utilisez plutôt le ntpd de
ntp.org. Ce dernier restera disponible dans les ports et comme paquetage.
Nous n'avons aucun plan ou souhait de rendre OpenNTPD bouffi en y
intégrant toutes les fonctionnalités possibles et imaginables.

<a name="OpenNTPDharmful"></a>
<h3>6.12.2 - "Quelqu'un a prétendu qu'OpenNTPD était 'nuisible' !"</h3>
Certaines personnes n'ont pas compris le but d'OpenNTPD, à savoir un
moyen de synchroniser l'horloge de votre ordinateur qui soit simple,
sécurisé et facile à maintenir.

Si la maintenance d'un temps aussi exact que possible est une chose
importante, un certain nombre d'utilisateurs ont rapporté de meilleurs
résultats avec OpenNTPD par rapport au programme ntpd de ntp.org. Si la
sécurité est importante, le code d'OpenNTPD est beaucoup plus lisible
(et donc auditable) et a été écrit en utilisant les appels de fonction
natifs d'OpenBSD tels que
<a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=strlcpy&amp;sektion=3">strlcpy</a>,
au lieu d'utiliser des fonctions plus portables telles que
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=strcpy&amp;sektion=3">strcpy</a>.
Il a été écrit avec des principes sécurité dès le début. La sécurité n'a
pas été ajoutée par la suite. Si le fait d'amener autant de personnes
que possible à utiliser la synchronisation du temps est une chose
précieuse, OpenNTPD rend une telle entreprise très facile pour beaucoup
de personnes. Si cela est "nuisible", alors nous souhaitons ce genre de
nuisance.

<p>
Il y a des applications pour lesquelles le programme ntpd de ntp.org est
plus approprié, cependant nous croyons qu'OpenNTPD est plus que
suffisant pour une large majorité d'utilisateurs.

<p>
Une réponse plus complète donnée par l'un des mainteneurs d'OpenNTPD et
concernant ce fait est disponible
<a href="http://www.advogato.org/person/dtucker/diary.html?start=52">ici</a>.

<a name="OpenNTPDNoServe"></a>
<h3>6.12.3 - Pourquoi mes autres machines ne peuvent pas se synchroniser
avec OpenNTPD?</h3>

Par défaut, ntpd(8) n'écoute sur aucune adresse.
Ainsi, pour l'utiliser en tant que serveur, vous devez décommenter la
ligne "<tt>#listen&nbsp;on&nbsp;*</tt>" dans
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ntpd.conf&amp;sektion=5">/etc/ntpd.conf</a>
et redémarrer le service ntpd(8).
Bien entendu, si vous préférez écouter sur une adresse particulière
plutôt que sur toutes celles disponibles, remplacez "*" par l'adresse
correspondante.

<p>
Lorsque ntpd(8) écoute il se peut que les autres machines ne puissent
toujours pas se synchroniser !

Lorsque que le service ntpd(8) vient juste de démarrer (par exemple si
vous venez de le redémarrer suite à un changement dans ntpd.conf) il se
peut qu'il refuse la synchronisation des clients en attendant que
lui-même ajuste sa propre horloge a un certain degré de stabilité.
Lorsque ntpd(8) considère que son information temporelle est stable, il
l'annonce par le message "clock now synced" dans
<tt>/var/log/daemon</tt>. Même si l'horloge système est assez correcte
au démarrage, cela peut prendre jusqu'à 10 minutes avant d'être
synchronisé et des heures voire des jours si celle-ci est décalée.

<p>
<a name="Wireless"></a>
<h2>6.13 - Quels sont les types de cartes Sans Fil supportées par OpenBSD ?</h2>
OpenBSD supporte un certain nombre de chipsets sans fil :
<ul>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=acx&amp;sektion=4">acx(4)</a>
TI ACX100/ACX111. <sup>(NFF) (AP)</sup>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=an&amp;sektion=4">an(4)</a>
Aironet Communications 4500/4800.
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ath&amp;sektion=4">ath(4)</a>
pilote pour Atheros 802.11a/b/g. <sup>(AP)</sup>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=athn&amp;sektion=4">athn(4)</a>
pilote pour Atheros 802.11/a/g/n.
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=atu&amp;sektion=4">atu(4)</a>
Atmel AT76C50x USB 802.11b
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=atw&amp;sektion=4">atw(4)</a>
ADMtek ADM8211.
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=bwi&amp;sektion=4">bwi(4)</a>
Broadcom AirForce 802.11b/g
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=cnw&amp;sektion=4">cnwi(4)</a>
Xircom CreditCard Netwave
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ipw&amp;sektion=4">ipw(4)</a>
Intel PRO/Wireless 2100 802.11b. <sup>(NFF)</sup>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=iwi&amp;sektion=4">iwi(4)</a>
Intel PRO/Wireless 2200BG/2225BG/2915ABG 802.11a/b/g. <sup>(NFF)</sup>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=iwn&amp;sektion=4">iwn(4)</a>
Intel WiFi Link 4965/5100/5300 802.11a/b/g/Draft-N wireless.
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=malo&amp;sektion=4">malo(4)</a>
Marvell Libertas 802.11b/g
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pgt&amp;sektion=4">pgt(4)</a>
Conexant/Intersil Prism GT Full-MAC 802.11a/b/g
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ral&amp;sektion=4">ral(4)</a>
et <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ural&amp;sektion=4">ural(4)</a> 
[USB] Ralink Technology RT25x0 802.11a/b/g. <sup>(AP)</sup>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ray&amp;sektion=4">ray(4)</a>
Raytheon Raylink/WebGear Aviator 802.11FH
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rtw&amp;sektion=4">rtw(4)</a>
Realtek 8180 802.11b. <sup>(AP)</sup>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rum&amp;sektion=4">rum(4)</a>
Ralink Technology RT2501USB. <sup>(AP)</sup>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=run&amp;sektion=4">run(4)</a>
Ralink Technology USB 802.11a/b/g/Draft-N
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=uath&amp;sektion=4">uath(4)</a>
Atheros USB 802.11a/b/g
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=upgt&amp;sektion=4">upgt(4)</a>
Conexant/Intersil PrismGT SoftMAC USB 802.11b/g
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=urtw&amp;sektion=4">urtw(4)</a>
Realtek RTL8187L USB 802.11b/g
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=wi&amp;sektion=4">wi(4)</a>
Prism2/2.5/3. <sup>(AP)</sup>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=wpi&amp;sektion=4">wpi(4)</a>
Intel PRO/Wireless 3945ABG. <sup>(NFF)</sup>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=zyd&amp;sektion=4">zyd(4)</a>
ZyDAS ZD1211/ZD1211B USB 802.11b/g
</ul>

<sup>(AP)</sup> signifie que la carte peut être utilisée comme point
d'accès.<br>
<sup>(NFF)</sup> signifie que la puce nécessite un firmware non-libre
qui ne peut pas être inclus dans OpenBSD.

<p>
Les adaptateurs basés sur ces composants peuvent être utilisés de la
même façon que n'importe quel autre adaptateur réseau pour connecter un
système OpenBSD à un réseau sans fil existant, et sont configurés de
façon standard à l'aide d'
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&amp;sektion=8">ifconfig(8)</a>
(prière de consulter les pages du manuel pour les détails précis).
Certaines cartes peuvent aussi être utilisées en mode "Host-Based
Access Point", ce qui leur permet d'être utilisées comme un point
d'accès sans fil pour votre réseau, intégré à votre pare-feu.

<p>
Notez que pour utiliser les cartes à base de chipset Intel, vous devrez
récupérer les firmwares dont Intel refuse la <a href="faq1.html#ReallyFree">
libre</a> distribution, ce qui empêche qu'ils soient inclus dans OpenBSD.
Lorsque cela est possible, les pages de manuel correspondantes incluent
les informations de contact afin que vous puissiez contacter les bonnes
personnes chez les constructeurs pour leur faire savoir ce que vous
pensez de cette situation ou de les informer sur le produit que vous
avez acheté à la place.

<p>
Une autre méthode pour permettre à un pare-feu OpenBSD de fournir un
accès sans fil est d'utiliser une carte conventionnelle et un point
d'accès externe en mode pont. Cette méthode a l'avantage de vous
permettre de positionner l'antenne là où elle est la plus efficace.

<p>
<h3>Configurer un adaptateur sans-fil</h3>
Votre adaptateur sans-fil peut être configuré de la même manière
qu'avec tous les autres adaptateurs réseau, c'est-à-dire via un fichier
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hostname.if&amp;sektion=5">hostname.if(5)</a>.
Cependant, les autres adaptateurs sont en général plus compliqués
à configurer.

<p>
Un exemple de fichier hostname pourrait être:
<blockquote><pre>
nwid puffyuberalles
wpakey puffyguffy
dhcp
</pre></blockquote>
ou
<blockquote><pre>
inet 10.0.0.157 255.255.255.0
nwid puffyuberalles
wpakey puffyguffy
</pre></blockquote>

Notez que <tt>dhcp</tt> devrait toujours figurer APRÈS les autres lignes
de configuration, étant donné que l'adaptateur réseau ne pourra pas
demander le DHCP avant d'avoir été configuré.

<h3>trunk(4)er un adaptateur réseau</h3>
De nombreux ordinateurs portables ont à la fois un adaptateur sans-fil et
un adaptateur câblé. Parfois, vous voulez vous connecter à votre réseau
à haute vitesse par le câble; d'autres fois, vous préférez utiliser votre
adaptateur sans-fil. Vous ne voudrez probablement pas reconfigurer votre
machine à chaque fois que vous changez de lieu.

<p>
Vous pourriez mettre en place les deux interfaces avec DHCP, mais dans ce
cas-là vous auriez à attendre que l'interface non-utilisée expire lors
du boot de votre système, et les choses seraient plus confuses si vous
aviez les deux ressources disponibles et deviez passer de l'une à l'autre.

<p>
Utiliser des interfaces
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=trunk&amp;sektion=4">trunk(4)</a>
peut vous simplifier la vie.
Les trunk(4)s sont des interfaces virtuelles constituées d'une ou de plusieurs
autres interfaces réseau.
Dans notre cas, nous allons utiliser un portable avec une interface
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=bge&amp;sektion=4">bge0</a>
câblée et une interface
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=iwn&amp;sektion=4">iwn0</a>
sans-fil.
En utilisant ces deux interfaces, nous allons créer une autre interface,
trunk0, puis nous utiliserons DHCP pour obtenir une adresse IP pour cette
interface virtuelle.
Si nous avons un câble disponible, nous voulons l'utiliser; sinon nous
voulons utiliser l'interface sans-fil.

<p>
Pour ce faire, on configure d'abord les deux ports physiques. Étant
donné qu'on ne fait que les assigner à une interface trunk0 combinée,
on ne veut rien faire d'autre avec l'interface câblée que l'activer:
<blockquote><pre>
# <b>cat /etc/hostname.bge0</b>
up
</pre></blockquote>

L'interface sans-fil, cependant, nécessite une configuration un peu
plus approfondie. Elle va devoir s'attacher à notre réseau sans-fil WPA:
<pre><blockquote>
# <b>cat /etc/hostname.iwn0</b>
nwid puffynet
wpakey mysecretkey
up
</pre></blockquote>

À présent, notre interface trunk est définie de la manière suivante:
<pre><blockquote>
# <b>cat /etc/hostname.trunk0</b>
trunkproto failover trunkport bge0
trunkport iwn0
dhcp
</pre></blockquote>

Le trunk est en mode "failover", donc les deux interfaces peuvent
être utilisées, mais si les deux sont disponibles, il préférera
le port bge0, étant donné que c'est le premier que l'on a ajouté
à l'interface trunk.


<p>
<a name="Multipath"></a>
<h2>6.14 - Comment puis-je mettre en oeuvre un routage multi-chemin à
      coût égal ?</h2>

<p>
Le routage multi-chemin à coût égal permet d'avoir de multiples routes
vers le même réseau, tel que la route par défaut (0.0.0.0/0), dans la
table de routage.
Lorsque le noyau recherche une route pour déterminer où acheminer des
paquets destinés à un réseau donné, il pourra alors choisir parmi les
routes à coût égal.
Dans la majorité des cas, un routage multi-chemin est utilisé pour
redonder des connexions "montantes" telles que les connexions vers
Internet.

<p>
La commande
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=route&amp;sektion=8">route(8)</a>
est employée pour ajouter, modifier et supprimer des routes dans la
table de routage.
L'argument <tt>-mpath</tt> est utilisé lors de l'ajout de routes
s'inscrivant dans un politique de routage multi-chemin.

<blockquote><pre>
# <b>route add -mpath default 10.130.128.1</b>
# <b>route add -mpath default 10.132.0.1</b>
</pre></blockquote>

<p>
Vérifiez les routes :

<blockquote><pre>
# <b>netstat -rnf inet | grep default</b>
default     10.130.128.1      UGS       2      134      -     fxp1
default     10.132.0.1        UGS       0      172      -     fxp2
</pre></blockquote>

<p>
À travers cet exemple, nous pouvons voir que la route par défaut pointe
vers 10.130.128.1, accessible par le biais de l'interface fxp1 tandis
que l'autre route par défaut pointe vers 10.132.0.1 qui est accessible
par le biais de l'interface fxp2.

<p>
Étant donné que le fichier
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mygate&amp;sektion=5"
>mygate(5)</a> ne supporte pas encore les routes par défaut
multi-chemin, les commandes précitées devraient être ajoutées à la fin
des fichiers
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hostname.if&amp;sektion=5"
>hostname.if(5)</a> correspondant aux interfaces fxp1 et fxp2. Le
fichier <tt>/etc/mygate</tt> devrait être supprimé.

<dl>
<dt><b>/etc/hostname.fxp1</b></dt>
<dd><tt>!route add -mpath default 10.130.128.1</tt></dd>
<dt><b>/etc/hostname.fxp2</b></dt>
<dd><tt>!route add -mpath default 10.132.0.1</tt></dd>
</dl>

<p>
Enfin, n'oubliez pas d'activer le support de routes multi-chemin à
l'aide de la variable sysctl(3) adéquate.

<blockquote><pre>
# <b>sysctl net.inet.ip.multipath=1</b>
# <b>sysctl net.inet6.ip6.multipath=1</b>
</pre></blockquote>

<p>
Assurez-vous d'éditer
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl.conf&amp;sektion=5"
>sysctl.conf(5)</a>
pour rendre les modifications permanentes.

<p>
Maintenant essayez d'effectuer un traceroute vers des destinations
différentes.
Le noyau partagera le trafic entre les différentes routes multi-chemin.

<blockquote><pre>
# <b>traceroute -n 154.11.0.4</b>
traceroute to 154.11.0.4 (154.11.0.4), 64 hops max, 60 byte packets
 1  10.130.128.1  19.337 ms  18.194 ms  18.849 ms
 2  154.11.95.170  17.642 ms  18.176 ms  17.731 ms
 3  154.11.5.33  110.486 ms  19.478 ms  100.949 ms
 4  154.11.0.4  32.772 ms  33.534 ms  32.835 ms

# <b>traceroute -n 154.11.0.5</b>
traceroute to 154.11.0.5 (154.11.0.5), 64 hops max, 60 byte packets
 1  10.132.0.1  14.175 ms  14.503 ms  14.58 ms
 2  154.11.95.38  13.664 ms  13.962 ms  13.445 ms
 3  208.38.16.151  13.964 ms  13.347 ms  13.788 ms
 4  154.11.0.5  30.177 ms  30.95 ms  30.593 ms
</pre></blockquote>

<p>
Pour de plus amples informations concernant la manière de choisir une
route, veuillez vous référer à la
<a href="http://www.ietf.org/rfc/rfc2992.txt">RFC2992</a>, "Analysis of
an Equal-Cost Multi-Path Algorithm".

<p>
Il est utile de noter que si une interface utilisée par une route
multi-chemin tombe (perte de signal par exemple), le noyau 
acheminera tout de même des paquets à travers cette interface. Ces
paquets seront bien entendus perdus.
Il est hautement recommandé d'utiliser
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifstated&amp;sektion=8"
>ifstated(8)</a> pour vérifier l'état des interfaces et ajuster la table
de routage si besoin.


<p>
<font color="#0000e0">
<a href="index.html">[Index de la FAQ]</a>
<a href="faq5.html">[Section 5 - Construire le Système à partir des Sources]</a>
<a href="faq7.html">[Section 7 - Contrôles du clavier et de l'affichage]</a></font>

<p>
<hr>
<a href="index.html"><img height="24" width="24" src="../../images/back.gif"
border="0" alt="[back]"></a>
<a href="mailto:www@@openbsd.org">www@@openbsd.org</a>
<br>
<small>
<!--
Originally [OpenBSD: faq6.html,v 1.313 ]<br>
$Translation: faq6.html,v 1.150 2013/12/05 17:27:53 rustybsd Exp $<br>
-->
$OpenBSD: faq6.html,v 1.122 2013/12/06 20:52:46 ajacoutot Exp $
</small>

</body>
</html>
@


1.122
log
@Sync with Steelix CVS
@
text
@d2489 1
a2489 1
$OpenBSD$
@


1.121
log
@Sync with Steelix CVS
@
text
@d1789 2
a1790 2
<h3>Est-il possible de démarrer d'autres noyaux que <tt>bsd.rd</tt> en
utilisant PXE ?</h3>
d2486 2
a2487 2
Originally [OpenBSD: faq6.html,v 1.311 ]<br>
$Translation: faq6.html,v 1.149 2013/11/16 12:13:13 rustybsd Exp $<br>
@


1.120
log
@Sync with Steelix CVS
@
text
@d771 1
a771 1
<tt>/var/log/message</tt>.
d2486 2
a2487 2
Originally [OpenBSD: faq6.html,v 1.310 ]<br>
$Translation: faq6.html,v 1.148 2013/11/01 16:50:38 rustybsd Exp $<br>
@


1.119
log
@Sync with Steelix CVS
@
text
@d1780 1
a1780 1
    OpenBSD 5.3 (RAMDISK_CD) #49: Tue Mar 12 18:50:37 MDT 2013
d2486 2
a2487 2
Originally [OpenBSD: faq6.html,v 1.309 ]<br>
$Translation: faq6.html,v 1.147 2013/10/19 05:37:17 rustybsd Exp $<br>
@


1.118
log
@Sync with Steelix CVS
@
text
@d27 1
a27 1
<!-- UNCOMMENT ONLY WHEN THE FILE IS OUT OF SYNC -->
d40 1
a40 1
<!-- -->
d246 2
d2271 88
d2486 2
a2487 2
Originally [OpenBSD: faq6.html,v 1.307 ]<br>
$Translation: faq6.html,v 1.146 2013/08/25 18:18:02 rustybsd Exp $<br>
@


1.117
log
@Sync with Steelix CVS
@
text
@d1394 1
a1394 1
<h3>Exemple d'application d'un pont</h3>
d1473 85
d1759 1
a1759 1
    >> OpenBSD/i386 PXEBOOT 3.17
d1768 1
a1768 1
    >> OpenBSD/i386 PXEBOOT 3.17
d1776 3
a1778 3
    Copyright (c) 1995-2012 OpenBSD.  All rights reserved.  http://www.OpenBSD.org
    
    OpenBSD 5.2 (RAMDISK_CD) #207: Wed Aug  1 10:19:00 MDT 2012
d2192 1
a2192 1
pilote pour Atheros 80211/a/g/n.
a2196 2
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=awi&amp;sektion=4">awi(4)</a>
AMD 802.11 PCnet Mobile.
d2396 2
a2397 2
Originally [OpenBSD: faq6.html,v 1.304 ]<br>
$Translation: faq6.html,v 1.145 2013/07/15 06:25:31 rustybsd Exp $<br>
@


1.116
log
@Sync with Steelix CVS
@
text
@d27 1
a27 1
<!-- UNCOMMENT ONLY WHEN THE FILE IS OUT OF SYNC
d36 1
a36 1
Si vous souhaitez contribuez à l'effort de traduction,
d40 2
a41 1
-->
d2314 1
a2314 1
$Translation: faq6.html,v 1.144 2013/03/07 13:11:20 rustybsd Exp $<br>
@


1.115
log
@Sync with Steelix CVS
@
text
@d2263 1
a2263 1
Le noyau partagera le traffic entre les différentes routes multi-chemin.
d2313 1
a2313 1
$Translation: faq6.html,v 1.143 2013/01/12 16:30:13 rustybsd Exp $<br>
@


1.114
log
@Sync with Steelix CVS
@
text
@d108 1
a108 1
href="http://www.rfc-editor.org/rfc.html">lecture des RFCs</a>. A priori, vous
d169 1
a169 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=fxp&amp;sektion=4">fxp(4)</a> .
d364 1
a364 1
Name" - Nom d'Hôte Pleinement Qualifié") dans le fichier <a
d595 1
a595 1
une gestion de la bande passante et une prioritarisation des paquets
d2313 1
a2313 1
$Translation: faq6.html,v 1.142 2012/11/04 16:06:42 rustybsd Exp $<br>
@


1.113
log
@Sync with Steelix CVS
@
text
@d1625 4
a1628 12
Vous devrez aussi activer le service <a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=tftpd&amp;sektion=8">tftpd(8)
</a>. Pour ce faire, il suffit de configurer <a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=inetd&amp;sektion=8">inetd(8)
</a>. L'installation standard d'OpenBSD fournit une ligne d'exemple dans
<tt>inetd.conf</tt> qui devrait vous satisfaire :
<pre>
    #tftp  dgram   udp  wait  root  /usr/libexec/tftpd   tftpd -s /tftpboot
</pre>

Retirez simplement le caractère '#' et envoyez à inetd(8) un signal -HUP
afin que celui-ci relise son fichier <tt>/etc/inetd.conf</tt>. Les
d1673 1
a1673 1
    >> OpenBSD/i386 PXEBOOT 3.16
d1682 1
a1682 1
    >> OpenBSD/i386 PXEBOOT 3.16
d1692 1
a1692 1
    OpenBSD 5.1 (RAMDISK_CD) #95: Sun Feb 12 10:02:21 MST 2012
d2312 2
a2313 2
Originally [OpenBSD: faq6.html,v 1.302 ]<br>
$Translation: faq6.html,v 1.141 2012/10/17 11:11:24 rustybsd Exp $<br>
@


1.112
log
@Sync with Steelix CVS
@
text
@d184 1
a184 1
        inet 192.168.1.34 netmask 0xffffff00 broadcast 192.168.1.255
d2320 2
a2321 2
Originally [OpenBSD: faq6.html,v 1.300 ]<br>
$Translation: faq6.html,v 1.140 2012/08/22 16:29:02 rustybsd Exp $<br>
@


1.111
log
@Sync with Steelix CVS
@
text
@d1163 2
a1164 1
nfsd_flags=""
d1230 5
a1234 7
Les arguments par défauts passés à nfsd dans
<a href= "http://www.openbsd.org/cgi-bin/man.cgi?query=rc.conf&amp;sektion=8">rc.conf(8)</a>
activent les connexions TCP (-t) et UDP (-u) et autorisent 4 instances (-n)
de nfsd à être exécutées. Vous devriez paramétrer un nombre approprié
d'instances de serveur NFS pour gérer le maximum de connexions
simultanées que vous souhaitez être en mesure de traiter en ajustant
<tt>nfsd_flags</tt> à rc.conf.local.
d2320 2
a2321 2
Originally [OpenBSD: faq6.html,v 1.299 ]<br>
$Translation: faq6.html,v 1.139 2012/08/13 07:27:57 rustybsd Exp $<br>
@


1.110
log
@Sync with Steelix CVS
@
text
@d1162 2
a1163 2
portmap=YES
nfs_server=YES
d1234 2
a1235 2
simultanées que vous souhaitez être en mesure de traiter en ajoutant
nfsd_flags à rc.conf.local.
d2321 2
a2322 2
Originally [OpenBSD: faq6.html,v 1.298 ]<br>
$Translation: faq6.html,v 1.138 2012/06/07 07:30:25 rustybsd Exp $<br>
@


1.109
log
@Sync with Steelix CVS
@
text
@d64 1
a64 1
<li><a href="#DHCPserver">6.4.2 - Server DHCP</a>
d283 1
a283 1
Vous pouvez également spécifier le type de media d'une connexion
d293 1
a293 1
ce n'est pour des besoins spécifiques, la configuration du type de media
d538 1
a538 1
alias. A la différence d'autres systèmes d'exploitation, OpenBSD ne s'y
d939 1
a939 1
A la place des méthodes traditionnelles de connexion, certains FAI
d1173 1
a1173 1
Ce serveur est destiné à fournir le service FS uniquement aux clients de
d1211 1
a1211 1
Une autre remarque sécurité importante : ne vous contentez pas d'ajouter
d1311 1
a1311 1
Ceci est du au fait que le serveur utilise les identifiants de
d1387 1
a1387 1
l'interface aura deux modes d'opération, l'un faisant parti du pont et
d1559 1
a1559 1
que d'un disque dur, une disquette ou un CD-ROM. A l'origine, cette
d2322 1
a2322 1
$Translation: faq6.html,v 1.137 2012/05/25 04:53:55 rustybsd Exp $<br>
@


1.108
log
@Sync with Steelix CVS
@
text
@d375 1
a375 1
A présent, vous pouvez soit redémarrer, soit lancer le script
d390 1
a390 1
routes sont déjà présentes dans la table de routage du noyau. A présent,
d702 1
a702 1
A présent, votre fichier resolv.conf(5) devrait inclure "lookup file bind"
d1081 1
a1081 1
<i>TRES PEU DE personne ont besoin d'ajutser un paramétre réseau !</i>
d1376 1
a1376 1
est un lien entre deux (ou plusieurs) réseaux séparés. A
d1379 1
a1379 1
semblent n'en faire qu'un de chaque côté du pont. Le pont ne transfèrera
d1415 1
a1415 1
présentes sur le reste du réseau. A présent, voyons comment arriver à ce
d1450 1
a1450 1
A présent, il nous faut paramétrer le pont. Un pont est initialisé par
d1542 2
a1543 2
IPX ou NETBEUI) de passer oûtre votre filtre. Dans certaines
situations, cela peut-être important et vous devez savoir qu'un pont
d1686 1
a1686 1
A présent, vous obtenez l'invite de commandes standard d'OpenBSD. Si vous
d1893 1
a1893 1
vide l'adresse de l'interface physique spécifiée par le mot-clef `carpdev'.
d1958 1
a1958 1
A présent nous avons deux groupes CARP avec la même adresse IP. Chaque
d2322 1
a2322 1
$Translation: faq6.html,v 1.136 2012/05/02 12:38:08 rustybsd Exp $<br>
@


1.107
log
@Sync with Steelix CVS
@
text
@d1699 1
a1699 1
    Copyright (c) 1995-2011 OpenBSD.  All rights reserved.  http://www.OpenBSD.org
d1701 1
a1701 1
    OpenBSD 5.0 (RAMDISK_CD) #36: Wed Aug 17 10:27:31 MDT 2011
d2321 2
a2322 2
Originally [OpenBSD: faq6.html,v 1.297 ]<br>
$Translation: faq6.html,v 1.135 2012/04/25 09:40:59 rustybsd Exp $<br>
@


1.106
log
@Sync with Steelix CVS
@
text
@d11 1
a11 1
<meta name= "copyright"     content= "This document copyright 1998-2011 by OpenBSD.">
d719 2
a720 3
ligne <tt>dhcpd_flags="<i>interface</i>"</tt>, remplacez <tt><i>interface</i></tt> avec
la liste des interfaces que le serveur écoute.

d722 1
a722 1
     # <b>echo 'dhcpd_flags="xl1 xl2 xl3"' &gt;&gt;/etc/rc.conf.local</b>
d725 6
d761 2
a762 2
     # <b>touch /var/db/dhcpd.leases</b>
     # <b>dhcpd fxp0</b>
d765 4
a768 8
<p>
La ligne invoquant <tt>touch</tt> est nécessaire afin de créer un
fichier <tt>dhcpd.leases</tt> vide avant que dhcpd(8) ne démarre.
Les <a href="faq10.html#rc">scripts de démarrage</a> d'OpenBSD se
chargeront de créer ce fichier au boot, mais si vous lancez dhcpd(8)
manuellement, vous devez au préalable créer ce fichier.
<tt>fxp0</tt> représente l'interface sur laquelle vous voulez
répondre aux requêtes DHCP.
d1223 3
a1225 4
# <b>/usr/sbin/portmap</b>
# <b>echo -n &gt;/var/db/mountdtab</b>
# <b>/sbin/mountd</b>
# <b>/sbin/nfsd -tun 4</b>
d1229 7
a1235 5
Les arguments passés à nfsd autorisent les connexions TCP (-t) et UDP
(-u) et autorisent aussi 4 instances (-n) de nfsd en exécution.
Vous devriez paramétrer un nombre approprié d'instances de serveur NFS
pour gérer le maximum de connexions simultanées que vous souhaitez être
en mesure de traiter.
d1248 1
a1248 1
# <b>kill -HUP `cat /var/run/mountd.pid`</b>
d2321 2
a2322 2
Originally [OpenBSD: faq6.html,v 1.296 ]<br>
$Translation: faq6.html,v 1.134 2012/04/19 17:52:07 rustybsd Exp $<br>
@


1.105
log
@Sync with Steelix CVS
@
text
@d8 2
a9 2
<meta name= "description"   content= "the OpenBSD FAQ page">
<meta name= "keywords"      content= "openbsd,faq">
d11 1
a11 1
<meta name= "copyright"     content= "This document copyright 1998-2010 by OpenBSD.">
d98 1
a98 1
href="http://www.3com.com/other/pdfs/infra/corpinfo/en_US/501302.pdf">
d173 5
a177 1
lo0: flags=8049&lt;UP,LOOPBACK,RUNNING,MULTICAST&gt; mtu 33224
a178 3
        inet6 ::1 prefixlen 128
        inet6 fe80::1%lo0 prefixlen 64 scopeid 0x5
lo1: flags=8008&lt;LOOPBACK,MULTICAST&gt; mtu 33224
d180 2
a181 1
        address: 00:04:ac:dd:39:6a
d184 1
a184 1
        inet 10.0.0.38 netmask 0xffffff00 broadcast 10.0.0.255
d186 7
a192 22
pflog0: flags=0&lt;&gt; mtu 33224
pfsync0: flags=0&lt;&gt; mtu 2020
sl0: flags=c010&lt;POINTOPOINT,LINK2,MULTICAST&gt; mtu 296
sl1: flags=c010&lt;POINTOPOINT,LINK2,MULTICAST&gt; mtu 296
ppp0: flags=8010&lt;POINTOPOINT,MULTICAST&gt; mtu 1500
ppp1: flags=8010&lt;POINTOPOINT,MULTICAST&gt; mtu 1500
tun0: flags=10&lt;POINTOPOINT&gt; mtu 3000
tun1: flags=10&lt;POINTOPOINT&gt; mtu 3000
enc0: flags=0&lt;&gt; mtu 1536
bridge0: flags=0&lt;&gt; mtu 1500
bridge1: flags=0&lt;&gt; mtu 1500
vlan0: flags=0&lt;&gt; mtu 1500
        address: 00:00:00:00:00:00
vlan1: flags=0&lt;&gt; mtu 1500
        address: 00:00:00:00:00:00
gre0: flags=9010&lt;POINTOPOINT,LINK0,MULTICAST&gt; mtu 1450
carp0: flags=0&lt;&gt; mtu 1500
carp1: flags=0&lt;&gt; mtu 1500
gif0: flags=8010&lt;POINTOPOINT,MULTICAST&gt; mtu 1280
gif1: flags=8010&lt;POINTOPOINT,MULTICAST&gt; mtu 1280
gif2: flags=8010&lt;POINTOPOINT,MULTICAST&gt; mtu 1280
gif3: flags=8010&lt;POINTOPOINT,MULTICAST&gt; mtu 1280
d198 1
a198 1
ifconfig(8)</a> nous fourni ici beaucoup plus d'informations que nécessaire.
d200 1
a200 1
précédent, la carte est déjà configurée. Ceci est évident de part la
d216 7
d229 1
a229 4
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=enc&amp;sektion=4">enc</a>
 - Interface d'encapsulation
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=bridge&amp;sektion=4">bridge
</a>
d233 2
d241 2
d244 1
a244 1
 -  Interface Ethernet Virtuelle
d248 4
a251 4
L'interface est configurée au démarrage en utilisant les fichiers <a 
href="http://www.openbsd.org/cgi-bin/man.cgi?query=hostname.if&amp;sektion=5">/etc/hostname.<i>if</i>(5)</a>
où <i>if</i> est remplacé par le nom complet de votre interface, c'est à
dire dans notre exemple: <i>/etc/hostname.fxp0</i>.
d322 1
a322 1
même accessible AVANT que la passerelle par défaut n'est été elle-même
d327 1
d359 1
d409 1
d495 18
a512 11
A présent, modifiez les routes sur les hôtes aux deux extrémités. Il
existe beaucoup d'autres usages d'OpenBSD en tant que routeur avec
l'aide de programmes comme <a href="http://www.openbgpd.org/">OpenBGPD</a>
(qui fait partie du projet OpenBSD), <a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=routed&amp;sektion=8">
routed(8)</a>, <a href="http://sourceforge.net/projects/mrt">mrtd</a>, <a
href="http://www.zebra.org">zebra </a> et <a
href="http://www.quagga.net">quagga</a>. Sous OpenBSD, zebra et mrtd
sont disponibles en tant que ports. OpenBGPD et routed sont inclus dans
le système de base. OpenBSD supporte différentes interfaces T1, HSSI,
ATM, FDDI, Ethernet et série (PPP/SLIP).
a1070 1
<!-- XXXrelease -->
d1241 1
a1241 1
alors que NFS est en cours d'éxecution, vous avez juste besoin d'en
d1311 1
a1311 1
Etant donné que l'utilisateur nobody n'a pas de permissions d'accès au
d1367 1
a1367 1

d1680 1
a1680 1
    >> OpenBSD/i386 PXEBOOT 3.15
d1689 1
a1689 1
    >> OpenBSD/i386 PXEBOOT 3.15
d1699 1
a1699 1
    OpenBSD 4.9 (RAMDISK_CD) #329: Wed Mar  2 07:27:01 MST 2011
d1715 1
d2101 1
a2102 1

d2162 1
a2162 1
qui ne peut pas être inclu dans OpenBSD.
d2191 1
d2230 1
a2230 1
A travers cet exemple, nous pouvons voir que la route par défaut pointe
d2236 1
a2236 1
Etant donné que le fichier
d2319 2
a2320 2
Originally [OpenBSD: faq6.html,v 1.290 ]<br>
$Translation: faq6.html,v 1.133 2011/05/07 08:16:36 benoit Exp $<br>
@


1.104
log
@Sync with Steelix CVS
@
text
@d1676 1
a1676 1
    >> OpenBSD/i386 PXEBOOT 2.03
d1685 1
a1685 1
    >> OpenBSD/i386 PXEBOOT 2.03
d1693 3
a1695 3
    Copyright (c) 1995-2010 OpenBSD.  All rights reserved.  http://www.OpenBSD.org

    OpenBSD 4.8 (RAMDISK_CD) #89: Mon Aug 16 09:24:20 MDT 2010
d2313 2
a2314 2
Originally [OpenBSD: faq6.html,v 1.289 ]<br>
$Translation: faq6.html,v 1.132 2010/11/07 09:27:23 benoit Exp $<br>
@


1.103
log
@Sync with Steelix CVS
@
text
@d1076 1
a1076 1
<i>TRES PEU DE personne ont besoin de cela !</i>
d1079 1
a1079 44
<h3>6.6.1 - Comment configurer le noyau pour avoir un plus grand nombre d'essais
et augmenter le délai d'expiration des sessions TCP ?</h3>

<p>
Généralement, vous utiliserez ceci en cas de problèmes de routage ou de
connexion. Bien sûr, pour que cette configuration soit la plus
efficace, les deux extrémités de la connexion doivent utiliser des
valeurs similaires.

<p>
Pour optimiser ceci, utilisez <tt>sysctl</tt> et augmentez les valeurs
de :

<pre>
net.inet.tcp.keepinittime
net.inet.tcp.keepidle
net.inet.tcp.keepintvl
</pre>

<p>
Avec sysctl -a, vous pouvez voir les valeurs courantes de ces paramètres
(ainsi que beaucoup d'autres). Pour en changer un, tapez par exemple
<tt>sysctl net.inet.tcp.keepidle=28800</tt>.

<p>
<h3>6.6.2 - Comment activer les émissions ("broadcasts") dirigées
?</h3>

<p>
Normalement, vous ne devriez pas utiliser ceci. Cette option permet à
quelqu'un de diriger le trafic vers la ou les adresses "broadcast" des
réseaux sur lesquels vous êtes connecté si vous utilisez OpenBSD en tant
que routeur.

<p>
Dans certaines situations, sur des réseaux fermés, cette option peut-
être utile, surtout lors de l'utilisation de vieilles implémentations du
protocole NetBIOS. Il s'agit d'un autre paramètre sysctl. <tt>sysctl net.inet.ip.directed-
broadcast=1</tt> active cette option. Lisez la section sur les <a
href="http://www.netscan.org">"attaques de type smurf"</a> si vous voulez savoir
pourquoi cette option est désactivée par défaut.

<p>
<h3>6.6.3 - Je ne veux pas que le noyau alloue dynamiquement un port
d1083 1
a1083 1
Il existe également un paramètre sysctl pour cela. D'après 
a1102 17
<h3>6.6.4 - Comment augmenter les performances sur les liens à grande
vitesse et à fort trafic ?</h3>

Si vous avez des soucis de performances sur des liens WAN à grande
vitesse lorsque vous transférez beaucoup de données, vous devriez
pouvoir optimiser ces performances en éditant les valeurs sysctls
suivantes :
<blockquote><pre>
net.inet.tcp.recvspace
net.inet.tcp.sendspace
</pre></blockquote>

Essayez une valeur comme 65536 au lieu de 16384. Notez que très peu de
personnes verront un gain réel. N'ajustez ces valeurs que si vous
obtenez des performances en deçà de vos attentes.

<p>
d1695 1
a1695 1
    OpenBSD 4.7 (RAMDISK_CD) #353: Wed Mar 17 21:02:53 MST 2010
d2313 2
a2314 2
Originally [OpenBSD: faq6.html,v 1.286 ]<br>
$Translation: faq6.html,v 1.130 2010/09/25 09:06:40 benoit Exp $<br>
@


1.102
log
@Sync with Steelix CVS
@
text
@d1506 2
a1507 2
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=bridgename.if&amp;sektion=5">
<tt>bridgename.bridge0</tt></a>. Dans ma situation, voici un exemple
d1511 1
a1511 1
$ <b>cat /etc/bridgename.bridge0</b>
d1578 2
a1579 2
href="http://www.openbsd.org/cgi-bin/man.cgi?query=brconfig&amp;sektion=8">
brconfig(8)</a> qui peut aussi être utilisée pour créer un
d1592 1
a1592 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=brconfig&amp;sektion=8"> brconfig(8)</a>
d1594 2
a1595 2
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=bridgename.if&amp;sektion=5">
bridgename.bridge0</a>, vous pouvez empêcher le trafic non-IP (comme
d2373 2
a2374 2
Originally [OpenBSD: faq6.html,v 1.284 ]<br>
$Translation: faq6.html,v 1.129 2010/05/23 09:32:53 benoit Exp $<br>
@


1.101
log
@Sync with Steelix CVS
@
text
@d11 1
a11 1
<meta name= "copyright"     content= "This document copyright 1998-2009 by OpenBSD.">
d225 1
a225 2
<li><a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=lo&amp;sektion=4">lo</a>
d227 1
a227 2
<li><a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflog&amp;sektion=4">pflog</a>
d229 1
a229 2
<li><a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=sl&amp;sektion=4">sl</a>
d231 1
a231 2
<li><a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=ppp&amp;sektion=4">ppp</a>
d233 1
a233 2
<li><a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=tun&amp;sektion=4">tun</a>
d235 1
a235 2
<li><a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=enc&amp;sektion=4">enc</a>
d237 1
a237 2
<li><a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=bridge&amp;sektion=4">bridge
d240 1
a240 2
<li><a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=vlan&amp;sektion=4">vlan</a>
d242 1
a242 2
<li><a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=gre&amp;sektion=4">gre</a>
d244 1
a244 2
<li><a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=gif&amp;sektion=4">gif</a>
d246 1
a246 2
<li><a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=carp&amp;sektion=4">carp</a>
d248 2
d1753 1
a1753 1
    Copyright (c) 1995-2009 OpenBSD.  All rights reserved.  http://www.OpenBSD.org
d1755 1
a1755 1
    OpenBSD 4.6 (RAMDISK_CD) #53: Thu Jul  9 21:41:35 MST 2009
d2167 2
d2373 2
a2374 2
Originally [OpenBSD: faq6.html,v 1.283 ]<br>
$Translation: faq6.html,v 1.128 2010/05/16 20:16:02 gapz Exp $<br>
@


1.100
log
@Sync with Steelix CVS
@
text
@d724 1
a724 1
la liste des interfaces que le serveur <b>écoute</b>.
d2381 1
a2381 1
$Translation: faq6.html,v 1.127 2010/03/19 05:24:43 benoit Exp $<br>
@


1.99
log
@Sync with Steelix CVS
@
text
@d587 1
a587 1
        inet 192.168.0.2  netmask 0xffffff00 broadcast 192.168.0.255
d665 1
a665 1
également supprimer <tt>hostname</tt> ainsi que d'autres options.
d2380 2
a2381 2
Originally [OpenBSD: faq6.html,v 1.282 ]<br>
$Translation: faq6.html,v 1.126 2010/02/05 12:55:21 benoit Exp $<br>
@


1.98
log
@Sync with Steelix CVS
@
text
@d1874 1
a1874 9
La seconde, <tt>net.inet.carp.arpbalance</tt>, est utilisée pour la
répartition de charge ("load balancing"). Si cette fonctionnalité est
activée, CARP effectue une empreinte (hachage) de l'IP originaire de la
requête. Cette empreinte est ensuite utilisée pour sélectionner à partir
du groupe l'hôte virtuel qui prendra en charge cette requête. Cette
fonctionnalité est désactivée par défaut.

<p>
La troisième, <tt>net.inet.carp.log</tt>, enregistre les changement d'états
d1879 1
a1879 1
La quatrième, <tt>net.inet.carp.preempt</tt> active la sélection
a2025 9
Tout ce qu'il nous reste à faire désormais est d'activer la variable
contrôlant la répartition de charge sur les deux machines, comme nous
l'avons vu précédemment :

<blockquote><pre>
# <b>sysctl net.inet.carp.arpbalance=1</b>
</pre></blockquote>

<p>
d2380 2
a2381 2
Originally [OpenBSD: faq6.html,v 1.281 ]<br>
$Translation: faq6.html,v 1.125 2009/11/30 10:59:51 benoit Exp $<br>
@


1.97
log
@Sync with Steelix CVS
@
text
@d1762 1
a1762 1
    Copyright (c) 1995-2008 OpenBSD.  All rights reserved.  http://www.OpenBSD.org
d1764 1
a1764 1
    OpenBSD 4.5 (RAMDISK_CD) #1112: Sat Feb 28 15:06:26 MST 2009
d2397 2
a2398 2
Originally [OpenBSD: faq6.html,v 1.280 ]<br>
$Translation: faq6.html,v 1.124 2009/10/25 20:06:05 benoit Exp $<br>
@


1.96
log
@Sync with Steelix CVS
@
text
@d2228 1
a2228 1
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=&amp;sektion=">urtw(4)</a>
d2397 2
a2398 2
Originally [OpenBSD: faq6.html,v 1.279 ]<br>
$Translation: faq6.html,v 1.123 2009/10/19 14:26:03 benoit Exp $<br>
@


1.95
log
@Sync with Steelix CVS
@
text
@a2227 1
<!-- XXX for 4.6
a2229 1
-->
d2397 2
a2398 2
Originally [OpenBSD: faq6.html,v 1.278 ]<br>
$Translation: faq6.html,v 1.122 2009/09/09 05:49:29 benoit Exp $<br>
@


1.94
log
@Sync with Steelix CVS
@
text
@d1135 2
a1136 3
Il existe également un paramètre sysctl pour cela. D'après <a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&amp;sektion=8">
sysctl(8)</a> :
d1138 1
a1138 1
<pre>
d1140 5
a1144 1
par le noyau. Ceci peut être utile afin d'éviter l'appropriation d'un
a1147 2
 #  <b>sysctl net.inet.tcp.baddynamic=749,750,751,760,761,871</b>

d1150 3
a1152 3
 #  <b>sysctl net.inet.tcp.baddynamic=+748</b>
 #  <b>sysctl net.inet.tcp.baddynamic=-871</b>
</pre>
d2399 2
a2400 2
Originally [OpenBSD: faq6.html,v 1.277 ]<br>
$Translation: faq6.html,v 1.121 2009/07/03 22:58:00 benoit Exp $<br>
@


1.93
log
@Sync with Steelix CVS
@
text
@d852 4
a855 4
set log Phase Chat LCP IPCP CCP tun command     
set device /dev/cua01                           
set speed 115200     
set dial "ABORT BUSY ABORT NO\\sCARRIER TIMEOUT 5 \"\" AT OK-AT-OK ATE1Q0 OK \\dATDT\\T TIMEOUT 40 CONNECT"
d887 6
a892 6
set phone 1234567   
set login "ABORT NO\\sCARRIER TIMEOUT 5 ogin:--ogin: ppp word: ppp"
set timeout 120   
set ifaddr 10.0.0.1/0 10.0.0.2/0 255.255.255.0 0.0.0.0
add default HISADDR 
enable dns
d948 8
a955 8
set phone 1234567   
set authname ppp
set authkey ppp
set login
set timeout 120   
set ifaddr 10.0.0.1/0 10.0.0.2/0 255.255.255.0 0.0.0.0
add default HISADDR 
enable dns
d2398 2
a2399 2
Originally [OpenBSD: faq6.html,v 1.276 ]<br>
$Translation: faq6.html,v 1.120 2009/06/04 13:59:04 benoit Exp $<br>
@


1.92
log
@Sync with Steelix CVS
@
text
@d1881 3
a1883 2
La troisième, <tt>net.inet.carp.log</tt>, enregistre les erreurs CARP.
Désactivée par défaut.
d2398 2
a2399 2
Originally [OpenBSD: faq6.html,v 1.275 ]<br>
$Translation: faq6.html,v 1.119 2009/04/30 23:04:33 benoit Exp $<br>
@


1.91
log
@Sync with Steelix CVS -- we are back to normal operation!
@
text
@d1744 1
a1744 1
    >> OpenBSD/i386 PXEBOOT 1.00
d1753 1
a1753 1
    >> OpenBSD/i386 PXEBOOT 1.00
d1763 1
a1763 1
    OpenBSD 4.4 (RAMDISK_CD) #857: Tue Aug 12 17:31:49 MDT 2008
d2397 2
a2398 2
Originally [OpenBSD: faq6.html,v 1.274 ]<br>
$Translation: faq6.html,v 1.118 2009/04/13 16:28:45 gapz Exp $<br>
@


1.90
log
@Sync with Steelix CVS
@
text
@d511 1
a511 1
routed(8)</a>, <a href="http://www.mrtd.net">mrtd</a>, <a
d723 1
a723 1
ligne <tt>dhcpd_flags="interface"</tt>, remplacez <tt><i>interface</i></tt> avec
d1077 1
a1077 1
L'un des objectifs de OpenBSD est d'avoir le système <i>Just Work</ i> pour la grande
d1082 1
a1082 1
<i>uniquement</ i> si vous avez un problème.
d2185 2
a2186 2
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=awi&amp;sektion=4">awi(4)</a>
AMD 802.11 PCnet Mobile.
d2189 4
a2192 2
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=wi&amp;sektion=4">wi(4)</a>
Prism2/2.5/3. <sup>(AP)</sup>
d2195 8
a2202 2
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ath&amp;sektion=4">ath(4)</a>
driver for Atheros IEEE 802.11a/b/g. <sup>(AP)</sup>
d2204 7
a2210 5
Intel PRO/Wireless 2200BG/2225BG/2915ABG IEEE 802.11a/b/g. <sup>(NFF)</sup>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ipw&amp;sektion=4">ipw(4)</a>
Intel PRO/Wireless 2100 IEEE 802.11b. <sup>(NFF)</sup>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=atu&amp;sektion=4">atu(4)</a>
Atmel AT76C50x USB IEEE 802.11b. 
d2212 4
a2215 2
and <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ural&amp;sektion=4">ural(4)</a> [USB]
Ralink Technology RT25x0 IEEE 802.11a/b/g. <sup>(AP)</sup>
d2217 1
a2217 6
Realtek 8180 IEEE 802.11b. <sup>(AP)</sup>

<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=acx&amp;sektion=4">acx(4)</a>
TI ACX100/ACX111. <sup>(NFF) (AP)</sup>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pgt&amp;sektion=4">pgt(4)</a>
Conexant/Intersil Prism GT Full-MAC. <sup>(NFF) (AP)</sup>
d2220 12
d2234 2
a2235 2
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=uath&amp;sektion=4">uath(4)</a>
Atheros AR5005UG/AR5005UX USB2.0 (en cours de développement). <sup>(NFF)</sup>
d2397 2
a2398 2
Originally [OpenBSD: faq6.html,v 1.272 ]<br>
$Translation: faq6.html,v 1.115 2009/01/31 06:36:12 benoit Exp $<br>
@


1.89
log
@Sync with Steelix CVS
@
text
@d11 1
a11 1
<meta name= "copyright"     content= "This document copyright 1998-2008 by OpenBSD.">
d2378 2
a2379 2
Originally [OpenBSD: faq6.html,v 1.270 ]<br>
$Translation: faq6.html,v 1.113 2008/11/29 09:58:53 benoit Exp $<br>
@


1.88
log
@Sync with Steelix CVS
@
text
@d723 2
a724 2
ligne <tt>dhcpd_flags=""</tt>. Placez le nom des interfaces sur lesquelles vous
souhaitez que le serveur <b>écoute</b>, dans le fichier <tt>/etc/dhcpd.interfaces</tt>.
d727 1
a727 1
     # <b>echo xl1 xl2 xl3 &gt;/etc/dhcpd.interfaces</b>
d1077 10
d1761 1
a1761 1
    Copyright (c) 1995-2007 OpenBSD.  All rights reserved.  http://www.OpenBSD.org
d1763 1
a1763 1
    OpenBSD 4.2 (RAMDISK_CD) #468: Tue Aug 28 11:02:17 MDT 2007
d2378 2
a2379 2
Originally [OpenBSD: faq6.html,v 1.265 ]<br>
$Translation: faq6.html,v 1.112 2008/03/26 16:04:49 gapz Exp $<br>
@


1.87
log
@sync with Steelix CVS
@
text
@d249 1
a249 1
 - Interface d'encapsulation EEE 802.1Q
d1200 1
a1200 1
Les services suivants doiventnt être activés et mis en route sur 
d1865 1
a1865 1
activée, CARP effectue une empreinte (hashage) de l'IP originaire de la
d2369 1
a2369 1
$Translation: faq6.html,v 1.111 2008/03/18 15:20:58 ajacoutot Exp $<br>
@


1.86
log
@Sync with Steelix CVS
@
text
@d11 1
a11 1
<meta name= "copyright"     content= "This document copyright 1998-2007 by OpenBSD.">
d143 1
a143 2
fxp0 at pci0 dev 10 function 0 "Intel 82557" rev 0x0c: irq 5, address
00:02:b3:2b:10:f7
d172 1
a172 1
$ <strong>ifconfig</strong>
d216 1
a216 1
<strong>UP</strong> et <strong>RUNNING</strong> sont également présents.
d286 1
a286 1
$ <strong>cat /etc/hostname.fxp0</strong>
d305 1
a305 1
Bien entendu, vous ne devriez jamais forcer le mode full duplex à moins
d310 1
a310 1
lorsque cela est rendu nécessaire par votre infrastructure.
d318 2
a319 2
$ <strong>cat /etc/hostname.vlan0</strong>
Inet 172.21.0.31 255.255.255.0 NONE vlan 2 vlandev fxp1
d388 1
a388 1
<strong>/etc/netstart</strong>. Vous pouvez l'exécuter simplement en
d392 1
a392 1
# <strong>sh /etc/netstart</strong>
d434 1
a434 1
$ <strong>netstat -rn</strong>
d450 1
a450 1
$ <strong>route show</strong>
d501 1
a501 1
# <strong>sysctl net.inet.ip.forwarding=1</strong>
d850 1
a850 2
<blockquote>
<pre>
d855 2
a856 4
set dial "ABORT BUSY ABORT NO\\sCARRIER TIMEOUT 5 \"\" AT OK-AT-OK ATE1Q0 OK
\\dATDT\\T TIMEOUT 40 CONNECT"
</pre>
</blockquote>
d885 1
a885 2
<blockquote>
<pre>
d893 1
a893 2
</pre>
</blockquote>
d946 1
a946 2
<blockquote>
<pre>
d956 1
a956 2
</pre>
</blockquote>
d1135 1
a1135 1
 #  <strong>sysctl net.inet.tcp.baddynamic=749,750,751,760,761,871</strong>
d1139 2
a1140 2
 #  <strong>sysctl net.inet.tcp.baddynamic=+748</strong>
 #  <strong>sysctl net.inet.tcp.baddynamic=-871</strong>
d1204 1
a1204 1
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=nfsd&amp;sektion=8">portmap(8)</a>
d1214 2
a1215 3
<blockquote>
<tt>
portmap=YES<br>
d1217 1
a1217 2
</tt>
</blockquote>
d1275 6
a1280 8
<blockquote>
<tt>
# <b>/usr/sbin/portmap</b><br>
# <b>echo -n &gt;/var/db/mountdtab</b><br>
# <b>/sbin/mountd</b><br>
# <b>/sbin/nfsd -tun 4</b><br>
</tt>
</blockquote>
d1356 1
a1356 2
<blockquote>
<tt>
d1358 1
a1358 2
</tt>
</blockquote>
d1383 1
a1383 1
$ <strong>rpcinfo -p 10.0.0.1</strong>
d1411 1
a1411 1
$ <strong>/usr/bin/showmount -a 10.0.0.1</strong>
d1475 1
a1475 2
<blockquote>
<pre>
d1478 1
a1478 2
</pre>
</blockquote>
d1487 1
a1487 2
<blockquote>
<pre>
d1490 1
a1490 2
</pre>
</blockquote>
d1508 1
a1508 2
<blockquote>
<pre>
d1513 1
a1513 2
</pre>
</blockquote>
d1539 1
a1539 2
<blockquote>
<pre>
d1544 1
a1544 2
</pre>
</blockquote>
d1554 1
a1554 2
<blockquote>
<pre>
d1565 1
a1565 2
</pre>
</blockquote>
d1864 1
a1864 1
balance de charge ("load balancing"). Si cette fonctionnalité est
d1903 1
a1903 1
(pour des raisons de balance de charge) la même adresse IP. CARP est
d1989 1
a1989 1
<h3>6.11.3 - Balance de charge ("load balancing")</h3>
d1995 1
a1995 1
est temps d'essayer la balance de charge. Créons une nouvelle interface
d2023 1
a2023 1
contrôlant la balance de charge sur les deux machines, comme nous
d2027 1
a2027 1
# <strong>sysctl net.inet.carp.arpbalance=1</strong>
d2264 4
a2267 6
<blockquote>
<tt>
# route add -mpath default 10.130.128.1<br>
# route add -mpath default 10.132.0.1<br>
</tt>
</blockquote>
d2272 2
a2273 3
<blockquote>
<pre>
# netstat -rnf inet | grep default
d2276 1
a2276 2
</pre>
</blockquote>
d2305 4
a2308 6
<blockquote>
<tt>
# sysctl net.inet.ip.multipath=1<br>
# sysctl net.inet6.ip6.multipath=1
</tt>
</blockquote>
d2321 2
a2322 3
<blockquote>
<pre>
# traceroute -n 154.11.0.4
d2329 1
a2329 1
# traceroute -n 154.11.0.5
d2335 1
a2335 2
</pre>
</blockquote>
d2368 2
a2369 2
Originally [OpenBSD: faq6.html,v 1.262 ]<br>
$Translation: faq6.html,v 1.109 2008/02/29 21:02:08 coyolxauhqui Exp $<br>
@


1.85
log
@Sync with Steelix CVS
@
text
@d561 1
a561 1
inet 192.168.0.2 255.255.255.0 media 100baseTX
d2400 2
a2401 2
Originally [OpenBSD: faq6.html,v 1.261 ]<br>
$Translation: faq6.html,v 1.108 2008/02/25 10:44:29 saad Exp $<br>
@


1.84
log
@Sync with Steelix CVS
@
text
@d1203 4
d1208 8
a1215 6
Autre note concernant la sécurité. Ne vous contentez pas juste d'ajouter
un système de fichiers dans <i>/etc/exports</i> sans mettre en place une
liste recensant les hôtes autorisés à se connecter. Sans une liste
d'hôtes autorisés à monter un répertoire particulier, n'importe qui,
capable de vous atteindre, sera en mesure de monter vos systèmes de
fichiers exportés par NFS.
d1218 3
a1220 4
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=portmap&amp;sektion=8">
portmap(8)</a> doit être lancé afin que NFS puisse fonctionner. Sous
OpenBSD, portmap(8) est désactivé par défaut, vous devez donc ajouter la
ligne
d1222 6
a1227 7
<blockquote><pre>
portmap=YES
</pre></blockquote>
dans le fichier <a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc.conf.local&amp;sektion=8">
rc.conf.local(8)</a> pour le lancer au démarrage. Il peut également être
lancé manuellement :
d1229 3
a1231 3
<blockquote><pre>
# <strong>/usr/sbin/portmap</strong>
</pre></blockquote>
d1234 11
a1244 10
Cette configuration consiste en un serveur d'adresse IP <b>10.0.0.1</b>. Ce
serveur n'offrira NFS qu'aux clients présents sur ce réseau. La
première étape pour installer un serveur NFS est de renseigner
votre fichier <i>/etc/exports</i>. Ce fichier liste les systèmes de
fichiers que vous souhaitez rendre accessibles par NFS et définit qui
peut y accéder. Beaucoup d'options sont disponibles pour l'édition
de <i>/etc/exports</i> et vous devriez lire la page de manuel <a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=exports&amp;sektion=5">
exports(5)</a>. Pour cet exemple, notre fichier <i>/etc/exports</i> ressemblera
à :
d1256 12
a1267 4
accessible par NFS. L'option <tt>-alldirs</tt> permet au client de
monter n'importe quel répertoire sous le point de montage
<tt>/work</tt>. L'option <tt>-ro</tt> exporte le système de fichiers en
lecture seule. Les deux derniers arguments spécifient que seuls les
d1274 19
a1292 5
Une fois que votre fichier <i>/etc/exports</i> est configuré, vous
pouvez mettre en place votre serveur NFS. Tout d'abord, vérifiez que les
options NFSSERVER &amp; NFSCLIENT sont bien présentes dans votre fichier
de configuration noyau. (Le noyau GENERIC inclus ces options.) Ensuite,
il vous faut inclure la ligne
d1294 17
d1312 1
a1312 1
nfs_server=YES
d1314 1
d1316 18
a1333 8
dans le fichier <i>/etc/rc.conf.local</i>. Ceci aura pour effet de
démarrer nfsd(8) et mountd(8) au redémarrage. A présent, vous pouvez
lancer les services manuellement. Ils doivent être lancés par root et vous
devez vérifier que portmap(8) est bien démarré sur votre système. Voici
un exemple de lancement de nfsd(8) servant les requêtes TCP et UDP et
utilisant 4 services. Vous devriez utiliser un nombre approprié de services
NFS en fonction du nombre maximum de connexions concurrentes que vous
souhaitez servir.
d1335 3
d1339 1
a1339 1
# <strong>/sbin/nfsd -tun 4</strong>
d1343 6
a1348 5
Vous devez non seulement démarrer le serveur nfsd(8) mais également
mountd(8). Il s'agit du service qui se charge de passer les requêtes de
montage à NFS. Pour démarrer mountd(8), soyez sûr qu'un fichier
mountdtab vide existe puis lancez le service :

d1350 1
a1350 2
# <strong>echo -n &gt;/var/db/mountdtab</strong>
# <strong>/sbin/mountd</strong>
d1354 19
a1372 3
Si vous faites des changements au fichier /etc/exports alors qu'NFS est
déjà en fonction, vous devez en informer mountd ! Lancez-lui simplement
un signal HUP :
d1374 7
a1380 3
<blockquote><pre>
# <strong>kill -HUP `cat /var/run/mountd.pid`</strong>
</pre></blockquote>
d1383 6
d1392 3
a1394 2
Maintenant, vous pouvez vérifier que tous ces services sont lancés et
enregistrés avec RPC. Pour ce faire, utilisez rpcinfo(8).
d1431 3
a1433 39
<h3>Monter des systèmes de fichiers NFS</h3>

<p>
Les systèmes de fichiers NFS doivent être montés par
mount(8), ou plus précisément, <a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=mount_nfs&amp;sektion=8">
mount_nfs(8)</a>. Pour monter le système de fichiers <i>/work</i> sur
10.0.0.1 vers le système de fichiers local <i>/mnt</i>, il vous suffit de
lancer la commande suivante (notez qu'il n'est pas nécessaire d'utiliser
une adresse IP ; mount résoudra les noms d'hôtes) :

<blockquote><pre>
# <strong>mount -o ro -t nfs 10.0.0.1:/work /mnt</strong>
</pre></blockquote>

<p>
Pour que ce système de fichiers soit monté au démarrage,
ajoutez la ligne suivante dans votre <i>/etc/fstab</i> :

<blockquote><pre>
10.0.0.1:/work /mnt nfs ro 0 0
</pre></blockquote>

<p>
Il est important que vous utilisiez <tt>0 0</tt> à la fin de la ligne
afin que votre machine ne lance pas un fsck sur ce système de fichiers
NFS au boot !!! Les autres options standards, comme noexec, nodev,
nosuid peuvent être employées lorsqu'elles sont applicables. Par exemple
:

<blockquote><pre>
10.0.0.1:/work /mnt nfs ro,nodev,nosuid 0 0
</pre></blockquote>

<p>
Ainsi, aucun périphérique ni programme setuid présent sur le serveur NFS
ne peut compromettre la sécurité du client. Si vous ne montez pas de
programmes que vous souhaitez utiliser sur le client NFS, ajoutez
l'option noexec à cette ligne.
d2400 2
a2401 2
Originally [OpenBSD: faq6.html,v 1.260 ]<br>
$Translation: faq6.html,v 1.107 2008/01/28 05:31:42 saad Exp $<br>
@


1.83
log
@Sync with Steelix CVS
@
text
@d804 1
a804 1
 - implémentation noyau du démon ppp.
d817 1
a817 1
espace utilisateur du démon PPP car il est plus simple à utiliser et
d830 1
a830 1
à la mise en place de ppp. Le fichier de configuration du démon
d1273 1
a1273 1
lancer les démons manuellement. Ils doivent être lancés par root et vous
d1276 1
a1276 1
utilisant 4 démons. Vous devriez utiliser un nombre approprié de démons
d1288 1
a1288 1
mountdtab vide existe puis lancez le démon :
d1308 1
a1308 1
Maintenant, vous pouvez vérifier que tous ces démons sont lancés et
d2352 1
a2352 1
$Translation: faq6.html,v 1.106 2008/01/14 21:54:36 saad Exp $<br>
@


1.82
log
@Sync with steelix translation CVS
@
text
@d1331 7
a1337 3
existe aussi nfsstat(8) qui affiche beaucoup plus de statistiques. Pour utiliser
showmount(8), essayez la commande <tt>/usr/bin/showmount -a hôte</tt>. Par
exemple :
d1728 1
a1728 1
    OpenBSD 4.1 (RAMDISK_CD) #247: Thu Mar  8 23:21:43 MST 2007
d2351 2
a2352 2
Originally [OpenBSD: faq6.html,v 1.256 ]<br>
$Translation: faq6.html,v 1.105 2007/05/02 08:00:42 ajacoutot Exp $<br>
@


1.81
log
@Sync with Steelix CVS
@
text
@d1722 1
a1722 1
    Copyright (c) 1995-2006 OpenBSD.  All rights reserved.  http://www.OpenBSD.org
d1724 1
a1724 1
    OpenBSD 4.0 (RAMDISK_CD) #39: Sat Sep 16 19:34:26 MDT 2006
d2347 2
a2348 2
Originally [OpenBSD: faq6.html,v 1.255 ]<br>
$Translation: faq6.html,v 1.104 2007/04/26 09:19:03 ajacoutot Exp $<br>
@


1.80
log
@sync with Steelix CVS
@
text
@d11 1
a11 1
<meta name= "copyright"     content= "This document copyright 1998-2006 by OpenBSD.">
d596 1
a596 1
Sous OpenBSD, le filtrage du trafic TCP/IP ainsi que la translation
d599 1
a599 1
est aussi capable de normaliser et de traiter le trafic TCP/IP, d'offrir
d2212 1
a2212 1
<a name="Multipath">
d2320 1
a2320 1
an Equal-Cost Multi-Path Algorithm"</a>.
d2347 2
a2348 2
Originally [OpenBSD: faq6.html,v 1.253 ]<br>
$Translation: faq6.html,v 1.103 2007/02/18 10:54:13 ajacoutot Exp $<br>
@


1.79
log
@sync with Steelix CVS
@
text
@d11 1
a11 1
<meta name= "copyright"     content= "This document copyright 1998-2007 by OpenBSD.">
d2348 1
a2348 1
$Translation: faq6.html,v 1.102 2007/02/07 10:37:38 benoit Exp $<br>
@


1.78
log
@sync with Steelix CVS
@
text
@d1599 1
a1599 1
plateformes i386 et amd64. Au démarrage, chaque interface compatible PXE
d2348 1
a2348 1
$Translation: faq6.html,v 1.101 2007/02/05 07:25:49 benoit Exp $<br>
@


1.77
log
@sync with Steelix CVS
@
text
@d11 1
a11 1
<meta name= "copyright"     content= "This document copyright 1998-2006 by OpenBSD.">
d217 1
a217 1
<strong>UP</strong> et <strong>RUNNING</strong> sont également présents
d280 1
a280 1
trivialles.
d376 1
a376 1
SOus OpenBSD, ce nom est défini comme FQDN ("Fully Qualified Domain
d404 1
a404 1
votre système devrait être en état de fonctionnement. Une nouvelle fois,
d517 1
a517 1
ATM, FDDI, Ethernet, et série (PPP/SLIP).
d757 1
a757 1
Si vous souhaiter démarrez dhcpd(8) à partir de la ligne de
d993 1
a993 1
<i>/usr/sbin/ppp</i> sans options, ce qui vous placera en mode
d1043 1
a1043 1
qu'au Royaume Uni ou en Belgique.
d1092 1
a1092 1
effective, les deux extrémités de la connexion doivent utiliser des
d1410 1
a1410 1
Un des mes racks possède un certain nombre d'anciens systèmes, lesquels
d1777 1
a1777 1
A intervalles paramétrables, le maître annonce sont état sur le port IP
d2263 1
a2263 1
multi-chemin, les commandes précitées devraient être ajoutée à la fin
d2348 1
a2348 1
$Translation: faq6.html,v 1.100 2007/02/02 14:21:00 ajacoutot Exp $<br>
@


1.76
log
@sync with Steelix CVS
@
text
@d1075 2
a1076 2
pptp quant à lui doit être installé en utilisant les <a href="../faq15.html#PkgMgmt">
paquets</a> ou les <a href="../faq15.html#Ports">ports</a>. De plus amples
d2032 1
a2032 1
disponible dans le système des <a href="../faq15.html#Ports">ports</a>,
d2348 1
a2348 1
$Translation: faq6.html,v 1.99 2007/02/01 16:31:38 ajacoutot Exp $<br>
@


1.75
log
@sync with steelix translation CVS
@
text
@d1610 1
a1610 1
un noyau (comme <tt>bsd</tt> ou <a href="../faq4.html#bsd.rd">
d2348 1
a2348 1
$Translation: faq6.html,v 1.98 2006/12/20 09:59:10 ajacoutot Exp $<br>
@


1.74
log
@sync with steelix translation CVS
@
text
@d46 2
a47 2
<li><a href= "#Intro" >6.1 - Avant d'aller plus loin</a>
<li><a href= "#Setup" >6.2 - Configuration initiale du réseau</a>
d49 8
a56 3
<li><a href="#Setup.1" >6.2.1 - Identifier et configurer vos interfaces réseau</a>
<li><a href="#Setup.2" >6.2.2 - Mettre en place une passerelle OpenBSD</a>
<li><a href="#Setup.3" >6.2.3 - Configurer les alias sur une interface</a>
d58 1
a58 1
<li><a href= "#PF"    >6.3 - Comment filtrer et utiliser un pare-feu sous
d60 1
a60 1
<li><a href= "#DHCP"  >6.4 - Protocole d'attribution dynamique des
d66 1
a66 1
<li><a href= "#PPP"   >6.5 - Protocole Point à Point (PPP)</a>
d69 1
a69 1
<li><a href= "#NFS"   >6.7 - Utilisation de NFS</a>
d71 1
a71 1
<li><a href= "#PXE"   >6.10 - Comment démarrer en utilisant PXE ?</a>
d117 8
a124 1
<h2>6.2 - Configuration initiale du réseau</h2>
d127 1
a127 1
<a name="Setup.1"></a>
a130 1
Pour commencer, vous devez d'abord identifier votre interface réseau.
d157 6
d169 1
a169 1
interface ethernet physique :
d263 7
a269 5
Si votre interface n'est pas configurée, la première chose à faire est
de créer le fichier <i>/etc/hostname.xxx</i>, où "xxx" représente le nom
de votre interface. En ce basant sur les informations des exemples précédents,
le nom du fichier sera <i>/etc/hostname.fxp0</i>. Le format de ce
fichier est simple :<br>
d275 2
a276 2
(Beaucoup plus d'informations sur la syntaxe de ce fichier sont disponibles dans
le manuel <a
d278 3
a280 1
hostname.if(5)</a>.)
d292 6
d306 1
a306 1
(Bien entendu, vous ne devriez jamais forcer le mode full duplex à moins
d309 3
a311 1
n'est pas nécessaire.)
d320 1
a320 1
inet 172.21.0.31 255.255.255.0 NONE vlan 2 vlandev fxp1
d323 18
a340 16
<p>
La prochaine étape consiste à définir votre passerelle par
défaut. Pour ce faire, renseignez simplement le fichier
<i>/etc/mygate</i> avec l'adresse IP de votre passerelle. Ceci permettra de
configurer automatiquement votre route par défaut au démarrage. A
présent, vous pouvez indiquer l'adresse de vos serveurs de noms et
renseigner le fichier <i>/etc/hosts</i> (voir la page de manuel <a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=hosts&amp;sektion=5">hosts(5)
</a>). Pour configurer vos serveurs de noms, vous devez créer un fichier
nommé <i>/etc/resolv.conf</i>. Vous pouvez en savoir plus sur le format
de ce fichier dans la page de manuel <a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=resolv.conf&amp;sektion=5">
resolv.conf(5)</a>. Si vous utilisez DHCP, soyez sûr de lire <a href="#DHCP">
6.4 - DHCP</a> ainsi que le manuel <a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=resolv.conf.tail&amp;sektion=5">
resolv.conf.tail(5)</a>. Mais pour une utilisation standard, voici un exemple.
d342 5
a346 3
<p>
Dans celui-ci, vos serveurs de noms sont 125.2.3.4 et 125.2.3.5. Vous faites
également partie du domaine "example.com".
a348 1
$ <strong>cat /etc/resolv.conf</strong>
d355 13
d369 19
d408 17
a424 1
ifconfig(8)</a>. Vous pouvez également vérifier vos routes via <a
d466 2
a467 2
<a name="Setup.2"></a>
<h3>6.2.2 - Mettre en place une passerelle OpenBSD</h3>
d520 2
a521 2
<a name="Setup.3"></a>
<h3>6.2.3 - Configurer les alias sur une interface</h3>
d578 3
a593 1
<a name="NAT"></a>
d2347 2
a2348 2
Originally [OpenBSD: faq6.html,v 1.250 ]<br>
$Translation: faq6.html,v 1.97 2006/11/27 10:35:40 ajacoutot Exp $<br>
@


1.73
log
@sync with Steelix CVS
@
text
@d2181 2
a2182 2
multi-chemin, la commande ifconfig précitée devrait être ajoutée à la
fin des fichiers
d2184 2
a2185 4
>hostname.if(5)</a> correspondant aux interfaces fxp1 et fxp2 et le
fichier devrait être supprimé.
Ceci aura pour effet d'ajouter les routes lorsque le système est
démarré.
a2196 4
Assurez-vous d'éditer
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl.conf&amp;sektion=5"
>sysctl.conf(5)</a>
pour rendre les modifications permanentes.
d2206 6
d2243 2
a2244 2
acheminera tout de même des paquets à travers cette interface. Ces paquets
seront bien entendus perdus. 
d2265 2
a2266 2
Originally [OpenBSD: faq6.html,v 1.249 ]<br>
$Translation: faq6.html,v 1.96 2006/11/22 10:17:11 saad Exp $<br>
@


1.72
log
@sync with steelix translation CVS
@
text
@d71 2
d2130 121
d2265 2
a2266 2
Originally [OpenBSD: faq6.html,v 1.248 ]<br>
$Translation: faq6.html,v 1.95 2006/11/03 10:39:34 ajacoutot Exp $<br>
@


1.71
log
@sync with steelix translation CVS
@
text
@d1640 1
a1640 1
    OpenBSD 3.9 (RAMDISK_CD) #1025: Thu Mar  2 02:43:29 MST 2006
d2062 8
a2069 8
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=awi&amp;sektion=4">
awi(4)</a> AMD 802.11 PCnet Mobile
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=an&amp;sektion=4">
an(4)</a> Aironet Communications 4500/4800
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=wi&amp;sektion=4">
wi(4)</a> Prism2/2.5/3
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=atw&amp;sektion=4">
atw(4)</a> ADMtek ADM8211
d2071 1
a2071 1
pilote pour chipset Atheros IEEE 802.11a/b/g.
d2073 1
a2073 1
Intel PRO/Wireless 2200BG/2225BG/2915ABG IEEE 802.11a/b/g.
d2075 1
a2075 1
Intel PRO/Wireless 2100 IEEE 802.11b.
d2077 1
a2077 1
Atmel AT76C50x USB IEEE 802.11b.
d2079 2
a2080 2
et <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ural&amp;sektion=4">ural(4)</a>
[USB] Ralink Technology RT25x0 IEEE 802.11a/b/g.
d2082 12
a2093 1
Realtek 8180 IEEE 802.11b.
d2096 6
d2104 4
a2107 2
système OpenBSD à un réseau sans fil existant (prière de consulter les
pages du manuel pour les détails précis).
a2112 6
Une autre méthode pour permettre à un pare-feu OpenBSD de fournir un
accès sans fil est d'utiliser une carte conventionnelle et un point
d'accès externe en mode pont. Cette méthode a l'avantage de vous
permettre de positionner l'antenne là où elle est la plus efficace.

<p>
d2116 5
a2120 3
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=iwi&amp;sektion=4#FILES">
Contactez Intel</a> afin de leur faire savoir ce que vous pensez de cette
situation ou de les informer sur le produit que vous avez acheté à la place.
d2123 4
a2126 6
D'autres constructeurs tels que Broadcom, Texas Instrument et Connexant se
sont activement battus contre nos tentatives de développer des pilotes
libres pour leurs produits. Nous vous encourageons à respecter leur souhait
et à ne pas acheter leurs produits. Realtek, Ralink, Atmel et ADMtek
font de bons produits et supportent la communauté Open Source dans sa
volonté de créer des pilotes libres, ils ont gagné notre support.
d2142 2
a2143 2
Originally [OpenBSD: faq6.html,v 1.246 ]<br>
$Translation: faq6.html,v 1.93 2006/10/28 18:19:19 aanriot Exp $<br>
@


1.70
log
@sync with Steelix CVS
@
text
@d1355 1
a1355 1
dhcp NONE NONE NONE NONE
d2129 2
a2130 2
Originally [OpenBSD: faq6.html,v 1.245 ]<br>
$Translation: faq6.html,v 1.92 2006/10/23 09:10:23 saad Exp $<br>
@


1.69
log
@sync with Steelix CVS
@
text
@d2129 2
a2130 2
Originally [OpenBSD: faq6.html,v 1.244 ]<br>
$Translation: faq6.html,v 1.91 2006/09/08 20:41:18 saad Exp $<br>
@


1.68
log
@sync with steelix translation CVS
@
text
@d195 1
a195 1
précédent, la carte est déja configurée. Ceci est évident de part la
d337 1
a337 1
routes sont déja présentes dans la table de routage du noyau. A présent,
d399 1
a399 1
Le noyau GENERIC est déja configuré pour permettre le routage IP,
d514 1
a514 1
paquet ; auquel nous nous réferrerons à présent sous le nom de PF) . PF
d591 1
a591 1
Le client DHCP écrase toutes les données déja présentes dans resolv.conf(5)
d798 1
a798 1
section en-dessous de <tt>default:</tt>. Le marqueur définissant cette
d943 1
a943 1
basée sur le protocol point-à-point. En voici des exemples:
d1072 1
a1072 1
vitessse lorsque vous transférez beaucoup de données, vous devriez
d1082 1
a1082 1
obtenez des performances en deça de vos attentes.
d1130 1
a1130 1
OpenBSD, Portmap(8) est désactivé par défaut, vous devez donc ajouter la
d1213 1
a1213 1
déja en fonction, vous devez en informer mountd ! Lancez-lui simplement
d1411 1
a1411 1
évoqué, il est probable que vous souhaitiez FAIRE quelquechose avec les
d1507 1
a1507 1
imcompatibles avec PXE ; s'il est équipé de tels contrôleurs, un
d1515 1
a1515 1
platformes i386 et amd64. Au démarrage, chaque interface compatible PXE
d1600 1
a1600 1
afin de vérifier que vous pouvez bien r#p#r les fichiers n#ssaires.
d1626 1
a1626 1
tapes simplement "<tt>bsd.rd</tt>" pour récupérerer le fichier <tt>bsd.rd</tt>
d1835 1
a1835 1
<i>Rachael</i> était déja en place à l'adresse 192.168.0.7. Comment allez-
d1921 1
a1921 1
sur les deux machines : CARP utilise une empreinte de l'IP originatrice
d1977 1
a1977 1
précisemment au démarrage car la synchronisation d'une horloge très
d2055 1
a2055 1
synchronisé et des heures voire des jours si celle-ci est décallée.
d2108 1
a2108 1
D'autres contructeurs tels que Broadcom, Texas Instrument et Connexant se
d2130 1
a2130 1
$Translation: faq6.html,v 1.90 2006/08/28 04:37:07 saad Exp $<br>
@


1.67
log
@sync with steelix translation CVS
@
text
@d416 2
a417 2
Souvenez-vous que ce changement ne sera pas sauvegard au redmarrage et
que vous devrez tre root pour utiliser cette commande.
d2130 1
a2130 1
$Translation: faq6.html,v 1.89 2006/08/24 14:38:15 ajacoutot Exp $<br>
@


1.66
log
@sync with steelix translation CVS
@
text
@d48 5
d55 6
a60 2
<li><a href= "#DHCP"  >6.4 - Protocole d'attribution dynamique des adresses
(DHCP)</a>
d533 1
a631 3



d633 1
d1987 2
a1988 2
Ce n'était pas un des <a
href="http://www.openntpd.org/goals.html">objectifs de la conception</a>
d2023 1
a2023 1
suffisant pour les 95% d'utilisateurs restants.
d2027 2
a2028 2
concernant ce fait est disponible <a
href="http://www.advogato.org/person/dtucker/diary.html?start=52">ici</a>.
d2030 26
d2129 2
a2130 2
Originally [OpenBSD: faq6.html,v 1.239 ]<br>
$Translation: faq6.html,v 1.88 2006/08/24 11:38:29 ajacoutot Exp $<br>
@


1.65
log
@sync with Steelix CVS
@
text
@d1961 2
a1962 2
href="faq10.html#rc">rc.conf.local</a>, votre ordinateur restera
synchronisé avec les serveurs de <a
d1964 1
a1964 1
serveurs de temps publiques.
d1968 1
a1968 1
de quelques minutes, il est *vivement* recommandé de la régler plus
d1971 3
a1973 6
la régler manuellement en utilisant
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=date&amp;sektion=1">date(1)</a>
ou de manière semi-automatique avec
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rdate&amp;sektion=8">rdate(8)</a>
ou encore tout simplement en réglant l'horloge matérielle de votre
ordinateur.
d2095 2
a2096 2
Originally [OpenBSD: faq6.html,v 1.238 ]<br>
$Translation: faq6.html,v 1.87 2006/08/07 08:22:38 saad Exp $<br>
@


1.64
log
@sync with steelix translation CVS
@
text
@d1801 1
a1801 1
&nbsp;&nbsp;&nbsp;&nbsp;192.168.0.7 255.255.255.0</b>
d1880 1
a1880 1
&nbsp;&nbsp;&nbsp;&nbsp;192.168.0.7 255.255.255.0</b>
d1889 2
a1890 2
pris# <b>ifconfig carp1 vhid 2 pass bryant carpdev fxp0 192.168.0.7
255.255.255.0</b>
d2098 2
a2099 2
Originally [OpenBSD: faq6.html,v 1.237 ]<br>
$Translation: faq6.html,v 1.86 2006/06/26 12:40:14 ajacoutot Exp $<br>
@


1.63
log
@sync with steelix translation CVS
cvs: ----------------------------------------------------------------------
@
text
@d1988 1
a1988 1
ntp.org. Ce dernier restera disponible dans les ports et comme package.
d2099 1
a2099 1
$Translation: faq6.html,v 1.85 2006/05/31 11:24:04 ajacoutot Exp $<br>
@


1.62
log
@sync with steelix translation CVS
@
text
@d1888 1
a1888 1
pris# <b>ifconfig create carp1</b>
d2098 2
a2099 2
Originally [OpenBSD: faq6.html,v 1.236 ]<br>
$Translation: faq6.html,v 1.84 2006/05/22 20:14:26 aanriot Exp $<br>
@


1.61
log
@sync with Steelix CVS
@
text
@d145 1
a145 1
$ <strong>ifconfig -a</strong>
d2098 2
a2099 2
Originally [OpenBSD: faq6.html,v 1.235 ]<br>
$Translation: faq6.html,v 1.83 2006/05/14 09:09:27 ajacoutot Exp $<br>
@


1.60
log
@sync with steelix translation CVS
@
text
@d778 1
a778 1
différents évênements. Le périphérique utilisé est indiqué par &quot;set
d904 1
a904 1
configuration précédente, ppp enregistrera les évênements dans
d1121 2
a1122 2
portmap(8)</a> doit être lancé afin que NFS puisse fonctionner. A partir
d'OpenBSD 3.2 Portmap(8) est désactivé par défaut, vous devez donc ajouter la
d1130 2
a1131 1
rc.conf.local(8)</a> puis redémarrer.
d1133 3
d1173 14
a1186 9
il vous faut inclure la ligne <tt>nfs_server=YES</tt> dans le fichier
<i>/etc/rc.conf.local</i>. Ceci aura pour effet de démarrer nfsd(8) et
mountd(8) au redémarrage. A présent, vous pouvez lancer les démons
manuellement. Ils doivent être lancés par root et vous devez vérifier
que portmap(8) est bien démarré sur votre système. Voici un exemple de
lancement de nfsd(8) servant les requêtes TCP et UDP et utilisant 4
démons. Vous devriez utiliser un nombre approprié de démons NFS en
fonction du nombre maximum de connexions concurrentes que vous souhaitez
servir.
d2098 2
a2099 2
Originally [OpenBSD: faq6.html,v 1.234 ]<br>
$Translation: faq6.html,v 1.81 2006/05/02 09:18:03 ajacoutot Exp $<br>
@


1.59
log
@sync with Steelix CVS
@
text
@d1059 16
d1621 1
a1621 2
    Copyright (c) 1995-2005 OpenBSD.  All rights reserved.
http://www.OpenBSD.org
d1623 1
a1623 1
    OpenBSD 3.8 (RAMDISK_CD) #794: Sat Sep 10 15:58:32 MDT 2005
d2089 2
a2090 2
Originally [OpenBSD: faq6.html,v 1.233 ]<br>
$Translation: faq6.html,v 1.80 2006/04/07 09:15:52 ajacoutot Exp $<br>
@


1.58
log
@sync with Steelix CVS
@
text
@d1474 1
a1474 1
imcompatibles avec PXE ; s'il est équipé de tels contrôlleurs, un
d2075 1
a2075 1
$Translation: faq6.html,v 1.79 2006/03/29 07:59:20 ajacoutot Exp $<br>
@


1.57
log
@sync with steelix translation CVS
@
text
@d983 2
a984 2
pptp quant à lui doit être installé en utilisant les <a href="faq15.html#PkgMgmt">
paquets</a> ou les <a href="faq15.html#Ports">ports</a>. De plus amples
d1916 1
a1916 1
disponible dans le système des <a href="faq15.html#Ports">ports</a>,
d2075 1
a2075 1
$Translation: faq6.html,v 1.78 2006/03/18 14:57:47 ajacoutot Exp $<br>
@


1.56
log
@sync with Steelix CVS
@
text
@d1685 9
a1693 8
groupe doivent appartenir au même réseau physique et que chaque
interface doive avoir une véritable adresse IP fixe en plus de l'adresse
IP CARP statique. De même, les services nécessitant une connexion
constante au serveur (tels que SSH ou IRC) ne seront pas transférés de
manière transparente aux autres systèmes, bien que dans ce cas, CARP
puisse aider à minimiser le temps d'arrêt. CARP, lui-même, ne
synchronise pas les données entre applications, ceci doit être fait au
travers de "procédés alternatifs" tels que
d2074 2
a2075 2
Originally [OpenBSD: faq6.html,v 1.232 ]<br>
$Translation: faq6.html,v 1.77 2006/03/10 15:45:04 ajacoutot Exp $<br>
@


1.55
log
@sync with Steelix CVS
@
text
@d11 1
a11 1
<meta name= "copyright"     content= "This document copyright 1998-2005 by OpenBSD.">
d2032 1
a2032 1
pages du manuel pour des détails précis).
d2054 1
a2054 1
libres pour leurs produits. Nous vuos encourageons à respecter leur souhait
d2073 2
a2074 2
Originally [OpenBSD: faq6.html,v 1.231 ]<br>
$Translation: faq6.html,v 1.75 2006/02/27 09:04:21 ajacoutot Exp $<br>
@


1.54
log
@sync with Steelix CVS
@
text
@d1996 1
a1996 1
Une réponse plus complête donnée par l'un des mainteneurs d'OpenNTPD et
d2074 1
a2074 1
$Translation: faq6.html,v 1.74 2005/12/22 09:47:36 ajacoutot Exp $<br>
@


1.53
log
@sync with Steelix CVS
@
text
@d141 2
a142 2
interface ethernet physique : <a href="http://www.openbsd.org/cgi-
bin/man.cgi?query=fxp&amp;sektion=4">fxp(4)</a> .
d299 2
d302 1
a302 1
également partie du domaine &quot;example.com&quot;.
d405 4
a408 4
directement l'utilitaire <a href="http://www.openbsd.org/cgi-
bin/man.cgi?query=sysctl&amp;sektion=8"> sysctl(8)</a>. Souvenez-vous
que ce changement ne sera pas sauvegardé au redémarrage et que vous
devrez être root pour utiliser cette commande.
d571 2
a572 2
et <b>supprimez</b> domain-name-servers. Bien sûr, vous pouvez
également supprimer hostname ainsi que d'autres options.
d633 1
a633 1
souhaitez que le serveur écoute, dans le fichier <tt>/etc/dhcpd.interfaces</tt>.
d694 3
a696 6
Samba.) Reportez vous à <a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=dhcp-options&amp;sektion=5">
dhcp-options(5)</a>. Si vos clients DHCP ont besoin de plus d'options, reportez
vous au manuel <a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=dhcp-options&amp;sektion=5">
dhcp-options(5)</a>.
d792 1
a792 1
d'utiliser le nom de votre FAI. Ici, nous utiliserons <b>myisp:</b> pour
a928 1
<p>
d1124 1
a1124 1
de ce fichier et vous devriez lire la page de manuel <a
d1351 2
a1352 2
l'existence d'un fichier du type <a href="http://www.openbsd.org/cgi-
bin/man.cgi?query=bridgename.if&amp;sektion=5">
d1439 12
a1450 12
    interface. Bien qu'il soit possible de filtrer sur les deux, vous
    devez vraiment en connaître toutes les implications avant de pouvoir
    le faire de la bonne manière.

<li>En utilisant l'option <i>blocknonip</i> de <a href="http://www.openbsd.org/cgi-
    bin/man.cgi?query=brconfig&amp;sektion=8"> brconfig(8)</a> ou dans
    <a href="http://www.openbsd.org/cgi-
    bin/man.cgi?query=bridgename.if&amp;sektion=5">
    bridgename.bridge0</a>, vous pouvez empêcher le trafic non-IP (comme
    IPX ou NETBEUI) de passer oûtre votre filtre. Dans certaines
    situations, cela peut-être important et vous devez savoir qu'un pont
    fonctionne pour tous les types de trafic, pas seulement IP.
d1453 7
a1459 6
    "Promiscuous" -- elles écoutent TOUT le trafic réseau, pas seulement
    celui leur étant dirigé. Ceci augmentera la charge du processeur et
    du bus. Certaines cartes ne fonctionnent pas correctement dans ce
    mode, le circuit TI ThunderLAN (<a href="http://www.openbsd.org/cgi-
    bin/man.cgi?query=tl&amp;sektion=4">tl(4)</a>) en est un exemple.
    </ul>
d1488 5
a1492 5
démarrage. Sous OpenBSD, <a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=pxeboot&amp;sektion=8&amp;arc
h=i386">pxeboot</a>, remplace le fichier <a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=boot&amp;sektion=8&amp;arch=i
386">boot(8)</a> standard. Il est alors capable de charger et d'exécuter
d1551 4
a1554 7
<li><a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=pxeboot&amp;sektion=8&amp;arc
h=i386"
>pxeboot</a>, le chargeur de démarrage (offre la même fonction que
<a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=boot&amp;sektion=8&amp;arch=i
386">boot</a> pour un démarrage sur disque).
d1557 2
a1558 4
<li><a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=boot.conf&amp;sektion=8&amp;a
rch=i386"
>/etc/boot.conf</a>, le fichier de configuration de boot.
d1565 3
a1567 3
tftpd(8) en utilisant un client <a href="http://www.openbsd.org/cgi-
bin/man.cgi?query=tftp&amp;sektion=1"> tftp(1)</a> afin de vérifier que
vous pouvez bien récupérer les fichiers nécessaires.
d1592 3
a1594 3
A présent, vous obtenez l'invite de commandes standard d'OpenBSD. Tapez
simplement "<tt>bsd.rd</tt>" pour récupérer le fichier homonyme à partir
du serveur TFTP.
d1692 4
a1695 3
travers de "procédés alternatifs" tels que <a href="http://www.openbsd.org/cgi-
bin/man.cgi?query=pfsync&amp;sektion=4"> pfsync(4)</a> (pour du filtrage
redondant), <a href="http://rsync.samba.org/">rsync</a>, pour dupliquer
d1737 2
a1738 3
Toutes ces variables sysctl sont documentées dans <a 
href="http://www.openbsd.org/cgi-
bin/man.cgi?query=sysctl&amp;sektion=3"> sysctl(3)</a>.
d1928 4
a1931 4
Le service <a href="http://www.openbsd.org/cgi-
bin/man.cgi?query=ntpd&amp;sektion=8">ntpd(8)</a> d'OpenBSD est contrôlé
à travers le fichier de configuration <a href="http://www.openbsd.org/cgi-
bin/man.cgi?query=ntpd.conf&amp;sektion=5"><tt>/etc/ntpd.conf</tt></a>
d2074 1
a2074 1
$Translation: faq6.html,v 1.73 2005/11/24 08:20:32 ajacoutot Exp $<br>
@


1.52
log
@sync with Steelix CVS
@
text
@d985 2
a986 2
pptp quant à lui doit être installé en utilisant les <a href="faq8.html#Ports">
ports</a> ou les <a href="faq8.html#Packages">packages</a>. De plus amples
d1921 1
a1921 1
disponible dans le système des <a href="faq8.html#Ports">ports</a>,
d2079 2
a2080 2
Originally [OpenBSD: faq6.html,v 1.230 ]<br>
$Translation: faq6.html,v 1.72 2005/11/02 09:49:31 ajacoutot Exp $<br>
@


1.51
log
@sync with steelix translation CVS
@
text
@d1614 1
a1614 1
    OpenBSD 3.8-current (RAMDISK_CD) #852: Tue Oct 25 18:00:44 MDT 2005
d2079 2
a2080 2
Originally [OpenBSD: faq6.html,v 1.228 ]<br>
$Translation: faq6.html,v 1.71 2005/11/01 12:54:02 ajacoutot Exp $<br>
@


1.50
log
@sync with Steelix CVS
@
text
@d974 1
a974 1
</a>, a été ajoutée dans OpenBSD 3.7.
d1614 1
a1614 1
    OpenBSD 3.7 (RAMDISK_CD) #573: Sun Mar 20 00:27:05 MST 2005
d1626 1
a1626 1
Oui, bien qu'avec les outils actuellement présents dans OpenBSD 3.7, le
d1942 2
a1943 2
href="faq10.html#rc">rc.conf.local</a>, votre ordinateur se
synchronisera avec des serveurs <a
d1947 11
a1957 2
Une fois votre horloge réglée de manière
précise, ntpd la gardera à un haut degré d'exactitude.
d2008 1
a2008 1
<!-- XXX remove "new" for 3.8 -->
d2020 1
a2020 2
<li><i>New</i> <a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=ath&amp;sektion=4">ath(4)</a>
d2022 1
a2022 2
<li><i>New</i> <a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=iwi&amp;sektion=4">iwi(4)</a>
d2024 1
a2024 2
<li><i>New</i> <a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=ipw&amp;sektion=4">ipw(4)</a>
d2026 1
a2026 2
<li><i>New</i> <a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=atu&amp;sektion=4">atu(4)</a>
d2028 1
a2028 2
<li><i>New</i> <a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=ral&amp;sektion=4">ral(4)</a>
d2031 1
a2031 2
<li><i>New</i> <a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=rtw&amp;sektion=4">rtw(4)</a>
d2079 2
a2080 2
Originally [OpenBSD: faq6.html,v 1.227 ]<br>
$Translation: faq6.html,v 1.70 2005/11/01 08:09:46 aanriot Exp $<br>
@


1.49
log
@sync with Steelix CVS
@
text
@d2076 2
a2077 2
Originally [OpenBSD: faq6.html,v 1.226 ]<br>
$Translation: faq6.html,v 1.69 2005/10/09 12:22:16 ajacoutot Exp $<br>
@


1.48
log
@sync with Steelix CVS
@
text
@d2058 1
a2058 1
et à ne pas acheter leurs produits. Realtek, Ralink, Atmel, ADMtek et Atheros
d2076 2
a2077 2
Originally [OpenBSD: faq6.html,v 1.225 ]<br>
$Translation: faq6.html,v 1.68 2005/09/01 12:10:08 ajacoutot Exp $<br>
@


1.47
log
@sync with Steelix CVS
@
text
@d1136 1
a1136 1
/work -alldirs -ro -network 10.0.0 -mask 255.255.255.0
d2076 2
a2077 2
Originally [OpenBSD: faq6.html,v 1.224 ]<br>
$Translation: faq6.html,v 1.67 2005/08/11 13:50:32 ajacoutot Exp $<br>
@


1.46
log
@sync with Steelix CVS
@
text
@d1797 4
d2076 2
a2077 2
Originally [OpenBSD: faq6.html,v 1.223 ]<br>
$Translation: faq6.html,v 1.66 2005/06/15 16:24:20 ajacoutot Exp $<br>
@


1.45
log
@sync with Steelix CVS
@
text
@d1781 1
a1781 1
rachael# <b><b>ifconfig carp0 vhid 1 pass tyrell carpdev fxp0 \
d2073 1
a2073 1
$Translation: faq6.html,v 1.65 2005/06/03 19:55:56 ajacoutot Exp $<br>
@


1.44
log
@sync with Steelix CVS
@
text
@d1750 7
a1756 7
ifconfig(8)</a>. Deux des quatre commandes spécifiques à CARP,
<tt>advbase</tt> et <tt>advskew</tt>, définissent l'intervalle entre les
annonces CARP. La formule (en secondes) est <tt>advskew</tt> divisée par
255 puis ajoutée à <tt>advbase</tt>. <tt>advbase</tt> peut être utilisée
pour diminuer le trafic réseau ou autoriser une plus grande latence
avant qu'un hôte de sauvegarde ne prenne le relais ; <tt>advskew</tt>
vous permet de contrôler quel hôte sera le maître sans trop de délais de
d1767 6
d1781 2
a1782 1
rachael# <b>ifconfig carp0 vhid 1 pass tyrell 192.168.0.7</b>
d1787 4
a1790 3
<i>tyrell</i>, et l'adresse IP 192.168.0.7. Afin de rendre ces changements
permanents après un redémarrage, vous pouvez créer un fichier
<tt>/etc/hostname.carp0</tt> ressemblant à :
d1793 2
a1794 1
inet 192.168.0.7 255.255.255.0 192.168.0.255 vhid 1 pass tyrell 
d1799 2
a1800 5
son interface CARP deviendra le maître.

<p>
Notez que sur une machine possédant plusieurs interfaces, l'interface
CARP est sur le même sous-réseau que l'interface physique.
d1856 2
a1857 1
rachael# <b>ifconfig carp1 vhid 2 advskew 100 pass bryant 192.168.0.7</b>
d1866 2
a1867 1
pris# <b>ifconfig carp1 vhid 2 pass bryant 192.168.0.7</b>
d2072 2
a2073 2
Originally [OpenBSD: faq6.html,v 1.222 ]<br>
$Translation: faq6.html,v 1.64 2005/05/27 18:34:59 aanriot Exp $<br>
@


1.43
log
@sync with Steelix CVS
@
text
@d1476 1
a1476 3
système OpenBSD/i386 ou amd64 ne pourra pas être démarré à par le
réseau.

d2065 1
a2065 1
$Translation: faq6.html,v 1.63 2005/05/24 15:10:10 ajacoutot Exp $<br>
@


1.42
log
@sync with steelix translation CVS
@
text
@d1664 1
a1664 1
chaud et automatique du maître). Peut importe les adresses IP et MAC de
d2040 1
a2040 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=iwi&sektion=4#FILES">
d2066 2
a2067 2
Originally [OpenBSD: faq6.html,v 1.221 ]<br>
$Translation: faq6.html,v 1.61 2005/05/20 06:32:20 ajacoutot Exp $<br>
@


1.41
log
@sync with Steelix CVS
@
text
@d974 1
a974 3
</a>, a été ajoutée dans OpenBSD -current ; cependant, elle ne sera pas
disponible aux utilisateurs non-current avant OpenBSD 3.7.
<!-- XXXrelease -->
d1613 1
a1613 1
    Copyright (c) 1995-2004 OpenBSD.  All rights reserved. 
d1616 1
a1616 1
    OpenBSD 3.6 (RAMDISK_CD) #378: Fri Sep 17 13:04:04 MDT 2004
d1628 1
a1628 1
Oui, bien qu'avec les outils actuellement présents dans OpenBSD 3.6, le
d1801 5
a1805 5
vous gérer cette situation ? Heureusement, CARP ne pose pas de problème
si un système possède la même adresse IP sur son interface physique et
dans un groupe CARP, donc il n'est pas nécessaire de changer les
commandes précédentes. Cependant, il est plus propre d'avoir une adresse
IP différente pour chaque systèm, cela rend les accès et la surveillance
d1936 2
a1937 10
<!-- XXXversion 3.6 only -->
Si l'horloge de votre ordinateur est très décalée, vous devriez d'abord
l'ajuster autant que possible, en utilisant
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rdate&amp;sektion=8">rdate(8)</a>,
car ntpd(8) n'ajuste l'horloge que TRES lentement en utilisant
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=adjtime&amp;sektion=2">adjtime(2)</a>
; il pourra s'écouler <i>plusieurs heures</i> (ou jours, voire même
plus) avant de synchroniser correctement une horloge retardant de
quelques minutes (<i>-current</i> ajustera immédiatement l'horloge au
démarrage de la machine). Une fois votre horloge réglée de manière
d1989 1
d2001 19
d2025 2
a2026 2
pages du manuel pour des détails précis). Cependant, les cartes à base
de Prism2 et Prism3, peuvent aussi être utilisées en mode "Host-Based
a2028 21
Malheureusement, les cartes réseau à base de Prism2/Prism3 ne sont plus
produites par les fabricants du marché de masse. En effet ces derniers
utilisent maintenant des composants plus récents et à moindre coût
souvent <a href="#GenSupport">sans modifier le numéro de série.</a> La
plupart des fabricants des nouveaux composants ont choisi de ne pas
publier la documentation nécessaire pour produire des pilotes libres et
ouverts pour ces périphériques (vous pouvez les contacter et essayer de
les convaincre de changer leur politique).

<p>

D'un autre côté, les adaptateurs Prism2/Prism3 sont encore disponibles
sur les marchés d'occasion et de surplus et quelques usines comprennent
la valeur d'un composant correctement documenté et compatible avec le
logiciel libre et continuent de produire des adaptateurs à base de Prism
de qualité professionnelle. Parmi celles-ci, on peut citer <a
href="http://www.netgate.com">Netgate.com</a>. De manière générale, si
le fabricant n'identifie pas de manière explicite un produit récent
comme étant un produit à base de Prism, vous pouvez estimer qu'il n'est
pas compatible avec le pilote wi(4). Il est à noter que les nouveaux
composants Prism (tels que le Prism-GT) ne sont pas encore supportés.
d2036 7
d2044 7
d2066 2
a2067 2
Originally [OpenBSD: faq6.html,v 1.220 ]<br>
$Translation: faq6.html,v 1.60 2005/05/14 09:52:36 ajacoutot Exp $<br>
@


1.40
log
@sync with OpenBSD CVS
@
text
@d1241 1
a1241 1
# <strong>mount -t nfs 10.0.0.1:/work /mnt</strong>
d1249 1
a1249 1
10.0.0.1:/work /mnt nfs rw 0 0
d1260 1
a1260 1
10.0.0.1:/work /mnt nfs rw,nodev,nosuid 0 0
d2063 2
a2064 2
Originally [OpenBSD: faq6.html,v 1.219 ]<br>
$Translation: faq6.html,v 1.59 2005/04/19 07:34:33 ajacoutot Exp $<br>
@


1.39
log
@sync with Steelix CVS
@
text
@d236 1
a236 1
de créer le fichier <i>/etc/hostname.xxx</i>, où xxx représente le nom
d295 6
a300 3
resolv.conf(5)</a>. Voici un exemple d'utilisation standard. Dans cet exemple,
vos serveurs de noms sont 125.2.3.4 et 125.2.3.5. Vous faites également
partie du domaine &quot;example.com&quot;.
d529 2
a530 2
xl0. La vôtre pouvant être aussi bien ep0 que fxp0 ou encore autre chose
! ) Tout ce que vous avez besoin d'écrire dans ce fichier est
d533 3
a535 3
<pre>
# <strong>echo dhcp &gt;/etc/hostname.xl0</strong>
</pre>
d543 1
a543 1
Si vous souhaitez démarrer le client dhcp à partir de la ligne de
d547 3
a549 3
<pre>
# <strong>dhclient fxp0</strong>
</pre>
d553 1
a553 1
par dhcp.
d556 1
a556 1
Peu importe la façon dont vous démarrez dhclient, vous pouvez
d563 1
a563 1
<pre>
d566 1
a566 1
</pre>
d573 51
d1622 1
a1622 1
Le noyau d'installation <a name="faq4.html#bsd.rd">bsd.rd</a> va
d2063 2
a2064 2
Originally [OpenBSD: faq6.html,v 1.218 ]<br>
$Translation: faq6.html,v 1.58 2005/03/29 08:26:26 svincent Exp $<br>
@


1.38
log
@sync with Steelix CVS
@
text
@d71 6
a76 8
Afin de permettre une meilleure compréhension de ce document, vous
devriez lire et assimiler au moins partiellement la section <a
href="faq5.html">Construire le Système à partir des Sources</a> de
la FAQ ainsi que le manuel <a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&amp;sektion=8">
ifconfig(8)</a> et <a href=
"http://www.openbsd.org/cgi-bin/man.cgi?query=netstat&amp;sektion=1">netstat(1)
</a>.
d109 4
a112 4
Sous OpenBSD, les interfaces sont nommées à partir du type de la carte
réseau, pas du type de la connexion. Vous pouvez voir l'initialisation
de votre carte pendant la procédure de démarrage, ou après celle-ci en
utilisant la commande <a
d182 1
a182 1
Comme vous pouvez le voir, à ce point <a
d184 1
a184 1
ifconfig(8)</a> nous fourni beaucoup plus d'informations que nécessaire.
d237 1
a237 1
de votre interface. A partir des informations des exemples précédents,
d500 1
a500 1
paquet ; auquel nous nous referrerons à présent sous le nom de PF) . PF
d503 2
a504 2
ainsi que d'être utilisé dans la création de puissants et flexibles pare-
feu. Tout ceci est décrit dans le <a href="../pf/fr/index.html"><b>Guide
d513 1
a513 1
configurer les interfaces réseaux automatiquement. OpenBSD peut être
d618 1
a618 1
La ligne incluant <tt>touch</tt> est nécessaire afin de créer un
d640 1
a640 1
dhcp-options(5)</a> Si vos clients DHCP ont besoin de plus d'options, reportez
d684 1
a684 1
Certaines de ces options ne sont pas obligatoires mais elles vous aideront
d735 1
a735 1
Maintenant, nous pouvons avancer et configurer les informations
d768 3
a770 3
timeout&quot; permet de couper la connexion après 120 secondes de non-
utilisation. L'option &quot;set ifaddr&quot; est un peu plus compliquée.
En voici une explication plus complête.
d790 1
a790 1
connexion ne demande explicitement l'adresse ``0.0.0.0''.
d798 2
a799 2
votre propre serveur DNS local car ppp empêchera les requêtes vers celui-
ci en remplaçant les lignes "nameserver" de votre fichier
d804 1
a804 1
utilisent à présent l'authentification CHAP ou PAP. Si c'est cas, notre
d825 1
a825 1
d'authentification CHAP ou PAP utilisé, ceci sera négocié
d835 1
a835 1
d'initier une connexion vers notre FAI. Je détaillerai certaines des
d863 1
a863 1
<i>/etc/ppp/ppp.linkdown</i>. Des exemples de configuration sont
d895 1
a895 1
Le protocole d'encapsulation PPP dans de l'Ethernet (PPPoE - "Point to Point
d897 1
a897 1
trames Ethernet. Le protocole d'encapsulation PPP dans de l'ATM (PPPoA - "Point
d909 1
a909 1
modem est capable de fonctionner en mode `bridge', il est possible d'activer ce
d918 1
a918 1
</a>, précédemment décrit). Une implémentation noyau du PPPoE, <a
d920 1
a920 1
</a>, a été ajouté dans OpenBSD -current ; cependant, elle ne sera pas
d933 2
a934 2
pptp quant à lui doit être installer en utilisant les <a href="faq8.html#Ports">
ports</a> ou les <a href="faq8.html#Packages">paquets</a>. De plus amples
d981 1
a981 1
protocole NetBIOS. Il s'agit d'un autre sysctl. <tt>sysctl net.inet.ip.directed-
d983 1
a983 1
href="http://www.netscan.org">"smurf attacks"</a> si vous voulez savoir
d991 1
a991 1
Il existe également un sysctl pour ceci. D'après <a
d1036 1
a1036 1
de pare-feu est configuré ain d'empêcher les accès extérieurs. Si vous
d1068 1
a1068 1
Cette configurarion consiste en un serveur d'adresse IP <b>10.0.0.1</b>. Ce
d1093 1
a1093 1
clients présents dans le réseau 10.0.0.0 utilisant un masque de
d1095 1
a1095 1
Ceci est important pour certains serveurs accessibles sur différents
d1106 1
a1106 1
manuellement. Ils doivent être lancés sous root et vous devez vérifier
d1164 1
a1164 1
existe aussi nfsstat(8) qui affiche beacoup plus de statistiques. Pour utiliser
d1184 1
a1184 1
une adress IP ; mount résoudra les noms d'hôtes) :
d1221 2
a1222 2
href="http://www.openbsd.org/cgi-bin/man.cgi?query=bridge&amp;sektion=4">bridge
</a>") est un lien entre deux (ou plusieurs) réseaux séparés. A
d1254 4
a1257 4
href="http://www.openbsd.org/cgi-bin/man.cgi?query=fxp&amp;sektion=4"><tt>fxp0
</tt></a>) et une carte 3c590-Combo (<a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=ep&amp;sektion=4"><tt>ep0
</tt></a>) pour le port coaxial. <tt>fxp0</tt> fait le lien avec le
d1336 1
a1336 1
de filtrer que sur l'une d'entre elles. Vos déclaration par défaut "Pass
d1458 1
a1458 1
(ceci n'est PAS obligatoire), le fichier <a
d1596 1
a1596 1
plus d'information sur les origines de CARP et les problèmes légaux
d1614 1
a1614 1
ereviennent avec les informations CARP.
d1617 1
a1617 1
A intervalles configurés, le maître annonce sont état sur le port IP
d1623 2
a1624 2
par défaut lorsque cela est faisable (ex. un hôte est un rapide Sun Fire
V120 et les autres sont des SPARCstation IPCs, comparativement plus
d1663 1
a1663 1
ifconfig(8)</a>. Regardons tout d'abord les sysctls.
d1849 1
a1849 1
Un temps exact est important pour plusieurs applications informatiques.
d1871 1
a1871 1
un temps exact sur votre ordinateur.
d2010 1
a2010 1
$Translation: faq6.html,v 1.57 2005/03/22 17:14:47 ajacoutot Exp $<br>
@


1.37
log
@sync with Steelix CVS
@
text
@d1914 4
a1917 2
Vous parlez probablement de
<a href="http://bradknowles.typepad.com/considered_harmful/2004/09/openntpd.html">Brad Knowles</a>.
d2011 2
a2012 2
Originally [OpenBSD: faq6.html,v 1.217 ]<br>
$Translation: faq6.html,v 1.56 2005/02/22 16:12:20 saad Exp $<br>
@


1.36
log
@sync with Steelix CVS
@
text
@d1355 2
a1356 2
l'interface <tt>fxp0</tt> en utilisant <tt>keep state<tt> pour prendre en charge
les données retournées :
d2010 1
a2010 1
$Translation: faq6.html,v 1.55 2005/02/05 11:21:33 ajacoutot Exp $<br>
@


1.35
log
@Sync with Steelix CVS
@
text
@d11 1
a11 1
<meta name= "copyright"     content= "This document copyright 1998-2004 by OpenBSD.">
d418 6
a423 5
routed(8)</a>, <a href="http://www.mrtd.net">mrtd</a>, et
<a href="http://www.zebra.org">zebra </a>. Sous OpenBSD, zebra et mrtd sont
disponibles en tant que ports. OpenBGPD et routed sont inclus dans le système de
base. OpenBSD supporte différentes interfaces T1, HSSI, ATM, FDDI, Ethernet, et
série (PPP/SLIP).
d433 4
a436 3
<i>/etc/hostname.&lt;if&gt;</i></a>. Ce fichier est lu au boot par le script <a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc&amp;sektion=8">/etc/rc(8)
</a> faisant partie de la séquence de démarrage <a
d2009 2
a2010 2
Originally [OpenBSD: faq6.html,v 1.215 ]<br>
$Translation: faq6.html,v 1.54 2005/02/02 08:40:33 ajacoutot Exp $<br>
@


1.34
log
@sync with Steelix CVS
@
text
@d415 2
a416 1
l'aide de programmes comme <a
d418 5
a422 5
routed(8)</a>, <a href="http://www.gated.org">gated</a>, <a
href="http://www.mrtd.net">mrtd</a>, et <a
href="http://www.zebra.org">zebra</a>. Sous OpenBSD, zebra, gated et mrtd sont
disponibles en tant que ports. OpenBSD supporte différentes interfaces
T1, HSSI, ATM, FDDI, Ethernet, et série (PPP/SLIP).
d2007 2
a2008 2
Originally [OpenBSD: faq6.html,v 1.214 ]<br>
$Translation: faq6.html,v 1.53 2005/01/23 10:50:14 ajacoutot Exp $<br>
@


1.33
log
@Sync with Steelix CVS
@
text
@d282 1
a282 1
inet 172.21.0.0 255.255.255.0 NONE vlan 2 vlandev fxp1
d736 1
a736 1
section en-dessous de <b>default:</b>. Le marqueur définissant cette
d1351 3
a1353 3
trafic entrant et sortant sur l'interface ep0, mais nous filtrerons sur
l'interface fxp0 en utilisant "keep state" pour prendre en charge les
données retournées :
d1769 1
a1769 1
rachael# <strong>sysctl net.inet.carp.preempt=1</strong>
d1775 1
a1775 1
pris# <strong>ifconfig carp0 advskew 100</strong>
d1798 2
a1799 3
rachael# <strong>ifconfig carp1 create</strong>
rachael# <strong>ifconfig carp1 vhid 2 advskew 100 pass bryant
192.168.0.7</strong>
d1807 3
a1809 3
pris# <strong>ifconfig create carp1</strong>
pris# <strong>ifconfig carp1 vhid 2 pass bryant 192.168.0.7</strong>
pris# <strong>sysctl net.inet.carp.preempt=1</strong>
d2006 2
a2007 2
Originally [OpenBSD: faq6.html,v 1.212 ]<br>
$Translation: faq6.html,v 1.52 2005/01/17 21:31:59 aanriot Exp $<br>
@


1.32
log
@Sync with Steelix CVS
@
text
@d2006 1
d2008 2
a2009 1
$Translation: faq6.html,v 1.51 2005/01/06 07:50:38 ajacoutot Exp $<br>
@


1.31
log
@Sync with Steelix CVS
@
text
@a55 1
<li><a href= "#PPTP"  >6.8 - Mise en place d'une connexion PPTP sous OpenBSD</a>
d875 63
a1213 123
<p>
<a name="PPTP"></a>
<h2>6.8 - Mise en place d'une connexion PPTP sous OpenBSD</h2>

<p>
<strong>NOTE :</strong> Cette section ne s'applique pas à
<strong>TOUS</strong> les fournisseurs ADSL, mais beaucoup d'informations
peuvent y être glanées. Cette configuration a été
confirmée comme fonctionnelle pour <a
href="http://www.inode.at">Inode</a>, un fournisseur d'accès autrichien
et <a href="http://www.kpn.nl">KPN</a>, un fournisseur d'accès
hollandais.

<p>
Pour commencer, vous devez installer pptp. Le port est situé sous
<i>/usr/ports/net/pptp</i>. Lisez la <a href="faq8.html#Ports">FAQ 8, Qu'est que
l'arborescences des ports ?</a> pour de plus amples renseignements concernant
l'arbre des ports sous OpenBSD.

<p>
Bien qu'il n'ait pas besoin de périphérique <a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=gre&amp;sektion=4">gre(4)</a>
, PPTP utilise l'encapsulation GRE. Afin de permettre au noyau de recevoir les
paquets encapsulés par GRE, lancez la commande suivante :
<blockquote><pre>
# sysctl net.inet.gre.allow=1
</pre></blockquote>
Puis ajoutez la ligne suivante dans votre fichier <i>/etc/sysctl.conf</i> :
<blockquote><pre>
net.inet.gre.allow=1
</pre></blockquote>
Ce qui permettra de sauvegarder ce changement au redémarrage.

<p>
Une fois le paquetage <b>pptp</b> installé et le fichier
<i>/etc/sysctl.conf</i> édité, vous devez renseigner un certain
nombre de fichiers afin de configurer votre connexion. Ce paquetage utilise le
<a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=ppp&amp;sektion=8">ppp(8)</a>
présent dans OpenBSD, donc si vous êtes familier avec l'utilisation
de celui-ci, la mise en place vous semblera similaire.
Référez-vous également à la <a href="#PPP">FAQ 6,
Protocole Point à Point</a>.

<ul>
<li>1 - /etc/ppp/options
<li>2 - /etc/ppp/pap-secrets
</ul>

<p>
En ce qui concerne le fichier <i>/etc/ppp/options</i>, la configuration suivante
devrait répondre à la plupart des besoins :

<blockquote><pre>
# <strong>cat /etc/ppp/options</strong>
name "LOGINNAME"
noauth
noipdefault
defaultroute
debug
</pre></blockquote>

<p>
<tt>LOGINNAME</tt> doit être remplacé par votre identifiant de
connexion.

<p>
Insérez une ligne similaire à celle qui suit dans
<i>/etc/ppp/pap-secrets</i> :

<blockquote><pre>
# <strong>cat /etc/ppp/pap-secrets</strong>
LOGINNAME 10.0.0.138 PASSWORD
</pre></blockquote>

<p>
Où LOGINNAME représente votre identifiant de connexion et PASSWORD
votre mot de passe. 10.0.0.138 est l'adresse IP de votre modem si
vous utilisez l'ADSL, etc. Veillez à ce que le fichier ne soit
accessible que par root et en lecture seule (mode 600).

<p>
<h3>6.8.1 - Assigner une adresse IP à votre interface</h3>

<p>
Dans l'exemple précédent, votre modem avait une adresse préconfigurée de
10.0.0.138. Nous devons maintenant assigner une adresse à NOTRE
interface. Il est préférable d'utiliser une adresse proche de celle
donnée à votre MODEM ou l'adresse IP statique qui vous est assignée.
Plus d'information sur la mise en place des interfaces est disponible
dans la <a href="#Setup">FAQ 6, Configuration initiale du réseau</a>.

<p>
Une fois votre interface configurée, vous devriez être en mesure de
créer une connexion pptp à l'aide de la commande :

<blockquote><pre>
# <strong>/usr/local/sbin/pptp 10.0.0.138 &amp;</strong>
</pre></blockquote>

<p>
Puisque ppp(8) est utilisé, deux processus sont démarrés.
Vous pouvez arrêter pptp en tuant ces deux processus :

<blockquote><pre>
# <strong>kill -9 [pid de pppd]</strong>
$ <strong>kill -9 [pid de pptp]</strong>
</pre></blockquote>

<p>
Il est recommandé d'ouvrir <tt>/var/log/messages</tt> dans un autre
terminal afin de diagnostiquer d'éventuels problèmes.

<blockquote>
<pre>
# <strong>tail -f /var/log/messages</strong>
</pre></blockquote>

<p>
Nous vous conseillons également de placer les commandes de
démarrage dans le fichier <i>/etc/rc.local</i> afin que la connexion soit
lancée à chaque fois que la machine démarre.

d2006 2
a2007 2
Originally [OpenBSD: faq6.html,v 1.210 ]<br>
$Translation: faq6.html,v 1.49 2005/01/01 21:10:40 aanriot Exp $<br>
@


1.30
log
@Sync with Steelix CVS
@
text
@d112 4
a115 4
Sous OpenBSD, les interfaces sont nommées à partir du type de la
carte réseau, pas du type de la connexion. Vous pouvez voir
l'initialisation de votre carte pendant la procédure de démarrage,
ou après celle-ci en utilisant la commande <a
d120 2
a121 2
ifconfig(8)</a>. Voici par exemple la sortie de la commande dmesg pour une carte
Intel Fast Ethernet qui utilise le nom de périphérique fxp.
d130 7
a136 7
Si vous ne connaissez pas le nom du périphérique associé
à votre carte, regardez dans la liste des <a
href="../../fr/plat.html">plates-formes actuellement supportées</a> par
votre architecture. Vous pourrez y trouver le nom des cartes les plus courantes
et leur équivalent sous OpenBSD. Ajoutez au nom alphabétique du
périphérique (par exemple fxp) le numéro assigné par
le noyau et vous aurez le nom de votre interface (par exemple fxp0).
d139 2
a140 2
Vous pouvez connaître quelles interfaces réseaux ont
été identifiées à l'aide de l'utilitaire <a
d144 2
a145 3
interface ethernet physique : <a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=fxp&amp;sektion=4">fxp(4)</a>
.
d189 4
a192 5
précédent, la carte est déja configurée. Ceci est
évident de part la présence d'une configuration réseau IP
pour fxp0, à savoir &quot;inet 10.0.0.38 netmask 0xffffff00 broadcast
10.0.0.255&quot;. Les indicateurs <strong>UP</strong> et
<strong>RUNNING</strong> sont également présents.
d196 2
a197 2
défaut. Il s'agit d'interfaces virtuelles servant différentes
fonctions. Les manuels suivants les décrivent :
d238 5
a242 5
Si votre interface n'est pas configurée, la première chose
à faire est de créer le fichier <i>/etc/hostname.xxx</i>,
où xxx représente le nom de votre interface. A partir des
informations des exemples précédents, le nom du fichier sera
<i>/etc/hostname.fxp0</i>. Le format de ce fichier est simple :<br>
d272 3
a274 3
que les deux extrémités de la connexion ne soient
configurées ainsi ! Si ce n'est pour des besoins spécifiques, la
configuration du type de media n'est pas nécessaire.)
d277 2
a278 2
Vous pouvez aussi vouloir utiliser des indicateurs spécifiques à
une certaine interface. Le format du fichier hostname ne change que très
d326 4
a329 4
routes sont déja présentes dans la table de routage du noyau. A
présent, votre système devrait être en état de
fonctionnement. Une nouvelle fois, vous pouvez vérifier que votre
interface a été correctement configurée avec <a
d336 4
a339 4
l'option -n de la commande route(8) qui affichera l'adresse IP plutôt que
d'effectuer une requête DNS et d'afficher le nom d'hôte. Voici un
exemple qui vous permettra de voir vos tables de routage en utilisant ces deux
programmes.
d377 5
a381 6
Voici les informations nécessaires à la mise en place d'une
passerelle OpenBSD (appelé aussi routeur). Si vous devez installer
OpenBSD pour en faire un routeur Internet, nous vous suggérons de lire
les instructions sur la mise en place du filtre de paquets (plus loin) afin de
bloquer le trafic non-autorisé. Avec le peu de disponibilité
d'adresses <a
d383 3
a385 3
la part des fournisseurs d'accès à Internet ainsi que des
registres Internet régionaux, vous pourriez vouloir vous renseigner sur
la translation d'adresses (NAT) afin d'économiser votre adressage IP.
d403 4
a406 5
directement l'utilitaire <a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&amp;sektion=8">
sysctl(8)</a>. Souvenez-vous que ce changement ne sera pas sauvegardé au
redémarrage et que vous devrez être root pour utiliser cette
commande.
d414 3
a416 3
A présent, modifiez les routes sur les hôtes aux deux
extrémités. Il existe beaucoup d'autres usages d'OpenBSD en tant
que routeur avec l'aide de programmes comme <a
d447 6
a452 6
alias. A la différence d'autres systèmes d'exploitation, OpenBSD
ne s'y réfère pas en tant que dc0:0, dc0:1. Si vous vous
référez à une adresse IP d'alias avec ifconfig ou si vous
ajoutez un alias, soyez sûr d'utiliser la commande "<tt>ifconfig int
alias</tt>" au lieu de "<tt>ifconfig int</tt>". Vous pouvez supprimer les alias
en utilisant "<tt>ifconfig int delete</tt>".
d455 2
a456 2
En admettant que vous utilisiez plusieurs adresses avec alias sur le même
sous-réseau IP, le masque correspondant à chaque alias devient
d460 2
a461 2
périphérique dc0, qui lui-même possède l'adresse
192.168.0.2 avec un masque de 255.255.255.0.
d471 3
a473 3
Après avoir édité ce fichier, il suffit de
redémarrer pour que les changements prennent effet. Mais vous pouvez
aussi créer les alias à la main en utilisant l'utilitaire <a
d498 8
a505 8
Sous OpenBSD, le filtrage du trafic TCP/IP ainsi que la translation d'adresses
(NAT) est pris en charge par "Packet Filter" (filtre de paquet ; auquel nous
nous referrerons à présent sous le nom de PF) . PF est aussi
capable de normaliser et de traiter le trafic TCP/IP, d'offrir une gestion de
la bande passante et une prioritarisation des paquets ainsi que d'être
utilisé dans la création de puissants et flexibles pare-feu. Tout
ceci est décrit dans le <a href="../pf/fr/index.html"><b>Guide de
l'Utilisateur PF</b></a>.
d512 5
a516 4
Le protocole d'attribution dynamique des adresses (DHCP) permet de configurer
les interfaces réseaux automatiquement. OpenBSD peut être serveur DHCP (afin de
configurer les autres machines), client DHCP (afin de recevoir sa configuration
à partir d'une autre machine) et, dans certains cas, les deux.
d525 3
a527 3
<tt>/etc/hostname.xl0</tt>  (sous-entendu que l'interface Ethernet soit xl0. La
vôtre pouvant être aussi bien ep0 que fxp0 ou encore autre chose ! )
Tout ce que vous avez besoin d'écrire dans ce fichier est
d725 8
a732 9
différents évênements. Le périphérique
utilisé est indiqué par &quot;set device&quot;. Il s'agit du port
sur lequel est présent notre modem. Dans cet exemple, le modem est
branché sur le port com 2. Ainsi, le port com 1 sera indiqué par
<i>/dev/cua00</i>. La vitesse de la connexion est précisée par
&quot;set speed&quot; et &quot;set dial&quot; renseigne nos paramètres de
numérotation. Avec ceci, nous pouvons changer l'expiration ("timeout") de
la connexion, etc. Ceci étant, cette ligne ne devrait pas tellement
varier.
d736 7
a742 7
spécifiques à notre FAI. Pour ce faire, nous allons rajouter une
autre section en-dessous de <b>default:</b>. Le marqueur définissant
cette nouvelle section pourra être ce que vous désirez - le plus
simple étant d'utiliser le nom de votre FAI. Ici, nous utiliserons
<b>myisp:</b> pour indiquer le commencement de la section correspondant à
notre FAI. Voici une configuration simple contenant le nécessaire afin de
nous connecter :
d757 7
a763 8
Ici nous avons fourni les éléments essentiels concernant ce FAI.
La première option, &quot;set phone&quot;, donne le numéro de
téléphone du FAI. Nos options d'ouverture de session sont
renseignées par &quot;set login&quot;. Notre "timeout" est égal
à 5 ; ce qui signifie que notre tentative de connexion expirera
après 5 secondes si aucune porteuse n'est trouvée. Dans le cas
contraire, &quot;login:&quot; sera envoyé avec notre nom d'utilisateur et
notre mot de passe.
d766 5
a770 5
Dans cet exemple, notre nom d'utilisateur est : ppp ; notre mot de passe est :
ppp. Ces valeurs doivent être changées. La ligne &quot;set
timeout&quot; permet de couper la connexion après 120 secondes de
non-utilisation. L'option &quot;set ifaddr&quot; est un peu plus
compliquée. En voici une explication plus complête.
d777 14
a790 15
La ligne précédente se définit avec le format suivant :
&quot;<b>set ifaddr [myaddr[/nn] [hisaddr[/nn] [netmask
[triggeraddr]]]]</b>&quot;. La première IP désigne l'adresse IP
que nous souhaitons nous voir attribuer. Si vous avez une adresse IP statique,
vous devez l'indiquer ici. Dans notre exemple, nous utilisons la notation /0 qui
dit qu'aucun "bit" de cette adresse ne doit forcément correspondre et que
celle-ci peut être changée. La deuxième adresse IP est celle
du FAI. La troisième option est notre masque de sous-réseau, ici
défini à 255.255.255.0. Si triggeraddr est renseigné, il
remplacera myaddr comme adresse IP utilisée pour la négociation
IPCP initiale. Cependant, seule une adresse incluse dans la gamme d'adressage
correspondant à myaddr sera acceptée. Ceci peut être utile
dans la négociation avec certaines implémentations PPP qui
n'attribuent pas d'adresse IP à moins que l'initiateur de la connexion ne
demande explicitement l'adresse ``0.0.0.0''.
d793 2
a794 2
L'option suivante &quot;add default HISADDR&quot; attribue comme route par
défaut l'adresse IP de votre FAI. Cette entrée permet d'ajuster
d796 5
a800 5
de celui-ci. &quot;enable dns&quot; est utilisé afin de
récupérer la liste des serveurs DNS du FAI. N'utilisez PAS cette
option si vous avez votre propre serveur DNS local car ppp empêchera les
requêtes vers celui-ci en remplaçant les lignes "nameserver" de
votre fichier <i>/etc/resolv.conf</i>.
d803 3
a805 3
A la place des méthodes traditionnelles de connexion, certains FAI utilisent à
présent l'authentification CHAP ou PAP. Si c'est cas, notre configuration sera
un peu différente:
d822 5
a826 4
Dans l'exemple précédent, nous spécifions notre nom d'utilisateur (ppp) et notre
mot de passe à l'aide des options authname et authkey, respectivement. Il n'est
pas nécessaire de spécifier le type d'authentification CHAP ou PAP utilisé, ceci
sera négocié automatiquement. "set login" signifie simplement de tenter de se
d847 7
a853 7

Si les commandes précédentes ne fonctionnent pas, lancez <i>/usr/sbin/ppp</i>
sans options, ce qui vous placera en mode interactif. Les options peuvent être
spécifiées une par une afin de diagnostiquer les erreurs et autres problèmes.
En utilisant la configuration précédente, ppp enregistrera les évênements dans
/var/log/ppp.log. Ce fichier de log ainsi que la page de manuel contiennent des
informations utiles.
d859 6
a864 5
Dans certaines situations, vous pourriez avoir besoin de lancer certaines
commandes au lancement ou à la coupure de votre connexion. Si vous vous
trouvez dans cette situation, il existe deux fichiers que vous pouvez
créer : <i>/etc/ppp/ppp.linkup</i> et <i>/etc/ppp/ppp.linkdown</i>. Des
exemples de configuration sont disponibles ici :
d885 4
a888 4
Généralement, vous utiliserez ceci en cas de problèmes de
routage ou de connexion. Bien sûr, pour que cette configuration soit la
plus effective, les deux extrémités de la connexion doivent
utiliser des valeurs similaires.
d891 2
a892 1
Pour optimiser ceci, utilisez <tt>sysctl</tt> et augmentez les valeurs de :
d912 2
a913 2
réseaux sur lesquels vous êtes connecté si vous utilisez
OpenBSD en tant que routeur.
d916 6
a921 7
Dans certaines situations, sur des réseaux fermés, cette option
peut-être utile, surtout lors de l'utilisation de vieilles
implémentations du protocole NetBIOS. Il s'agit d'un autre sysctl.
<tt>sysctl net.inet.ip.directed-broadcast=1</tt> active cette option. Lisez la
section sur les <a href="http://www.netscan.org">"smurf attacks"</a> si vous
voulez savoir pourquoi cette option est désactivée par
défaut.
d933 4
a936 5
Définie la liste des ports TCP ne devant pas être alloués
dynamiquement par le noyau. Ceci peut être utile afin d'éviter
l'appropriation d'un port spécifique dont un autre programme a besoin
pour fonctionner. Les éléments listés peuvent être
séparés par une virgule et/ou un espace.
d952 3
a954 3
NFS ("Network File System") est utilisé afin de partager un
système de fichiers à travers un réseau. Voici un certain
nombre de manuels à lire avant la mise en place d'un serveur NFS :
d969 20
a988 21
Cette section détaillera les étapes nécessaires à la
mise en oeuvre d'une configuration NFS simple. Cet exemple détaille un
serveur et ses clients NFS sur un LAN. Il ne s'agit pas d'étudier la
sécurisation de NFS. Nous assumerons que le filtre de paquets (PF) ou
qu'un autre type de pare-feu est configuré ain d'empêcher les
accès extérieurs. Si vous autorisez l'accès à votre
serveur NFS depuis l'extérieur et que vous hébergez des
données sensibles, nous vous conseillons fortement d'utiliser IPsec.
Autrement certaines personnes pourraient voir ce qui transite dans votre trafic
NFS. Quelqu'un pourrait également usurper l'adresse IP que vous autorisez
à se connecter à votre serveur NFS. Plusieurs types d'attaques
peuvent en découler. Mais lorsqu'IPsec est correctement configuré,
il offre une protection contre ces attaques.

<p>
Autre note concernant la sécurité. Ne vous contentez pas juste
d'ajouter un système de fichiers dans <i>/etc/exports</i> sans mettre en
place une liste recensant les hôtes autorisés à se
connecter. Sans une liste d'hôtes autorisés à monter un
répertoire particulier, n'importe qui, capable de vous atteindre, sera en
mesure de monter vos systèmes de fichiers exportés par NFS.
d1026 8
a1033 8
accessible par NFS. L'option <tt>-alldirs</tt> permet au client de monter
n'importe quel répertoire sous le point de montage <tt>/work</tt>.
L'option <tt>-ro</tt> exporte le système de fichiers en lecture seule.
Les deux derniers arguments spécifient que seuls les clients
présents dans le réseau 10.0.0.0 utilisant un masque de
255.255.255.0 seront autorisés à monter ce système de
fichiers. Ceci est important pour certains serveurs accessibles sur
différents réseaux.
d1036 5
a1040 5
Une fois que votre fichier <i>/etc/exports</i> est configuré, vous pouvez
mettre en place votre serveur NFS. Tout d'abord, vérifiez que les options
NFSSERVER &amp; NFSCLIENT sont bien présentes dans votre fichier de
configuration noyau. (Le noyau GENERIC inclus ces options.) Ensuite, il vous
faut inclure la ligne <tt>nfs_server=YES</tt> dans le fichier
d1042 7
a1048 7
mountd(8) au redémarrage. A présent, vous pouvez lancer les
démons manuellement. Ils doivent être lancés sous root et
vous devez vérifier que portmap(8) est bien démarré sur
votre système. Voici un exemple de lancement de nfsd(8) servant les
requêtes TCP et UDP et utilisant 4 démons. Vous devriez utiliser un
nombre approprié de démons NFS en fonction du nombre maximum de
connexions concurrentes que vous souhaitez servir.
d1055 4
a1058 4
Vous devez non seulement démarrer le serveur nfsd(8) mais
également mountd(8). Il s'agit du service qui se charge de passer les
requêtes de montage à NFS. Pour démarrer mountd(8), soyez
sûr qu'un fichier mountdtab vide existe puis lancez le démon :
d1078 2
a1079 3
Maintenant, vous pouvez vérifier que tous ces démons sont
lancés et enregistrés avec RPC. Pour ce faire, utilisez
rpcinfo(8).
d1138 3
a1140 2
NFS au boot !!! Les autres options standards, comme noexec, nodev, nosuid
peuvent être employées lorsqu'elles sont applicables. Par exemple :
d1147 4
a1150 4
Ainsi, aucun périphérique ni programme setuid présent sur
le serveur NFS ne peut compromettre la sécurité du client. Si vous
ne montez pas de programmes que vous souhaitez utiliser sur le client NFS,
ajoutez l'option noexec à cette ligne.
d1229 2
a1230 2
votre mot de passe. 10.0.0.138 étant l'adresse IP de votre modem au cas
où vous utiliseriez l'ADSL, etc. Faites attention que ce fichier ne soit
d1237 6
a1242 7
Dans l'exemple précédent, votre modem avait une adresse
préconfigurée de 10.0.0.138. Nous devons maintenant assigner une
adresse à NOTRE interface. Il est préférable d'utiliser une
adresse proche de celle donnée à votre MODEM ou l'adresse IP statique
qui vous est assignée. Plus d'information sur la mise en place des
interfaces est disponible dans la <a href="#Setup">FAQ 6, Configuration initiale
du réseau</a>.
d1282 7
a1288 9
</a>") est un lien entre deux (ou plusieurs) réseaux
séparés. A l'inverse d'un routeur, les paquets sont
transférés à travers le pont de manière "invisible"
-- au niveau logique, les deux segments de réseau semblent n'en faire
qu'un de chaque côtè du pont. Le pont ne transfèrera que les
paquets passant d'un segment à l'autre, ce qui entre autres, permet de
réduire le trafic sur un réseau complexe tout en permettant
à n'importe quel noeud d'accéder à un autre en cas de
besoin.
d1292 6
a1297 6
d'un pont peut, ou non ,posséder une adresse IP. Si c'est le cas,
l'interface aura deux modes d'opération, l'un comme faisant parti du pont
et l'autre se comportant comme une interface normale. Si aucune interface ne
possède d'adresse IP, le pont fera transiter le trafic mais ne sera pas
administrable par le réseau (ce qui peut être une
fonctionnalité voulue).
d1303 7
a1309 9
Un des mes racks possède un certain nombre d'anciens systèmes,
lesquels ne sont pas équipés de carte réseau 10BASE-TX.
Bien qu'ils possèdent des ports AUI ou AAUI, ma réserve de
transmetteurs est limitée à des câbles coaxiaux. Une des
machines de cette rangée est un serveur d'accès terminal sous
OpenBSD, toujours allumée et connectée au réseau à
haut débit. L'ajout d'une seconde carte équipée d'un port
coaxial permettra d'utiliser cette machine comme un pont vers le réseau
coaxial.
d1317 2
a1318 2
</tt></a>) pour le port coaxial. <tt>fxp0</tt> fait le lien avec le reste du
réseau et possède donc une adresse IP, <tt>ep0</tt>, ne faisant
d1321 2
a1322 2
présentes sur le reste du réseau. A présent, voyons comment
arriver à ce résultat.
d1325 3
a1327 3
Le fichier <tt>hostname.fxp0</tt> contient les informations concernant la carte
<tt>fxp0</tt>. Cette machine est configurée pour DHCP, donc le fichier
ressemble à celui-ci :
d1340 2
a1341 2
Comme vous pouvez le deviner, la configuration de la carte <tt>ep0</tt> est un
peu différente :
d1360 5
a1364 4
A présent, il nous faut paramétrer le pont. Un pont est
initialisé par l'existence d'un fichier du type <a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=bridgename.if&amp;sektion=5">
<tt>bridgename.bridge0</tt></a>.  Dans ma situation, voici un exemple possible :
d1377 3
a1379 4
fxp0 et ep0 et de l'activer. Est-ce que l'ordre dans lequel les cartes sont
énoncées est important ? Non, souvenez-vous qu'un pont est
très symétrique -- les paquets entrent et sortent dans les deux
directions.
d1388 2
a1389 2
évoqué, il est probable que vous souhaitiez FAIRE quelquechose
avec les paquets qui le traversent. Comme vous pouvez vous en douter, <a
d1394 4
a1397 4
Gardez à l'esprit que de part la nature d'un pont, les mêmes
données traversent les deux interfaces, ce qui signifie que vous n'avez
besoin de filtrer que sur l'une d'entre elles. Vos déclaration par
défaut "Pass all" ressembleront à l'exemple suivant :
d1410 5
a1414 5
vieux systèmes évoqués précédemment, ne
permettant qu'aux protocoles Web et SSH de les atteindre. Dans ce cas, nous
allons autoriser tout le trafic entrant et sortant sur l'interface ep0, mais
nous filtrerons sur l'interface fxp0 en utilisant "keep state" pour prendre en
charge les données retournées :
d1432 4
a1435 4
Notez que cette règle bloquera tout, à l'exception des
requêtes entrantes HTTP et SSH, vers la machine qui fait le pont ainsi
qu'en direction des autres noeuds "derrière" elle. Il est possible
d'obtenir d'autres résultats en filtrant sur l'autre interface.
d1449 12
a1460 12
interface. Bien qu'il soit possible de filtrer sur les deux, vous devez vraiment
en connaître toutes les implications avant de pouvoir le faire de la bonne
manière.

<li>En utilisant l'option <i>blocknonip</i> de <a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=brconfig&amp;sektion=8">
brconfig(8)</a> ou dans <a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=bridgename.if&amp;sektion=5">
bridgename.bridge0</a>, vous pouvez empêcher le trafic non-IP (comme IPX
ou NETBEUI) de passer oûtre votre filtre. Dans certaines situations, cela
peut-être important et vous devez savoir qu'un pont fonctionne pour tous
les types de trafic, pas seulement IP.
d1463 6
a1468 7
"Promiscuous" -- elles écoutent TOUT le trafic réseau, pas
seulement celui leur étant dirigé. Ceci augmentera la charge du
processeur et du bus. Certaines cartes ne fonctionnent pas correctement dans ce
mode, le circuit TI ThunderLAN (<a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=tl&amp;sektion=4">tl(4)</a>)
en est un exemple.
</ul>
d1473 12
a1484 14
démarrage) permet de démarrer un ordinateur à partir du
réseau plutôt que d'un disque dur, une disquette ou un CD-ROM. A
l'origine, cette technologie a été développée par
Intel mais est maintenant supportée par la plupart des contrôleurs
réseau et des constructeurs. Sachez qu'il existe plusieurs protocoles de
démarrage par le réseau, PXE étant relativement
récent. Traditionnellement, un démarrage PXE est effectué
en utilisant des ROMs présentes sur la carte réseau ou la carte
mère elle-même, mais plusieurs disquettes permettant de
démarrer en PXE sont disponibles sur différentes sources. Beaucoup
de ROMs présentes sur des anciens contrôleurs supportent le
démarrage en réseau mais sont imcompatibles avec PXE ; s'il est
équipé de tels contrôlleurs, un système OpenBSD/i386
ou amd64 ne pourra pas être démarré à par le
d1509 6
a1514 6
contrôleur compatible avec un démarrage PXE. Certaines
documentations précisent que toutes les cartes modernes sont compatibles
PXE, mais c'est tout simplement faux -- de nombreux systèmes à
bas prix n'incluent pas de ROMs PXE ou utilisent un ancien protocole de
démarrage sur réseau. Vous avez également besoin d'un
serveur <a href="#DHCP">DHCP</a> configuré ainsi qu'un serveur TFTP.
d1553 2
a1554 2
Retirez simplement le caractère '#' et envoyez à inetd(8) un
signal -HUP afin que celui-ci relise son fichier <tt>/etc/inetd.conf</tt>. Les
d1556 4
a1559 4
particulier, ici <tt>/tftpboot</tt>, que nous utiliserons pour cet exemple. Bien
évidemment, ce répertoire doit être créé et
contenir les fichiers nécessaires. Pour un démarrage PXE, vous
n'aurez typiquement besoin que de quelques fichiers :
d1578 6
a1583 7
souhaiteriez démarrer un noyau ne se nommant pas <tt>bsd</tt>, ou que les
options par défaut de pxeboot ne vous conviennent pas (par exemple si vous
utilisez une console série). Vous pouvez tester
votre serveur tftpd(8) en utilisant un client
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tftp&amp;sektion=1">
tftp(1)</a> afin de vérifier que vous pouvez bien récupérer
les fichiers nécessaires.
d1586 5
a1590 5
Une fois vos serveurs DHCP et TFTP démarrés, vous êtes
prêt pour un essai. Vous devez activer PXE sur votre système ou
votre carte réseau ; consultez la documentation fournie avec votre
matériel. Une fois que PXE est activé, vous devriez voir
apparaître des lignes similaires à celles-ci :
d1609 2
a1610 2
simplement "<tt>bsd.rd</tt>" pour récupérer le fichier homonyme
à partir du serveur TFTP.
d1628 2
a1629 2
Le noyau d'installation <a name="faq4.html#bsd.rd">bsd.rd</a> va maintenant se
lancer.
d1695 2
a1696 2
matérielle : si cela ne fonctionne pas, vous pouvez basculer sur le reste
du groupe jusqu'à ce que le problème soit résolu.
d1699 1
a1699 1
il existe cependant certaines situations où CARP ne pourra pas vous
d1708 5
a1712 6
travers de "procédés alternatifs" tels que <a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfsync&amp;sektion=4">
pfsync(4)</a> (pour du filtrage redondant), <a
href="http://rsync.samba.org/">rsync</a>, pour dupliquer manuellement
les données entre les machines, ou tout ce qui semble approprié à votre
application.
d1726 1
a1726 1
La première variable sysctl, <tt>net.inet.carp.allow</tt>, définie si
d1734 4
a1737 4
activée, CARP effectue une empreinte (hashage) de l'IP originatrice de
la requête. Cette empreinte est ensuite utilisée pour sélectionner à
partir du groupe l'hôte virtuel qui prendra en charge cette requête.
Cette fonctionnalité est désactivée par défaut.
d1752 3
a1754 3
Toutes ces variables sysctl sont documentées dans <a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&amp;sektion=3">
sysctl(3)</a>.
d1778 1
a1778 1
simple. Admettons que vous déploiez deux serveurs Web identiques,
d1807 8
a1814 8
Mais admettons que vous ne déploiiez pas cette solution à partir de
zéro. <i>Rachael</i> était déja en place à l'adresse 192.168.0.7.
Comment allez-vous gérer cette situation ? Heureusement, CARP ne pose
pas de problème si un système possède la même adresse IP sur son
interface physique et dans un groupe CARP, donc il n'est pas nécessaire
de changer les commandes précédentes. Cependant, il est plus propre
d'avoir une adresse IP différente pour chaque systèm, cela rend les
accès et la surveillance individuels bien plus simples.
d1912 4
a1915 4
est plus précise que leur ordinateur à 2000 euros.
Certes, connaître la date et l'heure est une chose importante. Mais
souvent, il est plus important de synchroniser plusieurs machines afin
qu'elles s'accordent sur la date et l'heure actuelles.
d1929 8
a1936 8
<a href="http://www.openntpd.org">OpenNTPD</a> est une tentative pour résoudre
certains de ces problèmes en créant un programme compatible NTP qui soit facile
à administrer, sûr, simple et qui vous permette d'avoir un temps exact sur votre
ordinateur.
Le service
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ntpd&amp;sektion=8">ntpd(8)</a>
d'OpenBSD est contrôlé à travers le fichier de configuration
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ntpd.conf&amp;sektion=5"><tt>/etc/ntpd.conf</tt></a>
d1951 5
a1955 5
; il pourra s'écouler <i>plusieurs heures</i> (ou jours, voire même plus) avant
de synchroniser correctement une horloge retardant de quelques minutes
(<i>-current</i> ajustera immédiatement l'horloge au démarrage de la machine).
Une fois votre horloge réglée de manière précise, ntpd la gardera à un
haut degré d'exactitude.
d1965 3
a1967 4
Si vous avez réellement besoin d'une précision de l'ordre de la
micro-seconde, alors OpenNTPD n'est pas pour vous. Utilisez plutôt le
ntpd de ntp.org. Ce dernier restera disponible dans les ports et comme
package.
d1977 4
a1980 4
résultats avec OpenNTPD par rapport au programme ntpd de ntp.org.
Si la sécurité est importante, le code d'OpenNTPD est beaucoup plus
lisible (et donc auditable) et a été écrit en utilisant les appels de
fonction natifs d'OpenBSD tels que 
d1985 6
a1990 5
Il a été écrit avec des principes sécurité dès le début. La sécurité n'a pas été
ajoutée par la suite. Si le fait d'amener autant de personnes que possible à
utiliser la synchronisation du temps est une chose précieuse, OpenNTPD rend une
telle entreprise très facile pour beaucoup de personnes. Si cela est "nuisible",
alors nous souhaitons ce genre de nuisance.
d1993 3
a1995 3
Il y a des applications pour lesquelles le programme ntpd de ntp.org est plus
approprié, cependant nous croyons qu'OpenNTPD est plus que suffisant pour les
95% d'utilisateurs restants.
d2017 15
a2031 14
Les adaptateurs basés sur ces composants peuvent être utilisés de la même façon
que n'importe quel autre adaptateur réseau pour connecter un système OpenBSD à
un réseau sans fil existant (prière de consulter les pages du manuel pour des
détails précis). Cependant, les cartes à base de Prism2 et Prism3, peuvent aussi
être utilisées en mode "Host-Based Access Point", ce qui leur permet d'être
utilisées comme un point d'accès sans fil pour votre réseau, intégré à votre
pare-feu. Malheureusement, les cartes réseau à base de Prism2/Prism3 ne sont
plus produites par les fabricants du marché de masse. En effet ces derniers
utilisent maintenant des composants plus récents et à moindre coût souvent <a
href="#GenSupport">sans modifier le numéro de série.</a> La plupart des
fabricants des nouveaux composants ont choisi de ne pas publier la documentation
nécessaire pour produire des pilotes libres et ouverts pour ces périphériques
(vous pouvez les contacter et essayer de les convaincre de changer leur
politique).
d2035 16
a2050 16
D'un autre côté, les adaptateurs Prism2/Prism3 sont encore disponibles sur les
marchés d'occasion et de surplus et quelques usines comprennent la valeur d'un
composant correctement documenté et compatible avec le logiciel libre et
continuent de produire des adaptateurs à base de Prism de qualité
professionnelle. Parmi celles-ci, on peut citer <a
href="http://www.netgate.com">Netgate.com</a>. De manière générale, si le
fabricant n'identifie pas de manière explicite un produit récent comme étant un
produit à base de Prism, vous pouvez estimer qu'il n'est pas compatible avec le
pilote wi(4). Il est à noter que les nouveaux composants Prism (tels que le
Prism-GT) ne sont pas encore supportés.

<p>
Une autre méthode pour permettre à un pare-feu OpenBSD de fournir un accès sans
fil est d'utiliser une carte conventionnelle et un point d'accès externe en mode
pont. Cette méthode a l'avantage de vous permettre de positionner l'antenne là
où elle est la plus efficace.
d2068 1
a2068 1
$Translation: faq6.html,v 1.48 2004/12/25 10:58:34 ajacoutot Exp $<br>
@


1.29
log
@Sync with Steelix CVS
@
text
@d2002 5
a2006 6
Il a été écrit avec des principes sécurité dès le début. La sécurité n'a
pas été ajoutée par la suite. Si le fait d'amener autant de personnes
que possible à utiliser la synchronisation du temps est une chose
précieuse, OpenNTPD rend une telle entreprise très facile pour beaucoup
de personnes.
Si cela est "nuisible", alors nous souhaitons ce genre de nuisance.
d2009 3
a2011 3
Il y a très certainement des applications pour lesquelles le programme
ntpd de ntp.org est plus approprié, cependant nous croyons qu'OpenNTPD
est plus que suffisant pour les 95% d'utilisateurs restants.
d2082 2
a2083 2
Originally [OpenBSD: faq6.html,v 1.209 ]<br>
$Translation: faq6.html,v 1.47 2004/12/22 13:21:05 ajacoutot Exp $<br>
@


1.28
log
@sync with Steelix CVS
@
text
@d2014 6
d2083 2
a2084 2
Originally [OpenBSD: faq6.html,v 1.208 ]<br>
$Translation: faq6.html,v 1.46 2004/12/10 13:20:37 ajacoutot Exp $<br>
@


1.27
log
@Sync with Steelix CVS
@
text
@d662 1
a662 1
 - Qui est l'implémentation noyau du démon ppp.
d665 1
a665 1
 - Qui est l'implémentation ppp en espace utilisateur ("userland"). 
d669 8
a676 2
Le premier que nous allons aborder est le démon PPP en espace
utilisateur. Pour commencer, vous aurez besoin de certaines informations
a696 2
Si vous n'utilisez pas le noyau GENERIC, soyez sûr d'inclure cette ligne
dans le fichier de configuration de votre noyau :
a697 5
<blockquote><pre><strong>
pseudo-device   tun
</strong></pre></blockquote>

<p>
d703 1
a703 1
pouvez vous inspirer du fichier <i>/etc/ppp/ppp.conf.sample</i>  afin de
d809 27
d852 7
a858 4
Lancer <i>/usr/sbin/ppp</i> sans options vous placera en mode interactif. A
partir de là, vous pouvez intéragir directement avec le modem ;
ceci peut être très utile pour corriger les erreurs dans votre
fichier <i>ppp.conf</i>.
a879 6
Plus d'informations peuvent être trouvées dans la section <a
href="http://www.freebsd.org/doc/fr_FR.ISO8859-1/books/handbook/userppp.html">
"User PPP" du Manuel de Référence ("Handbook") de FreeBSD</a>.


<p>
d2077 2
a2078 2
Originally [OpenBSD: faq6.html,v 1.207 ]<br>
$Translation: faq6.html,v 1.45 2004/12/04 09:16:17 ajacoutot Exp $<br>
@


1.26
log
@Sync with Steelix CVS
@
text
@d1942 1
a1942 1
car ntpd(8) ajuste l'horloge lentement en utilisant
d1944 3
a1946 3
; il pourra s'écouler plusieurs heures (ou jours, voire même plus) avant de
synchroniser correctement une horloge mal réglée (<i>-current</i>
ajustera immédiatement l'horloge au démarrage de la machine).
d2054 2
a2055 2
Originally [OpenBSD: faq6.html,v 1.206 ]<br>
$Translation: faq6.html,v 1.44 2004/11/28 23:48:53 ajacoutot Exp $<br>
@


1.25
log
@Sync with Steelix CVS
@
text
@d144 1
a144 1
interface ethernet physique: <a
d199 1
a199 1
fonctions. Les manuels suivants les décrivent:
d244 1
a244 1
<i>/etc/hostname.fxp0</i>. Le format de ce fichier est simple:<br>
d257 1
a257 1
à:
d315 1
a315 1
tapant (en tant que root):
d441 1
a441 1
informations importantes:
d480 1
a480 1
suivante:
d487 1
a487 1
Pour voir les alias, utilisez la commande suivante:
d531 1
a531 1
'<tt>dhcp</tt>':
d545 1
a545 1
lancez la commande:
d613 1
a613 1
commandes, une fois <tt>/etc/dhcpd.conf</tt> configuré, tapez:
d633 1
a633 1
<tt>/etc/dhcpd.conf</tt>:
d692 1
a692 1
dans le fichier de configuration de votre noyau:
d708 1
a708 1
par défaut:
d725 1
a725 1
verbosité des logs. Il peut être changé:
d747 1
a747 1
nous connecter:
d772 1
a772 1
Dans cet exemple, notre nom d'utilisateur est: ppp ; notre mot de passe est:
d783 1
a783 1
La ligne précédente se définit avec le format suivant:
d815 1
a815 1
options les plus utilisées:
d838 2
a839 2
créer: <i>/etc/ppp/ppp.linkup</i> et <i>/etc/ppp/ppp.linkdown</i>. Des
exemples de configuration sont disponibles ici:
d872 1
a872 1
Pour optimiser ceci, utilisez <tt>sysctl</tt> et augmentez les valeurs de:
d911 1
a911 1
sysctl(8)</a>:
d936 1
a936 1
nombre de manuels à lire avant la mise en place d'un serveur NFS:
d997 1
a997 1
à:
d1041 1
a1041 1
sûr qu'un fichier mountdtab vide existe puis lancez le démon:
d1051 1
a1051 1
un signal HUP:
d1087 1
a1087 1
exemple:
d1105 1
a1105 1
une adress IP ; mount résoudra les noms d'hôtes):
d1113 1
a1113 1
ajoutez la ligne suivante dans votre <i>/etc/fstab</i>:
d1123 1
a1123 1
peuvent être employées lorsqu'elles sont applicables. Par exemple:
d1140 1
a1140 1
<strong>NOTE:</strong> Cette section ne s'applique pas à
d1158 1
a1158 1
paquets encapsulés par GRE, lancez la commande suivante:
d1162 1
a1162 1
Puis ajoutez la ligne suivante dans votre fichier <i>/etc/sysctl.conf</i>:
d1186 1
a1186 1
devrait répondre à la plupart des besoins:
d1203 1
a1203 1
<i>/etc/ppp/pap-secrets</i>:
d1230 1
a1230 1
créer une connexion pptp à l'aide de la commande:
d1238 1
a1238 1
Vous pouvez arrêter pptp en tuant ces deux processus:
d1315 1
a1315 1
ressemble à celui-ci:
d1329 1
a1329 1
peu différente:
d1351 1
a1351 1
<tt>bridgename.bridge0</tt></a>.  Dans ma situation, voici un exemple possible:
d1385 1
a1385 1
défaut "Pass all" ressembleront à l'exemple suivant:
d1402 1
a1402 1
charge les données retournées:
d1511 1
a1511 1
dhcpd.conf</a> de votre serveur DHCP devra contenir la ligne suivante:
d1516 1
a1516 1
travail. Par exemple:
d1539 1
a1539 1
<tt>inetd.conf</tt> qui devrait vous satisfaire:
d1550 1
a1550 1
n'aurez typiquement besoin que de quelques fichiers:
d1582 1
a1582 1
apparaître des lignes similaires à celles-ci:
d1687 1
a1687 1
matérielle: si cela ne fonctionne pas, vous pouvez basculer sur le reste
d1712 1
a1712 1
Le contrôle de CARP s'effectue en deux endroits:
d1774 1
a1774 1
à l'adresse 192.168.0.7. Les commandes:
d1785 1
a1785 1
<tt>/etc/hostname.carp0</tt> ressemblant à:
d1812 1
a1812 1
peuvent nous pousser à cela: différences matérielles, simple préjudice,
d1826 1
a1826 1
<p>Configurons également <i>pris</i>:
d1839 1
a1839 1
similaire à: <blockquote><pre> pass on fxp0 proto carp keep state
d1849 1
a1849 1
et un nouveau groupe CARP sur <i>rachael</i>:
d1859 1
a1859 1
nouvelle interface, puis activer la variable sysctl "preempt":
d1876 1
a1876 1
l'avons vu précédemment:
d1886 1
a1886 1
sur les deux machines: CARP utilise une empreinte de l'IP originatrice
d1993 1
a1993 1
OpenBSD supporte un certain nombre de chipsets sans fil:
d2055 1
a2055 1
$Translation: faq6.html,v 1.43 2004/11/21 00:38:19 ajacoutot Exp $<br>
@


1.24
log
@Sync with Steelix CVS
@
text
@d579 2
a580 3
ligne <tt>dhcpd_flags="-q"</tt>. Placez le nom des interfaces sur lesquelles
vous souhaitez que le serveur écoute, dans le fichier
<tt>/etc/dhcpd.interfaces</tt>.
d1482 1
a1482 1
Tout d'abord, il serait sage de savoir <a href="../faq14.html#Boot386">comment
d2054 2
a2055 2
Originally [OpenBSD: faq6.html,v 1.204 ]<br>
$Translation: faq6.html,v 1.40 2004/11/11 14:02:24 ajacoutot Exp $<br>
@


1.23
log
@Sync with Steelix CVS
@
text
@d61 2
d1992 49
d2055 2
a2056 2
Originally [OpenBSD: faq6.html,v 1.203 ]<br>
$Translation: faq6.html,v 1.39 2004/11/04 09:22:51 ajacoutot Exp $<br>
@


1.22
log
@sync with Steelix CVS
@
text
@d1946 1
a1946 1
une fois votre horloge réglée de manière précise, ntpd la gardera à un
a1990 2


d2004 2
a2005 2
Originally [OpenBSD: faq6.html,v 1.202 ]<br>
$Translation: faq6.html,v 1.37 2004/11/03 14:40:37 saad Exp $<br>
@


1.21
log
@Sync with Steelix CVS
@
text
@d24 1
a24 1
<a href="../faq7.html">[Section 7 - Contrôles du clavier et de l'affichage]</a></font>
d1912 1
a1912 1
disponible dans le système des <a href="../faq8.html#Ports">ports</a>,
d1997 1
a1997 1
<a href="../faq7.html">[Section 7 - Contrôles du clavier et de l'affichage]</a></font>
d2007 1
a2007 1
$Translation: faq6.html,v 1.35 2004/11/01 09:25:43 ajacoutot Exp $<br>
@


1.20
log
@sync with Steelix CVS
@
text
@d1921 4
a1924 4
<a href="http://www.openntpd.org">OpenNTPD</a> est une tentative pour
résoudre certains de ces problèmes en créant un programme compatible
NTP qui est facile à administrer, sûr et simple et qui vous permet
d'avoir un temps exact sur votre ordinateur.
d1927 2
a1928 2
d'OpenBSD est contrôlé à travers un fichier de configuration
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ntpd.conf&amp;sektion=5"><tt>/etc/ntpd.conf</tt></a>.
d1941 1
a1941 1
vu que ntpd(8) ajuste l'horloge lentement en utilisant
d1943 1
a1943 1
-- il pourra s'écouler plusieurs heures (ou jours ou même plus) avant de
d1951 1
a1951 1
ntp.org!"</h3>
d1965 1
a1965 1
<h3>6.12.2 - "Quelqu'un a prétendu qu'OpenNTPD est 'nuisible'!"</h3>
d2007 1
a2007 1
$Translation: faq6.html,v 1.34 2004/10/31 23:42:46 ajacoutot Exp $<br>
@


1.19
log
@Sync with Steelix CVS
@
text
@d1904 2
a1905 2
est plus préciser que leur ordinateur à 2000 euros.
Certes, Connaître la date et l'heure est une chose importante. Mais
d1913 1
a1913 1
et qui peut être utiliser pour synchroniser les horloges des machines à
d1962 1
a1962 1
intégrant tous les fonctionnalités possible et imaginables.
d2007 1
a2007 1
$Translation: faq6.html,v 1.33 2004/10/31 21:12:09 saad Exp $<br>
@


1.18
log
@Sync with Steelix CVS
@
text
@d60 1
d205 1
a205 2
href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflog&amp;sektion=4&amp;manpa
th=OpenBSD+3.5">pflog</a>
d616 1
a616 1
     # <b>dhcpd -q fxp0</b>
d626 1
a626 3
répondre aux requêtes DHCP. L'option <tt>-q</tt> fait
démarrer le serveur dhcpd(8) en mode silencieux, sinon celui-ci est
très verbeux.
d1615 1
a1615 1
    OpenBSD 3.5 (RAMDISK_CD) #25: Thu Mar 19 23:16:56 EST 2004
d1627 1
a1627 1
Oui, bien qu'avec les outils actuellement présents dans OpenBSD 3.5, le
d1638 12
a1649 10
CARP ("Common Address Redundancy Protocol") est un outil aidant à la redondance
du système en ayant plusieurs ordinateurs créant une interface réseau unique
entre eux, afin que si l'un d'eux ne fonctionne plus, un autre puisse répondre à
sa place ; cet outil permet aussi de mettre en place un certain partage de
charge entre les différents systèmes. CARP est une avancée par rapport au VRRP
("Virtual Router Redundancy Protocol" - protocole de redondance de routeur
virtuel) standard. Il a été développé une fois que VRRP fut considéré comme non
suffisamment libre à cause d'un brevet Cisco pouvant le couvrir. Pour plus
d'information sur les origines de CARP et les problèmes légaux entourant VRRP,
rendez-vous sur <a href="../../lyrics.html#35">cette page</a>.
d1653 47
a1699 42
Shalayeff, Marco Pfatschbacher et Markus Friedl) a conçut CARP de manière à
être fondamentalement différent. Si l'inclusion de la cryptographie reste le
changement le plus visible, il n'en reste pas moins un seul parmi beaucoup d'
autres.

<p>
Comment fonctionne-t-il ? CARP est un protocole multicast. Il regroupe plusieurs
systèmes physiques en une ou plusieurs adresses virtuelles. L'un d'eux est le
maître et répond aux paquets destinés au groupe, alors que les autres se
comportent comme des "hot spares" (remplacement à chaud et automatique du
maître). Peut importe les adresses IP et MAC de l'interface physique locale, les
paquets envoyés vers l'adresse CARP ereviennent avec les informations CARP.

<p>
A intervalles configurés, le maître annonce sont état sur le port IP 112. Si le
maître est déconnecté, les autres systèmes du groupe CARP commencent à
annoncer leur présence. L'hôte qui parvient à s'annoncer le plus fréquemment
devient le nouveau maître. Lorsque le système principal est reconnecté, il se
transforme par défaut en hôte de secours, bien qu'il soit possible de configurer
un hôte spécifique en tant que maître par défaut lorsque cela est faisable (ex.
un hôte est un rapide Sun Fire V120 et les autres sont des SPARCstation IPCs,
comparativement plus lentes). 

<p>
Bien que les équipements à haute redondance et tolérance de pannes minimisent
le besoin de CARP, ils ne le suppriment pas. Il n'existe pas de matériel à
tolérance de pannes capable de gérer le fait que quelqu'un débranche le cordon
d'alimentation ou que l'administrateur système tape <tt>reboot</tt> dans la
mauvaise fenêtre. L'utilisation de CARP aide à rendre transparent une mise à
jour ou un redémarrage du point de vue des utilisateurs, ainsi que le test d'un
programme ou une mise à jour matérielle: si cela ne fonctionne pas, vous pouvez
basculer sur le reste du groupe jusqu'à ce que le problème soit résolu.

<p>Il existe cependant certaines situations où CARP ne pourra pas vous venir en
aide. La conception de CARP est telle que les membres d'un groupe doivent
appartenir au même réseau physique et que chaque interface doive avoir une
véritable adresse IP fixe en plus de l'adresse IP CARP statique. De même, les
services nécessitant une connexion constante au serveur (tels que SSH ou IRC) ne
seront pas transférés de manière transparente aux autres systèmes, bien que dans
ce cas, CARP puisse aider à minimiser le temps d'arrêt. CARP, lui-même, ne
synchronise pas les données entre applications, ceci doit être fait au travers
de "procédés alternatifs" tels que <a
d1702 3
a1704 2
href="http://rsync.samba.org/">rsync</a>, pour dupliquer manuellement les
données entre les machines, ou tout ce qui semble approprié à votre application.
d1717 5
a1721 3
<p>La première variable sysctl, <tt>net.inet.carp.allow</tt>, définie si l'hôte
gère ou non les paquets CARP. Bien évidemment, ceci est nécessaire à
l'utilisation de CARP. Cette variable sysctl est activée par défaut.
d1724 6
a1729 5
La seconde, <tt>net.inet.carp.arpbalance</tt>, est utilisée pour la balance de
charge ("load balancing"). Si cette fonctionnalité est activée, CARP effectue
une empreinte (hashage) de l'IP originatrice de la requête. Cette empreinte est
ensuite utilisée pour sélectionner à partir du groupe l'hôte virtuel qui prendra
en charge cette requête. Cette fonctionnalité est désactivée par défaut.
d1731 2
a1732 1
<p>La troisième, <tt>net.inet.carp.log</tt>, enregistre les erreurs CARP.
d1735 7
a1741 5
<p>La quatrième, <tt>net.inet.carp.preempt</tt> active la sélection naturelle
parmi les hôtes CARP. Le plus à même d'effectuer le travail (à savoir, celui qui
est capable de s'annoncer le plus fréquemment) deviendra le maître. Celle-ci est
désactivée par défaut, ce qui signifie qu'un système qui n'est pas maître ne
tentera pas de (re)gagner ce status.
d1748 3
a1750 2
<p>Pour ce qui concerne le reste de la configuration de CARP, nous dépendrons
d'<a
d1752 20
a1771 15
ifconfig(8)</a>. Deux des quatre commandes spécifiques à CARP, <tt>advbase</tt>
et <tt>advskew</tt>, définissent l'intervalle entre les annonces CARP. La
formule (en secondes) est <tt>advskew</tt> divisée par 255 puis ajoutée à
<tt>advbase</tt>. <tt>advbase</tt> peut être utilisée pour diminuer le trafic
réseau ou autoriser une plus grande latence avant qu'un hôte de sauvegarde ne
prenne le relais ; <tt>advskew</tt> vous permet de contrôler quel hôte sera le
maître sans trop de délais de basculement (si cela est nécessaire).

<p>Ensuite, <tt>pass</tt> crée un mot de passe et <tt>vhid</tt> définit le
numéro d'identification d'hôte virtuel du groupe CARP. Vous devez assigner un
numéro unique pour chaque groupe CARP, même s'ils partagent (pour des raisons de
balance de charge) la même adresse IP. CARP est limité à 255 groupes.

<p>Voyons l'emploi de ces différents paramètres dans une configuration simple.
Admettons que vous déploiez deux serveurs Web identiques, <i>rachael</i>
d1780 2
a1781 1
<p>créent l'interface carp0 et lui donnent un vhid de 1, le mot de passe
d1791 2
a1792 2
Faites la même chose sur <i>pris</i>. Le système démarrant en premier son
interface CARP deviendra le maître.
d1795 2
a1796 2
Notez que sur une machine possédant plusieurs interfaces, l'interface CARP est
sur le même sous-réseau que l'interface physique.
d1799 8
d1808 7
a1814 7
Mais admettons que vous ne déploiiez pas cette solution à partir de zéro.
<i>Rachael</i> était déja en place à l'adresse 192.168.0.7. Comment allez-vous
gérer cette situation ? Heureusement, CARP ne pose pas de problème si un
système possède la même adresse IP sur son interface physique et dans un groupe
CARP, donc il n'est pas nécessaire de changer les commandes précédentes.
Cependant, il est plus propre d'avoir une adresse IP différente pour chaque
systèm, cela rend les accès et la surveillance individuels bien plus simples.
d1816 4
a1819 10
<p>Ajoutons un nouveau niveau de complexité ; nous souhaitons que <i>rachael</i>
reste maître lorsque cela est possible. Plusieurs raisons peuvent nous pousser à
cela: différences matérielles, simple préjudice, "si ce système n'est pas
maître, c'est qu'il y a un problème", ou simplement connaître le maître par
défaut sans avoir à recourir à des scripts envoyant par courriel l'analyse de la
sortie d'ifconfig.

<p>Sur <i>rachael</i>, nous utiliserons la variable sysctl créée précédemment
puis nous éditerons <tt>/etc/sysctl.conf</tt> afin de rendre ce paramètre
permanent.
d1831 3
a1833 2
<p>Ceci décale les annonces de <i>pris</i>, ce qui signifie que <i>rachael</i>
sera maître s'il est fonctionnel.
d1837 2
a1838 3
"proto carp" sur toutes les interfaces concernées, avec une ligne similaire à:
<blockquote><pre>
pass on fxp0 proto carp keep state
d1843 6
a1848 5
<p>Effectuons une avance rapide de quelques mois. Notre entreprise de l'exemple
précédent a grossi au point qu'un seul serveur Web interne arrive tout juste à
gérer la charge. Que faire ? CARP à la rescousse. Il est temps d'essayer la
balance de charge. Créons une nouvelle interface et un nouveau groupe CARP sur
<i>rachael</i>:
d1856 2
a1857 1
<p>Sur <i>pris</i>, nous allons également créer un nouveau groupe et une
d1866 10
a1875 8
<p>A présent nous avons deux groupes CARP avec la même adresse IP. Chaque groupe
est dirigé vers un hôte différent, ce qui signifie que <i>rachael</i> restera
maître du premier groupe, mais que <i>pris</i> lui succédera comme maître dans
le second.

<p>Tout ce qu'il nous reste à faire désormais est d'activer la variable
contrôlant la balance de charge sur les deux machines, comme nous l'avons vu
précédemment:
d1881 7
a1887 5
<p>Bien que ces exemples ne soient que pour un cluster de deux machines, le même
principe reste valable avec plus de systèmes. Notez en revanche qu'il n'est pas
assuré que vous parveniez à une distribution de 50/50 sur les deux
machines: CARP utilise une empreinte de l'IP originatrice afin de savoir quel
système répondra à la requête, indépendamment de la charge.
d1896 2
a1897 2
Failover with pfsync and CARP"</a> (Redondance de pare-feu avec pfsync et CARP)
par Ryan McBride
d1900 90
d2006 2
a2007 2
Originally [OpenBSD: faq6.html,v 1.200 ]<br>
$Translation: faq6.html,v 1.32 2004/10/23 09:08:53 ajacoutot Exp $<br>
@


1.17
log
@Sync with Steelix CVS
@
text
@d17 3
a19 1
<img alt="[OpenBSD]" height=30 width=141 src="../../images/smalltitle.gif">
d1889 2
a1890 2
Originally [OpenBSD: faq6.html,v 1.199 ]<br>
$Translation: faq6.html,v 1.31 2004/10/19 06:35:38 ajacoutot Exp $<br>
@


1.16
log
@sync with Steelix CVS.
@
text
@d574 4
a577 4
</a>, éditez le fichier <tt>/etc/rc.conf</tt>. Changez la ligne
<tt>dhcpd_flags=NO</tt> en <tt>dhcpd_flags="-q"</tt>. Placez le nom des
interfaces sur lesquelles vous souhaitez que le serveur écoute, dans le
fichier <tt>/etc/dhcpd.interfaces</tt>.
d973 4
a976 7
NFS nécessite le lancement de <a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=portmap&amp;sektion=8">
portmap(8)</a> avant qu'il ne puisse opérer. A partir d'OpenBSD 3.2
Portmap(8) est désactivé par défaut, vous devez donc
l'activer dans <a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc.conf&amp;sektion=8">
rc.conf(8)</a> en changeant la ligne <tt>portmap</tt> en:
d981 4
a984 1
et redémarrer pour que ce changement prenne effet.
d1023 1
a1023 1
<i>/etc/rc.conf</i>. Ceci aura pour effet de démarrer nfsd(8) et
d1887 2
a1888 2
Originally [OpenBSD: faq6.html,v 1.198 ]<br>
$Translation: faq6.html,v 1.30 2004/10/13 15:44:00 ajacoutot Exp $<br>
@


1.15
log
@Sync with Steelix CVS
@
text
@d1564 1
a1564 1
>boot.conf</a>, le fichier de configuration de boot.
d1567 1
a1567 1
Notez que <tt>boot.conf</tt> n'est nécessaire qu'au cas où vous
d1569 2
a1570 1
options par défaut de pxeboot ne vous conviennent pas. Vous pouvez tester
d1887 2
a1888 2
Originally [OpenBSD: faq6.html,v 1.197 ]<br>
$Translation: faq6.html,v 1.29 2004/10/11 22:57:04 saad Exp $<br>
@


1.14
log
@Sync with Steelix CVS
@
text
@d1886 2
a1887 2
Originally [OpenBSD: faq6.html,v 1.195 ]<br>
$Translation: faq6.html,v 1.28 2004/10/11 14:25:25 ajacoutot Exp $<br>
@


1.13
log
@Sync with Steelix CVS
@
text
@d4 1
a4 1
<title>6 - Le r&eacute;seau</title>
d21 2
a22 2
<a href="faq5.html">[Section 5 - Construire le Syst&egrave;me &agrave; partir des Sources]</a>
<a href="../faq7.html">[Section 7 - Contr&ocirc;les du clavier et de l'affichage]</a></font>
d24 1
a24 1
<h1><font color="#e00000">6 - Le r&eacute;seau</font></h1>
d30 2
a31 2
   ce fichier est obsol&egrave;te. Consultez la version anglaise 
   <a href="../faq6.html">ici</a> pour des informations &agrave; jour.
d34 2
a35 2
Si vous souhaitez contribuez &agrave; l'effort de traduction,
pri&egrave;re de consulter
d42 1
a42 1
<h3>Table des mati&egrave;res</h3>
d45 1
a45 1
<li><a href= "#Setup" >6.2 - Configuration initiale du r&eacute;seau</a>
d50 3
a52 3
<li><a href= "#PPP"   >6.5 - Protocole Point &agrave; Point (PPP)</a>
<li><a href= "#Tuning">6.6 - Optimisation des param&egrave;tres
r&eacute;seau</a>
d56 1
a56 1
<li><a href= "#PXE"   >6.10 - Comment d&eacute;marrer en utilisant PXE ?</a>
d67 1
a67 1
Afin de permettre une meilleure compr&eacute;hension de ce document, vous
d69 1
a69 1
href="faq5.html">Construire le Syst&egrave;me &agrave; partir des Sources</a> de
d77 1
a77 1
Si vous &ecirc;tes administrateur de r&eacute;seau et que vous mettez en place
d79 1
a79 1
vous souhaitez en savoir plus sur les r&eacute;seaux IP, vous devriez lire "<a
d83 2
a84 2
&agrave; travailler sur les r&eacute;seaux IP, surtout si vous en avez un ou
plusieurs sous votre responsabilit&eacute;.
d89 1
a89 1
b&eacute;n&eacute;ficier de la <a
d92 2
a93 2
int&eacute;ressent ou les technologies que vous utilisez sur votre
r&eacute;seau. Lisez-les et voyez comment ces technologies fonctionnent. Les
d95 1
a95 1
fa&ccedil;on dont ils sont cens&eacute;s fonctionner.
d99 1
a99 1
<h2>6.2 - Configuration initiale du r&eacute;seau</h2>
d103 1
a103 1
<h3>6.2.1 - Identifier et configurer vos interfaces r&eacute;seau</h3>
d106 5
a110 5
Pour commencer, vous devez d'abord identifier votre interface r&eacute;seau.
Sous OpenBSD, les interfaces sont nomm&eacute;es &agrave; partir du type de la
carte r&eacute;seau, pas du type de la connexion. Vous pouvez voir
l'initialisation de votre carte pendant la proc&eacute;dure de d&eacute;marrage,
ou apr&egrave;s celle-ci en utilisant la commande <a
d112 2
a113 2
</a>. Vous avez aussi la possibilit&eacute; de voir votre carte r&eacute;seau
gr&acirc;ce &agrave; l'utilisation de la commande <a
d116 1
a116 1
Intel Fast Ethernet qui utilise le nom de p&eacute;riph&eacute;rique fxp.
d125 3
a127 3
Si vous ne connaissez pas le nom du p&eacute;riph&eacute;rique associ&eacute;
&agrave; votre carte, regardez dans la liste des <a
href="../../fr/plat.html">plates-formes actuellement support&eacute;es</a> par
d129 2
a130 2
et leur &eacute;quivalent sous OpenBSD. Ajoutez au nom alphab&eacute;tique du
p&eacute;riph&eacute;rique (par exemple fxp) le num&eacute;ro assign&eacute; par
d134 2
a135 2
Vous pouvez conna&icirc;tre quelles interfaces r&eacute;seaux ont
&eacute;t&eacute; identifi&eacute;es &agrave; l'aide de l'utilitaire <a
d138 1
a138 1
r&eacute;seau d'un syst&egrave;me. Cet exemple montre qu'il n'y a qu'une seule
d181 1
a181 1
Comme vous pouvez le voir, &agrave; ce point <a
d183 5
a187 5
ifconfig(8)</a> nous fourni beaucoup plus d'informations que n&eacute;cessaire.
Mais nous pouvons tout de m&ecirc;me voir notre interface. Dans l'exemple
pr&eacute;c&eacute;dent, la carte est d&eacute;ja configur&eacute;e. Ceci est
&eacute;vident de part la pr&eacute;sence d'une configuration r&eacute;seau IP
pour fxp0, &agrave; savoir &quot;inet 10.0.0.38 netmask 0xffffff00 broadcast
d189 1
a189 1
<strong>RUNNING</strong> sont &eacute;galement pr&eacute;sents.
d192 3
a194 3
Finalement, vous noterez que d'autres interfaces sont activ&eacute;es par
d&eacute;faut. Il s'agit d'interfaces virtuelles servant diff&eacute;rentes
fonctions. Les manuels suivants les d&eacute;crivent:
d207 1
a207 1
 - Interface SLIP (protocole Internet sur ligne s&eacute;rie)
d210 1
a210 1
 - Protocole point &agrave; point
d229 1
a229 1
 - Interface g&eacute;n&eacute;rique de tunnel IPv4/IPv6
d236 4
a239 4
Si votre interface n'est pas configur&eacute;e, la premi&egrave;re chose
&agrave; faire est de cr&eacute;er le fichier <i>/etc/hostname.xxx</i>,
o&ugrave; xxx repr&eacute;sente le nom de votre interface. A partir des
informations des exemples pr&eacute;c&eacute;dents, le nom du fichier sera
d253 1
a253 1
&agrave;:
d261 1
a261 1
Vous pouvez &eacute;galement sp&eacute;cifier le type de media d'une connexion
d269 4
a272 4
(Bien entendu, vous ne devriez jamais forcer le mode full duplex &agrave; moins
que les deux extr&eacute;mit&eacute;s de la connexion ne soient
configur&eacute;es ainsi ! Si ce n'est pour des besoins sp&eacute;cifiques, la
configuration du type de media n'est pas n&eacute;cessaire.)
d275 2
a276 2
Vous pouvez aussi vouloir utiliser des indicateurs sp&eacute;cifiques &agrave;
une certaine interface. Le format du fichier hostname ne change que tr&egrave;s
d285 2
a286 2
La prochaine &eacute;tape consiste &agrave; d&eacute;finir votre passerelle par
d&eacute;faut. Pour ce faire, renseignez simplement le fichier
d288 2
a289 2
configurer automatiquement votre route par d&eacute;faut au d&eacute;marrage. A
pr&eacute;sent, vous pouvez indiquer l'adresse de vos serveurs de noms et
d292 2
a293 2
</a>). Pour configurer vos serveurs de noms, vous devez cr&eacute;er un fichier
nomm&eacute; <i>/etc/resolv.conf</i>. Vous pouvez en savoir plus sur le format
d297 1
a297 1
vos serveurs de noms sont 125.2.3.4 et 125.2.3.5. Vous faites &eacute;galement
d309 2
a310 2
A pr&eacute;sent, vous pouvez soit red&eacute;marrer, soit lancer le script
<strong>/etc/netstart</strong>. Vous pouvez l'ex&eacute;cuter simplement en
d322 6
a327 6
Notez que plusieurs erreurs sont apparues. En ex&eacute;cutant ce script, vous
reconfigurez certaines choses qui le sont d&eacute;j&agrave;. De fait, certaines
routes sont d&eacute;ja pr&eacute;sentes dans la table de routage du noyau. A
pr&eacute;sent, votre syst&egrave;me devrait &ecirc;tre en &eacute;tat de
fonctionnement. Une nouvelle fois, vous pouvez v&eacute;rifier que votre
interface a &eacute;t&eacute; correctement configur&eacute;e avec <a
d329 1
a329 1
ifconfig(8)</a>. Vous pouvez &eacute;galement v&eacute;rifier vos routes via <a
d333 3
a335 3
</a>. Si vous avez des probl&egrave;mes de routage, vous pouvez utiliser
l'option -n de la commande route(8) qui affichera l'adresse IP plut&ocirc;t que
d'effectuer une requ&ecirc;te DNS et d'afficher le nom d'h&ocirc;te. Voici un
d375 3
a377 3
Voici les informations n&eacute;cessaires &agrave; la mise en place d'une
passerelle OpenBSD (appel&eacute; aussi routeur). Si vous devez installer
OpenBSD pour en faire un routeur Internet, nous vous sugg&eacute;rons de lire
d379 1
a379 1
bloquer le trafic non-autoris&eacute;. Avec le peu de disponibilit&eacute;
d382 3
a384 3
la part des fournisseurs d'acc&egrave;s &agrave; Internet ainsi que des
registres Internet r&eacute;gionaux, vous pourriez vouloir vous renseigner sur
la translation d'adresses (NAT) afin d'&eacute;conomiser votre adressage IP.
d387 2
a388 2
Le noyau GENERIC est d&eacute;ja configur&eacute; pour permettre le routage IP,
mais celui-ci doit &ecirc;tre explicitement activ&eacute;. Vous pouvez l'activer
d391 2
a392 2
sysctl(8)</a>. Afin d'autoriser le routage de fa&ccedil;on permanente,
&eacute;ditez le fichier <a
d401 1
a401 1
Pour prendre en compte ce changement sans red&eacute;marrer, vous utiliserez
d404 2
a405 2
sysctl(8)</a>. Souvenez-vous que ce changement ne sera pas sauvegard&eacute; au
red&eacute;marrage et que vous devrez &ecirc;tre root pour utiliser cette
d414 2
a415 2
A pr&eacute;sent, modifiez les routes sur les h&ocirc;tes aux deux
extr&eacute;mit&eacute;s. Il existe beaucoup d'autres usages d'OpenBSD en tant
d421 2
a422 2
disponibles en tant que ports. OpenBSD supporte diff&eacute;rentes interfaces
T1, HSSI, ATM, FDDI, Ethernet, et s&eacute;rie (PPP/SLIP).
d429 2
a430 2
OpenBSD poss&egrave;de un m&eacute;canisme simple pour la mise en place d'alias
IP sur une interface. Pour ce faire, il suffit d'&eacute;diter le fichier <a
d434 1
a434 1
</a> faisant partie de la s&eacute;quence de d&eacute;marrage <a
d436 1
a436 1
l'interface <b>dc0</b> et se trouve sur le r&eacute;seau 192.168.0.0. Autres
d441 1
a441 1
<li>le masque de sous-r&eacute;seau est 255.255.255.0
d446 5
a450 5
uniquement. Il n'y a pas de diff&eacute;rence entre le premier et le second
alias. A la diff&eacute;rence d'autres syst&egrave;mes d'exploitation, OpenBSD
ne s'y r&eacute;f&egrave;re pas en tant que dc0:0, dc0:1. Si vous vous
r&eacute;f&eacute;rez &agrave; une adresse IP d'alias avec ifconfig ou si vous
ajoutez un alias, soyez s&ucirc;r d'utiliser la commande "<tt>ifconfig int
d455 6
a460 6
En admettant que vous utilisiez plusieurs adresses avec alias sur le m&ecirc;me
sous-r&eacute;seau IP, le masque correspondant &agrave; chaque alias devient
255.255.255.255. Il n'est pas n&eacute;cessaire d'utiliser le masque
correspondant &agrave; l'adresse IP primaire de l'interface. Dans cet exemple,
<i>/etc/hostname.dc0</i>, deux alias sont configur&eacute;s pour le
p&eacute;riph&eacute;rique dc0, qui lui-m&ecirc;me poss&egrave;de l'adresse
d471 3
a473 3
Apr&egrave;s avoir &eacute;dit&eacute; ce fichier, il suffit de
red&eacute;marrer pour que les changements prennent effet. Mais vous pouvez
aussi cr&eacute;er les alias &agrave; la main en utilisant l'utilitaire <a
d475 1
a475 1
ifconfig(8)</a>. Pour cr&eacute;er le premier alias, lancez la commande
d500 1
a500 1
nous referrerons &agrave; pr&eacute;sent sous le nom de PF) . PF est aussi
d502 3
a504 3
la bande passante et une prioritarisation des paquets ainsi que d'&ecirc;tre
utilis&eacute; dans la cr&eacute;ation de puissants et flexibles pare-feu. Tout
ceci est d&eacute;crit dans le <a href="../pf/fr/index.html"><b>Guide de
d523 1
a523 1
dhclient(8)</a> inclus avec OpenBSD, &eacute;ditez le fichier
d525 2
a526 2
v&ocirc;tre pouvant &ecirc;tre aussi bien ep0 que fxp0 ou encore autre chose ! )
Tout ce que vous avez besoin d'&eacute;crire dans ce fichier est
d534 3
a536 3
Ceci aura pour effet de d&eacute;marrer automatiquement le client DHCP au
d&eacute;marrage. OpenBSD se verra attribuer son adresse IP, sa passerelle par
d&eacute;faut et ses serveurs de noms (DNS) &agrave; partir du serveur DHCP.
d539 2
a540 2
Si vous souhaitez d&eacute;marrer le client dhcp &agrave; partir de la ligne de
commande, v&eacute;rifiez bien que <tt>/etc/dhclient.conf</tt> existe, puis
d548 1
a548 1
O&ugrave; <tt>fxp0</tt> repr&eacute;sente l'interface que vous voulez configurer
d552 3
a554 3
Peu importe la fa&ccedil;on dont vous d&eacute;marrez dhclient, vous pouvez
&eacute;diter <tt>/etc/dhclient.conf</tt> afin de ne <b>pas</b> mettre &agrave;
jour vos DNS &agrave; l'aide du serveur dhcp en d&eacute;commentant les lignes
d556 1
a556 1
d&eacute;commenter afin de changer le comportement par d&eacute;faut de
d565 2
a566 2
et <b>supprimez</b> domain-name-servers. Bien s&ucirc;r, vous pouvez
&eacute;galement supprimer hostname ainsi que d'autres options.
d574 1
a574 1
</a>, &eacute;ditez le fichier <tt>/etc/rc.conf</tt>. Changez la ligne
d576 1
a576 1
interfaces sur lesquelles vous souhaitez que le serveur &eacute;coute, dans le
d584 1
a584 1
Ensuite, &eacute;ditez <tt>/etc/dhcpd.conf</tt>. Les options sont plut&ocirc;t
d599 6
a604 6
Ceci indique &agrave; vos clients DHCP que le domaine &agrave; ajouter aux
requ&ecirc;tes DNS est example.com (ainsi, si un utilisateur lance la commande
'telnet joe', il sera renvoy&eacute; vers joe.example.com). Les clients auront
comme serveurs DNS 192.168.1.3 et 192.168.1.5. Pour les h&ocirc;tes
pr&eacute;sents sur le sous-r&eacute;seau correspondant &agrave; l'interface du
serveur OpenBSD, &agrave; savoir dans la plage 192.168.1.0/24, ils se verront
d606 1
a606 1
par d&eacute;faut sera 192.168.1.1.
d609 2
a610 2
Si vous souhaiter d&eacute;marrez dhcpd(8) &agrave; partir de la ligne de
commandes, une fois <tt>/etc/dhcpd.conf</tt> configur&eacute;, tapez:
d618 9
a626 9
La ligne incluant <tt>touch</tt> est n&eacute;cessaire afin de cr&eacute;er un
fichier <tt>dhcpd.leases</tt> vide avant que dhcpd(8) ne d&eacute;marre.
Les <a href="faq10.html#rc">scripts de d&eacute;marrage</a> d'OpenBSD se
chargeront de cr&eacute;er ce fichier au boot, mais si vous lancez dhcpd(8)
manuellement, vous devez au pr&eacute;alable cr&eacute;er ce fichier.
<tt>fxp0</tt> repr&eacute;sente l'interface sur laquelle vous voulez
r&eacute;pondre aux requ&ecirc;tes DHCP. L'option <tt>-q</tt> fait
d&eacute;marrer le serveur dhcpd(8) en mode silencieux, sinon celui-ci est
tr&egrave;s verbeux.
d629 2
a630 2
Si vous pr&eacute;voyez de servir DHCP &agrave; des machines Windows, pour
pourriez souhaiter donner &agrave; ces clients une adresse de serveur 'WINS'.
d639 2
a640 2
(o&ugrave; <tt>192.168.92.55</tt> est l'adresse IP de votre serveur Windows ou
Samba.) Reportez vous &agrave; <a
d653 3
a655 3
Le protocole point &agrave; point est g&eacute;n&eacute;ralement utilis&eacute;
afin de cr&eacute;er une connexion modem vers votre FAI (fournisseur
d'acc&egrave;s &agrave; Internet). Sous OpenBSD, deux solutions existent.
d661 1
a661 1
 - Qui est l'impl&eacute;mentation noyau du d&eacute;mon ppp.
d664 1
a664 1
 - Qui est l'impl&eacute;mentation ppp en espace utilisateur ("userland"). 
d668 1
a668 1
Le premier que nous allons aborder est le d&eacute;mon PPP en espace
d673 1
a673 1
<li>Le num&eacute;ro de t&eacute;l&eacute;phone de votre FAI
d681 1
a681 1
&agrave; la mise en place de ppp. Le fichier de configuration du d&eacute;mon
d685 3
a687 3
pr&eacute;sents dans <i>/etc/ppp</i> peuvent vous aider &agrave; la mise en
place de votre configuration. Vous devriez jeter un oeil &agrave; ce
r&eacute;pertoire.
d690 1
a690 1
Si vous n'utilisez pas le noyau GENERIC, soyez s&ucirc;r d'inclure cette ligne
d701 2
a702 2
La configuration initiale de PPP n&eacute;cessite l'&eacute;dition du fichier
<i>/etc/ppp/ppp.conf</i>. Ce fichier n'existe pas par d&eacute;faut, mais vous
d704 4
a707 4
cr&eacute;er votre propre <i>ppp.conf</i>. Je commencerai par une configuration
simple et g&eacute;n&eacute;ralement tr&egrave;s employ&eacute;e. Voici
rapidement un petit fichier <i>ppp.conf</i> d&eacute;finissant quelques valeurs
par d&eacute;faut:
d721 5
a725 5
La section d&eacute;finie par le marqueur <tt>default:</tt> sera
ex&eacute;cut&eacute;e &agrave; chaque fois. Cette section recense des
informations importantes. &quot;set log&quot; d&eacute;fini le niveau de
verbosit&eacute; des logs. Il peut &ecirc;tre chang&eacute;:
r&eacute;f&eacute;rez-vous au manuel de <a
d728 8
a735 8
diff&eacute;rents &eacute;v&ecirc;nements. Le p&eacute;riph&eacute;rique
utilis&eacute; est indiqu&eacute; par &quot;set device&quot;. Il s'agit du port
sur lequel est pr&eacute;sent notre modem. Dans cet exemple, le modem est
branch&eacute; sur le port com 2. Ainsi, le port com 1 sera indiqu&eacute; par
<i>/dev/cua00</i>. La vitesse de la connexion est pr&eacute;cis&eacute;e par
&quot;set speed&quot; et &quot;set dial&quot; renseigne nos param&egrave;tres de
num&eacute;rotation. Avec ceci, nous pouvons changer l'expiration ("timeout") de
la connexion, etc. Ceci &eacute;tant, cette ligne ne devrait pas tellement
d740 6
a745 6
sp&eacute;cifiques &agrave; notre FAI. Pour ce faire, nous allons rajouter une
autre section en-dessous de <b>default:</b>. Le marqueur d&eacute;finissant
cette nouvelle section pourra &ecirc;tre ce que vous d&eacute;sirez - le plus
simple &eacute;tant d'utiliser le nom de votre FAI. Ici, nous utiliserons
<b>myisp:</b> pour indiquer le commencement de la section correspondant &agrave;
notre FAI. Voici une configuration simple contenant le n&eacute;cessaire afin de
d761 7
a767 7
Ici nous avons fourni les &eacute;l&eacute;ments essentiels concernant ce FAI.
La premi&egrave;re option, &quot;set phone&quot;, donne le num&eacute;ro de
t&eacute;l&eacute;phone du FAI. Nos options d'ouverture de session sont
renseign&eacute;es par &quot;set login&quot;. Notre "timeout" est &eacute;gal
&agrave; 5 ; ce qui signifie que notre tentative de connexion expirera
apr&egrave;s 5 secondes si aucune porteuse n'est trouv&eacute;e. Dans le cas
contraire, &quot;login:&quot; sera envoy&eacute; avec notre nom d'utilisateur et
d772 2
a773 2
ppp. Ces valeurs doivent &ecirc;tre chang&eacute;es. La ligne &quot;set
timeout&quot; permet de couper la connexion apr&egrave;s 120 secondes de
d775 1
a775 1
compliqu&eacute;e. En voici une explication plus compl&ecirc;te.
d782 1
a782 1
La ligne pr&eacute;c&eacute;dente se d&eacute;finit avec le format suivant:
d784 1
a784 1
[triggeraddr]]]]</b>&quot;. La premi&egrave;re IP d&eacute;signe l'adresse IP
d787 5
a791 5
dit qu'aucun "bit" de cette adresse ne doit forc&eacute;ment correspondre et que
celle-ci peut &ecirc;tre chang&eacute;e. La deuxi&egrave;me adresse IP est celle
du FAI. La troisi&egrave;me option est notre masque de sous-r&eacute;seau, ici
d&eacute;fini &agrave; 255.255.255.0. Si triggeraddr est renseign&eacute;, il
remplacera myaddr comme adresse IP utilis&eacute;e pour la n&eacute;gociation
d793 3
a795 3
correspondant &agrave; myaddr sera accept&eacute;e. Ceci peut &ecirc;tre utile
dans la n&eacute;gociation avec certaines impl&eacute;mentations PPP qui
n'attribuent pas d'adresse IP &agrave; moins que l'initiateur de la connexion ne
d800 6
a805 6
d&eacute;faut l'adresse IP de votre FAI. Cette entr&eacute;e permet d'ajuster
automatiquement notre route par d&eacute;faut en cas de changement d'adresse IP
de celui-ci. &quot;enable dns&quot; est utilis&eacute; afin de
r&eacute;cup&eacute;rer la liste des serveurs DNS du FAI. N'utilisez PAS cette
option si vous avez votre propre serveur DNS local car ppp emp&ecirc;chera les
requ&ecirc;tes vers celui-ci en rempla&ccedil;ant les lignes "nameserver" de
d812 3
a814 3
Maintenant que <i>ppp.conf</i> est configur&eacute;, nous pouvons essayer
d'initier une connexion vers notre FAI. Je d&eacute;taillerai certaines des
options les plus utilis&eacute;es:
d818 3
a820 3
interfaces, vous connectera &agrave; votre FAI et se placera en
arri&egrave;re-plan.
<li><tt>ppp -ddial myisp</tt> - Cette commande est similaire &agrave; -auto mais
d826 2
a827 2
partir de l&agrave;, vous pouvez int&eacute;ragir directement avec le modem ;
ceci peut &ecirc;tre tr&egrave;s utile pour corriger les erreurs dans votre
d835 1
a835 1
commandes au lancement ou &agrave; la coupure de votre connexion. Si vous vous
d837 1
a837 1
cr&eacute;er: <i>/etc/ppp/ppp.linkup</i> et <i>/etc/ppp/ppp.linkdown</i>. Des
d850 1
a850 1
Plus d'informations peuvent &ecirc;tre trouv&eacute;es dans la section <a
d852 1
a852 1
"User PPP" du Manuel de R&eacute;f&eacute;rence ("Handbook") de FreeBSD</a>.
d857 1
a857 1
<h2>6.6 - Optimisation des param&egrave;tres r&eacute;seau</h2>
d862 1
a862 1
et augmenter le d&eacute;lai d'expiration des sessions TCP ?</h3>
d865 3
a867 3
G&eacute;n&eacute;ralement, vous utiliserez ceci en cas de probl&egrave;mes de
routage ou de connexion. Bien s&ucirc;r, pour que cette configuration soit la
plus effective, les deux extr&eacute;mit&eacute;s de la connexion doivent
d880 1
a880 1
Avec sysctl -a, vous pouvez voir les valeurs courantes de ces param&egrave;tres
d885 1
a885 1
<h3>6.6.2 - Comment activer les &eacute;missions ("broadcasts") dirig&eacute;es
d889 1
a889 1
Normalement, vous ne devriez pas utiliser ceci. Cette option permet &agrave;
d891 1
a891 1
r&eacute;seaux sur lesquels vous &ecirc;tes connect&eacute; si vous utilisez
d895 3
a897 3
Dans certaines situations, sur des r&eacute;seaux ferm&eacute;s, cette option
peut-&ecirc;tre utile, surtout lors de l'utilisation de vieilles
impl&eacute;mentations du protocole NetBIOS. Il s'agit d'un autre sysctl.
d900 2
a901 2
voulez savoir pourquoi cette option est d&eacute;sactiv&eacute;e par
d&eacute;faut.
d905 1
a905 1
donn&eacute;</h3>
d908 1
a908 1
Il existe &eacute;galement un sysctl pour ceci. D'apr&egrave;s <a
d913 5
a917 5
D&eacute;finie la liste des ports TCP ne devant pas &ecirc;tre allou&eacute;s
dynamiquement par le noyau. Ceci peut &ecirc;tre utile afin d'&eacute;viter
l'appropriation d'un port sp&eacute;cifique dont un autre programme a besoin
pour fonctionner. Les &eacute;l&eacute;ments list&eacute;s peuvent &ecirc;tre
s&eacute;par&eacute;s par une virgule et/ou un espace.
d933 3
a935 3
NFS ("Network File System") est utilis&eacute; afin de partager un
syst&egrave;me de fichiers &agrave; travers un r&eacute;seau. Voici un certain
nombre de manuels &agrave; lire avant la mise en place d'un serveur NFS:
d950 8
a957 8
Cette section d&eacute;taillera les &eacute;tapes n&eacute;cessaires &agrave; la
mise en oeuvre d'une configuration NFS simple. Cet exemple d&eacute;taille un
serveur et ses clients NFS sur un LAN. Il ne s'agit pas d'&eacute;tudier la
s&eacute;curisation de NFS. Nous assumerons que le filtre de paquets (PF) ou
qu'un autre type de pare-feu est configur&eacute; ain d'emp&ecirc;cher les
acc&egrave;s ext&eacute;rieurs. Si vous autorisez l'acc&egrave;s &agrave; votre
serveur NFS depuis l'ext&eacute;rieur et que vous h&eacute;bergez des
donn&eacute;es sensibles, nous vous conseillons fortement d'utiliser IPsec.
d959 3
a961 3
NFS. Quelqu'un pourrait &eacute;galement usurper l'adresse IP que vous autorisez
&agrave; se connecter &agrave; votre serveur NFS. Plusieurs types d'attaques
peuvent en d&eacute;couler. Mais lorsqu'IPsec est correctement configur&eacute;,
d965 6
a970 6
Autre note concernant la s&eacute;curit&eacute;. Ne vous contentez pas juste
d'ajouter un syst&egrave;me de fichiers dans <i>/etc/exports</i> sans mettre en
place une liste recensant les h&ocirc;tes autoris&eacute;s &agrave; se
connecter. Sans une liste d'h&ocirc;tes autoris&eacute;s &agrave; monter un
r&eacute;pertoire particulier, n'importe qui, capable de vous atteindre, sera en
mesure de monter vos syst&egrave;mes de fichiers export&eacute;s par NFS.
d973 1
a973 1
NFS n&eacute;cessite le lancement de <a
d975 2
a976 2
portmap(8)</a> avant qu'il ne puisse op&eacute;rer. A partir d'OpenBSD 3.2
Portmap(8) est d&eacute;sactiv&eacute; par d&eacute;faut, vous devez donc
d984 1
a984 1
et red&eacute;marrer pour que ce changement prenne effet.
d988 5
a992 5
serveur n'offrira NFS qu'aux clients pr&eacute;sents sur ce r&eacute;seau. La
premi&egrave;re &eacute;tape pour installer un serveur NFS est de renseigner
votre fichier <i>/etc/exports</i>. Ce fichier liste les syst&egrave;mes de
fichiers que vous souhaitez rendre accessibles par NFS et d&eacute;finit qui
peut y acc&eacute;der. Beaucoup d'options sont disponibles pour l'&eacute;dition
d996 1
a996 1
&agrave;:
d1007 1
a1007 1
Ceci signifie que le syst&egrave;me de fichiers local <tt>/work</tt> sera
d1009 5
a1013 5
n'importe quel r&eacute;pertoire sous le point de montage <tt>/work</tt>.
L'option <tt>-ro</tt> exporte le syst&egrave;me de fichiers en lecture seule.
Les deux derniers arguments sp&eacute;cifient que seuls les clients
pr&eacute;sents dans le r&eacute;seau 10.0.0.0 utilisant un masque de
255.255.255.0 seront autoris&eacute;s &agrave; monter ce syst&egrave;me de
d1015 1
a1015 1
diff&eacute;rents r&eacute;seaux.
d1018 3
a1020 3
Une fois que votre fichier <i>/etc/exports</i> est configur&eacute;, vous pouvez
mettre en place votre serveur NFS. Tout d'abord, v&eacute;rifiez que les options
NFSSERVER &amp; NFSCLIENT sont bien pr&eacute;sentes dans votre fichier de
d1023 7
a1029 7
<i>/etc/rc.conf</i>. Ceci aura pour effet de d&eacute;marrer nfsd(8) et
mountd(8) au red&eacute;marrage. A pr&eacute;sent, vous pouvez lancer les
d&eacute;mons manuellement. Ils doivent &ecirc;tre lanc&eacute;s sous root et
vous devez v&eacute;rifier que portmap(8) est bien d&eacute;marr&eacute; sur
votre syst&egrave;me. Voici un exemple de lancement de nfsd(8) servant les
requ&ecirc;tes TCP et UDP et utilisant 4 d&eacute;mons. Vous devriez utiliser un
nombre appropri&eacute; de d&eacute;mons NFS en fonction du nombre maximum de
d1037 4
a1040 4
Vous devez non seulement d&eacute;marrer le serveur nfsd(8) mais
&eacute;galement mountd(8). Il s'agit du service qui se charge de passer les
requ&ecirc;tes de montage &agrave; NFS. Pour d&eacute;marrer mountd(8), soyez
s&ucirc;r qu'un fichier mountdtab vide existe puis lancez le d&eacute;mon:
d1049 1
a1049 1
d&eacute;ja en fonction, vous devez en informer mountd ! Lancez-lui simplement
d1060 2
a1061 2
Maintenant, vous pouvez v&eacute;rifier que tous ces d&eacute;mons sont
lanc&eacute;s et enregistr&eacute;s avec RPC. Pour ce faire, utilisez
d1083 1
a1083 1
showmount(8)</a>, qui permet de voir ce qui est mont&eacute; et par qui. Il
d1085 1
a1085 1
showmount(8), essayez la commande <tt>/usr/bin/showmount -a h&ocirc;te</tt>. Par
d1095 1
a1095 1
<h3>Monter des syst&egrave;mes de fichiers NFS</h3>
d1098 2
a1099 2
Les syst&egrave;mes de fichiers NFS doivent &ecirc;tre mont&eacute;s par
mount(8), ou plus pr&eacute;cis&eacute;ment, <a
d1101 4
a1104 4
mount_nfs(8)</a>. Pour monter le syst&egrave;me de fichiers <i>/work</i> sur
10.0.0.1 vers le syst&egrave;me de fichiers local <i>/mnt</i>, il vous suffit de
lancer la commande suivante (notez qu'il n'est pas n&eacute;cessaire d'utiliser
une adress IP ; mount r&eacute;soudra les noms d'h&ocirc;tes):
d1111 1
a1111 1
Pour que ce syst&egrave;me de fichiers soit mont&eacute; au d&eacute;marrage,
d1119 2
a1120 2
Il est important que vous utilisiez <tt>0 0</tt> &agrave; la fin de la ligne
afin que votre machine ne lance pas un fsck sur ce syst&egrave;me de fichiers
d1122 1
a1122 1
peuvent &ecirc;tre employ&eacute;es lorsqu'elles sont applicables. Par exemple:
d1129 2
a1130 2
Ainsi, aucun p&eacute;riph&eacute;rique ni programme setuid pr&eacute;sent sur
le serveur NFS ne peut compromettre la s&eacute;curit&eacute; du client. Si vous
d1132 1
a1132 1
ajoutez l'option noexec &agrave; cette ligne.
d1139 1
a1139 1
<strong>NOTE:</strong> Cette section ne s'applique pas &agrave;
d1141 4
a1144 4
peuvent y &ecirc;tre glan&eacute;es. Cette configuration a &eacute;t&eacute;
confirm&eacute;e comme fonctionnelle pour <a
href="http://www.inode.at">Inode</a>, un fournisseur d'acc&egrave;s autrichien
et <a href="http://www.kpn.nl">KPN</a>, un fournisseur d'acc&egrave;s
d1148 1
a1148 1
Pour commencer, vous devez installer pptp. Le port est situ&eacute; sous
d1154 1
a1154 1
Bien qu'il n'ait pas besoin de p&eacute;riph&eacute;rique <a
d1157 1
a1157 1
paquets encapsul&eacute;s par GRE, lancez la commande suivante:
d1165 1
a1165 1
Ce qui permettra de sauvegarder ce changement au red&eacute;marrage.
d1168 2
a1169 2
Une fois le paquetage <b>pptp</b> install&eacute; et le fichier
<i>/etc/sysctl.conf</i> &eacute;dit&eacute;, vous devez renseigner un certain
d1173 1
a1173 1
pr&eacute;sent dans OpenBSD, donc si vous &ecirc;tes familier avec l'utilisation
d1175 2
a1176 2
R&eacute;f&eacute;rez-vous &eacute;galement &agrave; la <a href="#PPP">FAQ 6,
Protocole Point &agrave; Point</a>.
d1185 1
a1185 1
devrait r&eacute;pondre &agrave; la plupart des besoins:
d1197 1
a1197 1
<tt>LOGINNAME</tt> doit &ecirc;tre remplac&eacute; par votre identifiant de
d1201 1
a1201 1
Ins&eacute;rez une ligne similaire &agrave; celle qui suit dans
d1210 3
a1212 3
O&ugrave; LOGINNAME repr&eacute;sente votre identifiant de connexion et PASSWORD
votre mot de passe. 10.0.0.138 &eacute;tant l'adresse IP de votre modem au cas
o&ugrave; vous utiliseriez l'ADSL, etc. Faites attention que ce fichier ne soit
d1216 1
a1216 1
<h3>6.8.1 - Assigner une adresse IP &agrave; votre interface</h3>
d1219 5
a1223 5
Dans l'exemple pr&eacute;c&eacute;dent, votre modem avait une adresse
pr&eacute;configur&eacute;e de 10.0.0.138. Nous devons maintenant assigner une
adresse &agrave; NOTRE interface. Il est pr&eacute;f&eacute;rable d'utiliser une
adresse proche de celle donn&eacute;e à votre MODEM ou l'adresse IP statique
qui vous est assign&eacute;e. Plus d'information sur la mise en place des
d1225 1
a1225 1
du r&eacute;seau</a>.
d1228 2
a1229 2
Une fois votre interface configur&eacute;e, vous devriez &ecirc;tre en mesure de
cr&eacute;er une connexion pptp &agrave; l'aide de la commande:
d1236 2
a1237 2
Puisque ppp(8) est utilis&eacute;, deux processus sont d&eacute;marr&eacute;s.
Vous pouvez arr&ecirc;ter pptp en tuant ces deux processus:
d1245 2
a1246 2
Il est recommand&eacute; d'ouvrir <tt>/var/log/messages</tt> dans un autre
terminal afin de diagnostiquer d'&eacute;ventuels probl&egrave;mes.
d1254 3
a1256 3
Nous vous conseillons &eacute;galement de placer les commandes de
d&eacute;marrage dans le fichier <i>/etc/rc.local</i> afin que la connexion soit
lanc&eacute;e &agrave; chaque fois que la machine d&eacute;marre.
d1265 8
a1272 8
</a>") est un lien entre deux (ou plusieurs) r&eacute;seaux
s&eacute;par&eacute;s. A l'inverse d'un routeur, les paquets sont
transf&eacute;r&eacute;s &agrave; travers le pont de mani&egrave;re "invisible"
-- au niveau logique, les deux segments de r&eacute;seau semblent n'en faire
qu'un de chaque c&ocirc;t&egrave; du pont. Le pont ne transf&egrave;rera que les
paquets passant d'un segment &agrave; l'autre, ce qui entre autres, permet de
r&eacute;duire le trafic sur un r&eacute;seau complexe tout en permettant
&agrave; n'importe quel noeud d'acc&eacute;der &agrave; un autre en cas de
d1276 3
a1278 3
Notez qu'&agrave; cause de sa nature "invisible", une interface faisant partie
d'un pont peut, ou non ,poss&eacute;der une adresse IP. Si c'est le cas,
l'interface aura deux modes d'op&eacute;ration, l'un comme faisant parti du pont
d1280 3
a1282 3
poss&egrave;de d'adresse IP, le pont fera transiter le trafic mais ne sera pas
administrable par le r&eacute;seau (ce qui peut &ecirc;tre une
fonctionnalit&eacute; voulue).
d1288 8
a1295 8
Un des mes racks poss&egrave;de un certain nombre d'anciens syst&egrave;mes,
lesquels ne sont pas &eacute;quip&eacute;s de carte r&eacute;seau 10BASE-TX.
Bien qu'ils poss&egrave;dent des ports AUI ou AAUI, ma r&eacute;serve de
transmetteurs est limit&eacute;e &agrave; des c&acirc;bles coaxiaux. Une des
machines de cette rang&eacute;e est un serveur d'acc&egrave;s terminal sous
OpenBSD, toujours allum&eacute;e et connect&eacute;e au r&eacute;seau &agrave;
haut d&eacute;bit. L'ajout d'une seconde carte &eacute;quip&eacute;e d'un port
coaxial permettra d'utiliser cette machine comme un pont vers le r&eacute;seau
d1299 1
a1299 1
Ce syst&egrave;me a, pour le moment, deux cartes r&eacute;seau, une Intel
d1305 5
a1309 5
r&eacute;seau et poss&egrave;de donc une adresse IP, <tt>ep0</tt>, ne faisant
quant &agrave; elle que du "bridging", n'en poss&egrave;de pas. Les machines
connect&eacute;es sur le segment coaxial communiqueront comme les autres
pr&eacute;sentes sur le reste du r&eacute;seau. A pr&eacute;sent, voyons comment
arriver &agrave; ce r&eacute;sultat.
d1313 2
a1314 2
<tt>fxp0</tt>. Cette machine est configur&eacute;e pour DHCP, donc le fichier
ressemble &agrave; celui-ci:
d1328 1
a1328 1
peu diff&eacute;rente:
d1338 1
a1338 1
Ici, nous demandons au syst&egrave;me d'activer cette interface en utilisant <a
d1341 2
a1342 2
ou information similaire n'est n&eacute;cessaire pour cette interface. Les
options possibles pour la carte <tt>ep</tt> sont disponibles en d&eacute;tail
d1347 2
a1348 2
A pr&eacute;sent, il nous faut param&eacute;trer le pont. Un pont est
initialis&eacute; par l'existence d'un fichier du type <a
d1362 1
a1362 1
Cela indique de mettre en place un pont constitu&eacute; de deux interfaces,
d1364 2
a1365 2
&eacute;nonc&eacute;es est important ? Non, souvenez-vous qu'un pont est
tr&egrave;s sym&eacute;trique -- les paquets entrent et sortent dans les deux
d1369 1
a1369 1
C'est tout ! Red&eacute;marrez et vous aurez un pont fonctionnel.
d1375 1
a1375 1
&eacute;voqu&eacute;, il est probable que vous souhaitiez FAIRE quelquechose
d1377 1
a1377 1
href="#PF">Packet Filter</a> peut &ecirc;tre utilis&eacute; pour restreindre le
d1381 4
a1384 4
Gardez &agrave; l'esprit que de part la nature d'un pont, les m&ecirc;mes
donn&eacute;es traversent les deux interfaces, ce qui signifie que vous n'avez
besoin de filtrer que sur l'une d'entre elles. Vos d&eacute;claration par
d&eacute;faut "Pass all" ressembleront &agrave; l'exemple suivant:
d1396 2
a1397 2
Maintenant, admettons que je souhaite filtrer le trafic dirig&eacute; vers les
vieux syst&egrave;mes &eacute;voqu&eacute;s pr&eacute;c&eacute;demment, ne
d1401 1
a1401 1
charge les donn&eacute;es retourn&eacute;es:
d1419 4
a1422 4
Notez que cette r&egrave;gle bloquera tout, &agrave; l'exception des
requ&ecirc;tes entrantes HTTP et SSH, vers la machine qui fait le pont ainsi
qu'en direction des autres noeuds "derri&egrave;re" elle. Il est possible
d'obtenir d'autres r&eacute;sultats en filtrant sur l'autre interface.
d1425 1
a1425 1
Pour surveiller et contr&ocirc;ler le pont que vous venez de cr&eacute;er,
d1428 2
a1429 2
brconfig(8)</a> qui peut aussi &ecirc;tre utilis&eacute;e pour cr&eacute;er un
pont apr&egrave;s le d&eacute;marrage.
d1435 1
a1435 1
<li>Il est HAUTEMENT recommand&eacute; de ne filtrer que sur une seule
d1437 2
a1438 2
en conna&icirc;tre toutes les implications avant de pouvoir le faire de la bonne
mani&egrave;re.
d1444 3
a1446 3
bridgename.bridge0</a>, vous pouvez emp&ecirc;cher le trafic non-IP (comme IPX
ou NETBEUI) de passer o&ucirc;tre votre filtre. Dans certaines situations, cela
peut-&ecirc;tre important et vous devez savoir qu'un pont fonctionne pour tous
d1449 3
a1451 3
<li>Un pont requiert que les interfaces r&eacute;seau soient en mode
"Promiscuous" -- elles &eacute;coutent TOUT le trafic r&eacute;seau, pas
seulement celui leur &eacute;tant dirig&eacute;. Ceci augmentera la charge du
d1459 17
a1475 17
<h2>6.10 - Comment d&eacute;marrer en utilisant PXE ? (i386, amd64)</h2>
PXE ("Preboot Execution Environment", environnement d'ex&eacute;cution avant
d&eacute;marrage) permet de d&eacute;marrer un ordinateur &agrave; partir du
r&eacute;seau plut&ocirc;t que d'un disque dur, une disquette ou un CD-ROM. A
l'origine, cette technologie a &eacute;t&eacute; d&eacute;velopp&eacute;e par
Intel mais est maintenant support&eacute;e par la plupart des contr&ocirc;leurs
r&eacute;seau et des constructeurs. Sachez qu'il existe plusieurs protocoles de
d&eacute;marrage par le r&eacute;seau, PXE &eacute;tant relativement
r&eacute;cent. Traditionnellement, un d&eacute;marrage PXE est effectu&eacute;
en utilisant des ROMs pr&eacute;sentes sur la carte r&eacute;seau ou la carte
m&egrave;re elle-m&ecirc;me, mais plusieurs disquettes permettant de
d&eacute;marrer en PXE sont disponibles sur diff&eacute;rentes sources. Beaucoup
de ROMs pr&eacute;sentes sur des anciens contr&ocirc;leurs supportent le
d&eacute;marrage en r&eacute;seau mais sont imcompatibles avec PXE ; s'il est
&eacute;quip&eacute; de tels contr&ocirc;lleurs, un syst&egrave;me OpenBSD/i386
ou amd64 ne pourra pas &ecirc;tre d&eacute;marr&eacute; &agrave; par le
r&eacute;seau.
d1480 1
a1480 1
<h3>Comment fonctionne un d&eacute;marrage PXE ?</h3>
d1482 3
a1484 3
se d&eacute;roule le processus de d&eacute;marrage d'OpenBSD/i386 ?</a> sur les
platformes i386 et amd64. Au d&eacute;marrage, chaque interface compatible PXE
&eacute;met une requ&ecirc;te DHCP en broadcast sur le r&eacute;seau. Le serveur
d1486 1
a1486 1
&agrave; ex&eacute;cuter sur le serveur
d1488 2
a1489 2
tftp(1)</a>. Ce fichier se charge ensuite de g&eacute;rer le reste du
d&eacute;marrage. Sous OpenBSD, <a
d1493 1
a1493 1
386">boot(8)</a> standard. Il est alors capable de charger et d'ex&eacute;cuter
d1495 1
a1495 1
<tt>bsd.rd</tt></a>) &agrave; partir du serveur tftp(1).
d1498 4
a1501 4
Le point &eacute;vident est que vous avez besoin d'une machine ou d'un
contr&ocirc;leur compatible avec un d&eacute;marrage PXE. Certaines
documentations pr&eacute;cisent que toutes les cartes modernes sont compatibles
PXE, mais c'est tout simplement faux -- de nombreux syst&egrave;mes &agrave;
d1503 2
a1504 2
d&eacute;marrage sur r&eacute;seau. Vous avez &eacute;galement besoin d'un
serveur <a href="#DHCP">DHCP</a> configur&eacute; ainsi qu'un serveur TFTP.
d1507 1
a1507 1
En admettant qu'une machine sous OpenBSD serve les fichiers de d&eacute;marrage
d1514 1
a1514 1
afin de pouvoir offrir ce fichier de d&eacute;marrage &agrave; une station de
d1543 1
a1543 1
Retirez simplement le caract&egrave;re '#' et envoyez &agrave; inetd(8) un
d1545 1
a1545 1
fichiers accessibles par tftpd(8) sont contenus dans un r&eacute;pertoire
d1547 2
a1548 2
&eacute;videmment, ce r&eacute;pertoire doit &ecirc;tre cr&eacute;&eacute; et
contenir les fichiers n&eacute;cessaires. Pour un d&eacute;marrage PXE, vous
d1555 1
a1555 1
>pxeboot</a>, le chargeur de d&eacute;marrage (offre la m&ecirc;me fonction que
d1558 1
a1558 1
386">boot</a> pour un d&eacute;marrage sur disque).
d1560 1
a1560 1
<tt>bsd</tt>, un noyau adapt&eacute;.
d1567 3
a1569 3
Notez que <tt>boot.conf</tt> n'est n&eacute;cessaire qu'au cas o&ugrave; vous
souhaiteriez d&eacute;marrer un noyau ne se nommant pas <tt>bsd</tt>, ou que les
options par d&eacute;faut de pxeboot ne vous conviennent pas. Vous pouvez tester
d1572 2
a1573 2
tftp(1)</a> afin de v&eacute;rifier que vous pouvez bien r&eacute;cup&eacute;rer
les fichiers n&eacute;cessaires.
d1576 5
a1580 5
Une fois vos serveurs DHCP et TFTP d&eacute;marr&eacute;s, vous &ecirc;tes
pr&ecirc;t pour un essai. Vous devez activer PXE sur votre syst&egrave;me ou
votre carte r&eacute;seau ; consultez la documentation fournie avec votre
mat&eacute;riel. Une fois que PXE est activ&eacute;, vous devriez voir
appara&icirc;tre des lignes similaires &agrave; celles-ci:
d1598 3
a1600 3
A pr&eacute;sent, vous obtenez l'invite de commandes standard d'OpenBSD. Tapez
simplement "<tt>bsd.rd</tt>" pour r&eacute;cup&eacute;rer le fichier homonyme
&agrave; partir du serveur TFTP.
d1623 1
a1623 1
<h3>Est-il possible de d&eacute;marrer d'autres noyaux que <tt>bsd.rd</tt> en
d1626 3
a1628 3
Oui, bien qu'avec les outils actuellement pr&eacute;sents dans OpenBSD 3.5, le
d&eacute;marrage PXE ne soit essentiellement pr&eacute;vu que pour installer le
syst&egrave;me d'exploitation.
d1876 2
a1877 2
<a href="faq5.html">[Section 5 - Construire le Syst&egrave;me &agrave; partir des Sources]</a>
<a href="../faq7.html">[Section 7 - Contr&ocirc;les du clavier et de l'affichage]</a></font>
d1887 1
a1887 1
$Translation: faq6.html,v 1.27 2004/10/07 11:06:34 ajacoutot Exp $<br>
@


1.12
log
@Sync with Steelix CVS
@
text
@d57 1
d127 3
a129 3
href="../../fr/plat.html">plates-formes actuellement support&eacute;es</a> par votre
architecture. Vous pourrez y trouver le nom des cartes les plus courantes et
leur &eacute;quivalent sous OpenBSD. Ajoutez au nom alphab&eacute;tique du
d504 2
a505 2
ceci est d&eacute;crit dans le <a href="../pf/fr/index.html"><b>Guide de l'Utilisateur
PF</b></a>.
d512 5
d526 2
a527 1
Tout ce que vous avez besoin d'&eacute;crire dans ce fichier est '<tt>dhcp</tt>'
d540 2
a541 2
commande, v&eacute;rifiez bien que /etc/dhclient.conf existe, puis lancez la
commande:
d548 2
a549 2
O&ugrave; fxp0 repr&eacute;sente l'interface que vous voulez configurer par
dhcp.
d553 5
a557 4
&eacute;diter /etc/dhclient.conf afin de ne <b>pas</b> mettre &agrave; jour vos
DNS &agrave; l'aide du serveur dhcp en d&eacute;commentant les lignes 'request'
(il y a des exemples de configurations, mais vous devez les d&eacute;commenter
afin de changer le comportement par d&eacute;faut de dhclient.)
d610 1
a610 1
commandes, une fois /etc/dhcpd.conf configur&eacute;, tapez:
d991 3
a993 3
fichiers que vous souhaitez rendre accessibles par NFS et d&eacute;finit qui peut
y acc&eacute;der. Beaucoup d'options sont disponibles pour l'&eacute;dition de
ce fichier et vous devriez lire la page de manuel <a
d1037 4
a1040 4
Vous devez non seulement d&eacute;marrer le serveur nfsd(8) mais &eacute;galement
mountd(8). Il s'agit du service qui se charge de passer les requ&ecirc;tes de
montage &agrave; NFS. Pour d&eacute;marrer mountd(8), soyez s&ucirc;r qu'un
fichier mountdtab vide existe puis lancez le d&eacute;mon:
d1462 1
a1462 1
r&eacute;seau plut&ocirc;t que d'un disque dur, une disquette ou un CDROM. A
d1481 2
a1482 2
Tout d'abord, il serait sage de savoir <a href="../faq14.html#Boot386">comment se
d&eacute;roule le processus de d&eacute;marrage d'OpenBSD/i386 ?</a> sur les
d1494 2
a1495 2
un noyau (comme <tt>bsd</tt> ou <a href="faq4.html#bsd.rd"><tt>bsd.rd</tt></a>)
&agrave; partir du serveur tftp(1).
d1630 241
d1887 1
a1887 1
$Translation: faq6.html,v 1.26 2004/10/06 16:43:37 saad Exp $<br>
@


1.11
log
@Sync with Steelix CVS
@
text
@d843 1
a843 1
href="http://www.freebsd.org/doc/en_US.ISO8859-1/books/handbook/userppp.html">
d1486 1
a1486 1
un noyau (comme <tt>bsd</tt> ou <a href="../faq4.html#bsd.rd"><tt>bsd.rd</tt></a>)
d1638 1
a1638 1
$Translation: faq6.html,v 1.24 2004/09/21 06:38:26 saad Exp $<br>
@


1.10
log
@Sync with Steelix CVS
@
text
@d4 1
a4 1
<title>6 - Administration R&eacute;seau</title>
d11 1
a11 1
<meta name= "copyright"     content= "This document copyright 1998-2003 by OpenBSD.">
d21 2
a22 3
<a href="faq5.html">[Section 5 - Construire le syst&egrave;me &agrave; partir des sources ]</a>
<a href="faq7.html">[Section 7 - Contr&ocirc;le du clavier et de l'affichage]</a>
</font>
d24 2
a25 2
<h1><font color="#e00000">6 - Administration R&eacute;seau</font></h1>
<!-- UNCOMMENT ONLY WHEN THE FILE IS OUT OF SYNC -->
d38 1
a38 1
<!-- -->
d44 13
a56 10
<li><a href= "#Intro" >6.0.1 - Avant d'aller plus loin</a>
<li><a href= "#Setup" >6.1 - Configuration R&eacute;seau de base</a>
<li><a href= "#PF"    >6.2 - Le filtrage de paquets (PF)</a>
<li><a href= "#DHCP"  >6.4 - Protocole de Configuration Dynamique d'H&ocirc;te</a>
<li><a href= "#PPP"   >6.5 - Le Protocole Point &agrave; Point</a>
<li><a href= "#Tuning">6.6 - Optimisation des param&egrave;tres R&eacute;seau</a>
<li><a href= "#NFS"   >6.7 - Utiliser NFS</a>
<li><a href= "#DNS"   >6.8 - Le service de nom de domaine - DNS, BIND et named</a>
<li><a href= "#PPTP"  >6.9 - Configurer une connexion PPTP sous OpenBSD</a>
<li><a href= "#Bridge">6.10 - Configurer une passerelle sous OpenBSD</a>
d63 2
a64 2
<a name="6.0.1"></a>
<h2>6.0.1- Avant d'aller plus loin</h2>
d66 29
a94 34
Pour pouvoir lire - et comprendre ! - la majeure partie de ce document, 
il est bon que vous ayiez lu et compris m&ecirc;me partiellement la 
section de cette FAQ consacr&eacute;e &agrave; la 
<a href="faq5.html">configuration et au param&egrave;trage du noyau</a> 
ainsi que les pages de manuel des commandes 
<a href= "http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&amp;sektion=8">
ifconfig(8)</a> et
<a href= "http://www.openbsd.org/cgi-bin/man.cgi?query=netstat&amp;sektion=1">
netstat(1)</a>.

<p>
Si vous &ecirc;tes un administrateur r&eacute;seau et que vous 
souhaitez mettre en oeuvre des protocoles de routage, si vous 
souhaitez mettre en place un routeur sous OpenBSD ou si vous 
souhaitez approfondir vos connaissances en mati&egrave;re de 
r&eacute;seaux IP, nous vous invitons &agrave; lire <a 
href="http://www.3com.com/other/pdfs/infra/corpinfo/en_US/501302.pdf">Comprendre l'Adressage IP</a>
(Understanding IP Addressing). C'est un excellent document qui 
contient tout ce que vous devez savoir sur les r&eacute;seaux IP 
et dont la lecture vous sera d'une grande utilit&eacute; si vous 
&egrave;tes amen&eacute;(e) &agrave; administrer plusieurs r&eacute;seaux.

<p>
Si vous travaillez avec des applications telles que des serveurs 
web, FTP ou de messagerie &eacute;lectronique, vous tirerez le plus 
grand b&eacute;n&eacute;fice de la lecture des 
<a href="http://the.rfceditor.org/rfc.html">RFCs</a>.
Vous n'aurez vraisemblablement pas besoin de toutes les lire. 
Choisissez celles qui se rapportent &agrave; un sujet qui vous 
int&eacute;resse ou &agrave; votre environnement r&eacute;seau. 
Parcourez-les et familiarisez-vous avec la fa&ccedil;on dont elles sont 
construites. Les RFCs d&eacute;finissent plusieurs (milliers de) standards 
pour les protocoles utilis&eacute;s sur Internet et la mani&egrave;re 
dont ils sont cens&eacute;s fonctionner.
d98 1
a98 2
<a name="6.1"></a>
<h2>6.1 - Configuration R&eacute;seau de base</h2>
d102 1
a102 2
<a name="6.1.1"></a>
<h3>6.1.1 - Identifier et configurer les interfaces R&eacute;seau</h3>
d105 11
a115 11
Pour commencer, vous devez identifier votre interface r&eacute;seau. 
Sous OpenBSD, les interfaces sont nomm&eacute;es d'apr&egrave;s le type 
de la carte utilis&eacute;e et non d'apr&egrave;s le type de connexion. 
Pour savoir comment a &eacute;t&eacute; initialis&eacute;e votre carte 
r&eacute;seau durant la phase de d&eacute;marrage de votre syst&egrave;me, 
utilisez la commande <a 
href="http://www.openbsd.org/cgi-bin/man.cgi?query=dmesg&amp;sektion=8">dmesg(8)</a>. 
Vous pouvez &eacute;galement utiliser la commande <a 
href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&amp;sektion=8">ifconfig(8)</a>.
Voici par exemple un extrait de la commande dmesg pour une carte r&eacute;seau 
Intel Fast Ethernet utilisant le p&eacute;riph&eacute;rique fxp :
d118 2
a119 1
fxp0 at pci0 dev 10 function 0 "Intel 82557" rev 0x0c: irq 5, address 00:02:b3:2b:10:f7
d124 17
a140 19
Si vous ignorez le type de p&eacute;riph&eacute;rique utilis&eacute; 
par votre carte r&eacute;seau, reportez-vous &agrave; la <a 
href="../../plat.html">liste des mat&eacute;riels support&eacute;s</a> 
par votre plate-forme.
Vous y trouverez la liste des cartes r&eacute;seau les plus communes et 
le nom du p&eacute;riph&eacute;rique qui leur est associ&eacute; sous OpenBSD.
Le nom d'une interface r&eacute;seau est constitu&eacute; du nom de ce 
p&eacute;riph&eacute;rique (par exemple fxp) suivi d'un chiffre 
assign&eacute; par le noyau (par exemple fxp0).

<p>
La commande <a 
href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&amp;sektion=8">ifconfig(8)</a> 
vous permet de visualiser les interfaces r&eacute;seau qui ont 
&eacute;t&eacute; identifi&eacute;es.  
La commande suivante affiche toutes les interfaces d'un syst&egrave;me.
Cet exemple nous montre qu'il n'y a qu'une seule interface ethernet
physique, de type 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=fxp&amp;sektion=4">fxp(4)</a>. 
d171 2
d180 9
a188 9
Comme vous le constatez, 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&amp;sektion=8">ifconfig(8)</a> 
nous donne beaucoup plus d'informations sur les interfaces r&eacute;seau 
que n&eacute;cessaire &agrave; ce stade. Ici une interface est 
d&eacute;j&agrave; configur&eacute;e et une adresse IP (en 
l'occurence &quot;inet
10.0.0.38 netmask 0xffffff00 broadcast 10.0.0.255&quot;) lui a 
&eacute;t&eacute; assign&eacute;e. Les drapeaux <strong>UP</strong> 
et <strong>RUNNING</strong> sont &eacute;galement positionn&eacute;s.
d191 3
a193 4
Enfin, vous remarquerez que d'autres interfaces sont activ&eacute;es 
par d&eacute;faut. Ces interfaces virtuelles servent &agrave; 
diff&eacute;rentes fonctions 
d&eacute;crites dans les pages de manuels suivantes : 
d197 18
a214 12
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=lo&amp;sektion=4">lo</a>
 - Interface de bouclage (NdT : Loopback)
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflog&amp;sektion=4&amp;manpath=OpenBSD+3.3">pflog</a>
 - Interface de journalisation utilis&eacute;e par le filtre de 
paquets Packet Filter
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sl&amp;sektion=4">sl</a>
 - Interface SLIP
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ppp&amp;sektion=4">ppp</a>
 - Protocole Point &agrave; Point
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tun&amp;sektion=4">tun</a>
 - Interface de "tunnelisation"
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=enc&amp;sektion=4">enc</a>
d216 3
a218 1
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=bridge&amp;sektion=4">bridge</a>
d220 5
a224 3
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=vlan&amp;sektion=4">vlan</a>
 - Interface d'encapsulation IEEE 802.1Q
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=gre&amp;sektion=4">gre</a>
d226 6
a231 2
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=gif&amp;sektion=4">gif</a>
 - Interface g&eacute;n&eacute;rique de tunnelisation IPv4/IPv6
d235 5
a239 5
Si aucune interface r&eacute;seau n'est encore configur&eacute;e, 
la premi&egrave;re &eacute;tape consiste &agrave; cr&eacute;er un fichier 
<i>/etc/hostname.xxx</i>, o&ugrave; xxx sera remplac&eacute; par le nom 
de votre interface. Pour l'exemple ci-dessus, ce fichier s'appellerait 
<i>/etc/hostname.fxp0</i>. Le format de ce fichier est simple :<br>
d245 4
a248 3
(Voir la page de manuel <a 
href="http://www.openbsd.org/cgi-bin/man.cgi?query=hostname.if&amp;sektion=5">hostname.if(5)</a>
pour plus de d&eacute;tails.)
d251 2
a252 1
Un fichier de configuration type pour IPv4 ressemble &agrave; ceci :
d260 2
a261 3
Il vous est possible de sp&eacute;cifier les types de m&eacute;dia Ethernet, 
ce qui est utile si vous d&eacute;sirez par exemple forcer une carte en 
mode 100baseTX full-duplex :
d268 4
a271 4
(Bien entendu, vous ne devriez faire cela que si les deux 
extr&eacute;mit&eacute;s de la connexion fonctionnent en mode full-duplex ! 
Sauf besoin particulier, ne touchez pas aux param&egrave;tres propres 
au m&eacute;dia.)
d274 3
a276 3
Si vous souhaitez positionner des drapeaux sp&eacute;ciaux pour une 
interface donn&eacute;e, vous vous apercevrez que le format du fichier 
hostname n'est gu&egrave;re diff&eacute;rent :
d284 14
a297 14
L'&eacute;tape suivante consiste &agrave; choisir une passerelle par 
d&eacute;faut en inscrivant son adresse IP dans le fichier 
<i>/etc/mygate</i>. La passerelle sera alors param&egrave;tr&eacute;e 
automatiquement &agrave; chaque (re)d&eacute;marrage de la machine.
Il vous reste &agrave; configurer le(s) serveur(s) de nom de domaine
et votre fichier <i>/etc/hosts</i> (voir la page de manuel <a 
href="http://www.openbsd.org/cgi-bin/man.cgi?query=hosts&amp;sektion=5">hosts(5)</a>). 
La configuration du service de nom se fait &agrave; l'aide du fichier 
<i>/etc/resolv.conf</i>. Consultez la page de manuel <a 
href="http://www.openbsd.org/cgi-bin/man.cgi?query=resolv.conf&amp;sektion=5">resolv.conf(5)</a> 
pour de plus amples informations sur son format.
Voici un exemple de fichier standard (les adresses des serveurs de noms 
utilis&eacute;s sont  125.2.3.4 et 125.2.3.5 et votre machine appartient 
au domaine &quot;example.com&quot;) :
d308 3
a310 3
Vous pouvez maintenant red&eacute;marrer votre machine ou lancer 
(sous l'identit&eacute; du super-utilisateur root) le script 
<strong>/etc/netstart</strong> :
d321 16
a336 18
Quelques erreurs peuvent se produire en lan&ccedil;ant ce script si vous 
reconfigurez des choses qui l'&eacute;taient d&eacute;j&agrave; comme par 
exemple des routes pr&eacute;sentes dans les tables de routage du noyau. 
Cependant, &agrave; partir de l&agrave;, votre syst&egrave;me devrait 
&ecirc;tre op&eacute;rationnel.
Une fois de plus, pour vous assurer que votre interface r&eacute;seau est 
correctement configur&eacute;e, utilisez la commande <a 
href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&amp;sektion=8">ifconfig(8)</a>.
Vous pouvez aussi v&eacute;rifier le routage &agrave; l'aide de la commande 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=netstat&amp;sektion=1">netstat(1)</a>
ou de la commande <a 
href="http://www.openbsd.org/cgi-bin/man.cgi?query=route&amp;sektion=8">route(8)</a>.
Si vous rencontrez des probl&egrave;mes de routage, utilisez l'otpion -n 
avec la commande 
route(8), ce qui &eacute;vite la r&eacute;solution de noms et se contente 
d'afficher les adresses IP des machines destinataires.
Voici un exemple d'affichage des tables de routage &agrave; l'aide de ces 
deux commandes :
d371 1
a371 2
<a name="6.1.2"></a>
<h3>6.1.2 - Configurer votre OpenBSD en routeur</h3>
d374 20
a393 18
Ce paragraphe contient les informations de base qui vous seront utiles si 
vous d&eacute;sirez utiliser votre OpenBSD comme routeur. Nous vous 
sugg&eacute;rons de lire les instructions et documents relatifs &agrave; 
Packet Filter pour pouvoir bloquer tout trafic potentiellement dangereux 
ainsi que la documentation sur la translation d'adresses (ce qui peut vous 
&ecirc;tre utile &eacute;tant donn&eacute; le peu d'adresses <a 
href="http://www.openbsd.org/cgi-bin/man.cgi?query=ip&amp;sektion=4">IPv4</a> 
encore disponibles aupr&egrave;s des fournisseurs d'acc&egrave;s et autres 
registres nationaux).

<p>
Le routage IP est support&eacute; par le noyau GENERIC. Vous devez 
cependant l'activer &agrave; l'aide de la commande <a 
href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&amp;sektion=8">sysctl(8)</a>. 
Pour p&eacute;renniser cette configuration, &eacute;ditez le fichier <a 
href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl.conf&amp;sektion=5">/etc/sysctl.conf</a> 
pour autoriser de fa&ccedil;on permanente le reroutage IP en y ajoutant la 
ligne suivante :
d400 6
a405 5
Le prise en compte de ces nouveaux param&egrave;tres peut s'effectuer sans 
avoir &agrave; red&eacute;marrer la machine gr&agrave;ce &agrave; la commande 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&amp;sektion=8">sysctl(8)</a> 
(n'oubliez pas que les changements effectu&eacute;s seront alors perdus au 
prochain red&eacute;marrage) :
d408 1
a408 1
# <strong>sysctl -w net.inet.ip.forwarding=1</strong>
d413 9
a421 11
Modifiez maintenant les routes sur chaque h&ocirc;te de chaque 
c&ocirc;t&egrave;. 
OpenBSD peut &ecirc;tre utilis&eacute; comme routeur de plusieurs fa&ccedil;ons
 &agrave; l'aide de logiciels comme <a 
href="http://www.openbsd.org/cgi-bin/man.cgi?query=routed&amp;sektion=8">routed(8)</a>,
<a href="http://www.gated.org">gated</a>, <a 
href="http://www.mrtd.net">mrtd</a>,
et <a href="http://www.zebra.org">zebra</a>. Zebra, gated et mrtd sont 
disponibles sous formes de ports pour OpenBSD. De plus, OpenBSD supporte de 
nombreux types d'interfaces : T1, HSSI, ATM, FDDI, Ethernet, s&eacute;rie 
(PPP/SLIP).
d425 1
a425 2
<a name="6.1.3"></a>
<h3>6.1.3 - Cr&eacute;er un alias d'interface</h3>
d428 9
a436 9
La cr&eacute;ation d'alias pour une interface sous OpenBSD est simple : il 
vous suffit d'&eacute;diter le fichier <a 
href="http://www.openbsd.org/cgi-bin/man.cgi?query=hostname.if&amp;sektion=5"><i>/etc/hostname.&lt;if&gt;</i></a> 
qui est lu durant la phase de d&eacute;marrage par le script <a 
href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc&amp;sektion=8">/etc/rc(8)</a> 
qui fait partie de la hi&eacute;rarchie de scripts <a 
href="faq10.html#rc">rc startup</a>. 
Prenons l'exemple d'une interface <b>dc0</b> sur le r&eacute;seau 192.168.0.0. 
avec les param&egrave;tres suivants :
d439 2
a440 2
<li>l'IP pour dc0 est 192.168.0.2
<li>le NETMASK est 255.255.255.0
d444 17
a460 21
Remarques sur les alias.  
Vous n'utilisez sous OpenBSD que le nom d'une interface. OpenBSD - 
&agrave; la diff&eacute;rence d'autres syst&egrave;mes d'exploitation qui 
g&egrave;rent le premier alias sous la forme dc0:0, le second sous la forme 
dc0:1, etc... - ne fait aucune distinction entre les alias. Ainsi, si vous 
faites r&eacute;f&eacute;rence &agrave; l'alias d'une adresse IP ou si vous 
souhaitez en cr&eacute;er un, veillez bien &agrave; utiliser la syntaxe 
"<tt>ifconfig
int alias</tt>" plut&ocirc;t que "<tt>ifconfig int</tt>". Les alias peuvent 
&ecirc;tre effac&eacute;s de cette fa&ccedil;on : 
"<tt>ifconfig int delete</tt>".

<p>
En supposant que vous ayiez plusieurs adresses IP sur un m&ecirc;me 
sous-r&eacute;seau, le masque de sous-r&eacute;seau pour chaque alias sera 
255.255.255.255. Ces masques ne doivent pas n&eacute;cessairement &ecirc;tre 
identiques &agrave; celui de la premi&egrave;re adresse IP affect&eacute;e 
&agrave; l'interface. Dans l'exemple suivant (<i>/etc/hostname.dc0</i>) deux 
alias sont ajout&eacute;s &agrave; l'interface dc0 d&eacute;j&agrave; 
configur&eacute;e avec l'adresse IP 192.168.0.2 et le masque de 
sous-r&eacute;seau 255.255.255.0 :
d470 6
a475 5
Il vous suffit de red&eacute;marrer la machine pour que ces 
modifications soient prises en compte.
Vous pouvez aussi utiliser la commande <a 
href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&amp;sektion=8">ifconfig(8)</a> 
de la mani&egrave;re suivante :
d482 1
a482 1
Pour visualiser les alias :
d496 9
a504 8
<h2>6.2 - Packet Filter (PF)</h2>
Packet Filter (que nous nommerons ci-apr&egrave;s PF) est le syst&egrave;me 
de filtrage TCP/IP et de translation d'adresses (NdT : NAT) 
int&eacute;gr&eacute; au noyau GENERIC d'OpenBSD depuis la version 3.0. PF 
permet &eacute;galement de normaliser le traffic TCP/IP, d'impl&eacute;menter 
le contr&ocirc;le de bande passante ainsi que la prioritisation de paquets. 
Tout cela est d&eacute;crit en long en large et en travers dans le tout nouveau
 <a href="../pf/index.html"><b>Guide d'Utilisation PF</b></a>.
a505 2
<p>
L'ancienne FAQ PF est encore accessible <a href="../faq6pf.html">ici</a>.
d509 1
a509 2
<a name= "6.4"></a> 
<h2>6.4 - Le protocole DHCP</h2> 
d512 1
a512 1
<h3>6.4.1 Configurer un client DHCP</h3>
d515 6
a520 6
Pour configurer OpenBSD en tant que client DHCP, utilisez le programme  
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dhclient&amp;sektion=8">dhclient(8)</a>
inclus dans OpenBSD. Editez le fichier /etc/hostname.xl0 (en supposant que 
votre interface r&eacute;seau principale est xl0. La v&ocirc;tre peut tout 
aussi bien s'appeler ep0 ou fxp0 ou autrement !) et ajoutez-y le mot-clef 
'dhcp' :
d527 3
a529 3
Le client DHCP sera lanc&eacute; automatiquement au d&eacute;marrage de la 
machine qui obtiendra ainsi son adresse IP, celles de la passerelle par 
d&eacute;faut et des serveurs DNS du serveur DHCP.
d532 3
a534 3
Si vous devez lancer le client DHCP depuis la ligne de commande, 
assurez-vous que le fichier 
/etc/dhclient.conf existe puis essayez :
d541 2
a542 1
(o&ugrave; fxp0 est l'interface que vous souhaitez configurer en DHCP).
d545 5
a549 6
Quelque soit la fa&ccedil;on dont vous d&eacute;marrez le client DHCP 
(dhclient), vous pouvez &eacute;diter le fichier /etc/dhclient.conf 
pour en accorder le contenu &agrave; vos besoins plut&ocirc;t que d'en 
utiliser les param&egrave;tres par d&eacute;faut. Vous pouvez par exemple 
ne <b>pas</b> mettre &agrave; jour les informations DNS par DHCP en 
d&eacute;commentant les lignes 'request' :
d557 2
a558 2
puis <b>supprimer</b> la variable domain-name-servers. Vous pouvez bien 
s&ucirc;r supprimer &eacute;galement la variable hostname entre autres.
d561 1
a561 1
<h3>6.4.2 Configurer un serveur DHCP</h3>
d564 6
a569 7
Vous pouvez utiliser OpenBSD en tant que serveur DHCP (<a 
href="http://www.openbsd.org/cgi-bin/man.cgi?query=dhcpd&amp;sektion=8">dhcpd(8)</a>).
Pour cela, &eacute;ditez le fichier /etc/rc.conf et positionnez 
la valeur de la variable dhcpd_flags &agrave; "-q" (dhcpd_flags="-q") 
au lieu de NO (dhcpd_flags=NO).
Listez ensuite dans le fichier /etc/dhcpd.interfaces le nom des interfaces 
sur lesquelles le serveur DHCP dhcpd <b>doit &eacute;couter</b> :
d576 2
a577 2
Enfin, &eacute;ditez le fichier /etc/dhcpd.conf dont les options sont 
assez explicites :
d591 8
a598 9
Cela indiquera &agrave; vos clients DHCP que le domaine auquel ils 
sont rattach&eacute;s est example.com (de mani&egrave;re &agrave; ce 
que l'utilisateur qui entrera la commande 'telnet joe' sera dirig&eacute; 
vers le serveur joe.example.com). De la m&ecirc;me mani&egrave;re, vos clients 
utiliseront les serveurs DNS 192.168.1.3 et 192.168.1.5. Les machines 
clientes situ&eacute;es sur le m&ecirc;me r&eacute;seau que celui d'une 
interface Ethernet du serveur DHCP OpenBSD  (&agrave; savoir la plage 192.168.1.0/24) 
se verront affecter une adresse IP comprise entre 192.168.1.32 et 192.168.1.127. 
Leur passerelle par d&eacute;faut sera la machine avec l'adresse 192.168.1.1.
d601 2
a602 2
Pour lancer le serveur dhcpd(8) depuis la ligne de commande apr&egrave;s 
modification du fichier /etc/dhcpd.conf :
d605 1
d610 9
a618 3
o&ugrave; <tt>fxp0</tt> est l'interface sur laquelle vous souhaitez mettre 
&agrave; disposition le service DHCP.
L'option <tt>-q</tt> lance dhcpd(8) en mode discret. Il est sinon assez verbeux.
d621 4
a624 3
Si votre serveur DHCP OpenBSD doit &ecirc;tre utilis&eacute; par des clients 
Windows, vous pouvez leur renvoyer l'adresse d'un serveur WINS en ajoutant 
la ligne suivante au fichier /etc/dhcpd.conf :
d631 7
a637 5
(o&ugrave; <tt>192.168.92.55</tt> est l'adresse IP de votre serveur 
Windows ou Samba.)
Voir la page de manuel <a 
href="http://www.openbsd.org/cgi-bin/man.cgi?query=dhcp-options&amp;sektion=5">dhcp-options(5)</a> 
pour plus de d&eacute;tails sur les options DHCP.
a641 1
<a name="6.5"></a>
d645 3
a647 3
PPP (Point-to-Protocol) est g&eacute;n&eacute;ralement utilis&eacute; pour 
cr&eacute;er un connexion par modem entre vous et un FAI. Cela peut 
&ecirc;tre fait de deux mani&egrave;res sous OpenBSD.
d650 5
a654 4
<li>Gr&agrave;ce &agrave; <a 
href="http://www.openbsd.org/cgi-bin/man.cgi?query=pppd&amp;sektion=8">pppd(8)</a>
 (d&eacute;mon PPP int&eacute;gr&eacute; au noyau).
<li>Gr&agrave;ce &agrave; <a 
d656 1
a656 1
 (d&eacute;mon PPP en mode Utilisateur). 
d660 3
a662 2
Nous commencerons par voir l'utilisation du d&eacute;mon en mode 
Utilisateur. Avant d'aller plus loin, il faut les informations suivantes :
d665 4
a668 4
<li>Le num&eacute;ro d'appel de votre FAI ;
<li>Le nom de votre serveur DNS ;
<li>Votre nom d'utilisateur et votre mot de passe ;
<li>L'adresse de votre passerelle.
d672 8
a679 8
Si certaines de ces informations sont optionnelles, elles n'en sont 
pas moins utiles pour bien configurer votre connexion PPP. La 
configuration du d&eacute;mon PPP en mode Utilisateur se fait &agrave; 
l'aide du fichier <a 
href="http://www.openbsd.org/cgi-bin/cvsweb/src/etc/ppp/ppp.conf.sample">/etc/ppp/ppp.conf</a>. 
Vous trouverez d'ailleurs dans le r&eacute;pertoire <i>/etc/ppp</i> des 
exemples de fichiers correspondant &agrave; diff&eacute;rentes situations 
dont vous pourrez vous inspirer.
d682 2
a683 2
Si vous n'utilisez pas un noyau GENERIC, assurez-vous que la ligne suivante 
est pr&eacute;sente dans votre fichier de configuration :
d686 1
a686 1
pseudo-device   tun             2
d693 7
a699 9
La configuration initiale du d&eacute;mon PPP (Utilisateur) se fait dans le fichier 
<i>/etc/ppp/ppp.conf</i>. Ce fichier n'existe pas par d&eacute;faut : vous 
pouvez vous inspirer du fichier <i>/etc/ppp/ppp.conf.sample</i> pour le 
cr&eacute;er. Nous allons &eacute;tudier une configuration tr&egrave;s 
simple qui devrait convenir &agrave; la plupart des besoins. Le fichier 
<i>ppp.conf</i> suivant assurera la connexion &agrave; votre FAI et le 
param&egrave;trage des routes par d&eacute;faut ainsi que des serveurs 
de nom. Les seules informations dont vous aurez besoin sont le num&eacute;ro 
d'appel de votre FAI et vos nom d'utilisateur et mot de passe : 
d707 2
a708 1
set dial "ABORT BUSY ABORT NO\\sCARRIER TIMEOUT 5 \"\" AT OK-AT-OK ATE1Q0 OK\\dATDT\\T TIMEOUT 40 CONNECT"
d713 5
a717 5
Les commandes de la section qui suit le mot-clef <tt>default:</tt> 
seront ex&eacute;cut&eacute;es &agrave; chaque connexion. Nous y 
avons donc mis toutes les informations importantes. Le degr&eacute; 
de journalisation est param&egrave;tr&eacute; gr&agrave;ce au mot-clef &quot;set
log&quot; (cela peut &ecirc;tre chang&eacute;. Consultez la page de manuel <a 
d719 20
a738 19
pour plus d'informations sur les diff&eacute;rents degr&eacute;s de journalisation). 
Le p&eacute;riph&eacute;rique (auquel est rattach&eacute; le modem) est configur&eacute; 
par &quot;set device&quot;. Dans notre exemple, le modem est rattach&eacute; au 
port s&eacute;rie 2 (<i>/dev/cua01</i>. Le port s&eacute;rie 1 sera donc 
<i>/dev/cua00</i>.) La vitesse de connexion du modem est param&egrave;tr&eacute;e 
&agrave; l'aide de l'option &quot;set speed&quot; et les param&egrave;tres d'appel 
&agrave; l'aide des options &quot;set dial&quot;. Il est aussi possible de modifier 
la dur&eacute;e d'inactivit&eacute; (NdT : timeout) &agrave; l'issue de laquelle la 
connexion sera coup&eacute;e, etc... Cependant, rien ne devrait &ecirc;tre 
modifi&eacute; dans cette ligne.

<p>
Voyons maintenant comment prendre en compte les informations sp&eacute;cifiques 
&agrave; votre FAI. 
Sous la section <b>default:</b>, ajoutez une nouvelle balise que vous appellerez 
comme bon vous semble, le plus simple &eacute;tant de lui donner le nom de 
votre FAI (dans notre exemple <n>myisp:</b>). Nous mettrons dans cette section 
toutes les informations n&eacute;cessaires &agrave; l'&eacute;tablissement 
d'une connexion chez le FAI :
d743 1
a743 1
set phone 0123456789   
d753 15
a767 10
L'option &quot;set phone&quot; correspond au num&eacute;ro d'appel de votre 
FAI et l'option &quot;set login&quot; aux options de connexion. La dur&eacute;e 
maximale d'inactivit&eacute; avant d&eacute;connexion automatique (NdT : timeout) 
en cas d'absence de porteuse est fix&eacute;e &agrave; 5 secondes. Dans le cas 
inverse (la porteuse est d&eacute;tect&eacute;e) votre nom d'utilisateur et votre 
mot de passe seront renvoy&eacute;s &agrave; l'invite &quot;login:&quot;.
Dans notre exemple, le nom d'utilisateur est ppp et le mot de passe ppp.
La directive &quot;set timeout&quot; fixe &agrave; 120 secondes la p&eacute;riode 
d'inactivit&eacute; pour la connexion. La directive &quot;set ifaddr&quot; est plus 
d&eacute;licate &agrave; comprendre et m&eacute;rite que l'on s'y attarde un peu : 
d774 25
a798 25
Dans la ligne ci-dessus (dont le format est 
&quot;<b>set ifaddr [myaddr[/nn] [hisaddr[/nn] [netmask [triggeraddr]]]]</b>&quot;)
la premi&egrave;re adresse IP sp&eacute;cifi&eacute;e est celle que nous voulons. 
C'est aussi celle que vous devez sp&eacute;cifier si votre FAI vous a 
allou&eacute; une adresse IP fixe. Le /0 indique qu'aucun des octets de cette 
adresse ne doit correspondre &agrave; ceux de l'adresse IP choisie : par cons&eacute;quent, 
toute l'adresse IP peut &ecirc;tre remplac&eacute;e. 
La seconde adresse IP est celle que nous attendons de la part du FAI (si elle est 
connue). Comme pour la premi&egrave;re, nous ne savons pas quelle IP nous 
sera attribu&eacute;e, d'o&ugrave; le /0 qui autorise son remplacement tout ou partie. 
La troisi&egrave;me option est le masque de sous-r&eacute;seau (255.255.255.0).
Si le param&egrave;tre triggeraddr est positionn&eacute;, sa valeur est utilis&eacute;e 
en lieu et place de myaddr lors de la n&eacute;gociation IPCP initiale.
Cependant, seule une adresse IP de la m&ecirc;me plage que celle de myaddr sera 
accept&eacute;e. C'est utile lors de la n&eacute;gociation avec quelques 
impl&eacute;mentations de PPP qui n'attribuent aucune adresse IP &agrave; moins que 
l'autre partie ne demande "0.0.0.0".

<p>
L'option suivante &quot;add default HISADDR&quot; positionne la route par d&eacute;faut.
Cette option est persistante dans le sens o&ugrave; si l'adresse IP de notre FAI 
change notre route sera automatiquement mise &agrave; jour. L'option &quot;enable
dns&quot; autorise l'authentification de nos serveurs de noms aupr&egrave;s du FAI. 
<b>Ne faites pas</b> cela si vous utilisez un serveur DNS local : ppp contournera 
votre configuration en ajoutant juste quelques lignes &agrave; <i>/etc/resolv.conf</i>.
d804 3
a806 4
Maintenant que nous avons renseign&eacute; notre fichier <i>ppp.conf</i> nous 
pouvons tenter une connexion avec notre FAI. Nous allons voir plus en 
d&eacute;tail quelques-uns des arguments les plus commun&eacute;ment 
utilis&eacute;s avec ppp.
d809 5
a813 5
<li><tt>ppp -auto myisp</tt> - Cette commande va lancer ppp, configurer 
votre interface r&eacute;seau, &eacute;tablir la connexion avec votre 
FAI puis basculera en arri&egrave;re-plan.
<li><tt>ppp -ddial myisp</tt> - Similaire &agrave; -auto mais si la 
connexion tombe, ppp tentera de la r&eacute;tablir.
d817 4
a820 3
Vous pouvez utiliser <i>/usr/sbin/ppp</i> sans option en mode interactif pour 
dialoguer avec le modem, ce qui peut s'av&eacute;rer utile pour d&eacute;boguer 
un fichier <i>ppp.conf</i>.
d823 1
a823 1
<h3>ppp(8) extras</h3>
d826 5
a830 4
Si vous souhaitez ex&eacute;cuter des commande au moment de l'&eacute;tablissement ou 
de la rupture de votre connexion, vous pouvez cr&eacute;er des fichiers 
<i>/etc/ppp/ppp.linkup</i> et <i>/etc/ppp/ppp.linkdown</i> dont vous trouverez 
ici des exemples :
d833 6
a838 2
<li><a href="http://www.openbsd.org/cgi-bin/cvsweb/src/etc/ppp/ppp.linkup.sample">ppp.linkup</a>
<li><a href="http://www.openbsd.org/cgi-bin/cvsweb/src/etc/ppp/ppp.linkdown.sample">ppp.linkdown</a>
d842 4
a845 3
Pour plus d'informations vous pouvez consulter <a 
href="http://www.freebsd.org/doc/en_US.ISO8859-1/books/handbook/userppp.html">la section Utilisation de PPP</a> 
du manuel FreeBSD (en anglais).
d848 2
a849 3
<a name="6.6"></a>
<h2>6.6 - Optimisation des param&egrave;tres
r&eacute;seau</h2>
d853 8
a860 9
<h3>Comment dois-je optimiser le noyau pour augmenter le nombre de
(re)tentatives et allonger le d&eacute;lai maximal d'inactivit&eacute;
des sessions TCP ?</h3>
<p>
Cette op&eacute;ration est particuli&egrave;rement utile pour
r&egrave;gler des probl&egrave;mes de routage. Bien entendu, les
meilleurs r&eacute;sultats sont obtenus lorsque les deux
extr&egrave;mit&eacute;s de la connexion utilisent les m&ecirc;mes
param&egrave;tres.
d863 1
a863 2
Utilisez la commande <tt>sysctl</tt> pour augmenter la valeur des
param&egrave;tres suivants : 
d872 7
a878 3
sysctl -a vous permet de visualiser leur valeur courante (entre autres). Pour
les modifier, utilisez <tt>sysctl -w</tt> comme ceci :
<tt>sysctl -w net.inet.tcp.keepidle=28800</tt>.
d881 5
a885 2
<h3>6.6.2 - Comment activer la multi-diffusion (NdT : broadcast)
dirig&eacute;e ?</h3>
d887 7
a893 15
En temps normal vous ne devriez pas avoir &agrave; le faire : cela
permettrait &agrave; quelqu'un d'envoyer du trafic sur une ou plusieurs
adresses de multi-diffusion de votre r&eacute;seau si vous utilisez votre
machine OpenBSD comme routeur.
<P>
Cependant, dans certains cas (sur des r&eacute;seaux
ferm&eacute;s) cette fonctionnalit&eacute; peut &ecirc;tre
tr&egrave;s utile, en particulier si vous utilisez des
impl&eacute;mentations anciennes du protocole NetBIOS.
Une fois de plus, vous utiliserez la commande sysctl de la mani&egrave;re
suivante pour activer cela :
<Tt>sysctl -w net.inet.ip.directed-broadcast=1</tt>. 
Lisez ce document <a href="http://www.netscan.org">smurf attacks</a> pour
comprendre pourquoi elle est d&eacute;sactiv&eacute;e par
d&eacute;faut...
d896 2
a897 2
<h3>6.6.3 - Je souhaite interdire l'attribution dynamique de certains
ports par le noyau</h3>
d900 3
a902 3
Toujours et encore la commande sysctl(8) dont la <a 
href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&amp;sektion=8">page de manuel</a> 
nous apprend :
d905 5
a909 4
[sysctl] sp&eacute;cifie la liste des ports TCP que le noyau ne devrait pas
allouer dynamiquement. Cela permet d'interdire l'acc&egrave;s par und&eacute;mon 
&agrave; un port dont un autre programme a besoin. Les &eacute;l&eacute;ments de 
la liste peuvent &ecirc;tre s&eacute;par&eacute;s par une virgule ou un espace :
d911 1
a911 2
 #  <strong>sysctl -w 
net.inet.tcp.baddynamic=749,750,751,760,761,871</strong>
d913 1
a913 1
Il est possible d'ajouter ou d'&ocirc;ter des ports de cette liste :
d915 2
a916 2
 #  <strong>sysctl -w net.inet.tcp.baddynamic=+748</strong>
 #  <strong>sysctl -w net.inet.tcp.baddynamic=-871</strong>
d919 1
d922 1
a922 2
<a name="6.7"></a>
<h2>6.7 - Utilisation de NFS</h2>
d925 3
a927 5
NFS (Network File System : Syst&egrave;me de Fichier R&eacute;seau) est
utilis&eacute; pour partager un syst&egrave;me de fichiers &agrave;
travers un r&eacute;seau.
Avant de vous lancer dans la mise en oeuvre d'un serveur NFS, vous devriez lire les 
pages de manuel suivantes :
d930 9
a938 8
<li><a 
href="http://www.openbsd.org/cgi-bin/man.cgi?query=nfsd&amp;sektion=8">nfsd(8)</a>
<li><a 
href="http://www.openbsd.org/cgi-bin/man.cgi?query=mountd&amp;sektion=8">mountd(
8)</a>
<li><a 
href="http://www.openbsd.org/cgi-bin/man.cgi?query=exports&amp;sektion=5">exports(5
)</a>
d942 30
a971 27
Dans ce paragraphe, nous d&eacute;taillerons la configuration de NFS &agrave; 
travers l'exemple d'un serveur et de clients situ&eacute;s sur un m&ecirc;me 
r&eacute;seau local que nous supposerons prot&eacute;g&eacute; du monde 
ext&eacute;rieur (par filtrage de paquets).
Si vous autorisez l'acc&egrave;s depuis l'ext&eacute;rieur &agrave; un serveur NFS sur 
lequel sont stock&eacute;es des donn&eacute;es confidentielles, nous vous 
recommandons chaudement l'utilisation du protocole <a href="../faq13.html">IPsec</a> 
sous peine d'exposer votre trafic NFS &agrave; d'&eacute;ventuelles &eacute;coutes. 
Bien configur&eacute;, IPSEC vous prot&egrave;ge contre de nombreux types 
d'attaques.

<p>
Autre remarque importante sur la s&eacute;curit&eacute; : n'ajoutez pas un 
syst&egrave;me de fichiers dans <i>/etc/exports</i> sans lister les h&ocirc;tes 
autoris&eacute;s &agrave; s'y connecter, sans cela toute machine pouvant s'y connecter 
pourra acc&eacute;der aux fichiers export&eacute;s via NFS.

<p>
NFS repose sur le d&eacute;mon <a 
href="http://www.openbsd.org/cgi-bin/man.cgi?query=portmap&amp;sektion=8">portmap
(8)</a>
qui doit tourner. Portmap(8) est d&eacute;sactiv&eacute; par d&eacute;faut depuis la 
version 3.2 d'OpenBSD. Vous devrez donc l'activer dans votre fichier 
<a 
href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc.conf&amp;sektion=8">rc.conf(8)
</a>
en changeant la ligne <tt>portmap</tt> :
d976 1
a976 2
sans oublier de red&eacute;marrer votre machine pour que les modifications soient 
prises en compte.
d979 10
a988 9
Soit un serveur dont l'adresse IP est <b>10.0.0.1</b> qui ne sera accessible en NFS que 
par des clients situ&eacute;s sur le m&ecirc;me r&eacute;seau. La premi&egrave;re 
chose que vous aurez &agrave; faire est de configurer le fichier <i>/etc/exports</i> qui 
liste les syst&egrave;mes de fichiers accessibles via NFS et en d&eacute;finit les conditions 
d'acc&egrave;s (par qui ?...).
Pour tout connaitre des nombreuses options utilisables dans ce fichier, la meilleure source 
d'informations reste la page de manuel  
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=exports&amp;sektion=5">exports(5)</a>
. Pour notre exemple, notre fichier <i>/etc/exports</i> ressemble &agrave; &ccedil;a :
d999 24
a1022 23
Le syst&egrave;me de fichiers <tt>/work</tt> sera donc accessible via NFS.
L'option <tt>-alldirs</tt> indique que les clients pourront monter n'importe 
quel point sous la rarcine 
<tt>/work</tt>. L'option <tt>-ro</tt> sp&eacute;cifie que ce syst&egrave;me 
de fichiers ne sera accessible 
qu'en lecture seule. Les deux derniers arguments limitent l'acc&egrave;s aux 
seuls clients du r&eacute;seau 10.0.0.0.
Cette derni&egrave;re option est importante pour les serveurs accessibles 
depuis plusieurs r&eacute;seaux.

<p>
Une fois le fichier <i>/etc/exports</i> renseign&eacute; vous pouvez passer &agrave; la 
configuration du serveur NFS. Assurez-vous tout d'abord que les options NFSSERVER &amp; NFSCLIENT 
figurent dans la configuration de votre noyau (elles sont pr&eacute;sentes dans le noyau GENERIC).
Positionnez ensuite &agrave; <tt>YES</tt> l'option <tt>nfs_server</tt> (soit 
<tt>nfs_server=YES</tt>) dans <i>/etc/rc.conf</i> pour lancer au d&eacute;marrage les 
d&eacute;mons nfsd(8) et mountd(8). Vous pourrez aussi d&eacute;marrer ces d&eacute;mons 
vous-m&ecirc;mes (ces d&eacute;mons doivent &ecirc;tre lanc&eacute;s en tant que root). 
Assurez-vous que portmap(8) tourne &eacute;galement. Voici un exemple de 
d&eacute;marrage du d&eacute;mon nfsd(8) utilisant les protocoles TCP et UDP et 4 
d&eacute;mons (vous devriez lancer un nombre de d&eacute;mons adapt&eacute; au nombre 
maximum de requ&ecirc;tes 
clientes simultan&eacute;es que vous d&eacute;sirez supporter) :
d1029 4
a1032 4
Vous devrez non seulement d&eacute;marrer le serveur nfsd(8) mais aussi le d&eacute;mon 
mountd(8) qui prend en charge les requ&ecirc;tes de montage NFS. Pour lancer 
mountd(8), v&eacute;rifiez qu'il existe un fichier vide nomm&eacute; mountdtab 
puis lancez le d&eacute;mon :
d1040 3
a1042 2
Si vous mofidiez le fichier /etc/export pendant le serveur NFS tourne, vous 
devrez "HUPer" le d&eacute;mon mountd : 
d1052 3
a1054 3
Pour v&eacute;rifier &agrave; tout instant que ces deux d&eacute;mons tournent 
et sont bien enregistr&eacute;s aupr&egrave;s des services RPC, utilisez 
la commande rpcinfo(8) :
d1072 7
a1078 6
D'autres commandes sont utiles pour surveiller l'ex&eacute;cution normale de NFS : 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=showmount&amp;sektion=8">showmount(8)</a>
 permet de visualiser 
les points de montage utilis&eacute;s et par qui,  
nfsstat(8) donne des statistiques plus d&eacute;taill&eacute;es.
Voici un exemple d'utilisation de showmount(8) :
d1090 7
a1096 7
Les syst&egrave;mes de fichiers NFS sont mont&eacute;s via la commande mount(8) et plus 
particuli&egrave;rement 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mount_nfs&amp;sektion=8">mount_nfs(8)</a>. 
Ainsi, pour rattacher au syst&egrave;me de fichiers local <i>/mnt</i> le 
syst&egrave;me de fichiers <i>/work</i> du serveur 10.0.0.1, utilisez la 
commande suivante (il n'est pas n&eacute;cessaire d'utiliser l'adresse IP : 
mount sait r&eacute;soudre les noms de domaines) : 
d1103 2
a1104 2
Pour faire cela au d&eacute;marrage; ajouter ceci dans votre fichier 
<i>/etc/fstab</i> : 
d1111 4
a1114 4
Il est important d'ajouter <tt>0 0</tt> &agrave; la fin de la ligne de fa&ccedil;on &agrave; 
ce que votre machine ne lance pas la commande fsck sur le syst&egrave;me de fichiers NFS 
au d&eacute;marrage ! D'autres options standard li&eacute;es &agrave; la s&eacute;curit&eacute; 
telles que noexec, nodev et nosuid peuvent &ecirc;tre utilis&eacute;es :
d1121 4
a1124 4
Ainsi aucun p&eacute;riph&eacute;rique ni programme setuid sur le serveur NFS ne peuvent 
circonvenir aux mesures de s&eacute;curit&eacute; mises en place sur le client.
Si vous n'envisagez pas d'utiliser des programmes situ&eacute;s sur le serveur NFS ajoutez l'option 
noexec &agrave; cette liste.
d1127 2
a1128 216
<a name="DNS"></a>
<a name="6.8"></a>
<h2>6.8 - Le service de nom de domaines : DNS, BIND et named</h2>

<p>
<i>Avertissement : ce paragraphe a &eacute;t&eacute; &eacute;crit pour les versions 3.2 et ant&eacute;rieures  
d'OpenBSD qui incluaient BIND4.
C'est maintenant BIND9 qui est distribu&eacute; avec OpenBSD 3.3. Cette version de BIND 
est beaucoup plus document&eacute;e que ne l'&eacute;tait la pr&eacute;c&eacute;dente.</i>

<p><i>Tout comme BIND4, BIND9 s'ex&eacute;cute sous OpenBSD dans un environnement cloisonn&eacute; (NdT : chroot(2)) 
et am&eacute;liore la s&eacute;curit&eacute; de BIND gr&agrave;ce aux fonctionnalit&eacute;s suivantes : 
</i>
<ul>
<li><i>Support de la fonction arc4random() (int&eacute;gr&eacute;e dans la version 9.3.0-snapshot)</i>
<li><i>Appel &agrave; la fonction tzset avant le cloisonnement (NdT : chroot)</i>
<li><i>Ouverture du pseudo-p&eacute;riph&eacute;rique /dev/null avant le cloisonnement</i>
<li><i>Retour au g&eacute;n&eacute;rateur de nombres al&eacute;atoires par d&eacute;faut du syst&egrave;me pendant le cloisonnement</i>
<li><i>Impl&eacute;mentation de LCG (G&eacute;n&eacute;rateur Lin&eacute;aire Congru) pour la librairie libisc</i>
<li><i>Utilisation de LCG en lieu et place de LFSR pour la g&eacute;n&eacute;ration d'identifiants</i>
<li><i>Possibilit&eacute; de choisir IPv{4,6} pour les requ&ecirc;tes faites par dig(1)</i>
<li><i>Version corrig&eacute;e de sha1.c contournant le bogue d'optimisation gcc (sparc64)</i>
<li><i>Cloisonnement dans <tt>/var/named</tt> par d&eacute;faut</i>
<li><i>D&eacute;mon s'ex&eacute;cutant sous l'identit&eacute; <tt>named</tt> par d&eacute;faut</i>
<li><i>Ecriture du fichier pid avant le cloisonnement</i>
</ul>
<i>Les utilisateurs d'OpenBSD 3.3 liront : </i>
<ul>
<li><i><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=named&amp;sektion=8">named(8)</a></i>
<li><i><a href="http://www.openbsd.org/cgi-bin/cvsweb/~checkout~/src/usr.sbin/bind/doc/arm/Bv9ARM.html"
>BIND 9 Administrator Reference Manual</a> (Disponible dans le r&eacute;pertoire 
<tt>/usr/share/doc/html/bind/</tt>)</i>
</ul>

<h3>6.8.1 Qu'est-ce que le DNS ?</h3>
Le service de nom de domaine (Domain Name Service) permet la r&eacute;solution de domaines IP, c'est-&agrave;-dire l'association d'un nom &agrave; une adresse IP (et vice versa).
Par d&eacute;faut votre machine OpenBSD est configur&eacute;e comme client DNS et non comme serveur. Ce qui signifie qu'elle peut soumettre des requ&ecirc;tes &agrave; un serveur de nom de domaine mais ne peut y r&eacute;pondre &agrave; moins d'$ecirc;tre configur&eacute;e pour le faire. 

<p>
Ma machine OpenBSD &eacute;tant actuellement connect&eacute;e &agrave; Internet gr&agrave;ce &agrave; mon FAI, je peux utiliser 
la commande 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=nslookup&amp;sektion=8">nslookup(8)</a>
pour ex&eacute;cuter des requ&ecirc;tes DNS : 

<blockquote><pre>
$ <strong>nslookup www.openbsd.org</strong>
Server:  ns4.us.prserv.net
Address:  165.87.201.244

Non-authoritative answer:
Name:    www.openbsd.org
Address:  129.128.5.191
</pre></blockquote>

<p>
<b>165.87.201.244</b> est l'adresse IP du serveur DNS qui a r&eacute;pondu &agrave; ma requ&ecirc;te. Cette adresse m'a &eacute;t&eacute; fournie 
par mon FAI et figure dans mon fichier 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=resolv.conf&amp;sektion=5">/etc/resolv.conf</a>.
Cependant, la r&eacute;ponse renvoy&eacute;e par ce serveur n'&eacute;tait pas autoritaire. Si je d&eacute;sire obtenir une telle r&eacute;ponse, 
je dois tout d'abord trouver l'adresse IP du serveur ayant autorit&eacute; sur le domaine <i>openbsd.org</i> puis l'interroger :

<blockquote><pre>
# Gr&agrave;ce au serveur de mon FAI, 
# on identifie le serveur d'autorit&eacute; pour openbsd.org
$ <strong>nslookup -type=NS openbsd.org</strong>
Server:  ns4.us.prserv.net
Address:  165.87.201.244

Non-authoritative answer:
openbsd.org     nameserver = cvs.openbsd.org
openbsd.org     nameserver = gandalf.sigmasoft.com
openbsd.org     nameserver = cs.colorado.edu
openbsd.org     nameserver = ns.appli.se
openbsd.org     nameserver = zeus.theos.com

Authoritative answers can be found from:
cvs.openbsd.org internet address = 199.185.137.3
gandalf.sigmasoft.com   internet address = 198.144.202.98
cs.colorado.edu internet address = 128.138.243.151
ns.appli.se     internet address = 194.198.196.230
zeus.theos.com  internet address = 199.185.137.1

# On utilise les informations renvoy&eacute;es par la pr&eacute;c&eacute;dente 
# requ&ecirc;te et on interroge le serveur zeus.theos.com
$ <strong>nslookup www.openbsd.org zeus.theos.com</strong>
Server:  zeus.theos.com
Address:  199.185.137.1

Name:    www.openbsd.org
Address:  129.128.5.191
</pre></blockquote>

<p>
<i>zeus.theos.com</i> tourne - je le suppose - sous OpenBSD et est - bien - configur&eacute; 
en tant que serveur DNS pour le domaine <i>openbsd.org</i>.

<p>
<a name="DNS.1.1"></a>
<a name="6.8.1.1"></a>
<h3>6.8.1.1 O&ugrave; puis-je tout savoir sur DNS sous OpenBSD ?</h3>
<ul>
<li>Jetez un oeil &agrave; aux RFCs <a href="http://www.faqs.org/rfcs/rfc1033.html">1033</a>, 
<a href="http://www.faqs.org/rfcs/rfc1034.html">1034</a> et  
<a href="http://www.faqs.org/rfcs/rfc1035.html">1035</a> pour en savoir plus sur le syst&egrave;me 
de nom de domaines sur Internet.
<li>Vous pouvez aussi lire cet ouvrage &eacute;dit&eacute; par O'Reilly Associates 
<i><a href="../../books.html#6">DNS
and BIND</a></i>.
<li>Le <a href="http://www.openbsd.org/cgi-bin/man.cgi">manuel OpenBSD</a> et plus particuli&egrave;rement les pages suivantes : 
  <ul>
  <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dig&amp;sektion=1">dig(1)</a>
  <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=nslookup&amp;sektion=8">nslookup(8)</a>
  <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=gethostbyname&amp;sektion=3">gethostbyname(3)</a>
  <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=named&amp;sektion=8">named(8)</a>
  <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=resolver&amp;sektion=3">resolver(3)</a>
  <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=resolver&amp;sektion=5">resolver(5)</a>
  </ul>
</ul>

<p>
La commande 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dig&amp;sektion=1">dig(1)</a>
est tr&egrave;s utile car elle permet d'interroger un serveur et de pr&eacute;senter ses 
r&eacute;ponses dans un format similaire &agrave; celui des fichiers de configuration de BIND. 
Vous pouvez aussi - toujours gr&agrave;ce &agrave; <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dig&amp;sektion=1">dig(1)</a> - 
comparer la configuration de serveurs bien configur&eacute;s et op&eacute;rationnels &agrave; la v&ocirc;tre.

<p>
<h3>6.8.2 Ma machine doit-elle &ecirc;tre serveur DNS ?</h3>

<p>
Si vous n'&ecirc;tes pas s&ucirc;r d'avoir besoin de faire de votre machine un serveur DNS, 
ne la configurez pas comme tel. Par d&eacute;faut, apr&egrave;s installation, OpenBSD n'active pas 
le serveur de nom de domaine, m&ecirc;me si tous les fichiers n&eacute;cessaires 
sont pr&eacute;sents.
Pour la plupart des stations de travail, le fichier 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hosts&amp;sektion=5">/etc/hosts</a>
contenant les noms et adresses IP des machines du r&eacute;seau local et le fichier 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=resolv.conf&amp;sektion=5">/etc/resolv.conf</a>
indiquant quels sont les serveurs DNS responsables de la r&eacute;solution de noms et d'adresses sur l'intranet ou Internet suffisent.

<p>
Autrement, vous pouvez avoir besoin de configurer votre machine en tant que serveur DNS dans les cas suivants :
<ul>
<li>
Vous ne voulez pas dupliquer les fichiers "hosts" sur chaque machine d'un m&ecirc;me LAN. Votre serveur OpenBSD jouera le r&ocirc;le de serveur DNS et r&eacute;pondra aux requ&ecirc;tes des autres machines du LAN.
  <ul>
  <li><b>Remarque : </b> il n'y a aucune restriction pratique du nombre de serveurs DNS 
  sur un m&ecirc;me LAN. Une ou plusieurs machines peuvent offrir ce service si elles sont 
  configur&eacute;es pour le faire. Le fait qu'un de ces serveurs fasse autorit&eacute; ou soit connu en dehors de votre LAN est un aspect de sa configuration contr&ocirc;l&eacute; au niveau imm&eacute;diatement sup&eacute;rieur dans la hi&eacute;rarchie du domaine. 
  </ul>
<li>
Si il y a sur votre LAN des machines devant &ecirc;tre connues au sens DNS du terme sur d'autres r&eacute;seaux locaux ou distants.
<li>
Si vous rencontrez des difficult&eacute;s pour r&eacute;soudre les noms et adresses IP locales malgr&eacute; la bonne configuration de vos fichiers 
<i>/etc/hosts</i> et <i>/etc/resolv.conf</i> 
(Netscape sous OpenBSD en particulier a ce genre de comportement parce qu'il utilise son propre 
m&eacute;canisme de r&eacute;solution plut&ocirc;t que <i>gethostbyname(3)</i>.)
</ul>

<p>
Un autre crit&egrave;re de d&eacute;cision est la rapidit&eacute; d'ex&eacute;cution. La r&eacute;solution est un processus it&eacute;ratif au cours duquel un serveur de nom lance des requ&ecirc;tes successives vers d'autres serveurs de noms pour les domaines qu'il ne g&egrave;re pas. Cela peut prendre plus de temps, si vous avez une connexion &agrave; Internet par modem,  d'utiliser votre propre serveur DNS pour la r&eacute;solution d'adresses externes que d'interroger celui de votre FAI (qui dispose s&ucirc;rement d'une connexion plus rapide que la v&ocirc;tre aux autres serveurs DNS).

<p>
<h3>6.8.3 De quels logiciels est compos&eacute; un serveur DNS ?</h3>
<ul>
<li>du d&eacute;mon named 
<li>des fichiers de configuration dans le r&eacute;pertoire et les sous-r&eacute;pertoires <i>/var/named/</i>
</ul>

<p>
<h4>6.8.3.1 Quelle est la version de BIND support&eacute;e ?</h4>
<!-- XXXchanges - changes with OpenBSD 3.3 -->

<p>
BIND est le nom d'une sp&eacute;cification pour un serveur de nom de domaine impl&eacute;ment&eacute;e par plusieurs composants.

<p>
Il y a trois sp&eacute;cifications diff&eacute;rentes :

<ol>
<li>BIND 4
<li>BIND 8
<li>BIND 9
</ol>

<p>
Dans son installation par d&eacute;faut, le d&eacute;mon <b>named</b> d'OpenBSD appartient &agrave; la branche 4.x de BIND.

<p>
<h4>6.8.3.2 Quelles sont les alternatives &agrave; la version par d&eacute;faut BIND 4.x ?</h4>
<!-- XXXexpires - goes away when 3.2 becomes unsupported -->

<ul>
<li>BIND 9.x, qui se trouve dans le r&eacute;pertoire <i>/usr/ports/net/bind9</i>.(Voir 
la section de cette FAQ consacr&eacute;e aux <a href="../../ports.html">ports</a>)
</ul>

<p>
<h5>6.8.3.2.1 Note sur la <u>s&eacute;curit&eacute;</u></h5>

<p>
Si vous d&eacute;cidez d'utiliser une version alternative pour votre DNS, sachez que vous appuierez un service r&eacute;seau critique sur un logiciel qui peut ne pas avoir &eacute;t&eacute; soumis au m&ecirc;me 
<a href="http://www.openbsd.org/security.html">audit de s&eacute;curit&eacute;</a>
que le d&eacute;mon <b>named</b> de l'installation par d&eacute;faut. 
Ceci est &agrave; prendre avec consid&eacute;ration dans la mesure o&ugrave; si votre serveur DNS est compromis, c'est toute la r&eacute;solution de nom et d'adresses qui peut &ecirc;tre gravement compromise, les applications utilisant votre serveur pouvant se trouver rediriger vers des sites pirates.

<p>
<h3>6.8.4 Que dois-je installer ?</h3>

<p>
Si la configuration par d&eacute;faut du r&eacute;seau a &eacute;t&eacute; bien faite au moment de l'installation d'OpenBSD, tout ce dont vous avez besoin est d&eacute;j&agrave; install&eacute;. Vous devez juste configurer le d&eacute;mon <tt>named</tt>.

<p>
<h3>6.8.5 Comment configurer le serveur DNS ?</h3>
<!-- XXXchanges - changes with OpenBSD 3.3 -->
d1131 7
a1137 2
Pour configurer votre serveur DNS OpenBSD, vous devez &eacute;diter et/ou cr&eacute;er les fichiers qui contr&ocirc;lent le d&eacute;mon <tt>named</tt>. Ces fichiers se trouvent par d&eacute;faut dans l'arborescence <i>/var/named</i>. Vous y trouverez le fichier <i>/var/named/named.boot</i> qui permet l'initialisation de <b>named</b>. Il y a aussi un peu de configuration &agrave; faire dans 
<i>/etc</i>.
d1140 4
a1143 3
Dans ce paragraphe, nous d&eacute;crirons la configuration d'un serveur DNS sur la machine 
<i>nemo.yewtopia.com</i> qui sera le serveur de nom primaire pour le (minuscule) domaine 
 <i>yewtopia.com</i>. L'adresse de ce serveur est <i>192.168.1.9</i>. Il y a sur le m&ecirc;me sous-r&eacute;seau deux autres machines : <i>crater.yewtopia.com </i> &agrave; l'adresse 192.168.1.1 et <i>earhart.yewtopia.com</i> &agrave; l'adresse 192.168.1.2.
d1146 4
a1149 6
<h4>6.8.5.1 Configuration des fichiers dans <i>/var/named</i></h4>
<!-- XXXchanges - changes with OpenBSD 3.3 -->

<p>
<h5>6.8.5.1.1 <i>/var/named/named.boot</i></h5>

d1151 1
a1151 10
; tell what subdir has the lookup database files
directory       /namedb

; type    domain   source host/file backup file
cache     .        root.cache
primary   0.0.127.IN-ADDR.ARPA  localhost.rev

; example primary server config:
primary  yewtopia.com yewtopia
primary  1.168.192.IN-ADDR.ARPA yewtopia.rev
d1153 1
a1153 7

<p>
Ces lignes indiquent l'emplacement et le nom des fichiers de configuration pour le domaine <i>yewtopia.com</i> qui seront lus lors de l'initialisation de named.

<p>
<h5>6.8.5.1.2 <i>/var/named/namedb/localhost.rev</i></h5>

d1155 1
a1155 9
; Reverse lookup for localhost interface
@@       IN      SOA     nemo.yewtopia.com.  your_id.nemo.yewtopia.com.  (
                                14      ; Serial
                                3600    ; Refresh
                                900     ; Retry
                                3600000 ; Expire
                                3600 )  ; Minimum
        IN      NS      nemo.yewtopia.com.
1       IN      PTR     localhost.yewtopia.com.
d1157 1
d1160 9
a1168 310
<h5>6.8.5.1.3 <i>/var/named/namedb/yewtopia</i></h5>

<blockquote><pre>
; yewtopia.com domain database
@@      IN      SOA     nemo.yewtopia.com.  your_id.nemo.yewtopia.com.  (
                                14      ; Serial
                                3600    ; Refresh
                                900     ; Retry
                                3600000 ; Expire
                                3600 )  ; Minimum
                     IN      NS      nemo.yewtopia.com.

; Addresses
localhost.yewtopia.com.      IN A    127.0.0.1
crater.yewtopia.com.         IN A    192.168.1.1
earhart.yewtopia.com.        IN A    192.168.1.2
nemo.yewtopia.com.           IN A    192.168.1.9
</pre></blockquote>

<p>
<h5>6.8.5.1.4 <i>/var/named/namedb/yewtopia.rev</i></h5>

<blockquote><pre>
; yewtopia domain reverse lookup database
@@      IN      SOA     nemo.yewtopia.com.  your_id.nemo.yewtopia.com.  (
                                14      ; Serial
                                3600    ; Refresh
                                900     ; Retry
                                3600000 ; Expire
                                3600 )  ; Minimum
1.168.192.in-addr.arpa. IN      NS      nemo.yewtopia.com.

; Addresses
1.1.168.192.in-addr.arpa. IN PTR crater.yewtopia.com.
2.1.168.192.in-addr.arpa. IN PTR earhart.yewtopia.com.
9.1.168.192.in-addr.arpa. IN PTR nemo.yewtopia.com.
</pre></blockquote>

<p>
<h4>6.8.5.2 Configuration dans <i>/etc</i></h4>

<p>
<h5>6.8.5.2.1 <i>/etc/resolv.conf</i></h5>

<p>
Assurez-vous que le fichier <i>/etc/resolv.conf</i> pointe sur le domaine local (plut&ocirc;t que sur le serveur DNS de votre FAI) de fa&ccedil;on &agrave; ce que la r&eacute;solution soit faite par <u>votre</u> d&eacute;mon <b>named</b> :

<blockquote><pre>
domain yewtopia.com
lookup file bind
</pre></blockquote>

<p>
<h4>6.8.5.2.2 <i>/etc/hosts</i></h4>

<p>
Si vous aviez ajout&eacute; des adresses de machines &agrave; votre fichier 
<i>/etc/hosts</i> vous devriez remettre ce dernier dans sa configuration initiale :

<blockquote><pre>
# Host addresses
127.0.0.1       localhost       localhost.localdomain
192.168.1.9     nemo            nemo.yewtopia.com
</pre></blockquote>

<p>
Vous &eacute;viterez ainsi les interf&eacute;rences entre des adresses contenues dans un fichier - obsol&egrave;te - <i>/etc/hosts</i> et celles g&eacute;r&eacute;es par <b>named</b>.
<u>Assurez-vous qu'il existe toutefois dans ce fichier une entr&eacute;e par d&eacute;faut pour l'h&ocirc;te local (NdT : localhost)</u> faute de quoi le r&eacute;seau ne sera pas proprement configur&eacute; au d&eacute;marrage ! Notez que <i>nemo</i> doit &ecirc;tre enregistr&eacute; dans son propre fichier hosts si vous ne voulez pas voir de message d'erreur (cependant inoffensif) &agrave; l'ex&eacute;cution par le script de d&eacute;marrage <i>/etc/netstart</i> de la commande 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=route&amp;sektion=8">route(8)</a> pour <i>nemo</i> (dont le nom appara&icirc;t dans le fichier <i>/etc/myname</i>).

<p>
<h4>6.8.5.3 Utiliser  <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dig&amp;sektion=1">dig(1)</a>.</h4>

<blockquote><pre>
$ <strong>dig @@nemo.yewtopia.com yewtopia.com any any</strong>

; &lt;&lt;&gt;&gt; DiG 2.2 &lt;&lt;&gt;&gt; @@nemo.yewtopia yewtopia any any
; (1 server found)
;; res options: init recurs defnam dnsrch
;; got answer:
;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 59904
;; flags: qr rd ra; Ques: 1, Ans: 2, Auth: 0, Addit: 1
;; QUESTIONS:
;;      yewtopia.com, type = ANY, class = ANY

;; ANSWERS:
yewtopia.com.   3600    SOA    nemo.yewtopia.com.  your_id.nemo.yewtopia.com. (
                        14      ; serial
                        3600    ; refresh (1 hour)
                        900     ; retry (15 mins)
                        3600000 ; expire (41 days 16 hours)
                        3600 )  ; minimum (1 hour)
yewtopia.com.   3600    NS      nemo.yewtopia.com.

;; ADDITIONAL RECORDS:
nemo.yewtopia.com.  3600    A       192.168.1.9

;; Total query time: 4 msec
;; FROM: nemo to SERVER: nemo.yewtopia.com  192.168.1.9
;; WHEN: Tue May  2 23:47:19 2000
;; MSG SIZE  sent: 25  rcvd: 102
</pre></blockquote>

<p>
<h3>6.8.6 Comment et quand d&eacute;marre et s'arr&egrave;te le serveur DNS ?</h3>

<p>
<h4>6.8.6.1 D&eacute;marrage du serveur DNS</h4>

<p>
Le d&eacute;mon <b>named</b> est lanc&eacute; durant la phase de d&eacute;marrage du syst&egrave;me &agrave; l'aide du script 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc&amp;sektion=8">/etc/rc</a>
si la ligne suivante dans 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc.conf&amp;sektion=8">/etc/rc.conf</a> :

<blockquote><pre>
named_flags=NO          # for normal use: ""
</pre></blockquote>

<p>
est remplac&eacute;e par celle-ci :

<blockquote><pre>
named_flags=""          # for normal use: ""
</pre></blockquote>

<p>
Dans ce m&ecirc;me fichier, v&eacute;rifiez la pr&eacute;sence des lignes suivantes :

<blockquote><pre>
named_user=named                # Named should not run as root unless necessary
named_chroot=/var/named         # Where to chroot named if not empty
</pre></blockquote>

<p>
Ces param&egrave;tres par d&eacute;faut conviennent &agrave; une grande majorit&eacute; de configurations.

<p>
Pour lancer <b>named</b> manuellement, utilisez la commande 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ndc&amp;sektion=8">ndc(8)</a>. 
Par exemple :

<blockquote><pre>
# <strong>ndc start</strong>
          or
# <strong>ndc restart</strong>
</pre></blockquote>

<p>
<h4>6.8.6.2 Arr&ecirc;t du serveur DNS</h4>

<p>
La meilleure fa&ccedil;on d'arr&ecirc;ter le d&eacute;mon named est d'utiliser la commande 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ndc&amp;sektion=8">ndc(8)</a> comme dans l'exemple suivant : 

<blockquote><pre>
# <strong>ndc stop</strong>
</pre></blockquote>

<p>
Si cela &eacute;choue, utilisez la commande 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=kill&amp;sektion=1">kill(1)</a> en lui passant en param&egrave;tre le PID du processus named. Ce PID est stock&eacute; durant l'ex&eacute;cution de <b>named</b> &agrave; la premi&egrave;re ligne du fichier 
<i>/var/named/named.pid</i> :

<blockquote><pre>
# <strong>cat /var/named/named.pid</strong>
4608
named -t /var/named -u named
# <strong>kill -KILL 4608</strong>
</pre></blockquote>

<p>
<h4>6.8.6.3 Relancer le serveur DNS apr&egrave;s en avoir modifi&eacute; la configuration</h4>

<p>
La relance du d&eacute;mon named permet la relecture de ses fichiers de configuration, ce qui s'av&egrave;re particuli&egrave;rement utile si vous les avez modifi&eacute;s. Cette op&eacute;ration se fait &agrave; l'aide du signal "hangup" :

<blockquote><pre>
# <strong>kill -HUP 4608</strong> 
</pre></blockquote>

<p>
ou bien en utilisant 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ndc&amp;sektion=8">ndc(8)</a> 
comme ceci :

<blockquote><pre>
# <strong>ndc reload</strong>
</pre></blockquote>

<p>
<h3>6.8.7 Comment bloquer les requ&egrave;tes AXFR ? </h3>

<p>
Soit l'exemple suivant :

<blockquote><pre>
garden:/home/jeremy$<strong>  host -l openssh.com</strong>
openssh.com.            NS      zeus.theos.com.
openssh.com.            NS      cvs.openbsd.org.
openssh.com.            NS      gandalf.sigmasoft.com.
openssh.com.            NS      cs.colorado.edu.
openssh.com.            NS      ns.appli.se.
openssh.com.            A       199.185.137.4
cvs.openssh.com.        A       199.185.137.4
localhost.openssh.com.  A       127.0.0.1
</pre></blockquote>

<p>
Ces informations, utiles pour d&eacute;boguer la configuration de votre serveur DNS, n'ont pas forc&egrave;ment besoin d'&ecirc;tre publi&eacute;es. Si vous utilisez une classe d'adresses de type "classless in-addr"(Voir RFC2317) comme reverse, la commande host -l peut dans certains cas renvoyer les informations sur tous les domaines que vous h&eacute;bergez ! Il est facile de rem&eacute;dier &agrave; cela en ajoutant une clause 'allow-transfer' dans votre fichier de zone.

<br><br>
Si vous utilisez BIND8 vous devrez indiquer pr&eacute;cis&eacute;ment la liste des h&ocirc;tes pour lesquels vous autorisez les transferts dans chaque fichier de zone :

<blockquote><pre>
zone "foo.com" in {
        type master;
        file "directory/zonefile";
        allow-transfer {
          127.0.0.1;
          10.0.0.6;
          10.0.255.12;
        };
};
</pre></blockquote>

<p>
Vous pouvez aussi bloquer les transferts pour tous les domaines en ajoutant dans le fichier 
/var/named.conf une clause 'allow-transfer' dans la section 'options' :

<blockquote><pre>
   options {
        allow-transfer { 127.0.0.1; };
    };
</pre></blockquote>

<p>
Cette m&eacute;thode BIND8 est utilisable avec BIND9.<br>
Si vous utilisez la version BIND 4 (celle par d&eacute;faut sous OpenBSD) vous pouvez &eacute;diter le fichier /var/named/named.boot et utiliser l'option 'xfrnets' :

<blockquote><pre>
xfrnets 209.142.221.5 12.7.96.7
; type    domain                source host/file                backup file
cache     .                                                     root.cache
primary   0.0.127.IN-ADDR.ARPA  localhost.rev
</pre></blockquote>

<p>
BIND 4 autorise les transferts de classes enti&egrave;res, ce qui pr&eacute;c&egrave;de n'est donc pas exact : typiquement, les seules machines devant effectuer des transferts de zones sont vos serveurs DNS secondaires ainsi que les machines &agrave; partir desquelles vous souhaitez  d&eacute;boguer (127.0.0.1 est la machine id&eacute;ale pour laquelle on peut autoriser les transferts !).
Bloquer les requ&ecirc;tes AXFR  renforce la s&eacute;curit&eacute; de votre r&eacute;seau mais peut aussi rendre difficile le d&eacute;bogage de votre service DNS. (Merci &agrave; 
<a href="mailto:ntang@@nachtwache.org">Nicholas Tang</a> pour cette remarque.)

<p>
<h3>6.8.8 Que ne m'avez-vous pas encore dit sur la configuration du DNS ?</h3>

<p>
Beaucoup de choses ! :-) 
<br>
Par exemple, comment faire en sorte que les requ&ecirc;tes pour des domaines internes (donc non visibles depuis l'ext&eacute;rieur) soient relay&eacute;es par vos serveurs DNS. Pour plus d'informations sur le service DNS, nous vous recommandons la lecture de ces 
<a href="#DNS.1.1">documents</a>.


<p>
<a name="PPTP"></a>
<a name="6.9"></a>
<h2>6.9 - Mise en place d'une connexion PPTP sous OpenBSD</h2>

<p>
<strong>NOTE:</strong> les informations contenues dans la pr&eacute;sente section ne s'appliquent pas &agrave; <strong>TOUS</strong> les FAI ADSL m&ecirc;me si l'essentiel de ce que vous devez savoir s'y trouve. La configuration cit&eacute;e en exemple a &eacute;t&eacute; valid&eacute;e pour 
<a href="http://www.inode.at">Inode</a>, FAI ADSL en Autriche.

<p>
Pour commencer vous devez isntaller pptp. Un port se trouve dans 
<i>/usr/ports/net/pptp</i>. (Re)lisez la <a href="faq8.html#Ports">section 8 de cette FAQ
</a> pour toute information sur les ports OpenBSD.

<p>
A cause d'un conflit entre le support 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=gre&amp;sektion=4">gre(4)</a> du noyau et 
pptp, vous devrez aussi recompiler votre noyau pour en supprimer le support gre(4).

<blockquote>Correctif (NdT : patch) pour supprimer le support GRE(4).
<pre>
Index: GENERIC
===================================================================
RCS file: /cvs/src/sys/conf/GENERIC,v
retrieving revision 1.86
diff -u -r1.86 GENERIC
--- GENERIC     14 Mar 2002 00:42:25 -0000      1.86
+++ GENERIC     17 May 2002 01:52:17 -0000
@@@@ -87,7 +87,7 @@@@
 pseudo-device  enc     1       # option IPSEC needs the encapsulation interface
 pseudo-device  bridge  2       # network bridging support
 pseudo-device  vlan    2       # IEEE 802.1Q VLAN
-pseudo-device  gre     1       # GRE encapsulation interface
+#pseudo-device gre     1       # GRE encapsulation interface
 #pseudo-device strip   1       # Starmode Radio IP interface

 pseudo-device  pty     64      # pseudo-terminals
</pre></blockquote>

<p>
Pour recomplier votre noyau, v&eacute;rifiez que vous disposez des derni&egrave;res 
sources &agrave; jour via cvs (voir la page <a href="../../anoncvs.html">AnonCVS</a> 
pour plus d'information), appliquez sur ces source le correctif ci-dessus puis recompilez votre noyau suivant les instructions de la <a href="faq5.html#Building">section 5 de cette FAQ</a>.

<p>
Apr&egrave;s l'installation de <b>pptp</b> et de votre nouveau noyau, vous devez &eacute;diter quelques fichiers pour configurer votre connexion. Vous (r&eacute;)utiliserez 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ppp&amp;sektion=8">ppp(8)</a> fa&ccedil;on OpenBSD et si ppp(8) vous est d&eacute;j&agrave; familier, vous constaterez que la configuration est quasiment la m&ecirc;me. Sinon, vous pouvez (re)lire la section 
<a href="#PPP">PPP de cette FAQ</a>.
d1176 2
a1177 1
L'ajo&ucirc;t dans votre fichier <i>/etc/ppp/options</i> des lignes suivantes sera tr&egrave;s probablement la seule chose que vous aurez &agrave; faire :
d1189 2
a1190 1
<tt>LOGINNAME</tt> doit &ecirc;tre remplac&eacute; par le nom d'utilisateur qui vous a &eacute;t&eacute; attribu&eacute; par votre FAI.
d1193 2
a1194 1
Le fichier <i>/etc/ppp/pap-secrets</i> doit contenir une ligne comme celle-ci :
d1202 4
a1205 3
o&ugrave; LOGINNAME est le nom de votre compte et PASSWORD... votre mot de passe. 
10.0.0.138 est l'adresse IP attribu&eacute;e &agrave; votre MODEM si vous utilisez l'ADSL. 
V&eacute;rifiez que ce fichier est en lecture seule pour le seul utilisateur root (mode 600).
d1208 1
a1208 1
<h3>6.9.1 - Attribuer une adresse IP &agrave; votre interface r&eacute;seau</h3>
d1211 7
a1217 2
Dans l'exemple ci-dessus, notre modem a une adresse pr&eacute;configur&eacute;e &agrave; 
10.0.0.138. Nous souhaitons cependant attribuer une adresse &agrave; NOTRE interface. Le mieux est de choisir une adresse IP proche de celle donn&eacute;e au modem ou d'utiliser l'adresse statique qui vous est attribu&eacute;e. Consultez la <a href="#Setup">section 6 de cette FAQ</a> pour en savoir plus sur la configuration initiale du r&eacute;seau.
d1220 2
a1221 1
Une fois votre interface configur&eacute;e, vous devriez pouvoir cr&eacute;er une connexion PPTP &agrave; l'aide de la commande suivante :
d1228 2
a1229 1
Deux processus sont cr&eacute;&eacute;es (cela est d&ucirc; au fait que nous utilisons le ppp(8) fourni par OpenBSD). Vous devez stopper ces deux processus pour arr&ecirc;ter pptp :
d1232 2
a1233 2
# <strong>kill -9 [pid of pppd]</strong>
$ <strong>kill -9 [pid of pptp]</strong>
d1237 2
a1238 1
Nous vous recommandons d'ouvrir le fichier <tt>/var/log/messages</tt> dans un autre terminal afin de tracer d'&eacute;ventuels probl&egrave;mes :
d1246 3
a1248 1
Nous vous sugg&eacute;rons &eacute;galement d'ajouter cette commande dans votre fichier <i>/etc/rc.local</i> pour monter la connexion automatiquement au d&eacute;marrage de la machine.
d1252 1
a1252 11
<h2>6.10 - Configurer une passerelle sous OpenBSD</h2>

<p>
Une passerelle (<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=bridge&amp;sektion=4">bridge</a>) permet de relier deux (ou plus) r&eacute;seaux. A la diff&eacute;rence d'un routeur, les paquets traversent la passerelle de mani&egrave;re transparente : les deux segments de r&eacute;seaux semblent n'en faire qu'un de chaque c&ocirc;t&egrave; de la passerelle par laquelle ne transiteront que les paquets devant passer d'un segment &agrave; l'autre. Une passerelle permet donc - entre autres choses - de r&eacute;duire le trafic sur un r&eacute;seau complexe en autorisant l'acc&egrave;s &agrave; chaque segment au cas par cas.

<p>
Remarque : du fait de sa nature "invisible", l'interface d'une passerelle peut ou non avoir une adresse IP propre. Si elle en a une, l'interface fonctionnera suivant deux modes : tout d'abord comme faisant partie de la passerelle, ensuite comme une interface normale "stand-alone". 
Si aucune interface ne poss&egrave;de d'adresse IP, la passerelle transmettra effectivement les donn&eacute;es &agrave; travers le r&eacute;seau mais ne pourra pas &ecirc;tre administr&eacute;e par le r&eacute;seau (ce qui peut &ecirc;tre un effet recherch&eacute;).

<p>
<h3>Exemple de passerelle</h3>
d1255 52
a1306 14
Une de mes baies contient des ordinateurs tournant sur de vieux syst&egrave;mes &eacute;quip&eacute;s non pas d'interfaces 10BASE-TX mais de connecteurs AUI ou AAUI et mes transmetteurs n'ont que des prises coaxiales. Une des machines de cette baie est un serveur OpenBSD connect&eacute; en permanence au r&eacute;seau haut d&eacute;bit. En lui ajoutant une seconde carte r&eacute;seau &eacute;quip&eacute;e d'une prise coaxiale, il m'a &eacute;t&eacute; possible d'en faire une passerelle entre les deux r&eacute;seaux. 

<p>
Ce serveur a donc deux interfaces r&eacute;seau, une carte 
Intel EtherExpress/100 
(<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=fxp&amp;sektion=4"><tt>fxp0</tt></a>)
et une carte 3COM 3c590-Combo  
(<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ep&amp;sektion=4"><tt>ep0</tt></a>)
avec prise coaxiale. <tt>fxp0</tt> fait le lien entre le reste de mon r&eacute;seau et poss&egrave;de donc une adresse IP tandis que l'interface <tt>ep0</tt> ne sert que pour la passerelle et n'en a donc pas. Les machines du r&eacute;seau coaxial peuvent &agrave; pr&eacute;sent communiquer avec le reste du r&eacute;seau comme si elles y &eacute;taient.
<p>
Comment cela est-il possible ?
<p>
Le fichier <tt>hostname.fxp0</tt> contient les param&egrave;tres pour l'interface 
<tt>fxp0</tt>. Cette machine &eacute;tant cliente DHCP, ce fichier ressemble &agrave; ceci :
d1316 1
a1316 1
Jusque-l&agrave; pas de surprise.
d1319 2
a1320 1
La configuration de l'interface <tt>ep0</tt> n'est pas tout &agrave; fait la m&ecirc;me, comme vous pouvez vous en douter :
d1330 7
a1336 5
Dans ce dernier cas, nous avons juste activ&eacute; l'interface &agrave; l'aide de la commande 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&amp;sektion=8">ifconfig(8)</a> 
et nous en avons forc&eacute; le type &agrave; 10BASE-2 (coaxiale). Aucune adresse IP ni aucune autre information similaire ne doivent &ecirc;tre sp&eacute;cifi&eacute;es pour cette interface.  
Les options utilisables pour l'interface <tt>ep</tt> sont d&eacute;taill&eacute;es dans cette 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ep&amp;sektion=4">page de manuel</a>.
d1339 4
a1342 3
Nous allons maintenant configurer la passerelle. Il suffit pour cela de cr&eacute;er un fichier 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=bridgename.if&amp;sektion=5"><tt>bridgename.bridge0</tt></a>. 
Voici un exemple pour ma situation :
d1354 5
a1358 2
Cela configure et active la passerelle &agrave; partir des deux cartes fxp0 et ep0. 
L'ordre dans lequel sont list&eacute;es les cartes est-il important ? Que nenni : n'oubliez pas qu'une passerelle est sym&eacute;trique et que les paquets la traversent dans un sens comme dans l'autre.
d1361 1
a1361 1
Et c'est tout ! Red&eacute;marrer votre serveur et vous avez une passerelle op&eacute;tionnelle.
d1364 1
a1364 2
<h3>Le filtrage sur une passerelle</h3>
<!-- XXXchanges - changes with OpenBSD 3.3 -->
d1366 5
a1370 3
Alors que pour certains usages une simple passerelle comme celle d&eacute;crite ci-dessus suffira, 
il est plus vraisemblable que vous voudrez faire quelquechose avec les paquets transitant par la v&ocirc;tre. Comme vous vous y attendiez (peut-&ecirc;tre), <a href="#PF">Packet
Filter</a> peut &ecirc;tre utilis&eacute; pour filtrer le trafic sur la passerelle. 
d1373 4
a1376 1
Gardez &agrave; l'esprit que par nature les flux de donn&eacute;es transitent par les deux interfaces d'une passerelle et que vous n'aurez donc &agrave; appliquer du filtrage que sur une des deux cartes. Votre directive "Pass all" par d&eacute;faut devrait ressembler &agrave; &ccedil;a :
d1388 6
a1393 1
Si je souhaite filtrer le trafic en direction des "vieilles" machines et n'y autoriser que le trafic Web et le SSH, je dois laisser le trafic entrer et sortir sur l'interface ep0 mais le filtrer sur fxp0 en utilisant l'option "keep state" afin de pouvoir traiter les retours :
d1397 1
a1397 1
# Pass all traffic through ep0
d1401 1
a1401 1
# Block fxp0 traffic
d1411 59
a1469 1
Voil&agrave; qui restreindra aux seules connections HTTP et SSH entrantes le trafic en direction de la passerelle et de ce qu'il y a "derri&egrave;re". On aurait p&ucirc; obtenir d'autres r&eacute;sultats en filtrant sur l'autre intereface. 
d1472 36
a1507 3
Pour administrer et surveiller la passerelle, utilisez la commande 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=brconfig&amp;sektion=8">brconfig(8)</a> 
qui peut aussi servir &agrave; cr&eacute;er une passerelle apr&egrave;s le d&eacute;marrage du syst&egrave;me.
d1509 14
d1525 17
a1541 1
<h3>Trucs et astuces sur les passerelles</h3>
d1544 77
a1620 2
<li>
Il est fortement recommand&eacute; de n'appliquer du filtrage que sur une interface. Vous pouvez le faire sur les deux mais vous devez alors vraiment savoir et comprendre ce que vous faites.
a1621 11
<li>En utilisant l'option <i>blocknonip</i> de la commande 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=brconfig&amp;sektion=8">brconfig(8)</a>
ou en l'ajoutant dans le fichier 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=bridgename.if&amp;sektion=5">bridgename.bridge0</a>,
vous pouvez interdire le passage de tout trafic non IP (tels que IPX ou NETBEUI) 
sur la passerelle (et ce m&ecirc;me si vos filtres n'ont pas pris en compte ces types de trafic). Cela peut &ecirc;tre important dans certaines situations mais vous devez &ecirc;tre conscient que les passerelles fonctionnent pour tout type de trafic et pas seulement pour le trafic IP.

<li>
Cr&eacute;er une passerelle n&eacute;cessite que les interfaces qui la composent fonctionnent en mode "Promiscuous" - elles &eacute;coutent la totalit&eacute; du trafic et non le seul trafic leur &eacute;tant destin&eacute;. Cela augmente la charge du processeur et du bus plus 
qu'on ne pourrait le croire. Quelques cartes r&eacute;seau ne fonctionnent pas bien dans ce mode : une carte &agrave; base de puce TI ThunderLAN (<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tl&amp;sektion=4">tl(4)</a>) par exemple ne pourra pas &ecirc;tre utilis&eacute;e sur une passerelle.
</ul>
d1627 2
a1628 3
<a href="faq5.html">[Section 5 - Construire le syst&egrave;me &agrave; partir des sources]</a>
<a href="faq7.html">[Section 7 - Contr&ocirc;le du clavier et de l'affichage]</a>
</font>
d1632 1
a1632 1
<a href="index.html"><img height="24" width="24" src="../../images/back.gif" 
d1637 2
a1638 2
Originally [OpenBSD: faq6.html,v 1.173 ]<br>
$Translation: faq6.html,v 1.22 2004/08/18 14:42:09 saad Exp $<br>
@


1.9
log
@Sync with Steelix CVS
@
text
@d36 1
a36 1
pri&egrave;re de consultez
d1906 1
a1906 1
$Translation: faq6.html,v 1.21 2003/12/14 14:05:07 saad Exp $<br>
@


1.8
log
@
sync with steelix translation CVS
@
text
@d21 1
a21 1
<a href="faq5.html">[Section 5 - Construire le syst&egrave;me à partir des sources ]</a>
d26 14
d43 1
a43 1
<h3>Table des matières</h3>
d66 1
a66 1
section de cette FAQ consacr&eacute;e à la 
d129 1
a129 1
par votre carte r&eacute;seau, reportez-vous à la <a 
d663 1
a663 1
configuration du démon PPP en mode Utilisateur se fait &agrave; 
d682 1
a682 1
La configuration initiale du démon PPP (Utilisateur) se fait dans le fichier 
d1342 1
a1342 1
cache     .	   root.cache
d1504 1
a1504 1
Ces param&egrave;tres par d&eacute;faut conviennent à une grande majorit&eacute; de configurations.
d1578 1
a1578 1
Ces informations, utiles pour déboguer la configuration de votre serveur DNS, n'ont pas forc&egrave;ment besoin d'&ecirc;tre publi&eacute;es. Si vous utilisez une classe d'adresses de type "classless in-addr"(Voir RFC2317) comme reverse, la commande host -l peut dans certains cas renvoyer les informations sur tous les domaines que vous h&eacute;bergez ! Il est facile de rem&eacute;dier &agrave; cela en ajoutant une clause 'allow-transfer' dans votre fichier de zone.
d1906 1
a1906 1
$Translation: faq6.html,v 1.19 2003/06/01 11:34:18 xsa Exp $<br>
@


1.7
log
@
sync with steelix translation CVS
@
text
@d145 1
a145 1
        inet 192.168.1.35 netmask 0xffffff00 broadcast 192.168.1.255
d1891 2
a1892 2
Originally [OpenBSD: faq6.html,v 1.172 ]<br>
$Translation: faq6.html,v 1.18 2003/05/22 08:55:46 xsa Exp $<br>
@


1.6
log
@
sync with steelix translation CVS
@
text
@d1 1
d4 1
a4 1
<title>6.0 - Mise en place du r&eacute;seau</title>
d6 1
d11 1
a11 1
<meta name= "copyright"     content= "This document copyright 1998-2002 by OpenBSD.">
d14 2
a15 1
<body bgcolor= "#ffffff" text= "#000000">
d19 8
a26 3
<h2><font color=#e00000>6.0 - Mise en place du r&eacute;seau</font> 
  <hr></h2>
<p></p>
d29 1
d31 10
a40 12
  <h3>Table des mati&egrave;res</h3>
  <li><A href= "#Intro" >6.0.1 - Avant d'aller plus loin</a>
  <li><a href= "#Setup" >6.1 - Configuration r&eacute;seau initiale</a>
  <li><a href= "#PF"    >6.2 - Packet Filter (PF)</a> 
  <li><a href= "#NAT"   >6.3 - Traduction d'adresses</a> 
  <li><a href= "#DHCP"  >6.4 - Protocole de Configuration Dynamique d'H&ocirc;te
    (DHCP)</a>
    <li><a href= "#PPP"   >6.5 - Protocole Point &agrave; Point</a>
  <li><A href= "#Tuning">6.6 - Optimisation des param&egrave;tres r&eacute;seau</a> 
  <li><a href= "#NFS"   >6.7 - Utilisation de NFS</a> 
  <li><a href= "#DNS"   >6.8 - Service de Noms - DNS, BIND, et named</a> 
    <li><a href= "#PPTP"  >6.9 - Mise en place d'une connexion PPTP sous OpenBSD</a>
d42 1
a42 1
<p></p>
d45 44
a88 29
<br>
<P>
<a name= "Intro"></a>
<A name="6.0.1"></a>
<H2>6.0.1 - Avant d'aller plus loin</h2>
<P> Le lecteur sera plus &agrave; l'aise pour lire ce document s'il a lu 
  auparavant - et m&ecirc;me partiellement - la section <a href="faq5.html">Configuration 
  du noyau</a> de la FAQ, et les pages du manuel Unix <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&sektion=8">ifconfig(8)</a> 
  et <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=netstat&sektion=1">netstat(1)</a>.
<P> Si vous &ecirc;tes un administrateur r&eacute;seau et que vous mettez en 
place 
  des protocoles de routage, si vous utilisez une machine OpenBSD pour assurer 
  des fonctions de routage, ou si vous avez besoin d'approfondir vos connaissances 
  des r&eacute;seaux IP, vous devriez lire <a href="http://www.3com.com/corpinfo/en_US/technology/tech_paper.jsp?DOC_ID=135">Comprendre 
  l'adressage IP</a> (voici <a href="http://www.3com.com/other/pdfs/infra/corpinfo/en_US/501302.pdf">un 
  autre lien</a>). C'est un excellent document expliquant les concepts 
  fondamentaux 
  pour travailler avec des r&eacute;seaux IP et particuli&egrave;rement quand 
  vous g&eacute;rez ou &ecirc;tes responsable de plus d'un r&eacute;seau. 
<p> Si vous manipulez des applications comme des serveurs web, des serveurs ftp, 
  ou des serveurs de messagerie, <a href="http://the.rfceditor.org/rfc.html">lire 
  les RFCs</a> pourrait vous &ecirc;tre tr&egrave;s b&eacute;n&eacute;fique. Il 
  est plus que probable que vous ne les lirez pas toutes. Choisissez les sujets 
  qui vous int&eacute;ressent ou dont vous avez besoin dans votre environnement 
  r&eacute;seau, cherchez les dans les RFCs et essayez d'en comprendre les fondements. 
  Les RFCs d&eacute;finissent plusieurs (des milliers de) standards pour les protocoles 
  de l'Internet et comment ceux-ci sont cens&eacute;s fonctionner. <a name= "Setup"></a> 
  <a name="6.1"></a> 
<h2>6.1 - Configuration r&eacute;seau initiale</h2>
d91 1
a91 1
<a name= "Setup.1"></a>
d93 1
a93 2
<h3>6.1.1 - Identification et configuration des interfaces r&eacute;seau</h3>
<p></p>
d95 12
a106 8
<p> Pour commencer, il vous faudra d'abord identifier votre interface r&eacute;seau. 
  Dans OpenBSD, les interfaces sont nomm&eacute;es d'apr&egrave;s le type de carte 
  et non pas d'apr&egrave;s le type de connexion. Vous pouvez voir l'initialisation 
  de votre carte r&eacute;seau durant le processus de d&eacute;marrage, ou apr&egrave;s 
  le processus de d&eacute;marrage en utilisant la commande <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dmesg&sektion=8">dmesg(8)</a>. 
  Vous pouvez aussi voir votre interface r&eacute;seau en utilisant la commande<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&sektion=8"> 
  ifconfig(8)</a>. Par exemple, voici la sortie fournie par dmesg pour une carte 
  r&eacute;seau Fast Ethernet Intel, qui utilise fxp comme nom de p&eacute;riph&eacute;rique.</p>
d108 1
a108 1
<ul><pre>
d111 1
a111 1
</pre></ul>
d113 20
a132 11
<p>Si vous ne connaissez pas le nom de p&eacute;riph&eacute;rique affect&eacute; 
  &agrave; votre carte, consultez <a href="../../fr/plat.html">la liste du mat&eacute;riel 
  support&eacute;</a> pour votre plateforme. Vous y trouverez une liste de plusieurs 
  noms communs de carte et leur nom de p&eacute;riph&eacute;rique OpenBSD. Il 
  suffira alors de combiner le nom r&eacute;duit de p&eacute;riph&eacute;rique 
  (comme fxp) et un nombre affect&eacute; par le noyau pour obtenir un nom d'interface 
  (comme fxp0).</p>
<p>Vous pouvez trouver quelles interfaces ont &eacute;t&eacute; identifi&eacute;es 
  en utilisant l'utilitaire <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&sektion=8">ifconfig(8)</a>. 
  La commande suivante affichera toutes les interfaces r&eacute;seau sur un syst&egrave;me. 
  Cet exemple de sortie nous montre une seule interface ethernet, une <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=fxp&sektion=4">fxp(4)</a>.</p>
d134 1
a134 1
<ul><pre>
d137 1
a137 1
        inet6 fe80::1%lo0 prefixlen 64 scopeid 0x4
d139 1
a139 1
        inet 127.0.0.1 netmask 0xff000000 
d142 1
d145 2
a146 2
        inet 10.0.0.38 netmask 0xffffff00 broadcast 10.0.0.255
        inet6 fe80::202:b3ff:fe2b:10f7%fxp0 prefixlen 64 scopeid 0x1
d148 1
d159 1
d161 2
a162 1
gre0: flags=8010&lt;POINTOPOINT,MULTICAST&gt; mtu 1450
d167 1
a167 1
</pre></ul>
d169 40
a208 32
<p>Comme vous pouvez le constater, <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&sektion=8">ifconfig(8)</a> 
  nous fournit beaucoup plus d'informations que nous ne pourrions en avoir besoin 
  &agrave; ce stade. N&eacute;anmoins, il nous permet de voir notre interface. 
  Dans l'exemple pr&eacute;cit&eacute;, la carte a d&eacute;j&agrave; &eacute;t&eacute; 
  configur&eacute;e. C'est &eacute;vident puisque l'acc&egrave;s &agrave; un
  réseau IP est configuré sur l'interface fxp0, 
  d'o&ugrave; les valeurs &quot;inet 10.0.0.38 netmask 0xffffff00 broadcast 10.0.0.255&quot;. 
  De plus, les drapeaux<b> UP</b> et <b>RUNNING</b> sont positionn&eacute;s. </p>
<p>Finalement, vous remarquerez que plusieurs autres interfaces sont activ&eacute;es 
  par d&eacute;faut. Ce sont des interfaces virtuelles qui servent &agrave; diff&eacute;rentes 
  fonctions. Les pages du manuel suivantes les d&eacute;crivent : </p>
<ul>
  <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=lo&sektion=4">lo</a> 
    - Interface de bouclage
  <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflog&sektion=4">pflog</a> 
    - Interface de journalisation du filtre de paquets Packet Filter
  <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sl&sektion=4">sl</a> 
    - Interface r&eacute;seau SLIP
  <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ppp&sektion=4">ppp</a> 
    - Protocole Point &agrave; Point 
  <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tun&sektion=4">tun</a> 
    - Interface r&eacute;seau tunnel 
  <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=enc&sektion=4">enc</a> 
    - Interface d'encapsulation 
  <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=bridge&sektion=4">bridge</a> 
    - Interface de pont Ethernet 
  <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=vlan&sektion=4">vlan</a> 
    - Interface d'encapsulation IEEE 802.1Q 
  <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=gre&sektion=4">gre</a> 
    - Interface d'encapsulation GRE/MobileIP 
  <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=gif&sektion=4">gif</a> 
    - Interface tunnel IPv4/IPv6 g&eacute;n&eacute;rique 
d211 19
a229 14
<p>Si votre interface r&eacute;seau n'est pas configur&eacute;e, la premi&egrave;re 
  &eacute;tape consiste &agrave; cr&eacute;er le fichier <strong>/etc/hostname.xxx</strong>. 
  Remplacez xxx par le nom de votre interface. A partir des informations  
  des exemples pr&eacute;c&eacute;dents, ce nom serait <strong>/etc/hostname.fxp0</strong>. 
  Le format de ce fichier est simple : </p>
<ul><pre>
address_family address netmask broadcast [other options]
</pre></ul>

<p>(Vous trouverez beaucoup plus de d&eacute;tails concernant le format de ce 
  fichier dans la page de manuel <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hostname.if&sektion=5">hostname.if(5)</a>.)</p>
<p>Un fichier typique de configuration d'interface, configur&eacute; pour une 
  adresse IPv4, ressemble à ceci : </p>
<ul><pre>
d232 16
a247 1
</pre></ul>
d249 6
a254 14
<p>Vous pouvez aussi sp&eacute;cifier le type de m&eacute;dia Ethernet si vous 
  le souhaitez, par exemple, forcer le mode 100baseTX full-duplex.</p>
<ul><pre>
inet 10.0.0.38 255.255.255.0 NONE media 100baseTX media-opt full-duplex
</pre></ul>

<p>(Bien entendu, vous ne devriez jamais forcer le mode full duplex &agrave; moins 
  que les deux extr&eacute;mit&eacute;s de la connexion soient param&eacute;tr&eacute;es 
  pour opérer dans ce mode ! En l'absence de besoins sp&eacute;cifiques, 
  les param&egrave;tres de m&eacute;dia doivent &ecirc;tre exclus.)</p>
<p>Ou peut-&ecirc;tre souhaitez-vous utiliser des drapeaux sp&eacute;ciaux sp&eacute;cifiques 
  &agrave; un type d'interface. Le format du fichier hostname n'est gu&egrave;re
  différent !</p>
<ul><pre>
d257 17
a273 1
</pre></ul>
d275 1
a275 11
<p>L'&eacute;tape suivante consiste &agrave; configurer votre passerelle. Pour 
  cela, mettez simplement l'adresse IP de la passerelle dans le fichier <strong>/etc/mygate</strong>. 
  Ceci aura pour effet de configurer votre passerelle au d&eacute;marrage. Ensuite, 
  vous devriez configurer vos serveurs de noms, et votre fichier <strong>/etc/hosts</strong> 
  (consultez la page du manuel <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hosts&sektion=5">hosts(5)</a>). 
  Pour configurer vos serveurs de noms, cr&eacute;ez un fichier appel&eacute; 
  <strong>/etc/resolv.conf</strong>. Plus d'informations sur le format 
  de ce fichier sont disponibles en consultant la page du manuel <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=resolv.conf&sektion=5">resolv.conf(5)</a>. 
  Mais pour une utilisation standard, voici un exemple. Dans cet exemple, vos 
  serveurs de noms sont 125.2.3.4 et 125.2.3.5. Vous appartenez au domaine &quot;yourdomain.com&quot;.</p>
<ul><pre>
d277 1
a277 1
search yourdomain.com
d281 1
a281 1
</pre></ul>
d283 6
a288 4
<p>Vous pouvez alors soit red&eacute;marrer soit ex&eacute;cuter 
  le script <strong>/etc/netstart</strong>. Vous pouvez faire cela simplement 
  en saisissant (en tant que root) : </p>
<ul><pre>
d294 21
a314 1
</pre></ul>
d316 1
a316 11
<p>Vous remarquerez que quelques erreurs sont g&eacute;n&eacute;r&eacute;es. 
  En ex&eacute;cutant ce script, vous reconfigurez des choses qui ont d&eacute;j&agrave; 
  &eacute;t&eacute; configur&eacute;es. Ainsi, quelques routes existent d&eacute;j&agrave; 
  dans la table de routage du noyau. Votre syst&egrave;me est maintenant op&eacute;rationnel. 
  Vous pouvez v&eacute;rifier que votre interface a &eacute;t&eacute; correctement 
  configur&eacute;e avec la commande <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&sektion=8">ifconfig(8)</a>. 
  Vous pouvez aussi v&eacute;rifier vos routes gr&acirc;ce &agrave; <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=netstat&sektion=1">netstat(1)</a> 
  ou <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=route&sektion=8">route(8)</a>. 
  Voici un example d'utilisation de ces deux commandes pour afficher vos tables 
  de routage : </p>
<ul><pre>
d345 1
a345 1
</pre></ul>
d348 1
a348 1
<a name= "Setup.2"></a>
d350 1
a350 2
<h3>6.1.2 - Configuration de votre machine OpenBSD en passerelle </h3>
<p></p>
d352 21
a372 17
<p>Ceci est l'information de base dont vous avez besoin pour configurer votre 
  machine OpenBSD en passerelle (appel&eacute;e aussi routeur). Si vous utilisez 
  OpenBSD en routeur sur Internet, nous vous sugg&eacute;rons de lire aussi les 
  instructions de configuration du filtre de paquet Packet Filter ci-apr&egrave;s 
  pour bloquer tout trafic potentiellement malicieux. De m&ecirc;me, vu la faible 
  disponibilit&eacute; d'adresses <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ip&sektion=4">IPv4</a> 
  chez les fournisseurs d'acc&egrave;s r&eacute;seau et les registres r&eacute;gionaux, 
  vous devriez aussi lire la partie concernant la traduction d'adresses afin 
  de conserver votre espace d'adressage IP. </p>
<p>Le noyau GENERIC a d&eacute;j&agrave; la fonction n&eacute;cessaire pour effectuer 
  le routage IP, mais celle-ci doit &ecirc;tre activ&eacute;e. Vous devriez faire 
  cela &agrave; l'aide de l'utilitaire <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&sektion=8">sysctl(8)</a>. 
  Pour effectuer cette modification de mani&egrave;re permanente, &eacute;ditez 
  le fichier <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl.conf&sektion=5">/etc/sysctl.conf(5)</a> 
  pour autoriser le routage IP. Pour ce faire, ajoutez la ligne suivante dans 
  ce fichier de configuration.</p>
<ul><pre>
d374 1
a374 1
</pre></ul>
d376 8
a383 5
<p>Pour faire ce changement sans red&eacute;marrage, utilisez directement l'utilitaire 
  <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&sektion=8">sysctl(8)</a>. 
  N&eacute;anmoins, il faut se rappeler que ce changement n'existera plus apr&egrave;s 
  red&eacute;marrage, et devra &ecirc;tre effectu&eacute; en tant que root.</p>
<ul><pre>
d386 14
a399 1
</pre></ul>
a400 7
<p>Maintenant, modifiez les routes sur les autres h&ocirc;tes des deux c&ocirc;t&eacute;s. 
  Il y a plusieurs utilisations possibles de OpenBSD comme routeur, en utilisant 
  des logiciels comme <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=routed&sektion=8">routed(8)</a>, 
  <a href="http://www.gated.org">gated</a>, <a href="http://www.mrtd.net">mrtd</a>, 
  et <a href="http://www.zebra.org">zebra</a>. La collection de ports de OpenBSD 
  contient zebra, gated, et mrtd. OpenBSD supporte plusieurs interfaces T1, HSSI, 
  ATM, FDDI, Ethernet, et s&eacute;rie (PPP/SLIP). </p>
d402 1
a402 1
<a name= "Setup.3"></a>
d404 16
a419 10
<h3>6.1.3 - Configuration d'alias sur une interface.</h3>
<p>OpenBSD poss&egrave;de un m&eacute;canisme simple pour configurer des alias 
  sur une interface. Pour faire cela, &eacute;ditez le fichier <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hostname.if&sektion=5"><i>/etc/hostname.&lt;if&gt;</i></a>. 
  Ce fichier est lu durant la phase de d&eacute;marrage par le script <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc&sektion=8">/etc/rc(8)</a>, 
  qui fait partie de la <a href="../faq10.html#rc">hi&eacute;rarchie de d&eacute;marrage 
  rc</a>. Par exemple, nous supposons que l'utilisateur a une interface <b>dc0</b> 
  sur le r&eacute;seau 192.168.0.0. D'autres informations utiles : </p>
<ul>
  <li>l'adresse IP de dc0 est 192.168.0.2 
  <li>le masque de sous-r&eacute;seau est 255.255.255.0 
d422 24
a445 17
<p>Quelques remarques &agrave; propos des alias. Dans OpenBSD, vous utilisez 
  uniquement le nom d'interface. Il n'y a pas de diff&eacute;rence entre le premier 
  alias et le second alias. OpenBSD ne s'y r&eacute;f&egrave;re pas en tant que 
  dc0:0 et dc0:1 comme le font d'autres syst&egrave;mes d'exploitation. Si vous 
  faites r&eacute;f&eacute;rence &agrave; une adresse IP sp&eacute;cifique en 
  alias avec ifconfig, ou si vous ajoutez un alias, assurez-vous de saisir &quot;<tt>ifconfig 
  int alias</tt>" au lieu de "<tt>ifconfig int</tt>" &agrave; la ligne de commande. 
  Vous pouvez effacer des alias avec &quot;<tt>ifconfig int delete</tt>". 
<p>En supposant que vous disposez de plusieurs adresses IP en alias 
appartenant au m&ecirc;me sous-r&eacute;seau IP, la configuration du masque de sous-r&eacute;seau 
  pour chaque alias sera 255.255.255.255. Il n'est pas nécessaire d'avoir le m&ecirc;me 
  masque de sous-r&eacute;seau que celui de la premi&egrave;re adresse IP affect&eacute;e 
  &agrave; l'interface. Dans cet exemple, <i>/etc/hostname.dc0</i>, deux alias 
  sont ajout&eacute;s &agrave; l'interface dc0, qui, rappelons-le, a &eacute;t&eacute; 
  configur&eacute;e avec l'adresse IP 192.168.0.2 et un masque de sous-r&eacute;seau 
  255.255.255.0. 
<ul><pre>
d450 1
a450 1
</pre></ul>
d452 8
a459 5
<p>Une fois ce fichier modifi&eacute; comme indiqu&eacute;, il suffit de red&eacute;marrer 
  pour que les changements prennent effet. Vous pouvez, toutefois, activer les 
  aliases &agrave; la main &agrave; l'aide de l'utilitaire <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&sektion=8">ifconfig(8)</a>. 
  Pour activer le premier alias, vous utiliseriez la commande : </p>
<ul><pre>
d461 1
a461 1
</pre></ul>
d463 2
a464 1
<p> Pour voir ces aliases, vous devez utiliser la commande : </p>
d466 1
a466 1
<ul><pre>
d472 1
a472 2
</pre></ul>

d476 2
a477 2
<a name= "6.2"></a>
<a name= "PF"></a>
d479 8
a486 1
<p></p>
d488 1
a488 112
<h5>Remarque : Packet filter est le syst&egrave;me de filtrage dans OpenBSD 
&agrave; 
  partir de la version 3.0. Si vous recherchez la FAQ IPF/IPNAT pour les versions 
  pr&eacute;c&eacute;dentes de OpenBSD, cliquez <a href="../faqipf.html">ici</a>.</h5>
<p>Le sous-syst&egrave;me Packet Filter a &eacute;t&eacute; cr&eacute;&eacute; pour fournir 
  deux services, la gestion des permissions de routage au niveau paquet et l'association 
  d'h&ocirc;tes/sous-r&eacute;seaux &agrave; une plage d'adresses externes. Les 
  fichiers de configuration pour ces deux services sont <i><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&sektion=5">/etc/pf.conf(5)</a></i> 
  et <i><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=nat.conf&sektion=5">/etc/nat.conf(5)</a></i>. 
</p>
<p>Pour d&eacute;marrer ces services, vous avez besoin d'&eacute;diter <i><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc.conf&sektion=8">/etc/rc.conf(8)</a></i> 
  et de mettre : </p>
<ul><pre>
pf=YES
</pre></ul>

<p>Si vous utilisez la traduction d'adresses, vous aurez tr&egrave;s probablement 
  besoin de mettre la valeur <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&sektion=8">sysctl(8)</a> 
  de <tt>net.inet.ip.forwarding</tt> &agrave; 1. Vous pouvez le faire en 
  d&eacute;commentant les lignes correspondantes dans <i><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl.conf&sektion=5">/etc/sysctl.conf(5)</a></i> 
  puis red&eacute;marrez votre ordinateur.</p>
<p>Si le support Packet Filter est inclus dans votre noyau mais que vous ne l'avez 
  pas activ&eacute; dans votre fichier <i><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc.conf&sektion=8">/etc/rc.conf(8)</a></i>,<i> 
  </i>vous pouvez toujours l'activer &agrave; l'aide de la commande <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&sektion=8">pfctl(8)</a>.</p>
<ul><pre>
# <b>pfctl -R /etc/pf.conf</b>
# <b>pfctl -N /etc/nat.conf</b>
# <b>pfctl -e</b>
</pre></ul>

<p>La premi&egrave;re ligne configure le filtrage, en utilisant <i>/etc/pf.conf</i> 
  et la seconde configure la traduction d'adresses, en utilisant <i>/etc/nat.conf</i> 
  (la <a href="#NAT">Section 6.3, Traduction d'adresses</a> fournit plus de d&eacute;tails 
  sur la traduction d'adresses), et finalement, la derni&egrave;re ligne active 
  PF.</p>
<p>Ceci peut aussi &ecirc;tre combin&eacute; en une seule ligne de commande : </p>
<ul><pre>
# <strong>pfctl -R /etc/pf.conf -N /etc/nat.conf -e</strong>
</pre></ul>
<p>Si vous effectuez des changements sur <i>/etc/pf.conf</i> apr&egrave;s le d&eacute;marrage 
  de PF, vous pouvez recharger les r&egrave;gles en rechargeant le fichier appropri&eacute; : </p>
<ul><pre>
# <b>pfctl -R /etc/pf.conf</b>
</pre></ul>

<p>Ce document va couvrir ci-apr&egrave;s quelques configurations basiques de 
  <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&sektion=5">pf.conf(5)</a> 
  et <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=nat.conf&sektion=5">nat.conf(5)</a>. 
  Vous pouvez aussi voir le <a href="#sample_pf.conf">jeu de r&egrave;gles r&eacute;sultant</a> 
  qui inclut toutes les instructions de configuration, expliqu&eacute;es plus 
  en d&eacute;tail ci-apr&egrave;s. Vous pouvez obtenir d'autres informations concernant 
  Packet Filter sur le <a href="http://www.benzedrine.cx/pf.html">site web Packet 
  Filter</a> et dans le <a href="http://www.inebriated.demon.nl/pf-howto/"> HOWTO 
  Packet Filter</a>.</p>
<p>
<h3>Packet Filter</h3>
<p></p>

<p>Afin d'activer Packet Filter au d&eacute;marrage, vous aurez besoin de modifier 
  <i>/etc/rc.conf </i>afin que ce fichier contienne la ligne <tt>pf=YES</tt>. 
  Packet Filter (pf) est contr&ocirc;l&eacute; par <i>/etc/pf.conf</i>, fichier 
  lu au d&eacute;marrage. Pour une explication plus d&eacute;taill&eacute;e, 
  voir <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&sektion=5">pf.conf(5)</a>. 
  Dans les exemples suivants, <tt>fxp0</tt> repr&eacute;sente l'interface externe 
  connect&eacute;e &agrave; internet. Ceci sera diff&eacute;rent pour vous selon 
  l'interface ethernet pr&eacute;sente sur votre machine. Les r&egrave;gles ci-apr&egrave;s 
  supposent une connectivit&eacute; internet permanente telle qu'utilisée
  pour un serveur web.</p>
<p>Les r&egrave;gles Packet Filter sont trait&eacute;es de mani&egrave;re s&eacute;quentielle 
  du haut vers le bas ; visualiser chaque paquet devant traverser chaque r&egrave;gle 
  avant d'atteindre sa destination aide &agrave; comprendre ce type de fonctionnement. 
</p>
<p>Par exemple, la base de r&egrave;gles par d&eacute;faut fournie autorise tous 
  les paquets en entr&eacute;e, et tous les paquets en sortie : </p>
<ul><pre>
pass out all 
pass in all
</pre></ul>

Ces r&egrave;gles sont &eacute;quivalentes &agrave; : 
<ul><pre>
pass in from any to any
pass out from any to any
</pre></ul>

<p>qui peuvent &ecirc;tre interpr&eacute;t&eacute;es comme &quot;laisser passer 
  les paquets &agrave; partir de n'importe quelle source vers n'importe quelle 
  destination&quot;, avec un &quot;sur n'importe quelle interface (qui est toujours 
  implicite si aucune interface n'est sp&eacute;cifi&eacute;e) pour n'importe 
  quelle famille d'adresses, <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=inet&sektion=4">inet 
  (v4)</a> ou <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=inet6&sektion=4">inet6 
  (v6)</a>&quot; implicite.</p>
<p>Bien &eacute;videmment, ceci n'est pas vraiment un filtre. Un filtrage plus 
  utile sera bas&eacute; sur la famille d'adresses (IPv4 ou IPv6), le(s) protocole(s) 
  et le(s) port(s) utilis&eacute;s par les services qu'on souhaite filtrer. N'importe 
  quel protocole list&eacute; dans <i><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=protocols&sektion=5">/etc/protocols(5)</a></i> 
  peut &ecirc;tre sp&eacute;cifi&eacute;, par son nom ou son num&eacute;ro, mais 
  nous allons nous limiter dans ce document &agrave; <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcp&sektion=4">tcp(4)</a>, 
  <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=udp&sektion=4">udp(4)</a> 
  et <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=icmp&sektion=4">icmp(4)</a>. 
</p>
<p>Maintenant supposons que nous ne voulons pas autoriser en entr&eacute;e les 
  connexions IPv4 au port TCP 3306 (MySQL) parce que la connexion &agrave; la 
  base de donn&eacute;es doit &ecirc;tre uniquement faite &agrave; partir du localhost. 
  Notre base de r&egrave;gles serait comme suit : </p>
<ul>
  <pre>
pass out all
pass in all
block in on fxp0 inet proto tcp from any to any port 3306
</pre>
</ul>
d490 4
a493 19
<p>Ceci peut &ecirc;tre interpr&eacute;t&eacute; comme suit : &quot;bloquer tout 
  les paquets IPv4 (inet) en entr&eacute;e &agrave; destination du port tcp 3306, 
  de n'importe quelle source vers n'importe quelle destination.&quot; Il est &agrave; 
  noter qu'il est obligatoire de sp&eacute;cifier un protocole avec tout filtre 
  bas&eacute; sur les ports, et qu'il est recommand&eacute; de sp&eacute;cifier 
  la famille d'adresses. Pour les services d&eacute;finis dans le fichier <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=services&sektion=5">/etc/services(5)</a> 
  , le nom du service peut &eacute;galement &ecirc;tre utilis&eacute;, comme <i>www 
  </i>ou <i>mysql</i>. Un paquet destin&eacute; au port tcp 3306 sur l'interface 
  <tt>fxp0</tt> va passer la premi&egrave;re r&egrave;gle &quot;pass in&quot; 
  puis sera bloqu&eacute; par la r&egrave;gle &quot;block in port 3306&quot;. 
  Si l'ordre de nos r&egrave;gles est invers&eacute; (souvenez-vous, l'ordre est 
  important) en entr&eacute;e : </p>
<ul>
  <pre>
pass out all
block in on fxp0 inet proto tcp from any to any port 3306
pass in all
</pre>
</ul>
d495 2
a496 15
<p>Les paquets destin&eacute;s au port tcp 3306 passeront parce que la derni&egrave;re 
  r&egrave;gle autorise tous les paquets &agrave; passer. Il est important de 
  se rappeler de ceci lors de l'&eacute;criture de r&egrave;gles de filtrage de paquets : 
  <b>la derni&egrave;re r&egrave;gle correspondante gagne</b>.</p>
<p>Bien s&ucirc;r, il y a des exceptions &agrave; chaque r&egrave;gle. L'option 
  <em>quick</em> bloque le paquet &agrave; la premi&egrave;re r&egrave;gle qui 
  correspond &agrave; ce dernier. Reprenons notre exemple pr&eacute;c&eacute;dent. 
  Si nous ajoutons <em>quick</em> &agrave; la r&egrave;gle &quot;block in&quot; : </p>
<ul>
  <pre>
pass out all
block in quick on fxp0 inet proto tcp from any to any port 3306
pass in all
</pre>
</ul>
d498 7
a504 67
<p>Un paquet destin&eacute; &agrave; notre machine sur le port tcp 3306 va atteindre 
  la r&egrave;gle &quot;block in quick&quot; et sera bloqu&eacute; imm&eacute;diatement. 
  Tous les paquets destin&eacute;s &agrave; d'autres ports ou d'autres protocoles 
  ne trouveront aucune r&egrave;gle correspondante jusqu'&agrave; ce qu'ils atteignent 
  la r&egrave;gle &quot;pass in&quot; qui autorise tous les paquets &agrave; passer.</p>
<p><b>Interdiction par d&eacute;faut </b></p>

<p>La plus s&ucirc;re des politiques de filtrage de paquets est une politique 
  d'interdiction par d&eacute;faut. Tout trafic non explicitement autoris&eacute; 
  est refus&eacute;. Cette politique est bien plus s&ucirc;re que d'interdire 
  explicitement chaque service prot&eacute;g&eacute;, permet d'avoir des bases 
  de r&egrave;gles plus petites, et peut prot&eacute;ger d'une mauvaise configuration 
  accidentelle d'un service laiss&eacute; expos&eacute;.</p>
<p>Voyons maintenant un autre exemple de base de r&egrave;gles et expliquons les 
  r&egrave;gles une par une. Voici un exemple pour un serveur web avec une politique 
  d'interdiction par d&eacute;faut qui autorise uniquement les connexions ssh 
  (pour l'administration) et les connexions http (port 80) et https (port 443).</p>
<ul><pre>
pass in quick on fxp0 inet proto tcp from any to any port 22
pass in quick on fxp0 inet proto tcp from any to any port 80
pass in quick on fxp0 inet proto tcp from any to any port 443
block in quick on fxp0 from any to any
pass out on fxp0 from any to any
</pre></ul>

<p>Ceci autorise les connexions en entr&eacute;e de n'importe o&ugrave; vers les 
  ports tcp 22 (ssh), 80 (http), 443 (https). Toutes les autres tentatives de connexions 
  en entr&eacute;e sont bloqu&eacute;es. Les connexions sortantes sont toutes 
  autoris&eacute;es. Cette base de r&egrave;gles est assez herm&eacute;tique. 
  Mais si vous vouliez autoriser uniquement vos h&ocirc;tes internes appartenant 
  au bloc d'adresses 1.1.1.0 de se connecter en ssh, et autoriser les connexions 
  &agrave; partir de l'externe &agrave; http et https ? 
<ul><pre>
pass in quick on fxp0 inet proto tcp from 1.1.1.0/24 to any port 22
pass in quick on fxp0 inet proto tcp from any to any port 80
pass in quick on fxp0 inet proto tcp from any to any port 443
block in quick on fxp0 from any to any
pass out on fxp0 from any to any
</pre></ul>

<p>Pas mal ! Mais si une seule machine (1.1.1.1) doit &ecirc;tre
autoris&eacute;e &agrave; 
  administrer le serveur web &agrave; distance ? Dans ce cas, il suffit de
  changer la ligne suivante : </p>
<ul><pre>
pass in quick on fxp0 inet proto tcp from 1.1.1.0/24 to any port 22
</pre></ul>
en : 
<ul><pre>
pass in quick on fxp0 inet proto tcp from 1.1.1.1/32 to any port 22
</pre></ul>
<p><b></b> 
</p>

<b>R&egrave;gles typiques</b> 
<p>Voici quelques r&egrave;gles typiques que tout le monde peut utiliser (en supposant 
  que fxp0 est l'interface externe connect&eacute;e &agrave; internet). D'abord, 
  une protection basique contre l'usurpation d'adresses doit &ecirc;tre mise en
  place. Ces adresses ne devraient (normalement) pas &ecirc;tre routables sur 
  l'Internet et m&ecirc;me si ce n'est pas le cas, elles sont tr&egrave;s 
  rarement l&egrave;gitimes et doivent &ecirc;tre bloqu&eacute;es :
<ul><pre>
block in quick on fxp0 inet from { 127.0.0.0/8, 192.168.0.0/16, \
172.16.0.0/12, 10.0.0.0/8 } to any
block out quick on fxp0 inet from any to { 127.0.0.1/8, 192.168.0.0/16, \ 
172.16.0.0/12, 10.0.0.0/8 }
</pre></ul>
d506 3
a508 4
<p>Notre base de r&egrave;gles commence &agrave; &ecirc;tre correcte ; une fois
tout rassembl&eacute;, voici &agrave; quoi cela ressemble : </p>
<ul>
  <pre># n'autoriser personne &agrave; usurper des adresses non-routables
d510 4
a513 4
block in quick on fxp0 inet from { 127.0.0.0/8, 192.168.0.0/16, \
172.16.0.0/12, 10.0.0.0/8 } to any
block out quick on fxp0 inet from any to { 127.0.0.1/8, 192.168.0.0/16, \
172.16.0.0/12, 10.0.0.0/8 }
d515 4
a518 1
# autoriser uniquement notre machine d'administration &agrave; se connecter via ssh
d520 3
a522 1
pass in quick on fxp0 inet proto tcp from 1.1.1.1/32 to any port 22
d524 2
a525 1
# autoriser les autres &agrave; utiliser http et https
d527 7
a533 4
pass in quick on fxp0 inet proto tcp from any to any port 80
pass in quick on fxp0 inet proto tcp from any to any port 443
# finalement, bloquer le rester avec une interdiction par d&eacute;faut
# et laisser passer le trafic sortant
d535 3
a537 1
pass out on fxp0 from any to any
a538 2
</ul>
<p></p>
d540 3
a542 72
<b>Journalisation de paquets</b> 
<p>C'est encore mieux mais peut encore &ecirc;tre am&eacute;lior&eacute;. Et si
nous souhaitons journaliser toute tentative de connexion vers le port 22 (ssh) 
qui sera bloqu&eacute;e par notre pare-feu ? Facile, Packet Filter peut
g&eacute;rer cela avec le mot-cl&eacute; 
  <i>log</i>: 
<ul><pre>
pass in quick on fxp0 inet proto tcp from 1.1.1.1/32 to any port 22
block in log quick on fxp0 inet proto tcp from any to any port 22
</pre></ul>
<p>Ces r&egrave;gles autorisent notre machine d'administration distante 
&agrave; se connecter au port 22, mais interdit et journalise toutes les autres 
tentatives de connexion au port 22.</p>
<p>Les paquets journalis&eacute;s sont envoy&eacute;s &agrave; l'interface pflog0, 
  surveill&eacute;e par <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&sektion=8">pflogd(8)</a>, 
  qui va enregistrer les paquets dans le fichier /var/log/pflog au format
  binaire <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&sektion=8">tcpdump(8)</a>. pflogd(8) est d&eacute;marr&eacute; par d&eacute;faut par <i><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc&sektion=8">/etc/rc(8)</a></i> 
  si pf est activ&eacute; dans <i><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc.conf&sektion=8">/etc/rc.conf(8)</a></i>.Vous 
  pouvez lire ces fichiers de log en utilisant la commande suivante :
<ul><pre>
# <b>tcpdump -n -e -ttt -r /var/log/pflog</b>
</pre></ul>
<p></p>
<p>Il faut &ecirc;tre conscient qu'utiliser tcpdump pour surveiller le fichier 
  pflog ne donne pas un affichage en temps r&eacute;el. Si vous souhaitez obtenir 
  un tel affichage, vous pourriez utiliser la commande : 
<ul><pre>
# <b>tcpdump -i pflog0</b>
</pre></ul>
<p>tcpdump peut aussi &ecirc;tre utilis&eacute; pour r&eacute;duire le champ 
d'investigation et faciliter le d&eacute;boguage : </p>
<ul><pre>
# <b>tcpdump -e -i pflog0 port 80</b>
</pre></ul>
<p>Ceci n'affecte pas les donn&eacute;es du fichier <i>/var/log/pflog</i>.</p>
<p>Lors de l'analyse des logs, un soin particulier devra &ecirc;tre pris avec 
  le d&eacute;codage verbeux de protocole par tcpdump (activ&eacute; &agrave; l'aide 
  de l'option -v). Les d&eacute;codeurs de protocole de tcpdump n'ont pas un 
  historique irréprochable en termes de s&eacute;curit&eacute;. En 
  th&eacute;orie du moins, une 
  attaque &agrave; retardement peut &ecirc;tre possible &agrave; travers les champs 
  donn&eacute;es partiels de paquets journalis&eacute;s. </p>
<p></p>
<p> Un soin suppl&eacute;mentaire devra &ecirc;tre pris concernant l'acc&egrave;s 
  aux logs. Pflogd capture 96 octets du paquet et le journalise. 
  L'acc&egrave;s aux journaux pourrait fournir un acc&egrave;s partiel 
  &agrave; des informations sensibles contenues dans le champ donn&eacute;e du 
  paquet (par exemple lors des connexions <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=telnet&sektion=1">telnet(1)</a> 
  ou <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp&sektion=1">ftp(1)</a>). 
</p>
<p><b>Protocoles multiples</b></p>

<p>Comment faire lorsqu'il est n&eacute;cessaire d'autoriser les connexions 
vers un service utilisant plusieurs protocoles, comme bind qui utilise TCP et 
UDP ? Packet Filter vous permet de regrouper des options sous forme d'une 
liste (plus de d&eacute;tails &agrave; propos des listes seront donn&eacute;s 
par la suite) : 
<ul>
  <pre>
# Laisser passer le trafic DNS pour BIND
pass in quick on fxp0 inet proto { tcp, udp } from any to any port 53
</pre>
</ul>
<p>Notez les espaces des deux c&ocirc;t&eacute;s des caract&egrave;res '{ }'. 
  Ceci est plus lisible que l'alternative que vous auriez pu utiliser : </p>
<ul>
  <pre>
pass in quick on fxp0 inet proto tcp from any to any port 53
pass in quick on fxp0 inet proto udp from any to any port 53
</pre>
</ul>
<p></p>
d544 2
a545 70
<p> <a name="normalization"></a> <b> Normalisation de paquets</b> </p>
<p>Certains syst&egrave;mes d'exploitation et applications ont du mal &agrave; 
  g&eacute;rer les paquets anormaux ou fragment&eacute;s. Il est donc parfois 
  b&eacute;n&eacute;fique de pouvoir normaliser les paquets avant de les transmettre 
  &agrave; leur destination finale. Ceci est effectu&eacute; gr&acirc;ce &agrave; 
  la directive <b>scrub,</b> utilis&eacute;e comme suit :
<ul><pre>
scrub in all
</pre></ul>
<p>Ceci engendre une charge additionnelle sur le syst&egrave;me. Il n'y a donc 
  aucune raison d'utiliser cette commande mis &agrave; part lors de la protection 
  d'&eacute;quipements ayant des mauvaises mises en oeuvre TCP/IP.</p>
<p> <b>Options IP</b></p>
<p>Par d&eacute;faut, PF bloque les paquets contenant des options IP. Ceci peut 
  rendre le travail plus difficile &agrave; des outils de &quot;prise d'empreinte 
  des syst&egrave;mes d'exploitation&quot; comme nmap. Si vous avez une application 
  qui n&eacute;cessite de tels paquets, comme le multicast ou l'IGMP, vous pouvez 
  utiliser la directive <b>allow-opts</b> : 
<ul><pre>
pass in quick on fxp0 allow-opts
</pre></ul>
<p></p>

<p> <b>Drapeaux TCP, connexions &eacute;tablies et maintien d'&eacute;tat </b></p>
<p>Packet Filter peut aussi filtrer les paquets en se basant sur les drapeaux 
  TCP et maintenir les connexions &eacute;tablies et l'&eacute;tat des connexions. 
  Il est recommand&eacute; que tous les utilisateurs qui souhaitent filtrer les 
  paquets selon les drapeaux TCP comprennent le r&ocirc;le de chaque drapeau. 
  Par exemple, si vous vouliez interdire tous les paquets avec les drapeaux FIN, 
  URG, et PSH positionn&eacute;s (comme par exemple lors d'une tentative de prise 
  d'empreinte avec nmap), vous pourriez utiliser une r&egrave;gle comme suit :
<ul><pre>
block in quick on fxp0 inet proto tcp from any to any flags FUP/FUP
</pre></ul>
<p>(Remerciements &agrave; <a href=mailto:halogen@@nol.net>Kyle Hargraves</a> pour 
  cette astuce) </p>
<p>Une autre fonctionnalit&eacute; utile de Packet Filter est sa capacit&eacute; 
  &agrave; maintenir l'&eacute;tat. Le maintien d'&eacute;tat a &eacute;t&eacute; 
  d&eacute;crit comme &quot;je ne parle pas avant qu'on me parle&quot;; en d'autres 
  termes, une fois une connexion est &eacute;tablie, les paquets n'ont plus besoin 
  de traverser les bases de r&egrave;gles. C'est une fonctionnalit&eacute; tr&egrave;s 
  puissante qui permet d'&eacute;crire des r&egrave;gles plus simples et plus 
  s&ucirc;res. </p>
<p></p>
<p></p>
<p></p>
<p></p>
<p></p>
<p></p>
<p>Par exemple, voyons comment peut s'appliquer le maintien d'&eacute;tat &agrave; 
  notre base de r&egrave;gles pr&eacute;c&eacute;dente. En r&eacute;sum&eacute;, 
  nous autorisons un acc&egrave;s d'administration &agrave; partir de notre classe 
  C au port 22 (ssh) et tout trafic web entrant vers les ports 80 (http) et 443 
  (https). Nous bloquons tout autre trafic. Mais si je voulais faire un <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ssh&sektion=1">ssh(1)</a> 
  &agrave; partir du serveur web ? Et si j'avais besoin d'utiliser <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=lynx&sektion=1">lynx(1)</a> 
  pour chercher quelque chose dans la FAQ ? Eh bien, je ne peux pas parce que 
  j'ai bloqu&eacute; toutes les connexions entrantes autres que celles &agrave; 
  destination des ports sp&eacute;cifi&eacute;s. Bien que c'est la plus s&ucirc;re 
  des m&eacute;thodes, cela peut devenir assez g&eacute;nant. En ajoutant le mot-cl&eacute; 
  <em>keep state</em> &agrave; notre r&egrave;gle &quot;pass out&quot;, nous pouvons 
  automatiquement autoriser les connexions entrantes en r&eacute;ponse &agrave; 
  des connexions que nous avons initi&eacute;, comme la navigation web. Attention, 
  nous avons besoin de sp&eacute;cifier le protocole pour lequel nous maintenons 
  l'&eacute;tat.</p>
<ul>
  <pre>
block in fxp0 inet proto tcp all
pass in quick on fxp0 inet proto tcp from 1.1.1.0/24 to any port 22
pass in quick on fxp0 from any to any port 80
pass in quick on fxp0 from any to any port 443
d547 8
a554 24
pass out on fxp0 inet proto tcp from any to any keep state
</pre>
</ul>
<p>Cette petite modification va am&eacute;liorer la flexibilit&eacute; et la s&eacute;curit&eacute; 
  de notre base de r&egrave;gles de fa&ccedil;on spectaculaire : par exemple, 
  dans la base de r&egrave;gles ci-dessus, nous autorisons tout trafic tcp 
  vers les 
  ports 80 et 443. On peut verrouiller nos r&egrave;gles un peu plus. Afin qu'une 
  connexion tcp s'&eacute;tablisse, nous avons seulement besoin de laisser le 
  &quot;tcp handshake&quot; initial avoir lieu. Une fois effectu&eacute;, on peut 
  bloquer le trafic vers ce port et laisser notre r&egrave;gle &quot;keep state&quot; 
  g&eacute;rer la connexion. Pour autoriser la poign&eacute;e de main tcp
  initiale, 
  nous avons uniquement besoin d'autoriser les paquets avec un drapeau SYN positionn&eacute; 
  et un drapeau ACK non positionn&eacute;. En laissant passer uniquement les paquets 
  avec un SYN positionn&eacute;, il est possible de se pr&eacute;munir contre
  plusieurs formes 
  de scan de ports comme le scan FIN. flags S/SA signifie : des deux drapeaux 
  S (SYN) et A (ACK), seulement SYN peut &ecirc;tre positionn&eacute;. Les 
  autres 
  drapeaux ne sont pas investigu&eacute;s. Les r&egrave;gles ressemblent 
  maintenant &agrave; : 
<ul>
  <pre>block in on fxp0 inet proto tcp all
d556 2
a557 52
pass in quick on fxp0 inet proto tcp from 1.1.1.0/24 to any port 22 \
flags S/SA keep state
pass in quick on fxp0 inet proto tcp from any to any port 80 \
flags S/SA keep state
pass in quick on fxp0 inet proto tcp from any to any port 443 \
flags S/SA keep state
block out on fxp0 inet proto tcp all
pass out on fxp0 proto tcp all flags S/SA keep state</pre>
</ul>
<p></p>
<p></p>
<p></p>
<p></p>
<p>Commen&ccedil;ons &agrave; lier les choses ensemble en mettant toutes les r&egrave;gles 
  que nous avons cr&eacute;e jusqu'&agrave; pr&eacute;sent dans une m&ecirc;me 
  base de r&egrave;gles. Cette base de r&egrave;gles supporte IPv4, a une politique 
  d'interdiction par d&eacute;faut, autorise les connexions d'administration &agrave; 
  partir d'un r&eacute;seau local uniquement (via ssh) et autorise le trafic entrant 
  vers les ports 80 (http) et 443 (https). Elle prot&egrave;ge aussi contre 
  des adresses usurp&eacute;es non-routables, et bloque tous les paquets qui 
  sont trop fragment&eacute;s pour pouvoir &ecirc;tre inspect&eacute;s. Une 
  configuration typique pour un serveur web public. Voici &agrave; quoi
  ressemblerait <i>/etc/pf.conf</i> : 
</p>
<ul>
  <pre>
# nettoyer les paquets anormaux et fragment&eacute;s
scrub in all


# n'autoriser personne &agrave; usurper des adresses non-routables
block in quick on fxp0 inet from { 127.0.0.0/8, 192.168.0.0/16, \
172.16.0.0/12, 10.0.0.0/8 } to any
block out quick on fxp0 inet from any to { 127.0.0.1/8, 192.168.0.0/16, \
172.16.0.0/12, 10.0.0.0/8 }

# par d&eacute;faut, interdire tous les paquets entrants, except&eacute; ceux
# explicimtement autoris&eacute;s par les r&egrave;gles suivantes
block in on fxp0 all

# autoriser les autres &agrave; utiliser http et https
pass in quick on fxp0 inet proto tcp from any to any port 80 \
flags S/SA keep state
pass in quick on fxp0 inet proto tcp from any to any port 443 \
flags S/SA keep state

# et laisser le trafic sortant passer en maintenant l'&eacute;tat des connexions
# &eacute;tablies 
# laisser passer tous les protocoles (y compris TCP, UDP, et ICMP) et 
# maintenir l'&eacute;tat correspondant de telle fa&ccedil;on que les serveurs DNS puissent
# r&eacute;pondre &agrave; nos propres requ&ecirc;tes DNS (UDP).
pass out on fxp0 from any to any keep state
a558 123
</ul>
<p></p>
<p>Bien que cet ensemble de r&egrave;gles soit correct, Packet Filter poss&egrave;de 
  quelques fonctionnalit&eacute;s qui vous permetteront de rendre votre fichier 
  <i>/etc/pf.conf</i> encore plus lisible et plus facilement maintenable.</p>
<p><b>Listes</b></p>

<p>Les listes sont des &quot;raccourcis&quot; utiles pour &eacute;crire des r&egrave;gles 
  plus simples et plus claires sous PF. Par exemple, comment faire si nous avons 
  besoin d'autoriser des connexions &agrave; un service utilisant plusieurs protocoles, 
  comme BIND, qui utilise TCP et UDP ?
<ul><pre>
pass in quick on fxp0 inet proto { tcp, udp } from any to any port 53
</pre></ul>
Notez les espaces des deux c&ocirc;t&eacute;s des caract&egrave;res '{ }'.
<p></p>
<p>Des groupes d'adresses IP en relation peuvent &ecirc;tre regroup&eacute;s 
dans des listes ; ces listes peuvent &ecirc;tre employ&eacute;es l&agrave; o&ugrave; une 
  seule adresse IP serait utilis&eacute;e dans une r&egrave;gle. Nos 
  r&egrave;gles d'anti-usurpation d'adresses en sont un exemple : 
<ul><pre>
# don't allow anyone to spoof non-routeable addresses
block in quick on fxp0 inet from { 127.0.0.0/8, 192.168.0.0/16, \
172.16.0.0/12, 10.0.0.0/8 } to any
block out quick on fxp0 inet from any to { 127.0.0.1/8, 192.168.0.0/16, \
172.16.0.0/12, 10.0.0.0/8 }
</pre></ul>
<p><b></b>
</p>

<b>Expansion de variable </b> 
<p>Un probl&egrave;me avec le pr&eacute;c&eacute;dent exemple de <i>pf.conf </i>est 
  de devoir changer un certain nombre de lignes si vous avez besoin de changer 
  votre interface, ou de changer une adresse IP. Le nombre de changements &agrave; 
  effectuer peut &ecirc;tre diminu&eacute; en utilisant l'expansion de variable : </p>
<ul><pre>
NoRouteIPs="{ 127.0.0.0/8, 192.168.0.0/16, 172.16.0.0/12, 10.0.0.0/8 }"
ExtIF="fxp0"
block in quick on $ExtIF from $NoRouteIPs to any
block out quick on $ExtIF from any to $NoRouteIPs
</pre></ul>
<p></p>

<p> <a name="sample_pf.conf"></a> <b>Mettons tout ensemble</b></p>
<p> Maintenant, mettons tout ensemble et voyons l'&eacute;l&eacute;gance de ce 
  fichier : 
<ul>
  <pre>
# D&eacute;finition de variables utiles

ExtIF="fxp0"              # Interface externe
IntNet="1.1.1.0/24"       # Notre réseau interne
NoRouteIPs="{ 127.0.0.0/8, 192.168.0.0/16, 172.16.0.0/12, 10.0.0.0/8 }"
Services="{ www, https }"

# Nettoyage des paquets anormaux et fragmentés
scrub in all

# n'autoriser personne &agrave; usurper des adresses non-routables
block in quick on $ExtIF from $NoRouteIPs to any
block out quick on $ExtIF from any to $NoRouteIPs

# par d&eacute;faut, interdire tous les paquets entrants, except&eacute; ceux
# explicimtement autoris&eacute;s par les r&egrave;gles suivantes
block in on fxp0 all

# autoriser les autres à utiliser http et https
pass in quick on $ExtIF inet proto tcp from any to any port $Services \
flags S/SA keep state

# et laisser le trafic sortant passer en maintenant l'&eacute;tat des connexions
# &eacute;tablies 
# laisser passer tous les protocoles (y compris TCP, UDP, et ICMP) et 
# maintenir l'&eacute;tat correspondant de telle fa&ccedil;on que les serveurs DNS puissent
# r&eacute;pondre &agrave; nos propres requ&ecirc;tes DNS (UDP).
pass out on fxp0 from any to any keep state</pre>
</ul>
<p></p>

<p> Si vous rencontrez des probl&egrave;mes, vous pouvez activer 
la journalisation sur des r&egrave;gles individuelles pour trouver la cause des probl&egrave;mes :
<ul><pre>
pass in log quick on fxp0 from 1.1.1.0/24 to any port 22
</pre></ul>
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&sektion=8">pflogd(8)</a> 
&eacute;crira les paquets journalis&eacute;s dans /<i>var/log/pflog</i>. Il 
faut se rappeler que <i>/var/log/pflog</i> 
est un fichier binaire, destin&eacute; &agrave; &ecirc;tre lu par <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&sektion=8">tcpdump(8)</a>, 
et PAS DIRECTEMENT par des &ecirc;tres humains. 
<p></p>
<p> Quand vous modifiez le fichier de configuration pour journaliser des 
paquets, n'oubliez pas de taper <b>pfctl -R /etc/pf.conf</b> pour la prise en 
compte des modifications ! </p>

<p>
<h3>Diff&eacute;rences entre PF et IPF</h3>
<p></p>
<p>Packet Filter (PF) a &eacute;t&eacute; con&ccedil;u pour &ecirc;tre tr&egrave;s 
  compatible avec le fichier de r&egrave;gles <i>ipf.rules </i> de IPF. N&eacute;anmoins, 
  PF n'est pas simplement un rempla&ccedil;ant immédiat d'IPF. Les principales 
  diff&eacute;rences de syntaxe pour les r&egrave;gles de filtrage (pf.conf) sont 
  les suivantes : </p>
<ul>
  <li><b>group et head:</b> ces options ne sont plus utilis&eacute;es, vu que 
    les r&egrave;gles de filtrage sont optimis&eacute;es &agrave; la vol&eacute;e. 
    Si vous migrez vos anciennes bases de r&egrave;gles IPF, vous devriez effacer 
    toute d&eacute;finition <em>group</em> ou <em>head</em> et r&eacute;ordonner 
    manuellement vos r&egrave;gles, en s'assurant que les s&eacute;mantiques n'ont 
    pas chang&eacute;. </li>
  <li><b>level:</b> pour la journalisation, PF n'accepte pas une option <em>level</em> 
    pour le mot-cl&eacute; <i>log</i>, puisqu'elle n'est pas effectu&eacute; 
    par <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=syslogd&sektion=8">syslogd(8)</a>, 
    mais par un d&eacute;mon de journalisation s&eacute;par&eacute;. Pour 
    analyser un type particulier de trafic, comme cela pourrait se faire avec 
    l'option<em> level</em>, 
    utilisez une des options disponibles de <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&sektion=8">tcpdump(8)</a>.</li>
  <li><b>keep frags:</b> Ceci a &eacute;t&eacute; remplac&eacute; par la normalisation 
    r&eacute;alis&eacute;e par le mot-cl&eacute; <a href="#normalization">scrub</a>.</li>
  <li><b>R&egrave;gles @@n :</b> PF n'a pas de support pour l'utilisation des pr&eacute;fixes 
    @@n pour ins&eacute;rer des r&egrave;gles &agrave; des points particuliers 
    dans la liste des r&egrave;gles comme le permet IPF. Pour voir les 
    num&eacute;ros de r&egrave;gles que PF a affect&eacute;, utilisez la commande <tt>pfctl -sr</tt></li>
</ul>
d561 2
a562 89
<a name="6.3"></a>
<a name="NAT"></a>
<h2>6.3 - Traduction d'adresses</h2>
<p></p>
<p>
<h5>Remarque : Packet filter est le syst&egrave;me de filtrage de OpenBSD &agrave; 
  partir de la version 3.0. Si vous recherchez la FAQ IPF/IPNAT pour les versions 
  ant&eacute;rieures de OpenBSD, cliquez <a href="../faqipf.html">ici</a>.</h5>
<p></p>
<a name="nat1.0"></a>
<h3><u>6.3.1 Introduction &agrave; la traduction d'adresses (NAT)</u></h3>

<a name="nat1.1"></a> 
<p> Bas&eacute;e sur la <a href="http://www.geektools.com/rfc/rfc1631.txt">RFC 
  1631</a>, la traduction d'adresses fournit un moyen facile pour faire correspondre 
  des r&eacute;seaux internes &agrave; une seule adresse internet (r&eacute;elle) 
  routable. Ceci est tr&egrave;s utile si vous n'avez pas des adresses officiellement 
  attribu&eacute;es &agrave; chaque h&ocirc;te de votre r&eacute;seau interne. 
  Quand vous mettez en place des r&eacute;seaux priv&eacute;s/internes, vous pouvez 
  b&eacute;n&eacute;ficier de blocs d'adresses r&eacute;serv&eacute;s (attribu&eacute;s 
  dans la <a href="http://www.geektools.com/rfc/rfc1918.txt">RFC 1918</a>) tels 
  les blocs suivants : </p>

<p>
10.0.0.0/8 (10.0.0.0 - 10.255.255.255)<br>
172.16.0.0/12 (172.16.0.0 - 172.31.255.255)<br>
192.168.0.0/16 (192.168.0.0 - 192.168.255.255)<br>
</p>

<p>On suppose que l'utilisateur a d&eacute;j&agrave; install&eacute; et configur&eacute; 
  une machine OpenBSD avec deux cartes r&eacute;seaux (une connect&eacute;e &agrave; 
  Internet et l'autre connect&eacute;e au r&eacute;seau local). </p>
<p><br>
  <a name="nat1.3"></a> <b>Configuration</b> </p>
<p>A des fins d'exemple, nous allons utiliser le syst&egrave;me d&eacute;crit 
  ci-apr&egrave;s. Votre configuration est tr&egrave;s probablement diff&eacute;rente, 
  alors soyez prudent quand vous reprenez cet exemple.</p>
<ul>
  <b>Interfaces r&eacute;seaux : </b> 
  <ul>
    Intel EtherExpress Pro/100 <b>fxp0</b><br>
    Connect&eacute;e au LAN (ou WAN) EXTERNE<br>
    <b>Adresse IP : </b>24.5.0.5<br>
    <b>Masque de sous-r&eacute;seau : </b>255.255.255.0<br>
    <br>
    Compaq Netelligent 10/100Mb <b>tl0</b><br>
    Connect&eacute;e au LAN INTERNE<br>
    <b>Adresse IP : </b>192.168.1.1<br>
    <b>Masque de sous-r&eacute;seau : </b>255.255.255.0<br>
  </ul>
  <br>
  <b>Adresse IP externe, routable sur Internet (fournie par le FAI, un fournisseur 
  d'acc&egrave;s c&acirc;ble dans ce cas)<br>
  </b> 
  <ul>
    <b>Adresse IP : </b>24.5.0.5<br>
    <b>Masque de sous-r&eacute;seau : </b>255.255.255.0<br>
    <b>Passerelle : </b>24.5.0.1<br>
  </ul>
  <br>
  <b>R&eacute;seau local</b><br>
  <ul>
    <p>Dans cet environnement donn&eacute; en exemple, les machines sur le r&eacute;seau 
      interne utilisent 192.168.1.xxx (o&ugrave; xxx est un nombre unique) comme 
      plan d'adressage. Il peut y avoir une vari&eacute;t&eacute; de syst&egrave;mes 
      d'exploitation sur le r&eacute;seau interne, tel que Windows 98, Windows 
      NT, OpenBSD et Linux, mais le syst&egrave;me d'exploitation de la machine 
      cliente n'est pas un souci pour la traduction d'adresses. Pour les exemples, 
      le client auquel nous nous int&eacute;resserons a 192.168.1.40 comme adresse 
      IP. </p>
  </ul>
  <br>
  <b>Diagramme de Configuration</b> 
  <ul>
    <pre>
+-----+              +---------+          +----------+
| Hub |--------- tl0 |   NAT   | fxp0 ----| Internet |
+-----+              +---------+          +----------+
| |
| +-- Client A
+---- More clients 

		      +--------------------------+
		      |          LEGEND          |
		      +--------------------------+
		      |  NIC fxp0 - 24.5.0.5     |
		      |  NIC tl0  - 192.168.1.1  |
		      | Client A  - 192.168.1.40 |
		      +--------------------------+
d564 3
a566 3
</pre>
  </ul>
</ul>
d568 2
a569 37
<br>
<a name="nat2.0"></a>
<h3><u>6.3.2 Traduction d'adresses</u></h3>
<br>
<a name="nat2.1"></a> <b>Introduction &agrave; la traduction d'adresses</b>
<p>Chaque noeud sur Internet requiert une adresse IP unique. Avec IPv4, il y a 
  un nombre fini et r&eacute;duit d'adresses IP distinctes disponibles, et par 
 cons&eacute;quent, ces adresses ne sont pas gratuites. La plupart des FAIs 
 &agrave; 
  faible co&ucirc;t limitent un site &agrave; un nombre d'adresses entre 1 et 
  30, et alors que de grandes organisations peuvent avoir les moyens pour se permettre 
  un large bloc d'adresses, dans la plupart des cas, il y a quelques b&eacute;n&eacute;fices 
  relatifs et des risques consid&eacute;rables &agrave; avoir chaque ordinateur 
  adressable individuellement sur Internet.</p>
<p>La traduction d'adresses, ou NAT (Network Address Translation), (connu aussi 
  sous le nom de &quot;IP Masquerading&quot; si vous avez une exp&eacute;rience 
  Linux) permet de mettre plusieurs ordinateurs &quot;derri&egrave;re&quot; une 
  seule (ou un petit nombre) adresse IP. Chaque ordinateur &quot;interne&quot; 
  a une adresse IP attribu&eacute;e localement et non enregistr&eacute;e (d'apr&egrave;s 
  la <a href="http://www.geektools.com/rfc/rfc1918.txt">RFC 1918</a>), et tous 
  utilisent la m&ecirc;me adresse IP externe, simultan&eacute;ment. </p>
<p> La NAT fonctionne de mani&egrave;re plut&ocirc;t simple. Quand un client sur 
  le LAN veut se connecter sur une machine sur Internet, il envoie un paquet TCP 
  avec une requ&ecirc;te de connexion. L'en-t&ecirc;te TCP contient l'adresse 
  IP du client (192.168.1.40 par exemple) et l'adresse IP du h&ocirc;te distant 
  (123.45.67.89 par exemple). La machine effectuant la NAT intercepte ce paquet 
  TCP et change l'adresse IP du client 192.168.1.40 avec l'adresse IP de la machine 
  connect&eacute;e sur Internet (24.5.0.5 par exemple). Ceci va faire croire &agrave; 
  la machine distante que la connexion vient de la machine de NAT, et non pas 
  de la machine cliente. La machine distante renvoie alors les r&eacute;ponses 
  &agrave; la machine de NAT comme si c'&eacute;tait cette derni&egrave;re qui 
  se connecte. Quand la machine de NAT re&ccedil;oit les r&eacute;ponses, elle 
  change rapidement l'adresse IP destination (la sienne) avec l'adresse IP du 
  client puis les envoie au client. Le client normalement n'a pas d'id&eacute;e 
  sur ce qui se passe et la connectivit&eacute; Internet est transparente pour 
  l'utilisateur et ses applications.</p>
<p> L'exemple ci-dessous montre la NAT un peu plus clairement : </p>
d571 2
a572 12
<ul>
  <pre>
Client ----------------- tl0 [ NAT ] fxp0 ---------- Hôte distant
192.168.1.40 --- 192.168.1.1 [ NAT ] 24.5.0.5 --- 123.45.67.89

Paquet TCP SORTANT                     	Paquet TCP SORTANT
De: 192.168.1.40    &gt;&gt;=== NAT ===&gt;&gt;     Vers: 24.5.0.5
De: 123.45.67.89                        Vers: 123.45.67.89

Paquet TCP ENTRANT                      Paquet TCP ENTRANT
De: 123.45.67.89 			De: 123.45.67.89
Vers: 192.168.1.40  &lt;&lt;=== NAT ===&lt;&lt;     Vers: 24.5.0.5
a573 1
</ul>
d575 10
a584 35
<br>
<a name="nat2.2"></a> <b>Pourquoi utiliser la NAT?</b> 
<p>Quand j'ai r&eacute;alis&eacute; que j'avais la possibilit&eacute; d'avoir 
  un modem c&acirc;ble dans mon nouvel appartement, j'ai aussi r&eacute;alis&eacute; 
  que j'avais un petit probl&egrave;me. Comment fournir un acc&egrave;s Internet 
  &agrave; mes colocataires vu que le modem c&acirc;ble est dans ma chambre ? 
  Quelques options s'offraient &agrave; moi comme l'obtention d'adresses IP suppl&eacute;mentaires, 
  la mise en place d'un serveur proxy, ou la mise en place de la NAT. (L'exemple
du c&acirc;ble modem domestique ne doit pas vous tromper. La NAT est assez 
  puissante pour masquer un grand r&eacute;seau avec des centaines voire des milliers 
  d'ordinateurs !)</p>
<p>Il y a plusieurs raisons pour lesquelles j'ai choisi la NAT. La raison num&eacute;ro 
  1 est l'&eacute;conomie d'argent. J'ai deux colocataires, et partager les co&ucirc;ts 
  est certainement attractif. De plus, chaque colocataire a son propre PC et j'en 
  ai moi-m&ecirc;me trois, ce qui fait cinq ordinateurs &agrave; connecter, mais 
  mon FAI autorise seulement trois adresses IP par domicile. Cela signifie 
  qu'il n'y avait pas assez d'adresses IP pour permettre &agrave; chaque 
  machine d'avoir un acc&egrave;s direct &agrave; Internet en simultan&eacute;. </p>
<p>En utilisant la NAT, chaque machine aura une adresse IP interne unique mais 
  partagera avec les autres la seule adresse IP fournie par mon FAI. Le co&ucirc;t 
  chute. </p>

<p> <a name="nat2.4"></a> <b>Mise en place</b></p>

<p>Pour activer la NAT sur votre machine OpenBSD, vous aurez besoin d'activer 
  PF. Ceci peut &ecirc;tre facilement réalisé en &eacute;ditant les fichiers 
  list&eacute;s ci-apr&egrave;s (effectuez les changements dans le fichier pour 
  qu'il ressemble &agrave; l'exemple ci-apr&egrave;s) : </p>
<p><b>/etc/rc.conf</b> (ce fichier est utilis&eacute; pour lancer les services 
  au d&eacute;marrage) </p>

<ul>
  <pre>
pf=YES</pre>
</ul>
d587 2
a588 2
<b>/etc/sysctl.conf</b>
</p>
d590 3
a592 3
<ul><pre>
net.inet.ip.forwarding=1
</pre></ul>
d594 4
a597 23
<p>Apr&egrave;s que ces changements aient &eacute;t&eacute; effectu&eacute;s, 
  la machine est maintenant pr&ecirc;te pour la configuration de la NAT.</p>
<p><a name="nat2.5"></a> <b>Configuration</b> </p>

<p>La premi&egrave;re &eacute;tape consiste &agrave; configurer le fichier de 
  configuration de PF (<i><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&sektion=5">/etc/pf.conf</a></i>). 
  Dans la suite de ce chapitre, nous allons autoriser le trafic &agrave; traverser 
  le pare-feu sans aucune interf&eacute;rence. Le fichier devrait ressembler
  &agrave; : </p>
<ul><pre>
pass in all
pass out all
</pre></ul>

<p>Encore une fois, vous pouvez lire <a href="#PF">FAQ 6, Packet Filter</a> pour 
  plus d'informations</p>
<p>Le fichier de configuration de la NAT (<i><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=nat.conf&sektion=5">/etc/nat.conf</a></i>) 
  a une syntaxe tr&egrave;s simple. Pour la configuration d&eacute;crite plus 
  haut, le fichier devrait contenir la ligne suivante : </p>

<ul><pre>
nat on fxp0 from 192.168.1.0/24 to any -&gt; 24.5.0.5
</pre></ul>
d599 4
a602 1
<p> Voici une explication de cette ligne. </p>
d604 3
a606 8
<ul>
  <strong>"nat"</strong> 
  <p>Ceci indique que la commande que vous donnez est une r&egrave;gle de NAT.</p>
  <p><strong>"fxp0"</strong> </p>
</ul>
<ul>
  <p>Ceci est l'interface r&eacute;seau qui est connect&eacute;e &agrave; Internet.</p>
</ul>
d608 6
a613 6
<ul>
  <b>"192.168.1.0/24"</b> 
  <p>l'adresse IP et le masque sous-r&eacute;seau (au format CIDR). Combin&eacute;s, 
    ils d&eacute;clarent que &quot;n'importe quelle adresse IP comprise entre 
    192.168.1.1 et 192.168.1.254 inclus&quot; doit faire l'objet d'une correspondance.</p>
</ul>
a614 5
<ul>
  <b>"24.5.0.5"</b> 
  <p> C'est l'adresse IP externe utilis&eacute;e pour la translation des adresses 
    IP internes. </p>
</ul>
d616 4
a619 36
<a name="nat2.6"></a> <b>Ex&eacute;cution</b> 
<p>Une fois la configuration termin&eacute;e, il y a deux mani&egrave;res 
  d'activer la NAT. La premi&egrave;re (et meilleure si possible) est de red&eacute;marrer 
  votre machine OpenBSD. Ceci est accompli &agrave; l'aide de la commande &quot;<i>reboot</i>&quot;. 
</p>
<p>Si vous voulez configurer la NAT &agrave; partir de la ligne de commande, utilisez 
  les commandes suivantes : </p>

<ul><pre>
# <b>pfctl -N /etc/nat.conf</b>
# <b>pfctl -e</b>
</pre></ul>

<p>La premi&egrave;re ligne sert &agrave; charger les r&egrave;gles de NAT dans 
  PF (et &agrave; purger les anciennes r&egrave;gles), la ligne suivante active 
  PF. Cependant, red&eacute;marrer est le meilleur moyen pour s'assurer que tout 
  va &ecirc;tre lanc&eacute; comme pr&eacute;vu au red&eacute;marrage.</p>
<p><b>Remarque : </b>afin de recharger les r&egrave;gles de NAT (au cas 
o&ugrave; vous auriez &eacute;dit&eacute; le fichier mais vous ne voulez pas 
red&eacute;marrer), 
  ex&eacute;cutez juste la premi&egrave;re commande encore une fois. La configuration 
  sera purg&eacute;e et recharg&eacute;e.</p>


<h3><u><a name="nat3.0"></a>6.3.3 Base de connaissances NAT</u></h3>

<a name="nat3.1"></a> <b>V&eacute;rification de l'&eacute;tat de la NAT</b> 
<p>Pour conna&icirc;tre l'&eacute;tat de la NAT ou &ecirc;tre s&ucirc;r que votre 
  configuration a &eacute;t&eacute; prise en compte, utilisez l'option &quot;-ss&quot;. 
  Cette option va lister toutes les sessions de NAT en cours : </p>
<ul><pre>
# pfctl -ss
TCP  192.168.1.40:2132 -&gt; 24.5.0.5:53136 -&gt; 65.42.33.245:22       TIME_WAIT:TIME_WAIT
TCP  192.168.1.40:2492 -&gt; 24.5.0.5:55011 -&gt; 65.42.33.245:22       ESTABLISHED:ESTABLISHED
UDP  192.168.1.40:2491 -&gt; 24.5.0.5:60527 -&gt; 24.2.68.33:53       2:1
</pre></ul>
d621 4
a624 22
<p> Explications (de la premi&egrave;re ligne, les autres &eacute;tant similaires) : 
</p>
<ul>
  <b>"192.168.1.40:2132"</b> 
  <p>Ceci vous donne l'adresse IP de la machine du LAN qui utilise la NAT (192.168.1.40). 
    Le num&eacute;ro de port utilis&eacute; pour faire la connexion (2132) est 
    affich&eacute; juste apr&egrave;s.</p>
</ul>
<ul>
  <b>"24.5.0.5:53136"</b> 
  <p> Ceci montre que la connexion va vers Internet &agrave; travers l'adresse 
    IP 24.5.0.5 et le port 53136.</p>
</ul>
<ul>
  <b>"65.42.33.245:22"</b> 
  <p>L'adresse IP et le port auxquels le client se connecte.</p>
</ul>
<ul>
  <b>"TIME_WAIT:TIME_WAIT"</b> 
  <p> Ceci indique l'&eacute;tat dans lequel la connexion TCP se trouve d'apr&egrave;s 
    PF. </p>
</ul>
a625 46
<a name="nat3.2"></a> <b> Probl&egrave;mes avec le FTP et la NAT</b> 
<p>Il y a quelques limitations &agrave; la NAT, la plus commun&eacute;ment rencontr&eacute;e 
  &eacute;tant avec FTP. Vous pouvez utiliser FTP de deux fa&ccedil;ons : passive 
  et active. De ces deux fa&ccedil;ons, le FTP passif est consid&eacute;r&eacute; 
  comme &eacute;tant plus s&eacute;curis&eacute;.</p>
<p>Avec le FTP actif, quand un utilisateur se connecte &agrave; un serveur FTP 
  distant et demande une information ou un fichier, le client FTP envoie au serveur 
  un num&eacute;ro de port al&eacute;atoire sur lequel le serveur va se connecter 
  au client et transf&eacute;rer l'information. Ceci est un probl&egrave;me pour 
  les utilisateurs tentant d'acc&eacute;der &agrave; des serveurs FTP &agrave; 
  partir de leur r&eacute;seau interne. Quand le serveur FTP envoie l'information, 
  il l'envoie &agrave; l'adresse externe (celle de la machine de NAT) sur un port 
  al&eacute;atoire. Quand la machine de NAT recevra ce paquet, et parce qu'elle 
  n'a aucune correspondance pour ce paquet inconnu et aucune correspondance pour 
  ce port, elle bloquera le paquet et ne le livrera pas. </p>
<p> Avec le mode FTP passif (s&eacute;lectionn&eacute; par d&eacute;faut par le 
  client <a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp&sektion=1">ftp(1)</a> de 
  OpenBSD), le client &eacute;met une requ&ecirc;te au serveur pour que ce dernier 
  choisisse un port al&eacute;atoire sur lequel il sera en attente d'une connexion 
  de donn&eacute;es. Le serveur informe le client du port qu'il a choisi, et ce 
  dernier se connecte &agrave; ce port pour transf&eacute;rer les donn&eacute;es. 
  Malheureusement, ceci n'est pas toujours possible ou souhaitable. ftp(1) utilise 
  ce mode par d&eacute;faut; pour forcer le mode FTP actif, utilisez le drapeau 
  -A de ftp, ou d&eacute;sactivez le mode passif en saisissant la commande suivante : </p>
<dl><dt>
<pre>passive off
</pre>
</dt></dl>
Au prompt ftp&gt;. 
<p></p>
<P>PacketFilter fournit une autre solution &agrave; cette situation : la redirection 
  du trafic FTP &agrave; travers un serveur proxy FTP, un programme qui agit pour 
  &quot;guider&quot; votre trafic FTP &agrave; travers les filtres. Le proxy FTP 
  utilis&eacute; par OpenBSD et PF est <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&sektion=8">ftp-proxy(8)</a>. 
  Pour l'activer, mettez quelque chose qui ressemble &agrave; la ligne suivante 
  dans votre fichier <i>/etc/nat.conf</i> :
<ul><pre>
rdr on tl0 from any to any port 21 -&gt; 127.0.0.1 port 8081
</pre></ul>
<p>Une explication concise de cette ligne est : &quot;le trafic sur l'interface 
  interne est redirig&eacute; vers le serveur proxy tournant sur cette machine 
  et &eacute;coutant sur le port 8081&quot;.</p>
<p>Si tout va bien, il est apparent que le serveur proxy a besoin d'&ecirc;tre 
  d&eacute;marr&eacute; sur la machine OpenBSD, ceci est effectu&eacute; en ins&eacute;rant 
  la ligne suivante dans <i>/etc/inetd.conf.</i></p>
d627 6
a632 2
  <pre>127.0.0.1:8081 stream tcp nowait root /usr/libexec/ftp-proxy ftp-proxy
</pre>
a633 30
<p>puis il faut soit red&eacute;marrer le syst&egrave;me soit envoyer un signal 
  'HUP' &agrave; <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=inetd&sektion=8">inetd(8)</a>. 
  Une des mani&egrave;res d'envoyer le signal 'HUP' est : </p>
<ul><pre>
kill -HUP `cat /var/run/inetd.pid`
</pre></ul>
<p>vous noterez que le ftp-proxy est &agrave; l'&eacute;coute sur le port 8081, 
  le m&ecirc;me port que celui sur lequel la r&egrave;gle rdr envoie le trafic 
  FTP. Le choix du port 8081 est arbitraire, bien qu'il soit judicieux, vu qu'il 
  n'est utilis&eacute; par aucune autre application.</p>
<p><br>
  <a name="nat3.3"></a> <b>Redirection de trafic</b></p>
<p>Pour certaines applications, vous pourriez avoir besoin de rediriger le trafic 
  en entr&eacute;e ou en sortie pour un protocole donn&eacute; vers une machine 
  sp&eacute;cifique derri&egrave;re le syst&egrave;me de filtrage. Un exemple 
  d'un tel besoin serait une machine du r&eacute;seau interne faisant office de 
  serveur web devant &ecirc;tre acc&eacute;d&eacute; par le monde externe (ou 
  bien s&ucirc;r, le ftp-proxy(8) d&eacute;j&agrave; &eacute;voqu&eacute;). Les 
  connexions en entr&eacute;e vers votre adresse IP Internet valide ne pourront 
  s'effectuer, &agrave; moins que votre machine de NAT fasse également serveur 
  web. 
 Pour cel&agrave;, nous utilisons la directive 'rdr' de la NAT dans le fichier de r&egrave;gles 
  pour dire vers o&ugrave; rediriger une connexion particuli&egrave;re.</p>
<p>Pour notre exemple, supposons que le serveur web r&eacute;side sur le LAN avec 
  l'adresse IP 192.168.1.80. Le fichier de r&egrave;gles NAT n&eacute;cessite 
  une nouvelle directive pour g&eacute;rer &ccedil;a. Ajoutez une ligne similaire 
  &agrave; la ligne suivante dans <i>/etc/nat.conf</i> : </p>
<ul><pre>
rdr on fxp0 from any to any port 80 -&gt; 192.168.1.80 port 80
</pre></ul>
d635 3
a637 85
<p> L'explication pour chaque partie de cette ligne suit.</p>
<ul>
  <b>"rdr"</b> 
  <p>Ceci est la commande que vous donnez au syst&egrave;me de NAT. Elle informe 
    le syst&egrave;me de NAT que cette entr&eacute;e est une entr&eacute;e pour 
    rediriger une connexion.</p>
  <p><b>"on fxp0"</b> </p>
  <p>C'est l'interface r&eacute;seau qui est connect&eacute;e &agrave; Internet.</p>
</ul>
<ul>
  <p> <b>"from any to any"</b> </p>
  <p>Ceci indique quelles adresses IP doivent &ecirc;tre redirig&eacute;es (de 
    n'importe quelle adresse en entr&eacute;e sur fxp0, comme indiqu&eacute; pr&eacute;c&eacute;demment, 
    vers n'importe quelle adresse IP destination)</p>
</ul>
<ul>
  <p><b>"port 80"</b> </p>
</ul>
<ul>
  <p>C'est le port en entr&eacute;e (80) qui doit &ecirc;tre redirig&eacute;. 
    Le num&eacute;ro &quot;80&quot; n'est pas n&eacute;cessaire. On peut utiliser 
    aussi &quot;port www&quot; pour sp&eacute;cifier une redirection du port 80. 
    Si vous voulez utiliser un nom au lieu d'un num&eacute;ro, le nom de service 
    et le port correspondant doivent exister dans le fichier <i>/etc/services.</i></p>
</ul>
<ul>
  <b>"192.168.1.80 port 80"</b> 
  <p>L'adresse IP de la machine du LAN vers laquelle les paquets doivent &ecirc;tre 
    redirig&eacute;s. Notez que le port destination n'a PAS besoin de correspondre 
    au port en entr&eacute;e. Par exemple, la ligne suivante et valide, et 
    potentiellement utile : </p>
  <pre>
rdr on fxp0 from any to any port 8080 -&gt; 192.168.1.40 port 80
</pre>
  <p>Cette ligne redirigera le trafic en entr&eacute;e arrivant sur le port 8080 
    vers un serveur web tournant sur une machine du r&eacute;seau interne, sur 
    le port &quot;standard&quot; 80.</p>
  <p></p>
</ul>
<p>Quand la modification est finie, rechargez les r&egrave;gles de NAT, et la 
  redirection prendra effet imm&eacute;diatement. </p>
<p><b>N&eacute;gation</b> </p>
<p>Parfois, vous aurez besoin de faire des exceptions &agrave; une r&egrave;gle 
  de NAT ou de redirection. Voici un exemple. AOL Instant Messenger est connu 
  pour se faufiler furtivement &agrave; travers les firewalls en utilisant n'importe 
  quel port disponible. Vous trouverez peut-&ecirc;tre que le ftp-proxy interf&egrave;re 
  avec AIM quand ce dernier choisit de sortir &agrave; travers le port 21. Dans 
  le cas o&ugrave; vous consid&eacute;rez cela comme mauvais (beaucoup de gens 
  passent beaucoup de temps &agrave; essayer de bloquer AIM !), vous aurez besoin 
  d'exclure les adresses IP utilis&eacute;es par les serveurs AIM du trafic redirig&eacute; 
  par la ligne de redirection vers le ftp-proxy. Vous pouvez faire cela gr&acirc;ce 
  &agrave; la ligne suivante :
<ul><pre>
rdr on tl0 from any to ! 64.12.163.199 port 21 -&gt; 127.0.0.1 port 8081
</pre></ul>
Interpr&eacute;tation: Redirige le trafic en entr&eacute;e sur l'interface tl0 
&agrave; destination du port 21 et sauf vers 64.12.163.199 (le serveur AIM avec 
lequel les utilisateurs avaient des probl&egrave;mes) au port 8081 du h&ocirc;te 
local (sur lequel normalement ftp-proxy &eacute;coute). Maintenant, il faut &ecirc;tre 
conscient qu'il y a plusieurs serveurs AIM, et si cette application vous int&eacute;resse, 
vous aurez probablement &agrave; manipuler les adresses des serveurs AIM (64.12.0.0/16 
est potentiellement plus judicieux bien qu'il y aura probabflement des interf&eacute;rences 
avec des serveurs n'appartenant pas &agrave; AOL). 
<p></p>

<br>
<a name="nat3.4"></a> <b>NAT contre Proxy</b> 
<p>La diff&eacute;rence entre la NAT et un proxy applicatif r&eacute;side dans 
  le fait qu'un proxy agit comme un interm&eacute;diaire entre Internet et les 
  machines connect&eacute;es au LAN. C'est tr&egrave;s bien, cependant chaque 
  application que vous voudrez ex&eacute;cuter sur votre machine et qui devra 
  se connecter &agrave; Internet &agrave; travers le serveur proxy DEVRA savoir 
  comment utiliser un proxy. Toutes les applications ne savent pas faire &ccedil;a 
  (et sp&eacute;cialement les jeux). De plus, il n'y a pas des proxies applicatifs 
  pour tous les services Internet actuels. La NAT fait correspondre de mani&egrave;re 
  transparente votre r&eacute;seau interne &agrave; une adresse donn&eacute;e 
  pour qu'il puisse se connecter &agrave; Internet. Le seul avantage en termes 
  de s&eacute;curit&eacute; &agrave; utiliser un proxy par rapport &agrave; la 
  NAT est que le proxy peut poss&eacute;der des fonctionnalit&eacute;s de s&eacute;curit&eacute;, 
  et peut filtrer le trafic d'apr&egrave;s le contenu, pour prot&eacute;ger votre 
  machine Windows contre un virus macro, ou pour prot&eacute;ger votre logiciel 
  client contre les d&eacute;bordements de tampon...etc. La maintenance 
  de ce type de filtres est souvent lourde.</p>
<p>&nbsp;</p>
<p><a name="nat4.0"></a> <b>6.3.4 Liens et r&eacute;f&eacute;rences crois&eacute;es</b></p>
a638 1
<p> Fichiers OpenBSD : 
d640 4
a643 5
  <li>/etc/nat.conf - fichier de r&egrave;gles NAT
  <li>/etc/rc.conf - doit &ecirc;tre &eacute;dit&eacute; pour lancer la NAT et 
    PF au d&eacute;marrage 
  <li>etc/sysctl.conf - doit &ecirc;tre &eacute;dit&eacute; pour activer le routage 
    IP
a644 1
<p></p>
a645 8
<p> Liens Internet &agrave; propos de la NAT : 
<ul>
  <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=nat.conf&sektion=5">page 
    du manuel nat.conf</a>
  <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&sektion=8">page 
    du manuel pfctl</a>
  <li><a href="http://www.geektools.com/rfc/rfc1631.txt">http://www.geektools.com/rfc/rfc1631.txt</a>
</ul>
d647 8
d656 3
a658 1
<br>
d660 3
a662 41
<p> 
<a name= "DHCP"></a>
<a name= "6.4"></a> 
<h2>6.4 - Protocole de Configuration Dynamique d'H&ocirc;te
    (DHCP)</h2>
<p></p>

<h3>6.4.1 Client DHCP</h3>
<p>Pour utiliser le client DHCP <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dhclient&sektion=8">dhclient(8)</a> 
  inclus avec OpenBSD, &eacute;ditez /etc/hostname.xl0 (ceci suppose que votre 
  interface ethernet principale est xl0. La votre pourrait &ecirc;tre ep0 
  ou fxp0 ou quelque chose d'autre !) et tout ce que vous avez besoin d'y mettre 
  est le mot-cl&eacute; 'dhcp' 
<pre>
# <strong>echo dhcp &gt;/etc/hostname.xl0</strong>
</pre>
<p>Ceci fera en sorte que le client DHCP d&eacute;marre automatiquement au d&eacute;marrage. 
  OpenBSD va r&eacute;cup&eacute;rer son adresse IP, sa passerelle par d&eacute;faut, 
  et les serveurs DNS &agrave; partir du serveur DHCP.</p>
<p>Si vous voulez d&eacute;marrer le client dhcp &agrave; partir de la ligne de 
  commande, assurez vous que le fichier /etc/dhclient.conf existe puis essayez : </p>
<PRE>
# <strong>dhclient fxp0</strong>
</pre>
<p>o&ugrave; fxp0 est l'interface sur laquelle vous voulez recevoir les informations 
  par dhcp.</p>
<p>Peu importe comment vous d&eacute;marrez dhclient, vous pouvez &eacute;diter 
  le fichier /etc/dhclient.conf pour ne pas mettre &agrave; jour les informations 
  DNS d'apr&egrave;s les informations fournies par le serveur dhcp en d&eacute;commentant 
  d'abord les lignes 'request' (ce sont des exemples de param&eacute;trages par 
  d&eacute;faut, mais vous devez les d&eacute;commenter pour privil&eacute;gier 
  vos param&egrave;tres par rapport aux param&egrave;tres par d&eacute;faut de 
  dhclient). </p>
<pre>
request subnet-mask, broadcast-address, time-offset, routers,
      domain-name, domain-name-servers, host-name, lpr-servers, ntp-servers;
</pre>
<p>puis <b>supprimer</b> domain-name-servers. Bien &eacute;videmment, vous pourriez 
  supprimer le hostname, ou d'autres param&egrave;tres aussi.</p>
<P>
<h3>6.4.2 Serveur DHCP</h3>
d664 2
a665 11
<p>Si vous voulez utiliser OpenBSD comme serveur DHCP <a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=dhcpd&sektion=8">dhcpd(8)</a>
,   &eacute;ditez /etc/rc.conf. Modifiez ce fichier de telle fa&ccedil;on
&agrave;   ce qu'il contienne dhcpd_flags="-q" au lieu de dhcpd_flags=NO. Mettez
les interfaces   sur lesquelles vous voulez que dhcpd <b>&eacute;coute</b> dans
/etc/dhcpd.interfaces.</p> 
<pre> # <strong>echo xl1 xl2 xl3 &gt;/etc/dhcpd.interfaces</strong> </pre>
<p>Puis &eacute;ditez /etc/dhcpd.conf. Les options sont plut&ocirc;t explicites.</p>
<pre>
        option  domain-name "xyz.mil";
        option  domain-name-servers 192.168.1.3, 192.168.1.5;
d667 10
a676 54
        subnet 192.168.1.0 netmask 255.255.255.0 {
                option routers 192.168.1.1;

                range 192.168.1.32 192.168.1.127;
        }
</pre>
<p> Ceci indiquera à vos clients dhcp de rajouter le domaine xyz.mil aux requ&ecirc;tes 
  DNS (ainsi, si l'utilisateur saisit la commande 'telnet joe' alors il sera dirigé 
  vers joe.xyz.mil). De plus, les clients dhcp seront dirigés vers les serveurs 
  DNS 192.168.1.3 et 192.168.1.5. Pour les h&ocirc;tes se trouvant sur le m&ecirc;me 
  r&eacute;seau qu'une interface ethernet de la machine OpenBSD, qui est dans 
  la plage d'adresses 192.168.1.0/24, une adresse IP entre 192.168.1.32 et 192.168.1.127 
  leur sera affect&eacute;e. </p>
<p>Si voulez d&eacute;marrer dhcpd à partir de la ligne de commande, apr&egrave;s 
  avoir &eacute;dit&eacute; /etc/dhcpd.conf, essayez : 
<PRE>
# <strong>dhcpd -q fxp0</strong> </PRE>
o&ugrave; fxp0 est une interface sur laquelle vous voulez que le serveur dhcp 
r&eacute;ponde aux requ&ecirc;tes. Le drapeau -q rend dhcpd silencieux, autrement 
il est tr&egrave;s bavard. 
<P> Si vous fournissez un service DHCP &agrave; une machine Windows, vous voudriez 
  peut-&ecirc;tre que dhcpd donne une adresse d'un serveur 'WINS' au client. Pour 
  cela, rajoutez la ligne suivante dans /etc/dhcpd.conf :
<pre> option netbios-name-servers
192.168.92.55; </pre>
(o&ugrave; 192.168.92.55 est l'adresse IP du serveur Windows ou Samba.) Voir <a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=dhcp-options&sektion=5">dhcp- 
options(5)</a> pour d'autres options dont pourraient avoir besoin vos clients 
DHCP. 
<p> <a name= "PPP"></a> <a
name= "6.5"></a> 
<h2>6.5 - Protocole Point &agrave; Point</h2>
<p>Le Protocole Point &agrave; Point (PPP) est le protocole g&eacute;n&eacute;ralement 
  utilis&eacute; pour cr&eacute;er une connexion &agrave; votre FAI via votre 
  modem. OpenBSD a deux mani&egrave;res de faire ceci.</p>

<ul>
  <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pppd&sektion=8">pppd(8)</a> 
    - Qui est le d&eacute;mon ppp du noyau.
  <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ppp&sektion=8">ppp(8)</a> 
    - Qui est le d&eacute;mon ppp en mode utilisateur. 
</ul>

<p>Le premier que nous allons couvrir est le d&eacute;mon ppp en mode
  utilisateur. Pour commencer, vous aurez besoin de quelques informations 
  simples 
  &agrave; propos de votre FAI. Voici une liste des informations utiles dont 
  vous aurez besoin : </p>
<ul>
  <li>Le num&eacute;ro d'appel de votre FAI
  <li>Votre serveur de noms 
  <li>Votre nom d'utilisateur et votre mot de passe
  <li>Votre passerelle
</ul>
d678 1
a678 26
<p>Quelques unes de ces informations sont optionnelles, mais sont utiles lors 
  de la configuration de votre ppp. Le d&eacute;mon ppp en mode
  utilisateur utilise le fichier <a href="http://www.openbsd.org/cgi-bin/cvsweb/src/etc/ppp/ppp.conf.sample">/etc/ppp/ppp.conf</a> 
  comme fichier de configuration. Il y a beaucoup de fichiers utiles dans <b>/etc/ppp 
  </b> contenant des configurations diverses et vari&eacute;es pour plusieurs 
  types de situations. Vous devriez naviguer dans ce r&eacute;pertoire.</p>
<p>Vous devrez aussi vous assurez, si vous n'utilisez pas le noyau GENERIC, que 
  vous avez la ligne suivante dans votre fichier de configuration du noyau : </p>

<ul><pre><strong>
pseudo-device   tun             2
</strong></pre></ul>


<h3>Mise en place initiale - pour PPP(8)</h3>
<p>La mise en place initiale pour le d&eacute;mon PPP en mode utilisateur 
  consiste &agrave; &eacute;diter le fichier <b>/etc/ppp/ppp.conf</b>. Ce fichier 
  n'existe pas par d&eacute;faut, mais il y a un fichier <b>/etc/ppp/ppp.conf.sample</b> 
  que vous pouvez &eacute;diter pour cr&eacute;er votre propre fichier <b>/etc/ppp/ppp.conf</b>. 
  Je vais commencer ici par la configuration la plus simpliste et probablement 
  la plus utilis&eacute;e. Voici un fichier <b>ppp.conf</b> qui va cr&eacute;er 
  une connexion vers votre FAI et configurer votre route par d&eacute;faut et 
  votre serveur de noms. Avec ce fichier, les seules informations dont vous 
  aurez besoin sont votre num&eacute;ro de t&eacute;l&eacute;phone FAI, votre 
  nom d'utilisateur et votre mot de passe. </p>
<ul>
d686 1
a686 21
</ul>

<p>La section en dessous de la balise <b>default:</b> sera ex&eacute;cut&eacute;e 
  &agrave; chaque fois. Ici, nous param&eacute;trons toutes nos informations critiques. 
  Avec &quot;set log&quot;, nous param&eacute;trons nos niveaux de journalisation. 
  Ceci peut &ecirc;tre modifi&eacute;, r&eacute;f&eacute;rez vous &agrave; <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ppp&sektion=8">ppp(8)</a> 
  pour plus d'informations concernant le param&eacute;trage des niveaux de logs. 
  Notre p&eacute;riph&eacute;rique est configur&eacute; avec &quot;set device&quot;. 
  C'est le port sur lequel le modem est connect&eacute;. Dans cet exemple, le 
  modem est sur le port s&eacute;rie 2. Le port s&eacute;rie 1 est donc /dev/cua00. 
  Avec &quot;set speed&quot;, nous param&eacute;trons la vitesse de notre connexion 
  modem et avec &quot;set dial&quot; nous configurons nos param&egrave;tres d'appel. 
  Nous pouvons aussi param&eacute;trer une p&eacute;riode d'inactivit&eacute; 
  au bout de laquelle nous serons d&eacute;connect&eacute;s, etc. Cependant, cette 
  ligne devrait rester pratiquement telle quelle.</p>
<p> Maintenant, nous pouvons avancer et param&eacute;trer les informations sp&eacute;cifiques 
  &agrave; notre FAI. Nous faisons ceci en ajoutant une nouvelle balise en dessous 
  de la section <b>default:</b>. Cette balise peut prendre n'importe quel nom, 
  le plus facile &eacute;tant le nom de votre FAI. Ici j'utiliserais <b>monfai:</b> 
  comme balise faisant r&eacute;f&eacute;rence &agrave; notre FAI. Voici une configuration 
  simple qui inclus tout le n&eacute;cessaire pour nous connecter : </p>
d689 25
d715 1
a715 1
<ul>
d717 2
a718 2
monfai:
set phone 1234567   
d725 13
a737 1
</ul>
d739 1
a739 13
<p>Ici, nous avons configur&eacute; l'information essentielle pour ce FAI. La premi&egrave;re 
  option &quot;set phone&quot; param&egrave;tre le num&eacute;ro d'appel de votre 
  FAI. &quot;set login&quot; configure nos options d'authentification. La minuterie 
  de connexion est positionn&eacute;e &agrave; 5. Ceci veut dire que nous allons 
  abandonner notre tentative de connexion apr&egrave;s 5 secondes s'il n'y a pas 
  de porteuse. Autrement, l'application attendra de recevoir un &quot;login:&quot; 
  et r&eacute;pondra par votre nom d'utilisateur et votre mot de passe. Dans cet 
  exemple, notre nom d'utilisateur = ppp et notre mot de passe = ppp. Ces valeurs 
  devront &ecirc;tre modifi&eacute;es. La ligne &quot;set timeout&quot; positionne 
  la p&eacute;riode d'inactivit&eacute; pour la dur&eacute;e de la connexion &agrave; 
  120 secondes. La ligne &quot;set ifaddr&quot; est un peu difficile &agrave; 
  comprendre. Voici une explication plus d&eacute;taill&eacute;e. </p>
<ul><pre>
d741 37
a777 1
</pre></ul>
a778 35
<p>Dans la ligne pr&eacute;c&eacute;dente, nous avons adopt&eacute; le format 
  &quot;<b>set ifaddr [myaddr[/nn] [hisaddr[/nn] [netmask [triggeraddr]]]]</b>&quot;. 
  La premi&egrave;re adresse IP sp&eacute;cifi&eacute;e est l'adresse IP que nous 
  voulons. Si vous avez une adresse IP statique, vous la fixez ici. Dans notre 
  exemple nous utilisons /0 qui dit qu'aucun des octets de cette adresse IP ne 
  doit correspondre &agrave; son &eacute;quivalent dans l'adresse IP choisie, 
  donc toute l'adresse IP peut &ecirc;tre remplac&eacute;e. La seconde adresse 
  IP sp&eacute;cifi&eacute;e est ce &agrave; quoi nous nous attendons comme
  adresse IP de leur part. Si vous la connaissez, vous pouvez la 
  sp&eacute;cifier. Encore 
  une fois, dans notre ligne nous ne savons pas ce qui sera attribu&eacute;, alors 
  nous les laissons nous le dire. La troisi&egrave;me option est notre masque 
  de sous-r&eacute;seau, ici positionn&eacute; &agrave; 255.255.255.0. Si triggeraddr 
  est sp&eacute;cifi&eacute;, il est utilis&eacute; au lieu de myaddr dans la 
  n&eacute;gociation 
  IPCP initiale. Cependant, seulement une adresse dans la plage de myaddr sera 
  accept&eacute;e. C'est utile lors de la n&eacute;gociations avec quelques 
  impl&eacute;mentations 
  PPP qui n'attribueront aucune adresse IP &agrave; moins que l'autre partie demande 
  &quot;0.0.0.0&quot;. </p>
<p>L'autre option utilis&eacute;e est &quot;add default HISADDR&quot;. Celle-ci 
  configure notre route par d&eacute;faut pour pointer sur leur adresse IP. 
  Cette option est 'persistante', dans le sens o&ugrave; si leur adresse IP 
  change, notre route sera automatiquement 
  mise &agrave; jour. Avec &quot;enable dns&quot;, nous disons &agrave; notre 
  FAI d'authentifier nos adresses de serveur de noms. NE faites pas &ccedil;a 
  si vous avez un DNS local, vu que ppp va simplement le contourner en mettant 
  quelques lignes 'nameserver' dans /etc/resolv.conf.</p>

<h3>Utilisation de PPP(8)</h3>

<p>Maintenant que nous avons configur&eacute; notre fichier <b>ppp.conf</b>,
nous pouvons commencer &agrave; essayer de se connecter &agrave; notre FAI. Je 
vais d&eacute;tailler quelques arguments commun&eacute;ment utilis&eacute;s 
avec ppp. </p>
d780 5
a784 5
  <li><b>ppp -auto myisp</b> - Ceci va ex&eacute;cuter ppp, configurer vos interfaces 
    et vous connecter &agrave; votre FAI puis mettra le programme en arri&egrave;re 
    plan. 
  <li><b>ppp -ddial myisp</b> - Ceci est similaire &agrave; -auto, mais si votre 
    connexion tombe, ppp tentera de vous reconnecter.
d786 15
a800 10
<p>En utilisant <b>/usr/sbin/ppp</b> sans options, vous serez en mode interactif. 
  A partir de l&agrave;, vous pouvez interagir directement avec votre modem, ce 
  qui est tr&egrave;s bien pour d&eacute;boguer votre fichier <b>ppp.conf</b>. 
</p>
<h3>extras ppp(8) </h3>
<p>Dans certaines situations, vous voudriez ex&eacute;cuter des commandes lorsque 
  votre connexion est &eacute;tablie ou rompue. Il y a deux fichiers que vous 
  pouvez cr&eacute;er pour ce genre de situations : <b>/etc/ppp/ppp.linkup</b> 
  et <b>/etc/ppp/ppp.linkdown</b>. Des configurations typiques peuvent &ecirc;tre 
  consult&eacute;es ici : </p>
d806 26
a831 16
<p>Vous pourrez trouver de plus amples informations dans <a href="http://www.freebsd.org/doc/en_US.ISO8859-1/books/handbook/userppp.html">la 
  section User PPP du guide FreeBSD</a>. </p>
<p>&nbsp;</p>

<p>
<a name= "Tuning"></a>
<a name= "6.6"></a>
<h2>6.6 - Optimisation des param&egrave;tres r&eacute;seau</h2>

<H3>6.6.1 - Comment puis-je param&eacute;trer mon noyau pour avoir un nombre plus 
  important de tentatives et des timeouts plus longs sur les sessions TCP ?</h3>
<p>Vous utiliseriez normalement ceci pour r&eacute;gler des probl&egrave;mes de 
  routage ou de connexion. Bien &eacute;videmment, pour un maximum d'efficacit&eacute;, 
  les deux c&ocirc;t&eacute;s de la connexion doivent utiliser des valeurs similaires.</p>
<p>Pour param&eacute;trer cela, utilisez <tt>sysctl</tt> et augmentez les 
  valeurs de : </p>
a836 21
<p>En utilisant sysctl -a, vous pouvez voir la valeur actuelle de ces param&egrave;tres 
  et celle d'autres param&egrave;tres. Pour modifier une valeur, utilisez <tt>sysctl 
  -w</tt>, comme dans <tt>sysctl -w net.inet.tcp.keepidle=28800</tt>. </p>
<h3>6.6.2 - Comment puis-je activer les broadcasts dirigés ? </h3>
<p>Normalement, vous ne devrez pas faire &ccedil;a. Ceci autorise quelqu'un &agrave; 
  envoyer du trafic vers des adresses broadcast de votre/vos r&eacute;seau(x) 
  connect&eacute;s si vous utilisez OpenBSD comme routeur.</p>
Il y a quelques cas, dans des r&eacute;seaux ferm&eacute;s, o&ugrave; &ccedil;a 
pourrait &ecirc;tre utile, particuli&egrave;rement quand vous utilisez d'anciennes 
impl&eacute;mentations du protocole NetBIOS. L'activation se fait par sysctl : 
<tt>sysctl -w net.inet.ip.directed-broadcast=1</tt>. Documentez vous sur les <a href="http://www.netscan.org">attaques 
smurf </a> si vous voulez savoir pourquoi cette option est désactivée par défaut. 
<H3>6.6.3 - Je ne souhaite pas que mon noyau alloue dynamiquement un port donn&eacute;</h3>
<p>Il y a aussi un sysctl pour cela. Traduction d'une partie de <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&sektion=8">sysctl(8)</a> : </p>
<PRE>
Param&eacute;tre la liste des ports TCP r&eacute;serv&eacute;s qui ne 
doivent pas &ecirc;tre allou&eacute;s dynamiquement par le noyau. 
Ceci peut être utilisé pour empêcher les démons de prendre 
un port spécifié qu'un autre programme utilise pour 
son fonctionnement. Les éléments de la liste peuvent être
séparés par des virgules et/ou des espaces.
d838 4
a841 1
   sysctl -w net.inet.tcp.baddynamic=749,750,751,760,761,871
d843 34
a876 2
Il est aussi possible d'ajouter ou de supprimer des ports 
de la liste courante. 
d878 7
a884 2
   sysctl -w net.inet.tcp.baddynamic=+748
   sysctl -w net.inet.tcp.baddynamic=-871
d888 1
a888 1
<a name= "NFS"></a>
a890 12
<p></p>
<p></p>
<p></p>
<p></p>
<p>NFS, ou Network File System, est utilis&eacute; pour partager un syst&egrave;me 
  de fichiers &agrave; travers le r&eacute;seau. Les quelques pages de manuel 
  &agrave; lire avant d'essayer de configurer NFS sont : </p>
<ul>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=nfsd&sektion=8">nfsd(8)</a>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mountd&sektion=8">mountd(8)</a>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=exports&sektion=5">exports(5)</a>
</ul>
d892 63
a954 28
<p>Cette section va vous guider &agrave; travers les &eacute;tapes n&eacute;cessaires 
  pour configurer NFS de mani&egrave;re simple. Cet exemple concerne un serveur 
  sur un LAN, avec des clients acc&eacute;dant &agrave; NFS sur le LAN. Nous n'allons 
  pas aborder la s&eacute;curisation de NFS. Nous supposerons que vous avez 
  d&eacute;j&agrave; configur&eacute; le filtrage de paquets ou une autre protection 
  de type pare-feu, pour vous pr&eacute;munir contre les acc&egrave;s externes. 
  Si vous autorisez les r&eacute;seaux externes &agrave; acc&eacute;der &agrave; 
  votre serveur NFS, et vous avez des informations sensibles stock&eacute;es dessus, 
  nous vous recommandons fortement d'utiliser <a href="../faq13.html">IPsec</a>. 
  Autrement, n'importe qui pourra potentiellement voir votre trafic NFS. Quelqu'un 
  pourrait aussi pr&eacute;tendre avoir l'adresse IP que vous autorisez &agrave; 
  acc&eacute;der &agrave; votre serveur NFS. Il y a plusieurs attaques qui peuvent 
  r&eacute;sulter. Proprement param&eacute;tr&eacute;, IPsec peut prot&eacute;ger 
  contre ce type d'attaques. 
<p>Une autre consigne de s&eacute;curit&eacute; importante. N'ajoutez pas simplement 
  un syst&egrave;me de fichiers sur /etc/exports sans aucune liste de h&ocirc;te(s) 
  autoris&eacute;(s). Sans liste d'h&ocirc;tes autoris&eacute;s &agrave; monter 
  un r&eacute;pertoire particulier, n'importe qui peut atteindre votre serveur 
  NFS sera capable de monter des exports NFS. 
<P> La configuration consiste en un serveur avec l'adresse IP <b>10.0.0.1</b>. 
  Ce serveur servira NFS uniquement pour les clients dans ce r&eacute;seau. La 
  premi&egrave;re &eacute;tape de la configuration consiste &agrave; configurer 
  votre fichier <i>/etc/exports</i>. Ce fichier liste quel(s) syst&egrave;me(s) 
  de fichiers vous souhaitez rendre accessible(s) via NFS et d&eacute;finit quel(s) 
  h&ocirc;te(s) est/sont autoris&eacute;(s) &agrave; y acc&eacute;der. Il y a 
  plusieurs options que vous pouvez utiliser dans votre fichier <i>/etc/exports</i>, 
  et il serait fort souhaitable que vous lisiez la page de manuel <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=exports&sektion=5">exports(5)</a>. 
  Pour cet exemple, voici &agrave; quoi ressemble le fichier <i>/etc/exports</i>:</p>
d956 1
a956 1
<ul><pre>
d962 1
a962 1
</pre></ul>
d964 24
a987 23
<p>Cela veut dire que le syst&egrave;me de fichiers local <b>/work</b> sera partag&eacute; 
  via NFS. <b>-alldirs</b> sp&eacute;cifie que les clients seront capables de 
  monter n'importe quel point en dessous du point de montage <b>/work</b>. <b>-ro</b> 
  sp&eacute;cifie que l'acc&egrave;s se fait uniquement en lecture seule (read 
  only). Les deux derniers arguments sp&eacute;cifient que seulement les clients 
  appartenant au r&eacute;seau 10.0.0.0 et utilisant un masque de sous-r&eacute;seau 
  de 255.255.255.0 seront autoris&eacute;s &agrave; monter ce syst&egrave;me de 
  fichiers. Ceci est important pour des serveurs accessibles &agrave; partir de 
  r&eacute;seaux diff&eacute;rents.</p>
<p>Une fois votre fichier <i>/etc/exports </i>configur&eacute;, vous pouvez mettre 
  en place votre serveur NFS. Tout d'abord, vous devriez vous assurer que les 
  options NFSSERVER et NFSCLIENT figurent dans votre configuration du noyau. (Le 
  noyau GENERIC inclut ces options). Ensuite, vous devrez positionner <strong>nfs_server=YES</strong> 
  dans <i>/etc/rc.conf</i>. Ceci lancera nfsd(8) et mountd(8) au red&eacute;marrage. 
  Vous pouvez d&eacute;marrer les d&eacute;mons vous-m&ecirc;me. Ces d&eacute;mons 
  doivent &ecirc;tre d&eacute;marr&eacute;s en tant que root, et vous devez vous 
  assurer que portmap(8) tourne sur votre syst&egrave;me. Voici un exemple de 
  d&eacute;marrage de nfsd(8) qui fera office de serveur sur TCP et UDP en utilisant 
  4 d&eacute;mons. Vous devriez param&eacute;trer un nombre appropri&eacute; de 
  d&eacute;mons NFS pour prendre en charge le nombre maximal de requ&ecirc;tes 
  simultan&eacute;es auxquelles vous voulez que votre serveur r&eacute;ponde.</p>

<P>
d989 1
a989 1
<ul><pre>
d991 1
a991 1
</pre></ul>
a992 3
<p>Vous devrez aussi lancer mountd(8). C'est le d&eacute;mon qui r&eacute;pond 
  r&eacute;ellement aux requ&ecirc;tes de montage NFS. Pour d&eacute;marrer mountd(8), 
  assurez vous qu'un fichier mounttab vide existe, et ex&eacute;cutez le d&eacute;mon : 
d994 4
d999 1
a999 1
<ul><pre>
d1002 1
a1002 1
</pre></ul>
d1004 5
a1008 3
<P>Si vous effectuez des changements dans /etc/exports alors que NFS est en marche, 
  vous devez en pr&eacute;venir mountd &agrave; l'aide d'un signal HUP: 
<UL><PRE>
d1010 1
a1010 1
</pre></ul>
d1012 2
a1013 3
<P>

<h3>V&eacute;rification de l'&eacute;tat NFS</h3>
a1014 3
<p>A partir de l&agrave;, vous pouvez v&eacute;rifier que tous ces d&eacute;mons 
  sont actifs et sont enregistr&eacute;s aupr&egrave;s du sous-système RPC. 
  Pour cela, utilisez rpcinfo(8).
d1016 3
d1020 1
a1020 1
<ul><pre>
d1033 1
a1033 1
</pre></ul>
d1035 7
a1041 7
<p>Durant une utilisation normale, il y a quelques autres utilitaires qui vous 
  permettent de voir ce qui se passe au niveau NFS. Un de ces derniers est <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=showmount&sektion=8">showmount(8)</a> 
  , qui vous autorise &agrave; voir quels r&eacute;pertoires sont mont&eacute;s 
  et quels clients les monte. Il y a aussi nfsstat(8) qui donne des statistiques 
  beaucoup plus verbeuses. Pour utiliser showmount(8), essayez <b>/usr/bin/showmount 
  -a host</b>. Par exemple : 
<P>
d1043 1
a1043 1
<ul><pre>
d1047 1
a1047 1
</pre></ul>
d1049 2
a1050 1
<h3>Montage de syst&egrave;mes de fichiers NFS </h3>
a1051 5
<p>Les syst&egrave;mes de fichiers doivent &ecirc;tre mont&eacute;s &agrave; l'aide 
  de la commande mount(8), ou plus sp&eacute;cifiquement, <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mount_nfs&sektion=8">mount_nfs(8)</a>. 
  Pour monter un syst&egrave;me de fichiers /work du h&ocirc;te 10.0.0.1 sur le 
  syst&egrave;me de fichiers local /mnt, faites (notez que vous n'avez pas besoin 
  d'utiliser une adresse IP, mount r&eacute;sout les noms d'h&ocirc;te) : 
d1053 7
d1061 1
a1061 1
<ul><pre>
d1063 1
a1063 1
</pre></ul>
a1064 2
<p>Pour monter ce syst&egrave;me de fichiers au d&eacute;marrage, ajoutez la ligne 
  suivante &agrave; /<i>etc/fstab</i> : 
d1066 2
d1069 1
a1069 1
<ul><pre>
d1071 1
a1071 1
</pre></ul>
a1072 5
<p>Il est important d'utiliser <tt>0 0</tt> &agrave; la fin de cette ligne pour 
  que votre machine n'essaye pas d'effectuer un fsck sur le syst&egrave;me de 
  fichiers NFS au d&eacute;marrage !!! Les autres options de s&eacute;curit&eacute; 
  standard comme noexec, nodev, et nosuid devraient &ecirc;tre utilis&eacute;es 
  l&agrave; o&ugrave; elles s'appliquent. Par exemple :
d1074 4
d1079 1
a1079 1
<ul><pre>
d1081 7
a1087 1
</pre></ul>
a1088 4
<p>De cette mani&egrave;re, aucun p&eacute;riph&eacute;rique ou programme suid 
  sur le serveur NFS ne pourront contourner les mesures de s&eacute;curit&eacute; 
  sur le client NFS. Si vous ne montez pas des applications que vous devez ex&eacute;cuter 
  en tant que client NFS, rajoutez noexec &agrave; cette liste.
d1090 1
a1090 1
<a name= "DNS"></a>
d1092 1
a1092 2
<h2>6.8 - Service de Noms - DNS, BIND, et named</h2>
<p></p>
d1094 5
a1098 1
<h3>6.8.1 Qu'est ce que le DNS ? </h3>
d1100 33
a1132 12
<p>Domain Name Service est un service r&eacute;seau qui permet &agrave; des domaines 
  de r&eacute;seaux IP de fournir des services de r&eacute;solution nom vers IP 
  et IP vers nom en r&eacute;ponse &agrave; une requ&ecirc;te. Votre installation 
  OpenBSD est configur&eacute;e par d&eacute;faut comme client DNS mais pas comme 
  serveur DNS. En clair, votre installation OpenBSD peut effectuer des requ&ecirc;tes 
  DNS &agrave; destination d'un serveur de noms pour l'adresse d'une machine, 
  mais elle ne peut pas r&eacute;pondre &agrave; des requ&ecirc;tes DNS par
  elle-m&ecirc;me, 
  &agrave; moins que vous ne la configuriez pour qu'elle le fasse.</p>
<p>Ma machine OpenBSD est actuellement connect&eacute;e &agrave; Internet via 
  mon FAI, alors je peux utiliser l'utilitaire <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=nslookup&sektion=8">nslookup(8)</a> 
  pour effectuer des requ&ecirc;tes DNS : </p>
d1134 1
a1134 1
<ul><pre>
d1142 1
a1142 1
</pre></ul>
d1144 10
a1153 11
<p><b>165.87.201.24</b> est le serveur de noms qui a r&eacute;pondu, parce que 
  c'est le serveur de noms que mon FAI m'a demand&eacute; d'utiliser avec mon 
  compte et dont l'adresse a &eacute;t&eacute; entr&eacute;e dans <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=resolv.conf&sektion=5">/etc/resolv.conf</a>. 
  Mais la r&eacute;ponse ne fait pas autorit&eacute;. Pour une r&eacute;ponse 
  qui fait autorit&eacute;, il nous faut trouver le serveur responsable du domaine 
  <i>openbsd.org</i> et lui demander l'adresse de <i>www.openbsd.org</i> : </p>
<p>&nbsp;</p>

<ul><pre>
# Identify the name servers for openbsd.org
# with the help of my ISP's name server.
d1172 2
a1173 2
# Use the info gained to query for an authoritative
# resolution: query the authoritative zeus.theos.com.
d1180 1
a1180 1
</pre></ul>
d1182 3
a1184 3
<p><i>zeus.theos.com</i>, comme vous vous en doutez, est sous OpenBSD et il est 
  correctement configur&eacute; pour &ecirc;tre serveur DNS du domaine <i>openbsd.org</i>.</p>
<p><a name="DNS.1.1"></a> <a name="6.8.1.1"></a> </p>
d1186 4
a1189 2
<h3>6.8.1.1 O&ugrave; puis-je en apprendre plus sur le DNS et son impl&eacute;mentation 
  sous OpenBSD ?</h3>
d1191 16
a1206 22
  <li>Consultez les RFCs <a href="http://www.faqs.org/rfcs/rfc1033.html">1033</a>, 
    <a href="http://www.faqs.org/rfcs/rfc1034.html">1034</a>, et <a href="http://www.faqs.org/rfcs/rfc1035.html">1035</a> 
    pour plus d'informations sur le syst&egrave;me de noms de domaines Internet</li>
  <li>Lisez le livre <i><a href="../../books.html#6">DNS and BIND</a> </i> de O'Reilly 
    Associates.</li>
  <li>Lisez le <a href="http://www.openbsd.org/cgi-bin/man.cgi">Manuel OpenBSD</a> 
    et sp&eacute;cialement les pages suivantes : 
    <ul>
      <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dig&sektion=1">dig(1)</a> 
      </li>
      <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=nslookup&sektion=8">nslookup(8)</a> 
      </li>
      <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=gethostbyname&sektion=3">gethostbyname(3)</a> 
      </li>
      <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=named&sektion=8">named(8)</a> 
      </li>
      <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=resolver&sektion=3">resolver(3)</a> 
      </li>
      <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=resolver&sektion=5">resolver(5)</a> 
      </li>
    </ul>
  </li>
a1207 20
La commande <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dig&sektion=1">dig(1)</a> 
est particuli&egrave;rement utile, parce qu'elle peut envoyer une requ&ecirc;te 
&agrave; un domaine et afficher l'information dans pratiquement le m&ecirc;me 
format que celui requis pour les fichiers de configuration BIND. Vous pouvez utiliser 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dig&sektion=1">dig(1)</a> 
pour analyser la configuration de serveurs de noms qui, selon vous, sont correctement 
configur&eacute;s afin de comparer votre configuration &agrave; la leur. 
<h3>6.8.2 Est-ce que ma machine &agrave; besoin d'&ecirc;tre un serveur de noms 
  ?</h3>

<p>Si vous n'&ecirc;tes pas s&ucirc;r que vous ayez besoin que votre machine soit 
  un serveur DNS, alors ne la configurez pas pour en &ecirc;tre un. L'installation 
  OpenBSD n'active pas, par d&eacute;faut, le serveur de noms de domaine sur votre 
  machine, malgr&eacute; que tous les fichiers n&eacute;cessaires soient install&eacute;s. 
  Pour la plupart des stations de travail, il suffit d'avoir le fichier <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hosts&sektion=5">/etc/hosts</a> 
  qui fait la correspondance ip-nom pour les machines locales et le fichier <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=resolv.conf&sektion=5">/etc/resolv.conf</a> 
  pour indiquer quels sont les serveurs DNS que vous devez utiliser pour r&eacute;soudre 
  le nom de machines sur intranet ou internet.</p>
<p>D'un autre c&ocirc;t&eacute;, vous pourriez avoir besoin de configurer votre 
  machine en tant que serveur de noms : </p>
d1209 24
d1234 14
a1247 24
  <li>Si vous avez un LAN IP sur lequel vous ne souhaitez pas r&eacute;pliquer 
    les fichiers &quot;hosts&quot; des adresses locales sur chacune des machines. 
    Dans ce cas, vous pouvez configurer votre machine OpenBSD en serveur DNS et 
    r&eacute;pondre aux requ&ecirc;tes des autres machines sur votre LAN. 
    <ul>
      <li><b>Remarque : </b>Il n'y a aucune restriction pratique au nombre de serveurs 
        DNS sur un LAN. N'importe quelle machine ou toutes les machines peuvent 
        offrir un service DNS si elles sont configur&eacute;es pour le faire. 
        Le fait qu'un de ces serveurs fasse autorit&eacute; ou pas en dehors de 
        votre LAN (ou s'il est tout simplement connu en dehors de votre LAN) est 
        un facteur de configuration qui est typiquement contr&ocirc;l&eacute; 
        &agrave; un cran plus haut dans la hi&eacute;rarchie des domaines.</li>
    </ul>
  </li>
  <li>Si vous avez un LAN IP sur lequel r&eacute;sident des machines 
  identifiables via une requ&ecirc;te DNS par d'autres machines sur un autre 
  LAN IP ou WAN.</li>
  <li>Si vous rencontrez des difficult&eacute;s lors de la r&eacute;solution du 
    nom de h&ocirc;te local vers une adresse IP, ou la r&eacute;solution d'autres 
    noms locaux vers des adresses IP malgr&eacute; le fait que vous avez des fichiers 
    <i>/etc/hosts</i> et <i>/etc/resolv.conf</i> corrects (par exemple, Netscape 
    sous OpenBSD a parfois ce comportement car il utilise son propre m&eacute;canisme 
    de r&eacute;solution au lieu d'utiliser simplement <i>gethostbyname(3)</i> 
    pour rechercher des adresses.)</li>
d1250 5
a1254 12
<p>Une autre raison est la vitesse d'ex&eacute;cution. Vu que la r&eacute;solution 
  de noms est un processus it&eacute;ratif, dans lequel le serveur de noms envoie 
  des requ&ecirc;tes r&eacute;p&eacute;titives &agrave; d'autres serveurs de noms 
  pour des adresses dans des domaines ext&eacute;rieurs, la r&eacute;solution 
  de noms peut prendre un peu plus de temps si vous avez une connexion modem &agrave; 
  Internet et vous envoyez des requ&ecirc;tes &agrave; votre propre serveur DNS 
  concernant des adresses distantes (votre serveur va alors, et de mani&egrave;re 
  it&eacute;rative, demander l'information &agrave; des serveurs de noms distants 
  via le modem) que si vous envoyez la requ&ecirc;te au serveur de noms de votre 
  FAI (qui a probablement une connexion plus rapide vers des serveurs de noms 
  distants).</p>
<h3>6.8.3 Quels sont les composants logiciels du serveur DNS ?</h3>
d1256 2
a1257 3
  <li>named <i>("name daemon")</i></li>
  <li>Les fichiers de configuration dans la hi&eacute;rarchie de r&eacute;pertoires 
    sous <i>/var/named/</i></li>
d1260 9
a1268 5
<h4>6.8.3.1 Quelle version de BIND est support&eacute;e ?</h4>
<p>BIND est le nom d'une sp&eacute;cification pour un serveur de noms de domaine. 
  La mise en oeuvre de BIND est constitu&eacute;e par un ensemble de composants 
  de service de noms.</p>
<p> Il y a trois versions distinctes de BIND : </p>
d1271 3
a1273 3
<li>BIND 4</li>
<li>BIND 8</li>
<li>BIND 9</li>
d1276 7
a1282 4
<p>Tel qu'il est install&eacute;, le <b>named</b> de OpenBSD g&egrave;re BIND 
  4.x. 
<h4>6.8.3.2 Quelles sont quelques unes des alternatives &agrave; fournir le service 
  DNS via l'impl&eacute;mentation par d&eacute;faut BIND 4.X ?</h4>
d1284 2
a1285 2
  <li>L'impl&eacute;mentation BIND 9.x qui se trouve sous <i>/usr/ports/net/bind9</i>.(Voir 
    <a href="../../fr/ports.html">ports</a>) 
d1288 10
a1297 10
<h5>6.8.3.2.1 Note de<u> s&eacute;curit&eacute;</u></h5>
<p>Si vous utilisez ces impl&eacute;mentations alternatives pour le service de 
  noms de domaines, vous fournissez un service r&eacute;seau critique &agrave; 
  travers des logiciels qui n'ont peut-&ecirc;tre pas &eacute;t&eacute; soumis 
  au m&ecirc;me examen minutieux que le d&eacute;mon <b>named</b> de l'installation 
  de base, <a href="http://www.openbsd.org/security.html">audit&eacute; au niveau 
  s&eacute;curit&eacute;</a>. Ceci est n'est pas &agrave; prendre &agrave; la 
  l&eacute;g&egrave;re, puisque si un serveur de noms de domaines est compromis, 
  les applications de r&eacute;solution de noms utilisant ce serveur de noms peuvent 
  &ecirc;tre redirig&eacute;s vers des sites imposteurs. </p>
a1298 16
<p>Si la configuration r&eacute;seau par d&eacute;faut de OpenBSD a &eacute;t&eacute; 
  param&eacute;tr&eacute;e correctement durant l'installation, tout est d&eacute;j&agrave; 
  install&eacute;. Vous avez juste &agrave; configurer le d&eacute;mon named.</p>
<h3>6.8.5 Comment puis-je configurer le DNS ?</h3>
<p>Vous configurez le DNS de OpenBSD en &eacute;ditant et/ou en cr&eacute;ant 
  des fichiers qui contr&ocirc;lent le d&eacute;mon <tt>named</tt>. Ces fichiers 
  r&eacute;sident par d&eacute;faut dans le r&eacute;pertoire <i>/var/named</i> 
  et ces sous-r&eacute;pertoires, sp&eacute;cialement le fichier <i>/var/named/named.boot</i> 
  qui est le fichier d'initialisation de <b>named</b>. Il y a aussi quelques &eacute;tapes 
  de configuration qui doivent &ecirc;tre effectu&eacute;es dans <i>/etc</i>.
</p>
<p>Dans ce document, nous allons configurer le d&eacute;mon named sur <i>nemo.yewtopia.com</i> 
  pour &ecirc;tre le serveur de noms primaire pour le (tout petit !) domaine <i>yewtopia.com</i>. 
  L'adresse de <i>nemo.yewtopia.com</i> est <i>192.168.1.9</i>. Deux autres machines 
  sont sur le m&ecirc;me sous-r&eacute;seau, <i>crater.yewtopia.com </i>&agrave; 
  l'adresse 192.168.1.1 et <i>earhart.yewtopia.com</i> &agrave; l'adresse 192.168.1.2.</p>
d1300 10
a1309 1
<h4>6.8.5.1 Configuration &agrave; effectuer dans <i>/var/named</i></h4>
d1311 10
d1323 1
a1323 1
<ul><pre>
d1334 1
a1334 1
</pre></ul>
d1336 4
a1339 3
<p>Ceci sp&eacute;cifie au processus d'initialisation dans quel sous-r&eacute;pertoire 
  et sous quels noms de fichiers il trouvera les fichiers de configuration pour 
  <i>yewtopia.com</i>.
d1342 1
a1342 1
<ul><pre>
d1344 1
a1344 2
@@       IN      SOA     nemo.yewtopia.com.
your_id.nemo.yewtopia.com.  (
d1352 1
a1352 1
</pre></ul>
d1354 1
d1357 1
a1357 1
<ul><pre>
d1359 1
a1359 2
yewtopia.com.        IN      SOA     nemo.yewtopia.com.
your_id.nemo.yewtopia.com.  (
d1372 1
a1372 1
</pre></ul>
d1374 1
d1377 1
a1377 1
<ul><pre>
d1379 1
a1379 2
1.168.192.in-addr.arpa. IN      SOA     nemo.yewtopia.com.
your_id.nemo.yewtopia.com.  (
d1391 1
a1391 1
</pre></ul>
d1393 2
a1394 1
<h4>6.8.5.2 Configuration &agrave; effectuer dans <i>/etc</i></h4>
d1396 1
d1398 5
a1402 5
<p>Assurez-vous que <i>/etc/resolv.conf </i>pointe sur le domaine de la machine 
  locale (au lieu du serveur de nom de votre FAI par exemple) de telle fa&ccedil;on 
  que les requ&ecirc;tes de r&eacute;solution de noms soient envoy&eacute;es au 
  <b>named</b> que vous avez configur&eacute; !</p>
<ul><pre>
d1405 1
a1405 1
</pre></ul>
d1407 1
d1410 5
a1414 4
<p>Si vous avez pr&eacute;c&eacute;demment ajout&eacute; des adresses de diverses 
  machines dans le fichier <i>/etc/hosts</i>, vous devriez remettre votre fichier 
  <i>/etc/hosts </i>dans sa configuration par d&eacute;faut : </p>
<ul><pre>
d1418 1
a1418 1
</pre></ul>
d1420 4
a1423 11
<p>&nbsp; </p>
<p>Pour que la r&eacute;solution assur&eacute;e par <b> named</b> ne soit pas 
  contourn&eacute;e en faveur d'adresses (probablement d&eacute;pass&eacute;es) 
  dans le fichier <i>/etc/hosts</i>. <u>Assurez-vous que vous avez au moins une 
  entr&eacute;e <i>localhost</i></u> ou votre r&eacute;seau ne d&eacute;marrera 
  pas proprement ! Notez aussi que <i>nemo </i>doit appara&icirc;tre dans son 
  propre fichier d'h&ocirc;tes vous verrez un message (quasi-inoffensif) au d&eacute;marrage 
  lorsque <i>/etc/netstart </i>fait appel &agrave; <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=route&sektion=8">route(8)</a> 
  pour ajouter <i>nemo </i>(dont le nom appara&icirc;t dans <i>/etc/myname</i>).</p>
<h4>6.8.5.3 Utilisation de <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dig&sektion=1">dig(1)</a> 
  pour analyser les r&eacute;sultats</h4>
d1425 5
a1429 2
<ul><pre>
$ <strong>dig @@nemo.yewtopia yewtopia any any</strong>
d1438 1
a1438 1
;;      yewtopia, type = ANY, class = ANY
d1441 1
a1441 2
yewtopia.        3600   SOA     nemo.yewtopia.
your_id.nemo.yewtopia. (
d1447 1
a1447 1
yewtopia.        3600   NS      nemo.yewtopia.
d1450 1
a1450 1
nemo.yewtopia.   3600   A       192.168.1.9
d1453 1
a1453 1
;; FROM: nemo to SERVER: nemo.yewtopia.  192.168.1.9
d1456 4
a1459 1
</pre></ul>
d1461 10
a1470 7
<h3>6.8.6 Comment et quand se d&eacute;marre et s'arr&ecirc;te le DNS ? </h3>
<h4>6.8.6.1 D&eacute;marrer le DNS</h4>
<p>Le d&eacute;mon <b>named</b> est lanc&eacute; lors du d&eacute;marrage du syst&egrave;me 
  &agrave; partir de <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc&sektion=8">/etc/rc</a> 
  si la ligne par d&eacute;faut dans <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc.conf&sektion=8">/etc/rc.conf</a> 
  : </p>
<ul><pre>
d1472 1
a1472 1
</pre></ul>
d1474 2
a1475 1
<p> est remplac&eacute;e par :</p>
d1477 1
a1477 1
<ul><pre>
d1479 4
a1482 1
</pre></ul>
d1484 1
a1484 2
<p>De m&ecirc;me, v&eacute;rifier les lignes suivantes dans /etc/rc.conf : </p>
<ul><pre>
d1487 1
a1487 1
</pre></ul>
d1489 9
a1497 5
<p>Ces valeurs par d&eacute;faut conviennent pour pratiquement toutes les configurations.</p>
<p>Pour d&eacute;marrer <b>named</b> &agrave; la main, utilisez la commande <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ndc&sektion=8">ndc(8)</a>. 
  Par exemple : </p>
<ul>
  <pre>
d1499 1
a1499 1
ou
d1501 4
a1504 2
</pre>
</ul>
d1506 3
a1508 1
<h4>6.8.6.2 Arr&ecirc;ter le DNS</h4>
d1510 1
a1510 4
<p>La meilleure mani&egrave;re d'arr&ecirc;ter le d&eacute;mon <b>named</b> est 
  d'utiliser la commande <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ndc&sektion=8">ndc(8)</a>. 
  Par exemple : </p>
<ul><pre>
d1512 6
a1517 1
</pre></ul>
d1519 1
a1519 6
<p>Si cela &eacute;choue, trouvez l'identifiant du processus 
  (PID) de named et utilisez la commande <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=kill&sektion=1">kill(1)</a> 
  pour arr&ecirc;ter le processus. Le PID de <b>named</b> quand ce dernier est 
  actif se trouve dans la premi&egrave;re ligne du fichier <i>/var/named/named.pid</i> 
</p>
<ul><pre>
d1524 1
a1524 1
</pre></ul>
d1526 5
a1530 1
<h4>6.8.6.3 Red&eacute;marrer le DNS avec une configuration modifi&eacute;e</h4>
d1532 1
a1532 4
<p>Pour amener une instance en cours du d&eacute;mon <b>named </b> &agrave; red&eacute;marrer 
  en rechargeant la configuration apr&egrave;s que vous ayez effectu&eacute; des 
  changements, envoyez-lui un signal &quot;hangup&quot; : </p>
<ul><pre>
d1534 1
a1534 1
</pre></ul>
d1536 4
a1539 2
<p> ou utilisez la commande <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ndc&sektion=8">ndc(8)</a> 
  comme ceci : </p>
d1541 1
a1541 1
<ul><pre>
d1543 4
a1546 1
</pre></ul>
d1548 4
a1551 3
<h3>6.8.7 Comment puis-je bloquer les requ&ecirc;tes AXFR ?</h3>
<p> exemple : 
<ul><pre>
d1561 9
a1569 12
</pre></ul>
<p>Cette information est utile lors du d&eacute;boguage du DNS, mais dans certains 
  cas vous ne voudriez pas qu'elle soit disponible publiquement de mani&egrave;re 
  permanente. Si vous utilisez une &quot;classless in-addr&quot; (rfc2137) comme 
  classe inverse, host -l pourrait afficher tout domaine que votre syst&egrave;me 
  h&eacute;berge ! On peut rem&eacute;dier facilement &agrave; ce comportement 
  gr&acirc;ce &agrave; la clause &quot;allow-transfer&quot; dans votre fichier 
  de zone. 
<p>Si vous utilisez Bind8, vous devez sp&eacute;cifier les h&ocirc;tes que vous 
  voulez autoriser &agrave; transf&eacute;rer des zones dans votre/vos fichier(s) 
  de zone individuel(s) :
<ul><pre>
d1579 7
a1585 5
</pre></ul>
<p>Vous pouvez aussi bloquer les transferts vers tous les domaines en &eacute;ditant 
  /var/named.conf et en ajoutant le param&egrave;tre 'allow-transfer' &agrave; 
  la section 'options' du fichier de configuration : </p>
<ul><pre>
d1589 7
a1595 5
</pre></ul>
<p>La m&eacute;thode Bind8 fonctionne aussi avec Bind9. </p>
<p>Si vous utilisez Bind 4 (le d&eacute;faut sous OpenBSD), vous pouvez 
&eacute;diter /var/named/named.boot et utilisez l'option 'xfrnets'. </p>
<ul><pre>
d1600 15
a1614 22
</pre></ul>
<p><br>
  Bind 4 autorise le transfert &agrave; partir de classes enti&egrave;res donc 
  ce n'est pas vraiment exacte. Typiquement, les seuls h&ocirc;tes qui ont besoin 
  d'effectuer des transferts sont vos serveurs DNS esclaves et les h&ocirc;tes 
  &agrave; partir desquels vous souhaitez d&eacute;boguer (127.0.0.1 est usuellement 
  un h&ocirc;te &agrave; qui on peut autoriser les transferts !) Bloquer les requ&ecirc;tes 
  AXFR ajoute un niveau suppl&eacute;mentaire de s&eacute;curit&eacute;, mais 
  peut emp&ecirc;cher le d&eacute;boguage DNS qui se r&eacute;v&egrave;le 
  parfois utile. (Merci &agrave; <a href=mailto:ntang@@nachtwache.org>Nicholas Tang</a> 
  pour cette remarque)</p>
<p></p>
<h3>6.8.8 Que ne m'avez vous pas dit &agrave; propos de la mise en place du DNS 
  ? </h3>
<p>Il y a beaucoup de choses que nous ne vous avons pas dit. Par exemple, comment 
  configurer le DNS de telle mani&egrave;re &agrave; ce que les requ&ecirc;tes 
  pour les domaines intranet qui ne sont pas visibles &agrave; partir de la racine 
  la hi&eacute;rarchie de domaines soient relay&eacute;es &agrave; des serveurs 
  au sein de votre entreprise. Lisez <a href="#DNS.1.1">les documents que nous 
  vous avons recommand&eacute;</a> pour plus d'informations concernant le DNS. 
</p>
<p><a name= "PPTP"></a> <a name="6.9"></a> </p>
d1616 4
a1620 12
<p><b>REMARQUE : </b> Ceci ne s'applique pas &agrave; <b>TOUS</b> les fournisseurs 
  d'acc&egrave;s ADSL, mais l'essentiel de ce que vous devez conna&icirc;tre se 
  trouve dans cette configuration typique. Cette configuration a &eacute;t&eacute; 
  valid&eacute;e avec <a href="http://www.inode.at">Inode</a>, un fournisseur 
  d'acc&egrave;s ADSL en Autriche. </p>
<p>Pour commencer, vous avez besoin d'installer pptp. Le port se trouve sous <i>/usr/ports/net/pptp</i>. 
  Consultez <a href="../faq8.html#Ports">FAQ 8, Ports</a> pour plus d'informations 
  concernant l'arborescence de ports OpenBSD. </p>

<p>A cause d'un conflit entre le support au niveau noyau <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=gre&sektion=4">gre(4)</a> 
  et pptp, vous aurez besoin de re-compiler votre noyau en supprimant le support 
  pour gre(4). </p>
d1622 13
a1634 1
<p>&nbsp; </p>
d1636 2
a1637 3
<ul>
  Correctif pour supprimer le support GRE(4) : 
  <pre>
d1641 12
a1652 11
retrieving revision 1.66
diff -u -r1.66 GENERIC
--- sys/conf/GENERIC    2000/10/13 04:21:14     1.66
+++ sys/conf/GENERIC    2000/12/26 19:55:31
@@@@ -97,6 +97,6 @@@@
 pseudo-device  ksyms   1	# kernel symbols device
 pseudo-device  bridge  2	# network bridging support
 pseudo-device vlan    2	# IEEE 802.1Q VLAN
-pseudo-device  gre     1	# GRE encapsulation interface
+#pseudo-device gre     1	# GRE encapsulation interface
 #pseudo-device strip   1   # Starmode Radio IP interface
d1654 6
a1659 3
 
</pre>
</ul>
d1661 4
a1664 11
<p>Pour recompiler votre noyau, utilisez cvs pour r&eacute;cup&eacute;rer OpenBSD 
  (consultez la page web <a href="../../stable.html">OpenBSD Stable</a> pour plus 
  d'informations), appliquer le patch pr&eacute;c&eacute;dent, et reconstruisez 
  votre noyau en suivant les instructions indiqu&eacute;es dans <a href="faq5.html#Building">FAQ 
  5, Configuration du noyau</a>. </p>
<p>Apr&egrave;s avoir reconstruit le noyau et install&eacute; le package <b>pptp</b>, 
  vous devez &eacute;diter quelques fichiers pour mettre en place votre connexion. 
  Ce package utilise le <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ppp&sektion=8">ppp(8)</a> 
  fourni avec OpenBSD, alors si vous &ecirc;tes familier avec ppp(8), la configuration 
  est pratiquement la m&ecirc;me. Consultez <a href="#PPP">FAQ 6, Protocole Point 
  &agrave; Point</a>. </p>
d1671 4
a1674 3
<p>La configuration suivante est tr&egrave;s probablement tout ce dont vous avez 
  besoin dans le fichier <i>/etc/ppp/options</i> : </p>
<ul><pre>
d1681 4
a1684 1
</pre></ul>
d1686 2
a1687 1
<p> <tt>LOGINNAME</tt> doit &ecirc;tre remplac&eacute; avec votre nom d'utilisateur.</p>
d1689 1
a1689 2
<p><i>/etc/ppp/pap-secrets</i> devrait contenir une ligne comme la suivante : 
<ul><pre>
d1692 6
a1697 1
</pre></ul>
d1699 18
a1716 23
<p>O&ugrave; LOGINNAME est votre nom d'utilisateur et PASSWORD est votre mot de 
  passe. 10.0.0.138 est l'adresse IP attribu&eacute;e &agrave; votre MODEM dans 
  le cas o&ugrave; vous utilisez l'ADSL, etc. Assurez-vous que ce fichier est 
  en lecture seule pour root uniquement (mode 600). </p>
<h3>6.9.1 - Attribution d'une adresse &agrave; votre interface r&eacute;seau</h3>
<p>Dans l'exemple ci-dessus, notre modem a une interface pr&eacute;configur&eacute;e 
  avec l'adresse 10.0.0.138. Maintenant, nous avons besoin d'affecter une 
  adresse 
  &agrave; NOTRE interface. Le mieux est de choisir une adresse IP proche de celle 
  donn&eacute;e par votre MODEM, ou utiliser l'adresse statique qui vous est attribu&eacute;e. 
  Consultez <a href="#Setup">FAQ 6, Mise en place initiale</a> pour plus d'informations 
  concernant le param&eacute;trage d'interfaces.</p>
<p>Une fois votre interface configur&eacute;e, vous devriez &ecirc;tre capable 
  de cr&eacute;er une connexion pptp avec la commande : </p>

<ul><pre>
# <strong>/usr/local/sbin/pptp 10.0.0.138 &</strong>
</pre></ul>

<p>Puisque que nous utilisons le ppp(8) fourni avec OpenBSD, deux programmes sont 
  d&eacute;marr&eacute;s. Vous pouvez arr&ecirc;ter pptp en &quot;tuant&quot; 
  ces deux programmes : </p>
<ul><pre>
d1718 5
a1722 2
% <strong>kill -9 [pid of pptp]</strong>
</pre></ul>
d1724 1
a1724 3
<p>Il est recommand&eacute; d'ouvrir <tt>/var/log/messages</tt> dans un autre 
  terminal, pour tracer d'&eacute;ventuels probl&egrave;mes.</p>
<ul>
d1727 5
a1731 2
</pre></ul>
<p></p>
d1733 150
a1882 5
<p>Nous vous sugg&eacute;rons aussi de mettre la commande de d&eacute;marrage 
  dans <i>/etc/rc.local</i> pour vous connecter automatiquement au d&eacute;marrage.</p>
<p> <font color= "#0000e0"> <a href= "index.html">[Retour &agrave; l'Index G&eacute;n&eacute;ral]</a> 
  <a href= "faq5.html">[Vers la Section 5.0 - Configuration du noyau]</a> <a href= "faq7.html">[Vers 
  la Section 7.0 - Param&eacute;trage du clavier]</a> </font> </p>
d1886 10
a1895 5
<a href= "index.html"><img height= "24" width= "24" src= "../../images/back.gif" border= "0" alt= "[back]"></a> 
<a href= "mailto:www@@openbsd.org">www@@openbsd.org</a> <br>
<small>Originally [OpenBSD: faq6.html,v 1.133 2002/05/23 13:10:11 dhartmei Exp]<br>
$Translation: faq6.html,v 1.16 2003/05/12 12:00:54 saad Exp $<br>
$OpenBSD$ </small> 
@


1.5
log
@
sync with badlands translation CVS
@
text
@d2114 1
a2114 1
    <a href="../../ports.html">ports</a>) 
d2548 1
a2548 1
$Translation: faq6.html,v 1.15 2002/05/27 05:52:03 saad Exp $<br>
@


1.4
log
@
sync with badlands translation CVS.
@
text
@d95 1
a95 13
<p>Remarque concernant les mises &agrave; jour &agrave; partir d'une ancienne 
  version d'OpenBSD : d'anciens pilotes ethernet sont parfois remplac&eacute;s 
  par des nouveaux, et dans ce cas, le nom de l'interface peut changer. 
  Par exemple, les pilotes mx, al, ax, et pn ont &eacute;t&eacute; tous remplac&eacute;s 
  par le pilote dc. Toutes les r&eacute;f&eacute;rences dans <i>/etc/dhcpd.interfaces</i>, 
  <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&sektion=5">/etc/pf.conf(5)</a>, 
  ou <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=nat.conf&sektion=5">/etc/nat.conf(5)</a> 
  doivent &ecirc;tre remplac&eacute;es avec le nouveau nom d'interface. Bien entendu, 
  les fichiers <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hostname.if&sektion=5">/etc/hostname.xxx</a> 
  doivent &ecirc;tre renomm&eacute;s; xxx repr&eacute;sentant l'ancien nom de 
  l'interface et son num&eacute;ro.</p>

<P> Vous pouvez trouver quelles interfaces ont &eacute;t&eacute; identifi&eacute;es 
a316 4
<p></p>

<p><strong>A partir de OpenBSD 2.8, <i>/etc/ifaliases</i> n'est plus utilis&eacute;! 
  </strong> </p>
d482 2
a483 1
<ul><pre>
d486 3
a488 2
block in on fxp0 inet proto tcp from any to any port = 3306
</pre></ul>
d493 11
a503 10
  noter qu'il est obligatoire de sp&eacute;cifier un protocole avec tout 
  filtre bas&eacute; 
  sur les ports, et qu'il est recommand&eacute; de sp&eacute;cifier la famille d'adresses. 
  Pour les services d&eacute;finis dans le fichier <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=services&sektion=5">/etc/services(5)</a> 
  , le nom du service peut &eacute;galement &ecirc;tre utilis&eacute;, comme <i>www </i>ou <i>mysql</i>. 
  Un paquet destin&eacute; au port tcp 3306 sur l'interface <tt>fxp0</tt> va passer 
  la premi&egrave;re r&egrave;gle &quot;pass in&quot; puis sera bloqu&eacute; 
  par la r&egrave;gle &quot;block in port = 3306&quot;. Si l'ordre 
  de nos r&egrave;gles est invers&eacute; (souvenez-vous, l'ordre est important) en entr&eacute;e : </p>
<ul><pre>
d505 1
a505 1
block in on fxp0 inet proto tcp from any to any port = 3306
d507 2
a508 1
</pre></ul>
d518 2
a519 1
<ul><pre>
d521 1
a521 1
block in quick on fxp0 inet proto tcp from any to any port = 3306
d523 2
a524 1
</pre></ul>
d544 3
a546 3
pass in quick on fxp0 inet proto tcp from any to any port = 22
pass in quick on fxp0 inet proto tcp from any to any port = 80
pass in quick on fxp0 inet proto tcp from any to any port = 443
d559 3
a561 3
pass in quick on fxp0 inet proto tcp from 1.1.1.0/24 to any port = 22
pass in quick on fxp0 inet proto tcp from any to any port = 80
pass in quick on fxp0 inet proto tcp from any to any port = 443
d571 1
a571 1
pass in quick on fxp0 inet proto tcp from 1.1.1.0/24 to any port = 22
d575 1
a575 1
pass in quick on fxp0 inet proto tcp from 1.1.1.1/32 to any port = 22
d606 1
a606 1
pass in quick on fxp0 inet proto tcp from 1.1.1.1/32 to any port = 22
d610 2
a611 2
pass in quick on fxp0 inet proto tcp from any to any port = 80
pass in quick on fxp0 inet proto tcp from any to any port = 443
d627 2
a628 2
pass in quick on fxp0 inet proto tcp from 1.1.1.1/32 to any port = 22
block in log quick on fxp0 inet proto tcp from any to any port = 22
d677 2
a678 1
<ul><pre>
d680 3
a682 2
pass in quick on fxp0 inet proto { tcp, udp } from any to any port = 53
</pre></ul>
d685 6
a690 4
<ul><pre>
pass in quick on fxp0 inet proto tcp from any to any port = 53
pass in quick on fxp0 inet proto udp from any to any port = 53
</pre></ul>
d745 2
a746 2
  C au port 22 (ssh) et tout trafic web entrant vers les ports 80 (http) et 443 (https). 
  Nous bloquons tout autre trafic. Mais si je voulais faire un <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ssh&sektion=1">ssh(1)</a> 
d751 13
a763 11
  des m&eacute;thodes, cela peut devenir assez g&eacute;nant. En ajoutant 
  le mot-cl&eacute; <em>keep state</em> &agrave; notre r&egrave;gle &quot;pass 
  out&quot;, nous pouvons automagiquement autoriser les connexions entrantes en 
  r&eacute;ponse &agrave; des connexions que nous avons initi&eacute;, comme la 
  navigation web. Attention, nous avons besoin de sp&eacute;cifier le protocole 
  pour lequel nous maintenons l'&eacute;tat.</p>
<ul><pre>
pass in quick on fxp0 inet proto tcp from 1.1.1.0/24 to any port = 22
pass in quick on fxp0 from any to any port = 80
pass in quick on fxp0 from any to any port = 443
block in quick on fxp0 from any to any
d765 2
a766 1
</pre></ul>
d787 10
a796 6
  <pre>
pass in quick on fxp0 inet proto tcp from 1.1.1.0/24 to any port = 22
pass in quick on fxp0 inet proto tcp from any to any port = 80 flags S/SA
pass in quick on fxp0 inet proto tcp from any to any port = 443 flags S/SA
block in quick on fxp0 from any to any
pass out on fxp0 proto tcp from any to any keep state</pre>
d825 3
a827 2
# autoriser uniquement nos machines &agrave; se connecter via ssh
pass in quick on fxp0 inet proto tcp from 1.1.1.0/24 to any port = 22
d830 4
a833 5
pass in quick on fxp0 inet proto tcp from any to any port = 80 flags S/SA
pass in quick on fxp0 inet proto tcp from any to any port = 443 flags S/SA

# finalement, bloquer le tout avec une interdication par d&eacute;faut
block in quick on fxp0 from any to any
d837 3
d854 1
a854 1
pass in quick on fxp0 inet proto { tcp, udp } from any to any port = 53
d878 1
a878 1
NoRouteIPs="{ 127.0.0.1/8, 192.168.0.0/16, 172.16.0.0/12, 10.0.0.0/8 }"
d894 1
a894 1
NoRouteIPs="{ 127.0.0.1/8, 192.168.0.0/16, 172.16.0.0/12, 10.0.0.0/8 }"
d904 3
a906 2
# autoriser seulement nos machines à administrer via ssh
pass in quick on $ExtIF inet proto tcp from $IntNet to any port = 22
d909 2
a910 1
pass in quick on $ExtIF inet proto tcp from any to any port $Services flags S/SA
d912 6
a917 6
# finalement bloquons le reste avec une interdiction par défaut
block in quick on $ExtIF from any to any

# et laissons le trafic sortant passer et maintenons l'&eacute;tat sur les connexions établies 
pass out on $ExtIF from any to any keep state
</pre>
d924 1
a924 1
pass in log quick on fxp0 from 1.1.1.0/24 to any port = 22
d1312 4
a1315 3
<ul><pre>
8081 stream tcp nowait root /usr/libexec/ftp-proxy ftp-proxy
</pre></ul>
a1598 6
<p><b>REMARQUE</b> - Sur OpenBSD 2.6, le syst&egrave;me est sorti avec un <i>/etc/ppp/ppp.conf.sample</i> 
  qui avait un mauvais param&egrave;tre pour un p&eacute;riph&eacute;rique. Ce 
  dernier &eacute;tait &quot;<i>set device /dev/cuaa0</i>&quot;. Ceci devrait 
  &ecirc;tre <i>/dev/cua00</i> qui correspond au port s&eacute;rie 1 (COM1). Votre 
  modem peut ne pas &ecirc;tre connect&eacute; sur COM1, n&eacute;anmoins la nomenclature 
  &eacute;tait fausse.</p>
d1600 3
a1602 5
  &agrave; chaque fois. Ici, nous param&eacute;trons toutes nos informations 
  critiques. 
  Avec &quot;set log&quot;, nous param&eacute;trons nos niveaux de
  journalisation. Ceci 
  peut &ecirc;tre modifi&eacute;, r&eacute;f&eacute;rez vous &agrave; <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ppp&sektion=8">ppp(8)</a> 
a1611 1

d2042 3
a2044 4
  OpenBSSD n'active pas, par d&eacute;faut, le serveur de noms de domaine sur 
  votre machine, malgr&eacute; que tous les fichiers n&eacute;cessaires soient 
  install&eacute;s. Pour la plupart des stations de travail, il suffit d'avoir 
  le fichier <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hosts&sektion=5">/etc/hosts</a> 
d2434 3
a2436 6
<p>Pour commencer, vous avez besoin d'installer pptp. Un port a &eacute;t&eacute; 
  ajout&eacute; &agrave; l'arborescence des ports OpenBSD APRES la sortie de OpenBSD 
  2.8 et il fonctionne bien avec l'arborescence de ports OpenBSD 2.8. Le port 
  se trouve sous <i>/usr/ports/net/pptp</i>. Consultez <a href="../faq8.html#Ports">FAQ 
  8, Ports</a> pour plus d'informations concernant l'arborescence de ports OpenBSD. 
</p>
d2447 1
a2447 1
Index: sys/conf/GENERIC
d2457 1
a2457 1
 #pseudo-device vlan    2	# IEEE 802.1Q VLAN
d2460 3
a2462 2

 option		BOOT_CONFIG     # add support for boot -c
d2467 2
a2468 2
  2.8-stable (consultez la page web <a href="../../stable.html">OpenBSD Stable</a> 
  pour plus d'informations), appliquer le patch pr&eacute;c&eacute;dent, et reconstruisez 
d2547 3
a2549 4
<small>Originally [OpenBSD: faq6.html,v 1.126 2002/01/27 22:51:50 nick Exp]<br>
$Translation: faq6.html,v 1.14 2002/02/23 22:23:39 saad Exp $<br>
$OpenBSD$
</small>
@


1.3
log
@
sync with badlands translation CVS
@
text
@d43 2
a44 2
<P> Le lecteur sera plus &agrave; l'aise pour lire ce document si elle/il a lu 
  auparavant - et m&ecirc;me partiellement- la section <a href="faq5.html">Configuration 
d47 2
a48 1
<P> Si vous &ecirc;tes un administrateur r&eacute;seau et vous mettez en place 
d53 2
a54 1
  autre lien</a>). C'est un excellent document, contenant les concepts fondamentaux 
d64 1
a64 1
  Internet et comment ceux-ci sont sens&eacute;s fonctionner. <a name= "Setup"></a> 
d80 1
a80 1
  ifconfig(8)</a>. Comme exemple, voici la sortie fournie par dmesg pour une carte 
d96 2
a97 2
  version de OpenBSD: D'anciens pilotes ethernet sont parfois remplac&eacute;s 
  par des nouveaux, et quand &ccedil;a a lieu, le nom d'une interface peut changer. 
d147 2
a148 1
  configur&eacute;e. C'est &eacute;vident vu que fxp0 a &eacute;t&eacute; rattach&eacute;e, 
d153 1
a153 1
  fonctions. Les pages du manuel suivantes les d&eacute;crivent:</p>
d156 1
a156 1
    - Interface de Loopback
d158 1
a158 1
    - Interface de Log du filtre de paquets Packet Filter
d164 1
a164 1
    - Interface r&eacute;seau Tunnel 
d168 1
a168 1
    - Interface de Pont Ethernet 
d174 1
a174 1
    - Interface Tunnel IPv4/IPv6 G&eacute;n&eacute;rique 
d179 3
a181 3
  Remplacez xxx par le nom de votre interface. A partir des informations fournies 
  par les exemples pr&eacute;c&eacute;dentes, ce nom serait <strong>/etc/hostname.fxp0</strong>. 
  Le format de ce fichier est simple:</p>
d189 1
a189 1
  adresse IPv4, serait comme suit:</p>
d196 1
a196 1
  voulez, par exemple, forcer le mode 100baseTX full-duplex.</p>
d203 5
a207 5
  pour travailler dans ce mode ! Dans l'absence de besoins sp&eacute;cifiques, 
  les param&egrave;tres de m&eacute;dia devront &ecirc;tre exclus.)</p>
<p>Ou peut-&ecirc;tre voudriez vous utiliser des drapeaux sp&eacute;ciaux sp&eacute;cifiques 
  &agrave; un type d'interface. Le format du fichier hostname ne varie gu&egrave;re 
  plus !</p>
d214 1
a214 1
  faire cela, mettez simplement l'IP de la passerelle dans le fichier <strong>/etc/mygate</strong>. 
d219 2
a220 2
  <strong>/etc/resolv.conf</strong>. Vous pourrez en savoir plus sur le format 
  de ce fichier en consultant la page du manuel <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=resolv.conf&sektion=5">resolv.conf(5)</a>. 
d231 1
a231 1
<p>A partir de l&agrave;, vous pouvez soit red&eacute;marrer soit ex&eacute;cuter 
d233 1
a233 1
  en saisissant (en tant que root): </p>
d242 1
a242 1
<p>Vous remarquerez que quelques erreurs ont &eacute;t&eacute; g&eacute;n&eacute;r&eacute;es. 
d251 1
a251 1
  de routage:</p>
d328 1
a328 1
<h3>6.1.3 - Configuration d'aliases sur une interface.</h3>
d333 1
a333 1
<p>OpenBSD poss&egrave;de un m&eacute;canisme simple pour configurer des aliases 
d338 1
a338 1
  sur le r&eacute;seau 192.168.0.0. D'autres informations utiles:</p>
d344 1
a344 1
<p>Quelques remarques &agrave; propos des aliases. Dans OpenBSD, vous utilisez 
d351 7
a357 7
  Vous pouvez effacer des aliases avec &quot;<tt>ifconfig int delete</tt>". 
<p>En supposant que vous avez de multiples adresses IP en alias appartenant au 
  m&ecirc;me sous-r&eacute;seau IP, la configuration du masque de sous-r&eacute;seau 
  pour chaque alias sera 255.255.255.255. Il n'y pas besoin d'avoir le m&ecirc;me 
  masque de sous-r&eacute;seau que celle de la premi&egrave;re IP affect&eacute;e 
  &agrave; l'interface. Dans cet exemple, <i>/etc/hostname.dc0</i>, deux aliases 
  sont ajout&eacute;s &agrave; l'interface dc0, qui -rappelons le- a &eacute;t&eacute; 
d370 1
a370 1
  Pour activer le premier alias, vous utiliseriez la commande: </p>
d375 1
a375 1
<p> Pour voir ces aliases, vous devez utiliser la commande: </p>
d393 2
a394 1
<h5>Remarque: Packet filter est le syst&egrave;me de filtrage de OpenBSD &agrave; 
d397 1
a397 1
<p>Le sous-syst&egrave;me Packet Filter a &eacute;t&eacute; cr&eacute;e pour fournir 
d399 1
a399 1
  de h&ocirc;tes/sous-r&eacute;seaux &agrave; une plage d'adresses externes. Les 
d403 2
a404 2
<p>Pour d&eacute;marrer ces services, vous aurez besoin d'&eacute;diter <i><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc.conf&sektion=8">/etc/rc.conf(8)</a></i> 
  et de mettre:</p>
d409 3
a411 3
<p>si vous utilisez la traduction d'adresses, vous aurez tr&egrave;s probablement 
  besoin de fixer la valeur <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&sektion=8">sysctl(8)</a> 
  de <tt>net.inet.ip.forwarding</tt> &agrave; 1. Vous pouvez faire &ccedil;a en 
d414 1
a414 1
<p>Si le support Packet Filter est inclus dans votre noyau, mais vous ne l'avez 
d428 1
a428 1
<p>Ceci peut &ecirc;tre aussi combin&eacute; en une seule ligne de commande:</p>
d433 1
a433 1
  de PF, vous pouvez recharger les r&egrave;gles en rechargeant le fichier appropri&eacute;:</p>
d443 1
a443 1
  en d&eacute;tail ci-apr&egrave;s. Vous pouvez avoir d'autres informations concernant 
d454 1
a454 1
  parcouru au d&eacute;marrage. Pour une explication plus d&eacute;taill&eacute;e, 
d457 1
a457 1
  connect&eacute;e &agrave; internet. Cela sera diff&eacute;rent pour vous selon 
d459 2
a460 2
  supposent une connectivit&eacute; internet permanente telle celle qu'on peut 
  constater sur un serveur web.</p>
d462 1
a462 1
  du haut vers le bas; visualiser chaque paquet devant traverser chaque r&egrave;gle 
d466 1
a466 1
  les paquets en entr&eacute;e, et tous les paquets en sortie:</p>
d472 1
a472 1
Ces r&egrave;gles sont &eacute;quivalentes &agrave;: 
d497 1
a497 1
  Notre base de r&egrave;gles serait comme suit:</p>
d504 1
a504 1
<p>Ceci peut &ecirc;tre interpr&eacute;t&eacute; comme suit: &quot;bloquer tout 
d507 3
a509 2
  noter qu'on doit sp&eacute;cifier un protocole avec tout filtre bas&eacute; 
  sur les ports, et il est recommand&eacute; de sp&eacute;cifier la famille d'adresses. 
d511 1
a511 1
  , on peut aussi utiliser le nom du service, comme <i>www </i>ou <i>mysql</i>. 
d514 2
a515 2
  par la r&egrave;gle &quot;block in port = 3306&quot;. Si on inverse l'ordre 
  de nos r&egrave;gles (souvenez-vous, l'ordre est important) en entr&eacute;e:</p>
d524 2
a525 2
  se rappeler de ceci quand on &eacute;crit des r&egrave;gles de filtrage de paquets: 
  <b>La derni&egrave;re r&egrave;gle correspondante gagne</b>.</p>
d529 1
a529 1
  Si nous ajoutons <em>quick</em> &agrave; la r&egrave;gle &quot;block in&quot;:</p>
d548 1
a548 1
  accidentelle d'un service qu'on a laiss&eacute; expos&eacute;.</p>
d562 1
a562 1
  ports tcp 22(ssh), 80(http), 443(https). Toutes les autres tentatives de connexions 
d576 4
a579 3
<p>Pas mal ! Mais si on voulait autoriser une seule machine (1.1.1.1) &agrave; 
  administrer le serveur web &agrave; distance? Dans ce cas, on change la ligne 
  suivante:</p>
d583 1
a583 1
par: 
d593 4
a596 4
  on mettra en place une protection basique contre l'usurpation d'adresses. Ces 
  adresses ne devraient (normalement) pas &ecirc;tre routables sur internet et 
  m&ecirc;me si ce n'est pas le cas, c'est tr&egrave;s rarement bon alors on les 
  bloque: 
d604 2
a605 2
<p>Notre base de r&egrave;gles commence &agrave; &ecirc;tre correcte; quand on 
  met tout ensemble, voici &agrave; quoi elle ressemble:</p>
d630 5
a634 4
<b>Logs de paquets</b> 
<p>C'est encore mieux mais c'est am&eacute;liorable. Et si nous voulions loguer 
  n'importe quelle tentative de connexion vers le port 22(ssh) qui sera bloqu&eacute;e 
  par notre pare-feu ? facile, Packet Filter peut g&eacute;rer avec le mot-cl&eacute; 
d640 4
a643 4
<p>Ces r&egrave;gles autorisent notre machine d'administration distante &agrave; 
  se connecter au port 22, mais interdit et logue toutes les autres tentatives 
  de connexion au port 22.</p>
<p>Les paquets logu&eacute;s sont envoy&eacute;s &agrave; l'interface pflog0, 
d645 2
a646 2
  qui va enregistrer les paquets dans le fichier /var/log/pflog au format <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&sektion=8">tcpdump(8)</a> 
  binaire. pflogd(8) est d&eacute;marr&eacute; par d&eacute;faut par <i><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc&sektion=8">/etc/rc(8)</a></i> 
d648 1
a648 1
  pouvez lire ces fichiers de log en utilisant la commande suivante:
d655 1
a655 1
  un tel affichage, vous pourriez utiliser la commande: 
d659 2
a660 2
<p>On peut aussi utiliser tcpdump pour r&eacute;duire le champ d'investigation 
  et faciliter le d&eacute;boguage:</p>
d666 4
a669 3
  le d&eacute;codage de protocole verbeux de tcpdump (activ&eacute; &agrave; l'aide 
  de l'option -v). Les d&eacute;codeurs de protocole de tcpdump n'ont pas un historique 
  en termes de s&eacute;curit&eacute; parfait. En th&eacute;orie du moins, une 
d671 1
a671 1
  donn&eacute;es partiels de paquets logu&eacute;s par le dispositif de log. </p>
d674 4
a677 4
  aux logs. Pflogd capture 96 octets du paquet et le logue. L'acc&egrave;s aux 
  logs pourrait fournir un acc&egrave;s partiel &agrave; des informations sensibles 
  contenues dans le champ donn&eacute;e du paquet (par exemple lors des connexions 
  <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=telnet&sektion=1">telnet(1)</a> 
d682 5
a686 4
<p>Comment faire lorsqu'on a besoin d'autoriser les connexions vers un service 
  utilisant plusieurs protocoles, comme bind qui utilise TCP et UDP ? Packet Filter 
  vous permet de regrouper des options sous forme d'une liste (plus de d&eacute;tails 
  &agrave; propos des listes seront donn&eacute;s par la suite): 
d692 1
a692 1
  Ceci est plus ordonn&eacute; que l'alternative que vous auriez pu utiliser:</p>
d704 1
a704 1
  la directive <b>scrub,</b> utilis&eacute;e comme suit:
d710 1
a710 1
  d'&eacute;quipements ayant des mauvaises impl&eacute;mentations TCP/IP.</p>
d716 1
a716 1
  utiliser la directive <b>allow-opts</b>: 
d729 1
a729 1
  d'empreinte avec nmap), vous pourriez utiliser une r&egrave;gle comme suit:
d748 1
a748 1
<p>Par exemple, voyons comment on peut appliquer le maintien d'&eacute;tat &agrave; 
d751 1
a751 1
  C au port 22(ssh) et tout trafic web entrant vers les ports 80(http) et 443(https). 
d757 1
a757 1
  des m&eacute;thodes, &ccedil;a peut devenir assez g&eacute;n&acirc;nt. En ajoutant 
d771 3
a773 2
  de notre base de r&egrave;gles de fa&ccedil;on dramatique: par exemple, dans 
  la base de r&egrave;gles ci-dessus, nous autorisons tout trafic tcp vers les 
d778 2
a779 1
  g&eacute;rer la connexion. Pour autoriser le &quot;tcp handshake&quot; initial, 
d782 7
a788 5
  avec un SYN positionn&eacute;, on peut se pr&eacute;munir de plusieurs formes 
  de scan de ports comme le scan FIN. flags S/SA veut dire: des deux drapeaux 
  S (SYN) et A (ACK), seulement SYN peut &ecirc;tre positionn&eacute;. Les autres 
  drapeaux ne sont pas investigu&eacute;s. Les r&egrave;gles ressemblent maintenant 
  &agrave;: 
d806 5
a810 4
  vers les ports 80(http) et 443(https). Elle prot&egrave;ge aussi contre des 
  adresses usurp&eacute;es non-routables, et bloque tous les paquets qui sont 
  trop fragment&eacute;s pour pouvoir &ecirc;tre inspect&eacute;s. Une configuration 
  typique pour un serveur web public. Voici comment serait <i>/etc/pf.conf</i>: 
d814 1
a814 1
# Nettoyez les paquets anormaux et fragment&eacute;s
d846 1
a846 1
  plus simples et plus claires sous PF. Par exemple, Comment faire si nous avons 
d854 4
a857 4
<p>Des groupes d'IPs en relation peuvent &ecirc;tre regroup&eacute;s dans des 
  listes; ces listes peuvent &ecirc;tre employ&eacute;es l&agrave; o&ugrave; une 
  seule adresse IP peut &ecirc;tre utilis&eacute;e dans une r&egrave;gle. Nos 
  r&egrave;gles d'anti-usurpation d'adresses en sont un exemple: 
d872 1
a872 1
  effectuer peut &ecirc;tre diminu&eacute; en utilisant l'expansion de variable:</p>
d883 1
a883 1
  fichier: 
d915 2
a916 2
<p> Si vous rencontrez des probl&egrave;mes, vous pouvez activer le loguing sur 
  des r&egrave;gles individuelles pour trouver la cause des probl&egrave;mes:
d921 2
a922 1
&eacute;crira les logs dans /<i>var/log/pflog</i>. Il faut se rappeler que <i>/var/log/pflog</i> 
d926 3
a928 3
<p> Quand vous modifiez le fichier de configuration pour loguer des paquets, 
  n'oubliez pas de taper <b>pfctl -R /etc/pf.conf</b> pour la prise en compte 
  des modifications ! </p>
d935 1
a935 1
  PF n'est pas simplement un quelconque remplacement pour IPF. Les principales 
d937 1
a937 1
  les suivantes:</p>
d939 1
a939 1
  <li><b>group et head:</b> Ces options ne sont plus utilis&eacute;es, vu que 
d945 2
a946 2
  <li><b>level:</b> Lors du loguing, PF n'accepte pas une option <em>level</em> 
    pour le mot-cl&eacute; <i>log</i>, puisque le loguing n'est pas effectu&eacute; 
d948 3
a950 2
    mais par un d&eacute;mon de loguing s&eacute;par&eacute;. Pour analyser un 
    type particulier de trafic, comme on pourrait le faire avec l'option<em> level</em>, 
d956 2
a957 2
    dans la liste des r&egrave;gles comme fait IPF. Pour voir les num&eacute;ros 
    de r&egrave;gles que PF a affect&eacute;, utilisez la commande <tt>pfctl -sr</tt></li>
d966 1
a966 1
<h5>Remarque: Packet filter est le syst&egrave;me de filtrage de OpenBSD &agrave; 
d982 1
a982 1
  les blocs suivants: </p>
d999 1
a999 1
  <b>Interfaces r&eacute;seaux: </b> 
d1003 2
a1004 2
    <b>Adresse IP: </b>24.5.0.5<br>
    <b>Masque de sous-r&eacute;seau: </b>255.255.255.0<br>
d1008 2
a1009 2
    <b>Adresse IP: </b>192.168.1.1<br>
    <b>Masque de sous-r&eacute;seau: </b>255.255.255.0<br>
d1016 3
a1018 3
    <b>Adresse IP: </b>24.5.0.5<br>
    <b>Masque de sous-r&eacute;seau: </b>255.255.255.0<br>
    <b>Passerelle: </b>24.5.0.1<br>
d1061 3
a1063 2
  un nombre fini et r&eacute;duit d'adresses IP distinctes disponibles, et comme 
  r&eacute;sultat, ces adresses ne sont pas gratuites. La plupart des FAIs &agrave; 
d1091 1
a1091 1
<p> L'exemple ci-dessous montre la NAT un peu plus clairement:</p>
d1115 2
a1116 2
  la mise en place d'un serveur proxy, ou la mise en place de la NAT. (Ne laissez 
  pas l'exemple du c&acirc;ble modem domestique vous abuser. La NAT est assez 
d1123 3
a1125 3
  mon FAI autorise seulement trois adresses IP par domicile. Cela veut qu'il n'y 
  avait pas assez d'adresses IP pour permettre &agrave; chaque machine d'avoir 
  un acc&egrave;s direct &agrave; Internet en simultan&eacute;. </p>
d1133 1
a1133 1
  PF. Ceci peut &ecirc;tre facilement accompli en &eacute;ditant les fichiers 
d1135 1
a1135 1
  qu'il ressemble &agrave; l'exemple ci-apr&egrave;s):</p>
d1159 2
a1160 1
  le pare-feu sans aucune interf&eacute;rence. Le fichier devrait ressembler &agrave;:</p>
d1170 1
a1170 1
  haut, le fichier devrait contenir la ligne suivante:</p>
d1201 1
a1201 1
<p>Une fois la configuration compl&eacute;t&eacute;e, il y a deux mani&egrave;res 
d1206 1
a1206 1
  les commandes suivantes:</p>
d1217 3
a1219 2
<p><b>Remarque:</b>afin de recharger les r&egrave;gles de NAT (au cas o&ugrave; 
  vous auriez &eacute;dit&eacute; le fichier mais vous ne voulez pas red&eacute;marrer), 
d1229 1
a1229 1
  Cette option va lister toutes les sessions de NAT en cours:</p>
d1237 1
a1237 1
<p> Explications (de la premi&egrave;re ligne, les autres &eacute;tant similaires): 
d1262 1
a1262 1
  &eacute;tant avec FTP. Vous pouvez utiliser FTP de deux fa&ccedil;ons: passive 
d1284 1
a1284 1
  -A de ftp, ou d&eacute;sactivez le mode passif en saisissant la commande suivante:</p>
d1291 1
a1291 1
<P>PacketFilter fournit une autre solution &agrave; cette situation: la redirection 
d1296 1
a1296 1
  dans votre fichier <i>/etc/nat.conf</i>:
d1300 1
a1300 1
<p>Une explication concise de cette ligne est: &quot; Le trafic sur l'interface 
d1311 1
a1311 1
  Une des mani&egrave;res d'envoyer le signal 'HUP' est:</p>
d1328 4
a1331 3
  s'effectuer &agrave; moins que votre machine de NAT embarque un serveur web. 
  A ces fins, nous utilisons la directive 'rdr' de la NAT dans le fichier de r&egrave;gles 
  pour dire vers o&ugrave; on redirige une connexion particuli&egrave;re.</p>
d1335 1
a1335 1
  &agrave; la ligne suivante dans <i>/etc/nat.conf</i>:</p>
d1369 2
a1370 2
    au port en entr&eacute;e. Par exemple, la ligne suivante et valide, et potentiellement 
    utile:</p>
d1391 1
a1391 1
  &agrave; la ligne suivante:
d1421 1
a1421 1
  client contre les d&eacute;bordements de m&eacute;moire tampon...etc. La maintenance 
d1426 1
a1426 1
<p> Fichiers OpenBSD: 
d1436 1
a1436 1
<p> Liens Internet &agrave; propos de la NAT: 
d1458 1
a1458 1
  interface ethernet principale est xl0. La v&ocirc;tre pourrait &ecirc;tre ep0 
d1468 1
a1468 1
  commande, assurez vous que le fichier /etc/dhclient.conf existe puis essayez:</p>
d1472 1
a1472 1
<p>O&ugrave; fxp0 est l'interface sur laquelle vous voulez recevoir les informations 
d1508 1
a1508 1
<p> Ceci dira a vos clients dhcp de rajouter le domaine xyz.mil aux requ&ecirc;tes 
d1516 1
a1516 1
  avoir &eacute;dit&eacute; /etc/dhcpd.conf, essayez: 
d1519 1
a1519 1
O&ugrave; fxp0 est une interface sur laquelle vous voulez que le serveur dhcp 
d1524 1
a1524 1
  cela, rajoutez la ligne suivante dans /etc/dhcpd.conf:
d1542 1
a1542 1
    - Qui est le d&eacute;mon ppp au niveau de l'espace utilisateur. 
d1545 5
a1549 4
<p>Le premier que nous allons couvrir est le d&eacute;mon ppp au niveau de l'espace 
  utilisateur. Pour commencer vous aurez besoin de quelques informations simples 
  &agrave; propos de votre fai. Voici une liste des informations utiles dont vous 
  aurez besoin:</p>
d1558 1
a1558 1
  de la configuration de votre ppp. Le d&eacute;mon ppp au niveau de l'espace 
d1564 1
a1564 1
  vous avez la ligne suivante dans votre fichier de configuration du noyau:</p>
d1572 1
a1572 1
<p>La mise en place initiale pour le d&eacute;mon PPP au niveau de l'espace utilisateur 
d1578 4
a1581 4
  une connexion vers votre FAI et configurer vos routes par d&eacute;faut et votre 
  serveur de noms. Avec ce fichier, les seules informations dont vous aurez besoin 
  sont votre num&eacute;ro de t&eacute;l&eacute;phone FAI, votre nom d'utilisateur 
  et votre mot de passe. </p>
d1599 4
a1602 2
  &agrave; chaque fois. Ici nous param&eacute;trons toutes nos informations critiques. 
  Avec &quot;set log&quot;, nous param&eacute;trons nos niveaux de logs. Ceci 
d1619 1
a1619 1
  simple qui inclus tout le n&eacute;cessaire pour nous connecter:</p>
d1635 1
a1635 1
<p>Ici nous avons configur&eacute; l'information essentielle pour ce FAI. La premi&egrave;re 
d1658 3
a1660 2
  IP sp&eacute;cifi&eacute;e est ce &agrave; quoi nous nous attendons comme IP 
  de leur part. Si vous la connaissez, vous pouvez la sp&eacute;cifier. Encore 
d1664 2
a1665 1
  est sp&eacute;cifi&eacute;, c'est utilis&eacute; au lieu de myaddr dans la n&eacute;gociation 
d1667 2
a1668 1
  accept&eacute;e. C'est utile quand on n&eacute;gocie avec quelques impl&eacute;mentations 
d1672 3
a1674 2
  configure notre route par d&eacute;faut pour pointer sur leur IP. Cette option 
  est 'collante', dans le sens o&ugrave; si leur IP change, notre route sera automatiquement 
d1682 4
a1685 4
<p>Maintenant que nous avons configur&eacute; notre fichier <b>ppp.conf</b>, on 
  peut commencer &agrave; essayer de se connecter &agrave; notre FAI. Je vais 
  d&eacute;tailler quelques arguments commun&eacute;ment utilis&eacute;s avec 
  ppp. </p>
d1688 1
a1688 1
    et vous connecter &agrave; votre fai puis mettra le programme en arri&egrave;re 
d1700 1
a1700 1
  pouvez cr&eacute;er pour ce genre de situations: <b>/etc/ppp/ppp.linkup</b> 
d1702 1
a1702 1
  consult&eacute;es ici:</p>
d1722 2
a1723 2
<p>Pour param&eacute;trer &ccedil;a, utilisez <tt>sysctl</tt> et augmentez les 
  valeurs de:</p>
d1732 1
a1732 1
<h3>6.6.2 - Comment je peux activer les broadcasts directs ? </h3>
d1738 1
a1738 1
impl&eacute;mentations du protocole NetBIOS. L'activation se fait par sysctl: 
d1741 2
a1742 2
<H3>6.6.3 - Je ne veux pas que mon noyau alloue dynamiquement un port donn&eacute;</h3>
<p>Il y a aussi un sysctl pour &ccedil;a. Traduction d'une partie de <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&sektion=8">sysctl(8)</a>:</p>
d1744 1
a1744 1
Param&eacute;trer la liste des ports TCP r&eacute;serv&eacute;s qui ne 
d1770 1
a1770 1
  &agrave; lire avant d'essayer de configurer NFS sont:</p>
d1780 1
a1780 1
  pas abord&eacute; la s&eacute;curisation de NFS. Nous supposerons que vous avez 
d1844 1
a1844 1
  assurez vous qu'un fichier mounttab vide existe, et ex&eacute;cutez le d&eacute;mon: 
d1863 2
a1864 2
  sont actifs et sont enregistr&eacute;s aupr&egrave;s de RPC. Pour faire &ccedil;a, 
  utilisez rpcinfo(8).
d1887 1
a1887 1
  -a host</b>. Par exemple: 
d1896 1
a1896 1
<h3>Montage des syst&egrave;mes NFS </h3>
d1902 1
a1902 1
  d'utiliser une adresse IP, mount r&eacute;sout les noms d'h&ocirc;te): 
d1910 1
a1910 1
  suivante &agrave; /<i>etc/fstab</i>: 
d1921 1
a1921 1
  l&agrave; o&ugrave; elles s'appliquent. Par exemple:
d1938 1
a1938 1
<h3>6.8.1 C'est quoi le DNS ?</h3>
d1946 2
a1947 1
  mais elle ne peut pas r&eacute;pondre &agrave; des requ&ecirc;tes DNS par elle-m&ecirc;me 
d1951 1
a1951 1
  pour effectuer des requ&ecirc;tes DNS:</p>
d1968 1
a1968 1
  <i>openbsd.org</i> et lui demander l'adresse de <i>www.openbsd.org</i>:</p>
d2015 1
a2015 1
    et sp&eacute;cialement les pages suivantes: 
d2052 1
a2052 1
  machine en tant que serveur de noms:</p>
d2060 1
a2060 1
      <li><b>Remarque: </b>Il n'y a aucune restriction pratique au nombre de serveurs 
d2069 3
a2071 3
  <li>Si vous avez un LAN IP sur lequel r&eacute;sident des machines qu'ont peut 
    trouver via une requ&ecirc;te DNS par d'autres machines sur un autre LAN IP 
    ou WAN.</li>
d2101 1
a2101 1
  L'impl&eacute;mentation de BIND est constitu&eacute;e par un ensemble de composants 
d2103 1
a2103 1
<p> Il y a trois sp&eacute;cifications distinctes de BIND:</p>
d2134 1
a2134 1
<h3>6.8.5 Comment je configure le DNS ?</h3>
d2140 2
a2141 1
  de configuration qui doivent effectu&eacute;es dans <i>/etc</i>.</p>
d2238 1
a2238 1
  <i>/etc/hosts </i>dans sa configuration par d&eacute;faut:</p>
d2288 1
a2288 1
<h3>6.8.6 Comment et quand je d&eacute;marre et j'arr&ecirc;te le DNS ? </h3>
d2304 1
a2304 1
<p>De m&ecirc;me, v&eacute;rifier les lignes suivantes dans /etc/rc.conf:</p>
d2312 1
a2312 1
  Par exemple:</p>
d2325 1
a2325 1
  Par exemple:</p>
d2330 1
a2330 1
<p>Si cela &eacute;choue, trouvez le num&eacute;ro d'identification du processus 
d2346 1
a2346 1
  changements, envoyez-lui un signal &quot;hangup&quot;:</p>
d2352 1
a2352 1
  comme ceci:</p>
d2358 2
a2359 2
<h3>6.8.7 Comment je bloque les requ&ecirc;tes AXFR ?</h3>
<p> exemple: 
d2380 1
a2380 1
  de zone individuel(s):
d2394 1
a2394 1
  la section 'options' du fichier de configuration: </p>
d2401 2
a2402 2
<p>Si vous utilisez Bind 4 (le d&eacute;faut sur OpenBSD), vous pouvez &eacute;diter 
  /var/named/named.boot et utilisez l'option 'xfrnets'. </p>
d2416 2
a2417 2
  peut emp&ecirc;cher le d&eacute;boguage DNS qui se r&eacute;v&egrave;le parfois 
  utile (Merci &agrave; <a href=mailto:ntang@@nachtwache.org>Nicholas Tang</a> 
d2432 1
a2432 1
<p><b>REMARQUE:</b> Ceci ne s'applique pas &agrave; <b>TOUS</b> les fournisseurs 
d2451 1
a2451 1
  Un patch pour supprimer le support GRE(4). 
d2489 1
a2489 1
  besoin dans le fichier <i>/etc/ppp/options</i>:</p>
d2501 1
a2501 1
<p><i>/etc/ppp/pap-secrets</i> devrait contenir une ligne comme la suivante: 
d2513 2
a2514 1
  avec l'adresse 10.0.0.138. Maintenant nous avons besoin d'affecter une adresse 
d2519 2
a2520 2
<p>une fois votre interface configur&eacute;e, vous devriez &ecirc;tre capable 
  de cr&eacute;er une connexion pptp avec la commande:</p>
d2528 1
a2528 1
  ces deux programmes:</p>
d2553 1
a2553 1
$Translation: faq6.html,v 1.13 2002/02/22 08:37:34 saad Exp $<br>
@


1.2
log
@
sync with badlands translation CVS
@
text
@d26 1
a26 1
  <li><a href= "#NAT"   >6.3 - Translation d'adresses</a>
d50 1
a50 1
  des r&eacute;seaux IP, vous auriez vraiment besoin de lire <a href="http://www.3com.com/corpinfo/en_US/technology/tech_paper.jsp?DOC_ID=135">Comprendre 
d62 1
a62 1
  Internet et comment ces protocoles sont sens&eacute;s fonctionner. <a name= "Setup"></a> 
d102 2
a103 2
  doivent &ecirc;tre renomm&eacute;es; xxx repr&eacute;sentant l'ancien nom de 
  l'interface et le nombre).</p>
d142 1
a142 1
  nous fournit beaucoup plus d'information que nous ne pourrions en avoir besoin 
d145 3
a147 4
  configur&eacute;e. C'est &eacute;vident du fait qu'un r&eacute;seau IP est d&eacute;j&agrave; 
  configur&eacute; pour fxp0, d'o&ugrave; les valeurs &quot;inet 10.0.0.38 netmask 
  0xffffff00 broadcast 10.0.0.255&quot;. De plus, les drapeaux<b> UP</b> et <b>RUNNING</b> 
  sont positionn&eacute;s. </p>
d177 1
a177 1
  par les ex&eacute;mples pr&eacute;c&eacute;dentes, ce nom serait <strong>/etc/hostname.fxp0</strong>. 
d193 1
a193 1
  voulez, mettons, forcer le mode 100baseTX full-duplex.</p>
d198 3
a200 3
<p>(Bien entendu, vous ne devriez jamais forcer le mode full duplex que si les 
  deux extr&eacute;mit&eacute;s de la connexion sont param&eacute;tr&eacute;es 
  pour travailler dans ce mode! Dans l'absence de besoins sp&eacute;cifiques, 
d202 3
a204 2
<p>Ou vous voudriez utiliser des drapeaux sp&eacute;ciaux sp&eacute;cifiques &agrave; 
  un type d'interface. Le format du fichier hostname ne varie gu&egrave;re beaucoup!</p>
d215 1
a215 1
  Pour configurer vos serveurs de noms, cr&eacute;ez un fichier appell&eacute; 
d247 2
a248 2
  Voici un example d'utilisation ces deux commandes pour afficher vos tables de 
  routage:</p>
d293 1
a293 1
  vous devriez aussi lire la partie concernant la Translation d'Adresses afin 
d295 3
a297 3
<p>Le noyau GENERIC a d&eacute;j&agrave; la capacit&eacute; d'autoriser le routage 
  IP, mais celle-ci doit &ecirc;tre activ&eacute;e. Vous devriez faire cela &agrave; 
  l'aide de l'utilitaire <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&sektion=8">sysctl(8)</a>. 
d306 2
a307 2
<p>Pour effectuer ce changement sans red&eacute;marrage, utilisez directement 
  l'utilitaire <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&sektion=8">sysctl(8)</a>. 
d333 1
a333 1
  qui fait partie de la <a href="faq10.html#rc">hi&eacute;rarchie de d&eacute;marrage 
d355 2
a356 2
  configur&eacute; avec l'adresse IP 192.168.0.2 et un masque de sous-r&eacute;seau 
  255.255.255.0.
d392 1
a392 1
  de OpenBSD jusqu'&agrave; 2.9, cliquez <a href="../faqipf.html">ici</a>.</h5>
d395 2
a396 2
  de h&ocirc;tes/sous-r&eacute;seaux &agrave; un intervalle d'adresses externes. 
  Les fichiers de configuration pour ces deux services sont <i><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&sektion=5">/etc/pf.conf(5)</a></i> 
d405 1
a405 1
<p>si vous utilisez la translation d'adresses, vous aurez tr&egrave;s probablement 
d410 1
a410 1
<p>Si le support Packet Filter est inclut dans votre noyau, mais vous ne l'avez 
d420 3
a422 3
  et la seconde configure la translation d'adresses, en utilisant <i>/etc/nat.conf</i> 
  (la <a href="#NAT">Section 6.3, Translation d'adresses</a> fournit plus de d&eacute;tails 
  sur la translation d'adresses), et finalement, la derni&egrave;re ligne active 
d483 1
a483 1
  et le(s) port(s) utilis&eacute;s par les services qu'on souhaite filter. N'importe 
d510 1
a510 1
  de nos r&egrave;gles (souvenez-vous, l'ordre est important):</p>
d544 1
a544 1
<p>Voyons maintenant un autre exemple de base de r&egrave;gles et expliquer les 
d556 1
a556 1
<p>Ceci autorise les connexion en entr&eacute;e de n'importe o&ugrave; vers les 
d562 1
a562 1
  &agrave; partir de l'externe &agrave; http et https ?
d577 1
a577 1
A: 
d588 3
a590 2
  adresses ne devraient (normalement) pas &ecirc;tre routables sur internet mais 
  si ce n'est pas le cas, c'est tr&egrave;s rarement bon alors on les bloque: 
d634 1
a634 1
  se connecter au port 22, mais interdit et loguer toutes les autres tentatives 
d647 2
a648 2
  pflog ne donne pas un affichage en temps r&eacute;el. Si vous souhaitez un tel 
  affichage, vous pourriez utiliser la commande:
d652 1
a652 1
<p>On peut aussi utiliser tcpdump pour r&eacute;tr&eacute;cir le champ d'investigation 
d661 3
a663 3
  s&eacute;curit&eacute; parfait. En th&eacute;orie du moins, une attaque &agrave; 
  retardement peut &ecirc;tre possible &agrave; travers les champs donn&eacute;es 
  partiels de paquets logu&eacute;s par le dispositif de log. </p>
d677 1
a677 1
  &agrave; propos des listes seront donn&eacute;es par la suite):
d744 1
a744 1
  &agrave; partir de serveur web ? Et si j'avais besoin d'utiliser <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=lynx&sektion=1">lynx(1)</a> 
d762 1
a762 1
  de notre base de r&egrave;gles de mani&egrave;re dramatique: par exemple, dans 
d789 9
a797 8
  que nous avons jusqu'&agrave; pr&eacute;sent dans une base de r&egrave;gles. 
  Cette base de r&egrave;gles supporte IPv4, a une politique d'interdiction par 
  d&eacute;faut, autorise les connexions d'administration &agrave; partir d'un 
  r&eacute;seau local uniquement (via ssh) et autorise le trafic entrant vers 
  les ports 80(http) et 443(https). Elle prot&egrave;ge aussi contre des adresses 
  usurp&eacute;es non-routables, et bloque tous les paquets qui sont trop fragment&eacute;s 
  pour pouvoir &ecirc;tre inspect&eacute;s. Une configuration typique pour un 
  serveur web public. Voici comment serait <i>/etc/pf.conf</i>: </p>
d826 1
a826 1
<p>Bien que cet ensemble de r&egrave;gles est correct, Packet Filter poss&egrave;de 
d828 1
a828 1
  <i>/etc/pf.conf</i> plus lisible et plus facilement maintenable.</p>
d856 3
a858 4
  le fait que vous ayez besoin de changer un certain nombre de lignes si vous 
  avez besoin de changer votre interface, ou de changer une adresse IP. Le nombre 
  de changements &agrave; effectuer peut &ecirc;tre diminu&eacute; en utilisant 
  l'expansion de variable:</p>
a922 1
<p>&nbsp;</p>
d933 3
a935 3
    mais par un d&eacute;mon de loguing s&eacute;par&eacute;. Pour examiner un 
    type particulier de trafic, comme on pourrait le faire avec l'option<em> 
    level</em>, utilisez une des options disponibles de <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&sektion=8">tcpdump(8)</a>.</li>
d937 1
a937 2
    r&eacute;alis&eacute;e par le mot-cl&eacute; <a href="#normalization">scrub</a> 
    option.</li>
d947 1
a947 1
<h2>6.3 - Translation d'adresses</h2>
d952 1
a952 1
  de OpenBSD jusqu'&agrave; 2.9, cliquez <a href="../faqipf.html">ici</a>.</h5>
d955 1
a955 1
<h3><u>6.3.1 Introduction &agrave; la translation d'adresses (NAT)</u></h3>
d959 1
a959 1
  1631</a>, la translation d'adresses fournit un moyen facile pour faire correspondre 
d1012 1
a1012 1
      cliente n'est pas un souci pour la translation d'adresses. Pour les exemples, 
d1041 1
a1041 1
<h3><u>6.3.2 Translation d'adresses</u></h3>
d1043 1
a1043 1
<a name="nat2.1"></a> <b>Introduction &agrave; la translation d'adresses</b>
d1052 1
a1052 1
<p>La translation d'adresses, ou NAT (Network Address Translation), (connu aussi 
d1097 5
a1101 5
  il y a quelques options qui s'offrent &agrave; moi comme l'obtention d'adresses 
  IP suppl&eacute;mentaires, la mise en place d'un serveur proxy, ou la mise en 
  place de la NAT. (Ne laissez pas l'exemple du c&acirc;ble modem domestique vous 
  abuser. La NAT est assez puissante pour masquer un large r&eacute;seau avec 
  des centaines voire des milliers d'ordinateurs !)</p>
d1105 4
a1108 4
  ai trois, ce qui fait cinq ordinateurs &agrave; connecter, mais mon FAI autorise 
  seulement trois adresses IP par domicile. Cela veut qu'il n'y avait pas assez 
  d'adresses IP pour permettre &agrave; chaque machine d'avoir un acc&egrave;s 
  direct &agrave; Internet en simultan&eacute;. </p>
d1110 1
a1110 1
  partagera avec les autres la seule adresse IP fournir par mon FAI. Le co&ucirc;t 
d1119 2
a1120 2
<p><b>/etc/rc.conf</b> (ce fichier est utilis&eacute; pour d&eacute;marrer les 
  services au d&eacute;marrage) </p>
d1122 4
a1125 3
<ul><pre>
pf=YES<br>
</pre></ul>
d1178 1
a1178 1
  <p> C'est l'adresse IP externe utilis&eacute;e pour la correspondance des adresses 
d1198 1
a1198 1
  va d&eacute;marrer comme pr&eacute;vu au red&eacute;marrage.</p>
d1205 1
a1205 3
<p> <a name="nat3.0"></a> </p>

<h3><u>6.3.3 Base de connaissances NAT</u></h3>
a1206 1
<br>
d1209 1
a1209 1
  configuration a &eacute;t&eacute; pris en compte, utilisez l'option &quot;-ss&quot;. 
d1218 2
a1219 1
<p> Explications (de la premi&egrave;re ligne, les autres sont similaires): </p>
d1237 2
a1238 1
  <p> Ceci indique l'&eacute;tat dans lequel la connexion TCP est, selon PF. </p>
d1252 4
a1255 4
  il l'envoie &agrave; l'adresse externe sur un port al&eacute;atoire. Quand la 
  machine de NAT recevra ce paquet, et parce qu'elle n'a aucune correspondance 
  pour ce paquet inconnu et aucune correspondance pour ce port, elle bloquera 
  le paquet et ne le livrera pas. </p>
d1281 1
a1281 1
<p>Une explication courte de cette ligne est: &quot; Le trafic sur l'interface 
d1290 1
a1290 1
<p>puis il faut soit red&eacute;marrer le syst&egrave;me soit en envoyant un signal 
d1298 2
a1299 2
  FTP. Le choix du port 8081 est arbitraire, bien que le choix du port 8081 est 
  judicieux, vu qu'il n'est utilis&eacute; par aucune autre application.</p>
d1307 1
a1307 1
  bien s&ucirc;r, le ftp-proxy(8)d&eacute;j&agrave; &eacute;voqu&eacute;). Les 
d1320 1
a1320 1
<p> L'explication pour chaque partie de cette ligne:</p>
d1343 1
a1343 1
    et le port correspondant, doit exister dans le fichier <i>/etc/services.</i></p>
d1348 2
a1349 2
    redirig&eacute;s. Notez que le port destination n'a PAS besoin de correspondra 
    le port en entr&eacute;e. Par exemple, la ligne suivante et valide, et potentiellement 
d1390 12
a1401 12
  application que voudrez ex&eacute;cuter sur votre machine et qui devra se connecter 
  &agrave; Internet &agrave; travers le serveur proxy DEVRA savoir comment utiliser 
  un proxy. Toutes les applications ne savent pas faire &ccedil;a (et sp&eacute;cialement 
  les jeux). De plus, il n'y a pas des proxies applicatifs pour tous les services 
  Internet actuels. La NAT fait correspondre de mani&egrave;re transparente votre 
  r&eacute;seau interne &agrave; une adresse donn&eacute;e pour qu'il puisse se 
  connecter &agrave; Internet. Le seul avantage en termes de s&eacute;curit&eacute; 
  &agrave; utiliser un proxy par rapport &agrave; la NAT est que le proxy peut 
  poss&eacute;der des fonctionnalit&eacute;s de s&eacute;curit&eacute;, et peut 
  filtrer le trafic d'apr&egrave;s le contenu, pour prot&eacute;ger votre machine 
  Windows contre un virus macro, ou pour prot&eacute;ger votre logiciel client 
  contre les d&eacute;bordements de m&eacute;moire tampon...etc. La maintenance 
d1409 2
a1410 2
  <li>/etc/rc.conf - doit &ecirc;tre &eacute;dit&eacute; pour d&eacute;marrer 
    la NAT et PF au d&eacute;marrage 
d1438 3
a1440 3
  interface ethernet principale est xl0. La v&ocirc;tre pour &ecirc;tre ep0 ou 
  fxp0 ou quelque chose d'autre !) et tout ce que vous avez besoin d'y mettre 
  est le mot-cl&eacute; 'dhcp'
d1457 1
a1457 1
  d'abord les lignes 'require' (ce sont des exemples de param&eacute;trages par 
d1465 2
a1466 2
<p>puis <b>supprimer</b> domain-name-servers. Bien s&ucirc;r, vous pourriez supprimer 
  le hostname, ou d'autres param&egrave;tres aussi.</p>
d1495 1
a1495 1
<p>Si voulez d&eacute;marrer dhcpcd à partir de la ligne de commande, apr&egrave;s 
d1540 2
a1541 2
  </b> contenant des configurations diverses et vari&eacute;es pour des situations 
  diverses et vari&eacute;es. Vous devriez naviguer dans ce r&eacute;pertoire.</p>
d1543 1
a1543 1
  vous avez la ligne suivante dans votre fichier de configuration:</p>
d1571 1
a1571 1
<p><b>REMARQUE</b> - Sur OpenBSD 2.6, le syst&egrave;me est sorti avec un <i>/etc/ppp/ppp.conf.example</i> 
d1575 2
a1576 2
  modem peut ne pas &ecirc;tre connect&eacute; sur COM1, n&eacute;anmoins le sch&eacute;ma 
  de nommage &eacute;tait faux. </p>
d1596 1
a1596 1
  simple qui inclut tout le n&eacute;cessaire pour nous connecter:</p>
d1631 3
a1633 3
  voulons. Si vous avez une adresse IP statique, vous la param&eacute;trez ici. 
  Dans notre exemple nous utilisons /0 qui dit que aucun des octets de cette adresse 
  IP ne doit correspondre &agrave; son &eacute;quivalent dans l'adresse IP choisie, 
d1647 1
a1647 1
  est 'collante', dans le sens ou si leur IP change, notre route sera automatiquement 
d1668 1
a1668 1
  qui est tr&egrave;s bien pour d&eacute;boger votre fichier <b>ppp.conf</b>. 
d1702 2
a1703 2
<p>En utilisant sysctl -a, vous pouvez voir les valeurs actuelles de ces param&egrave;tres 
  et celles d'autres param&egrave;tres. Pour modifier une valeur, utilisez <tt>sysctl 
d1752 7
a1758 7
  sur un LAN, avec des clients acc&eacute;dant &agrave; NFS sur le LAN. Il ne 
  prend pas en compte la s&eacute;curisation de NFS. Nous supposerons que vous 
  avez d&eacute;j&agrave; configur&eacute; le filtrage de paquets ou une autre 
  protection de type pare-feu, pour vous pr&eacute;munir contre les acc&egrave;s 
  externes. Si vous autorisez les r&eacute;seaux externes &agrave; acc&eacute;der 
  &agrave; votre serveur NFS, et vous avez des informations sensibles stock&eacute;es 
  dessus, nous vous recommandons fortement d'utiliser <a href="faq13.html">IPsec</a>. 
d1760 1
a1760 1
  pourrait aussi pr&eacute;tendre d'avoir l'adresse IP que vous autorisez &agrave; 
d1763 1
a1763 1
  contre ce type d'attaques.
d1766 3
a1768 3
  autoris&eacute;(s). Sans liste d'h&ocirc;tes qui peuvent monter un r&eacute;pertoire 
  particulier, n'importe qui peut atteindre votre serveur NFS sera capable de 
  monter des exports NFS.
d1772 5
a1776 5
  votre fichier <i>/etc/exports</i>. Ce fichier liste quels syst&egrave;mes de 
  fichiers vous souhaitez rendre accessible via NFS et d&eacute;finit qui est 
  autoriser &agrave; y acc&eacute;der. Il y a plusieurs options que vous pouvez 
  utiliser dans votre fichier <i>/etc/exports</i>, et il serait fort souhaitable 
  que vous lisiez la page de manuel <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=exports&sektion=5">exports(5)</a>. 
d1794 2
a1795 2
  fichiers. Ceci est important pour quelques serveurs qui sont accessibles &agrave; 
  partir de r&eacute;seaux diff&eacute;rents.</p>
d1800 1
a1800 1
  dans <i>/etc/rc.conf</i>. Ceci d&eacute;marrera nfsd(8) et mountd(8) au red&eacute;marrage. 
d1807 1
a1807 1
  simultan&eacute;es auxquelles vous voulez r&eacute;pondre.</p>
d1815 1
a1815 1
<p>Vous devrez aussi d&eacute;marrer mountd(8). C'est le d&eacute;mon qui r&eacute;pond 
d1817 1
a1817 1
  assurez vous qu'un fichier mounttab vide existe, et ex&eacute;cutez le d&eacute;mon:
d1826 1
a1826 1
  vous devez pr&eacute;venir mountd &agrave; l'aide d'un signal HUP:
d1858 3
a1860 3
  et qui les monte. Il y a aussi nfsstat(8) qui donne des statistiques beaucoup 
  plus verbeuses. Pour utiliser showmount(8), essayez <b>/usr/bin/showmount -a 
  host</b>. Par exemple:
d1975 1
a1975 1
  correctement configur&eacute; pour &ecirc;tre serveur DNS pour le domaine <i>openbsd.org</i>.</p>
d1984 1
a1984 1
  <li>Lisez le livre <i><a href="../books.html#6">DNS and BIND</a> </i> de O'Reilly 
d2010 1
a2010 1
configur&eacute;s afin de comparer v&ocirc;tre configuration &agrave; la leur. 
d2035 4
a2038 4
        Le fait qu'un de ces serveurs fait autorit&eacute; ou pas en dehors de 
        votre LAN (ou s'il est simplement connu en dehors de votre LAN) est un 
        facteur de configuration qui est typiquement contr&ocirc;l&eacute; &agrave; 
        un cran plus haut dans la hi&eacute;rarchie des domaines.</li>
d2041 3
a2043 3
  <li>Si vous avez un LAN IP sur lequel r&eacute;sident des machines qui peuvent 
    &ecirc;tre trouvables via une requ&ecirc;te DNS par d'autres machines sur 
    un autre LAN IP ou WAN.</li>
d2073 2
a2074 2
  Des composants de serveurs de noms existent pour collectivement impl&eacute;menter 
  BIND. </p>
d2088 2
a2089 2
  <li>L'impl&eacute;mentation BIND 9.x qui se trouve sous <i>usr/ports/net/bind9</i>.(Voir 
    <a href="../ports.html">ports</a>) 
d2094 1
a2094 1
  noms de domaine, vous fournissez un service r&eacute;seau critique &agrave; 
d2099 1
a2099 1
  l&eacute;g&egrave;re, puisque si un serveur de noms de domaine est compromis, 
d2101 1
a2101 1
  &ecirc;tre redirig&eacute;s vers des sites d'imposteurs. </p>
d2197 1
a2197 1
  locale (au lieu de le serveur de nom de votre FAI par exemple) de telle fa&ccedil;on 
d2217 7
a2223 6
<p>Pour que <b>named</b> ne soit pas contourn&eacute; en faveur d'adresses (probablement 
  d&eacute;pass&eacute;es) dans le fichier <i>/etc/hosts</i>. <u>Assurez-vous 
  que vous avez au moins une entr&eacute;e <i>localhost</i></u> ou votre r&eacute;seau 
  ne d&eacute;marrera pas proprement ! Notez aussi que <i>nemo </i>doit appara&icirc;tre 
  dans son propre fichier d'h&ocirc;tes vous verrez un message (quasi-inoffensif) 
  au d&eacute;marrage lorsque <i>/etc/netstart </i>fait appel &agrave; <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=route&sektion=8">route(8)</a> 
d2261 2
a2262 2
<p>Le d&eacute;mon <b>named</b> est d&eacute;marr&eacute; lors du d&eacute;marrage 
  du syst&egrave;me &agrave; partir de <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc&sektion=8">/etc/rc</a> 
d2287 1
a2287 1
          ou
d2316 2
a2317 2
  en rechargeant la configuration apr&egrave;s que vous ayez effectu&eacute;e 
  des changements, envoyez-lui un signal &quot;hangup&quot;:</p>
d2343 6
a2348 6
  cas vous ne voudriez pas que cette information soit disponible publiquement 
  de mani&egrave;re permanente. Si vous utiliser une &quot;classless in-addr&quot; 
  (rfc2137) comme classe inverse, host -l pourrait afficher tout domaine que votre 
  syst&egrave;me h&eacute;berge ! On peut rem&eacute;dier facilement &agrave; 
  ce comportement gr&acirc;ce &agrave; la clause &quot;allow-transfer&quot; dans 
  votre fichier de zone.
d2371 1
a2371 1
<p>La m&eacute;thode Bond8 fonctionne aussi avec Bind9. </p>
d2381 3
a2383 3
  Bind 4 autorise le transf&egrave;re &agrave; partir de classes enti&egrave;res 
  donc ce n'est pas vraiment exacte. Typiquement, les seuls h&ocirc;tes qui ont 
  besoin d'effectuer des transferts sont vos serveurs DNS esclaves et les h&ocirc;tes 
d2393 1
a2393 1
<p>Il y a beaucoup de choses que nous ne vous avons pas dit, par exemple, comment 
d2398 2
a2399 1
  avons recommand&eacute;</a> pour plus d'informations concernant le DNS. </p>
d2406 2
a2407 2
  valid&eacute;e pour marcher avec <a href="http://www.inode.at">Inode</a>, un 
  fournisseur d'acc&egrave;s ADSL en Autriche. </p>
d2409 1
a2409 1
  ajout&eacute; &agrave; l'arborescencerscence des ports OpenBSD APRES la sortie de OpenBSD 
d2411 1
a2411 1
  se trouve sous <i>/usr/ports/net/pptp</i>. Consultez <a href="faq8.html#Ports">FAQ 
d2443 1
a2443 1
  2.8-stable (consultez la page web <a href="../stable.html">OpenBSD Stable</a> 
d2523 1
a2523 1
$Translation: faq6.html,v 1.12 2002/02/21 15:26:19 saad Exp $<br>
@


1.1
log
@
sync with badlands translation CVS.
@
text
@d25 9
a33 8
  <li><a href= "#PF"    >6.2 - Packet Filter (PF)</a>
<li><a href= "#NAT"   >6.3 - Network Address Translation</a>
<li><a href= "#DHCP"  >6.4 - Dynamic Host Configuration Protocol</a>
<li><a href= "#PPP"   >6.5 - Point to Point Protocol</a>
<li><A href= "#Tuning">6.6 - Tuning networking parameters</a>
<li><a href= "#NFS"   >6.7 - Using NFS</a>
<li><a href= "#DNS"   >6.8 - Domain Name Service  - DNS, BIND, and named</a>
<li><a href= "#PPTP"  >6.9 - Setting up a PPTP connection in OpenBSD</a>
d390 8
a397 12
<h5>Note: Packet Filter is the filtering system in OpenBSD 3.0 and 
later.  If you are looking for the IPF/IPNAT FAQ for OpenBSD 2.9 and 
before, click <a href="faqipf.html">here</a>.</h5>
<p></p>
<p>
The Packet Filter subsystem was created to handle two tasks, dealing 
with packet level forwarding permissions and mapping hosts/subnets to 
a range of external addresses.  The configuration files for these 
two services are 
<i><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&sektion=5">/etc/pf.conf(5)</a></i> 
and 
<i><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=nat.conf&sektion=5">/etc/nat.conf(5)</a></i>.
d399 2
a400 6
<p>
To start these services with your system, you need to edit
<i><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc.conf&sektion=8">/etc/rc.conf(8)</a></i>
and set the line to:
</p>

d405 8
a412 15
<p>
If you are using NAT, you will most likely also need to set
the <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&sektion=8">sysctl(8)</a>
value <tt>net.inet.ip.forwarding</tt> to 1. You can do this by
uncommenting the relevant lines in 
<i><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl.conf&sektion=5">/etc/sysctl.conf(5)</a></i>
and rebooting your computer.
</p>
<p>
If you have Packet Filter compiled into your kernel, but you
don't have it turned on in your
<i><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc.conf&sektion=8">/etc/rc.conf(8)</a></i>
file, you can still activate it with the
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&sektion=8">pfctl(8)</a> command.
</p>
d419 6
a424 7
<p>
The first line sets up filtering, using <i>/etc/pf.conf</i> and the 
second sets up NAT, using <i>/etc/nat.conf</i> (more on NAT later 
in <a href="#NAT">Section 6.3, NAT</a>), and finally, the last line 
activates PF.
</p>
This can also be combined into one command line:
d428 2
a429 5
<p>
If you make changes to <i>/etc/pf.conf</i> after 
PF is started, you can reload your rules by reloading the 
appropriate file:
</p>
d434 9
a442 12
<p>
This document will cover some basic 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&sektion=5">pf.conf(5)</a>
and <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=nat.conf&sektion=5">nat.conf(5)</a> 
configurations below.  You can also look at the <a href="#sample_pf.conf">resulting 
ruleset</a> that includes all the tweaks explained below in more detail.
You can find other Packet Filter information
at the <a href="http://www.benzedrine.cx/pf.html">Packet Filter web site</a> 
and in the 
<a href="http://www.inebriated.demon.nl/pf-howto/">Packet Filter HOWTO</a>. 
</p>

d447 13
a459 17
<p>
In order to enable Packet Filter at boot, you will need to 
modify <i>/etc/rc.conf</i> so that it reads <tt>pf=YES</tt>.  Packet Filter (pf)
is controlled by <i>/etc/pf.conf</i>, which is read at boot. For a 
more detailed explanation, see 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&sektion=5">pf.conf(5)</a>. 
In the examples that follow, <tt>fxp0</tt> will represent the external 
interface to the internet. It will be different for you, 
based on the ethernet adapter present in your computer. These 
rules will assume full-time internet connectivity, such as 
you would see on a webserver.
</p>

<p>
Packet Filter rules are processed sequentially from top to bottom; 
it helps to visualize each packet having to traverse every 
rule before it reaches its destination.
d461 2
a462 5

<p>
For example, the default ruleset provided allows all packets 
to travel in, and all packets to travel out:

d468 1
a468 1
This is shorthand, for:
d474 20
a493 23
which can be read as &quot;pass incoming packets from any source to 
any destination&quot;, with an implied &quot;on any interface (which is 
always implied if a specific interface isn't specified) of any
address family, <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=inet&sektion=4">inet (v4)</a> or <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=inet6&sektion=4">inet6 (v6)</a>&quot;.
<p></p>
<p>
Obviously, this isn't much of a filter.  More useful filtering
will be based on the address family (IPv4 or IPv6), protocol(s) 
and port(s) used by the services
you wish to filter.  Any of the protocols listed in
<i><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=protocols&sektion=5">/etc/protocols(5)</a></i>
can be specified, by either name or number, but we will
concern ourselves with
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcp&sektion=4">tcp(4)</a>,
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=udp&sektion=4">udp(4)</a> and
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=icmp&sektion=4">icmp(4)</a>.
</p>

<p>
Now let's say we don't want to allow any incoming IPv4 connections to 
TCP port 3306 (MySQL) because the database should only be connected 
to from localhost. Our ruleset would look like this:

d500 11
a510 15
This says &quot;block in all IPv4 (inet) incoming packets, from 
any source to 
any destination bound for tcp port 3306.&quot;  Note that 
it is required that you specify a protocol with any port-based
filter, and recommended that you specify the address family.  
For services defined in the
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=services&sektion=5">/etc/services(5)</a>
file, you can also use the service names, such as <em>www</em>
or <em>mysql</em>.
A packet destined for tcp port 3306 on interface 
<tt>fxp0</tt> will pass the first &quot;pass in&quot; rule and then 
be dropped by the &quot;block 
in port = 3306&quot; rule. If you reversed the order of our 
incoming rules (remember, order is important):

d517 8
a524 12
Packets destined for tcp port 3306 would pass because the last rule 
in the set allows all packets to pass. It is important to keep 
this in mind when writing packet filter rules:
<b>The last matching rule wins</b>.
<p></p>

<p>
Of course, there are exceptions to every rule. The <em>quick</em> 
option drops the packet at the first rule that matches. Let's 
look at our above flawed example, if we add <em>quick</em> to 
the &quot;block in&quot; rule:

d531 17
a547 22
<p>
A packet destined for our host on tcp port 3306 will hit the 
&quot;block in quick&quot; rule and be dropped immediately. All 
packets destined for other ports or protocols won't find a rule match until 
they reach our &quot;pass in&quot; rule that allows all packets 
to pass.
</p>

<b>Default Deny</b>
<p> The safest packet filtering policy is a default deny policy. 
All traffic not explicitly allowed is denied. This policy is far 
safer than explicitly denying each protected service, allows for 
smaller rulesets, and can protect from an accidentally 
misconfigured service that has been left exposed.
</p>
<p>
Let's now look at another example ruleset and explain 
things line by line. Here's an example for a webserver with a 
default deny policy that only allows ssh connections (for 
administration) and connections to http (port 80) and https 
(port 443).
</p>
d556 7
a562 8
<p>
This will allow incoming connections from anywhere to tcp ports 
22(ssh), 80(http), and 443(https). It will drop all other 
connection attempts, and allow all outgoing connections. This 
is a pretty tight ruleset.  But what if you only wanted to 
allow internal hosts on your 1.1.1.0 address block to connect 
to ssh, but allow outside connections to http and https?

d571 3
a573 4
Pretty good, but what if we only want to allow one machine 
(1.1.1.1) to administer the web server remotely?
In that case, we can change this:

d577 1
a577 1
to this:
d581 2
a582 1
<p></p>
d584 6
a589 7
<b>Sample Rules</b>
<p>
Here are some good rules for everyone to use (assuming that 
fxp0 is the external internet-connected interface). First we 
will set up a simple address spoofing protection.  These addresses
shouldn't (normally) be floating around the Internet, 
and if they are, it is rarely good, so we block them:
d597 4
a600 2
Our ruleset is starting to look pretty good; when we put 
it together, here is what it looks like:
a601 2
<ul><pre>
# don't allow anyone to spoof non-routeable addresses
d607 2
a608 1
# only allow our administration machine to connect via ssh
d611 2
a612 1
# allow others to use http and https
d615 2
a617 4
# finally lock the rest down with a default deny
block in quick on fxp0 from any to any

# and let out-going traffic out
d619 2
a620 1
</pre></ul>
d623 5
a627 5
<b>Packet Logging</b>
<p>
Now that's pretty good, but it could be better. What if we want to 
log any connection attempts to port 22(ssh) that get blocked by 
our firewall? Easy, Packet Filter can handle this with the <em>log</em> keyword:
d632 9
a640 15
This rule will allow our remote administration machine to connect 
to port 22, but deny and log all other attempts to connect to 
port 22.
<p></p>
<p>
Logged packets are sent to the pflog0 interface, which is monitored
by 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&sektion=8">pflogd(8)</a>,
which typically dumps the packets to <i>/var/log/pflog</i> in 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&sektion=8">tcpdump(8)</a>
binary format.  pflogd(8) is started by default by
<i><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc&sektion=8">/etc/rc(8)</a></i>
if pf is enabled in
<i><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc.conf&sektion=8">/etc/rc.conf(8)</a></i>.
You can read these log files using the following command:
d645 3
a647 4
<p>
One should be aware that using tcpdump to watch the pflog file does 
NOT give a real-time display.  If you wish a real-time display, you 
can use this command:
d651 2
a652 2
One could also use tcpdump to narrow down the focus to facilitate
debugging:
d656 21
a676 27
Doing this does NOT impact the data that is put to the file 
<i>/var/log/pflog</i>.  
<p></p>
<p>
When examining one's logs, especial care should be taken
with tcpdump's verbose protocol decoding (activated via the -v command
line option).  Tcpdump's protocol decoders do not have a perfect
security history.  At least in theory, a delayed attack could be
possible via the partial packet payloads recorded by the logging
device.
</p>
<p>
Additional care should be taken about access to the logs.  Pflogd
will capture 96 bytes of the packet and log it.  Access to the logs
could provide partial access to sensitive packet payloads (like
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=telnet&sektion=1">telnet(1)</a> or
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp&sektion=1">ftp(1)</a> logins).
</p>

<p>
<b>Multiple Protocols</b>
</p>
<p>
What if we need to allow connections to a service running 
over multiple protocols, such as bind, which uses TCP and UDP? 
Packet filter lets you lump options together into sets  
(more on this later): 
d678 1
a678 1
# Pass DNS traffic for BIND
d681 2
a682 2
Notice the spaces on both sides of the '{ }' characters.  This is 
neater than the alternative you might otherwise have to use:
d689 6
a694 9
<p>
<a name="normalization"></a>
<b> Packet Normalization</b>
</p>
<p> 
As some OSs and applications have trouble with abnormal or 
fragmented packets, it is sometimes beneficial to normalize the 
packets before they are passed on to their ultimate destination.
This is done with the <b>scrub</b> directive, used as here:
d698 9
a706 15
As this does put additional load on the system, there is no reason
to use this command unless this system is protecting a device
with a poor TCP/IP implementation
<p></p>

<p>
<b>IP Options</b>
</p>
<p>
By default, PF blocks packets with IP options set.  This can make
the job more difficult for &quot;OS fingerprinting&quot; utilities
like nmap.  If you have an application that requires the passing of 
these packets, such as multicast or IGMP, you can use the 
<b>allow-opts</b>
directive:
d712 8
a719 11
<p>
<b>TCP Flags, established connections and keeping state</b>
</p>
<p>
Packet Filter can also filter packets based on TCP flags and 
maintain established connections and connection state. It is 
recommend that all users who wish to filter packets based on 
TCP flags understand what role each flag plays. For instance, 
if you wanted to deny all packets with the FIN, URG, and PSH 
flags set (like for instance an nmap OS fingerprinting attempt) 
you could use a rule like this:
d723 12
a734 1
(Thanks to <a href=mailto:halogen@@nol.net>Kyle Hargraves</a> for that tip)
d736 17
a752 26
<p>
Packet Filter's next cool trick is its ability to maintain state. 
Maintaining state has been described as &quot;not speaking until 
spoken to&quot;; in other words, once a connection is established, 
packets no longer have to traverse rulesets. This is a very 
powerful feature allowing much simpler and more secure rule 
writing.
</p>
<p>
For example, let's see how we can apply state to our previous 
example ruleset (confused yet?). To review, we are allowing 
management access from our Class C to port 22(ssh) and allowing 
all incoming web traffic on ports 80(http) and 443(https). We 
are blocking all other traffic. But, what if I want to
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ssh&sektion=1">ssh(1)</a>
out of the webserver? What if I need to use
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=lynx&sektion=1">lynx(1)</a> to look up 
something in the FAQ? Well, I can't because I have blocked all 
incoming connections other than those on the specified ports. While 
this is the safest route, it can be quite inconvenient. By 
adding the <em>keep state</em> keywords to our &quot;pass 
out&quot; rule, we can automagically allow incoming 
connections in response to connections we initiate, such as 
when web browsing.  Remember, we do need to specify what 
protocol we are keeping state for.
</p>
d760 17
a776 14
<p>
This little change will dramatically increase the flexibility and
security of our ruleset: for instance, in the above ruleset, we are
allowing all tcp traffic into ports 80 &amp; 443. We can tighten this up
even more. In order for a tcp connection to be established, we only need
to allow the initial handshake to occur; once that occurs, we can block
traffic to that port and allow our &quot;keep state&quot; rule to manage
the connection. To allow the initial handshake to complete, we need only
allow packets with the SYN flag set and ACK flag not set. By passing only 
packets with SYN set, we can prevent many forms of portscanning such
as FIN scanning. flags S/SA means: out of flags S (SYN) and A (ACK), only
SYN may be set. Other flags aren't investigated.
The rules now look like this:
<ul><pre>
d781 5
a785 2
pass out on fxp0 proto tcp from any to any keep state
</pre></ul>
d787 12
a798 11
<p>
Let's start to tie things together by putting all of the rules we 
have so far into a ruleset. This ruleset will support IPv4, have 
a default deny policy, allow management connections from an 
internal network only (via ssh) and allow incoming traffic on 
ports 80(http) and 443(https). It will also protect against 
spoofed non-routeable ip addresses, and drop all packets that are 
too fragmented to inspect. A pretty comprehensive setup for a public 
webserver. Here's what <i>/etc/pf.conf</i> could look like:
<ul><pre>
# Clean up fragmented and abnormal packets
d801 2
a802 1
# don't allow anyone to spoof non-routeable addresses
d808 1
a808 1
# only allow our machines to connect via ssh
d811 1
a811 1
# allow others to use http and https
d815 1
a815 1
# finally lock the rest down with a default deny
d818 2
a819 1
# and let out-going traffic out and maintain state on established connections
d821 2
a822 1
</pre></ul>
d824 9
a832 14
<p>
While this may look good, there are some things Packet Filter 
will let you do to make your <i>pf.conf</i> file look neater and easier
to maintain.
</p>

<p>
<b>Sets</b>
</p>
<p>
Sets are useful "shortcuts" for writing simple and clear 
rules in PF.  For example, what if we need to allow 
connections to a service running
over multiple protocols, such as BIND, which uses TCP and UDP?
d836 1
a836 1
Note the spaces on both sides of the '{ }' characters. 
d838 4
a841 4
<p>
Groups of related IPs can be clustered together into sets, which 
can be used anywhere a single IP could be used.  For example, 
looking at our anti-spoofing rules above:
d849 2
a850 1
<p></p>
d852 6
a857 9
<p>
<b>Variable Expansion</b>
</p>
<p>
One problem with the above sample <i>pf.conf</i> file is that should
you need to change your NIC, or change an IP address, you would
need to change a number of lines.  This can be lessened by using
variable expansion:
</p>
d866 9
a874 10
<p>
<a name="sample_pf.conf"></a>
<b>Putting it all together</b>
</p>
<p>
Now, let's put it all together, and look at the elegance of the file:
<ul><pre>
# Define useful variables
ExtIF="fxp0"              # External Interface
IntNet="1.1.1.0/24"       # Our internal network
d878 1
a878 1
# Clean up fragmented and abnormal packets
d881 1
a881 1
# don't allow anyone to spoof non-routeable addresses
d885 1
a885 1
# only allow our machines to connect via ssh
d888 1
a888 1
# allow others to use http and https
d891 1
a891 1
# finally lock the rest down with a default deny
d894 1
a894 1
# and let out-going traffic out and maintain state on established connections
d896 2
a897 1
</pre></ul>
d900 2
a901 3
<p>
If you experience problems, you may want to enable logging on 
individual rules to effectively troubleshoot. ie: 
d905 38
a942 33
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&sektion=8">pflogd(8)</a> will write to ip log entries to <i>/var/log/pflog</i>.
Remember that <i>/var/log/pflog</i> is a binary file, intended to be
read by <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&sektion=8">tcpdump(8)</a>, NOT directly by humans.
<p></p>
<p>
When you modify the configuration file to log packets, don't 
forget to <b>pfctl -R /etc/pf.conf</b> for the changes to take affect! 
</p>

<p>
<h3>Differences between PF and IPF</h3>
<p></p>
<p>
Packet Filter (PF) was designed to be very compatible with IPF's 
<i>ipf.rules</i> file.  However, PF is not simply a drop-in replacement for IPF.
The main syntax differences for filtering (pf.conf) rules are as follows:
</p>
<ul>
<li><b>group and head:</b>  These options are no longer used,
as the filter rules are optimized on the fly.  If you are 
migrating your old rulesets from IPF, you should delete any <em>group</em>
or <em>head</em> definitions and manually reorder your rules, making sure
their semantics haven't changed.</li>
<li><b>level:</b> When logging, PF does not accept a <em>level</em> option to the log
keyword, as logging is not performed by <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=syslogd&sektion=8">syslogd(8)</a>, but by a separate 
logging daemon.  To examine a particular kind of traffic, as might have been
done with <em>level</em> option, use any of the available options of 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&sektion=8">tcpdump(8)</a>.</li>
<li><b>keep frags:</b>  This has been replaced by the normalization 
the <a href="#normalization">scrub</a> option performs.</li>
<li><b>@@n Rules:</b>  PF does not support prepending rules with <em>@@n</em>
to insert them into particular points in the rule list as IPF does.  To
view the rule numbers PF has assigned, use the command <tt>pfctl -sr</tt></li>
d948 1
a948 1
<h2>6.3 - NAT</h2>
d951 3
a953 3
<h5>Note: Packet Filter is the filtering system in OpenBSD 3.0 and
later.  If you are looking for the IPF/IPNAT FAQ for OpenBSD 2.9 and
before, click <a href="faqipf.html">here</a>.</h5>
d956 1
a956 3
<h3><u>6.3.1 NAT Introduction</u></h3>

<a name="nat1.1"></a>
d958 10
a967 11
<p>
Based on 
<a href="http://www.geektools.com/rfc/rfc1631.txt">RFC 1631</a>, 
NAT provides an easy way to map internal networks to a single 
routeable ("real") internet address. This is very useful if you 
don't have officially assigned addresses for every host on your 
internal network. When you set up private/internal networks, you 
can take advantage of reserved address blocks (assigned in 
<a href="http://www.geektools.com/rfc/rfc1918.txt">RFC 1918</a>), 
such as:
</p>
d975 46
a1020 52
<p>
The user is assumed to have already set up
and configured an OpenBSD machine with two network cards (one
connected to the Internet and the other to the local network).
</p>


<br>
<a name="nat1.3"></a>
<b>Configuration</b>

<p>
For the purpose of example, we will use the system described
below. Your setup will almost certainly vary from this, so be 
very careful in typing anything you see here literally into
your system and expecting it to work as you desire.  
</p>

<ul>
<b>NICs: </b>
<ul>
Intel EtherExpress Pro/100 <b>fxp0</b><br>
Connected to the EXTERNAL LAN (or WAN)<br>
<b>IP Address: </b>24.5.0.5<br>
<b>Netmask: </b>255.255.255.0<br>
<br>
Compaq Netelligent 10/100Mb <b>tl0</b><br>
Connected to the INTERNAL LAN<br>
<b>IP Address: </b>192.168.1.1<br>
<b>Netmask: </b>255.255.255.0<br>	
</ul>
<br>
<b>External, Internet-routeable IP (provided by ISP, in this example, a cable modem provider)<br></b>
<ul>
<b>IP Address: </b>24.5.0.5<br>
<b>Netmask: </b>255.255.255.0<br>
<b>Gateway: </b>24.5.0.1<br>
</ul>
<br>
<b>Local Area Network</b><br>
<ul>
In this example environment,
machines on the internal network use the IP addressing scheme 192.168.1.xxx
(where xxx is a unique number). There could be a variety of different
operating systems on the internal network, such as Windows 98,
Windows NT, OpenBSD and Linux, but the client OS is not an issue for NAT. 
For the examples, the client we will look at on the internal
network will be assumed to have an IP address of 192.168.1.40.
</ul>
<br>
<b>Diagram of Configuration</b>
<ul><pre>
d1033 1
a1033 1
		      | Client A  - 192.168.1.35 |
d1036 2
a1037 1
</pre></ul>
d1042 1
a1042 1
<h3><u>6.3.2 Network Address Translation</u></h3>
d1044 47
a1090 56

<a name="nat2.1"></a>
<b>Introduction to NAT</b>

<p>
Each node on the Internet requires a unique IP address.  At least
with IPv4, there is a very finite number of distinct IP addresses 
available, and as a result, they are not free.  Most "low-cost" ISPs
will limit a site to anywhere from 1 to 30 addresses, and while 
larger budget organizations may be able to afford a larger block, 
in most cases, there are relatively few benefits and considerable 
risks to having each computer individually addressable on the 
Internet.
</p>
<p>
Network Address Translation, or NAT, (also known as &quot;IP Masquerading&quot;
if you are coming from a Linux background) allows multiple computers
to be located &quot;behind&quot; one (or a small number of) IP address.  Each 
&quot;internal&quot; computer has a locally assigned, unregistered
IP address (per <a href="http://www.geektools.com/rfc/rfc1918.txt">RFC 1918</a>), 
and all utilize the same external IP address, simultaneously.  
</p>
<p>
The way NAT works is rather simple. When a client on the LAN
wants to connect to a machine on the Internet, it sends out a TCP
packet with a request to connect. Inside the TCP packet header is the
client's IP address (e.g. 192.168.1.40) and the requested host's IP
address (e.g. 123.45.67.89). The machine running NAT intercepts this
TCP packet and changes the client's IP address from 192.168.1.40 to
the IP address of the Internet-connected machine (e.g. 24.5.0.5). This
effectively tricks the host machine into thinking the actual connection
is from the NAT machine, not the actual client's machine. The host then
sends back responses to the NAT machine like it was the one connecting.
When the NAT machine receives the responses it quickly translates the
destination IP address back from itself to the client's machine and
sends the packet to the client. The client normally does not have any 
idea what happened and the apparent Internet connectivity is 
transparent to the user and user's applications.
</p>

<p>
The example below shows NAT a little more clearly:
</p>

<ul><pre>
Client ----------------- tl0 [ NAT ] fxp0 ---------- Internet Host
192.168.1.35 --- 192.168.1.1 [ NAT ] 24.5.0.5 --- 123.45.67.89

OUTGOING TCP Packet                     OUTGOING TCP Packet
From: 192.168.1.35  &gt;&gt;=== NAT ===&gt;&gt;     From: 24.5.0.5
To: 123.45.67.89                        To: 123.45.67.89

INCOMING TCP Packet                     INCOMING TCP Packet
From: 123.45.67.89 			From: 123.45.67.89
To:   192.168.1.40  &lt;&lt;=== NAT ===&lt;&lt;     To: 24.5.0.5
</pre></ul>
d1093 29
a1121 41
<a name="nat2.2"></a>
<b>Why use NAT?</b>

<p>
When presented with a cable modem in my new apartment I was also
presented with another minor problem. How to get Internet access for
my roommates, when the cable modem resides in my room? There were a
few options I could implement, ranging from obtaining extra IP
addresses, to setting up a proxy server, to setting up NAT.
(Don't let the home cable modem example fool you.  NAT is powerful enough
to masquerade a large network with hundreds or even thousands of computers!)
</p>

<p>
There are many reasons why I wanted to set up NAT. The number one
reason is to save money. There
are two roommates in my house, splitting the cost is certainly attractive.
Further, as each roommate has their own PC and I have three, we
had five computers to connect, but my ISP only allows for three IP 
addresses per household.  This means that there weren't enough IP 
addresses to allow every machine simultaneous direct Internet access.
</p>

<p>
By using NAT each machine will have a unique internal IP address
but share the one IP address given to me by my ISP. The cost goes down.
</p>

<br>
<a name="nat2.4"></a>
<b>Setup</b>

<p>
In order to enable NAT on your OpenBSD machine you will need to turn on
PF. This is easily accomplished by editing the files listed
below (make the changes to the file so it looks like the options below):
</p>

<p>
<b>/etc/rc.conf</b> (this file used to start services at boot time)
</p>
d1135 8
a1142 17
<p>
After these changes are made, the machine is now ready for the
configuration of NAT.
</p>

<br>
<a name="nat2.5"></a>
<b>Configuration</b>

<p>
The first step is to configure the PF configuration file
(<i><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&sektion=5">/etc/pf.conf</a></i>).
For the purposes of this document we will allow traffic to pass
through this firewall without any interference. The file
should look like this:
</p>

d1148 5
a1152 11
<p>
Again, for more information you can read <a href="#PF">FAQ 6, Packet Filter</a>
</p>

<p>
The NAT configuration file
(<i><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=nat.conf&sektion=5">/etc/nat.conf</a></i>).
has a very simple syntax.
For the configuration set forth above, the file should contain the
following entry:
</p>
d1158 1
a1158 3
<p>
Here is an explanation for the above lines.
</p>
d1161 3
a1163 4
<strong>"nat"</strong>
<p>
This indicates the command you are giving is a NAT rule.
</p>
a1164 1

d1166 1
a1166 4
<strong>"fxp0"</strong>
<p>
This is the network interface that is connected to the Internet.
</p>
d1170 4
a1173 6
<b>"192.168.1.0/24"</b>
<p>
the IP address and netmask (the netmask is in
CIDR format). Combined they state "any IP address of value
192.168.1.1 through 192.168.1.254" should be mapped. 
</p>
d1177 3
a1179 4
<b>"24.5.0.5"</b>
<p>
This is the external IP address the internal IP addresses will be mapped to.
</p>
d1182 4
a1185 13
<a name="nat2.6"></a>
<b>Running</b>

<p>
Once the configuration is
complete, there are two ways to enable NAT. The first (and best way if
possible) is to reboot your OpenBSD machine.
This is accomplished with the command "<i>reboot</i>". 
</p>

<p>
If you would like to configure NAT from the command line, use the following
commands:
d1187 2
d1195 8
a1202 6
<p>
The first line is to load a set of NAT rules into PF (and flushing any
old rules), the second line enables PF.  Again, though, rebooting is 
the best way to ensure that everything will startup from a reboot as 
you expect.
</p>
d1205 1
a1205 5
<p>
<b>Note:</b> in order to reload the NAT settings (in case you edit the file
but don't want to reboot) just execute the first command over again. The
settings will be flushed and reloaded.
</p>
d1207 1
a1207 3
<br>
<a name="nat3.0"></a>
<h3><u>6.3.3 Nat Knowledge Base</u></h3>
d1210 4
a1213 9
<a name="nat3.1"></a>
<b>Checking NAT Status</b>

<p>
To find out how NAT is doing or make sure the settings have taken
effect, you use the "-ss" option. This option will list all the
current sessions that NAT is running:
</p>

d1216 51
a1266 65
TCP  192.168.1.35:2132 -&gt; 24.5.0.5:53136 -&gt; 65.42.33.245:22       TIME_WAIT:TIME_WAIT
TCP  192.168.1.35:2492 -&gt; 24.5.0.5:55011 -&gt; 65.42.33.245:22       ESTABLISHED:ESTABLISHED
UDP  192.168.1.35:2491 -&gt; 24.5.0.5:60527 -&gt; 24.2.68.33:53       2:1
</pre></ul>

<p>
Explanations (first line, others are similar):
</p>
<ul>
<b>"192.168.1.35:2132"</b>
<p>
This tells you the IP address of the
machine on the LAN that is using NAT (192.168.1.35). The port number used to make
the connection (2132) is displayed afterwards.
</p>
</ul>
<ul>
<b>"24.5.0.5:53136"</b>
<p>
This denotes that the connection is going
to the Internet via IP address 24.5.0.5 and using port 53136.
</p>
</ul>
<ul>
<b>"65.42.33.245:22"</b>
<p>
The IP address and the port being connected to.
</p>
</ul>
<ul>
<b>"TIME_WAIT:TIME_WAIT"</b>
<p>
This indicates what state PF believes the TCP connection to be in.
</p>
</ul>

<a name="nat3.2"></a>
<b> Issues with FTP and NAT</b>

<p>
There are a few limitations of NAT, the most commonly encountered is
with FTP. You can use FTP in two ways: passive and active. Of these,
passive FTP is generally considered more secure.
</p>
<p>
With active FTP, when a user connects to a remote FTP server and
requests information or file, the FTP client sends the server a random
port number that the the FTP server will make a connection to on the
client and transfer the info. This is a problem for users attempting
to gain access to FTP servers from within the LAN. When the FTP server
sends its information it sends it to the external NIC at a random port.
The NAT machine will receive this, but because it has no mappings for
the unknown packet and doesn't have any mappings for that port, it will
drop the packet and won't deliver it.
</p>
<p>
With passive mode FTP (the default with OpenBSD <a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp&sektion=1">ftp(1)</a>
client), the client requests that the server picks up a random port
that it will listen on for the data connection. The server informs the
client of the port it has chosen, and the client connects to this port
to transfer the data. Unfortunately, this is not always possible or
desirable. ftp(1) uses this mode by default; to force active mode FTP,
use the -A flag to ftp, or set the passive mode to off by issuing
the command
d1271 1
a1271 1
at the ftp&gt; prompt.
d1273 6
a1278 6
<P>
Packet Filter provides another solution for this situation, redirecting 
FTP traffic through an FTP proxy server, a process which acts to "guide" your 
FTP traffic through the filters.  The FTP proxy used by OpenBSD and PF is 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&sektion=8">ftp-proxy(8)</a>.
To activate it, put something like this in your <i>/etc/nat.conf</i> file:
d1282 6
a1287 8
Short explanation of this line is, "Traffic on the internal interface is 
redirected to the proxy server running on this machine which is listening at
port 8081".
<p></p>
<P>
Hopefully, it is apparent the proxy server has to be started and running on 
the OpenBSD box, this is done by inserting the following line in 
<i>/etc/inetd.conf</i>:
d1291 3
a1293 3
and either rebooting the system or sending a 'HUP' signal to
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=inetd&sektion=8">inetd(8)</a>.
One way to send the 'HUP' signal is with the command:
d1297 20
a1316 26
You will note that ftp-proxy is listening on port 8081, the same port the above 
rdr statement was sending FTP traffic to.  The choice of port 8081 is arbitrary,
though 8081 is a good choice, as it is not defined for any other application.
<p></p>
<br>
<a name="nat3.3"></a>
<b>Redirecting Traffic</b>

<p>
For some applications, you may need to redirect incoming or outgoing 
traffic for a certain protocol and/or port to a particular machine behind
the filtering system. An example of this would be a computer residing inside 
the local network running a web server which was to be accessed by the outside world, 
(or of course, the already discussed ftp-proxy(8)). Incoming connections to 
your valid Internet IP will find that unless your NAT box is also running
a web server, no connection can be made. For this purpose we use the
NAT 'rdr' directive in the rules file to instruct where to redirect
a particular connection to.
</p>

<p>
For our example, lets say a web server resides on the LAN with IP address
of 192.168.1.80. The NAT rules file needs a new directive to handle this.
Add a line similar to the following one to your <i>/etc/nat.conf</i>:
</p>

d1321 1
a1321 3
<p>
The explanation for each part of this line:
</p>
d1323 6
a1328 5
<b>"rdr"</b>
<p>
This is the command you are giving NAT. It is telling NAT 
that this entry is an entry to redirect a connection. 
</p>
a1329 1

d1331 4
a1334 4
<b>"on fxp0"</b>
<p>
This is the network interface that is connected to the Internet.
</p>
a1335 1

d1337 1
a1337 5
<b>"from any to any"</b>
<p>
This indicates which IP addresses to redirect (from any coming in 
on fxp0, as indicated above, to any destination IP) 
</p>
a1338 1

d1340 5
a1344 8
<b>"port 80"</b>
<p>
This is the incoming port (80) that should be redirected. The number
"80" didn't have to be used. You can use "port www" also to specify
a redirection of port 80. If you would like to use a name instead of
a number, the service name and corresponding port, must exist in the
file <i>/etc/services</i>.
</p>
d1347 7
a1353 7
<b>"192.168.1.80 port 80"</b>
<p>
The IP address of the LAN machine which the packets are redirected to. 
Note that the destination port does NOT need to match the incoming port. 
For example, the following is valid, and even potentially useful:
<pre>
rdr on fxp0 from any to any port 8080 -&gt; 192.168.1.35 port 80
d1355 18
a1372 21
This line would redirect incoming traffic on port 8080 to a webserver
running on a machine in the internal network, at the "standard" port 80.
<p></p>
</ul>
<p>
When the addition is complete reload the NAT rules, and the redirection
will start immediately.
</p>
<p>
<b>Negation</b>
</p>
<p>
Sometimes, you need to make exceptions to a NAT or redirection rule.
Here's an example.  AOL Instant Messenger is noted for sneaking out 
firewalls through any available port.  You may find that the 
ftp-proxy is interfering with AIM when it chooses to go out to 
remote port 21.  In the event you consider this bad (many people 
spend considerable time trying to block AIM!), you might wish to 
exclude the IP addresses used by the AIM servers from the traffic
redirected by our above ftp-proxy line.  You can do this with the
following line:
d1376 8
a1383 7
Interpretation: Redirect traffic coming in on tl0 going to port 21 
but NOT to 64.12.163.199 (the AIM server users were having trouble
with) to localhost port 8081 (where
hopefully ftp-proxy is waiting).  Now, be advised that there are many
AIM servers, if this application interests you, you will probably 
have to play with these IP addresses (64.12.0.0/16 might be more 
productive, though probably also interferes with some non-AOL sites)
d1387 27
a1413 29
<a name="nat3.4"></a>
<b>NAT versus Proxy</b>

<p>
The difference between NAT and an application-based proxy is that the proxy
software acts as a middle-man between the Internet and the machines connected
on the LAN. This is fine, however each application you want to run on
your machine and connect to the Internet through the proxy server MUST
be proxy-aware (be able to use a proxy server). Not all applications are
able to do this (especially games). Furthermore, there simply are not
proxy server applications for all of the Internet services out there.
NAT transparently maps
your internal network so that it may connect to the Internet.  The only
security advantage to using a proxy software over NAT is that the proxy
software may have been made security aware, and can filter based on content,
to keep your Windows machine from getting a macro virus, it can protect
against buffer overflows to your client software, and more.  To maintain
these filters is often a high-maintenance job.
</p>

<a name="nat4.0"></a>
<b>6.3.4 Links and Cross-References</b>

<p>
OpenBSD files:
<ul>
<li>/etc/nat.conf - NAT rules file
<li>/etc/rc.conf - need to edit to start up NAT and PF at boot time
<li>/etc/sysctl.conf - need to edit to enable IP forwarding
d1417 7
a1423 6
<p>
NAT Internet Links:
<ul>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=nat.conf&sektion=5">nat.conf man page</a>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&sektion=8">pfctl man page</a>
<li><a href="http://www.geektools.com/rfc/rfc1631.txt">http://www.geektools.com/rfc/rfc1631.txt</a>
d1432 2
a1433 1
<h2>6.4 - DHCP</h2> 
d1436 6
a1441 5
<h3>6.4.1 DHCP Client</h3>
<p>To use the DHCP client <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dhclient&sektion=8">dhclient(8)</a>
included with OpenBSD, edit /etc/hostname.xl0
(this is assuming your main ethernet interface is xl0.  Yours might be ep0 or fxp0 or something else!)
All you need to put in this hostname file is 'dhcp'
d1445 5
a1449 5
This will cause OpenBSD to automatically start the DHCP client on boot.  OpenBSD will gather its IP address,
default gateway, and DNS servers from the DHCP server.  
<p>
If you want to start a dhcp client from the command line, make sure
/etc/dhclient.conf exists, then try:
d1453 9
a1461 6
Where fxp0 is the interface that you want to receive dhcp on.
<P>No matter how you start the dhclient, you can edit
the /etc/dhclient.conf file to <b>not</b> update your DNS according to the dhcp
server's idea of DNS by first uncommenting the 'require' lines in it (they are
examples of the default settings, but you need to uncomment them to override
dhclient's defaults.)
d1466 2
a1467 2
and then <b>remove</b> domain-name-servers.  Of course, you may want to remove
hostname, or other settings too.
d1469 1
a1469 1
<h3>6.4.2 DHCP Server</h3>
d1471 8
a1478 8
If you want to use OpenBSD as a DHCP server <A href="http://www.openbsd.org/cgi-bin/man.cgi?query=dhcpd&sektion=8">dhcpd(8)</a>,
edit /etc/rc.conf.  Set it up so that dhcpd_flags="-q" instead of dhcpd_flags=NO.
Put the interfaces that you want dhcpd to <b>listen</b> on in /etc/dhcpd.interfaces.
<pre>
# <strong>echo xl1 xl2 xl3 &gt;/etc/dhcpd.interfaces</strong>
</pre>
Then, edit /etc/dhcpd.conf.
The options are pretty self explanatory.
d1489 9
a1497 8
<p>
This will tell your dhcp clients that the domain to append to DNS requests is xyz.mil (so, if the user types in 'telnet joe' then it will
send them to joe.xyz.mil).  It will point them to DNS servers 192.168.1.3 and 192.168.1.5.  For hosts that are on the same network as
an ethernet interface on the OpenBSD machine, which is in the 192.168.1.0/24 range, it will assign them an IP address between
192.168.1.32 and 192.168.1.127.  It will set their default gateway as 192.168.1.1.
<p>
If you want to start dhcpd from the command line, after editing /etc/dhcpd.conf,
try:
d1499 46
a1544 51
# <strong>dhcpd -q fxp0</strong>
</PRE>
Where fxp0 is an interface that you want to start serving dhcp on.
The -q flag makes dhcpd quiet, otherwise it is very noisy.
<P>
If you are serving DHCP to a Windows box, you may want to
dhcpd to give the client a 'WINS' server address.
To make this happen, just the following line to your /etc/dhcpd.conf:
<pre>
option	netbios-name-servers	192.168.92.55;
</pre>
(where 192.168.92.55 is the IP of your Windows or Samba server.)
See <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dhcp-options&sektion=5">dhcp-options(5)</a> for more options that your DHCP
clients may want.
<p>
<a name= "PPP"></a>
<a name= "6.5"></a>
<h2>6.5 - PPP </h2>
<p></p>

Point-to-Protocol is generally what is used to create a connection to your ISP via your modem. OpenBSD has 2 ways of doing this. 

<ul>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pppd&sektion=8">pppd(8)</a> - Which is
the kernel ppp daemon.
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ppp&sektion=8">ppp(8)</a> - Which is
the userland ppp daemon. 
</ul>

<p>
The first one we will cover will be the userland PPP daemon. To start off you will need some simple
information about your isp. Here is a list of helpful information that you will need.
</p>

<ul>
<li>Your ISP's dialup number
<li>Your nameserver 
<li>Your username and password.
<li>Your gateway
</ul>

<p>
Some of these you can do without, but would be helpful in setting up your ppp. The userland PPP daemon uses
the file <a href="http://www.openbsd.org/cgi-bin/cvsweb/src/etc/ppp/ppp.conf.sample">/etc/ppp/ppp.conf</a> as
its configuration file. There are many helpful files in <b>/etc/ppp</b> that can have different setups for
many different situations. You should take a browse though that directory.
</p>

<p>
Also, make sure, that if your not using a GENERIC kernel, that you have this line in your configuration file:
</p>
d1551 11
a1561 11
<h3>Initial Setup - for PPP(8)</h3>

<p>
Initial Setup for the userland PPP daemon consists of editing your <b>/etc/ppp/ppp.conf</b> file. This file
doesn't exist by default, but there is a file <b>/etc/ppp/ppp.conf.sample</b> in which you can simply edit to
create your own <b>ppp.conf</b> file. Here I will start with the simplist setup and probably most used setup.
Here is a quick <b>ppp.conf</b> file that will simply connect to your ISP and set your default routes and
nameserver. With this file all the information you need is your ISP's phone number and your username and
password.
</p>

d1572 26
a1597 13
<p>
<b>NOTICE</b> - On OpenBSD 2.6, the system shipped with a <i>/etc/ppp/ppp.conf.example</i> that had an incorrect setting for device. The device was <i>"set device /dev/cuaa0"</i>. This should be <i>/dev/cua00</i> which would correspond to serial device 1. (COM1). Your device might not be on COM1, however the naming scheme was wrong.
</p>

<p>
The section under the <b>default:</b> tag will get executed each time. Here we setup all our critical
information. Here with &quot;set log&quot; we set our logging levels. This can be changed, refer to 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ppp&sektion=8">ppp(8)</a> for more info on
setting up logging levels. Our device gets set with &quot;set device&quot;. This is the device that the modem
is on. In this example the modem is on com port 2. Therefore com port 1 would be /dev/cua00. With &quot;set
speed&quot; we set the speed of our dialup connection and with &quot;set dial&quot; we set our dialup
parameters. With this we can change our timeout time, etc. This line should stay pretty much as it is though.
</p>
a1599 5
Now we can move on and setup our information specific to our ISP. We do this by adding another tag under our
<b>default:</b> section. This tag can be called anything you want, easiest to just use the name of your ISP.
Here I will use <b>myisp:</b> as our tag referring to our ISP. Here is a simple setup incorporating all we need
to get ourselves connected.
<p>
d1603 1
a1603 1
myisp:
d1613 12
a1624 10
<p>
Here we have setup essential info for that specific ISP. The first option &quot;set phone&quot; sets your
ISP's dialup number. The &quot;set login&quot; sets our login options. Here we have the timeout set to 5, this
means that we will abort our login attempt after 5 seconds if no carrier. Otherwise it will wait for
&quot;login:&quot; to be sent and send in your username and password. In this example our Username = ppp and
Password = ppp. These values will need to be changed. The line &quot;set timeout&quot; sets the idle timeout for
the entire connection duration to 120 seconds. The &quot;set ifaddr&quot; line is a little tricky. Here is a more
extensive explanation.
</p>

d1629 48
a1676 46
<p>
In the above line, we have it set in the format of &quot;<b>set ifaddr [myaddr[/nn] [hisaddr[/nn] [netmask
[triggeraddr]]]]</b>&quot;. So the first IP specified is what we want as our IP. If you have a static IP address, you set it here. In our example we use /0
which says that no bits of this ip address need to match and the whole thing can be replaced. The second IP
specified is what we expect as their IP. If you know this you can specify it. Again in our line we don't know
what will be assigned, so we let them tell us. The third option is our netmask, here set to 255.255.255.0.If
triggeraddr is specified, it is used in place of myaddr in the initial IPCP negotiation.  However, only an
address in the myaddr range will be accepted.  This is useful when negotiating with some PPP implementations
that will not assign an IP number unless their peer requests ``0.0.0.0''.
</p>

<p>
The next option used &quot;add default HISADDR&quot; sets our default route to their IP. This is 'sticky',
meaning that if their IP should change, our route will automatically be updated. With &quot;enable dns&quot;
we are telling our ISP to authenticate our nameserver addresses. Do NOT do this if you are running an local
DNS, as ppp will simply circumvent its use by entering some nameserver lines in /etc/resolv.conf.
</p>

<h3>Using PPP(8)</h3>

<p>
Now that we have our <b>ppp.conf</b> file setup we can start trying to make a connection to our ISP. I will
detail some commonly used arguments with ppp.
</p>

<ul>
<li><b>ppp -auto myisp</b> - This will run ppp, configure your interfaces and connect to your isp and then go
into the background.
<li><b>ppp -ddial myisp</b> - This is similar to -auto, but if your connection is dropped it will try and
reconnect.
</ul>

<p>
By using <b>/usr/sbin/ppp</b> with no options will put you into interactive mode. From here you can interact
directly with the modem, it is great for debugging problems in your <b>ppp.conf</b> file.
</p>

<h3>ppp(8) extras</h3>

<p>
In some situations you might want commands executed as your connection is
made or dropped. There are two files you can create for just these
situations. <b>/etc/ppp/ppp.linkup</b> and <b>/etc/ppp/ppp.linkdown</b>.
Sample configurations can be viewed here:
</p>

d1682 3
a1684 3
<p>
Extended information can be found at <a href="http://www.freebsd.org/doc/en_US.ISO8859-1/books/handbook/userppp.html">FreeBSD Handbook entry on User PPP</a>. 
</p>
d1689 1
a1689 1
<h2>6.6 - Tuning networking parameters</h2>
d1691 7
a1697 6
<H3>6.6.1 - How can I tweak the kernel so that there are a higher number of retries and longer timeouts for TCP sessions?</h3>
You would normally use this to allow for routing or connection problems.
Of course, for it to be most effective, both sides of the connection
need to use similar values.
<P>
To tweak this, use <tt>sysctl</tt> and increase the values of:
d1703 14
a1716 14
Using sysctl -a, you can see the current values of these (and many other)
parameters.  To change one, use <tt>sysctl -w</tt>, as in <tt>sysctl -w
net.inet.tcp.keepidle=28800</tt>.  
<h3>6.6.2 - How can I turn on directed broadcasts?</h3>
Normally, you don't want to do this.  This allows someone to send
traffic to the broadcast address(es) of your connected network(s) if you
are using your OpenBSD box as a router.<P>
There are some instances, in closed networks, where this may be useful,
particularly when using older implementations of the NetBIOS protocol.
This is another sysctl.  <Tt>sysctl -w net.inet.ip.directed-broadcast=1</tt> 
turns this on.  Read about <a href="http://www.netscan.org">smurf attacks</a>
if you want to know why it is off by default.
<H3>6.6.3 - I don't want the kernel to dynamically allocate a certain port</h3>
There is a sysctl for this also.  From <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&sektion=8">sysctl(8)</a>:
d1718 6
a1723 4
Set the list of reserved TCP ports that should not be allocated by the
kernel dynamically.  This can be used to keep daemons from stealing a
specific port that another program needs to function.  List elements may
be separated by commas and/or whitespace.
d1727 2
a1728 1
It is also possible to add or remove ports from the current list.
d1737 4
a1740 1
<h2>6.7 - Simple NFS usage</h2>
d1742 3
a1744 7

<p> NFS, or Network File System, is used to share a filesystem over the
network. A few choice man pages to read before trying to setup a NFS
server are:

<p>

d1751 28
a1778 30
<p>
This section will go through the steps for a simple setup of NFS. This example
details a server on a LAN, with clients accessing NFS on the LAN. It
does not talk about securing NFS. We presume you have already setup
packet filtering or other firewalling protection, to prevent outside access.
If you are allowing outside access to your NFS server, and you have
any kind of sensitive data stored on it, we strongly recommend that you employ 
<a href="faq13.html">IPsec</a>.  Otherwise, people can potentially see your NFS
traffic.  Someone could also pretend to be the IP address which you are 
allowing into your NFS server.  There are several attacks that can result.
When properly configured, IPsec protects against these types of attacks.
<P>
Another important security note.  Don't
just add a filesystem to /etc/exports without some kind of list of allowed
host(s). Without a list of hosts which can mount a particular directory,
anyone on who can reach your host will be able to mount your NFS
exports.
</p>

<p>
The setup consists of a server with the ip <b>10.0.0.1</b>. This server
will be serving NFS only to clients within that network. The first step to
setting up NFS is to setup your <i>/etc/exports</i> file. This file lists
which filesystems you wish to have accessible via NFS and defines who is
able to access them. There are many options that you can use in your
<i>/etc/exports</i> file, and it is best that you read the 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=exports&sektion=5">exports(5)</a>
man page. For this example we have an <i>/etc/exports</i> that looks like
this:
</p>
d1788 21
a1808 21
<p>
This means that the local filesystem <b>/work</b> will be made available
via NFS. <b>-alldirs</b> specifies that clients will be able to mount at
any point under the <b>/work</b> mount point. <b>-ro</b> specifies that it
will only be allowed to be mounted read-only. The last two arguments
specify that only clients within the 10.0.0.0 network using a netmask of
255.255.255.0 will be authorized to mount this filesystem. This is
important for some servers that are accessible by different networks.
</p>

<p> Once your <i>/etc/exports</i> file is setup, you can go ahead and
setup your NFS server. You should first make sure that options NFSSERVER
&amp; NFSCLIENT are in your kernel configuration. (GENERIC kernel has these
options included.) Next, you should set <strong>nfs_server=YES</strong> in
<i>/etc/rc.conf</i>. This will bring up both nfsd(8) and mountd(8) when
you reboot. Now, you can go ahead and start the daemons yourself. These
daemons need to be started as root, and you need to make sure that
portmap(8) is running on your system. Here is an example of starting
nfsd(8) which serves on both TCP and UDP using 4 daemons.  You should set
an appropriate number of NFS server daemons to handle the maximum number of
concurrent client requests that you want to service.
d1816 3
a1818 5
<p>
Not only do you have to start the nfsd(8) server, but you need to start
mountd(8). This is the daemon that actually services the mount requests on
NFS. To start mountd(8), make sure an empty mountdtab file exists, and run
the daemon:
d1826 2
a1827 4
<P>
If you make changes to /etc/exports while NFS is already running,
you need to make mountd aware of this!  Just HUP it:

d1834 1
a1834 1
<h3>Checking Stats on NFS</h3>
d1836 3
a1838 3
<p>
From here, you can check to make sure that all these daemons are up and
registered with RPC. To do this, use rpcinfo(8). 
d1856 6
a1861 7
<p> During normal usage, there are a few other utilities that allow you to
see what is happening with NFS. One is <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=showmount&sektion=8">showmount(8)</a>
, which allows you to view what is currently mounted and who is mounting
it. There is also nfsstat(8) which shows much more verbose statistics. To
use showmount(8), try <b>/usr/bin/showmount -a host</b>. For
example:

d1870 1
a1870 1
<h3>Mounting NFS Filesystems</h3>
d1872 5
a1876 6
<p>
NFS filesystems should be mounted via mount(8), or more specifically,
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mount_nfs&sektion=8">mount_nfs(8)</a>.
To mount a filesystem /work on host 10.0.0.1 to local filesystem /mnt,
do this (note that you don't need to use an IP address, mount will resolve
host names):
d1883 2
a1884 3
<p>
To have your system mount upon boot,
add something like this to your <i>/etc/fstab</i>:
d1891 5
a1895 5
<p>
It is important that you use <tt>0 0</tt> at the end of this line so that
your computer does not try to fsck the NFS filesystem on boot!!!!
The other standard security options, such as noexec, nodev, and nosuid,
should also be used where applicable.  Such as:
d1902 4
a1905 6
<p>
This way, no devices or setuid programs on the NFS server can subvert security measures
on the NFS client.  If you are not mounting programs which you expect
to run on the NFS client, add noexec to this list.


d1909 1
a1909 1
<h2>6.8 - Domain Name Service  - DNS, BIND, and named</h2>
d1912 1
a1912 1
<h3>6.8.1 What is DNS?</h3>
d1914 11
a1924 6
<p>
Domain Name Service is a network facility allowing IP network domains to provide name-to-IP address resolution and IP address-to-name resolution in response to a query. Your OpenBSD installation is configured by default as a DNS client but not as a DNS server. That is, your OpenBSD installation can perform a DNS query against a domain name server for the address of a machine, but it cannot answer such DNS queries itself unless you specifically configure it to do so.</p>

<p>
My OpenBSD machine is currently connected to the Internet via my ISP, so I can use the <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=nslookup&sektion=8">nslookup(8)</a> utility to execute the DNS query:
</p>
d1936 7
a1942 3
<p>
<b>165.87.201.244</b> is the name server which answered, because it is the nameserver that my ISP told me to use with my account and whose number is entered in <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=resolv.conf&sektion=5">/etc/resolv.conf</a>. But the answer was not authoritative. For an authoritative answer, let's find which is the authoritative DNS server for the <i>openbsd.org</i> domain and ask it for the address of <i>www.openbsd.org</i>:
</p>
d1975 102
a2076 59
<p>
<i>zeus.theos.com</i> is, one would suppose, running OpenBSD and is properly configured to be a DNS server for the <i>openbsd.org</i> domain.
</p>

<a name="DNS.1.1"></a>
<a name="6.8.1.1"></a>
<h3>6.8.1.1 Where can I learn all about DNS and its implementation under OpenBSD?</h3>

<ul>
<li>See RFCs <a href="http://www.faqs.org/rfcs/rfc1033.html">1033</a>, <a href="http://www.faqs.org/rfcs/rfc1034.html">1034</a>, and <a href="http://www.faqs.org/rfcs/rfc1035.html">1035</a> for more information on the Internet name-domain system.</li>
<li>Read the O'Reilly Associates book <i><a href="../books.html#6">DNS and BIND</a> </i>.</li>
<li>Read the <a href="http://www.openbsd.org/cgi-bin/man.cgi">OpenBSD Manual</a> especially the pages for</li>
	<ul>
	<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dig&sektion=1">dig(1)</a>
	<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=nslookup&sektion=8">nslookup(8)</a>
	<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=gethostbyname&sektion=3">gethostbyname(3)</a>
	<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=named&sektion=8">named(8)</a>
	<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=resolver&sektion=3">resolver(3)</a>
	<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=resolver&sektion=5">resolver(5)</a>
	</ul>
</ul>

<p>
The <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dig&sektion=1">dig(1)</a> command is especially useful, because it can query a domain and return information in much the same record format as required in BIND configuration files. You can use <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dig&sektion=1">dig(1)</a> to examine name servers you know to be operating properly as a way of comparing your setup to theirs.
</p>

<h3>6.8.2 Does my machine need to be a domain name server?</h3>

<p>
If you aren't sure that you need your machine to perform the role of DNS server, don't configure it as one. The OpenBSD installation does not, by default, activate your machine as a domain name server, though all necessary files are installed. For most workstations, just the <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hosts&sektion=5">/etc/hosts</a> file naming local machines' IP addresses and the <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=resolv.conf&sektion=5">/etc/resolv.conf</a> file for indicating which DNS servers serve you out on the intranet or internet is sufficient.
</p>

<p>
On the other hand, you might need to set up a machine as a domain name server:
<ul>
<li>If you have an IP LAN on which you do not wish to replicate "hosts" files of local addresses machine by machine. In such a case, you may configure your OpenBSD machine as a DNS server and serve queries from the other machines on your LAN.</li>
<ul>
<li><b>Note:</b> There is no practical restriction on the number of DNS servers on a LAN. Any or all machines on the LAN may offer DNS service if they are so configured. Whether any such server is considered authoritative from outside your LAN (or is even known from outside your LAN) is a configuration factor which typically is controlled at the next level up from your LAN in the domain hierarchy.</li>
</ul>
<li>If you have an IP LAN on which reside machines you will wish to be findable via DNS query by machines on another IP LAN or WAN.</li>
<li>If you experience difficulties resolving the local hostname to an IP address, or resolving other local names to IP addresses even though you have correct <i>/etc/hosts</i> and <i>/etc/resolv.conf</i> (E.g., Netscape on OpenBSD sometimes exhibits this behavior because it implements its own resolver instead of just using <i>gethostbyname(3)</i> to look up addresses.)</li>
</ul>

<p>
One more consideration is speed of execution. Since name resolution is an iterative process, in which the name server makes repeated queries to other nameservers for addresses in remote domains, name resolution may take slightly longer if you have a modem connection to the Internet and are querying your own DNS server for remote addresses (which will then iteratively query remote name servers via the modem) than if you are querying your ISP's name server (which probably has a faster connection to remote name servers).
</p>

<h3>6.8.3 What are the software components of the DNS server?</h3>

<ul>
<li>named <i>("name daemon")</i></li>
<li>Configuration files in the directory hierarchy under <i>/var/named/</i></li>
</ul>

<h4>6.8.3.1 What level of BIND is supported?</h4>

<p>
BIND is the name of the behavioral specification of a domain name server. Domain name server components exist to collectively implement BIND. 
</p>
a2077 2
<p>
There are three distinct BIND specifications:
d2084 35
a2118 30
<p>
As installed, OpenBSD <b>named</b> supports BIND 4.x.

<h4>6.8.3.2 What are some of the alternatives to providing DNS via the default BIND 4.x implementation?</h4>

<ul>
<li>The BIND 9.x implementation in <i>/usr/ports/net/bind9</i>.(See <a href="../ports.html">ports</a>)
</ul>

<h5>6.8.3.2.1 <u>Security</u> note</h5>

<p>
If you use these alternative implementations of domain name service, you are providing a critical network service using software which may not have been subject to quite the same level of scrutiny as the <a href="http://www.openbsd.org/security.html">security-audited</a> <b>named</b> name daemon in the base installation. This is a significant consideration, since if a domain name server is compromised, resolvers using that name server can be re-directed to impostor sites.
</p>

<h3>6.8.4 How much do I have to install?</h3>

<p>
If the default networking setup was installed properly at OpenBSD installation time, everything is already installed. You just have to configure the name daemon ("<tt>named</tt>").
</p>

<h3>6.8.5 How do I configure DNS?</h3>

<p>
You configure OpenBSD DNS by editing and/or creating files that control the name daemon <tt>named</tt>. These files reside by default in the directory <i>/var/named</i> and its subdirectories, especially the file <i>/var/named/named.boot</i> which is the initialization file for <b>named</b>. There are also a couple of other configuration steps to be taken in <i>/etc</i>.
</p>

<p>
In this document, we will configure the name daemon on <i>nemo.yewtopia.com</i> be the primary nameserver for the (very small!) domain <i>yewtopia.com</i>. The address of <i>nemo.yewtopia.com</i> is <i>192.168.1.9</i>. Two other machines are on that subnet, <i>crater.yewtopia.com </i>at 192.168.1.1 and <i>earhart.yewtopia.com</i> at 192.168.1.2.
</p>
d2120 1
a2120 1
<h4>6.8.5.1 Configuration in <i>/var/named</i></h4>
d2137 3
a2139 3
<p>
This tells the initialization process in what subdirectory and under which filenames to find the configuration files for <i>yewtopia.com</i>. 

d2194 1
a2194 1
<h4>6.8.5.2 Configuration in <i>/etc</i></h4>
d2197 4
a2200 4
<p>
Make sure <i>/etc/resolv.conf</i> now points to the domain of local machine (instead of, for example, your ISP's name server) so that name resolution requests actually get sent to the <b>named</b> you have configured!
</p>

d2208 3
a2210 4
<p>
If you previously had added the addresses of various machines to the <i>/etc/hosts</i> file, you might consider shortening your <i>/etc/hosts</i> file back to the default:
</p>

d2217 10
a2226 5
<p>
So that <b>named</b> isn't bypassed in favor of (possibly outdated) addresses in the <i>/etc/hosts</i> file. <u>Make sure you have at least the default <i>localhost</i> entry</u> or your network won't start properly! Note also <i>nemo</i> must appear in its own hosts file or you will see a (mostly harmless) error message at bootup when <i>/etc/netstart</i> invokes <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=route&sektion=8">route(8)</a> in order to add <i>nemo</i> (whose name appears in <i>/etc/myname</i>).
</p>

<h4>6.8.5.3 Using <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dig&sektion=1">dig(1)</a> to examine the results.</h4>
d2259 6
a2264 8
<h3>6.8.6 How and when do I start and stop DNS?</h3>

<h4>6.8.6.1 Starting DNS</h4>

<p>
The name daemon <b>named</b> is launched during system startup from <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc&sektion=8">/etc/rc</a> if the line installed by default in <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc.conf&sektion=8">/etc/rc.conf</a>.
</p>

d2269 1
a2269 3
<p>
is changed to
</p>
d2275 1
a2275 4
<p>
Also, examine these lines in /etc/rc.conf:
</p>

d2281 5
a2285 9
<p>
These defaults will be correct for nearly all setups.
</p>

<p>
To start <b>named</b> by hand, use the <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ndc&sektion=8">ndc(8)</a> command. For example:
</p>

<ul><pre>
d2287 1
a2287 1
          or
d2289 2
a2290 3
</pre></ul>

<h4>6.8.6.2 Stopping DNS</h4>
d2292 1
a2292 3
<p>
The best way to stop the name daemon is to use the <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ndc&sektion=8">ndc(8)</a> command. For example:
</p>
d2294 3
d2301 4
a2304 2
<p>
If this fails to work, find the process id of named and use the <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=kill&sektion=1">kill(1)</a> command to end that process. The PID for <b>named</b> while it is running is found as the first line in the file <i>/var/named/named.pid</i>
a2305 1

d2313 1
a2313 5
<h4>6.8.6.3 Restarting DNS with an altered configuration</h4>

<p>
To cause a running instance of the name daemon to restart itself reloading its configuration after you have made changes, send it a "hangup" signal:
</p>
d2315 3
d2322 2
a2323 3
<p>
or by using the <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ndc&sektion=8">ndc(8)</a> command. For example:
</p>
d2329 2
a2330 3
<h3>6.8.7 How do I block AXFR queries? </h3>
<p>
example:
d2342 10
a2351 6
<p>
This information is useful for debugging DNS, but in some instances you may not want this output publicly offered.
If you are using classless in-addr(rfc2317) for reverse, host -l may report every domain that your system hosts!
This can easily be remedied by the 'allow-transfer' clause in your zone file.
<br><br>
If you're using Bind8 you need to specify the hosts you want to allow to transfer zones in your individual zone file(s):
d2363 3
a2365 1
You can also block transfers for all domains by editing /var/named.conf and add the 'allow-transfer' parameter to the 'options' section of the configuration file:
d2371 3
a2373 2
The Bind8 method also works with Bind9.<br>
If you are using Bind 4 (default in OpenBSD) you can edit /var/named/named.boot and use the 'xfrnets' option.<br>
d2379 38
a2416 11
</pre></ul><br>
Bind 4 allows transfers from entire classes so it is not as exact.
Typically, the only hosts that need to perform transfers are your DNS slaves and hosts you may want to debug from (127.0.0.1 is usually a good host to
allow transfers from!)
Blocking AXFR queries adds an extra level of privacy, but can hinder useful DNS debugging.
(Thanks to <a href=mailto:ntang@@nachtwache.org>Nicholas Tang</a> for that tip)
<p></p>
<h3>6.8.8 What didn't you tell me about setting up DNS?</h3>
<p>
There's a lot we didn't tell you, for example, how to set up DNS so that queries for intranet domains that aren't visible from the root of the domain hierarchy get relayed to servers within your enterprise. Read the <a href="#DNS.1.1">documents we recommended</a> for more information on DNS. 
</p>
d2418 1
a2418 5
<p>
<a name= "PPTP"></a>
<a name="6.9"></a>
<h2>6.9 - Setting up a PPTP connection in OpenBSD</h2>
<p></p>
d2420 3
a2422 14
<p>
<strong>NOTE:</strong> This does not apply to <strong>ALL</strong> ADSL providers, but much information can be gleaned from the setup here. This is known to work for <a href="http://www.inode.at">Inode</a>, an ADSL provider in Austria.
</p>

<p>
To start off, you need to install pptp. A port was added to the OpenBSD ports tree AFTER the release of OpenBSD 2.8 and works fine with with the OpenBSD 2.8 ports tree. The port is located at <i>/usr/ports/net/pptp</i>. Read <a href="faq8.html#Ports">FAQ 8, Ports</a> for more information on the OpenBSD ports tree.
</p>

<p>
Because of a conflict between the In-Kernel <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=gre&sektion=4">gre(4)</a> support and pptp, you will need to re-compile your kernel, removing support for gre(4).
</p>

<ul>Patch to remove GRE(4) support.
<pre>
d2438 2
a2439 5
</pre></ul>

<p>
To recompile your kernel, check out OpenBSD 2.8-stable via cvs (refer to <a href="../stable.html">OpenBSD Stable</a> web page for more information), apply the following patch, and rebuild your kernel as per <a href="faq5.html#Building">FAQ 5, Building a kernel</a>.
</p>
d2441 11
a2451 4
<p>
After you have the <b>pptp</b> package installed and a new kernel, you need to edit a few files to setup for your connection. This packages uses the in-house OpenBSD 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ppp&sektion=8">ppp(8)</a>, so if you are familiar with ppp(8), much of the setup is the same. Also, refer to <a href="#PPP">FAQ 6, PPP</a>.
</p>
d2458 2
a2459 5
<p>
For the <i>/etc/ppp/options</i> file, a setup like below will most likely
do all that you need:
</p>

d2469 1
a2469 6
<p>
<tt>LOGINNAME</tt> should be replaced with your User-ID.
</p>

<p>
The <i>/etc/ppp/pap-secrets</i> a line like:
d2471 1
d2477 13
a2489 12
<p>
Where LOGINNAME is your User-ID and PASSWORD is your password. 10.0.0.138 is the IP assigned to your MODEM in the case that you are using ADSL, etc. Make sure this file stays readonly by root (mode 600).
</p>

<h3>6.9.1 - Assigning an address to your Network Interface</h3>

<p>
In the above example, our modem came with a preconfigured interface of 10.0.0.138. We now need to assign an address to OUR interface, It's best to pick an IP close to the one given by your MODEM, or use the static IP assigned to you. Read more about setting up interfaces in <a href="#Setup">FAQ 6, Setup</a>.
</p>

<p>
Once your interface is setup, you should be able to create a pptp connection with the command.
d2495 3
a2497 4
<p>
Since this uses the in-house OpenBSD ppp(8), two processes are started. You can kill pptp by killing both these processes:
</p>

d2503 2
a2504 2
It is recommended to open <tt>/var/log/messages</tt> in a extra terminal window, to recognize possible problems.

d2511 5
a2515 11
<p>
We also suggest that you put the startup command in <i>/etc/rc.local</i> so that you automatically connect on reboot.
</p>

<p>
<font color= "#0000e0">
<a href= "index.html">[Back to Main Index]</a>
<a href= "faq5.html">[To Section 5.0 - Kernel configuration and Disk Setup]</a>
<a href= "faq7.html">[To Section 7.0 - Keyboard controls]</a>
</font>
</p>
d2522 1
a2522 1
$Translation: faq6.html,v 1.4 2002/02/14 11:23:56 saad Exp $<br>
@

