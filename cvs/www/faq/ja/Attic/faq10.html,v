head	1.15;
access;
symbols;
locks; strict;
comment	@# @;


1.15
date	2005.08.13.08.19.33;	author saad;	state dead;
branches;
next	1.14;

1.14
date	2004.05.09.09.58.22;	author saad;	state Exp;
branches;
next	1.13;

1.13
date	2004.04.17.19.33.21;	author jufi;	state Exp;
branches;
next	1.12;

1.12
date	2004.03.10.14.41.49;	author jufi;	state Exp;
branches;
next	1.11;

1.11
date	2004.03.01.09.48.23;	author jufi;	state Exp;
branches;
next	1.10;

1.10
date	2004.01.04.22.43.22;	author horacio;	state Exp;
branches;
next	1.9;

1.9
date	2003.11.03.16.52.23;	author jufi;	state Exp;
branches;
next	1.8;

1.8
date	2003.11.03.15.07.08;	author horacio;	state Exp;
branches;
next	1.7;

1.7
date	2003.10.28.12.31.17;	author horacio;	state Exp;
branches;
next	1.6;

1.6
date	2003.10.26.23.26.52;	author horacio;	state Exp;
branches;
next	1.5;

1.5
date	2003.10.22.16.51.54;	author horacio;	state Exp;
branches;
next	1.4;

1.4
date	2003.09.19.16.38.11;	author horacio;	state Exp;
branches;
next	1.3;

1.3
date	2003.06.21.10.00.37;	author jufi;	state Exp;
branches;
next	1.2;

1.2
date	2003.05.10.13.21.29;	author jufi;	state Exp;
branches;
next	1.1;

1.1
date	2003.04.15.17.18.58;	author jufi;	state Exp;
branches;
next	;


desc
@@


1.15
log
@remove unmaintained [ja] translation files. requested by translator.
@
text
@<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>10 - System Management</title>
<link rev= "made" href= "mailto:www@@openbsd.org">
<meta http-equiv="Content-Type" content="text/html; charset=iso-2022-jp">
<meta name= "resource-type" content= "document">
<meta name= "description"   content= "the OpenBSD FAQ page">
<meta name= "keywords"      content= "openbsd,faq">
<meta name= "distribution"  content= "global">
<meta name= "copyright"     content= "This document copyright 1998-2004 by OpenBSD.">
</head>

<body bgcolor= "#ffffff" text= "#000000">

<img alt="[OpenBSD]" height=30 width=141 src="../../images/smalltitle.gif">
<p>

<font color= "#0000e0">
<a href="index.html">[FAQ の目次]</a>
<a href="faq9.html">[9 章 - Linux からのお引っ越し]</a>
<a href="faq11.html">[11 章 - パフォーマンスのチューニング]</a>
</font>

<h1><font color="#e00000">10 - システム管理</font></h1>
<hr>

<h3>Table of Contents</h3>
<ul>
<li><a href="#wheel"         >10.1 - su で root になろうとすると、グループが違うと言世錣譴泙鹿畩
殊蘊釈鱚羹■汀霪哂碓ぢファイルシステムを丸ごと複誓修垢襪砲鹿畩
殊蘊釈鱚羹■鱆碓ぢシステム内のデーモンはどのように起動するのでしょう ? (rc(8) の概要)</a>
<li><a href="#RelayingDenied">10.4 - ユーザが OpenBSD システム経由でリモートからメールを送ろうとすると、リレーアクセスが拒否されるのはどうしてでしょう ?</a>
<li><a href="#POP"           >10.5 - POP を誓瀋蠅靴燭里法椀ぢサーバにアクセスできなくて困っています。どうすれば良いのでしょう ?</a>
<li><a href="#SendmailDNS"   >10.6 - どうして sendmail は /etc/hosts を無視するのでしょう ?</a>
<li><a href="#HTTPS"         >10.7 - SSL(8) を使用したセキュアな HTTP サーバの誓瀋鹿畩
殊蘊釈鱚羹■頷碓續祚鞜齠ぢを vi(1) で編集したのに変更が反映されません。なぜでしょう ?</a>
<li><a href="#AddDelUser"    >10.9 - ユーザを追加するには ? &nbsp; また、削除するには ?</a>
<li><a href="#FTPOnly"       >10.10 - ftp 誓賤僖▲Ε鵐箸鮑鄒成するにはどうすればよいのでしょう ?</a>
<li><a href="#Quotas"        >10.11 - ユーザのディスク quota を誓瀋鹿畩
殊蘊釈鱚羹■妹鰲纈闢碓妹鰲纈闢のクライアントとサーバの誓瀋鹿畩
殊蘊釈鱚羹■綜闔瀞丐碓綜闔阨瀞サーバの誓瀋鹿畩
殊蘊釈鱚羹■胄鞦蓿闖槇碓胄鞣┯でユーザをホームディレクトリから出られないようにするには ?</a>
<li><a href="#Patches"       >10.15 - OpenBSD へのパッチの適用</a>
<li><a href="#httpdchroot"   >10.16 - Apache の chroot() って何でしょう ?</a>
<li><a href="#rootshell"     >10.17 - 標準の root のシェルが好きではありません !</a>
<li><a href="#ksh"           >10.18 - ksh で他に何ができますか ?</a>
</ul>

<hr>

<p>
<a name= "wheel"></a>
<h2>10.1 - su で root になろうとすると、グループが違うと言世錣譴泙鹿莢
腫既存のユーザが su するには、そのユーザを手作業で <kbd>&quot;wheel&quot;</kbd>
グループに追加する必要があります。これはセキュリティ上の理由によるものですので、
誰にそのアクセス権を付与するかについては十分に注意してくだ世気ぁ
緕帯では、<kbd>wheel</kbd> グループの人は
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=su&amp;sektion=1">su(1)</a>
ユーザランドプログラムを使用して root になることができます。
<kbd>&quot;wheel&quot;</kbd> にないユーザは
su(1) を使用することはできません。
<strong>ericj</strong> というユーザを <kbd>&quot;wheel&quot;</kbd> に追加するときに
<kbd>/etc/group</kbd> に追加する場合のエントリを以下に示します。

<p>
もし、新しいユーザの追加を
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=adduser&amp;sektion=8">adduser(8)</a>
で実行しているのでしたら、途中で "<tt>Invite <i>user</i> into other groups:</tt>"
という誓瀋蟾猝椶个討泙垢里如△海海蒹繻ぢと入力すれば wheel に追加されます。
これを実行すると /etc/group にその人が追加され、以下の例のようになります。

<blockquote><pre>
wheel:*:0:root,ericj
</pre></blockquote>

<p>
ユーザを <kbd>&quot;wheel&quot;</kbd> に加えずに、
スーパーユーザの特権の一部をユーザに使用させたい場合には、
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sudo&amp;sektion=8">sudo(8)</a>
を使用します。

<p>
<a name= "DupFS"></a>
<h2>10.2 - ファイルシステムを丸ごと複誓修垢襪砲鹿莢
腫ファイルシステムの複誓修砲
釈鱚羹∵雕關緕碵筮闥膀竍薛砠遲轣隨竍蘓髟纈糒逅逅雌繼闔集⊂糒逅┯と
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=restore&amp;sektion=8">restore(8)</a>
を使用します。たとえば、<kbd>SRC</kbd> ディレクトリ以下のものすべてを
<kbd>DST</kbd> に複誓修垢襪砲蓮⊆，里茲Δ砲靴泙后

錫跫站髟阡緇腫鱚首闔臂邃嘔短井邃柘垰纉鱚鱠鹿齡鳫鈑鹿頏緇鹿碎閭鞫
腫糒逅ぢは強力なバックアップ能力を備えるように誓澤廚気譴討い襪里如
単にファイルシステムの一部 (あるいは丸ごと)
を複誓修垢訥戮里海箸砲い舛い岨藩僂垢襪茲Δ覆發里任呂覆い眞里譴泙擦鵝修譴覆
釈鱚羹∵雕關緕碵筮闥膀竍薛砠遲轣隨竍蘓髟纈鬢瘢雹黼謾蜿扈陰浄癇┗コマンドのほうが高速です。形式はとても似ています。

<blockquote>
<pre>
# <strong>cd /SRC; tar cf -  . | (cd /DST; tar xpf - )</strong>
</pre>
</blockquote>

<p>
<a name= "rc"></a>
<h2>10.3 - システム内のデーモンはどのようにして起動するのでしょう ?
(rc(8) の概要)</h2>

<p>
OpenBSD は
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc&amp;sektion=8">rc(8)</a>
スタイルの起動をします。これは起動にいくつか鍵となるファイルを持っています。

<ul>
  <li>/etc/rc - 主スクリプトです。編集してはいけません。
  <li>/etc/rc.conf - <i>/etc/rc</i> が使用するファイルで、
      システム起動時にどのデーモンを起動すべきかを記述します。
  <li>/etc/rc.conf.local - /etc/rc.conf 自体には手を加えずに、
      /etc/rc.conf の誓瀋蠅縫璽弌璽薀ぅ匹靴道藩僂垢襪燭瓩寮設定ファイルです。
      しばしばアップグレードを行う人たちには便利なものです。
  <li>/etc/netstart - ネットワーク初期化に使うスクリプトです。
      編集してはいけません。
  <li>/etc/rc.local - ローカル管理のためのスクリプトです。
      新しいデーモンやホスト固有の情報は、ここに保存しましょう。
  <li>/etc/rc.securelevel - セキュリティレベルが変わる前に実行しなくてはならないコマンドを
      実行するスクリプトです。
      <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=init&amp;sektion=8">init(8)</a> を参照してくだ世気ぁ
殊蘊祟鼈粹ぢシャットダ瀬Ε鷸房孫圓気譴襯好螢廛箸任后
シャットダ瀬Ε鸛阿房孫圓気擦燭い海箸鬚垢戮討海海傍劼靴泙后
釈鱚羹∵雕關緕碵筮闥膀竍薛砠遲轣隨竍蘓髟纈鱆蔘阯遉瘢雹黼謾蜿扈権条祟鼈粹┯を参照してくだ世気ぁ
鹿
取馨鱆┯の仕組みは ?</h3>

<p>
システム管理者が誓貲阿垢戮舁廛侫．ぅ襪蓮
守少續祚鱆闔羲ぢまたは <i>/etc/rc.conf.local</i>)、
<i>/etc/rc.local</i> と <i>/etc/rc.shutdown</i> です。
rc(8) の進行のフローは以下のようになります。

<p>
カーネルが起動すると、<i>/etc/rc</i> が実行されます。
<ul>
  <li>まず、ファイルシステムをチェックします。これは /etc/fastboot ファイルがあれば省略されますが、
      もちろん省略することは望ましいことではありません。
  <li>誓瀋衢僂諒竸瑤蘊祟竢鈕鹿蘊ぢから読み込まれます。
      そしてその後、<i>/etc/rc.conf.local</i> が読み込まれます。
      rc.conf.local 中の誓瀋蠅祟竢鈕ぢの誓瀋蠅鬟璽弌璽薀ぅ匹靴泙后
殊蘊ファイルシステムをマウントします。
  <li><i>/tmp</i> をクリアして、エディタファイルは保存します。
  <li><i>/etc/netstart</i> によってネットワークの誓瀋蠅鮃圓い泙后
受貍
	殊蘊ネットワークインターフェースの誓瀋
	殊蘊ホスト名、ドメイン名等の誓瀋
鹿殊蘊システムデーモンを起動します。
  <li>その他の各種チェックを実行します (quota、savecore 等)。
  <li>ローカルデーモンを <i>/etc/rc.local</i> 経由で実行します。
</ul>

<h3>OpenBSD 付属のデーモンやサービスの起動</h3>

<p>
OpenBSD にデフォルトで附属しているデーモンやサービスのほとんどは、
<i>/etc/rc.conf</i> 誓瀋螢侫．ぅ襪鯤埆犬垢襪誓けでシステムの起動時に起動されるようになります。
まず、デフォルトの
<a href="http://www.openbsd.org/cgi-bin/cvsweb/src/etc/rc.conf">/etc/rc.conf</a>
ファイルを見てみましょう。
次のような行が多数あるはずです。

<blockquote><pre>
ftpd_flags=NO           # for non-inetd use: ftpd_flags="-D"
</pre></blockquote>

<p>
このような行は、ftpd はシステム起動時には起動されない、という意味になります
(少なくとも rc(8) 経由ではそうです。詳細は
<a href="faq10.html#AnonFTP">Anonymous FTP FAQ</a> を参照してくだ世気ぢ。
いずれにせよ、各行にはコメントもあり、
そのデーモンやサービスの<b>通常利用</b>の場合の値を示しています。
しかし、これは、そのデーモンやサービスを
そのフラグで使用しなければならないことを意味するものではありません。
man(1) は常に参照可能ですので、好みの形で起動するようにできます。
たとえば、httpd(8) のデフォルトは以下のようになっています。

<blockquote><pre>
httpd_flags=NO          # for normal use: "" (or "-DSSL" after reading ssl(8))
</pre></blockquote>

<p>
ここでは明世蕕法蔗の起動には、通常はどのようなフラグも不要であることがわかります。ですから、普通に httpd
を使用するだ世韻任靴燭蕁⊂綉旅圓髟阡纂眈蔗籖肚瘍鷭□鹿眈ぢにすれば良いのです。しかし、SSL を有効にして
httpd を起動するには、この行を &quot;httpd_flags="-DSSL"&quot; のように編集してくだ世気詳細については、
<a href="#HTTPS">SSL FAQ</a> か <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ssl&amp;sektion=8">ssl(8)</a>
を参照してくだ世気ぢ。

<p>
もっとも、<i>/etc/rc.conf</i> ファイル自身は決して編集しない方法の方が良いでしょう。
その代わりに、<i>/etc/rc.conf.local</i> ファイルを作誓掘守少續祚鱆闔羲ファイルの変更しようとしている行だ世韻鬚海離侫．ぅ襪縫灰圈爾靴討虔埆犬垢襪里任后
この方法では、将来のアップグレードがより簡単になります。それは、すべての変更が
ひとつのファイルに入っているからです。

<h3>ローカルのデーモン起動と誓瀋鹿莖
腫竟鶯など、他の方法でシステムにインストールしたその他デーモンを起動するには、
<i>/etc/rc.local</i> ファイルを使用します。
たとえば、/usr/local/sbin/daemonx にデーモンをインストールしたとします。
これをシステムの起動時に起動したい場合には、
<i>/etc/rc.local</i> に以下のようなエントリを書き加えます。

<blockquote><pre>
if [ -x /usr/local/sbin/daemonx ]; then
             echo -n ' daemonx';       /usr/local/sbin/daemonx
fi
</pre></blockquote>

<p>
(もし、システム起動時にデーモンが自動的に起動されなかった場合には、
コマンドラインの行末に "&amp;" を追加するということを覚えておいてくだ世気ぁ
腫これ以降は、起動時にこのデーモンが実行されるようになります。
また、起動時のエラーも見られます。
もし、エラーなしで普通にブートすると、以下のような行が表示されるでしょう。

<blockquote><pre>
Starting local daemons: daemonx.
</pre></blockquote>

<h3>rc.shutdown</h3>

<p>
<i>/etc/rc.shutdown</i> はシャットダ瀬Ε鵑虜櫃房孫圓気譴襯好螢廛箸任后
システムのシャットダ瀬Ε鸛阿房孫圓気擦燭い海箸蓮△垢戮討海離侫．ぅ襪傍劼靴討誓さい。
apm があるのでしたら、&quot;powerdown=YES&quot; も誓瀋蠅靴討泙后
これは &quot;shutdown -p&quot;と同じになります。

<p>
<a name= "RelayingDenied"></a>
<h2>10.4 - ユーザが OpenBSD システム経由でリモートからメールを送ろうとすると、
中継が拒否されるのはなぜでしょう ?</h2>

<p>
以下を試してみてくだ世気ぁ

錫跫站髟阡緇腫鱚首闔臂竅瘟豁黼鈔轣蛹苒辮繻癨闕瘟銖鹿齡鳫鈑鹿頏緇鹿碎閭鞫
腫出力はこのような感じでしょう。

<blockquote><pre>
FR-o /etc/mail/relay-domains
</pre></blockquote>

<p>
もし、このファイルがないようでしたら、これを作誓靴討誓さい。
リモートからメールを送信してくるホストを、以下の構文で記述する必要があります。

<blockquote><pre>
.domain.com    # domain.com内のホストからはすべてのメールのやり取りを認める
sub.domain.com # sub.domain.com とそのドメイン内のホストからはすべてのメールのやり取りを認める
10.2           # IP ネット 10.2.*.*内の全ホストからのメールのやり取りを認める
</pre></blockquote>

<p>
このファイルを作誓靴燭蕁黼鈔轣蛹ぢに「HangUP」シグナルを送るのを忘れないようにしましょう
(ほとんどのデーモンに誓瀋蠅鮑篤匹濆澆気擦襯轡哀淵襪任ぢ。

<blockquote><pre>
# <strong>kill -HUP `cat /var/run/sendmail.pid`</strong>
</pre></blockquote>

<p>

<h3>参考文献</h3>

<p>
<ul>
<li><a href="http://www.sendmail.org/~ca/email/relayingdenied.html">http://www.sendmail.org/~ca/email/relayingdenied.html</a>
<li><a href="http://www.sendmail.org/tips/relaying.html">http://www.sendmail.org/tips/relaying.html</a>
<li><a href="http://www.sendmail.org/antispam.html">http://www.sendmail.org/antispam.html</a>
</ul>

<p>
<a name= "POP"></a>
<h2>10.5 - POP を誓瀋蠅靴燭里法椀ぢサーバにアクセスできなくて困っています。
どうすれば良いのでしょう ?</h2>

<p>
POP に関係する問題のほとんどは、一時ファイルとロックファイルの問題でしょう。
pop サーバから以下のようなエラーメッセージが出力された場合には、

<blockquote><pre>
-ERR Couldn't open temporary file, do you own it?
</pre></blockquote>

<p>
ファイルパーミッションを以下のように変更してくだ世気ぁ鹿霈

錫跫站髟阡緇腫鱚鞳鴉蜩皷闔糅鵄蜴瘟輝浴俺虻宛瘟

鞳鴉蜩皷闔蜴癇瘟黼鴈瘢纈釶辣浴俺虻宛黼鴈瘢鹿頏緇鹿碎閭鞫
腫もうひとつチェックしておきたいのは、ユーザの /var/mail
ファイルがそのユーザ自身の所有になっているかどうかです。
もちろんそうなっているはずなのですが (つまり、/var/mail/joe を所有しているのは joe のはずなのですが)、
なぜかそうなっていない場合には、それが問題の原因でしょう !

<p>
もちろん、/var/mail に対して、グループ mail での書き込みを許可しておくと、
あいまいで変なセキュリティ上の問題が発誓犬靴泙后修蕕△海里茲Δ砲靴討い討皺燭睫簑蠅呂覆い任靴腓Α
しかし、問題になる可能誓呂△蠅泙特にあなたが有名なサイトを運営していたり、ISP だ世辰燭蠅靴燭
緕帯の ports コレクションには、誓気靴な，妊ぅ鵐好函璽襪垢襪海箸椎修椀ぢデーモンがいくつかあります。
しかし、もし可能でしたら、OpenBSD の基本インストールで利用可能となっている
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=popa3d&amp;sektion=8">popa3d</a>
を使用してくだ世気ぁ
あるいは単に、自分の POP デーモン用に選んだ瀬廛轡腑鵑岼磴辰討い襪誓けなのかも知れません
(たとえば、dot locking 等)。あるいは、POP デーモンがロックをかけるディレクトリを
変更すれば済む話かも知れません (ただ世掘△修Δ覆襪肇蹈奪椀ぢデーモンにとってのみ
意味があることになってしまうのですが)。

<p>
<b>追伸:</b> OpenBSD は &quot;mail&quot; という名前のグループを持っていないことに注意してくだ世気ぁ
ですので、必要なら、これを <i>/etc/group</i> ファイルに作誓靴覆韻譴个覆蠅泙擦鵝
このエントリは、

<blockquote><pre>
mail:*:6:
</pre></blockquote>

<p>
のようなもので十分でしょう。

<a name="SendmailDNS"></a>
<h2>10.6 - どうして sendmail は <tt>/etc/hosts ファイルを無視するのでしょう ?</tt></h2>

<p>
デフォルトで、sendmail は、<tt>/etc/hosts</tt> ファイルではなく、
DNS を名前解決に使用します。この挙動は、<tt>/etc/mail/service.switch</tt>
を使用することで変更することが可能です。

<p>
DNS サーバへの問い合わせの前に hosts ファイルを参照したい場合には、
以下のような行を含む <tt>/etc/mail/service.switch</tt>
ファイルを作誓靴泙后

腫鱚闢蛹纉銖
鹿頏緇

腫もし、hosts ファイル*だ世ぢを参照させたい場合には、次のような行を使用します。

<pre>
     hosts       files
</pre>

<p>
そして、以下のように sendmail に HUP シグナルを送ります。

<pre>
     # <b>kill -HUP `head -1 /var/run/sendmail.pid`</b>
</pre>

<p>
これによって上記の変更が有効になります。


<p>
<a name= "HTTPS"></a>
<h2>10.7 - SSL(8) を使用したセキュアな HTTP サーバの誓瀋鹿莢
腫緕帯は SSL 対応の httpd および RSA ライブラリを含んで出荷されています。
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=httpd&amp;sektion=8">httpd(8)</a>
で使用するためには、
まず証明製颪鮑鄒成しなければなりません。これは <i>/etc/ssl/private/</i>
中の関連する鍵とともに <i>/etc/ssl/</i> に保存されます。
ここで示すステップは、
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ssl&amp;sektion=8">ssl(8)</a>
man ページからのものです。詳細についてはそちらを参照してくだ世気ぁ海叢ぢは、
web サーバ用に RSA 証明製颪虜鄒成の仕方を誓睫誓しますが、
DSA サーバ証明製颪砲録┐譴泙擦鵝海舛蕕砲弔い討蓮
釈鱚羹∵雕關緕碵筮闥膀竍薛砠遲轣隨竍蘓髟纈齠讀瘢雹黼謾蜿扈権杖鼬┯轣ページを参照してくだ世気ぁ

腫最初に、OpenSSL を使用して
自分のサーバの鍵と証明製颪鮑鄒成する必要があります。

<div style="margin-left: 2em">
<pre>
# <strong>openssl genrsa -out /etc/ssl/private/server.key 1024</strong>
</pre>
</div>

<p>
あるいは、鍵をパスフレーズで暗号化して、
それをタイプしないとサーバが起動できないようにするには以下のようにします。

<div style="margin-left: 2em">
<pre>
# <strong>openssl genrsa -des3 -out /etc/ssl/private/server.key 1024</strong>
</pre>
</div>

<p>
次のステップは、証明製饅靆祥弋瓩鮟个垢海箸任后海譴
着鶯蜀鈑蓖鱸蛋に証明製颪縫汽ぅ鵑鬚發蕕Δ海箸任泙后
そのためには、以下のコマンドを使用します。

<div style="margin-left: 2em">
<pre>
# <strong>openssl req -new -key /etc/ssl/private/server.key -out /etc/ssl/private/server.csr</strong>
</pre>
</div>

<p>
これで鍵にサインしてくれる CA にわたすことのできる <i>server.csr</i>
ファイルが誓言成されます。このような CA の一例として、
<a href="http://www.thawte.com/">http://www.thawte.com/</a>
でアクセス可能な <b>Thawte Certification</b> があります。

<p>
とてもここまでできない人や、証明製颪麓妊汽ぅ鵑垢譴个いい塙佑┐訖佑蓮
以下のようにすることもできます。

<div style="margin-left: 2em">
<pre>
# <strong>openssl x509 -req -days 365 -in /etc/ssl/private/server.csr \
       -signkey /etc/ssl/private/server.key -out /etc/ssl/server.crt</strong>
</pre>
</div>

<p>
<i>/etc/ssl/server.crt</i> と
<i>/etc/ssl/private/server.key</i> があれば、
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=httpd&amp;sektion=8">httpd(8)</a>
を <b>-DSSL</b> フラグつきで起動できるはずです。
これであなたのマシンも、ポート 443 で https
のトランザクションができるようになったはずです。

<p>
<a name= "vipw"></a>
<h2>10.7 - /etc/passwd を vi(1) で編集したのに変更が反映されません。
なぜでしょう ?</h2>

<p>
/etc/passwd を編集しても、変更は全部消えてしまいます。
OpenBSD では、/etc/passwd を動的に
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pwd_mkdb&amp;sektion=8&amp;apropos=0">pwd_mkdb(8)</a>
コマンドで誓言成しています。OpenBSD の主パスワードファイルは /etc/master.passwd なのです。
これは、pwd_mkdb(8) によると以下のようになります。

<blockquote><pre>
FILES
     /etc/master.passwd  current password file
     /etc/passwd         a Version 7 format password file
     /etc/pwd.db         insecure password database file
     /etc/pwd.db.tmp     temporary file
     /etc/spwd.db        secure password database file
     /etc/spwd.db.tmp    temporary file
</pre></blockquote>

<p>
/etc/passwd のような従来の Unix パスワードファイルの場合、
ユーザの暗号化パスワードを含む各種情報が、システム上の万人に提供されていました
(そのため、Crack のようなプログラムの最初の標的にされてしまいます)。
4.4BSD で master.passwd ファイルが導入されましたが、これは拡張フォーマットを持っていて
(/etc/passwd で提供されていたものよりオプションが増えました)、root しか読むことができません。
さらに高速にデータにアクセスするため、このデータにアクセスするライブラリコールは、
通常は /etc/pwd.db と /etc/spwd.db とを読みます。

<p>
OpenBSD は、パスワードファイルを編集するのに使用するツールが附属しています。
これが vipw(8) です。
vipw は vi (あるいは $EDITOR で定義したお気に入りのエディタ) を使用して
/etc/master.passwd を編集できるようにします。その編集が終了すれば、
その変更に合わせて、自動的に /etc/passwd、/etc/pwd.db、/etc/spwd.db を更新します。
vipw はまた、これらのファイルのロックの面倒も見てくれますので、
あなたの編集と同時に誰かが変更しようとした場合には、アクセスが拒否されるようになっています。

<p>
<a name= "AddDelUser"></a>
<h2>10.9 - ユーザを追加するには ? &nbsp; また、削除するには ?</h2>

<p>
OpenBSD は、簡単にユーザをシステムに追加するためのふたつのコマンドを用意しています。

<ul>
<li><a href="#adduser">adduser(8)</a>
<li><a href="#user">user(8)</a>
</ul>

<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=vipw&amp;sektion=8">vipw(8)</a>
を使用して、ユーザを手で追加することもできますが、
これはほとんどの操作がより難しいものになります。

<a name="adduser"></a>
<p>
OpenBSD でユーザを追加するのに最も良い方法は
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=adduser&amp;sektion=8">adduser(8)</a>
スクリプトを使用することでしょう。<strong>/etc/adduser.conf</strong> を編集することで、
adduser(8) を誓瀋蠅垢襪海箸任泙后
痲糒黼鬥県ぢは <strong>/etc/passwd</strong>、<strong>/etc/group</strong>
と shell データベースに矛盾がないかもチェックします。
これは、エントリと $HOME ディレクトリも自動的に作誓靴泙后
さらには、ユーザの歓迎メッセージまで送信してくれるのです。
以下では、例として、ユーザ <b>testuser</b> をシステムに追加しています。
このユーザには $HOME ディレクトリ <i>/home/testuser</i> が与えられ、
<b>guest</b> グループに入れられ、シェルは <i>/bin/ksh</i> となります。

<blockquote><pre>
# <strong>adduser</strong>
Use option ``-silent'' if you don't want to see all warnings and questions.

Reading /etc/shells
Reading /etc/login.conf
Check /etc/master.passwd
Check /etc/group

Ok, let's go.
Don't worry about mistakes. I will give you the chance later to correct any input.
Enter username []: <b>testuser</b>
Enter full name []: <b>Test FAQ User</b>
Enter shell csh ksh nologin sh [sh]: <b>ksh</b>
Uid [1002]: <b><i>Enter</i></b>
Login group testuser [testuser]: <b>guest</b>
Login group is ``guest''. Invite testuser into other groups: guest no 
[no]: <b>no</b>
Login class auth-defaults auth-ftp-defaults daemon default staff 
[default]: <b><i>Enter</i></b>
Enter password []: <b><i>Type password, then Enter</i></b>
Enter password again []: <b><i>Type password, then Enter</i></b>

Name:        testuser
Password:    ****
Fullname:    Test FAQ User
Uid:         1002
Gid:         31 (guest)
Groups:      guest
Login Class: default
HOME:        /home/testuser
Shell:i      /bin/ksh
OK? (y/n) [y]: <b>y</b>
Added user ``testuser''
Copy files from /etc/skel to /home/testuser
Add another user? (y/n) [y]: <b>n</b>
Goodbye!
</pre></blockquote>

<p>
ユーザを削除するには、
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rmuser&amp;sektion=8">rmuser(8)</a>
ユーティリティを使用します。このユーティリティは、そのユーザの存在をすべて消去してしまいます。
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=crontab&amp;sektion=1">crontab(1)</a>
の関連エントリも消去されますし、$HOME ディレクトリも (オーナがそのユーザなら) 消去され、
メールも消去されます。もちろん、<strong>/etc/passwd</strong> と <strong>/etc/group</strong>
のエントリも消去されます。以下は、さきほど追加したユーザを削除した場合です。
ユーザ名を入力するようプロンプトが出力され、ユーザのホームディレクトリを削除すべきかどうか
確認を求められているのがわかります。

<blockquote><pre>
# <strong>rmuser</strong>
Enter login name for user to remove: <strong>testuser</strong>
Matching password entry:

testuser:$2a$07$ZWnBOsbqMJ.ducQBfsTKUe3PL97Ve1AHWJ0A4uLamniLNXLeYrEie:1002
:31::0:0:Test FAQ User:/home/testuser:/bin/ksh

Is this the entry you wish to remove? <strong>y</strong>
Remove user's home directory (/home/testuser)? <strong>y</strong>
Updating password file, updating databases, done.
Updating group file: done.
Removing user's home directory (/home/testuser): done.
</pre></blockquote>

<a name="user"></a>
<h3>user(8) を使用したユーザの追加</h3>

<p>
これらのツールは
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=adduser&amp;sektion=8">adduser(8)</a>
コマンドのような対話型ではありませんので、スクリプト内での使用がより簡単になっていると言世┐泙后

腫このツール全体は以下のとおりです。
<ul>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=group&amp;sektion=8">group(8)</a>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=groupadd&amp;sektion=8">groupadd(8)</a>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=groupdel&amp;sektion=8">groupdel(8)</a>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=groupinfo&amp;sektion=8">groupinfo(8)</a>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=groupmod&amp;sektion=8">groupmod(8)</a>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=user&amp;sektion=8">user(8)</a>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=useradd&amp;sektion=8">useradd(8)</a>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=userdel&amp;sektion=8">userdel(8)</a>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=userinfo&amp;sektion=8">userinfo(8)</a>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=usermod&amp;sektion=8">usermod(8)</a>
</ul>

<h4>実際のユーザ追加</h4>

<p>
user(8) は対話的に使用できないので、ユーザを手軽に追加する最も簡単な方法は、
adduser(8) コマンドを使うことです。実際のコマンド <i>/usr/sbin/user</i> は、
その他の <i>/usr/sbin/user*</i> コマンド群のフロントエンドに過ぎません。
ですから、以下のコマンドは <b>user add</b> や <b>useradd</b>
を使用すれば追加できますし、何が必要で、何が不要かはあなたの選択次第であり、
コマンドの使用方法は一誓敲僂蠅泙擦鵝

腫この例では、上記の <a href="#adduser">adduser</a> で行ったのと同じユーザを
同じ条件で追加してみましょう。useradd(8) は、
ユーザ追加前にデフォルト誓瀋蠅鮹里辰討い襪曚Δ△茲蟷箸い笋垢い發里砲覆蠅泙后
この誓瀋蠅蓮守少續祚纈辯逕闔羲に記述してあり、
次のようにすることで参照可能です。

<blockquote><pre>
$ <strong>user add -D</strong>
group           users
base_dir        /home
skel_dir        /etc/skel
shell           /bin/csh
inactive        0
expire          Null (unset)
range           1000..60000
</pre></blockquote>

<p>
コマンドラインでオプション指定しない限りは、この誓瀋蠅藩僂気譴泙后
たとえば、ここでの例では、ユーザの所属グループは <b>users</b> ではなく
<b>guest</b> にしたいとします。さらにもうひとつのハードルがあります。
パスワードをコマンドラインで指定しなければなりません。
そのパスワードも、暗号化済みのパスワードなのです。
ですから、まず
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=encrypt&amp;sektion=1">encrypt(1)</a>
ユーティリティを使用して予めパスワードを作誓靴討廚△蠅泙后燭箸┐弌緕帯のパスワードはデフォルトでは Blowfish アルゴリズムを 6 回適用したものになります。
useradd(8) に指定するパスワードを作誓垢襪砲蓮
まず、以下のようにしなければならないことになります。

<blockquote><pre>
$ <strong>encrypt -p -b 6</strong>
Enter string:                &lt;---- ここで使いたいパスワードを入力
$2a$06$YOdOZM3.4m6MObBXjeZtBOWArqC2.uRJZXUkOghbieIvSWXVJRzlq
</pre></blockquote>

<p>
これで暗号化されたパスワードが作誓気譴泙靴燭里如▲罅璽兇猟媛辰鮗孫圓任泙后

錫跫站髟阡緇腫鱚首闔臂纈粐Г過ぐ兇拵簣斃凱危桐替裙暈堆彖鴆嘆卻旒寞萵蜈楓嘛慟片颶碓芦
砠遲謫壹齡叢黼鬆齡纉黼鮗闔臂
鹿頏緇鹿碎閭鞫
腫錫ぢ注:</b> シェルが user(8) に送る前にこれを解釈してしまうので、
パスワードのストリングを囲むときには、
&quot;&nbsp;&quot; (ダ瀬屮襯璽ではなく、
'&nbsp;' (シングルクォート) を使用しなければなりません。
これに加えて、ユーザのホームディレクトリを作誓靴
守少續祚鼡繻鹿蘊ぢのファイルをコピーしておく必要があるのでしたら、
<b>-m</b> オプションを忘れないようにしてくだ世気ぁ

腫ユーザが問題なく作誓気譴燭匹Δ魍稜Г垢襪砲蓮△い蹐い蹐
ユーティリティが使用可能です。以下に、すべてが誓気靴鄒成されたかどうかを
確認するためのコマンドをいくつか挙げておきます。

<blockquote><pre>
$ <strong>ls -la /home</strong>
total 14
drwxr-xr-x   5 root      wheel   512 May 12 14:29 .
drwxr-xr-x  15 root      wheel   512 Apr 25 20:52 ..
drwxr-xr-x  24 ericj     wheel  2560 May 12 13:38 ericj
drwxr-xr-x   2 testuser  guest   512 May 12 14:28 testuser
$ <strong>id testuser</strong>
uid=1002(testuser) gid=31(guest) groups=31(guest)
$ <strong>finger testuser</strong>
Login: testuser                         Name: Test FAQ User
Directory: /home/testuser               Shell: /bin/ksh
Last login Sat Apr 22 16:05 (EDT) on ttyC2
No Mail.
No Plan.
</pre></blockquote>

<p>
これらのコマンドに加えて、user(8) は userinfo(8) と呼ばれる独自のユーティリティを提供していて、
ユーザ属誓鯢充┐垢襪海箸任泙后

錫跫站髟阡緇腫鱚首闔臂纈蜴肬纉黼鮗闔臂
跫芍齡纈
鞜齠碓芦
苒阨頌苺纉竏瘤艱怛偵咳杭旭紺厩狭
竚癈艱竢壹齡叢黼粡闕絲齡纈
鼈繻蜴鼈
纔韈鱚怛偵咳杭旭紺厩狭
鹿頏緇鹿碎閭鞫
取款ユーザ削除</h4>

<p>
user(8) 以下のコマンドでユーザ削除するには、userdel(8) を使用します。
これはとても簡単で使いやすいコマンドです。
上記の例で作誓靴織罅璽兇鮑鐔垢襪砲蓮韻房，里茲Δ砲靴泙后

錫跫站髟阡緇腫鱚首闔臂纈粤纉黼鮗闔臂
鹿頏緇鹿碎閭鞫
腫錫将鮗オプションに注意してくだ世気ぁ罅璽兇離曄璽爛妊譽肇蠅眛瓜忘鐔垢訃豺腓砲蓮
このオプションが必要になります。あるいは、<b>-r</b> の代わりに
<b>-p</b> を指定した場合には、ユーザのアカウントはロックされますが、
情報が一誓攤鐔気譴襪海箸呂△蠅泙擦鵝

腫釈瘢綵瀞佻鉤昭取仮碓鈿銷迴墅ぢではない) ftp 誓賤僖▲Ε鵐箸鮑鄒成するにはどうすればよいのでしょう ?</h2>

<p>
いくつかの方法があるのですが、よく使われる方法としては <i>/usr/bin/false</i> を
<strong>/etc/shells</strong> にシェルとして追加し、そしてユーザを誓瀋蠅垢襪箸
ログインシェルを /usr/bin/false に指定することで、
話型のログインをできないようにした上で、ftp は使用可能にすることができます。
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=adduser&amp;sektion=8">adduser(8)</a>
を使用すると、デフォルトでホームディレクトリを <i>/home/&lt;user&gt;</i> にすることができます。
それで良ければ、ホームディレクトリを変更しなくても構いませんが、
これも任意のディレクトリを指定することができます。
<i>/etc/ftpchroot</i> に対象ユーザのユーザ名を加えておけば、
そのユーザがアクセスできるのは彼自身のホームディレクトリのファイルだ世韻砲覆蠅泙后
また、<b>-A</b> オプションを
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftpd&amp;sektion=8">ftpd(8)</a>
に指定することで、ftpchroot ログインしか受け付けなくなります !

<p>
<a name= "Quotas"></a>
<h2>10.11 - ユーザのディスク quota を誓瀋鹿莢
腫髟阡は、あるユーザがドライブ上で使用可能なディスクスペースを誓造垢襪里忙藩僂靴泙后
リソースが限られているときにはとても役に立ちます。
quota はユーザ別 および/または グループ別に誓瀋蠅垢襪海箸任泙后

腫髟阡の誓瀋蠅梁莪貶發蓮
釈鱚羹〓聲餤譯闔鵞ぢカーネルの誓瀋鹿畩の中に
"<tt>option QUOTA</tt>" が入っていることを確かめることです。
これは GENERIC カーネルにはデフォルトで入っています。次に、
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=fstab&amp;sektion=5"><tt>/etc/fstab</tt></a>
の中で quota を有効にするファイルシステムにマークをつけることで、これは
quota を使用するファイルシステムに、<tt>userquota</tt> と <tt>groupquota</tt>
というキーワードでマークを示します。デフォルトで
<tt>quota.user</tt> と <tt>quota.group</tt> というファイルが
そのファイルシステムのルートに作誓気譟△海海ぢの情報が保存されます。
このデフォルトは、"userquota=/var/quotas/quota.user" のように
quota オプションにファイル名を指定することでオーバーライドされます。
もちろん、ここで指定するのは、quota 情報が指定されているどのようなファイルでも構いません。
以下は、userquota を有効にしたファイルシステムがひとつだ世餌減澆掘
髟阡ファイルが標準ではない位置に存在する /etc/fstab の例です。

<blockquote><pre>
/dev/wd0a / ffs rw,userquota=/var/quotas/quota.user 1 1
</pre></blockquote>

<p>
では、ユーザの quota を誓瀋蠅靴泙靴腓Α海譴砲蓮
釈鱚羹∵雕關緕碵筮闥膀竍薛砠遲轣隨竍蘓髟纈繖髟阡瓲瘢雹黼謾蜿扈権上糀┯ユーティリティを使用します。簡単な使用方法は、単に "<tt>edquota&nbsp;&lt;user&gt;</tt>"
とします。edquota(8) は、vi(1) や環境変数 EDITOR に誓瀋蠅気譴織┘妊燭鮖藩僂靴
を編集します。たとえば、

<blockquote><pre>
# <strong>edquota ericj</strong>
</pre></blockquote>

<p>
入力することによる出力は以下のようになります。

<blockquote><pre>
Quotas for user ericj:
/: blocks in use: 62, limits (soft = 0, hard = 0)
	inodes in use: 25, limits (soft = 0, hard = 0)
</pre></blockquote>

<p>
ユーザのディスク使用量を誓造垢襪砲蓮△海離侫．ぅ襪魄焚爾領磴里茲Δ吠埆犬靴泙后

錫跫站髟阡緇腫鱚剳阡癈闥黼纈蜒蟶
跫站蜴黼恐跚迚齒胄旭穐癇碓軌	蜴閼纉綺規蜊蜚閹穐癇逢
鹿頏緇鹿碎閭鞫
腫髟阡の割り当ては 1k ブロック単位で行われることに注意してくだ世気ぁ
ここでは softlimit が 1000k にセットされ、hardlimit は
1050k にセットされています。softlimit というのは、
ユーザが誓造魃曚┐燭箸いΨ拗陲鮗韻董⇒瑛輯崙發縫妊好藩冦未鮓困蕕垢茲Α
ユーザに要求を出します。猶予期間は eduquota(8) で <strong>-t</strong>
オプションを使用することで誓瀋蠅任泙后
この猶予期間が過ぎると、softlimit は hardlimit として処理されるようになります。
これは普通は、アロケーションエラーを引き起こすことになります。

<p>
これで quota が誓瀋蠅気譴泙靴燭里如髟阡を有効にします。
そのためには、以下の例のように
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=quotaon&amp;sektion=8">quotaon(8)</a>
を使用します。

<blockquote><pre>
# <strong>quotaon -a</strong>
</pre></blockquote>

<p>
これは <tt>/etc/fstab</tt> を参照して、quota
オプションのついたファイルシステムを有効化する作業です。
これによって、quota が有効になりますので、
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=quota&amp;sektion=1">quota(1)</a>
を使用して見ることが可能になります。"<tt>quota &lt;user&gt;</tt>" というコマンドを使用することで、
そのユーザの情報も見ることができます。引数なしで呼び出されると、quota(1) コマンドは
quota 統計を表示すします。たとえば以下のようにしてみてくだ世気ぁ

錫跫站髟阡緇腫鱚首闔臂髟阡纈蜒蠎闔臂
鹿頏緇鹿碎閭鞫
腫すると、得世蕕譴觀覯未楼焚爾里茲Δ覆發里砲覆襪呂困任后

錫跫站髟阡緇腫鱚堤鼡肬纈鱸竓碓葦蛹纉跫站髟阡跚迚苒痺肅跂髟阡跚迚苒痺旭圧鹿頏緇鹿碎閭鞫
腫デフォルトで /etc/fstab で誓瀋蠅靴ぢが起動時にセットされます。
これをオフにするには、次のコマンドを使用します。

<blockquote><pre>
# <strong>quotaoff -a</strong>
</pre></blockquote>

<p>
<a name= "Kerberos"></a>
<h2>10.12 - KerberosV のクライアントとサーバの誓瀋鹿莢
腫緕帯には、デフォルトの状態で KerberosV が
システムの構誓覆箸靴徳箸濆泙譴討い泙后

腫妹鰲纈闢についてのより詳しいことは、OpenBSD システム上で
以下のコマンドを使用してくだ世気ぁ
腫鱚眈蜴肬繪辟瘡鹿眈
鹿頏緇


腫釈瘢綵綜闔瀞丐昭取仮碓綜闔阨瀞サービスの誓瀋鹿莢
腫綜闔阨瀞は、アカウントのない人たちに File Transfer Protocol を使用して
あなたのコンピュータ上のマシンにアクセスさせるものです。
以下に、この Anonymous FTP サーバの概要、そのログの取り方、その他の誓瀋蠅砲弔い峠劼戮泙后

取馨瀞アカウントの追加</h3>

<p>
まず、システム上に "ftp" というアカウントが必要になります。このアカウントは、
使用可能なパスワードを持っていてはいけません。ここでは仮にログインディレクトリを
/home/ftp としますが、これはどこでも好みのディレクトリを指定して構いません。
Anonymous FTP を使用する場合、ftp は chroot して 'ftp'
ユーザのホームディレクトリに移動します。この詳細については、
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftpd&amp;sektion=8">ftp(8)</a> と 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=chroot&amp;sektion=2">chroot(2)</a> の
man ページを参照してくだ世気ぁ０焚爾蘊胄霄ユーザ追加の例を示します。
ここでは
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=adduser&amp;sektion=8">adduser(8)</a>
を使用します。さらに <i>/etc/shells</i> に /usr/bin/false を追加しておいてくだ世気ぁ
これがこの ftp ユーザに使用させる &quot;シェル&quot; ということになります。
このため彼らは、空のパスワードをもらってもログインすることはできません。
これには簡単に <i>echo /usr/bin/false &gt;&gt; /etc/shells</i>
とすれば良いでしょう。
また、adduser の質問のときにそのシェルがあらわれるようにしたければ、
<i>/etc/adduser.conf</i> も変更しておく必要があります。

<blockquote><pre>
# <strong>adduser</strong>
Use option ``-silent'' if you don't want to see all warnings and questions.

Reading /etc/shells
Reading /etc/login.conf
Check /etc/master.passwd
Check /etc/group

Ok, let's go.
Don't worry about mistakes. I will give you the chance later to correct any input.
Enter username []: <b>ftp</b>
Enter full name []: <b>anonymous ftp</b>
Enter shell csh false ksh nologin sh tcsh zsh [sh]: <b>false</b>
Uid [1002]: <b><i>Enter</i></b>
Login group ftp [ftp]: <b><i>Enter</i></b>
Login group is ``ftp''. Invite ftp into other groups: guest no 
[no]: <b>no</b>
Login class auth-defaults auth-ftp-defaults daemon default staff 
[default]: <b><i>Enter</i></b>
Enter password []: <b><i>Enter</i></b>
Set the password so that user cannot logon? (y/n) [n]: <b>y</b>

Name:        ftp
Password:    ****
Fullname:    anonymous ftp
Uid:         1002
Gid:         1002 (ftp)
Groups:      ftp
Login Class: default
HOME:        /home/ftp
Shell:       /usr/bin/false
OK? (y/n) [y]: <b>y</b>
Added user ``ftp''
Copy files from /etc/skel to /home/ftp
Add another user? (y/n) [y]: <b>n</b>
Goodbye!
</pre></blockquote>

<h3>ディレクトリの誓瀋鹿莖
腫これでユーザと同時に <i>/home/ftp</i> というディレクトリが作誓気譴泙靴拭海譴呂海舛蕕
意図したとおりの結果なのですが、Anonymous FTP で使用するためにはもうひと工夫が必要になります。これについては
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftpd&amp;sektion=8">ftp(8)</a>
の man ページに誓睫誓されています。

<p>
/home/ftp/usr や /home/ftp/bin ディレクトリは
<b>作誓垢詆廚呂△蠅泙擦鹿眈。
<ul>
<li><i>/home/ftp</i> - これがメインのディレクトリです。
所有者は root にして、パーミッションは 555 にしておいてくだ世気ぁ
殊蘊守少蓖辣鹿蘊ぢこれはまったくのオプションでしかなく、お勧めもしません。
それは、このマシン上のユーザについての情報を漏曳することになるだ世韻誓からです。
しかし、Anonymous FTP ディレクトリで、ファイルに実際のオーナ情報等を表示させたい場合には、
<i>/home/ftp/etc</i> ディレクトリを作誓靴續祚頷筮籵ぢと /etc/group
をこのディレクトリにコピーしておきます。このディレクトリはモードを 511 にして、
コピーしたふたつのファイルはモード 444 にしておきます。これでファイルの所有者が番号ではなく
名前で表示されるようになります。また、pwd.db にはパスワードは含まれず、パスワードはすべて
spwd.db に入っています。ですから、spwd.db は<strong>誓簑个鹿齡鳫鈑ぢコピーしてはいけません。
<li><i>/home/ftp/pub</i> - これは、共有したいファイルをコピーしておく標準のディレクトリです。
このディレクトリもモード 555 にしておいてくだ世気ぁ
鹿
腫
以上のディレクトリはすべて、所有者を「root」にしておきます。
以下に、最終的にディレクトリがどのような構誓砲覆襪里鮗┐靴泙后

錫跫站髟阡緇腫鱚闢蓍矚釶頷
闕闢蓍矚釶踈赱胄糅鬮鳫阡胄渦臼些糅鬮鳫阡繞渦碓叉
糅鳫阡胄渦臼些續糅鬮鳫阡胄渦臼些頤
胄隴續禳
干
糅鳫阡胄渦臼些糅鬮鳫阡胄渦臼些
鬮鳫阡胄蔚臼些苒阨鬮鳫阡胄姐彊臼些頷筮籵

胄隴頤盧
糅鬮鳫阡胄渦臼些糅鬮鳫阡胄渦臼些
鹿頏緇鹿碎閭鞫
取馨サーバを起動してログの取得世魍鹿莖
腫胄鞣ぢの場合、これを inetd から実行するのか、あるいは rc スクリプトで開始するのか選択することが可能です。
以下の例では、デーモンを
<a href="http://www.openbsd.org/cgi-bin/cvsweb/src/etc/inetd.conf">inetd.conf</a>
から起動することにします。まずは ftpd のオプションのいくつかに馴れておいてくだ世気ぁ
守少續祚蜴續筮竢鈕鹿蘊ぢのデフォルトの記述は以下のようになります。

<blockquote><pre>
<strong>ftp             stream  tcp     nowait  root    /usr/libexec/ftpd       ftpd -US</strong>
</pre></blockquote>

<p>
ここでは ftpd は <i>-US</i> オプションで起動されています。
これは anonymous 誓楝海離蹈阿蘊癇閾篌に記録し、
同時に発誓犬垢襯札奪轡腑鵑離蹈阿蘊癇霄に記録するものです。
これでセッションが who(1) で見られるようになります。
中には、anonymous サーバだ世韻鮗孫圓靴董▲罅璽兇砲ぢを許可しないようにしたい場合もあるでしょう。
そのためには、ftpd を <i>-A</i> オプションで起動します。以下に挙げるのは、ftpd を
anonymous 誓楝海里澆鯒Г瓩觀舛乃阿垢詢磴任后気蕕蘊貅オプションも付与しています。
これは、get、retrieve などの ftp コマンドと合わせて、それぞれの誓楝海離蹈阿跫に記録します。

<blockquote><pre>
<strong>ftp             stream  tcp     nowait  root    /usr/libexec/tcpd       ftpd -llUSA</strong>
</pre></blockquote>

<p>
注: トラフィックが非常に高い ftp サーバを運用する人は、ftpd を
inetd.conf から起動しないほうがいいかも知れません。最も良い方法は、
inetd.conf の ftpd をコメントアウトして、ftpd を <i>-D</i> オプションつきで
rc.conf から起動することでしょう。これなら、ftpd はデーモンとして起動されるので、
inetd から起動するよりオーバーヘッドもずっと小さくなるのです。
rc.conf から起動するときの記述例は以下のようになりませす。

<blockquote><pre>
ftpd_flags="-DllUSA"           # for non-inetd use: ftpd_flags="-D"
</pre></blockquote>

<p>
これはもちろん、<i>/etc/inetd.conf</i>から ftpd をコメントアウトして、
inetd にこのファイルを再読み込みさせておかなければうまく動作しません。

<h3>その他関連ファイル</h3>

<ul>
<li><i>/etc/ftpwelcome</i> - ここには ftp サーバに誓楝海靴真佑紡个靴
表示するメッセージを書きます。
<li><i>/etc/motd</i> - これは、ftp サーバにログインしてきた人に対して
表示するメッセージです。
<li><i>.message</i> - このファイルはどこのディレクトリに置いても構いません。
ユーザがそのディレクトリに入ってきたら表示されるメッセージです。
</ul>


<p>
<a name= "ftpchroot"></a>
<h2>10.14 - ftpd(8) でユーザをホームディレクトリから出られないようにするには</a></h2>

<p>
OpenBSD の
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftpd&amp;sektion=8">ftpd(8)</a>
は、デフォルトでこれを簡単にこなせるようになっています。これは
<strong>/etc/ftpchroot</strong> ファイルを使用することで実現できます。
ユーザは常に信用できるとは限りませんから、
ホームディレクトリに押し込めておくことが必要になるかも知れません。
これはデフォルトでは、有効になっていません。デフォルトの挙動の例を以下に示します。

<blockquote><pre>
$ <strong>ftp localhost</strong>
Connected to localhost.
220 oshibana FTP server (Version 6.4/OpenBSD) ready.
Name (localhost:ericj): <strong>ericj</strong>
331 Password required for ericj.
Password: <strong>*********</strong>
230- OpenBSD 3.4 (GENERIC) #18: Wed Sep 17 03:34:47 MDT 2003
230- 
230- Welcome to OpenBSD: The proactively secure Unix-like operating system.
230- 
230- Please use the sendbug(1) utility to report bugs in the system.
230- Before reporting a bug, please try to reproduce it with the latest
230- version of the code.  With bug reports, please try to ensure that
230- enough information to reproduce the problem is enclosed, and if a
230- known fix for it exists, include that as well.
230- 
230 User ericj logged in.
Remote system type is UNIX.
Using binary mode to transfer files.
ftp> <strong>cd /</strong>
250 CWD command successful.
ftp> <strong>ls</strong>
227 Entering Passive Mode (127,0,0,1,60,7)
150 Opening ASCII mode data connection for 'file list'.
altroot
bin
dev
etc
home
mnt
root
sbin
stand
tmp
usr
var
bsd
sys
boot
226 Transfer complete.
ftp> <strong>quit</strong>
221 Goodbye.
</pre></blockquote>

<p>
ご覧のとおり、全サーバへのアクセスが認められてしまいます。
この誓い萎任△蕕罎襯罅璽兇缶姪某僂任襪里任△譴弌
これでも構いませんが、残念ながらそうはいきません。ユーザを誓造垢襪砲蓮
単にそのユーザ名を <strong>/etc/ftpchroot</strong> ファイルに記述します。
以下の例では、&quot;ericj&quot; というユーザが誓造気譴討い泙后

錫跫站髟阡緇腫鱚首闔臂竅竏鳫阡鹿齡鳫鈑緕帯頂竏鳫阡更強扱渦艮穏慣纈瘁糘
跚齡纈鈬纈蜴紿蝟緕窿纉蓿闖癇縺
鱚痲胄鞣┯
纈蜒鹿頏緇鹿碎閭鞫
腫これだ世韻如纈蜒螟髟阡というユーザは自分のディレクトリから出られなくなます。
次の例のように、/ ディレクトリが
いきなりこのユーザのホームディレクトリになっているのです !

<blockquote><pre>
$ <strong>ftp localhost</strong>
Connected to localhost.
220 oshibana FTP server (Version 6.4/OpenBSD) ready.
Name (localhost:ericj): <strong>ericj</strong>
331 Password required for ericj.
Password: <strong>*********</strong>
230 User ericj logged in.
Remote system type is UNIX.
Using binary mode to transfer files.
ftp> <strong>cd /</strong>
250 CWD command successful.
ftp> <strong>ls</strong>
227 Entering Passive Mode (127,0,0,1,92,171)
150 Opening ASCII mode data connection for 'file list'.
.login
.mailrc
.profile
.rhosts
.ssh
.cshrc
work
mail
src
226 Transfer complete.
ftp> <strong>quit</strong>
221 Goodbye.
</pre></blockquote>

<p>
<a name= "Patches"></a>
<h2>10.14 - OpenBSD にパッチを適用する</h2>

<p>
OpenBSD ソースツリーは誓笋┐妻儔修靴堂韻気譴討い泙垢掘
同時によくある問題への修誓気盥圓錣譟△修里燭瓩離僖奪舛気譴討い泙后
これらのパッチは、
<a href="../../ja/errata.html">errata web ページ</a>上で、
カテゴリ別に分けて公開されています。そして、
これらのカテゴリは、それぞれのアーキテクチャごとに適用されるべきパッチと、
アーキテクチャ独立のパッチに関連しています。

<p>
しかし、パッチは OpenBSD への機能追加のために行われているわけではないことに注意してくだ世気ぁ
これは、緊急対応が必要な、重要な信頼誓韻筌札絅螢謄紊量簑蠅悗梁弍里燭瓩誓けに使用されるものです。
ただ世掘△修譴紡弍垢襪匹Δ砲弔い討蓮
常にシステム管理者次第です。

<p>
たとえば、セキュリティのための修誓気里燭瓠
釈鱚羹∵雕關緕碵筮闥膀竍薛砠遲轣隨竍蘓髟纈跌筅瘢雹黼謾蜿扈権浄瘡諢┯に
<a href="../../ja/errata.html">errata web ページ</a>からの
パッチを適用してみましょう。

<h3>このようなパッチは、CVS ツリーにあるものとはどのように異なっているのでしょうか ?</h3>

<p>
<a href="../../ja/errata.html">errata web ページ</a>にポストされるパッチは、
最新リリースのソースツリーに対するものなのです。
また、最新の CVS ツリーに対するパッチには、
リリースシステムでは求められないような
その他の変化が含まれているかも知れません。

<h3>システムにパッチをあてる準備をします。</h3>

<p>
OpenBSD オペレーティングシステム用のパッチは、diff で配布されています。
これは元のソースコードに対する差分を含むテキストファイルです。
これはバイナリ形式では<b>配布されていません</b>。
つまり、システムにパッチを適用するためには、
OpenBSD <b>リリース</b>バージョンのソースコードが手元になければなりません。
OpenBSD のソースコードが全部そろっている必要はありませんが、
パッチを適用するプログラムの分についてはすべて必要となります。
たとえば、カーネルにパッチを適用するのでしたら、
カーネルのソースコードが手元に必要となるのです。

<p>
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=cvs&amp;sektion=1">cvs(1)</a>
を使用すると、手軽に好みの Anonymous CVS サーバから、
必要なソースコードだ世韻鮗萋誓することができます。サーバ一覧は
<a href="../../ja/anoncvs.html">Anonymous CVS のページ</a>
を参照してくだ世気ぁ

腫守廠繻縺黼鹿蘊ぢの talkd(8) のソースコードを
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=cvs&amp;sektion=1">cvs(1)</a>
で取得世垢襪砲蓮焚爾離灰泪鵐匹鮖藩僂靴泙后

寂蝟跂就轣鱧蜴繙纃⊂
腫鱚錫上闥置嘔蕨埆瘤闔笆鸚節鈿釿貴甌關緕碵筮闥膾鹿眈
錫障椀杜帯吊樫岸汰單鱆蛯纔繝瘡諢笆黼鴟纈寳籬鈑鱆蛯纔繝瘡諢
齟祚跚矼祚跌箝瘤鈿竇
齟祚跚矼祚跌箝跌筮齟祚跚矼祚跌箝跌筮鹿頏緇
鹿粡

腫必要なソースコードの CVS パスを調べるには、
適用したいパッチの <i>Index:</i> 行を見ます。
この例では、CVS パスは <i>src/libexec/talkd/</i> になります。
必ず OPENBSD_version_number_BASE のリビジョンをチェックしてくだ世気ぁ
汰單ぢがない場合には、安定版ブランチをチェックアウトしていることになります。
これには不要な他のコードが含まれているかも知れません。
既にパッチブランチを追いかけているのでしたら、
パッチは既にソースに含まれているはずですが、
必ず確認するようにしてくだ世気ぁ
釈鱚羹〓甎韭譬章鞳鄲喞鱚銓ぢの変更点鹿畩を見れば、
どのパッチがパッチブランチに適用されたのかがわかるはずです。
もし、パッチがまだ静僂気譴討い覆韻譴弌
上記のコマンドを使用して最新リリースのソースコードを取得世靴討誓さい。

<p>
また、公式 OpenBSD CD を買ってくれた人は、
直誓からソースコードを持ってくると良いでしょう。
CD からソースを持ってくる方法については、CD に付属の紙を見てくだ世気ぁ
このようにすれば、anoncvs 経由でソースを持って来る必要はありません。

<blockquote><pre>
Apply by doing:
        cd /usr/src
        patch -p0 &lt; 026_talkd.patch
        cd libexec/talkd
        make obj &amp;&amp; make depend &amp;&amp; make &amp;&amp; make install

Index: libexec/talkd/announce.c <b>&lt;------ Path to sources </b>
===================================================================
RCS file: /cvs/src/libexec/talkd/announce.c,v
retrieving revision 1.8
retrieving revision 1.9
diff -u -r1.8 -r1.9
--- libexec/talkd/announce.c    1998/08/18 03:42:10     1.8
+++ libexec/talkd/announce.c    2000/07/06 00:01:45     1.9
@@@@ -160,6 +160,6 @@@@
                *(bptr++) = '\n';
        }
        *bptr = '\0';
-       fprintf(tf, big_buf);
+       fprintf(tf, "%s", big_buf);
        fflush(tf);
 }
</pre></blockquote>

<p>
然るべきソースコードを入手したら、パッチを取得世靴
守杖鱆に置いてくだ世気ぁ

取馨パッチを適用する</h3>

<div style="margin-left: 2em">
<pre>
$ <b>cd /usr/src</b>
$ <b>patch -p0&lt;/path/to/026_talkd.patch</b>
Hmm...  Looks like a unified diff to me...
The text leading up to this was:
--------------------------
|Apply by doing:
|       cd /usr/src
|       patch -p0 &lt; 026_talkd.patch
|       cd libexec/talkd
|       make obj &amp;&amp; make depend &amp;&amp; make &amp;&amp; make install
|
|Index: libexec/talkd/announce.c
|===================================================================
|RCS file: /cvs/src/libexec/talkd/announce.c,v
|retrieving revision 1.8
|retrieving revision 1.9
|diff -u -r1.8 -r1.9
|--- libexec/talkd/announce.c   1998/08/18 03:42:10     1.8
|+++ libexec/talkd/announce.c   2000/07/06 00:01:45     1.9
--------------------------
Patching file libexec/talkd/announce.c using Plan A...
Hunk #1 succeeded at 160. <b>&lt;------------ Patch Succeeded</b>
done
$ <b>cd /usr/src/libexec/talkd/</b>
$ <b>ls</b>
CVS             announce.c      print.c         table.c         talkd.c
Makefile        announce.c.orig process.c       talkd.8         talkd.h
$ <b>make obj &amp;&amp; make depend &amp;&amp; make</b>
making /home/ericj/lsrc/src/libexec/talkd/obj
mkdep -a /home/ericj/lsrc/src/libexec/talkd/talkd.c \
 /home/ericj/lsrc/src/libexec/talkd/announce.c \
 /home/ericj/lsrc/src/libexec/talkd/process.c /home/ericj/lsrc/src/libexec/talkd/table.c \
 /home/ericj/lsrc/src/libexec/talkd/print.c
cc -O2     -c /home/ericj/lsrc/src/libexec/talkd/talkd.c
cc -O2     -c /home/ericj/lsrc/src/libexec/talkd/announce.c
cc -O2     -c /home/ericj/lsrc/src/libexec/talkd/process.c
cc -O2     -c /home/ericj/lsrc/src/libexec/talkd/table.c
cc -O2     -c /home/ericj/lsrc/src/libexec/talkd/print.c
cc   -o ntalkd talkd.o announce.o process.o table.o print.o
nroff -Tascii -mandoc /home/ericj/lsrc/src/libexec/talkd/talkd.8 &gt; \
 talkd.cat8
$ <b>sudo make install</b>
install -c -s -o root -g bin  -m 555 ntalkd /usr/libexec
install -c -o root -g bin -m 444 talkd.cat8 /usr/share/man/cat8/talkd.0
/usr/share/man/cat8/ntalkd.0 -&gt; /usr/share/man/cat8/talkd.0
</pre>
</div>

<p>
これが終了したら、該当サービスを再起動してくだ世気ぁ


釈瘢綵∵鞣竏鳫阡⊂鹿畩
取仮碓草痺蒹ぢの chroot() って何でしょう ?</h2>

<p>
OpenBSD では、Apache 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=httpd&amp;sektion=8">httpd(8)</a>
サーバは、デフォルトで
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=chroot&amp;sektion=2">chroot(2)</a>
されるようになりました。これは驚異的にセキュリティを向上させるものですが、
そのための準備ができていなければ、問題を誓犬困襪海箸箸覆襪眞里譴泙擦鵝

取馨竏鳫阡ぢとは何でしょう ?</h3>

<p>
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=chroot&amp;sektion=2">chroot(2)</a>
されたアプリケーションは特定のディレクトリに閉じ込められ、
そのディレクトリが "<tt>/</tt>" (ルート)
ディレクトリであるかのように見えます。
そして、残りのディレクトリツリーをさまよい歩くことはできません。
httpd(8) の場合ですと、プログラムが起動すると、まず、自身のログファイルをオープンし、
自身の TCP ポート (ただ世掘△海了誓では、まだ瀬如璽燭麓靴泙擦とバインドし、
そして、自身の誓瀋蠅鯑匹濆澆泙后，法⊆納箸蘊癇鹿蘊ぢに閉じ込め、
権限を落とします。そして、リクエストを受け付け始めます。これは、Apache が使用し、
あるいはサービスを提供するすべてのファイルは、<i>/var/www</i>
ディレクトリの中になければならないということを意味します。これによって、
Apache に何かセキュリティ上の問題があった場合にも、セキュリティは驚異的に向上します。
ダ瀬瓠璽犬蓮崙匹濆澆里漾廚離僉璽潺奪轡腑鵑鮖鎮碓譴離妊譽肇蠅妨堕蠅気譟
そして損害を被るリソースはなくなるのです。

<h3>ユーザにとって、これは何を意味するのでしょう ?</h3>

<p>
単刀直入に言世┐弌竏鳫阡┣を行う Apache は新しいものですので、多くの古い
アプリケーションやシステム誓瀋蠅楼柄阿里茲Δ砲脇阿覆覆辰討靴泙Δ任靴腓Α

受貍
殊蘊錫ぢ歴史的なファイルシステムのレイアウト:</b> OpenBSD の古い目のバージョンから
アップグレードされたサーバは、web ファイルをユーザのディレクトリに持っているかも
知れませんが、これは明世蕕蓿闖鴬ぢされた環境では動作しなくなります。というのは、
chroot(2) された httpd(8) は <i>/home</i> にアクセスすることができなくなるからです。
管理者は、すべての web ファイルを置くには、既存の /var/www パーティションが
小さ過ぎることにも気付くかも知れません。この場合の選択肢は、再構築を行うか
chroot(2) の機能を使用しないことでしょう。もちろん、ユーザのホームディレクトリから
<i>/var/www</i> を指し示すシンボリックリンクを使用することもできますが、
chroot(2) されているため、その逆に <i>/var/www</i> からファイルシステムの他の場所への
シンボリックリンクを使用することはできません。もし、ユーザに対して、
<a href="faq10.html#ftpchroot">chroot(2) された FTP アクセス</a>を行わせたいのでしたら、
シンボリックリンク誓茲砲蓮瀞竏鳫阡┣のためにアクセスできないので、
これもうまく動かないであろうことに注意してくだ世気ぁ海量簑蠅紡个垢覯魴荳蓮
これらのユーザに対しては <i>/home</i> ディレクトリをホームディレクトリとして使用せず、
たとえば <i>/var/www/home</i> のようなディレクトリを代わりに使用させることでしょう。

<li><b>ログローテーション:</b> 通常、ログのローテーションは古いファイルをリネームすることによって
行われます。Apache の場合は、SIGUSR1 シグナルを httpd(8) に送信することで、古いログがクローズされ、
新しいログがオープンされます。しかし、いったん特権を放棄してしまうと、httpd(8) はログをオープンする
能力を持たなくなるので、これはもはや不可能となります。ですので、ログのローテーションを行うためには、
以下のように httpd(8) をいったん停止させて、再起動させる必要があります。

<pre>
     # <b>apachectl stop && apachectl start</b>
</pre>

また、これ以外に、
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pipe&amp;sektion=2">pipe(2)</a>
にロギングし、pipe(2) の他端における外部のログローテーションの仕組みを使用する方法を含む、他の誓鑪發△蠅泙后

殊蘊錫ぢ既存の Apache のモジュール:</b> 仮想的にすべてをロードする方法を使用することになるのですが、
一部は chroot(2) 環境下では誓気靴虻遒靴覆げ椎柔性がありますので、"<tt>

<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=apachectl&amp;sektion=8">apachectl</a>
restart</tt>" には、httpd(8) が終了してしまうようなエラーの原因となるなど、多くの問題が残ります。

<li><b>既存の CGI:</b> ほとんどのものは、そのままでは動かないでしょう。なぜなら、これらは、
<i>/var/www</i> の外部のプログラムやライブラリを必要とすることが多いからです。これらのうちの
いくつかは、(他のディレクトリのライブラリを必要としない) スタティックリンクとしてコンパイル
することによって解決できるかも知れません。また、これは取るに足りないことではありませんし、
かなりのプログラミング知識を要求されるのですが、他のほとんどは <i>/var/www</i> ディレクトリに
アプリケーションが必要とするファイルを置くことで解決できるかも知れません。ですので、ほとんどの
ユーザは、これらのアプリケーションが更新されるまでは chroot(2) の機能を単純に無効にする方が、
より簡単であるということに落ち着くでしょう。

</ul>

いくつかのケースでは、アプリケーションや誓瀋螢侫．ぅ襪蓿闖誓茲肪屬茲
変更することができます。他のケースでは、
<i><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc.conf&amp;sektion=8">/etc/rc.conf</a></i>
の中で、httpd(8) のオプションとして <tt>-u</tt> を使用して、単にこの機能を無効化することになるでしょう。

<a name="rootshell"></a>
<h2>10.17 - 標準の root のシェルが好きではありません !</h2>
OpenBSD の <i>root</i> のデフォルトシェルは、伝統的な要因で
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=csh&amp;sektion=1">csh</a>
となっています。OpenBSD の root login 用のシェルが csh(1) でなければならないという
必要条件はありません (が、これを変更する前の見解を保持しています)。

<p>
他の Unix ライクなオペレーティングシステムから来たユーザが、csh(1) は好みではない
と言世辰董△匹里茲Δ砲垢譴个海譴鯤儿垢任襪里鮨劼佑討襪海箸△蠅泙后
そのような場合のためのいくつかの選択肢があります。

<ul>
<li><b><i>root</i> でログインしてはいけません !</b>
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=su&amp;sektion=1">su</a>
と
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sudo&amp;sektion=8">sudo</a>
さえあれば、初期誓瀋蠍紊里曚箸鵑匹離▲廛螢院璽轡腑鵑砲箸辰董▲罅璽兇
鳫阡ぢとしてログインしなければならない理由など、ほとんどありません。
<li><b>ログイン後に好みのシェルを呼び出す:</b> もし、ksh(1) や
他のシェルがお好みでしたら、それをデフォルトのシェルから呼び出しましょう。
<li><b>root のシェルを変更する:</b> これは、
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=chsh&amp;sektion=1">chsh</a> か
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=vipw&amp;sektion=8">vipw</a>
を使用して変更できます。
</ul>

伝統的な Unix のガイドラインでは、root 用のシェルはスタティックリンクとなるようにコンパイルされたものだ世韻鮖藩僂垢戮
となっています。と言世Δ里蓮▲轡好謄爐鬟轡鵐哀襯罅璽競癲璽匹乃阿靴疹豺隋
鳫阡ぢパーティション以外はマウントされないので、ダ瀬ぅ淵潺奪螢鵐気譴織轡Д襪少鮗
パーティションに置かれたライブラリにアクセスできないからです。しかし、OpenBSD の場合、
システムがシングルユーザモードで使用するシェルを聞いてきますし、その場合のデフォルトが
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sh&amp;sektion=1">sh</a>
となっていますので、このことは OpenBSD にとっては重大な問題ではありません。

OpenBSD の 3 個の標準シェル
(<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=csh&amp;sektion=1">csh</a>、
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sh&amp;sektion=1">sh</a>
および
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ksh&amp;sektion=1">ksh</a>)
は、すべてスタティックにリンクされていて、シングルユーザモードでも使用可能となっています。

<p>
root のシェルは誓簑个吠儿垢垢戮任呂覆い箸いΔ海箸箸匹誓われますが、
OpenBSD においてはそのような理由は特にありません。しかし、繰り返しますが、
それが問題なのではなく、root としてログインしてはいけない、ということです。

<a name="ksh"></a>
<h2>10.18 - <i>ksh</i> で他に何ができますか ?</h2>
OpenBSD では、
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ksh&amp;sektion=1">ksh</a>
はパブリックドメイン版の Korn Shell である
<a href="http://web.cs.mun.ca/~michael/pdksh/">pdksh</a> であり、これは
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sh&amp;sektion=1">sh</a> と同じバイナリとなっています。

<p>
しばしば Linux システム上で使用されている <i>bash</i> のユーザの利便誓蓮
おそらく、非常によく似た機能を
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ksh&amp;sektion=1">ksh</a>
にも見つけることができるでしょう。ksh(1) は、タブ補完やコマンド行編集、
および矢印キーによるヒストリ機能、CTRL-A/CTRL-E によるコマンド行の
誓萋ぢ最後へのジャンプなど、<i>bash</i> のよく使用される機能のほとんどを
用意しています。もし、他の <i>bash</i> の機能を希望する場合には、<i>bash</i> 自体を
<a href="faq8.html#Ports">ports</a> や <a href="faq8.html#Packages">packages</a>
から導入することも可能です。

<p>
<i>ksh</i> のコマンドプロンプトは、<tt>PS1</tt> 環境変数で誓瀋蠅気譴
デフォルトの "$ " 以上の情報を持つものに簡単に変更することができます。 
たとえば、次の行を <tt>/etc/profile</tt> に挿入することで、

<pre>
     export PS1='$PWD $ '
</pre>

以下のようなコマンドプロンプトを表示させることができるようになります。

<pre>
     /home/nick $
</pre>

多くの便利な機能や例が記載されている
<a href="http://www.openbsd.org/cgi-bin/cvsweb/~checkout~/src/etc/ksh.kshrc?content-type=text/plain"><tt>/etc/ksh.kshrc</tt></a>
を参照して、
ユーザ自身の <tt>.profile</tt> の中に記述しておくと良いでしょう。
<p>
<font color= "#0000e0">
<a href="index.html">[FAQ の目次]</a>
<a href="faq9.html">[9 章 - Linux からのお引っ越し]</a>
<a href="faq11.html">[11 章 - パフォーマンスのチューニング]</a>
</font>

<p>
<hr>
<a href= "index.html"><img height= "24" width= "24" src= "../../images/back.gif" border= "0" alt="[back]"></a>
<a href="mailto:www@@openbsd.org">www@@openbsd.org</a>
<br>
<small>
Originally [OpenBSD: faq10.html,v 1.100 ]
<br>
$Translation: faq10.html,v 1.13 2004/04/13 10:59:56 toshi Exp $
<br>
$OpenBSD: faq10.html,v 1.14 2004/05/09 09:58:22 saad Exp $
</small>
</body>
</html>  
@


1.14
log
@sync with Steelix CVS
@
text
@d1536 1
a1536 1
$OpenBSD: faq10.html,v 1.100 2004/03/25 02:41:51 jcs Exp $
@


1.13
log
@Sync with Steelix CVS
@
text
@@


1.12
log
@sync with steelix translation CVS
@
text
@d1221 1
a1221 1
<a href="http://www.openbsd.org/ja/anoncvs.html">Anonymous CVS のページ</a>
d1532 1
a1532 1
Originally [OpenBSD: faq10.html,v 1.99 ]
d1534 1
a1534 1
$Translation: faq10.html,v 1.12 2004/03/10 12:08:39 toshi Exp $
d1536 1
a1536 1
$OpenBSD: faq10.html,v 1.99 2004/03/10 00:23:11 saad Exp $
@


1.11
log
@sync with steelix translation CVS
@
text
@d44 1
a44 1
<li><a href="#Patches"       >10.15 - OpenBSD にパッチを適用する</a>
d57 9
a65 5
既存のユーザが su するには、そのユーザを手作業で <kbd>&quot;wheel&quot;</kbd> グループに追加する必要があります。
これはセキュリティ上の理由によるものですので、誰にそのアクセス権を付与するかについては十分に注意してくだ世気ぁ
緕帯では、<kbd>wheel</kbd> グループの人は <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=su&amp;sektion=1">su(1)</a>
ユーザランドプログラムを使用して root になることができます。<kbd>&quot;wheel&quot;</kbd> にないユーザは su(1)
を使用することはできません。<strong>ericj</strong> というユーザを <kbd>&quot;wheel&quot;</kbd> に追加するときに
d69 2
a70 1
もし、新しいユーザの追加を <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=adduser&amp;sektion=8">adduser(8)</a>
d80 4
a83 2
ユーザを <kbd>&quot;wheel&quot;</kbd> に加えずに、スーパーユーザの特権の一部をユーザに使用させたい場合には、
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sudo&amp;sektion=8">sudo(8)</a> を使用します。
d90 5
a94 3
ファイルシステムの複誓修砲蓿繙就蔗痕鞳鈞黻鱧芍蜴瘤芍髄鴒巡隍瘢雹黼謾蜿扈権鞘隕県鹿畩ぢと
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=restore&amp;sektion=8">restore(8)</a> を使用します。たとえば、
<kbd>SRC</kbd> ディレクトリ以下のものすべてを <kbd>DST</kbd> に複誓修垢襪砲蓮⊆，里茲Δ砲靴泙后
箟葦
甕鯵
糒逅ぢは強力なバックアップ能力を備えるように誓澤廚気譴討い襪里如韻縫侫．ぅ襯轡好謄爐琉貮
ぢあるいは丸ごと) を複誓修垢訥戮里海箸砲い舛い岨藩僂垢襪茲Δ覆發里任呂覆い眞里譴泙擦鵝修譴覆
箟欝
甕蔚
取仮碓ぢシステム内のデーモンはどのようにして起動するのでしょう ? (rc(8) の概要)</h2>
d119 2
a120 1
OpenBSD は <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc&amp;sektion=8">rc(8)</a>
d124 16
a139 12
	<li>/etc/rc - 主要スクリプト。編集したりしてはいけません。
	<li>/etc/rc.conf - <i>/etc/rc</i> が使用するファイルで、
	    システム起動時にどのデーモンを起動すべきかを記述。
	<li>/etc/rc.conf.local - /etc/rc.conf 自体には手を加えずに、/etc/rc.conf の誓瀋蠅縫璽弌璽薀ぅ匹靴
	使用するための誓瀋螢侫．ぅ襦靴个靴丱▲奪廛哀譟璽匹鮃圓佑燭舛砲亙慷覆發里任后
	殊蘊續齡癇ネットワーク初期化に使うスクリプト。編集してはいけません。
	<li>/etc/rc.local - ローカル管理のためのスクリプト。
	    新しいデーモンやホスト固有の情報は、ここに保存しましょう。
	<li>/etc/rc.securelevel - セキュリティレベルが変わる前に実行しなくてはならないコマンドを実行するスクリプト。
	    <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=init&amp;sektion=8">init(8)</a> を参照。
	<li>/etc/rc.shutdown - シャットダ瀬Ε鷸房孫圓気譴襯好螢廛函轡礇奪肇誓ウン前に実行させたいことをすべてここに記述します。
	    <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc.shutdown&amp;sektion=8">rc.shutdown(8)</a> を参照。
d145 4
a148 3
システム管理者が誓貲阿垢戮舁廛侫．ぅ襪蓮守少續祚鱆闔羲ぢまたは <i>/etc/rc.conf.local</i>)、<i>/etc/rc.local</i> と
<i>/etc/rc.shutdown</i> です。rc(8) の進行のフローは以下のようになります。
d153 15
a167 14
	<li>まず、ファイルシステムをチェックします。これは /etc/fastboot ファイルがあれば省略されますが、
	    もちろん省略することは望ましいことではありません。
	<li>誓瀋衢僂諒竸瑤蘊祟竢鈕鹿蘊ぢから読み込まれます。そしてその後、<i>/etc/rc.conf.local</i> が読み込まれます。
	    rc.conf.local 中の誓瀋蠅祟竢鈕ぢの誓瀋蠅鬟璽弌璽薀ぅ匹靴泙后
	殊蘊ファイルシステムをマウントします。
	<li><i>/tmp</i> をクリアして、エディタファイルは保存します。
	<li><i>/etc/netstart</i> によってネットワークの誓瀋蠅鮃圓い泙后
		受貍
		殊蘊ネットワークインターフェースの誓瀋
		殊蘊ホスト名、ドメイン名等の誓瀋
		鹿	殊蘊システムデーモンを起動します。
	<li>その他の各種チェックを実行します (quota、savecore 等)。
	<li>ローカルデーモンを <i>/etc/rc.local</i> 経由で実行します。
d170 1
a170 1
<h3>OpenBSD 付属のデーモンやサービスを起動する</h3>
d173 3
a175 2
OpenBSD にデフォルトで附属しているデーモンやサービスのほとんどは、<i>/etc/rc.conf</i>
誓瀋螢侫．ぅ襪鯤埆犬垢襪誓けでシステムの起動時に起動されるようになります。まず、デフォルトの
d177 2
a178 1
ファイルを見てみましょう。次のような行が多数あるはずです。
d185 9
a193 5
このような行は、ftpd はシステム起動時には起動されない、という意味になります (少なくとも rc(8) 経由では。詳細は
<a href="faq10.html#AnonFTP">Anonymous FTP FAQ</a> を参照してくだ世気ぢ。いずれにせよ、各行にはコメントもあり、
そのデーモンやサービスの<b>通常利用</b>の場合の値を示しています。しかし、これは、そのデーモンやサービスを
そのフラグで使用しなければならないことを意味するものではありません。man(1) は常に参照可能ですので、好みの形で
起動するようにできます。たとえば、httpd(8) のデフォルトは以下のようになっています。
d203 2
a204 1
<a href="#HTTPS">SSL FAQ</a> か <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ssl&amp;sektion=8">ssl(8)</a> を参照してくだ世気ぢ。
d217 4
a220 2
<i>/etc/rc.local</i> ファイルを使用します。たとえば、/usr/local/sbin/daemonx にデーモンをインストールしたとします。
これをシステムの起動時に起動したい場合には、<i>/etc/rc.local</i> に以下のようなエントリを書き加えます。
d233 2
a234 1
これ以降は、起動時にこのデーモンが実行されるようになります。また、起動時のエラーも見られます。
d246 2
a247 1
apm があるのでしたら、&quot;powerdown=YES&quot; も誓瀋蠅靴討泙后海譴髟阡雌蔘阯と同じになります。
d251 2
a252 1
<h2>10.4 - ユーザが OpenBSD システム経由でリモートからメールを送ろうとすると、中継が拒否されるのはなぜでしょう ?</h2>
d299 2
a300 1
<h2>10.5 - POP を誓瀋蠅靴燭里法椀ぢサーバにアクセスできなくて困っています。どうすれば良いのでしょう ?</h2>
d323 2
a324 1
もうひとつチェックしておきたいのは、ユーザの /var/mail ファイルがそのユーザ自身の所有になっているかどうかです。
d332 2
a333 4
OpenBSD の ports コレクションには、誓気靴な，妊ぅ鵐好函璽襪垢襪海箸椎修
佻デーモンがいくつかあります。
しかし、もし可能でしたら、
OpenBSD の基本インストールで利用可能となっている
d342 3
a344 1
<b>追伸:</b> OpenBSD は &quot;mail&quot; という名前のグループを持っていないことに注意してくだ世気ぁ任垢里如廚覆蕁△海譴蘊鳫鹿蘊ぢファイルに作誓靴覆韻譴个覆蠅泙擦鵝海離┘鵐肇蠅蓮
箜恭
甞挟
以下のような行を含む <tt>/etc/mail/service.switch</tt> ファイルを作誓靴泙后
箚扱
甦宛
最初に、OpenSSL を使用して自分のサーバの鍵と証明製颪鮑鄒成する必要があります。
d438 3
a440 2
これで鍵にサインしてくれる CA にわたすことのできる <i>server.csr</i> ファイルが誓言成されます。
このような CA の一例として、<a href="http://www.thawte.com/">http://www.thawte.com/</a>
d444 2
a445 1
とてもここまでできない人や、証明製颪麓妊汽ぅ鵑垢譴个いい塙佑┐訖佑蓮焚爾里茲Δ砲垢襪海箸發任泙后
箚亀
甦彊
守少續祚齠豁黼鴟纈鶯鹿蘊ぢと <i>/etc/ssl/private/server.key</i> があれば、
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=httpd&amp;sektion=8">httpd(8)</a> を <b>-DSSL</b> フラグつきで起動できるはずです。
これであなたのマシンも、ポート 443 で https のトランザクションができるようになったはずです。
d464 2
a465 1
<h2>10.7 - /etc/passwd を vi(1) で編集したのに変更が反映されません。なぜでしょう ?</h2>
d468 5
a472 3
/etc/passwd を編集しても、変更は全部消えてしまいます。OpenBSD では、/etc/passwd を動的に
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pwd_mkdb&amp;sektion=8&amp;apropos=0">pwd_mkdb(8)</a> コマンドで誓言成しています。OpenBSD の主パスワードファイルは /etc/master.passwd なのです。
pwd_mkdb(8) によると、
d495 3
a497 2
これが vipw(8) です。vipw は vi (あるいは $EDITOR で定義したお気に入りのエディタ)
を使用して /etc/master.passwd を編集できるようにします。その編集が終了すれば、
d528 1
a528 3
これはあなたのニーズ次第で変更することもできます。
以下では、例として、ユーザ <b>testuser</b>
をシステムに追加しています。
d653 2
a654 1
そのパスワードも、暗号化済みのパスワードなのです。ですから、まず
d656 4
a659 3
ユーティリティを使用して予めパスワードを作誓靴討廚△蠅泙后
たとえば、OpenBSD のパスワードはデフォルトでは Blowfish アルゴリズムを 6 回適用したものになります。
useradd(8) に指定するパスワードを作誓垢襪砲蓮△泙此焚爾里茲Δ砲靴覆韻譴个覆蕕覆い海箸砲覆蠅泙后
箏干
畄干
取仮碓鈿銷迴墅ぢではない) ftp 誓賤僖▲Ε鵐箸鮑鄒成するにはどうすればよいのでしょう ?</h2>
d747 12
a758 8
<strong>/etc/shells</strong> にシェルとして追加し、そしてユーザを誓瀋蠅垢襪箸縫蹈哀ぅ鵐轡Д襪
齟蜴瘡黼ぢに指定することで、対話型のログインをできないようにした上で、 ftp は使用可能にすることができます。
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=adduser&amp;sektion=8">adduser(8)</a> を使用すると、
デフォルトでホームディレクトリを <i>/home/&lt;user&gt;</i> にすることができます。それで良ければ、ホームディレクトリを
変更しなくても構いませんが、これも任意のディレクトリを指定することができます。<i>/etc/ftpchroot</i>
に対象ユーザのユーザ名を加えておけば、そのユーザがアクセスできるのは彼自身のホームディレクトリのファイルだ世韻砲覆蠅泙后
また、<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftpd&amp;sektion=8">ftpd(8)</a> に
<b>-A</b> オプションを指定することで、ftpchroot ログインしか受け付けなくなります !
d830 2
a831 1
これで quota が誓瀋蠅気譴泙靴燭里如髟阡を有効にします。そのためには、以下の例のように
d840 2
a841 1
これは <tt>/etc/fstab</tt> を参照して、quota オプションのついたファイルシステムを有効化する作業です。
d845 2
a846 2
そのユーザの情報も見ることができます。引数なしで呼び出されると、quota(1) コマンドは quota 統計を表示すします。
たとえば以下のようにしてみてくだ世気ぁ
筝郡
畍卦
緕帯には、デフォルトの状態で KerberosV がシステムの構誓覆箸靴徳箸濆泙譴討い泙后
筝係
畍傾
妹鰲纈闢についてのより詳しいことは、OpenBSD システム上で以下のコマンドを使用してくだ世気ぁ
筝弘
畍慌
綜闔阨瀞は、アカウントのない人たちに File Transfer Protocol を使用してあなたのコンピュータ上のマシンにアクセスさせるものです。
以下に、この anonymous FTP サーバの概要、そのログの取り方、その他の誓瀋蠅砲弔い峠劼戮泙后
筝昂
畊葦
まず、システム上に "ftp" というアカウントが必要になります。このアカウントは、使用可能なパスワードを持っていてはいけません。
ここでは仮にログインディレクトリを /home/ftp としますが、これはどこでも好みのディレクトリを指定して構いません。
anonymous ftp を使用する場合、ftp は chroot して 'ftp' ユーザのホームディレクトリに移動します。この詳細については、
d904 10
a913 5
man ページを参照してくだ世気ぁ０焚爾蘊胄霄ユーザ追加の例を示します。ここでは <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=adduser&amp;sektion=8">adduser(8)</a> を使用します。
さらに <i>/etc/shells</i> に /usr/bin/false を追加しておいてくだ世気ぁ海譴海ぢユーザに使用させる &quot;シェル&quot;
ということになります。このため彼らは、空のパスワードをもらってもログインすることはできません。これには簡単に
<i>echo /usr/bin/false &gt;&gt; /etc/shells</i> とすれば良いでしょう。また、adduser
の質問のときにそのシェルがあらわれるようにしたければ、<i>/etc/adduser.conf</i> も変更しておく必要があります。
d957 4
a960 3
これでユーザと同時に <i>/home/ftp</i> というディレクトリが作誓気譴泙靴拭海譴呂海舛蕕琉嫂泙靴燭箸蠅侶覯未覆里任垢
瘤闔阨胄で使用するためにはもうひと工夫が必要になります。これについては
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftpd&amp;sektion=8">ftp(8)</a> man ページに誓睫誓されています。
d963 2
a964 1
/home/ftp/usr や /home/ftp/bin ディレクトリは<b>作誓垢詆廚呂△蠅泙擦鹿眈。
d966 10
a975 4
<li><i>/home/ftp</i> - これがメインのディレクトリです。所有者は root にして、パーミッションは 555 にしておいてくだ世気ぁ
殊蘊守少蓖辣鹿蘊ぢこれはまったくのオプションでしかなく、お勧めもしません。それは、このマシン上のユーザについての情報を漏曳することになるだ世韻誓からです。しかし、anonymous ftp ディレクトリで、ファイルに実際のオーナ情報等を表示させたい場合には、<i>/home/ftp/etc</i> ディレクトリを作誓靴續祚頷筮籵ぢと /etc/group をこのディレクトリにコピーしておきます。このディレクトリはモードを 511 にして、コピーしたふたつのファイルはモード 444 にしておきます。これでファイルの所有者が番号ではなく名前で表示されるようになります。
また、pwd.db にはパスワードは含まれず、パスワードはすべて spwd.db に入っています。
ですから、spwd.db は<strong>誓簑个鹿齡鳫鈑ぢコピーしてはいけません。
d1010 5
a1014 3
ftpd の場合、これを inetd から実行するのか、あるいは rc スクリプトで開始するのか選択することが可能です。以下の例では、
デーモンを <a href="http://www.openbsd.org/cgi-bin/cvsweb/src/etc/inetd.conf">inetd.conf</a> から起動することにします。
まずは ftpd のオプションのいくつかに馴れておいてくだ世気ぁ守少續祚蜴續筮竢鈕鹿蘊ぢのデフォルトの記述は以下のようになります。
d1021 8
a1028 5
ここでは ftpd は <i>-US</i> オプションで起動されています。これは anonymous 誓楝海離蹈阿蘊癇閾篌に記録し、
同時に発誓犬垢襯札奪轡腑鵑離蹈阿蘊癇霄に記録するものです。これでセッションが who(1) で見られるようになります。
中には、anonymous サーバだ世韻鮗孫圓靴董▲罅璽兇砲ぢを許可しないようにしたい場合もあるでしょう。そのためには、ftpd を
<i>-A</i> オプションで起動します。以下に挙げるのは、ftpd を anonymous 誓楝海里澆鯒Г瓩觀舛乃阿垢詢磴任后気蕕蘊貅オプションも付与しています。これは、get、retrieve などの ftp コマンドと合わせて、それぞれの誓楝海離蹈阿跫に記録します。
d1035 5
a1039 3
Note - トラフィックが非常に高い ftp サーバを運用する人は、ftpd を inetd.conf から起動しないほうがいいかも知れません。
最も良い方法は、inetd.conf の ftpd をコメントアウトして、ftpd を <i>-D</i> オプションつきで rc.conf から起動することでしょう。
これなら、ftpd はデーモンとして起動されるので、inetd から起動するよりオーバーヘッドもずっと小さくなるのです。
d1053 6
a1058 3
<li><i>/etc/ftpwelcome</i> - ここには ftp サーバに誓楝海靴真佑紡个靴読充┐垢襯瓮奪察璽犬鮟颪泙后
殊蘊守少續祚迴鹿蘊ぢこれは、ftp サーバにログインしてきた人に対して表示するメッセージです。
<li><i>.message</i> - このファイルはどこのディレクトリに置いても構いません。ユーザがそのディレクトリに入ってきたら表示されるメッセージです。
d1067 3
a1069 2
OpenBSD の <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftpd&amp;sektion=8">ftpd(8)</a> は、
デフォルトでこれを簡単にこなせるようになっています。これは
d1209 3
a1211 3
これはバイナリ形式では<b>配布されていません</b>。つまり、
システムにパッチを適用するためには、OpenBSD
<b>リリース</b>バージョンのソースコードが手元になければなりません。
d1213 3
a1215 2
パッチを適用するプログラムの分についてはすべて必要となります。たとえば、
カーネルにパッチを適用するのでしたら、カーネルのソースコードが手元に必要となるのです。
d1219 3
a1221 2
を使用すると、手軽に好みの anonymous cvs サーバから、必要なソースコードだ世韻鮗萋誓することができます。サーバ一覧は
<a href="http://www.openbsd.org/ja/anoncvs.html">http://www.openbsd.org/anoncvs.html</a>
d1241 19
a1259 5
必要なソースコードの CVS パスを調べるには、適用したいパッチの <i>Index:</i> 行を見ます。
この例では、CVS パスは <i>src/libexec/talkd/</i> になります。必ず OPENBSD_version_number_BASE のリビジョンをチェックしてくだ世気ぁ汰單ぢがない場合には、安定版ブランチをチェックアウトしていることになります。これには不要な他のコードが含まれているかも知れません。既にパッチブランチを追いかけているのでしたら、パッチは既にソースに含まれているはずですが、必ず確認するようにしてくだ世気ぁ釈鱚羹〓甎韭譬乗雕關緕碵筮闥膀韭貅を見れば、どのパッチがパッチブランチに適用されたのかがわかるはずです。もし、パッチがまだ静僂気譴討い覆韻譴弌⊂綉離灰泪鵐匹鮖藩僂靴萄膿轡螢蝓璽垢離宗璽好魁璽匹鮗萋誓してくだ世気ぁ

腫また、公式 OpenBSD CD を買ってくれた人は、直誓からソースコードを持ってくると良いでしょう。CD からソースを持ってくる方法については、CD に付属の紙を見てくだ世気ぁ海里茲Δ砲垢譴弌瘤闔笆経由でソースを持って来る必要はありません。
d1287 2
a1288 1
然るべきソースコードを入手したら、パッチを取得世靴蘊齟祚鹿蘊ぢに置いてくだ世気ぁ
箟涯甕涯されたアプリケーションは特定のディレクトリに閉じ込められ、そのディレクトリが
"<tt>/</tt>" (ルート) ディレクトリであるかのように見えます。
d1390 7
a1396 8
chroot(2) されているため、その逆に <i>/var/www</i> から
ファイルシステムの他の場所へのシンボリックリンクを使用することはできません。
もし、ユーザに対して、<a href="faq10.html#ftpchroot">chroot(2) された
FTP アクセス</a>を行わせたいのでしたら、シンボリックリンク誓茲砲蓮
瀞竏鳫阡┣のためにアクセスできないので、これもうまく動かないだ世蹐
ということに注意してくだ世気ぁ海量簑蠅紡个垢覯魴荳蓮△海譴蕕離罅璽兇紡个靴討
守少蓖辣鹿蘊ぢディレクトリをホームディレクトリとして使用せず、たとえば
<i>/var/www/home</i> のようなディレクトリを代わりに使用させることでしょう。
d1410 1
a1410 2
にロギングし、pipe(2) の他端における外部のログローテーションの仕組みを使用する方法を含む、
他の誓鑪發△蠅泙后
箟官甕官一部は chroot(2) 環境下では誓気靴虻遒靴覆げ椎柔性がありますので、
"<tt><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=apachectl&amp;sektion=8">apachectl</a> restart</tt>"
には、httpd(8) が終了してしまうようなエラーの原因となるなど、多くの問題が残ります。
d1532 1
a1532 1
Originally [OpenBSD: faq10.html,v 1.97 ]
d1534 1
a1534 1
$Translation: faq10.html,v 1.10 2004/03/01 01:48:45 toshi Exp $
d1536 1
a1536 1
$OpenBSD: faq10.html,v 1.97 2004/02/29 20:45:59 saad Exp $
@


1.10
log
@Sync with Steelix CVS
@
text
@d1100 2
a1101 2
<a href="../../ja/errata.html">http://www.openbsd.org/errata.html</a>
にある errata web ページ上で、カテゴリ別に分けて公開されています。そして、
d1114 2
a1115 2
<a href="../../ja/errata.html">errata.html</a>
からのパッチを適用してみましょう。
d1120 4
a1123 3
<a href="../../ja/errata.html">http://www.openbsd.org/errata.html</a>
にポストされるパッチは、最新リリースのソースツリーに対するものなのです。
また、最新の CVS ツリーに対するパッチには、リリースシステムでは求められないような
d1437 1
a1437 1
Originally [OpenBSD: faq10.html,v 1.96 ]
d1439 1
a1439 1
$Translation: faq10.html,v 1.9 2004/01/03 02:42:02 toshi Exp $
d1441 1
a1441 1
$OpenBSD: faq10.html,v 1.96 2004/01/01 04:13:34 nick Exp $
@


1.9
log
@sync with steelix translation CVS
@
text
@d11 1
a11 1
<meta name= "copyright"     content= "This document copyright 1998-2003 by OpenBSD.">                                           <meta name= "copyright"     content= "Japanese translation copyright 2000 by Yamagata Hiroo">
d1436 1
a1436 1
Originally [OpenBSD: faq10.html,v 1.95 ]
d1438 1
a1438 1
$Translation: faq10.html,v 1.8 2003/11/03 12:46:04 toshi Exp $
d1440 1
a1440 1
$OpenBSD: faq10.html,v 1.95 2003/10/30 22:43:42 nick Exp $
@


1.8
log
@Sync with Steelix CVS
@
text
@@


1.7
log
@Sync with Steelix CVS
@
text
@d1004 1
a1004 1
230- OpenBSD 3.3 (GENERIC) #44: Sat Mar 29 13:22:05 MST 2003
d1144 1
a1144 1
<i>3.3-release</i> の talkd(8) のソースコードを
d1151 1
a1151 1
$ <b>cvs co -rOPENBSD_3_3_BASE src/libexec/talkd/</b>
a1251 1
<!-- XXXchanges - stops being new with 3.3 -->
d1254 1
a1254 1
OpenBSD 3.2 から、Apache 
d1436 1
a1436 1
Originally [OpenBSD: faq10.html,v 1.94 ]
d1438 1
a1438 1
$Translation: faq10.html,v 1.7 2003/10/27 15:56:37 toshi Exp $
d1440 1
a1440 1
$OpenBSD: faq10.html,v 1.94 2003/10/26 16:58:20 nick Exp $
@


1.6
log
@Sync with Steelix CVS
@
text
@d406 1
a406 2
でアクセス可能な <b>Thawte Certification</b> があります。Thawte は現時点世任蓮厶鍵に署名してくれますが、
DSA 鍵も使用できるようにするための手続きも進行中です。
d1437 1
a1437 1
Originally [OpenBSD: faq10.html,v 1.93 ]
d1439 1
a1439 1
$Translation: faq10.html,v 1.6 2003/10/26 14:21:23 toshi Exp $
d1441 1
a1441 1
$OpenBSD: faq10.html,v 1.93 2003/10/26 02:05:59 nick Exp $
@


1.5
log
@Sync with Steelix CVS
@
text
@d547 2
a548 1
testuser:$2a$07$ZWnBOsbqMJ.ducQBfsTKUe3PL97Ve1AHWJ0A4uLamniLNXLeYrEie:1002:31::0:0:Test FAQ User:/home/testuser:/bin/ksh
d1151 2
a1152 1
$ <b>cvs -d anoncvs@@anoncvs5.usa.openbsd.org:/cvs co -rOPENBSD_3_3_BASE src/libexec/talkd/</b>
d1228 4
a1231 1
mkdep -a /home/ericj/lsrc/src/libexec/talkd/talkd.c /home/ericj/lsrc/src/libexec/talkd/announce.c /home/ericj/lsrc/src/libexec/talkd/process.c /home/ericj/lsrc/src/libexec/talkd/table.c /home/ericj/lsrc/src/libexec/talkd/print.c
d1238 2
a1239 1
nroff -Tascii -mandoc /home/ericj/lsrc/src/libexec/talkd/talkd.8 &gt; talkd.cat8
d1438 1
a1438 1
Originally [OpenBSD: faq10.html,v 1.92 ]
d1440 1
a1440 1
$Translation: faq10.html,v 1.5 2003/10/21 14:30:35 toshi Exp $
d1442 1
a1442 1
$OpenBSD: faq10.html,v 1.92 2003/10/19 23:14:22 nick Exp $
@


1.4
log
@sync with steelix cvs
@
text
@d487 4
a490 3
以下では、例として、ユーザ <b>testuser</b> をシステムに追加しています。
このユーザの $HOME ディレクトリは <i>/home/testuser</i> で、
<b>guest</b> グループに入り、シェルは <i>/bin/ksh</i> となります。
d497 1
d503 22
a524 19
Enter username [a-z0-9_]: <strong>testuser</strong>
Enter full name []: <strong>Test FAQ User</strong>
Enter shell csh ksh nologin sh [ksh]: <strong>ksh</strong>
Uid [1002]: <strong>&lt;Enter&gt;</strong>
Login group testuser [testuser]: <strong>guest</strong>
Login group is ``guest''. Invite testuser into other groups: guest no
[no]: <strong>no</strong>
Enter password []: 
Enter password again []:

Name:     testuser
Password: ****
Fullname: Test FAQ User
Uid:      1002
Gid:      31 (guest)
Groups:   guest
HOME:     /home/testuser
Shell:    /bin/ksh
OK? (y/n) [y]: <strong>y</strong>
d526 2
a527 2
Copy files from /usr/share/skel to /home/testuser
Add another user? (y/n) [y]: <strong>n</strong>
d857 2
a858 2
oshibana# <strong>adduser</strong>
Use option ``-silent'' if you don't want see all warnings &amp; questions.
d861 1
d867 22
a888 19
Enter username [a-z0-9_]: <strong>ftp</strong>
Enter full name []: <strong>anonymous ftp</strong>
Enter shell csh false ksh nologin sh tcsh zsh [sh]: <strong>false</strong>
Uid [1002]:
Login group ftp [ftp]:
Login group is ``ftp''. Invite ftp into other groups: guest no
[no]: <strong>no</strong>
Enter password []:
Use an empty password? (y/n) [y]: <strong>y</strong>

Name:     ftp
Password: ****
Fullname: anonymous ftp
Uid:      1002
Gid:      1002 (ftp)
Groups:   ftp
HOME:     /home/ftp
Shell:    /usr/bin/false
OK? (y/n) [y]: <strong>y</strong>
d890 2
a891 2
Copy files from /usr/share/skel to /home/ftp
Add another user? (y/n) [y]: <strong>n</strong>
d1432 1
a1432 1
Originally [OpenBSD: faq10.html,v 1.91 ]
d1434 1
a1434 1
$Translation: faq10.html,v 1.4 2003/09/18 15:50:17 toshi Exp $
d1436 1
a1436 1
$OpenBSD: faq10.html,v 1.91 2003/06/17 15:59:07 nick Exp $
@


1.3
log
@sync with steelix translation CVS
@
text
@d404 1
a404 1
これで鍵にサインしてくれる CA に渡すことのできる <i>server.csr</i> ファイルが誓言成されます。
d1425 1
a1425 1
$Translation: faq10.html,v 1.3 2003/06/17 23:04:53 toshi Exp $
@


1.2
log
@
sync with steelix translation CVS
@
text
@a53 1
<a name= "10.1"></a>
a79 1
<a name= "10.2"></a>
a104 1
<a name="10.3"></a>
a221 1
<a name="10.4"></a>
a268 1
<a name="10.5"></a>
a356 1
<a name="10.6"></a>
a425 1
<a name="10.7"></a>
a461 1
<a name="10.8"></a>
d468 2
a469 2
	<li><a href="#adduser">adduser(8)</a>
	<li><a href="#user">user(8)</a>
d472 4
d480 3
a482 3
スクリプトを使用することでしょう。これは、<strong>/etc/adduser.conf</strong> を編集することで、
好みの挙動に誓瀋蠅垢襪海箸任泙后釈鱚羹∵雕關緕碵筮闥膀竍薛砠遲轣隨竍蘓髟纈頷逅雌繼闔集⊂頷┯を使用して手動でユーザを追加しても良いのですが、
お奨めは adduser(8) の方です。adduser(8) は <strong>/etc/passwd</strong>、<strong>/etc/group</strong>
d484 1
a484 1
また、$HOME ディレクトリのエントリも自動的に作誓靴泙后
箚原
甦幻
これはあなたのニーズ次第で変更することもできます。以下では見本ユーザ <b>testuser</b>
をシステムに追加しています。このユーザの $HOME ディレクトリは <i>/home/testuser</i> で、
d527 2
a528 1
ユーザを削除するには、<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rmuser&amp;sektion=8">rmuser(8)</a>
d530 6
a535 3
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=crontab&amp;sektion=1">crontab(1)</a> の関連エントリも消去されますし、$HOME ディレクトリも (オーナがそのユーザなら) 消去され、メールも消去されます。
もちろん、<strong>/etc/passwd</strong> と <strong>/etc/group</strong> のエントリも消去されます。
以下は、さきほど追加したユーザを削除した場合です。ユーザ名を入力するようプロンプトが出力され、ユーザのホームディレクトリを削除すべきかどうかの確認を求められているのがわかります。
d562 10
a571 10
	<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=group&amp;sektion=8">group(8)</a>
	<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=groupadd&amp;sektion=8">groupadd(8)</a>
	<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=groupdel&amp;sektion=8">groupdel(8)</a>
	<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=groupinfo&amp;sektion=8">groupinfo(8)</a>
	<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=groupmod&amp;sektion=8">groupmod(8)</a>
	<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=user&amp;sektion=8">user(8)</a>
	<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=useradd&amp;sektion=8">useradd(8)</a>
	<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=userdel&amp;sektion=8">userdel(8)</a>
	<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=userinfo&amp;sektion=8">userinfo(8)</a>
	<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=usermod&amp;sektion=8">usermod(8)</a>
d577 6
a582 1
user(8) は対話的に使用できないので、ユーザを手軽に追加する最も簡単な方法は、adduser(8) コマンドを使うことです。実際のコマンド <i>/usr/sbin/user</i> は、その他の <i>/usr/sbin/user*</i> コマンド群のフロントエンドに過ぎません。ですから、以下のコマンドは <b>user add</b> や <b>useradd</b> を使用すれば追加できますし、何が必要で、何が不要かはあなたの選択次第であり、コマンドの使用方法は一誓敲僂蠅泙擦鵝
箋元
甬弦
この例では、上記の <a href="#adduser">adduser</a> で行ったのと同じユーザを同じ条件で追加してみましょう。useradd(8) は、ユーザ追加前にデフォルト誓瀋蠅鮹里辰討い襪曚Δ△茲蟷箸い笋垢い發里砲覆蠅泙后海寮設定は、<i>/etc/usermgmt.conf</i> に記述してあり、次のようにすることで参照可能です。
d603 9
a611 1
コマンドラインでオプション指定しない限りは、この誓瀋蠅藩僂気譴泙后燭箸┐弌△海海任領磴任蓮▲罅璽兇僚蠡哀哀襦璽廚眈纈鷦ではなく <b>guest</b> にしたいとします。さらにもうひとつのハードルがあります。パスワードをコマンドラインで指定しなければなりません。そのパスワードも、暗号化済みのパスワードなのです。ですから、まず <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=encrypt&amp;sektion=1">encrypt(1)</a> ユーティリティを使用して予めパスワードを作誓靴討廚△蠅泙后燭箸┐弌緕帯のパスワードはデフォルトでは Blowfish アルゴリズムを 6 回適用したものになります。useradd(8) に指定するパスワードを作誓垢襪砲蓮△泙此焚爾里茲Δ砲靴覆韻譴个覆蕕覆い海箸砲覆蠅泙后
箒恩
甼慨
錫ぢ注:</b> シェルが user(8) に送る前にこれを解釈してしまうので、パスワードのストリングを囲むときには、&quot;&quot; ではなく、'' を使用しなければなりません。これに加えて、ユーザのホームディレクトリを作誓靴蘊諷貅のファイルをコピーしておく必要があるのでしたら、<b>-m</b> オプションを忘れないようにしてくだ世気ぁ
箒碍
甼街
ユーザが問題なく作誓気譴燭匹Δ魍稜Г垢襪砲蓮△い蹐い蹐淵罅璽謄螢謄藩儔椎修任后０焚爾法△垢戮討正しく作誓気譴燭匹Δ魍稜Г垢襪燭瓩離灰泪鵐匹鬚い弔鵑欧討泙后
箒宜
甼彊
これらのコマンドに加えて、user(8) は userinfo(8) と呼ばれる独自のユーティリティを提供していて、ユーザ属誓鯢充┐垢襪海箸任泙后
箒傾
甼険
纈┯以下のコマンドでユーザ削除するには、userdel(8) を使用します。これはとても簡単で使いやすいコマンドです。上記の例で作誓靴織罅璽兇鮑鐔垢襪砲蓮韻房，里茲Δ砲靴泙后
箒幻
甼恒
錫将鮗オプションに注意してくだ世気ぁ罅璽兇離曄璽爛妊譽肇蠅眛瓜忘鐔垢訃豺腓砲蓮△海離廛轡腑鵑廚砲覆蠅泙后△襪い蓮錫将鮗の代わりに <b>-p</b> を指定した場合には、ユーザのアカウントはロックされますが、情報が一誓攤鐔気譴襪海箸呂△蠅泙擦鵝
甼拘
釈瘢綵握喉昭箏旭
畄斡
齟蜴瘡黼ぢに指定することで、対話型のログインをできないようにした上で、
ftp は使用可能にすることができます。<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=adduser&amp;sektion=8">adduser(8)</a>
を使用すると、デフォルトでホームディレクトリを <i>/home/&lt;user&gt;</i> にすることができます。
それで良ければ、ホームディレクトリを変更しなくても構いませんが、
これも任意のディレクトリを指定することができます。
<i>/etc/ftpchroot</i> に対象ユーザのユーザ名を加えておけば、そのユーザがアクセスできるのは
彼自身のホームディレクトリのファイルだ世韻砲覆蠅泙后泙拭釈鱚羹∵雕關緕碵筮闥膀竍薛砠遲轣隨竍蘓髟纈胄鞣逅雌繼闔集⊂胄鞣┯に <b>-A</b> オプションを指定することで、ftpchroot ログインしか受け付けなくなります !
a709 1
<a name="10.10"></a>
a816 1
<a name="10.11"></a>
a830 1
<a name="10.12"></a>
a977 1
<a name="10.13"></a>
a1084 1
<a name="10.14"></a>
d1423 1
a1423 1
Originally [OpenBSD: faq10.html,v 1.89 ]
d1425 1
a1425 1
$Translation: faq10.html,v 1.2 2003/05/10 01:03:42 toshi Exp $
d1427 1
a1427 1
$OpenBSD: faq10.html,v 1.89 2003/05/05 03:49:58 david Exp $
@


1.1
log
@
sync with steelix translation CVS
@
text
@d30 5
a34 5
<li><a href="#wheel"         >10.1 - su で root になろうとすると、グループが違うと言世錣譴泙鹿畩鹿跚殊蘊釈鱚羹■汀霪哂碓ぢファイルシステムを丸ごと複誓修垢襪砲鹿畩鹿跚殊蘊釈鱚羹■鱆碓ぢシステム内のデーモンはどのように起動するのでしょう ? (rc(8) の概要)</a></li>
<li><a href="#RelayingDenied">10.4 - ユーザが OpenBSD システム経由でリモートからメールを送ろうとすると、リレーアクセスが拒否されるのはどうしてでしょう ?</a></li>
<li><a href="#POP"           >10.5 - POP を誓瀋蠅靴燭里法椀ぢサーバにアクセスできなくて困っています。どうすれば良いのでしょう ?</a></li>
d36 9
a44 9
<li><a href="#HTTPS"         >10.7 - SSL(8) を使用したセキュアな HTTP サーバの誓瀋鹿畩鹿跚殊蘊釈鱚羹■頷碓續祚鞜齠ぢを vi(1) で編集したのに変更が反映されません。なぜでしょう ?</a></li>
<li><a href="#AddDelUser"    >10.9 - ユーザを追加するには ? &nbsp; また、削除するには ?</a></li>
<li><a href="#FTPOnly"       >10.10 - ftp 誓賤僖▲Ε鵐箸鮑鄒成するにはどうすればよいのでしょう ?</a></li>
<li><a href="#Quotas"        >10.11 - ユーザのディスク quota を誓瀋鹿畩鹿跚殊蘊釈鱚羹■妹鰲纈闢碓妹鰲纈闢ぢクライアント/サーバの誓瀋鹿畩鹿跚殊蘊釈鱚羹■綜闔瀞丐碓綜闔阨瀞サーバの誓瀋鹿畩鹿跚殊蘊釈鱚羹■胄鞦蓿闖槇碓胄鞣┯でユーザをホームディレクトリから出られないようにするには ?</a></li>
<li><a href="#Patches"       >10.15 - OpenBSD にパッチを適用する</a></li>
d226 1
a226 1
<h2>10.4 - ユーザが OpenBSD システム経由でリモートからメールを送ろうとすると、リレーアクセスが拒否されるのはどうしてでしょう ?</h2>
d476 2
a477 2
	<li><a href="#adduser">adduser(8)</a></li>
	<li><a href="#user">user(8)</a></li>
d788 1
a788 1
<h2>10.12 - OpenBSD で Kerberos のクライアントとサーバを使う</h2>
d791 1
a791 4
OpenBSD のユーザ/管理人であるあなたは幸運です。
KerberosIV がデフォルトシステムのコンポーネントとしてインストール済みなのですから。
ここでは Kerberos realm サーバと、
クライアントの誓瀋衒，鮴説明世靴泙后
箏拘
畄拘首闔臂非常に</strong>重要なポイントとして、Kerberos クライアントとサーバは
システムの時計が同期していなくてはなりません。時計のずれが 5 分以上もあると、
変なエラーが出るようになりますし、それが時計のずれのせいだ世箸呂覆覆い鼎覆い里任后
たとえば、以下のようなエラーになりますし、

<blockquote><pre>
kinit: Can't send request (send_to_kdc) 
</pre></blockquote>

あるいは、よりわかりやすいエラーの場合で、以下のようなものになります。

<blockquote><pre>
kauth: Time is out of bounds (krb_rd_req) 
</pre></blockquote>

<p>
システムの時計を同期させる簡単な方法として ntpd があります。これは packages にも入っていますし、
ports ツリーでも <strong>/usr/ports/net/ntp/</strong> にあります。

<p>
FAQ のこの部分は、Kerberos の考え方をあなたが事前に知っているという前提で書かれています。
すばらしくわかりやすい参考文献としては、以下のようなものがあります。

<ul>
<li><a href="http://www.freebsd.org/handbook/kerberos.html">The FreeBSD handbook</a>
<li><strong>info kth-krb</strong> コマンドを使用してみましょう。
<li><a href="http://web.mit.edu/kerberos/www/dialogue.html">Designing an Authentication System: a Dialogue in Four Scenes</a>
<li><a href="http://web.mit.edu/kerberos/www/papers.html#krb4">KerberosIV について記述された論席犬筌疋絅瓮鵐董璽轡腑鵑い蹐い鹿畩
鹿あるいは本なら、以下のようなものがあります。
<ul>
<li><a href="http://www.amazon.com/exec/obidos/ASIN/0130614661/qid%3D930594963/">Network Security Private Communication in a Public World [Kaufman, Perlman, Speciner, 1995]</a>
</ul>

<h3>Kerberos IV の REALM と SERVER の誓瀋鹿莖
腫檀倉喪搜堙羊詫ぢという realm で、avalanche.ciarasystems.com を主サーバにして誓瀋蠅靴泙后

腫最初に、誓瀋螢侫．ぅ襪諒埆犬廚砲覆蠅泙后海離侫．ぅ襪少續祚諷鰲纈闢埠ぢにあります。
私たちが注意すべきふたつのファイルは <i>krb.realms</i> と <i>krb.conf</i> です。まず、<i>krb.conf</i> から始めましょう。

<blockquote><pre>
[root@@avalanche kerberosIV] <strong>cat krb.conf</strong>
CIARASYSTEMS.COM
CIARASYSTEMS.COM avalanche.ciarasystems.com admin server
</pre></blockquote>

<p>
ご覧のように、これで kerberos に、ドメイン (または論斥縺跋が CIARASYSTEMS.COM で、そのドメインの中で
avalanche が管理サーバだ世箸いΔ里舛錣蠅泙后，蘊謦皰鱚瘡逑鹿蘊ぢを見てみましょう。詳細は、
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=krb.conf&amp;sektion=5">krb.conf</a> を参照してくだ世気ぁ

錫跫站髟阡緇腫鱚首闔臂竅謦皰鱚瘡逑鹿齡鳫鈑癘瘡瘤竏絎竕癇癈逑闕檀倉喪搜堙羊詫
蛛鱇齷齡纃鶤竢檀倉喪搜堙羊詫
鹿頏緇鹿碎閭鞫
腫謦皰鱚瘡逑ぢは、ホスト名から、そのホストがサービスを提供する Kerberos の realm 名への変換を行います。変換ファイルの
それぞれの行は、以下の形式のいずれかであるべきです (domain_name は .XXX.YYY という形式でなければなりません)。ですから、
この例では、avalanche は CIARASYSTEMS.COM realm 上にあるコンピュータのホスト名になります。ここでも、詳しい情報は
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=krb.realms&amp;sektion=5">krb.realms</a>
man ページを参照してくだ世気ぁ

腫次に <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=kbd_init&amp;sektion=8">kdb_init(8)</a> 
を実行して、初期 Kerberos データベースを作誓靴泙后

錫跫站髟阡緇腫鱚首闔臂諢矍蜴蜚鹿齡鳫鈑吶瘡釶辣粤聲弄津徳嫐址凖遡欹描卅噎嘖斗哺地搶跛頏闕頸繖闥蒹癆痰癈浴齡纈癈齬闥筮
部蜊竟鶯瘤癆阨碗播蜩癈齬闥筮

梼妹鰲纈闢癈鞜齠鰾首闔臂鈿鼈阯郤闔臂
帙鱸胱蜴鞜齠鰾
梼妹鰲纈闢癈鞜齠鰾鹿頏緇鹿碎閭鞫
腫次に、<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=kstash&amp;sektion=8">kstash(8)</a> を使用します。
これは Kerberos キー配布センター (KDC) データベースのマスターキーをマスターキーキャッシュファイルに入れるものです。

<blockquote>
d796 1
a796 7
# <strong>kstash</strong>
Enter Kerberos master password:

Current Kerberos master key version is 1.

Master key entered.  BEWARE!
Wrote master key to /etc/kerberosIV/master_key
a798 246
これで暗号化されたマスターパスワードが /etc/kerberosIV/master_key に保存されました。

<p>
次に、 Kerberosで保護されるシステムのそれぞれについて、ふたつの principals
がデータベースに追加される必要があります。 それは、<i>kpasswd</i> と <i>rcmd</i>
のふたつです。このふたつの principals がそれぞれのシステム用に作誓気譟
インスタンスは個別システム名になります。

これらの、<i>kpasswd</i> と <i>rcmd</i> のふたつのデーモンは、他のシステムが
Kerberos のパスワードを変更したり、<i>rcp, rlogin</i> および <i>rsh</i>
などのコマンドを実行できるようにするためのものです。


<pre>
# <b>kdb_edit</b>
Opening database...
    
Enter Kerberos master key:
    
Current Kerberos master key version is 1.
    
Master key entered.  BEWARE!

Previous or default values are in [brackets] ,
enter return to leave the same, or new value.

Principal name: <strong>passwd</strong>
Instance: <strong>avalanche</strong>

&lt;Not found&gt;, Create [y] ? <strong>y</strong>

Principal: passwd, Instance: avalanche, kdc_key_ver: 1
New Password:                <strong>&lt;----- ここでは「RANDOM」と入力する</strong>
Verifying password -
New Password:

Random password [y] ? <strong>y</strong>

Principal's new key version = 1
Expiration date (enter yyyy-mm-dd) [ 1999-12-31 ] ? <strong>2001-12-31</strong>
Max ticket lifetime (*5 minutes) [ 255 ] ?
Attributes [ 0 ] ?
Edit O.K.


Principal name: <strong>rcmd</strong>
Instance: <strong>avalanche</strong>

&lt;Not found&gt;, Create [y] ? <strong>y</strong>
Principal: rcmd, Instance: avalanche, kdc_key_ver: 1
New Password:                 <strong>&lt;----- ここでは「RANDOM」と入力する</strong>
Verifying password -
New Password:

Random password [y] ? <strong>y</strong>

Principal's new key version = 1
Expiration date (enter yyyy-mm-dd) [ 1999-12-31 ] ? <strong>2001-12-31</strong>
Max ticket lifetime (*5 minutes) [ 255 ] ?
Attributes [ 0 ] ?
Edit O.K.
Principal name:               <strong>&lt;----- &lt;ENTER&gt; を押すと終了</strong>

</pre>
</blockquote>

<p>
srvtab ファイルはサービスキーファイルです。各サービスが Kerberos 利用を認証するためには、これは Kerberos
キー配信センターのデータベースから抽出したものでなくてはなりません。コマンドラインで指定された各ホスト名ごとに、
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ext_srvtab&amp;sektion=8">ext_srvtab(8)</a>
がサービスキーファイルの hostname-new-srvtab を作誓靴泙后海海砲蓮▲曠好般召鬟ぅ鵐好織鵐垢離侫璽襯匹忙
すべてのエントリが含まれています。

<blockquote><pre>
# <Strong>ext_srvtab avalanche</strong>

Enter Kerberos master password:

Current Kerberos master key version is 1.

Master key entered.  BEWARE!
Generating 'avalanche-new-srvtab'....

# <strong>mv avalanche-new-srvtab srvtab</strong>
# <strong>chmod 600 srvtab</strong>
</pre></blockquote>

<p>
これで、ユーザをデータベースに追加できるようになりました。

<blockquote><pre>
# <strong>kdb_edit</strong>
Opening database...
    
Enter Kerberos master key:
    
Current Kerberos master key version is 1.
    
Master key entered.  BEWARE!
Previous or default values are in [brackets] ,
enter return to leave the same, or new value.
    
Principal name: <strong>jeremie</strong>
Instance:
    
&lt;Not found&gt;, Create [y] ? <strong>y</strong>
    
Principal: jeremie, Instance: , kdc_key_ver: 1
New Password:                &lt;---- ここで安全なパスワードを入力
Verifying password
    
New Password:                &lt;---- パスワード再入力
Principal's new key version = 1
Expiration date (enter yyyy-mm-dd) [ 2000-01-01 ] ?
Max ticket lifetime (*5 minutes) [ 255 ] ?
Attributes [ 0 ] ?
Edit O.K.
Principal name:          &lt;---- ここでリターンだ世韻魏，垢判察
				続けてエントリを追加することも可能。
</pre></blockquote>

<p>
これで、Kerberos の各種誓瀋蠅錣蠅泙靴拭８紊狼飴纈矼鳫サーバがロードされるようにして、
Kerberos 化されたデーモンを有効にするだ世韻任后

腫祟竢鈕ぢの中に、以下のエントリを誓瀋蠅靴討誓さい。

<blockquote>
<tt>kerberos_server=YES</tt>
</blockquote>

<p>
また、/etc/inetd.conf の中の以下のエントリのコメントを除去してくだ世気ぁ

錫跫站髟阡緇腫鱚跪續縺竦阯瘟闖鬲跚矼祚跪續繻鈬謖閾蜴縺竦阯瘟闖鬲跚矼祚鳰閾蜴跫芍鈔謫蒹跛縺竦阯瘟闖鬲跚矼祚鴦葢鼈
諱縺竦阯瘟闖鬲跚矼祚諱葢癜鹿頏緇鹿碎閭鞫
腫その後、リブートするか、以下の操作を行ってくだ世気ぁ

錫跫站髟阡緇腫鱚首闔臂謇跛晩珮癆鬲鴣遲蜴續筮韈籥鹿齡鳫鈑首闔臂齟蛯纔繝纈矼鳫鬲跫膀諷鰲纈闢閾瘢雹鹿齡鳫鈑首闔臂齟蛯纔繝痲迚鈔鬲跫膀諱粱蜴筮跫逅纂闔臂
鹿頏緇鹿碎閭鞫
腫注: これはかなり単純なサーバ誓瀋蠅任后Ｄ名錣魯機璽个鯑鷭轍修靴討いひとつをスレーブにして)、
一方のサーバがダ瀬Ε鵑靴疹豺腓砲纈矼鳫に依存するサービスのすべてがダ瀬Ε鵑靴燭蠅靴覆い茲Δ砲靴泙后
また、指定の principal に「su」権限を与えるには
<a href="http://www.freebsd.org/handbook/kerberos.html#AEN4957">the FreeBSD Handbook</a>
を参照してくだ世気ぁ

取馨クライアントのワークステーションを Kerberos 化する</h3>

<p>
<i>gatekeeper</i> というワークステーションを、CIARASYSTEMS.COM realm にいるものとして誓瀋蠅掘
メインのサーバを avalanche.ciarasystems.com にするように誓瀋蠅靴泙后

腫まず手始めに、上のマシンと同じように <i>krb.conf</i> と <i>krb.realms</i> を誓瀋蠅靴泙后海譴蘊艨諷辮纈鹿蘊ぢが、
KDC がどのサーバか、どのドメイン上にいるのかわかるようにするためです。ファイルの中身をもう一度挙げておきます。

<blockquote><pre>
# <strong>cat krb.conf</strong>
CIARASYSTEMS.COM
CIARASYSTEMS.COM avalanche.ciarasystems.com admin server

# <strong>cat krb.realms</strong>
avalanche.ciarasystems.com      CIARASYSTEMS.COM
.ciarasystems.com               CIARASYSTEMS.COM
</pre></blockquote>

<p>
誓瀋蠅擦靴燭蕁諷鰲纈闢ぢを初期化します。チケットを取得世垢襪砲蓮釈鱚羹∵雕關緕碵筮闥膀竍薛砠遲轣隨竍蘓髟纈謇鉗熙瘢雹黼謾蜿扈陰城蜴蜚┗を使用します。

<blockquote><pre>
$ <strong>kinit</strong>
The OpenBSD Project (gatekeeper)
Kerberos Initialization
Kerberos name: <strong>jeremie</strong>
Password:
</pre></blockquote>

<p>
これで同定されたから、<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=klist&amp;sektion=1">klist(1)</a> でチケット一覧を表示して、自分のものが表示されるかどうか確認してくだ世気ぁ

錫跫站髟阡緇腫鱚首闔臂謖蜩闔臂
夂站續蛹綺逅謾碓旭
會蜴竕鞜貂裙鱚迚綫醒描卅噎嘖斗哺地
蕪齦繖蜥纉會蜴竕鞜宝恩浦鯵魂臼紺該乙謦碪苳描卅噎嘖斗哺地誉醒描卅噎嘖斗哺地鹿頏緇鹿碎閭鞫
腫誓瀋蠅任討い襪茲Δ任垢里如紊魯謄好箸鮃圓辰討誓さい。ここでは、rlogin(1) と telnet(1) でテストします。

<blockquote><pre>
$ <Strong>telnet avalanche</strong>
Trying 192.168.0.38...
Connected to avalanche.
Escape character is '^]'.
[ Trying mutual KERBEROS4 ... ]
[ Kerberos V4 accepts you ]
[ Kerberos V4 challenge successful ]
Last login: Sun Jun 27 22:52:25 on ttyp1 from gatekeeper
Warning: no Kerberos tickets issued.
OpenBSD 3.2 (GENERIC) #25: Thu Oct  3 19:51:53 MDT 2002
</pre></blockquote>

また、

<blockquote><pre>
$ <Strong>rlogin avalanche</strong>
Last login: Sun Jun 27 22:53:39 on ttyp1 from gatekeeper
Warning: no Kerberos tickets issued.
OpenBSD 3.2 (GENERIC) #25: Thu Oct  3 19:51:53 MDT 2002
</pre></blockquote>

<p>
これで確かに rlogin セッションの認証に Kerberos が使用されているのがわかります。
発行されたチケットを削除するには、たとえば、以下のように <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=kdestroy&amp;sektion=1">kdestroy(1)</a>
を使用します。

<blockquote><pre>
$ <strong>kdestroy</strong>
Tickets destroyed.
$ <strong>rlogin avalanche</strong>
krcmd: No ticket file (tf_util)
rlogin: warning, using standard rlogin: can't provide Kerberos auth data.
avalanche: Connection refused
</pre></blockquote>

<p>
「Warning: no Kerberos tickets issued」と表示されても心配する必要はありません。これは、ここでは kerberos
認証を行っただ世韻如站續癈皷鈑ぢを行っていないからです。もし、ticket passing を行いたい場合には、それをサポートする
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ssh&amp;sektion=1">OpenSSH</a>
を使用します。通常の KerberosIV kdc は ticket にリストされたクライアントの IP アドレスをチェックするので、
そのままの KerberosIV には tgt passing のサポートはなく、AFS kaserver による krb4 の実装しかありません。
d968 1
a968 1
230- OpenBSD 3.2 (GENERIC) #25: Thu Oct  3 19:51:53 MDT 2002
d1109 1
a1109 1
最新リリースのソースコードを
d1115 1
a1115 1
$ <b>cvs -danoncvs@@anoncvs5.usa.openbsd.org:/cvs co -rOPENBSD_2_7_BASE src/libexec/talkd/</b>
d1368 1
a1368 1
たとえば、次の行を <tt>/etc/.profile</tt> に挿入することで、
d1397 1
a1397 1
Originally [OpenBSD: faq10.html,v 1.87 ]
d1399 1
a1399 1
$Translation: faq10.html,v 1.1 2003/04/14 15:30:45 toshi Exp $
d1401 1
a1401 1
$OpenBSD: faq10.html,v 1.87 2003/04/10 19:01:31 nick Exp $
@

