head	1.40;
access;
symbols;
locks; strict;
comment	@# @;


1.40
date	2005.08.13.08.19.34;	author saad;	state dead;
branches;
next	1.39;

1.39
date	2004.05.09.09.58.22;	author saad;	state Exp;
branches;
next	1.38;

1.38
date	2004.04.17.19.33.21;	author jufi;	state Exp;
branches;
next	1.37;

1.37
date	2004.02.25.18.30.09;	author jufi;	state Exp;
branches;
next	1.36;

1.36
date	2004.01.01.23.46.18;	author horacio;	state Exp;
branches;
next	1.35;

1.35
date	2003.11.03.16.52.23;	author jufi;	state Exp;
branches;
next	1.34;

1.34
date	2003.10.28.12.31.17;	author horacio;	state Exp;
branches;
next	1.33;

1.33
date	2003.10.26.23.26.52;	author horacio;	state Exp;
branches;
next	1.32;

1.32
date	2003.10.18.23.25.15;	author horacio;	state Exp;
branches;
next	1.31;

1.31
date	2003.08.22.20.50.03;	author jufi;	state Exp;
branches;
next	1.30;

1.30
date	2003.07.26.13.08.15;	author jufi;	state Exp;
branches;
next	1.29;

1.29
date	2003.07.19.12.09.27;	author jufi;	state Exp;
branches;
next	1.28;

1.28
date	2003.07.04.22.16.13;	author jufi;	state Exp;
branches;
next	1.27;

1.27
date	2003.05.10.13.21.29;	author jufi;	state Exp;
branches;
next	1.26;

1.26
date	2003.04.07.21.33.51;	author jufi;	state Exp;
branches;
next	1.25;

1.25
date	2003.03.19.19.08.27;	author jufi;	state Exp;
branches;
next	1.24;

1.24
date	2003.03.17.11.29.43;	author jufi;	state Exp;
branches;
next	1.23;

1.23
date	2003.03.12.14.23.06;	author jufi;	state Exp;
branches;
next	1.22;

1.22
date	2003.03.11.09.41.18;	author jufi;	state Exp;
branches;
next	1.21;

1.21
date	2003.02.28.19.46.47;	author jufi;	state Exp;
branches;
next	1.20;

1.20
date	2003.02.25.19.56.59;	author jufi;	state Exp;
branches;
next	1.19;

1.19
date	2003.02.21.17.24.50;	author jufi;	state Exp;
branches;
next	1.18;

1.18
date	2003.02.19.18.12.52;	author jufi;	state Exp;
branches;
next	1.17;

1.17
date	2003.01.04.23.29.57;	author jufi;	state Exp;
branches;
next	1.16;

1.16
date	2002.12.25.11.30.03;	author jufi;	state Exp;
branches;
next	1.15;

1.15
date	2002.12.14.23.48.43;	author jufi;	state Exp;
branches;
next	1.14;

1.14
date	2002.10.08.19.15.40;	author jufi;	state Exp;
branches;
next	1.13;

1.13
date	2002.07.13.07.58.28;	author jufi;	state Exp;
branches;
next	1.12;

1.12
date	2002.07.02.09.13.43;	author jufi;	state Exp;
branches;
next	1.11;

1.11
date	2002.06.29.08.39.32;	author jufi;	state Exp;
branches;
next	1.10;

1.10
date	2002.06.17.20.43.52;	author jufi;	state Exp;
branches;
next	1.9;

1.9
date	2002.06.11.08.52.40;	author jufi;	state Exp;
branches;
next	1.8;

1.8
date	2002.06.08.08.49.49;	author jufi;	state Exp;
branches;
next	1.7;

1.7
date	2002.05.20.11.20.17;	author jufi;	state Exp;
branches;
next	1.6;

1.6
date	2002.04.28.10.26.23;	author jufi;	state Exp;
branches;
next	1.5;

1.5
date	2002.04.20.19.41.01;	author jufi;	state Exp;
branches;
next	1.4;

1.4
date	2002.04.16.07.01.09;	author jufi;	state Exp;
branches;
next	1.3;

1.3
date	2002.04.14.12.55.44;	author jufi;	state Exp;
branches;
next	1.2;

1.2
date	2002.04.14.12.11.14;	author jufi;	state Exp;
branches;
next	1.1;

1.1
date	2002.04.13.19.03.54;	author jufi;	state Exp;
branches;
next	;


desc
@@


1.40
log
@remove unmaintained [ja] translation files. requested by translator.
@
text
@<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>14 - Disk Setup</title>
<link rev= "made" href= "mailto:www@@openbsd.org">
<meta name= "resource-type" content= "document">
<meta name= "description"   content= "the OpenBSD FAQ page">
<meta name= "keywords"      content= "openbsd,faq">
<meta name= "distribution"  content= "global">
<meta name= "copyright"     content= "This document copyright 1998-2004 by OpenBSD.">
<meta http-equiv="Content-Type" content="text/html; charset=iso-2022-jp">
<style type="text/css">
  <!--
  pre { margin-left: 20px; }
  -->
</style>
</head>

<body bgcolor= "#ffffff" text= "#000000">

<img alt="[OpenBSD]" height=30 width=141 src="../../images/smalltitle.gif">
<p>
<font color= "#0000e0">
<a href= "index.html">[FAQ の目次]</a>
<a href= "faq12.html">[12 章 - プラットフォーム固有の質問]</a>
</font>

<h1><font color="#e00000">14 - ディスクの誓瀋鹿肬銓昭云取鮠

取馨目次</h3>
<ul>
<li><a href="#disklabel"  >14.1 - OpenBSD の disklabel(8) を使用する</a>
<li><a href="#fdisk"      >14.2 - OpenBSD の fdisk(8) を使用する</a>
<li><a href="#NewDisk"    >14.3 - OpenBSD でディスクを追加する</a>
<li><a href="#SwapFile"   >14.4 - ファイルへのスワップ</a>
<li><a href="#SoftUpdates">14.5 - Soft updates</a>
<li><a href="#Boot386"    >14.6 - OpenBSD/i386 はどのようにブートするの ?</a>
<li><a href="#LargeDrive" >14.7 - OpenBSD での大容量ドライブは
    どうなってるのでしょう ?</a>
<li><a href="#InstBoot"   >14.8 - Bootblock のインストール - i386 のみ</a>
<li><a href="#Backup"     >14.9 - トラブルに備えよう: テープへの
    バックアップと復元</a>
<li><a href="#MountImage" >14.10 - OpenBSD でディスクイメージをマウント</a>
<li><a href="#pciideErr"  >14.11 - 助けて!  PCIIDE でエラーになってしまいます !</a>
<li><a href="#RAID"       >14.13 - OpenBSD の RAID オプション</a>
</ul>
<hr>

<a name="disklabel"></a>
<h2>14.1 - OpenBSD の disklabel(8) を使用する</h2>
<h3>目次</h3>

<ul>
<li><a href="#disklabel.1">disklabel(8) とは ?</a></li>
<li><a href="#disklabel.2">OpenBSD インストール時の disklabel(8)</a></li>
<li><a href="#disklabel.3">よくある disklabel(8) の使い方</a></li>
</ul>


<a name="disklabel.1"></a>
<h3>disklabel(8) とは ?</h3>
  
<p>
まず、
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=disklabel&amp;sektion=8">disklabel(8)</a>
にあるマニュアルをお読みくだ世気ぁ

腫堤鼡赱矼は、ディスクとカーネル内のディスクドライバの間に、
効率よいインターフェースを提供するために作誓気譴燭發里任后
ラベルには、ドライブのジオメトリとか、ファイルシステム情報とか、
ディスク関係の情報が含まれています。そしてこれをブートストラップ・プログラムが
使用して、ドライブをロードしたり、ドライブ上のどこにファイルシステムが
あるのかを調べたりします。ラベルはまた、ファイルシステムといっしょに
使用されて、効率よい環境が作られます。disklabel についてのより
詳しいことは
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=disklabel&amp;sektion=5">disklabel(5)</a>
を参照してくだ世気ぁ

腫さらなるメリットとして、disklabel を使うことでディスクパーティションの
アーキテクチャ的な誓鵑鮠茲蟇曚┐蕕譴襪里任后燭箸┐蓋では
プライマリパーティション (つまり Windows NT や DOS など他の OS に見える
パーティション) は 4 つまでしか持てません。
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=disklabel&amp;sektion=8">disklabel(8)</a>
では、この「プライマリパーティション」をひとつ使用するだ世韻如緕帯パーティション
を全部 (たとえば 'swap', '/', '/usr', '/var') をそこに納められます。
それでも他の OS で使えるパーティションが 3 つも残っているのです !

<a name="disklabel.2"></a>
<h3>OpenBSD インストール時の disklabel(8)</h3>

<p>
OpenBSD インストールでの大きな山場のひとつが、ラベルを最初に作誓垢
ところでしょう。これは (i386 ユーザなら) <a href="#fdisk">fdisk(1)</a>
の直後に出てきます。インストール中に、disklabel を使って、
マウントポイントごとに別々のラベルを作誓靴泙后
インストール中に、
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=disklabel&amp;sektion=8">disklabel(8)</a>
の中からマウントポイントを指定することもできますが、これはどうしても
必要というわけではありません。というのは、後ほどプロンプトで、
これでいいかどうかの確認を求められますからです。しかし、
これは実行しておいた方がインストールが少しはスムーズになることでしょう。

<p>
インストール中なら、まだ瀬薀戰襪呂爾鵑爾鵑覆い呂困任垢里如
どうしても作誓垢詆廚△蠅泙后能蕕忘鄒成するラベルはラベル
'a' です。このラベルは誓簑个ぢをマウントするところにすべきです。
作誓靴討い進匹ぁ△瓮僉璽謄轡腑鵑箸修離汽ぅ困砲弔い討蓮
釈鱚羹〓聲餞譯嚼痺緡繞粤笄焼叢必要なスペース</a>
を参照してくだ世気ぁ機璽个両豺隋⊂覆箸發海海暴颪い討△襯薀戰襪
別々にしておくのが望ましいでしょう。デスクトップのユーザなら、
/ のマウントポイントだ世韻鮑鄒成しておけば十分でしょう。最初に
root パーティション ('a' ラベル) を作るとき、スワップラベル用に
多少の空きを残しておくのをお忘れなく。これまでに基本は
誓睫誓しましたから、以下にインストール中に disklabel を使う例を挙げてみましょう。
最初の例では、このマシン上には OpenBSD しか
なく、フルインストールをするものとします。

<pre>

If this disk is shared with other operating systems, those operating systems
should have a BIOS partition entry that spans the space they occupy completely.
For safety, also make sure all OpenBSD file systems are within the offset and
size specified in the 'A6' BIOS partition table.  (By default, the disklabel
editor will try to enforce this).  If you are unsure of how to use multiple
partitions properly (ie. separating /,  /usr, /tmp, /var, /usr/local, and other
things) just split the space into a root and swap partition for now.

# using MBR partition 3: type A6 off 63 (0x3f) size 4991553 (0x4c2a41) 

Treating sectors 63-16386300 as the OpenBSD portion of the disk.
You can use the 'b' command to change this.

Initial label editor (enter '?' for help at any prompt)
&gt; <b>d a</b>
&gt; <b>a a</b>
offset: [63] <b>&lt;Enter&gt;</b>
size: [16386237] <b>64M</b>
Rounding to nearest cylinder: 131040
FS type: [4.2BSD] <b>&lt;Enter&gt;</b>
mount point: [none] <b>/</b>
fragment size: [1024] <b>&lt;Enter&gt;</b>
block size: [8192] <b>&lt;Enter&gt;</b>
cpg: [16] <b>&lt;Enter&gt;</b>
&gt; <b>a b</b>
offset: [131103] <b>&lt;Enter&gt;</b>
size: [16255197] <b>64M</b>
Rounding to nearest cylinder: 131040
FS type: [swap] <b>&lt;Enter&gt;</b>
</pre>

<p>
これで、64MB の root パーティションが / にマウントされて、64MB の
スワップパーティションが作られました。オフセットがセクター 63 から
始まるのに注目してくだ世気ぁ靴掘△海譴芭匹い里任后
サイズの話という点世如粡鼡赱矼はセクター単位で表示を行いますが、
入力は特にセクターで入力しなくても構いません。上記の例でもそうですが、
<i>64MB なら 64M</i> とか、<i>2GBなら 2G</i> とすれば良いのです。
すると Disklabel はそれをいちばん近いシリンダ世亡櫃瓩討譴泙后
また上記の例では、disklabel は「b」がスワップであると自動的に
想定していることにも注目してくだ世気ぁ海譴論正しい想定で、GENERIC
カーネルはラベル「b」にスワップを探しにいくよう誓瀋蠅気譴討い襪里任后
ですから、このガイドラインに従って、スワップは 'b' にしておきましょう。

<p>
次の例では、もうふたつラベルを作誓靴討い泙后海譴呂弔泙蝓袷瓦
インストールではないということです。これらのサイズは、OpenBSD を
完全にインストールするには不十分だ世蕕任后７衒屬靴砲覆襪誓けですので、
パーティションをすべて作誓垢觝邏箸鮓擦襪里肋蔑靴泙后

腫鱚眈篌閹胝續朮恐唄掛眈梼鬢苳纂皷霸怯牡欝芸眈挟夕呰粡鈑鈬癇纉笙跚鈔纈嘘碓完
酉綺堪佳喞錫商踉仕銓纈鹿眈
迴竟蜴鈿鈬錫少霄胙瘍辣銓蝴綺碓牡錫商踉仕銓纈鹿眈
碎閭皷杆厩課眈梼鬢苳纂竦膾蔚錫商踉仕銓纈鹿眈
眈綣閹胝續朿抗姥掛眈梼鬢苳纂皷霸宜抗臼芸眈挟夕呰粡鈑鈬癇纉笙跚鈔纈嘘碓完
酉綺堪佳喞錫商踉仕銓纈鹿眈
迴竟蜴鈿鈬錫少鮗胙瘍辣銓蝴綺碓牡錫商踉仕銓纈鹿眈
碎閭皷杆厩課眈梼鬢苳纂竦膾蔚錫商踉仕銓纈鹿眈
鹿頏緇

腫上記の例では、ふたつほど気付く点世△蠅泙后泙此▲侫札奪箸
自動的に計算され、次のところでデフォルトになって待っているということです。
このようなインストールをするなら、オフセットをあれこれと変更する
必要はまったくありません。別の違いとしては、ラベル 'c' はスキップ
されています。これには理由があり、ラベル 'c' はディスク全体を
表わすラベルだ世蕕覆里任后任垢蕁▲薀戰礑ぢだ世韻論絶対に
変更してはいけません。

<p>
ラベルが全部できたら、後はそれをディスクに書き込んでインストールを
誓茲某覆瓩泙靴腓ΑＡ管颪い蜩謖痰繻ぢを終了するには
(そしてインストールを続けるには)、次のようにします。


<pre>
&gt; <b>w</b>
&gt; <b>q</b>
</pre>>

<p>

<a name="disklabel.3"></a>
<h3>よくある disklabel(8) の使い方</h3>

<p>
いったんシステムのインストールが終わったら、もうあまり disklabel を
使うこともないでしょう。しかし、ディスクを追加、削除、再構誓垢襪箸覆鼻
粡鼡赱矼を使う場合が出てきます。まず最初にやるべきことは、現状の
disklabel を見ることです。これには以下のようにします。

<pre>
# <b>disklabel wd0</b> &gt;----- Or whatever disk device you'd like to view

# using MBR partition 3: type A6 off 64 (0x40) size 16777152 (0xffffc0)
# /dev/rwd0c:
type: ESDI
disk:
label: TOSHIBA MK2720FC
flags:
bytes/sector: 512
sectors/track: 63
tracks/cylinder: 16
sectors/cylinder: 1008
cylinders: 2633
total sectors: 2654064
rpm: 3600
interleave: 1
trackskew: 0
cylinderskew: 0
headswitch: 0           # milliseconds
track-to-track seek: 0  # milliseconds
drivedata: 0 

16 partitions:
#        size   offset    fstype   [fsize bsize   cpg]
  a:  2071440    65583    4.2BSD     1024  8192    16   # (Cyl.   65*- 2120)
  b:    65520       63      swap                        # (Cyl.    0*- 65)
  c:  2654064        0    unused        0     0         # (Cyl.    0 - 2632)
  j:   512001  2137023    4.2BSD     1024  8192    16   # (Cyl. 2120*- 2627*)
</pre>

<p>
上記のコマンドは、単に既存の disklabel を許すためのものであり、
間違って変更してしまったりしないよう保証してくれるものです
(これは私たちは、ときどき必要なことでしょう)。しかし、もし変更を
加えたいなら、disklabel で -E オプションを使用しなければなりません。

<pre>
# <b>disklabel -E wd0</b>
</pre>

<p>
これでプロンプトが出てきますが、これは OpenBSD のインストール時に
目にするものと同じものです。このプロンプトで何より大誓擇淵灰泪鵐匹
Эでしょう。これは disklabel で使用可能なオプションの
一覧を表示してくれるものです。
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=disklabel&amp;sektion=8">disklabel(8)</a>
man ページ全部を見るには、 'M' コマンドを使います。
このプロンプトから、パーティションの追加、削除、
変更すべてを行うことができます。より詳しくは 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=disklabel&amp;sektion=8">disklabel(8)</a>
man ページを参照してくだ世気ぁ

釈瘢綵∽粡鼡⊂鹿畩
取仮唄鞳鄲喞ぢの fdisk(8) を使用する</h2>

まず、必ず
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=fdisk&amp;sektion=8&amp;arch=i386">fdisk(8)</a>
の man ページを参照してくだ世気ぁ

腫凪蜩は、パーティションのメンテナンスを助けてくれるソフトです。この
プログラムはインストール時に使われて、OpenBSD のパーティションを誓瀋蠅靴泙この
パーティションの中に複数のラベルが誓瀋蠅気譴董△修譴召譴侫．ぅ襯轡好謄爐筌好錺奪彭砲覆蠅泙ぢ。
ドライブのスペースを区誓擇辰董△劼箸弔鬟▲謄屬砲任泙后海離廛蹈哀薀爐
通常、シングルユーザモード (つまり boot -s) で使われます。Fdisk はまた、
各種ハードディスクの MBR も誓瀋蠅靴泙后

腫インストールするには、ほとんどの場合は OpenBSD パーティションが <b>ひとつ</b>あれば良いでしょう。
それをさらに区誓擇辰董▲好錺奪廚筌侫．ぅ襯轡好謄爐鮑鄒成するには disklabel を使います。

<p>
fdisk でパーティションテーブルを見るだ世韻任靴燭蕁⊆，里茲Δ

腫鱚升眈聹蜩黻絢昭碣鹿頏緇

腫と入力すると、次のように出力されます。

<pre>
Disk: sd0       geometry: 553/255/63 [8883945 Sectors]
Offset: 0       Signature: 0xAA55
         Starting       Ending       LBA Info:
 #: id    C   H  S -    C   H  S [       start:      size   ]
------------------------------------------------------------------------
*0: A6    3   0  1 -  552 254 63 [       48195:     8835750 ] OpenBSD     
 1: 12    0   1  1 -    2 254 63 [          63:       48132 ] Compaq Diag.
 2: 00    0   0  0 -    0   0  0 [           0:           0 ] unused      
 3: 00    0   0  0 -    0   0  0 [           0:           0 ] unused      
</pre>

<p>
この例では、最初の SCSI ディスクドライブの fdisk 出力を見ています。
OpenBSD パーティション (A6) と
そのサイズも見られます。* がついているので、起動パーティションが
OpenBSD パーティションだ世箸錣蠅泙后

腫前の例では、情報を見ただ世韻任垢△任蓮▲僉璽謄轡腑鵐董璽屮襪鯤埆犬靴燭ぞ豺腓
どのようにすれば良いのでしょう ?　そのときには <b>-e</b> フラグを使います。
これによって、コマンドラインプロンプトが出力されて、fdisk が操作可能になります。

<pre>
# <b>fdisk -e wd0</b>
Enter 'help' for information
fdisk: 1&gt; <b>help</b>
        help            Command help list
        manual          Show entire OpenBSD man page for fdisk
        reinit          Re-initialize loaded MBR (to defaults)
        setpid          Set the identifier of a given table entry
        disk            Edit current drive stats
        edit            Edit given table entry
        flag            Flag given table entry as bootable
        update          Update machine code in loaded MBR
        select          Select extended partition table entry MBR
        print           Print loaded MBR partition table
        write           Write loaded MBR to disk
        exit            Exit edit of current MBR, without saving changes
        quit            Quit edit of current MBR, saving current changes
        abort           Abort program without saving current changes
fdisk: 1&gt; 
</pre>

<p> 
fdisk に入っていろいろ試すのは、まったく危険はありません。ただ世掘
変更を保存するかどうか聞かれた場合には、誓簑个眈亮と答え、
<b>write</b> コマンドは使わないようにしてくだ世気ぁ

腫昭眈鹿眈ぢフラグで使用可能なコマンドの一覧を
以下に挙げておきます。

<ul>
<li><b>help</b>    対話型編集モードで fdisk のわかる
コマンド一覧を表示します。
<li><b>reinit</b>  現在選択中のメモリに入っている
ブートブロックのコピーを初期化します。
<li><b>disk</b>    fdisk がプローブした現在のドライブジオメトリを
表示します。必要なら編集も可能です。
<li><b>setpid</b>  パーティションテーブルの指定エントリの
パーティション ID を変更します。このコマンドは、既存のパーティションを
OpenBSD に再割り当てしたりする場合には特に便利です。
<li><b>edit</b>    現在のブートブロックのメモリ内コピーの、
指定テーブルエントリを編集。BIOS ジオメトリモードで編集することも、
セクターオフセットやサイズで編集することも可能です。
<li><b>flag</b>    パーティションテーブルの指定エントリを起動可能に誓瀋蠅靴泙后
ただ世掘芦椎修棒設定できるエントリはひとつだ世韻任后
もし、拡張パーティションから起動したい場合には、その拡張パーティションの
エントリを起動可能にする必要があります。
<li><b>update</b>  現在のブートブロックのメモリ内コピーの
機械コードを更新します。
<li><b>select</b>  現在のブートブロックにある、拡張パーティションテーブルエントリで
示されたブートブロックを、メモリに読み込みます。
<li><b>print</b>   現在選択中のメモリ内のブートブロックのコピーと
その MBR テーブルをターミナルに表示します。
<li><b>write</b>   現在メモリ内にあるブートブロックのコピーをディスクに出力します。
本当に実行してよいかどうか、操作確認が出力されます。
<li><b>exit</b>    現在の fdisk のレベルを終了し、
前に選んだ瀬瓮皀蠧發離屐璽肇屮蹈奪離灰圈爾北瓩襪
それがなければプログラムを終了します。
<li><b>quit</b>    現在の fdisk のレベルを終了し、
前に選んだ瀬瓮皀蠧發離屐璽肇屮蹈奪離灰圈爾北瓩襪
それがなければプログラムを終了します。exit と異なるのは、
変更したブロックはディスクに出力される点世任后
殊蘊錫鍾硼鶯鹿眈ぢ現在の変更を保存しないでプログラムを終了します。
</ul>

<a name="NewDisk"></a>
<h2>14.3 - OpenBSD でディスクを追加する</h2>

<p>
そう、ディスクさえ<b>きちんと</b>インストールされれば、あとは
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=fdisk&amp;&amp;sektion=8&amp;arch=i386">fdisk(8)</a>
(<i>i386 のみ</i>) と
<a href= "http://www.openbsd.org/cgi-bin/man.cgi?query=disklabel&amp;sektion=8">disklabel(8)</a>
を使用して OpenBSD 用にディスクを誓瀋蠅垢襪誓けなのです。

<p>
i386 の人たちは、fdisk から始めてくだ世気ぁＢ召離◆璽謄船磴凌佑蓮△海海鬟好奪廚垢襪海箸任泙后
以下の例では、3 個目の SCSI ドライブをシステムに追加しています。
<pre>
# <b>fdisk -i sd2</b>
</pre>
これはディスクの「ほんものの」パーティションを初期化して、
OpenBSD 誓賤僂吠僂┐觝邏箸任后
続いてここに disklabel を作誓靴泙后海譴肋渓姪櫃眞里譴泙擦鵝
腫鱚錫鞘蜩謖痰繻黻下
守嘗画面が消えて、$EDITOR で指定のエディタが起動します)</i>
type: SCSI
<i>うだ世Δ誓……</i>
sectors/track: 63
total sectors: 6185088
<i>うだ世Δ誓……</i>
16 partitions:
#        size   offset    fstype   [fsize bsize   cpg]
  c:  6185088        0    unused        0     0         # (Cyl.    0 - 6135)
  d:  1405080       63    4.2BSD     1024  8192    16   # (Cyl.    0*- 1393*)
  e:  4779945  1405143    4.2BSD     1024  8192    16   # (Cyl. 1393*- 6135)
</pre>

まず、'c' パーティションは無視します。必ず存在していて、disklabel のような
プログラムが機能するために必要なものですから !
OpenBSD の fstype は 4.2BSD です。
Total sectors は、ディスクの総容量です。たとえば、これが 3 GB のディスクとします。
ディスクメーカの言世な任蓮蚤ぢは 3000 MB です。そこで 6185088/3000 の割り算をします
(<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=bc&amp;sektion=1">bc(1))</a>
を使います。答は 2061 です。そこで a, d, e, f, g, ... のパーティションサイズを
計算するには、それぞれ X MB の容量が必要ならば、単に X*2061 のかけ算をすれば
良いのです。最初の新しいパーティションのオフセットは、さっき disklabel
の出力に出てきた「sectors/track」と同じになります。ここでは 63 です。
その後の各パーティションのオフセットは、各パーティションサイズと、
そのパーティションのオフセットを組み合わせたものになります
(ただ世礑ぢパーティションだ世韻蓮什澆亮阿砲△討呂泙襪箸海蹐發覆い掘
無視しましょう)。

<p>
あるいは、ディスク上にパーティションがひとつだ世韻靴廚覆ぞ豺腓發△蠅泙后燭箸┐弌
ディスク全体を Web 保存に使うとか、ホームディレクトリにしたいとかなどです。
この場合には、ディスクの総容量から、トラックあたりのセクター数をひくことで求められます。
6185088-63 = 6185025 ですから、あなたのパーティションは次のようになります。

<pre>
    d:  6185025       63    4.2BSD     1024  8192    16 
</pre>

<b>これが必要以上に面倒だ世隼廚Δ里任靴燭蕁韻蜩謖痰繻を使うことで、
インストール時と同じパーティション誓擇螢癲璽匹貌譴泙鹿眈
そこで、96 メガバイト必要なら "96M" と指定すれば良いのです (ディスクが巨大なら、
96GB で 96 ギガバイトということです !) 残念なことに、
-E モードは本当のディスクジオメトリではなく、BIOS ディスクジオメトリを使用していて、
この両者が必ずしも一致しないということでしょう。この誓鵑魏麋鬚垢襪砲蓮
х繽辣粡鼡ぢの略で 'g d' とタイプします (その他のオプションとしては、'geometry bios' なら 'g b' で、
'g u' とすれば geometry user、つまり disklabel が変更前に
どのような内容になっていたかを表示します)。

<p>
以上、非常に多くの内容でした。しかし、まだ析辰禄辰討呂い覆い里任后
最後に、そのディスク上にファイルシステムを作誓靴覆討呂覆蕕覆い里任后海譴砲蓮
釈鱚羹∵雕關緕碵筮闥膀竍薛砠遲轣隨竍蘓髟纈鈬鵙瘢雹黼謾蜿扈権嬢纓胝┯を使用します。

<pre>
# <b>newfs sd2a </b>
</pre>

<p>
wd1a のところは、OpenBSD のディスク番号方式で、あなたのディスクの番号に該当するものに置き換えます
(OpenBSD のディスク名称を見たい場合は、
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=newfs&amp;sektion=8">newfs(8)</a>
の出力を見ます)。

<p>
さて、この作誓気譴燭个蠅離僉璽謄轡腑鵑鬚匹海縫泪Ε鵐箸垢襪里鮃佑┐泙后燭箸┐にマウントしたいとします。
その場合、まず、/u ディレクトリを作誓靴泙后修譴蕕修譴鬟泪Ε鵐箸垢襪里任后

腫鱚錫壌阨銓粤黻過鹿頏緇

腫最後にそれを
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=fstab&amp;sektion=5">/etc/fstab(5)</a> に追加します。

<pre>/dev/sd2a /u ffs rw 1 1</pre>

<p>
では、/usr/local などの既存のディレクトリを移動させたい場合にはどのようにすれば良いのでしょう。
このような場合には、新しいドライブを /mnt にマウントして、<tt>cpio -pdum</tt> を使って /usr/local を
/mnt ディレクトリにコピーします。そして、
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=fstab&amp;sektion=5">/etc/fstab(5)</a>
ファイルを編集して、/usr/local パーティションが新しい /dev/sd2a
(さきほど新規にフォーマットしたパーティション) になるように変更します。たとえば、

<pre>
<b>/dev/sd2a /usr/local ffs rw 1 1</b>
</pre>

<p>
<strong>boot -s</strong> で、シングルユーザモードで再起動します。既存の /usr/local を /usr/local-backup
に移動します (あるいは、ツキが上向いてる気分ならバッサリ削除しても良いでしょう)。そして、
空のディレクトリ /usr/local を作誓靴討誓さい。そしてシステムを再起動すると、ファイルが
/usr/local に元どおりになっているのがわかります !


<a name="SwapFile"></a>
<h2>14.4 - ファイルへのスワップ</h2>

<p>
(注: もし、
&quot;virtual memory exhausted&quot; エラーが多数出力されているため、スワップをしようとしているのでしたら、
まずはプロセスごとのリミットを上げてみましょう。csh でしたら
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=unlimit&amp;sektion=1">unlimit(1)</a>
ですし、sh でしたら
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ulimit&amp;sektion=1">ulimit(1)</a> です。)

<p>
ファイルへのスワップは、カスタムのカーネルは必要ありませんが、
ビルドし直しても構いません。
この FAQ では、どちらの方法でもスワップスペースを追加する方法を示します。

<h3>ファイルへのスワップ</h3>

<p>
追加のスワップ領域を誓瀋蠅垢襪里法∈任盍蔽韻朕彗癖，蓮▲侫．ぅ襪悗離好錺奪廚鯆媛辰垢襪海箸任后
この方法は、Soft Updates が有効になっているファイルシステム上では使用できません
(これはデフォルトでは有効になってはいません)。最初に、まず、今どのくらいのスワップ領域があって、
どれくらいスワップを使用しているのかを調べます。これには
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=swapctl&amp;sektion=8">swapctl(8)</a>
ユーティリティを、次のように使用します。

<pre>
$ <b>swapctl -l</b>
Device      512-blocks     Used    Avail Capacity  Priority
swap_device      65520        8    65512     0%    0
</pre>

<p>
これは、今、スワップに使用されているデバイスとその現在の統計を示しています。
上記の例では &quot;swap_device&quot; というデバイスがひとつしかありません。
これはディスク上の事前に定義されたスワップ領域です
(disklabel を見るときにはパーティション b として表示されます)。
上記の例でもわかりますが、このデバイスは現状ではあまり使用されてはいません。
しかし、この文章では仮に、
さらに 32MB が必要だ世箸いΔ海箸砲靴泙靴腓Α

腫ファイルをスワップデバイスとして誓瀋蠅垢訛莪貶發蓮
そのファイルを作誓垢襪海箸任后海譴釈鱚羹∵雕關緕碵筮闥膀竍薛砠遲轣隨竍蘓髟纈粐逅雌繼闔襲⊂粐┗ユーティリティで作誓垢襪里任睥匹い任靴腓Α
以下は、大きさ 32MB の <i>/var/swap</i> ファイルを作誓靴討い泙后

腫鱚錫杖粐羹纐纈閹蒐鬲齬瘰鷭焔阨銓蹴卸狂鹿眈
害袈見鱚竢鰾蜴
害袈見鱚竢鰾阨崖亀幹害纉鱇銖聽鴪繖屋繝┗況祁憶纉繝鹿頏緇

腫これができたら、そのデバイスへのスワップを有効にします。以下のコマンドを使用して、
このデバイスへのスワップを有効にします。

<pre>
$ <b>sudo chmod 600 /var/swap</b>
$ <b>sudo swapctl -a /var/swap</b>
</pre>

<p>
ここで、作誓気譴燭發里好錺奪廛妊丱ぅ垢琉賤膨媛辰気譴燭匹Δ
チェックしましょう。

<pre>
$ <b>swapctl -l</b>
Device      512-blocks     Used    Avail Capacity  Priority
swap_device      65520        8    65512     0%    0
/var/swap        65536        0    65536     0%    0
Total           131056        8   131048     0%
</pre>

<p>
これでファイルが誓瀋蠅気譴謄好錺奪廚圓錣譴討い襪里如
守少續祚胝蘯ファイルに記入して、次の起動時にも
このファイルが使用されるようにします。
この一行がないと、スワップデバイスとして誓瀋蠅気譴泙擦鵝

腫鱚錫障癆續祚胝蘯纐箘聿鵄
癇癇齬瘰鹿頏緇

取馨閼デバイス経由でスワップ</h3>

<p>
これはスワップ領域を追加するさらに恒久的な解決方法です。ファイルを恒久的にスワップするには、
まず vnd0c をスワップにしたカーネルを作誓靴泙后璽優襪箘を root ファイルシステムに
しているなら、これまでのスワップは wd0b ですから、カーネル誓瀋螢侫．ぅ襪念焚爾里茲Δ聞圓
使用します (疑問があれば、新しいカーネルのコンパイルを参照してくだ世気ぢ。 

<pre>
config          bsd     root on wd0a swap on wd0b and vnd0c dumps on wd0b
</pre>

<p>
これが終れば、スワップに使用するファイルを
作誓靴覆韻譴个覆蠅泙擦鵝
これは、上記の例と同じコマンドを使えば良いでしょう。

<pre>
$ <b>sudo dd if=/dev/zero of=/var/swap bs=1k count=32768</b>
32768+0 records in
32768+0 records out
33554432 bytes transferred in 20 secs (1677721 bytes/sec)
</pre>

<p>
さて、ファイルができたましたので、そのファイルを
<i>/etc/fstab</i> に追加します。このデバイスが起動時に
スワップデバイスになるための一行は、以下のようになります。

<pre>
$ <b>cat /etc/fstab</b>
/dev/wd0a / ffs rw 1 1
/dev/vnd0c none swap sw 0 0 
</pre>

<p>
この時点世妊灰鵐團紂璽燭鮑撞阿気擦董▲璽優襪諒儿垢娠任気譴襪茲Δ砲靴泙后
これを実行したら、デバイスをスワップとして誓瀋蠅垢襪海箸砲覆蠅泙后海譴砲
釈鱚羹∵雕關緕碵筮闥膀竍薛砠遲轣隨竍蘓髟纈竢鈕蜃逅雌繼闔集⊂竢鈕蜃┯を使用します。

<pre>
$ <b>sudo vnconfig -c -v vnd0 /var/swap</b>
vnd0: 33554432 bytes on /var/swap
</pre>

<p>
そして、最後になりますが、そのデバイスでスワップを有効にします。これは、上記の例とまったく
同じように swapctl(8) を使用しましょう。最後に、それがスワップの一覧にきちんと追加されたかどうかを
確認してくだ世気ぁ

腫鱚錫杖齬瘰笏粤箘禺錫杖鞦貅偵竇輝沖碎閭謫黼蛹瘰痺蜚鱸闥蜚齬瘰焙纐蜒亀屋亀渦
纐鈔違亀涯亀涯
夬嘘碓偽嘘碓憾鹿頏緇



釈瘢綵閹鞣癆纉⊂鹿畩
取仮唄閹寳籬鹿莢

腫囂胄鞣癆纉ぢは、
<a href="http://www.ece.cmu.edu/~ganger/papers/CSE-TR-254-95/">Greg Ganger
と Yale Patt</a> が提案したアイディアに基づいて、
<a href="http://www.mckusick.com/softdep/">Kirk McKusick</a>
が FreeBSD 用に開発したものです。SoftUpdates は、バッファキャッシュ操作を
部分的に誓依垢襪海箸如▲妊譽肇蠅離┘鵐肇蠅瞭唄颪澆箸いν弋畛爐
篤のコードから除去可能になります。これによって、
ディスクへの書き込み誓修紡臧文紊蕕譴泙后

腫囂胄鞣癆纉ぢを使用して fsck(8) をバックグラウンドで実行する可能誓砲弔い討蓮
まだ鞳鄲喞ぢでは実現されていませんので、
誓気靴蔘阯せずに終了したときには、やはり
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=fsck&amp;sektion=8">fsck(8)</a>
を必要としますが、これは将来のバージョンでは変更されるかも知れません。

<p>
Soft Update を使用するには、

<p>
<b>option FFS_SOFTUPDATES</b>
<p>
をつけたカーネルをコンパイルしなければなりませんが、これは既に GENERIC には入っています。

<p>
Soft Update を有効にするにはマウント時のオプションで行う必要があります。
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mount&amp;sektion=8">mount(8)</a>
ユーティリティでパーティションをマウントする際、このパーティションでは
Soft Update を有効にしたいということを指定することができます。
以下は、Soft Update を使用してマウントしようとしているひとつの
パーティション <i>sd0a</i> を持つ、サンプルの
<i><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=fstab&amp;sektion=5">/etc/fstab(5)</a></i> 
エントリです。

<pre>
/dev/sd0a / ffs rw,softdep 1 1
</pre>

<p>
sparc ユーザへの注意: sun4 や sun4c のマシンでは Soft Update を有効にしてはいけません。
これらのアーキテクチャでは、ごく限られた量のカーネルメモリしかサポートしませんので、
Soft Update を使用することができないのです。
しかし、sun4m マシンなら大丈夫です。

<a name="Boot386"></a>
<h2>14.6 - OpenBSD/i386 はどのようにブートするの ?</h2>
OpenBSD/i386 のブートプロセスは単純なものではなく、それがどのように動作するのかを
理解することは、これが動作しない場合に問題を解決するのに役に立つことでしょう。
ブートプロセスには以下のような 4 つの鍵となる部分があります。
<ol>
<li><b><i>マスタブートレコード (MBR: Master Boot Record):</i></b> MBR
はディスクの最初の物理セクタ (512 バイト) のことです。
これには、プライマリパーティションテーブルおよびパーティションブートレコード
(PBR: Partition Boot Record) をロードするための小さなプログラムが含まれます。
ある種の環境では、"MBR" という用語は、(パーティションテーブルを含む)
最初のブロック全体のことではなく、ディスクの最初のブロックのコードの部分だ世韻
指して使用されることがあるということに注意してくだ世気ぁ
緕帯の用語として、"MBR を初期化する" ということの意味を理解することは
大変重要なことであり、ある種のシステムがそうであるように、
それはコードだ世韻任呂覆岱ぢセクタ全体への再書き込みを伴ないます。
もし、あなたがそのようにしたくない場合には、
代わりに fdisk(8) の "-u" コマンドラインオプションを使用してくだ世気
│儒聹蜩箘鹿匠ぢ。

<p>
仮想的にどのような MBR でも OpenBSD をブートすることができるので、OpenBSD
が MBR を含んでいるにも関わらず、その使用を余儀なくされることはありません。
MBR は、fdisk(8) プログラムによって操作されますが、このプログラムは、
パーティションテーブルの編集と MBR コードのディスクへのインストールの
両方を行うものです。 

<p>
OpenBSD の MBR は、自身を以下のようなメッセージでアナウンスします。
<pre>
    Using Drive: 0 Partition: 3
</pre>
これは、PBR をどのディスクのどのパーティションからロードするのかを示しています。

<li><b><i>パーティションブートレコード (PBR: Partition Boot Record):</i></b>
パーティションブートレコードは、PBR または
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=biosboot&amp;sektion=8&amp;arch=i386">biosboot(8)</a>
(コードを保持するファイルの名前の後) とも呼ばれ、ディスク上の
OpenBSD パーティションの最初の物理セクタのことです。
PBR は OpenBSD 用の「第一段階ブートローダ澄廚任后
この PBR は MBR コードからロードされ、OpenBSD の第二段階ブートローダ
釈鱚羹∵雕關緕碵筮闥膀竍薛砠遲轣隨竍蘓髟纈硼阡逅雌繼闔集逅氏鱆莉薐原⊂硼阡┯をロードする役割を有しています。
MBR と同様、PBR はコードとデータ全体でわずか 512 バイトという
非常に小さな部分から構誓気譴泙后
これは、完全にファイルシステムのことを知るアプリケーションには十分ではありませんので、
PBR はディスク上の <tt>/boot</tt> の位置を持つのではなく、
BIOS がアクセス可能な <tt>/boot</tt> 位置が、インストール時に PBR
のコードに物理的に組み込まれます。

<p>
PBR は、
<a href="faq14.html#InstBoot">このドキュメントで後ほど記述</a>する
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=installboot&amp;sektion=8&amp;arch=i386">installboot</a>
によってインストールされます。
PBR は、自身を以下のようなメッセージでアナウンスします。
<pre>
    reading boot....
</pre>
これは、ディスクから読み出しているセクタ数をドットで示します。

<li><b><i>第二段階ブートローダ少硼阡鹿昇鹿蘊鹿眈少硼阡鹿は、
は PBR によってロードされ、マシンの BIOS を通じて OpenBSD のファイルシステムに
アクセスし、実際のカーネルの位置を特定してロードする役割を有しています。
boot(8) はまた、各種のオプションや情報をカーネルにわたします。
<p>
boot(8) は会話的なプログラムです。ロードされた後、このプログラムは <tt>/etc/boot.conf</tt>
の位置の特定とその読み込みを試み、もし、このファイルが存在していれば (因みに、このファイルは
デフォルトではインストールされません)、その中に指定されたコマンドを処理します。<tt>/etc/boot.conf</tt>
による他の指示がない限り、このプログラムは以下のようなプロンプトをユーザに出力します。

<pre>
     probing: pc0 com0 com1 apm mem[636k 190M a20=on]
     disk: fd0 hd0+
     >> OpenBSD/i386 BOOT 2.02
     boot>
</pre>
このプロンプトは、ユーザが別の指示を与えられるよう (デフォルトで) 5 秒待ちますが、
このタイムアウトまでに何の指示も与えられなければ、デフォルトの挙動である、
最初のハードディスクの root パーティションからの、カーネル <tt>bsd</tt>
のロードを開始します。
この第二段階ブートローダ世蓮鞳鄲喞ぢのカーネルがまだ瀬蹇璽匹気譴討い覆い里舵腕ぢを通じて、あなたのシステムのハードウェアのプローブ (検出テスト) を行います。
上記では、検出を試みて見つかった少しばかりのものを見ることができます。
<ul>
<li><b>pc0</b> - i386 システムの標準キーボードおよび
ビデオディスプレイです。
<li><b>com0、com1</b> - ふたつのシリアルポートです。
<li><b>apm</b> - APM (Advanced Power Management) BIOS 機能です。
<li><b>636k 190M</b> - 検出されたコンベンショナル (1M 以下) および
拡張 (1M 以上) メモリの量です。
<li><b>fd0 hd0+</b> - 検出された BIOS ディスクデバイスで、この場合なら、
一台のフロッピーディスクと一台のハードディスクです。
</ul>

"hd0" の後の '+' の文字は、<tt>/boot</tt> が BIOS 経由でこのディスクに
LBA でアクセスできることを示しています。
初回インストール時、ハードディスクの後に '*' が表示されているのを
見かけることがあるかも知れませんが、これは、このディスク上には誓犠錣
緕帯のディスクラベルがないように見えることを示しています。


<li><b><i>カーネル: <tt>/bsd</tt></i>:</b>  これは、OpenBSD のカーネルを RAM
上にロードし、誓気靴孫圓垢襪燭瓩痢▲屐璽肇廛蹈札垢虜能奮任后
カーネルがいったんロードされると、OpenBSD はもはや BIOS を経由することなく、
ハードウェアに直誓椒▲札垢垢襪茲Δ砲覆蠅泙后

鹿闌
以上のことから、ブートプロセスのごく最初の部分は以下のようになります。
<blockquote><pre>
Using Drive: 0 Partition: 3                      <b><i>&lt;- MBR</i></b>
reading boot....                                 <b><i>&lt;- PBR</i></b>
probing: pc0 com0 com1 apm mem[636k 190M a20=on] <b><i>&lt;- /boot</i></b>
disk: fd0 hd0+
>> OpenBSD/i386 BOOT 2.02
boot>
booting hd0a:/bsd 4464500+838332 [58+204240+181750]=0x56cfd0
entry point at 0x100120

[ using 386464 bytes of bsd ELF symbol table ]
Copyright (c) 1982, 1986, 1989, 1991, 1993       <b><i>&lt;- カーネル</i></b>
        The Regents of the University of California.  All rights reserved.
Copyright (c) 1995-2003 OpenBSD.  All rights reserved.  http://www.OpenBSD.org

OpenBSD 3.4 (GENERIC) #18: Wed Sep 17 03:34:47 MDT 2003
   ...
</pre></blockquote>


<h3>うまく動作しない場合には</h3>
<ul>
<li><b>不良/不誓気ぢ互換誓里覆岱瑳通常、使用されているハードディスクは何らかの MBR を保持していますが、
新しいディスクや異なるハードウェアプラットフォームからのディスク、そして
<a href="../faq4.html#Disks">インストール時</a>の "Use entire disk" という質問に "Yes"
と応答しなかった場合には、誓掬岱ぢを持たないディスクになることがあります。このため、
このディスクでは、誓気靴ぅ僉璽謄轡腑鵐董璽屮襪減澆靴討い討皀屐璽箸垢襪海箸呂任泙擦鵝

腫緕帯の MBR は、fdisk プログラムを使用してハードディスクにインストールすることもできます。
インストールメディアからブートし、"Shell" を選択して
以下のコマンドプロンプトを表示させます。

<pre>
    # <b>fdisk -u wd0</b>
</pre>

また、fdisk を使用して、以下のように、指定の MBR をインストールすることもできます。
<pre>
    # <b>fdisk -u -f /usr/mdec/mbr wd0 </b>
</pre> 

この場合、<tt>/usr/mdec/mbr</tt> ファイルがシステムの
MBR としてインストールされることになります。
標準的なインストールの行われた OpenBSD に附属のこの特別なファイルは、
たまたま fdisk にも組み込まれる標準的な MBR でもありますが、他の
いかなる MBR でも、ここに指定することができます。

<li><b>PBR にインストールされた <tt>/boot</tt> の位置情報が不誓瑳蜴齡瘡赳闖県ぢが PBR をインストールする際に、<tt>/boot</tt>
のディスクセクタの物理的な位置を PBR に書き込みます。
このため、<a href="faq14.html#InstBoot">installboot(8)</a>
を再実行せずに <tt>/boot</tt> を消去して置換すると、PBR は
たまたまそこに指定されているブロックが何であってもそれをロードしますが、
それはほぼ確実に第二段階ブートローダ世砲楼嫐里覆い發里任靴腓Δ蕁
システムはブート不可能な状態に陥ってしまいます。
<tt>/boot</tt> は BIOS 呼び出しを使用して読み込みを行いますので、もし、
ドライブのジオメトリを変更した場合 (たとえば、CHS 変換を使用する、あるコンピュータから
ドライブを取り出して LBA 変換を使用する別のコンピュータに移動したり、あるいは BIOS
で変換オプションを変更したりした場合) には、<i>BIOS にとっては</i>異なる位置情報に
見えてしまいます (つまり、ディスクから同じデータを読み出すには、異なるブロック番号で
アクセスしなければならないのです)。ですので、このような場合にも、
システムをリブートする前に installboot(8) を実行する必要があります。
PBR は非常に小さいので、そのエラーメッセージの範囲は以下のようにかなり限られています。

<ul>
<li><b>Read Error</b> -- ディスクからブロックを読み込もうとした際に BIOS
がエラーを返しました。
ディスクに物理的な問題が発誓犬靴燭ぢたとえば、ジオメトリ問題などで)
不誓気淵札燭鯑匹濆發Δ箸靴寝椎柔性が考えられます。
<li><b>Bad magic</b> -- 不誓気
釈鱚羹∵雕關緕碵筮闥膀竍薛砠遲轣隨竍蘓髟纈轣芍礒瘢雹黼謾蜿扈帰壌瘍蜒┻ナンバを持つ第二段階ブートローダ世離悒奪誓が読み込まれました。
これは一般的に、読み込まれたものが <tt>/boot</tt>
ではないことを意味しています。
通常、これはドライブジオメトリ問題が原因であり、ディスク上の
<tt>/boot</tt> が置換されたか、あるいは、あなたのシステムの
<a href="faq14.html#LargeDrive">8GB あるいは BIOS の限界</a>
を無視して、PBR がアクセスできない場所に <tt>/boot</tt>
が置かれてしまったことによるものです。
</ul>
</ul>

i386 のブートプロセスについてのより詳しい情報については、以下のドキュメントを参照してくだ世気ぁ
受貍
殊蘊釈鱚羹∵雕關緕碵筮闥膀竍薛砠遲轣隨竍蘓髟纈硼阡煢蓋共瘢雹黼謾蜿扈研瘢雹癇竏初蓋侠鐘闖薐原┯殊蘊釈鱚羹∵雕癆甅癆瘰藪竢躁蓍蔗蹉乗雕癆甅癆瘰藪竢躁蓍蔗躰悲跂瘤粡のドキュメント "How it Works"
</ul>

<a name="LargeDrive"></a>
<h2>14.7 - OpenBSD での大容量ドライブに関する問題は ?</h2>
<!-- XXXversion i386 changes for 3.5 -->

<p>
OpenBSD は現在や近い将来入手できるどのようなハードディスクよりも
はるかに大きなサイズのファイルシステムをサポートしていますが、
いくつかのインターフェースでは OpenBSD
の理論静丙蚤臙佑茲蠅眈気文続Δ△蠅泙后

腫もちろん、すべてのハードウェアの組み合わせが可能なわけではありません。
新しい 250GB の IDE ハードディスクは、古い目の (137GB 以上の標準以前の)
インターフェイスでは動かないでしょうし、いくつかの非常に古い SCSI アダ瀬廛燭
より現代的なドライブとの組み合わせでは問題があることがわかっています。
もちろん、あなたは、あなたのハードウェアの能力に期待すべきではあります。

<h3>パーティションサイズと位置の限界</h3>
不幸にも、OS がメモリにロードされるまでは OS のすべての能力は使用できませんので、
起動のプロセスそれ自体に限界があります。
起動プロセスはシステムのブート ROM を使用します (また、だ世蕕海修修譴棒制限されるのです)。
OpenBSD/i386 の第一段階ブートローダ
┝蓿繙就蔗痕鞳鈞黻鱧芍蜴瘤芍髄鴒盾蜿黷闖熙瘢雹黼謾蜿扈研瘢雹癇竏初蓋侠鐘蜿黷闖県鹿畩にも、古い BIOS の限界から来る、それ自身の内部的な 8GB の限界が存在しています。

<p>
このような理由で、/bsd ファイル (カーネル) 全体がブート ROM で使用できる
領域内か、ディスクの誓萋蚤ぢ以内のどちらか小さい方に置かれなて
いなければなりません。これは、いくつかのさらに古い i386 システムでは
root パーティションは、完全に誓萋梓預ぢ以内になければなりませんが、
ほとんどの新しいコンピュータでは root パーティションは誓萋蚤ぢ以内の
どこかにあれば良い、という意味です。

<p>
古い 486 に 40GB のドライブを入れてひとつの巨大なパーティションとして
OpenBSD をロードすることもできることに注意しましょう。うまく上記の
規則を破ることができたと思うかも知れません。しかしながら、その規則は
もっとも嫌な具合につきまとってくるかも知れません。

<ul>
  <li>40GB の / パーティションにインストールすると、これはうまく動きます。
      なぜなら OS と (/bsd を含む) すべてのファイルは誓萋梓預ぢ以内にあるからです。
  <li>システムを使い込んでいくに従って、504MB 以上のファイルが存在するようになります。
  <li>アップグレードの際に自分のカーネルを作誓垢襪覆匹靴董⊃靴靴
黻ぢを古いものに上書きコピーします。
  <li>再起動します。
  <li>"bad magic" というようなメッセージが出ることになります。
</ul>
<p>
これはどうしてでしょう ?  なぜなら新しい /bsd ファイルを「上書き」コピーしたとき、
古いものを上書きしたのではなく、BIOS がサポートする
504MB の範囲の外にあるであろう新しい領域に再配置されてしまったからなのです。
ブートローダ世碵ファイルをロードできなくなって、
システムはハングしてしまうのです。

<p>
OpenBSD が起動するようにするには、ブートローダ薐原ぢの場合なら biosboot(8)
と <tt>/boot</tt>) およびカーネル (<tt>/bsd</tt>) がブート ROM
のサポートする範囲内、ならびにブートローダ声里稜塾呂糧楼呂砲覆韻譴个覆蠅泙擦鵝
安全に実行するための規則は単純です。

<p>
<b>root パーティション全体はコンピュータの BIOS (もしくはブート ROM) で使用可能な
領域内か、ディスクの誓萋蚤ぢ以内のどちらか小さい方に置かれていなければなりません。</b>
<br><i>注: OpenBSD/i386 の 8G の誓造笊鴪緕では除去されています。
それでもなお、システムの BIOS の誓造和砂鼎靴覆韻譴个覆蠅泙擦鵝鹿蘊

腫これは、単一の巨大なパーティションを使用するより、<a href="../faq4.html#SpaceNeeded">
ハードディスクのパーティションを分割する</a>ことに対するもうひとつの良い理由となっています。

<h3>fsck(8) の時間と必要なメモリの量</h3>
巨大なファイルシステムについてのもうひとつの考察は、
電源断やクラッシュ後のファイルシステムに対する
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=fsck&amp;sektion=8">fsck(8)</a>
に要する時間や必要なメモリの量についてです。
32MB の RAM しか搭載されていないシステムでは、120GB のファイルシステムを置こうとしたり、
それがクラッシュした後の fsck(1) が誓垢襪覆匹塙佑┐燭蠅垢戮任呂△蠅泙擦鵝
大まかなガイドラインとしては、ディスクの fsck が誓垢襪燭瓩砲蓮▲妊好
映あたり、少なくとも 1MB ずつ利用可能なメモリをシステムは搭載すべきです。
また、ディスクの fsck に要する時間は、ファイルシステムが巨大になればなるほど
問題になってくる可能誓△蠅泙后


釈瘢綵銖闖槇昭取仮唄闖跫站ぢのインストール - i386 のみ</h2>

<p>
古いバージョンの MS-DOS は、1024 シリンダ整焚爾離妊好献瓮肇蠅砲靴弍
していません。最近のディスクはほとんどすべて 1024 シリンダ整幣
ありますので、ほとんどの SCSI BIOS チップ (SCSI コントローラボード上にある) と
IDE BIOS (その他 PC BIOS の一部) は、真のディスクジオメトリを MS-DOS が扱える
ようなものに「翻訳」するオプション (ときにはこれがデフォルト) があります。
しかし、BIOS チップの「翻訳」のしかたは必ずしも一致するわけではありません。
もし、BIOS を変えて (マザーボードを交換したとか、SCSI コントローラを交換したとか)、
そして新しい方が使用している「翻訳」ディスクジオメトリが異なっていたら、
第二段階ブートローダ世匹濆瓩覆つまりカーネルも読み込めない) ことになります。
(なぜかというと、第一段階ブートローダ世硼阡ぢの入ったブロック一覧を
持っていますが、これが以前の「翻訳」ジオメトリで記述されているからなのです)。
IDE ディスクを使用していて BIOS 誓瀋蠅鯤儿垢靴疹豺腓砲癲∨殘うっかり)
変更してしまう場合があります (ほとんどの IDE BIOS は翻訳の仕方を 3 通り持っています)。
ブートブロックを直して普通にブートできるようにするためには、
ドライブに起動フロッピーを入れて (あるいはブート可能な CD-ROM を使用して)、
boot プロンプトで「b hd0a:/bsd」とタイプして、最初のハードディスク
(フロッピーではなく) から起動してくだ世気ぁ海譴派當未縫泪轡鵑阿垢襪呂困任后
そうしたら、第一段階ブートローダ世鮃洪靴靴董
新しいジオメトリが見えるようにしてくだ世気
ぢそしてそれに応じたブートブロックに書き換えてくだ世気ぢ。 <br>
ここでの例では、あなたの起動ディスクが sd0 だ世帆枋蠅靴討い泙
ぢもし IDE なら wd0 等々..)。

<pre>
# <b>cd /usr/mdec; ./installboot /boot biosboot sd0</b>
</pre>

<p>
もし、installboot が BIOS のジオメトリが読めなくてエラーメッセージを出力するようなら、
boot&gt; プロンプトで &quot;machine diskinfo&quot; コマンド (または短く
&quot;ma di&quot;) コマンドを入力して、必要な情報を表示させてくだ世気ぁ
蒹痲鵙髟阡と &quot;secs&quot; の値をそれぞれ installboot の -h
と -s フラグ付きで入力しましょう。このような形で変更した installboot コマンドは
次のようになります。

<pre>
#<b> cd /usr/mdec; ./installboot -h &lt;heads&gt; -s &lt;secs&gt; /boot biosboot sd0</b>
</pre>

<p>
もし、ブートブロックのバージョン更新が必要なら、
それは自分でコンパイルするしかありませんが、その方法は簡単です。

<pre>
# <b>cd /sys/arch/i386/stand/</b>
# <b>make &amp;&amp; make install </b>
# <b>cd /usr/mdec; cp ./boot /boot</b>
# <b>./installboot /boot biosboot sd0</b> (ディスクのデバイスは自分のにあわせて変更してくだ世気鹿頏緇

釈瘢綵痺謨陟昭取仮唄ぢトラブルにそなえよう: テープへのバックアップと復元</h2>

<h3>はじめに</h3>

<p>
たとえば、もし業務用サーバを走らせようとしているのでしたら、
固定ディスクのどれかがクラッシュした場合のために、
何らかのバックアップは取っておくようにしてくだ世気ぁ

腫ここにある情報は、OpenBSD 附属の通常の
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dump&amp;sektion=8">dump(8)</a>/<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=restore&amp;sektion=8">restore(8)</a>
ユーティリティの使い方を誓睫誓しています。
複数のサーバを一本のテープドライブでバックアップするために、
<a href="faq8.html#Ports">ports</a> にある、
より高度な「Amanda」というソフトもあります。
普通の環境では
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dump&amp;sektion=8">dump(8)</a>/<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=restore&amp;sektion=8">restore(8)</a>
で十分でしょうが、複数のマシンを一台のテープにバックアップしたい場合には、
Amanda を検討してみてくだ世気ぁ

腫この文書のデバイス例は、SCSI ディスクとテープを使うような構誓離轡好謄爐鯀枋蠅靴討い泙后
業務用環境では、不良ブロックの処理の方法から、IDE よりも SCSI が推奨されています。
しかし、IDE や別種のテープドライブを使用している人に
この情報が役に立たないわけではありません。
デバイス名を読み換えることで話は同じになります。
たとえば、SCSI の sd0a は IDE のシステムなら wd0a になります。

<h3>テープにバックアップ</h3>

<p>
テープへのバックアップは、ファイルシステムがどこにマウントされているかという知識が必須になります。
ファイルシステムがどうマウントされているのかについては、シェルプロンプトから
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mount&amp;sektion=8">mount(8)</a>
コマンドを使用します。これによって、たとえば、以下のような出力が得世蕕譴襪呂困任后

腫鱚錫壌阨銓鹿眈
纐箘闔聿閭瘡纐箘闔鞳胝跫竅讒
鹿頏緇

腫この例では、root (/) ファイルシステムは物理的には sd0a 上にあります。
これは SCSI 固定ディスク 0 のパーティション a です。
/usr ファイルシステムは sd0h 上で、これは SCSI 固定ディスク 0 のパーティション h になります。

<p>
以下は、さらに高度なマウントテーブルの例です。

<pre>
# <b>mount</b>
/dev/sd0a on / type ffs (local)
/dev/sd0d on /var type ffs (local)
/dev/sd0e on /home type ffs (local)
/dev/sd0h on /usr type ffs (local)
</pre>

<p>
この、さらに高度な例では、root (/) ファイルシステムは物理的には sd0a 上にあります。
/var ファイルシステムは sd0d、/home ファイルシステムは sd0e で、
/usr は sd0h にあります。

<p>
マシンのバックアップには、それぞれの固定ディスクパーティション名を
dump に指定する必要があります。さきほどの簡単な方のマウントテーブルを
バックアップするコマンドは次のようになります。

<pre>
# <b>/sbin/dump -0au -f /dev/nrst0 /dev/rsd0a</b>
# <b>/sbin/dump -0au -f /dev/nrst0 /dev/rsd0h</b>
# <b>mt -f /dev/rst0 rewind  </b>
</pre>

<p>
さらに複雑な方のマウントテーブルの例なら
次のようになります。

<pre>
# <b>/sbin/dump -0au -f /dev/nrst0 /dev/rsd0a</b>
# <b>/sbin/dump -0au -f /dev/nrst0 /dev/rsd0d</b>
# <b>/sbin/dump -0au -f /dev/nrst0 /dev/rsd0e</b>
# <b>/sbin/dump -0au -f /dev/nrst0 /dev/rsd0h</b>
# <b>mt -f /dev/rst0 rewind</b>
</pre>

<p>
それぞれのコマンドラインのスイッチが何を意味するのかについては、
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dump&amp;sektion=8">dump(8)</a>
man ページを見るのが最も良いでしょう。
上記の例で使用したパラメータの概要を以下に誓睫誓します。

<ul>
<li><b>0</b> - レベル 0 でダ瀬鵐廚靴泙后弔泙蠢乾侫．ぅ襪鬟誓ンプします。
<li><b>a</b> - 自動的にテープメディアの長さを決めようとします。
<li><b>u</b> - /etc/dumpdates を更新して、最後にバックアップをした日時を記録します。
<li><b>f</b> - どのテープデバイスを使うかを指定します (ここでは /dev/nrst0)。
</ul>

<p>
そして最後に、バックアップするパーティションが記述されています (/dev/rsd0a, etc)。

<p>
最後に
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mt&amp;sektion=1">mt(1)</a>
コマンドを使用して、ドライブを巻き戻しています。
他のオプション (たとえば eject) については、mt の man ページを参照してくだ世気ぁ

腫テープデバイス名がよくわからない場合には、dmesg を使用して調べます。
たとえば、dmesg を使った例は次のようになります。

<pre>
st0 at scsibus0 targ 5 lun 0: &lt;ARCHIVE, Python 28388-XXX, 5.28&gt;
</pre>

<p>
バックアップをする場合に、デバイス名が dmesg に出てくる「st0」ではなく
「nrst0」になっているのにお気付きでしょうか ?
st0 に nrst0 としてアクセスした場合は、
同じ物理デバイスにアクセスしていることには違いないのですが、
ジョブの終了後に巻き戻さないことと、デバイスを raw mode でアクセスすることが異なります。
複数のファイルシステムを一本のテープにバックアップするには、
必ず巻き戻さないデバイスを使用してくだ世気ぁ
もし巻き戻すデバイス (rst0) を使用した場合には、
バックアップごとにテープが巻き戻されて、前のファイルシステムが上書きされてしまいます。
各種テープドライブについてのより詳しい誓睫誓は dump の man ページを参照してくだ世気ぁ

腫以下は、"backup" を
簡単なスクリプトにした例です。

<pre>
echo "  Starting Full Backup..."
/sbin/dump -0au -f /dev/nrst0 /dev/rsd0a
/sbin/dump -0au -f /dev/nrst0 /dev/rsd0d
/sbin/dump -0au -f /dev/nrst0 /dev/rsd0e
/sbin/dump -0au -f /dev/nrst0 /dev/rsd0h
echo
echo -n "  Rewinding Drive, Please wait..."
mt -f /dev/rst0 rewind
echo "Done."
echo
</pre>

<p>
もし、毎晩定期的にバックアップしたい場合には、
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=cron&amp;sektion=8">cron(8)</a>
を使用して自動的にバックアップ用スクリプトを起動させます。

<p>
あと、それぞれのファイルシステムがどのくらいのサイズになるかを (紙誓擇譴書いておくと役立ちます。それぞれのパーティションがどのくらいの容量を使用しているかを調べるには
df -h を使用します。これを行っておくと、ドライブが壊れてパーティションテーブルを
新しいドライブに再現するときに便利です。

<p>
データをリストアすることで、ファイルの断片化解消にもなります。
ファイル全部を確実にバックアップするには、まず再起動してシングルユーザモードで起動することです。
ファイルシステムは、バックアップするときにマウントしていなくても構いません。
シングルユーザモードで起動したら、root (/) r/w をマウントするのは忘れないようにしてくだ世気ぁ
そうしないと、ダ瀬鵐廚瞭佞鮟颪个修Δ箸垢襪箸は失敗します。
シングルユーザモードで起動するには、boot&gt; プロンプトで bsd -s を入力してくだ世気ぁ

取馨糒逅ぢテープの中身を見る</h3>


<p>
初めてファイルシステムをバックアップしたら、
テープをちょっとテストしてみて、
そこのデータが思い通りのところにあるか確認するようにしてくだ世気ぁ

腫以下に dump テープ上のファイルの
カタログを見る例を示します。

<pre>
# <b>/sbin/restore -tvs 1 -f /dev/rst0</b>
</pre>

<p>
これで、dump テープの最初のパーティション上にある
ファイルのリストが一覧表示されます。上記の例について
さらに述べるなら、1 というのは root (/) ファイルシステムのことです。

<p>
2番目のテープパーティションに何があるのかを見て、
その出力をファイルに書き込むには次の例のようにしてくだ世気ぁ

腫鱚錫少黷蜴纉鱚粤鴦蓖辣絲跚齡鹿眈
鹿頏緇

腫さきほどの単純な方のようなマウントテーブルを持っている場合には 2 は /usr で、
もし高度な方のマウントテーブルならば 2 は /var などの
他のファイルシステムになります。また、シーケンス番号は、
ファイルシステムがテープに書き出された順番と一致します。


<h3>テープからの復元</h3>

<p>
以下に挙げた例題シナリオは、固定ディスクが完全に壊れた場合に便利です。
テープからファイルをひとつだ世韻鯢気靴燭ぞ豺腓砲蓮
鱚齡闥の man ページを参照して、
対話型モードの指示をよく読んでくだ世気ぁ

腫もし、きちんと準備をしてあれば、ディスクを交換してテープからデータを復元するのは
とても手早くできます。標準の OpenBSD インストール/起動フロッピーは、
すでに必要な復元ユーティリティも附属していますし、
パーティションを誓擇辰匿靴靴ぅ疋薀ぅ屬魑芦椎修砲垢襪燭瓩離丱ぅ淵蠅眛辰討い泙后
ほとんどの場合、このフロッピーと最新の dump テープがあれば、
それだ世韻妊轡好謄爐鯲督召擦泙后

腫壊れたディスクドライブを物理的に交換したら、
データの復元の基本的なステップは以下の通りです。

<ul>
<li>
<p>
まず、OpenBSD インストール/起動フロッピーから起動し、メニュー選択で
Shell を選択します。そして、最新のバックアップテープを、
書き込み禁止にした上でテープドライブに入れてくだ世気ぁ
錫鮠
殊蘊
腫釈鱚羹∵雕關緕碵筮闥膀竍薛砠遲轣隨竍蘓髟纈聹蜩襴瘢雹黼謾蜿扈研瘢雹癇竏初蓋侠丈粡鼡┯条
コマンドを使用して、新品のドライブにプライマリ
OpenBSD パーティションを作誓靴泙后
以下に例を示します。

<pre>
# <b>fdisk -e sd0</b>
</pre>

<p>
詳しくは <a href="#fdisk">fdisk FAQ</a> を参照してくだ世気ぁ

殊蘊
腫粡鼡赱矼コマンドを使用して、今、fdisk で作誓靴織廛薀ぅ泪
緕帯パーティションの中に、OpenBSD パーティションを作誓靴泙后
その例を以下に示します。

<pre>
# <b>disklabel -E sd0</b>
</pre>

<p>
(スワップを忘れないようにしてくだ世気ぁ椶靴蓿繙就ｄ蜩謖痰繻⊂粡鼡赱矼徳兌を参照してくだ世気ぁ
殊蘊
腫鈬コマンドで、上記ステップで作誓靴織僉璽謄轡腑鵑某靴靴ぅ侫．ぅ襯轡好謄爐鮑鄒成します。
以下にその例を示します。

<pre>
# <b>newfs /dev/rsd0a</b>
# <b>newfs /dev/rsd0h</b>
</pre>

<li>
<p>
新品の root (/) ファイルシステムを /mnt にマウントします。以下に例を示します。

<pre>
# <b>mount /dev/sd0a /mnt</b>
</pre>

<li>
<p>
マウントされた root ファイルシステムに移動して、復元プロセスを開始します。
以下に例を示します。

<pre>
# <b>cd /mnt</b>
# <b>restore -rs 1 -f /dev/rst0</b>
</pre>

<li>
<p>
この新しいディスクを起動可能にする場合には、以下のコマンドでドライブに新しい MBR を書き込みます。
以下に例を示します。

<pre>
# <b>fdisk -i sd0</b>
</pre>

<li>
<p>
ドライブに新品の MBR を書くと同時に、起動できるようにブートブロックをインストールしなければなりません。
以下に簡単な例を示します。

<pre>
# <b>cp /usr/mdec/boot /mnt/boot</b>
# <b>/usr/mdec/installboot -v /mnt/boot /usr/mdec/biosboot sd0</b>
</pre>

<li>
<p>
ハードディスクの新しい root ファイルシステムはこれで用意できましたので、
そこから起動して他のファイルシステムのリストアを続けることができます。
OS はまだ栖袷瓦任呂△蠅泙擦鵑里如坤轡鵐哀襯罅璽競癲璽匹
起動するようにしてくだ世気ぁ轡Д襪離廛蹈鵐廛箸如
以下のコマンドを使用してアンマウントしてシステムを停止します。

<pre>
# <b>umount /mnt</b>
# <b>halt</b>
</pre>

<li>
<p>
インストール/起動フロッピーをドライブから抜いて、システムを再起動します。
OpenBSD boot&gt; プロンプトで次のコマンドを入力します。

<pre>
boot&gt; <b>bsd -s</b>
</pre>

<p>
bsd -s で、カーネルをシングルユーザモードで起動します。
これには root (/) ファイルシステムだ世韻廚箸覆蠅泙后

殊蘊
腫以上のステップをきちんと実行して、途中で何らかのトラブルがなければ、
プロンプトが出力され、シェルのパスを入力するかリターンを押すことが求められます。
リターンを押した場合は、sh が使用可能になります。次に、root を読み出し誓賤僂任呂覆
鬲モードでマウントし直すため、以下のコマンドを実行します。

<pre>
# <b>mount -u -w /</b>
</pre>

<li>
<p>
r/w モードで再マウントしましたら、残りのファイルシステムの再現を続けてくだ世気ぁ
以下にその例を示します。

<pre>
(単純なマウントテーブル)
# <b>mount /dev/sd0h /usr; cd /usr; restore -rs 2 -f /dev/rst0</b>

(さらに高度なマウントテーブル)
# <b>mount /dev/sd0d /var; cd /var; restore -rs 2 -f /dev/rst0</b>
# <b>mount /dev/sd0e /home; cd /home; restore -rs 3 -f /dev/rst0</b>
# <b>mount /dev/sd0h /usr; cd /usr; restore -rs 4 -f /dev/rst0</b>
</pre>

<p>
ダ瀬鵐廛札奪箸乕気気譴襯屮献Д般召鬚修療堙抔燭ぞ豺腓砲蓮
単に rsf とするのではなく "<b>restore rvsf</b>" を使用します。

<li>
<p>
最後に、他のファイルシステムを全部ディスクに回復し終えましたら、
マルチユーザモードに移行します。すべてが意図した通りに進んでいたら、
システムは最新のバックアップ時と同じ状態に戻っていて、
また使用可能になっているはずです。
</ul>

<a name="MountImage"></a>
<h2>14.10 - OpenBSD でディスクイメージをマウントする</h2>

<p>
ディスクイメージ (ISO イメージ、dd で作ったディスクイメージなど)
を OpenBSD でマウントするには、
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=vnd&amp;sektion=4">vnd(4)</a>
デバイスを誓瀋蠅垢詆廚△蠅泙后燭箸┐弌瓶イメージが
<i>/tmp/ISO.image</i> にあるとしたら、
マウントするには以下のようにしてくだ世気ぁ

儒痰跂闥粤鮟糘莉軌⊂
儒鮠
儒鈿瘰艫闌闥就Ｅ電電鄭腫鱚錫畳釿闔肅齧鈔逅嗜轣艱鹿眈
錫壌阨銓邃攻彊粤齧鈔違邇鹿頏緇
鹿鹿鹿碎緇

腫ポイントとしては、このイメージは CD イメージですので、マウントする場合にはその種類を
<i>cd9660</i> で指定するということです。これはどのような種類のイメージでもそうなのですが、
たとえばディスクイメージをマウントするのでしたら ffs を使用しなければなりません。

<p>
イメージのアンマウントには以下のコマンドを使用します。

<table border=0 width="650">
        <tr>
                <td nowrap bgcolor="#EEEEEE">
<pre>
# <b>umount /mnt</b>
# <b>vnconfig -u svnd0</b>
</pre>
                </td>
        </tr>
</table>

<p>
詳しくは
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=vnconfig&amp;sektion=8">vnconfig(8)</a>
man page を参照のこと。


<a name="pciideErr"></a>
<h2>14.11 - 助けて!  PCIIDE でエラーになってしまう !</h2>

<p>
PCI IDE DMA は多くのハードウェアの組み合わせにおいて信頼誓磴い發里任后
ですので、最近までは、IDE ドライブとの DMA 転送のサポートを謳っている、
ほとんどの「主流」のオペレーティングシステムでも、デフォルトでは
この機能を有効にしていない状態で出荷されていました。

<p>
OpenBSD は誓儷謀如∪設定できる最上位の DMA モードを使おうとします。
このようにすることで、ある誓瀋蠅任魯丱阿里△襯泪供璽棔璽匹離船奪廛札奪箸
バグのあるドライブ、ケーブル上のノイズなどの理由によって
データ転送の悪化を引き起こすかも知れません。幸運にも、Ultra-DMA モードは
悪化を検出する CRC によってデータ転送を保護してくれます。Ultra-DMA CRC
が失敗した場合には、OpenBSD はエラーメッセージを出力して、もう一度転送を試みます。

<pre>
wd2a:  aborted command, interface CRC error reading fsbn 64 of 64-79
(wd2 bn 127; cn 0 tn 2 sn 1), retrying
</pre>

<p>
何度か失敗すると、OpenBSD はもっと遅い (そして願わくばもっと信頼できる)
Ultra-DMA モードへと下げます。Ultra-DMA モード 0 まで行ってしまったら、
ドライブは PIO モードへと下げます。

<p>
もし OpenBSD がうまくモードを下げられなかったり、
途中でマシンが固まったりするようでしたら、
<a href="../../ja/report.html">バグの報告</a>を行ってくだ世気ぁ

釈瘢綵蘇帳昭取仮唄緕帯の RAID オプション</h2>
RAID (Redundant Array of Inexpensive Disks) は、一台のディスクだ世韻里箸茲蝓
より良い誓修筺⇒椴漫△修靴鴇蘢浩性を得世襪燭瓩法∧罎離妊好鮖箸Δ燭瓩
仕組みです。
RAID の特質についての詳細な議論世蓮△海諒絃呂糧楼漏阿任垢△佞燭弔僚斗廚陛誓だ世韻
ここで明棲里砲靴討泙靴腓Α

受貍
殊蘊卅苗ぢはバックアップについては何もしない。
<li>RAID 自身はダ瀬Ε鵐織ぅ爐鮹蚕未靴討譴襪錣韻任呂覆ぁ
鹿
もし、これがあなたにとって新しい情報だ世辰燭蠅靴燭蕁△海譴呂△覆燭砲箸辰董
卅苗ぢの冒険のための良い出発点世任呂△蠅泙擦鵝

取馨ソフトウェアオプション</h3>
OpenBSD は、ソフトウェア RAID である RAIDframe を含んでいます。
これについてのドキュメントは以下の場所にあります。

<ul>
<li><a href="faq11.html#raid">FAQ 11, RAID</a>
<li><a href="http://www.pdl.cmu.edu/RAIDframe/">RAIDframe ホームページ</a>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=raidctl&amp;sektion=8">raidctl(8)
     man ページ</a>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=raid&amp;sektion=4">raid(4)
     man ページ</a>
</ul>

<p>
root パーティションは
直誓椒潺蕁璽螢鵐阿垢襪海箸椎修砲覆蠅泙靴拭

取馨ハードウェアオプション</h3>
<p>
多くの OpenBSD の <a href="../../ja/plat.html">プラットフォーム</a> は、
いろんな種類のハードウェア RAID 誓宿覆鬟汽檗璽箸靴討い泙后
これはプラットフォームによって変わりますので、ハードウェアサポート
ページ (<a href="../../ja/plat.html">ここ</a> にリストがあります) を見てくだ世気ぁ

腫もうひとつ、複数のドライブを一台の IDE や SCSI のドライブとして見せて、
これを標準の IDE や SCSI アダ瀬廛燭棒接続して使うタイプの多くの誓宿覆
多くのプラットフォームで利用可能です。
これらのデバイスは、SCSI や IDE をサポートしている
どのようなハードウェアプラットフォームでも仮想的に動作できます。

<p>
これらの誓宿覆里い弔寮製造業者は次のとおり。
<ul>
<li><a href="http://www.arcoide.com/">Arco</a>
<li><a href="http://www.accusys.com.tw/">Accusys</a>
<li><a href="http://www.maxtronic.com/">Maxtronic</a>
<li><a href="http://www.infortrend.com/">Infortrend</a>
</ul>
(注: これらは OpenBSD のユーザが使えることをレポートしてくれた
誓宿覆箸いΔ誓けですので、その使用を推奨しているわけではありませんし、
徹底したリストというわけでもありません。)


<h3>Non-Options</h3>
<p>
<a href="../../ja/mail.html">メーリングリスト</a>上で、ときどき繰り返される質問として、
「Promise や HighPoint の IDE RAID コントローラはサポートしているのか ?」というのがあります。
しかし、その答は "No" です。これらのカードやチップはほんとうのハードウェア RAID コントローラ
ではなく、むしろ、これは、BIOS の助けを借りてブートするソフトウェア RAID だ世蕕覆覆里任后
既に OpenBSD は、ハードウェアに依存しない方法でソフトウェア RAID をサポートしているのですから、
OpenBSD の開発者の間では、これらのカードの特別なサポートを実装しようという気には
ならないのです。

<p>
<font color= "#0000e0">
<a href= "index.html">[FAQ の目次]</a>
<a href= "faq12.html">[12 章 - プラットフォーム固有の質問]</a>
</font>

<p>
<hr>
<a href= "index.html"><img height= "24" width= "24" src= "../../images/back.gif" border= "0" alt="[back]"></a>
<a href="mailto:www@@openbsd.org">www@@openbsd.org</a>
<br>
<small>
Originally [OpenBSD: faq14.html,v 1.103 ]
<br>
$Translation: faq14.html,v 1.43 2004/04/14 03:51:58 toshi Exp $
<br>
$OpenBSD: faq14.html,v 1.39 2004/05/09 09:58:22 saad Exp $
</small>

</body>
</html>
@


1.39
log
@sync with Steelix CVS
@
text
@d1581 1
a1581 1
$OpenBSD: faq14.html,v 1.103 2004/04/14 00:32:36 nick Exp $
@


1.38
log
@Sync with Steelix CVS
@
text
@@


1.37
log
@sync with steelix translation CVS
@
text
@d32 2
a33 2
<li><a href="#disklabel"  >14.1 - OpenBSD の disklabelを使用する</a>
<li><a href="#fdisk"      >14.2 - OpenBSD の fdiskを使用する</a>
d39 1
a39 1
    どうなってるの ?</a>
d44 1
a44 1
<li><a href="#pciideErr"  >14.11 - 助けて!  PCIIDE でエラーになってしまう !</a>
d50 1
a50 1
<h2>14.1 - OpenBSD の disklabel を使用する</h2>
d54 3
a56 3
<li><a href="#disklabel.1">disklabel とは ?</a></li>
<li><a href="#disklabel.2">OpenBSD インストール時の disklabel</a></li>
<li><a href="#disklabel.3">よくある disklabel の使い方</a></li>
d61 1
a61 1
<h3>disklabel とは ?</h3>
d91 1
a91 1
<h3>OpenBSD インストール時の disklabel</h3>
a213 6
<b>*注*</b> - 巨大なドライブをお持ちの方に。もしあなたの bios が
そのサイズのドライブをサポートできなければ、OpenBSD でもサポート
は無理です。そうでなければ、OpenBSD は問題なくディスクを扱えるはずです。
もし bios がサポートしていないドライブに直面したら、Maxtor EZ-Drive
のようなオーバーレイ誓宿覆鮖遒靴討澆襪販匹い任靴腓Α

箍係
甓係
取仮唄鞳鄲喞ぢの fdisk を使用する</h2>
d280 1
a280 1
まず、必ず fdisk の man ページを参照してくだ世気ぁ
箍顕
箍更
甓更
腫鱚升眈聹蜩聹絢昭碣箜斡
甞唄
蜩觝箘繽辣渥億姥恩鍵繝鴦聿黼蜃釶鱚鷓禅規因囈癇鈑梼粡鈑
葢繝笙黼齡癇皷
虻恩鍵緕帯浦繖
穏恩傾療慥嘖登
該繖
箜姥
甞厩
この例では、フロッピードライブの fdisk 出力を見ています。OpenBSD パーティション (A6) と
d726 2
a727 1
代わりに fdisk(8) の "update" コマンドを使用してくだ世気ぁ
箟斡甕斡より高度な「Amanda」というソフトもあります。普通の環境では
d1525 2
a1526 5
<!-- XXXexpires - この文誓瓩ぢがサポートされなくなった時点世能颪召靴廚任后
緕帯凱では、RAIDframe の "Autoconfiguration" オプションを使用して、
直誓闖パーティションをミラーリングすることが可能になりました。
OpenBSD の以前のリリースでは、この方法で root パーティションを
ミラーリングすることはできませんでした。
d1577 1
a1577 1
Originally [OpenBSD: faq14.html,v 1.102 ]
d1579 1
a1579 1
$Translation: faq14.html,v 1.42 2004/02/13 18:10:06 toshi Exp $
d1581 1
a1581 1
$OpenBSD: faq14.html,v 1.102 2004/02/13 07:20:28 david Exp $
@


1.36
log
@Sync with Steelix CVS
@
text
@d10 1
a10 1
<meta name= "copyright"     content= "This document copyright 1998-2003 by OpenBSD.">
d37 1
d713 199
d915 1
a917 1
<!-- XXXexpires - この文誓瓩ぢがサポートされなくなった時点世能颪召靴廚任后
箙屋
畊憶
いくつかのインターフェースでは OpenBSD の理論静丙蚤臙佑茲蠅眈気文続Δ△蠅泙后
苗ドライブでは、限界は 128GB で、これは現在一般的な ATA インターフェースの
限界となっています。128GB (1G=2^30 で、1,000,000,000 ではありませんので、
ドライブ誓渋ざ伴圓呂靴个靴碍蚤ぢと呼称しています) より大きな容量を持つ次誓ぢ紊
壮ドライブは、OpenBSD 3.1 およびそれ以前のバージョンでは
サポートされていないことに注意してくだ世気ぁ
箙牡
箙慨
畊涯
┝蓿繙就蔗痕鞳鈞黻鱧芍蜴瘤芍髄鴒盾蜿黷闖熙瘢雹黼謾蜿扈研瘢雹癇竏初蓋侠鐘蜿黷闖県鹿畩
や
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=boot&amp;sektion=8&amp;arch=i386">boot(8)</a>)
といった OpenBSD/i386 のブートローダ世
それ自身の内部的な古い BIOS の限界から来る 8GB の限界が存在しています。
d969 4
a972 2
OpenBSD が起動するようにするには、/bsd がブート ROM がサポートしている
範囲内になければいけません。安全に実行するための規則は単純です。
d977 2
a978 3
現時点世任蓮△海譴紡仆茲垢襪燭瓩梁召諒，呂△蠅泙擦鵝笋燭舛鮨犬董△海離襦璽襪
守ぢ必ず守ってくだ世気鹿蘊。

d984 12
d1581 1
a1581 1
Originally [OpenBSD: faq14.html,v 1.95 ]
d1583 1
a1583 1
$Translation: faq14.html,v 1.38 2003/12/30 11:58:34 toshi Exp $
d1585 1
a1585 1
$OpenBSD: faq14.html,v 1.95 2003/12/27 20:28:22 nick Exp $
@


1.35
log
@sync with steelix translation CVS
@
text
@d431 3
a433 3
プログラムが機能するために必要なものですから !  ふつうの操作用なら、fsize は必ず
1024 で、bsize は必ず 8192、cpg は必ず 16 です。Fstype は 4.2BSD です。Total sectors
は、ディスクの総容量となります。たとえば、これが 3 GB のディスクとします。
d1367 1
a1367 1
Originally [OpenBSD: faq14.html,v 1.94 ]
d1369 1
a1369 1
$Translation: faq14.html,v 1.37 2003/10/27 15:56:37 toshi Exp $
d1371 1
a1371 1
$OpenBSD: faq14.html,v 1.94 2003/10/26 16:45:11 nick Exp $
@


1.34
log
@Sync with Steelix CVS
@
text
@@


1.33
log
@Sync with Steelix CVS
@
text
@a43 1
<li><a href="#IDEDMA"     >14.12 - IDE ディスクに対しての DMA アクセスの強誓鹿畩
甕恩換
釈瘢綵津塚羨昭取仮唄苗ディスクに対しての DMA アクセスの強誓鹿莢
腫价苗のコードは、チップセットが何であるのかわからないことがあります。
そのような場合には、次のようなメッセージが出力されます。

<blockquote>
<pre>
pciide0: DMA, (unused)
</pre>
</blockquote>

このメッセージが出力された場合には、カーネルコンフィグレーションファイルの pciide の
エントリに 'flags 0x0001' を使用することで、強誓輿ぢモードで使用することができます。
これは次のような行になります。

<blockquote>
<pre>
pciide* at pci ? dev ? function ? flags 0x0001
</pre>
</blockquote>

この誓瀋蠅鮃圓錣譴襪函鞦蜑粤ぢコードは、チップセットが実際にはどのようにして
DMA 転送を行うのかを知っているかどうかに関わらず、DMA モードを使おうとします。
もし、これが動いてシステムが fsck を行って起動すれば、だ世い燭いΔ泙阿い討い
と見ても良いでしょう。もし、これが動かなければ、つまり、起動後にハングアップ
したりパニックするようなら、(そのチップセットのサポートがまだ青媛辰気譴討い覆
ため)、DMA モードを使用することができないということです。もし、その PCI-IDE
チップセットのドキュメントを見つけたら、その PCI-IDE コントローラチップセットを
完全にサポートできるようにするための良い機会だ世塙佑┐討誓さい。それは誓渋ざ伴圓
怛サイト上にあるかも知れませんし、電話で聞いてみても良いでしょう。また、もし、
その PCI-IDE コントローラがマザーボードの一部なら、どの誓渋ざ伴圓里發里鯆瓦戞
その誓渋ざ伴圓離螢宗璽垢鯆匹い韻泙靴腓Α

腫次のようなメッセージが表示されることで、DMA サポートが有効化されたことが
わかるということに注意してくだ世気ぁ

錫跫站髟阡緇
腫鱚邃姶鞦蜑粤虻浦逢蜴佗迴粤塚迴粤
鹿頏緇
鹿碎閭鞫
これは、(ATAPI CD-ROM として見えている) pciide0 の channel 1、drive 0 が
DMA 転送を使用していることを意味します。


d1367 1
a1367 1
Originally [OpenBSD: faq14.html,v 1.93 ]
d1369 1
a1369 1
$Translation: faq14.html,v 1.36 2003/10/26 14:21:24 toshi Exp $
d1371 1
a1371 1
$OpenBSD: faq14.html,v 1.93 2003/10/26 01:28:03 nick Exp $
@


1.32
log
@Sync with Steelix CVS
@
text
@a36 2
<li><a href="#D0P3"       >14.6 - OpenBSD/i386 をインストールして起動すると
    "Using partition 3 id 0" で止まるのですが</a>
a713 168
<a name="D0P3"></a>
<h2>14.6 -  OpenBSD/i386 をインストールして起動すると "Using Drive: 0 Partition: 3"
  で止まるのですが  - i386 のみ</h2>

<p>
これ自体は実はエラーメッセージではなく、MBR に入ってるブートローダ世
どのドライブのどのパーティションから起動しようとしているかということです。
問題なのは、起動がここで止まってしまうということでしょう。

<p>
このようなことが起こる場合のよくある理由がふたつあります。BIOS と
OpenBSD の MBR の非互換誓△弔泙蝓▲疋薀ぅ屬離献瓮肇蠅量簑蠅任后
ドライブのジオメトリの問題は、インストールの途中で原因不明世乃襪海
も報告されていますが、たとえば、ドライブをコンピュータから別のコンピュータ
へ移したり、BIOS をアップデートしたり、BIOS の誓瀋蠅鯤儿垢靴燭蠅靴燭箸
起きるものです。

<p>
<b>注:</b> OpenBSD 3.1 以降では、BIOS の互換誓量簑蠅蓮△垢戮討離灰鵐團紂璽
システムで仮想的に解決されているはずです。しかしながら、ドライブジオメトリの
問題はまだ逝減澆憩誓ますので、このメッセージが表示された後で、システムがハング
アップする危険誓呂泙誓残っています。

<p>
BIOS の非互換誓量簑蠅魏魴茲垢襪砲蓮▲屐璽肇蹇璽誓をシステムに合った
ものにしなければなりません。幸い、ブートローダ世
簡単に手に入るものです。

<h3>BootEasy ブートローダ世鬟ぅ鵐好函璽襪垢襪砲鹿莖腫まず、システムを起動しなければなりません。ハードディスクから直誓楜阿任覆
場合には、ブートフロッピーか CD-ROM で起動する必要があります。
'boot&gt;' プロンプトが出力されたら、ハードディスクからの起動に
誓擇蟯垢┐泙后

腫鱚鱚痲蜴硼阡頏閧蜴鞦竢躇闕鞦辣朸街傾甓綾闔粡鼡箘箘
鞳鄲喞蕨窺恩
硼阡眈硼阡箘畉黻鹿眈
鹿頏緇
腫このコマンドで、最初のドライブの 'a' パーティションにある /bsd
からの起動に誓擇蟯垢錣辰董▲轡好謄爐阿垢襪茲Δ砲覆蠅泙后

腫次慓鴦蜿システムが起動できたら、BootEasy ブートローダ世鬟ぅ鵐好函璽襪垢詆廚
あります。ファイルは CD-ROM か ftp サイトの 
<tt>3.3/tools/booteasy/Boot.bin</tt> ディレクトリ
にありますので、以下のような
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=fdisk&amp;sektion=8&amp;arch=i386">fdisk(8)</a>
コマンドでインストールできます。

<pre>
<!-- XXXversion -->
# <b>fdisk -i -f /mnt/3.3/tools/booteasy/Boot.bin wd0</b>
</pre>
<p>
<!-- XXXversion -->
3.3 の CD を /mnt にマウントしていて、IDE ドライブを使っている場合には、
Boot.bin の場所やどのようなハードディスクを使用しているのか (SCSI
ドライブなら 'sd0' というように) によって、適当に変える必要があります。
<b>注意: ディスクが丸ごと OpenBSD のパーティションではない場合に、
これを実行してはいけません !</b>  MBR をこのように初期化してしまいますと、
OpenBSD のパーティションをディスク全体に広げて他のパーティションを
全部消去してしまうことになりますので、大変なことになります。

<p>
BootEasy には他にも機能がありますので、ブートローダ世北簑蠅覆討
使用してみたくなるかも知れません。起動時にブートパーティション
を選択することができます -- これは、どのパーティションから起動するのかを
聞いてきて、何も選ばなければアクティブパーティションから起動します。
ひとつのディスクに複数の OS を入れている場合には、これは非常に便利なものです。
BootEasy をこのようにインストールするには、MS-DOS から CD-ROM か
FTP サーバーの BootEasy のディレクトリにある BOOTINST.EXE を実行してくだ世気ぁ

取馨羊腕ぢブートローダ世鬟ぅ鵐好函璽襪垢襪砲鹿莖腫督瓶邦努の入った Windows 9x か v6 の起動ディスクから起動します。
システムが起動して MS-DOS のプロンプトが出力されたら、次のようにタイプします。

<pre>
A:\&gt;<b>fdisk /mbr</b>
</pre>
<p>
メッセージは何も出力されずに少しだ世吋妊好縫▲札垢△辰討薀灰泪鵐
プロンプトに戻ってきます。"Bad command or file name" と出た場合には、
FDISK.EXE がディスクにないということです。うまくいけば、
"Using ..." というメッセージを出力していた部分が置き換えられますので、
メッセージは出なくなります。BIOS 互換誓量簑蠅△辰疹豺隋
これで問題がなくなったはずですから、再起動すれば、OpenBSD のインスールは
うまくいくでしょう。

<p>
FreeDOS でもうまくいくという報告もあります。


<h3>OS-BS ブートローダ鹿莖腫別のブートローダ世哭帯ぢは OpenBSD の CD-ROM に入っていますし、
FTP サイトの <tt>3.3/tools/osbs135.exe</tt> にもあります。OS-BS の web ページは、
<a href="http://www.prz.tu-berlin.de/~wolf/os-bs.html">
    http://www.prz.tu-berlin.de/~wolf/os-bs.html</a>
です。

<h3>LILO</h3>
<p>
Linux の LILO も使用できます。詳細は以下のところにあります。
<a href="ftp://ftp.openbsd.org/pub/OpenBSD/3.3/i386/INSTALL.linux">INSTALL.linux</a>


<h3>問題を避けるには</h3>
<p>
ほとんどのマシンは BIOS の互換誓量簑蠅呂△蠅泙擦鵑△發掘
この問題があるとわかっているマシンの誓瀋蠅鬚垢襪里任靴燭
問題を避けるのはとても簡単です。普通にインストールしているときに
OpenBSD のローダ世轡好謄爐縫ぅ鵐好函璽襪気譴襪里專緕鱚蜩肬緕帯徴
という質問に 'Y' と答えたときだ世韻任后と答えて OpenBSD のパーティションを
手動で作誓垢譴弌聹蜩で 'reinit' か' 'update' をしない限りは、
ブートローダ世屬垢┐蕕譴襪海箸呂△蠅泙擦鵝發舛蹐鵝△海譴浪燭蕕
ブートローダ世辰討い訃豺腓力辰任后ぢそうでなければ (新品や空のディスクの場合や、
他のプラットフォームから持ってきたドライブのような場合)
システムが起動する前に入れておかなければなりません。


<h3>ドライブのジオメトリの問題を解決するには</h3>
<p>
理想的には、ドライブのジオメトリを直さずに同じジオメトリの
ままにして問題を避けたいと思うでしょうが、それでは避けられない
場合もあります。例えば LBA をサポートしていない古い
コンピュータからどうしても LBA を使う新しいマシンへ
大容量のドライブを移すような場合です。

<p>
上記にあるように、ブートディスクか CD-ROM で起動します。
root でログインして、以下のコマンドを実行してくだ世気ぁ

腫鱚竦鬲辟繝闖闖齟粤祚蜴齡瘡赳闖硼阡鬲辟繝蜿黷闖鹿頏緇
腫再起動すれば、うまくいくはずです。

<p>
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=installboot&amp;sektion=8&amp;arch=i386">installboot(8)</a>
は
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=biosboot&amp;sektion=8&amp;arch=i386">biosboot(8)</a>
をロードするパーティションブートローダ
釈鱚羹∵雕關緕碵筮闥膀竍薛砠遲轣隨竍蘓髟纈硼阡逅雌繼闔集逅氏鱆莉薐原⊂硼阡┯をインストールして誓瀋蠅靴泙后
釈鱚羹∵雕關緕碵筮闥膀竍薛砠遲轣隨竍蘓髟纈硼阡逅雌繼闔集逅氏鱆莉薐原⊂硼阡┯はカーネルを RAM へロードするモジュールです。
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=biosboot&amp;sektion=8&amp;arch=i386">biosboot(8)</a> は、
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=boot&amp;sektion=8&amp;arch=i386">boot(8)</a>
の物理的な場所 (システムの BIOS による) を指し示すテーブルを持っています。BIOS が感知する
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=boot&amp;sektion=8&amp;arch=i386">boot(8)</a>
の場所を変更するような何かを行った場合には、上にあるように
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=installboot&amp;sektion=8&amp;arch=i386">installboot(8)</a>
を再度実行して
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=boot&amp;sektion=8&amp;arch=i386">boot(8)</a>
を指しているテーブルを再初期化しなければなりません。

<p>
詳しくは <a href="#InstBoot">Install Boot</a> を参照してくだ世気ぁ

箟俺甕卸過硼鶯繖闕轣鈔蜴鱠痺智纈鳫鱚痲蜴胝碆閹喚傾碆卸竡齊續鴒蜴箟官甕官蜃蜴瘡踟緕帯頂瘻唄讙窺慌
箟官甕官ぴ鱇銖赱闔聲餘堪蔗迪屋鯵渥唄浦憶紺鼈祷箟寛甕寛は鞳鄲喞聲餘堪蔗迪屋鯵渥碓虻碍叉鉗站


窺咳
跫栴繻蝌鱇銖赱闔嶝

絶昂畊群
ドライブに起動フロッピーを入れて (あるいはブート可能な CDROM を使用して)、
d1586 1
a1586 1
Originally [OpenBSD: faq14.html,v 1.91 ]
d1588 1
a1588 1
$Translation: faq14.html,v 1.34 2003/08/22 19:45:11 toshi Exp $
d1590 1
a1590 1
$OpenBSD: faq14.html,v 1.91 2003/08/22 13:11:53 nick Exp $
@


1.30
log
@sync with steelix translation CVS
@
text
@d25 1
a25 1
<a href= "faq12.html">[12 章 - 高度なユーザ向け]</a>
d1555 1
d1577 1
a1577 1
<a href= "faq12.html">[12 章 - 高度なユーザ向け]</a>
d1586 1
a1586 1
Originally [OpenBSD: faq14.html,v 1.88 ]
d1588 1
a1588 1
$Translation: faq14.html,v 1.32 2003/07/26 02:39:51 toshi Exp $
d1590 1
a1590 1
$OpenBSD: faq14.html,v 1.88 2003/07/25 20:05:19 nick Exp $
@


1.29
log
@sync with steelix translation CVS
@
text
@d25 1
a25 1
<a href= "faq13.html">[13 章 - IPsec]</a>
d1576 1
a1576 1
<a href= "faq13.html">[13 章 - IPsec]</a>
d1585 1
a1585 1
Originally [OpenBSD: faq14.html,v 1.87 ]
d1587 1
a1587 1
$Translation: faq14.html,v 1.31 2003/07/14 23:13:56 toshi Exp $
d1589 1
a1589 1
$OpenBSD: faq14.html,v 1.87 2003/07/14 20:15:56 nick Exp $
@


1.28
log
@sync with steelix translation CVS
@
text
@d523 1
a523 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=unlimit&amp;sektion=1&amp;format=html">unlimit(1)</a>
d525 1
a525 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ulimit&amp;sektion=1&amp;format=html">ulimit(1)</a> です。)
d768 1
a768 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=fdisk&amp;sektion=8&amp;arch=i386&amp;format=html">fdisk(8)</a>
d1585 1
a1585 1
Originally [OpenBSD: faq14.html,v 1.86 ]
d1587 1
a1587 1
$Translation: faq14.html,v 1.30 2003/07/04 15:05:51 toshi Exp $
d1589 1
a1589 1
$OpenBSD: faq14.html,v 1.86 2003/07/04 13:09:55 nick Exp $
@


1.27
log
@
sync with steelix translation CVS
@
text
@d32 2
a33 2
<li><a href="#disklabel"  >14.1 - OpenBSD の Disklabelを使う</a>
<li><a href="#fdisk"      >14.2 - OpenBSD の fdiskを使う</a>
d51 2
a52 3
<a name= "disklabel"></a>
<a name="14.1"></a>
<h2>OpenBSD の Disklabel を使う</h2>
d285 2
a286 3
<a name= "fdisk"></a>
<a name="14.2"></a>
<h2>14.2 - OpenBSD の fdisk を使う</h2>
d398 1
a398 2
<a name= "NewDisk"></a>
<a name="14.3"></a>
d516 1
a516 2
<a name= "SwapFile"></a>
<a name="14.4"></a>
d666 1
a666 2
<a name= "SoftUpdates"></a>
<a name="14.5"></a>
d671 8
a678 6
過去数年にわたって、Kirk McKusick は "Soft Update" なるものの
開発を進めてきました。これは Greg Ganger と Yale Patt が
提案したアイディアに基づくもので、バッファキャッシュ操作を
部分的に誓依垢襪海箸如篤コードからディレクトリのエントリを同期書き込みしなければならない
という要件が除去可能になる、という考え方です。これによって、ディスクへの書き込み誓修
大幅に向上します。
d681 3
a683 2
Soft Update は今も開発中ですから、
コンピュータがきちんと shutdown せずに突然落ちたときには、やはり
d685 1
a685 7
が必要なのですが、これは将来的には改善される見込みです。

<p>
Soft Update についてのより詳しいことは、
<a href="http://www.ece.cmu.edu/~ganger/papers/CSE-TR-254-95/">Ganger and Patt</a> や
<a href="http://www.mckusick.com/softdep/index.html">McKusick</a>
の論席犬鮖仮箸靴討誓さい。
d716 1
a716 2
<a name= "D0P3"></a>
<a name="14.6"></a>
d818 1
a818 1
FTP サイトの 2.9/tools/osbs135.exe にもあります。OS-BS の web ページは、
d884 1
a884 2
<a name= "LargeDrive"></a>
<a name="14.7"></a>
d954 1
a954 2
<a name= "InstBoot"></a>
<a name="14.8"></a>
d1008 1
a1008 2
<a name= "Backup"></a>
<a name="14.9"></a>
d1374 1
a1374 2
<a name= "MountImage"></a>
<a name=14.l0></a>
d1421 1
a1421 2
<a name= "pciideErr"></a>
<a name=14.11></a>
d1452 1
a1452 1
<a name= "IDEDMA"></a>
d1501 1
a1501 1
<a name= "RAID"></a>
d1585 1
a1585 1
Originally [OpenBSD: faq14.html,v 1.83 ]
d1587 1
a1587 1
$Translation: faq14.html,v 1.27 2003/05/10 01:03:42 toshi Exp $
d1589 1
a1589 1
$OpenBSD: faq14.html,v 1.83 2003/05/01 01:47:41 nick Exp $
@


1.26
log
@
sync with steelix translation CVS
@
text
@d319 1
a319 1
----------------------------------------------------------------------
d678 1
a678 1
提案したアイデアに基づくもので、バッファキャッシュ操作を
d775 1
a775 1
3.0/tools/booteasy/Boot.bin ディレクトリ
d782 1
a782 1
# <b>fdisk -i -f /mnt/3.0/tools/booteasy/Boot.bin wd0</b>
d786 1
a786 1
3.0 の CD を /mnt にマウントしていて、IDE ドライブを使っている場合には、
d835 1
a835 1
<a href="ftp://ftp.openbsd.org/pub/OpenBSD/3.0/i386/INSTALL.linux">INSTALL.linux</a>
d1599 1
a1599 1
Originally [OpenBSD: faq14.html,v 1.82 ]
d1601 1
a1601 1
$Translation: faq14.html,v 1.26 2003/04/06 12:45:48 toshi Exp $
d1603 1
a1603 1
$OpenBSD: faq14.html,v 1.82 2003/04/04 17:49:08 nick Exp $
@


1.25
log
@
sync with steelix translation CVS
@
text
@d772 1
d781 1
d785 1
d898 1
d1545 1
d1599 1
a1599 1
Originally [OpenBSD: faq14.html,v 1.81 ]
d1601 1
a1601 1
$Translation: faq14.html,v 1.25 2003/03/19 06:08:02 toshi Exp $
d1603 1
a1603 1
$OpenBSD: faq14.html,v 1.81 2003/03/18 03:41:04 nick Exp $
@


1.24
log
@
sync with steelix translation CVS
@
text
@d22 7
a28 1
<h2><font color=#e00000>14 - ディスクの誓瀋鹿肬銓昭蓿昭仮
箟妓甕妓釈鱚羹蜴粤蔗迪⊂枡叢ぢトップ]</a>
d1588 1
a1588 1

a1589 1
<p>
d1594 1
a1594 1
Originally [OpenBSD: faq14.html,v 1.80 ]
d1596 1
a1596 1
$Translation: faq14.html,v 1.24 2003/03/15 16:57:13 toshi Exp $
d1598 1
a1598 1
$OpenBSD: faq14.html,v 1.80 2003/03/11 21:03:38 nick Exp $
@


1.23
log
@
sync with steelix translation CVS
@
text
@d818 1
a818 1
FTP サイトの 2.9/tools/osbs135.exe にもあります。OS-BS のウェブページは、
d1526 1
a1526 1
<li><a href="../faq11.html#raid">FAQ 11, RAID</a>
d1591 1
a1591 1
$Translation: faq14.html,v 1.23 2003/03/12 00:18:31 toshi Exp $
@


1.22
log
@
sync with steelix translation CVS
@
text
@d945 3
d1589 1
a1589 1
Originally [OpenBSD: faq14.html,v 1.79 ]
d1591 1
a1591 1
$Translation: faq14.html,v 1.22 2003/03/10 10:56:19 toshi Exp $
d1593 1
a1593 1
$OpenBSD: faq14.html,v 1.79 2003/03/10 00:17:23 margarida Exp $
@


1.21
log
@
sync with steelix translation CVS
@
text
@d407 1
d471 1
a471 1
# <b>newfs wd1a </b>
d485 1
a485 1
# <b>mount /dev/wd1a /u</b>
d492 1
a492 1
<pre>/dev/wd1a /u ffs rw 1 1</pre>
d496 1
a496 1
このような場合には、新しいドライブを /mnt にマウントして、cpio -pdum を使って /usr/local を
d499 1
a499 1
ファイルを編集して、/usr/local パーティションが新しい /dev/wd1a
d503 1
a503 1
<b>/dev/wd1a /usr/local ffs rw 1 1</b>
d507 1
a507 1
<strong>boot -s</strong> で、シングルユーザモードで起動します。既存の /usr/local を /usr/local-backup
d1586 1
a1586 1
Originally [OpenBSD: faq14.html,v 1.78 ]
d1588 1
a1588 1
$Translation: faq14.html,v 1.21 2003/02/28 07:05:36 toshi Exp $
d1590 1
a1590 1
$OpenBSD: faq14.html,v 1.78 2003/02/28 00:34:28 nick Exp $
@


1.20
log
@
sync with steelix translation CVS
@
text
@d1585 1
a1585 1
Originally [OpenBSD: faq14.html,v 1.77 ]
d1587 1
a1587 1
$Translation: faq14.html,v 1.20 2003/02/25 05:11:15 toshi Exp $
d1589 1
a1589 1
$OpenBSD: faq14.html,v 1.77 2003/02/25 04:00:10 david Exp $
@


1.19
log
@
sync with steelix translation CVS
@
text
@d1585 1
a1585 1
Originally [OpenBSD: faq14.html,v 1.76 ]
d1587 1
a1587 1
$Translation: faq14.html,v 1.19 2003/02/20 06:32:59 toshi Exp $
d1589 1
a1589 1
$OpenBSD: faq14.html,v 1.76 2003/02/20 03:09:56 nick Exp $
@


1.18
log
@
sync with steelix translation CVS
@
text
@d4 1
a4 1
<title>14.0 - Disk setup</title>
d22 1
a22 1
<h2><font color=#e00000>14.0 - ディスクの誓瀋鹿肬銓昭蓿昭仮
箟儀甕儀釈鱚羹蜴粤蔗迪⊂枡叢ぢトップへ]</a>
<a href= "faq13.html">[13.0 - IPsec へ]</a>
d1585 1
a1585 1
Originally [OpenBSD: faq14.html,v 1.75 ]
d1587 1
a1587 1
$Translation: faq14.html,v 1.18 2003/02/19 00:12:40 toshi Exp $
d1589 1
a1589 1
$OpenBSD: faq14.html,v 1.75 2003/02/18 03:02:18 nick Exp $
@


1.17
log
@
sync with steelix translation CVS
@
text
@d1585 1
a1585 1
Originally [OpenBSD: faq14.html,v 1.74 ]
d1587 1
a1587 1
$Translation: faq14.html,v 1.17 2003/01/04 15:40:51 toshi Exp $
d1589 1
a1589 1
$OpenBSD: faq14.html,v 1.74 2003/01/01 13:02:00 nick Exp $
@


1.16
log
@
sync with steelix translation CVS
@
text
@d10 1
a10 1
<meta name= "copyright"     content= "This document copyright 1998-2002 by OpenBSD.">
d1585 1
a1585 1
Originally [OpenBSD: faq14.html,v 1.73 ]
d1587 1
a1587 1
$Translation: faq14.html,v 1.16 2002/12/25 06:55:18 toshi Exp $
d1589 1
a1589 1
$OpenBSD: faq14.html,v 1.68 2002/07/12 02:51:35 nick Exp $
@


1.15
log
@
sync with badlands translation CVS
@
text
@d26 5
a30 5
<li><a href="#disklabel"  >14.1 - OpenBSD の Disklabelを使う</a></li>
<li><a href="#fdisk"      >14.2 - OpenBSD の fdiskを使う</a></li>
<li><a href="#NewDisk"    >14.3 - OpenBSD でディスクを追加する</a></li>
<li><a href="#SwapFile"   >14.4 - ファイルへのスワップ</a></li>
<li><a href="#SoftUpdates">14.5 - Soft updates</a></li>
d32 8
a39 6
"Using partition 3 id 0" で止まるのですが</a></li>
<li><a href="#LargeDrive" >14.7 - OpenBSD での大容量ドライブはどうなってるの ?</a></li>
<li><a href="#InstBoot"   >14.8 - Bootblock のインストール - i386 のみ</a></li>
<li><a href="#Backup"     >14.9 - トラブルにそなえよう: テープへのバックアップと復元</a></li>
<li><a href="#MountImage" >14.10 - OpenBSD でディスクイメージをマウント</a></li>
<li><a href="#pciideErr"  >14.11 - 助けて!  PCIIDE でエラーになってしまう !</a></li>
d41 1
a41 1
<li><a href="#RAID"       >14.13 - OpenBSD の RAID オプション</a></li>
d62 1
a62 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=disklabel&amp;sektion=8&amp;format=html">disklabel(8)</a>
a63 1
</p>
d73 2
a74 1
詳しいことは <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=disklabel&amp;sektion=5&amp;format=html">disklabel(5)</a>
a75 1
</p> 
d82 1
a82 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=disklabel&amp;sektion=8&amp;format=html">disklabel(8)</a>
a85 1
</p>
d92 9
a100 8
ところでしょう。これは (i386 ユーザなら) <a href="#fdisk">fdisk(1)</a> の直後に出てきます。
インストール中に、disklabel を使って、マウントポイントごとに別々のラベルを
作誓靴泙后ぅ鵐好函璽訝罎法
釈鱚羹∵雕關緕碵筮闥膀竍薛砠遲轣隨竍蘓髟纈粡鼡赱矼讀瘢雹黼謾蜿扈研瘢雹肬鴉癆処譬鞘蜩謖痰繻┯の中からマウントポイントを指定することもできますが、これはどうしても必要
というわけではありません。後ほどプロンプトで、これでいいかどうかの確認を求められますから。
しかし、これは実行しておいた方がインストールが少しはスムーズになることでしょう。
</p>
d105 6
a110 5
'a' です。このラベルは誓簑个ぢをマウントするところにすべきです。作誓靴討い進
良い、お勧めパーティションとそのサイズについては、
<a href="../faq4.html#SpaceNeeded">FAQ 4, 必要なスペース</a> を参照してくだ世気ぁ
サーバの場合、少なくともここに書いてあるラベルは別々にしておくのが望ましいでしょう。
デスクトップのユーザなら、/ のマウントポイントだ世韻鮑鄒成しておけば十分でしょう。最初に
a115 1
</p>
d133 4
a136 4
&gt; <strong>d a</strong>
&gt; <strong>a a</strong>
offset: [63] <strong>&lt;Enter&gt;</strong>
size: [16386237] <strong>64M</strong>
d138 8
a145 8
FS type: [4.2BSD] <strong>&lt;Enter&gt;</strong>
mount point: [none] <strong>/</strong>
fragment size: [1024] <strong>&lt;Enter&gt;</strong>
block size: [8192] <strong>&lt;Enter&gt;</strong>
cpg: [16] <strong>&lt;Enter&gt;</strong>
&gt; <strong>a b</strong>
offset: [131103] <strong>&lt;Enter&gt;</strong>
size: [16255197] <strong>64M</strong>
d147 1
a147 1
FS type: [swap] <strong>&lt;Enter&gt;</strong>
d151 11
a161 8
これで、64MB の root パーティションが / にマウントされて、64MB スワップパーティションが作られました。オフセットが
セクター 63 から始まるのに注目してくだ世気ぁ靴掘△海譴芭匹い里任后汽ぅ困力辰箸いε誓で、disklabel は
セクター単位で表示を行いますが、入力は特にセクターで入力しなくても構いません。上記の例でもそうですが、
<i>64MB なら 64M</i> とか、<i>2GBなら 2G</i> とすれば良いのです。すると Disklabel はそれをいちばん近い
シリンダ世亡櫃瓩討譴泙后泙疹綉領磴任蓮粡鼡赱矼は「b」がスワップであると自動的に想定していることにも
注目してくだ世気ぁ海譴論正しい想定で、GENERIC カーネルはラベル「b」にスワップを探しにいくよう
誓瀋蠅気譴討い襪里任后任垢蕁△海離ぅ疋薀ぅ鵑砲靴燭辰董▲好錺奪廚皈ぢにしておきましょう。
</p>
d164 4
a167 4
次の例では、もうふたつラベルを作誓靴討い泙后海譴呂弔泙蝓袷瓦淵ぅ鵐好函璽襪任呂覆
ということです。これらのサイズは、OpenBSD を完全にインストールするには不十分だ世蕕任后
繰り返しになるだ世韻任垢里如▲僉璽謄轡腑鵑鬚垢戮萄鄒成する作業を見せるのは省略します。
</p>
d170 3
a172 3
&gt; <strong>a d</strong>
offset: [262143] <strong>&lt;Enter&gt;</strong>
size: [16124157] <strong>64M</strong>
d174 8
a181 8
FS type: [4.2BSD] <strong>&lt;Enter&gt;</strong>
mount point: [none] <strong>/tmp</strong>
fragment size: [1024] <strong>&lt;Enter&gt;</strong>
block size: [8192] <strong>&lt;Enter&gt;</strong>
cpg: [16] <strong>&lt;Enter&gt;</strong>
&gt; <strong>a e</strong>
offset: [393183] <strong>&lt;Enter&gt;</strong>
size: [15993117] <strong>64M</strong>
d183 5
a187 5
FS type: [4.2BSD] <strong>&lt;Enter&gt;</strong>
mount point: [none] <strong>/var</strong>
fragment size: [1024] <strong>&lt;Enter&gt;</strong>
block size: [8192] <strong>&lt;Enter&gt;</strong>
cpg: [16] <strong>&lt;Enter&gt;</strong>
d191 7
a197 6
上記の例では、ふたつほど気付く点世△蠅泙后泙此▲侫札奪箸暗坊彁擦気譴董
次のところでデフォルトになって待っているということです。このようなインストールをするなら、
オフセットをあれこれと変更する必要はまったくない。別の違いとしては、ラベル 'c' は
スキップされています。これには理由があり、ラベル 'c' はディスク全体を表わすラベルだ世蕕覆里任后
ですから、ラベル 'c' だ世韻論絶対に変更してはいけません。
</p>
d200 4
a203 3
ラベルが全部できたら、後はそれをディスクに書き込んでインストールを誓茲某覆瓩泙靴腓Α
全部書いて disklabel を終了するには (そしてインストールを続けるには)、次のようにします。
</p>
d206 2
a207 2
&gt; <strong>w</strong>
&gt; <strong>q</strong>
d211 5
a215 4
<strong>*注*</strong> - 巨大なドライブをお持ちの方に。もしあなたの bios がそのサイズのドライブをサポートできなければ、
OpenBSD でもサポートは無理です。そうでなければ、OpenBSD は問題なくディスクを扱えるはずです。もし bios がサポート
していないドライブに直面したら、Maxtor EZ-Drive のようなオーバーレイ誓宿覆鮖遒靴討澆襪販匹い任靴腓Α
鹿霈
箍臆
甓乙
いったんシステムのインストールが終わったら、もうあまり disklabel を使うこともないでしょう。しかし、ディスクを追加、
削除、再構誓垢襪箸覆鼻粡鼡赱矼を使う場合が出てきます。まず最初に
やるべきことは、現状の disklabel を見ることです。これには以下のようにします。
</p>
d228 1
a228 1
# <strong>disklabel wd0</strong> &gt;----- Or whatever disk device you'd like to view
d259 4
a262 4
上記のコマンドは、単に既存の disklabel を許すためのものであり、間違って変更してしまったりしないよう
保証してくれるものです (これは私たちは、ときどき必要なことでしょう)。しかし、もし変更を加えたいなら、
disklabel で -E オプションを使用しなければなりません。
</p>
d265 1
a265 1
# <strong>disklabel -E wd0</strong>
d269 3
a271 2
これでプロンプトが出てきますが、これは OpenBSD のインストール時に目にするものと同じものです。
このプロンプトで何より大誓擇淵灰泪鵐匹色ぢでしょう。これは disklabel で使用可能なオプションの
d273 3
a275 2
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=disklabel&amp;sektion=8&amp;format=html">disklabel(8)</a>
man ページ全部を見るには、 'M' コマンドを使います。このプロンプトから、パーティションの追加、削除、
d277 1
a277 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=disklabel&amp;sektion=8&amp;format=html">disklabel(8)</a>
a278 1
</p>
a283 1
<p>
d285 2
a286 2
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=fdisk&amp;apropos=0&amp;sektion=8&amp;arch=i386&amp;format=html">fdisk(8)</a>
</p>
a293 1
</p>
a297 1
</p>
d301 2
a302 2
</p>
<pre># <strong>fdisk fd0</strong><br>
a306 1
</p>
a323 1
</p>
a328 1
</p>
d331 1
a331 1
# <strong>fdisk -e wd0</strong>
d333 1
a333 1
fdisk: 1&gt; <strong>help</strong>
d352 3
a354 3
fdisk に入っていろいろ試すのは、まったく危険はありません。ただ世掘∧儿垢鯤歛犬垢襪匹Δ垢譴疹豺腓砲蓮
誓簑个齡鳫鈑称鹿齡鳫鈑と答え、<strong>write</strong> コマンドは使わないようにしてくだ世気ぁ
鹿霈
箜儀
甞妓
以下に挙げておきます。</p>
d360 32
a391 15
<li><strong>help</strong>    対話型編集モードで fdisk のわかるコマンド一覧を表示します。</li>
<li><strong>reinit</strong>  現在選択中のメモリに入っているブートブロックのコピーを初期化します。</li>
<li><strong>disk</strong>    fdisk がプローブした現在のドライブジオメトリを表示します。必要なら編集も可能です。</li>
<li><strong>setpid</strong>  パーティションテーブルの指定エントリのパーティション ID を変更します。このコマンドは、既存のパーティションを OpenBSD に再割り当てしたりする場合には特に便利です。</li>
<li><strong>edit</strong>    現在のブートブロックのメモリ内コピーの、指定テーブルエントリを編集。BIOS ジオメトリモードで編集することも、セクターオフセットやサイズで編集することも可能です。</li>
<li><strong>flag</strong>    パーティションテーブルの指定エントリを起動可能に誓瀋蠅靴泙后燭誓し、起動可能に誓瀋蠅任襯┘鵐肇蠅呂劼箸弔誓けです。
もし、拡張パーティションから起動したい場合には、その拡張パーティションのエントリを起動可能にする必要があります。</li>
<li><strong>update</strong>  現在のブートブロックのメモリ内コピーの機械コードを更新します。</li>
<li><strong>select</strong>  現在のブートブロックにある、拡張パーティションテーブルエントリで示されたブートブロックを、メモリに読み込みます。</li>
<li><strong>print</strong>   現在選択中のメモリ内のブートブロックのコピーとその MBR テーブルをターミナルに表示します。</li>
<li><strong>write</strong>   現在メモリ内にあるブートブロックのコピーをディスクに出力します。本当に実行してよいかどうか、操作確認が出力されます。</li>
<li><strong>exit</strong>    現在の fdisk のレベルを終了し、前に選んだ瀬瓮皀蠧發離屐璽肇屮蹈奪離灰圈爾北瓩襪△修譴覆韻譴丱廛蹈哀薀爐鮟擦靴泙后鹿跚殊蘊首闔臂髟蜚鹿齡鳫鈑ぢ現在の fdisk のレベルを終了し、前に選んだ瀬瓮皀蠧發離屐璽肇屮蹈奪離灰圈爾北瓩襪
それがなければプログラムを終了します。exit と異なるのは、変更したブロックはディスクに出力される点世任后
殊蘊首闔臂痰闥闔臂ぢ現在の変更を保存しないでプログラムを終了します。</li>
d399 7
a405 9
そう、ディスクさえ<strong>きちんと</strong>インストールされれば、あとは
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=fdisk&amp;apropos=0&amp;sektion=8&amp;arch=i386&amp;format=html">fdisk(8)</a>
(<i>i386 のみ</i>)
と
<a href= "http://www.openbsd.org/cgi-bin/man.cgi?query=disklabel&amp;apropos=0&amp;sektion=8&amp;format=html">
disklabel(8)</a> を使用して
OpenBSD 用にディスクを
誓瀋蠅垢襪誓けなのです。
<P>
d408 1
a408 1
# <Strong>fdisk -i sd2</strong>
d414 1
a414 1
# <strong>disklabel -e sd2</strong>
d428 16
a443 15
まず、'c' パーティションは無視します。必ず存在していて、
disklabel のようなプログラムが機能するために必要なものですから !
ふつうの操作用なら、fsize は必ず 1024 で、bsize は必ず 8192、 
cpg は必ず 16 です。Fstype は 4.2BSD です。Total sectors は、
ディスクの総容量となります。
たとえば、これが 3 GB のディスクとします。ディスクメーカの言世な任蓮
蚤ぢは 3000 MB です。そこで 6185088/3000 の割り算をします
(<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=bc&amp;sektion=1">bc(1))</a> を使います。答は 2061 です。
そこで a, d, e, f, g, ... のパーティションサイズを計算するには、それぞれ X MB の容量が必要ならば、単に X*2061
のかけ算をすれば良いのです。最初の新しいパーティションのオフセットは、
さっき disklabel の出力に出てきた「sectors/track」と
同じになります。ここでは 63 です。その後の各パーティションのオフセットは、
各パーティションサイズと、そのパーティションの
オフセットを組み合わせたものになります (ただ世礑ぢパーティションだ世韻蓮什澆亮阿
あてはまるところもないし、無視しましょう)。
d449 1
d453 1
a453 1
<p>
d463 1
d466 2
a467 3
最後に、そのディスク上にファイルシステムを作誓靴覆討呂覆蕕覆い里任后海譴砲蓮釈鱚羹
∵雕關緕碵筮闥膀竍薛砠遲轣隨竍蘓髟纈鈬鵙瘢雹瘰鳫竟鷭愛瘢雹黼謾蜿扈研瘢雹肬鴉癆処譬嬢纓胝┯を使用します。
</p>
d470 1
a470 1
# <strong>newfs wd1a </strong>
d475 3
a477 2
(OpenBSD のディスク名称を見たい場合は、<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dmesg&sektion=8">dmesg(8)</a> の出力を見ます)。
</p>
a481 1
</p>
d484 1
a484 1
# <strong>mount /dev/wd1a /u</strong>
d488 3
a490 2
最後にそれを <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=fstab&amp;sektion=5">/etc/fstab(5)</a> に追加します。
</p>
d494 6
a499 6
では、/usr/local などの既存のディレクトリを移動させたい場合にはどのようにすれば良いのでしょう。このような場合には、
新しいドライブを /mnt にマウントして、cpio -pdum を使って /usr/local を /mnt ディレクトリにコピーします。そして、
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=fstab&amp;sektion=5">/etc/fstab(5)</a> ファイルを編集して、
/usr/local パーティションが新しい /dev/wd1a (さきほど新規にフォーマットしたパーティション) になるように変更します。
たとえば、
</p>
d502 1
a502 1
<strong>/dev/wd1a /usr/local ffs rw 1 1</strong>
d506 4
a509 4
<strong>boot -s</strong> で、シングルユーザモードで起動します。既存の /usr/local を /usr/local-backup に移動します
(あるいは、ツキが上向いてる気分ならバッサリ削除しても良いでしょう)。そして、空のディレクトリ /usr/local を
作誓靴討誓さい。そしてシステムを再起動すると、ファイルが /usr/local に元どおりになっているのがわかります !
</p>
a510 1
<br>
d519 4
a522 5
まずはプロセスごとのリミットを上げてみましょう。
csh でしたら <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=unlimit&amp;sektion=1&amp;format=html">unlimit(1)</a>
ですし、
sh でしたら <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ulimit&amp;sektion=1&amp;format=html">ulimit(1)</a> です。)
</p>
d525 2
a526 1
ファイルへのスワップは、カスタムのカーネルは必要ありませんが、ビルドし直しても構いません。
a527 1
</p>
d532 5
a536 4
追加のスワップ領域を誓瀋蠅垢襪里法∈任盍蔽韻朕彗癖，蓮▲侫．ぅ襪悗離好錺奪廚鯆媛辰垢襪海箸任后海諒，蓮
囂胄鞣癆纉ぢが有効になっているファイルシステム上では使用できません (これはデフォルトでは有効になってはいません)。
最初に、まず、今どのくらいのスワップ領域があって、どれくらいスワップを使用しているのかを調べます。これには
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=swapctl&amp;sektion=8&amp;format=html">swapctl(8)</a>
a537 1
</p>
d540 1
a540 1
$ <strong>swapctl -l</strong>
d546 6
a551 4
これは、今、スワップに使用されているデバイスとその現在の統計を示しています。上記の
例では &quot;swap_device&quot; というデバイスがひとつしかありません。これはディスク上の事前に定義された
スワップ領域です (disklabel を見るときにはパーティション b として表示されます)。上記の例でもわかりますが、
このデバイスは現状ではあまり使用されてはいません。しかし、この文章では仮に、
d553 1
a553 1
</p>
d555 5
a559 4
ファイルをスワップデバイスとして誓瀋蠅垢訛莪貶發蓮△修離侫．ぅ襪鮑鄒成することです。これは 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dd&amp;sektion=1&amp;format=html">dd(1)</a>
ユーティリティで作誓垢襪里任睥匹い任靴腓Α０焚爾蓮腓架の <i>/var/swap</i> ファイルを作誓靴討い泙后
鹿霈
箋恐
甬恐
首闔臂齦粹蜀蒐粤鳫羹癇碵襲竢害袈玄闔臂
甬薫
鹿霈
箋軍
甬郡
首闔臂齦粹蓁閼旭鬲齬瘰鹿齡鳫鈑首闔臂齦粹鞦癇霄闔臂
箋係
甬傾
ここで、作誓気譴燭發里好錺奪廛妊丱ぅ垢琉賤膨媛辰気譴燭匹Δ鬟船Д奪靴泙靴腓Α
鹿霈
箋顕
甬顕
首闔臂齬瘰笏鹿齡鳫鈑箋弘
甬慌
これでファイルが誓瀋蠅気譴謄好錺奪廚圓錣譴討い襪里如守少續祚胝蘯ファイルに記入して、次の起動時にもこのファイルが使用されるようにします。
a593 1
</p>
d596 1
a596 1
$ <strong>cat /etc/fstab</strong>
d604 4
a607 4
これはスワップ領域を追加するさらに恒久的な解決方法です。ファイルを恒久的にスワップするには、まず vnd0c をスワップに
したカーネルを作誓靴泙后璽優襪箘を root ファイルシステムにしているなら、これまでのスワップは wd0b ですから、
カーネル誓瀋螢侫．ぅ襪念焚爾里茲Δ聞圓鮖藩僂靴泙疑問があれば、新しいカーネルのコンパイルを参照してくだ世気ぢ。 
</p>
d614 2
a615 1
これが終れば、スワップに使用するファイルを作誓靴覆韻譴个覆蠅泙擦鵝
甼蔚
鹿霈
箒厩
甼厩
首闔臂齦粹蜀蒐粤鳫羹癇碵襲竢害袈玄闔臂
箒俺
甼恩
さて、ファイルができたましたので、そのファイルを <i>/etc/fstab</i> に追加します。
このデバイスが起動時にスワップデバイスになるための一行は、以下のようになります。
</p>
d631 1
a631 1
$ <strong>cat /etc/fstab</strong>
d639 2
a640 2
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=vnconfig&amp;sektion=8&amp;format=html">vnconfig(8)</a> を使用します。
</p>
d643 1
a643 1
$ <strong>sudo vnconfig -c -v vnd0 /var/swap</strong>
a650 1
</p>
d653 2
a654 2
$ <strong>sudo swapctl -a /dev/vnd0c</strong>
$ <strong>swapctl -l</strong>
d675 1
d680 3
a682 1
が必要なのですが、これは将来的には改善される見込みです。<p>
d685 2
a686 2
<a href="http://www.mckusick.com/softdep/index.html">McKusick</a> の論席犬鮖仮箸靴討誓さい。
</p>
a689 1
</p>
d692 2
a693 2
<strong>option FFS_SOFTUPDATES</strong>
</p>
a704 1
</p>
d713 2
a714 2
Soft Update を使用することができないのです。しかし、sun4m マシンなら大丈夫です。
</p>
d719 2
a720 1
<h2>14.6 -  OpenBSD/i386 をインストールして起動すると "Using Drive: 0 Partition: 3" で止まるのですが  - i386 のみ</h2>
d726 1
a726 1
</p>
d734 1
a734 1
</p>
d740 1
a740 1
</p>
a744 1
</p>
d752 1
a752 1
</p>
d763 1
a763 1
</p>
d771 1
a771 1
</p>
d778 4
a781 5
ドライブなら 'sd0' というように) によって、
適当に変える必要があります。<b>注意: ディスクが丸ごと OpenBSD の
パーティションではない場合に、これを実行しては
いけません !</b>  MBR をこのように初期化してしまいますと、OpenBSD の
パーティションをディスク全体に広げて他のパーティションを
d783 1
a783 1
</p>
d792 1
a792 1
</p>
d797 1
a797 1
</p>
d809 1
a809 1
</p>
d812 1
a812 1
</p>
d821 1
a821 1
</p>
d826 1
a826 1
</p>
d832 4
a835 5
問題を避けるのはとても簡単です。普通にインストールしている
ときに OpenBSD のローダ世轡好謄爐縫ぅ鵐好函璽襪気譴襪里
д黼銓蜥粡鼡闥鞳鄲喞という質問に 'Y' と答えたとき
だ世韻任后と答えて OpenBSD のパーティションを手動で作誓
すれば、fdisk で 'reinit' か' 'update' をしない限りは、
d837 2
a838 2
ブートローダ世辰討い訃豺腓力辰任后ぢそうでなければ (新品や空の
ディスクの場合や、他のプラットフォームから持ってきたドライブのような場合)
d840 1
a840 1
</p>
d849 1
a849 1
</p>
d853 1
a853 1
</p>
d860 1
a860 1
</p>
d879 2
a880 1
</p>
a881 2
<br>

d890 7
a896 8
いくつかのインターフェースでは OpenBSD の理論静丙蚤臙佑茲蠅
小さな限界があります。
IDE ドライブでは、限界は 128GB で、これは現在一般的な ATA インターフェース
の限界となっています。128GB (1G=2^30 で、
1,000,000,000 ではありませんので、ドライブ誓渋ざ伴圓呂靴个靴碍蚤ぢと呼称しています)
より大きな容量を持つ次誓ぢ紊堊ぢドライブは、OpenBSD 3.1 およびそれ以前の
バージョンではサポートされていないことに注意してくだ世気ぁ
鹿霈
筝晃
畍晃
不幸にも、OS がメモリにロードされるまでは
OS のすべての能力は使用できませんので、
d905 2
a906 3
それ自身の内部的な
古い BIOS の限界から来る 8GB の限界が存在しています。
</p> 
d914 1
a914 1
</p>
d920 1
a920 1
</p>
d936 1
a936 1
</p>
d940 1
a940 1
</p>
d944 1
a944 1
</p>
d948 1
a948 1
</p>
d958 1
a958 2
IDE BIOS (その他 PC BIOS の一部) は、
真のディスクジオメトリを MS-DOS が扱える
d961 2
a962 3
もし、BIOS を変えて (マザーボードを交換したとか、
SCSI コントローラを交換したとか)、そして新しい方が使用している
「翻訳」ディスクジオメトリが異なっていたら、
d966 3
a968 3
IDE ディスクを使用していて BIOS 誓瀋蠅鯤儿垢靴疹豺腓砲癲
翻訳を (うっかり) 変更してしまう場合があります (ほとんどの IDE BIOS は翻訳の仕方を
3 通り持っています)。ブートブロックを直して普通にブートできるようにするためには、
d970 7
a976 8
boot プロンプトで
「b hd0a:/bsd」とタイプして、最初のハードディスク (フロッピーでは
なく) から起動してくだ世気ぁ海譴派當未縫泪轡鵑阿垢襪呂困任后修Δ靴燭蕁
第一段階ブートローダ世鮃洪靴靴董⊃靴靴ぅ献瓮肇蠅┐襪茲Δ砲靴討誓さい
(そしてそれに応じたブートブロックに書き換えてくだ世気ぢ。
<br>
ここでの例では、あなたの起動ディスクが sd0 だ世帆枋蠅靴討い泙もし IDE なら wd0 等々..)。
</p>
d979 1
a979 1
# <strong>cd /usr/mdec; ./installboot /boot biosboot sd0</strong>
d989 1
a989 1
</p>
d991 1
a991 1
#<strong> cd /usr/mdec; ./installboot -h &lt;heads&gt; -s &lt;secs&gt; /boot biosboot sd0</strong>
d995 2
a996 2
もし、ブートブロックのバージョン更新が必要なら、それは自分でコンパイルするしかありませんが、その方法は簡単です。
</p>
d999 4
a1002 4
# <strong>cd /sys/arch/i386/stand/</strong>
# <strong>make &amp;&amp; make install </strong>
# <strong>cd /usr/mdec; cp ./boot /boot</strong>
# <strong>./installboot /boot biosboot sd0</strong> (ディスクのデバイスは自分のにあわせて変更してくだ世気箟葦憶
甕鯵碓
たとえば、もし業務用サーバを走らせようとしているのでしたら、固定ディスクのどれかがクラッシュした場合のために、何らかのバックアップは取っておくようにしてくだ世気ぁ
鹿霈

腫ここにある情報は、OpenBSD 附属の通常の <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dump&amp;sektion=8&amp;format=html">dump(8)</a>/<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=restore&amp;sektion=8&amp;format=html">restore(8)</a> ユーティリティの使い方を誓睫誓しています。複数のサーバを一本のテープドライブでバックアップするために、より高度な「Amanda」というソフトもあります。普通の環境では <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dump&amp;sektion=8&amp;format=html">dump(8)</a>/<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=restore&amp;sektion=8&amp;format=html">restore(8)</a> で十分でしょうが、複数のマシンを一台のテープにバックアップしたい場合には、Amanda を検討してみてくだ世気ぁ
鹿霈

腫この文書のデバイス例は、SCSI ディスクとテープを使うような構誓離轡好謄爐鯀枋蠅靴討い泙后６般獲儡超任蓮堽疋屮蹈奪僚萢諒，蕁苗よりも SCSI が推奨されています。しかし、IDE や別種のテープドライブを使用している人にこの情報が役に立たないわけではありません。デバイス名を読み換えることで話は同じになります。たとえば、SCSI の sd0a は IDE のシステムなら wd0a になります。
</p>
d1037 4
a1040 2
テープへのバックアップは、ファイルシステムがどこにマウントされているかという知識が必須になります。ファイルシステムがどうマウントされているのかについては、シェルプロンプトから <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mount&amp;sektion=8">mount(8)</a> コマンドを使用します。これによって、たとえば、以下のような出力が得世蕕譴襪呂困任后
鹿霈
箟梓甕圧この例では、root (/) ファイルシステムは物理的には sd0a 上にあります。これは SCSI 固定ディスク 0 のパーティション a です。/usr ファイルシステムは sd0h 上で、これは SCSI 固定ディスク 0 のパーティション h になります。
</p>
a1054 1
</p>
d1065 3
a1067 2
この、さらに高度な例では、root (/) ファイルシステムは物理的には sd0a 上にあります。/var ファイルシステムは sd0d、/home ファイルシステムは sd0e で、/usr は sd0h にあります。
</p>
d1070 3
a1072 2
マシンのバックアップには、それぞれの固定ディスクパーティション名を dump に指定する必要があります。さきほどの簡単な方のマウントテーブルをバックアップするコマンドは次のようになります。
</p>
d1081 2
a1082 2
さらに複雑な方のマウントテーブルの例なら次のようになります。
</p>
d1093 4
a1096 2
それぞれのコマンドラインのスイッチが何を意味するのかについては、<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dump&amp;sektion=8&amp;format=html">dump(8)</a> man ページを見るのが最も良いでしょう。上記の例で使用したパラメータの概要を以下に誓睫誓します。
</p>
a1106 1
</p>
d1109 4
a1112 2
最後に <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mt&amp;sektion=1">mt(1)</a> コマンドを使用して、ドライブを巻き戻しています。他のオプション (たとえば eject) については、mt の man ページを参照してくだ世気ぁ
鹿霈
箟臼甕臼テープデバイス名がよくわからない場合には、dmesg を使用して調べます。たとえば、dmesg を使った例は次のようになります。
</p>
d1123 10
a1132 2
バックアップをする場合に、デバイス名が dmesg に出てくる「st0」ではなく「nrst0」になっているのにお気付きでしょうか ?  st0 に nrst0 としてアクセスした場合は、同じ物理デバイスにアクセスしていることには違いないのですが、ジョブの終了後に巻き戻さないことと、デバイスを raw mode でアクセスすることが異なります。複数のファイルシステムを一本のテープにバックアップするには、必ず巻き戻さないデバイスを使用してくだ世気ぁ發郡瓩好妊丱ぅ鴦を使用した場合には、バックアップごとにテープが巻き戻されて、前のファイルシステムが上書きされてしまいます。各種テープドライブについてのより詳しい誓睫誓は dump の man ページを参照してくだ世気ぁ
鹿霈
箟嘘甕嘘以下は、"backup" を簡単なスクリプトにした例です。
</p>
d1152 17
a1168 10
もし、毎晩定期的にバックアップしたい場合には、<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=cron&amp;sektion=8&amp;format=html">cron(8)</a> を使用して自動的にバックアップ用スクリプトを起動させます。
</p>

<p>
あと、それぞれのファイルシステムがどのくらいのサイズになるかを (紙誓擇譴書いておくと役立ちます。それぞれのパーティションがどのくらいの容量を使用しているかを調べるには df -h を使用します。これを行っておくと、ドライブが壊れてパーティションテーブルを新しいドライブに再現するときに便利です。
</p>

<p>
データをリストアすることで、ファイルの断片化解消にもなります。ファイル全部を確実にバックアップするには、まず再起動してシングルユーザモードで起動することです。ファイルシステムは、バックアップするときにマウントしていなくても構いません。シングルユーザモードで起動したら、root (/) r/w をマウントするのは忘れないようにしてくだ世気ぁ修Δ靴覆い函▲誓ンプの日付を書き出そうとするときに dump は失敗します。シングルユーザモードで起動するには、boot&gt; プロンプトで bsd -s を入力してくだ世気ぁ
鹿霈
箟鰻甕鰻初めてファイルシステムをバックアップしたら、テープをちょっとテストしてみて、そこのデータが思い通りのところにあるか確認するようにしてくだ世気ぁ
鹿霈
箟鰻甕姥以下に dump テープ上のファイルのカタログを見る例を示します。
</p>
d1187 3
a1189 2
これで、dump テープの最初のパーティション上にあるファイルのリストが一覧表示されます。上記の例についてさらに述べるなら、1 というのは root (/) ファイルシステムのことです。
</p>
d1192 2
a1193 2
2番目のテープパーティションに何があるのかを見て、その出力をファイルに書き込むには次の例のようにしてくだ世気ぁ
鹿霈
箟屋甕屋さきほどの単純な方のようなマウントテーブルを持っている場合には、2 は /usr で、もし高度な方のマウントテーブルならば 2 は /var などの他のファイルシステムになります。また、シーケンス番号は、ファイルシステムがテープに書き出された順番と一致します。
</p>
d1209 12
a1220 2
以下に挙げた例題シナリオは、固定ディスクが完全に壊れた場合に便利です。テープからファイルをひとつだ世韻鯢気靴燭ぞ豺腓砲蓮鱚齡闥の man ページを参照して、対話型モードの指示をよく読んでくだ世気ぁ
鹿霈
箟臆甕臆もし、きちんと準備をしてあれば、ディスクを交換してテープからデータを復元するのはとても手早くできます。標準の OpenBSD インストール/起動フロッピーは、すでに必要な復元ユーティリティも附属していますし、パーティションを誓擇辰匿靴靴ぅ疋薀ぅ屬魑芦椎修砲垢襪燭瓩離丱ぅ淵蠅眛辰討い泙后曚箸鵑匹両豺隋△海離侫蹈奪圈爾蛤膿靴テープがあれば、それだ世韻妊轡好謄爐鯲督召擦泙后
鹿霈

腫壊れたディスクドライブを物理的に交換したら、データの復元の基本的なステップは以下の通りです。
</p>
d1229 3
a1231 1
まず、OpenBSD インストール/起動フロッピーから起動し、メニュー選択で Shell を選択します。そして、最新のバックアップテープを、書き込み禁止にした上でテープドライブに入れてくだ世気ぁ
甕桶鹿霈

箟桶甕桶釈鱚羹∵雕關緕碵筮闥膀竍薛砠遲轣隨竍蘓髟纈聹蜩襴瘢雹黼謾蜿扈研瘢雹癇竏初蓋共瘢雹肬鴉癆処譬丈粡鼡┯コマンドを使用して、新品のドライブにプライマリ OpenBSD パーティションを作誓靴泙后０焚爾卜磴鮗┐靴泙后
鹿霈
甕牡鹿霈
箟牡甕乙粡鼡赱矼コマンドを使用して、今、fdisk で作誓靴織廛薀ぅ泪鞳鄲喞ぢパーティションの中に、OpenBSD パーティションを作誓靴泙后修領磴魄焚爾房┐靴泙后
鹿霈
箟乙甕乙ぢスワップを忘れないようにしてくだ世気ぁ椶靴蓿繙就ｄ蜩謖痰繻⊂粡鼡赱矼徳兌を参照してくだ世気ぁ鹿霈
箟俺甕俺鈬コマンドで、上記ステップで作誓靴織僉璽謄轡腑鵑某靴靴ぅ侫．ぅ襯轡好謄爐鮑鄒成します。以下にその例を示します。
</p>
a1273 1
</p>
d1281 2
a1282 2
マウントされた root ファイルシステムに移動して、復元プロセスを開始します。以下に例を示します。
</p>
d1291 2
a1292 2
この新しいディスクを起動可能にする場合には、以下のコマンドでドライブに新しい MBR を書き込みます。以下に例を示します。
</p>
d1300 2
a1301 2
ドライブに新品の MBR を書くと同時に、起動できるようにブートブロックをインストールしなければなりません。以下に簡単な例を示します。
</p>
d1310 5
a1314 2
ハードディスクの新しい root ファイルシステムはこれで用意できましたので、そこから起動して他のファイルシステムのリストアを続けることができます。OS はまだ栖袷瓦任呂△蠅泙擦鵑里如坤轡鵐哀襯罅璽競癲璽匹乃阿垢襪茲Δ砲靴討誓さい。シェルのプロンプトで、以下のコマンドを使用してアンマウントしてシステムを停止さます。
</p>
d1323 2
a1324 2
インストール/起動フロッピーをドライブから抜いて、システムを再起動します。OpenBSD boot&gt; プロンプトで次のコマンドを入力します。
</p>
d1331 2
a1332 2
bsd -s で、カーネルをシングルユーザモードで起動します。これには root (/) ファイルシステムだ世韻廚箸覆蠅泙后
鹿霈
箟崖甕崖以上のステップをきちんと実行して、途中で何らかのトラブルがなければ、プロンプトが出力されて、シェルのパスを入力するかリターンを押すことが求められます。リターンを押した場合は、sh が使用可能になります。次に、root を読み出し誓賤僂任呂覆ぢモードでマウントし直すため、以下のコマンドを実行します。
</p>
d1347 2
a1348 2
r/w モードで再マウントしましたら、残りのファイルシステムの再現を続けてくだ世気ぁ０焚爾砲修領磴鮗┐靴泙后
鹿霈
箟涯甕涯ダ瀬鵐廛札奪箸乕気気譴襯屮献Д般召鬚修療堙抔燭ぞ豺腓砲蓮韻黽ぢとするのではなく "<b>restore rvsf</b>" を使用します。
</p>
d1366 4
a1369 2
最後に、他のファイルシステムを全部ディスクに回復し終えましたら、マルチユーザモードに移行します。すべてが意図した通りに進んでいたら、システムは最新のバックアップ時と同じ状態に戻っていて、また使用可能になっているはずです。
</p>
d1377 6
a1382 3
ディスクイメージ (ISO イメージ、dd で作ったディスクイメージなど) を OpenBSD で
マウントするには、<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=vnd&amp;sektion=4">vnd(4)</a> デバイスを誓瀋蠅垢詆廚△蠅泙后燭箸┐弌瓶イメージが <i>/tmp/ISO.image</i> にあるとしたら、マウントするには以下のようにしてくだ世気ぁ
鹿霈
箟蓋甕蓋首闔臂竢鈕蜃箘隴瓶弄蜊瘍綣闔臂
首闔臂迴箙橋纐箘銓鹿齡鳫鈑箟街甕街ポイントとしては、このイメージは CD イメージですので、マウントする場合にはその種類を <i>cd9660</i> で指定するということです。これはどのような種類のイメージでもそうなのですが、たとえばディスクイメージをマウントするのでしたら ffs を使用しなければなりません。
</p>
a1401 1
</p>
d1407 2
a1408 2
# <strong>umount /mnt</strong>
# <strong>vnconfig -u svnd0</strong>
d1416 2
a1417 2
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=vnconfig&amp;sektion=8">vnconfig(8)</a> man page を参照のこと。
</p>
a1428 1
</p>
d1436 1
a1436 3
が失敗した場合には、OpenBSD はエラーメッセージを出力して、もう一度
転送を試みます。
</p>
a1445 1
</p>
d1448 3
a1450 3
もし OpenBSD がうまくモードを下げられなかったり、途中でマシンが固まったり
するようでしたら、<a href="../../ja/report.html">バグの報告</a>を行ってくだ世気ぁ
鹿霈
箟軌箟輝甕輝殊蘊卅苗ぢはバックアップについては何もしない。</li>
<li>RAID 自身はダ瀬Ε鵐織ぅ爐鮹蚕未靴討譴襪錣韻任呂覆ぁ鹿跚箟輝箟飢箟飢甕飢殊蘊釈鱚羹∵雕鞣谺竝繖卅苗胙瘢絲⊂卅苗胙瘢ホームページ</a></li>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=raidctl&amp;sektion=8">raidctl(8) man ページ</a></li>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=raid&amp;sektion=4">raid(4) man ページ</a></li>
d1529 1
d1531 4
a1534 4
OpenBSD 3.1 では、RAIDframe の "Autoconfiguration" オプションを使用して、直誓闖パーティションをミラーリングすることが可能になりました。OpenBSD の以前のリリースでは、
この方法での root パーティションをミラーリングすることはできませんでした。
</p>
d1538 3
a1540 2
多くの OpenBSD の <a href="../../ja/plat.html">プラットフォーム</a> は、いろんな種類のハードウェア
RAID 誓宿覆鬟汽檗璽箸靴討い泙后海譴魯廛薀奪肇侫璽爐砲茲辰栃僂錣蠅泙垢里如▲蓮璽疋ΕД▲汽檗璽
箟鬼甕鬼鹿霈
箟鬼甕亀多くのプラットフォームで利用可能です。これらのデバイスは、SCSI や IDE を
サポートしているどんなハードウェアプラットフォームでも仮想的に動作できます。
</p>
d1553 3
a1555 3
<li><a href="http://www.arcoide.com/">Arco</a></li>
<li><a href="http://www.maxtronic.com/">Maxtronic</a></li>
<li><a href="http://www.infortrend.com/">Infortrend</a></li>
d1567 2
a1568 3
ではなく、むしろ、これは、
BIOS の助けを借りてブートするソフトウェア RAID だ世蕕覆覆里任后４鞳鄲喞ぢは、
ハードウェアに依存しない方法でソフトウェア RAID をサポートしているのですから、
d1571 1
a1571 1
</p>
d1577 1
a1577 1
</p>
d1585 1
a1585 1
Originally [OpenBSD: faq14.html,v 1.72 ]
d1587 1
a1587 1
$Translation: faq14.html,v 1.15 2002/12/13 16:00:25 toshi Exp $
d1591 1
a1591 1
</p>
@


1.14
log
@
sync with badlands translation CVS
@
text
@d1515 1
a1515 1
Originally [OpenBSD: faq14.html,v 1.71 ]
d1517 1
a1517 1
$Translation: faq14.html,v 1.14 2002/10/08 11:58:23 toshi Exp $
@


1.13
log
@
sync with badlands translation CVS
@
text
@d32 1
a32 1
"Using partition 3 id 0" で止まるんですけど</a></li>
d37 3
a39 2
<li><a href="#pciideErr"  >14.11 - 助けて!  PCIIDE でエラーになっちゃう!</a></li>
<li><a href="#RAID"       >14.12 - OpenBSD の RAID オプション</a></li>
d49 1
a49 1
<li><a href="#disklabel.1">disklabel とはなんぞや ?</a></li>
d56 1
a56 1
<h3>disklabel とはなんぞや ?</h3>
d59 1
a59 1
最初に
d61 1
a61 1
にあるマニュアルを読むこと。
d66 6
a71 6
効率よいインターフェースを提供するようにしようってことでこしらえたのだ澄
ラベルは、ドライブのジオメトリとか、ファイルシステム情報とか、
ディスク関係の情報を含んでいる。そしてこれがブートストラップ・プログラムに
使われて、ドライブをロードしたり、ドライブ上のどこにファイルシステムが
あるのかを調べたりすることになる。ラベルはまたファイルシステムといっしょに
使われて、効率よい環境をつくる。disklabel についてもっと
d73 1
a73 1
を読もう。
d77 2
a78 2
さらにおまけのメリットとして、disklabel を使うとディスクパーティションの
アーキテクチャ的な誓鵑鮠茲蟇曚┐蕕譴襦燭箸┐蓋では
d80 1
a80 1
パーティション) は 4 つまでしか持てない。
d82 3
a84 3
では、この「プライマリパーティション」を一つ使うだ世韻如緕帯ぢパーティション
を全部 (たとえば 'swap', '/', '/usr', '/var') をそこに納められる。
それでもほかの OS で使えるパーティションが 3 つも残っている !
d91 2
a92 2
OpenBSD インストールでの大きな山場のひとつが、ラベルを最初につくる
ところだ澄海譴薐原ぢユーザなら) <a href="#fdisk">fdisk(1)</a> の直後に出てくる。
d94 1
a94 1
つくる。インストール中に、
d96 3
a98 3
の中からマウントポイントを指定することもできるけれど、
これはどうしても必要というわけじゃない。あとでどうせプロンプトで、
これでいいか確認を求められるから。でも、やっといたほうがインストールがちょっとはスムーズになるかな。
d102 12
a113 12
インストール中なら、まだ瀬薀戰襪呂爾鵑爾鵑覆い呂困覆里如
どうしてもつくる必要がある。最初につくるラベルはラベル
'a' だ澄海離薀戰襪論絶対に / をマウントするところにしたほうがいい。作った方が
いいおすすめパーティションとそのサイズに
ついては、<a href="../faq4.html#SpaceNeeded">FAQ 4, 必要なスペース</a> を読もう。サーバの場合、
少なくともここに書いてあるラベルは別々にしておくのが望ましい。デスクトップの
ユーザなら、/ のマウントポイントだ世浦遒辰討韻仆淑誓ろう。最初に
root パーティション ('a' ラベル) をつくるとき、スワップラベル用に
多少の空きを残しておくのをお忘れなく。いまので基本は
誓睫誓したから、以下にインストール中に disklabel を使う例をあげよう。最初の
例では、このマシン上には OpenBSD しか
なくて、フルインストールをするものとする。
d150 7
a156 7
いまので、64M の root パーティションが / にマウントされて、64Meg スワップパーティションが作られている。オフセットが
セクター 63 から始まるのに注目。これでいいのだ澄汽ぅ困力辰砲覆襪函粡鼡赱矼は
セクター単位で表示を行うけれど、でも入力するときは別にセクターで入力しなくていい。上の例でもそうだ世韻譴鼻
守抄翰なら 64M</i> とか、<i>2GBなら 2G</i> とすればいい。すると Disklabel
はそれをいちばん近いシリンダ世亡櫃瓩討譴襦泙疹紊領磴任蓮粡鼡赱矼は「b」がスワップだ世伴暗
想定していることにも注目。これは誓気靴ち枋蠅如播療夘カーネルはラベル「b」にスワップを
探しにいくよう誓瀋蠅気譴討い襦誓からこのガイドラインにしたがって、スワップは 'b' にしておこう。
d160 3
a162 3
次の例では、もうふたつラベルをこしらえている。これはつまり、完全なインストールではない
ということだ澄海譴蕕離汽ぅ困蓮緕帯を完全にインストールするには不十分だ世蕁
パーティション全部をつくるのを見せても、繰り返しになるだ世韻誓。
d187 5
a191 5
上の例では、ふたつほど気がつく点世△襦泙此▲侫札奪箸暗
計算されて、次のところでデフォルトになって待っているということ。この手のインストールをするなら、オフセット変更を
ぐちゃぐちゃする必要はまったくない。別のちがいとしては、ラベル 'c' は
とばされている。これには理由があって、ラベル 'c' はディスク全体をあらわすラベルなのだ澄
だ世薀薀戰礑ぢはまったくいじってはけない。
d195 2
a196 2
ラベルが全部できたら、あとはそれをディスクに書き込んでインストールを
誓茲某覆瓩譴个いぁＡ管颪い蜩謖痰繻ぢを終了するには (そしてインストールを続けるには)、
d205 3
a207 3
<strong>*注*</strong> - でかいドライブを持っている人へ。もしあなたの bios がそのサイズのドライブをサポートできなければ、
OpenBSD でもサポートは無理だ澄修Δ任覆韻譴弌緕帯は問題なくディスクを扱えるはず。もし bios がサポート
していないドライブに直面したら、Maxtor EZ-Drive みたいなオーバーレイ誓宿覆鮖遒靴討澆襪箸いぁ
箍欝
甓鰻
いったんシステムのインストールが終わったら、もうあまり disklabel を使うこともないだ世蹐Α任皀妊好鯆媛叩
削除、再構誓垢襪箸覆鵑蜩謖痰繻ぢを使う場合が出てくる。まず最初に
やるべきことは、現状の disklabel を見ることだ澄海譴砲楼焚爾里茲Δ砲垢襦
箍飢
甓鬼
上のコマンドは、単にすでにある disklabel を見せてくれて、ヘタにいじって壊したりすんなよ、
と念を入れてくれているわけだわれわれみんな、たまには忠告もきかないとね)。でももし変更を加えたいなら、
disklabel で -E オプションを使わないといけない。
d262 3
a264 3
これでプロンプトが出てくる。OpenBSD インストール時にお目にかかったのと同じものだ澄海離廛蹈鵐廛箸
なによりだ世い犬淵灰泪鵐匹色ぢだ澄海譴蜩謖痰繻ぢで使える可能なオプション一覧を
表示してくれる。
d266 2
a267 2
man ページ全部を見るには、 'M' コマンドを使う。このプロンプトから、パーティションの追加、削除、
変更すべてを行う。もっと詳しくは 
d269 1
a269 1
man ページを読もう。
d277 1
a277 1
まず、必ず fdisk の man ページを見よう。
d281 6
a286 6
Fdisk は、パーティションのメンテナンスを助けてくれるソフトだ澄海
プログラムはインストール時に使われて、OpenBSD パーティションの誓瀋蠅鬚垢この
パーティションの中に複数のラベルがのって、それぞれがファイルシステムやスワップなんかになる)。
ドライブのスペースを区誓擇辰董譴弔鬟▲謄屬砲任襦廛蹈哀薀爐
通常、シングルユーザモードで使われる (つまり boot -s)。Fdisk はまた各種ハードディスクの MBR も
誓瀋蠅垢襦
箍弘
甓恒
インストールするには、ほとんどの場合は OpenBSD パーティションが <b>ひとつ</b>あれば
いい。それをさらに区誓擇辰謄好錺奪廚筌侫．ぅ襯轡好謄爐鬚弔襪砲蜩謖痰繻ぢを使う。
d295 1
a295 1
fdisk でパーティションテーブルを見るだ世韻覆蕁△海Δ靴茲Α
箜葦
甞葦
するとこんな感じの出力が出る。
d317 3
a319 3
この例では、フロッピードライブの fdisk 出力を見ている。OpenBSD パーティション (A6) と
そのサイズも見られる。* がついているので、起動パーティションが
OpenBSD パーティションだ世箸錣襦
箜桶
甞乙
前の例では、情報を見ただ世韻誓。パーティションテーブルを
編集したい場合は ?　うん、そのときには <b>-e</b> フラグを使う。
するとコマンドラインプロンプトが出てきて、fdisk を操作できる。
d350 2
a351 2
fdisk に入っていろいろ試すのは、まったく危険はない。ただ世掘∧儿垢鯤歛犬垢襪匹Δ譴燭
誓簑个齡鳫鈑称鹿齡鳫鈑と答えて、<strong>write</strong> コマンドは使わないこと。
d354 2
a355 2
<p><b>-e</b> フラグで使えるコマンド一覧を
以下に挙げる。</p>
d357 12
a368 12
<li><strong>help</strong>    対話型編集モードで fdisk のわかるコマンド一覧を表示。</li>
<li><strong>reinit</strong>  いま選ばれてメモリに入っているブートブロックのコピーを初期化。</li>
<li><strong>disk</strong>    fdisk がプローブした現在のドライブジオメトリを表示。お望みなら編集もできる。</li>
<li><strong>setpid</strong>  パーティションテーブルの指定エントリのパーティション ID を変更する。このコマンドは、既存のパーティションを OpenBSD に再割り当てしたりする場合には特に便利。</li>
<li><strong>edit</strong>    現在のブートブロックのメモリ内コピーの、指定テーブルエントリを編集。BIOS ジオメトリモードで編集してもいいし、セクターオフセットやサイズで編集してもいい。</li>
<li><strong>flag</strong>    パーティションテーブルの指定エントリを起動可能にする。起動可能にできるエントリはひとつだ世韻誓。
もし、拡張パーティションから起動したいなら、その拡張パーティションのエントリを起動可能にしておく。</li>
<li><strong>update</strong>  現在のブートブロックのメモリ内コピーの機械コードを更新。</li>
<li><strong>select</strong>  現在のブートブロックにある、拡張パーティションテーブルエントリで示されたブートブロックを、メモリに読み込む。</li>
<li><strong>print</strong>   現在選択されている、メモリ内のブートブロックのコピーとその MBR テーブルをターミナルに表示。</li>
<li><strong>write</strong>   現在メモリ内にあるブートブロックのコピーをディスクに書き出す。本気かどうか、操作の確認が出てくる。</li>
<li><strong>exit</strong>    現在の fdisk のレベルを終了し、前に選んだ瀬瓮皀蠧發離屐璽肇屮蹈奪離灰圈爾北瓩襪△修譴覆韻譴丱廛蹈哀薀爐鮟察鹿跚箜薫
甞訓
それがなければプログラムを終了。exit とちがうのは、変更したブロックはディスクに書き出されるということ。</li>
<li><strong>abort</strong>   現在の変更を保存しないでプログラムを終了。</li>
d379 1
a379 1
うん、ディスクさえ<strong>きちんと</strong>インストールされたら、あとは
d384 1
a384 1
disklabel(8)</a> を使って
d386 1
a386 1
誓瀋蠅垢襪誓けだ澄
箜幻
甞幻
薐原ぢの人たちは、fdisk からはじめよう。ほかのアーキテクチャの人は、ここはとばしていいよ。
d393 2
a394 2
OpenBSD 誓賤僂吠僂┐襦
続いてここに disklabel をつくろう。これはちょっとややこしい。
d398 1
a398 1
<i>(画面が消えて、$EDITOR で指定のエディタがたちあがる)</i>
d410 2
a411 2
まず、'c' パーティションは無視ね。必ずあって、
disklabel みたいなプログラムが機能するために必要なものだ世
箚嘘
甦厩
竦は誓簑个だ澄二鞳ぢは 4.2BSD。Total sectors は、
ディスクの総容量。
たとえばこれが 3 GB のディスクだ世箸靴茲Α妊好瓠璽慮誓い方では、3 GB は
3000 MB だ澄修海姥軌幻旭のわり算をしよう
(<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=bc&amp;sektion=1">bc(1))</a> を使うのよ。答は 2061 だ澄
そこで a, d, e, f, g, ... のパーティションサイズを計算するには、それぞれ X MB の容量がほしければ単に X*2061
のかけ算をしてやればいい。最初の新しいパーティションのオフセットは、
d421 1
a421 1
同じ。ここでは 63 やね。その後の各パーティションのオフセットは、
d423 2
a424 2
オフセットを組み合わせたものになる (ただ世礑ぢパーティションだ世韻蓮△い泙亮阿
あてはまるところもないし、無視ね)。
d426 4
a429 4
あるいは、ディスク上にパーティションひとつだ世韻靴い蕕覆い海箸發△襦燭箸┐
ディスク全体を Web 保存に使うとか、ホームディレクトリにしたいとかなんとか。
この場合には、ディスクの総容量から、トラックあたりのセクター数をひいてやればいい。
6185088-63 = 6185025 だ世蕁△△覆燭離僉璽謄轡腑鵑麓，里茲Δ砲覆襦
箚慨甦感錫ぢこれがなんだ世詰僂砲笋笋海靴い隼廚辰燭蕁韻蜩謖痰繻を使えば、
インストール時と同じパーティション誓擇螢癲璽匹貌譴襪鹿眈
そこでなら、96 メガバイトと言世い燭韻譴攻輸ぢと指定すればいい (ディスクがでかければ、
96G で 96 ギガバイトっちゅーこってすな !) 残念なことに、
-E モードは本当のディスクジオメトリではなく、BIOS ディスクジオメトリを使っていて、
この両者は必ずしも一致しない。この誓鵑魏麋鬚垢襪砲蓮
х繽辣粡鼡ぢの略で 'g d' とタイプしよう (その他のオプションとしては、'geometry bios' なら 'g b' で、
'g u' とやれば geometry user、つまり disklabel が変更前に
どういう内容になっていたかを表示する)
<p>
結構山誓垢蠅誓ったね。でもまだ析辰禄錣辰舛磴い覆ぁ
最後に、そのディスク上にファイルシステムをつくんなきゃいけない。<a href=
"http://www.openbsd.org/cgi-bin/man.cgi?query=newfs&amp;apropos=0&amp;sektion=8&amp;format=html">newfs(8)</a> を使おう。
d454 2
a455 2
wd1a のところは、OpenBSD のディスク番号方式であなたのディスクの番号に該当するものに置き換えよう
(OpenBSD のディスク名称を見たければ <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dmesg&sektion=8">dmesg(8)</a> の出力を見よう)。
d459 2
a460 2
さて、作りたてのこのパーティションをどこにマウントするか考えよう。たとえば /u にマウントしたかったとする。
まず、/u ディレクトリをつくる。それからそれをマウントする。
d468 1
a468 1
最後にそれを <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=fstab&amp;sektion=5">/etc/fstab(5)</a> に追加。
d473 4
a476 4
もし /usr/local とか既存のディレクトリを引っ越しさせたかったら ?  新しいドライブを
/mnt にマウントして、cpio -pdum を使って /usr/local を /mnt ディレクトリにコピーしよう。
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=fstab&amp;sektion=5">/etc/fstab(5)</a> ファイルを編集して、/usr/local パーティションがいまでは /dev/wd1a
(いまさっき新規にフォーマットしたパーティション) になるように変更する。
d485 3
a487 3
<strong>boot -s</strong> で、シングルユーザモードで起動しよう。既存の
/usr/local を /usr/local-backup に移動する (か、ツキが向いてる気分なら削除しちゃおうか)。そして
空のディレクトリ /usr/local をつくる。それからシステムを再起動してみますと、あらふしぎ !  ファイルが /usr/local に !
d497 6
a502 6
(注: もし
&quot;virtual memory exhausted&quot; エラーがたくさん出ているのでスワップをしようとしているなら、
まずはプロセスごとのリミットを上げてみよう。
csh なら <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=unlimit&amp;sektion=1&amp;format=html">unlimit(1)</a>
だ世掘
鼈ぢなら <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ulimit&amp;sektion=1&amp;format=html">ulimit(1)</a> だ澄箋斡
甬扱
ファイルへのスワップは、カスタムのカーネルは必要ないけれど、ビルドしなおすこともできる。
この FAQ では、どちらの方法でもスワップスペースを追加する方法を示す。
d513 3
a515 3
追加のスワップ領域を誓瀋蠅垢襪里法△い舛个鶸蔽韻任垢个笋な，蓮▲侫．ぅ襪悗離好錺奪廚鬚垢襪海箸誓。これは 
Soft Updates が有効になっているファイルシステム上では使えない (これはデフォルトでは有効になっていない)。
手始めに、まずいまどのくらいスワップ領域があって、どれくらいスワップを使っているかを調べよう。これには
d517 1
a517 1
ユーティリティを使う。こんな具合だ澄
箋卸
甬咳
これは、いまスワップに使われているデバイスとその現在の統計を示す。上の
例では &quot;swap_device&quot; というデバイスひとつしかない。これはディスク上の事前に定義された
スワップ領域だ粡鼡赱矼を見るときにはパーティション b として表示される)。上の例でもわかるけれど、
このデバイスは目下、あんまし使われていない。でもこの文章では、
仮にもう 32M が必要だ世箸いΔ海箸砲靴茲Α
箋慨
甬慨
ファイルをスワップデバイスとして誓瀋蠅垢訛莪貶發蓮△修離侫．ぅ襪鬚弔襪海箸誓。これは 
d536 1
a536 1
ユーティリティでやるのがいちばんいい。以下に大きさ 32M の <i>/var/swap</i> ファイルをつくってやろう。
d547 2
a548 2
これができたら、そのデバイスへのスワップを有効にしよう。以下のコマンドを使って、
このデバイスへのスワップを有効にする。
d557 1
a557 1
じゃあ、いまのがスワップデバイスの一覧にちゃんと追加されたかチェックしよう。
d570 2
a571 2
ファイルに記入して、次の起動時にもこのファイルが使われるようにしよう。この一行がないと、
スワップデバイスが誓瀋蠅気譴覆い茵
箋験
甬元
これはスワップ領域を追加するもっと恒久的な解決方法だ澄侫．ぅ襪鮃欝彭縫好錺奪廚垢襪砲蓮△泙鈔違ぢを
スワップにしたカーネルをつくる。カーネルが wd0a を root ファイルシステムにしてあったら、これまでのスワップは
wd0b だ世蕁▲璽優訐設定ファイルでこんな行を使おう (わかんなければ、新しいカーネルのコンパイルを参照)。 
d593 2
a594 2
これが終わったら、スワップに使うファイルを作らなきゃいけない。これは、
上の例と同じコマンドを使えばいい。
d605 2
a606 2
さてファイルができたので、そのファイルを <i>/etc/fstab</i> に追加しよう。このデバイスが
起動時にスワップデバイスになるための一行はこんな感じだ澄
箒蔚
甼姥
この時点世妊灰鵐團紂璽燭鮑撞阿気擦董▲璽優襪諒儿垢娠任気譴襪茲Δ砲靴茲Α海譴
やったら、デバイスをスワップとして誓瀋蠅垢襪海箸砲覆襦海譴砲
釈鱚羹∵雕關緕碵筮闥膀竍薛砠遲轣隨竍蘓髟纈竢鈕蜃逅雌繼闔集逅紙闥轣蔗迪⊂竢鈕蜃┯を使う。
d627 3
a629 3
さて最後の一歩。そのデバイスでスワップを有効にする。これは、上の例とまったく
同じように swapctl(8) を使ってやろう。それから、それがスワップの一覧にきちんと追加されたか
確認してやる。
d650 5
a654 5
開発を進めている。これは Greg Ganger と Yale
Patt が提案したアイデアに基づくもので、バッファキャッシュ操作を
部分的に誓依靴討笋襪函篤ぢコードからディレクトリのエントリを同期書き込みしなきゃいけないという
要件をはずせるじゃないか、というのが考え方だ澄修Δ覆襪函▲妊好颪濱性能は
かなり上がる。
d656 2
a657 2
Soft Update はまだ世泙誓開発中だ世蕁
コンピュータがきちんと shutdown せずに突然落ちたときにはやっぱり
d659 2
a660 2
が必要なんだ世韻鼻⊂茲浪韻気譴襪呂困誓。<p>
もっと詳しく Soft Update の中身を知りたいんだ世辰燭蕁
箒恐
甼恐
釈鱚羹∵雕辜謨皷站闕閹辮鈔纔譬祥稻蜒觴にある論席犬鯑匹鵑任譟
箒群
甼群
をつけてカーネルをコンパイルしないといけないが、これは既に GENERIC に入っている。
d675 1
a675 1
Soft Update を有効にするにはマウント時のオプションで行う必要がある。
d678 1
a678 1
Soft Update を有効にしたいということを指定することができる。
d682 1
a682 1
エントリである。
d690 3
a692 3
sparc ユーザへの注意: sun4 や sun4c のマシンでは Soft Update は有効にしないこと。
こいつらはごく限られた量のカーネルメモリーしかサポートしてないので、Soft Update
は使えない。でも、sun4m マシンだ世辰燭藺臂翩廖
箒晃
甼晃
取仮唄緕帯眺薐原ぢをインストールして起動すると "Using Drive: 0 Partition: 3" で止まるんですけど  - i386 のみ</h2>
d701 3
a703 3
これ自体は実はエラーメッセージじゃなくって、MBR に入ってるブートローダ世
どのドライブのどのパーティションから起動しようとしているかってことなんだ澄
問題なのは、起動がここで止まってしまったってことだ澄
箏斡
畄扱
こういうことが起こるときのよくある理由がふたつある。BIOS と
OpenBSD の MBR の非互換誓△弔泙螢疋薀ぅ屬離献瓮肇蠅量簑蠅誓。
d709 1
a709 1
も報告されているけれど、例えば、ドライブをコンピュータから別のコンピュータ
d711 1
a711 1
起きる。
d715 3
a717 3
システムで仮想的に解決されているはずだ澄靴靴覆蕁▲疋薀ぅ屮献瓮肇蠅
問題はまだ逝減澆憩誓るので、このメッセージが表示された後で、システムがハング
アップする危険誓呂泙誓残っている。
d721 2
a722 2
ものにしないといけない。幸い、ブートローダ世
簡単に手に入る。
d727 4
a730 4
まずシステムを起動しないといけない。ハードディスクから直誓楜阿任覆
ときには、ブートフロッピーか CD-ROM で起動する必要がある。
'boot&gt;' プロンプトが出たら、ハードディスクからの起動に
誓擺垢┐襦
箏官
畄官
からの起動に誓擇蟯垢錣辰董▲轡好謄爐阿垢襪茲Δ砲覆襦
箏患
畄患
ある。ファイルは CD-ROM か ftp サイトの 
d747 1
a747 1
にあるので、以下のような
d749 1
a749 1
コマンドでインストールできる。:
d755 17
a771 17
3.0 の CD を /mnt にマウントしてあって、IDE ドライブを使っているときは
こんな感じだ澄啄阡蜴ぢの場所やどんなハードディスクを使っているか(SCSI
ドライブだ世辰燭黻挨というように)によって、
適当に変える必要がある。<b>注意: ディスクが丸ごと OpenBSD の
パーティションじゃないときは、これはやっちゃ
いけない !</b>  MBR をこんなふうに初期化してしまうと OpenBSD の
パーティションをディスク全体に広げて他のパーティションを全部消してしまう
ので、大変なことになる。
</p>
<p>
BootEasy には他にも機能があるので、ブートローダ世北簑蠅覆討
使ってみたくなるかもしれない。起動時にブートパーティション
を選ぶことができる -- どのパーティションから起動するのか聞いてきて、
何も選ばなければアクティブパーティションから起動する。
ひとつのディスクに複数の OS を入れてるんだ世辰燭蕁△海譴枠鷯錣吠慷誓。
BootEasy をこういうふうにインストールするには、MS-DOS から CD-ROM か
FTP サーバーの BootEasy のディレクトリにある BOOTINST.EXE を実行すればよい。
d775 2
a776 2
FDISK.EXE の入った Windows 9x か v6 の起動ディスクから起動する。
システムが起動して MS-DOS のプロンプトが出たら、次のように打つ。
d782 7
a788 7
メッセージは何も出ずに少しだ世吋妊好縫▲札垢△辰討薀灰泪鵐
プロンプトに戻ってくる。"Bad command or file name" と出たら、
FDISK.EXE がディスクにないってことだ澄Δ泙い辰燭
皷鈑というメッセージを出していた部分が置き換えられるので、
メッセージは出なくなる。BIOS 互換誓量簑蠅△辰燭鵑誓ったら、
もうなくなったから、再起動すれば、OpenBSD のインスールは
うまくいくはずだ澄
箏恒
畄恒
汝繞掴でもうまくいくという報告がある。
d796 2
a797 2
別のブートローダ世哭帯ぢは OpenBSD の CD-ROM に入っているし、
FTP サイトの 2.9/tools/osbs135.exe にもある。OS-BS のウェブページは、
d800 1
a800 1
だ澄
筝梓
畍梓
也銛の LILO も使える。詳細は以下のところにある。
d810 3
a812 3
ほとんどのマシンは BIOS の互換誓量簑蠅呂覆い韻鼻△發
この問題があるとわかっているマシンの誓瀋蠅鬚垢襪鵑誓ったら
問題を避けるのはとても簡単だ澄Ｉ當未縫ぅ鵐好函璽襪靴討い
筝欝
畍屋
だ世韻誓。'N' と答えて OpenBSD のパーティションを手動で作誓
すれば、fdisk で 'reinit' か' 'update' をしない限り
ブートローダ世話屬垢┐蕕譴覆ぁ發舛蹐鵝△覆鵑蕕離屐璽肇蹇璽誓
が入っているときの話だ澄ぢそうでないなら (新品か空のディスクや他の
プラットホームからとってきたドライブのとき) システムが起動する
前に入れておかないといけない。
d825 5
a829 5
理想を言世┐弌▲疋薀ぅ屬離献瓮肇蠅鯆召気困
同じジオメトリのままにして問題を避けたいと思うだ世蹐Δ韻鼻
避けられないときもある。例えば LBA をサポートしていない
古いコンピュータからどうしても LBA を使う新しいマシンへ
大容量のドライブを移すようなときだ澄
筝害
畍崖
上にあるように、ブートディスクか CD-ROM で起動しよう。
root でログインして、以下のコマンドを実行する。
d840 1
a840 1
再起動すれば、うまくいくはずだ澄
筝憾
畍憾
をインストールして誓瀋蠅垢襦
筝軌
畍軌
はカーネルを RAM へロードするモジュールだ澄
筝騎
畍騎
の物理的な場所 (システムの BIOS による) を指し示すテーブルを持っている。BIOS が感知する
d855 1
a855 1
の場所を変更するような何かをやったときには、上にあるように
d859 1
a859 1
を指しているテーブルを再初期化してやらないといけない。
d861 1
a861 1
詳しくは <a href="#InstBoot">Install Boot</a> を参照。
d870 4
a873 4
OpenBSD は現在や近い将来入手できるどんなハードディスクよりも
ずっと大きなサイズのファイルシステムをサポートしているけれども、
いくつかのインターフェースでは OpenBSD の理論静丙蚤臙佑茲蠅眈気
限界がある。
d875 4
a878 4
の限界だ澄渦固映讐浤で、
1,000,000,000 じゃないので、ドライブ誓渋ざ伴圓
しばしば 137G といっている) より大きな容量を持つ次誓ぢ紊堊ぢドライブは、
OpenBSD 3.1 およびそれ以前のバージョンではサポートされていないことに注意。
d881 4
a884 4
不幸にも、OS がメモリーにロードされるまでは
OS の全部の能力は使えないので、
起動のプロセスそれ自体に限界がある。
起動プロセスはシステムのブート ROM を使う (そしてだ世蕕海修修譴棒制限される)。
d890 1
a890 1
古い BIOS の限界から来ている 8G の限界がある。
d893 6
a898 6
こういったわけで、/bsd ファイル (カーネル) 全体がブート
ROM で使える領域内か、ディスクの誓萋以内のどちらか小さい方に
置かれないといけない。これは、いくつかのずっと古い i386 システムでは
root パーティションは完全に誓萋梓以内になければいけないが、
ほとんどの新しいコンピュータでは root パーティションは誓萋
固ぢ以内のどこかにあればいい、という意味だ澄
箙葦
畊梓
古い 486 に 40G のドライブを入れてひとつの巨大なパーティションとして
OpenBSD をロードすることはできることに注意。うまく上にあった
規則を破ることができたと思うかもしれない。しかしながら、その規則は
もっとも嫌な具合につきまとってくるかもしれない。
d907 7
a913 7
  <li>40G の / パーティションにインストールする。うまく動く、なぜなら
OS と全てのファイル (/bsd を含む) は誓萋梓以内にあるから。
  <li>システムを使っていて、504M 以上のファイルがあるようになる。
  <li>アップグレードして自分のカーネルを作誓掘△覆匹鬚掘⊃靴靴
黻ぢを古いものに上書きコピーする。
  <li>再起動する。
  <li>"bad magic" というようなメッセージが出る。
d916 1
a916 1
どうして ?  なぜなら新しい /bsd ファイルを「上書き」コピーしたとき、
d918 3
a920 3
504M の範囲の外にあるであろう新しい領域に再配置されてしまったからだ澄
ブートローダ世碵ファイルをとってこれなくて、
システムはハングする。
d924 1
a924 1
範囲内になければいけない。安全にやるには、規則は単純だ澄
箙卸
畊恩
錫条闖パーティション全体はコンピュータの BIOS (もしくはブート ROM) で使える
領域内か、ディスクの誓萋以内のどちらか小さい方に置かれないといけない。</b>
d932 1
a932 1
ハードディスクのパーティションを分割する</a>ことに対するもうひとつの良い理由となっている。
d941 2
a942 2
していない。最近のディスクはほとんどすべて 1024 シリンダ整幣
あるので、ほとんどの SCSI BIOS チップ (SCSI コントローラボード上にある) と
d945 6
a950 6
ようなものに「翻訳」するオプション (ときにはこれがデフォルト) がある。
でも、BIOS チップの「翻訳」のしかたは必ずしも一致しない。
もし BIOS を変えて (マザーボードを換えたとか、
SCSI コントローラを換えたとか)、そして新しいやつの使う
「翻訳」ディスクジオメトリがちがったら、
第二段階ブートローダ世匹濆瓩覆つまりカーネルも読み込めない)。
d952 4
a955 4
持っているんだ世韻譴鼻△海譴柄阿痢嵋殘廛献瓮肇蠅乃劼気譴討い襪蕕誓)。
IDE ディスクを使っていて BIOS 誓瀋蠅鯤僂┐燭箸砲癲
翻訳を (うっかり) 変えてしまう場合がある (ほとんどの IDE BIOS は翻訳の仕方を 3 通り
持っている)。ブートブロックをなおしてふつうにブートできるようにするには、
d959 3
a961 3
なく) から起動させよう。これでふつうにマシンが起動するはずだ澄修Δ靴燭蕁
第一段階ブートローダ世鮃洪靴靴董⊃靴靴ぅ献瓮肇蠅┐襪茲Δ砲靴茲
ぢそしてそれに応じたブートブロックに書き換えよう)。
d963 1
a963 1
ここでの例では、あなたの起動ディスクが sd0 だ世帆枋蠅靴討いもし IDE なら wd0 等々..)。
d971 1
a971 1
もし installboot が、BIOS のジオメトリが読めないよとブーたれるようなら、
d973 1
a973 1
&quot;ma di&quot;) コマンドを入れて、必要な情報を表示させよう。
d975 2
a976 2
と -s フラグに食わせてやるのだ澄海ΔいΨ舛琶儿垢靴銖跛硼阡ぢコマンドは
こんな具合になる。
d983 1
a983 1
もしブートブロックのバージョン更新が必要なら、それは自分でコンパイルするしかない。やりかたは簡単だ澄
箙弘
畊弘
首闔臂蜴齡瘡赳闖闖砠闢硼阡箘鹿齡鳫鈑ぢディスクのデバイスは自分のにあわせて変えてね)
d1000 1
a1000 1
もし、いわば業務用のサーバと称するようなものを走らせようとしているなら、固定ディスクのどれかがイカレたときのために、なんらかのバックアップはとっておこうね。
d1004 1
a1004 1
ここにある情報は、OpenBSD についてくる通常の <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dump&amp;sektion=8&amp;format=html">dump(8)</a>/<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=restore&amp;sektion=8&amp;format=html">restore(8)</a> ユーティリティの使い方を誓睫誓している。複数のサーバを一本のテープドライブでバックアップするために、もっと高度な「Amanda」というソフトもある。ふつうの環境では <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dump&amp;sektion=8&amp;format=html">dump(8)</a>/<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=restore&amp;sektion=8&amp;format=html">restore(8)</a> でじゅうぶんだ世韻譴鼻∧瑤離泪轡鵑魄貘罎離董璽廚縫丱奪▲奪廚靴燭韻譴弌△い困轣鈔を検討するといいだ世蹐Α
箟旭甕旭この文書のデバイス例は、SCSI ディスクとテープを使うような構誓離轡好謄爐鯀枋蠅靴討い襦６般獲儡超任蓮堽疋屮蹈奪僚萢里笋蠅燭蕁苗よりも SCSI が推奨される。だ世蕕箸い辰董苗や別種のテープドライブを使っている人にここの情報が役にたたないわけじゃない。デバイス名だ世永僂┐譴佻辰脇韻犬誓。たとえば SCSI の sd0a は、IDE のシステムなら wd0a になる。
d1014 1
a1014 1
テープへのバックアップは、ファイルシステムがどこにマウントされているかという知識が必須だ澄侫．ぅ襯轡好謄爐匹Ε泪Ε鵐箸気譴討い襪蓮▲轡Д襯廛蹈鵐廛箸蓿繙就蔗痕鞳鈞黻鱧芍蜴瘤芍髄鴒渚阨銓逅雌繼闔集⊂迴県鹿畩ぢコマンドを使えばいい。こんな出力が出てくるはずだ澄
箟芦甕芦この例では、root (/) ファイルシステムは物理的には sd0a 上にある。これは SCSI 固定ディスク 0 のパーティション a だ澄齟ぢファイルシステムは sd0h 上で、これは SCSI 固定ディスク 0 のパーティション hになる。
d1028 1
a1028 1
もっと高度なマウントテーブルの例はこんな感じだ澄
箟梓甕梓このもっと高度な例では、root (/) ファイルシステムは物理的には sd0a 上にある。/var ファイルシステムは sd0d、/home ファイルシステムは sd0e で、/usr は sd0hにある。
d1044 1
a1044 1
マシンのバックアップには、それぞれの固定ディスクパーティション名を dump に指定する必要がある。さっきの、簡単な方のマウントテーブルをバックアップするコマンドはこんな具合だ澄
箟圧甕圧もっと複雑なほうのマウントテーブルの例なら、こんな感じだ世蹐Α
箟斡甕斡それぞれのコマンドラインのスイッチが何をするのかは、<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dump&amp;sektion=8&amp;format=html">dump(8)</a> man ページを見るのがいちばん簡単だ澄紊領磴濃箸辰織僖薀瓠璽燭鬚兇辰叛説明世靴茲Α
箟扱甕扱殊蘊錫尚鹿眈ぢレベル 0 のダ瀬鵐廚鬚垢襦△弔泙蠢乾侫．ぅ襪鬟誓ンプ
<li><b>a</b> - 自動的にテープメディアの長さを決めようとする
<li><b>u</b> - /etc/dumpdates を更新して、最後にバックアップをした日時を記録する
<li><b>f</b> - どのテープデバイスを使うか (ここでは /dev/nrst0)
d1077 1
a1077 1
そして最後に、バックアップするパーティションが記述してある (/dev/rsd0a, etc)。
d1081 1
a1081 1
最後に <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mt&amp;sektion=1">mt(1)</a> コマンドを使って、ドライブを巻き戻している。ほかのオプション (たとえば eject) については mt man ページを見てね。
d1085 1
a1085 1
テープデバイス名がよくわからなければ、dmesg を使って調べよう。たとえば dmesg を使うとこんな感じだ澄
箟姐甕姐バックアップをするときに、デバイス名が dmesg に出てくる「st0」ではなく「nrst0」になっているのに気がついたかな。st0 に nrst0 としてアクセスすると、同じ物理デバイスにアクセスしているのだ世韻譴鼻▲献腑屬僚燦紊亡瓩気覆い海箸函▲妊丱ぅ垢癡閼でアクセスすることになる。複数のファイルシステムを一本のテープにバックアップするには、必ず巻き戻さないデバイスを使うこと。もし巻き戻すデバイス (rst0) を使ったら、バックアップごとにテープが巻き戻されて、前のファイルシステムが上書きされてしまう。各種テープドライブについてもっとくわしい誓睫誓は dump man ページにある。
d1097 1
a1097 1
"backup" を簡単なスクリプトにするならこういう感じだ澄
箟臼甕臼もし毎晩定期的にバックアップしたいなら、<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=cron&amp;sektion=8&amp;format=html">cron(8)</a> を使って自動的にバックアップ用スクリプトを起動させよう。
d1118 1
a1118 1
あと、それぞれのファイルシステムがどのくらいのサイズになるかを (紙誓擇譴書いておくと役に立つ。それぞれのパーティションがどのくらいの容量を使っているか調べるには df -h を使おう。これをやっておくと、ドライブがこわれてパーティションテーブルを新しいドライブに再現するときに便利だ澄
箟渦甕渦データのリストアをすると、ファイルの断片化解消にもなる。ファイル全部を確実にバックアップするには、まず再起動してシングルユーザモードで起動することだ澄侫．ぅ襯轡好謄爐蓮▲丱奪▲奪廚垢襪箸縫泪Ε鵐箸靴討い覆討發いぁ轡鵐哀襯罅璽競癲璽匹乃阿靴燭蕁鳫阡ぢをマウントするのは忘れないように。そうしないと、ダ瀬鵐廚瞭佞鮟颪个修Δ箸垢襪箸は失敗する。シングルユーザモードで起動するには、boot&gt; プロンプトで bsd -s を入力しよう。
d1129 1
a1129 1
初めてファイルシステムをバックアップしたら、テープをちょっとテストしてみて、そこのデータが思い通りのところにあるか確認するのがいいだ世蹐Α
箟嘘甕嘘糒逅ぢテープ上のファイルのカタログを見るには、以下のような例を使えばいい。
d1141 1
a1141 1
これで、dump テープの最初のパーティション上にあるファイルのリストが一覧表示される。上の例で追加しておくと、1 というのはroot (/) ファイルシステムだ澄
箟唄甕唄ぢ番目のテープパーティションになにがあるかを見て、その出力をファイルに書き込むにはこんな感じのコマンドを使おう。
d1153 1
a1153 1
さっきの単純なほうのようなマウントテーブルを持っている場合には、2 は /usr で、もし高度なほうのマウントテーブルならば 2 は /var とかほかのファイルシステムになる。シーケンス番号は、ファイルシステムがテープに書き出された順番と一致する。
d1160 1
a1160 1
以下に上げた例題シナリオは、固定ディスクが完全にいかれたときに便利だ澄董璽廚薀侫．ぅ覦譴弔誓けを復元したいときは、restore man ページを見て、対話型モードの指示をよく読むこと。
d1164 1
a1164 1
もしきちんと準備をしてあれば、ディスクを交換してテープからデータを復元するのはとても手早くできる。標準の OpenBSD インストール/起動フロッピーは、すでに必要な復元ユーティリティもあるし、パーティションを誓擇辰匿靴靴ぅ疋薀ぅ屬魑芦椎修砲垢襪燭瓩離丱ぅ淵蠅眛辰討い襦曚箸鵑匹両豺隋△海離侫蹈奪圈爾蛤膿靴テープがあれば、それだ世韻妊轡好謄爐鯲督召擦襦
箟蔚甕蔚壊れたディスクドライブを物理的に交換したら、データの復元の基本的なステップは以下の通り。
d1174 1
a1174 1
OpenBSD インストール／起動フロッピーから起動。メニュー選択で、Shell を選ぼう。最新のバックアップテープを、書き込み禁止にしてからテープドライブに入れる。
d1180 1
a1180 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=fdisk&amp;sektion=8&amp;arch=i386&amp;format=html">fdisk(8)</a> コマンドを使って、新品のドライブにプライマリ OpenBSD パーティションをつくる。以下に例を示す。
d1188 1
a1188 1
詳しくは <a href="#fdisk">fdisk FAQ</a> を参照。
d1193 1
a1193 1
disklabel コマンドを使って、いま fdisk で作ったプライマリ OpenBSD パーティションの中に、OpenBSD パーティションをつくる。以下に例を示す。
d1201 1
a1201 1
(スワップをわすれないこと。詳しくは <a href="#disklabel">disklabel FAQ</a> を見よう。)
d1206 1
a1206 1
newfs コマンドで、上記ステップでつくったパーティションにきれいなファイルシステムをつくろう。以下に例を示す。
d1216 1
a1216 1
新品の root (/) ファイルシステムを /mnt にマウントする。以下に例を示す。
d1225 1
a1225 1
マウントされた root ファイルシステムに移動して、復元プロセスを開始しよう。以下に例を示す。
d1235 1
a1235 1
この新しいディスクは起動可能にしたいので、以下のコマンドでドライブに新しい MBR を書き込む。以下に例を示す。
d1244 1
a1244 1
ドライブに新品の MBR を書くと同時に、起動できるようにブートブロックをインストールしなきゃいけない。簡単な例を挙げよう。
d1254 1
a1254 1
ハードディスクの新しい root ファイルシステムはこれで用意ができたので、そこから起動してほかのファイルシステムのリストアを続けることができる。OS はまだ栖袷瓦任呂覆い蕁坤轡鵐哀襯罅璽競癲璽匹乃阿垢襪茲Δ法轡Д襪離廛蹈鵐廛箸如焚爾離灰泪鵐匹如▲▲鵐泪Ε鵐箸靴謄轡好謄爐鯆篁澆気擦襦
箟俺甕俺インストール/起動フロッピーをドライブから抜いて、システムを再起動しよう。OpenBSD boot&gt; プロンプトで次のコマンドを入れる。
d1272 1
a1272 1
bsd -s で、カーネルはシングルユーザモードで起動することになる。これは root (/) ファイルシステムだ世韻△譴个いぁ
箟卸甕卸以上のステップをきちんとやって、途中でなにかトラブルがなければ、プロンプトが出てきて、シェルのパスを入れるかリターンを押せと言世錣譴襦螢拭璽鵑魏，擦が使える。次に、root を読み出し誓賤僂任呂覆ぢモードでマウントしなおそう。以下のコマンドを実行する。
d1286 1
a1286 1
r/w モードで再マウントしたら、残りのファイルシステムの再現を続けよう。以下に例を示す。
d1293 1
a1293 1
(もっと高度なマウントテーブル)
d1300 1
a1300 1
ダ瀬鵐廛札奪箸乕気気譴襯屮献Д般召鬚修療堙抔燭い覆蕁△燭誓の rsf ではなく "<b>restore rvsf</b>" を使おう。
d1305 1
a1305 1
最後に、ほかのファイルシステムを全部ディスクに回復し終えたら、マルチユーザモードに入ろう。すべてもくろみ通りに進んだ世蕁▲轡好謄爐郎膿靴離丱奪▲奪彁汎韻絃屬北瓩辰討い董△泙浸箸┐襪茲Δ砲覆辰討い襪呂困誓。
d1315 1
a1315 1
マウントするには、<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=vnd&amp;sektion=4">vnd(4)</a> デバイスを誓瀋蠅垢詆廚△襦燭箸┐弌瓶イメージが <i>/tmp/ISO.image</i> にあるとしたら、マウントするには以下のようにするのだ澄
箟咳甕咳儒痰跂闥粤鮟糘莉旭⊂
箟崖甕崖ポイントとしては、このイメージは CD イメージなので、マウントするときにはその種類を <i>cd9660</i> で指定してやるってことだ澄海譴呂匹鵑兵鑪爐離ぅ瓠璽犬任發修Δ如△燭箸┐丱妊好ぅ瓠璽犬鬟泪Ε鵐箸垢襪覆胝ぢを使わなきゃいけない。
d1334 1
a1334 1
イメージのアンマウントには以下のコマンドを使おう。
d1337 1
a1337 1
<table border=0 width="800">
d1356 1
a1356 2
<h2>14.11 - 助けて!  PCIIDE でエラーになっちゃう!</h2>

d1359 2
a1360 2
PCI IDE DMA は多くのハードウェアの組み合わせにおいて信頼誓磴ぁ
なので、最近までは、IDE ドライブとの DMA 転送のサポートを謳っている、
d1362 1
a1362 1
この機能を有効にしていない状態で出荷していた。
d1366 7
a1372 7
OpenBSD は誓儷謀如∪設定できる一番上位の DMA モードを使おうとする。
こうすると、ある誓瀋蠅任魯丱阿里△襯泪供璽棔璽匹離船奪廛札奪箸箸
バグのあるドライブとかケーブル上のノイズなんかのせいで
データ転送の悪化を引き起こすだ世蹐Α９燭砲癲寥甅塚モードは
悪化を検出する CRC によってデータ転送を保護する。Ultra-DMA CRC
が失敗したときには、OpenBSD はエラーメッセージを出してもう一度
転送を試みる。
d1380 3
a1382 3
何度か失敗すると、OpenBSD はもっと遅い (願わくばもっと信頼できる)
Ultra-DMA モードへ下げる。Ultra-DMA モード 0 まで行ったら、
ドライブは PIO モードへ下げる。
d1387 1
a1387 1
するようだ世辰燭蕁釈鱚羹〓甎鱚竟鶯譬ぢバグの報告</a> へ送っていただ世燭ぁ
箟街憾
箟幹甕幹取仮唄緕帯の RAID オプション</h2>
d1443 3
a1445 3
仕組みだ澄
卅苗ぢの特質についての詳細な議論世蓮△海諒絃呂糧楼漏阿誓が、ふたつの重要な点世誓けは
ここで明棲里砲靴討海Α
箟幹甕幹殊蘊卅苗ぢ自身はダ瀬Ε鵐織ぅ爐鮹蚕未靴討譴呂靴覆ぁ鹿跚箟患甕患卅苗ぢの冒険のための良い出発点世任呂覆ぁ
箟患甕患緕帯は、ソフトウェア RAID である RAIDframe を含んでいる。
これについてのドキュメントは以下の場所にある。
d1464 2
a1465 2
パーティションをミラーリングすることが可能になった。OpenBSD の以前のリリースでは、
この方法で root パーティションをミラーリングすることはできなかった。
d1471 2
a1472 2
RAID 誓宿覆鬟汽檗璽箸靴討い襦海譴魯廛薀奪肇侫璽爐砲茲辰栃僂錣襪里如▲蓮璽疋ΕД▲汽檗璽
ページ (<a href="../../ja/plat.html">ここ</a> にリストがある) を見てね。
d1477 2
a1478 2
多くのプラットフォームで利用可能だ澄海譴蕕離妊丱ぅ垢蓮喘喇ぢや IDE を
サポートしているどんなハードウェアプラットフォームでも仮想的に動作できる。
d1487 2
a1488 2
誓宿覆箸いΔ誓けなので、その使用を推奨しているわけではないし、
徹底したリストだ世箸いΔ錣韻任發覆ぁ箟換甕換「Promise や HighPoint の IDE RAID コントローラはサポートしているのか ?」というのがある。
その答は "No" だ澄海譴蕕離璽匹筌船奪廚呂曚鵑箸Δ離蓮璽疋ΕД蘇コントローラ
じゃなくて、むしろ、これは、
BIOS の助けを借りてブートするソフトウェア RAID だ世蕕覆鵑誓。既に OpenBSD は、
ハードウェアに依存しない方法でソフトウェア RAID をサポートしているんだ世蕁
箟軌甕軌ならないだ世蹐Α
箟輝甕輝蜃蜴瘡踟緕帯頂瘻唄讙窺狂
箟輝甕輝ぴ鱇銖赱闔聲餘堪蔗迪屋芦君嘘浦梓佐鼈祷

窺渦
跫挽楊跂瘤

絶唄況
甕感蜃蜴瘡踟緕帯頂瘻唄讙窺況
箟感甕感ぴ鱇銖赱闔聲餘堪蔗迪屋芦君芦減渦佐鼈祷箟慣甕慣は鞳鄲喞聲餘堪蔗迪屋芦君芦浦鰻叉鉗站


窺臼
跫碣闍緕蜴
絶幹甦換
碵筍齡鳫鈑嬢纓胝箟鹿齡鳫鈑箚恭
甦恭
迴纐箟
箋屋
甬屋
纈蜒蠕戦鼈蛯瘤瓲苳首闔臂齬瘰笏鹿齡鳫鈑箋街
甬街
纈蜒蠕戦鼈蛯瘤瓲苳首闔臂齦粹蜀蒐粤鳫羹癇碵襲竢害袈玄闔臂
箋輝
甬飢
纈蜒蠕戦鼈蛯瘤瓲苳首闔臂齦粹蓁閼旭鬲齬瘰鹿齡鳫鈑纈蜒蠕戦鼈蛯瘤瓲苳首闔臂齦粹鞦癇霄闔臂
箋彊
甬彊
纈蜒蠕戦鼈蛯瘤瓲苳首闔臂齬瘰笏鹿齡鳫鈑箋郡
甬郡
纈蜒蠕戦鼈蛯瘤瓲苳首闔臂竅齡痰鹿齡鳫鈑箋昂
甬昂
纈蜒蠕戦鼈蛯瘤瓲苳首闔臂齦粹蜀蒐粤鳫羹癇碵襲竢害袈玄闔臂
箒姐
甼姐
纈蜒蠕戦鼈蛯瘤瓲苳首闔臂竅齡痰鹿齡鳫鈑箒憶
甼憶
纈蜒蠕戦鼈蛯瘤瓲苳首闔臂齦粹釿闔肅箘鬲齬瘰鹿齡鳫鈑箒害
甼崖
纈蜒蠕戦鼈蛯瘤瓲苳首闔臂齦粹鞦纐鈔違鹿齡鳫鈑纈蜒蠕戦鼈蛯瘤瓲苳首闔臂齬瘰笏鹿齡鳫鈑箏恩
畄恩
р闖プロンプトが出たら、ハードディスクからの起動に
d735 2
a736 2
>> OpenBSD BOOT 1.28
boot> <b>boot hd0a:/bsd</b>
d778 1
a778 1
A:\&gt<b>fdisk /mbr</b>
d987 1
a987 1
# <strong>make && make install </strong>
d1017 1
a1017 1
shell# <b>mount</b>
d1031 1
a1031 1
shell# <b>mount</b>
d1121 1
a1121 1
データのリストアをすると、ファイルの断片化解消にもなる。ファイル全部を確実にバックアップするには、まず再起動してシングルユーザモードで起動することだ澄侫．ぅ襯轡好謄爐蓮▲丱奪▲奪廚垢襪箸縫泪Ε鵐箸靴討い覆討發いぁ轡鵐哀襯罅璽競癲璽匹乃阿靴燭蕁鳫阡ぢをマウントするのは忘れないように。そうしないと、ダ瀬鵐廚瞭佞鮟颪个修Δ箸垢襪箸は失敗する。シングルユーザモードで起動するには、boot> プロンプトで bsd -s を入力しよう。
d1183 1
a1183 1
shell# <b>fdisk -e sd0</b>
d1196 1
a1196 1
shell# <b>disklabel -E sd0</b>
d1209 2
a1210 2
shell# <b>newfs /dev/rsd0a</b>
shell# <b>newfs /dev/rsd0h</b>
d1219 1
a1219 1
shell# <b>mount /dev/sd0a /mnt</b>
d1228 2
a1229 2
shell# <b>cd /mnt</b>
shell# <b>restore -rs 1 -f /dev/rst0</b>
d1238 1
a1238 1
shell# <b>fdisk -i sd0</b>
d1247 2
a1248 2
shell# <b>cp /usr/mdec/boot /mnt/boot</b>
shell# <b>/usr/mdec/installboot -v /mnt/boot /usr/mdec/biosboot sd0</b>
d1257 2
a1258 2
shell# <b>umount /mnt</b>
shell# <b>halt</b>
d1280 1
a1280 1
shell# <b>mount -u -w /</b>
d1290 1
a1290 1
shell# <b>mount /dev/sd0h /usr; cd /usr; restore -rs 2 -f /dev/rst0</b>
d1293 3
a1295 3
shell#	<b>mount /dev/sd0d /var; cd /var; restore -rs 2 -f /dev/rst0</b>
shell#	<b>mount /dev/sd0e /home; cd /home; restore -rs 3 -f /dev/rst0</b>
shell#	<b>mount /dev/sd0h /usr; cd /usr; restore -rs 4 -f /dev/rst0</b>
d1467 1
a1467 1
Originally [OpenBSD: faq14.html,v 1.65 ]
d1469 1
a1469 1
$Translation: faq14.html,v 1.11 2002/06/29 08:21:22 jufi Exp $
d1471 1
a1471 1
$OpenBSD: faq14.html,v 1.65 2002/06/14 21:20:30 nick Exp $
@


1.10
log
@
sync with badlands translation CVS
@
text
@d930 1
a930 1
これは、単一の巨大なパーティションを使用するより、<a href="faq4.html#SpaceNeeded">
d1469 1
a1469 1
$Translation: faq14.html,v 1.10 2002/06/15 15:58:34 toshi Exp $
@


1.9
log
@
sync with badlands translation CVS
@
text
@d513 1
a513 1
Soft Updates を使っている人は使えない (これはデフォルトでは有効になっていない)。
d1467 1
a1467 1
Originally [OpenBSD: faq14.html,v 1.64 ]
d1469 1
a1469 1
$Translation: faq14.html,v 1.9 2002/06/11 05:38:51 toshi Exp $
d1471 1
a1471 1
$OpenBSD: faq14.html,v 1.64 2002/06/10 23:46:07 nick Exp $
@


1.8
log
@
sync with badlands translation CVS
@
text
@d951 1
a951 1
持っているんだ世韻譴鼻△海譴柄阿痢嵋殘廛献瓮肇蠅乃劼気譴討い襪蕕誓。)
d955 2
a956 1
ハードディスクに起動フロッピーを入れて、boot プロンプトで
d1467 1
a1467 1
Originally [OpenBSD: faq14.html,v 1.63 ]
d1469 1
a1469 1
$Translation: faq14.html,v 1.8 2002/06/08 02:51:33 toshi Exp $
d1471 1
a1471 1
$OpenBSD: faq14.html,v 1.63 2002/06/07 22:54:21 nick Exp $
@


1.7
log
@
3.1 changes
@
text
@d33 1
a33 1
<li><a href="#LargeDrive" >14.7 - OpenBSD での大容量ドライブはどうなってるの ? - i386 のみ</a></li>
d334 1
d359 1
d866 1
a866 1
<h2>14.7 - OpenBSD での大容量ドライブに関する問題は ?  - i386 のみ</h2>
d877 1
a877 6
OpenBSD で新しいインターフェースの規格が実装されるまではサポートされない
ことに注意。
(開発のための
<a href="../../ja/want.html">ハードウェア</a> の
<a href="../../ja/donations.html">寄付</a> 
は歓迎するよ。)
d883 1
a883 1
起動プロセスはシステムの BIOS を使う (そしてだ世蕕海修修譴棒制限される)。
d887 1
a887 1
といった OpenBSD のブートローダ世
筝慌
畍拘
こういったわけで、/bsd ファイル (カーネル) 全体が
BIOS で使える領域内か、ディスクの誓萋以内のどちらか小さい方に
置かれないといけない。これは、いくつかのずっと古いコンピュータでは
d918 1
a918 1
BIOS を使っているブートローダ世碵ファイルをとってこれなくて、
d922 1
a922 1
OpenBSD が起動するようにするには、/bsd が BIOS がサポートする
d926 2
a927 2
<b>root パーティション全体は BIOS で使える領域内か、
ディスクの誓萋以内のどちらか小さい方に置かれないといけない。</b>
d930 2
a931 3
OpenBSD は、システムの BIOS が認識できる空間のみではなく、
IDE ドライブ全体 (128G まで)にアクセスすることができるが、root は
BIOS の範囲内にあるのが一番だ澄
箟感甕感蜃蜴瘡踟緕帯頂瘻唄讙窺怯
箟感甕感ぴ鱇銖赱闔聲餘堪蔗迪旭億圧宛佐敢干闢蓍
箟慣甕慣は鞳鄲喞聲餘堪蔗迪屋芦起屋浦梓佐鉗站


窺跫齷釿蜚矚粲瘤糂鱇銖赱闔嶝

絶寛甦屋
オフセットを組み合わせたものになる（ただ世礑ぢパーティションだ世韻蓮△い泙亮阿
箋鯵
甬梓
緕帯荻のリリース後に、
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=swapctl&amp;sektion=8&amp;format=html">swapctl(8)</a>
ができて、スワップデバイスの扱いはずっと簡単になった。もし OpenBSD 2.5 システムを使っているなら、swapctl
を swapon と読み替えて、スワップデバイスを一覧表示するには pstat -s を使おう。ファイルへのスワップは、
カスタムのカーネルは必要ないけれど、ビルドしなおすこともできる。この FAQ では、どちらの方法でも
スワップスペースを追加する方法を示す。
d511 1
a511 1
Soft Updates を使っている人は使えない（これはデフォルトでは有効になっていない）。
d642 1
a642 1
<h2>14.5 - Soft Updates</h2>
d646 1
a646 1
過去数年にわたって、Kirk McKusick は "Soft Updates" なるものの
d651 2
a652 1
かなり上がる。<br>
d663 1
a663 1
Softupdates を有効にするには、
d669 1
a669 1
をつけてカーネルをコンパイルしないといけない。
d672 8
a679 5
このオプションは OpenBSD 2.9 以降だ世辰燭杜賭秒ぢカーネルに入っているけど、でも、相変わらずマウントポイント毎に有効にしてやる必要はある。
</p>

<p>
2.9 以降だ世辰燭蕁齒胄鞣癆纉ぢを有効にするには <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tunefs&amp;sektion=8">tunefs(8)</a> じゃなくて、マウント時のオプションで指定してやらないといけない。さて、<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mount&amp;sektion=8">mount(8)</a> ユーティリティでパーティッションをマウントするときに、そのパーティッションで soft updates を有効にしたいってことを指定できる。以下が soft updates を有効にしてマウントしたい <i>sd0a</i> のパーティションの行がある <i><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=fstab&amp;sektion=5">/etc/fstab(5)</a></i> の例だ澄
箒厳
甼弦荻より古い OpenBSD を使ってるんだ世辰燭蕁▲轡鵐哀襯罅璽競癲璽匹乃阿靴董焚爾里茲Δ砲垢襦
鹿霈

腫鱚硼阡首闔臂硼阡鷦闔臂
椏鉗鞆
碵筍齡鳫鈑浄繙釶碎鱇粤竇鹿齡鳫鈑碵筍齡鳫鈑条繧闖鹿齡鳫鈑鹿頏緇

腫齔癇ユーザへの注意: sun4 や sun4c のマシンでは soft updates は有効にしないこと。こいつらはごく限られた量のカーネルメモリーしかサポートしてないので、soft updates は使えない。でも、sun4m マシンだ世辰燭藺臂翩廖
箏臼
箟官甕寛現時点世任蓮▲襦璽肇僉璽謄轡腑鵑鞳鄲喞ぢでは RAIDframe で直誓椒潺蕁璽螢鵐
できないが、これは、次の OpenBSD のリリースでは変更されるはずだ澄
箟慣甕慣蜃蜴瘡踟緕帯頂瘻唄讙窺彊
箟慣甕慣ぴ鱇銖赱闔聲餘堪蔗迪旭億梓嘘魂浦嘘闢蓍
箟慣甕慣は鞳鄲喞聲餘堪蔗迪屋芦姦姥杭換紺鉗站


窺跫齷釿蜚矚粲瘤糂鱇銖赱闔嶝

絶幻畍険
釈鱚羹〓瘤蔗迪⊂ハードウェア</a> の
d1393 1
a1393 1
するようだ世辰燭蕁釈鱚羹〓辮闥蔗迪⊂バグの報告</a> へ送っていただ世燭ぁ
箟患甕患釈鱚羹〓瘟谺蔗迪⊂メーリングリスト</a>上で、ときどき繰り返される質問として、
d1474 1
a1474 1
$Translation: faq14.html,v 1.5 2002/04/18 22:48:37 toshi Exp $
@


1.4
log
@
broken link
@
text
@d1365 4
a1368 2
PCI IDE DMA は信頼できない。Microsoft が出荷しているオペレーティング
システムで default は無効にしてあるのはそのためだ澄
箟慣甕慣蜃蜴瘡踟緕帯頂瘻唄讙窺宜
箟慣甕慣ぴ鱇銖赱闔聲餘堪蔗迪旭億梓斡佐刑乙祷箟慣甕慣は鞳鄲喞聲餘堪蔗迪屋芦劾屋該鬼些鉗站


窺跫碣闍緕蜴謫辮瘟鱚磔闢蓍蓍謠屠
絶憶
甓守辯踉就柤鞳鄲喞蘗繪艾外蜆襲官鱆就轣艱鶩鼾瘡踉蜚跂蜀⊂
箟慣甕慣ぴ鱇銖赱闔聲餘堪蔗迪旭億梓渦些矯官闢蓍


窺跫碣闍緕蜴襾鶇

絶原畍怯
詳しくは <a href="#14.8">section 14.8</a> を参照。
d1413 1
a1413 1
<li><a href="faq11.html#raid">FAQ 11, RAID</a>
d1472 1
a1472 1
$Translation: faq14.html,v 1.2 2002/04/14 11:58:04 jufi Exp $
@


1.1
log
@
sync with badlands translation CVS
@
text
@d105 1
a105 1
ついては、<a href="faq4.html#SpaceNeeded">FAQ 4, 必要なスペース</a> を読もう。サーバの場合、
d881 2
a882 2
<a href="/want.html">ハードウェア</a> の
<a href="/ja/donations.html">寄付</a> 
d1472 1
a1472 1
$Translation: faq14.html,v 1.1 2002/04/13 15:02:14 toshi Exp $
@

