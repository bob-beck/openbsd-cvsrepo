head	1.3;
access;
symbols;
locks; strict;
comment	@# @;


1.3
date	2005.08.13.08.19.34;	author saad;	state dead;
branches;
next	1.2;

1.2
date	2004.05.09.09.58.22;	author saad;	state Exp;
branches;
next	1.1;

1.1
date	2004.04.17.19.33.21;	author jufi;	state Exp;
branches;
next	;


desc
@@


1.3
log
@remove unmaintained [ja] translation files. requested by translator.
@
text
@<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
   <meta http-equiv="Content-Type" content="text/html; charset=ISO-2022-JP">
   <title>OpenBSD Upgrading Mini-FAQ - Old Versions</title>
</head>
<body bgcolor="#FFFFFF" text="#000000" link="#23238E">


<h1>ミニ FAQ: OpenBSD のアップグレード - 旧バージョン</h1>
<h2>こちらでカバーするバージョンは 2.3 〜 3.1 です。</h2>

<address>
<p>
Kjell Wooding 
&lt;<a href="mailto:kjell@@openbsd.com">kjell@@openbsd.org</a>&gt; <br />
Updated:
$OpenBSD: upgrade-old.html,v 1.2 2004/05/09 09:58:22 saad Exp $
</p>
</address>

<br />

<blockquote>
<p>
このドキュメントは、既にサポートされなくなったバージョンの OpenBSD 
のためのミニ FAQ のエントリを含みます。より最近のバージョンのための
一般的なアップグレード手順については、誓擬鞍任
釈鱚羹♭韃鱇粤蜴蜀瘻譬ぢアップグレード ミニ FAQ</a> を参照してくだ世気ぁ
鹿霈
鹿碎閭鞫

取仮窺虻ぢ一般的なアップグレードについての質問</h2>

<p>
<a href="#1.1">
1.1: より最近のバージョンの OpenBSD に関する情報はどちらにあるのでしょう ?
</a>
</p>

<h2>3.1 からのアップグレード</h2>

    <p>
      <a href="#3.1.1">3.1.1: 新しいユーザ/グループ</a><br>
      <a href="#3.1.2">3.1.2: crontab(1) と at(1) のための新しいグループ</a><br>
      <a href="#3.1.3">3.1.3: 新しい binutils</a><br>
      <a href="#3.1.4">3.1.4: 新しい S/Key の構誓鹿畩錫鮠
釈鱚羹■凱窺帰廠跟のための新しいパーミッション</a><br>
      <a href="#3.1.6">3.1.6: atrun(8) はもはや不要</a><br>
      <a href="#3.1.7">3.1.7: nat.conf の pf.conf へのマージ</a><br>
      <a href="#3.1.8">3.1.8: xdm 用の新しい fbtab 必須エントリ</a><br>
      <a href="#3.1.9">3.1.9: ある種の関数への __attribute__((sentinel))
               の使用</a><br>
    </p>

<h2>3.0 からのアップグレード</h2>

    <p>
      <a href="#3.0.1">3.0.1: mtree(8) でサポートされる新しいキーワード</a><br>
      <a href="#3.0.2">3.0.2: ELF プラットフォームからの libdl の削除</a><br>
      <a href="#3.0.3">3.0.3: リグレッションテスト用の新しいフレームワーク</a><br>
      <a href="#3.0.4">3.0.4: /etc/ssh/ に移動された ssh の誓瀋螢侫．ぅ鹿畩錫鮠
鹿霈

取仮荻からのアップグレード</h2>

    <p>
      <a href="#2.9.1">2.9.1: 新しいユーザ/グループ - <em>proxy</em> と
	<em>smmsp</em>、<em>popa3d</em></a><br>
      <a href="#2.9.2">2.9.2: 新しいパケットフィルタ: <em>pf</em></a><br>
      <a href="#2.9.3">2.9.3: <em>make</em> への変更</a><br>
      <a href="#2.9.4">2.9.4: KerberosV のエラーが原因の構築の
	失敗</a><br>
      <a href="#2.9.5">2.9.5: 新バージョンの <em>sendmail</em></a><br>
      <a href="#2.9.6">2.9.6: <tt>/etc/primes</tt> の移動</a>
    </p>

<h2>2.8 からのアップグレード</h2>
    
    <p>
      <a href="#2.8.1">2.8.1: 新しい <em>auth</em> グループ</a><br
      />

      <a href="#2.8.2">2.8.2: 新しい <em>wscons</em> コンソールシステム</a><br>

      <a href="#2.8.3">2.8.3: 未定義のシンボルによるカーネルのコンパイルの
	失敗</a><br>
    </p>

<h2>2.7 からのアップグレード</h2>

<p>
<a href="#2.7.1">
2.7.1: 2.7 から 2.8 へのアップグレードでの大きな問題は何でしょう ?
</a>
</p>

<h2>2.6 からのアップグレード</h2>

<p>
<a href="#2.6.1">
2.6.1: Termcap のエントリが長過ぎます
</a> <br />

<a href="#2.6.2">
2.6.2: <em>pn</em> (または <em>mx</em>、<em>al</em>、<em>ax</em>)
デバイスをカーネルが認識しなくなりました
</a> <br />

<a href="#2.6.3">
2.6.3: GCC 2.95.1 から 2.95.2 へのアップグレード
</a> <br />

<a href="#2.6.4">
2.6.4: Kerberos のアップグレード
</a> <br />

<a href="#2.6.5">
2.6.5: M4 のアップグレード
</a> <br />

<a href="#2.6.6">
2.6.6: Sendmail のアップグレード
</a> <br />

<a href="#2.6.7">
2.6.7: アップグレード後、<em>apm(8)</em> サポート
を含むカーネルがブートしなくなりました
</a> <br />

<a href="#2.6.8">
2.6.8: <em>daemon</em> ユーザのデフォルトのグループが変更されました

</a>
</p>


<h2>2.5 からのアップグレード</h2>

<p>
<a href="#2.5.1">
2.5.1: 2.5 から 2.6 へのアップグレードでの大きな問題は何でしょう ?
</a> <br />
<a href="#2.5.2">
2.5.2: <em>gcc</em> から <em>egcs</em> へのアップグレードはどのように行うのでしょう ?
</a>
</p>

<blockquote>
<p>
<a href="#2.5.2.1">2.5.2.1 - i386 および sparc は、最早 #define されていません。</a><br />
<a href="#2.5.2.2">2.5.2.2 - xlint で Build が失敗します。</a><br />
<a href="#2.5.2.3">2.5.2.3 - uthread_autoinit.c で core ダ瀬鵐廚靴泙后鹿畩錫
釈鱚羹■荻貴荻刈床艫は gcc よりずっと遅いようなのですが... </a><br />
<a href="#2.5.2.5">2.5.2.5 - egcs は gcc より大きなコードを誓言成するようですが... </a><br />
<a href="#2.5.2.6">2.5.2.6 - egcs をインストールしたら、非常に小さなディスク空間しか
残っていません。</a><br />
<a href="#2.5.2.7">2.5.2.7 - ビルドで libcurses の構築に失敗します。</a><br />
<a href="#2.5.2.8">2.5.2.8 - make obj が失敗します。</a>
</p>
</blockquote>

<p>
<a href="#2.5.3">
2.5.3: <em>make build</em> が <em>unimplemented syscall</em> エラーで停止します。
</a> <br />

<a href="#2.5.4">
2.5.4: 新しい 2.6 ディレクトリへのリンク
</a> <br />

<a href="#2.5.5">
2.5.5: <strong>(U)</strong>pgrade を選択後の、<em>base26.tar.gz</em>
の展開が失敗します。
</a>
</p>

<h2>2.4 からのアップグレード</h2>

<p>
<a href="#2.4.1">
2.4.1: Man ページの変更
</a> <br />

<a href="#2.4.2">
2.4.2: <em>cap_mkdb</em> のシンタクスの変更
</a> <br />

<a href="#2.4.3">
2.4.3: Snake
</a>
</p>

<h2>2.3 からのアップグレード</h2>

<p>
<a href="#2.3.1">
2.3.1: 新しいユーザ: <em>named</em>
</a> <br />

<a href="#2.3.2">
2.3.2: 構築しようとすると、<em>ssleay</em> をビルドしようとして
失敗します。</em>.
</a> <br />

<a href="#2.3.3">
2.3.3: 構築しようとすると、PowerPC 用の何かを
make しようとして失敗します。
</a>
</p>


&nbsp;<hr width="30%">

<a name="1.0"></a>
<h2>1.0: 一般的なアップグレードについての質問</h2>


<a name="1.1"></a>
<h3>
1.1: より最近のバージョンの OpenBSD に関する情報はどちらにあるのでしょう ?
</h3>
<p>
誓擬鞍任蓿繙就苒痲絖迚鉗聲餉蔗迪⊂アップグレード ミニ FAQ</a> を参照してくだ世気ぁ
鹿霈


釈瘢綵⊂鹿畩
取仮
凱からのアップグレード
    </h2>

    <a name="3.2.1"></a>
    <h3>
      3.2.1: 新しい Perl (2002/11/05)
    </h3>

    <p>Perl がバージョン 5.8.0 に更新されました。<br>
      Perl 5.8.0 では、XS モジュールの API が stdio から PerlIO に誓擇蠡悗┐蕕譴燭里砲箸發覆辰
変更されました (PerlIO についてのより詳しいことは perldelta マニュアルページを参照してくだ世気ぢ。
      これは、インストール済のすべての XS モジュール (Perl .so ファイル) を再構築する
      <strong>必要がある</strong>ことを意味します。もし、<em>Undefined symbol "perl_get_sv"</em>
      のようなエラーが発誓犬靴疹豺腓砲蓮△海譴彊任靴腓Α泙拭△發掘
インストール済のモジュールが packages や ports システムからインストールされたものだ世韻任△譴弌
慯ぢモジュールをチェックするために、以下のコマンドを実行してくだ世気ぁ
腫鱚	苒辮椪齒癇皴韜膀雉地淋杜墫篋羆闥
鹿頏緇
これによって見つかった古いモジュールは <em>pkg_delete -f</em> を使用して削除した後、
      これらを ports ツリーから再構築/インストールし直してくだ世気ぁ

釈瘢綵⊂鹿畩
取馨
凱荻穏ぢ新しいグループ _radius、_token および _shadow (2002/11/21)
    </h3>
    <p>以下のいくつかの新しいグループが追加されました。
      <ul>
      <li><em>_radius</em> グループは、<tt>/etc/raddb/servers</tt>
	  ファイルに対する読み出し誓賤僖▲札垢鯆鷆，垢襪燭瓩離哀襦璽廚任后
殊蘊弱躱熹闍緕鹿纃グループは、
	  <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tokeninit&amp;sektion=8">tokeninit(8)</a>、
	  <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tokenadm&amp;sektion=8">tokenadm(8)</a> および
	  <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=login_token&amp;sektion=8">login_token(8)</a>
	  が使用するトークンデータベースに対する読み出し誓賤僖▲札垢鯆鷆，垢襪燭瓩離哀襦璽廚任后
殊蘊弱躱燗葹粹躱ぢグループは、シャドウパスワードデータベースに対する
	  読み出し誓賤僖▲札垢鯆鷆，垢襪燭瓩離哀襦璽廚任后
鹿
これらのグループの追加やいくつかのファイルに対するパーミッションの調誓阿蓮
轣諷趙ぢの実行前に行う必要があります。root 権限で、
      次のコマンドを実行してくだ世気ぁ
	腫鱚	苒阨鞜粐恭鱇粡
	竏苒熬痲蝠痲籵續祚鱇粐皴黼鴟纈	竏迴腴痲籵
	竏迴腴痲籵纈鴦

	苒阨鞜粐挟諷	竏苒熹闍緕續祚痺籵續祚竰鉉	竏迴斡完續祚痺籵續祚竰鉉
	苒阨鞜粐教鼈痲阯
	竏苒燗葹粹頷筮籵
	竏迴斡完續祚齔	鹿頏緇

ファイルが見つからないというエラーメッセージは気にする必要はありません。それは単に、
      <em>token</em> や <em>radius</em> 認証の誓瀋蠅鮃圓辰討い覆い海箸魄嫐靴討い襪誓けです。

    <a name="3.2.3"></a>
    <h3>
      3.2.3: 重要なコンパイラの変更 (2002/12/02)
    </h3>
    <p><a href="http://www.trl.ibm.com/projects/security/ssp">propolice</a>
      スタック保護拡張機能が
      <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=gcc-local&amp;sektion=1">gcc</a>
      にマージされました。このため、アップグレード手順が以下のように若干異なります。
      <ul>
      <li>まだ世海了誓では、新しいカーネルを構築しては<b>いけません</b>。
      <li>まだ世海了誓では、新しい gcc を再構築しては<b>いけません</b>。
      <li>シェアードライブラリを持つシステムの場合、新しい ld.so (ダ瀬ぅ淵潺奪蹇璽誓)
        を構築し、インストールします。
        <pre>
	  # cd /usr/src
	  # make obj
          ELF プラットフォーム (alpha, macppc, sparc, sparc64) の場合、
          # cd /usr/src/libexec/ld.so
          # make depend &amp;&amp; make &amp;&amp; make install
          a.out プラットフォーム (amiga, hp300, i386, mac68k, mvme68k) の場合、
          # cd /usr/src/gnu/usr.bin/ld/rtld
          # make depend &amp;&amp; make &amp;&amp; make install
	</pre>
      <li><i>make build</i> からの、最初の少しのコマンドに従って libc を再構築し、
        インストールします。
	<pre>
          # cd /usr/src/include
	  # make prereq &amp;&amp; make includes
	  # cd /usr/src/lib/libc
	  # make depend &amp;&amp; make NOMAN=1 &amp;&amp; make NOMAN=1 install
	</pre>
        使用中のコンパイラが古過ぎる場合、libc を構築することができない可能誓△襪海箸肪躇佞廚任后
その場合には、snapshot を使用したバイナリアップグレードを実行する必要があります。
      <li><a href="#1.8">1.8</a> 章に従って gcc を再構築し、インストールします。
      <li>ここで、カーネルの再コンパイルを行うことができます。
        カーネル用の Makefile を再誓言成するために、確実に
        <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=config&amp;sektion=8">config</a>
        を再実行してくだ世気ぁ
殊蘊新しいカーネルでリブートし、スタック保護の効果を得世襪燭瓠
守壌瘠碯蛹篌を実行します。
      </ul>

    <a name="3.2.4"></a>
    <h3>
      3.2.4: 新しいユーザ/グループ _spamd (2002/12/24)
    </h3>
    <p>新しいユーザ/グループ _spamd が
      <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=spamd&amp;sektion=8"
      >spamd(8)</a> デーモン用に追加されました。
      root で以下を実行してグループを追加します。
<pre>
  # groupadd -g 62 _spamd
</pre>
      また、<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=vipw&amp;sektion=8">vipw(8)</a>
      を使用して次のユーザのエントリを追加してくだ世気ぁ
腫鱚燗鞜辟昏唆穏恐査虻虻嚼瘢痳迴邵癇逅痕黷蜴闌閾蜴
鹿頏緇

釈瘢綵⊂鹿畩
取馨
凱荻戯做境秒熔ぢ用のエイリアス (2002/12/30)
    </h3>

    <p>ipv6-icmp 用の新しいエイリアス、<em>icmp6</em> が、
      <tt>/etc/protocols</tt> に追加されました。<em>icmp6</em> エイリアスを使用する場合 (
      <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8">pfctl(8)</a>
      のリグレッションテストで使用)、
      <tt>/etc/protocols</tt> ファイル中の <em>ipv6-icmp</em> の行を、# の前に <em>icmp6</em> 
      を追加して変更しなければなりません。
      この行は以下のようにしておくべきです。
    </p>
<pre>
  ipv6-icmp 58    IPv6-ICMP icmp6 # ICMP for IPv6
</pre>

    <a name="3.2.6"></a>
    <h3>
      3.2.6: 新しいグループ _lkm (2003/01/05)
    </h3>

    <p><tt>/dev/lkm</tt> へのアクセスを誓罎垢襪燭瓩離哀襦璽
纃醤跌躰躱ぢが追加されました。
         <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=modstat&amp;sektion=8">modstat(8)</a>
         は _lkm に setgid されるようになりました。
    <p>
      &quot;make build&quot; の実行前に、このグループを追加し、
      <tt>/dev/lkm</tt> のパーミッションを調誓阿垢詆廚△蠅泙后
次のコマンドを root で実行することで、これが行われます。
<pre>
  # groupadd -g 61 _lkm
  # chgrp _lkm /dev/lkm
</pre>

    <a name="3.2.7"></a>
    <h3>
      3.2.7: 新しい libpthread (2003/01/14)
    </h3>

    <p><em>libc_r</em> と <em>libnpthread</em> が除去され、<em>libpthread</em>
    で置換されました。スレッドを使用するプログラムは、やはり <em>-pthread</em>
    オプションを使用してコンパイルしてくだ世気ぁ灰鵐僖ぅ蕕諒農正しく処理
    を行います。

    <p><em>libc_r</em> と <em>libnpthread</em> とを消去する前に、スレッドを使用する
    アプリケーションは <em>libpthread</em> を使用して再コンパイルしておかなければ
    なりません。推奨再構築手順は以下のようになります。

    <ol>
      <li>
        <p><a href="#1.8">1.8</a> 章に従って、gcc を再構築してくだ世気ぁ
殊蘊
腫昭蓿繙就１⊂窺擬章に従って、システムを再構築してくだ世気ぁ
殊蘊
腫ぢすべてのスレッドを使用する ports を再構築してくだ世気ぁ
殊蘊
腫ぢ使用されなくなったライブラリを消去してくだ世気ぁ
腫鱚鴉鬲跚皴跚矣熬齟蛯蛯鉋鱚痲鹿頏緇
鹿闌
釈瘢綵⊂鹿畩
取馨
凱荻減牝ぢアーキテクチャ用のリンカの変更 (2003/01/17)
    </h3>

    <p>binutils/ld は、ELF 実行形式に新しいセキュリティ機能を導入するために
    変更されました。これは、実行形式ならびにシェアードライブラリのデータ
    セクションがリンカによってマークされた実行形式になるのを許容する代わりに、
    実行形式としてのプログラムイメージを適誓擇淵札轡腑鵑里潺沺璽気譴襪茲
レイアウトが変更されたものです。この変更は、ELF アーキテクチャである
    alpha、sparc、sparc64、macppc に対してのみ影響があります。
    <p>
    binutils は、残りのシステムの再構築前に構築しておくことをお勧めします。
    <p>
<pre>
  # cd /usr/src/gnu/usr.bin/binutils
  # make -f Makefile.bsd-wrapper cleandir
  # make -f Makefile.bsd-wrapper obj
  # make -f Makefile.bsd-wrapper depend
  # make -f Makefile.bsd-wrapper
  # make -f Makefile.bsd-wrapper install
</pre>
    <p>
    そして、<a href="#1.5">1.5</a> 章に従って、システムを再構築してくだ世気ぁ

釈瘢綵⊂鹿畩
取馨
凱荻杭鬲癆ぢの削除と crontab の変更 (2003/02/19)
    </h3>

    <p><em>at</em> が <em>cron</em> と統合されたことにともない、<tt>/var/at</tt>
    のコンテンツは <tt>/var/cron</tt> にマージされました。さらに、POSIX に準拠するため、
    および at.allow と at.deny との一貫誓琉飮里燭瓠弱躱竰闔鹿纃の allow および
    deny ファイルは、それぞれ cron.allow および cron.deny にリネームされました。
    <p>
    まず、<a href="#1.5">1.5</a> 章に従って、システムを再構築してくだ世気ぁ
そして、次のように既存のファイルを移動させて cron を再起動してくだ世気ぁ
腫腫鱚逍鬲癆鬲竰闔
逍鬲竰闔閧癇鳫遲癆褊碵
逍鬲竰闔跛阯鬲竰闔鳫隨瘡跫逍鬲竰闔緕癇鳫遲竰闔緕鴉鱠鬲癆謇跛竅癇鳫隨韈籥
齟砠遲竰闔
鹿頏緇
腫瘡跫および deny ファイルがなくなったことによる一誓擇侶拗陬瓮奪察璽犬鰐技襪靴討誓さい。
    それらのすべてがデフォルトでインストールされるものというわけではないからです。
    <p>
    もし、まだ鳫隨粤銷ぢファイルがない場合で (このファイルは OpenBSD 3.3 以前の
    バージョンではインストールされません)、<em>crontab</em> をスーパーユーザ以外の
    ユーザ権限で実行したい場合には、このファイルが必要となります。
<pre>
  # install -c -o root -g crontab -m 660 /dev/null /var/cron/cron.deny
</pre>

    <a name="3.1"></a>
    <h2>
      3.1 からのアップグレード
    </h2>
    
    <a name="3.1.1"></a>
    <h3>
      3.1.1: 新しいユーザ/グループ
    </h3>

    <p>いくつかの新しいユーザ/グループが追加されました。
      <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=authpf&amp;sektion=8">authpf(8)</a>
      のサポートのため、新しいグループが必要になりました。また、
      <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sshd&amp;sektion=8">sshd(8)</a>
      の特権分離機能のサポートのため、<em>sshd</em> という
      新しいユーザとグループがシステムに追加されました。
      システムサービス用に、さらにいくつかの
      &quot;_&quot; をプレフィクスとして持つ
      新しいユーザが追加されました。
      <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=vipw&amp;sektion=8">vipw(8)</a>
      を使用して、次のユーザエントリを追加してくだ世気ぁ
鹿霈
腫鱚齠葢昏魂刑卸査虻虻齠葢鱸辮痕鬲纃頸砠遲鈿跫芍熕闥瘰昏魂減恩査虻虻竟鶯轣雕癇逅痕黷蜴闌閾蜴
煢粤銓篋温魂杭紺紺咲粤銓篋癇逅痕黷蜴闌閾蜴
熬齡癆篋外些虻紺紺昨鞦齡癆篋癇逅痕黷蜴闌閾蜴
熬纈黻昏些穏害査虻虻鴃祟鴣黼鴦篋癇逅痕黷蜴闌閾蜴
煕蜴艱鰾昏些該崖査虻虻肅鈑纈篋癇逅痕黷蜴闌閾蜴
燔臼昏些戯概査虻虻黼鴟纈痕鬲纃頸砠遲鈿跫芍鹿頏緇

腫ぢまた、次のような行を /etc/group に追加します。</p>
       
<pre>
  sshd:*:27:
  _portmap:*:28:
  _identd:*:29:
  _rstatd:*:30:
  _rusersd:*:32:
  _fingerd:*:33:
  _sshagnt:*:34:
  _x11:*:35:
  authpf:*:72:
</pre>

    <a name="3.1.2"></a>
    <h3>
      3.1.2: crontab(1) と at(1) のための新しいグループ
    </h3>

    <p>
      <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=crontab&amp;sektion=1">
      crontab(1)</a> と
      <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=at&amp;sektion=1">
      at(1)</a>
      コマンドは、もはや setuid root されたものではなくなり、
      <em>crontab</em> グループに setgid されたものになりました。

    <p>
      &quot;make build&quot; を実行する前に、
      <em>crontab</em> グループを追加する必要があるでしょう。
      <tt>/etc/group</tt> ファイルに次のような行を追加してくだ世気ぁ鹿霈

腫鱚竰闔盧橋鹿頏緇

腫また、&quot;make build&quot; は、パーミッションも更新しますが、
      すべてではありませんので、&quot;make build&quot; の終了後に、
      次のコマンドを手動で実行してくだ世気儒蜴鼈鹿を仮定します)。
</p>

<pre>
  # chgrp crontab /var/at/at.{allow,deny} /var/cron/{allow,deny}
  # chmod 0640 /var/at/at.{allow,deny} /var/cron/{allow,deny}
  # foreach f ( /var/cron/tabs/* )
	  set u=`basename $f`
 	  chown $u:crontab $f
    end
</pre>

<p>
      もっとも、たぶん allow/deny ファイルが全然ないと思いますので、
      これは問題にはならないとは思います。
</p>

    <a name="3.1.3"></a>
    <h3>
      3.1.3: 新しい binutils
    </h3>

<p>
新しい binutils (2.11.2) がツリーに導入されましたが、これは更新済の <em>libiberty</em>
を必要としています。このライブラリを構築するには、次のステップに従ってくだ世気ぁ
鹿霈

腫鱚邃鬲齟祚芬繚笂蛯蛯纈
轣諷浴諷肅跂黻鱇韶纈跂瘤粡轣諷浴諷肅跂黻鱇韶纈礪
轣諷浴諷肅跂黻鱇韶纈辮緕轣諷浴諷肅跂黻鱇韶纈
轣諷浴諷肅跂黻鱇韶纈銖跛
鹿頏緇

釈瘢綵⊂鹿畩
取馨
凱窺敢ぢ新しい S/Key の構誓
鹿莖
腫古い S/Key データベースファイルである <tt>/etc/skeykeys</tt> は、<tt>/etc/skey</tt>
      というディレクトリに置き換えられ、それぞれのレコードは、それが記述しているユーザが
      所有する個々のファイルになりました。<tt>/etc/skeykeys</tt> を (root 権限で) 次の
      コマンドを実行することで新しい形式に変換することができます。
    </p>
<pre>
  # skeyinit -C
  # mv /etc/skeykeys /etc/skeykeys.OLD
</pre>

<p>
      すべての S/Key ディレクトリを使用するサードパーティープログラムについては、
      再コンパイルする必要があるということに注意してくだ世気ぁ
鹿霈

釈瘢綵⊂鹿畩
取馨
凱窺戯險ぢのための新しいパーミッション
    </h3>

    <p>
      現在では、lpr にファイルをスプール可能にするため、lpd の使用する
      ディレクトリは daemon グループが書き込み可能でなければなりません。
      さらに、スプールディレクトリ中のファイルは、所有者・グループ共に
      daemon でなければなりません。これは、次の方法で変更できます。
    </p>
<pre>
 # find /var/spool/output /var/spool/lpd -type d \
	-execdir chgrp daemon {} \; -execdir chmod g+rwx {} \;
 # find /var/spool/output /var/spool/lpd -type f \
	-execdir chown daemon:daemon {} \;
</pre>

    <a name="3.1.6"></a>
    <h3>
      3.1.6: atrun(8) はもはや不要
    </h3>

    <p>
      <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=atrun&amp;sektion=8">atrun(8)</a>
      コマンドが、もはや不要のものとなりました。その機能は、
      <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=cron&amp;sektion=8">cron(8)</a>.
      に統合されました。次のコマンドを root で実行して、<tt>/usr/libexec/atrun</tt>
      のジョブを root の crontab から削除してくだ世気ぁ
鹿霈
腫鱚竰闔
鹿頏緇

腫また、<tt>/usr/libexec/atrun</tt>、
      <tt>/usr/share/man/cat8/atrun.0</tt> および
      <tt>/var/at/spool</tt> ディレクトリも削除可能です。
    </p>

    <a name="3.1.7"></a>
    <h3>
      3.1.7: nat.conf の pf.conf へのマージ
    </h3>

    <p>
       <tt>/etc/nat.conf</tt> は <tt>/etc/pf.conf</tt> にマージされました。
       NAT ルールは、pf.conf の scrub ルールとフィルタルールとの間に挿入
       してくだ世気ぁ
鹿霈
腫蓿繙就蔗痕鞳鈞黻鱧芍蜴瘤芍髄鴒署聶逅雌繼闔集⊂鞴笏讎県鹿畩
ぢには、ルールセットをロードするための新しいオプション -f が実装され、
       -R および -N オプションには新しい意味が付加されました。man ページを
       確認して、確実に <tt>/etc/rc</tt> を更新するようにしてくだ世気ぁ
鹿霈

釈瘢綵⊂鹿畩
取馨
用の新しい fbtab 必須エントリ
    </h3>

    <p>
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=login&amp;sektion=1">
login(1)</a> は、多くのアーキテクチャで xdm が特権を放棄するために使用する、
新しい _x11 ユーザに /dev/wsmouse を chown する必要があります。<tt>/etc/fbtab</tt>
への変更は、アーキテクチャに依存します。ファイルは (それが /usr/src にあると
仮定して)、以下のプロセスで誓言成してくだ世気ぁ
鹿霈
腫鱚竅齟鱆碪痰縺碪痰
竅齟鱆瘢牆聰松續祚聰竅齟鱆碪痰瘟松續祚聰鹿頏緇
腫もし、あなたが <tt>/etc/fbtab</tt> に特別な変更を施している場合には、それらを
手動で新しいファイルにマージする必要があります。
</p>
   <a name="3.1.9"></a>
   <h3>
    3.1.9: ある種の関数への __attribute__((sentinel)) の使用
   </h3>

   <p>
     __attribute__((sentinel)) は、
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=exec&amp;sektion=3">
exec(3)</a> 関数が NULL ポインタで終端していない状態で使用された場合に
     警告を発するために使用されるようになります。
     <br><br><tt>make build</tt> に誓茲誓って、ミニ FAQ の
     <a href="#1.8">1.8</a> 章に従って、
     gcc を再構築しなければなりません。
   </p>

    <a name="3.0"></a>
    <h2>
      3.0 からのアップグレード
    </h2>
    
    <a name="3.0.1"></a>
    <h3>
      3.0.1: mtree(8) でサポートされる新しいキーワード
    </h3>

    <p>
      &quot;make build&quot; が誓垢襪燭瓩砲蓮⊃靴靴ぅ弌璽献腑鵑
釈鱚羹∵雕關緕碵筮闥膀竍薛砠遲轣隨竍蘓髟纈逕鱚絋瘢雹黼謾蜿扈権壌繞┯
ユーティリティを構築して、インストールする必要があります。
    </p>
<pre>
  # cd /usr/src/usr.sbin/mtree
  # make cleandir
  # make obj
  # make depend
  # make
  # make install
</pre>

    <a name="3.0.2"></a>
    <h3>
      3.0.2: ELF プラットフォームからの libdl の削除
    </h3>
    
    <p>
      ELF ベースのプラットフォーム (alpha と macppc、sparc64) では、もう
      libdl は使用されなくなりました。libdl を使用するシステムから使用しない
      システムへのアップグレードは、次のステップで行うのが最も良いでしょう。
    </p>

    <ul>
      <li>
	<p>システムの再コンパイルを行います。</p>
<pre>
  # cd /usr/src
  # make build
</pre>
      </li>

      <li>
	<p>
	  &quot;make build&quot; が誓靴燭覆蕁⊆，離好謄奪廚某覆爐海箸
	でき、libdl も削除することができます。ただ世掘△海譴鬟螢鵐靴討い
	鞜站瘍纉ぢは、その後に再インストールすべきであることに注意して
	  くだ世気ぁ修僚猗任討い覆い覆蕁⊆茲蠅△┐此△海離好謄奪廚
	飛ばすこともできます。誓気靴痺諱艱が用意された snapshot が
	  用意されます。
	</p>
<pre>
  # rm -f /usr/lib/libdl.* /usr/lib/libdl_pic.a
</pre>
	</li>
      <li>
	<p>
	  libdl を削除したら、シェアードライブラリのキャッシュを再誓言成してくだ世気ぁ
	鹿霈
	
腫鱚趙竢鈕蜃鹿頏緇
鹿跚鹿
釈瘢綵⊂鹿畩
取馨
凱握該ぢリグレッションテスト用の新しいフレームワーク
    </h3>
    
    <p>
      リグレッションテスト用の新しいインフラストラクチャーが導入され、
      <tt>bsd.regress.mk</tt> が追加されました。<em>make obj</em> を
      実行する前に、このファイルをインストールしておく必要があります。
    </p>

<pre>
  # cd /usr/src/share/mk
  # make install
</pre>

    <a name="3.0.4"></a>
    <h3>
      3.0.4: /etc/ssh/ に移動された ssh の誓瀋螢侫．ぅ
鹿莖
腫まず、/etc/ssh/ を作誓垢詆廚△蠅泙后
釈鱚羹■窺嘘⊂窺嘘鹿畩ぢを参照してくだ世気ぁ
鹿霈

腫システムの再コンパイルを行います。
    </p>
<pre>
  # cd /usr/src
  # make build
</pre>

    <p>
      /etc/ssh*_* ファイルを、新しく作誓靴續祚齠莚ぢディレクトリに移動します。
    </p>
<pre>
  # cd /etc
  # mv ssh*_* ssh/
</pre>

    <p>
      これらの変更を反映するため、
      <a href="http://www.openbsd.org/cgi-bin/cvsweb/src/etc/rc.diff?r1=1.188&amp;r2=1.189">
	<tt>rc</tt> スクリプトを変更</a>
      する必要があります。
    </p>

    <p>
      新しい場所を反映するように、sshd_config ファイルの中の <tt>HostKey</tt>
      の行を更新します。たとえば、
    </p>
<pre>
  HostKey /etc/ssh_host_key
</pre>

    <p>というのは次のように変更します。</p>

<pre>
  HostKey /etc/ssh/ssh_host_key
</pre>

    <p>
      これらの変更後、sshd デーモンを再起動してくだ世気ぁ
鹿霈

釈瘢綵⊂鹿畩取仮荻からのアップグレード</h2>

    <a name="2.9.1"></a> 
    <h3>2.9.1: 新しいユーザ/グループ - <em>proxy</em> と
      <em>smmsp</em>、<em>popa3d</em></h3>

    <p>
      まず、
      <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf&amp;sektion=4">pf(4)</a>
      パケットフィルタリングパッケージ、
      および、その構誓覆
釈鱚羹∵雕關緕碵筮闥膀竍薛砠遲轣隨竍蘓髟纈胄隲頏陂瘢雹黼謾蜿扈権丈鳫┯の追加にともなって、
      <em>proxy</em> という、
      新しいユーザとグループがシステムに追加されました。
      この新しい追加機能をサポートするため、
      <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=vipw&amp;sektion=8">vipw(8)</a>
      を使用して、次のようなユーザエントリを追加してくだ世気ぁ鹿霈

腫鱚頏陂訓嵯浦紺紺歳鳫纈竇鷓闔纔蜩銓痕黷蜴闌閾蜴
鹿頏緇

腫樵踈痲弱躱頏陂躱鳫鳫瑳
腫鱚頏陂訓鹿頏緇

腫ぢ次に、sendmail 8.12 のアップグレードにともなって、sendmail は
      もはや setuid root としては実行されなくなりました。<em>smmsp</em>
      という、新しいユーザと新しいグループがシステムに追加されましたので、
      次のような行を <tt>/etc/group</tt> に追加します。</p>

<pre>
smmsp:*:25:
</pre>

    <p>そして、
      <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=vipw&amp;sektion=8">vipw(8)</a>
      を実行して、
      <em>smmsp</em> ユーザのための次のような行を
      追加してくだ世気ぁ鹿霈

腫鱚鼾逑雕乙魂戯紺紺采緕粱瘟羅齠瘍囎硴蜩皷闔鳫苒瘢痕鈿鈬齡緕砠遲鈿跫芍鹿頏緇

腫ぢこの行が、
      <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=yp&amp;sektion=8">yp(8)</a>
      を誓瀋蠅垢襪燭瓩旅圓茲蠅眩阿砲△襪海箸魍稜Г靴討誓さい。</p>

    <p>最後に、システムの構誓里劼箸弔箸覆辰拭囂赱偵皷芬纈ぢの
      popa3d サーバのための、新しいユーザと新しいグループが追加されました。
      次のような行を <tt>/etc/group</tt> に追加します。</p>

<pre>
popa3d:*:26:
</pre>

    <p>そして、
      <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=vipw&amp;sektion=8">vipw(8)</a>
      を使用して、次の行を追加してくだ世気ぁ鹿霈
腫鱚竟鞜割昏魂矯俺査虻虻佻亞纈鮑癇逅痕黷蜴闌閾蜴
鹿頏緇

釈瘢綵⊂鹿畩取馨荻庚穏ぢ新しいパケットフィルタ: <em>pf</em></h3>

    <p>以前の OpenBSD の release の部品だ世辰
賓パケットフィルタリングパッケージは、
      <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf&amp;sektion=4">pf(4)</a>
      と呼ばれる、完全に新しいパケットフィルタリング
      パッケージと置き換えられました。その結果として、
      多くの変更を行う必要があります。</p>

    <p>まず、<em>pf</em> には新しいデバイスファイルが必要です。次のようにして、
      この新しいスペシャルデバイスが作誓気譴討い襪海箸魍稜Г靴討誓さい。</p>

<pre>
  # cd /dev
  # cp /usr/src/etc/etc.`machine`/MAKEDEV ./
  # ./MAKEDEV all
</pre>

    <p>次に、多くのファイルの変更が行われました。参考までに、
      次のバイナリが置き換えられました。</p>

<pre>
OLD:
/sbin/ipf /sbin/ipfstat /sbin/ipnat /usr/sbin/ipfs
/usr/sbin/ipftest /usr/sbin/ipmon /usr/sbin/ipresend
/usr/sbin/ipsend /usr/sbin/iptest
NEW:
/sbin/pfctl
/usr/libexec/ftp-proxy
</pre>

    <p>同様に、デバイスの方も次のように置き換えられ、</p>

<pre>
OLD: /dev/ipl /dev/ipnat /dev/ipstate /dev/ipauth
NEW: /dev/pf
</pre>

    <p>そしてフィルタ誓瀋螢侫．ぅ襪蘯，里茲Δ肪屬垢┐蕕譴泙靴拭鹿霈

腫鱚鰐頂續祚蜷罧鴣跂韲癆纉
療弸續祚鞴闔癆闔鹿頏緇
腫ぢ古い IPfilter のサンプル誓瀋螢侫．ぅ襪肋探遒靴討盥修錣覆い任靴腓Α
鹿霈
腫鱚鴉鱠鬲鼈癇絲蜷鹿頏緇

腫昭纃情羲躱ぢを安全に有効化するためのメカニズムが、
      <tt>/etc/rc</tt> と <tt>/etc/rc.conf</tt> ファイルに追加されました。
      新しいフックメカニズムを含むこれらのファイルを、更新する必要が
      あります。<em>pf</em> を有効化するには、<tt>/etc/rc.conf</tt>
      の中に、PF=YES をセットします。</p>

    <a name="2.9.3"></a> 
    <h3>2.9.3: <em>make</em> への変更点鹿莖
腫昭蓿繙就蔗痕鞳鈞黻鱧芍蜴瘤芍髄鴒渚瘠絋瘢雹黼謾蜿扈陰壌瘠紲羽鹿畩
と、そのデータファイルに変更が加えられましたが、
      それが構築のプロセスでの障害の原因となるかも知れません。
      これは通常、構築の際に、<em>bsd.own.mk</em> の中で発誓犬垢
エラーとして現われます。この問題を回避するためには、
      次のデータファイルをまず更新してくだ世気ぁ鹿霈
腫鱚邃鬲齟祚鼈癇絲迢
轣諷銖跛
鹿頏緇

腫ぢそして次に、新しい make を構築し、インストールします。</p>

<pre>
  # cd /usr/src/usr.bin/make
  # make clean &amp;&amp; make obj &amp;&amp; make depend &amp;&amp; make
  # make install
</pre>

    <p>さぁ、アップグレードを継続してくだ世気ぁ鹿霈

釈瘢綵⊂鹿畩
取馨荻庚敢纈矼鳫黏ぢのエラーが原因の構築の失敗</h3>

    <p>システム全体の構築を始める前に、まず、KerberosV の構築を
      行う必要があります。</p>

    <p>まず、<em>/etc</em> の下に新しい KerberosV 用の誓瀋螢侫．ぅ詬僂
が作られました。もし、このディレクトリをまだ精遒辰討い覆い里任靴燭蕁
釈鱚羹■窺嘘⊂窺嘘ぢ章</a> に記述されている
      <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mtree&amp;sektion=8">mtree(8)</a>
      を使用して作誓靴討誓さい。</p>

    <p>では、KerberosV を構築しましょう。</p>

<pre>
  # cd /usr/src/kerberosV
  # make obj
  # cd lib/roken
  # make 
  # cd ../../usr.bin/asn1_compile
  # make
  # make install
</pre>

    <p><tt>/usr/libexec/auth/login_krb-or-pwd</tt>  は
      <tt>login_krb<strong>4</strong>-or-pwd</tt> に
      ファイル名が変更されましたが、これを反映するよう
      <tt>/etc/login.conf</tt> を更新する必要もあります。</p>

    <a name="2.9.5"></a> 
    <h3>2.9.5: 新バージョンの <em>sendmail</em></h3>

    <p><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sendmail&amp;sektion=8">sendmail(8)</a>
      は、バージョン 8.12 へとアップグレードされました。
      このバージョンの <em>sendmail</em> は、
      もはや setuid root として実行されなくなりました。
      このため、大きな変更が行われました。</p>

    <ol>
      <li>新しいユーザと新しいグループ (<em>smmsp</em>) が追加されました。
	これらのユーザの作誓泙誓でしたら、<a href="#2.9.1">2.9.1 章</a>
	の手順に従って、作誓靴討誓さい。</li>

      <li><tt>新しい /var/spool/clientmqueue</tt> ディレクトリや
	<tt>/var/spool/mqueue</tt> の新しいパーミッションなど、
	ファイルの階層構造にいくつかの変更が行われました。
	これらの変更には、
	<a href="#1.13">1.13 章</a> に記述されている
	<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mtree&amp;sektion=8">mtree(8)</a>
	を使用することができます。</li>

      <li>
        <p>以下に示す行を、root の
	  <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=crontab&amp;sektion=1">crontab(1)</a>
	  に追加してくだ世気ぁ弱躱黼鈔轣蛹鹿纃は、
	  もはや setuid root バイナリではなくなりましたので、
	  その仕事に一部は、これに依存するようになりました。</p>

<pre>
# sendmail clientmqueue runner
*/30    *       *       *       *       /usr/sbin/sendmail -L sm-msp-queue -Ac -q
</pre>

      </li>
      
      <li>
        <p>sendmail をアップグレードします。</p>

<pre>
  # cd /usr/src/gnu/usr.sbin/sendmail
  # make clean &amp;&amp; make obj &amp;&amp; make depend &amp;&amp; make &amp;&amp; make install
</pre>

        <p><strong>注:</strong> <tt>submit.cf</tt> と
	  <tt>localhost.cf</tt> は、
	  <tt>/etc/mail</tt> ディレクトリにインストールされています。
	  前者の <tt>submit.cf</tt> (これは、現在の sendmail のドキュメンテーション
	  にある、"クライアント" 機能用誓瀋螢侫．ぅ襪箸靴道仮箸気譴泙は、
	  sendmail でローカルにメールを配送しようとするユーザのメーラー (MUA) が
	  使用します。上述のとおり、パーミッションの変更によって、これらは
	  root 権限を必要としなくなり、sendmail のバイナリは、smmsp に
	  setgid されるようになりました。
	  後者の <tt>localhost.cf</tt> は、
	  sendmail がローカルホストからのメールを受信するのに、
	  localhost インターフェースのみを待ち受けるようにして、
	  ネットワークからの誓楝海鮗栄佞韻覆い箸いΑ
	いわゆるひとつの OpenBSD の流儀です (たとえば、
	  外部インターフェースの SMTP ポートを待ち受けるのに、
	  <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=smtpd&amp;sektion=8">smtpd(8)</a>
	  などを使用しているのなら、間違いなくこれを必要とするでしょう)。
	  より詳しくは、<tt>/usr/src/gnu/usr.sbin/sendmail/sendmail</tt> ディレクトリの下の
	  <tt>SECURITY</tt> ファイルを参照してくだ世気ぁ鹿霈

腫昭少續祚轣蛹鹿の下の sendmail の誓瀋螢侫．ぅ襪鮑得生誓掘
	更新することを強く推奨します。<tt>/usr/share/sendmail/cf</tt>
	  の下に、使えそうな構誓侫．ぅ襪鮓弔韻蕕譴襪眞里譴泙擦鵝
	跫竅跏闢竊ぢは、openbsd-localhost.mc から
	  誓言成されたものだ世箸いΔ海箸肪躇佞靴討誓さい。</p>
      </li>

      <li>
        <p>インストール後のデフォルトの誓瀋蠅修Δ任△襪茲Δ法
	儒祟竢鈕鹿の中で <tt>-bd</tt> オプションを指定せずに
	  sendmail を実行しているのなら、<tt>localhost.cf</tt> を
	  使用する必要があります。次のように、これが使われるよう、
	  <tt>rc.conf</tt> を編集しましょう。</p>
<pre>
# For normal use: "-L sm-mta -bd -q30m"
sendmail_flags="-L sm-mta -C/etc/mail/localhost.cf -bd -q30m"
</pre>
      </li>

      <li>
        <p>誓瀋螢侫．ぅ襪僚猗任燭蕁什濕孫埣罎緕粱瘟を
         <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=kill&amp;sektion=1">kill(1)</a>
         しましょう。</p>
<pre>
  kill `sed 1q /var/run/sendmail.pid`
</pre>

        <p>これで、誓気靴ぅ廛轡腑鵑膿靴靴緕粱瘟が再起動されます。
	  たとえば、外部からのメールを受け付ける場合は、</p>
<pre>
  /usr/sbin/sendmail -L sm-mta -bd -q30m
</pre>

        <p>のようになりますし、また、ローカルのメールのみの誓瀋蠅覆蕁鹿霈

腫鱚齟砠遲黼鈔轣蛹鼾誰續祚轣蛹閭瘡蓖齡外鹿頏緇

腫ぢのようになります。</p>

        <p><strong>注:</strong> <tt>-bd</tt> オプションは、現在は、
	  どちらのケースでも必要とされます。</p>
      </li>
    </ol>

    <p>これで、新しい <em>sendmail</em> が実行されているはずです。</p>

    <a name="2.9.6"></a> 
    <h3>2.9.6: <tt>/etc/primes</tt> の移動</h3>

    <p><tt>/etc/primes</tt> は <tt>/etc/moduli</tt> に
      ファイル名が変更されました。古いファイルをリネームするか、
      または、<tt>/usr/src/etc</tt> から単にコピーしてくだ世気ぁ鹿霈


釈瘢綵⊂鹿畩取仮荻からのアップグレード</h2>


<a name="2.8.1"></a> 
<h3>2.8.1: 新しい <em>auth</em> グループ</h3>

<p>GID 11 の新しいグループ <em>auth</em> がシステムに追加されました。
<tt>/etc/group</tt> ファイルに以下のような行を
追加してくだ世気ぁ鹿霈

腫鱚癜昏艮浦
鹿頏緇

釈瘢綵⊂鹿畩取馨荻軒穏ぢ新しいコンソールシステム <em>wscons</em></h3>

<p><em>pcvt</em> コンソールドライバは <em>wscons</em>
コンソールシステムで置換されます。wscons を使用する前には、wscons
関連のデバイスを誓言成しておく必要があります。最新の MAKEDEV
がインストールされていることを確認し、すべてのドライバを make してくだ世気ぁ鹿霈

腫鱚齟鱆蓋強輿謀津纐阻田砥
纐
阻田砥跛
鹿頏緇

腫ぢもし、X を実行しているのなら、その <em>XF86Config</em> ファイルの
Pointer セクションを、以下の例のような行を含むよう変更してくだ世気ぁ鹿霈

腫鱚會阡閭闌†鼾阨黼偵竇粤迴紜
鹿頏緇

釈瘢綵⊂鹿畩取馨荻軒該ぢ未定義のシンボルによるカーネルのコンパイルの失敗</h3>

<p><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=config&amp;sektion=8">config(8)</a> が更新されました。
古い <em>config</em> を使用して構築するのは、以下のようなエラーの原因となってしまいます。</p>
<pre>
  Undefined symbol `_pdevnames_size' referenced
  Undefined symbol `_pdevnames' referenced
</pre>

<p>これを修誓気垢襪燭瓩砲蓮⊃靴靴纃障闔肅膽躱ぢをコンパイルし、インストールしてくだ世気ぁ鹿霈
腫鱚邃鬲齟祚鬯黷蜴闔肅轣諷跂瘤瘢雹逅轣諷辮緕逅殺瘢雹瘠轣諷銖跛
鹿頏緇

腫ぢこれで、以前のように新しいカーネルをコンパイルできるようになりました。</p>


<a name="2.7"></a>
<h2>
2.7 からのアップグレード
</h2>

<a name="2.7.1"></a>
<h3>
2.7.1: 2.7 から 2.8 へのアップグレードでの大きな問題は何でしょう ?
</h3>

<p>
自己参照 <em>libc</em> ライブラリの誓言成を非常に簡単にすることのできる
gcc の大規模な変更が導入されました。この理由により、アップグレードするためには、 
以下の手順を誓騎里房孫圓靴討誓さい。
</p>

<ol>
<li> ソースツリーから<a href="upgrade-minifaq.html#1.10">ゴミを消去</a>し、
2.8 のソースコードを取得世靴討誓さい。</li>

<li>
<p>
 新しいリンカをビルドしてインストールします。これは、<em>gcc</em>
全体をビルドする前に実行する<strong>必要があります</strong>。
</p>
<pre>
  $ cd /usr/src/gnu/usr.bin/ld
  $ make clean &amp;&amp; make obj &amp;&amp; make
  $ sudo make install
</pre>
</li>
<li> 新しい <em>gcc</em> をビルドし、インストールします。
     <a href="upgrade-minifaq.html#1.8">BOOTSTRAP</a> の手順により、
     この作業を高速化することができます。
</li>

<li>
<p> 新しいカーネルを構築します。ただ世掘△泙誓インストールしないでくだ世気ぁ鹿霈
腫鱚邃鬲齟祚齷鶩癇竏轣竏蜴縲闔竢鈕蜃杜賭秒
邃竢逅蛹絲播療夘轣諷跂瘤瘢雹逅轣諷辮緕逅殺瘢雹瘠鹿頏緇
鹿跚
殊蘊腫いくつかの libc の変更のため、<tt>/etc/resolv.conf</tt> に <em>lookup file bind</em>
   という行が含まれていないと、起動時にマシンがハングアップするかも知れません。
   必要なら、この行を追加してくだ世気ぁ鹿霈
腫鱚繝蓖髟阡詞闖謨肅跂蜴筅髟阡續祚鱚齒踝闔鹿頏緇
鹿跚殊蘊ぢ新しいカーネルをインストールし、マシンを再起動してくだ世気ぁ
腫鱚邃鬲齟祚齷鶩癇竏轣竏蜴縲闕韈跂杜賭秒
逍碵黻趙
逍黻碵竏阯鳫阡蒹繻碵鼈粹鈿鹿頏緇
腫ぢもし、このステップが失敗した場合には、<tt>boot&gt;</tt> プロンプトに
古いカーネル - bsd.old - を指定してリカバーすることができます。)</p>
</li>
<li> 
<p>新しい make (とそのサポートファイル) をビルドし、インストールします。
     その際に <tt>make depend</tt> のステップを忘れずに実行してくだ世気ぁ
鹿霈
腫鱚邃鬲齟祚鬯砠遲轣諷
轣諷跂瘤瘢雹逅轣諷礪瘢雹逅轣諷辮緕逅殺瘢雹瘠齦粹瘠蜴齡瘡邃鬲齟祚鼈癇絲迢
齦粹瘠蜴齡瘡鹿頏緇
鹿跚
殊蘊
腫ぢ最新の <em>mtree</em> をインストールし、必要なディレクトリ構造が
     存在していることを確認しておいてくだ世気ぁ鹿霈
腫鱚邃鬲齟祚續祚逕鱚齦粹銖跛闖蒹繻幹堪澗喞蜩繞
齦粹繞驗繙續祚逕鱚絲
鹿頏緇
鹿跚
殊蘊ぢここで、make build を実行します。
<pre>
  # cd /usr/src &amp;&amp; make build
</pre>
</li>

<li> そして、<a href="upgrade-minifaq.html#1.9"><tt>/etc</tt> <tt>/var</tt>
     ならびに <tt>/dev/MAKEDEV</tt></a> を手動で更新してくだ世気ぁ

鹿跚鹿闌
釈瘢綵⊂鹿畩
取仮
荻からのアップグレード
</h2>

<a name="2.6.1"></a>
<h3>
2.6.1: Termcap のエントリが長過ぎます
</h3>

<p>
新しい <tt>termcaps.master</tt> ファイルが作誓気譴泙靴拭海里燭瓠
現行バージョンの
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tic&amp;sektion=1">tic(1)</a>
を使用して、<tt>terminfo</tt> と <tt>termcaps</tt> ファイルの再誓言成が必要となります。
もし、<em>make build</em> でアップグレードを行う場合、現行バージョンの tic(1)
を使用して、この再誓言成が実行されます。この作業を実行していない場合、
以下のようなエラーが発誓犬靴泙后
鹿霈

腫鱚鴉蜴肬鱆竢鴪堯阨繞鞣癆齟蜴蜒
鹿頏緇

腫この場合、(現行バージョンの <tt>libcurses</tt> が確実に使用されるようにして)
tic(1) を再構築してインストールしなければなりません。または、ソースツリー中の
バージョンの tic(1) を単純に構築してくだ世気ぁ
鹿霈

釈瘢綵⊂鹿畩
取馨
荻峡穏纃情郤躱または <em>mx</em>、<em>al</em>、<em>ax</em>)
デバイスをカーネルが認識しなくなりました
</h3>

<p> (注: 単純化のため、<em>pn</em> を以下で使用しています。これは、
必要に応じて、<em>pn</em>、<em>mx</em>、<em>al</em> または <em>ax</em>
に読み換えてくだ世気ぁ鹿霈

腫これらの 4 個のドライバは、単一の <em>dc</em> ドライバで置換されました。
誓瀋螢侫．ぅ訝罎妨修譴襪垢戮討纃情遞鹿纃ぢ、<em>mx</em>、<em>al</em> や
<em>ax</em> を変更する必要があります。これは、以下のものを含みます。
</p>

<ul>
<li>カーネル誓瀋螢侫．ぅ襪旅洪ヒント: まっさらな GENERIC
    カーネルから始め、ここから変更しましょう)。
</li>
<li><tt>/etc/hostname.pn*</tt> を <tt>/etc/hostname.dc*</tt> にリネーム。
</li>
<li><tt>/etc/ifaliases</tt> ファイルの更新。
</li>
<li>新しいインターフェイス名を反映するための、
    <tt>/etc/ipnat.rules</tt> および <tt>/etc/ipf.rules</tt> の変更。</li>
</ul>

<p>
カスタムカーネルを変更する場合には、カーネル誓瀋螢侫．ぅ訝罎
以下のように <em>dcphy</em> デバイスが含まれていることを確認してくだ世気ぁ
鹿霈

腫鱚粃韆癆蜑韆堤芍柱闔佝搏
鹿頏緇

腫ぢこの変更の際、以下のデバイスも追加して構いません。</p>

<pre>
ukphy*  at mii? phy ?                           # "unknown" PHYs
</pre>

<a name="2.6.3"></a>
<h3>
2.6.3: GCC 2.95.1 から 2.95.2 へのアップグレード
</h3>

<p>2000 年 1 月 19 日ころ、<em>gcc</em> 2.95.2 が OpenBSD
のソースツリーにマージされました。従って、誓気靴纃丞窿鹿纃をビルドするため、
最近の (2.6 以後の) <em>libiberty</em> が必要になります。
このライブラリをビルドは、以下の手順で行ってくだ世気ぁ鹿霈

腫鱚	邃鬲齟祚芬繚笂蛯蛯纈
	轣諷浴諷肅跂黻鱇韶纈跂瘤
	轣諷浴諷肅跂黻鱇韶纈礪
	轣諷浴諷肅跂黻鱇韶纈
	轣諷浴諷肅跂黻鱇韶纈銖跛
鹿頏緇

腫注: pmax のような MIPS ベースのアーキテクチャでは、新しいライブラリのビルド後、
明声纃場粃闔肅膽躱ぢを実行する必要があります。
</p>

<p><em>libiberty</em> がビルドできたら、標準的な <em>gcc</em>
のブートストラップを進めてくだ世気ぁ鹿霈

腫鱚齟鱆銛艫鶩艫瘠瘠繙蛹絎碵筬瘰鞳竚縺瘠瘠繙蛹絎碵筬瘰鞳閧瘠瘠繙蛹絎碵筬瘰鞳堆嘖卅瘠瘠繙蛹絎碵筬瘰鞳堆嘖卅蜴齡瘡瘠瘠繙蛹絎碵筬瘰鞳竚縺瘠瘠繙蛹絎碵筬瘰鞳
瘠瘠繙蛹絎碵筬瘰鞳蜴齡瘡鹿頏緇

釈瘢綵⊂鹿畩
取馨
荻峡敢纈矼鳫のアップグレード
</h3>

<p>
Kerberos IV を誓気靴咼襯匹垢襪燭瓠
以下の手順を実行する必要があります。
</p>

<ul>
<li>
<p> 最新の <tt>usr.bin/compile_et</tt> を取得世掘▲咼襯匹靴泙后鹿霈
腫鱚齟鱆齟蜴闕韈跂煥瘠竚縺逅殺瘢雹瘠粤鞳鈔瘢雹逅轣諷瘢雹逅轣諷銖跛
鹿頏緇
鹿跚
殊蘊
腫最新の <tt>lib/libcom_err</tt> を取得世掘▲咼襯匹靴泙后鹿霈
腫鱚齟鱆蛯蛯竢轜纈瘠竚縺逅殺瘢雹瘠粤鞳鈔瘢雹逅轣諷瘢雹逅轣諷銖跛
鹿頏緇
鹿跚
殊蘊
腫いったん Kerberos ヘッダ瀬侫．ぅ襪両探遒靴董∈謄ぅ鵐好函璽襪靴泙后鹿霈
腫鱚鴉齟釿跿粤纈矼鳫麌岶邃鬲齟祚諷鰲纈闢埠
轣諷釿跿粤鹿頏緇
鹿跚殊蘊
腫ここで、Kerberos ライブラリファイルを再構築してくだ世気ぁ鹿霈
腫鱚齟鱆纈矼鳫麌岶跚瘠竚縺逅殺瘢雹瘠粤鞳鈔瘢雹逅轣諷瘢雹逅轣諷銖跛
鹿頏緇
鹿跚殊蘊
腫完全な make build を実行しない場合には Kerberos を再構築する必要があります。</p>
<pre>
   # cd /usr/src/kerberosIV
   # make cleandir &amp;&amp; make depend &amp;&amp; make &amp;&amp; make install
</pre>
</li>
<li> 上記を実行しない場合には、単に <em>make build</em> を再開してくだ世気ぁ鹿跚鹿

釈瘢綵⊂鹿畩
取馨
荻峡戯のアップグレード
</h3>

<p>
OpenBSD 2.6 とともに出荷されているバージョンの m4 は、sendmail の .mc ファイルを
.cf ファイルに変換する際に、無限ループに入ってしまうことがあります。このため、
<em>make build</em> を実行しようとする<strong>前</strong>に、新しいバージョンの m4
をインストールする必要があります。そのためには、以下のような処理を行ってくだ世気ぁ
鹿霈

腫鱚邃鬲齟祚鬯砠遲躊
轣諷瘢雹逅轣諷銖跛瘢雹逅轣諷跂瘤粡鹿頏緇

釈瘢綵⊂鹿畩
取馨
荻峡矯緕粱瘟のアップグレード
</h3>

<p>
sendmail 8.10.X では、sendmail 誓瀋螢侫．ぅ襪両貊と名前) が変更されました。
PID ファイル以外のすべてのファイルは、/etc/mail の下に置かれるようになりました。
さらに、いくつかのファイルで、そのファイル名が変更されました。
</p>

<table border="0">
<tr>
  <td><strong>OLD</strong></td>
  <td><strong>NEW</strong></td>
</tr>
<tr>
  <td><tt>/etc/sendmail.cf</tt></td>
  <td><tt>/etc/mail/sendmail.cf</tt></td>
</tr>
<tr>
  <td><tt>/etc/sendmail.cw</tt></td>
  <td><tt>/etc/mail/local-host-names</tt></td>
</tr>
<tr>
  <td><tt>/etc/sendmail.ct</tt></td>
  <td><tt>/etc/mail/trusted-users</tt></td>
</tr>
<tr>
  <td><tt>/etc/sendmail.oE</tt></td>
  <td><tt>/etc/mail/error-header</tt></td>
</tr>
<tr>
  <td><tt>/etc/aliases</tt></td>
  <td><tt>/etc/mail/aliases</tt></td>
</tr>
<tr>
  <td><tt>/etc/service.switch</tt></td>
  <td><tt>/etc/mail/service.switch</tt></td>
</tr>
<tr>
  <td><tt>/etc/userdb</tt></td>
  <td><tt>/etc/mail/userdb</tt></td>
</tr>
<tr>
  <td><tt>/usr/share/misc/sendmail.hf</tt></td>
  <td><tt>/etc/mail/helpfile</tt></td>
</tr>
</table>

<p>
古い sendmail の誓瀋螢侫．ぅ襪蘓靴靴だ設定ファイルへの変換方法には
いくつかの方法がありますが、最初のステップはどの方法でも同じです。
</p>

<ol>
<li> <tt>/etc/sendmail.cf</tt> の代わりに <tt>/etc/mail/sendmail.cf</tt>
     を探索するよう、<tt>/etc/rc</tt> を更新してくだ世気ぁ
鹿跚殊蘊壌緕粱瘟谺竊續祚轣蛹緕粱瘟谺竊鹿錫
ぢこれが最小限必要な操作であり、他のすべてのファイルの場所は
     変更する必要はないはずです。
</li>
<li> または、.mc のソースファイルから新しい .cf ファイルを構築してくだ世気ぁ
瘠によって含められるので、最早
     <pre>include(`../m4/cf.m4')</pre>
     という行を指定する必要がないことに注意してくだ世気ぁ泙拭模蛋餅地瞭蒜
ぢのセクション (たとえば、<tt>openbsd-lists.mc</tt> を参照してくだ世気ぢに ("Cw machinename" で) クラス w にマシンを追加する必要がある
     ということにも注意が必要が必要です。
</li>
</ol>

<a name="2.6.7"></a>
<h3>
2.6.7: アップグレード後、
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=apm&amp;sektion=8&amp;arch=i386">apm(8)</a>
サポートを含むカーネルがブートしなくなりました
</h3>

<p>
ブートブロックを更新する必要があります。詳細は、
OpenBSD FAQ の <a href="faq14.html#14.8">14.8 章</a>
を参照してくだ世気ぁ
鹿霈

釈瘢綵⊂鹿畩
取馨
荻峡減纃鞘痳迴郤躱ぢユーザのデフォルトのグループが変更されました
</h3>

<p><em>daemon</em> のユーザのデフォルトのグループが 31 から 1 に変更されました。
daemon ユーザが以下の例のように見えるようにするためには vipw を使用してくだ世気ぁ
腫昭鞘痳迴邵浦浦紺紺犀蒹纐蛹蜊黼趾痕鳫阡痕黷蜴闌閾蜴鹿鹿霈

釈瘢綵⊂鹿畩
取仮荻からのアップグレード</h2>

<a name="2.5.1"></a>
<h3>
2.5.1: 2.5 から 2.6 へのアップグレードでの大きな問題は何でしょう ?
</h3>

<h5><em>perl</em> と <em>make</em></h5>
<p>
最新版の Perl (5.005_03) を誓気靴灰鵐僖ぅ襪垢襪燭瓩砲蓮
新しいバージョンの <em>make</em> が必要です。新しい Perl
をビルドする前に make を再構築するため、以下を実行してくだ世気ぁ
鹿霈

腫鱚邃鬲齟祚鬯砠遲轣諷
轣諷跂瘤瘢雹逅轣諷瘢雹逅轣諷銖跛
鹿頏緇

腫この後、Perl の再構築を実行してくだ世気ぁ海虜胴獣曚料阿法倥鳰ぢの
<code>obj</code> ディレクトリのクリーンアップを手動で実行してくだ世気ぁ
鹿霈

腫倥鳰ぢの開発者の方は、millert@@openbsd.org からの、以下の
最新の変更の注意事項に目を通しておいてくだ世気ぁ
鹿霈

腫鱚緕帯┣ぢ以降) のソースツリー中の Perl のバージョンは 5.005_03
にアップグレードされました。ビルド方法が一部変更されましたが、
そのほとんどは目に見えるものではありません。ユーザに影響のある
重要な変更点世楼焚爾里茲Δ覆發里任后

羽纈のライブラリファイルが /usr/lib/perl5 から、より誓騎里
齟蛯籬纈豕ぢに移動されました。
2) デフォルトの site_perl ディレクトリは /usr/local に存在します。
たとえば、Perl モジュールをインストールする場合、それは
/usr/local/libdata/perl5/site_lib にインストールされるようになりました。これにより、
non-stock モジュールが何なのかを見るのが簡単になりました。これはまた、ports
システム中に Perl モジュールをより簡単に持たせることができるということも意味します。
3) Perl ライブラリの man ページは /usr/share/man/cat3p にインストールされるようになりました。
この効果を得世襪燭瓩砲蓮▲轡好謄爐瘤闔を src/etc/man.conf
に基づいて変更する必要があります。これは、"man 3p less" を実行して
less プラグマの情報を取得世任△覆轣跂齠で less ページャの
man ページも取得世任襪箸いΔ海箸魄嫐靴討い泙后

もし、既存のモジュールや他の non-stock Perl ファイルがある場合に、最も簡単にできることは、
/usr/lib/perl5 を /usr/libdata/perl5 に移動し、/usr/lib/perl5 から /usr/libdata/perl5
に対してシンボリックリンクを張ることです。それ以外の方法としては、インストールされた
Config.pm ファイルを編集し、そのパスを修誓気垢襪海箸任靴腓Α

鹿頏緇

取犠コンパイラの変更: <em>egcs</em> で <em>gcc</em> を置換</h5>
<p>
この変更は、今までで最も大きな変更であると思われるものです。これに関する
詳細の手順については、<a href="#2.5.2">2.5.2 章</a>を参照してくだ世気ぁ
鹿霈

取犠カーネル構造体 - <em>statfs</em> - の変更</h5>
<p>
<tt>statfs</tt> 構造体が 5 月 31 日に変更されました。<em>make build</em>
を実行しようとする前に、カーネルを再構築する必要があります。
詳細は、<a href="#2.5.3">2.5.3</a> を参照してくだ世気ぁ
鹿霈

釈瘢綵⊂鹿畩
取馨
荻貴穏纃丞窿鹿纃から <em>egcs</em> へのアップグレードはどのように行うのでしょう ?
</h3>

<p>
最も安全な方法は、これが利用可能な最近の snapshot にアップグレードすることでしょう。
<strong>まずは、snapshot を見てくだ世気鹿齡鳫鈑ぢ古いコンパイラを使用して
新しいコンパイラのブートストラップを行うのは<em>最後の手段</em>と言世辰椴匹い任靴腓Α
鹿霈

腫まず、いくつかのプラットフォームでは、まだ瀬屐璽肇好肇薀奪廚棒成功していない
ということに注意してくだ世気ぁ８住誓では、注意深く実行すれば、
以下のプラットフォームで動作することがわかっています。
</p>

<ul>
<li><strong>i386</strong>
<li><strong>sparc</strong>
<li><strong>m68k</strong>
<li><strong>alpha</strong>
</ul>

<p>
<strong>mips</strong> と <strong>rs6000</strong> には問題があります。
</p>

<p>
あなたのプラットフォームがブートストラップ可能かどうか、
<a href="../../ja/ports.html">ports コレクション</a> から
egcs-snapshot を取得世靴謄ぅ鵐好函璽襪靴討澆討誓さい。
もし、これが動作すれば、ツリー中のバージョンも同様に動作するでしょう。
これがこの処理の<em>最も安全な</em>方法です。
</p>

<p>
今ここで、これ以上誓茲某覆狒阿法⊆蟲纃鐘蜴蛹鷦躱、<em>gas</em>
および <em>ld</em> が最新版であることを確認してくだ世気ぁ張蝓蔀罎砲蓮
弱躱艨鷦躱ぢと <em>ld</em> が 2 バージョンあることに注意してくだ世気ぁ
首闔臂薐原鹿齡鳫鈑と <strong>sparc</strong> では、binutils の
バージョンは使用されません。代わりに <tt>/usr/src/gnu/usr.bin/gas</tt>
と <tt>/usr/src/gnu/usr.bin/ld</tt> とをチェックしてくだ世気ぁ
鹿霈

腫以下の手順は、オリジナルの egcs の snapshot (egcs-990517) に適用されたものです。
それ以降に、二番目の snapshot (egcs-990608) がツリーにマージされました。
もし、基本の 2.5 を使用している場合、最新バージョンを直誓椒咼襯匹任覯椎柔性は
まずないでしょう。このような場合、これらの手順に従って、中間バージョンの
ブートストラップを行わなければなりません。
</p>

<p>
以下は espie@@openbsd.org からのメッセージです。
</p>

<blockquote>
<pre>
本日、コンパイラが変更されました。

gcc 2.8.1 をやめて egcs... もっと誓騎里妨誓うなら gcc 2.95 のプリリリース版に移行します。

これは、おそらく試練になるでしょうが、私は、私自身による各アーキテクチャごとの
すべての微調誓阿紡个垢觝邏箸鯊海韻襪海箸任覆覆蠅泙靴拭

私は、まさに *今* から導入作業を開始します。作業が落ち着いた時点世如
通目のメッセージを tech@@ に投稿するつもりです。

私の誓依鮗蠹舛辰討譴審Г気鵝辰蜍赱ぢ、turan そして millert
に感謝します。

なぜ誓擇蠡悗┐襪里

皆さんのほとんどが御存知のように、現在、egcs が FSF のサポートする公式の
コンパイラとなりました。来たる 7 月のリリースは gcc 2.95 と名付けられました。

ログメッセージを見てみますと、新しいプロセッサのサポートの改善、
C++ のより厳密な ANSI/ISO 標準への適合、Fortran 77 のより緊密な統合
など、多くの改善が行われていることがわかります。
さらに、無数のバグ修誓気筌魁璽廟生誓硫韻盥圓錣譴討い泙后

また、開発はよりオープンに行われています。CVS ツリーやいくつかのメーリングリスト
が利用可能で、私たちはより緊密に egcs のチームと共同作業を行うことができました。
さらに厳密に言世┐弌∋笋蓮緕帯の誓瀋蠅阿縫汽檗璽箸気譴襪茲Α▲僖奪舛
繚笂ぢのチームにフィードバックしてきました。
また、開発チームは、バグレポートに非常に敏感に反応しており、問題点世
修誓気靴討泙靴拭

また、バンドワゴン現象というのもあります。皆さんが egcs に移行するということは、
多数のコードがコンパイラのテストを行うことを意味し、それによって、
関連プロジェクトからの利益を亨受することができるということでもあるのです。

なぜ今なのか
------------
egcs-1.1 はある種の目的には適合しませんでした。特に、i386 のコードサイズは
gcc 2.8.1 より大きく、フロッピーディスク関連の問題になっていました。
2.5 がフリーズされた時点世如泙瓩襪海箸里任詬０譴離魁璽匹蓮△匹海坩堕蠅
齊瘰鼈阡ぢしかありませんでした。安定誓量簑蠅砲弔い毒困瀏瓦い燭△欧繚笂ぢは
2.5 には入れないことにしました。

そして今、egcs プロジェクトは egcs 1.2 をリリースするサイクルに入っています。
彼らのタイムスケジュールから判断して、egcs 1.2 と OpenBSD の次期リリースとの
間には十分な余裕があります。また、あまり多くは使用されていないアーキテクチャ上で
問題を報告する機会がが欲しいことや、1.2 の問題のすべてが修誓気気譴燭發里澆靴い里如
今、これを取り込みたいと考えたのです。

egcs の `将来のフリーズ' は 5 月 7 日に予定されており、また、現状の snapshot の
19990502 版は問題なさそうに見えます。

何が動いて何が動かないのか
--------------------------
egcs は i386 で OpenBSD を何の問題もなく実行させることができます。m68k でも同様ですが、
いずれは修誓気靴覆韻譴个覆蕕覆ぁ△茲錣蕕覆ぅ丱阿亡悗垢襪錣困焚麋鮑椶気譴討い泙后
齔癇でも同様に動作しているように見えます。次の私たちのリリースまでには修誓気靴覆韻譴
ならない、リンカの問題がいくつかの他のアーキテクチャ上で見つかっています。

現状では、ダ瀬ぅ淵潺奪薀ぅ屮薀蠅砲泙燭襯灰鵐好肇薀燭蓮△垢阿砲詫儖佞気譴泙擦鵝

繚笂ぢは、現時点世任蓮什漾∋笋燭舛藩冀罎離魯奪爾辰櫃げ魴荳茲衢イ譴
単独の cpp を特徴としています。これは、一部のインターフェイスが変更され、
ちょっと変った警告が出力される可能誓里△襪海箸魄嫐靴討い泙后

艫荻軒を維持すべきか ?
--------------------------
サイズの誓鵑里燭瓠繚笂ぢを導入でき次第、gcc は CVS の Attic
に移動されます。もし、今は egcs を使用したくない場合には、
CVS の update を慎重に実行する必要があるでしょう。
includes、gnu/usr.bin や gnu/lib などの、いくつかの Makefile は変更されます。
また、xlint や cpp.sh もまた同様に変更されます。

どのようにしてコンパイラのブートストラップを実行するのか
--------------------------------------------------------
最も簡単な方法は、おそらく、各アーキテクチャのメンテナを信じて、
snapshot をダ瀬Ε鵐蹇璽匹垢襪海箸任靴腓Α

もし、難しい方法を選択する場合には、最初に obj ディレクトリを
誓気靴萄鄒成する必要があります。
cd /usr/src
make obj

i386 で実行しているのでしたら、gas が更新されていなければなりません。
sparc で実行しているのでしたら、ld が更新されていなければなりません。

その後、次のようにして libiberty をビルドしてくだ世気ぁ
邃鬲齟祚芬繚笂蛯蛯纈
轣諷浴諷肅跂黻鱇韶纈跂瘤
轣諷浴諷肅跂黻鱇韶纈辮緕轣諷浴諷肅跂黻鱇韶纈轣諷浴諷肅跂黻鱇韶纈銖跛

そして C コンパイラをビルドしてくだ世気ぁ
邃鬲齟祚芬繚笂窿
轣諷浴諷肅跂黻鱇韶纈跂瘤
轣諷浴諷肅跂黻鱇韶纈辮緕轣諷浴諷肅跂黻鱇韶纈轣諷浴諷肅跂黻鱇韶纈銖跛

コンパイラを新しいバージョンを使用して再構築してくだ世気ぁ
邃鬲齟祚芬繚笂窿
轣諷浴諷肅跂黻鱇韶纈跂瘤
轣諷浴諷肅跂黻鱇韶纈辮緕轣諷浴諷肅跂黻鱇韶纈轣諷浴諷肅跂黻鱇韶纈銖跛

蜴竚ファイルを再構築します。
cd /usr/src/include
make includes

すべての egcs ライブラリをビルドし、それらをインストールしてくだ世気ぁ
邃鬲齟祚芬繚笂
轣諷浴諷肅跂黻鱇韶纈跂瘤
轣諷浴諷肅跂黻鱇韶纈辮緕轣諷浴諷肅跂黻鱇韶纈轣諷浴諷肅跂黻鱇韶纈銖跛

そして、新しい cpp ドライバをインストールします。
cd /usr/src/usr.bin/cpp
make install

これですべての処理が終了しましたので、標準の make build を実行できるようになったはずです。
</pre>


<p>
[もうひとつの注意: 実際に、これが誓気靴虻遒靴覆韻譴弌蜴はビルドに失敗するでしょう。
しかし、その修誓気牢蔽韻任后弱躱轣諷趙鹿纃を実行しようとする前に、
<code>/usr/src/usr.bin/xlint/xlint</code> ディレクトリ中で、
単に、<code> make &amp;&amp; make install </code> を実行します。
詳しくは、<a href="#2.5.2.2">2.5.2.2</a> を参照してくだ世気ぁ鹿霈

腫鱚もし、これがうまく行かなければ、まだ瘠碯蛹を実行していない arch を使用しているのでしょう。
最も発誓犬垢覯椎柔性の高いのは、ICE として知られる Internal Compiler Error (内部コンパイラエラー)
でしょう。

まず、-O1 か -O0 で ICE が消えるかどうかを見てみてくだ世気ぁ修両豺隋
これが修誓気気譴襪泙任隆屐浴諷肅跂ぢに回避策を講じることができます
(m68k 用に、このような回避策をどのように講じるかの例は、
/usr/src/lib/libm/Makefile を参照してくだ世気ぢ。

そして、そのエラーは、egcs-bugs メーリングリストに報告されなければなりません。

最低限、オプションとして -v -save-temps を加えた上で、同じコンパイラを呼び出して
ソースをコンパイルする必要があります。

-v は gcc によって呼び出されるコマンドの誓騎里淵掘璽吋鵐垢鯢充┐掘癘絖逅は、egcs の人びとは、
彼らのマシン上で OpenBSD を実行してもらえるかどうかをあなたがお願いできないということの意味を
理解しているので、プリプロセッサを通した後の C のファイル (.i) や C++ (.li) を誓言成します。

時間的な余裕があるなら、バグの発誓幻彊箸覆覯椎柔性を最小限にするために、プリプロセッサを通した
C ファイルをスリム化するよう試行錯誤することができます。また、二分法はうまく動作します。
</pre>
</blockquote>

<p>
もし、この手順どおりに実行した場合、そしてすべてが動作している場合は、おめでとうございます。
誓任后靴掘△發靴修Δ任覆韻譴弌焚爾両呂鮖温佑砲靴謄船Д奪慶召靴討誓さい。また、
ここにリストアップされていない問題があれば、tech@@openbsd.org に投稿してくだ世気ぁ
鹿霈

釈瘢綵⊂鹿畩
取犠
荻貴荻儒薐原鹿および <tt>sparc</tt> は、
最早 <tt>#define</tt> されていません。
</h5>

<p>
これは本当です。<em>egcs</em> は、よりクリーンな <tt>__i386__</tt> および
<tt>__sparc__</tt> を使用します。古い定義に依存するコードをコンパイルする必要が
ある場合には、Makefile 中の適誓気憤銘屬将提鞜鱆鹿や <tt>-Di386</tt>
を追加してくだ世気ぁ
鹿霈

釈瘢綵⊂鹿畩
取犠
荻貴荻蜴で Build が失敗します。
</h5>

<p>
これは、cpp のセマンティクスの違いによるものです。その回避策は単純で、
<a href="#2.4.2">2.4.2</a> に記述された <em>cap_mkdb</em> の問題と同様です。
</p>

<p>
以下を実行してくだ世気ぁ
鹿霈

腫鱚邃鬲齟祚鬯砠遲蜴蜴轣諷瘢雹逅轣諷銖跛
鹿頏緇

腫これで、make を再実行し、ビルドを継続することができます。
</p>

<a name="2.5.2.3"></a>
<h5>
2.5.2.3 - <tt>uthread_autoinit.c</tt> で core ダ瀬鵐廚靴泙后
鹿莎
腫リンカのバグの犠誓靴砲覆辰討靴泙辰燭茲Δ任垢諭０焚爾蓮△修譴亡愀犬里△襯瓮奪察璽犬任后
鹿霈

腫鱚汝闕浴鱆齔蜈踉四癇祟涛韈綫専蛛聲皷纒鬢苳囎礪繝鱚痲焉濶鉗で egcs がコアダ瀬鵐

もし、あなたのところでこれが発誓犬靴疹豺隋△海譴呂茲里蕕譴織螢鵐量簑蠅如
あなたの cc1 が変にリンクされてしまっているせいでしょう。

最初に、私はこの問題を回避するため、cc1 をスタティックな /usr/lib/libiberty.a
に対してリンクしましたが、これは問題を誓擇蠎茲蟆瓩討い董▲丱阿童修靴討靴泙辰燭里如
おそらく libc か他の部分の関係のない変更に感謝すべきなのかも知れません。

ソースツリーは、以下のファイルについての回避策とともにパッチが当たっていますので、

src/gnu/egcs/f/lang-options.h

この回避策の適用済バージョンのファイル (少なくとも rev 1.2 はそうです)
があることを確認して、cc1 を再コンパイルして再インストールすれば、この問題は解消します。

ここで発誓犬靴燭海箸蓮韭纐ぢの中の巨大な文字配列のためと、
何かが間違ってリンクされてしまったことにより、
i386 のリンカがおかしくなってしまったためで、
void f(void) __attribute((constructor)) {}
が cc1 を kill してしまうからなのです。

回避策として、誰かがリンカのエラーがどこなのかを発見するまでは、私は
ヘルプの文章の中の Fortran のオプションを除去することにしました。 
</pre>

<a name="2.5.2.4"></a>
<h5>
2.5.2.4 - <em>egcs</em> は <em>gcc</em> よりずっと遅いようなのですが... 
</h5>

<p>
そのとおりかも知れませんが、これには理由があります。<em>egcs</em> はより多くの最適化パスを実行します。
これにより、<em>egcs</em> の誓言成したコードのデータのアライメントやその他の機能誓覆匹より良くなっているはずです。
</p>

<a name="2.5.2.5"></a>
<h5>
2.5.2.5 - <em>egcs</em> は <em>gcc</em> より大きなコードを誓言成するようですが...
</h5>

<p>
そのとおりです。これは特に、古い gcc のスイッチ <tt>-O2</tt> で注意すべきことと
なっています。このため、<em>egcs</em> では、サイズの最適化を行うための新しいオプション
<tt>-Os</tt> が導入されています。これは、大まかに言世辰董鼎将浪鹿の挙動と
互換誓△蠅泙后
鹿霈

釈瘢綵⊂鹿畩
取犠
荻貴荻弱躱繚笂鹿纃をインストールしたら、非常に小さなディスク空間しか残っていません。
</h5>

<p>
<em>egcs</em> は gcc 2.8.1 とは異なるサブディレクトリにインストールされます。egcs
がいったんブートストラップに誓掘虻遒垢襪茲Δ砲覆譴弌弱躱艫禺躱ぢを消去しても構いません。
</p>

<p>
関連する注意事項として、<a href="#2.5.1">2.5.1</a> に記述された Perl の変更は、
<tt>/usr/lib/perl5</tt> ディレクトリが消去できるということを意味します。
このデータの新しい位置は <tt>/usr/libdata/perl5</tt> です。
</p>

<a name="2.5.2.7"></a>
<h5>
2.5.2.7 - ビルドで libcurses の構築に失敗します。
</h5>

<p>
<em>libcurses</em> は、現時点世任纃障韶鹿纃の最新バージョンに依存しています。
最新バージョンの <em>cpp</em> を取得世靴董焚爾里茲Δ砲靴瞳兮海靴討誓さい。
</p>
<pre>
# cd /usr/src/usr.bin/cpp &amp;&amp; make install
</pre>

<p>そして、もう一度、 make build を実行してみてくだ世気ぁ鹿霈

釈瘢綵⊂鹿畩
取犠
荻貴荻轣諷礪ぢが失敗します。
</h5>

<p>
もし、たとえば、以下の例のように Makefile 中のエラーが理由で <em>make obj</em>
が失敗する場合には、Makefile の include が古いものと考えられます。
</p>

<pre>
===&gt; lib/libkvm
"Makefile", line 30: Malformed conditional ((${UVM} == "yes"))
"Makefile", line 30: Missing dependency operator
"Makefile", line 32: if-less endif
"Makefile", line 32: Need an operator
Fatal errors encountered -- cannot continue

</pre>

<p>
これは、Makefile の include を再構築することで解決することができます。以下を実行してくだ世気ぁ
鹿霈

腫鱚邃鬲齟祚鼈癇絲迢瘢雹逅轣諷銖跛
鹿頏緇

腫そして、もう一度、ビルドを実行してみてくだ世気ぁ
鹿霈

釈瘢綵⊂鹿畩
取馨
荻貴該纃壌瘠碯蛹篌躱ぢが <em>unimplemented syscall</em> エラーで停止します。
</h3>

<p><strong>短かい回答:</strong> </p>

<p>
カーネル構造体 <tt>statfs</tt> が変更されました。<em>make build</em>
を実行しようとする前に、カーネルを再構築する必要があります。
</p>

<p><strong>長い回答:</strong> </p>

<p>
カーネル構造体 <tt>statfs</tt> が変更されました。
新しい <tt>struct statfs</tt> は以下のような機能を持ちます。
</p>

<ul>
<li> <tt>u_int32_t</tt> フラグフィールドを持っています -- softdep が実際のフラグを持つことができるようになりました。
</li>

<li> long の代わりに <tt>u_int32_t</tt> を使用します (alpha 上でより良くなっています)。  
注: マニュアルページには、不誓気ぢ使用していないフィールドを -1 にセットするという嘘が記載されていました。
確かに、SunOS ではそのようになっていますが、私たちのコードでは決してそのようなことはありません。
</li>

<li> <tt>f_type</tt> を完全に除去しました。これは、NetBSD 0.9 から使用されていないもので、
それが存在しているのに常に 0 であるということが混乱の元でした。これは、
いくつかの古いコードがコンパイルできない原因になるかも知れないと考えられますが、
それでも黙ってブレークしてしまうよりはまだ世泙靴任靴腓Α
鹿跚
殊蘊焼嘖捐冬癇苴鹿構造体を含む <tt>mount_info</tt> 共用体を追加しました。
これは、<em>mount</em> が、マウントされたファイルシステムのすべてのオプションを
表示できるようになったことを意味します。これは、NFS で特にすばらしいものでしょう。
</li>
</ul>

<p>
その他の変更点鹿霈

受貍
殊蘊蜴ぢの statfs のエミュレーションは、BSD のファイルシステム名と Linux の <tt>f_type</tt>
の数との間の変換を行いませんでした。BSD の <tt>f_type</tt> の数は Linux アプリケーションにとっては
役に立たないので (そして常に除去されるので)、現在ではこれができるようになりました。
</li>

<li> FreeBSD の struct statfs は私たちのものとは異なり
(古いところも新しいところも両方あります)、変換が必要となっています。
以前は、OpenBSD のシステムコールが実際の変換を行うことはありませんでした。
</li>

<li> <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mount&amp;sektion=8">mount(8)</a>
は、引数なしで呼び出された場合に、特別な情報を表示するようになりました。
しかし、<em>すべての情報</em>を見るためには、-v (verbose) フラグを使用しなければなりません。
</li>
</ul>

<a name="2.5.4"></a>
<h3>
2.5.4: 新しい 2.6 ディレクトリへのリンク
</h3>

<p>
2.6 にアップグレードする場合には、gcc 用にひとつの単純なリンクを誓言成する必要があります。
</p>

<pre>
   cd /usr/lib/gcc-lib
   ln -s ${ARCH}-unknown-openbsd2.5 ${ARCH}-unknown-openbsd2.6
</pre>

<a name="2.5.5"></a>
<h3>
2.5.5: <strong>(U)</strong>pgrade を選択後の、<em>base26.tar.gz</em>
の展開が失敗します。
</h3>

<p>
<em>tar: Unable to remove directory ./usr/include/machine &lt;Directory
not empty&gt;
</em>
</p>

<p>2.5 では、<tt>/usr/include/machine</tt> がディレクトリであり、
<tt>/usr/include/i386</tt> はそれに対するリンクでした。 2.6 では、
この状況は反転しています。
</p>

<p>
問題を訂誓気垢襪燭瓠▲轡Д襪縫┘好院璽廚靴少鬲蜴竚絲轣竏蜴綣ぢを削除してから、アップグレードを再実行してくだ世気ぁ
鹿霈


釈瘢綵⊂鹿畩
取仮荻からのアップグレード</h2>

<a name="2.4.1"></a>
<h3>2.4.1: Man ページの変更</h3>
<p>
いくつかのマニュアルページがセクション 1 から後のセクションに移されました。
不運にも、古いマニュアルページがセクション 1 に残っていると、注意深くない
ユーザは最新バージョンのページを見ないことになってしまいます。
</p>

<p>
以下のページを削除すべきです。
</p>
<pre>
/usr/share/man/cat1/ipf.0
/usr/share/man/cat1/ipnat.0
/usr/share/man/cat1/ipsecadm.0
</pre>

<a name="2.4.2"></a>
<h3>2.4.2: <em>cap_mkdb</em> のシンタクスの変更</h3>

<p>
<strong>現象:</strong>
</p>

<p>
<em>make build</em> で、以下のようなエラーが発誓犬靴泙后
鹿霈

腫鱚竅鞏迢籵纈迚鈕鴉蜴肬鱆
竅鞏迢籵蛹跂艨關闔瘍綺瘰熏諢朖肅跂肅跂梟蛹絏湯鳫竢粤
鹿頏緇

腫首闔臂修誓瑳闔臂
鹿霈

腫弱躱竅鞏迢籵鹿纃を呼び出す際のシンタクスが少し変更されました。
<em>make build</em> を実行する前に、cap_mkdb を最新のソースから
再構築してくだ世気ぁ
鹿霈

腫鱚邃鬲齟祚鬯砠遲竅鞏迢籵
轣諷跂瘤瘢雹逅轣諷瘢雹逅轣諷銖跛
鹿頏緇

腫これで、問題なく make build を実行できるようになります。
</p>


<a name="2.4.3"></a>
<h3>2.4.3: Snake</h3>
<p>
<code>/usr/src/games/snake</code> をアップグレードする前に、obj
ディレクトリの内容を消去する必要があります。
</p>
 
<a name="2.3"></a>
<h2>2.3 からのアップグレード</h2>

<a name="2.3.1"></a>
<h3>
2.3.1: 新しいユーザ: <em>named</em>
</h3>

<p>
2.3 以後、DNS デーモンの <em>named</em> が chroot されるようになりました。
この変更を可能にするため、ユーザ <em>named</em> が作誓気譴泙靴拭
まだ澄△海離罅璽兇鮑鄒成していない場合には、ビルドの処理中にすべてのディレクトリが
誓犠錣忘鄒成されることを確実にするため、このユーザを作誓靴討廚△蠅泙后
鹿霈

腫釈鱚羹∵雕關緕碵筮闥膀竍薛砠遲轣隨竍蘓髟纈頷逅雌繼闔集⊂頷┯を使用して、/etc/passwd に以下のエントリを追加してくだ世気ぁ
鹿霈

腫鱚釶辣篋薫嵯虻紺紺座瀕鶴纃闔痕鬲釶辣篋砠遲鈿跫芍鹿頏緇

腫また、以下のグループも /etc/group に追加します。
</p>

<pre>
named:*:70:
</pre>


<a name="2.3.2"></a>
<h3>
2.3.2: 構築しようとすると、<em>ssleay</em> をビルドしようとして
失敗します。</em>.
</h3>

<p>
パスワードファイルに <em>named</em> ユーザのエントリを
作誓靴討い覆い茲Δ任垢諭
鹿霈

腫首闔臂短かい回答:</strong>
</p>

<p>
ビルドの前にこのユーザを作誓靴討誓さい。
</p>

<p>
<strong>長い回答:</strong>
</p>

<p>
<em>named</em> ユーザは、パーミッションを誓気靴設定するために必要です。
ですので、このユーザがない場合には、ビルドの処理の一部が失敗します。
もし、(<em>make build &amp;&gt;/tmp/build.log</em> のようにして) ビルドの処理を
ファイルにキャプチャしている場合には、以下のような注意のメッセージが記録されています。
</p>

<pre>
(cd /usr/src/etc &amp;&amp; make DESTDIR=/ distrib-dirs)
install -d -o root -g wheel -m 755 /
mtree -def mtree/4.4BSD.dist -p // -u

mtree: unknown user named
mtree: failed at line 1632 of the specification
*** Error code 1 (ignored)
</pre>

<p>
私たちにとって不幸なのは、ビルドがそのまま継続されてしまうことで、
最終的にエラーが発誓犬靴燭箸い造技襪気譴討靴泙Δ海箸任靴腓Α
鹿霈

腫弱躱釶辣篌躱ぢユーザが存在している場合には、mtree が誓犠錣貌虻遒靴泙后
鹿霈

腫鱚迚齠蜴膾癇瘢繖竰縺筴
迚齠蜴膾癇瘢繖纐竰縺筴
迚齠蜴膾癇瘢繖竰縺筴
迚齠蜴膾胝竰縺筴
迚齠蜴膾鼬竰縺筴
迚齠蜴膾鼬鱸竰縺筴
迚齠蜴膾齟礪鈿竰縺篋蛹纔蜩迚齠蜴膾齟葹鱚閭鱚癆繖迚齠蜴膾齟葹鱚閭豁踟銹煦繻鱚癆繖迚齠蜴膾齟葹鱚閭豁踟銹煦繻隴諷闍纉竰縺筴
迚齠蜴膾齟葹鱚閭黻凱鱚鱚癆繖迚齠蜴膾齟葹鱚瘤癆姦竟鴃鱚癆繖迚齠蜴膾齟葹鱚瘤瘤姦瘡韆鱚癆繖迚齠蜴膾齟葹鱚瘤瘤姦齏癢竰縺筴
迚齠蜴膾齟葹鱚瘤瘤姦竟鴃鱚癆繖迚齠蜴膾齟葹鱚轣祚辟閭竰縺筴
迚齠蜴膾癇閭鶩轣銛瘡蓖齡鱚癆繖迚齠蜴膾齟釿跿粤鼬竰縺筴
鹿頏緇

腫ここで、この失敗の理由は、<em>/usr/include/ssl</em> ディレクトリが
決して作誓気譴覆い海箸任后修靴董▲悒奪誓ファイルがないので、
<em>ssleay</em> のビルドが失敗するのです。
</p>

<p>
<strong>修誓瑳闔臂
鹿霈

腫弱躱釶辣篌躱ぢユーザ/グループを作誓靴討誓さい。そして、<em>/usr/include/ssl</em>、
<em>/var/named</em>、および <em>make build</em> によって間違って通常ファイルとして
作誓気譴討靴泙辰拭⊂綉離螢好箸梁召離妊譽肇蠅鬚垢戮萄鐔靴討誓さい。
</p>


<a name="2.3.3"></a>
<h3>
2.3.3: 構築しようとすると、PowerPC 用の何かを
make しようとして失敗します。
</h3>

<p>
ディレクトリツリーが不完全です。特に、
<tt>/usr/share/man/cat4/powerpc</tt> ディレクトリがありません。
</p>

<p>
<strong>簡単な修誓瑳闔臂
鹿霈

腫このディレクトリを作誓掘▲灰鵐僖ぅ襪魴兮海靴討誓さい。
</p>

<p>
<strong>完全な修誓瑳闔臂
鹿霈

腫全体のディレクトリツリーを作誓靴泙后０焚爾鮗孫圓靴討誓さい。
</p>

<pre>
# cd /usr/src/etc &amp;&amp; make DESTDIR=/ distrib-dirs
</pre>

<p>
これにより、以下のような出力を目にするはずです。
</p>

<pre>
install -d -o root -g wheel -m 755 /
mtree -def mtree/4.4BSD.dist -p // -u

missing: ./var/named (created)
missing: ./var/named/dev (created)
missing: ./var/named/etc (created)
missing: ./etc/afs (created)
missing: ./etc/ssl (created)
missing: ./etc/ssl/private (created)
missing: ./usr/obj (not created: File exists)
missing: ./usr/share/doc/html (created)
missing: ./usr/share/doc/html/lynx_help (created)
missing: ./usr/share/doc/html/lynx_help/keystrokes (created)
missing: ./usr/share/doc/usd/13.viref (created)
missing: ./usr/share/man/cat4/powerpc (created)
missing: ./usr/share/man/man4/alpha (created)
missing: ./usr/share/man/man4/pmax (created)
missing: ./usr/share/man/man4/powerpc (created)
missing: ./usr/share/tmac/mdoc (created)
missing: ./var/www/htdocs/manual/vhosts (created)
missing: ./usr/include/ssl (created)
</pre>

<p>
usr/share/man/cat4/powerpc は、この処理によって作誓気譴襯妊譽肇蠅里劼箸弔任△襪箸いΔ海箸肪躇佞靴討誓さい。
</p>



<p>
--
</p>
<address>
<p>
Originally [OpenBSD: upgrade-old.html,v 1.9 ]
<br>
$Translation: upgrade-old.html,v 1.1 2004/04/13 11:21:06 toshi Exp $
<br>
$OpenBSD: upgrade-old.html,v 1.2 2004/05/09 09:58:22 saad Exp $
<br />
Copyright &copy; 1998-2003, Kjell Wooding. 
<br />
どのような御質問、御指摘、コメントでも
<a href="mailto:kjell@@openbsd.org">kjell@@openbsd.org</a> にお送りくだ世気ぁ
鹿霈
鹿痲糅纉鷯

鹿硼糯鹿蔗迪

窺跫栴繻蝌嶝

絶姥
甕は鞳鄲喞苒痲絖闌筮蔗迪旭姦芦鰻些刑温蜒祷箍涯甓涯は鞳鄲喞苒痲絖闌筮蔗迪旭姦芦鰻些刑温蜒祷

窺跫績繻蝌嶝

誓

