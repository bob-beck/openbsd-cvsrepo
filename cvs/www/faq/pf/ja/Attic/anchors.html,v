head	1.14;
access;
symbols;
locks; strict;
comment	@# @;


1.14
date	2005.08.13.08.24.51;	author saad;	state dead;
branches;
next	1.13;

1.13
date	2004.05.09.09.58.22;	author saad;	state Exp;
branches;
next	1.12;

1.12
date	2004.01.04.22.47.55;	author horacio;	state Exp;
branches;
next	1.11;

1.11
date	2003.12.03.21.55.17;	author horacio;	state Exp;
branches;
next	1.10;

1.10
date	2003.11.10.21.40.53;	author horacio;	state Exp;
branches;
next	1.9;

1.9
date	2003.11.03.16.54.43;	author jufi;	state Exp;
branches;
next	1.8;

1.8
date	2003.09.26.13.21.46;	author horacio;	state Exp;
branches;
next	1.7;

1.7
date	2003.09.19.16.44.17;	author horacio;	state Exp;
branches;
next	1.6;

1.6
date	2003.07.11.20.33.05;	author jufi;	state Exp;
branches;
next	1.5;

1.5
date	2003.06.27.21.22.20;	author jufi;	state Exp;
branches;
next	1.4;

1.4
date	2003.06.13.12.05.29;	author jufi;	state Exp;
branches;
next	1.3;

1.3
date	2003.06.12.17.22.21;	author jufi;	state Exp;
branches;
next	1.2;

1.2
date	2003.06.05.13.33.00;	author jufi;	state Exp;
branches;
next	1.1;

1.1
date	2003.05.30.10.20.56;	author jufi;	state Exp;
branches;
next	;


desc
@@


1.14
log
@remove unmaintained [ja] translation files.  requested by translator.
@
text
@<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>PF: Anchors and Named Rulesets</title>
<link rev="made" href="mailto:www@@openbsd.org">
<meta http-equiv="Content-Type" content="text/html; charset=ISO-2022-JP">
<meta name="resource-type" content="document">
<meta name="description"   content="the OpenBSD FAQ page">
<meta name="keywords"      content="openbsd,faq,pf">
<meta name="distribution"  content="global">
<meta name="copyright"     content="This document copyright 2003-2004 by OpenBSD.">
</head>

<body bgcolor="#ffffff" text="#000000">
<!-- Passes validator.w3.org, please keep it this way;
please, use a max of 72 chars per line -->

<img alt="[OpenBSD]" height=30 width=141 src="../../../images/smalltitle.gif">
<p>
[<a href="scrub.html">前に戻る: スクラブ (scrub: パケットの誓亀象
杣蓿繙就蜴粤蔗迪⊂目次</a>]
[<a href="queueing.html">次に進む: パケットキューイングと優誓莉膂棉佞鹿畩
腫取云惹闔竢跫鮟■絨旭旭⊂估アンカーと名前付きルールセット</font></h1>

<hr>

<h3>目次</h3>
<ul>
<li><a href="#intro">はじめに</a>
<li><a href="#named">名前付きルールセット</a>
<li><a href="#options">アンカーのオプション</a>
<li><a href="#manip">名前付きルールセットの操作</a>
</ul>

<hr>

<a name="intro"></a>
<h2>はじめに</h2>
PF は主ルールセットだ世韻任覆▲汽屮襦璽襯札奪箸良床舛盥圓Δ海箸任泙后
サブルールセットは、
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+3.4"
>pfctl(8)</a> を使用して運用中に操作することもできるので、
アクティブなルールセットを動的に代替するための便利な方法を提供しています。
<a href="tables.html">テーブル</a>がアドレスの動的なリストを保持するために使用されるのに対して、
サブルールセットはフィルタ、<tt>nat</tt>, <tt>rdr</tt>、<tt>binat</tt> ルールの
動的なセットを保持するために使用されるものです。

<p>
サブルールセットはアンカーを使用して主ルールセットに連結されます。
<tt>anchor</tt> ルールには以下のように 4 種類あります。
<ul>
<li><tt>anchor <i>名前</i></tt> - <i><tt>名前</tt></i> のアンカー中の
すべての <a href="filter.html">フィルタ</a>ルールを評価します。
<li><tt>binat-anchor <i>名前</i></tt> - <i><tt>名前</tt></i> のアンカー中の
すべての <a href="nat.html#binat"><tt>binat</tt></a>
ルールを評価します。
<li><tt>nat-anchor <i>名前</i></tt> - <i><tt>名前</tt></i> のアンカー中の
すべての <a href="nat.html"><tt>nat</tt></a> ルールを評価します。
<li><tt>rdr-anchor <i>名前</i></tt> - <i><tt>名前</tt></i> のアンカー中の
すべての <a href="rdr.html"><tt>rdr</tt></a> ルールを評価します。 
</ul>

主ルールセットだ世韻鍾釿蓖鮗ぢルールを含むことができます。

<a name="named"></a>
<h2>名前付きルールセット</h2>
名前付きルールセットとは、名前の割り付けられたフィルタおよび/または変換ルールの
グループのことです。<tt>anchor</tt> 点世砲呂劼箸聴幣紊里修里茲Δ淵襦璽襯札奪箸
含まれているかも知れません。PF は主ルールセット中に <tt>anchor</tt> ルールを
見つけると、その <tt>anchor</tt> 点世墨襪気譴燭垢戮討離襦璽襯札奪箸髻
その名前のアルファベット順に評価しようとします。
主ルールセットの処理は、<tt>quick</tt> オプション付きの
フィルタルールか、アンカーの中の変換ルールに
パケットがマッチするまで継続されますが、このようなケースでは、
マッチは最終的なものであると見なされますので、主ルールセットと
アンカーの両方のルールの評価がここで中止されます。

<p>
たとえば、以下のようになります。
<blockquote>
<tt>
ext_if = "fxp0"<br>
<br>
block on $ext_if all<br>
pass &nbsp;out on $ext_if all keep state<br>
anchor goodguys
</tt>
</blockquote>

<p>
このルールセット一式は、<tt>fxp0</tt> 上の着信ならびに送出トラフィックの両方のための
デフォルトで拒誓笋垢襯櫂螢掘爾箸覆辰討い泙后肇薀侫奪肋屬鯤歛犬靴討錣燭気譟
儒苡閼苺鹿という名前のアンカールールが誓言成されます。
以下のふたつの方法でアンカーにルールを関連付けられます。
<ul>
<li><tt>load</tt> ルールの使用
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+3.4"
>pfctl(8)</a>
の使用
</ul>

<p>
<tt>load</tt> ルールは、テキストファイルからルールを読み込むことにより、
指定されたアンカーと名前付きルールセットとを関連付けるため、<tt>pfctl</tt>
を呼び出すことになります。たとえば、以下のようになります。
<blockquote>
<tt>
load anchor goodguys:ssh from "/etc/anchor-goodguys-ssh"
</tt>
</blockquote>

<p>
主ルールセットがロードされた際に、ファイル <tt>/etc/anchor-goodguys-ssh</tt>
にリストされたルールは、<tt>goodguys</tt> アンカーに連結された
名前付きルールセット <tt>ssh</tt> にロードされます。

<p>
<tt>pfctl</tt> を使用してルールをアンカーに追加するためには、
以下のようなコマンドを使用することができます。
<blockquote>
<tt>
# echo "pass in proto tcp from 192.0.2.3 to any port 22" \<br>
&nbsp;&nbsp;&nbsp;| pfctl -a goodguys:ssh -f -
</tt>
</blockquote>

<p>
これは、<tt>goodguys</tt> アンカーに連結された <tt>ssh</tt>
という名前のルールセットに <tt>pass</tt> ルールを追加します。
PF は主ルールセット中の <tt>anchor goodguys</tt> に達したときに、
このルール (および追加された他のすべてのフィルタルール) を評価します。

<p>
ルールはテキストファイルに保存し、ここからロードすることも可能です。
<blockquote>
<tt>
# cat &gt;&gt; /etc/anchor-goodguys-www<br>
pass in proto tcp from 192.0.2.3 to any port 80<br>
pass in proto tcp from 192.0.2.4 to any port { 80 443 }<br>
<br>
# pfctl -a goodguys:www -f /etc/anchor-goodguys-www<br>
</tt>
</blockquote>

<p>
これは <tt>/etc/anchor-goodguys-www</tt> ファイルから <tt>goodguys</tt>
アンカー中の <tt>www</tt> という名前のルールセットにルールを読み込みます。

<p>
フィルタならびに変換ルールは、主ルールセットとしてロードされたルールと同様のシンタクス
およびオプションを使用した名前付きルールセットとして読み込むことができます。
しかしながら、それは使用されている<a href="macros.html">マクロ</a>も
名前付きルールセットの中に定義されていなければなりません。
主ルールセットの中で定義されているマクロは、
名前付きルールセットからは<i>見えません</i>。

<p>
それぞれの名前付きルールセットは、主ルールセットと同様、他のルールセットとは
独立に存在します。ルールのフラッシュのような、ひとつのルールセットの処理が終了が、
他のすべてのルールセットに影響を及ぼすことはありません。さらに、主ルールセットからの
アンカーポイントを除去しても、そのアンカーに付随する、いかなる名前付きルールセットも
破壊されることはありません。名前付きルールセットは、
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+3.4"
>pfctl(8)</a> を使用してすべてのルールをフラッシュしない限り、
破壊されることはありません。名前付きルールセットを持たないアンカーポイントが
これに付随する場合、これもまた破壊されてしまいます。

<a name="options"></a>
<h2>アンカーのオプション</h2>
<tt>anchor</tt> ルールには、オプションとして、インターフェイス、プロトコル、
送信元および送信誓茱▲疋譽垢覆匹髻▲侫襯織襦璽襪汎瑛佑離轡鵐織垢鮖藩僂靴
指定することができます。このような情報た与えられた場合には、パケットが <tt>anchor</tt>
ルールの記述にマッチした場合にのみ、<tt>anchor</tt> ルールは処理されます。
たとえば、以下のようになります。
<blockquote>
<tt>
ext_if = "fxp0"<br>
<br>
block on $ext_if all<br>
pass &nbsp;out on $ext_if all keep state<br>
anchor ssh in on $ext_if proto tcp from any to any port 22<br>
</tt>
</blockquote>

<p>
アンカー <tt>ssh</tt> 中のルールは、<tt>fxp0</tt> に着信したポート 22
に向かう TCP パケットのために評価されます。そして、ルールが以下のように
<tt>anchor</tt> に追加されます。
<blockquote>
<tt>
# echo "pass in from 192.0.2.10 to any" | pfctl -a ssh:allowed -f -
</tt>
</blockquote>

<p>
この場合、フィルタルールには、インターフェイス、プロトコルやポートが
指定されていないにも関わらず、ホスト 192.0.2.10 だ世韻鍾釿蓖鮗
ルールの記述に従って、SSH を使用して誓楝海垢襪海箸魑弔気譴討い泙后

釈瘢綵瘤蜷⊂鹿畩
取仮名前付きルールセットの操作</h2>
名前付きルールセットの操作は、<tt>pfctl</tt> 経由で実行されます。
これは、主ルールセットをリロードすることなく、ルールのルールセットに追加したり、
ルールセットから削除したりするのに使用できます。

<p>
<tt>ssh</tt> アンカーに連結された <tt>allowed</tt>
ルールセット中のルールをすべてリストするには、以下のようにします。
<blockquote>
<tt>
# pfctl -a ssh:allowed -s rules
</tt>
</blockquote>

<p>
上記と同じルールセットからすべてのフィルタルールをフラッシュするには、以下のようにします。
<blockquote>
<tt>
# pfctl -a ssh:allowed -F rules
</tt>
</blockquote>

<p>
ルールセット名が省略されている場合には、アンカー中のすべてのルールに対して
動作が適用されます。

<p>
コマンドのすべてのリストについては、
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+3.4"
>pfctl(8)</a> を参照してくだ世気ぁ

腫杣蓿繙就黹鴣皰蔗迪⊂前に戻る: スクラブ (scrub: パケットの誓亀象
杣蓿繙就蜴粤蔗迪⊂目次</a>]
[<a href="queueing.html">次に進む: パケットキューイングと優誓莉膂棉佞鹿畩
腫取鮠
釈鱚羹∫鈔纔譬昭蜊蒹蜃蔗就牡糘莉刈鱆就轣艱鶩矚站蜀硼鰾纈就唖踉就桙痺諫⊂鹿畩釈鱚羹瘟踉鏈戦鞳鈞黻鱧⊂戦鞳鈞黻鱧鹿畩
錫鮠
首轣跛蜃蜴瘡踟緕帯頂釿蓖鴦讙窺碓
錫鮠
ぴ鱇銖赱闔瘤竏闥鶤蔗迪屋梓丑鯵戯渦佐鼈祷錫鮠
は鞳鄲喞瘤竏闥鶤蔗迪屋梓起姐杭妓魂黶痲
鹿鼾瘡貍

鹿硼糯鹿蔗迪


窺嘘
跫栴繻蝌嶝

絶牡甓換
は鞳鄲喞瘤竏闥鶤蔗迪屋梓丑葦敢蔚艮鉗站


窺渦
跫績繻蝌嶝

誓


窺臼
跫績繻蝌嶝

絶臼
甕狩續釶辣就竢顆鱸艾槇闔銓就壽蜩閭緕竢顆鱸艾屋鯵緕帯町⊂
箍患
甓患
蜃蜴瘡踟緕帯頂釿蓖鴦讙窺箍慣
甓慣
ぴ鱇銖赱闔瘤竏闥鶤蔗迪屋鯵億鯵敢憾些鼈祷箍換
甓換
は鞳鄲喞瘤竏闥鶤蔗迪旭劾臼欝紺減乙蜒祷

窺碓
跫績繻蝌嶝

絶屋
甓杣蓿繙就跫艸蜴膊蔗迪⊂前に戻る: ログの取得鹿畩箍甓杣蓿繙就鼈闥鶤蔗迪⊂次に進む: ルールセット作誓龍疇鹿畩箚甦昭情聶┯鹿畩ぢを使用して運用中に操作することもできるので、
d93 1
a93 1
このルールセット一式は、fxp0 上の着信ならびに送出トラフィックの両方のための
d95 27
a121 2
<tt><i>goodguys</i></tt> という名前のアンカールールが誓言成されます。この
<tt><i>goodguys</i></tt> アンカーにルールを追加するには、以下のコマンドを使用します。
d130 1
a130 1
これは、<tt><i>goodguys</i></tt> アンカーに連結された <tt><i>ssh</i></tt>
d148 2
a149 3
これは <tt>/etc/anchor-goodguys-www</tt> ファイルから
<tt><i>goodguys</i></tt> アンカー中の
<tt><i>www</i></tt> という名前のルールセットにルールを読み込みます。
d188 1
a188 1
アンカー <tt><i>ssh</i></tt> 中のルールは、fxp0 に着信したポート 22
d209 1
a209 1
<tt><i>ssh</i></tt> アンカーに連結された <tt><i>allowed</i></tt>
d232 1
a232 1
><tt>pfctl(8)</tt></a> を参照してくだ世気ぁ
箍概
甓概
杣蓿繙就跫艸蜴膊蔗迪⊂前に戻る: ログの取得鹿畩箍碍
甓碍
杣蓿繙就鼈闥鶤蔗迪⊂次に進む: ルールセット作誓龍疇鹿畩箍患
甓患
蜃蜴瘡踟緕帯頂釿蓖鴦讙窺箍慣
甓慣
ぴ鱇銖赱闔瘤竏闥鶤蔗迪屋鯵丑碓敢騎艮鼈祷箍換
甓換
は鞳鄲喞瘤竏闥鶤蔗迪旭劾臼桶魂杭芦蜒祷

窺跫栴繻蝌鱇銖赱闔嶝

絶干
甦釈鱚羹∵雕關緕碵筮闥膀竍薛砠遲轣隨竍蘓髟纈鞴笏讀瘢雹黼謾蜿扈研瘢雹轣鉋癆莉緕帯朝凱晦
箟官
甕官
釈鱚羹∵雕關緕碵筮闥膀竍薛砠遲轣隨竍蘓髟纈鞴笏讀瘢雹黼謾蜿扈研瘢雹轣鉋癆莉緕帯朝凱晦
箍扱
甓扱
釈鱚羹∵雕關緕碵筮闥膀竍薛砠遲轣隨竍蘓髟纈鞴笏讀瘢雹黼謾蜿扈研瘢雹轣鉋癆莉緕帯朝凱晦
箍憶
甓憶
蜃蜴瘡踟緕帯頂釿蓖鴦讙窺箍桶
甓桶
ぴ鱇銖赱闔瘤竏闥鶤蔗迪屋鯵康牡敢咳些鼈祷箍乙
甓乙
は鞳鄲喞瘤竏闥鶤蔗迪旭劾姐芦魂杭鯵蜒祷

窺跫栴繻蝌

誓


窺跫栴繻蝌

絶厳
畍鞜齠阨闔纔蜀跛繞齡癆綣碣箟妓
甕妓
鞜齠阨闔纔蜀跛繞齡癆綣碣箟挟
甕挟
儒瘤竏闥蘊齠莠昭ぢ中のルールは、fxp0 に着信したポート 22
d185 1
a185 1
<tt><i>ssh</i></tt> <tt>anchor</tt> に連結された <tt><i>allowed</i></tt>
d221 1
a221 1
Originally [OpenBSD: anchors.html,v 1.6 ]
d223 1
a223 1
$Translation: anchors.html,v 1.9 2003/09/18 14:09:44 toshi Exp $
d225 1
a225 1
$OpenBSD: anchors.html,v 1.6 2003/09/16 01:23:49 nick Exp $
@


1.6
log
@sync with steelix translation CVS
@
text
@d221 1
a221 1
Originally [OpenBSD: anchors.html,v 1.5 ]
d223 1
a223 1
$Translation: anchors.html,v 1.8 2003/07/10 15:18:32 toshi Exp $
d225 1
a225 1
$OpenBSD: anchors.html,v 1.5 2003/06/23 01:51:36 nick Exp $
@


1.5
log
@sync with steelix translation CVS
@
text
@d47 1
a47 1
サブルールセットは filter、<tt>nat</tt>, <tt>rdr</tt>、<tt>binat</tt> ルールの
d223 1
a223 1
$Translation: anchors.html,v 1.7 2003/06/23 06:36:11 toshi Exp $
@


1.4
log
@sync with steelix translation CVS
@
text
@d127 19
d221 1
a221 1
Originally [OpenBSD: anchors.html,v 1.4 ]
d223 1
a223 1
$Translation: anchors.html,v 1.6 2003/06/13 04:57:08 toshi Exp $
d225 1
a225 1
$OpenBSD: anchors.html,v 1.4 2003/06/13 02:54:08 nick Exp $
@


1.3
log
@sync with steelix translation CVS
@
text
@d43 2
a44 2
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+3.3">
<tt>pfctl(8)</tt></a> を使用して運用中に操作することもできるので、
d188 2
a189 2
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+3.3">
<tt>pfctl(8)</tt></a> を参照してくだ世気ぁ
箍芦
甓芦
蜃蜴瘡踟緕帯頂釿蓖鴦讙窺箍梓
甓梓
ぴ鱇銖赱闔瘤竏闥鶤蔗迪旭劾斡欝魂敢亀闢蓍
箍斡
甓斡
は鞳鄲喞瘤竏闥鶤蔗迪旭劾圧鯵紺該鬼蜒祷

窺跫齷釿蜚齡繞跚瘤鼬癆蜿置
絶恐
甼すべての <a href="../rdr.html"><tt>rdr</tt></a> ルールを評価します。 
d204 1
a204 1
$Translation: anchors.html,v 1.4 2003/06/05 12:20:40 toshi Exp $
@


1.1
log
@
sync with steelix translation CVS
@
text
@d20 1
a20 1
[<a href="../logging.html">前に戻る: ログの取得鹿畩箋甬すべての <a href="../filter.html">filter</a> ルールを評価します。
d57 1
a57 1
すべての <a href="../nat.html#binat"><tt>binat</tt></a>
d60 1
a60 1
すべての <a href="../nat.html"><tt>nat</tt></a> ルールを評価します。
d192 1
a192 1
[<a href="../logging.html">前に戻る: ログの取得鹿畩箍梓
甓梓
ぴ鱇銖赱闔瘤竏闥鶤蔗迪旭劾圧渦些戯臼闢蓍

