head	1.12;
access;
symbols;
locks; strict;
comment	@# @;


1.12
date	2005.08.13.08.24.51;	author saad;	state dead;
branches;
next	1.11;

1.11
date	2004.05.09.09.58.22;	author saad;	state Exp;
branches;
next	1.10;

1.10
date	2004.02.25.18.31.45;	author jufi;	state Exp;
branches;
next	1.9;

1.9
date	2004.01.04.22.47.55;	author horacio;	state Exp;
branches;
next	1.8;

1.8
date	2003.12.15.19.44.12;	author horacio;	state Exp;
branches;
next	1.7;

1.7
date	2003.12.03.21.55.18;	author horacio;	state Exp;
branches;
next	1.6;

1.6
date	2003.11.10.21.40.53;	author horacio;	state Exp;
branches;
next	1.5;

1.5
date	2003.11.03.16.54.43;	author jufi;	state Exp;
branches;
next	1.4;

1.4
date	2003.09.26.13.21.47;	author horacio;	state Exp;
branches;
next	1.3;

1.3
date	2003.09.19.16.44.18;	author horacio;	state Exp;
branches;
next	1.2;

1.2
date	2003.07.11.20.33.06;	author jufi;	state Exp;
branches;
next	1.1;

1.1
date	2003.06.21.10.04.16;	author jufi;	state Exp;
branches;
next	;


desc
@@


1.12
log
@remove unmaintained [ja] translation files.  requested by translator.
@
text
@<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>PF: パケットキューイングと優誓莉膂棉佞鹿緇
殊蜴鱚痲紜鱚羹瘟踉鏈戦鞳鈞黻鱧⊂
狩續蔗髟蝟就衷銓緕奘鞳竢銓緕♯纔蔗迪竏癇黼瓶廊屋臆丐狩續釶辣就鱚齒竇紜闔銓就粹笊辣銓⊂
狩續釶辣就粤黹鱸頸蜿遐闔銓就緕帯徳鞜艱⊂
狩續釶辣就諷闥糂闔銓就關緕碵筱聲飫鞴⊂
狩續釶辣就粡齡鱸碯闔闔銓就芟閧瘡⊂
狩續釶辣就竢顆鱸艾槇闔銓就壽蜩閭緕竢顆鱸艾屋鯵旭磔鞳鄲喞鹿蒹痲
錫閼砒竢跫鮟■聿聿聿就０旭旭唖次癈黼跚籬鬯鱧韭縺黼繞蜚蓍
韭縺黼轣閹竏癇鞳跚鈬

守辯踉就柤鞳鄲喞蘗繪艾外蜆襲官鱆就轣艱鶩鼾瘡踉蜚跂蜀⊂
腫杣蓿繙就瘤竏闥鶤蔗迪⊂前に戻る: アンカーと名前付き (サブ) ルールセット</a>]
[<a href="index.html">目次</a>]
[<a href="pools.html">次に進む: アドレスプールと負荷分散 (Load Balancing)</a>]

<p>
<h1><font color="#e00000">PF: パケットキューイングと優誓莉膂棉佞鹿肬銓昭云


取鮠

取馨目次</h3>
<ul>
<li><a href="#queueing">キューイング</a>
<li><a href="#sched">スケジューラ</a>
	<ul>
	<li><a href="#cbq">CBQ (Class Based Queueing)</a>
	<li><a href="#priq">PRIQ (Priority Queueing)</a>
	<li><a href="#red">RED (Random Early Detection)</a>
	<li><a href="#ecn">明声寫堋銘鹿畩
	鹿殊蘊釈鱚羹■瘡⊂キューイングの誓瀋鹿畩
殊蘊釈鱚羹■癈皷芬⊂キューへのトラフィックの割り当て</a>
<li><a href="#example1">例 #1: 小規模事務所、家庭内ネットワーク</a>
<li><a href="#example2">例 #2: 企業ネットワーク</a>
</ul>

<hr>

<a name="queueing"></a>
<h2>キューイング</h2>
<p>
何かをキューに入れるということは、それが処理を待つ間、順序に従って、
それを蓄誓僂垢襪箸いΔ海箸任后灰鵐團紂璽織優奪肇錙璽任蓮▲如璽織僖吋奪箸
ホストから送出される際、それらはオペレーティングシステムによって処理されるのを待つ間、
キューに入れられます。そして、オペレーティングシステムは、どのキューに入れられている、
どのパケットを処理すべきであるのかを決定します。オペレーティングシステムが選択した、
処理すべきパケットの順序は、ネットワークの誓修鳳洞舛鰺燭┐泙后
たとえば、SSH と FTP という、ふたつのネットワークアプリケーションを実行する
ユーザのことを想像してみてくだ世気ぁＭ枦砲蓮∋屬防甸兇喩ぢの誓舛里燭瓠
嗷のパケットは FTP のパケットより誓茲暴萢気譴襪戮任靴腓Α
たとえば、SSH クライアントで鍵がタイプされた場合には、直ちに反応することが
期待されますが、数秒の余計な遅延を発誓犬気擦墅ぢ転送が、何らかのメッセージの
原因となることはほとんどありません。しかし、このような誓楝海離魯鵐疋螢鵐阿鮃圓Ε襦璽燭
嗷誓楝海僚萢料阿墅ぢ誓楝海蕕梁舂未離僖吋奪箸硫瑤鮟萢垢訃豺隋
どのようなことが起きるでしょうか ?  SSH 誓楝海離僖吋奪箸魯紂爾房茲蟷弔気譴襪里
ぢあるいは、ルータがすべてのパケットを保持するのに十分大きなキューがない場合には、
このようなパケットは廃棄されてしまうかも知れません)、
SSH の誓楝海話抉笋掘阿覆辰燭茲Δ妨┐襪眞里譴泙擦鵝修海如
使用されているキューイングの誓鑪鯤儿垢垢襪海箸砲茲辰董曚覆襯▲廛螢院璽轡腑鵝▲罅璽供
そしてコンピュータの間で、ネットワークの帯域幅を適誓気剖ν垢襪海箸任襪茲Δ砲覆蠅泙后

腫キューイングは、<i>送出</i>方向のパケットに対してのみ役に立つということに
注意してくだ世気ぁい辰燭鵝綽離僖吋奪箸ぅ鵐拭璽侫Дぅ垢謀紊靴浸誓で、
このパケットのキューイングするのはもう既に遅過ぎるのです。なぜなら、このパケットは、
これを受信するインターフェイスに到着するまでに、既にネットワーク帯域を
消費してしまっているからなのです。これに対する解決策は、近隣のルータの
キューイングを有効化するか、パケットをルータに送出する内部インターフェイスの
キューイングを有効化することだ世韻任后

釈瘢綵‰竏繖⊂鹿畩
取仮スケジューラ</h2>
スケジューラは、処理すべきキューとその中の順序を決定します。
デフォルトでは、OpenBSD は FIFO (First In First Out) スケジューラを使用します。
FIFO キューは、スーパーマーケットや銀行における人の行列と同じように動きます。
つまり、キューに入れられた最初の要素は最初に処理されることになります。新しい
パケットが到着すると、それはキューの最後に追加されます。もし、キューが一杯になると、
新しく到着したパケットは廃棄されます。これはテイルドロップとして知られています。

<p>
OpenBSD では FIFO 以外に以下のふたつのスケジューラをサポートしています。
<ul>
<li>CBQ (Class Based Queueing)
<li>PRIQ (Priority Queueing)
</ul>

<a name="cbq"></a>
<h3>CBQ (Class Based Queueing)</h3>
CBQ (Class Based Queueing) は、複数のキューやクラスの間で、ネットワーク
誓楝海梁唹萇諒笋鮃圓Ε紂璽ぅ鵐哀▲襯乾螢坤爐任后修譴召譴離紂爾蓮
送信元あるいは送信誓茲離▲疋譽垢筌檗璽犯峭罅▲廛蹈肇灰襪覆匹亡陲鼎い
割り当てられるトラフィックを持っています。ひとつのキューは、オプションとして
親キューの使用率が低い場合に、親キューから帯域幅を借りるよう構誓気譴討い
かも知れません。キューはまた、SSH のような会話的なトラフィックを含む場合に、
FTP のような巨大なトラフィックを含むキューに誓萠辰討修離僖吋奪箸萢気譴
優誓荼△鰺燭┐蕕譴討い襪眞里譴泙擦鵝

腫誕のキューは階層的な方法で配置されます。階層の最上位には、
利用可能な帯域幅の総量を定義するルート (root) キューが
位置しています。子キューがルートキューの下に誓言成され、その
それぞれに、ルートキューの帯域幅の一部が割り当てられています。
たとえば、キューが以下のように定義されているとしましょう。
<dl>
<dd>ルートキュー (2Mbps)
	<dl>
	<dd>キュー A (1Mbps)
	<dd>キュー B (500Kbps)
	<dd>キュー C (500Kbps)
	</dl>
</dl>

<p>
この場合、利用可能な総帯域幅は 2Mbps に誓瀋蠅気譴討い泙后
そして、この帯域幅は 3 個の子キューの間で分割されています。

<p>
この階層は、キューの中にキューを定義することで、さらに拡張することができます。
異なるユーザの間で帯域幅を均等に分割し、そして、あるプロトコルが他のトラフィックの
帯域幅を枯渇させることがないように彼らのトラフィックをクラス化することで、
たとえば、以下のようなキューイング構造を定義することができます。
<dl>
<dd>ルートキュー (2Mbps)
	<dl>
	<dd>ユーザ A (1Mbps)
		<dl>
		<dd>ssh (50Kbps)
		<dd>バルク (950Kbps)
		</dl>
	<dd>ユーザ B (1Mbps)
		<dl>
		<dd>オーディオ (250Kbps)
		<dd>バルク (750Kbps)
			<dl>
			<dd>http (100Kbps)
			<dd>その他 (650Kbps)
			</dl>
		</dl>
	</dl>
</dl>

<p>
それぞれのキューに割り当てられた帯域幅の合計が、親キューに
割り当てられた帯域幅以上にはならないことに注意してくだ世気ぁ

腫他の子キューに利用されていない利用可能な帯域幅を、親キューが過剰に
持っている場合に、その親キューから帯域幅を借りるようにキューの誓瀋蠅
行うことができます。たとえば、以下のようなキューの構誓鮃佑┐討澆泙后
寂貍
寂箴ルートキュー (2Mbps)
	<dl>
	<dd>ユーザ A (1Mbps)
		<dl>
		<dd>ssh (100Kbps)
		<dd>ftp (900Kbps、借用)
		</dl>
	<dd>ユーザ B (1Mbps)
	</dl>
</dl>

<p>
ここで、<tt>ftp</tt> 用のキューのトラフィックが 900Kbps を超え、<tt>ユーザ A</tt>
のキューのトラフィックが (ssh は、それ用のキューに割り当てられた 100Kbps
未満の帯域しか使用していないので) 1Mbps 未満なら、<tt>ftp</tt>
用のキューは超過した帯域幅を<tt>ユーザ A</tt> から借用することができます。
このように、<tt>ftp</tt> 用のキューは、それが過負荷に直面した場合に、
それ用に割り当てられた帯域幅以上を使用することができるのです。もし、<tt>ssh</tt>
の負荷が増加した場合には、借用した帯域幅は返却されることになります。

<p>
CBQ はそれぞれのキューに優誓菘戮魍笋蠹討泙后茲蟾發ねダ先度を持つキューは、
より低い優誓菘戮鮖張紂爾汎韻舷討魘ν垢觚造蠅砲い換言世垢譴弌
両方のキューが階層構造の中の同じ枝に位置している限りにおいては)、
輻輳の際により低い優誓菘戮鮖張紂爾僕ダ先します。また、同一の優誓菘戮鮖
キューは、ラウンドロビン方式で処理されて行きます。たとえば、以下において、
<dl>
<dd>ルートキュー (2Mbps)
	<dl>
	<dd>ユーザ A (1Mbps、優誓菘		寂貍
		寂箴齠┗旭魔頌、優誓菘		寂箴胄┨旭魔頌、優誓菘		鹿粲	寂箴ユーザ B (1Mbps、優誓菘	鹿粲鹿粲
腫誕は、<tt>ユーザ A</tt> と<tt>ユーザ B</tt> 用のキューをラウンドロビン方式で
処理します。つまり、どちらのキューも他方に優誓茲垢襪海箸呂△蠅泙擦鵝
儒ユーザ A</tt> 用のキューが処理されている間、<tt>CBQ</tt>
はその子キューの処理も行います。この場合、<tt>ssh</tt>
用のキューはより高い優誓菘戮鮖繊▲優奪肇錙璽寫圓靴討い訃豺腓法
儒胄霄ぢ用のキューより優誓菘並垓燭┐蕕譴襪海箸砲覆蠅泙后
儒ユーザ A</tt> 用と<tt>ユーザ B</tt> 用のキューと比較して、<tt>ssh</tt> 用と
<tt>ftp</tt> 用のキューは、どのような優誓菘戮盪辰討い覆い海箸肪躇佞靴討誓さい。
なぜなら、これらは、階層構造の中ですべてが同じ枝に位置しているわけではないからです。

<p>
より詳細な CBQ 関連の理論世鮹里蠅燭ぞ豺腓砲蓮
釈鱚羹∵雕蜒蜥鱧跫碌譬消耐ぢに関するリファレンス</a>を参照してくだ世気ぁ

釈瘢綵鱸顴昭取馨侑頻會蜿鱸蜴腥鹿莖侑頻會蜿鱸蜴腥ぢは、それぞれのキューに固有の優誓菘戮燭┐蕕譴
複数のキューを、ネットワークインターフェイスに割り当てます。
より高い優誓菘戮鮖張紂爾蓮守ぢ常に</i>より低い優誓菘戮離紂爾茲蠕先に
処理が行われます。

<p>
PRIQ のキューイング構造は均一です。つまり、キューの中に
キューを定義することはできません。利用可能な帯域幅の
総量を誓瀋蠅靴織襦璽肇紂爾蟲舛気譟△修硫爾縫汽屮紂爾
定義されます。以下の例について考えてみましょう。
<dl>
<dd>ルートキュー (2Mbps)
	<dl>
	<dd>キュー A (優誓菘	寂箴キュー B (優誓菘	寂箴キュー C (優誓菘	鹿粲鹿粲
腫ルートキューは、2Mbps の利用可能な帯域幅を持つものとして定義され、
その下に 3 個のサブキューが定義されています。最も高い優誓菘戮離紂
ぢ優誓莉膂未糧峭罎嚢發里發は最初に処理されます。いったん、キューの
中のすべてのパケットが処理されるか、あるいはキューが空になると、PRIQ
は次に高い優誓菘戮鮖張紂爾暴萢魄椶靴泙后Ｍ燭┐蕕譴織紂爾涼罎任蓮
パケットは FIFO (First In First Out) 方式で処理が行われます。

<p>
PRIQ を使用する場合、キューイングの計画を非常に慎重に行わなければならないことに
注意することが非常に重要です。これは、PRIQ が、<i>常に</i>より高い優誓菘戮離紂爾
より低い優誓菘戮里發里茲蠕先に処理するからであり、より高い優誓菘戮離紂爾蠑鐡
ストリームのパケットを受信している場合には、このより高い優誓菘戮離紂爾△茲蠶磴
優誓菘戮離紂爾鮹抉笋気擦燭蝓△△襪い魯僖吋奪箸儡気譴觚彊砲覆辰燭蠅垢襪海箸
あるからなのです。

<a name="red"></a>
<h3>RED (Random Early Detection)</h3>
RED (Random Early Detection) は輻輳回避アルゴリズムです。その仕事は、
キューが一杯にならないことを確実にすることで、ネットワークの輻輳を
回避することです。これは、キューの平均的な長さ (サイズ) を連続的に計算し、
それをふたつの閾値、つまり下限の閾値および上限の閾値と比較することによって
行われます。もし、平均的なキューのサイズが下限の閾値を下回っている場合には、
パケットが廃棄されるようなことはまったくありません。しかし、平均値が上限の
閾値を上回っているような場合には、新しく着信する<i>すべての</i>パケットが
廃棄されてしまいます。もし、平均値がこれらふたつの閾値の間の値であれば、
平均的なキューのサイズから計算された確率に基づいて、パケットは廃棄される
ことになります。これは換言世垢譴弌∧振囘淵紂爾離汽ぅ困絽造麗臙佑
近付けば近付くほどパケットはより多く廃棄されることになるということです。
パケットを廃棄する場合には、RED はパケットを廃棄する誓楝海鬟薀鵐誓ムに選択します。
これは、より大きな帯域幅の総量を使用している誓楝海曚鼻▲僖吋奪箸儡気譴
確率がより高いということになります。

<p>
RED は、global synchronization 問題として知られる状況を回避することができますし、
また、爆発的なトラフィックに対応することもできますので、非常に役に立つものです。
global synchronization は、いくつかの誓楝海蘰瓜縫僖吋奪箸鯒儡靴討靴泙Δ燭瓠
全体的なスループットの低下を招いてしまうものでず。たとえば、10 個の FTP 誓楝海
中継するルータで輻輳が発誓犬掘鋲キューイングの場合のように) すべての
(あるいはほとんどの) これらの誓楝海儡気譴疹豺腓砲蓮∩澗療淵好襦璽廛奪箸
著しく低下してしまうことになります。
もちろん、これは、すべての FTP 誓楝海修離好襦璽廛奪箸鯆祺爾気擦討靴泙Δ海箸
なりますし、また、ネットワークはもはやその能力を十分に活用できない状態になって
しまいますので、とても理想的な状態であるとは言世┐覆覆辰討靴泙い泙后
凖は、すべての誓楝海鯀鬚垢訛紊錣蠅法▲僖吋奪箸鯒儡垢訐接続をランダ瀬爐
選択することによって、このような状況を回避します。より大きな帯域幅の総量を
使用している誓楝海蓮△修離僖吋奪箸鯒儡気譴覯椎柔性がより高くなります。
このようにして、大きな帯域幅を消費する誓楝海座気譴襪海箸剥寫圓麋鬚気譟
全体的なスループットの著しい低下は発誓犬靴覆覆襪里任后気蕕法凖は、
キューが一杯になる<i>前に</i>パケットの廃棄を開始するため、爆発的な
トラフィックにも対応することができます。爆発的なトラフィックがやって来た場合にも、
キューには新しいパケットを受信するのに十分なスペースが残されているはずです。

<p>
RED は、ネットワークからの輻輳通知に対して、トランスポートプロトコルが応答できる
場合にのみ使用することができます。ほとんどの場合において、これは UDP や ICMP
のトラフィックではなく、TCP トラフィックをキューイングする場合に RED
を使用すべきであるということを意味します。

<p>
より詳細な RED 関連の理論世鮹里蠅燭ぞ豺腓砲蓮
釈鱚羹∵雕蜒蜥鱧跫繖譬紹田ぢに関するリファレンス</a>を参照してくだ世気ぁ

釈瘢綵√竡⊂鹿畩
取馨明声寫堋銘鹿莖明声寫堋銘澱虜跚竕衷鈑纉闔阡蜀蜒癆蜿遘ぢは、通信経路が
輻輳状態にあるネットワーク上で通信中の 2 台のホストにそれを通知するため、RED
とともに動作します。これは、パケットを廃棄するのではなく、パケットヘッダ醒罎
フラグをセットするために RED を有効化することによって行われます。送信中の
ホストが ECN をサポートしていると仮定した場合、そのホストがこのフラグを読み、
そのネットワークトラフィックをそれに従って減速することで行われます。

<p>
ECN についてのより詳しい情報は、
<a href="http://www.rfc-editor.org/rfc/rfc3168.txt">RFC 3168</a> を参照してくだ世気ぁ

釈瘢綵≡踉顴昭取仮キューイングの誓瀋鹿莢緕帯凱から
<a href="http://www.csl.sony.co.jp/person/kjc/kjc/software.html#ALTQ"
>ALTQ (Alternate Queueing)</a> のキューイングの実装が基本システムの一部として
組み込まれました。また、OpenBSD 3.3 からは、ALTQ は PF に統合されました。OpenBSD の
ALTQ の実装は、CBQ (Class Based Queueing) と PRIQ (Priority Queueing) スケジューラを
サポートしています。また、OpenBSD の ALTQ は、RED (Random Early Detection) と
明声寫堋銘澱虜跚竕衷鈑纉闔阡蜀蜒癆蜿遘ぢもサポートしています。

<p>
ALTQ は PF にマージされたので、キューイングを動作させるためには PF を
有効化しなければなりません。PF をどのようにして有効化させるのかに関しては、
<a href="config.html#activate">はじめに</a> を参照してくだ世気ぁ

腫キューイングは、<tt>
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&amp;sektion=5&amp;manpath=OpenBSD+3.4"
>pf.conf</a></tt> で誓瀋蠅気譴泙后紂璽ぅ鵐阿寮設定には、以下のような
ふたつのタイプのディレクティブが使用されます。
<ul>
<li><tt>altq on</tt> - インターフェイス上でキューイングを有効化して、
どのスケジューラを使用するかを定義し、そしてルートキューを誓言成します。
<li><tt>queue</tt> - 子キューの属誓鯆蟲舛靴泙后
鹿
腫儒瘡郤ぢディレクティブのシンタクスは以下のとおりとなっています。
<blockquote>
<tt>
altq on <i>interface scheduler</i> bandwidth <i>bw</i> qlimit 
<i>qlim</i> \<br>
&nbsp;&nbsp;&nbsp;tbrsize <i>size</i> queue { <i>queue_list</i> }
</tt>
</blockquote>

<ul>
<li><tt><i>interface</i></tt> - キューイングを有効化するネットワークインターフェイス
<li><tt><i>scheduler</i></tt> - 使用するキューイングスケジューラ。指定可能な値は、
<tt>cbq</tt> と <tt>priq</tt> です。ある時点世如△劼箸弔離ぅ鵐拭璽侫Дぅ江紊
有効化可能なスケジューラはひとつだ世韻任后
殊蘊儒守鐘昭ぢスケジューラが利用可能な帯域幅の総量。この値には、
ビット毎秒、キロビット毎秒、メガビット毎秒およびギガビット毎秒を表現するのに、
<tt>b</tt>、<tt>Kb</tt>、<tt>Mb</tt> あるいは <tt>Gb</tt> を付けた誓簑价佑
あるいは<tt><i>インターフェイス</i><tt>の
帯域幅のパーセンテージを指定することができます。
<li><tt><i>qlim</i></tt> - キューに保持されるパケット数の最大値。このパラメータは
オプションです。また、デフォルトは 50 です。
<li><tt><i>size</i></tt> - トークンのバケットの調誓以曚離汽ぅ困鬟丱ぅ反瑤派修錣靴燭發痢海譴
指定されていなければ、<tt><i>インターフェイス</i><tt>の帯域幅に基づいてサイズが誓瀋蠅気譴泙后
殊蘊儒守擾煬蜩昭ぢルートキューの下に誓言成する子キューの
リスト。
</ul>

<p>
たとえば、
<blockquote>
<tt>
altq on fxp0 cbq bandwidth 2Mb queue { std, ssh, ftp }
</tt>
</blockquote>
の場合は、インターフェイス <tt>fxp0</tt> 上で CBQ を有効化しています。また、利用可能な全帯域幅は
2Mbps に誓瀋蠅気譴討い泙后修靴董儒齡篌、<tt>ssh</tt> および <tt>ftp</tt> という
3 個の子キューが定義されています。

<p>
<tt>queue</tt> ディレクティブのシンタクスは以下のとおりとなっています。
<blockquote>
<tt>
queue <i>name</i> [on <i>interface</i>] bandwidth <i>bw</i> [priority 
<i>pri</i>] [qlimit <i>qlim</i>] \<br>
&nbsp;&nbsp;&nbsp;<i>scheduler</i> ( <i>sched_options</i> )
{ <i>queue_list</i> }
</tt>
</blockquote>

<ul>
<li><tt><i>name</i></tt> - キュー名。これは、<tt>altq on</tt> ディレクティブの
<tt><i>queue_list</i></tt> で指定されたキューのひとつの名前と一致していなければ
なりません。<tt>cbq</tt> では、その前の <tt>queue</tt> ディレクティブの
<tt><i>queue_list</i></tt> のキュー名に一致するものでも構いません。
キュー名は 15 文字より長いものであってはいけません。
<li><tt><i>interface</i></tt> - キューが有効となるネットワークインターフェイス。
この値はオプショナルなものであり、指定されていない場合には、
キューはすべてのインターフェイス上で有効になります。
<li><tt><i>bw</i></tt> - キューが利用可能な帯域幅の総量。
この値には、
ビット毎秒、キロビット毎秒、メガビット毎秒およびギガビット毎秒を表現するのに、
<tt>b</tt>、<tt>Kb</tt>、<tt>Mb</tt> あるいは <tt>Gb</tt> を付けた誓簑价佑
あるいは親キューの
帯域幅のパーセンテージを指定することができます。
このパラメータは、<tt>cbq</tt> スケジューラを使用した場合にのみ適用できます。
<li><tt><i>pri</i></tt> - キューの優誓菘戞儒竄饉ぢでは、優誓菘戮糧楼呂
〜 7 の間であり、<tt>priq</tt> の範囲は 0 〜 15 の間です。
ここで、優誓菘ぢは、最も低い優誓菘戮任后泙拭△海譴慊蠅気譴討い覆ぞ豺腓砲蓮
がデフォルト値として使用されます。
<li><tt><i>qlim</i></tt> - キューに保持されるパケットの最大値。
また、これが指定されていない場合には、50 がデフォルト値として使用されます。
<li><tt><i>scheduler</i></tt> - 使用されるスケジューラで、<tt>cbq</tt> か
<tt>priq</tt> のいずれか。ルートキューと同じものでなければなりません。
<li><tt><i>sched_options</i></tt> - スケジューラの挙動を誓罎垢襪燭瓩砲錣燭垢海箸硫椎修
オプション。
	<ul>
	<li><tt>default</tt> - 他のどのキューにもマッチしないパケットを
	キューイングするためのデフォルトのキューの定義。デフォルトキューは、
	誓騎里砲劼箸弔靴蟲舛垢襪海箸呂任泙擦鵝
	殊蘊儒鱚篌ぢこのキューで RED (Random Early Detection) を有効化。
	<li><tt>rio</tt> - 入出力ともに RED を有効化。このモードでは、RED
	複数の平均キュー長、複数の閾値、そしてそれぞれの IP のサービス品質
	(QoS) のうちのひとつを保守します。
	<li><tt>ecn</tt> - このキューで明声寫堋銘澱虜跚竕衷鈑纉闔阡蜀蜒癆蜿遘
	有効化。<tt>ECN</tt> は暗黙のうちに <tt>red</tt> を有効化します。
	<li><tt>borrow</tt> - 親から帯域幅を借用することのできるキュー。これは、
	<tt>cbq</tt> スケジューラを使用している場合にのみ指定可能です。
	</ul>
<li><tt><i>queue_list</i></tt> - このキューの下に誓言成される子キューのリスト。
<tt><i>queue_list</i></tt> は、<tt>cbq</tt> スケジューラを使用している場合にのみ
指定可能です。
</ul>

<p>
上記の例の続きを以下に示します。
<blockquote>
<tt>
queue std bandwidth 50% cbq(default)<br>
queue ssh { ssh_login, ssh_bulk }<br>
&nbsp;&nbsp;queue ssh_login  priority 4 cbq(ecn)<br>
&nbsp;&nbsp;queue ssh_bulk   cbq(ecn)<br>
queue ftp bandwidth 500Kb priority 3 cbq(borrow red)<br>
</tt>
</blockquote>

<p>
ここでは、以前に定義された子キューのパラメータを誓瀋蠅靴討い泙后
儒齡篌ぢキューは、ルートキューの帯域幅 (または 1Mbps) の
50% の帯域幅が割り当てられ、デフォルトキューとして誓瀋蠅気譴討い泙后
儒齠莠ぢキューには、<tt>ssh_login</tt> と <tt>ssh_bulk</tt>
という、ふたつの子キューが定義されています。<tt>ssh_login</tt> には
<tt>ssh_bulk</tt> よりも高い優誓菘戮燭┐蕕譴討蝓△匹舛蕕知
が有効化されています。また、<tt>ftp</tt> キューには 500Kbps
の帯域幅が割り当てられ、優誓菘ぢが与えられています。そしてこれは、
余力がある場合には帯域幅の借用も可能となっていて、RED も有効化されています。

<a name="assign"></a>
<h3>キューへのトラフィックの割り当て</h3>
<p>
キューにトラフィックを割り当てるためには、PF の <a href="filter.html">フィルタルール</a>
とともに <tt>queue</tt> キーワードを使用します。たとえば、
以下のような行を含むフィルタルールの誓瀋蠅鮃佑┐討澆泙靴腓Α
錫跫站髟阡緇
儒鞜齠胯隶鳫瘤銷闥臆鹿鹿碎閭鞫
腫パケットは、<tt>queue</tt> キーワードを使用して、
特定のキューに割り当てられたルールにマッチします。
<blockquote>
<tt>pass out on fxp0 from any to any port 22 queue ssh</tt>
</blockquote>

<p>
<tt>queue</tt> キーワードが <tt>block</tt> ディレクティブとともに使用された場合、
その結果として、TCP RST や ICMP Unreachable パケットが指定されたキューに
割り当てられます。

<p>
<tt>altq on</tt> ディレクティブで定義されたインターフェイス以外の、
インターフェイス上でキューの指定が行われる可能誓△襪海箸肪躇佞靴討誓さい。
<blockquote>
<tt> 
altq on fxp0 cbq bandwidth 2Mb queue { std, ftp }<br>
queue std cbq(default)<br>
queue ftp bandwidth 1.5Mb<br>
<br>
pass in on dc0 from any to any port 21 queue ftp<br>
</tt>
</blockquote>

<p>
キューイングは <tt>fxp0</tt> 上で有効化されていますが、タグ付けは <tt>dc0</tt>
上で行われます。もし、インターフェイス <tt>fxp0</tt> から出てきた、<tt>pass</tt>
ルールにパケットがマッチする場合、これらのパケットは、<tt>ftp</tt>
キューにキューイングされるはずです。この方式のキューイングは、
ルータに取っては非常に役に立つものです。

<p>
通常は、ひとつのキュー名だ世韻擾鹿キーワードに与えられますが、
もし、ふたつ目の名前が指定されている場合には、そのキューは、低遅延のための
<a href="http://www.rfc-editor.org/rfc/rfc791.txt">ToS (Type of Service)</a>
パケットか、データのペイロードのない TCP ACK パケットのために使用されます。
この良い例が、SSH を使用している場合になります。SSH のログインセッションは、
低遅延のために ToS を誓瀋蠅靴討い泙垢喘や SFTP のセッションには
これが誓瀋蠅気譴討い泙擦鵝估ぢは、非ログイン誓楝外奮阿琉曚覆襯紂爾涼罎離蹈哀ぅ
誓楝海紡阿垢襯僖吋奪箸鬟紂璽ぅ鵐阿垢襪燭瓩法△海両霾鵑鮖藩僂垢襪海箸任泙后
これは、ファイル転送のパケットよりログイン誓楝海離僖吋奪箸鰺ダ先させるのに役立ちます。
<blockquote>
<tt>pass out on fxp0 from any to any port 22 queue(ssh_bulk, ssh_login)</tt>
</blockquote>

<p>
これは、SSH のログイン誓楝海紡阿垢襯僖吋奪箸杖鼈煬閾蜴鹿キューに割り当て、SCP や SFTP 誓楝海紡阿垢襯僖吋奪箸杖鼈烽觴
キューに割り当てています。<tt>ssh_login</tt> キューは、
より高い優誓菘戮鮖辰討い襪里如嗷ログイン誓楝海離僖吋奪箸蓮
喘や SFTP 誓楝海僕ダ先して処理されるようになります。

<p>
TCP ACK パケットをより高い優誓菘戮鮖張紂爾乏笋蠹討襪海箸蓮△燭箸┐
祖嗅ぢ回誓里茲Δ法▲▲奪廛蹇璽匹肇誓ウンロードの帯域幅が異なっているような、
非対称の誓楝海砲い栃慷覆發里任后祖嗅ぢ回誓任蓮▲▲奪廛蹇璽匹離船礇優襪
非常に混雑している場合にダ瀬Ε鵐蹇璽匹呂泙襪函▲▲奪廛蹇璽疋船礇優襪鯆未靴
埣礎パケットを送信しようとする際に、輻輳している中に
それを送信しなければならないため、
ダ瀬Ε鵐蹇璽匹皹洞舛鮗韻襪海箸砲覆辰討靴泙い泙后
最良の結果を得世襪燭瓩縫謄好箸鮃圓辰董▲▲奪廛蹇璽匹離紂爾梁唹萇髻
その能力より小さな値に誓瀋蠅垢戮任后尊櫃砲蓮▲▲奪廛蹇璽匹虜蚤臙佑
挟伊の ADSL 回誓両豺腓任垢函▲襦璽肇紂爾儒帯域幅</tt>を
600Kb のような値に誓瀋蠅垢襪海箸如△茲衫匹だ性能を得世蕕譴襪茲Δ砲覆蠅泙后
そして試行錯誤を行うことで、最良の<tt>帯域幅</tt>の誓瀋蠅鯑誓られるはずです。

<p>
以下のように、<tt>keep state</tt> が指定されたルールに対して
<tt>queue</tt> キーワードを使用する場合、
<blockquote>
<tt>
pass in on fxp0 proto tcp from any to any port 22 flags S/SA \<br>
&nbsp;&nbsp;&nbsp;keep state queue ssh
</tt>
</blockquote>

<p>
PF は、状態を持つ誓楝海縫泪奪舛靴拭儒胯隶鹿から出て行くパケットが、
最後に <tt>ssh</tt> キューに入るよう、その状態テーブルのエントリにキューを登録します。
<tt>queue</tt> キーワードが着信トラフィックをフィルタリングするルールに対して
使用されているにも関わらず、その目的が関係する送出トラフィックのためのキューを
指定するためであるということに注意してくだ世気ぁ綉離襦璽襪蓮
着信パケットをキューイングするためのものではないのです。

<a name="example1"></a>
<h2>例 #1: 小規模事務所、家庭内ネットワーク</h2>
<pre>
  
    [ Alice ]    [ Charlie ]
        |             |                              ADSL
     ---+-----+-------+------ dc0 [ OpenBSD ] fxp0 -------- ( Internet )
              |
           [ Bob ]

</pre>

<p>
この例では、OpenBSD は 3 台のワークステーションが誓楝海気譴拭⊂呂焚板軻
ネットワークのインターネットゲートウェイとして使用されています。このゲートウェイは、
パケットフィルタリングと NAT の仕事を行っています。ADSL 回誓鮖藩僂靴
インターネット誓楝海蓮爾蠅翌頌ぢで上りが 640Kbps となっています。

<p>
このネットワークのキューイングのポリシーは以下のとおりです。
<ul>
<li>Alice や Charlie のダ瀬Ε鵐蹇璽匹房挧發気譴襪海箸覆啄がオンラインゲームを
楽しめるよう、下りの帯域幅のうちの 80Kbps を彼のために予約します。可能な場合には、
Bob は 80Kbps 以上の帯域幅を利用することもできます。
<li>会話的な SSH のトラフィックやインスタントメッセージのトラフィックは、
通常のトラフィックより高い優誓菘戮鮖弔茲Δ砲靴泙后
殊蘊栂の問い合わせとその応答は、その次に高い優誓菘戮鮖弔茲Δ砲靴泙后
殊蘊送出される TCP ACK パケットは、その他のすべての送出トラフィックよりも
高い優誓菘戮鮖弔茲Δ砲靴泙后
鹿
腫以下は、このネットワークポリシーに適合するルールセットです。上記のポリシーに
直誓榲謀僂気譴情罧竢鈕鹿のディレクティブだ世韻減澆靴討い襪海箸
注意してくだ世気ぁ釈鱚羹癆譬昭嬢癆鹿昭ぢ、
<a href="rdr.html"><tt>rdr</tt></a> と <a href="options.html">オプション</a>などは、
これには含まれていません。

<p>
<table border=0 width="650">
<tr><td nowrap bgcolor="#EEEEEE">
<pre>
# enable queueing on the external interface to control traffic going to
# the Internet. use the priq scheduler to control only priorities. set
# the bandwidth to 610Kbps to get the best performance out of the TCP
# ACK queue.

altq on fxp0 priq bandwidth 610Kb queue { std_out, ssh_im_out, dns_out, \
	tcp_ack_out }

# define the parameters for the child queues.
# std_out      - the standard queue. any filter rule below that does not
#                explicitly specify a queue will have its traffic added
#                to this queue.
# ssh_im_out   - interactive SSH and various instant message traffic.
# dns_out      - DNS queries.
# tcp_ack_out  - TCP ACK packets with no data payload.

queue std_out     priq(default)
queue ssh_im_out  priority 4 priq(red)
queue dns_out     priority 5
queue tcp_ack_out priority 6

# enable queueing on the internal interface to control traffic coming in
# from the Internet. use the cbq scheduler to control bandwidth. max
# bandwidth is 2Mbps.

altq on dc0 cbq bandwidth 2Mb queue { std_in, ssh_im_in, dns_in, bob_in }

# define the parameters for the child queues.
# std_in      - the standard queue. any filter rule below that does not
#               explicitly specify a queue will have its traffic added
#               to this queue.
# ssh_im_in   - interactive SSH and various instant message traffic.
# dns_in      - DNS replies.
# bob_in      - bandwidth reserved for Bob's workstation. allow him to
#               borrow.

queue std_in    cbq(default)
queue ssh_im_in priority 4
queue dns_in    priority 5
queue bob_in    bandwidth 80Kb cbq(borrow)


# ... in the filtering section of pf.conf ...

alice         = "192.168.0.2"
bob           = "192.168.0.3"
charlie       = "192.168.0.4"
local_net     = "192.168.0.0/24"
ssh_ports     = "{ 22 2022 }"
im_ports      = "{ 1863 5190 5222 }"

# filter rules for fxp0 inbound
block in on fxp0 all

# filter rules for fxp0 outbound
block out on fxp0 all
pass  out on fxp0 inet proto tcp from (fxp0) to any flags S/SA \
	keep state queue(std_out, tcp_ack_out)
pass  out on fxp0 inet proto { udp icmp } from (fxp0) to any keep state
pass  out on fxp0 inet proto { tcp udp } from (fxp0) to any port domain \
	keep state queue dns_out
pass  out on fxp0 inet proto tcp from (fxp0) to any port $ssh_ports \
	flags S/SA keep state queue(std_out, ssh_im_out)
pass  out on fxp0 inet proto tcp from (fxp0) to any port $im_ports \
	flags S/SA keep state queue(ssh_im_out, tcp_ack_out)

# filter rules for dc0 inbound
block in on dc0 all
pass  in on dc0 from $local_net

# filter rules for dc0 outbound
block out on dc0 all
pass  out on dc0 from any to $local_net
pass  out on dc0 proto { tcp udp } from any port domain to $local_net \
	queue dns_in
pass  out on dc0 proto tcp from any port $ssh_ports to $local_net \
	queue(std_in, ssh_im_in)
pass  out on dc0 proto tcp from any port $im_ports to $local_net \
	queue ssh_im_in
pass  out on dc0 from any to $bob queue bob_in
</pre>
</td></tr>
</table>

<a name="example2"></a>
<h2>例 #2: 企業ネットワーク</h2>
<pre>

  ( IT Dept )  [ Boss's PC ]
       |          |                                   T1
     --+----+-----+---------- dc0 [ OpenBSD ] fxp0 -------- ( Internet )
            |                         fxp1
         [ COMP1 ]    [ WWW ]         /
                         |           / 
                       --+----------' 

</pre>

<p>
この例では、OpenBSD のホストを、企業ネットワークのファイアウォールとして稼働させています。
この会社では、その顧客が FTP で顧客の web サイトをアップロードするため、
この会社のネットワークの DMZ で WWW サーバを運用しています。IT 部門では、
自身のネットワークを基幹ネットワークに誓楝海靴道藩僂靴討い泙后泙拭⊆卍垢蓮
電子メールや web サーフィンに使用するための PC を、自分の机に持っています。
インターネットへは、上下方向ともに 1.5Mbps の T1 回誓鮖藩僂靴得接続しています。
その他のすべてのネットワークセグメントは、Fast Ethernet (100Mbps) を使用しています。

<p>
ネットワーク管理者は以下のようなポリシーを決定しました。
<ul>
<li>インターネットと WWW サーバとの間のトラフィックは、
双方向とも 500Kbps に誓造靴泙后
殊蘊忻サーバと内部ネットワークとの間のトラフィックには、
一誓擇梁唹萇寮制限を誓澆韻泙擦鵝
殊蘊忻サーバとインターネットとの間の HTTP のトラフィックには、
(FTP のアップロードのような) 他の WWW サーバとインターネットとの間の
トラフィックよりも高い優誓菘戮鰺燭┐泙后
殊蘊不ぢ部門のネットワークには、彼らが最新のソフトウェアのアップデートを
適誓擇併縫誓ウンロードできるように 500Kbps を予約します。また、可能な
ときには、彼らは 500Kbps 以上の帯域幅を利用できるようにしています。
<li>社長の PC とインターネットの間のトラフィックには、インターネットとの間の
他のトラフィックよりも高い優誓菘戮鰺燭┐泙后
鹿
腫以下は、このネットワークポリシーに適合するルールセットです。上記のポリシーに
直誓榲謀僂気譴情罧竢鈕鹿のディレクティブだ世韻減澆靴討い襪海箸
注意してくだ世気ぁ釈鱚羹癆譬昭嬢癆鹿昭ぢ、
<a href="rdr.html"><tt>rdr</tt></a> と <a href="options.html">オプション</a>などは、
これには含まれていません。

<p>
<table border=0 width="650">
<tr><td nowrap bgcolor="#EEEEEE">
<pre>
# enable queueing on the external interface to queue packets going out
# to the Internet. use the cbq scheduler so that the bandwidth use of
# each queue can be controlled. the max outgoing bandwidth is 1.5Mbps.

altq on fxp0 cbq bandwidth 1.5Mb queue { std_ext, www_ext, boss_ext }

# define the parameters for the child queues.
# std_ext        - the standard queue. also the default queue for
#                  outgoing traffic on fxp0.
# www_ext        - container queue for WWW server queues. limit to
#                  500Kbps.
#   www_ext_http - http traffic from the WWW server
#   www_ext_misc - all non-http traffic from the WWW server
# boss_ext       - traffic coming from the boss's computer

queue std_ext        cbq(default)
queue www_ext        bandwidth 500Kb { www_ext_http, www_ext_misc }
  queue www_ext_http priority 3 cbq(red)
  queue www_ext_misc priority 1
queue boss_ext       priority 3

# enable queueing on the internal interface to control traffic coming
# from the Internet or the DMZ. use the cbq scheduler to control the
# bandwidth of each queue. bandwidth on this interface is set to the
# maximum. traffic coming from the DMZ will be able to use all of this
# bandwidth while traffic coming from the Internet will be limited to
# 1.0Mbps (because 0.5Mbps (500Kbps) is being allocated to fxp1).

altq on dc0 cbq bandwidth 100% queue { net_int, www_int }

# define the parameters for the child queues.
# net_int    - container queue for traffic from the Internet. bandwidth
#              is 1.0Mbps.
#   std_int  - the standard queue. also the default queue for outgoing
#              traffic on dc0.
#   it_int   - traffic to the IT Dept network.
#   boss_int - traffic to the boss's PC.
# www_int    - traffic from the WWW server in the DMZ.

queue net_int    bandwidth 1.0Mb { std_int, it_int, boss_int }
  queue std_int  cbq(default)
  queue it_int   bandwidth 500Kb cbq(borrow)
  queue boss_int priority 3
queue www_int    cbq(red)

# enable queueing on the DMZ interface to control traffic destined for
# the WWW server. cbq will be used on this interface since detailed
# control of bandwidth is necessary. bandwidth on this interface is set
# to the maximum. traffic from the internal network will be able to use
# all of this bandwidth while traffic from the Internet will be limited
# to 500Kbps.

altq on fxp1 cbq bandwidth 100% queue { internal_dmz, net_dmz }

# define the parameters for the child queues.
# internal_dmz   - traffic from the internal network.
# net_dmz        - container queue for traffic from the Internet.
#   net_dmz_http - http traffic.
#   net_dmz_misc - all non-http traffic. this is also the default queue.

queue internal_dmz      # no special settings needed
queue net_dmz        bandwidth 500Kb { net_dmz_http, net_dmz_misc }
  queue net_dmz_http priority 3 cbq(red)
  queue net_dmz_misc priority 1 cbq(default)


# ... in the filtering section of pf.conf ...

main_net  = "192.168.0.0/24"
it_net    = "192.168.1.0/24"
int_nets  = "{ 192.168.0.0/24, 192.168.1.0/24 }"
dmz_net   = "10.0.0.0/24"

boss      = "192.168.0.200"
wwwserv   = "10.0.0.100"

# default deny
block on { fxp0, fxp1, dc0 } all

# filter rules for fxp0 inbound
pass in on fxp0 proto tcp from any to $wwwserv port { 21, \
	&gt; 49151 } flags S/SA keep state queue www_ext_misc
pass in on fxp0 proto tcp from any to $wwwserv port 80 \
	flags S/SA keep state queue www_ext_http

# filter rules for fxp0 outbound
pass out on fxp0 from $int_nets to any keep state
pass out on fxp0 from $boss to any keep state queue boss_ext

# filter rules for dc0 inbound
pass in on dc0 from $int_nets to any keep state
pass in on dc0 from $it_net to any queue it_int
pass in on dc0 from $boss to any queue boss_int
pass in on dc0 proto tcp from $int_nets to $wwwserv port { 21, 80, \
	&gt; 49151 } flags S/SA keep state queue www_int

# filter rules for dc0 outbound
pass out on dc0 from dc0 to $int_nets

# filter rules for fxp1 inbound
pass in on fxp1 proto { tcp, udp } from $wwwserv to any port 53 \
	keep state

# filter rules for fxp1 outbound
pass out on fxp1 proto tcp from any to $wwwserv port { 21, \
	&gt; 49151 } flags S/SA keep state queue net_dmz_misc
pass out on fxp1 proto tcp from any to $wwwserv port 80 \
	flags S/SA keep state queue net_dmz_http
pass out on fxp1 proto tcp from $int_nets to $wwwserv port { 80, \
	21, &gt; 49151 } flags S/SA keep state queue internal_dmz
</pre>
</td></tr>
</table>

<p>
[<a href="anchors.html">前に戻る: アンカーと名前付き (サブ) ルールセット</a>]
[<a href="index.html">目次</a>]
[<a href="pools.html">次に進む: アドレスプールと負荷分散 (Load Balancing)</a>]

<p>
<hr>
<a href="index.html"><img height="24" width="24" src="../../../images/back.gif" border="0" alt="[back]"></a> 
<a href="mailto:www@@openbsd.org">www@@openbsd.org</a>
<br>
<small>
Originally [OpenBSD: queueing.html,v 1.18 ]
<br>
$Translation: queueing.html,v 1.9 2004/01/19 05:55:02 toshi Exp $
<br>
$OpenBSD: queueing.html,v 1.11 2004/05/09 09:58:22 saad Exp $
</small>

</body>
</html> 
@


1.11
log
@sync with Steelix CVS
@
text
@d854 1
a854 1
$OpenBSD: queueing.html,v 1.18 2004/01/19 00:21:29 nick Exp $
@


1.10
log
@sync with steelix translation CVS
@
text
@@


1.9
log
@Sync with Steelix CVS
@
text
@d850 1
a850 1
Originally [OpenBSD: queueing.html,v 1.17 ]
d852 1
a852 1
$Translation: queueing.html,v 1.8 2004/01/03 05:24:39 toshi Exp $
d854 1
a854 1
$OpenBSD: queueing.html,v 1.17 2004/01/01 04:16:17 nick Exp $
@


1.8
log
@Sync with Steelix CVS
@
text
@d11 1
a11 1
<meta name="copyright"     content="This document copyright 2003 by OpenBSD.">
d850 1
a850 1
Originally [OpenBSD: queueing.html,v 1.16 ]
d852 1
a852 1
$Translation: queueing.html,v 1.7 2003/12/14 00:41:22 toshi Exp $
d854 1
a854 1
$OpenBSD: queueing.html,v 1.16 2003/12/12 04:21:14 nick Exp $
@


1.7
log
@Sync with Steelix CVS
@
text
@d367 1
d369 1
d395 2
a396 1
<li><tt><i>bw</i></tt> - スケジューラが利用可能な帯域幅の総量。この値には、
d399 1
a399 1
あるいは<tt><i>インターフェイス</i><tt>の
d850 1
a850 1
Originally [OpenBSD: queueing.html,v 1.14 ]
d852 1
a852 1
$Translation: queueing.html,v 1.6 2003/12/03 04:48:37 toshi Exp $
d854 1
a854 1
$OpenBSD: queueing.html,v 1.14 2003/11/27 15:08:25 nick Exp $
@


1.6
log
@Sync with Steelix CVS
@
text
@d4 1
a4 1
<title>PF: Queueing</title>
d20 1
a20 1
[<a href="scrub.html">前に戻る: スクラブ (scrub)</a>]
d22 1
a22 1
[<a href="nat.html">次に進む: ネットワークアドレス変換 (NAT)</a>]
d25 1
a25 1
<h1><font color="#e00000">PF: キューイング</font></h1>
d211 1
a211 1
<a href="http://www.icir.org/floyd/cbq.html">この web サイト</a>を参照してくだ世気ぁ
箍控
甓控
釈鱚羹∵雕蜒蜥鱧跫繖譬ぢこの web サイト</a>を参照してくだ世気ぁ
箜桶
甞桶
釈鱚羹≪闔肅膊蔗迪ａ笏蝟癆紜ぢ誓瀋螢札轡腑鹿畩を参照してくだ世気ぁ
箜恩
甞恩
少續祚鞴闔羲昭ぢで誓瀋蠅気譴泙后紂璽ぅ鵐阿寮設定には、以下のような
d369 1
a369 1
の場合は、インターフェイス fxp0 上で CBQ を有効化しています。また、利用可能な全帯域幅は
d377 2
a378 2
queue <i>name</i> bandwidth <i>bw</i> priority <i>pri</i> qlimit
<i>qlim</i> \<br>
d390 3
d398 1
d474 1
a474 1
インターフェイス上でキューのタグ付けが発誓犬垢覯椎柔性があることに注意してくだ世気ぁ
箚原
甦弘
キューイングは fxp0 上で有効化されていますが、タグ付けは dc0 上で行われます。
もし、インターフェイス fxp0 から出てきた、<tt>pass</tt> ルールにパケットが
マッチする場合、これらのパケットは、<tt>ftp</tt> キューにキューイングされる
はずです。この方式のキューイングは、ルータに取っては非常に役に立つものです。
d538 1
a538 1
PF は、状態を持つ誓楝海縫泪奪舛靴拭胯隶ぢから出て行くパケットが、
d837 1
a837 1
[<a href="scrub.html">前に戻る: スクラブ (scrub)</a>]
d839 1
a839 1
[<a href="nat.html">次に進む: ネットワークアドレス変換 (NAT)</a>]
d847 1
a847 1
Originally [OpenBSD: queueing.html,v 1.13 ]
d849 1
a849 1
$Translation: queueing.html,v 1.5 2003/11/10 14:53:17 toshi Exp $
d851 1
a851 1
$OpenBSD: queueing.html,v 1.13 2003/11/09 23:29:02 nick Exp $
@


1.5
log
@sync with steelix translation CVS
@
text
@d327 1
a327 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&amp;sektion=5&amp;manpath=OpenBSD+3.3"
d842 1
a842 1
Originally [OpenBSD: queueing.html,v 1.12 ]
d844 1
a844 1
$Translation: queueing.html,v 1.4 2003/09/24 04:31:39 toshi Exp $
d846 1
a846 1
$OpenBSD: queueing.html,v 1.12 2003/09/22 02:29:03 nick Exp $
@


1.4
log
@sync with steelix cvs
@
text
@@


1.3
log
@sync with steelix cvs
@
text
@d121 2
d150 2
d170 9
a178 6
ここで、ftp 用のキューのトラフィックが 900Kbps を超え、ユーザ A のキューの
トラフィックが (ssh は、それ用のキューに割り当てられた 100Kbps 未満の帯域しか
使用していないので) 1Mbps 未満なら、ftp 用のキューは超過した帯域幅をユーザ A
から借用することができます。このように、ftp 用のキューは、それが過負荷に
直面した場合に、それ用に割り当てられた帯域幅以上を使用することができるのです。
もし、ssh の負荷が増加した場合には、借用した帯域幅は返却されることになります。
d197 11
a207 8
CBQ は、ユーザ A とユーザ B 用のキューをラウンドロビン方式で処理します。
つまり、どちらのキューも他方に優誓茲垢襪海箸呂△蠅泙擦鵝罅璽ぢ用の
キューが処理されている間、CBQ はその子キューの処理も行います。この場合、
ssh 用のキューはより高い優誓菘戮鮖繊▲優奪肇錙璽寫圓靴討い訃豺腓法
胄用のキューより優誓菘並垓燭┐蕕譴襪海箸砲覆蠅泙后
ユーザ A 用とユーザ B 用のキューと比較して、ssh 用と ftp 用のキューは、
どのような優誓菘戮盪辰討い覆い海箸肪躇佞靴討誓さい。なぜなら、これらは、
階層構造の中ですべてが同じ枝に位置しているわけではないからです。
d233 2
d353 2
a354 1
b、Kb、Mb あるいは Gb を付けた誓簑价佑△△襪い儒守ぢインターフェイス</i><tt>の
d364 1
d369 3
a371 2
の場合は、インターフェイス fxp0 上で CBQ を有効化しています。また、利用可能な全帯域幅は 2Mbps
に誓瀋蠅気譴討い泙后修靴董齡ぢ、ssh および ftp という 3 個の子キューが定義されています。
d392 2
a393 1
b、Kb、Mb あるいは Gb を付けた誓簑价佑△△襪い儒守ぢインターフェイス</i><tt>の
d423 1
d427 2
a428 2
queue std          bandwidth 50% cbq(default)<br>
queue ssh          { ssh_login, ssh_bulk }<br>
d431 1
a431 1
queue ftp          bandwidth 500Kb priority 3 cbq(borrow red)<br>
d436 8
a443 6
ここでは、以前に定義された子キューのパラメータを誓瀋蠅靴討い泙后齡キューは、ルートキューの帯域幅 (または 1Mbps) の 50% の帯域幅が割り当てられ、
デフォルトキューとして誓瀋蠅気譴討い泙后齠キューには、ssh_login と ssh_bulk
という、ふたつの子キューが定義されています。ssh_login には ssh_bulk よりも高い
優誓菘戮燭┐蕕譴討蝓△匹舛蕕知ぢが有効化されています。また、ftp キューには
500Kbps の帯域幅が割り当てられ、優誓菘ぢが与えられています。そしてこれは、
d502 5
a506 5
これは、SSH のログイン誓楝海紡阿垢襯僖吋奪箸鼈煬閾蜴ぢキューに割り当て、
SCP や SFTP 誓楝海紡阿垢襯僖吋奪箸鼈烽キューに割り当てています。
ssh_login キューは、より高い優誓菘戮鮖辰討い襪里如
嗷ログイン誓楝海離僖吋奪箸蓮喘や SFTP 誓楝海
優誓茲靴峠萢気譴襪茲Δ砲覆蠅泙后
箋慨
甬慨
最後に ssh キューに入るよう、その状態テーブルのエントリにキューを登録します。
d574 3
a576 2
注意してくだ世気ぁ釈鱚羹癆譬称壮鹿畩、<a href="rdr.html">RDR</a> と
<a href="options.html">オプション</a>などは、これには含まれていません。
d709 3
a711 2
注意してくだ世気ぁ釈鱚羹癆譬称壮鹿畩、<a href="rdr.html">RDR</a> と
<a href="options.html">オプション</a>などは、これには含まれていません。
d842 1
a842 1
Originally [OpenBSD: queueing.html,v 1.11 ]
d844 1
a844 1
$Translation: queueing.html,v 1.3 2003/09/18 14:09:44 toshi Exp $
d846 1
a846 1
$OpenBSD: queueing.html,v 1.11 2003/09/16 01:23:49 nick Exp $
@


1.2
log
@sync with steelix translation CVS
@
text
@d398 1
a398 1
	有効化。<tt>ecn</tt> は暗黙のうちに <tt>red</tt> を有効化します。
d446 1
a446 1
その結果として、TCP RST や ICMP unreachable パケットが指定されたキューに
d821 1
a821 1
Originally [OpenBSD: queueing.html,v 1.10 ]
d823 1
a823 1
$Translation: queueing.html,v 1.2 2003/07/10 15:18:32 toshi Exp $
d825 1
a825 1
$OpenBSD: queueing.html,v 1.10 2003/06/13 02:54:08 nick Exp $
@


1.1
log
@sync with steelix translation CVS
@
text
@d387 1
a387 1
<li><tt><i>sched_options</i></tt> - スケジューラの挙動を誓罎垢襪燭瓩謀呂垢海箸硫椎修
筝桶
畍桶
ぴ鱇銖赱闔髟纒繪鈑讙窺屋鯵強欝穏卸些鼈祷
