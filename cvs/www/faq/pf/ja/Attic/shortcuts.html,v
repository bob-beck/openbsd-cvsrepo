head	1.11;
access;
symbols;
locks; strict;
comment	@# @;


1.11
date	2005.08.13.08.24.51;	author saad;	state dead;
branches;
next	1.10;

1.10
date	2004.05.09.09.58.22;	author saad;	state Exp;
branches;
next	1.9;

1.9
date	2004.01.04.22.47.55;	author horacio;	state Exp;
branches;
next	1.8;

1.8
date	2003.12.03.21.55.18;	author horacio;	state Exp;
branches;
next	1.7;

1.7
date	2003.11.10.21.40.53;	author horacio;	state Exp;
branches;
next	1.6;

1.6
date	2003.11.03.16.54.43;	author jufi;	state Exp;
branches;
next	1.5;

1.5
date	2003.09.26.13.21.47;	author horacio;	state Exp;
branches;
next	1.4;

1.4
date	2003.09.19.16.44.18;	author horacio;	state Exp;
branches;
next	1.3;

1.3
date	2003.06.21.10.04.16;	author jufi;	state Exp;
branches;
next	1.2;

1.2
date	2003.06.13.12.05.29;	author jufi;	state Exp;
branches;
next	1.1;

1.1
date	2003.05.30.10.20.57;	author jufi;	state Exp;
branches;
next	;


desc
@@


1.11
log
@remove unmaintained [ja] translation files.  requested by translator.
@
text
@<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>PF: Shortcuts For Creating Rulesets</title>
<link rev="made" href="mailto:www@@openbsd.org">
<meta http-equiv="Content-Type" content="text/html; charset=ISO-2022-JP">
<meta name="resource-type" content="document">
<meta name="description"   content="the OpenBSD FAQ page">
<meta name="keywords"      content="openbsd,faq,pf">
<meta name="distribution"  content="global">
<meta name="copyright"     content="This document copyright 2003-2004 by OpenBSD.">
</head>

<body bgcolor="#ffffff" text="#000000">
<!-- Passes validator.w3.org, please keep it this way;
please, use a max of 72 chars per line -->

<img alt="[OpenBSD]" height=30 width=141 src="../../../images/smalltitle.gif">
<p>
[<a href="rdr.html">前に戻る: トラフィックリダ瀬ぅ譽轡腑ポートフォワーディング)</a>]
[<a href="index.html">目次</a>]
[<a href="options.html">次に進む: 実行時オプション</a>]

<p>
<h1>
<font color="#e00000">PF: ルールセット作誓龍疇鹿肬銓鹿莟
取鮠

取馨目次</h3>
<ul>
<li><a href="#intro">はじめに</a>
<li><a href="#macros">マクロの使用</a>
<li><a href="#lists">リストの使用</a>
<li><a href="#grammar">PF の文法</a>
       <ul>
       <li><a href="#elim">キーワードの除去</a>
       <li><a href="#return"><tt>Return</tt> の単純化</a>
       <li><a href="#order">キーワードの順序</a>
       </ul>
</ul>

<hr>

<a name="intro"></a>
<h2>はじめに</h2>
PF はルールセットを単純化することができる多数の方法を用意しています。
その良い例のひとつに
<a href="macros.html#macros">マクロ</a>や
<a href="macros.html#lists">リスト</a>の使用を挙げることができます。
さらに、ルールセット言生譴笋修諒庫　△気蕕縫襦璽襯札奪箸
より簡単にするための近道も用意しています。一般的な経験に基づいて言世Δ函
より簡単なルールセットは、その理解やメンテナンスがより簡単になると言世┐泙后

釈瘢綵痺鳫鵞昭取仮マクロの使用</h2>
マクロは、アドレスやポート番号、インターフェイス名などをルールセット中に
ハードコードしなくて済む代替方法を用意するもので、便利な機能です。さて、
サーバの IP アドレスを変更しましたが... &nbsp; でも大丈夫です。マクロを
更新するだ世韻如△△覆燭離法璽困亡袷瓦帽臙廚垢襪茲Α∋屬肇┘優襯爾鯣颪靴
フィルタルール全体にメスを入れる必要はありません。

<p>
PF のルールセットにおける一般的は習慣は、それぞれのネットワークインターフェイスのための
マクロを定義することです。もし、ここで異なるドライバを使用するネットワークカードに
置換しなければならなくなったとすると、たとえば、3Com を Intel に交換する場合、
マクロを書き換えるだ世韻妊侫襯織襦璽襪楼柄阿汎韻犬茲Δ傍’修靴討譴泙后
もうひとつの利点世箸靴董韻献襦璽襯札奪箸鯊真瑤離泪轡鵑縫ぅ鵐好函璽襪垢訃豺腓
考えることができます。あるマシンは異なるネットワークカードを持っているかも知れませんが、
ネットワークインターフェイスの定義にマクロを使用していれば、
インストールされるルールセットは最小限の編集で済みます。ルールセット中の、
ポート番号や IP アドレス、インターフェイス名などのような、
変更の対象となり得世訃霾鵑猟蟲舛砲蓮▲泪蹐鮖藩僂垢襪海箸箴気譴討い泙后
錫跫站髟阡緇
儒
粤肅鈬痺鳫肬縺竏續鳬銓纈聲竇錫鮠
侮≫祕⊆碣祷∽唖錫鮠
庭∽陰
鹿鹿碎閭鞫
腫もうひとつの一般的な習慣として、IP アドレスやネットワークブロックの定義にマクロを使用する、
というのがあります。これによって、IP アドレスが変更された場合に
ルールセットのメンテナンスの手間を大幅に減少させることが可能となります。
<blockquote>
<tt>
# define our networks<br>
IntNet = "192.168.0.0/24"<br>
ExtAdd = "24.65.13.4"<br>
DmzNet = "10.0.0.0/24"
</tt>
</blockquote>

<p>
もし、内部ネットワークが、拡張されたり異なる IP ブロックに付け替えられたりした場合でも、
マクロを更新するだ世韻悩僂澆泙后
錫跫站髟阡緇
儒
侮續厩荻蔚軒握渥牡厩荻蔚軒窺渥牡鹿鹿碎閭鞫
腫そして、この後にルールセットをいったん再ロードすれば、すべて以前と同様に動作します。

<a name="lists"></a>
<h2>リストの使用</h2>
インターネットには存在すべきではない、そしてもしインターネット上に存在していれば、
たいていトラブルの原因となってしまう、
<a href="http://www.geektools.com/rfc/rfc1918.txt">RFC 1918</a>
で定義されるプライベートアドレスを扱うためのルールセットのお手本を見てみましょう。
<blockquote>
<tt>
block in &nbsp;quick on tl0 inet from 127.0.0.0/8 to any<br>
block in &nbsp;quick on tl0 inet from 192.168.0.0/16 to any<br>
block in &nbsp;quick on tl0 inet from 172.16.0.0/12 to any<br>
block in &nbsp;quick on tl0 inet from 10.0.0.0/8 to any<br>
block out quick on tl0 inet from any to 127.0.0.0/8<br>
block out quick on tl0 inet from any to 192.168.0.0/16<br>
block out quick on tl0 inet from any to 172.16.0.0/12<br>
block out quick on tl0 inet from any to 10.0.0.0/8
</tt>
</blockquote>

<p>
これは、以下のように単純化することができます。
<blockquote>
<tt>
block in &nbsp;quick on tl0 inet from { 127.0.0.0/8, 192.168.0.0/16, \<br>
&nbsp;&nbsp;&nbsp;172.16.0.0/12, 10.0.0.0/8 } to any<br>
block out quick on tl0 inet from any to { 127.0.0.0/8, \<br>
&nbsp;&nbsp;&nbsp;192.168.0.0/16, 172.16.0.0/12, 10.0.0.0/8 }
</tt>
</blockquote>

<p>
このルールセットは 8 行から 2 行まで減少させることができました。
ここで、このリスト中でマクロを使用すれば、
さらにわかりやすくなります。
<blockquote>
<tt>
NoRouteIPs = "{ 127.0.0.0/8, 192.168.0.0/16, 172.16.0.0/12, \<br>
&nbsp;&nbsp;&nbsp;10.0.0.0/8 }"
<br>
ExtIF = "tl0"<br>
block in &nbsp;quick on $ExtIF from $NoRouteIPs to any<br>
block out quick on $ExtIF from any to $NoRouteIPs
</tt>
</blockquote>

<p>
マクロやリストを使用して <tt>pf.conf</tt> ファイルを単純化することができますが、
それぞれの行は、実際には
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+3.4"
>pfctl(8)</a> によって複数のルールに展開されることに注意してくだ世気ぁ
ですので、上記の例は、実際には以下のルールに展開されることになります。
<blockquote>
<tt>
block in &nbsp;quick on tl0 inet from 10.0.0.0/8 to any<br>
block in &nbsp;quick on tl0 inet from 172.16.0.0/12 to any<br>
block in &nbsp;quick on tl0 inet from 192.168.0.0/16 to any<br>
block in &nbsp;quick on tl0 inet from 127.0.0.0/8 to any<br>
block out quick on tl0 inet from any to 10.0.0.0/8<br>
block out quick on tl0 inet from any to 172.16.0.0/12<br>
block out quick on tl0 inet from any to 192.168.0.0/16<br>
block out quick on tl0 inet from any to 127.0.0.0/8
</tt>
</blockquote>

<p>
これまで見てきましたように、PF の拡張は純粋に <tt>pf.conf</tt>
ファイルの書き手やメンテナに対して便利なものなのであって、
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf&amp;sektion=4&amp;manpath=OpenBSD+3.4"
>pf(4)</a>
が処理するルールを実際に単純化できるわけではありません。

<p>
マクロは単にアドレスやポート以上のものを定義するのに使用することもできます。
これらは、PF ルールファイルのどこにでも使用することができます。たとえば、
<blockquote>
<tt>
pre  = "pass in quick on ep0 inet proto tcp from "<br>
post = "to any port { 80, 6667 } keep state"<br>
<br>
# David's classroom<br>
$pre 21.14.24.80 $post<br>
<br>
# Nick's home<br>
$pre 24.2.74.79 $post<br>
$pre 24.2.74.178 $post
</tt>
</blockquote>

<p>
は、以下のように展開されます。
<blockquote>
<tt>
pass in quick on ep0 inet proto tcp from 21.14.24.80 to any \<br>
&nbsp;&nbsp;&nbsp;port = 80 keep state<br>
pass in quick on ep0 inet proto tcp from 21.14.24.80 to any \<br>
&nbsp;&nbsp;&nbsp;port = 6667 keep state<br>
pass in quick on ep0 inet proto tcp from 24.2.74.79 to any \<br>
&nbsp;&nbsp;&nbsp;port = 80 keep state<br>
pass in quick on ep0 inet proto tcp from 24.2.74.79 to any \<br>
&nbsp;&nbsp;&nbsp;port = 6667 keep state<br>
pass in quick on ep0 inet proto tcp from 24.2.74.178 to any \<br>
&nbsp;&nbsp;&nbsp;port = 80 keep state<br>
pass in quick on ep0 inet proto tcp from 24.2.74.178 to any \<br>
&nbsp;&nbsp;&nbsp;port = 6667 keep state
</tt>
</blockquote>

<a name="grammar"></a>
<h2>PF の文法</h2>
より大きなルールセットの柔斉霎性を持つよう、現在では PF の文法は実に
柔斉陲覆發里箸覆辰討い泙后泙拭估ぢは、ある種のキーワードを推測できるように
なりましたが、これは、そのようなキーワードをルール中に明声傍椶垢詆廚覆
ことを意味し、また、キーワードの順序についても、厳密に覚える必要がないほど
形式張らないものとなっています。

<a name="elim"></a>
<h3>キーワードの除去</h3>
<p>
「デフォルトで拒否」というポリシーを定義するために、ふたつのルールが使用されます。
<blockquote>
<tt>
block in &nbsp;all<br>
block out all
</tt>
</blockquote>

<p>
これは以下のように省略可能です。
<blockquote>
<tt>
block all
</tt>
</blockquote>

<p>
方向が指定されていない場合、PF は両方向に移動するパケットに対して
ルールセットが適用されるものと見なします。

<p>
同様に、"<tt>from any to any</tt>" や "<tt>all</tt>" 誓瓩蓮
ルールから無視されるかも知れません。たとえば、
<blockquote>
<tt>
block in on rl0 all<br>
pass &nbsp;in quick log on rl0 proto tcp from any to any port 22 keep state
</tt>
</blockquote>

<p>
は、以下のように単純化することができます。
<blockquote>
<tt>
block in on rl0<br>
pass &nbsp;in quick log on rl0 proto tcp to port 22 keep state</tt>
</blockquote>

<p>
最初のルールは、rl0 に対するすべての着信パケットは、どこからどこに行こうとするものでも
すべてブロックされますし、ふたつ目のルールは、rl0 上のポート 22 への TCP トラフィックを通過させます。

<a name="return"></a>
<h3><tt>Return</tt> の単純化</h3>
<p>
ブロックして TCP RST や ICMP Unreachable 応答を返すためのルールセットは、
たとえば以下のようなものであるかも知れません。
<blockquote>
<tt>
block in all<br>
block return-rst in proto tcp all<br>
block return-icmp in proto udp all<br>
block out all<br>
block return-rst out proto tcp all<br>
block return-icmp out proto udp all
</tt>
</blockquote>

<p>
この場合、以下のように単純化することができます。
<blockquote>
<tt>
block return
</tt>
</blockquote>

<p>
PF が <tt>return</tt> キーワードを見つけると、誓気靴け鯀垢襪
何も応答を返さない、十分誓気譴親虻遒鮃圓い泙垢△海瞭虻遒
ブロックされるパケットのプロトコルに依存します。

<a name="order"></a>
<h3>キーワードの順序</h3>
<p>
指定されたキーワードの順序は、ほとんどの場合、柔斉陲覆發里任后
たとえば、以下のように記述されたルールの場合、
<blockquote>
<tt>
pass in log quick on rl0 proto tcp to port 22 \<br> 
&nbsp;&nbsp;&nbsp;flags S/SA keep state queue ssh label ssh
</tt>
</blockquote>

<p>
このように書き換えることもできます。
<blockquote>
<tt>
pass in quick log on rl0 proto tcp to port 22 \<br>
&nbsp;&nbsp;&nbsp;queue ssh keep state label ssh flags S/SA
</tt>
</blockquote>

<p>
その他の同様のバリエーションでも同じように動作します。

<p>
[<a href="rdr.html">前に戻る: トラフィックリダ瀬ぅ譽轡腑ポートフォワーディング)</a>]
[<a href="index.html">目次</a>]
[<a href="options.html">次に進む: 実行時オプション</a>]

<p>
<hr>
<a href="index.html"><img height="24" width="24" src="../../../images/back.gif" border="0" alt="[back]"></a> 
<a href="mailto:www@@openbsd.org">www@@openbsd.org</a>
<br>
<small>
Originally [OpenBSD: shortcuts.html,v 1.10 ]
<br>
$Translation: shortcuts.html,v 1.8 2004/01/03 06:14:18 toshi Exp $
<br>
$OpenBSD: shortcuts.html,v 1.10 2004/05/09 09:58:22 saad Exp $
</small>

</body>
</html> 
@


1.10
log
@sync with Steelix CVS
@
text
@d337 1
a337 1
$OpenBSD: shortcuts.html,v 1.10 2004/01/01 04:16:17 nick Exp $
@


1.9
log
@Sync with Steelix CVS
@
text
@@


1.8
log
@Sync with Steelix CVS
@
text
@d11 1
a11 1
<meta name="copyright"     content="This document copyright 2003 by OpenBSD.">
d333 1
a333 1
Originally [OpenBSD: shortcuts.html,v 1.9 ]
d335 1
a335 1
$Translation: shortcuts.html,v 1.7 2003/12/03 04:48:37 toshi Exp $
d337 1
a337 1
$OpenBSD: shortcuts.html,v 1.9 2003/11/27 15:08:25 nick Exp $
@


1.7
log
@Sync with Steelix CVS
@
text
@d20 1
a20 1
[<a href="anchors.html">前に戻る: アンカーとサブルールセット</a>]
d22 1
a22 1
[<a href="pools.html">次に進む: アドレスプールと負荷分散 (Load Balancing)</a>]
d155 1
a155 1
マクロやリストを使用して <tt>/etc/pf.conf</tt> ファイルを単純化することができますが、
d174 1
a174 1
これまで見てきましたように、PF の拡張は純粋に <tt>/etc/pf.conf</tt>
d323 1
a323 1
[<a href="anchors.html">前に戻る: アンカーとサブルールセット</a>]
d325 1
a325 1
[<a href="pools.html">次に進む: アドレスプールと負荷分散 (Load Balancing)</a>]
d333 1
a333 1
Originally [OpenBSD: shortcuts.html,v 1.8 ]
d335 1
a335 1
$Translation: shortcuts.html,v 1.6 2003/11/10 14:53:17 toshi Exp $
d337 1
a337 1
$OpenBSD: shortcuts.html,v 1.8 2003/11/09 23:29:02 nick Exp $
@


1.6
log
@sync with steelix translation CVS
@
text
@d157 1
a157 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+3.3"
d176 1
a176 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf&amp;sektion=4&amp;manpath=OpenBSD+3.3"
d218 2
a219 2
OpenBSD 3.3 のリリースとともに、より大きなルールセットの柔斉霎性を持つよう、PF
の文法がチューニングされました。また、PF は、ある種のキーワードを推測できるように
d221 2
a222 1
ことを意味します。キーワードの順序についても、以前ほど厳密である必要はありません。
d333 1
a333 1
Originally [OpenBSD: shortcuts.html,v 1.7 ]
d335 1
a335 1
$Translation: shortcuts.html,v 1.5 2003/09/24 04:31:39 toshi Exp $
d337 1
a337 1
$OpenBSD: shortcuts.html,v 1.7 2003/09/22 02:29:03 nick Exp $
@


1.5
log
@sync with steelix cvs
@
text
@@


1.4
log
@sync with steelix cvs
@
text
@d39 1
a39 1
       <li><a href="#return">Return の単純化</a>
d117 4
a120 4
block in quick on tl0 inet from 127.0.0.0/8 to any<br>
block in quick on tl0 inet from 192.168.0.0/16 to any<br>
block in quick on tl0 inet from 172.16.0.0/12 to any<br>
block in quick on tl0 inet from 10.0.0.0/8 to any<br>
d132 1
a132 1
block in quick on tl0 inet from { 127.0.0.0/8, 192.168.0.0/16, \<br>
d149 1
a149 1
block in quick on $ExtIF from $NoRouteIPs to any<br>
d162 4
a165 4
block in quick on tl0 inet from 10.0.0.0/8 to any<br>
block in quick on tl0 inet from 172.16.0.0/12 to any<br>
block in quick on tl0 inet from 192.168.0.0/16 to any<br>
block in quick on tl0 inet from 127.0.0.0/8 to any<br>
d229 1
a229 1
block in all<br>
d269 1
a269 1
<h3>Return の単純化</h3>
d332 1
a332 1
Originally [OpenBSD: shortcuts.html,v 1.6 ]
d334 1
a334 1
$Translation: shortcuts.html,v 1.4 2003/09/18 14:09:44 toshi Exp $
d336 1
a336 1
$OpenBSD: shortcuts.html,v 1.6 2003/09/16 01:23:49 nick Exp $
@


1.3
log
@sync with steelix translation CVS
@
text
@d332 1
a332 1
Originally [OpenBSD: shortcuts.html,v 1.5 ]
d334 1
a334 1
$Translation: shortcuts.html,v 1.3 2003/06/15 12:27:37 toshi Exp $
d336 1
a336 1
$OpenBSD: shortcuts.html,v 1.5 2003/06/13 02:54:08 nick Exp $
@


1.2
log
@sync with steelix translation CVS
@
text
@d22 1
a22 1
[<a href="../pools.html">次に進む: アドレスプールと負荷分散 (Load Balancing)</a>]
d324 1
a324 1
[<a href="../pools.html">次に進む: アドレスプールと負荷分散 (Load Balancing)</a>]
d334 1
a334 1
$Translation: shortcuts.html,v 1.2 2003/06/13 04:57:08 toshi Exp $
@


1.1
log
@
sync with steelix translation CVS
@
text
@d157 2
a158 2
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+3.3">
pfctl(8)</a> によって複数のルールに展開されることに注意してくだ世気ぁ
箟袈
甕祁
釈鱚羹∵雕關緕碵筮闥膀竍薛砠遲轣隨竍蘓髟纈鞴逅雌繼闔輯逅詩瘤鞜熟鞳鄲喞⊂
鞴┫箜害
甞害
蜃蜴瘡踟緕帯頂蓖鶯笊讙窺箜慨
甞慨
ぴ鱇銖赱闔鼈闥鶤蔗迪旭劾圧渦些戯渦闢蓍
箜涯
甞涯
は鞳鄲喞鼈闥鶤蔗迪旭劾圧鯵紺該鬼蜒祷ぜ轣跛
