head	1.25;
access;
symbols;
locks; strict;
comment	@# @;


1.25
date	2014.04.01.17.14.11;	author nick;	state dead;
branches;
next	1.24;

1.24
date	2009.11.08.22.09.17;	author tobias;	state Exp;
branches;
next	1.23;

1.23
date	2009.05.04.19.07.52;	author tobias;	state Exp;
branches;
next	1.22;

1.22
date	2008.11.02.00.28.45;	author tobias;	state Exp;
branches;
next	1.21;

1.21
date	2008.08.04.12.05.27;	author tobias;	state Exp;
branches;
next	1.20;

1.20
date	2007.11.12.20.29.59;	author saad;	state Exp;
branches;
next	1.19;

1.19
date	2007.05.09.05.49.53;	author jufi;	state Exp;
branches;
next	1.18;

1.18
date	2006.11.04.17.38.45;	author saad;	state Exp;
branches;
next	1.17;

1.17
date	2006.10.30.14.20.19;	author jufi;	state Exp;
branches;
next	1.16;

1.16
date	2006.05.24.06.48.44;	author jufi;	state Exp;
branches;
next	1.15;

1.15
date	2006.05.14.09.54.41;	author saad;	state Exp;
branches;
next	1.14;

1.14
date	2006.05.02.17.09.33;	author jufi;	state Exp;
branches;
next	1.13;

1.13
date	2006.01.20.20.05.19;	author jufi;	state Exp;
branches;
next	1.12;

1.12
date	2005.11.03.11.30.54;	author saad;	state Exp;
branches;
next	1.11;

1.11
date	2005.08.24.12.58.45;	author saad;	state Exp;
branches;
next	1.10;

1.10
date	2005.08.21.22.37.28;	author saad;	state Exp;
branches;
next	1.9;

1.9
date	2005.05.19.18.23.06;	author jufi;	state Exp;
branches;
next	1.8;

1.8
date	2005.05.04.17.52.26;	author jufi;	state Exp;
branches;
next	1.7;

1.7
date	2004.11.12.16.16.53;	author jufi;	state Exp;
branches;
next	1.6;

1.6
date	2004.10.09.16.37.52;	author jufi;	state Exp;
branches;
next	1.5;

1.5
date	2004.01.16.21.01.34;	author jufi;	state Exp;
branches;
next	1.4;

1.4
date	2003.12.16.11.04.12;	author horacio;	state Exp;
branches;
next	1.3;

1.3
date	2003.11.14.23.10.31;	author horacio;	state Exp;
branches;
next	1.2;

1.2
date	2003.09.28.22.28.56;	author horacio;	state Exp;
branches;
next	1.1;

1.1
date	2003.09.02.14.37.19;	author jufi;	state Exp;
branches;
next	;


desc
@@


1.25
log
@
Abandon translations, per deraadt@@ and ajacoutot@@.
@
text
@<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>PF: Translacje adresów (NAT)</title>
<link rev="made" href="mailto:www@@openbsd.org">
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-2">
<meta name="resource-type" content="document">
<meta name="description"   content="the OpenBSD FAQ page">
<meta name="keywords"      content="openbsd,faq,pf">
<meta name="distribution"  content="global">
</head>

<!--
Copyright (c) 2003, Nick Holland <nick@@openbsd.org>
Copyright (c) 2003, 2004 Joel Knight <enabled@@myrealbox.com>

Permission to use, copy, modify, and distribute this documentation for
any purpose with or without fee is hereby granted, provided that the
above copyright notice and this permission notice appear in all copies.

THE DOCUMENTATION IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL
WARRANTIES WITH REGARD TO THIS DOCUMENTATION INCLUDING ALL IMPLIED
WARRANTIES OF MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE
AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL
DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR
PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER
TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS DOCUMENTATION
-->

<body bgcolor="#ffffff" text="#000000">
<!-- Passes validator.w3.org, please keep it this way;
please, use a max of 72 chars per line -->

<a href="../../../pl/index.html">
<img alt="[OpenBSD]" height=30 width=141 src="../../../images/smalltitle.gif" border="0">
</a>
<p>
[<a href="filter.html">Wstecz: Filtrowanie pakietów</a>]
[<a href="index.html">Spis tre¶ci</a>]
[<a href="rdr.html">Dalej: Przekierowania ruchu</a>]

<p>
<h1><font color="#e00000">PF: Translacje adresów (NAT)</font></h1>

<hr>

<h3>Spis tre¶ci</h3>
<ul>
<li><a href="#intro">Wprowadzenie</a>
<li><a href="#works">Jak dzia³a NAT</a>
<li><a href="#filter">NAT a filtrowanie pakietów</a>
<li><a href="#ipfwd">Przekazywanie pakietów IP (IP Forwarding)</a>
<li><a href="#config">Konfiguracja NAT</a>
<li><a href="#binat">Dwukierunkowe mapowanie adresów (mapowanie 1:1)</a>
<li><a href="#except">Wyj±tki w regu³ach translacji</a>
<li><a href="#status">Sprawdzanie stanu NAT</a>
</ul>

<hr>

<a name="intro"></a>
<h2>Wprowadzenie</h2>
Translacja adresów (ang. Network Address Translation - NAT) daje mo¿liwo¶æ
zmapowania ca³ej sieci (lub wielu sieci) do pojedynczego adresu IP. NAT
jest niezbêdny, gdy liczba adresów IP przydzielonych przez
Dostawcê Us³ug Internetowych (ISP) jest mniejsza ni¿ ca³kowita liczba
maszyn, który maj± mieæ dostêp do Internetu. NAT jest opisany w
<a href="http://www.geektools.com/rfc/rfc1631.txt">RFC 1631</a>
"The IP Network Address Translator (NAT)".

<p>
NAT pozwala korzystaæ z dobrodziejstw zarezerwowanych bloków adresów
zdefiniowanych w
<a href="http://www.geektools.com/rfc/rfc1918.txt">RFC 1918</a>
"Address Allocation for Private Internets".
Zwykle, wewnêtrzna sieæ bêdzie skonfigurowana przy u¿yciu jednego lub
wiêcej z tych bloków, a s± to:

<pre>
	10.0.0.0/8       (10.0.0.0 - 10.255.255.255)
	172.16.0.0/12    (172.16.0.0 - 172.31.255.255)
	192.168.0.0/16   (192.168.0.0 - 192.168.255.255)
</pre>

<p>
Maszyna z OpenBSD realizuj±ca NAT bêdzie mia³a co najmniej dwa adaptery
sieciowe, jeden do Internetu, drugi do sieci wewnêtrznej. NAT bêdzie
t³umaczy³ wywo³ania z sieci wewnêtrznej tak, aby wydawa³o siê, ¿e pochodz±
one z maszyny OpenBSD realizuj±cej NAT.

<a name="works"></a>
<h2>Jak dzia³a NAT</h2>
<p>
Gdy klient w sieci wewnêtrznej ³±czy siê z maszyn± w Internecie,
wysy³a pakiety IP zaadresowane do tej maszyny. Pakiety te zawieraj±
wszystkie informacje adresowe, niezbêdne aby dotrzeæ do celu.
NAT zajmuje siê nastêpuj±cymi danymi:
<ul>
<li>¬ród³owy adres IP (na przyk³ad, 192.168.1.35)
<li>¬ród³owy port TCP lub UDP (na przyk³ad, 2132)
</ul>

<p>
Gdy pakiety przechodz± przez bramkê NAT, s± modyfikowane tak aby wydawa³y siê
pochodziæ z samej bramki (ang. gateway) NAT. Bramka NAT zapamiêtuje zmiany,
wykonywane na pakietach, w swojej tabeli stanów, aby móc: a) odwróciæ
zmiany w powracaj±cych pakietach oraz b) zapewniæ, ¿e powracaj±ce pakiety
s± przepuszczane przez firewall i nie s± blokowane. Na przyk³ad, mog±
wyst±piæ nastêpuj±ce zmiany:
<ul>
<li>¬ród³owe IP: zamienione na zewnêtrzny adres bramki
(na przyk³ad, 24.5.0.5)
<li>¬ród³owy port: zamieniony na losowo wybrany, nieu¿ywany port na
bramce (na przyk³ad, 53136)
</ul>

<p>
Ani wewnêtrzna maszyna, ani host w Internecie nie obawiaj± siê tych translacji.
Dla komputera z sieci lokalnej, system realizuj±cy NAT jest po prostu bramk±.
Dla hosta w Internecie, pakiety wydaj± siê pochodziæ wprost z systemu, na którym
realizowany jest NAT; nawet nie zdaje sobie sprawy, ¿e wewnêtrzne stacje
robocze w ogóle istniej±. 

<p>
Kiedy host w Internecie odpowiada na pakiety wewnêtrznej maszyny, s± one
adresowane do zewnêtrznego IP bramki realizuj±cej NAT (24.5.0.5) i na
przet³umaczony port (53136). Bramka NAT przeszuka wówczas tabelê stanów,
aby sprawdziæ, czy powracaj±ce pakiety pasuj± do jakiego¶ ju¿ nawi±zanego
po³±czenia. Niepowtarzalne dopasowanie zostaje dokonane na podstawie
kombinacji IP/port, która mówi PF, ¿e datagramy nale¿± do po³±czenia
zainicjowanego przez wewnêtrzn± maszynê 192.168.1.35. PF wykona wówczas
odwrócone zmiany w stosunku do wychodz±cych pakietów i przeka¿e je
do maszyny w sieci wewnêtrznej.

<p>
Translacje pakietów ICMP odbywaj± siê w podobny sposób, ale bez modyfikacji
portu ¼ród³owego.

<a name="filter"></a>
<h2>NAT a filtrowanie pakietów</h2>
<p>
<font color="#ff0000">Uwaga:</font> Pakiety podlegaj±ce translacji
s± tak¿e przetwarzane przez regu³y filtruj±ce i zostan± przez nie
zablokowane lub przepuszczone zgodnie z tym jak zadeklarowano.
<i>Jedynym</i> odstêpstwem od tej regu³y jest u¿ycie s³owa kluczowego
<tt>pass</tt> w samej regule <tt>nat</tt>.
Spowoduje to przepuszczanie przez filtr pakietów podlegaj±cych NAT.

<p>
Nale¿y byæ ¶wiadomym, i¿ poniewa¿ translacje maj± miejsce <i>przed</i>
filtrowaniem, regu³y filtruj±ce widz± pakiety <i>po translacji</i>,
ju¿ z podmienionym adresem IP oraz portem, zgodnie z tym
<a href="#works">Jak dzia³a NAT</a>.

<!-- legacy anchor; can eventually be removed -->
<a name="enable"></a>
<a name="ipfwd"></a>
<h2>Przekazywanie pakietów IP (IP Forwarding)</h2>
<p>
Poniewa¿ NAT jest prawie zawsze stosowany w routerach i bramkach sieciowych,
najprawdopodobniej konieczne bêdzie aktywowanie przekazywania pakietów IP
(ang. IP forwarding), aby umo¿liwiæ ich przekazywanie pomiêdzy interfejsami
sieciowymi na maszynie OpenBSD.
Przekazywanie pakietów IP jest aktywowane przy pomocy mechanizmu
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&amp;sektion=3"
>sysctl(3)</a>:
<blockquote>
<tt>
# sysctl net.inet.ip.forwarding=1<br>
# sysctl net.inet6.ip6.forwarding=1 <i>(je¶li u¿ywany jest IPv6)</i>
</tt>
</blockquote>

<p>
Aby zmienne ty by³y ustawiane podczas ka¿dego startu systemu, nastêpuj±ce
linie powinny zostaæ dodane do
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl.conf&amp;sektion=5"
><tt>/etc/sysctl.conf</tt></a>:
<blockquote>
<tt>
net.inet.ip.forwarding=1<br>
net.inet6.ip6.forwarding=1
</tt>
</blockquote>

<p>
Linie te s± tam ju¿ obecne w domy¶lnej instalacji, ale s± tylko komentarzem
(poprzedzone znakiem <tt>#</tt>). Wystarczy usun±æ znak <tt>#</tt> i zapisaæ
plik. Przekazywanie pakietów IP bêdzie w³±czone po kolejnym starcie systemu.

<a name="config"></a>
<h2>Konfiguracja NAT</h2>
Ogólna sk³adnia regu³ NAT w <tt>pf.conf</tt> wygl±da tak:
<blockquote>
<tt>
nat [pass] [log] on <i>interface</i> [<i>af</i>] from <i>src_addr</i>
[port <i>src_port</i>] to \<br>
&nbsp;&nbsp;&nbsp;<i>dst_addr</i> [port <i>dst_port</i>] -&gt;
<i>ext_addr</i> [<i>pool_type</i>] [static-port]
</tt>
</blockquote>

<dl>
<dt><tt>nat</tt>
<dd>s³owo kluczowe rozpoczynaj±ce regu³ê NAT.

<dt><tt>pass</tt>
<dd>Powoduje, ¿e pakiety podlegaj±ce translacji s± zawsze przepuszczane
przez regu³y filtruj±ce.

<dt><tt>log</tt>
<dd>Pozwoli logowaæ pakiety poprzez 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+4.6"
>pflogd(8)</a>.
Normalnie logowany jest tylko pierwszy pasuj±cy pakiet.
Aby logowaæ wszystkie pakiety, u¿yj <tt>log (all)</tt>.

<dt><tt><i>interface</i></tt>
<dd>Nazwa interfejsu sieciowego lub grupy interfejsów na którym ma mieæ 
miejsce translacja pakietów.

<dt><tt><i>af</i></tt>
<dd>Rodzina adresów: <tt>inet</tt> dla IPv4 lub <tt>inet6</tt>
dla IPv6. PF jest zwykle w stanie zidentyfikowaæ ten parametr na podstawie
adresu(ów) ¼ród³owych/przeznaczenia.

<dt><tt><i>src_addr</i></tt>
<dd>¬ród³owy (wewnêtrzny) adres pakietów, które bêd± podlega³y translacji NAT.
Adres ¼ród³owy mo¿e byæ podany jako:
<ul>
<li>Pojedynczy adres IPv4 lub IPv6.
<li>Blok sieci - <a href="http://public.pacbell.net/dedicated/cidr.html">CIDR</a>.
<li>W pe³ni okre¶lona domena, która bêdzie rozwiniêta przez DNS w czasie
³adowania zestawu regu³. Wszystkie zwrócone adresy IP bêd± wstawione do regu³y.
<li>Nazwa interfejsu sieciowego. Wszystkie adresy IP przypisane do urz±dzenia
bêd± wprowadzone podczas ³adowania zestawu regu³.
<li>Nazwa interfejsu sieciowego lub grupy interfejsów wraz z 
<tt><i>/netmask±</i></tt> (np <tt>/24</tt>). Ka¿dy adres IP danego interfejsu 
jest ³±czony z ka¿d± mask± sieciow± aby utworzyæ odpowiedni blok sieci CIDR,
który bêdzie wprowadzony podczas ³adowania zestawu regu³.
<li>Nazwa interfejsu sieciowego lub grupy interfejsów z dopisanym na koñcu jednym z poni¿szych
wyra¿eñ:
  <ul>
  <li><tt>:network</tt> - odpowiada blokowi sieci CIDR (np
  192.168.0.0/24)
  <li><tt>:broadcast</tt> - odpowiada adresowi rozg³oszeniowemu podsieci
  (np 192.168.0.255)
  <li><tt>:peer</tt> - odpowiada adresowi IP wêz³a na drugim koñcu po³±czenia
  point-to-point
  </ul>
  <dl>
  <dd>Dodatkowo, wyra¿enie <tt>:0</tt> mo¿e zostaæ dodane na koñcu
  zarówno nazwy interfejsu/grupy jak i któregokolwiek z wymienionych s³ów
  kluczowych aby nie by³y brane pod uwagê dodatkowe, wskazuj±ce adresy IP
  (ang. aliased IP addresses) podczas przetwarzania regu³.
  Oznaczenia te mog± tak¿e byæ u¿yte wewn±trz wyra¿eñ w nawiasach.
  Przyk³ad: <tt>fxp0:network:0</tt>
  </dl>
<li><a href="tables.html">Tabeli</a>.
<li>Którykolwiek z powy¿szych, lecz zanegowany przy pomocy modyfikatora
<tt>!</tt> ("not"). <li>Zestaw adresów w postaci
<a href="macros.html#lists">listy</a>. <li>S³owo kluczowe <tt>any</tt>
oznaczaj±ce wszystkie adresy.
</ul>

<dt><tt><i>src_port</i></tt>
<dd>Port ¼ród³owy w Warstwie 4 nag³ówka pakietu. Porty mog± byæ podawane jako:
<ul>
<li>Liczba z zakresu od 1 do 65535
<li>Poprawna nazwa us³ugi, zdefiniowana w
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=services&amp;sektion=5"
><tt>/etc/services</tt></a>
<li>Zestaw portów w postaci <a href="macros.html#lists">listy</a>
<li>Przedzia³:
	<ul>
	<li><tt>!=</tt> (ró¿ny)
	<li><tt>&lt;</tt> (mniejszy ni¿)
	<li><tt>&gt;</tt> (wiêkszy ni¿)
	<li><tt>&lt;=</tt> (mniejszy lub równy)
	<li><tt>&gt;=</tt> (wiêkszy lub równy)
	<li><tt>&gt;&lt;</tt> (przedzia³)
	<li><tt>&lt;&gt;</tt> (poza przedzia³em)
	<dl>
	<dd>Ostatnie dwa s± operatorami binarnymi (wymagaj± dwóch argumentów) oraz
	nie mog± mieæ parametrów w postaci przedzia³ów.
	</dl>
	<li><tt>:</tt> (obejmuj±cy zasiêg)
	<dl>
	<dd>Operator obejmuj±cy zasiêg jest operatorem binarnym, nie obejmuje
	on jednak koñców przedzia³ów stanowi±cych jego argumenty.
	</dl>
	</ul>
</ul>
Opcja <tt>port</tt> nie jest zwykle wykorzystywana w regu³ach <tt>nat</tt>,
poniewa¿ celem jest zwyk³e translacja NAT ca³ego ruch bez wzglêdu na u¿ywane
port(y).

<dt><tt><i>dst_addr</i></tt>
<dd>Adres docelowy pakietów, który ma ulegaæ translacji. Adres docelowy
jest podawany w ten sam sposób, co adres ¼ród³owy.

<dt><tt><i>dst_port</i></tt>
<dd>Port docelowy w Warstwie 4 nag³ówka pakietu. Port ten jest podawany
w ten sam sposób, co port ¼ród³owy.

<dt><tt><i>ext_addr</i></tt>
<dd>Zewnêtrzny adres w bramce NAT, na który pakiety bêd± t³umaczone.
Zewnêtrzny adres mo¿e byæ podany jako:
<ul>
<li>Pojedynczy adres IPv4 lub IPv6.
<li>Blok sieci - <a href="http://public.pacbell.net/dedicated/cidr.html">CIDR</a>.
<li>W pe³ni okre¶lona domena, która bêdzie rozwijana przez DNS w czasie
³adowania zestawu regu³.
<li>Nazwa zewnêtrznego interfejsu sieciowego. Wszystkie adresy IP przypisane do
urz±dzenia bêd± wprowadzone podczas ³adowania zestawu regu³.
<li>Nazwa zewnêtrznego interfejsu sieciowego w nawiasach okr±g³ych 
<tt>( )</tt>. Mówi to PF, aby od¶wie¿aæ regu³ê, je¶li adres(y) IP tego
urz±dzenia sieciowego ulegn± zmianie. Jest to bardzo przydatne gdy zewnêtrzne
urz±dzenie otrzymuje swój adres IP przez DHCP lub dial-up, gdy¿ zestaw regu³
nie musi byæ prze³adowywany za ka¿dym razem, gdy zmienia siê IP.
<li>Nazwa interfejsu sieciowego z dopisanym na koñcu jednym z poni¿szych
wyra¿eñ:
  <ul>
  <li><tt>:network</tt> - odpowiada blokowi sieci CIDR (np
  192.168.0.0/24)
  <li><tt>:peer</tt> - odpowiada adresowi IP wêz³a na drugim koñcu po³±czenia
  point-to-point
  </ul>
  <dl>
  <dd>Dodatkowo, wyra¿enie <tt>:0</tt> mo¿e zostaæ dodane na koñcu
  zarówno nazwy interfejsu jak i któregokolwiek z wymienionych s³ów
  kluczowych aby nie by³y brane pod uwagê dodatkowe, wskazuj±ce adresy IP
  (ang. aliased IP addresses) podczas przetwarzania regu³.
  Oznaczenia te mog± tak¿e byæ u¿yte wewn±trz wyra¿eñ w nawiasach.
  Przyk³ad: <tt>fxp0:network:0</tt>
  </dl>
<li>Zestaw adresów w postaci <a href="macros.html#lists">listy</a>.
</ul>

<dt><tt><i>pool_type</i></tt>
<dd>Okre¶la jaki typ <a href="pools.html">puli adresów</a> ma byæ
zastosowany dla translacji.

<dt><tt>static-port</tt>
<dd>Mówi PF, aby port ¼ród³owy w pakietach TCP i UDP nie ulega³ translacji.

</dl>

<p>
Prowadzi to do najprostszej formy tej linii, podobnej do tej:
<blockquote>
<tt>
nat on tl0 from 192.168.1.0/24 to any -&gt; 24.5.0.5
</tt>
</blockquote>

<p>
Regu³a ta mówi, aby wykonywaæ translacje NAT na urz±dzeniu <tt>tl0</tt> dla
wszystkich pakietów z bloku 192.168.1.0/24, oraz aby zastêpowaæ ¼ród³owy
adres IP przez 24.5.0.5.

<p>
Mimo, ¿e powy¿sza regu³a jest poprawna, nie jest ona polecan± form±.
Jej konserwacja mog³aby byæ trudna, gdy¿ jakiekolwiek zmiany w numerach
zewnêtrznych lub wewnêtrznych adresów bêd± wymagaæ modyfikacji tej linii.
Porównaj j± z t±, ³atw± w zarz±dzaniu, regu³k± (<tt>tl0</tt> zewnêtrzny
interfejs, <tt>dc0</tt> wewnêtrzne interfejs):
<blockquote>
<tt>
nat on tl0 from dc0:network to any -&gt; tl0
</tt>
</blockquote>

<p>
Zalety powinny byæ wyra¼nie widoczne: mo¿na zmieniaæ adresy IP któregokolwiek
z interfejsów bez zmiany tej regu³y.

<p>
Gdy podana zostaje nazwa interfejsu dla translacji adresów, jak w
przyk³adzie powy¿ej, adres IP jest okre¶lony w pf.conf podczas
<i>³adowania</i>, nie od rêki. Je¶li u¿ywane jest DHCP, do konfiguracji
zewnêtrznego interfejsu, mo¿na napotkaæ nastêpuj±cy problem: je¶li przypisany
adres IP ulega zmianie, NAT nadal bêdzie t³umaczyæ wychodz±ce pakiety
u¿ywaj±c starego adresu IP. Spowoduje to, ¿e wychodz±ce po³±czenia przestan±
funkcjonowaæ. Aby to obej¶æ, mo¿na nakazaæ PF automatycznie aktualizowaæ adres
translacji poprzez wstawienie nazwy danego interfejsu w nawiasy okr±g³e:
<blockquote>
<tt>
nat on tl0 from dc0:network to any -&gt; (tl0)
</tt>
</blockquote>

<p>
Ta metoda translacji dzia³a zarówno dla adresów IPv4 jak i IPv6.

<a name="binat"></a>
<h2>Dwukierunkowe mapowanie adresów (mapowanie 1:1)</h2>
Dwukierunkowe mapowanie mo¿e byæ realizowane przy pomocy regu³y
<tt>binat</tt>. Regu³a <tt>binat</tt> realizuje mapowanie jeden do jednego
pomiêdzy zewnêtrznym i wewnêtrznym adresem IP. Mo¿e to byæ u¿yteczne, aby
serwer web z sieci wewnêtrznej by³ widoczny w Internecie jako serwer web 
z w³asnym zewnêtrznym adresem IP. Po³±czenia z Internetu na ten adres
zewnêtrzny bêd± t³umaczone na adres wewnêtrzny , a po³±czenia z serwera web
(jak na przyk³ad zapytania DNS) bêd± t³umaczone na adres zewnêtrzny. Porty
TCP i UDP nie s± nigdy modyfikowane przez regu³y <tt>binat</tt>, co odró¿nia
t± regu³ê od <tt>nat</tt>.

<p>
Przyk³ad:
<blockquote>
<tt>
web_serv_int = "192.168.1.100"<br>
web_serv_ext = "24.5.0.6"<br>
<br>
binat on tl0 from $web_serv_int to any -&gt; $web_serv_ext<br>
</tt>
</blockquote>

<a name="except"></a>
<h2>Wyj±tki w regu³ach translacji</h2>
Wyj±tki w regu³ach translacji mog± byæ definiowane przy pomocy s³owa kluczowego
<tt>no</tt>. Je¶li wcze¶niejszy przyk³ad NAT by³by zmodyfikowany
w nastêpuj±cy sposób:
<blockquote>
<tt>
no nat on tl0 from 192.168.1.208 to any<br>
nat on tl0 from 192.168.1.0/24 to any -&gt; 24.2.74.79
</tt>
</blockquote>

<p>
Wówczas translacja NAT by³aby realizowana dla ca³ego bloku sieci
192.168.1.0/24, z wyj±tkiem hosta 192.168.1.208.

<p>
Zwróæ uwagê, ¿e w przypadku translacji brana jest pierwsza pasuj±ca regu³a -
je¶li jest to regu³ka <tt>no</tt>, wtedy pakiet nie bêdzie poddany translacji.
S³owo kluczowe <tt>no</tt> mo¿e tak¿e byæ u¿ywane wraz z regu³ami
<tt>binat</tt> i <a href="rdr.html"><tt>rdr</tt></a>.

<a name="status"></a>
<h2>Sprawdzanie stanu NAT</h2>
Aby wy¶wietliæ listê aktywnych translacji NAT, u¿ywa siê programu 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+4.6"
>pfctl(8)</a> z opcj± <tt>-s state</tt>. Opcja ta wy¶wietli wszystkie obecne sesje NAT:

<pre>
   # pfctl -s state
   fxp0 TCP 192.168.1.35:2132 -&gt; 24.5.0.5:53136 -&gt; 65.42.33.245:22 TIME_WAIT:TIME_WAIT
   fxp0 UDP 192.168.1.35:2491 -&gt; 24.5.0.5:60527 -&gt; 24.2.68.33:53   MULTIPLE:SINGLE
</pre>

<p>
Wyja¶nienie (jedynie pierwsza linia):

<dl>
<dt>fxp0
<dd>To interfejs z którym zwi±zany jest wpis w tabeli stanów. 
S³owo kluczowe
<tt>self</tt> pojawi siê gdy stan jest ruchomy (ang. 
<a href="options.html#state-policy"><tt>floating</tt>)</a>.
</dl>

<dl>
<dt>TCP
<dd>Protokó³ wykorzystywany przez po³±czenie.
</dl>

<dl>
<dt>192.168.1.35:2132
<dd>Adres IP (192.168.1.35) maszyny w sieci wewnêtrznej. Port ¼ród³owy
(2132) jest wy¶wietlany po adresie. Jest to adres, który jest zamieniany
w nag³ówku IP.
</dl>

<dl>
<dt>24.5.0.5:53136
<dd>Adres IP (24.5.0.5) i port (53136) na bramce, na który pakiety s±
t³umaczone.
</dl>

<dl>
<dt>65.42.33.245:22
<dd>Adres IP (65.42.33.245) i port (22), na który ³±czy siê maszyna z
sieci wewnêtrznej.
</dl>

<dl>
<dt>TIME_WAIT:TIME_WAIT
<dd>Stan w jakim, wed³ug PF, znajduje siê po³±czenie TCP.
</dl>

<p>
[<a href="filter.html">Wstecz: Filtrowanie pakietów</a>]
[<a href="index.html">Spis tre¶ci</a>]
[<a href="rdr.html">Dalej: Przekierowania ruchu</a>]

<p>
<hr>
<a href="index.html"><img height="24" width="24" src="../../../images/back.gif" border="0" alt="[wstecz]"></a> 
<a href="mailto:www@@openbsd.org">www@@openbsd.org</a>
<br>
<small>
<!--
Originally [OpenBSD: nat.html,v 1.31 ]<br>
$Translation: nat.html,v 1.24 2009/11/08 19:35:52 tkniaz Exp $<br>
-->
$OpenBSD: nat.html,v 1.24 2009/11/08 22:09:17 tobias Exp $
</small>
</body>
</html> 
@


1.24
log
@Sync with Steelix CVS
@
text
@d509 1
a509 1
$OpenBSD$
@


1.23
log
@Sync with Steelix CVS
@
text
@d214 1
a214 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+4.5"
d445 1
a445 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+4.5"
d506 2
a507 2
Originally [OpenBSD: nat.html,v 1.30 ]<br>
$Translation: nat.html,v 1.23 2009/05/03 15:43:29 tkniaz Exp $<br>
@


1.22
log
@Sync with Steelix CVS
@
text
@d214 1
a214 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+4.4"
d445 1
a445 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+4.4"
d506 2
a507 2
Originally [OpenBSD: nat.html,v 1.29 ]<br>
$Translation: nat.html,v 1.22 2008/11/01 23:52:42 tkniaz Exp $<br>
@


1.21
log
@Sync with Steelix CVS
@
text
@d214 1
a214 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+4.3"
d445 1
a445 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+4.3"
d506 2
a507 2
Originally [OpenBSD: nat.html,v 1.28 ]<br>
$Translation: nat.html,v 1.21 2008/07/30 23:22:49 tkniaz Exp $<br>
@


1.20
log
@Sync with Steelix CVS
@
text
@d214 1
a214 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+4.2"
d445 1
a445 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+4.2"
d506 2
a507 2
Originally [OpenBSD: nat.html,v 1.27 ]<br>
$Translation: nat.html,v 1.20 2007/11/03 10:20:39 tkniaz Exp $<br>
@


1.19
log
@Sync with steelix translation CVS
@
text
@d197 1
a197 1
nat [pass [log]] on <i>interface</i> [<i>af</i>] from <i>src_addr</i>
d213 2
a214 2
<dd>U¿ycie <tt>log</tt> pozwoli logowaæ pakiety poprzez 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+4.1"
d445 1
a445 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+4.1"
d506 2
a507 2
Originally [OpenBSD: nat.html,v 1.26 ]<br>
$Translation: nat.html,v 1.19 2007/05/07 00:53:30 tkniaz Exp $<br>
@


1.18
log
@sync with Steelix CVS
@
text
@d166 1
a166 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&amp;sektion=3&amp;manpath=OpenBSD+4.0"
d178 1
a178 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl.conf&amp;sektion=5&amp;manpath=OpenBSD+4.0"
d214 1
a214 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+4.0"
d272 1
a272 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=services&amp;sektion=5&amp;manpath=OpenBSD+4.0"
d445 1
a445 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+4.0"
d506 2
a507 2
Originally [OpenBSD: nat.html,v 1.25 ]<br>
$Translation: nat.html,v 1.18 2006/11/04 16:11:12 tkniaz Exp $<br>
@


1.17
log
@sync with steelix translation CVS
@
text
@d52 1
a52 1
<li><a href="#filter">NAT, a filtrowanie pakietów</a>
d141 1
a141 1
<h2>NAT, a filtrowanie pakietów</h2>
d166 1
a166 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&amp;sektion=3&amp;manpath=OpenBSD+3.9"
d178 1
a178 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl.conf&amp;sektion=5&amp;manpath=OpenBSD+3.9"
d214 1
a214 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+3.9"
d220 2
a221 1
<dd>Nazwa interfejsu sieciowego na którym ma mieæ miejsce translacja pakietów.
d238 3
a240 3
<li>Nazwa interfejsu sieciowego wraz z <tt><i>/netmask±</i></tt>
(np <tt>/24</tt>). Ka¿dy adres IP danego interfejsu jest ³±czony
z ka¿d± mask± sieciow± aby utworzyæ odpowiedni blok sieci CIDR,
d242 1
a242 1
<li>Nazwa interfejsu sieciowego z dopisanym na koñcu jednym z poni¿szych
d254 1
a254 1
  zarówno nazwy interfejsu jak i któregokolwiek z wymienionych s³ów
d272 1
a272 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=services&amp;sektion=5&amp;manpath=OpenBSD+3.9"
d445 1
a445 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+3.9"
d506 2
a507 2
Originally [OpenBSD: nat.html,v 1.24 ]<br>
$Translation: nat.html,v 1.17 2006/10/30 05:25:56 tkniaz Exp $<br>
@


1.16
log
@sync with steelix translation CVS
@
text
@d69 2
a70 1
<a href="http://www.geektools.com/rfc/rfc1631.txt">RFC 1631</a>.
d75 2
a76 1
<a href="http://www.geektools.com/rfc/rfc1918.txt">RFC 1918</a>.
d505 2
a506 2
Originally [OpenBSD: nat.html,v 1.23 ]<br>
$Translation: nat.html,v 1.16 2006/05/23 17:51:58 tkniaz Exp $<br>
@


1.15
log
@sync with Steelix CVS
@
text
@a63 1
<p>
d235 1
a235 1
<li>Nazwa interfejsu sieciowego wraz z mask± sieciow±
a323 2
  <li><tt>:broadcast</tt> - odpowiada adresowi rozg³oszeniowemu podsieci
  (np 192.168.0.255)
d441 1
a441 2
Aby wy¶wietliæ listê aktywnych translacji NAT, u¿ywa siê opcji
<tt>-s state</tt> programu
d443 1
a443 1
>pfctl(8)</a>. Opcja ta wy¶wietli wszystkie obecne sesje NAT:
d504 1
a504 1
$Translation: nat.html,v 1.14 2006/05/13 00:20:44 tkniaz Exp $<br>
@


1.14
log
@sync with steelix translation CVS
@
text
@d130 1
a130 1
kombinacji IP/port, która mówi PF, ¿e datagarmy nale¿± do po³±czenia
d253 1
a253 1
  kluczowych aby nie by³y brane pod uwagê dodantkowe, wskazuj±ce adresy IP
d255 1
a255 1
  Oznaczenia te mog± tak¿e byæ u¿yte wewnatrz wyra¿eñ w nawiasach.
d318 1
a318 1
urz±dzenie otrzymuje swój adres IP przez DHCP lub dial-up, gdzy¿ zestaw regu³
d333 1
a333 1
  kluczowych aby nie by³y brane pod uwagê dodantkowe, wskazuj±ce adresy IP
d335 1
a335 1
  Oznaczenia te mog± tak¿e byæ u¿yte wewnatrz wyra¿eñ w nawiasach.
d444 1
a444 1
Aby wy¶wietliæ listê aktywnych translacji NAT, u¿ywa sie opcji
d508 1
a508 1
$Translation: nat.html,v 1.13 2006/05/01 18:52:44 tkniaz Exp $<br>
@


1.13
log
@sync with steelix translation CVS
@
text
@d165 1
a165 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&amp;sektion=3&amp;manpath=OpenBSD+3.8"
d177 1
a177 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl.conf&amp;sektion=5&amp;manpath=OpenBSD+3.8"
d213 1
a213 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+3.8"
d270 1
a270 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=services&amp;sektion=5&amp;manpath=OpenBSD+3.8"
d446 1
a446 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+3.8"
d507 2
a508 2
Originally [OpenBSD: nat.html,v 1.22 ]<br>
$Translation: nat.html,v 1.12 2006/01/18 16:23:03 tkniaz Exp $<br>
@


1.12
log
@sync with Steelix CVS
@
text
@d196 1
a196 1
nat [pass] on <i>interface</i> [<i>af</i>] from <i>src_addr</i>
d211 7
d507 2
a508 2
Originally [OpenBSD: nat.html,v 1.21 ]<br>
$Translation: nat.html,v 1.11 2005/11/02 15:08:45 tkniaz Exp $<br>
@


1.11
log
@sync with Steelix CVS
@
text
@d165 1
a165 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&amp;sektion=3&amp;manpath=OpenBSD+3.7"
d177 1
a177 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl.conf&amp;sektion=5&amp;manpath=OpenBSD+3.7"
d263 1
a263 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=services&amp;sektion=5&amp;manpath=OpenBSD+3.7"
d439 1
a439 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+3.7"
d500 2
a501 2
Originally [OpenBSD: nat.html,v 1.20 ]<br>
$Translation: nat.html,v 1.10 2005/08/24 11:42:47 pl-team Exp $<br>
@


1.10
log
@sync with Steelix CVS
@
text
@d499 1
d501 2
a502 1
$Translation: nat.html,v 1.9 2005/08/12 07:53:54 pl-team Exp $<br>
@


1.9
log
@sync with steelxi translation CVS
@
text
@d165 1
a165 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&amp;sektion=3&amp;manpath=OpenBSD+3.6"
d177 1
a177 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl.conf&amp;sektion=5&amp;manpath=OpenBSD+3.6"
d263 1
a263 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=services&amp;sektion=5&amp;manpath=OpenBSD+3.6"
d439 1
a439 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+3.6"
d499 2
a500 2
Originally [OpenBSD: nat.html,v 1.19 ]<br>
$Translation: nat.html,v 1.8 2005/05/03 21:21:34 pl-team Exp $<br>
@


1.8
log
@huge sync from the translators
@
text
@@


1.7
log
@sync with Polish OpenBSD Doc Project, thanks guys !
@
text
@d35 3
a37 1
<img alt="[OpenBSD]" height=30 width=141 src="../../../images/smalltitle.gif">
d499 2
a500 2
Originally [OpenBSD: nat.html,v 1.18 ]<br>
$Translation: nat.html,v 1.7 2004/11/12 13:50:48 pl-team Exp $<br>
@


1.6
log
@Sync with Steelix CVS
@
text
@d163 1
a163 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&amp;sektion=3&amp;manpath=OpenBSD+3.5"
d175 1
a175 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl.conf&amp;sektion=5&amp;manpath=OpenBSD+3.5"
d261 1
a261 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=services&amp;sektion=5&amp;manpath=OpenBSD+3.5"
d418 1
a418 1
no nat on tl0 from 192.168.1.10 to any<br>
d425 1
a425 1
192.168.1.0/24, z wyj±tkiem hosta 192.168.1.10.
d437 1
a437 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+3.5"
d497 2
a498 2
Originally [OpenBSD: nat.html,v 1.16 ]<br>
$Translation: nat.html,v 1.6 2004/10/09 15:07:44 pl-team Exp $<br>
@


1.5
log
@Sync with Steelix CVS
@
text
@a10 1
<meta name="copyright"     content="This document copyright 2002-2004 by OpenBSD.">
d13 18
d163 1
a163 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&amp;sektion=3&amp;manpath=OpenBSD+3.4"
d167 2
a168 2
# sysctl -w net.inet.ip.forwarding=1<br>
# sysctl -w net.inet6.ip6.forwarding=1 <i>(je¶li u¿ywany jest IPv6)</i>
d175 1
a175 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl.conf&amp;sektion=5&amp;manpath=OpenBSD+3.4"
d231 19
a249 4
<li>Nazwa interfejsu sieciowego z dopisanym na koñcu s³owem kluczowym
<tt>:network</tt> lub <tt>:broadcast</tt>. Odpowiedni blok sieci CIDR
(np 192.168.0.0/24) lub adres rozg³oszeniowy (np 192.168.0.255) bêdzie
wprowadzony podczas ³adowania zestawu regu³.
d261 1
a261 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=services&amp;sektion=5&amp;manpath=OpenBSD+3.4"
a272 1
	</ul>
d277 6
d311 18
a328 3
<li>Nazwa interfejsu sieciowego z dopisanym na koñcu s³owem kluczowym
<tt>:network</tt>. Odpowiedni blok sieci CIDR (np 192.168.0.0/24) bêdzie
wprowadzony podczas ³adowania zestawu regu³.
d362 1
a362 1
nat on tl0 from dc0/24 to any -&gt; tl0
d381 1
a381 1
nat on tl0 from dc0/24 to any -&gt; (tl0)
d386 1
a386 3
Jest jedno znacz±ce ograniczenie tej metody: jedynie pierwszy alias IP
na danym urz±dzeniu jest rozwijany gdy nazwa interfejsu jest w nawiasach
okr±g³ych.
d437 1
a437 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+3.4"
d442 2
a443 2
   TCP 192.168.1.35:2132 -&gt; 24.5.0.5:53136 -&gt; 65.42.33.245:22 TIME_WAIT:TIME_WAIT
   UDP 192.168.1.35:2491 -&gt; 24.5.0.5:60527 -&gt; 24.2.68.33:53   MULTIPLE:SINGLE
d450 8
d497 2
a498 2
Originally [OpenBSD: nat.html,v 1.13 ]<br>
$Translation: nat.html,v 1.5 2004/01/12 17:37:45 pl-team Exp $<br>
@


1.4
log
@Sync with Steelix CVS
@
text
@d11 1
a11 1
<meta name="copyright"     content="This document copyright 2002-2003 by OpenBSD.">
d439 2
a440 2
Originally [OpenBSD: nat.html,v 1.12 ]<br>
$Translation: nat.html,v 1.4 2003/12/15 19:58:42 pl-team Exp $<br>
@


1.3
log
@Sync with Steelix CVS
@
text
@d20 1
a20 1
[<a href="queueing.html">Wstecz: Kolejkowanie</a>]
d33 2
a34 1
<li><a href="#enable">W³±czanie NAT</a>
d120 17
d138 2
a139 1
<h2>W³±czanie NAT</h2>
d141 7
a147 3
Aby uruchomiæ NAT na bramce OpenBSD, poza
<a href="config.html#activate">aktywacj± PF</a>, trzeba tak¿e w³±czyæ
przekazywanie pakietów IP (ang. IP forwarding):
d174 1
a174 1
Ogólna sk³adnia regu³ NAT w <tt>/etc/pf.conf</tt> wygl±da tak:
d177 1
a177 1
nat on <i>extif</i> [<i>af</i>] from <i>src_addr</i> 
d179 2
a180 2
&nbsp;&nbsp;&nbsp;<i>dst_addr</i> [port <i>dst_port</i>] -&gt; 
<i>ext_addr</i>
d185 9
a193 2
<dt><tt><i>extif</i></tt>
<dd>Nazwa zewnêtrznego interfejsu sieciowego.
d280 7
a423 1

d429 1
a429 1
[<a href="queueing.html">Wstecz: Kolejkowanie</a>]
d439 2
a440 2
Originally [OpenBSD: nat.html,v 1.11 ]<br>
$Translation: nat.html,v 1.3 2003/11/13 12:03:04 pl-team Exp $<br>
@


1.2
log
@sync with steelix cvs
@
text
@d135 1
a135 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl.conf&amp;sektion=5&amp;manpath=OpenBSD+3.3"
d199 1
a199 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=services&amp;sektion=5&amp;manpath=OpenBSD+3.3"
d350 1
a350 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+3.3"
d403 2
a404 2
Originally [OpenBSD: nat.html,v 1.10 ]<br>
$Translation: nat.html,v 1.2 2003/09/28 14:46:48 pl-team Exp $<br>
@


1.1
log
@sync with Polish translation project
@
text
@d402 3
a404 2
<small>Originally [OpenBSD: nat.html,v 1.7 ]<br>
$Translation: nat.html,v 1.1 2003/08/28 09:46:09 pl-team Exp $<br>
@

