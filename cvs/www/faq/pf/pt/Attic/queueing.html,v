head	1.19;
access;
symbols;
locks; strict;
comment	@# @;


1.19
date	2014.04.01.17.14.11;	author nick;	state dead;
branches;
next	1.18;

1.18
date	2013.12.06.20.52.46;	author ajacoutot;	state Exp;
branches;
next	1.17;

1.17
date	2013.05.03.05.53.48;	author ajacoutot;	state Exp;
branches;
next	1.16;

1.16
date	2013.01.18.07.15.55;	author ajacoutot;	state Exp;
branches;
next	1.15;

1.15
date	2012.12.19.19.53.39;	author ajacoutot;	state Exp;
branches;
next	1.14;

1.14
date	2009.10.19.09.39.59;	author ajacoutot;	state Exp;
branches;
next	1.13;

1.13
date	2009.10.17.15.58.26;	author ajacoutot;	state Exp;
branches;
next	1.12;

1.12
date	2009.05.16.08.59.12;	author ajacoutot;	state Exp;
branches;
next	1.11;

1.11
date	2009.03.16.20.24.23;	author tobias;	state Exp;
branches;
next	1.10;

1.10
date	2008.04.15.11.07.13;	author tobias;	state Exp;
branches;
next	1.9;

1.9
date	2007.12.01.10.39.11;	author tobias;	state Exp;
branches;
next	1.8;

1.8
date	2006.11.22.15.14.07;	author saad;	state Exp;
branches;
next	1.7;

1.7
date	2006.06.26.18.32.12;	author jufi;	state Exp;
branches;
next	1.6;

1.6
date	2006.05.29.11.06.11;	author jufi;	state Exp;
branches;
next	1.5;

1.5
date	2005.12.24.10.04.36;	author saad;	state Exp;
branches;
next	1.4;

1.4
date	2005.11.18.20.48.47;	author jufi;	state Exp;
branches;
next	1.3;

1.3
date	2005.06.08.17.38.20;	author saad;	state Exp;
branches;
next	1.2;

1.2
date	2005.02.12.11.03.21;	author jufi;	state Exp;
branches;
next	1.1;

1.1
date	2005.01.06.20.03.30;	author jufi;	state Exp;
branches;
next	;


desc
@@


1.19
log
@
Abandon translations, per deraadt@@ and ajacoutot@@.
@
text
@<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>PF: Enfileiramento de Pacotes e Priorização</title>
<link rev="made" href="mailto:www@@openbsd.org">
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<meta name="resource-type" content="document">
<meta name="description"   content="the OpenBSD FAQ page">
<meta name="keywords"      content="openbsd,faq,pf">
<meta name="distribution"  content="global">
</head>

<!--
Copyright (c) 2003-2005 Joel Knight <enabled@@myrealbox.com>

Permission to use, copy, modify, and distribute this documentation for
any purpose with or without fee is hereby granted, provided that the
above copyright notice and this permission notice appear in all copies.

THE DOCUMENTATION IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL
WARRANTIES WITH REGARD TO THIS DOCUMENTATION INCLUDING ALL IMPLIED
WARRANTIES OF MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE
AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL
DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR
PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER
TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS DOCUMENTATION
-->

<body bgcolor="#ffffff" text="#000000">
<!-- Passes validator.w3.org, please keep it this way;
please, use a max of 72 chars per line -->

<a href="../../../pt/index.html">
<img alt="[OpenBSD]" height=30 width=141 src="../../../images/smalltitle.gif" border="0">
</a>
<p>
[<a href="anchors.html">Anterior: Âncoras</a>]
[<a href="index.html">Conteúdo</a>]
[<a href="pools.html">Próximo: Grupos de Endereços e Balanceamento de Carga</a>]

<p>
<h1><font color="#e00000">PF: Enfileiramento de Pacotes e Priorização</font></h1>


<hr>

<h3>Conteúdo</h3>
<ul>
<li><a href="#queueing">Enfileiramento</a>
<li><a href="#sched">Agendadores</a>
	<ul>
	<li><a href="#cbq">Enfileiramento Baseado em Classe</a>
	<li><a href="#priq">Enfileiramento por Prioridade</a>
	<li><a href="#red">Detecção Antecipada Aleatória</a>
	<li><a href="#ecn">Notificação de Congestionamento Explícita</a>
	</ul>
<li><a href="#altq">Configuração de Enfileiramento</a>
<li><a href="#assign">Atribuição de Tráfego a uma Fila</a>
<li><a href="#example1">Exemplo 1: Rede Pequena, doméstica</a>
<li><a href="#example2">Exemplo 2: Rede Empresarial</a>
</ul>

<hr>

<a name="queueing"></a>
<h2>Enfileiramento</h2>
<p>
Enfileirar algo é armazená-lo em algum lugar, de maneira organizada,
enquanto aguarda processamento. Em uma rede de computadores, quando
pacotes de dados são enviados por uma máquina eles entram em uma fila
onde aguardam processamento pelo sistema operacional. O sistema
operacional decide qual fila e qual(is) pacote(s) nessa fila deve(m)
ser processado(s). A ordem em que o sistema operacional escolhe os
pacotes para processar pode afetar o desempenho da rede. Por exemplo,
imagine um usuário executando dois aplicativos de rede:
SSH e FTP. Em condições ideais, os pacotes SSH devem ser processados
antes dos pacotes FTP por causa da natureza sensível do tempo no SSH;
quando uma tecla é acionada em um cliente SSH, uma resposta imediata é
esperada, mas uma transferência FTP sendo atrasada por alguns segundos
extras muito dificilmente será percebida. Mas o que acontece se o
roteador manipulando essas conexões processar um grande número de
pacotes da conexão FTP antes de processar a conexão SSH? Pacotes
da conexão SSH permanecerão na fila (ou possivelmente serão
descartados pelo roteador caso a fila não seja grande o suficiente
para manter todos os pacotes) e a sessão SSH parecerá latente
ou muito lenta. Ao modificar a estratégia de enfileiramento utilizada,
a largura de banda pode ser compartilhada entre diferentes aplicativos,
usuários e computadores.

<p>
Perceba que o enfileiramento é útil somente para pacotes que estão
<i>saindo</i>.
Quando o pacote chega na direção de entrada em uma interface, já é tarde
demais para ser enfileirado -- ele já consumiu largura de banda ao
chegar na interface que o recebeu.
A única solução é habilitar enfileiramento no roteador adjacente ou, se
a máquina que recebeu o pacote está funcionando como roteador, habilitar
enfileiramento na interface interna por onde os pacotes saem dele.

<a name="sched"></a>
<h2>Agendadores</h2>
O agendador ("scheduler") é que decide quais filas processar e em que
ordem. Por padrão o OpenBSD usa um agendador do tipo
Primeiro a Entrar, Primeiro a Sair (FIFO - "First In First Out").
Uma fila FIFO funciona como um caixa de supermercado -- o primeiro item
na fila é o primeiro a ser processado. Conforme novos pacotes chegam,
vão sendo colocados no fim da fila. Caso a fila fique cheia, e aqui
a analogia com o supermercado termina, novos pacotes que estão chegando
são descartados. Isso é conhecido como "tail-drop".

<p>
OpenBSD suporta mais dois agendadores:
<ul>
<li>Enfileiramento Baseado em Classe
<li>Enfileiramento por Prioridade
</ul>

<a name="cbq"></a>
<h3>Enfileiramento Baseado em Classe</h3>
O Enfileiramento Baseado em Classe (CBQ - "Class Based Queueing") é um
algoritmo de enfileiramento que divide a largura de banda entre
múltiplas filas ou classes. Cada fila então recebe a atribuição de
tráfego com base no endereço de origem ou destino, número de porta,
protocolo, etc. Uma fila pode opcionalmente ser configurada para
emprestar largura de banda de sua fila pai, caso esta não esteja
utilizando sua largura total. As filas também recebem uma prioridade,
de modo que as que contêm tráfego interativo, como SSH, podem ter seus
pacotes processados antes de filas que contêm tráfego intenso, como FTP.

<p>
Filas CBQ são organizadas de forma hierárquica. No topo da hierarquia
está a fila raiz que define a quantidade total de largura de banda
disponível.
As filas filhas são criadas sob a fila raiz, cada uma delas pode
receber parte da largura de banda da fila raiz. Por exemplo, filas
podem ser definidas da seguinte maneira:
<dl>
<dd>Fila Raiz (2Mbps)
	<dl>
	<dd>Fila A (1Mbps)
	<dd>Fila B (500Kbps)
	<dd>Fila C (500Kbps)
	</dl>
</dl>

<p>
Nesse caso, a largura de banda total disponível está definida como
2 megabits por segundo (Mbps). Essa largura de banda é então dividida
entre outras três filas filhas.

<p>
A hierarquia pode ser expandida definindo-se filas dentro de filas.
Para dividir a largura de banda igualmente entre diferentes usuários e
ainda classificar seu tráfego de forma que certos protocolos não ocupem
a largura de banda de outros, uma estrutura de enfileiramento parecida
com esta pode ser definida:
<dl>
<dd>Fila Raiz (2Mbps)
	<dl>
	<dd>UsuárioA (1Mbps)
		<dl>
		<dd>ssh (50Kbps)
		<dd>tráfego intenso (950Kbps)
		</dl>
	<dd>UsuárioB (1Mbps)
		<dl>
		<dd>áudio (250Kbps)
		<dd>tráfego intenso (750Kbps)
			<dl>
			<dd>http (100Kbps)
			<dd>outro (650Kbps)
			</dl>
		</dl>
	</dl>
</dl>

<p>
Perceba que a cada nível a soma do total da largura de banda vinculada
a cada fila nunca é maior que o valor da largura de banda da fila raiz.

<p>
Uma fila pode ser configurada para emprestar largura de banda de sua
fila pai caso as outras filas dentro da fila pai não estejam usando
sua porção e a largura de banda esteja disponível. Considere a
configuração de enfileiramento a seguir:
<dl>
<dd>Fila Raiz (2Mbps)
	<dl>
	<dd>UsuárioA (1Mbps)
		<dl>
		<dd>ssh (100Kbps)
		<dd>ftp (900Kbps, toma emprestado largura de banda)
		</dl>
	<dd>UsuárioB (1Mbps)
	</dl>
</dl>

<p>
Se o tráfego na fila <tt>ftp</tt> exceder os 900Kbps e o tráfego na fila
<tt>UsuárioA</tt> for menor que 1Mbps (porque a fila <tt>ssh</tt> está
usando menos que 100Kbps), a fila <tt>ftp</tt> empresta a
largura de banda excedente de <tt>UsuárioA</tt>.
Dessa forma a fila <tt>ftp</tt> pode usar mais largura de banda do que
foi definido a princípio quando necessário. Quando o tráfego na
fila <tt>ssh</tt> aumenta, a largura de banda emprestada é devolvida.

<p>
CBQ atribui a cada fila um nível de prioridade. Filas com prioridade
alta têm preferência sobre outras com menor prioridade em caso de
congestionamento, contanto que ambas as filas estejam contidas na mesma
fila pai (em outras palavras, contanto que estejam no mesmo ramo na
hierarquia).
Filas com a mesma prioridade são processadas pelo método round robin.
Por exemplo:
<dl>
<dd>Fila Raiz (2Mbps)
	<dl>
	<dd>UsuárioA (1Mbps, prioridade 1)
		<dl>
		<dd>ssh (100Kbps, prioridade 5)
		<dd>ftp (900Kbps, prioridade 3)
		</dl>
	<dd>UsuárioB (1Mbps, prioridade 1)
	</dl>
</dl>

<p>
O CBQ processa as filas <tt>UsuárioA</tt> e <tt>UsuárioB</tt> através
do método round robin -- nenhuma fila será preferida sobre a outra.
Enquanto a fila <tt>UsuárioA</tt> está sendo processada, o CBQ também
processa suas filas filhas.
Nesse caso, a fila <tt>ssh</tt> tem prioridade maior
e terá tratamento preferencial sobre a fila <tt>ftp</tt> caso a rede
fique congestionada. Perceba como as filas <tt>ssh</tt> e <tt>ftp</tt>
não têm suas prioridades comparadas às filas <tt>UsuárioA</tt> e
<tt>UsuárioB</tt> pelo fato de elas não estarem no mesmo ramo na
hierarquia.

<p>
Para um estudo mais detalhado sobre a teoria por trás do CBQ, por
favor consulte as
<a href="http://www.icir.org/floyd/cbq.html">Referências sobre CBQ</a>.

<a name="priq"></a>
<h3>Enfileiramento por Prioridade</h3>
No Enfileiramento por Prioridade (PRIQ - "Priority Queueing") várias
filas são atribuídas a uma interface de rede, com cada fila tendo um
único nível de prioridade.
Uma fila com prioridade mais alta <i>sempre</i> é processada na frente
de uma fila com prioridade mais baixa.
Se duas ou mais filas possuem a mesma prioridade, então essas filas
são processadas pelo método round robin.

<p>
A estrutura de enfileiramento no PRIQ é plana -- você não pode
definir filas dentro de filas. A fila raiz é definida, onde é
configurado o total de largura de banda disponível, então subfilas são
definidas sob a raiz. Considere o exemplo a seguir:
<dl>
<dd>Fila Raiz (2Mbps)
	<dl>
	<dd>Fila A (prioridade 1)
	<dd>Fila B (prioridade 2)
	<dd>Fila C (prioridade 3)
	</dl>
</dl>

<p>
A fila raiz é definida como tendo 2Mbps de largura de banda disponível
e três subfilas são definidas. A fila com maior prioridade (o maior
número de prioridade) é servida primeiro. Quando todos os pacotes nessa
fila são processados, ou caso a fila esteja vazia, PRIQ vai para a
próxima fila com prioridade mais alta. Dentro de uma fila, os pacotes
são processados através do método Primeiro a Entrar, Primeiro a Sair.

<p>
É importante notar que quando estiver usando PRIQ você deve planejar
suas filas com muito cuidado. Como PRIQ <i>sempre</i> processa a fila
com prioridade mais alta por primeiro, é possível que uma fila com alta
prioridade faça com que pacotes destinados a outra fila com prioridade
menor atrasem muito ou até mesmo sejam descartados caso a fila preferida
esteja recebendo um fluxo constante de pacotes.

<a name="red"></a>
<h3>Detecção Antecipada Aleatória</h3>
Detecção Antecipada Aleatória (RED - "Random Early Detection") é um
algoritmo para se evitar congestionamento.
Seu trabalho é evitar congestionamento na rede certificando-se de que a
fila não fique cheia. Ele realiza a tarefa calculando continuamente o
comprimento (tamanho) médio da fila e comparando-o com dois valores,
um valor mínimo e um valor máximo.
Se o tamanho médio da fila estiver abaixo do valor mínimo, então nenhum
pacote é descartado.
Se a média estiver acima do valor máximo, então <i>todos</i> os pacotes
que estão chegando são descartados.
Se o tamanho médio estiver entre os dois valores, então os pacotes são
descartados baseando-se no cálculo de probabilidade obtido a partir
do tamanho médio da fila. Em outras palavras, conforme o tamanho médio
da fila se aproxima do valor máximo, mais e mais pacotes são
descartados. Ao descartar pacotes, RED escolhe aleatoriamente de quais
conexões ele irá descartá-los.
Conexões que utilizam grandes porções da largura de banda têm maior
probabilidade de terem seus pacotes descartados.

<p>
O RED é útil porque evita uma situação conhecida como sincronização
global e porque pode acomodar aumentos repentinos no tráfego.
Sincronização global refere-se a uma queda na capacidade de
transferência devido aos pacotes descartados de várias conexões ao
mesmo tempo. Por exemplo, caso o congestionamento ocorra em um roteador
que está transmitindo tráfego para 10 conexões FTP, e pacotes de todas
(ou quase todas) as conexões são descartados (como é o caso com
enfileiramento FIFO), a capacidade média de transferência cai
severamente.
Essa não é uma situação ideal porque faz com que todas as conexões FTP
reduzam sua taxa de transferência, e também significa que a rede não
está mais sendo utilizada em todo seu potencial.
RED evita esse cenário escolhendo aleatoriamente quais conexões terão
pacotes descartados em vez de escolher todas elas.
Conexões que utilizam muita largura de banda têm chances maiores de
terem seus pacotes descartados. Dessa forma, conexões que ocupam muita
largura de banda são evitadas, o congestionamento é evitado, e
sérias perdas nas taxas de transferência não ocorrem.
Além disso, RED pode responder a aumentos repentinos no tráfego pelo
fato de começar a descartar pacotes <i>antes</i> da fila ficar cheia.
Quando o tráfego inesperado chegar, existe espaço suficiente
na fila para armazenar os novos pacotes.

<p>
RED deve ser usado apenas quando o protocolo de transporte for capaz
de responder a indicadores de congestionamento da rede. Na maioria
dos casos isso significa que RED deve ser usado para enfileirar
tráfego TCP e não tráfego UDP ou ICMP.

<p>
Para uma discussão mais detalhada sobre a teoria por trás do RED, por
favor consulte as
<a href="http://www.icir.org/floyd/red.html">Referências sobre RED</a>.

<a name="ecn"></a>
<h3>Notificação de Congestionamento Explícita</h3>
A Notificação de Congestionamento Explícita
(ECN - "Explicit Congestion Notification") trabalha em conjunto com RED
para notificar duas máquinas, comunicando-se pela rede, de quaisquer
congestionamentos no caminho de comunicação. Para fazer isso, RED
insere um sinalizador no cabeçalho do pacote em vez de descartá-lo.
Supondo que a máquina que está enviando dados tem suporte a ECN, ela
pode ler esse sinalizador e reduzir seu tráfego de rede de acordo.

<p>
Para mais informações sobre ECN, por favor consulte a
<a href="http://www.rfc-editor.org/rfc/rfc3168.txt">RFC 3168</a>.

<a name="altq"></a>
<h2>Configuração de Enfileiramento</h2>
Desde o OpenBSD 3.0 a implementação de enfileiramento
<a href="http://www.csl.sony.co.jp/person/kjc/kjc/software.html#ALTQ"
>"Alternate Queueing" (ALTQ)</a> é parte do sistema base.
A partir do OpenBSD 3.3, ALTQ foi integrado ao PF.
A implementação ALTQ do OpenBSD suporta os agendadores de
Enfileiramento Baseado em Classe (CBQ) e
Enfileiramento por Prioridade (PRIQ).
Ela também suporta Detecção Antecipada Aleatória (RED) e
Notificação de Congestionamento Explícita (ECN).

<p>
Pelo fato do ALTQ ter sido integrado ao PF, o PF deve estar habilitado
para que o enfileiramento funcione. Instruções sobre como habilitar o PF
podem ser encontradas em
<a href="config.html#activate">Primeiros Passos</a>.

<p>
O enfileiramento é configurado no arquivo <tt>
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&amp;sektion=5&amp;manpath=OpenBSD+5.4"
>pf.conf</a></tt>. Existem dois tipos de diretivas que são utilizadas
para configurar o enfileiramento:
<ul>
<li><tt>altq on</tt> - habilita o enfileiramento em uma interface,
    define qual agendador usar e cria a fila raiz
<li><tt>queue</tt> - define as propriedades da fila filha
</ul>

<p>
A sintaxe para a diretiva <tt>altq on</tt> é:
<blockquote>
<tt>
altq on <i>interface agendador</i> bandwidth <i>larg_de_banda</i> qlimit
<i>lim_da_fila</i> \<br>
&nbsp;&nbsp;&nbsp;tbrsize <i>tamanho</i> queue { <i>lista_de_filas</i> }
</tt>
</blockquote>

<ul>
<li><tt><i>interface</i></tt> - a interface de rede onde o
    enfileiramento deve ser ativado.
<li><tt><i>agendador</i></tt> - o agendador a ser utilizado. Valores
    possíveis são <tt>cbq</tt> e <tt>priq</tt>. Somente um agendador
    por vez pode estar ativo na interface.
<li><tt><i>larg_de_banda</i></tt> - o valor total de largura de banda
    disponível para o agendador. Isso pode ser especificado como um
    valor absoluto utilizando os sufixos <tt>b</tt>, <tt>Kb</tt>,
    <tt>Mb</tt> e <tt>Gb</tt> para representar bits, kilobits, megabits
    e gigabits por segundo, respectivamente, ou como uma percentagem de
    largura de banda da <tt><i>interface</i></tt>.
<li><tt><i>lim_da_fila</i></tt> - o número máximo de pacotes que
    podem ser armazenados na fila. Esse parâmetro é opcional.
    O padrão é 50.
<li><tt><i>tamanho</i></tt> - o tamanho do regulador "token bucket" em
    bytes. Caso não seja especificado, o tamanho é definido baseando-se
    na largura de banda da <tt><i>interface</i></tt>.
<li><tt><i>lista_de_filas</i></tt> - uma lista de filas filhas a serem
    criadas sob a fila raiz.
</ul>

<p>
Por exemplo:
<blockquote>
<tt>
altq on fxp0 cbq bandwidth 2Mb queue { std, ssh, ftp }
</tt>
</blockquote>
Isso habilita o CBQ na interface <tt>fxp0</tt>. A largura de banda
total disponível é configurada para 2Mbps. Três filas filhas são
definidas:
<tt>std</tt>, <tt>ssh</tt> e <tt>ftp</tt>.

<p>
A sintaxe para a diretiva <tt>queue</tt> é:
<blockquote>
<tt>
queue <i>nome</i> [on <i>interface</i>] bandwidth <i>lar_de_banda</i> [priority
<i>prio</i>] [qlimit <i>lim_da_fila</i>] \<br>
&nbsp;&nbsp;&nbsp;<i>agendador</i> ( <i>opções_do_agendador</i> )
{ <i>lista_de_filas</i> }
</tt>
</blockquote>

<ul>
<li><tt><i>nome</i></tt> - o nome da fila. Esse nome deve ser um dos
    nomes de filas definidos na <tt><i>lista_de_filas</i></tt>
    da diretiva <tt>altq on</tt>. Para o <tt>cbq</tt>, também pode ser
    um nome de fila definido em uma <tt><i>lista_de_filas</i></tt>
    da diretiva <tt>queue</tt> anterior. Nomes de filas não devem ser
    mais longos que 15 caracteres.
<li><tt><i>interface</i></tt> - a interface de rede onde a fila é
    válida. Esse valor é opcional, e quando não especificado
    torna a fila válida em todas as interfaces.
<li><tt><i>larg_de_banda</i></tt> - a quantidade total de
    largura de banda disponível para a fila. Pode ser especificado como
    um valor absoluto ou usando sufixos <tt>b</tt>, <tt>Kb</tt>,
    <tt>Mb</tt> e <tt>Gb</tt> para representar bits, kilobits, megabits
    e gigabits por segundo, respectivamente, ou um valor em percentagem
    da largura de banda da fila pai. Esse parâmetro só é aplicável ao
    usar o agendador <tt>cbq</tt>. Se não for especificado, o padrão é
    100% da largura de banda da fila pai.
<li><tt><i>prio</i></tt> - a prioridade da fila. Para o <tt>cbq</tt>
    a faixa de prioridade varia de 0 a 7; e para <tt>priq</tt>
    a faixa vai de 0 a 15. A prioridade 0 é a mais baixa. Quando não
    especificada, o valor padrão de 1 é usado.
<li><tt><i>lim_da_fila</i></tt> - o número máximo de pacotes que
    podem ser armazenados na fila. Quando não for especificado, o padrão
    de 50 é usado.
<li><tt><i>agendador</i></tt> - o agendador utilizado, <tt>cbq</tt>
    ou <tt>priq</tt>. Deve ser o mesmo da fila raiz.
<li><tt><i>opções_do_agendador</i></tt> - outras opções podem ser
    passadas para controlar o comportamento do agendador:
	<ul>
	<li><tt>default</tt> - define uma fila padrão onde os pacotes
	    que não corresponderam a nenhuma outra fila serão
            enfileirados. Exatamente uma fila padrão é necessária.
	<li><tt>red</tt> - habilita a
            Detecção Antecipada Aleatória (RED) na fila.
	<li><tt>rio</tt> - habilita RED com "IN/OUT". Nesse modo, RED
	    mantém múltiplos comprimentos médios de fila e múltiplos
	    valores de comparação, um para cada nível de
	    Qualidade de Serviço IP.
	<li><tt>ecn</tt> - habilita a
            Notificação de Congestionamento Explícita (ECN) na fila.
            <tt>Ecn</tt> implica <tt>red</tt>.
	<li><tt>borrow</tt> - a fila pode emprestar largura de banda de
            sua fila pai. Essa opção só pode ser utilizada com o
            agendador <tt>cbq</tt>.
	</ul>
<li><tt><i>lista_de_filas</i></tt> - uma lista de filas filhas a serem
    criadas dentro dessa fila. Uma <tt><i>lista_de_filas</i></tt> pode
    ser definida apenas quando o agendador utilizado for o <tt>cbq</tt>.
</ul>

<p>
Continuando o exemplo acima:
<blockquote>
<tt>
queue std bandwidth 50% cbq(default)<br>
queue ssh bandwidth 25% { ssh_login, ssh_bulk }<br>
&nbsp;&nbsp;queue ssh_login bandwidth 25% priority 4 cbq(ecn)<br>
&nbsp;&nbsp;queue ssh_bulk  bandwidth 75% cbq(ecn)<br>
queue ftp bandwidth 500Kb priority 3 cbq(borrow red)<br>
</tt>
</blockquote>

<p>
Aqui os parâmetros das filas filhas, previamente definidas, são
configurados.
A fila <tt>std</tt> possui largura de banda de 50% da largura de banda
da fila raiz (ou 1Mbps) e está configurada como a fila padrão.
A fila <tt>ssh</tt> possui 25% da largura de banda da fila raiz (500kb)
e também contém duas filas filhas,
<tt>ssh_login</tt> e <tt>ssh_bulk</tt>.
A fila <tt>ssh_login</tt> tem prioridade maior que a <tt>ssh_bulk</tt>,
e ambas tem ECN habilitado.
A largura de banda atribuída à fila <tt>ftp</tt> é de 500Kbps, com a
prioridade 3. Ela também pode tomar largura de banda emprestada quando
estiver disponível, e também tem RED habilitado.

<p>
<b>NOTA:</b> Cada definição de fila filha tem sua largura de banda
especificada.
Sem especificar a largura de banda, o PF dá à fila 100% da
largura de banda da fila pai.
Nessa situação, que causaria um erro quando as regras fossem carregadas,
pois se já existe uma fila com 100% da largura de banda, nenhuma outra
fila pode ser definida nesse nível, já que não existe largura de banda
livre para ser alocada.

<a name="assign"></a>
<h3>Atribuição de Tráfego a uma Fila</h3>
<p>
Para atribuir tráfego a uma fila, a palavra-chave <tt>queue</tt> é usada
em conjunto com as <a href="filter.html">regras de filtragem</a> do PF.
Por exemplo, considere um conjunto de regras de filtragem contendo uma
linha como:
<blockquote>
<tt>pass out on fxp0 proto tcp to port 22</tt>
</blockquote>

<p>
Pacotes que corresponderam àquela regra podem ser atribuídos a uma fila
específica através do uso da palavra-chave <tt>queue</tt>:
<blockquote>
<tt>pass out on fxp0 proto tcp to port 22 queue ssh</tt>
</blockquote>

<p>
Quando uma entrada na tabela de estados é criada por esta regra, o PF irá registrar 
a fila pertencente a esta entrada da tabela de estados; isso será 
utilizado por outros pacotes permitidos pela seguinte entrada:
<blockquote>
<tt>pass in on fxp0 proto tcp to port 80 queue http</tt>
</blockquote>
Com essa regra, pacotes pertencentes a conexões stateful e trafegando 
de volta por <tt>fxp0</tt> que  vão acabar na fila <tt>http</tt>.
Percebe-se, então, que mesmo que a <tt>queue</tt> esteja sendo utilizada
em uma regra de filtragem de tráfego de entrada, o objetivo é 
especificar uma fila para o tráfego de saída correspondente; a regra 
acima não adiciona pacotes de entrada a uma fila.

<p>
Ao usar a palavra-chave <tt>queue</tt> com diretivas <tt>block</tt>,
quaisquer pacotes TCP RST ou ICMP de Inalcançável resultantes serão
atribuídos à fila especificada.

<p>
Note que as designações de filas podem ocorrer em uma
interface diferente da definida na diretiva <tt>altq on</tt>:
<blockquote>
<tt>
altq on fxp0 cbq bandwidth 2Mb queue { std, ftp }<br>
queue std bandwidth 500Kb cbq(default)<br>
queue ftp bandwidth 1.5Mb<br>
<br>
pass in on dc0 proto tcp to port 21 queue ftp<br>
</tt>
</blockquote>

<p>
O enfileiramento está habilitado em <tt>fxp0</tt>, mas a designação
acontece em <tt>dc0</tt>.
Se os pacotes que correspondem à regra <tt>pass</tt> (ou ao estado 
correspondente a esta regra) sairem pela interface <tt>fxp0</tt>, 
eles serão enfileirados na fila <tt>ftp</tt>.
Esse tipo de enfileiramento pode ser muito útil em roteadores.

<p>
Normalmente apenas um nome de fila é informado com a palavra-chave
<tt>queue</tt>, mas caso um segundo nome seja especificado, a fila será
usada para pacotes com um
<a href="http://www.rfc-editor.org/rfc/rfc791.txt">Tipo de Serviço</a>
(ToS - "Type of Service") de baixo atraso e para pacotes TCP ACK sem
carga útil de dados.
Um bom exemplo disso é encontrado ao utilizar o SSH. Inícios de sessão
SSH definem o ToS para baixo atraso enquanto que sessões SCP e SFTP
não. O PF pode usar essas informações para enfileirar pacotes
pertencentes a uma conexão de início de sessão em uma fila diferente dos
pacotes que não forem de conexões de início de sessão.
Isso pode ser útil para priorizar os pacotes das
conexões de início de sessão sobre pacotes de transferência de arquivos.
<blockquote>
<tt>pass out on fxp0 from any to any port 22 queue(ssh_bulk, ssh_login)</tt>
</blockquote>

<p>
Isso atribui pacotes pertencentes à conexões de início de sessão SSH
para a fila <tt>ssh_login</tt>, e pacotes pertencentes à conexões SCP e
SFTP para a fila <tt>ssh_bulk</tt>. Conexões de início de sessão SSH
terão seus pacotes processados antes dos pacotes SCP e SFTP porque a
fila <tt>ssh_login</tt> tem uma prioridade maior.

<p>
Atribuir pacotes TCP ACK a uma fila de alta prioridade é útil em
conexões assimétricas, isto é, conexões que possuem taxas de upload e
download diferentes, como conexões ADSL, por exemplo. Em uma conexão
ADSL, se o canal de upload estiver sendo utilizado em sua capacidade
máxima e um download é iniciado, o download sofre porque os
pacotes TCP ACK que devem ser enviados entram em um congestionamento
quando tentam passar pelo canal de upload. Testes têm mostrado que para
atingir os melhores resultados a largura de banda na fila de upload
deve ser configurada para um valor menor do que a conexão realmente é
capaz. Por exemplo, se uma conexão ADSL tem uma taxa máxima de upload
de 640Kbps, configurar a <tt>bandwidth</tt> (largura de banda) da
fila raiz para um valor como 600Kb deve resultar em uma melhora de
desempenho. Tentativas e erros mostram a melhor configuração de
<tt>bandwidth</tt>.

<a name="example1"></a>
<h2>Exemplo 1: Rede Pequena, doméstica</h2>
<pre>

    [ Alice ]    [ Charlie ]
        |             |                              ADSL
     ---+-----+-------+------ dc0 [ OpenBSD ] fxp0 -------- ( Internet )
              |
           [ Bob ]

</pre>

<p>
Nesse exemplo o OpenBSD está sendo usado em um gateway de Internet para
uma pequena rede doméstica com três estações de trabalho. O gateway faz
filtragem de pacotes e NAT. A conexão com a Internet é via linha ADSL
funcionando a 2Mbps de download e 640Kbps de upload.

<p>
A política de enfileiramento para essa rede:
<ul>
<li>Reservar 80Kbps de largura de banda de download para Bob, para
    que ele possa jogar online sem sofrer latência por causa dos
    downloads de Alice ou Charlie. Permitir a Bob usar mais de 80Kbps
    quando houver disponibilidade.
<li>Tráfego de SSH interativo e mensagem instantânea terão maior
    prioridade do que o tráfego comum.
<li>Consultas e respostas DNS terão a segunda maior prioridade.
<li>Pacotes TCP ACK saindo terão maior prioridade que qualquer
    outro tráfego de saída.
</ul>

<p>
Abaixo o conjunto de regras adequado à política da rede. Perceba
que somente diretivas <tt>pf.conf</tt> que se aplicam diretamente à
política descrita acima estão presentes.

<p>
<table border="0" width="650">
<tr><td nowrap bgcolor="#EEEEEE">
<pre>
# Habilita o enfileiramento na interface externa para controlar o
# tráfego indo para Internet. Usa o agendador priq para controlar
# somente as prioridades. Define a largura de banda como 610Kbps para
# obter o melhor desempenho da fila TCP ACK.

altq on fxp0 priq bandwidth 610Kb queue { std_out, ssh_im_out, dns_out, \
	tcp_ack_out }

# Define os parâmetros para as filas filhas.
# std_out      - a fila padrão. Qualquer regra de filtragem abaixo que
#                não especifique explicitamente uma fila terá seu
#		 tráfego adicionado a essa fila.
# ssh_im_out   - SSH interativo e tráfego de várias mensagens
#                instantâneas.
# dns_out      - pesquisas DNS.
# tcp_ack_out  - pacotes TCP ACK sem carga útil de dados.

queue std_out     priq(default)
queue ssh_im_out  priority 4 priq(red)
queue dns_out     priority 5
queue tcp_ack_out priority 6

# Habilita o enfileiramento na interface interna para controlar o tráfego
# vindo da Internet. Usa o agendador cbq para controlar a largura de banda.
# A largura de banda máxima é 2Mbps.

altq on dc0 cbq bandwidth 2Mb queue { std_in, ssh_im_in, dns_in, bob_in }

# Define os parâmetros para as filas filhas.
# std_in      - a fila padrão. Qualquer regra de filtragem abaixo que
#		não especifique explicitamente uma fila terá seu
#		tráfego adicionado a essa fila.
# ssh_im_in   - SSH interativo e tráfego de várias mensagens
#               instantâneas.
# dns_in      - respostas DNS.
# bob_in      - largura de banda reservada para a estação de trabalho de
#		Bob. Permitir a ele emprestar banda dos outros.

queue std_in    bandwidth 1.6Mb cbq(default)
queue ssh_im_in bandwidth 200Kb priority 4
queue dns_in    bandwidth 120Kb priority 5
queue bob_in    bandwidth 80Kb cbq(borrow)


# ... Na seção de filtragem do pf.conf ...

alice         = "192.168.0.2"
bob           = "192.168.0.3"
charlie       = "192.168.0.4"
local_net     = "192.168.0.0/24"
ssh_ports     = "{ 22 2022 }"
im_ports      = "{ 1863 5190 5222 }"

# Regras de filtragem para o tráfego de entrada em fxp0
block in on fxp0 all

# Regras de filtragem para o tráfego de saída em fxp0
block out on fxp0 all
pass  out on fxp0 inet proto tcp from (fxp0) queue(std_out, tcp_ack_out)
pass  out on fxp0 inet proto { udp icmp } from (fxp0)
pass  out on fxp0 inet proto { tcp udp } from (fxp0) to port domain \
	queue dns_out
pass  out on fxp0 inet proto tcp from (fxp0) to port $ssh_ports \
	queue(std_out, ssh_im_out)
pass  out on fxp0 inet proto tcp from (fxp0) to port $im_ports \
	queue(ssh_im_out, tcp_ack_out)

# Regras de filtragem para o tráfego de entrada em dc0
block in on dc0 all
pass  in on dc0 from $local_net

# Regras de filtragem para o tráfego de saída em dc0
block out on dc0 all
pass  out on dc0 to $local_net
pass  out on dc0 proto { tcp udp } from port domain to $local_net \
 	queue dns_in
pass  out on dc0 proto tcp from port $ssh_ports to $local_net \
 	queue(std_in, ssh_im_in)
pass  out on dc0 proto tcp from port $im_ports to $local_net \
 	queue ssh_im_in
pass  out on dc0 to $bob queue bob_in
</pre>
</td></tr>
</table>

<a name="example2"></a>
<h2>Exemplo 2: Rede Empresarial</h2>
<pre>

  ( Dep. de TI ) [ PC do Chefe ]
       |           |                                  T1
     --+----+------+--------- dc0 [ OpenBSD ] fxp0 -------- ( Internet )
            |                         fxp1
         [ COMP1 ]    [ WWW ]         /
                         |           /
                       --+----------'

</pre>

<p>
Nesse exemplo a máquina OpenBSD funciona como firewall para a rede
de uma empresa. A empresa roda um servidor WWW na porção DMZ de sua
rede, onde os clientes fazem upload de seus sítios Web via FTP. O
departamento de TI possui sua própria sub-rede conectada na rede
principal, e o chefe tem um PC em sua mesa que é usado para acessar o
correio eletrônico e navegar na Internet. A conexão com a Internet é
via linha T1 funcionando a 1.5Mbps em ambas as direções.
Todos os outros segmentos de rede utilizam Fast Ethernet (100Mbps).

<p>
O administrador da rede decidiu pela seguinte política:
<ul>
<li>Limitar todo o tráfego entre o servidor WWW e a Internet para
    500Kbps em ambas as direções.
       <ul>
       <li>Distribuir 250Kbps para tráfego HTTP.
       <li>Distribuir 250Kbps para "outro tipo" de tráfego (ou seja,
	   tráfego não-HTTP).
       <li>Permitir a qualquer fila emprestar totalmente os 500Kbps.
       <li>Dar alta prioridade ao tráfego entre o servidor WWW
	   e a Internet do que outro tráfego entre o servidor WWW
	   e a Internet (como uploads FTP).
       </ul>
<li>O tráfego entre o servidor WWW e a rede interna pode usar
    totalmente os 100Mbps que a rede oferece.
<li>Reservar 500Kbps para a rede do Departamento de TI para que eles
    possam baixar as últimas atualizações de software em tempo hábil.
    Eles devem ser capazes de utilizar mais do que 500Kbps caso haja
    disponibilidade.
<li>Dar alta prioridade ao tráfego entre o PC do chefe e a
    Internet do que outro tráfego indo à/vindo da Internet.
</ul>

<p>
Abaixo o conjunto de regras adequado à política da rede. Perceba
que somente diretivas <tt>pf.conf</tt> que se aplicam diretamente à
política descrita acima estão presentes;
<a href="nat.html"><tt>nat</tt></a>,
<a href="rdr.html"><tt>rdr</tt></a>, <a href="options.html">opções</a>,
etc., não são mostradas.

<p>
<table border="0" width="650">
<tr><td nowrap bgcolor="#EEEEEE">
<pre>
# Habilita o enfileiramento na interface externa para enfileirar pacotes
# saindo para a Internet. Usa o agendador cbq de modo que o uso da
# largura de banda por cada fila possa ser controlado.
# A largura de banda máxima para tráfego de saída é de 1.5Mbps.

altq on fxp0 cbq bandwidth 1.5Mb queue { std_ext, www_ext, boss_ext }

# Define os parâmetros para as filas filhas.
# std_ext        - a fila padrão. Também é a fila padrão para o tráfego
#                  de saída em fxp0.
# www_ext        - fila contêiner para as filas do servidor WWW.
#                  Limitada a 500Kbps.
#   www_ext_http - tráfego http do servidor WWW; alta prioridade.
#   www_ext_misc - todo o tráfego diferente de http do servidor WWW.
# boss_ext       - tráfego vindo do computador do chefe.


queue std_ext        bandwidth 500Kb cbq(default borrow)
queue www_ext        bandwidth 500Kb { www_ext_http, www_ext_misc }
  queue www_ext_http bandwidth 50% priority 3 cbq(red borrow)
  queue www_ext_misc bandwidth 50% priority 1 cbq(borrow)
queue boss_ext       bandwidth 500Kb priority 3 cbq(borrow)

# Habilita o enfileiramento na interface interna para controlar o
# tráfego vindo da internet ou DMZ. Usa o agendador cbq para controlar a
# largura de banda de cada fila. Esta interface está configurada para a
# largura máxima de banda. Tráfego vindo da DMZ pode usar toda a
# largura de banda, enquanto tráfego vindo da Internet é limitado a
# 1.0Mbps (porque 0.5Mbps (500Kbps) está alocado para fxp1).

altq on dc0 cbq bandwidth 100% queue { net_int, www_int }

# Define os parâmetros para as filas filhas.
# net_int    - fila contêiner para o tráfego da Internet.
#              Largura de banda de 1.0Mbps.
#   std_int  - a fila padrão. Também é a fila padrão para o tráfego
#              de saída em dc0.
#   it_int   - tráfego para a rede do departamento de TI; reserva
#              a eles 500Kbps.
#   boss_int - tráfego para o PC do chefe, designa alta prioridade.
# www_int    - tráfego do servidor WWW na DMZ; velocidade máxima.

queue net_int    bandwidth 1.0Mb { std_int, it_int, boss_int }
  queue std_int  bandwidth 250Kb cbq(default borrow)
  queue it_int   bandwidth 500Kb cbq(borrow)
  queue boss_int bandwidth 250Kb priority 3 cbq(borrow)
queue www_int    bandwidth 99Mb cbq(red borrow)

# Habilita o enfileiramento na interface da DMZ para controlar o tráfego
# destinado ao servidor WWW. cbq será utilizado nesta interface já que
# o controle preciso se faz necessário. A largura de banda nesta
# interface está configurada para o máximo. O tráfego da rede interna
# é capaz de utilizar toda a largura de banda, enquanto o tráfego da
# Internet é limitado a 500Kbps.

altq on fxp1 cbq bandwidth 100% queue { internal_dmz, net_dmz }

# Define os parâmetros para as filas filhas.
# internal_dmz   - tráfego da rede interna.
# net_dmz        - fila contêiner para o tráfego da Internet.
#   net_dmz_http - tráfego http; alta prioridade.
#   net_dmz_misc - todo tráfego não-http. Essa também é a fila padrão.

queue internal_dmz   bandwidth 99Mb cbq(borrow)
queue net_dmz        bandwidth 500Kb { net_dmz_http, net_dmz_misc }
  queue net_dmz_http bandwidth 50% priority 3 cbq(red borrow)
  queue net_dmz_misc bandwidth 50% priority 1 cbq(default borrow)


# ... Na seção de filtragem do pf.conf ...

main_net  = "192.168.0.0/24"
it_net    = "192.168.1.0/24"
int_nets  = "{ 192.168.0.0/24, 192.168.1.0/24 }"
dmz_net   = "10.0.0.0/24"

boss      = "192.168.0.200"
wwwserv   = "10.0.0.100"

# Negar por padrão
block on { fxp0, fxp1, dc0 } all

# Regras de filtragem para o tráfego de entrada em fxp0
pass in on fxp0 proto tcp from any to $wwwserv port { 21, \
	&gt; 49151 } queue www_ext_misc
pass in on fxp0 proto tcp from any to $wwwserv port 80 queue www_ext_http

# Regras de filtragem para o tráfego de saída em fxp0
pass out on fxp0 from $int_nets
pass out on fxp0 from $boss queue boss_ext

# Regras de filtragem para o tráfego de entrada em dc0
pass in on dc0 from $int_nets
pass in on dc0 from $it_net queue it_int
pass in on dc0 from $boss queue boss_int
pass in on dc0 proto tcp from $int_nets to $wwwserv port { 21, 80, \
	&gt; 49151 } queue www_int

# Regras de filtragem para o tráfego de saída em dc0
pass out on dc0 from dc0 to $int_nets

# Regras de filtragem para o tráfego de entrada em fxp1
pass in on fxp1 proto { tcp, udp } from $wwwserv to port 53

# Regras de filtragem para o tráfego de saída em fxp1
pass out on fxp1 proto tcp to $wwwserv port { 21, \
	&gt; 49151 } queue net_dmz_misc
pass out on fxp1 proto tcp to $wwwserv port 80 queue net_dmz_http
pass out on fxp1 proto tcp from $int_nets to $wwwserv port { 80, \
	21, &gt; 49151 } queue internal_dmz</pre>
</td></tr>
</table>

<p>
[<a href="anchors.html">Anterior: Âncoras</a>]
[<a href="index.html">Conteúdo</a>]
[<a href="pools.html">Próximo: Grupos de Endereços e Balanceamento de Carga</a>]

<p>
<hr>
<a href="index.html"><img height="24" width="24" src="../../../images/back.gif" border="0" alt="[voltar]"></a>
<a href="mailto:www@@openbsd.org">www@@openbsd.org</a>
<br>
<small>
<!--
Originally [OpenBSD: queueing.html,v 1.46 ]<br>
$Translation: queueing.html,v 1.18 2013/12/01 12:44:33 egypcio Exp $<br>
-->
$OpenBSD: queueing.html,v 1.18 2013/12/06 20:52:46 ajacoutot Exp $
</small>

</body>
</html>
@


1.18
log
@Sync with Steelix CVS
@
text
@d939 1
a939 1
$OpenBSD$
@


1.17
log
@Sync with Steelix CVS
@
text
@d375 1
a375 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&amp;sektion=5&amp;manpath=OpenBSD+5.3"
d936 2
a937 2
Originally [OpenBSD: queueing.html,v 1.45 ]<br>
$Translation: queueing.html,v 1.17 2013/05/02 22:48:46 renato Exp $<br>
@


1.16
log
@Sync with Steelix CVS
@
text
@d375 1
a375 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&amp;sektion=5&amp;manpath=OpenBSD+5.2"
d936 2
a937 2
Originally [OpenBSD: queueing.html,v 1.44 ]<br>
$Translation: queueing.html,v 1.16 2013/01/13 20:11:22 egypcio Exp $<br>
@


1.15
log
@Sync with Steelix CVS
@
text
@d544 13
a556 1

d572 1
a572 1
pass in on dc0 from any to any port 21 queue ftp<br>
d579 3
a581 2
Se os pacotes que correspondem à regra <tt>pass</tt> sairem pela
interface <tt>fxp0</tt>, eles serão enfileirados na fila <tt>ftp</tt>.
a624 19
<p>
Ao utilizar a palavra-chave <tt>queue</tt> com regras
<tt>keep state</tt> (que mantêm o estado), como:
<blockquote>
<tt>
pass in on fxp0 proto tcp from any to any port 22 flags S/SA \<br>
&nbsp;&nbsp;&nbsp;keep state queue ssh
</tt>
</blockquote>

<p>
O PF grava uma entrada para a fila na tabela de estados, de forma que
pacotes saindo pela <tt>fxp0</tt> que correspondam à conexão "stateful"
serão enviados para a fila <tt>ssh</tt>. Perceba que apesar da
palavra-chave <tt>queue</tt> estar sendo utilizada em uma regra
que está filtrando tráfego de entrada, o objetivo é especificar uma
fila para o tráfego de saída correspondente; a regra acima não enfileira
pacotes que estão chegando.

d660 1
a660 4
política descrita acima estão presentes;
<a href="nat.html"><tt>nat</tt></a>,
<a href="rdr.html"><tt>rdr</tt></a>, <a href="options.html">opções</a>,
etc., não são mostradas.
d724 8
a731 9
pass  out on fxp0 inet proto tcp from (fxp0) to any flags S/SA \
	keep state queue(std_out, tcp_ack_out)
pass  out on fxp0 inet proto { udp icmp } from (fxp0) to any keep state
pass  out on fxp0 inet proto { tcp udp } from (fxp0) to any port domain \
	keep state queue dns_out
pass  out on fxp0 inet proto tcp from (fxp0) to any port $ssh_ports \
	flags S/SA keep state queue(std_out, ssh_im_out)
pass  out on fxp0 inet proto tcp from (fxp0) to any port $im_ports \
	flags S/SA keep state queue(ssh_im_out, tcp_ack_out)
d739 8
a746 8
pass  out on dc0 from any to $local_net
pass  out on dc0 proto { tcp udp } from any port domain to $local_net \
	queue dns_in
pass  out on dc0 proto tcp from any port $ssh_ports to $local_net \
	queue(std_in, ssh_im_in)
pass  out on dc0 proto tcp from any port $im_ports to $local_net \
	queue ssh_im_in
pass  out on dc0 from any to $bob queue bob_in
d895 2
a896 3
	&gt; 49151 } flags S/SA keep state queue www_ext_misc
pass in on fxp0 proto tcp from any to $wwwserv port 80 \
	flags S/SA keep state queue www_ext_http
d899 2
a900 2
pass out on fxp0 from $int_nets to any keep state
pass out on fxp0 from $boss to any keep state queue boss_ext
d903 3
a905 3
pass in on dc0 from $int_nets to any keep state
pass in on dc0 from $it_net to any queue it_int
pass in on dc0 from $boss to any queue boss_int
d907 1
a907 1
	&gt; 49151 } flags S/SA keep state queue www_int
d913 1
a913 2
pass in on fxp1 proto { tcp, udp } from $wwwserv to any port 53 \
	keep state
d916 3
a918 4
pass out on fxp1 proto tcp from any to $wwwserv port { 21, \
	&gt; 49151 } flags S/SA keep state queue net_dmz_misc
pass out on fxp1 proto tcp from any to $wwwserv port 80 \
	flags S/SA keep state queue net_dmz_http
d920 1
a920 2
	21, &gt; 49151 } flags S/SA keep state queue internal_dmz
</pre>
d936 2
a937 2
Originally [OpenBSD: queueing.html,v 1.38 ]<br>
$Translation: queueing.html,v 1.15 2012/12/18 16:37:29 renato Exp $<br>
@


1.14
log
@Sync with Steelix CVS
@
text
@d375 1
a375 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&amp;sektion=5&amp;manpath=OpenBSD+4.6"
d534 1
a534 1
<tt>pass out on fxp0 from any to any port 22</tt>
d541 1
a541 1
<tt>pass out on fxp0 from any to any port 22 queue ssh</tt>
d544 2
d951 1
a951 1
$Translation: queueing.html,v 1.14 2009/10/18 16:52:52 alan Exp $<br>
@


1.13
log
@Sync with Steelix CVS
@
text
@d105 1
a105 1
"Primeiro a entrar, Primeiro a Sair" (FIFO, "First In First Out").
d121 1
a121 1
O Enfileiramento Baseado em Classe (CBQ, "Class Based Queueing") é um
d247 1
a247 1
No Enfileiramento por Prioridade (PRIQ, "Priority Queueing") várias
d275 1
a275 2
são processados através do método "Primeiro a entrar, Primeiro a Sair"
(FIFO, "First In First Out").
d287 1
a287 1
Detecção Antecipada Aleatória (RED, "Random Early Detection") é um
d344 1
a344 1
(ECN, "Explicit Congestion Notification") trabalha em conjunto com RED
d375 1
a375 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&amp;sektion=5&amp;manpath=OpenBSD+4.5"
d574 1
a574 1
(ToS, "Type of Service") de baixo atraso e para pacotes TCP ACK sem
d948 2
a949 2
Originally [OpenBSD: queueing.html,v 1.37 ]<br>
$Translation: queueing.html,v 1.13 2009/10/13 19:12:28 alan Exp $<br>
@


1.12
log
@Sync with Steelix CVS
@
text
@d4 1
a4 1
<title>PF: Fila de Pacotes e Priorização</title>
d43 1
a43 1
<h1><font color="#e00000">PF: Fila de Pacotes e Priorização</font></h1>
d51 1
a51 1
<li><a href="#sched">Organizadores</a>
d53 4
a56 4
	<li><a href="#cbq">Filas Baseadas em Classe</a>
	<li><a href="#priq">Fila de Prioridade</a>
	<li><a href="#red">Random Early Detection</a>
	<li><a href="#ecn">Explicit Congestion Notification</a>
d58 4
a61 4
<li><a href="#altq">Configurando Filas</a>
<li><a href="#assign">Atribuindo Tráfego a uma Fila</a>
<li><a href="#example1">Exemplo #1: Rede Pequena, doméstica</a>
<li><a href="#example2">Exemplo #2: Rede Empresarial</a>
d70 2
a71 2
enquanto aguarda processamento. Numa rede de computadores, quando
pacotes de dados são enviados por um host, eles entram numa fila
d73 4
a76 4
operacional decide qual fila e quais pacotes nessa fila devem ser
processados. A ordem em que o sistema operacional escolhe os
pacotes a processar pode afetar o desempenho da rede. Por exemplo,
imagine um usuário executando duas aplicações de rede:
d79 1
a79 1
quando uma tecla é acionada num cliente SSH, uma resposta imediata é
d81 1
a81 1
extra, muito dificilmente será percebida. Mas o que acontece se o
d86 3
a88 3
para manter todos os pacotes) e a sessão SSH parecerá muito lenta
e com atrasos. Modificando a estratégia de enfileiramento utilizada,
a largura de banda pode ser compartilhada entre diferentes aplicações,
d92 8
a99 7
Perceba que o enfileiramento é útil somente para pacotes <i>saindo</i>.
Quando o pacote chega entrando numa interface, já é tarde demais para
ser enfileirado -- ele já consumiu largura de banda ao chegar na
interface que o recebeu. A única solução é habilitar enfileiramento
no roteador adjacente ou, se o host que recebeu o pacote está
funcionando como roteador, habilitar enfileiramento na interface
interna onde os pacotes saem do mesmo.
d102 4
a105 4
<h2>Organizadores</h2>
O organizador ("scheduler") é que decide quais filas processar e em que
ordem. Por padrão o OpenBSD usa um organizador FIFO
("First In First Out").
d109 2
a110 2
a analogia com o supermercado termina, novos pacotes vão sendo
descartados. Isso é conhecido como tail-drop.
d113 1
a113 1
OpenBSD suporta mais dois organizadores:
d115 2
a116 2
<li>Filas Baseadas em Classe
<li>Fila de Prioridade
d120 10
a129 10
<h3>Filas Baseadas em Classe</h3>
Filas Baseadas em Classe ou "Class Based Queuing" (CBQ) é um algoritmo
de enfileiramento que divide a largura de banda entre múltiplas filas
ou classes. Cada fila tem seu tráfego atribuído com base em endereço
de origem ou destino, número de porta, protocolo, etc. Uma fila pode
opcionalmente ser configurada para emprestar banda de sua fila pai,
caso ela não esteja utilizando sua largura total. As filas também
recebem uma prioridade de forma que as que contém tráfego interativo
como SSH, podem ter seus pacotes processados antes de filas contendo
tráfego normal, como FTP.
d133 3
a135 2
está a fila raiz que define a quantidade total de banda disponível.
As outras filas são criadas sob a fila raiz, cada uma delas pode
d137 1
a137 1
podem ser definidas assim:
d139 1
a139 1
<dd>Root Queue (2Mbps)
d141 3
a143 3
	<dd>Queue A (1Mbps)
	<dd>Queue B (500Kbps)
	<dd>Queue C (500Kbps)
d148 3
a150 3
Nesse caso, a largura de banda total disponível está definida para
2 megabits por segundo (Mbps). Essa banda é então dividida entre
outras três filas.
d154 4
a157 3
Para dividir a banda igualmente entre diferentes usuários e ainda
classificar seu tráfego de forma que certos protocolos não ocupem
a banda de outros, uma estrutura parecida com esta pode ser definida:
d159 1
a159 1
<dd>Root Queue (2Mbps)
d161 1
a161 1
	<dd>UserA (1Mbps)
d164 1
a164 1
		<dd>bulk (950Kbps)
d166 1
a166 1
	<dd>UserB (1Mbps)
d168 2
a169 2
		<dd>audio (250Kbps)
		<dd>bulk (750Kbps)
d172 1
a172 1
			<dd>other (650Kbps)
d179 2
a180 2
Perceba que a cada nível a soma do total de banda vinculado a cada fila
nunca é maior que o valor da banda da fila raiz.
d183 4
a186 3
Uma fila pode ser configurada para emprestar banda de sua fila pai
caso as outras filas dentro da fila pai não estejam usando sua porção
e a banda esteja disponível. Considere a configuração a seguir:
d188 1
a188 1
<dd>Root Queue (2Mbps)
d190 1
a190 1
	<dd>UserA (1Mbps)
d193 1
a193 1
		<dd>ftp (900Kbps, borrow)
d195 1
a195 1
	<dd>UserB (1Mbps)
d201 6
a206 5
<tt>UserA</tt> for menor que 1Mbps (porque a fila <tt>ssh</tt> está
usando menos que 100Kbps), a fila <tt>ftp</tt> irá emprestar banda de
<tt>UserA</tt>. Dessa forma a fila <tt>ftp</tt> pode usar mais banda do
que foi definido a princípio quando necessário. Quando o tráfego na fila
<tt>ssh</tt> aumenta, a banda emprestada é devolvida.
d210 5
a214 4
alta tem preferência sobre outras com menor prioridade em caso de
congestionamento, contanto que estejam contidas na mesma fila pai (em
outras palavras, contanto que estejam no mesmo nível na hierarquia).
Filas com a mesma prioridade são processadas em sequência (round-robin).
d217 1
a217 1
<dd>Root Queue (2Mbps)
d219 1
a219 1
	<dd>UserA (1Mbps, priority 1)
d221 2
a222 2
		<dd>ssh (100Kbps, priority 5)
		<dd>ftp (900Kbps, priority 3)
d224 1
a224 1
	<dd>UserB (1Mbps, priority 1)
d229 6
a234 5
O CBQ irá processar as filas <tt>UserA</tt> e <tt>UserB</tt>
em sequência -- nenhuma fila será preferida sobre a outra. Enquanto a
fila <tt>UserA</tt> está sendo processada, o CBQ também irá processar
suas subfilas. Nesse caso, a fila <tt>ssh</tt> tem prioridade maior e
terá tratamento preferencial sobre a fila <tt>ftp</tt> caso a rede
d236 2
a237 2
não têm suas prioridades comparadas às filas <tt>UserA</tt> e
<tt>UserB</tt> pelo fato de elas não estarem no mesmo nível na
d242 1
a242 1
favor consulte
d246 8
a253 7
<h3>Fila de Prioridade</h3>
Fila de Prioridade ou "Priority Queuing" (PRIQ) designa várias filas
numa interface de rede com cada uma tendo um único nível de prioridade.
Uma fila com alta prioridade é <i>sempre</i> processada na frente
de uma fila com prioridade menor.
Se duas ou mais filas estiverem atribuídas à mesma prioridade, então
essas filas serão processadas de modo round-robin.
d256 1
a256 1
A estrutura de enfileiramento no PRIQ é simples -- você não pode
d258 1
a258 1
configurado o total de banda disponível, então subfilas são
d261 1
a261 1
<dd>Root Queue (2Mbps)
d263 3
a265 3
	<dd>Queue A (priority 1)
	<dd>Queue B (priority 2)
	<dd>Queue C (priority 3)
d270 1
a270 1
A fila raiz é definida possuindo 2Mbps de largura de banda disponível
d272 1
a272 1
número na prioridade) é servida primeiro. Quando todos os pacotes nessa
d274 3
a276 2
próxima fila com prioridade mais alta. Dentro da fila, os pacotes são
processados num sistema FIFO (First In First Out).
d279 1
a279 1
É importante notar quando estiver usando PRIQ que você deve planejar
d281 1
a281 1
com prioridade mais alta primeiro, é possível que uma fila com alta
d284 1
a284 1
esteja recebendo pacotes constantemente.
d287 18
a304 15
<h3>Random Early Detection</h3>
"Random Early Detection" (RED) é um algoritmo para evitar
congestionamento. Seu trabalho é evitar congestionamento na rede
certificando-se de que a fila nunca fique cheia. Ele realiza a tarefa
calculando continuamente o tamanho médio da fila e comparando-a com
dois valores, um valor mínimo e um valor máximo. Se o tamanho médio
da fila estiver abaixo do valor mínimo, então nenhum pacote será
descartado. Se a média estiver acima do valor máximo, então <i>todos</i>
os pacotes que chegarem serão descartados. Se a média estiver entre os
dois valores então os pacotes são descartados baseando-se no cálculo da
probabilidade obtido do tamanho médio da fila. Em outras palavras,
conforme o tamanho médio da fila se aproxima do valor máximo, mais
pacotes são descartados. Ao descartar pacotes, RED escolhe
aleatoriamente de quais conexões ele irá descartá-los.
Conexões usando grandes porções da largura de banda têm maior
d309 1
a309 1
global e pode acomodar aumentos repentinos no tráfego.
d312 5
a316 4
mesmo tempo. Por exemplo, caso o congestionamento ocorra num roteador
transmitindo tráfego para 10 conexões FTP e pacotes de todas (ou quase
todas) as conexões são descartados (como é o caso com enfileiramento
FIFO), a capacidade média de transferência cairá severamente.
d318 2
a319 2
reduzam sua taxa de transferência e também significa que a rede não é
mais utilizada em todo seu potencial.
d321 9
a329 8
pacotes descartados ao invés de escolher todas elas.
Conexões usando muita largura de banda tem chances maiores de terem seus
pacotes descartados. Dessa forma, conexões que ocupam muita banda serão
evitadas, o congestionamento será evitado, e sérias perdas nas taxas de
transferência não ocorrerão. Além disso, RED pode responder a aumentos
repentinos no tráfego pelo fato de começar a descartar pacotes
<i>antes</i> da fila ficar cheia. Quando o tráfego inesperado chegar,
existirá espaço suficiente na fila para armazenar os novos pacotes.
d335 1
a335 1
tráfego TCP e nunca tráfego UDP ou ICMP.
d339 1
a339 1
favor consulte
d343 4
a346 3
<h3>Explicit Congestion Notification</h3>
"Explicit Congestion Notification" (ECN) trabalha em conjunto com RED
para notificar dois hosts comunicando-se pela rede de quaisquer
d348 3
a350 3
insere um marcador (flag) no cabeçalho do pacote ao invés de
descartá-lo. Supondo que o host enviando dados tem suporte a ECN, ele
pode identificar essa marcação e reduzir seu tráfego de acordo.
d357 2
a358 2
<h2>Configurando Filas</h2>
Desde o OpenBSD 3.0, a implementação de filas
d360 13
a372 6
>Alternate Queueing (ALTQ)</a> se tornou parte do sistema base. Desde
o OpenBSD 3.3, ALTQ foi integrado ao PF.
A implementação ALTQ do OpenBSD suporta os organizadores
Class Based Queueing (CBQ) e Priority Queueing (PRIQ). Ele também
suporta Random Early Detection (RED) e Explicit Congestion
Notification (ECN).
d375 1
a375 6
Pelo fato de ALTQ ter sido integrado ao PF, o PF deve estar habilitado
para que o sistema funcione. Instruções de como habilitar o PF podem ser
encontradas em <a href="config.html#activate">Começando</a>.

<p>
Filas são configuradas no arquivo <tt>
d377 2
a378 2
>pf.conf</a></tt>. Existem dois tipos de diretivas utilizadas
para configuração de filas:
d380 3
a382 3
<li><tt>altq on</tt> - habilita enfileiramento na interface, define qual
    organizador (scheduler) usar e cria a fila raiz
<li><tt>queue</tt> - define as propriedades da subfila
d389 3
a391 3
altq on <i>interface scheduler</i> bandwidth <i>bw</i> qlimit
<i>qlim</i> \<br>
&nbsp;&nbsp;&nbsp;tbrsize <i>size</i> queue { <i>queue_list</i> }
d398 2
a399 2
<li><tt><i>scheduler</i></tt> - o organizador a ser utilizado. Valores
    possíveis são <tt>cbq</tt> e <tt>priq</tt>. Somente um organizador
d401 5
a405 10
<li><tt><i>bw</i></tt> - o valor total de banda disponível para o
    organizador. Isso pode ser especificado como um valor absoluto
    utilizando os sufixos <tt>b</tt>, <tt>Kb</tt>, <tt>Mb</tt>, e
    <tt>Gb</tt> para representar bits, kilobits, megabits, e gigabits
    por segundo, respectivamente, ou como uma porcentagem da banda na
    <tt><i>interface</i></tt>.
<li><tt><i>qlim</i></tt> - o número máximo de pacotes que podem ser
    armazenados na fila. Esse parâmetro é opcional. O padrão é 50.
<li><tt><i>size</i></tt> - o tamanho do regulador token bucket em bytes.
    Caso não seja especificado, o tamanho é definido baseando-se na
d407 8
a414 2
<li><tt><i>queue_list</i></tt> - uma lista de subfilas a serem criadas
    sob a fila raiz.
d424 3
a426 2
Isso habilitará o CBQ na interface <tt>fxp0</tt>. A largura de banda
total disponível é configurada para 2Mbps. Três subfilas são definidas:
d433 4
a436 4
queue <i>name</i> [on <i>interface</i>] bandwidth <i>bw</i> [priority
<i>pri</i>] [qlimit <i>qlim</i>] \<br>
&nbsp;&nbsp;&nbsp;<i>scheduler</i> ( <i>sched_options</i> )
{ <i>queue_list</i> }
d441 6
a446 6
<li><tt><i>name</i></tt> - o nome da fila. Esse nome deve ser um dos
    nomes de filas definidos na diretiva <tt>altq on</tt>
<tt><i>queue_list</i></tt>. Para o <tt>cbq</tt>, também pode ser
    nome de fila definido numa diretiva <tt><i>queue_list</i></tt>,
    numa <tt>queue</tt> anterior. Nomes de filas não devem ser mais
    longos que 15 caracteres.
d448 13
a460 13
    válida. Esse valor é opcional, e quando não especificado,
    tornará a fila válida em todas as interfaces.
<li><tt><i>bw</i></tt> - a quantidade total de banda disponível
    para a fila. Pode ser especificado como um valor absoluto ou usando
    sufixos <tt>b</tt>, <tt>Kb</tt>, <tt>Mb</tt>, e <tt>Gb</tt>,
    representando bits, kilobits, megabits, e gigabits por segundo,
    respectivamente, ou um valor em porcentagem da fila principal.
    Esse parâmetro só é aplicável quando usar o organizador
    <tt>cbq</tt>. Se não for especificado, o padrão é 100% da banda
    da fila pai.
<li><tt><i>pri</i></tt> - a prioridade da fila. Para o <tt>cbq</tt>,
    a faixa de prioridade varia de 0 a 7; e para <tt>priq</tt>,
    a faixa vai de 0 a 15. Prioridade 0 é a mais baixa. Quando não
d462 4
a465 4
<li><tt><i>qlim</i></tt> - o número máximo de pacotes que podem ser
    armazenados na fila. Quando não for especificado, o padrão 50 é
    usado.
<li><tt><i>scheduler</i></tt> - o organizador utilizado, <tt>cbq</tt>
d467 2
a468 2
<li><tt><i>sched_options</i></tt> - outras opções podem ser passadas
    para controlar o comportamento do organizador:
d471 6
a476 6
	    que não casarem com nenhuma outra fila serão armazenados.
	    Exatamente uma fila padrão é necessária.
	<li><tt>red</tt> - habilita Random Early Detection (RED) na
            fila.
	<li><tt>rio</tt> - habilita RED com IN/OUT. Nesse modo, RED
	    manterá múltiplos valores médios da fila e múltiplos
d479 6
a484 5
	<li><tt>ecn</tt> - habilita Explicit Congestion Notification
	    (ECN) na fila. <tt>Ecn</tt> implica <tt>red</tt>.
	<li><tt>borrow</tt> - a fila pode emprestar banda de sua fila
	    pai. Essa opção só pode ser utilizada com o organizador
            <tt>cbq</tt>.
d486 3
a488 3
<li><tt><i>queue_list</i></tt> - uma lista de subfilas a serem criadas
    dentro dessa fila. Uma <tt><i>queue_list</i></tt> pode ser definida
    apenas quando o organizador utilizado for <tt>cbq</tt>.
d504 1
a504 1
Aqui os parâmetros das subfilas, previamente definidas, são
d506 20
a525 16
A fila <tt>std</tt> possui largura de banda de 50% da fila raiz
(ou 1Mbps) e está configurada como a fila padrão. A fila <tt>ssh</tt>
possui 25% da banda da fila raiz (500kb) e também contém duas filas
<tt>ssh_login</tt> e <tt>ssh_bulk</tt>. A fila <tt>ssh_login</tt>
tem prioridade maior que <tt>ssh_bulk</tt> e ambas tem ECN habilitado.
A banda atribuída à fila <tt>ftp</tt> é de 500Kbps com prioridade 3. Ela
também pode tomar banda emprestada quando estiver disponível e também
tem RED habilitado.

<p>
<b>NOTA:</b> Cada definição de fila tem sua banda especificada.
Sem especificar a banda, o PF dará à fila 100% da banda da fila pai.
Nessa situação, que causará um erro quando as regras são carregadas,
já que existe uma fila com 100% da banda, nenhuma outra fila pode
ser definida nesse nível, já que não existe banda livre para
alocar.
d528 1
a528 1
<h3>Atribuindo Tráfego a uma Fila</h3>
d539 1
a539 1
Pacotes que casarem com essa regra podem ser enviados para uma fila
d546 3
a548 3
Ao usar a palavra <tt>queue</tt> com diretivas <tt>block</tt>, quaisquer
pacotes TCP RST ou ICMP Unreachable resultantes serão enviados à fila
especificada.
d551 2
a552 2
Note que as designações de filas podem ocorrer numa interface diferente
da definida na diretiva <tt>altq on</tt>:
d564 1
a564 1
Enfileiramento está habilitado em <tt>fxp0</tt>, mas a designação
d566 2
a567 2
Se os pacotes que casam com a regra <tt>pass</tt> sairem pela
interface <tt>fxp0</tt>, serão enfileirados na fila <tt>ftp</tt>.
d571 1
a571 1
Normalmente, apenas um nome de fila é informado com a palavra-chave
d574 10
a583 9
<a href="http://www.rfc-editor.org/rfc/rfc791.txt">Type of Service
(ToS)</a> com pouco atraso e para pacotes TCP ACK sem payload de dados.
Um bom exemplo disso pode ser obtido utilizando SSH. Sessões de login
SSH irão definir o ToS para low-delay enquanto que sessões SCP e SFTP
não.
O PF pode usar essas informações para enfileirar pacotes pertencentes a
uma conexão de login numa fila diferente dos pacotes que não forem de
conexões de login. Isso pode ser útil para priorizar os pacotes das
conexões de login sobre pacotes de transferênca de arquivos.
d589 5
a593 5
Isso envia pacotes pertencentes à conexões de login SSH para a fila
<tt>ssh_login</tt> e pacotes pertencentes à conexões SCP e SFTP
para a fila <tt>ssh_bulk</tt>. Conexões de login SSH terão seus pacotes
processados antes dos pacotes SCP e SFTP, porque a fila
<tt>ssh_login</tt> tem prioridade maior.
d598 12
a609 11
download diferentes, como conexões ADSL, por exemplo. Numa conexão ADSL,
se o canal de upload estiver sendo utilizado em sua capacidade máxima e
um download é iniciado, o download irá sofrer, porque os pacotes TCP ACK
que devem ser enviados entrarão num congestionamento quando tentarem
passar pelo canal de upload. Testes têm mostrado que para atingir os
melhores resultados, a largura de banda na fila de upload deve ser
configurada para um valor menor do que a conexão realmente é capaz.
Por exemplo, se uma conexão ADSL tem uma taxa máxima de upload de
640Kbps, configurar a <tt>bandwidth</tt> da fila raiz para um valor
como 600Kb deve resultar numa melhora de desempenho. Tentativas e
erros mostrarão a melhor configuração de <tt>bandwidth</tt>.
d612 2
a613 2
Ao utilizar a palavra-chave <tt>queue</tt> com regras que <tt>mantém o
estado (keep state)</tt>, como:
d622 2
a623 2
O PF gravará uma entrada para a fila na tabela de estado, de forma que
pacotes saindo pela <tt>fxp0</tt> que casam com a conexão stateful
d625 4
a628 3
palavra-chave <tt>queue</tt> estar sendo utilizada numa regra filtrando
tráfego entrante, o objetivo é especificar uma fila para o tráfego que
sai; a regra acima não enfileira pacotes entrantes.
d631 1
a631 1
<h2>Exemplo #1: Rede Pequena, doméstica</h2>
d643 1
a643 1
Nesse exemplo, o OpenBSD está sendo usado num gateway de Internet para
d646 1
a646 1
rodando a 2Mbps de download e 640Kbps de upload.
d649 1
a649 1
A política de filas para essa rede:
d652 1
a652 1
    que ele possa jogar online sem sofrer atrasos por causa dos
d655 2
a656 2
<li>Tráfego SSH interativo e mensagem instantânea terão maior prioridade
    do que o tráfego comum.
d663 1
a663 1
Abaixo segue o conjunto de regras adequado à política da rede. Perceba
d667 1
a667 1
<a href="rdr.html"><tt>rdr</tt></a>, <a href="options.html">options</a>,
d674 4
a677 4
# Habilita enfileiramento na interface externa para controlar o tráfego
# indo para Internet. Usa o organizador priq para controlar somente
# prioridades. Define largura de banda para 610Kbps para obter melhor
# desempenho na fila TCP ACK.
d682 4
a685 4
# Define os parâmetros para as subfilas.
# std_out      - a fila padrão. Qualquer regra abaixo que não
#                especifique explicitamente uma fila, terá seu tráfego
#		 inserido nessa fila.
d689 1
a689 1
# tcp_ack_out  - pacotes TCP ACK sem payload de dados.
d696 3
a698 3
# Habilita enfileiramento na interface interna para controlar tráfego
# vindo da Internet. Usa o organizador cbq para controlar a banda.
# Largura de banda máxima é 2Mbps.
d702 1
a702 1
# Define os parâmetros para as subfilas.
d705 1
a705 1
#		tráfego inserido nessa fila.
d709 2
a710 2
# bob_in      - banda reservada para a estação de trabalho de Bob.
#		Permitir a ele emprestar banda dos outros.
d718 1
a718 1
# ... na seção de filtragem do pf.conf ...
d727 1
a727 1
# Regras de filtragem para entrada em fxp0
d730 1
a730 1
# Regras de filtragem para saída em fxp0
d742 1
a742 1
# Regras de filtragem de entrada em dc0
d746 1
a746 1
# Regras de filtragem de saída em dc0
d761 1
a761 1
<h2>Exemplo #2: Rede Empresarial</h2>
d764 3
a766 3
  ( IT Dept )  [ Boss's PC ]
       |          |                                   T1
     --+----+-----+---------- dc0 [ OpenBSD ] fxp0 -------- ( Internet )
d775 1
a775 1
Nesse exemplo, a máquina OpenBSD funciona como firewall para a rede
d777 6
a782 6
rede, onde os clientes fazem upload de seus websites via FTP. O
departamento de TI possui sua própria subrede conectada na rede
principal, e o chefe tem um PC em sua mesa que é usado para ler email
e navegar na Internet. A conexão com a Internet é via um linha T1
rodando a 1.5Mbps em ambas as direções. Todos os outros segmentos de
rede utilizam Fast Ethernet (100Mbps).
d785 1
a785 1
O administrador de rede decidiu pela seguinte política:
d787 1
a787 1
<li>Limitar todo o tráfego entre o servidor WWW e a internet para
d791 2
a792 2
       <li>Distribuir 250Kbps para "outro" tráfego (ou seja,
	   tráfego não-HTTP)
d800 1
a800 1
<li>Reservar 500Kbps para o Departamento de TI para que eles
d805 1
a805 1
    Internet do que outro tráfego indo/vindo da Internet.
d809 1
a809 1
Abaixo estão as regras que fazem a política dessa rede. Perceba
d813 1
a813 1
<a href="rdr.html"><tt>rdr</tt></a>, <a href="options.html">options</a>,
d820 4
a823 3
# Habilita enfileiramento na interface externa para pacotes saindo
# para a Internet. Usa cbq para que o uso da banda por cada fila possa
# ser controlado. A largura máxima para tráfego saindo é de 1.5Mbps.
d827 4
a830 3
# Define os parâmetros para as subfilas.
# std_ext        - a fila padrão. Também para o tráfego saindo via fxp0.
# www_ext        - fila para tráfego WWW do servidor.
d832 1
a832 1
#   www_ext_http - fila para tráfego WWW do servidor; alta prioridade.
d843 6
a848 6
# Habilita enfileiramento na interface interna para controlar tráfego
# vindo da internet para DMZ. Usa cbq para controlar a banda em cada
# fila. Esta interface está configurada para largura máxima de banda.
# Tráfego vindo da DMZ poderá usar toda a banda enquanto tráfego vindo
# da Internet será limitado a 1.0Mbps (porque 0.5Mbps (500Kbps) está
# alocado para fxp1).
d852 8
a859 5
# Define os parâmetros para as subfilas.
# net_int    - fila para tráfego vindo da Internet. Banda de 1.0Mbps.
#   std_int  - a fila padrão. Padrão também para tráfego saindo via dc0.
#   it_int   - tráfego para a rede do TI; reservar 500Kbps.
#   boss_int - tráfego para o PC do chefe, designar alta prioridade.
d868 1
a868 1
# Habilitar enfileiramento na interface da DMZ para controlar tráfego
d870 4
a873 4
# o controle preciso se faz necessário. A banda nesta interface está
# configurada para sua capacidade máxima. O tráfego da rede interna
# poderá utilizar toda a banda, enquanto o tráfego da Internet será
# limitado a 500Kbps.
d877 1
a877 1
# Define os parâmetros para as subfilas.
d879 1
a879 1
# net_dmz        - tráfego da Internet.
d889 1
a889 1
# ... na seção de filtragem do pf.conf ...
d902 1
a902 1
# Regras de filtragem para entrada em fxp0
d908 1
a908 1
# Regras de filtragem para saída em fxp0
d912 1
a912 1
# Regras de filtragem para entrada em dc0
d919 1
a919 1
# Regras de filtragem para saída em dc0
d922 1
a922 1
# Regras de filtragem para entrada em fxp1
d926 1
a926 1
# Regras de filtragem para saída em fxp1
d950 1
a950 1
$Translation: queueing.html,v 1.12 2009/05/10 17:44:16 alan Exp $<br>
@


1.11
log
@Sync with Steelix CVS
@
text
@d102 3
a104 2
O organizador (scheduler) é que decide quais filas processar e em que
ordem. Por padrão o OpenBSD usa um organizador FIFO (First In First Out).
d243 3
a245 3
de uma fila com prioridade menor. 
Se duas ou mais filas estiverem atribuídas à mesma prioridade, então 
essas filas serão processadas de modo round-robin. 
d302 5
a306 5
todas) as conexões são descartados (como é o caso com enfileiramento 
FIFO), a capacidade média de transferência cairá
severamente. Essa não é uma situação ideal porque faz com que todas
as conexões FTP reduzam sua taxa de transferência e também significa
que a rede não é mais utilizada em todo seu potencial.
d359 1
a359 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&amp;sektion=5&amp;manpath=OpenBSD+4.4"
d625 3
a627 3
    que ele possa jogar online sem sofrer lag por causa dos downloads
    de Alice ou Charlie. Permitir a Bob usar mais de 80Kbps quando
    houver disponibilidade.
d764 1
a764 1
       <li>Distribuir 250Kbps para "outro" tráfego (i.e.,
d917 2
a918 2
Originally [OpenBSD: queueing.html,v 1.36 ]<br>
$Translation: queueing.html,v 1.11 2009/03/11 00:52:57 dsantos Exp $<br>
@


1.10
log
@Sync with Steelix CVS
@
text
@d4 1
a4 1
<title>PF: Fila de Pacotes e Prioriza&ccedil;&atilde;o</title>
d8 3
a10 3
<meta name="description" content="the OpenBSD FAQ page">
<meta name="keywords" content="openbsd,faq,pf">
<meta name="distribution" content="global">
d38 3
a40 3
[<a href="anchors.html">Anterior: &Acirc;ncoras</a>]
[<a href="index.html">Conte&uacute;do</a>]
[<a href="pools.html">Pr&oacute;ximo: Grupos de Endere&ccedil;os e Balanceamento de Carga</a>]
d43 1
a43 1
<h1><font color="#e00000">PF: Fila de Pacotes e Prioriza&ccedil;&atilde;o</font></h1>
d48 1
a48 1
<h3>Conte&uacute;do</h3>
d59 2
a60 2
<li><a href="#assign">Atribuindo Tr&aacute;fego a uma Fila</a>
<li><a href="#example1">Exemplo #1: Rede Pequena, dom&eacute;stica</a>
d69 1
a69 1
Enfileirar algo &eacute; armazen&aacute;-lo em algum lugar, de maneira organizada, 
d71 27
a97 27
pacotes de dados s&atilde;o enviados por um host, eles entram numa fila
onde aguardam processamento pelo sistema operacional.  O sistema 
operacional decide qual fila e quais pacotes nesta fila devem ser 
processados. A ordem em que o sistema operacional escolhe os 
pacotes a processar pode afetar a performance da rede. Por 
exemplo, imagine um usu&aacute;rio executando duas aplica&ccedil;&otilde;es de rede: 
SSH e FTP. Em condi&ccedil;oes ideais, os pacotes SSH devem ser 
processados antes dos pacotes FTP por causa da natureza 
sens&iacute;vel do tempo no SSH; quando uma tecla &eacute; acionada num cliente 
SSH, uma resposta imediata &eacute; esperada, mas uma transfer&ecirc;ncia FTP 
sendo atrasada por alguns segundos extras, muito dificilmente ser&aacute; 
percebida.  Mas o que acontece se o roteador manipulando estas 
conex&otilde;es processar um grande n&uacute;mero de pacotes da conex&atilde;o FTP antes de 
processar a conex&atilde;o SSH? Pacotes da conex&atilde;o SSH permanecer&atilde;o na fila 
(ou possivelmente ser&atilde;o descartados pelo roteador caso a fila n&atilde;o seja 
grande o suficiente para manter todos os pacotes) e a sess&atilde;o SSH 
parecer&aacute; muito lenta e com atrasos.  Modificando a estrat&eacute;gia de 
enfileiramento utilizada, a largura de banda pode ser compartilhada 
entre diferentes aplica&ccedil;&otilde;es, usu&aacute;rios e computadores.

<p>
Perceba que o enfileiramento &eacute; &uacute;til somente para pacotes  
<i>saindo</i>. Quando o pacote chega entrando numa interface   
j&aacute; &eacute; tarde demais para ser enfileirado -- ele j&aacute; consumiu largura de banda 
ao chegar na interface que o recebeu. A &uacute;nica solu&ccedil;&atilde;o &eacute; habilitar 
enfileiramento no roteador adjacente ou, se o host que recebeu o pacote 
est&aacute; funcionado como roteador, habilitar enfileiramento na interface 
d102 7
a108 7
O escalonador (scheduler) &eacute; que decide quais filas processar e em que 
ordem. Por padr&atilde;o o OpenBSD usa um escalonador FIFO (First In First Out).
Uma fila FIFO funciona como um caixa de supermercado -- o primeiro item 
na fila &eacute; o primeiro a ser processado. Conforme novos pacotes chegam 
v&atilde;o sendo colocados no fim da fila. Caso a fila fique cheia, e aqui 
a analogia com o supermercado termina, novos pacotes v&atilde;o sendo 
descartados. Isso &eacute; conhecido como tail-drop.
d111 1
a111 1
OpenBSD suporta mais dois escalonadores:
d119 7
a125 7
Filas Baseadas em Classe ou Class Based Queuing (CBQ) &eacute; um algoritmo 
de enfileiramento que divide a largura de banda entre m&uacute;ltiplas filas
ou classes. Cada fila tem seu tr&aacute;fego atribu&iacute;do com base em endere&ccedil;o 
de origem ou destino, n&uacute;mero de porta, protocolo, etc.  Uma fila pode 
opcionalmente ser configurada para emprestar banda de sua fila pai, 
caso ela n&atilde;o esteja utilizando sua largura total.  As filas tamb&eacute;m 
recebem uma prioridade de forma que as que cont&eacute;m tr&aacute;fego interativo 
d127 1
a127 1
tr&aacute;fego normal, como FTP.
d130 4
a133 4
Filas CBQ s&atilde;o organizadas de forma hir&aacute;rquica.  No topo da hierarquia
est&aacute; a fila raiz que define a quantidade total de banda dispon&iacute;vel. 
As outras filas s&atilde;o criadas sob a fila raiz, cada uma delas pode 
receber parte da largura de banda da fila raiz.  Por exemplo, filas 
d136 1
a136 1
<dd>Fila Raiz (2Mbps)
d138 3
a140 3
	<dd>Fila A (1Mbps)
	<dd>Fila B (500Kbps)
	<dd>Fila C (500Kbps)
d145 3
a147 3
Neste caso, a largura de banda total dispon&iacute;vel est&aacute; definida  para 
2 megabits por segundo (Mbps). Esta banda &eacute; ent&atilde;o dividida entre 
outras tr&ecirc;s filas.
d151 3
a153 4
Para dividir a banda igualmente entre diferentes usu&aacute;rios e ainda 
classificar seu tr&aacute;fego de forma que certos protocolos n&atilde;o ocupem 
a banda de outros, uma estrutura parecida com essa pode ser 
definida:
d155 1
a155 1
<dd>Fila Raiz (2Mbps)
d175 2
a176 2
Perceba que a cada n&iacute;vel a soma do total de banda vinculado a cada fila 
nunca &eacute; maior que o valor da banda da fila raiz.
d180 2
a181 2
caso as outras filas dentro da fila pai n&atilde;o estejam usando sua por&ccedil;&atilde;o 
e a banda esteja dispon&iacute;vel.  Considere a configura&ccedil;&atilde;o a seguir:
d183 1
a183 1
<dd>Fila Raiz (2Mbps)
d195 6
a200 6
Se o tr&aacute;fego na fila <tt>ftp</tt> exceder os 900Kbps e o tr&aacute;fego na fila 
<tt>UserA</tt> for menor que 1Mbps (por que a fila <tt>ssh</tt> est&aacute; 
usando menos que 100Kbps), a fila <tt>ftp</tt> ir&aacute; emprestar banda de 
<tt>UserA</tt>.  Desta forma a fila <tt>ftp</tt> pode usar mais banda do 
que foi definido a princ&iacute;pio quando necess&aacute;rio.  Quando o tr&aacute;fego na fila 
<tt>ssh</tt> aumenta, a banda emprestada &eacute; devolvida.
d203 5
a207 5
CBQ atribui a cada fila um n&iacute;vel de prioridade. Filas com prioridade 
alta tem prefer&ecirc;ncia sobre outras com menor prioridade em caso de 
congestionamento, contanto que estejam contidas na mesma fila pai (Em 
outras palavras contanto que estejam no mesmo n&iacute;vel na hierarquia). 
Filas com a mesma prioridade s&atilde;o processadas em sequ&ecirc;ncia (round-robin).
d210 1
a210 1
<dd>Fila Raiz (2Mbps)
d222 8
a229 8
O CBQ ir&aacute; processar as filas <tt>UserA</tt> e <tt>UserB</tt> 
em sequ&ecirc;ncia -- nenhuma fila ser&aacute; preferida sobre a outra. Enquanto a 
fila <tt>UserA</tt> est&aacute; sendo processada, o CBQ tamb&eacute;m ir&aacute; processar 
suas subfilas.  Neste caso, a fila <tt>ssh</tt> tem prioridade maior e 
ter&aacute; tratamento preferencial sobre a fila <tt>ftp</tt> caso a rede 
fique congestionada.  Perceba como as filas <tt>ssh</tt> e <tt>ftp</tt>
n&atilde;o tem suas prioridades comparadas &agrave;s filas <tt>UserA</tt> e 
<tt>UserB</tt> pelo fato de elas n&atilde;o estarem no mesmo n&iacute;vel na 
d233 1
a233 1
Para um estudo mais detalhado sobre a teoria por tr&aacute;s do CBQ, por 
d235 1
a235 1
<a href="http://www.icir.org/floyd/cbq.html">Refer&ecirc;ncias sobre CBQ</a>.
d239 6
a244 6
Fila de Prioridade ou Priority Queuing (PRIQ) designa v&aacute;rias filas 
numa interface de rede com cada uma tendo um n&iacute;vel de prioridade. 
Uma fila com alta prioridade &eacute; <i>sempre</i> processada na frente 
de uma fila com prioridade menor.
Se duas ou mais filas estiverem atribuidas a mesma prioridade ent&atilde;o
estas filas ser&atilde;o processadas de modo round-robin.
d247 3
a249 3
A estrutura de enfileiramento no PRIQ &eacute; simples -- voc&ecirc; n&atilde;o pode 
definir filas dentro de filas. A fila raiz &eacute; definida, onde &eacute; 
configurado o total de banda dispon&iacute;vel, ent&atilde;o subfilas s&atilde;o 
d252 1
a252 1
<dd>Fila raiz (2Mbps)
d254 3
a256 3
	<dd>Fila A (priority 1)
	<dd>Fila B (priority 2)
	<dd>Fila C (priority 3)
d261 5
a265 5
A fila raiz &eacute; definida possuindo 2Mbps de largura de banda dispon&iacute;vel 
e tr&ecirc;s subfilas s&atilde;o definidas. A fila com maior prioridade (o maior 
n&uacute;mero na prioridade) &eacute; servida primeiro. Quando todos pacotes nesta 
fila s&atilde;o processados, ou caso a fila esteja vazia, PRIQ vai para a 
pr&oacute;xima fila com prioridade mais alta.  Dentro da fila, os pacotes s&atilde;o 
d269 5
a273 5
&Eacute; importante notar quando estiver usando PRIQ que voc&ecirc; deve planejar 
suas filas com muito cuidado.  Como PRIQ <i>sempre</i> processa a fila 
com prioridade mais alta primeiro, &eacute; poss&iacute;vel que uma fila com alta 
prioridade fa&ccedil;a com que pacotes destinados a outra fila com prioridade 
menor atrasem muito ou at&eacute; mesmo sejam descartados caso a fila preferida 
d278 43
a320 42
Random Early Detection (RED) &eacute; um algoritmo para evitar congestionamento. 
Seu trabalho &eacute; evitar congestionamento na rede certificando-se de que a 
fila nunca fique cheia. Ele realiza a tarefa calculando continuamente 
o tamanho m&eacute;dio da fila e comparando-a com dois valores, um valor m&iacute;nimo 
e um valor m&aacute;ximo. Se o tamanho m&eacute;dio da fila estiver abaixo do valor 
m&iacute;nimo ent&atilde;o nenhum pacote ser&aacute; descartado. Se a m&eacute;dia estiver acima 
do valor m&aacute;ximo ent&atilde;o <i>todos</i> os pacotes que chegarem ser&atilde;o 
descartados. Se a m&eacute;dia estiver entre os dois valores ent&atilde;o os pacotes 
s&atilde;o descartados baseados no c&aacute;lculo da probabilidade obtido do 
tamanho m&eacute;dio da fila. Em outras palavras, conforme o tamanho m&eacute;dio da 
fila se aproxima do valor m&aacute;ximo, mais pacotes s&atilde;o descartados. Ao 
descartar pacotes, RED escolhe aleatoriamente de quais conex&otilde;es ele 
ir&aacute; descart&aacute;-los. Conex&otilde;es usando grandes por&ccedil;&otilde;es da 
largura de banda tem maior probabilidade de terem seus pacotes descartados.

<p>
O RED &eacute; &uacute;til porque evita uma situa&ccedil;&atilde;o conhecida como 
sincroniza&ccedil;&atilde;o global e pode acomodar aumentos repentinos no tr&aacute;fego. 
Sincroniza&ccedil;&atilde;o global refere-se a uma queda na capacidade de transfer&ecirc;ncia 
devido aos pacotes descartados de v&aacute;rias conex&otilde;es ao mesmo tempo. Por exemplo, caso 
o congestionamento ocorra num roteador transmitindo tr&aacute;fego para 10 
conex&otilde;es FTP e pacotes de todas (ou quase todas) as conex&otilde;es s&atilde;o 
descartados (como &eacute; o caso com enfileiramento FIFO), a capacidade 
m&eacute;dia de transfer&ecirc;ncia cair&aacute; severamente. Esta n&atilde;o &eacute; uma 
situa&ccedil;&atilde;o ideal porque faz com que todas as conex&otilde;es FTP reduzam sua taxa de 
transfer&ecirc;ncia e tamb&eacute;m significa que a rede n&atilde;o &eacute; utilizada mais 
em todo seu potencial.  RED evita esse cen&aacute;rio escolhendo aleatoriamente 
quais conex&otilde;es ter&atilde;o pacotes descartados ao inv&eacute;s de escolher todas elas.
Conex&otilde;es usando muita largura de banda tem chances maiores de terem seus 
pacotes descartados. Desta forma, conex&otilde;es que ocupam muita banda ser&atilde;o 
evitadas, o congestionamento ser&aacute; evitado, e s&eacute;rias perdas nas taxas de 
transfer&ecirc;ncia n&atilde;o ocorrer&atilde;o. Al&eacute;m disso, RED pode responder a 
aumentos repentinos no tr&aacute;fego pelo fato de come&ccedil;ar a descartar 
pacotes <i>antes</i> da fila ficar cheia. Quando o t&aacute;fego 
inesperado chegar, existir&aacute; espa&ccedil;o suficiente na fila para 
armazenar os novos pacotes.

<p>
RED deve ser usado apenas quando o protocolo de transporte for capaz 
de responder a indicadores de congestionamento da rede. Na maioria 
dos casos isto significa que RED deve ser usado para enfileirar 
tr&aacute;fego TCP e nunca tr&aacute;fego UDP ou ICMP.
d323 1
a323 1
Para uma discuss&atilde;o mais detalhada sobre a teoria por tr&aacute;s do RED, por 
d325 1
a325 1
<a href="http://www.icir.org/floyd/red.html">Refer&ecirc;ncias sobre RED</a>.
d329 6
a334 6
Explicit Congestion Notification (ECN) trabalha em conjunto com RED 
para notificar dois hosts comunicando-se pela rede de quaisquer 
congestionamentos no caminho de comunica&ccedil;&atilde;o. Para fazer isso RED 
insere um marcador (flag) no cabe&ccedil;alho do pacote ao inv&eacute;s de 
descart&aacute;-lo. Supondo que o host enviando dados tem suporte a ECN, ele 
pode identificar essa marca&ccedil;&atilde;o e reduzir seu tr&aacute;fego de acordo.
d337 1
a337 1
Para mais informa&ccedil;&otilde;es sobre ECN, por favor consulte a
d342 19
a360 17
Desde o OpenBSD 3.0 a implementa&ccedil;&atilde;o de filas  
<a href="http://www.csl.sony.co.jp/person/kjc/kjc/software.html#ALTQ">Alternate Queueing (ALTQ)</a> se tornou parte do sistema base. Desde o OpenBSD 3.3 ALTQ foi 
integrado ao PF.  A implementa&ccedil;&atilde;o ALTQ do OpenBSD suporta os
escalonadores 
Class Based Queueing (CBQ) e Priority Queueing (PRIQ). Ele tamb&eacute;m 
suporta Random Early Detection (RED) e Explicit Congestion Notification (ECN).

<p>
Pelo fato de ALTQ ter sido integrado ao PF, o PF deve estar habilitado para 
que o sistema funcione. Instru&ccedil;&otilde;es de como habilitar o PF podem ser 
encontradas em <a href="config.html#activate">Come&ccedil;ando</a>.

<p>
Filas s&atilde;o configuradas no arquivo <tt>
<a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&amp;sektion=5&amp;manpath=OpenBSD+4.2">pf.conf</a></tt>. 
Existem dois tipos de diretivas utilizadas para configura&ccedil;&atilde;o de filas:
d362 2
a363 2
<li><tt>altq on</tt> - habilita enfileiramento na interface, define qual 
escalonador usar e cria a fila raiz
d368 1
a368 1
A sintaxe para a diretiva <tt>altq on</tt> &eacute;:
d371 1
a371 1
altq on <i>interface scheduler</i> bandwidth <i>bw</i> qlimit 
d378 18
a395 15
<li><tt><i>interface</i></tt> - a interface de rede onde o enfileiramento deve ser ativado.
<li><tt><i>scheduler</i></tt> - o escalonador a ser utilizado. Valores poss&iacute;veis s&atilde;o
<tt>cbq</tt> e <tt>priq</tt>. Somente um escalonador por vez pode estar ativo na interface.
<li><tt><i>bw</i></tt> - o valor total de banda dispon&iacute;vel para o
escalonador.
Isto pode ser especificado como um valor absoluto utilizando os sufixos <tt>b</tt>,
<tt>Kb</tt>, <tt>Mb</tt>, e <tt>Gb</tt> para representar bits, kilobits,
megabits, e gigabits por segundo, respectivamente ou como uma percentagem da banda na
<tt><i>interface</i></tt>.
<li><tt><i>qlim</i></tt> - o n&uacute;mero m&aacute;ximo de pacotes que podem ser armazenados na 
fila.
Este par&acirc;metro &eacute; opcional. O padr&atilde;o &eacute; 50.
<li><tt><i>size</i></tt> - o tamanho do regulador token bucket em bytes. Caso n&atilde;o seja 
especificado, o tamanho &eacute; definido baseado na largura de banda da <tt><i>interface</i></tt> .
<li><tt><i>queue_list</i></tt> - uma lista de subfilas a serem criadas sob a fila raiz.
d405 2
a406 2
Isso habilitar&aacute; o CBQ na interface <tt>fxp0</tt>. A largura de banda 
total dispon&iacute;vel &eacute; configurada para 2Mbps. Tr&ecirc;s subfilas s&atilde;o definidas: 
d410 1
a410 1
A sintaxe para a diretiva <tt>queue</tt> &eacute;:
d413 1
a413 1
queue <i>name</i> [on <i>interface</i>] bandwidth <i>bw</i> [priority 
d421 28
a448 30
<li><tt><i>name</i></tt> - o nome da fila. Este nome deve ser um dos 
nomes de filas definidos na diretiva <tt>altq on</tt> 
<tt><i>queue_list</i></tt>. Para o <tt>cbq</tt> tamb&eacute;m pode ser 
nome de fila definido numa diretiva <tt><i>queue_list</i></tt> numa 
<tt>queue</tt> anterior. Nomes de fila n&atilde;o devem ser mais 
longos que 15 caracteres.
<li><tt><i>interface</i></tt> - a interface de rede onde a fila &eacute; 
v&aacute;lida. Este valor &eacute; opcional, e quando n&atilde;o 
especificado, tornar&aacute; a fila v&aacute;lida em todas interfaces.
<li><tt><i>bw</i></tt> - a quantidade total de banda dispon&iacute;vel 
para a fila.
Pode ser especificado como um valor absoluto ou usando sufixos 
<tt>b</tt>, <tt>Kb</tt>, <tt>Mb</tt>, e <tt>Gb</tt> representando 
bits, kilobits, megabits, e gigabits por segundo, respectivamente ou 
um valor em porcentagem da fila principal.
Este par&acirc;metro s&oacute; &eacute; aplic&aacute;vel quando usar 
o escalonador <tt>cbq</tt>.
Se n&atilde;o for especificado, o padr&atilde;o &eacute; 100% da banda 
da fila pai. <li><tt><i>pri</i></tt> - a prioridade da fila. Para o 
<tt>cbq</tt> a faixa de prioridade varia de 0 a 7 e para <tt>priq</tt> 
a faixa vai de 0 a 15.
Prioridade 0 &eacute; a mais baixa. Quando n&atilde;o especificada, o 
valor padr&atilde;o de 1 &eacute; usado.
<li><tt><i>qlim</i></tt> - o n&uacute;mero m&aacute;ximo de pacotes 
que podem ser armazenados na fila.
Quando n&atilde;o for especificado, o padr&atilde;o 50 &eacute; usado.
<li><tt><i>scheduler</i></tt> - o escalonador utilizado, <tt>cbq</tt>
ou <tt>priq</tt>. Deve ser o mesmo da fila raiz.
<li><tt><i>sched_options</i></tt> - outras op&ccedil;&otilde;es podem 
ser passadas para controlar o comportamento do escalonador:
d450 14
a463 12
	<li><tt>default</tt> - define uma fila padr&atilde;o onde os 
	pacotes que n&atilde;o casarem com nenhuma outra fila ser&atilde;o 
	armazenados. Exatamente uma fila padr&atilde;o &eacute; necess&aacute;ria.
	<li><tt>red</tt> - habilita Random Early Detection (RED) na fila.
	<li><tt>rio</tt> - habilita RED com IN/OUT. Neste modo, RED manter&aacute;
	m&uacute;ltiplos valores m&eacute;dios da fila e m&uacute;ltiplos 
	valores de compara&ccedil;&atilde;o, um para cada n&iacute;vel de 
	Qualidade de Servi&ccedil;o IP.
	<li><tt>ecn</tt> - habilita Explicit Congestion Notification (ECN) na 
	fila. <tt>Ecn</tt> implica <tt>red</tt>.
	<li><tt>borrow</tt> - a fila pode emprestar banda de sua fila pai. 
	Esta op&ccedil;&atilde;o s&oacute; pode ser utilizada com o escalonador <tt>cbq</tt>.
d465 3
a467 3
<li><tt><i>queue_list</i></tt> - uma lista de subfilas a serem criadas 
dentro desta fila. Uma <tt><i>queue_list</i></tt> pode ser definida apenas 
quando o escaonador utilizado for <tt>cbq</tt>.
d483 18
a500 18
Aqui os par&acirc;metros das subfilas previamente definidas s&atilde;o configurados. 
A fila <tt>std</tt> possui largura de banda de 50% da fila raiz (ou 1Mbps) 
e est&aacute; configurada como a fila padr&atilde;o. A fila <tt>ssh</tt> 
possui 25% da banda da fila raiz (500kb) e tamb&eacute;m 
cont&eacute;m duas filas <tt>ssh_login</tt> 
e <tt>ssh_bulk</tt>. A fila <tt>ssh_login</tt> 
tem prioridade maior que <tt>ssh_bulk</tt> e ambas tem ECN habilitado. 
A banda atribu&iacute;da &agrave; fila <tt>ftp</tt> &eacute; de 500Kbps com prioridade 3. Ela 
tamb&eacute;m pode tomar banda emprestada quando estiver dispon&iacute;vel e tamb&eacute;m tem 
RED habilitado.

<p>
<b>NOTA:</b> Cada defini&ccedil;&atilde;o de fila tem sua banda especificada.
Sem especificar a banda, o PF dar&aacute; a fila 100% da banda da fila pai.
Nesta situa&ccedil;&atilde;o, que causar&aacute; um erro quando as regras
s&atilde;o carregadas uma vez que existe uma fila com 100% da banda, nenhuma
outra fila pode ser definida neste n&iacute;vel uma vez que n&atilde;o
existe banda livre para alocar. 
d503 1
a503 1
<h3>Atribuindo Tr&aacute;fego a uma Fila</h3>
d505 1
a505 1
Para atribuir tr&aacute;fego a uma fila, a palavra-chave <tt>queue</tt> &eacute; usada 
d507 2
a508 1
Por exemplo, considere um conjunto de regras de filtragem contendo uma linha como:
d514 2
a515 2
Pacotes que casarem com esta regra podem ser enviados para uma fila espec&iacute;fica 
atrav&eacute;s do uso da palavra-chave <tt>queue</tt>:
d521 2
a522 2
Ao usar a palavra <tt>queue</tt> com diretivas <tt>block</tt>, quaisquer 
pacotes TCP RST ou ICMP Unreachable resultantes ser&atilde;o enviados &agrave; fila 
d526 1
a526 1
Note que as designa&ccedil;&otilde;es de filas podem ocorrer numa interface diferente 
d529 1
a529 1
<tt> 
d539 19
a557 17
Enfileiramento est&aacute; habilitado em <tt>fxp0</tt> mas a designa&ccedil;&atilde;o 
acontece em <tt>dc0</tt>. 
Se os pacotes combinando com a regra <tt>pass</tt> sairem pela 
interface <tt>fxp0</tt>, ser&atilde;o enfileirados na fila <tt>ftp</tt>.
Este tipo de enfileiramento pode ser muito &uacute;til em roteadores.

<p>
Normalmente apenas um nome de fila &eacute; informado com a palavra <tt>queue</tt>, 
mas caso um segundo nome seja especificado a fila ser&aacute; usada para pacotes 
com um <a href="http://www.rfc-editor.org/rfc/rfc791.txt">Type of
Service (ToS)</a> com pouco atraso e para pacotes TCP ACK sem payload de 
dados. Um bom exemplo disso pode ser obtido utilizando SSH. Sess&otilde;es de login 
SSH ir&atilde;o definir o ToS para low-delay enquanto que sess&otilde;es SCP e SFTP n&atilde;o.
PF pode usar estas informa&ccedil;&otilde;es para enfileirar pacotes pertencentes a uma 
conex&atilde;o de login numa fila diferente dos pacotes que n&atilde;o forem de conex&otilde;es
de login. Isso pode ser &uacute;til para priorizar os pacotes das conex&otilde;es de login
sobre pacotes de transfer&ecirc;ncia de arquivos.
d563 20
a582 20
Isto envia pacotes pertencentes a conex&otilde;es de login SSH para a fila 
<tt>ssh_login</tt> e pacotes pertencentes a conex&otilde;es SCP e SFTP 
para a fila <tt>ssh_bulk</tt>. Conex&otilde;es de login SSH ter&atilde;o seus pacotes 
processados antes dos pacotes SCP e SFTP, porque a fila <tt>ssh_login</tt> 
tem prioridade maior.

<p>
Atribuir pacotes TCP ACK a uma fila de alta prioridade &eacute; &uacute;til em 
conex&otilde;es assim&eacute;tricas, isto &eacute;, conex&otilde;es que possuem taxas de
upload e download diferentes, como conex&otilde;es ADSL por exemplo. Numa conex&atilde;o ADSL, se 
o canal de upload estiver sendo utilizado em sua capacidade m&aacute;xima e um 
download &eacute; iniciado, o download ir&aacute; sofrer porqu&ecirc; os pacotes TCP ACK 
que devem ser enviados entrar&atilde;o num congestionamento quando tentarem 
passar pelo canal de upload. Testes tem mostrado que para atingir os 
melhores resultados, a largura de banda na fila de upload deve ser 
configurado para um valor menor do que a conex&atilde;o realmente &eacute; capaz. 
Por exemplo, se uma conex&atilde;o ADSL, tem uma taxa m&aacute;xima de upload de 
640Kbps, configurar a <tt>bandwidth</tt> da fila raiz para um valor como 600Kbp deve 
resultar numa melhora de performance. Tentativas e erros mostrar&atilde;o a melhor 
configura&ccedil;&atilde;o de <tt>bandwidth</tt>.
d585 2
a586 2
Ao utilizar a palavra <tt>queue</tt> com regras que mant&eacute;m o estado das 
conex&otilde;es <tt>keep state</tt> como:
d595 6
a600 6
O PF gravar&aacute; uma entrada para fila na tabela de estado de forma que 
pacotes saindo pela <tt>fxp0</tt> que combinem com a conex&atilde;o stateful 
ser&atilde;o enviados para a fila <tt>ssh</tt>. Perceba que apesar da palavra 
<tt>queue</tt> estar sendo utilizada num regra filtrando tr&aacute;fego 
entrante, o objetivo &eacute; especificar uma fila para o tr&aacute;fego que sai; a 
regra acima n&atilde;o enfileira pacotes entrantes.
d603 1
a603 1
<h2>Exemplo #1: Rede Pequena, dom&eacute;stica</h2>
d605 1
a605 1
  
d615 4
a618 4
Neste exemplo, o OpenBSD est&aacute; sendo usado num gateway Internet para uma pequena 
rede dom&eacute;stica com tr&ecirc;s esta&ccedil;&otilde;es de trabalho. O gateway faz 
filtragem de pacotes e NAT. A conex&atilde;o Internet &eacute; via linha ADSL rodando 
a 2Mbps down e 640Kbps up.
d621 1
a621 1
O pol&iacute;tica de filas para esta rede:
d623 9
a631 9
<li>Reservar 80Kbps de largura de banda de download para Bob, para 
que ele possa jogar online sem sofrer lag por causa dos downloads de 
Alice ou Charlie. Permitir a Bob usar mais de 80Kbps quando houver 
disponibilidade.
<li>SSH interativo e mensagem instant&acirc;neas ter&atilde;o maior prioridade 
do que tr&aacute;fego comum.
<li>Consultas e respostas DNS ter&atilde;o a segunda maior prioridade.
<li>Pacotes TCP ACK saindo ter&atilde;o maior prioridade que qualquer 
outro tr&aacute;fego de sa&iacute;da.
d635 4
a638 3
Abaixo segue o conjunto de regras adequado &agrave; pol&iacute;tica da rede. Perceba 
que somente diretivas <tt>pf.conf</tt> que se aplicam diretamente a pol&iacute;tica 
descrita acima est&atilde;o presentes; <a href="nat.html"><tt>nat</tt></a>,
d640 1
a640 1
etc., n&atilde;o s&atilde;o mostradas.
d646 4
a649 4
# habilita enfileiramento na interface externa para controlar tr&aacute;fego
# indo para Internet. usa o escalonador priq para controlar somente prioridades.
# define largura de banda para 610Kbps para obter melhor performance 
# na fila TCP ACK.
d654 6
a659 4
# define os par&acirc;metros para as subfilas.
# std_out      - a fila padr&atilde;o. qualquer regra abaixo que n&atilde;o especifique 
#		 explicitamente uma fila ter&aacute; seu tr&aacute;fego inserido nesta fila.
# ssh_im_out   - SSH interativo e tr&aacute;fego de v&aacute;rias mensagems instant&acirc;neas.
d661 1
a661 1
# tcp_ack_out  - pacotes TCP ACK sem dados de payload.
d668 3
a670 3
# habilita enfileiramento na interface interna para controlar tr&aacute;fego 
# vindo da Internet. usa escalonador cbq para controlar a banda. 
# largura de banda m&aacute;xima &eacute; 2Mbps.
d674 6
a679 5
# define os par&acirc;metros para as subfilas.
# std_in      - a fila padr&atilde;o. qualquer regra de filtragem abaixo que 
#		n&atilde;o expecifique explicitamente uma fila ter&aacute; seu 
#		tr&aacute;fego inserido nesta fila.
# ssh_im_in   - SSH interativo e tr&aacute;fego de v&aacute;rias mensagems instant&acirc;neas.
d681 2
a682 2
# bob_in      - banda reservada para a esta&ccedil;&atilde;o de trabalho de Bob. 
#		permitir a ele emprestar banda dos outros.
d690 1
a690 1
# ... na se&ccedil;&atilde;o de filtragem do pf.conf ...
d699 1
a699 1
# regras de filtragem para entrada em fxp0
d702 1
a702 1
# regras de filtragem para sa&iacute;da em fxp0
d714 1
a714 1
# regras de filtragem de entrada em dc0
d718 1
a718 1
# regras de filtragem de sa&iacute;da em dc0
d741 2
a742 2
                         |           / 
                       --+----------' 
d747 7
a753 7
Neste exemplo, a m&aacute;quina OpenBSD funciona como firewall para a rede 
de uma empresa. A empresa roda um servidor WWW na por&ccedil;&atilde;o DMZ de sua 
rede, onde os clientes fazem upload de seus websites via FTP. O 
departamento de TI possui sua pr&oacute;pria subrede conectada na rede 
principal, e o chefe tem um PC em sua mesa que &eacute; usado para ler email 
e navegar na Internet. A conex&atilde;o com a Internet &eacute; via um linha T1 
rodando a 1.5Mbps em ambas as dire&ccedil;&otilde;es. Todos os outros segmentos de 
d757 1
a757 1
O administrador de rede decidiu pela seguinte pol&iacute;tica:
d759 2
a760 2
<li>Limitar todo o tr&aacute;fego entre o servidor WWW e a internet 
para 500Kbps em ambas as dire&ccedil;&otilde;es.
d762 7
a768 7
       <li>Distribuir 250Kbps para tr&aacute;fego HTTP.
       <li>Distribuir 250Kbps para "outro" tr&aacute;fego (ex., 
	tr&aacute;fego n&atilde;o-HTTP)
       <li>Permitir qualquer fila emprestar totalmente os 500Kbps.
       <li>Dar alta prioridade ao tr&aacute;fego entre o servidor WWW 
	e a Internet do que outro tr&aacute;fego entre o servidor WWW
	e a Internet (como uploads FTP).
d770 8
a777 8
<li>O tr&aacute;fego entre o servidor WWW e a rede interna pode usar 
totalmente os 100Mbps que a rede oferece.
<li>Reservar 500Kbps para o Departamento de TI para que eles 
possam baixar as &uacute;ltimas vers&otilde;es de software em tempo h&aacute;bil. Eles 
devem ser capazes de utilizar mais do que 500Kbps caso haja
disponibilidade.
<li>Dar alta prioridade ao tr&aacute;fego entre o PC do chefe e a 
Internet do que outro tr&aacute;fego indo/vindo da Internet.
d781 4
a784 3
Abaixo est&atilde;o as regras que fazem a pol&iacute;tica desta rede. Perceba
que somente diretivas <tt>pf.conf</tt> que se aplicam diretamente a pol&iacute;tica descrita 
acima est&atilde;o presentes; <a href="nat.html"><tt>nat</tt></a>,
d786 1
a786 1
etc., n&atilde;o s&atilde;o mostradas.
d792 3
a794 3
# habilita enfileiramento na interface externa para pacotes 
# saindo para a Internet. usa cbq para que o uso da banda por cada fila
# possa ser controlado. a largura m&aacute;xima para tr&aacute;fego saindo &eacute; de 1.5Mbps.
d798 7
a804 6
# define os par&acirc;metros para as subfilas.
# std_ext        - a fila padr&atilde;o. tamb&eacute;m para tr&aacute;fego saindo via fxp0.
# www_ext        - fila para tr&aacute;fego WWW do servidor. limitada a 500Kbps.
#   www_ext_http - fila para tr&aacute;fego WWW do servidor; alta prioridade.
#   www_ext_misc - todo tr&aacute;fego difetente de http do servidor WWW.
# boss_ext       - tr&aacute;fego vindo do computador do chefe.
d813 5
a817 5
# habilita enfileiramento na interface interna para controlar tr&aacute;fego
# vindo da internet para DMZ. usa cbq para controlar a banda em cada
# fila. esta interface est&aacute; configurada para largura m&aacute;xima de banda.
# tr&aacute;fego vindo da DMZ poder&aacute; usar toda a banda enquanto tr&aacute;fego vindo
# da Internet ser&aacute; limitado a 1.0Mbps (porque 0.5Mbps (500Kbps) est&aacute; 
d822 6
a827 7
# define os par&acirc;metros para as subfilas.
# net_int    - fila para tr&aacute;fego vindo da Internet. banda de 1.0Mbps.
#   std_int  - a fila padr&atilde;o. padr&atilde;o tamb&eacute;m para tr&aacute;fego 
#	       saindo via dc0. 
#   it_int   - tr&aacute;fego para a rede do TI; reservar 500Kbps.
#   boss_int - tr&aacute;fego para o PC do chefe, designar alta prioridade.
# www_int    - tr&aacute;fego do servidor WWW na DMZ; velocicade m&aacute;xima.
d835 6
a840 6
# habilitar enfileiramento na interface da DMZ para controlar tr&aacute;fego
# destinado ao servidor WWW. cbq &eacute; utilizado nesta interface j&aacute; que 
# controle preciso se faz necess&aacute;rio. a banda nesta interface est&aacute; 
# configurada para sua capacidade m&aacute;xima. tr&aacute;fego da rede interna poder&aacute; 
# utilizar toda a banda, enquanto tr&aacute;fego da Internet ser&aacute; limitado a 
# 500Kbps.
d844 5
a848 6
# define os par&acirc;metros para as subfilas.
# internal_dmz   - tr&aacute;fego da rede interna.
# net_dmz        - tr&aacute;fego da Internet.
#   net_dmz_http - tr&aacute;fego http; alta prioridade.
#   net_dmz_misc - todo tr&aacute;fego n&atilde;o-http. esta tamb&eacute;m &eacute; a fila
#	           padr&atilde;o.
d856 1
a856 1
# ... na se&ccedil;&atilde;o de filtragem do of pf.conf ...
d866 1
a866 1
# negar por padr&atilde;o 
d869 1
a869 1
# regras de filtragem para entrada em fxp0
d875 1
a875 1
# regras de filtragem para sa&iacute;da em fxp0
d879 1
a879 1
# regras de filtragem para entrada em dc0
d886 1
a886 1
# regras de filtragem para sa&iacute;da em dc0
d889 1
a889 1
# regras de filtragem para entrada em fxp1 
d893 1
a893 1
# regras de filtragem para sa&iacute;da em fxp1 
d905 3
a907 3
[<a href="anchors.html">Anterior: &Acirc;ncoras</a>]
[<a href="index.html">Conte&uacute;do</a>]
[<a href="pools.html">Pr&oacute;ximo: Grupos de Endere&ccedil;os e Balanceamento de Carga</a>]
d916 2
a917 2
Originally [OpenBSD: queueing.html,v 1.33 ]<br>
$Translation: queueing.html,v 1.10 2008/04/12 15:05:03 dsantos Exp $<br>
d919 1
a919 1
$OpenBSD$ 
@


1.9
log
@Sync with Steelix CVS
@
text
@d438 1
a438 1
valor padr&atilde;o de 1 &eacute; udado.
d905 1
a905 1
$Translation: queueing.html,v 1.9 2007/11/24 18:12:31 dsantos Exp $<br>
@


1.8
log
@sync with Steelix CVS
@
text
@d81 1
a81 1
sendo atrasada por alguns segundos extra, muito dificilmente ser&aacute; 
d87 1
a87 1
parecer&aacute; muito lenta e com lag.  Modificando a estrat&eacute;gia de 
d102 2
a103 2
O organizador (scheduler) &eacute; que decide quais filas processar e em que 
ordem. Por padr&atilde;o o OpenBSD usa um scheduler FIFO (First In First Out).
d111 1
a111 1
OpenBSD suporta mais dois schedulers:
d241 1
a241 1
numa interface de rede com cada uma tendo um &uacute;nico n&iacute;vel de prioridade. 
d244 2
d344 2
a345 1
integrado ao PF.  A implementa&ccedil;&atilde;o ALTQ do OpenBSD suporta os organizadores 
d357 2
a358 2
href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&amp;sektion=5&amp;manpath=OpenBSD+4.0">pf.conf</a></tt>. Existem dois tipos de diretivas utilizadas 
para configura&ccedil;&atilde;o de filas:
d361 1
a361 1
organizador (scheduler) usar e cria a fila raiz
d377 4
a380 3
<li><tt><i>scheduler</i></tt> - o organizador a ser utilizado. Valores poss&iacute;veis s&atilde;o
<tt>cbq</tt> e <tt>priq</tt>. Somente um organizador por vez pode estar ativo na interface.
<li><tt><i>bw</i></tt> - o valor total de banda dispon&iacute;vel para o organizador.
d432 1
a432 1
o organizador <tt>cbq</tt>.
d442 1
a442 1
<li><tt><i>scheduler</i></tt> - o organizador utilizado, <tt>cbq</tt>
d445 1
a445 1
ser passadas para controlar o comportamento do organizador:
d458 1
a458 1
	Esta op&ccedil;&atilde;o s&oacute; pode ser utilizada com o organizador <tt>cbq</tt>.
d462 1
a462 1
quando o organizador utilizado for <tt>cbq</tt>.
d638 1
a638 1
# indo para Internet. usa o organizador priq para controlar somente prioridades.
d658 1
a658 1
# vindo da Internet. usa organizador cbq para controlar a banda. 
d904 2
a905 2
Originally [OpenBSD: queueing.html,v 1.30 ]<br>
$Translation: queueing.html,v 1.8 2006/11/21 01:54:24 dsantos Exp $<br>
@


1.7
log
@sync with steelix translation CVS
@
text
@d354 1
a354 1
href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&amp;sektion=5&amp;manpath=OpenBSD+3.9">pf.conf</a></tt>. Existem dois tipos de diretivas utilizadas 
d900 2
a901 2
Originally [OpenBSD: queueing.html,v 1.29 ]<br>
$Translation: queueing.html,v 1.7 2006/06/23 15:10:21 dsantos Exp $<br>
@


1.6
log
@sync with steelix translation CVS
@
text
@d412 6
a417 5
<li><tt><i>name</i></tt> - o nome da fila. Este nome deve ser um dos nomes de filas 
definidos na diretiva <tt>altq on</tt> 
<tt><i>queue_list</i></tt>. Para o <tt>cbq</tt> tamb&eacute;m pode ser nome de fila definido 
numa diretiva <tt><i>queue_list</i></tt> numa <tt>queue</tt> anterior. Nomes de fila n&atilde;o 
devem ser mais longos que 15 caracteres.
d419 18
a436 15
v&aacute;lida. Este valor &eacute; opcional, e quando n&atilde;o especificado, tornar&aacute; 
a fila v&aacute;lida em todas interfaces.
<li><tt><i>bw</i></tt> - a quantidade total de banda dispon&iacute;vel para a fila.
Pode ser especificado como um valor absoluto ou usando sufixos <tt>b</tt>,
<tt>Kb</tt>, <tt>Mb</tt>, e <tt>Gb</tt> representando bits, kilobits,
megabits, e gigabits por segundo, respectivamente ou um valor em porcentagem da 
fila principal.
Este par&acirc;metro s&oacute; &eacute; aplic&aacute;vel quando usar o organizador <tt>cbq</tt>.
Se n&atilde;o for especificado, o padr&atilde;o &eacute; 100% da banda da fila pai.
<li><tt><i>pri</i></tt> - a prioridade da fila. Para o <tt>cbq</tt> a 
faixa de prioridade varia de 0 a 7 e para <tt>priq</tt> a faixa vai de 0 a 15.
Prioridade 0 &eacute; a mais baixa. Quando n&atilde;o especificada, o valor padr&atilde;o de 1 
&eacute; udado.
<li><tt><i>qlim</i></tt> - o n&uacute;mero m&aacute;ximo de pacotes que podem ser 
armazenados na fila.
d440 2
a441 2
<li><tt><i>sched_options</i></tt> - outras op&ccedil;&otilde;es podem ser passadas 
para controlar o comportamento do organizador:
d443 3
a445 3
	<li><tt>default</tt> - define uma fila padr&atilde;o onde os pacotes que n&atilde;o 
	casarem com nenhuma outra fila ser&atilde;o armazenados. Exatamente uma fila 
	padr&atilde;o &eacute; necess&aacute;ria.
d448 3
a450 2
	m&uacute;ltiplos valores m&eacute;dios da fila e m&uacute;ltiplos valores de 
	compara&ccedil;&atilde;o, um para cada n&iacute;vel de Qualidade de Servi&ccedil;o IP.
d901 1
a901 1
$Translation: queueing.html,v 1.6 2006/05/28 17:23:03 dsantos Exp $<br>
@


1.5
log
@sync with Steelix CVS
@
text
@d354 1
a354 1
href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&amp;sektion=5&amp;manpath=OpenBSD+3.8">pf.conf</a></tt>. Existem dois tipos de diretivas utilizadas 
d895 2
a896 2
Originally [OpenBSD: queueing.html,v 1.28 ]<br>
$Translation: queueing.html,v 1.5 2005/12/22 21:21:45 dsantos Exp $<br>
@


1.4
log
@sync with steelix translation CVS
@
text
@d605 1
a605 1
</p><ul>
d896 1
a896 1
$Translation: queueing.html,v 1.4 2005/11/15 14:36:42 dsantos Exp $<br>
@


1.3
log
@sync with Steelix CVS
@
text
@d353 2
a354 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&amp;sektion=5&amp;manpath=OpenBSD+3.7">pf.conf</a></tt>. Existem dois tipos de diretivas utilizadas 
d894 4
a897 2
Originally [OpenBSD: queueing.html,v 1.27 ]<br>
$Translation: queueing.html,v 1.3 2005/06/06 13:06:29 dsantos Exp $<br>
@


1.2
log
@Sync with Steelix CVS
@
text
@d353 1
a353 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&amp;sektion=5&amp;manpath=OpenBSD+3.6">pf.conf</a></tt>. Existem dois tipos de diretivas utilizadas 
d425 1
d460 3
a462 3
queue ssh { ssh_login, ssh_bulk }<br>
&nbsp;&nbsp;queue ssh_login  priority 4 cbq(ecn)<br>
&nbsp;&nbsp;queue ssh_bulk   cbq(ecn)<br>
d470 4
a473 2
e est&aacute; configurada como a fila padr&atilde;o. A fila <tt>ssh</tt> define duas 
subfilas, <tt>ssh_login</tt> e <tt>ssh_bulk</tt>. A fila <tt>ssh_login</tt> 
d479 8
d515 1
a515 1
queue std cbq(default)<br>
d662 3
a664 3
queue std_in    cbq(default)
queue ssh_im_in priority 4
queue dns_in    priority 5
d737 13
a749 6
<li>Limitar o tr&aacute;fego entre o servidor WWW e a internet para 500Kbps 
em ambas as dire&ccedil;&otilde;es.
<li>Nenhuma limita&ccedil;&atilde;o de banda no tr&aacute;fego entre o servidor WWW e 
a rede interna.
<li>Dar prioridade maior ao tr&aacute;fego HTTP entre o servidor WWW e 
a Internet do que qualquer outro tr&aacute;fego (como transfer&ecirc;ncias FTP).
d778 4
a781 3
#   www_ext_http - tr&aacute;fego http do servidor WWW
#   www_ext_misc - todo tr&aacute;fego difetente de http do servidor WWW
# boss_ext       - tr&aacute;fego vindo do computador do chefe
d783 1
a783 1
queue std_ext        cbq(default)
d785 3
a787 3
  queue www_ext_http priority 3 cbq(red)
  queue www_ext_misc priority 1
queue boss_ext       priority 3
d802 3
a804 3
#   it_int   - tr&aacute;fego para a rede do TI.
#   boss_int - tr&aacute;fego para o PC do chefe.
# www_int    - tr&aacute;fego do servidor WWW na DMZ.
d807 1
a807 1
  queue std_int  cbq(default)
d809 2
a810 2
  queue boss_int priority 3
queue www_int    cbq(red)
d824 1
a824 1
#   net_dmz_http - tr&aacute;fego http.
d828 1
a828 1
queue internal_dmz      # nenhuma configura&ccedil;&atilde;o especial necess&aacute;ria
d830 2
a831 2
  queue net_dmz_http priority 3 cbq(red)
  queue net_dmz_misc priority 1 cbq(default)
d893 2
a894 2
Originally [OpenBSD: queueing.html,v 1.25 ]<br>                                                  
$Translation: queueing.html,v 1.2 2005/02/11 16:00:21 dsantos Exp $<br>                 
@


1.1
log
@sync with steelix translation CVS
@
text
@d14 1
a14 1
Copyright (c) 2003, 2004 Joel Knight <enabled@@myrealbox.com>
d38 1
a38 1
[<a href="anchors.html">Anterior: &Acirc;ncoras e Subconjuntos de Regras Nomeadas</a>]
d864 1
a864 1
[<a href="anchors.html">Anterior: &Acirc;ncoras e Subconjuntos de Regras Nomeadas</a>]
d874 2
a875 2
Originally [OpenBSD: queueing.html,v 1.24 ]<br>                                                  
$Translation: queueing.html,v 1.1 2005/01/04 17:09:07 dsantos Exp $<br>                 
@

