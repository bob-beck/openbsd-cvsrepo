head	1.17;
access;
symbols;
locks; strict;
comment	@# @;


1.17
date	2014.04.01.17.03.09;	author nick;	state dead;
branches;
next	1.16;

1.16
date	2013.12.06.20.52.47;	author ajacoutot;	state Exp;
branches;
next	1.15;

1.15
date	2013.06.04.14.28.29;	author ajacoutot;	state Exp;
branches;
next	1.14;

1.14
date	2013.05.08.05.30.07;	author ajacoutot;	state Exp;
branches;
next	1.13;

1.13
date	2013.05.06.20.25.55;	author ajacoutot;	state Exp;
branches;
next	1.12;

1.12
date	2013.01.18.07.15.55;	author ajacoutot;	state Exp;
branches;
next	1.11;

1.11
date	2010.06.19.07.38.08;	author ajacoutot;	state Exp;
branches;
next	1.10;

1.10
date	2009.11.08.22.09.17;	author tobias;	state Exp;
branches;
next	1.9;

1.9
date	2009.11.07.07.32.54;	author ajacoutot;	state Exp;
branches;
next	1.8;

1.8
date	2009.10.26.20.27.01;	author ajacoutot;	state Exp;
branches;
next	1.7;

1.7
date	2009.10.17.15.58.26;	author ajacoutot;	state Exp;
branches;
next	1.6;

1.6
date	2009.10.11.20.35.03;	author ajacoutot;	state Exp;
branches;
next	1.5;

1.5
date	2009.10.03.09.54.29;	author ajacoutot;	state Exp;
branches;
next	1.4;

1.4
date	2009.09.27.17.12.07;	author ajacoutot;	state Exp;
branches;
next	1.3;

1.3
date	2009.08.27.07.24.17;	author ajacoutot;	state Exp;
branches;
next	1.2;

1.2
date	2009.05.26.21.30.39;	author ajacoutot;	state Exp;
branches;
next	1.1;

1.1
date	2009.05.16.08.59.12;	author ajacoutot;	state Exp;
branches;
next	;


desc
@@


1.17
log
@
Abandon translations, per deraadt@@ and ajacoutot@@.
Thanks to all those that did the translation work, and my appologies to
those who had to translate my writing!
@
text
@<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>10 - Administração do Sistema</title>
<link rev= "made" href= "mailto:www@@openbsd.org">
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<meta name= "resource-type" content= "document">
<meta name= "description"   content= "OpenBSD FAQ 10 - System Management">
<meta name= "keywords"      content= "openbsd,faq10">
<meta name= "distribution"  content= "global">
<meta name= "copyright"     content= "This document copyright 1998-2013 by OpenBSD.">
</head>

<body bgcolor= "#ffffff" text= "#000000">

<a href="../../pt/index.html">
<img alt="[OpenBSD]" height=30 width=141 src="../../images/smalltitle.gif" border="0">
</a>
<p>
<font color= "#0000e0">
<a href= "index.html">[Índice da FAQ]</a>
<a href= "faq9.html">[Seção 9 - Migração para OpenBSD]</a>
<a href="faq11.html">[Seção 11 - O sistema X Window]</a>
</font>

<h1><font color="#e00000">10 - Administração do Sistema</font></h1>
<hr>

<p>
<h3>Conteúdo</h3>
<ul>
<li><a href="#wheel"         >10.1 - Quando eu tento me tornar root
    através do su, ele diz que estou no grupo errado.</a>
<li><a href="#DupFS"         >10.2 - Como duplicar um sistema de
    arquivos?</a>
<li><a href="#rc"            >10.3 - Como eu inicio daemons ao mesmo
    tempo que o sistema inicializa? (Visão geral do rc(8))</a>
<li><a href="#RelayingDenied">10.4 - Por que os usuários recebem a
    mensagem "relaying access denied" quando estão enviando correio
    eletrônico remotamente através do OpenBSD?</a>
<li><a href="#POP"           >10.5 - Eu configurei o POP, mas recebo
    erros quando acesso meu correio eletrônico através do POP. O que
    posso fazer?</a>
<li><a href="#SendmailDNS"   >10.6 - Por que o Sendmail ignora o arquivo
    /etc/hosts?</a>
<li><a href="#HTTPS"         >10.7 - Configuração de um Servidor HTTP
    Seguro com ssl(8)</a>
<li><a href="#vipw"          >10.8 - Eu fiz mudanças no arquivo
    /etc/passwd com um editor, mas as mudanças não tiveram efeito. Por
    quê?</a>
<li><a href="#AddDelUser"    >10.9 - Como eu adiciono um usuário? ou,
    como excluir um usuário?</a>
<li><a href="#FTPOnly"       >10.10 - Como eu crio uma conta somente
    para ftp?</a>
<li><a href="#Quotas"        >10.11 - Configuração de quotas de disco
    para usuários</a>
<li><a href="#Kerberos"      >10.12 - Configuração de Clientes e
    Servidores KerberosV</a>
<li><a href="#AnonFTP"       >10.13 - Configuração de um servidor FTP
    anônimo</a>
<li><a href="#ftpchroot"     >10.14 - Como confinar usuários em seus
    diretórios pessoais no ftpd(8)</a>
<li><a href="#Patches"       >10.15 - Como aplicar correções no OpenBSD</a>
<li><a href="#httpdchroot"   >10.16 - Me fala sobre o chroot(2) no
    Apache?</a>
<li><a href="#rootshell"     >10.17 - Posso mudar o shell do usuário
    root?</a>
<li><a href="#ksh"           >10.18 - O que mais posso fazer com o ksh?</a>
<li><a href="#Dir"           >10.19 - Serviços de diretório</a>
<ul>
  <li><a href="#Dir.available" >10.19.1 - Quais serviços de diretório
      estão disponíveis?</a>
  <li><a href="#YP_secure"     >10.19.2 - Considerações de segurança
      sobre YP</a>
  <li><a href="#YP_server"     >10.19.3 - Configuração de um servidor YP</a>
  <li><a href="#YP_client"     >10.19.4 - Configuração de um cliente YP</a>
</ul>
<li><a href="#locales"         >10.20 - Conjuntos de caracteres (charset) 
	e suporte a idioma nativo</a>
<ul>
  <li><a href="#charset"       >10.20.1 - Configurando o charset</a>
  <li><a href="#nls"           >10.20.2 - Alterando idioma utilizado em 
	mensagens das aplicações</a>
</ul>
</ul>

<hr>

<p>
<a name= "wheel"></a>
<h2>10.1 - Por que ele diz que estou no grupo errado quando eu tento
usar o su para me tornar root?</h2>

<p>
No OpenBSD, usuários que estão no grupo
<kbd>wheel</kbd> têm permissão para usar o
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=su&amp;sektion=1">su(1)</a>
para se tornarem root. 
Usuários que não estão no grupo <kbd>&quot;wheel&quot;</kbd> não 
podem usar o su(1). Caso contrário, o usuário receberá uma mensagem de 
erro como retorno.

<p>
Se você está criando um novo usuário com o
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=adduser&amp;sektion=8">adduser(8)</a>,
você pode colocá-lo no grupo wheel adicionando o nome do grupo wheel como resposta para
"<tt>Invite <i>user</i> into other groups:</tt>". Isso o adicionará
ao grupo e o arquivo /etc/group ficará parecido com:

<blockquote><pre>
wheel:*:0:root,ericj
</pre></blockquote>

<p>
Se você está procurando uma maneira de permitir aos usuários acesso
limitado aos privilégios de super usuário, sem colocá-los no grupo
<kbd>&quot;wheel&quot;</kbd>, use o
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sudo&amp;sektion=8">sudo(8)</a>.

<p>
<a name= "DupFS"></a>
<h2>10.2 - Como duplicar um sistema de arquivos?</h2>

<p>
Para duplicar seu sistema de arquivos, use o
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dump&amp;sektion=8">dump(8)</a>
e o
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=restore&amp;sektion=8">restore(8)</a>.
Por exemplo, para duplicar tudo que esteja no diretório <kbd>SRC</kbd>
para o diretório <kbd>DST</kbd>, faça um:

<blockquote><pre>
# <b>cd /SRC; dump 0f - . | (cd /DST; restore -rf - )</b>
</pre></blockquote>

<p>
dump é projetado para fornecer possibilidades de backup, e ele pode
ser exagerado se você apenas quer duplicar uma parte de um (ou todo o)
sistema de arquivos. O comando
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tar&amp;sektion=1">tar(1)</a>
pode ser mais rápido para essa operação. O formato é muito parecido com:

<blockquote><pre>
# <b>cd /SRC; tar cf -  . | (cd /DST; tar xpf - )</b>
</pre></blockquote>

<p>
<a name= "rc"></a>
<h2>10.3 - Como eu inicio daemons ao mesmo tempo que o
sistema inicializa? (Visão geral do rc(8))</h2>

O OpenBSD utiliza o estilo
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc&amp;sektion=8">rc(8)</a>
de inicialização. Esse estilo usa alguns arquivos-chave para a
inicialização.

<ul>
  <li>/etc/rc - Script principal. Não deve ser editado.
  <li>/etc/rc.conf - Arquivo de configuração usado pelo <i>/etc/rc</i>
      para definir os parâmetros de inicialização para o sistema.
      Não deve ser editado.
  <li>/etc/rc.conf.local - Arquivo de configuração que sobrescreve
      as configurações no /etc/rc.conf, assim você não precisa alterar o
      próprio /etc/rc.conf, o que é importante no momento da atualização
      de versão do seu sistema.
  <li>/etc/netstart - Script usado para inicializar a rede. Não deve ser
      editado.
  <li>/etc/rc.local - Script usado para a administração local. É onde
      novos daemons ou informações específicas da máquina podem ser
      alteradas.
  <li>/etc/rc.securelevel - Script que executa comandos que precisam ser
      executados antes das mudanças do nível de segurança. Veja
      <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=init&amp;sektion=8">init(8)</a>
  <li>/etc/rc.shutdown - Script executado no momento que o sistema está
      sendo desligado. Coloque nesse arquivo qualquer coisa que você
      quer que seja executada antes do shutdown. Veja
      <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc.shutdown&amp;sektion=8">rc.shutdown(8)</a>
</ul>

<h3>Como o rc(8) funciona?</h3>

<p>
Os arquivos principais que o administrador de sistema deve se concentrar
são: <i>/etc/rc.conf</i> (como guia), <i>/etc/rc.conf.local</i> (para
alterações), <i>/etc/rc.local</i> e <i>/etc/rc.shutdown</i>.
Para compreender o funcionamento do processo rc(8), veja o fluxo:

<p>
Depois que o kernel é inicializado, o <i>/etc/rc</i> é iniciado:
<ul>
  <li>Sistemas de arquivos são verificados.
  <li>Variáveis de configuração padrão são lidas do arquivo
      <i>/etc/rc.conf</i> e então as alterações àquelas variáveis são
      lidas do arquivo <i>/etc/rc.conf.local</i>.
      Configurações no rc.conf.local sobrescrevem aquelas do rc.conf.
  <li>Sistemas de arquivos são montados
  <li>O diretório <i>/tmp</i> é limpado e quaisquer arquivos de editor
      são preservados
  <li>Configura a rede através do <i>/etc/netstart</i>
  <ul>
    <li>Ativa suas interfaces.
    <li>Configura o nome da máquina, nome de domínio, etc.
  </ul>
  <li>Inicia os daemons do sistema
  <li>Faz várias outras verificações (quotas, savecore, etc.)
  <li>Executa-se o <i>/etc/rc.firsttime</i>
  <li>Executa-se o <i>/etc/rc.local</i>
  <li>Scripts em <i>/etc/rc.d</i> são executados.
</ul>

<h3>Inicialização de Daemons e Serviços do OpenBSD</h3>

<p>
A maioria dos daemons e serviços contidos no OpenBSD são controlados na
inicialização pelas variáveis definidas no arquivo de configuração
<i>/etc/rc.conf</i>.
Dê uma olhada no arquivo
<a href="http://www.openbsd.org/cgi-bin/cvsweb/~checkout~/src/etc/rc.conf?content-type=text/plain">/etc/rc.conf</a>.
Você verá linhas similares a esta:

<blockquote><pre>
ftpd_flags=NO           # for non-inetd use: ftpd_flags=""
</pre></blockquote>

<p>
Uma linha igual a essa mostra que o
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftpd&amp;sektion=8">ftpd(8)</a>
não é carregado com o sistema (pelo menos não como um daemon através do
rc(8); o ftpd na maioria das vezes é executado pelo
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=inetd&amp;sektion=8">inetd(8)</a>,
veja a
<a href="faq10.html#AnonFTP">FAQ sobre FTP anônimo</a> para ler mais
sobre isso).
Cada linha tem um comentário que mostra os sinalizadores para o uso
normal daquele daemon ou serviço.
Isso não significa que você deve executar aquele daemon ou serviço com
aqueles sinalizadores.
Leia a página de manual referente ao assunto para ver como você pode
ter aquele daemon ou serviço carregando de qualquer forma que você
quiser.

<p>
Nós recomendamos fortemente que você nunca toque no <i>/etc/rc.conf</i>.
Ao invés disso, crie o arquivo <i>/etc/rc.conf.local</i>, copie de
<i>/etc/rc.conf</i> apenas as linhas que você precisa alterar, e
ajuste-as do modo que quiser.
Isso torna as futuras atualizações de versão fáceis -- todas as
modificações/atualizações estão em um arquivo que não foi modificado 
por você.
De fato, o <a href="../upgrade54.html">processo de atualização de
versão</a> padrão assume que você não modificou o <i>/etc/rc.conf</i>
e sobrescreve-o com a nova versão do arquivo.

<p>
Por exemplo, esta é a linha padrão relacionada ao httpd(8).

<blockquote><pre>
httpd_flags=NO          # for normal use: "" (or "-DSSL" after reading ssl(8))
</pre></blockquote>

<p>
Aqui você pode ver que para carregar o httpd normalmente nenhum
sinalizador é necessário, então uma linha como <tt>httpd_flags=""</tt>
adicionada ao <i>/etc/rc.conf.local</i> cumpre a tarefa.
Mas para carregar o httpd com SSL ativo (consulte a
<a href="#HTTPS">FAQ sobre SSL</a> ou
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ssl&amp;sektion=8">ssl(8)</a>),
você começaria com uma linha como <tt>httpd_flags="-DSSL"</tt>, embora
você possa precisar adicionar outros parâmetros por outros motivos.

<h3>Inicialização de daemons e a configuração local</h3>

<p>
Para outros daemons que você deseja instalar no seu sistema através
de pacotes ou outros meios, você pode usar o arquivo
<i>/etc/rc.local</i>.
Por exemplo, eu instalei um daemon que se situa em
/usr/local/sbin/daemonx, e quero que ele carregue no momento da
inicialização. Eu poderia adicionar uma entrada no <i>/etc/rc.local</i> 
igual a esta:

<blockquote><pre>
if [ -x /usr/local/sbin/daemonx ]; then
	echo 'Starting daemonx'; /usr/local/sbin/daemonx
fi
</pre></blockquote>

<p>
(Se o daemon não se destaca automaticamente durante a inicialização,
lembre-se de adicionar um "&amp;" no fim da linha de comando.)

<p>
A partir de agora esse daemon será carregado no inicialização. Você será
capaz de ver qualquer erro na inicialização, sendo que uma inicialização
normal, sem erros, deve mostrar uma linha como esta:

<blockquote><pre>
Starting daemonx
</pre></blockquote>

<h3>O diretório <i>/etc/rc.d/</i></h3>
Desde o surgimento do OpenBSD 5.0, daemons de sistema ("services") 
são iniciados, parados e controlados através do 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc.d&amp;sektion=8"
><i>/etc/rc.d</i></a>.
Todos os daemons de sistema e a maioria dos 
<a href="faq15.html">pacotes adicionais</a> também são controlados através destes scripts.

<p>
Esses scripts (um para cada daemon) são chamados pelo <tt>rc</tt>. 
A ordem de execução dos daemons do sistema está presenta no código 
do <tt>rc</tt>, e a ordem de pacotes adicionais é controlada através 
da variável de ambiente <tt>pkg_scripts</tt>, que deve ser 
configurada no arquivo <tt>/etc/rc.conf.local</tt>.
Note que o simples fato de adicionar um script no diretório 
<tt>/etc/rc.d</tt> não o faz ser carregado automaticamente no 
processo de boot; o nome do script deve, também, ser especificado na 
variável <tt>pkg_scripts</tt> para que ele seja carregado durante 
o processo de boot do OpenBSD.

<p>
The starting of system scripts is determined by entries in the
<tt>/etc/rc.conf.local</tt> file.
For example, <tt>/etc/rc.d/httpd</tt> does not start
<a href="http://www.openbsd.org/cgi-bin/man.cgiquery=httpd&amp;sektion=8">httpd(8)</a>
unless <tt>/etc/rc.conf</tt> or <tt>/etc/rc.conf.local</tt> contains a
line defining the "<tt>httpd_flags</tt>" variable.
To help make sure your system will come up as expected on the next boot,
the <tt>rc.d</tt> scripts will not run their daemon if the appropriate
variable is not defined.
You can, of course, manually invoke <tt>/usr/sbin/httpd</tt> directly
with whatever options you wish, if you wish to run the program manually.

<p>
Perceba que em vez de ter cada script em <tt>/etc/rc.d</tt>, 
controlando todas as operações de startup, shutdown, reload, restart 
e check pode ser reduzida a uma especificação com muito poucas 
variáveis¿¿ com o uso do 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc.subr&amp;sektion=8">rc.subr</a>, 
que gerencia a maior parte dessas tarefas de forma padronizada no OpenBSD.

<p>
Por exemplo, o daemon de nossa aplicação <tt>daemonx</tt> pode ser 
iniciado através de um script presente em <tt>/etc/rc.d</tt> 
com o seguinte conteúdo:

<blockquote><pre>
#!/bin/sh

daemon="/usr/local/sbin/daemonx"

. /etc/rc.d/rc.subr

rc_cmd $1
</pre></blockquote>

Em seguida, adicionar o nome do script para gerenciamento do daemon a 
variável <tt>pkg_scripts</tt> em <tt>/etc/rc.conf.local</tt>.

<h3>rc.shutdown</h3>

<p>
<i>/etc/rc.shutdown</i> é um script que é executado no desligamento.
Qualquer tarefa que você queira fazer antes do sistema ser desligado
deve ser adicionada nesse arquivo. Se você usa o apm, você pode também
definir &quot;powerdown=YES&quot;. Isso é o equivalente do
&quot;shutdown -p&quot;.

<p>
<a name= "RelayingDenied"></a>
<h2>10.4 - Por que os usuários recebem a mensagem "relaying denied"
quando estão enviando correio eletrônico remotamente através do OpenBSD?</h2>

<p>
Tente isto:

<blockquote><pre>
# <b>grep relay-domains /etc/mail/sendmail.cf</b>
</pre></blockquote>

<p>
A saída talvez se pareça com esta:

<blockquote><pre>
FR-o /etc/mail/relay-domains
</pre></blockquote>

<p>
Se esse arquivo não existe, crie-o. Você precisa especificar as máquinas
que estão enviando correio eletrônico remotamente, com a seguinte
sintaxe:

<blockquote><pre>
.domain.com    #Allow relaying for/to any host in domain.com
sub.domain.com #Allow relaying for/to sub.domain.com and any host in that domain
10.2           #Allow relaying from all hosts in the IP net 10.2.*.*
</pre></blockquote>

<p>
Não se esqueça de enviar um sinal 'HangUP' para o sendmail (um sinal
que faz com que a maioria dos daemons leiam novamente seus arquivos
de configuração):

<blockquote><pre>
# <b>kill -HUP `head -1 /var/run/sendmail.pid`</b>
</pre></blockquote>

<p>

<h3>Para mais informações</h3>

<p>
<ul>
<li><a href="http://www.sendmail.org/~ca/email/relayingdenied.html">http://www.sendmail.org/~ca/email/relayingdenied.html</a>
<li><a href="http://www.sendmail.org/tips/relaying.php">http://www.sendmail.org/tips/relaying.php</a>
<li><a href="http://www.sendmail.org/antispam/">http://www.sendmail.org/antispam/</a>
</ul>

<p>
<a name= "POP"></a>
<h2>10.5 - Eu configurei o POP, mas recebo erros quando acesso meu
correio eletrônico através do POP. O que posso fazer?</h2>

<p>
A maioria dos problemas relacionados ao POP são problemas com arquivos
temporários e arquivos bloqueados. Se seu servidor POP envia uma
mensagem de erro do tipo:

<blockquote><pre>
-ERR Couldn't open temporary file, do you own it?
</pre></blockquote>

<p>
Tente configurar suas permissões do seguinte modo:

<blockquote><pre>
permissões em  /var
drwxrwxr-x   2 bin     mail     512 May 26 20:08 mail


permissões em  /var/mail
-rw-------   1 username   username        0 May 26 20:08 username
</pre></blockquote>

<p>
Outra coisa para verificar é se o usuário é realmente o dono de seu
arquivo em /var/mail. Normalmente esse deve ser o caso (por exemplo, o
dono de /var/mail/joe deveria ser o próprio usuário joe), mas se não
está definido corretamente, essa pode ser a causa do problema!

<p>
Normalmente, deixar o /var/mail com permissão de escrita para o grupo
"mail" cria alguns problemas de segurança. É provável que você nunca
terá problemas com ele, mas pode ter! (especialmente se seu sítio é de
grande volume, como um "ISP", ...) Existem vários servidores POP que
você pode instalar diretamente através da coleção de portes. Se
possível, use o
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=popa3d&amp;sektion=8">popa3d</a>,
que está disponível na instalação base do OpenBSD.
Também poderia ser o caso de uma seleção incorreta das opções para
o seu daemon pop. Ou você precisa apenas mudar o diretório em que ele
faz o bloqueio (embora o bloqueio somente seria de valor para o daemon
POP).

<p>
<b>Nota:</b> O OpenBSD não tem um grupo com o nome &quot;mail&quot;.
Você precisa criá-lo em seu arquivo <i>/etc/group</i> se você precisa
dele. Uma entrada como:

<blockquote><pre>
mail:*:6:
</pre></blockquote>

<p>
seria o suficiente.

<p>
<a name="SendmailDNS"></a>
<h2>10.6 - Por que o Sendmail ignora o arquivo <tt>/etc/hosts</tt>?</h2>

<p>
Por padrão, o Sendmail usa o serviço DNS para a resolução de nomes, e
não o arquivo <tt>/etc/hosts</tt>. Esse comportamento pode ser alterado
através do uso do arquivo <tt>/etc/mail/service.switch</tt>.

<p>
Se você deseja consultar o arquivo hosts antes dos servidores DNS,
crie o arquivo <tt>/etc/mail/service.switch</tt> e coloque nele a
seguinte linha:

<blockquote><pre>
hosts       files dns
</pre></blockquote>

<p>
Se você deseja consultar SOMENTE o arquivo hosts, use o seguinte:

<blockquote><pre>
hosts       files
</pre></blockquote>

<p>
Envie ao Sendmail um sinal HUP:

<blockquote><pre>
# <b>kill -HUP `head -1 /var/run/sendmail.pid`</b>
</pre></blockquote>

<p>
e as mudanças terão efeito.


<p>
<a name= "HTTPS"></a>
<h2>10.7 - Configuração de um servidor HTTP seguro com SSL(8)</h2>

<p>
O OpenBSD é distribuído com bibliotecas RSA e um servidor httpd
que suporta SSL. Para o uso com o
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=httpd&amp;sektion=8">httpd(8)</a>,
você primeiro precisa ter um certificado. O certificado será mantido em
<i>/etc/ssl/</i>, com a chave correspondente em
<i>/etc/ssl/private/</i>.
As etapas descritas aqui são, em partes, retiradas da página de manual
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ssl&amp;sektion=8">ssl(8)</a>;
utilize-a para obter mais informação.
Esta parte da FAQ é somente sobre a criação de um certificado RSA para
servidores Web, ela não descreve certificados de servidores DSA.
Para mais informações sobre como fazer isso, leia a página de manual
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ssl&amp;sektion=8">ssl(8)</a>.

<p>
Para começar, você precisa criar o certificado e a chave do seu servidor
usando o OpenSSL:

<blockquote><pre>
# <b>openssl genrsa -out /etc/ssl/private/server.key 2048</b>
</pre></blockquote>

<p>
Ou, se você deseja que a chave seja encriptada com uma frase secreta que
você terá que digitar quando iniciar os servidores

<blockquote><pre>
# <b>openssl genrsa -aes256 -out /etc/ssl/private/server.key 2048</b>
</pre></blockquote>

<p>
O próximo passo é gerar uma Requisição de Assinatura de Certificado, que
é utilizada para permitir que uma Autoridade de Certificação
(CA - "Certifying Authority") assine seu certificado. Para fazer isso,
use o comando:

<blockquote><pre>
# <b>openssl req -new -key /etc/ssl/private/server.key -out /etc/ssl/private/server.csr</b>
</pre></blockquote>

<p>
O arquivo <i>server.csr</i> pode então ser enviado a uma Autoridade de
Certificação que assinará a chave. Uma das Autoridades de Certificação
é a <b>Thawte Certification</b>, que você pode encontrar no endereço
<a href="http://www.thawte.com/">http://www.thawte.com/</a>.

<p>
Se você não pode fazer isso, ou simplesmente quer assinar o certificado
você mesmo, o seguinte comando pode ser usado.

<blockquote><pre>
# <b>openssl x509 -sha256 -req -days 365 -in /etc/ssl/private/server.csr \
       -signkey /etc/ssl/private/server.key -out /etc/ssl/server.crt</b>
</pre></blockquote>

<p>
Com os arquivos <i>/etc/ssl/server.crt</i> e
<i>/etc/ssl/private/server.key</i> no lugar certo, você deve então
iniciar o
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=httpd&amp;sektion=8">httpd(8)</a>
com o sinalizador <b>-DSSL</b> (veja a <a href="#rc">seção sobre o
rc(8)</a> nesta faq), ativando assim as transações https na porta 443 da
sua máquina.

<p>
<a name= "vipw"></a>
<h2>10.8 - Eu editei o arquivo /etc/passwd, mas as mudanças não tiveram
efeito. Por quê?</h2>

<p>
Se você editou diretamente o arquivo <i>/etc/passwd</i>, suas mudanças
serão perdidas.
O OpenBSD gera dinamicamente o arquivo <i>/etc/passwd</i> com o
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pwd_mkdb&amp;sektion=8">pwd_mkdb(8)</a>.
O arquivo de senhas principal no OpenBSD é o <i>/etc/master.passwd</i>.
De acordo com o pwd_mkdb(8),

<blockquote><pre>
FILES
     /etc/master.passwd  current password file
     /etc/passwd         a 6th Edition-style password file
     /etc/pwd.db         insecure password database file
     /etc/pwd.db.tmp     temporary file
     /etc/spwd.db        secure password database file
     /etc/spwd.db.tmp    temporary file
</pre></blockquote>

<p>
Em um arquivo de senhas tradicional do Unix, como o /etc/passwd, tudo e
inclusive a senha criptografada do usuário está disponível para qualquer
um no sistema (e é o primeiro alvo para programas como o "Crack").
O 4.4BSD introduziu o arquivo master.passwd, que possui um formato
estendido (com opções adicionais além daquelas fornecidas pelo
/etc/passwd) e somente pode ser lido pelo usuário root. Para acesso
rápido aos dados, as chamadas de bibliotecas que acessam esses dados
normalmente leem os arquivos /etc/pwd.db e /etc/spwd.db.

<p>
O OpenBSD inclui uma ferramenta para a edição do arquivo de senhas.
Essa ferramenta é chamada
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=vipw&amp;sektion=8">vipw(8)</a>.
Vipw usa o vi (ou seu editor favorito definido por $EDITOR) para
editar o arquivo /etc/master.passwd. Após a modificação, ele recria
/etc/passwd, /etc/pwd.db e /etc/spwd.db, conforme as mudanças que você
tenha feito.
Vipw também se encarrega de bloquear esses arquivos, de modo que se
alguém tentar mudá-los ao mesmo tempo, o acesso é negado.

<p>
<a name= "AddDelUser"></a>
<h2>10.9 - Qual é a melhor forma de adicionar e excluir usuários?</h2>

<p>
O OpenBSD fornece dois comandos para a adição fácil de usuários no
sistema:

<ul>
<li><a href="#adduser">adduser(8)</a>
<li><a href="#user">user(8)</a>
</ul>

Você também pode adicionar manualmente os usuários, usando o
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=vipw&amp;sektion=8">vipw(8)</a>,
mas na maioria das operações isso é mais difícil.

<a name="adduser"></a>
<p>
A forma mais fácil de adicionar um usuário no OpenBSD é usando o script
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=adduser&amp;sektion=8">adduser(8)</a>.
Você pode configurar o adduser(8) através da edição do arquivo
<i>/etc/adduser.conf</i>.
O adduser(8) permite verificações consistentes em <i>/etc/passwd</i>,
<i>/etc/group</i> e no banco de dados de shell. Ele cria as entradas
e o diretório $HOME para você. É possível enviar uma mensagem de
boas vindas ao usuário. Este é um exemplo de usuário, <b>testuser</b>,
sendo adicionado no sistema.
Ele(a) terá o diretório $HOME em <i>/home/testuser</i>, fará parte
do grupo <b>guest</b>, e terá o shell <i>/bin/ksh</i>.

<blockquote><pre>
# <b>adduser</b>
Use option ``-silent'' if you don't want to see all warnings and questions.

Reading /etc/shells
Check /etc/master.passwd
Check /etc/group

Ok, let's go.
Don't worry about mistakes. There will be a chance later to correct any input.
Enter username []: <b>testuser</b>
Enter full name []: <b>Test FAQ User</b>
Enter shell csh ksh nologin sh [ksh]: <b>ksh</b>
Uid [1002]: <b><i>Enter</i></b>
Login group testuser [testuser]: <b>guest</b>
Login group is ``guest''. Invite testuser into other groups: guest no 
[no]: <b>no</b>
Login class authpf daemon default staff [default]: <b><i>Enter</i></b>
Enter password []: <b><i>Digite a senha e tecle Enter</i></b>
Enter password again []: <b><i>Digite a senha e tecle Enter</i></b>

Name:        testuser
Password:    ****
Fullname:    Test FAQ User
Uid:         1002
Gid:         31 (guest)
Groups:      guest
Login Class: default
HOME:        /home/testuser
Shell:       /bin/ksh
OK? (y/n) [y]: <b>y</b>
Added user ``testuser''
Copy files from /etc/skel to /home/testuser
Add another user? (y/n) [y]: <b>n</b>
Goodbye!
</pre></blockquote>

<p>
Para excluir usuários você deve usar o utilitário
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rmuser&amp;sektion=8">rmuser(8)</a>.
Este remove toda a existência de um usuário. Ele remove qualquer
entrada no
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=crontab&amp;sektion=1">crontab(1)</a>,
o diretório $HOME (se o usuário em questão for o proprietário do
diretório) e suas mensagens de correio eletrônico.
Naturalmente, ele também remove as entradas nos arquivos
<i>/etc/passwd</i> e <i>/etc/group</i>. O próximo exemplo é a remoção do
usuário que foi adicionado acima. Repare que você será perguntado pelo
nome, e se quer ou não remover o diretório pessoal do usuário.

<blockquote><pre>
# <b>rmuser</b>
Enter login name for user to remove: <b>testuser</b>
Matching password entry:

testuser:$2a$07$ZWnBOsbqMJ.ducQBfsTKUe3PL97Ve1AHWJ0A4uLamniLNXLeYrEie:1002
:31::0:0:Test FAQ User:/home/testuser:/bin/ksh

Is this the entry you wish to remove? <b>y</b>
Remove user's home directory (/home/testuser)? <b>y</b>
Updating password file, updating databases, done.
Updating group file: done.
Removing user's home directory (/home/testuser): done.
</pre></blockquote>

<a name="user"></a>
<h3>Como adicionar usuários através do user(8)</h3>

<p>
Estas ferramentas são menos interativas que o comando
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=adduser&amp;sektion=8">adduser(8)</a>,
o que as tornam fáceis de serem usadas em scripts.

<p>
A lista completa de ferramentas:
<ul>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=group&amp;sektion=8">group(8)</a>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=groupadd&amp;sektion=8">groupadd(8)</a>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=groupdel&amp;sektion=8">groupdel(8)</a>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=groupinfo&amp;sektion=8">groupinfo(8)</a>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=groupmod&amp;sektion=8">groupmod(8)</a>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=user&amp;sektion=8">user(8)</a>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=useradd&amp;sektion=8">useradd(8)</a>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=userdel&amp;sektion=8">userdel(8)</a>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=userinfo&amp;sektion=8">userinfo(8)</a>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=usermod&amp;sektion=8">usermod(8)</a>
</ul>

<h4>Como realmente adicionar usuários</h4>

<p>
O comando <i>/usr/sbin/user</i> é apenas uma interface para o resto dos
comandos <i>/usr/sbin/user*</i>. Portanto, os comandos seguintes podem
ser utilizados como <b>user add</b> ou <b>useradd</b>, de modo que
depende da sua escolha qual utilizar, e não altera o resultado dos
comandos.
Lembre-se que o comando user(8) não é interativo, a maneira mais fácil de
adicionar eficientemente usuários é através do comando adduser(8). 

<p>
O comando useradd(8) é menos assustador se você já sabe a
configuração padrão antes de adicionar o usuário. Essas configurações
estão localizadas em 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=usermgmt.conf&amp;sektion=5">usermgmt.conf(5)</a>, 
e podem ser visualizadas com o comando:

<blockquote><pre>
$ <b>user add -D</b>
group           users
base_dir        /home
skel_dir        /etc/skel
shell           /bin/csh
inactive        0
expire          Null (unset)
range           1000..60000
</pre></blockquote>

<p>
As configurações acima serão as utilizadas, a menos que você especifique
uma configuração diferente com as opções da linha de comando. Por
exemplo, no nosso caso, queremos que o usuário pertença ao grupo
<b>guest</b>, e não ao grupo <b>users</b>.
Um pequeno obstáculo ao adicionar usuários é que as senhas precisam
ser especificadas na linha de comando. As senhas devem ser
criptografadas, então primeiro você precisa usar o utilitário
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=encrypt&amp;sektion=1">encrypt(1)</a>
para criar a senha. Por exemplo: as senhas do OpenBSD usam por padrão
o algoritmo Blowfish em 6 "rounds".
Esta é uma linha de exemplo para criar uma senha encriptada para ser
especificada ao useradd(8).

<blockquote><pre>
$ <b>encrypt -p -b 6</b>
Enter string:
$2a$06$YOdOZM3.4m6MObBXjeZtBOWArqC2.uRJZXUkOghbieIvSWX
</pre></blockquote>

<p>
Agora que temos nossa senha encriptada, já estamos prontos para
adicionar o usuário.
Vamos adicionar o mesmo usuário com as mesmas especificações que 
adicionamos <a href="#adduser">acima</a>, desta vez via adduser(8).

<blockquote><pre>
# <b>user add -p '$2a$06$YOdOZM3.4m6MObBXjeZtBOWArqC2.uRJZXUkOghbieIvSWX' -u 1002 \
-s /bin/ksh -c "Test FAQ User" -m -g guest testuser</b>
</pre></blockquote>

<p>
<b>Nota:</b> Tenha certeza que você está usando '&nbsp;' (aspas simples)
em ambos os lados da senha, e não &quot;&nbsp;&quot; (aspas duplas),
já que estas serão interpretadas pelo shell antes de serem enviadas
para o user(8). Em adição, tenha certeza de especificar a opção
<b>-m</b> se você quer que o diretório pessoal do usuário seja criado
e os arquivos de <i>/etc/skel</i> sejam copiados para lá.

<p>
Para ver se o usuário foi criado corretamente, podemos usar vários
utilitários diferentes. Abaixo estão alguns comandos que você pode
usar para verificar rapidamente se tudo foi criado corretamente.

<blockquote><pre>
$ <b>ls -la /home</b>
total 14
drwxr-xr-x   5 root      wheel   512 May 12 14:29 .
drwxr-xr-x  15 root      wheel   512 Apr 25 20:52 ..
drwxr-xr-x  24 ericj     wheel  2560 May 12 13:38 ericj
drwxr-xr-x   2 testuser  guest   512 May 12 14:28 testuser
$ <b>id testuser</b>
uid=1002(testuser) gid=31(guest) groups=31(guest)
$ <b>finger testuser</b>
Login: testuser                         Name: Test FAQ User
Directory: /home/testuser               Shell: /bin/ksh
Last login Sat Apr 22 16:05 (EDT) on ttyC2
No Mail.
No Plan.
</pre></blockquote>

<p>
Em adição a tais comandos, o user(8) provê seu próprio utilitário para
mostrar as características do usuário, chamado de userinfo(8).

<blockquote><pre>
$ <b>userinfo testuser</b>
login   testuser
passwd  *
uid     1002
groups  guest
change  Wed Dec 31 19:00:00 1969
class
gecos   Test FAQ User
dir     /home/testuser
shell   /bin/ksh
expire  Wed Dec 31 19:00:00 1969
</pre></blockquote>

<h4>Como excluir usuários</h4>

<p>
Para remover usuários com a hierarquia de comandos user(8), você usa
o comando userdel(8). Ele é muito simples, mas um comando útil. Para
remover o usuário criado no último exemplo, basta executar:

<blockquote><pre>
# <b>userdel -r testuser</b>
</pre></blockquote>

<p>
Note a opção <b>-r</b>, que precisa ser especificada se você quer que o
diretório pessoal do usuário também seja excluído. Alternativamente,
você pode especificar <b>-p</b> e não <b>-r</b>, e assim a conta do
usuário será bloqueada, mas nenhuma informação será eliminada.

<p>
<a name= "FTPOnly"></a>
<h2>10.10 - Como eu crio uma conta somente para ftp (que não seja
FTP anônimo)?</h2>

<p>
Existem alguns meios de se fazer isso, mas um modo muito comum é
adicionar "<tt>/usr/bin/false</tt>" no arquivo "<tt>/etc/shells</tt>".
Então quando você configurar o shell dos usuários para
"<tt>/usr/bin/false</tt>", eles não serão capazes de iniciar uma sessão
interativa no sistema, mas serão capazes de usar o serviço ftp.
Você talvez queira também restringir o acesso
<a href="#ftpchroot">confinando os usuários em seus diretórios pessoais
no ftpd</a>.


<p>
<a name= "Quotas"></a>
<h2>10.11 - Configuração de quotas de disco</h2>

<p>
Quotas são utilizadas para limitar o espaço de disco disponível para os
usuários. O sistema pode ser muito útil em situações onde você tem
recursos limitados. Quotas podem ser configuradas por usuário e/ou por
grupo.

<p>
O primeiro passo para configurar as quotas é ter certeza que
"<tt>option QUOTA</tt>" está na <a href="faq5.html#Options">configuração
do kernel</a>. Essa opção está no kernel GENERIC. Depois disso, você
precisa marcar no
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=fstab&amp;sektion=5"><tt>/etc/fstab</tt></a>
os sistemas de arquivos que terão as quotas ativadas.
As palavras-chave <tt>userquota</tt> e <tt>groupquota</tt> devem ser
usadas para marcar cada sistema de arquivos que você vai utilizar
quotas.
Por padrão, os arquivos <tt>quota.user</tt> e <tt>quota.group</tt>
serão criados na raiz daquele sistema de arquivo para guardar
informações sobre quotas. Esse padrão pode ser modificado especificando
o nome do arquivo com a opção quota em <tt>/etc/fstab</tt>, como em
"<tt>userquota=/var/quotas/quota.user</tt>".
Este é um exemplo de <tt>/etc/fstab</tt> que tem um sistema de arquivos
com quotas ativas, e o arquivo de quotas em uma localização não padrão:

<blockquote><pre>
/dev/wd0a / ffs rw,userquota=/var/quotas/quota.user 1 1
</pre></blockquote>

<p>
Agora é hora de configurar as quotas do usuário. Para esse fim, nós
utilizamos o utilitário
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=edquota&amp;sektion=8">edquota(8)</a>.
Um uso simples é "<tt>edquota&nbsp;&lt;usuário&gt;</tt>". edquota(8)
utiliza o vi(1) para editar as quotas, a menos que a variável de
ambiente EDITOR esteja definida para um editor diferente. Por exemplo, o
comando:

<blockquote><pre>
# <b>edquota ericj</b>
</pre></blockquote>

<p>
Mostra uma saída similar a esta:

<blockquote><pre>
Quotas for user ericj:
/: KBytes in use: 62, limits (soft = 0, hard = 0)
        inodes in use: 25, limits (soft = 0, hard = 0)
</pre></blockquote>

<p>
Para adicionar limites, faça a edição para obter um resultado similar a
este:

<blockquote><pre>
Quotas for user ericj:
/: KBytes in use: 62, limits (soft = 1000, hard = 1050)
        inodes in use: 25, limits (soft = 0, hard = 0)
</pre></blockquote>

<p>
Note que a alocação de quotas está em blocos de 1k.
Nesse caso, o limite mínimo está fixado em 1000k e o limite máximo em
1050k. Um limite mínimo é um limite onde o usuário é avisado quando o
ultrapassa, e tem um período de graça para reduzir seu uso do disco para
abaixo do seu limite. Os períodos de graça podem ser configurados usando
a opção <b>-t</b> do edquota(8). Depois que o perído de graça termina,
o limite mínimo é manipulado como limite máximo. O resultado é uma falha
de alocação.

<p>
Agora que as quotas estão configuradas, você precisa ativá-las.
Para fazer isso, use o comando
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=quotaon&amp;sektion=8">quotaon(8)</a>.
Por exemplo:

<blockquote><pre>
# <b>quotaon -a</b>
</pre></blockquote>

<p>
Esse comando lê o <tt>/etc/fstab</tt> para ativar os sistemas de
arquivos com as opções de quota. Agora que as quotas estão funcionando,
você pode vê-las usando o comando
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=quota&amp;sektion=1">quota(1)</a>.
O uso do comando "<tt>quota &lt;usuário&gt;</tt>" mostra-lhe a
informação do usuário. Quando chamado sem nenhum argumento, o comando
quota(1) mostra-lhe suas estatísticas de quota. Por exemplo:

<blockquote><pre>
# <b>quota ericj</b>
</pre></blockquote>

<p>
Mostra um resultado como este:

<blockquote><pre>
Disk quotas for user ericj (uid 1001): 
     Filesystem  blocks   quota   limit   grace   files   quota   limit   grace
              /      62    1000    1050              27       0       0        
</pre></blockquote>

<p>
Por padrão, as quotas configuradas em <tt>/etc/fstab</tt> são
carregadas na inicialização. Para desligá-las, use:

<blockquote><pre>
# <b>quotaoff -a</b>
</pre></blockquote>

<p>
<a name= "Kerberos"></a>
<h2>10.12 - Configuração de Clientes e Servidores KerberosV</h2>

<p>
O OpenBSD inclui o KerberosV como um componente pré-instalado do sistema
padrão.

<p>
Para mais informações sobre o KerberosV a partir do seu sistema
OpenBSD, use o comando:
<blockquote><pre>
# <b>info heimdal</b>
</pre></blockquote>


<p>
<a name= "AnonFTP"></a>
<h2>10.13 - Configuração de um servidor FTP anônimo</h2>

<p>
O FTP anônimo permite que usuários sem contas acessem arquivos no seu
computador através do Protocolo de Transferência de Arquivos (FTP -
"File Transfer Protocol"). Esta seção oferece um resumo sobre como
configurar um servidor FTP anônimo, seu registro de dados, etc.

<h3>Criação de uma conta FTP</h3>

<p>
Para começar, você precisa ter uma conta <i>ftp</i> em seu sistema.
Essa conta não deve ter uma senha usável. Neste exemplo, nós iremos
configurar o diretório de início de sessão como /home/ftp, mas você
pode colocá-lo em qualquer lugar que quiser.
Quando o ftp anônimo é utilizado, o daemon ftp vai se confinar
(chroot) no diretório pessoal do usuário <i>ftp</i>. Para saber mais
sobre isso, leia as páginas de manual
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftpd&amp;sektion=8">ftpd(8)</a> e
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=chroot&amp;sektion=2">chroot(2)</a>.
Este é um exemplo de como criar o usuário <i>ftp</i>.
Para isso, usaremos o
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=adduser&amp;sektion=8">adduser(8)</a>.
Nós também precisamos adicionar /usr/bin/false no nosso arquivo
<i>/etc/shells</i>; esse será o &quot;shell&quot; que daremos ao
usuário <i>ftp</i>.
Isso não permite que ele inicie sessão, mesmo dando uma senha vazia.
Para isso, você pode simplesmente fazer o seguinte:

<blockquote><pre>
echo /usr/bin/false &gt;&gt; /etc/shells
</pre></blockquote>

Depois disso, você está pronto para adicionar o usuário <i>ftp</i>:

<blockquote><pre>
# <b>adduser</b>
Use option ``-silent'' if you don't want to see all warnings and questions.

Reading /etc/shells
Check /etc/master.passwd
Check /etc/group

Ok, let's go.
Don't worry about mistakes. There will be a chance later to correct any input.
Enter username []: <b>ftp</b>
Enter full name []: <b>anonymous ftp</b>
Enter shell csh false ksh nologin sh [ksh]: <b>false</b>
Uid [1002]: <b><i>Enter</i></b>
Login group ftp [ftp]: <b><i>Enter</i></b>
Login group is ``ftp''. Invite ftp into other groups: guest no 
[no]: <b>no</b>
Login class authpf daemon default staff [default]: <b><i>Enter</i></b>
Enter password []: <b><i>Enter</i></b>
Set the password so that user cannot logon? (y/n) [n]: <b>y</b>

Name:        ftp
Password:    ****
Fullname:    anonymous ftp
Uid:         1002
Gid:         1002 (ftp)
Groups:      ftp
Login Class: default
HOME:        /home/ftp
Shell:       /usr/bin/false
OK? (y/n) [y]: <b>y</b>
Added user ``ftp''
Copy files from /etc/skel to /home/ftp
Add another user? (y/n) [y]: <b>n</b>
Goodbye!
</pre></blockquote>

<h3>Configuração do diretório</h3>

<p>
Junto com o usuário, isso criou o diretório <i>/home/ftp</i>. É o que
queremos, mas existem algumas mudanças que temos que fazer para torná-lo
pronto para o ftp anônimo. Novamente, essas mudanças são explicadas na
página de manual
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftpd&amp;sektion=8">ftpd(8)</a>.

<p>
Você <b>não</b> precisa criar o diretório /home/ftp/usr ou
/home/ftp/bin.
<ul>
<li><i>/home/ftp</i> - Esse é o diretório principal. Seu proprietário
    deve ser o root, e deve ter a permissão 555.
<li><i>/home/ftp/etc</i> - É totalmente opcional e não é recomendado,
    sendo que ele somente serve para dar informações sobre os usuários
    existentes no sistema. Se você quer que seu diretório ftp anônimo
    pareça ter usuários reais associados aos arquivos, você deve copiar
    os arquivos /etc/pwd.db e /etc/group para esse diretório. Esse
    diretório deve estar no modo 511, e os dois arquivos devem estar no
    modo 444. Eles são usados para mostrar os nomes dos proprietários no
    lugar dos números. Não existem senhas guardadas no arquivo pwd.db,
    elas estão todas no spwd.db, então não copie este arquivo.
<li><i>/home/ftp/pub</i> - Esse é o diretório para colocar os arquivos
    que você deseja compartilhar. Esse diretório também deve estar no
    modo 555.
</ul>

<p>
Note que todos esses diretórios devem ser de propriedade de ''root''.
Esta é uma lista de como os diretórios devem se parecer após criados.

<blockquote><pre>
# pwd
/home
# ls -laR ftp
total 5
dr-xr-xr-x  5 root  ftp    512 Jul  6 11:33 .
drwxr-xr-x  7 root  wheel  512 Jul  6 10:58 ..
dr-x--x--x  2 root  ftp    512 Jul  6 11:34 etc
dr-xr-xr-x  2 root  ftp    512 Jul  6 11:33 pub

ftp/etc:
total 43
dr-x--x--x  2 root  ftp    512 Jul  6 11:34 .
dr-xr-xr-x  5 root  ftp    512 Jul  6 11:33 ..
-r--r--r--  1 root  ftp    316 Jul  6 11:34 group
-r--r--r--  1 root  ftp  40960 Jul  6 11:34 pwd.db

ftp/pub:
total 2
dr-xr-xr-x  2 root  ftp  512 Jul  6 11:33 .
dr-xr-xr-x  5 root  ftp  512 Jul  6 11:33 ..
</pre></blockquote>

<h3>Inicialização do servidor e do registro de dados</h3>

<p>
Você pode escolher como iniciar o ftpd, tanto pelo
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=inetd&amp;sektion=8">inetd(8)</a>
ou a partir dos scripts
<a href="#rc">rc</a>.
Estes exemplos mostram nosso daemon sendo iniciado a partir do
inetd.conf.
Mas, antes, precisamos nos familiarizar com algumas das opções do ftpd.
A linha padrão do <i>/etc/inetd.conf</i> é:

<blockquote><pre>
<b>ftp             stream  tcp     nowait  root    /usr/libexec/ftpd       ftpd -US</b>
</pre></blockquote>

<p>
Como você pode ver, o ftpd é executado com <i>-US</i>. Isso registra as
conexões anônimas em <i>/var/log/ftpd</i> e as sessões concorrentes em
<i>/var/run/utmp</i>. Desse modo, poderemos ver essas sessões com o
comando who(1). É possível que alguns queiram apenas ter um servidor
anônimo, e desativar o ftp para usuários. Para isso, você deve executar
o ftpd com a opção <i>-A</i>. Aqui temos uma linha que inicia o ftpd
somente para conexões anônimas. Ele também usa <i>-ll</i> para fazer o
registro de cada conexão usando o syslog, junto com os comandos "get",
"retrive", etc. do ftp.

<blockquote><pre>
<b>ftp             stream  tcp     nowait  root    /usr/libexec/ftpd       ftpd -llUSA</b>
</pre></blockquote>

<p>
<b>Nota:</b> Para aqueles que usam servidores ftp de ALTO tráfego,
pode-se não querer executar o ftpd a partir do inetd.conf. A melhor
opção é comentar a linha ftpd do inetd.conf e iniciar o ftpd a partir do
rc.conf.local.
Isso inicia o ftpd como um daemon, e será mais simples e rápido
do que iniciar pelo inetd.
Esta é uma linha de exemplo para iniciá-lo a partir do rc.conf.local:

<blockquote><pre>
ftpd_flags="llUSA"           # for non-inetd use: ftpd_flags=""
</pre></blockquote>

<p>
Evidentemente, somente funciona se você retirou (comentou) o ftpd do
<i>/etc/inetd.conf</i> e fez com que o inetd lesse novamente o arquivo
de configuração.

<p>
Não é necessário passar opções de inicialização adicionais para o 
ftpd permitir conexões anônimas.
As etapas anteriores de criação do usuário 'ftp' e configuração dos
diretórios relevantes com as permissões corretas são suficientes.
No entanto, para impedir conexões anônimas, não é necessário desfazer tudo.
Basta reiniciar o ftpd com a opção  <b>-n</b> e conexões anônimas 
serão, então, desabilitadas.

<h3>Outros arquivos importantes</h3>

<ul>
<li><i>/etc/ftpwelcome</i> - Contém a mensagem de bem-vindo para as
    pessoas que se conectarem ao seu servidor ftp.
<li><i>/etc/motd</i> - Contém a mensagem que as pessoas veem após terem
    se conectado corretamente ao seu servidor ftp.
<li><i>.message</i> - Esse arquivo pode ser colocado em qualquer
    diretório. Ele é mostrado quando o usuário entra naquele
    diretório.
</ul>


<p>
<a name= "ftpchroot"></a>
<h2>10.14 - Como confinar usuários em seus diretórios pessoais no ftpd(8)</h2>

<p>
Por padrão, quando os usuários se conectam por ftp, eles podem ir para
qualquer diretório que tenham acesso no sistema de arquivos.
Isso pode não ser desejável em certas ocasiões.
É possível restringir o que os usuários podem ver em uma sessão ftp,
confinando os usuários em seus diretórios pessoais usando o chroot.

<p>
Se você quer permitir conexões ftp somente em chroot, utilize a opção
<b>-A</b> do
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftpd&amp;sektion=8">ftpd(8)</a>.

<p>
Se você quer usar o chroot de maneira mais fina, a
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=login.conf&amp;sektion=5">
infraestrutura de capacidades de início de sessão</a> e o
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftpd&amp;sektion=8">ftpd(8)</a>
do OpenBSD tornam isso fácil.
<p>

Os usuários em uma classe de início de sessão com a variável
<tt>ftp-chroot</tt> definida são confinados automaticamente.
Adicionalmente, você pode adicionar um nome de usuário no arquivo
<b>/etc/ftpchroot</b> para confinar apenas os usuários que tenham seus
nomes nesse arquivo.
Um usuário somente precisa ser listado em um desses lugares.


<p>
<a name= "Patches"></a>
<h2>10.15 - Como aplicar correções no OpenBSD</h2>

<p>
Mesmo no OpenBSD, erros acontecem.
Alguns problemas podem levar à problemas de confiabilidade (ou seja,
algumas vezes pode fazer com que o sistema pare de funcionar como
desejado). Outros problemas podem levar à vulnerabilidades de segurança
(que pode permitir que outros "usem" seu computador de maneira
não desejada e sem autorização).
Quando uma falha crítica é encontrada, a correção é integrada na
árvore de código fonte <i>-current</i>, e as correções são lançadas para
as <a href="faq5.html#Flavors">releases suportadas</a> do OpenBSD.
Essas correções aparecem na <a href="../../errata.html">página Web das
erratas</a>, e são separadas em correções "commom", aplicáveis em
todas as <a href="../../pt/plat.html">plataformas</a>, e em correções
aplicáveis em uma ou mais plataformas, mas não em todas.

<p>
Note, no entanto, que as correções não são publicadas de modo a fornecer
novas funcionalidades ou suportes a novos hardwares ao OpenBSD, 
elas são feitas somente para correções importantes de
confiabilidade ou problemas de segurança, que devem ser conduzidos
de maneira correta nos sistemas afetados (que frequentemente NÃO são
todos os sistemas, dependendo dos propósitos).

<p>
Existem três jeitos de atualizar seu sistema com código fonte corrigido:

<ul>
<li><b>Atualizar a versão do seu sistema para a versão
    <a href="../current.html"><i>-current</i></a>.</b>
    Como todas as correções são aplicadas na base de código fonte
    <i>-current</i>, atualizar seu sistema para a última snapshot
    disponível é uma boa forma de aplicar o código fonte corrigido.
    Entretanto, usar a versão <i>-current</i> não é para qualquer um.
<li><b>Atualizar seu sistema para a versão
    <a href="../../pt/stable.html"><i>-stable</i></a>.</b>
    Isso é feito através do download ou atualização da árvore de
    código fonte usando o ramo <i>-stable</i> apropriado, e recompilando
    o kernel e os utilitários do resto do sistema.
    Em geral, esse é provavelmente o modo mais fácil, mas leva um tempo
    para a recompilação, e o "checkout" completo do código fonte pode
    levar um bom tempo se você tem uma banda de rede limitada.
<li><b>Corrigir, compilar e instalar os arquivos afetados
    individualmente.</b>
    Isso é o que usaremos no nosso exemplo abaixo.
    Enquanto isso requer menos banda de rede e tipicamente menos tempo
    que um checkout/update através do cvs(1) e a compilação do código
    fonte, algumas vezes é a opção mais difícil, já que não existe um
    conjunto universal de instruções a seguir.
    Algumas vezes você deve corrigir, recompilar e instalar um
    aplicativo, outras vezes você tem que recompilar seções inteiras
    da árvore se o problema está em um arquivo de biblioteca.
</ul>

Novamente, corrigir arquivos individuais não é sempre simples, então
pense seriamente em seguir o ramo
<a href="../../pt/stable.html"><i>-stable</i></a> (ou "patch") do
OpenBSD.
Misturar e combinar soluções de correção podem ser feitas se você
entende como tudo funciona, mas novos usuários devem escolher um método
a seguir.

<h3>Quais são as diferenças entre as correções da página das erratas
e aquelas que estão na árvore CVS?</h3>

<p>
Todas as correções postadas na
<a href="../../errata.html">página Web das erratas</a> são correções
feitas na árvore de código fonte da release indicada. Correções na
árvore CVS atual também incluem outras mudanças que não são desejadas em
um sistema de produção.
Isto é importante: se você instalar uma snapshot, fizer o download da
árvore de código fonte no momento em que você obteve a snapshot, e
tentar aplicar uma correção usando um arquivo de correção publicado,
você vai ver que ele não é aplicado, já que o código pode ter mudado.



<h3>Como aplicar as correções.</h3>

<p>
As correções do OpenBSD são distribuídas em diffs unificados
("Unified diffs"), que são arquivos de texto que guardam as diferenças
em relação ao código fonte original.
Elas <b>NÃO</b> são distribuídas em formato binário.
Isso significa que para aplicar as correções no
seu sistema, você precisa ter o código fonte da versão
<b>RELEASE</b> do OpenBSD à vossa disposição.
Geralmente, você deve ter à disposição a árvore de código fonte
completa.
Se você está usando a versão release adquirida em um CD-ROM
oficial, as árvores de código fonte estão disponíveis no disco 3, elas
também estão disponíveis como arquivos nos
<a href="../../ftp.html">servidores FTP</a>.
Iremos assumir que você tem a árvore de código fonte completa à
disposição.

<p>
No nosso exemplo, nós vamos olhar a correção 001 para o OpenBSD 3.6,
relacionada ao driver
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=st&amp;sektion=4">st(4)</a>,
que controla drives de fitas magnéticas ("tape drives").
Sem esta correção, restaurar dados de backups seria um pouco difícil.
As pessoas que usam um drive de fitas magnéticas <i>precisam</i> desta
correção; no entanto, pessoas que não utilizem firas magnéticas podem 
não ter a necessidade de instalar esta correção.
Vamos olhar a correção:

<blockquote><pre>
# <b>more 001_st.patch</b>
Apply by doing:
        cd /usr/src
        patch -p0 < 001_st.patch

Rebuild your kernel.

Index: sys/scsi/st.c
===================================================================
RCS file: /cvs/src/sys/scsi/st.c,v
retrieving revision 1.41
retrieving revision 1.41.2.1
diff -u -p -r1.41 -r1.41.2.1
--- sys/scsi/st.c       1 Aug 2004 23:01:06 -0000       1.41
+++ sys/scsi/st.c       2 Nov 2004 01:05:50 -0000       1.41.2.1
@@@@ -1815,7 +1815,7 @@@@ st_interpret_sense(xs)
        u_int8_t skey = sense->flags & SSD_KEY;
        int32_t info;
 
-       if (((sense->flags & SDEV_OPEN) == 0) ||
+       if (((sc_link->flags & SDEV_OPEN) == 0) ||
            (serr != 0x70 && serr != 0x71))
                return (EJUSTRETURN); /* let the generic code handle it */
</pre></blockquote>

Como você pode ver, no começo do arquivo de correção é incluído breves
instruções sobre como aplicá-lo.
Vamos assumir que você colocou esse arquivo de correção no diretório
<tt>/usr/src</tt>, e as etapas seguintes serão usadas:

<blockquote><pre>
# <b>cd /usr/src</b>
# <b>patch -p0 &lt; 001_st.patch</b>
Hmm...  Looks like a unified diff to me...
The text leading up to this was:
--------------------------
|Apply by doing:
|        cd /usr/src
|        patch -p0 < 001_st.patch
|
|Rebuild your kernel.
|
|Index: sys/scsi/st.c
|===================================================================
|RCS file: /cvs/src/sys/scsi/st.c,v
|retrieving revision 1.41
|retrieving revision 1.41.2.1
|diff -u -p -r1.41 -r1.41.2.1
|--- sys/scsi/st.c      1 Aug 2004 23:01:06 -0000       1.41
|+++ sys/scsi/st.c      2 Nov 2004 01:05:50 -0000       1.41.2.1
--------------------------
Patching file sys/scsi/st.c using Plan A...
Hunk #1 succeeded at 1815.              <i>&lt;-- Olhe essa mensagem!</i>
done
</pre></blockquote>

Note a mensagem "<tt>Hunk #1 succeeded</tt>" acima.
Isso indica que a correção foi aplicada corretamente.
Muitas correções são mais complexas que essa, e envolvem múltiplos
"hunks" e múltiplos arquivos. Você deve se assegurar que todos os
"hunks" foram aplicados com sucesso em todos os arquivos.
Se eles não foram aplicados com sucesso, normalmente isso significa
que sua árvore de código fonte não está em conformidade com a 
árvore utilizada para desenvolvimento do patch, você não seguiu as
instruções com cuidado, ou seu arquivo de correção estava corrompido.
As correções são sensíveis em relação aos espaços em branco -- copiar
e colar a partir do seu navegador frequentemente transforma
caracteres tab em espaços ou altera de outra forma o espaço em branco
de um arquivo, tornando a correção inutilizável.

<p>
Neste ponto, você já pode
<a href="faq5.html#BldKernel">compilar e instalar</a> um novo kernel 
e reiniciar o sistema da maneira habitual.

<p>
Nem todas as correções são para o kernel.
Em alguns casos, você terá que recompilar utilitários
individualmente. Em outras vezes, será necessário recompilar todos os
utilitários ligados estaticamente em uma biblioteca corrigida.
Siga o guia no cabeçalho do arquivo de correção, e se você estiver em
dúvida, recompile o sistema inteiro.

<p>
Correções que são irrelevantes ao seu sistema em particular não
precisam ser aplicadas -- usualmente.
Por exemplo, se você não tem um drive de fitas magnética no seu sistema,
você não se beneficiará com a correção acima.
No entanto, assume-se que as correções sejam aplicadas "em ordem"
-- é possível que uma última correção dependa de uma correção aplicada
anteriormente.
Seja consciente a respeito disso se você selecionou o método de
escolher quais correções aplicar, e, se está em dúvida, aplique todas
elas, em ordem.

<p>
<a name="httpdchroot"></a>
<h2>10.16 - Me fala sobre o chroot(2) no Apache?</h2>

<p>
No OpenBSD, o servidor
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=httpd&amp;sektion=8">httpd(8)</a>
Apache é
"<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=chroot&amp;sektion=2">chroot(2)</a>ado"
por padrão. Enquanto é um grande passo do ponto de vista da segurança,
isso pode criar problemas se você não estiver preparado.

<h3>O que é um chroot?</h3>

Um aplicativo
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=chroot&amp;sektion=2">chroot(2)</a>ado
é trancado em um diretório específico e não pode passar para o resto
da árvore de diretórios, e vê esse diretório como seu diretório raiz
"<tt>/</tt>" ("root").
No caso do httpd(8), o programa inicia, abre os arquivos de registro,
ouve em suas portas TCP (mas não aceita dados ainda), e lê sua
configuração. Continuando, ele se tranca em <i>/var/www</i> e perde os
privilégios, e então passa a aceitar as requisições.
Isso significa que todos os arquivos servidos e usados pelo Apache
precisam estar no diretório <i>/var/www</i>.
Na configuração padrão do OpenBSD, todos os arquivos no diretório
<i>/var/www</i> estão em modo apenas para leitura para o usuário que
está executando o Apache, o <i>www</i>.
Isso ajuda consideravelmente na segurança -- se existir algum problema
de segurança com o Apache, o dano será confinado a um único diretório
com permissões "apenas para leitura" e sem recursos que possam causar
algum dano.

<h3>O que isso significa para o administrador?</h3>

<p>
Para sermos diretos, "chroot(2)ar" o Apache é uma coisa que não é feita
por padrão na maioria dos outros sistemas operacionais.
Muitas aplicações e configurações do sistema não funcionam em
chroot(2) sem algumas modificações.
No mais, é preciso estar ciente que segurança e conveniência
frequentemente não possuem objetivos compatíveis.
A implementação do Apache no OpenBSD não sacrifica a segurança em
favor das vantagens ou da "facilidade".

<ul>
<li><b>Hierarquia histórica do sistema de arquivos:</b> Servidores que
    foram atualizados a partir de versões antigas do OpenBSD podem ter
    arquivos Web localizados nos diretórios dos usuários, o que
    claramente não funciona em um ambiente "chroot(2)ado", já que o
    httpd(8) não pode alcançar o diretório <i>/home</i>.
    Os administradores também podem acabar descobrindo que a partição
    /var/www é muito pequena para armazenar todos os arquivos Web.
    Suas opções são de reestruturar ou não usar o chroot(2). Você pode,
    naturalmente, usar ligações simbólicas nos diretórios pessoais dos
    usuários apontando para subdiretórios em <i>/var/www</i>, mas você
    NÃO pode usar ligações em <i>/var/www</i> apontando para outras
    partes do sistema de arquivos -- isso não funciona por causa do
    chroot(2). Note que se você quer que seus usuários tenham
    <a href="faq10.html#ftpchroot">acesso ao FTP "chroot(2)ado"</a>,
    isso não funciona, já que o chroot do FTP (novamente) impede
    que você acesse os alvos das ligações simbólicas. Uma solução para
    isso é não usar <i>/home</i> como base para os diretórios pessoais
    dos seus usuários, e usar no lugar algo similar a
    <i>/var/www/users</i>. Ligações simbólicas podem ser usadas dentro
    do chroot(2), mas elas devem ser relativas, não absolutas.

<li><b>Rotação dos arquivos de registro:</b> Normalmente, a rotação de
    arquivos de registro é feita renomeando os arquivos antigos, e então
    enviando ao httpd(8) um sinal SIGUSR1 para fazer com que o Apache
    feche os arquivos de registro antigos e abra os novos arquivos.
    Isso não é mais possível, porque o httpd(8) não tem a possibilidade
    de abrir arquivos de registro para a escrita, já que os privilégios
    foram perdidos. O httpd(8) precisa ser parado e reiniciado.
    Algumas vezes leva alguns segundos para que todos os processos
    filhos sejam terminados, e isso precisa acontecer antes que o
    httpd(8) possa ser reiniciado; então, uma maneira possível de fazer
    a rotação dos arquivos de registro é a seguinte:

<blockquote><pre>
# <b>apachectl stop</b>
    <i>renomeie seus arquivos de registro</i>
# <b>apachectl start ; sleep 10 ; apachectl start</b>
</pre></blockquote>

    Sim, a última linha tenta reiniciar o Apache imediatamente, e, em
    caso de falha, ele espera alguns segundos e tenta novamente.
    E sim, isso significa que, por alguns segundos e em todas as vezes
    que você fizer a rotação de arquivos de registro, seu servidor Web
    estará indisponível. Enquanto isso possa parecer chato, qualquer
    tentativa de permitir que o httpd(8) abra novamente os arquivos após
    ser "chroot(2)ado" vai contra o propósito do chroot!
    Existem também outras estratégias disponíveis, incluindo fazer o
    registro de dados em um
    <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pipe&amp;sektion=2">pipe(2)</a>,
    e usar um programa externo para fazer a rotação na outra ponta do
    pipe(2).

<li><b>Módulos Apache existentes:</b> Praticamente todos carregam,
    no entanto, alguns podem não funcionar corretamente no chroot(2), e
    muitos têm problemas com o
    "<tt><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=apachectl&amp;sektion=8">apachectl</a>
    restart</tt>", gerando um erro que faz com que o httpd(8) termine
    sua execução.

<li><b>CGIs existentes:</b> A maioria NÃO funciona como deve. Eles
    podem precisar de programas ou bibliotecas que estão fora de
    <i>/var/www</i>. Alguns podem ser corrigidos através da compilação
    e ligação estática (não necessitando de bibliotecas em outros
    diretórios), a maioria pode ser corrigida através da cópia de
    arquivos requeridos no diretório <i>/var/www</i>, mas isso não é
    algo trivial e requer algum conhecimento do programa.

<li><b>Opções de montagem do sistema de arquivos:</b>
    Por padrão, no OpenBSD, sua partição <i>/var</i> é montada com as
    opções <tt>nosuid</tt> e <tt>nodev</tt>.
    Se você tentar usar uma aplicação dentro do chroot, você pode
    precisar ter que mudar aquelas opções.
    Normalmente, talvez você precise fazer isso mesmo se você não usa a
    opção chroot.

<li><b>Resolução de nomes:</b>
    O httpd(8) dentro do chroot(2) não é capaz de usar os arquivos
    do sistema <i>/etc/hosts</i> ou <i>/etc/resolv.conf</i>. Então, se
    você tem aplicações que requerem resolução de nomes, você vai
    precisar copiar o arquivo <i>/var/www/etc/hosts</i> e/ou
    <i>/var/www/etc/resolv.conf</i> para o ambiente chroot(2). Note que
    algumas aplicações esperam a resolução do "localhost" para
    funcionar.

<li><b>Fuso Horário (Hora Local):</b>
    O httpd(8) executando em um ambiente chroot(2) NÃO será capaz 
    de acessar o <i>/etc/localtime</i> do sistema.
    Se você demanda que eventos sejam registrados em log, você terá 
    de copiar (não apenas criar um link) 
    <i>/usr/share/zoneinfo/</i> para <i>/var/www/etc/localtime</i>.

</ul>

Em alguns casos, a aplicação ou a configuração pode ser alterada para
ser executada dentro do chroot(2).
Em outros casos, você simplesmente terá que desabilitar essa
funcionalidade usando a opção <tt>-u</tt> do httpd(8) no
<i><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc.conf.local&amp;sektion=8">/etc/rc.conf.local</a></i>.

<h3>Exemplo de chroot(2) de uma aplicação: wwwcount</h3>
Como exemplo de um processo que pode ser usado para fazer o chroot de
uma aplicação, nós vamos olhar o caso do wwwcount, um contador simples
de páginas Web, disponível através dos
<a href="faq15.html#PkgMgmt">pacotes</a>.
Embora seja um programa eficaz, ele não sabe nada sobre o Apache
"chroot(2)ado", e não funciona "chroot(2)ado" em sua configuração
padrão.

<p>
Primeiro, nós instalamos o pacote
<a href="http://www.muquit.com/muquit/software/Count/Count.html">wwwcount</a>.
Nós configuramos e testamos, e descobrimos que ele parece não funcionar:
o Apache nos retorna uma mensagem dizendo "Internal Server Error".

O primeiro passo consiste em parar e reiniciar o Apache com o comutador
<tt>-u</tt> para verificar se o problema vem do chroot(2), e não da
configuração do sistema.

<blockquote><pre>
# <b>apachectl stop</b>
/usr/sbin/apachectl stop: httpd stopped
# <b>httpd -u</b>
</pre></blockquote>

Após fazer isso, nós constatamos que o contador funciona corretamente,
devido à mudança de dono em um diretório que o Apache (e os CGIs que
ele executa) pode escrever nos arquivos.
Assim, temos definitivamente um problema de chroot, então paramos e
reiniciamos novamente o Apache, usando o chroot por padrão:

<blockquote><pre>
# <b>apachectl stop</b>
/usr/sbin/apachectl stop: httpd stopped
# <b>httpd</b>
</pre></blockquote>

<p>
Um bom ponto de partida pode ser supor que o wwwcount usa algumas
bibliotecas e outros arquivos que ele não pode acessar estando em
chroot.
Nós podemos usar o comando
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ldd&amp;sektion=1">ldd(1)</a>
para descobrir as dependências dinâmicas do CGI em questão:

<blockquote><pre>
# <b>cd /var/www/cgi-bin/</b>
# <b>ldd Count.cgi</b>
Count.cgi:
        Start    End      Type Open Ref GrpRef Name
        1c000000 3c007000 exe  1    0   0      /var/www/cgi-bin/Count.cgi
        0c085000 2c0be000 rlib 0    1   0      /usr/lib/libc.so.57.0
        08713000 08713000 rtld 0    1   0      /usr/libexec/ld.so
</pre></blockquote>

Certo, esse é um problema, dois arquivos que não estão disponíveis no
ambiente chroot(2).
Então nós copiamos para o ambiente:

<blockquote><pre>
# <b>mkdir -p /var/www/usr/lib /var/www/usr/libexec</b>
# <b>cp /usr/lib/libc.so.57.0 /var/www/usr/lib</b>
# <b>cp /usr/libexec/ld.so /var/www/usr/libexec</b>
</pre></blockquote>

e tentamos usar o contador novamente.

<p>
Bem, agora o programa está em execução e nos enviando as mensagens de
erro diretamente: "Unable to open config file for reading".
Nós fizemos um progresso, mas ainda não terminamos.
O arquivo de configuração fica normalmente em
<tt>/var/www/wwwcount/conf</tt>,
mas dentro do ambiente chroot ele deve ser procurado em
<tt>/wwwcount/conf</tt>.
Nós temos duas opções: uma é recompilar o programa para fazer ele
funcionar com a nova localização dos arquivos, a outra é mover os
arquivos de dados.
Como nós instalamos a partir de um pacote, vamos apenas mover os
arquivos de dados.
Para usar a mesma configuração em chroot(2) ou não, iremos usar
uma ligação simbólica:

<blockquote><pre>
# <b>mkdir -p /var/www/var/www</b>
# <b>cd /var/www/var/www</b>
# <b>ln -s ../../wwwcount wwwcount</b>
</pre></blockquote>

Repare que a ligação simbólica é pensada para funcionar dentro do
chroot. Novamente, nós testamos... e descobrimos mais um problema.
Agora o wwwcount está reclamando que não pode achar os arquivos
"strip image" que ele utiliza para mostrar as mensagens.
Após um pouco de pesquisa, descobrimos que aqueles arquivos são
armazenados em <tt>/usr/local/lib/wwwcount</tt>, então nós temos que
copiá-los no ambiente chroot, como de hábito.

<blockquote><pre>
# <b>tar cf - /usr/local/lib/wwwcount | (cd /var/www; tar xpf - )</b>
</pre></blockquote>

nós testamos novamente... e ele funcionou!

<p>
Note que somente copiamos os arquivos que são absolutamente necessários
para o bom funcionamento.
Geralmente, somente o mínimo possível de arquivos necessários para
executar uma aplicação deve ser copiado no ambiente chroot.

<h3>Devo utilizar o chroot?</h3>
No exemplo acima, o programa é relativamente simples, e ainda assim
encontramos diferentes tipos de problemas.

<p>
<i>Nem toda aplicação pode ou deve ser "chroot(2)ada".</i>

<p>
O objetivo é um servidor Web seguro, o chroot(2) é apenas uma ferramenta
para alcançar isso, não é o objetivo por si só.
Lembre-se, a configuração inicial do Apache em chroot(2) do OpenBSD
é onde o usuário que está executando o programa httpd(8) não pode
executar nenhum programa, não pode alterar nenhum arquivo, e não pode
assumir outra identidade de usuário.
Perdendo essas restrições, você perde parte da sua segurança, usando
ou não o chroot.

<p>
Algumas aplicações são relativamente simples, e utilizar o chroot(2)
faz sentido. Outras são muito complexas, e não valem o esforço
necessário para colocá-las em chroot(2), ou o tempo que você vai levar
para copiar uma boa parte do sistema para o chroot, e no final acaba-se
perdendo o benefício do ambiente chroot(2).
Por exemplo, o programa OpenWebMail precisa ser capaz de ler e escrever
no diretório de correio eletrônico, no diretório pessoal do usuário, e
também precisa ser capaz de funcionar usando qualquer usuário no
sistema. Tentar colocá-lo em chroot será inútil, já que você será
obrigado a desativar todos os benefícios do uso do chroot(2).
Mesmo com uma aplicação tão simples como o contador, ele precisa
escrever no disco (para guardar sua contagem), então <i>parte</i> do
benefício do chroot(2) é perdida.

<p>
Qualquer aplicação que deve funcionar com privilégios de root é inútil
no escopo do chroot(2), já que o root pode sair do chroot(2).

<p>
Não se esqueça que, se o processo de colocar sua aplicação em chroot é
muito difícil, você não pode atualizar ou instalar uma nova versão do
sistema na frequência que deveria.
Isso pode acabar tornando seu sistema MENOS seguro que um sistema mais
atualizado e com o chroot desativado.

<p>
<a name="rootshell"></a>
<h2>10.17 - Posso mudar o shell do usuário root?</h2>
Algumas vezes é dito que não se deve mudar o shell do usuário root,
apesar de não existir razão para não fazer isso no OpenBSD.

<p>
O shell padrão para o usuário <i>root</i> no OpenBSD é o
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ksh&amp;sektion=1">ksh</a>.

<p>
Uma diretiva Unix tradicional é usar para o root somente shells
compilados estaticamente, porque se seu sistema entra em modo usuário
único, partições não-raiz não são montadas, e shells ligados
dinamicamente não são capazes de acessar as bibliotecas situadas na
partição <tt>/usr</tt>. Isso não é realmente um problema significante
no OpenBSD, já que o sistema pergunta por um shell quando ele
entra em modo usuário único, e o shell por padrão é o
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sh&amp;sektion=1">sh</a>.

Os três shells padrão do OpenBSD
(<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=csh&amp;sektion=1">csh</a>,
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sh&amp;sektion=1">sh</a>
e
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ksh&amp;sektion=1">ksh</a>)
são todos ligados estaticamente, e são utilizáveis no modo usuário
único.

<p>
<a name="ksh"></a>
<h2>10.18 - O que mais posso fazer com o <i>ksh</i>?</h2>
No OpenBSD,
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ksh&amp;sektion=1">ksh</a>
é o <a href="http://web.cs.mun.ca/~michael/pdksh/">pdksh</a>,
o shell Korn em Domínio Público ("Public Domain Korn Shell"), e é o
mesmo binário que o
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sh&amp;sektion=1">sh</a>.

<p>
Usuários confortáveis com o shell <i>bash</i>, utilizado na maioria das
vezes em sistemas Linux, provavelmente acharão o
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ksh&amp;sektion=1">ksh</a>
muito familiar. O ksh(1) oferece a maioria das opções encontradas no
shell <i>bash</i>, incluindo a completação de comandos através da tecla
tab, edição de linha de comando e acesso ao histórico através das teclas
direcionais, e CTRL-A/CTRL-E para pular para o começo ou fim da linha de
comando. Se você deseja outras opções do shell <i>bash</i>, o próprio
<i>bash</i> pode ser instalado através dos
<a href="faq15.html#PkgMgmt">pacotes</a>
ou através dos <a href="faq15.html#Ports">portes</a>.

<p>
O prompt de comando do <i>ksh</i> pode ser facilmente alterado para
fornecer mais informações do que o prompt padrão "$ ", através da
configuração da variável <tt>PS1</tt>. Por exemplo, ao inserir a
seguinte linha:

<blockquote><pre>
export PS1='$PWD $ '
</pre></blockquote>

no seu arquivo <tt>/etc/profile</tt>, produz-se o seguinte prompt de
comando:

<blockquote><pre>
/home/nick $
</pre></blockquote>

Veja o arquivo
<a href="http://www.openbsd.org/cgi-bin/cvsweb/~checkout~/src/etc/ksh.kshrc?content-type=text/plain"><tt>/etc/ksh.kshrc</tt></a>,
que inclui muitas opções úteis e exemplos, e pode ser executado em seu
arquivo <tt>.profile</tt> de usuário.

<p>
O shell ksh(1) do OpenBSD foi melhorado. Vários "caracteres especiais"
para a sequência primária de prompt, PS1, similares àqueles usados no
shell bash, foram adicionados.
Por exemplo:
<blockquote>
<tt>\e - </tt>Insere um caractere de escape ASCII.<br>
<tt>\h - </tt>O nome da máquina, sem o nome de domínio.<br>
<tt>\H - </tt>O nome completo da máquina, incluindo o nome de domínio.<br>
<tt>\n - </tt>Insere um caractere de nova linha.<br>
<tt>\t - </tt>O horário atual, no formato HH:MM:SS de 24 horas.<br>
<tt>\u - </tt>O nome do usuário atual.<br>
<tt>\w - </tt>O diretório de trabalho atual. $HOME é abreviado como `~'.<br>
<tt>\W - </tt>O nome base do diretório de trabalho atual.<br>
<tt>\$ - </tt>Mostra "#" para os usuários root, e "$" para os outros.
</blockquote>

(veja a página de manual
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ksh&amp;sektion=1">ksh(1)</a>
para obter mais detalhes, e muito, muito mais caracteres especiais!
Também note que o caractere "$" tem um significado especial dentro de
aspas duplas, então manipule-o com cuidado)

<p>
Você pode usar o seguinte comando:
<blockquote><pre>
export PS1="\n\u@@\H\n\w \\$ "
</pre></blockquote>
para ter um prompt de comando excessivamente detalhado, mas de certa
forma útil.


<p>
<a name="Dir"></a>
<h2>10.19 - Serviços de diretório</h2>

<p>
O OpenBSD pode ser usado como servidor e cliente de banco de dados
contendo credenciais de usuários, informações de grupos e outros dados
relacionados à rede.

<p>
<a name="Dir.available"></a>
<h3>10.19.1 - Quais serviços de diretório estão disponíveis?</h3>

<p>
Naturalmente, você pode usar vários serviços de diretório no OpenBSD.
Mas o YP é o único que pode ser acessado diretamente usando as funções
da biblioteca padrão de C como
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=getpwent&amp;sektion=3"
>getpwent(3)</a>,
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=getgrent&amp;sektion=3"
>getgrent(3)</a>,
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=gethostbyname&amp;sektion=3"
>gethostbyname(3)</a> e outras.
Assim, se você mantém seus dados em um banco de dados YP, você não
precisa copiá-lo para arquivos de configuração locais como
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=master.passwd&amp;sektion=5"
>master.passwd(5)</a> antes de você poder utilizá-lo,
por exemplo, para autenticar usuários do sistema.

<p>
YP é um serviço de diretório compatível com o
NIS ("Network Information System", ou Sistema de Informação da Rede) da
Sun Microsystems.
Veja
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=yp&amp;sektion=8">yp(8)</a>
para uma visão geral sobre as páginas de manual disponíveis.
Seja cuidadoso, alguns sistemas operacionais possuem serviços de
diretório com nomes parecidos, mas todos são incompatíveis; por
exemplo, NIS+.

<p>
Para usar outros serviços de diretório, exceto o YP, você precisa
popular arquivos de configuração locais a partir do diretório, ou você
precisa de um "frontend" YP para o diretório.
Por exemplo, você pode usar o porte <tt>sysutils/login_ldap</tt> quando
escolher o primeiro, enquanto o daemon
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ypldap&amp;sektion=8"
>ypldap(8)</a> fornece o último.

<p>
Para algumas aplicações, a simples sincronização de um pequeno número
de arquivos de configuração entre um grupo de máquinas usando
ferramentas como
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=cron&amp;sektion=8"
>cron(8)</a>,
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=scp&amp;sektion=1"
>scp(1)</a> ou <tt>rsync</tt> (disponível no portes) se torna uma
alternativa fácil e robusta para um serviço de diretório completo.

<p>
<a name="YP_secure"></a> 
<h3>10.19.2 - Considerações de segurança sobre YP</h3>

<p>
Por razões de compatibilidade, todas as características de segurança
embutidas na implementação de YP do OpenBSD estão <em>desativadas</em>,
por padrão.
Mesmo quando elas estão todas ativadas, o protocolo NIS ainda é
de natureza insegura por duas razões:
Todos os dados, incluindo dados sensíveis como dispersões de senhas,
são transmitidos sem encriptação na rede, e nem o cliente nem o
servidor podem verificar confiavelmente a identidade um do
outro.

<p>
Dessa forma, antes de ativar qualquer servidor YP, você deve considerar
se essas falhas de segurança são aceitáveis no seu contexto.
Em particular, YP é inadequado se atacantes em potencial têm acesso
físico à sua rede.
Qualquer um com acesso root em qualquer computador conectado no seu
segmento de rede com tráfego YP pode enganar o seu domínio YP e
recuperar seus dados.
Em alguns casos, passar o tráfego YP por túneis SSL ou IPSec pode ser
uma opção, ou você pode considerar a combinação de YP com autenticação
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=kerberos&amp;sektion=8"
>kerberos(8)</a>.

<a name="YP_server"></a> 
<h3>10.19.3 - Configuração de um servidor YP</h3>

<ol>
<li><p>
Um servidor YP serve um grupo de clientes chamado de um "domínio".
Você primeiro deve selecionar um nome de domínio; ele pode ser uma
string arbitrária e não precisa estar relacionado em nenhuma forma com
nomes de domínio DNS.
Escolher um nome aleatório, como "Eepoo5vi", pode melhorar marginalmente
a segurança, embora o efeito seja de segurança por obscuridade.
Caso você precise manter vários domínios YP diferentes, provavelmente
é melhor escolher nomes descritivos como "vendas",
"marketing" e "pesquisa" para evitar erros de administração do sistema
causados pela obscuridade.

Também note que algumas versões do SunOS requerem o uso do nome de
domínio DNS da máquina, então sua escolha pode ser restrita em uma rede
que inclui tais máquinas.

<p>
Use o utilitário
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=domainname&amp;sektion=1"
>domainname(1)</a> para definir um nome de domínio, e coloque-o no
arquivo
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=defaultdomain&amp;sektion=5"
>defaultdomain(5)</a> para defini-lo automaticamente durante a
inicialização do sistema.

<blockquote><pre>
echo "puffynet" > /etc/defaultdomain
domainname `cat /etc/defaultdomain`
</pre></blockquote>

<li><p>
    Inicialize o servidor YP usando o comando interativo

<blockquote><pre>
ypinit -m
</pre></blockquote>

    Neste ponto ainda não é necessário especificar os servidores
    escravos.
    Para adicionar servidores escravos, você deve executar novamente o
    <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ypinit&amp;sektion=8"
    >ypinit(8)</a> usando a opção <tt>-u</tt>.

    Configurar ao menos um servidor escravo para cada domínio é útil
    para evitar as interrupções de serviço, pois o servidor mestre pode
    desligar-se ou perder a conectividade de rede; em particular, os
    processos clientes tentando acessar os mapas YP ficarão bloqueados
    indefinidamente até que eles recebam a informação requerida. Assim,
    interrupções de serviço YP tipicamente fazem com que as máquinas
    clientes fiquem inutilizáveis até que o serviço YP volte a
    funcionar.

<li><p>
    Decida onde guardar os arquivos fonte usados para gerar seus mapas
    YP.
    Manter a configuração do servidor separada da configuração servida
    ajuda a controlar quais informações serão servidas e quais não
    serão, então o <tt>/etc</tt> padrão na maioria das vezes não é
    a melhor escolha.

    <p>
    A única inconveniência causada por mudar o diretório fonte é
    que você não será capaz de adicionar, remover e modificar usuários
    e grupos no domínio YP usando utilitários como
    <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=user&amp;sektion=8"
    >user(8)</a> e
    <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=group&amp;sektion=8"
    >group(8)</a>.
    No lugar, você terá que editar os arquivos de configuração com um
    editor de texto.

    <p>
    Para definir o diretório fonte, edite o arquivo
    <tt>/var/yp/`domainname`/Makefile</tt>
    e mude a variável <tt>DIR</tt>; por exemplo

<blockquote><pre>
DIR=/etc/yp/src/puffynet
</pre></blockquote>

<li><p>
    Considere a personalização de outras variáveis em
    <tt>/var/yp/`domainname`/Makefile</tt>. Veja
    <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=Makefile.yp&amp;sektion=8"
    >Makefile.yp(8)</a> para obter mais detalhes.

    <p>
    Por exemplo, mesmo no caso de você utilizar o diretório fonte
    padrão, <tt>/etc</tt>, você usualmente não precisa ter todas as
    contas e grupos existentes no servidor em todas as suas máquinas
    cliente.
    Em particular, não servir a conta do root e, assim, manter a
    dispersão da senha do root confidencial é, frequentemente,
    benéfico para a segurança.
    Revise os valores de <tt>MINUID</tt>, <tt>MAXUID</tt>,
    <tt>MINGID</tt> e <tt>MAXGID</tt> e ajuste-os de acordo com as suas
    necessidades.

    <p>
    Se todos os seus clientes YP usam OpenBSD ou FreeBSD, exclua as
    senhas encriptadas dos mapas <tt>passwd</tt> definindo
    <tt>UNSECURE=""</tt> em
    <tt>/var/yp/`domainname`/Makefile</tt>.

    <p>
    A prática anterior de editar o arquivo modelo
    <tt>/var/yp/Makefile.yp</tt> não é mais recomendada. Mudanças
    naquele arquivo afetam todos os domínios inicializados após a
    mudança, mas não afetam domínios inicializados antes da mudança,
    dessa forma essa prática é propensa a erros:
    você tem o risco de que as mudanças não tenham efeito, e o risco
    de esquecê-las e delas afetarem outros domínios mais tarde, para
    os quais essas mudanças nunca foram pretendidas.

<li><p>
    Crie o diretório fonte e popule-o com os arquivos de configuração
    que você necessita. Veja
    <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=Makefile.yp&amp;sektion=8"
    >Makefile.yp(8)</a> para aprender sobre quais mapas YP requerem
    quais arquivos fonte.
    Para o formato de arquivos de configuração individuais, consulte
    <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=passwd&amp;sektion=5"
    >passwd(5)</a>,
    <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=group&amp;sektion=5"
    >group(5)</a>,
    <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hosts&amp;sektion=5"
    >hosts(5)</a> e outros, e olhe nos exemplos em <tt>/etc</tt>.

<li><p>
    Crie a versão inicial dos seus mapas YP utilizando os comandos

<blockquote><pre>
cd /var/yp
make
</pre></blockquote>

    Não se preocupe com as mensagens de erro do
    <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=yppush&amp;sektion=8"
    >yppush(8)</a> por enquanto.
    O servidor YP não está em execução ainda.

<li><p>
    YP utiliza o
    <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rpc&amp;sektion=3"
    >rpc(3)</a> ("remote procedure calls", ou
    chamadas de procedimento remoto) para comunicar-se com os
    clientes, então é necessário ativar o
    <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=portmap&amp;sektion=8"
    >portmap(8)</a>.
    Para fazer isso, edite o
    <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc.conf.local&amp;sektion=8"
    >rc.conf.local(8)</a> e defina <tt>portmap_flags=""</tt>.
    Isso iniciará o portmapper na próxima inicialização.
    Você pode evitar a reinicialização iniciando-o manualmente:

<blockquote><pre>
echo 'portmap_flags=""' >> /etc/rc.conf.local
portmap
</pre></blockquote>

<li><p>
    Considere o uso do recurso de segurança
    <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=securenet&amp;sektion=5"
    >securenet(5)</a> ou o
    <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ypserv.acl&amp;sektion=5"
    >ypserv.acl(5)</a> do daemon servidor YP.
    Mas esteja atento ao fato de que ambos somente fornecem controle de
    acesso baseado em IP.
    Dessa forma, eles somente ajudam enquanto atacantes em potencial
    não possuem acesso físico ao hardware do segmento de rede
    transmitindo seu tráfego YP nem acesso root em qualquer máquina
    conectada a esses segmentos de rede.

<li><p>
    Finalmente, inicie o daemon servidor YP:

<blockquote><pre>
ypserv
</pre></blockquote>

    Ele será reiniciado automaticamente durante a inicialização contanto
    que o diretório <tt>/var/yp/`domainname`</tt> continue existindo.

<li><p>
    Para testar o novo servidor, considere torná-lo o seu próprio
    cliente, seguindo as instruções na primeira parte da próxima seção.
    Caso você não queira usar seus próprios mapas, você pode desativar
    a parte do cliente após o teste, com os seguintes comandos:

<blockquote><pre>
pkill ypbind
rm -rf /var/yp/binding
</pre></blockquote>

<li><p>
    Se você deseja permitir que usuários mudem suas senhas a partir de
    máquinas clientes, então você precisa ativar
    <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=yppasswdd&amp;sektion=8"
    >yppasswdd(8)</a>:

<blockquote><pre>
echo 'yppasswdd_flags="-d /etc/yp/src/puffynet"' >> /etc/rc.conf.local
rpc.yppasswdd
</pre></blockquote>

Caso você deixe o diretório fonte no <tt>/etc</tt> padrão, use apenas
<tt>yppasswdd_flags=""</tt>.

<li><p>
    Lembre-se que a cada vez que você muda um arquivo incluído por um
    mapa YP, você deve gerar novamente seus mapas YP.

<blockquote><pre>
cd /var/yp
make
</pre></blockquote>

    Isso atualiza todos os arquivos de banco de dados em
    <tt>/var/yp/`domainname`</tt>, com uma exceção:
    o arquivo <tt>ypservers.db</tt>, que lista todos os servidores YP,
    mestres e escravos, associados ao domínio, é criado diretamente com
    <tt>ypinit -m</tt> e modificado exclusivamente por
    <tt>ypinit -u</tt>.
    No caso de você excluí-lo acidentalmente, execute <tt>ypinit -u</tt>
    para recriá-lo a partir do zero.
</ol>

<a name="YP_client"></a> 
<h3>10.19.4 - Configuração de um cliente YP</h3>

Configurar um cliente YP envolve duas partes distintas.
Em primeiro lugar, você precisa de um daemon cliente YP em execução,
conectando a sua máquina cliente ao servidor YP.
Ao finalizar os passos seguintes, você será capaz de recuperar dados
de um servidor YP, mas aqueles dados ainda não serão usados pelo
sistema:

<ol>
<li><p>
    Igual no servidor, você precisa definir um nome de domínio e ativar
    o portmapper:

<blockquote><pre>
echo "puffynet" > /etc/defaultdomain
domainname `cat /etc/defaultdomain`
echo "portmap=YES" >> /etc/rc.conf.local
portmap
</pre></blockquote>

<li><p>
    É recomendado o fornecimento de uma lista de servidores YP no
    arquivo de configuração <tt>/etc/yp/`domainname`</tt>.
    Caso contrário, o daemon cliente YP usará emissões ("broadcasts")
    de rede para encontrar os servidores YP para seu domínio.
    Especifique de maneira explícita os servidores que são mais
    robustos e marginalmente menos abertos à ataques.
    Se você não configurou os servidores escravos, apenas coloque o
    nome de máquina do servidor mestre em <tt>/etc/yp/`domainname`</tt>.

<li><p>
    O daemon cliente YP é chamado de
    <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ypbind&amp;sektion=8"
    >ypbind(8)</a>.
    A inicialização manual criará o diretório <tt>/var/yp/binding</tt>,
    como ele será automaticamente reiniciado na inicialização.

<blockquote><pre>
ypbind
</pre></blockquote>

<li><p>
    Se tudo ocorrer bem, você deve ser capaz de consultar o servidor YP
    usando o
    <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ypcat&amp;sektion=1"
    >ypcat(1)</a> e ver seu mapa de senha como resposta.

<blockquote><pre>
ypcat passwd
bob:*:5001:5000:Bob Nuggets:/home/bob:/usr/local/bin/zsh
...
</pre></blockquote>

    Outras ferramentas úteis para a depuração da sua configuração YP
    incluem
    <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ypmatch&amp;sektion=1"
    >ypmatch(1)</a> e
    <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=yptest&amp;sektion=8"
    >yptest(8)</a>.
</ol>

A segunda parte da configuração de um cliente YP envolve a edição de
arquivos de configuração locais, tais como certos mapas YP usados
por várias instalações do sistema.
Nem todos os servidores servem todos os mapas padrão suportados pelo
sistema operacional, alguns servidores servem mapas adicionais, que não
fazem parte do padrão, e você não tem meios de forçar o uso de todos
aqueles mapas.
Quais dos mapas disponíveis serão ou não serão usados, e para quais
propósitos eles serão usados, é responsabilidade do administrador de
sistema da máquina cliente.

<p>
Para uma lista de mapas YP padrão e seus usos, veja
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=Makefile.yp&amp;sektion=8"
>Makefile.yp(8)</a>.
Os casos mais comuns de uso incluem:

<ul>
<li><p>
    Se você quer incluir todas as contas de usuário do domínio YP,
    acrescente o marcador YP padrão no arquivo de senhas mestre e
    recompile o banco de dados de senhas:

<blockquote><pre>
echo '+:*::::::::' >> /etc/master.passwd
pwd_mkdb -p /etc/master.passwd
</pre></blockquote>

    Para detalhes sobre inclusão e exclusão seletiva de contas de
    usuário, veja
    <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=passwd&amp;sektion=5"
    >passwd(5)</a>.
    Para testar se a inclusão funciona, use o utilitário
    <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=id&amp;sektion=1"
    >id(1)</a>.

<li><p>
    Se você quer incluir todos os grupos de um domínio YP, acrescente
    o marcador YP padrão no arquivo de grupo:

<blockquote><pre>
echo '+:*::' >> /etc/group
</pre></blockquote>

    Para detalhes sobre a inclusão seletiva de grupo, veja
    <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=group&amp;sektion=5"
    >group(5)</a>.

<li><p>
    Se você está distribuindo nomes de máquina via YP, você agora deve
    revisar o
    <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=resolv.conf&amp;sektion=5"
    >resolv.conf(5)</a> e verificar se a ordem de procura de nome de
    serviço está correta.
    A maioria dos usuários utilizarão uma linha como esta:

<blockquote><pre>
lookup file yp bind
</pre></blockquote>
</ul>

<p>
<a name="locales"></a>
<h2>10.20 - Conjuntos de caracteres (charset) e suporte a idioma nativo</h2>
 
O OpenBSD usa ASCII como seu Conjunto de Caracteres (charset) padrão. 
Ele também suporta os seguintes charsets: Latin (ISO-8859-*), KOI-8 
e Unicode (UTF-8).

<a name="charset"></a>
<h3>10.20.1 - Configurando o charset</h3>

<p>Para usar um dos conjuntos de caracteres estendidos, a variável 
de ambiente <i>LC_CTYPE</i> deve ser definida para o nome de uma das 
localidade suportadas.
A variável <i>LC_CTYPE</i> afetará somente o conjunto de caracteres 
disponíveis para aplicações.
Ela não vai mudar o idioma usado para mensagens do aplicativo.

<p>A lista dos locales suportador pode ser obtida com ajuda do seguinte comando:
<blockquote><pre>
locale -a
</pre></blockquote>

A variável de ambiente <i>LC_CTYPE</i> pode ser definida das seguintes maneiras:

<ul>
<li>Se voxê estiver efetuando login via
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=xdm&amp;sektion=1">xdm(1)</a>, 
adicione a linha
<blockquote><pre>
export LC_CTYPE="en_US.UTF-8"
</pre></blockquote>
ao arquivo <i>~/.xsession</i> antes de iniciar sua sessão (para mais detalhes, veja
<a href="faq11.html#CustomizingX">Customizando o Ambiente X Window</a>).
Este exemplo habilita o charset Unicode (UTF-8) e possibilita aplicações como o
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=xterm&amp;sektion=1">xterm(1)</a>
a usar o modo UTF-8 por padrão.

<li><p>Se estiver efetuando login via linha de comando, adicione a linha
<blockquote><pre>
export LC_CTYPE="en_US.ISO8859-1"
</pre></blockquote>
ao arquivo <i>~/.profile</i>.
Tenha em mente que o uso do console só dará suporte a caracteres ASCII e ISO8859-1.
UTF-8 não é suportado.
</ul>

<p>Poucos utilitários do sistema base suportam UTF-8 até o momento.
A maioria vai fazer uso de caracteres ASCII.
Entretanto, muitos programas presentes na Coleção de Ports tem 
suporte a UTF-8.

<p>UTF-8 can also be used with specific applications only by starting
those applications in
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=uxterm&amp;sektion=1">uxterm(1)</a>.
This works even if the login session uses a non-UTF-8 locale.

<p>Se estiver efetuando login remoto utilizando
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ssh&amp;sektion=1">ssh(1)</a>,
a variável de ambiente <i>LC_CTYPE</i> presente em seu sistema não 
será propagada e você terá de defini-la manualmente para que tenha o 
mesmo valor utilizado no terminal local.

<a name="nls"></a>
<h3>10.20.2 - Alterando idioma utilizado em mensagens das aplicações</h3>

<p>O idioma utilizado em mensagens das aplicações pode ser alterado 
modificando o valor da variável de ambiente <i>LC_MESSAGES</i> para 
o nome de uma das localidades suportadas.
Este procedimento pode ser realizado da mesma maneira como descrito 
<a href="#charset">acima</a>, para alterar o valor da variável de 
ambiente <i>LC_CTYPE</i>. Ambas as variáveis, <i>LC_MESSAGES</i> 
e <i>LC_CTYPE</i>, devem ser configuradas com os mesmos valores.

<p>Poucos utilitários presentes no sistema base suportam outro 
idioma, senão Inglês, até o momento.
Entretanto, muitos programas presentes na Coleção de Ports já 
suportam diversos idiomas. Eles retornarão mensagens em Inglês, 
caso o idioma desejado não esteja disponível.

<p>
<font color= "#0000e0">
<a href="index.html">[Índice da FAQ]</a>
<a href= "faq9.html">[Seção 9 - Migração para OpenBSD]</a>
<a href="faq11.html">[Seção 11 - O sistema X Window]</a>
</font>

<p>
<hr>
<a href= "index.html"><img height= "24" width= "24" src= "../../images/back.gif" border= "0" alt="[voltar]"></a>
<a href="mailto:www@@openbsd.org">www@@openbsd.org</a>
<br>
<small>
<!--
Originally [OpenBSD: faq10.html,v 1.180 ]<br>
$Translation: faq10.html,v 1.18 2013/12/01 12:53:12 egypcio Exp $<br>
-->
$OpenBSD: faq10.html,v 1.16 2013/12/06 20:52:47 ajacoutot Exp $
</small>
</body>
</html>
@


1.16
log
@Sync with Steelix CVS
@
text
@d2397 1
a2397 1
$OpenBSD$
@


1.15
log
@Sync with Steelix CVS
@
text
@d250 1
a250 1
De fato, o <a href="../upgrade53.html">processo de atualização de
d2318 5
d2394 2
a2395 2
Originally [OpenBSD: faq10.html,v 1.179 ]<br>
$Translation: faq10.html,v 1.17 2013/06/04 11:53:43 egypcio Exp $<br>
@


1.14
log
@Sync with Steelix CVS
@
text
@a2317 5
<p>A lista de localidades pode ser listada com o seguinte comando:
<blockquote><pre>
ls /usr/share/locale
</pre></blockquote>

d2389 2
a2390 2
Originally [OpenBSD: faq10.html,v 1.178 ]<br>
$Translation: faq10.html,v 1.16 2013/05/07 21:18:54 egypcio Exp $<br>
@


1.13
log
@Sync with Steelix CVS
@
text
@d325 1
a325 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=&amp;sektion=4">httpd(1)</a>
d2394 2
a2395 2
Originally [OpenBSD: faq10.html,v 1.175 ]<br>
$Translation: faq10.html,v 1.15 2013/05/05 20:35:34 egypcio Exp $<br>
@


1.12
log
@Sync with Steelix CVS
@
text
@d11 1
a11 1
<meta name= "copyright"     content= "This document copyright 1998-2012 by OpenBSD.">
d250 1
a250 1
De fato, o <a href="../upgrade52.html">processo de atualização de
d2327 1
a2327 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=xdm&sektion=1">xdm(1)</a>, 
d2331 1
a2331 1
</blockquote></pre>
d2335 1
a2335 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=xterm&sektion=1">xterm(1)</a>
d2341 1
a2341 1
</blockquote></pre>
d2354 1
a2354 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=uxterm&sektion=1">uxterm(1)</a>.
d2358 1
a2358 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ssh&sektion=1">ssh(1)</a>,
d2394 2
a2395 2
Originally [OpenBSD: faq10.html,v 1.174 ]<br>
$Translation: faq10.html,v 1.14 2013/01/13 21:33:06 egypcio Exp $<br>
@


1.11
log
@Sync with Steelix CVS
@
text
@d8 2
a9 2
<meta name= "description"   content= "the OpenBSD FAQ page">
<meta name= "keywords"      content= "openbsd,faq">
d11 1
a11 1
<meta name= "copyright"     content= "This document copyright 1998-2010 by OpenBSD.">
d78 7
d95 1
a95 4
Usuários que já existem precisam ser adicionados ao grupo
<kbd>&quot;wheel&quot;</kbd> manualmente.
Isso é feito por razões de segurança, e você deve ser cuidadoso com
quem você permite o acesso. No OpenBSD, usuários que estão no grupo
d97 5
a101 5
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=su&amp;sektion=1">su(1)</a>,
um programa do espaço de usuário para se tornar root. Usuários que não
estão no grupo <kbd>&quot;wheel&quot;</kbd> não podem usar o su(1).
Este é um exemplo de uma entrada no arquivo <kbd>/etc/group</kbd> para
colocar o usuário <b>ericj</b> no grupo <kbd>&quot;wheel&quot;</kbd>.
d104 1
a104 1
Se você está adicionando um novo usuário com o
d106 3
a108 3
você pode colocá-lo no grupo wheel respondendo wheel para a pergunta
"<tt>Invite <i>user</i> into other groups:</tt>". Isso o adiciona
ao /etc/group, que fica parecido com:
d152 1
a152 1
O OpenBSD usa o estilo
d169 2
a170 2
      novos daemons ou informações específicas da máquina devem ser
      guardados.
d206 3
a208 1
  <li>Daemons locais são executados através do <i>/etc/rc.local</i>
d222 1
a222 1
ftpd_flags=NO           # for non-inetd use: ftpd_flags="-D"
d244 1
a244 1
No lugar, crie o arquivo <i>/etc/rc.conf.local</i>, copie de
d248 3
a250 2
modificações estão em um arquivo.
De fato, o <a href="../upgrade47.html">processo de atualização de
d265 1
a265 1
Mas para carregar o httpd com ssl ativo (consulte a
d275 1
a275 1
de pacotes ou outros meios, você deve usar o arquivo
d279 2
a280 2
inicialização. Eu colocarei uma entrada no <i>/etc/rc.local</i> igual a
esta:
d284 1
a284 1
             echo -n ' daemonx';       /usr/local/sbin/daemonx
d298 57
a354 1
Starting local daemons: daemonx.
d357 3
a474 1

d477 1
d537 1
a537 1
# <b>openssl genrsa -out /etc/ssl/private/server.key 1024</b>
d545 1
a545 1
# <b>openssl genrsa -des3 -out /etc/ssl/private/server.key 1024</b>
d569 1
a569 1
# <b>openssl x509 -req -days 365 -in /etc/ssl/private/server.csr \
a661 1
Reading /etc/login.conf
d666 1
a666 1
Don't worry about mistakes. I will give you the chance later to correct any input.
d669 1
a669 1
Enter shell csh ksh nologin sh [sh]: <b>ksh</b>
d674 1
a674 2
Login class auth-defaults auth-ftp-defaults daemon default staff 
[default]: <b><i>Enter</i></b>
d745 1
a745 1
<h4>Como adicionar usuários</h4>
d748 1
a748 3
Sendo que o comando user(8) não é interativo, a maneira mais fácil de
adicionar eficientemente usuários é através do comando adduser(8). O
comando <i>/usr/sbin/user</i> é apenas uma interface para o resto dos
d753 2
d757 1
a757 4
Neste exemplo, nós estamos adicionando o mesmo usuário com as mesmas
especificações do usuário que foi adicionado
<a href="#adduser">acima</a>.
O comando useradd(8) é muito mais fácil de usar se você sabe a
d759 3
a761 2
estão localizadas em <i>/etc/usermgmt.conf</i>, e podem ser visualizadas
com o comando:
d791 1
a791 1
$2a$06$YOdOZM3.4m6MObBXjeZtBOWArqC2.uRJZXUkOghbieIvSWXVJRzlq
d797 2
d801 1
a801 1
# <b>user add -p '$2a$06$YOdOZM3.4m6MObBXjeZtBOWArqC2.uRJZXUkOghbieIvSWXVJRzlq' -u 1002 \
a1057 1
Reading /etc/login.conf
d1062 1
a1062 1
Don't worry about mistakes. I will give you the chance later to correct any input.
d1065 1
a1065 1
Enter shell csh false ksh nologin sh tcsh zsh [sh]: <b>false</b>
d1070 1
a1070 2
Login class auth-defaults auth-ftp-defaults daemon default staff 
[default]: <b><i>Enter</i></b>
d1181 1
a1181 1
rc.conf.local usando a opção <i>-D</i>.
d1187 1
a1187 1
ftpd_flags="-DllUSA"           # for non-inetd use: ftpd_flags="-D"
d1195 9
d1259 1
a1259 1
não desejada).
d1269 3
a1271 2
Note, no entanto, que as correções não adicionam novas funcionalidades
no OpenBSD, e são feitas somente para correções importantes de
d1333 1
a1333 1
As correções do OpenBSD são distribuídas como diffs unificadas
d1335 3
a1337 2
em relação ao código fonte original. Elas <b>NÃO</b> são distribuídas
em formato binário. Isso significa que para aplicar as correções no
d1341 2
a1342 1
completa. Se você está usando a versão release adquirida em um CD-ROM
d1354 1
a1354 1
Sem esta correção, restaurar dados de backups é um pouco difícil.
d1356 2
a1357 2
correção; no entanto, aquelas que não utilizam podem não ter uma
necessidade particular de instalar a correção.
d1393 1
a1393 1
# <b>patch -p0 < 001_st.patch</b>
d1423 2
a1424 1
que sua árvore de código fonte está com problemas, você não seguiu as
d1432 3
a1434 3
Neste ponto, você pode
<a href="faq5.html#Building">compilar o kernel</a> da maneira habitual,
instalá-lo e reinicializar o sistema.
d1456 1
a1456 1

d1586 7
d1652 1
a1652 1
        0c085000 2c0be000 rlib 0    1   0      /usr/lib/libc.so.50.1
d1662 1
a1662 1
# <b>cp /usr/lib/libc.so.50.1 /var/www/usr/lib</b>
d1753 1
d1781 1
a1781 1

d1917 1
d2100 1
a2100 1
    >rc.conf.local(8)</a> e defina <tt>portmap=YES</tt>.
d2105 1
a2105 1
echo "portmap=YES" >> /etc/rc.conf.local
d2300 79
d2382 1
a2382 1
<a href= "index.html">[Índice da FAQ]</a>
d2394 2
a2395 2
Originally [OpenBSD: faq10.html,v 1.149 ]<br>
$Translation: faq10.html,v 1.12 2010/06/14 17:17:05 renato Exp $<br>
@


1.10
log
@Sync with Steelix CVS
@
text
@d11 1
a11 1
<meta name= "copyright"     content= "This document copyright 1998-2007 by OpenBSD.">
d243 1
a243 1
De fato, o <a href="../upgrade46.html">processo de atualização de
d2231 2
a2232 2
Originally [OpenBSD: faq10.html,v 1.148 ]<br>
$Translation: faq10.html,v 1.11 2009/11/07 08:41:06 alan Exp $<br>
@


1.9
log
@Sync with Steelix CVS
@
text
@d2088 2
a2089 7
    Portanto, tome um cuidado especial para nunca danificar aquele
    arquivo em particular, para que você não tenha que regerá-lo
    manualmente utilizando o
    <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=makedbm&amp;sektion=8"
    >makedbm(8)</a>,
    ou tenha que reinicializar o servidor executando novamente
    <tt>ypinit -m</tt>.
d2231 2
a2232 2
Originally [OpenBSD: faq10.html,v 1.147 ]<br>
$Translation: faq10.html,v 1.10 2009/11/05 12:07:16 alan Exp $<br>
@


1.8
log
@Sync with Steelix CVS
@
text
@d1864 2
d1881 8
a1888 9
<ol>
<li><p>
    Use o utilitário
    <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=domainname&amp;sektion=1"
    >domainname(1)</a> para definir um nome de domínio, e coloque-o no
    arquivo
    <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=defaultdomain&amp;sektion=5"
    >defaultdomain(5)</a> para defini-lo automaticamente durante a
    inicialização do sistema.
d1896 22
d1919 8
a1926 8
    YP. Normalmente, a localização padrão <tt>/etc</tt> <em>não</em> é
    apropriada:
    Como uma regra, você não precisa que todas as contas e grupos
    que existem no servidor também existam nas máquinas clientes.
    Em particular, não servir a conta root e, assim, manter a dispersão
    da senha do root confidencial é, frequentemente, benéfico para a
    segurança.
    A única inconveniência causada por mudar o diretório de origem é
d1937 3
a1939 3
    Para definir um diretório de origem, edite o arquivo
    <tt>/var/yp/Makefile.yp</tt> e mude a variável
    <tt>DIR</tt>; por exemplo
d1945 19
d1966 2
a1967 1
    <tt>UNSECURE=""</tt> em <tt>/var/yp/Makefile.yp</tt>.
d1970 8
a1977 3
    Um backup do modelo original <tt>Makefile.yp</tt> é colocado em
    <tt>/var/yp/Makefile.yp.dist</tt> no momento da instalação do
    sistema, no caso de você precisar recuperar uma configuração básica.
d1994 1
a1994 1
    Inicialize o servidor YP usando o comando interativo
d1997 2
a1998 1
ypinit -m
d2001 4
a2004 32
    Neste ponto, ainda não é necessário especificar os servidores
    escravos.
    Para adicionar servidores escravos, você deve executar novamente o
    <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ypinit&amp;sektion=8"
    >ypinit(8)</a>, usando a opção <tt>-u</tt>.
    Configurar ao menos um servidor escravo para cada domínio é útil
    para evitar as interrupções de serviço, pois o servidor mestre pode
    desligar-se ou perder a conectividade de rede; em particular, os
    processos clientes tentando acessar os mapas YP ficarão bloqueados
    indefinidamente até que eles recebam a informação requerida. Assim,
    interrupções de serviço YP tipicamente fazem com que as máquinas
    clientes fiquem inutilizáveis até que o serviço YP volte a
    funcionar.

    <p>
    Note que mudanças feitas no <tt>/var/yp/Makefile.yp</tt> após a
    execução do <tt>ypinit -m</tt> não têm efeito porque
    <tt>ypinit -m</tt> copiou o modelo de
    <tt>/var/yp/`domainname`/Makefile</tt>.
    Enquanto a maior parte dos arquivos de banco de dados em
    <tt>/var/yp/`domainname`</tt> podem facilmente ser recriados usando
    esse novo Makefile, existe uma exceção:
    o arquivo <tt>ypservers.db</tt>, que lista todos os servidores
    mestres e escravos associados ao domínio, é criado diretamente
    com <tt>ypinit -m</tt> e modificado exclusivamente pelo
    <tt>ypinit -u</tt>.
    Dessa forma, tome um cuidado especial para nuncar danificar aquele
    arquivo em particular, para que você não tenha que gerá-lo novamente
    usando
    <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=makedbm&amp;sektion=8"
    >makedbm(8)</a>,
    ou reinicializar o servidor executando novamente <tt>ypinit -m</tt>.
d2081 14
d2236 2
a2237 2
Originally [OpenBSD: faq10.html,v 1.146 ]<br>
$Translation: faq10.html,v 1.9 2009/10/21 19:25:52 alan Exp $<br>
@


1.7
log
@Sync with Steelix CVS
@
text
@d243 1
a243 1
De fato, o <a href="../upgrade45.html">processo de atualização de
d485 1
a485 1
(CA, "Certifying Authority") assine seu certificado. Para fazer isso,
d1988 2
a1989 1
    >rpc(3)</a> ("remote procedure calls") para comunicar-se com os
d2201 2
a2202 2
Originally [OpenBSD: faq10.html,v 1.145 ]<br>
$Translation: faq10.html,v 1.8 2009/10/13 19:21:11 alan Exp $<br>
@


1.6
log
@Sync with Steelix CVS
@
text
@d1417 1
a1417 1
Para sermos diretos, chroot(2)ar o Apache é uma coisa que não é feita
d1430 1
a1430 1
    claramente não funciona em um ambiente chroot(2)ado, já que o
d1440 1
a1440 1
    <a href="faq10.html#ftpchroot">acesso ao FTP chroot(2)ado</a>,
d1472 1
a1472 1
    ser chroot(2)ado vai contra o propósito do chroot!
d1525 1
a1525 1
chroot(2)ado, e não funciona chroot(2)ado em sua configuração
d1633 1
a1633 1
<i>Nem toda aplicação pode ou deve ser chroot(2)ada.</i>
d2201 1
a2201 1
$Translation: faq10.html,v 1.7 2009/10/05 11:42:07 alan Exp $<br>
@


1.5
log
@Sync with Steelix CVS
@
text
@d229 1
a229 1
<b>NORMAL</b> daquele daemon ou serviço.
d2201 1
a2201 1
$Translation: faq10.html,v 1.6 2009/10/01 10:20:22 alan Exp $<br>
@


1.4
log
@Sync with Steelix CVS
@
text
@a147 1
<p>
d156 6
a161 5
      para saber quais daemons devem ser inicializados pelo sistema.
  <li>/etc/rc.conf.local - Arquivo de configuração que você pode usar
      para sobrescrever as configurações do /etc/rc.conf, assim você não
      precisa alterar o próprio /etc/rc.conf, o que é conveniente no
      momento da atualização de versão do seu sistema.
d180 3
a182 3
são: <i>/etc/rc.conf</i> (ou <i>/etc/rc.conf.local</i>),
<i>/etc/rc.local</i> e <i>/etc/rc.shutdown</i>. Para compreender o
funcionamento do processo rc(8), veja o fluxo:
d188 4
a191 3
  <li>Variáveis de configuração são lidas do arquivo <i>/etc/rc.conf</i>
      e, mais tarde, do <i>/etc/rc.conf.local</i>. Configurações no
      rc.conf.local sobrescrevem aquelas do rc.conf.
d208 2
a209 2
A maioria dos daemons e serviços contidos no OpenBSD por padrão, podem
ser iniciados com uma edição simples do arquivo de configuração
d211 2
a212 2
Para começar, dê uma olhada no arquivo
<a href="http://www.openbsd.org/cgi-bin/cvsweb/~checkout~/src/etc/rc.conf?content-type=text/plain">/etc/rc.conf</a> padrão.
d220 29
a248 10
Uma linha igual a essa mostra que o ftpd não é carregado com o sistema
(pelo menos não através do rc(8); leia a <a href="faq10.html#AnonFTP">
FAQ sobre FTP anônimo</a> para saber mais sobre isso).
Em todo caso, cada linha tem um comentário que mostra os sinalizadores
para o uso <b>NORMAL</b> daquele daemon ou serviço. Isso não significa
que você deve executar aquele daemon ou serviço com aqueles
sinalizadores. Leia a página de manual referente ao assunto para ver
como você pode ter aquele daemon ou serviço carregando de qualquer forma
que você quiser. Por exemplo, esta é a linha padrão relacionada ao
httpd(8).
d255 8
a262 15
Aqui você pode ver claramente que para carregar o httpd normalmente
nenhum sinalizador é necessário. Então uma linha como
&quot;<b> httpd_flags=""</b>&quot; é o bastante. Mas para carregar
o httpd com o ssl ativo (consulte a
<a href="#HTTPS">FAQ a respeito do SSL</a> ou <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ssl&amp;sektion=8">ssl(8)</a>),
você deve usar uma linha como esta:
&quot;httpd_flags="-DSSL"&quot;.

<p>
Uma boa prática é nunca modificar o próprio <i>/etc/rc.conf</i>.
E, no lugar, criar o arquivo <i>/etc/rc.conf.local</i>, copiar apenas as
linhas do <i>/etc/rc.conf</i> que você tem interesse em modificar, e
ajustá-las ao seu gosto.
Isso torna fácil as futuras atualizações de versão -- todas as mudanças
estão em um único arquivo.
d1517 1
a1517 1
<i><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc.conf&amp;sektion=8">/etc/rc.conf</a></i>.
d2200 2
a2201 2
Originally [OpenBSD: faq10.html,v 1.144 ]<br>
$Translation: faq10.html,v 1.5 2009/09/21 10:16:19 alan Exp $<br>
@


1.3
log
@Sync with Steelix CVS
@
text
@d1732 1
a1732 1
para a sequência primária de prompt, PS1, similar a aqueles usados no
d2188 1
a2188 1
$Translation: faq10.html,v 1.4 2009/08/26 13:02:34 alan Exp $<br>
@


1.2
log
@Sync with Steelix CVS
@
text
@d22 2
a23 2
<a href= "faq9.html">[Seção 9 - Migrando para o OpenBSD]</a>
<a href="faq11.html">[Seção 11 - O Sistema X Window]</a>
d36 2
a37 2
<li><a href="#rc"            >10.3 - Como eu inicio serviços ("daemons")
    no mesmo tempo que o sistema inicia? (Visão geral do rc(8))</a>
d39 2
a40 2
    mensagem "relaying access denied" quando estão enviando e-mail
    remotamente através do OpenBSD?</a>
d42 2
a43 1
    erros quando acesso meu e-mail através do POP. O que posso fazer?</a>
d46 2
a47 2
<li><a href="#HTTPS"         >10.7 - Configurando um Servidor HTTP
    Seguro usando ssl(8)</a>
d49 4
a52 3
    /etc/passwd com um editor, mas não surge efeito. Por quê?</a>
<li><a href="#AddDelUser"    >10.9 - Como eu adiciono um usuário? ou
    como deletar um usuário?</a>
d55 5
a59 5
<li><a href="#Quotas"        >10.11 - Configurando quotas de disco para
    usuários</a>
<li><a href="#Kerberos"      >10.12 - Configurando Clientes e Servidores
    KerberosV</a>
<li><a href="#AnonFTP"       >10.13 - Configurando um servidor de FTP
d61 3
a63 4
<li><a href="#ftpchroot"     >10.14 - Confinando os usuários no
    diretório HOME com o ftpd(8)</a>
<li><a href="#Patches"       >10.15 - Aplicando correções ("patches") no
    OpenBSD</a>
d75 2
a76 2
  <li><a href="#YP_server"     >10.19.3 - Configurando um servidor YP</a>
  <li><a href="#YP_client"     >10.19.4 - Configurando um cliente YP</a>
d92 1
a92 1
<kbd>wheel</kbd> possuem permissão para usar o
d94 2
a95 2
um programa "userland" para se tornar root. Usuários que não estão no
grupo <kbd>&quot;wheel&quot;</kbd>, não podem usar o su(1).
d102 3
a104 3
você pode colocar ele no grupo wheel respondendo wheel para a pergunta
"<tt>Invite <i>user</i> into other groups:</tt>". Isso o adicionará
ao /etc/group, que ficará parecido com:
d111 1
a111 1
Se você está procurando um jeito de permitir usuários com acesso
d122 2
a123 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dump&amp;sektion=8">dump(8)</a> e o
d145 2
a146 2
<h2>10.3 - Como eu inicio serviços ("daemons") no mesmo tempo que o
sistema inicia? (Visão geral do rc(8))</h2>
d151 2
a152 1
de iniciar. Esse estilo usa alguns arquivos chave para a inicialização.
d157 1
a157 1
      para saber quais serviços devem ser iniciados pelo sistema.
d161 1
a161 1
      momento de fazer o upgrade do seu sistema.
d165 1
a165 1
      novos serviços ou informações específicas da máquina devem ser
d167 2
a168 2
  <li>/etc/rc.securelevel - Script que roda comandos que precisam ser
      rodados antes das mudanças do nível de segurança. Veja
d185 1
a185 1
Depois que o kernel é carregado, o <i>/etc/rc</i> se inicia:
d187 1
a187 1
  <li>Sistemas de arquivos são checados.
d190 1
a190 1
      rc.conf.local irão sobrescrever aquelas do rc.conf.
d197 1
a197 1
    <li>Configura o nome do host, nome de domínio, etc.
d199 3
a201 3
  <li>Inicia os serviços do sistema
  <li>Faz várias outras checagens (quotas, savecore, etc.)
  <li>Serviços locais são executados através do <i>/etc/rc.local</i>
d204 1
a204 1
<h3>Iniciando Daemons e Serviços do OpenBSD</h3>
d207 1
a207 1
A maioria dos "daemons" e serviços contidos no OpenBSD por padrão, podem
d220 1
a220 1
(pelo menos não através do rc(8), leia a <a href="faq10.html#AnonFTP">
d222 7
a228 6
Em todo caso, cada linha tem uma comentário mostrando as opções para
o uso <b>NORMAL</b> daquele daemon ou serviço. Isso não significa que
você deve executar aquele daemon ou serviço com aquelas opções.
Leia a página de manual referente ao assunto para ver como você pode
ter aquele daemon ou serviço carregando de qualquer forma que você
quiser. Por exemplo, esta é a linha padrão relacionada ao httpd(8).
d235 2
a236 2
Aqui você pode ver claramente que para carregar o httpd, normalmente
nenhuma opção é necessária. Então uma linha como
d238 1
a238 1
o httpd com o ssl ativo (Consulte a
d245 1
a245 1
E no lugar, criar o arquivo <i>/etc/rc.conf.local</i>, copiar apenas as
d248 2
a249 2
Isso torna fácil os futuros "upgrades" -- todas as mudanças estão em um
único arquivo.
d251 1
a251 1
<h3>Iniciando daemons e a configuração local</h3>
d258 3
a260 2
/usr/local/sbin/daemonx e quero que ele carregue no momento do boot.
Eu colocarei uma entrada no <i>/etc/rc.local</i> igual a esta:
d273 3
a275 3
A partir de agora esse daemon será carregado no boot. Você será
capaz de ver qualquer erro no boot, um boot normal sem erros deve
mostrar uma linha como esta:
d285 1
a285 1
Qualquer tarefa que você queira fazer antes do sistema ser desligado,
d293 1
a293 1
quando estão enviando e-mail remotamente através do OpenBSD?</h2>
d310 3
a312 2
Se esse arquivo não existe, crie ele. Você precisará digitar os hosts
que estão enviando e-mail remotamente, com a seguinte sintaxe:
d343 1
a343 1
e-mail através do POP. O que posso fazer?</h2>
d367 4
a370 4
Outra coisa para checar é se o usuário é o dono atual do seu arquivo
/var/mail. Normalmente esse deve ser o caso (por exemplo, o dono de
/var/mail/joe deveria ser o próprio usuário joe) mas se não está
configurado corretamente, essa pode ser a causa do problema!
d375 5
a379 4
terá problemas com ele, mas pode ter! (especialmente se seu site é de
grande volume, como um "ISP", ...). Existem vários servidores POP que
você pode instalar diretamente através da coleção de ports. Se possível,
use o <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=popa3d&amp;sektion=8">popa3d</a>,
d383 2
a384 1
bloqueia (embora o bloqueio somente seria de valor para o daemon POP).
d388 1
a388 1
Você precisa criar este em seu arquivo <i>/etc/group</i> se você precisa
d408 1
a408 1
Se você deseja consultar o arquivo de hosts antes dos servidores DNS,
d417 1
a417 1
Se você deseja consultar SOMENTE o arquivo de hosts, use o seguinte:
d436 1
a436 1
<h2>10.7 - Configurando um servidor HTTP seguro com SSL(8)</h2>
d439 1
a439 1
O OpenBSD é distribuído com bibliotecas RSA e um serviço httpd
d442 1
a442 1
você precisa primeiro ter um certificado. O certificado será mantido em
d446 1
a446 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ssl&amp;sektion=8">ssl(8)</a>,
d449 1
a449 1
servidores web, ela não descreve certificados de servidores DSA.
d462 1
a462 1
Ou se você deseja que a chave seja encriptada com uma frase-passe que
d470 4
a473 3
O próximo passo é gerar uma requisição de assinatura de certificado que
é utilizada para permitir que uma autoridade de certificação (CA)
assine seu certificado. Para fazer isso, use o comando:
d480 3
a482 3
O arquivo <i>server.csr</i> pode então ser enviado a uma autoridade de
certificação que assinará a chave. Uma das autoridades é a
<b>Thawte Certification</b>, que você pode encontrar no endereço
d486 2
a487 2
Se você não pode fazer isso, ou apenas quer assinar o certificado você
mesmo, o seguinte comando pode ser usado.
d496 2
a497 1
<i>/etc/ssl/private/server.key</i> no lugar, você deve então iniciar o
d499 3
a501 3
com as opções <b>-DSSL</b> (veja a <a href="#rc">seção sobre o
rc(8)</a> nesta faq), ativando assim as transações https através da
porta 443 da sua máquina.
d531 1
a531 1
extendido (com opções adicionais além daquelas fornecidas pelo
d540 3
a542 3
Vipw usará o vi (ou seu editor favorito definido por $EDITOR) para
editar o arquivo /etc/master.passwd. Após a modificação, ele recriará
/etc/passwd, /etc/pwd.db, e /etc/spwd.db conforme as mudanças que você
d544 2
a545 2
Vipw também se encarregará de bloquear esses arquivos, de modo que se
alguém tentar mudá-los ao mesmo tempo, o acesso será negado.
d549 1
a549 1
<h2>10.9 - Qual é a melhor forma de adicionar e remover usuários?</h2>
d560 1
a560 1
Você pode também adicionar manualmente os usuários, usando o
d570 2
a571 2
O adduser(8) permite checagens consistentes em <i>/etc/passwd</i>,
<i>/etc/group</i>, e a base de dados shell. Ele criará as entradas
d573 1
a573 1
boas vindas ao usuário. Este é um usuário de exemplo, <b>testuser</b>,
d618 1
a618 1
Para remover usuários você deve usar o utilitário
d620 1
a620 1
Este removerá toda a existência de um usuário. Ele removerá qualquer
d624 2
a625 2
diretório), e suas mensagens (mail).
Naturalmente ele também removerá as entradas nos arquivos
d646 1
a646 1
<h3>Adicionando usuários através do user(8)</h3>
d654 1
a654 1
A lista completa de ferramentas é:
d685 1
a685 1
estão localizadas em <i>/etc/usermgmt.conf</i> e podem ser visualizadas
d700 1
a700 1
As configuração acima serão as utilizadas a menos que você especifique
d702 1
a702 1
exemplo, no nosso caso, nós queremos que o usuário pertença ao grupo
d704 1
a704 1
Um pequeno obstáculo ao adicionar usuários, é que as senhas precisam
d706 1
a706 1
criptografadas, então você precisa usar primeiro o utilitário
d729 1
a729 1
<b>Nota:</b> Tenha certeza que está usando '&nbsp;' (aspas simples)
d734 1
a734 1
e os arquivos de <i>/etc/skel</i> copiados para lá.
d738 2
a739 2
utilitários diferentes. A seguir estão alguns comandos que você pode
usar para rapidamente checar se tudo foi criado corretamente.
d760 1
a760 1
mostrar as características do usuário, este é chamado userinfo(8).
d776 1
a776 1
<h4>Como remover usuários</h4>
d779 1
a779 1
Para remover usuários com a hierarquia de comandos user(8), você usará
d789 1
a789 1
diretório pessoal do usuário também seja deletado. Alternativamente,
d799 2
a800 2
Existem alguns meios de fazer isso, mas um modo muito comum é adicionar
"<tt>/usr/bin/false</tt>" no arquivo "<tt>/etc/shells</tt>".
d804 3
a806 3
Você pode também querer restringir o acesso
<a href="#ftpchroot">Confinando os usuários no diretório HOME com o
ftpd</a>.
d811 1
a811 1
<h2>10.11 - Configurando quotas de disco</h2>
d827 2
a828 1
usadas para marcar cada sistema de arquivo que você vai utilizar quotas.
d830 3
a832 3
serão criados na raiz daquele sistema de arquivo para guardar informação
sobre quotas. Esse padrão pode ser modificado especificando o nome do
arquivo com a opção quota em <tt>/etc/fstab</tt>, como em
d834 2
a835 2
Este é um exemplo de <tt>/etc/fstab</tt> que tem um sistema de arquivo
com quotas ativas, e o arquivo de quotas em uma localização não-padrão:
d842 1
a842 1
Agora é hora de configurar as quotas dos usuários. Para esse fim, nós
d845 2
a846 2
Um uso simples é "<tt>edquota&nbsp;&lt;user&gt;</tt>". edquota(8)
utilizará o vi(1) para editar as quotas, a menos que a variável de
d855 1
a855 1
Mostrará uma saída similar a esta:
d875 7
a881 6
Nesse caso, softlimit está fixado em 1000k e o hardlimit em 1050k.
Um softlimit é um limite onde o usuário é avisado quando o ultrapassa,
e tem um período de graça para reduzir seu uso do disco para abaixo do
seu limite. Os períodos de graça podem ser configurados usando a opção
<b>-t</b> do edquota(8). Depois que o perído de graça termina,
o softlimit se torna hardlimit. O resultado é uma falha de alocação.
d894 1
a894 1
Esse comando lerá o <tt>/etc/fstab</tt> para ativar os sistemas de
d898 1
a898 1
O uso do comando "<tt>quota &lt;user&gt;</tt>" lhe mostrará a
d900 1
a900 1
quota(1) lhe mostrará suas estatísticas de quota. Por exemplo:
d907 1
a907 1
Mostrará um resultado como este:
d916 1
a916 1
Por padrão, as quotas configuradas em <tt>/etc/fstab</tt> serão
d925 1
a925 1
<h2>10.12 - Configurando Clientes e Servidores KerberosV</h2>
d941 1
a941 1
<h2>10.13 - Configurando um servidor de FTP anônimo</h2>
d944 4
a947 4
O FTP anônimo permite que usuários sem contas, acessem arquivos no seu
computador através do Protocolo de Transferência de Arquivos (FTP, "File
Transfer Protocol"). Esta seção oferece um resumo sobre como configurar
um servidor FTP anônimo, seus "logs" gerados, etc.
d949 1
a949 1
<h3>Criando uma conta FTP</h3>
d954 2
a955 2
configurar o diretório de login para /home/ftp, mas você pode colocá-lo
em qualquer lugar que quiser.
d965 1
a965 1
<i>/etc/shells</i>, esse será o &quot;shell&quot; que daremos ao
d967 1
a967 1
Isso não permite que ele faça o login, mesmo dando uma senha vazia.
d1019 3
a1021 3
queremos, mas existem algumas mudanças que teremos que fazer para tornar
ele pronto para o ftp anônimo. Novamente, essas mudanças são explicadas
na página de manual
d1029 1
a1029 1
    deve ser o root, e ter permissões 555.
d1032 1
a1032 1
    existentes no sistema. Se você quer que seu diretório de ftp anônimo
d1035 1
a1035 1
    diretório deve ter o modo 511, e os dois arquivos devem estar no
d1040 2
a1041 2
    que você deseja compartilhar. Esse diretório também deve ter o modo
    555.
d1071 1
a1071 1
<h3>Iniciando o servidor e os logs</h3>
d1078 1
a1078 1
Estes exemplos mostrarão nosso daemon sendo iniciado a partir do
d1080 1
a1080 1
Mas antes, precisamos nos familiarizar com algumas das opções do ftpd.
d1088 9
a1096 9
Como você pode ver, o ftpd é invocado com a opção <i>-US</i>. Essa opção
irá gerar logs das conexões anônimas em <i>/var/log/ftpd</i> e das
sessões concorrentes em <i>/var/run/utmp</i>. Desse modo, poderemos ver
essas sessões com o comando who(1). É possível que alguns queiram apenas
ter um servidor anônimo, e desativar o ftp para usuários. Para isso,
você deve invocar o ftpd com a opção <i>-A</i>. Aqui temos uma linha
que inicia o ftpd somente para conexões anônimas. Ele também usa
<i>-ll</i> para fazer o log de cada conexão usando o syslog, junto com
os comandos "get", "retrive", etc., do ftp.
d1103 3
a1105 3
<b>Nota:</b> Para aqueles que usam servidores ftp de MUITO tráfego,
pode-se não querer invocar o ftpd a partir do inetd.conf. A melhor opção
é comentar a linha ftpd do inetd.conf e iniciar o ftpd a partir do
d1107 1
a1107 1
Isso iniciará o ftpd como um daemon, e será mais simples e rápido
d1117 1
a1117 1
<i>/etc/inetd.conf</i> e fez com que o inetd lê-se novamente o arquivo
d1120 1
a1120 1
<h3>Outros arquivos de importância</h3>
d1125 1
a1125 1
<li><i>/etc/motd</i> - Contém a mensagem que as pessoas verão após terem
d1128 1
a1128 1
    diretório. Ele será mostrado quando o usuário entrar naquele
d1135 1
a1135 1
<h2>10.14 - Confinando usuários em seus diretórios HOME com o ftpd(8)</h2>
d1138 1
a1138 1
Por padrão, quando os usuários se conectam pelo ftp, eles podem ir para
d1140 1
a1140 1
Isso não pode ser desejável em certas ocasiões.
d1142 1
a1142 1
confinando os usuários em seus diretórios HOME usando o chroot.
d1150 5
a1154 4
Se você quer usar o chroot de maneira mais fina, consulte
"<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=login.conf&amp;sektion=5">login
capability infrastructure</a>" e
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftpd&amp;sektion=8">ftpd(8)</a>.
d1157 3
a1159 3
Os usuários em uma classe de login com a variável <tt>ftp-chroot</tt>
definida são automaticamente confinados.
De outra forma, você pode adicionar um nome de usuário no arquivo
d1167 1
a1167 1
<h2>10.15 - Aplicando correções ("patches") no OpenBSD</h2>
d1174 6
a1179 6
(que pode permitir que outros "usem" seu computador de forma não
desejada).
Quando um problema crítico é encontrado, a correção será colocada na
árvore de código <i>-current</i>, e os patches serão lançados para as
<a href="faq5.html#Flavors">releases suportadas</a> do OpenBSD.
Essas correções aparecem na <a href="../../errata.html">página web das
d1182 1
a1182 1
aplicáveis em uma ou mais, mas não todas, plataformas.
d1185 2
a1186 2
Note, no entanto, que os patches não adicionam novas funcionalidades no
OpenBSD, e são feitos somente para correções importantes de
d1192 1
a1192 1
Existem três jeitos de atualizar seu sistema com código corrigido:
d1195 1
a1195 1
<li><b>Faça o upgrade do seu sistema para a versão
d1197 5
a1201 5
    Como todas as correções são aplicadas na base de códigos
    <i>-current</i>, atualizando seu sistema para o último snapshot
    disponível é uma boa forma de aplicar o código corrigido.
    Entretanto, rodar a versão <i>-current</i> não é para qualquer um.
<li><b>Atualize seu sistema para
d1204 2
a1205 2
    códigos usando o ramo <i>-stable</i> apropriado, e recompilando o
    kernel e os utilitários do resto do sistema.
d1207 5
a1211 5
    para a recompilação, e o "checkout" completo do código pode levar
    um bom tempo se você tem uma banda de rede limitada.
<li><b>Corrigir (aplicar o patch), compilar e instalar os arquivos
    afetados individualmente.</b>
    Isso é o que usaremos no nosso exemplo a seguir.
d1215 3
a1217 3
    conjunto universal de instruções para seguir.
    Algumas vezes você deve corrigir, recompilar e instalar uma
    aplicação, outras vezes você tem que recompilar seções inteiras
d1234 8
a1241 8
<a href="../../errata.html">página web das erratas</a> são correções
feitas na árvore de código da release indicada. Correções na árvore CVS
atual também incluem outras mudanças que não são desejadas em um sistema
de produção.
Isto é importante: se você instalou um snapshot, fez o download da
árvore de código no momento em que você obteve o snapshot, e tentar
aplicar uma correção usando um patch publicado, você vai ver que ele
não é aplicado, já que o código pode ter mudado.
d1245 1
a1245 1
<h3>Aplicando as correções.</h3>
d1254 4
a1257 4
Geralmente, você deve ter à disposição a árvore de código completa.
Se você está rodando a versão release adquirida em um CDROM oficial,
as árvores de código estão disponíveis no disco 3, elas também estão
disponíveis como arquivos nos
d1259 2
a1260 1
Iremos assumir que você tem a árvore de códigos completa à disposição.
d1267 1
a1267 1
Sem esta correção, restaurar dados de "backups" é um pouco difícil.
d1269 1
a1269 1
correção, no entanto aquelas que não utilizam podem não ter uma
d1299 3
a1301 3
Como você pode ver, no começo do patch é incluído breves instruções
sobre como aplicá-lo.
Vamos assumir que você colocou esse patch no diretório
d1331 2
a1332 2
Isso indica que o patch foi aplicado corretamente.
Muitos patches são mais complexos que esse, e envolverão múltiplos
d1336 2
a1337 2
que sua árvore de código está com problemas, você não seguiu as
instruções com cuidado, ou seu patch estava corrompido.
d1339 2
a1340 2
e colar a partir do seu navegador, frequentemente irá transformar
caracteres tab em espaços ou alterar de outra forma o espaço em branco
d1346 1
a1346 1
instalá-lo e reiniciar o sistema.
d1352 3
a1354 3
utilitários linkados estaticamente em uma biblioteca corrigida.
Siga o guia no cabeçalho do patch, e se você estiver em dúvida,
recompile o sistema inteiro.
d1357 2
a1358 2
Correções que são irrelevantes ao seu sistema em particular, não
precisam ser aplicadas, normalmente.
d1360 1
a1360 1
você não se beneficiará do patch acima.
d1365 1
a1365 1
escolher quais correções aplicar, e se está em dúvida, aplique todas
d1376 1
a1376 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=chroot&amp;sektion=2">chroot(2)</a>ado
d1378 1
a1378 1
isso pode criar problemas se você não está preparado.
d1382 3
a1384 3
Uma aplicação
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=chroot&amp;sektion=2">chroot(2)</a>ada
é bloqueada em um diretório específico e não pode passar para o resto
d1387 4
a1390 4
No caso do httpd(8), o programa inicia, abre os arquivos de log, ouve
em suas portas TCP (mas não aceita dados ainda), e lê sua configuração.
Continuando, ele se bloqueia em <i>/var/www</i> e perde os privilégios,
e então passa a aceitar as requisições.
d1394 2
a1395 2
<i>/var/www</i> são legíveis apenas pelo usuário que está rodando o
Apache, o <i>www</i>.
d1406 1
a1406 1
Muitas aplicações e configurações do sistema não funcionarão em
d1416 1
a1416 1
    arquivos "web" localizados nos diretórios dos usuários, o que
d1420 1
a1420 1
    /var/www é muito pequena para armazenar todos os arquivos web.
d1422 1
a1422 1
    naturalmente, usar links simbólicos nos diretórios HOME dos
d1424 2
a1425 2
    NÃO pode usar links em <i>/var/www</i> apontando para outras partes
    do sistema de arquivos -- isso não funcionará por causa do
d1428 14
a1441 14
    isso não funcionará, já que o chroot FTP irá (novamente) impedir
    que você acesse os alvos dos links simbólicos. Uma solução para
    isso é não usar <i>/home</i> como diretório HOME para os seus
    usuários, e usar no lugar, algo similar a <i>/var/www/users</i>.
    Links simbólicos podem ser usados dentro do chroot(2), mas eles
    devem ser relativos, não absolutos.

<li><b>Rotação dos arquivos de log:</b> Normalmente, a rotação de logs
    é feita renomeando os arquivos antigos, e então enviando ao
    httpd(8) um sinal SIGUSR1 para fazer com que o Apache feche os
    arquivos de log antigos e abra os novos arquivos. Isso não é mais
    possível, porque o httpd(8) não tem a possibilidade de abrir
    arquivos de log para a escrita já que os privilégios foram
    perdidos. O httpd(8) precisa ser parado e reiniciado.
d1443 3
a1445 3
    filhos sejam terminados, isso precisa acontecer antes que o
    httpd(8) possa ser reiniciado; então uma maneira possível de fazer
    a rotação dos logs é a seguinte:
d1449 1
a1449 1
    <i>rename your log files</i>
d1453 1
a1453 1
    Sim, a última linha tenta reiniciar o Apache imediatamente, e em
d1455 7
a1461 7
    E sim, isso significa que por alguns segundos, e em todas as vezes
    que você fizer a rotação de logs, seu servidor web estará
    indisponível. Enquanto isso possa parecer chato, qualquer tentativa
    de permitir que o httpd(8) abra novamente os arquivos após ser
    chroot(2)ado vai contra o propósito do chroot!
    Existem também outras estratégias disponíveis, incluindo fazer o log
    em um
d1466 3
a1468 3
<li><b>Módulos Apache existentes:</b> Praticamente todos irão carregar,
    no entanto alguns podem não funcionar corretamente no chroot(2), e
    muitos tem problemas com o
d1470 2
a1471 1
    restart</tt>", gerando um erro que faz com que o httpd(8) pare.
d1473 1
a1473 1
<li><b>CGIs existentes:</b> A maioria NÃO funcionarão como devem. Eles
d1476 1
a1476 1
    e linkagem estática (não necessitando de bibliotecas em outros
d1482 1
a1482 1
    Por padrão no OpenBSD, sua partição <i>/var</i> será montada com as
d1485 2
a1486 2
    precisar mudar aquelas opções.
    Normalmente, você pode precisar fazer isso mesmo se você não usa a
d1490 1
a1490 1
    O httpd(8) dentro do chroot(2) não será capaz de usar os arquivos
d1501 1
a1501 1
rodar dentro do chroot(2).
d1509 1
a1509 1
de página web, disponível através dos
d1512 1
a1512 1
chroot(2)ado, e não funcionará chroot(2)ado em sua configuração
d1521 2
a1522 2
O primeiro passo consiste em parar e reiniciar o Apache com a opção
<tt>-u</tt>, para verificar se o problema vem do chroot(2), e não da
d1533 1
a1533 1
ele executa) possa escrever nos arquivos.
d1563 1
a1563 1
Então, nós copiamos para o ambiente:
d1574 1
a1574 1
Bem, agora o programa está rodando, e nos enviando as mensagens de
d1586 2
a1587 2
Para usar a mesma configuração tanto em chroot(2) ou não, iremos usar
um link simbólico:
d1595 2
a1596 2
Repare que o link simbólico é pensado para funcionar dentro do chroot.
Novamente, nós testamos... e descobrimos mais um problema.
d1623 1
a1623 1
O objetivo é um servidor web seguro, o chroot(2) é apenas uma ferramenta
d1626 3
a1628 3
é onde o usuário que está rodando o programa httpd(8) não pode executar
nenhum programa, não pode alterar nenhum arquivo, e não pode assumir
outra identidade de usuário.
d1631 1
a1631 1
 
d1639 4
a1642 4
no diretório mail, no diretório pessoal do usuário, e também precisa ser
capaz de funcionar usando qualquer usuário no sistema.
Tentar colocá-lo em chroot será inútil, já que você será obrigado a
desativar todos os benefícios do uso do chroot(2).
d1669 6
a1674 6
compilados estaticamente, porque se seu sistema entra em modo de usuário
único, partições não-root não serão montadas, e shells dinamicamente
linkados não serão capazes de acessar as bibliotecas situadas na
partição <tt>/usr</tt>. Isso não é atualmente um problema significante
no OpenBSD, já que o sistema perguntará por um shell quando ele
entrar em modo de usuário único, e o shell por padrão é o
d1677 1
a1677 1
Os três shells padrões do OpenBSD
d1682 1
a1682 1
são todos estaticamente linkados, e são utilizáveis no modo de usuário
d1690 1
a1690 1
é <a href="http://web.cs.mun.ca/~michael/pdksh/">pdksh</a>,
d1692 1
a1692 1
mesmo binário que
d1696 2
a1697 2
Usuários confortáveis com o shell <i>bash</i>, frequentemente utilizado
em sistemas Linux, vão provavelmente achar o
d1699 8
a1706 7
muito familiar. Ksh(1) oferece a maioria das opções encontradas no shell
<i>bash</i>, incluindo a completação de comandos através da tecla tab,
edição de linha de comando e histórico através das teclas de orientação,
e CTRL-A/CTRL-E para pular para o começo ou fim da linha de comando.
Se você deseja outras opção do shell <i>bash</i>, o próprio <i>bash</i>
pode ser instalado através dos <a href="faq15.html#PkgMgmt">pacotes</a>
ou através dos <a href="faq15.html#Ports">ports</a>.
d1711 2
a1712 2
configuração da variável <tt>PS1</tt>. Por exemplo, inserindo a seguinte
linha:
d1718 1
a1718 1
no seu arquivo <tt>/etc/profile</tt>, se produz o seguinte prompt de
d1727 2
a1728 2
que inclui muitas opções úteis e exemplos, e pode ser invocado em seu
arquivo de usuário <tt>.profile</tt>.
d1733 1
a1733 1
shell bash, foram adicionado.
d1737 2
a1738 2
<tt>\h - </tt>O nome do host sem o nome de domínio.<br>
<tt>\H - </tt>O nome completo do host, incluindo o nome de domínio.<br>
d1740 1
a1740 1
<tt>\t - </tt>O horário atual, em 24 horas, no formato HH:MM:SS.<br>
d1749 1
a1749 1
para mais detalhes, e muito, muito mais caracteres especiais!
d1751 1
a1751 1
aspas duplas, então o manipule com precaução)
d1776 1
a1776 1
Naturalmente, você pode vários serviços de diretório no OpenBSD.
d1793 1
a1793 1
NIS ("Network Information System" - Sistema de Informação da Rede) da
d1806 1
a1806 1
Por exemplo, você pode usar o port <tt>sysutils/login_ldap</tt> quando
d1818 1
a1818 1
>scp(1)</a> ou <tt>rsync</tt> (disponível no ports) se torna uma
d1830 1
a1830 1
Todos os dados, incluindo dados sensíveis como hashes de senhas,
d1849 1
a1849 1
<h3>10.19.3 - Configurando um servidor YP</h3>
d1852 1
a1852 1
Você deve primeiro selecionar um nome de domínio; ele pode ser uma
d1863 2
a1864 2
domínio DNS do host, então sua escolha pode ser restrita em uma rede
que inclui tais hosts.
d1873 1
a1873 1
    >defaultdomain(5)</a> para definí-lo automaticamente durante a
d1886 3
a1888 3
    que existem no servidor também existam nos hosts clientes.
    Em particular, não servir a conta root e, assim, manter o hash da
    senha do root confidencial é, frequentemente, benéfico para a
d1945 1
a1945 1
    para evitar as interrupções de serviço, o servidor mestre pode
d1949 1
a1949 1
    interrupções de serviço YP tipicamente fazem com que os hosts
d1962 1
a1962 1
    mestres e escravos associados com o domínio, é criado diretamente
d1975 1
a1975 1
    >rpc(3)</a> (remote procedure calls) para comunicar-se com os
d2000 2
a2001 2
    transmitindo seu tráfego YP nem acesso root em qualquer host
    conectado a esses segmentos de rede.
d2049 1
a2049 1
<h3>10.19.4 - Configurando um cliente YP</h3>
d2053 1
a2053 1
conectando o seu host cliente ao servidor YP.
d2078 1
a2078 1
    nome de host do servidor mestre em <tt>/etc/yp/`domainname`</tt>.
d2120 1
a2120 1
sistema do host cliente.
d2160 1
a2160 1
    Se você está distribuindo nomes de host via YP, você agora deve
d2163 1
a2163 1
    >resolv.conf(5)</a> e checar se a ordem de procura de nome de
d2176 2
a2177 2
<a href= "faq9.html">[Seção 9 - Migrando para o OpenBSD]</a>
<a href="faq11.html">[Seção 11 - O Sistema X Window]</a>
d2188 1
a2188 1
$Translation: faq10.html,v 1.3 2009/05/23 17:49:16 alan Exp $<br>
@


1.1
log
@Sync with Steelix CVS
@
text
@d2120 1
a2120 1
pwd_mkdb /etc/master.passwd
d2171 2
a2172 2
Originally [OpenBSD: faq10.html,v 1.143 ]<br>
$Translation: faq10.html,v 1.2 2009/05/10 17:44:16 alan Exp $<br>
@

