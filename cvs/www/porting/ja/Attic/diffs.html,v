head	1.8;
access;
symbols;
locks; strict;
comment	@# @;


1.8
date	2008.03.31.20.01.47;	author tobias;	state dead;
branches;
next	1.7;

1.7
date	2006.01.02.06.51.10;	author saad;	state Exp;
branches;
next	1.6;

1.6
date	2005.09.20.07.29.59;	author saad;	state Exp;
branches;
next	1.5;

1.5
date	2005.01.31.11.04.56;	author saad;	state Exp;
branches;
next	1.4;

1.4
date	2004.05.09.09.58.24;	author saad;	state Exp;
branches;
next	1.3;

1.3
date	2004.02.18.01.47.00;	author jufi;	state Exp;
branches;
next	1.2;

1.2
date	2003.11.03.17.00.42;	author jufi;	state Exp;
branches;
next	1.1;

1.1
date	2003.09.02.15.08.08;	author jufi;	state Exp;
branches;
next	;


desc
@@


1.8
log
@Sync with Steelix CVS
@
text
@<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<html>
<head>
<meta name="generator" content="HTML Tidy, see www.w3.org">
<meta http-equiv="Content-Type" content=
"text/html; charset=iso-2022-jp">
<meta name="resource-type" content="document">
<meta name="description" content=
"Differences with other BSD porting systems.">
<meta name="keywords" content="openbsd,ports">
<meta name="distribution" content="global">
<meta name="copyright" content="This document copyright 2000 by OpenBSD.">
<title>Differences from other BSD port systems</title>
</head>
<body text="Black" bgcolor="White" link="#23238E">
<img height="30" width="141" src="../../images/smalltitle.gif" alt=
"[OpenBSD]">

<h1>OpenBSD の port 作誓里燭瓩両霾鹿莟
取仮惹闔竢跫鮟■絨旭旭⊂他の BSD プロジェクトとの
重要な差異</font></h2>

<p>
NetBSD では、<em>ports</em> という用語を、アーキテクチャ依存のものとして使用しています。
その代わりに、彼らの ports の枠組は <em>packages</em> と呼ばれています。
</p>

<h3>特別のサポート</h3>
ports のためのインフラストラクチャは、新しい ports を誓言成するための機能を持つ、
以下のようないくつかのスクリプトを含みます。
<dl>
<dt>build/resolve-lib
    <dd>共有ライブラリの依存誓鮓‐擇垢襪燭瓠若閼緇轣諷蛯辮緕糂蒹站鹿竢粤から呼び出されます。
<dt>build/update-patches
    <dd><strong>常にパッチを再誓言成させるため</strong>、<code>make update-patches</code>
    から呼び出されます。
<dt>install/make-plist
    <dd><code>make update-plist</code> から呼び出されます。これは、
    誓騎里淵僖奪鵐哀螢好箸鮑鄒成するのに最も良い点世里曚箸鵑匹良魎浜靴討い泙后
緕帯のパッキングリストは、他の BSD プロジェクトとは大きく異なりますが、その理由のひとつに
    パッケージツールが完全に書き直されたことがあります。
</dl>

<h3>一般的なインフラストラクチャの問題</h3>

<p>
OpenBSD の make は、変数の値を大文字や小文字に変換するために、
<code>${VAR:U}</code> および <code>${VAR:L}</code> をサポートします。
このため、make の条件テストは、たとえば以下の例のように、
大文字・小文字に依存しない形でコーディングすべきです。
</p>

<pre>
	.if ${NEED_XXX:L} == "yes"
	do stuff if yes
	.else
	do other stuff
	.endif
</pre>

<p>
理論静砲蓮若閼緇碵筮竟鶯觴閼緇ぢが認識するすべてのブール変数は、
常に定義されているべきなので、<code>defined(USE_FOO)</code>
のようなコードを必要とすべきではなく、<code>${USE_FOO:L} != "no"</code>
が動作しなければなりません。
</p>

<p>
主となる <code>bsd.port.mk</code> ファイルは、大変効率化され、
修誓気気譴泙靴拭Ｆ辰法∧体瘠が可能になっています。
<code>scripts/{pre,do,post}-*</code> の機能は、このプロセスから
なくなりました。この機能を置き換えるため、Makefile から手動で
スクリプトを呼び出してくだ世気ぁ
鹿霈

取馨轣諷ぢの誓気靴せ藩冕鹿莖
腫もし、<code>make VAR=value</code> として make を実行する場合には、Makefile
から得世蕕譴倉ぢの値がどのようなものであっても、その値の割り当てに優誓茲垢襪海箸
注意してくだ世気ぁ任垢蕁燭両豺隋浴諷肅跂ぢのパッチは不要ですので、
メンテナンスの負荷を軽減するためには、MAKE_FLAGS を誓騎里棒設定する方が
ずっと良いでしょう。
</p>

<h3>ソースの取得鹿莖
腫ソースアーカイブには、DISTFILES と PATCHFILES の 2 種類があります。
OpenBSD ではそれらを同じ方法で処理し、デフォルトでは MASTER_SITES
からすべてのものを受け取ります。PATCH_SITES や PATCH_SITES_SUBDIR
は存在<strong>しない</strong>のです。
</p>

<p>
OpenBSD は filename:0 から filename:9 までの拡張を許していますので、
もし、同一のサイトから必要なすべてのファイルを取得世任覆辰疹豺腓砲蓮
たとえば、ファイルを受け取るために MASTER_SITES0 から MASTER_SITES9
まで使用されることになります。
</p>

<p>
いくつかのアーキテクチャでは、特定の配布ファイルが必要になるかも知れません。以前は
これが原因で、配布ファイルのミラーリングが関係したトラブルになることがありました。
OpenBSD は、SUPDISTFILES で 3 つ目のファイルのセットをサポートしています。これらは、
チェックサムの誓言成やミラーリングの目的のためだ世韻僕儖佞気譴討い襪發里塙佑┐蕕譴泙后
嗾伉瓶堝斌途ぢは、たとえば、以下の例のように DISTFILES や PATCHFILES と重複している
かも知れないということに注意してくだ世気ぁ
鹿霈

腫鱚	追嘖読姪喀肬鎰窺握	倉暖十薐原	追嘖読姪哽醇闖蓋峡	跚倉暖幅‰鞜鱆	追嘖読姪哽醇闖鞜鱆苞
	鈔蜀
	嗾伉瓶堝斌途醇闖蓋峡肬鎰齔癇祟鹿頏緇

取馨若閼緇徠膨敏鹿竢粤インフラストラクチャ</h3>

<p>
私たちは <code>NO_WRKDIR</code> を使用するような ports は欲しくはありません。
すべての OpenBSD の ports は作業用ディレクトリが指定されていなければなりません。
これらの作業用ディレクトリの命名の詳細は、port 作誓圓亡愀犬里覆い茲Δ砲垢戮任后
もし、これらの名前を見つけたい場合には、Makefile を参照してくだ世気ぁ
若閼緇邃葹竟鶯黯粡逅殺瘢雹瘠鼈阯倉料妖竣卷追匱閼緇ぢとすれば、
その ports の <code>WRKDIR</code> を見ることができるはずです。
</p>

<p>
作業用ディレクトリない ports を禁止する主な理由は、OpenBSD の <code>bsd.port.mk</code>
が、実際の Makefile のように振る舞い、依存誓△襪蕕任后
若閼緇聽莠閼緇ぢのステージは、配布ファイルやパッチファイルに依存し、
これ以外のすべてのステージは、作業用ディレクトリ (やクッキー) に存在する
実際のファイルに依存しているので、これらのファイルは
作業用ディレクトリなしに存在することができないのです。
</p>

もし、DISTFILES の展開が特殊である場合には、
</p>

<pre>
EXTRACT_ONLY=
</pre>

<p>
を誓瀋蠅掘△修靴竢粤情闢纔痺閼緇ぢの展開を実行してくだ世気ぁ
鹿霈

寂貍
寂徠膨敏鹿糘
寂箴竟鶯が自分自身のクッキーを置くための
作業用ディレクトリです。</dd>

<dt>WRKDIST</dt>

<dd>WRKDIR のサブディレクトリで、ここで ports が実際に展開されます。
ここはまた、パッチを適用するためのベースディレクトリでもあります。
他の BSD は、現状では WRKDIST/WRKSRC を区別せず、WRKSRC
を持つのみです。</dd>

<dt>WRKSRC</dt>

<dd>WRKDIST のサブディレクトリで、ここに実際のソースが
置かれます。</dd>

<dt>WRKBUILD</dt>

<dd>WRKDIR のサブディレクトリで、ここで ports のコンフィギュアとビルドが
行われます。他の BSD は、WRKBUILD/WRKSRC を区別していません。
autoconf に基づくプログラムは、WRKSRC と区別された WRKBUILD の中で
ports のビルドを行わせるようにするため、SEPARATE_BUILD を (ほぼ)
普通にセットすることができます。</dd>

<dt>WRKCONF</dt>

<dd>WRKDIR のサブディレクトリで、コンフィギュアスクリプトはここで実行されるべきです。
省略時は WRKBUILD が使用されますが、十中八九問題ありません。</dd>

<dt>WRKINST</dt>

<dd>packages を作誓垢襪燭瓩闥ぢがインストールされるディレクトリです
(下記の ports の仮インストールを参照してくだ世気ぢ。</dd>
</dl>

<p>
<em>NO_WRKSUBDIR は削除されたことに注意してくだ世気ぁ徠膨瓶埆え徠膨敏を誓瀋蠅垢襪海箸如△海竜’修鯊綢慍椎修任后鹿纃鹿霈

取馨竟鶯の仮インストール</h3>

<h4>はじめに</h4>

<p>
ビルドの完了後、他の BSD では ports のインストールが行われ、その後に
インストールされた ports から packages のビルドが行われます。OpenBSD
では、その代わりに仮のインストールが使用されます。
</p>

<ul>
<li>OpenBSD の port は普通にコンフィギュアが行われ、ビルドされます
(たとえば、通常は <code>/usr/local</code> である <code>PREFIX</code>
の下にインストールされるように...)。</li>

<li>しかし、実際には他の場所、通常は WRKDIR のサブディレクトリの WRKINST
と名付けられたところの下にインストールされるよう指示されます。</li>

<li>そして、本物ではないインストールされた物は、pkg_create の -B
オプションを使用して packages として作誓気譴泙后鹿跚
殊蘊最終的に、pkg_add を使用してインストール可能な packages
が得世蕕譴泙后鹿跚鹿
取款優位誓鹿茣
受貍
殊蘊鞜站瘍纉ぢ作誓圓砲箸辰董△海譴呂曚箸鵑匹闥ぢは実際にはインストールされる
必要がないことを意味し、多数の誓濺並填┐篝正常にインストールされなかった ports
による一般的な障害を回避することができます。それはまた、同じマシン上で、
いくつかの互いに対立するような packages を構築できるということも意味していますし、
そしてさらには、誓犠錣淵ぅ鵐好函璽襪鮃圓錣覆討癲▲謄好箸圓錣譴討い覆た靴靴
鞜站瘍纉ぢを構築できるということでもあるのです。</li>

<li>ports の作者にとっては、ports がインストールされるまでは、仮の
インストール場所は空の領域ですので、パックするリストの問題点世鮓弔韻觝邏箸
非常に簡単になります。そしてまた、ports が非常に多数のファイルをインストール
する場合でも、特に ports のインストールに関する微調誓阿鮃圓ι廚呂△蠅泙擦鵝
なぜなら、パックするリストの中に無関係なファイルを書かないようにするだ世韻
十分だ世蕕任后鹿跚
殊蘊エンドユーザにとっては、これは packages の質を改善します。なぜなら、
最終的な ports は pkg_add を使用してインストールされ、エンドユーザは
port 作誓圓離泪轡鷯紊僕儖佞気譴織愁侫肇ΕД△弱躱厳密に</em>同じものが
得世蕕譴襪蕕任后鹿跚鹿
取款その方法</h4>

<p>
以下のようなわずかな違いを除いて、<code>make fake</code> で呼び出される
ターゲットが、通常はインストールされるターゲットになります。
</p>

<ul>
<li>MAKE_FLAGS の代わりに FAKE_FLAGS が使用されます。デフォルトでは、
FAKE_FLAGS は DESTDIR=${WRKINST} をセットします。</li>

<li>INSTALL_TARGET の代わりに FAKE_TARGET が使用されます。</li>

<li>{pre,do,post}-install という要素が TRUEPREFIX を $(PREFIX) に、
PREFIX を $(WRKINST)$(PREFIX) に、そして DESTDIR を $(WRKINST) に
セットした上で呼び出されます。</li>
</ul>

<p>
imake の要素は DESTDIR を使用するように構誓気譴襪里如蜊瘠を使用する
ports も、そのとおりに動作すべきです。同様にして、最近の GNU configure
を使用する ports も無変更で動作すべきです。
</p>

<p>
もうひとつの良いテクニックは、「遅延構築」の裏技です。Makefile
が以下の行を含むようにするため、ports が $(DESTDIR)/usr/local
を使用するように構誓靴泙后
鹿霈

腫鱚頏繙蝌修途堋敏鬲跫竅鹿頏緇

腫竟鶯がビルドされる際に、DESTDIR には何もセットされていないので、
/usr/local が使用されます。そして、仮インストールでは、すべてのものが
WRKINST/usr/local の下に置かれます (例: GNU configure では、
<code>CONFIGURE_STYLE= gnu dest</code> を使用します)。
</p>

<h4>落とし穴</h4>

<ul>
<li>いくつかの ports は、その DESTDIR の処理に一貫誓△蠅泙擦鵝
ひとつかふたつの違反を除けば、ほとんどの ports は DESTDIR の組み合わせに
問題を抱えてはいません。パッチを当てて問題を解決してくだ世気ぁ鹿跚
殊蘊竟鶯がインストールされる実際の場所と packages
の構誓侫．ぅ襪傍燭気譴討い訃貊蠅箸龍菠未砲蓮
十分に注意してくだ世気ぁ海譴呂い箸盍蔽韻妨瓩瓦靴討靴泙Δ海箸任垢
墟嫖侑兎婦ぢを使用して修誓気垢襪里盍蔽韻覆海箸覆里任后鹿跚
殊蘊誓簑佚淵轡鵐椒螢奪螢鵐蓮哉汗整を必要とします。幸運にも
<code>bsd.port.mk</code> は、この領域の問題に対して警告してくれます。</li>

<li>少数の ports は、configure の段階で $(DESTDIR)
をそのままにしておいてくれません。すべての Makefiles に対して DESTDIR
を追加してくれる post-configure の要素が必要になります。</li>

<li>めったにないことですが、ports の仮インストールを行おうとする誓掬併遒澆
すべて失敗することがあります。ports が見つけようとするすべてのものを WRKINST
の領域にコピーするかリンクするという pre-fake を使用するという、強引なアプローチを
使用できる場合があります。その場合、chroot 環境下でインストールを実行してくだ世気ぁ鹿跚鹿
取馨パッケージ化ツール</h3>

<p>
パッケージ化ツールは非常に少数のファイルタイプをサポートし、かつ
自動で多くのことをします。ほとんどの場合 <code>@@exec</code> コマンドまたは
<code>INSTALL</code> スクリプトは必要とされません。<br>
<em>注: 不必要なスクリプトは禁止すべきです。なぜなら拡張誓亡悗垢
問題を有するからです。単一のパッケージ環境をデバッグすることは、新たな問題を
処理するために数百のスクリプトを変更することに比べて遥かに簡単だ世蕕任后
鹿纃昭碣例えば:
</p>

<ul>
<li><code>@@exec ldconfig</code> は必要ありません。なぜなら共有ライブラリは
<code>@@lib libfoo.so.1.0</code> のように指示され、<code>ldconfig</code> は
必要なとき実行されるからです。また chroot も誓気靴藩僂気譴泙后鹿跚殊蘊若閼緇誓纔繝銖跛鈕鐚閼緇ぢは必要ありません。なぜなら info 文書ファイルは
<code>@@info file.info</code> のように指示されるからです。これはまた
複数の info ファイルを処理し、<code>makeinfo --no-split</code> する必要誓
除去します。</li>
<li>フォントは <code>@@font</code> と <code>@@fontdir</code> によって自動的に
統合されます。</li>
<li>新規ユーザーおよびグループは、インストール用スクリプトの代わりに <code>@@newuser</code> と 
<code>@@newgroup</code> により作誓気譴泙后卦罅璽供爾筌哀襦璽廚呂泙拭聞澆紡海
パッケージ抽出処理時に利用可能となるよう、充分早い段階に作誓気譴泙后鹿跚殊蘊コンフィギュレーションファイルは、インストール用スクリプトの代わりに
<code>@@sample</code> によって処理されます。
</ul>

<p>
より詳細な内容は、
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pkg_create&amp;sektion=1&amp;format=html">pkg_create(1)</a>
を参照してくだ世気ぁ曚箸鵑匹両豺隋
若閼緇轣諷鞣癆絖韭蜩閼緇ぢとすることで、非常に的確な完全パッキングリストの概要が
得世蕕譴泙后泙燭△襯弌璽献腑鵑藜，離弌璽献腑鵑悗痢⊆蟶邏箸里茲Δ僻汗整が
可能になります。
</p>

<h3>フレーバ</h3>

<p>
オプションはフレーバとして合理化されていますので、packages の構築に一貫誓
持たせることができます。オプションを持つ ports は、その ports が理解可能な
すべてのオプションのリストを、(たとえば、FLAVORS=foo bar zoinx のように)
FLAVORS に誓瀋蠅垢戮任后修靴董⊆尊櫃冒鬚気譴織廛轡腑鵑燭任△襪里
テストするには、(たとえば、FLAVOR=zoinx foo のように) FLAVOR を使用します。
<code>bsd.port.mk</code> は、以下のようなものをいくつかサポートしています。
</p>

<ul>
<li>PKGNAME は、(たとえば package-foo-zoinx のように) ハイフンで
分けられたオプションを含むよう調誓阿気譴泙后鹿跚
殊蘊徠膨敏ぢは、衝突することなく同時に構築できるフレーバを区別するために
調誓阿気譴泙后鹿跚
殊蘊ゥ肚癘闥ゥぢという形態での構築は、PFRAG.flavor を含む
きっかけとなります。また、%%SHARED%% という構誓蓮估卅熱鼈癇繖
を含むきっかけとなります。</li>

<li>bsd.port.subdir.mk は、`FLAVOR=opt1 opt2 用のディレクトリで ports
をビルドする' ということを誓觚誓するための SUBDIR=directory,opt1,opt2
という拡張を理解します。</li>
</ul>

<p>
与えられたフレーバが選択されたかどうかは、以下のように簡単にチェックすることができます。
</p>

<pre>
.if ${FLAVOR:L:Mzoinx}
</pre>

MULTI_PACKAGES として知られる特別の拡張があります。一般的に言世┐弌
葉猛敷仭男素途ぢと FLAVORS とは直交するメカニズムです。これらは、
多数の別の packages を構築するために、単一の ports の
ひとつのディレクトリを許容するので、OpenBSD の ports ツリーが
他の BSD よりいくぶん小さくなるのに役立っています。
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=bsd.port.mk&amp;sektion=5&amp;format=html">bsd.port.mk(5)</a> は
FLAVORS および MULTI_PACKAGES 誓賤僂里垢戮討離札轡腑鵑鮖辰討い泙后

取鮠

首轣跛次
蜃蜴瘡踟緕帯頂蜀胝讙窺姥
ぴ鱇銖赱闔粡聿鶤蔗迪旭強葦臼佐減概蜊蜚瘠祷は鞳鄲喞粡聿鶤蔗迪旭強葦斡叉浦碓瘁祷鹿鼾瘡貍

鹿硼糯鹿蔗迪

窺跫栴繻蝌嶝

絶街甞更
は鞳鄲喞粡聿鶤蔗迪屋梓億蔚虻扱魂褫肅


窺跫栴繻蝌嶝

絶温甓控
墟嫖侑兎婦ぢを使用して修誓気垢襪發隆蔽韻覆海箸覆里任后鹿跚箜昂
甞昂
ぴ鱇銖赱闔粡聿鶤蔗迪旭起姐鰻佐該軌蜊蜚瘠祷

窺跫栴繻蝌嶝

絶姥箜芦
甞芦
を追加するしてくれる post-configure の要素が必要になります。</li>
d310 39
d389 1
a389 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=bsd.port.mk&amp;sektion=5&amp;format=html">bsd.port.mk(5)</a>
d395 4
a398 4
Originally [OpenBSD: diffs.html,v 1.17 ]
<br>
$Translation: diffs.html,v 1.4 2005/01/31 01:21:58 toshi Exp $
<br>
@


1.4
log
@sync with Steelix CVS
@
text
@d17 1
a17 1
"[OpenBSD]"> 
d19 1
a19 1
<h1>OpenBSD 移植情報</h1>
d30 1
a30 1
移植のためのインフラストラクチャは、新しい ports を誓言成するための機能を持つ、
d34 1
a34 1
    <dd>共有ライブラリの依存誓鮓‐擇垢襪燭瓠若閼緇轣諷蒹站蛯辮緕糂鹿竢粤箚甦緕帯のパッキングリストは、OpenBSD とは大きく異なりますが、その理由のひとつに
d128 1
a128 1
これらの作業用ディレクトリの命名の詳細は、移植者に関係のないようにすべきです。
d148 1
a148 1
</pre> 
d164 1
a164 1
他の BSD は、現状では WRKDIST/WRKSRC を区別せず、WRKSRC 
d198 1
a198 2
では、その代わりに仮のインストールが使用されます。ports ツリーは、FAKE
を使用することで、その全体の変換が行われませんが、目的は達誓任泙后
箍芦
甓芦
殊蘊仮の ports は普通にコンフィギュアが行われ、ビルドされます
d209 1
a209 1
<li>そして、本物ではないインストールされた物は、pkg_create の -s
d212 1
a212 1
<li>最終的に、pkg_add を使用してインストール可能な packages 
d235 1
a235 1
移植者のマシン上に用意されたソフトウェアと<em>厳密に</em>同じものが
d266 1
a266 1
を使用するように構誓靴泙后箜輝
甞輝
蜃蜴瘡踟緕帯頂蜀胝讙窺唄
箜騎
甞騎
ぴ鱇銖赱闔粡聿鶤蔗迪旭姦芦碓紺杭梓闢蓍


窺跫栴繻蝌鱇銖赱闔嶝

誓


窺跫栴繻蝌鱇銖赱闔嶝

絶温甦取馨賠鈬鱸蜴胙癈鱚齠鷦馨
箒甼最終的に <code>defined(USE_GMAKE)</code> を除去し、代わりに
<code>${USE_GMAKE:L} != "no"</code> を使用するようにするため、
<code>bsd.port.mk</code> に認識されるすべての変数が
常に定義されていることを確実にしようとする動きがあります。
d123 1
a123 1
<h3><code>作業用</code>インフラストラクチャ</h3>
d143 1
a143 6
<p>
歴史的な偶然誓砲茲蝓若閼緇粹鱇笏鹿竢粤の断片が
作業用ディレクトリを作誓靴泙后任垢里如
若閼緇頏絖纔痺閼緇ぢと <code>do-extract</code> は、
<em>決して</em>無効にすべきではありません。もし、DISTFILES
の展開が特殊である場合には、
d341 8
d352 1
a352 1
Originally [OpenBSD: diffs.html,v 1.12 ]
d354 1
a354 1
$Translation: diffs.html,v 1.1 2003/08/17 12:13:18 toshi Exp $
d356 1
a356 1
$OpenBSD: diffs.html,v 1.12 2002/09/23 06:01:58 pvalchev Exp $
@


1.1
log
@Sync with steelix translation CVS
@
text
@@

