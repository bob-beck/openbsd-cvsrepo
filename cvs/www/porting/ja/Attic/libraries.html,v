head	1.8;
access;
symbols;
locks; strict;
comment	@# @;


1.8
date	2008.03.31.20.01.47;	author tobias;	state dead;
branches;
next	1.7;

1.7
date	2006.01.02.06.51.10;	author saad;	state Exp;
branches;
next	1.6;

1.6
date	2005.10.09.20.43.49;	author saad;	state Exp;
branches;
next	1.5;

1.5
date	2005.09.20.07.29.59;	author saad;	state Exp;
branches;
next	1.4;

1.4
date	2004.05.09.09.58.24;	author saad;	state Exp;
branches;
next	1.3;

1.3
date	2004.03.23.12.31.10;	author jufi;	state Exp;
branches;
next	1.2;

1.2
date	2003.11.03.17.00.43;	author jufi;	state Exp;
branches;
next	1.1;

1.1
date	2003.10.02.12.04.43;	author horacio;	state Exp;
branches;
next	;


desc
@@


1.8
log
@Sync with Steelix CVS
@
text
@<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<html>
<head>
<meta name="generator" content="HTML Tidy, see www.w3.org">
<meta http-equiv="Content-Type" content=
"text/html; charset=iso-2022-jp">
<meta name="resource-type" content="document">
<meta name="description" content=
"Quick guide to writing ports">
<meta name="keywords" content="openbsd,ports">
<meta name="distribution" content="global">
<meta name="copyright" content=
"This document copyright 2001 by OpenBSD.">
<title>Handling shared libraries in the OpenBSD ports tree</title>
</head>
<body text="Black" bgcolor="White" link="#23238E">
<img height="30" width="141" src="../../images/smalltitle.gif" alt=
"[OpenBSD]"> 

<h1>ports ツリーでは、共有ライブラリをどのように扱うか</h1>

<h2>共有ライブラリの採番ルールを理解する</h2>
共有ライブラリには、さまざまな理由により、若干トリッキーなところがあります。
ですので、<code>libfoo.so.major.minor</code> のような、
ライブラリの名前付けの仕組みを覚える必要があります。
<p>
プログラムをリンクする場合、リンカ <code>ld</code> は誓言成されたバイナリに
情報を埋め込みます。この情報は、<code>ldd</code> で見ることができます。
その後、プログラムを実行する際に、ダ瀬ぅ淵潺奪螢鵐竢粤場筮齒鹿竢粤は、
次のようにして誓気靴ぅ誓イナミックライブラリを見つけるために、この情報を利用します。
<ul>
	<li>厳密に同じメジャー番号のライブラリが要求されます。
	<li>同じかそれ以上のマイナー番号のライブラリが要求されます。
</ul>
つまり、これは、メジャー番号が同じで、マイナー番号が同じかそれ以上の
<strong>すべての</strong>ライブラリは、<strong>プログラムが期待するバイナリ API
を満足しなければならない</strong>ことを意味します。そのようになっていない場合には、
その ports は壊れているということになります。具体的には、ユーザが自分のシステムを
更新しようとするのを不可能にしてしまうことになるでしょう。
<p>
共有ライブラリのルールは極めて単純なものです。
<ul>
	<li>ライブラリに関数を追加した場合には、ライブラリのマイナー番号を
増加させなければなりません。それは、この関数を必要とするプログラムが、少なくとも
このバージョンを明声北笋す腓錣擦困法△海隆愎瑤鰺弋瓩垢觴蠱覆呂覆い蕕任后
	殊蘊既存の API を変更した場合や、何かの関数のシグネチャが変わってしまった場合、
誓掬文討喀个啓蟒腓發呂篝正当なものではなくなってしまった場合、あるいは
互換誓里覆し燭諒儿垢辰┐蕕譴疹豺腓砲蓮▲薀ぅ屮薀蠅離瓮献磧屡峭罎
首闔臂増加させなければなりません</strong>。
	<li>これは、古い関数を削除する場合にも当てはまります。
どのような関数の削除であっても、メジャー番号は増加することになります。
</ul>
<p>
ときどき、ライブラリがいくつかのファイルとして書かれていて、その内部関数が
これらのファイルの間で通信する必要があるために見えてしまうことがあります。
このような関数名は伝統的にアンダ澄璽好灰△藥呂泙辰討い董△海譴蕕論正当な
API の一部ではありません。
<p>
このライブラリの命名の枠組は、それが ELF か a.out かに関係なく、OpenBSD
プラットフォームのいたるところに存在するものであるということに注意してくだ世気ぁ

取仮竟鶯ビルド時に誓気靴ぬ樵阿鮗閏茲襪燭瓩糧汗整</h2>
ごく一部の ports は、どのようにしても、共有ライブラリを誓気靴咼襯匹垢襪燭瓩糧汗整を必要とします。
共有ライブラリのビルドは、次のように行うべきであるということを思い出してくだ世気ぁ
若閼緇艫葹鱚韈笨佗蛯肬鎬齒礪閧蟆鹿竢粤腫バージョン番号の調誓宛紊縫薀ぅ屮薀衞召鯤儿垢垢襪海箸呂任泙擦鵝覆爾覆蕁
徒ライブラリはライブラリの内部名を誓瀋蠅垢襪里法△い弔瞭段未淵泪献奪
使用しているからで、最初から誓気靴ぅ弌璽献腑鵑鬟螢鵐靴討廚△蠅泙后
腫この一方で、ports の Makefile 中の <code>MAKE_FLAGS</code> を使用して、Makefile
の変数をコマンドラインから優誓荵慊蠅垢襪海箸任襪箸いΔ海箸鮖廚そ个靴討誓さい。
これはたとえば、libtool ベースの ports にとっては、実に価値のあることであり、それが
誓言成するそれぞれのライブラリ用に、ひとつのこのようなバージョン変数が用意されています。

<h2>ユーザに見えるすべてのライブラリは /usr/local/lib に置くように</h2>
一般的に、ldconfig のパスにディレクトリを追加するようユーザに要求するのは、
非常に悪い方法です。なぜなら、プログラムに直誓椒螢鵐気譴襪垢戮討龍ν
ライブラリは /usr/local/lib に現れるべきであるからです。しかしながら、
これは実際のライブラリへのシンボリックリンクを使用して簡単に実現できます。
以下のようなライブラリ参照ルールを理解しておいてくだ世気ぁ
受貍
	殊蘊ビルド時には、<code>ld</code> はライブラリを探索するパスを誓瀋蠅垢襪里
若閼緇鹿竢粤フラグを使用します。そして、その要求にマッチするライブラリを
見つけた時点世把召舛肪戯鯆篁澆靴泙后
	殊蘊実行時には、<code>ld.so</code> は要求されたライブラリを探すのに
<code>ldconfig</code> によってキャッシュされた情報を使用します。
</ul>

ここで、<code>qt.1.45</code> と <code>qt.2.31</code> という、メジャーバージョンの
異なるふたつのライブラリを提供するふたつの ports があると仮定します。
どちらの ports も同時にインストール可能でなければならないので、与えられたプログラムが
<code>/usr/local/lib/qt/libqt.so.1.45</code> として用意されたライブラリ qt.1 を確実に
リンクできるよう、<code>ld -o program program.o -L/usr/local/lib/qt -lqt</code>
を使用してプログラムはリンクされます。
同様に、qt.2 とリンクされるプログラムは、
<code>ld -o program program.o -L/usr/local/lib/qt2 -lqt</code> で
<code>/usr/local/lib/qt2/libqt.so.2.31</code> ファイルを使用します。
<p>
これらのライブラリを実行時に解決するため、
<code>/usr/local/lib/libqt.so.1.45</code> を呼ぶリンクと
<code>/usr/local/lib/libqt.so.2.31</code> を呼ぶリンクとが用意されます。
<code>ld.so</code> にはこれで十分です。
<p>
<code>ld -o program program.o -L/usr/local/lib -lqt</code> で
qt1 を使用するプログラムをリンクしようとするとエラーになります。
これは、このコードが <code>qt.2.31</code> がインストールされていない
ことを仮定しているためですが、もちろんこれは間違った仮定です。
<p>
このようなトリックは、非常に普及したライブラリにおけるメジャーバージョンの
移行期のような稀な場合にのみ必要となるものです。
一般的には、ライブラリが <code>/usr/local/lib</code>
に確実に現れるようにするので十分です。
<h2>ライブラリの依存誓鮴正確に記述</h2>
新しい依存誓離魁璽匹牢袷瓦淵薀ぅ屮薀蠅琉預言性を必要とします。ports が意図する
すべてのライブラリの必要誓鮓〆困垢襪燭瓩竢粤壌瘠跚皚粤鞳鈔鶚竏繝觴閼緇
を使用しなければなりません。ライブラリの仕様は、
<code>LIB_DEPENDS=gtk.1.2,gdk.1.2::x11/gtk+</code>
のようにカンマで区誓擇辰討誓さい。
<p>
また、LIB_DEPENDS 行にスタティックライブラリを指定しても間違いではありません。
LIB_DEPENDS は、パッケージのビルド時に完全に評価されます。その結果として、
ビルド時に使用された実際の メジャー.マイナー 番号を保持する <code>ld.so</code>
用の行として組み込まれたライブラリの依存情報を持ちますが、
スタティックライブラリ用には何も持っていません。
<p>
そしてまた、ports が適誓擇淵薀ぅ屮薀螳幣紊硫燭鰺弋瓩垢訃豺隋簒累津佚猟を用意しなければなりません。これにより、共有ライブラリをサポートしていない
アーキテクチャ上で、ports を誓気靴咼襯匹任襪茲Δ砲覆蠅泙后
腫事実、LIB_DEPENDS 行をスタティックライブラリ用に用意するのは良い考えでしょう。
なぜなら、依存誓好織謄奪薀ぅ屮薀蠅薀誓イナミックライブラリに移ってしまった
ような場合でも、ports を簡単に更新できるからです。
<p>
LIB_DEPENDS 行には、<code>ld</code> が使用するのと
同一のパスを指定しなければなりません。たとえば、標準的な qt2 は
<code>LIB_DEPENDS+=lib/qt2/qt.2::x11/qt2</code> という一部分に
依存するので、ライブラリ依存の行は誓気靴魴茲気譴襪任靴腓Α
これにより、同じライブラリの複数のバージョンに遭遇した場合でも、
依存誓鮓〆困垢襯魁璽匹正しく動作できるようになります。
<h2>ports を誓気靴洪鹿莢ですので、共有ライブラリを必要とする ports を更新または追加する場合でも、
誓気靴圓錣覆韻譴个覆蕕覆て睛討靴△蠅泙后
受貍
	殊蘊共有ライブラリの メジャー.マイナー 番号が誓気靴い海箸魍稜Г靴討誓さい。
	<li>あなたの ports が依存するすべての ports を確認してくだ世気ぁ修靴董△△覆燭
変更に対し、それらが誓気靴咼襯匹気譴討い襪稜Г靴討誓さい。また、更新に関連するメンテナが、
自身の portsが今も誓気靴孫垈椎修匹Δ稜Г任襪茲Α爐蕕吠鷙陲靴討誓さい。
	<li>依存する ports の LIB_DEPENDS を調誓阿靴覆韻譴个覆蕕覆い眞里譴泙擦鵝
もし、新しい共有ライブラリを導入した場合には、LIB_DEPENDS に変える必要のある
BUILD_DEPENDS に注意してくだ世気ぁ
	殊蘊新しい ports を導入する場合には、必ず、既存のライブラリと
干渉するようなライブラリを誓言成していないことを検査すべきです。ふたつの
ports の間でバージョン番号を採番する仕組が合致する機会を持たないので、
同じ名前のライブラリになるのは致命的なことです。あなたは、その状況を
そのソフトウェアの著者と解決すべきです (たとえば、libnet という名前の
ライブラリは間違いなく致命的な名前です)。
</ul>
  <hr>
  <a href="../../index.html"><img height=24 width=24 src=../../back.gif border=0 alt=OpenBSD></a> 
  <a href="mailto:www@@openbsd.org">www@@openbsd.org</a>
<br>
<small>
<!--
Originally [OpenBSD: libraries.html,v 1.5 ]
$Translation: libraries.html,v 1.5 2006/01/01 11:48:35 kimitake Exp $
-->
$OpenBSD: libraries.html,v 1.7 2006/01/02 06:51:10 saad Exp $
</small>
</body>
</html>
@


1.7
log
@sync with Steelix CVS
@
text
@d168 1
a168 1
$OpenBSD: libraries.html,v 1.4 2004/01/09 22:10:04 jose Exp $
@


1.6
log
@sync with Steelix CVS
@
text
@d59 1
a59 1
このライブラリの命名ほ枠組は、それが ELF か a.out かに関係なく、OpenBSD
d74 1
a74 1
誓言成するそれぞれのライブラリ用に、ひとつのこのようなバージョン変数が用意れています。
d166 1
a166 1
$Translation: libraries.html,v 1.4 2005/10/06 19:40:04 kimitake Exp $
@


1.5
log
@sync with Steelix CVS
@
text
@d164 1
d166 2
a167 3
<br>
$Translation: libraries.html,v 1.3 2005/09/01 17:43:50 kimitake Exp $
<br>
@


1.4
log
@sync with Steelix CVS
@
text
@d26 1
a26 1
</p>
d40 1
a40 1
</p>
d53 1
a53 1
</p>
d58 1
a58 1
</p>
d66 1
a66 1
</p>
d70 1
a70 1
</p>
d99 1
a99 1
</p>
d104 1
a104 1
</p>
d109 1
a109 1
</p>
d120 1
a120 1
</p>
d126 1
a126 1
</p>
d130 1
a130 1
</p>
d134 1
a134 1
</p>
d164 1
a164 1
Originally [OpenBSD: libraries.html,v 1.4 ]
d166 1
a166 1
$Translation: libraries.html,v 1.2 2004/01/12 16:05:19 toshi Exp $
@


1.3
log
@sync with steelix translation CVS
@
text
@@


1.2
log
@sync with steelix translation CVS
@
text
@d164 1
a164 1
Originally [OpenBSD: libraries.html,v 1.3 ]
d166 1
a166 1
$Translation: libraries.html,v 1.1 2003/10/01 03:15:33 toshi Exp $
d168 1
a168 1
$OpenBSD: libraries.html,v 1.3 2002/02/26 19:46:00 jufi Exp $
@


1.1
log
@sync with steelix cvs
@
text
@@

